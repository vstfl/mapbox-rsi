/*! For license information please see main.js.LICENSE.txt */
(()=>{var t={2591:(t,e,i)=>{"use strict";i.d(e,{A:()=>d});var n=i(1601),r=i.n(n),o=i(6314),s=i.n(o),a=i(4417),l=i.n(a),c=new URL(i(8048),i.b),u=s()(r());u.push([t.id,"@import url(https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap);"]);var h=l()(c);u.push([t.id,`.mdl-button{background:0 0;border:none;border-radius:2px;color:#000;position:relative;height:36px;margin:0;min-width:64px;padding:0 16px;display:inline-block;font-family:Roboto,Helvetica,Arial,sans-serif;font-size:14px;font-weight:500;text-transform:uppercase;line-height:1;letter-spacing:0;overflow:hidden;will-change:box-shadow;transition:box-shadow .2s cubic-bezier(.4,0,1,1),background-color .2s cubic-bezier(.4,0,.2,1),color .2s cubic-bezier(.4,0,.2,1);outline:0;cursor:pointer;text-decoration:none;text-align:center;line-height:36px;vertical-align:middle}.mdl-button::-moz-focus-inner{border:0}.mdl-button:hover{background-color:rgba(158,158,158,.2)}.mdl-button:focus:not(:active){background-color:rgba(0,0,0,.12)}.mdl-button:active{background-color:rgba(158,158,158,.4)}.mdl-button.mdl-button--colored{color:#3f51b5}.mdl-button.mdl-button--colored:focus:not(:active){background-color:rgba(0,0,0,.12)}input.mdl-button[type=submit]{-webkit-appearance:none}.mdl-button--raised{background:rgba(158,158,158,.2);box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12)}.mdl-button--raised:active{box-shadow:0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12),0 2px 4px -1px rgba(0,0,0,.2);background-color:rgba(158,158,158,.4)}.mdl-button--raised:focus:not(:active){box-shadow:0 0 8px rgba(0,0,0,.18),0 8px 16px rgba(0,0,0,.36);background-color:rgba(158,158,158,.4)}.mdl-button--raised.mdl-button--colored{background:#3f51b5;color:#fff}.mdl-button--raised.mdl-button--colored:hover{background-color:#3f51b5}.mdl-button--raised.mdl-button--colored:active{background-color:#3f51b5}.mdl-button--raised.mdl-button--colored:focus:not(:active){background-color:#3f51b5}.mdl-button--raised.mdl-button--colored .mdl-ripple{background:#fff}.mdl-button--fab{border-radius:50%;font-size:24px;height:56px;margin:auto;min-width:56px;width:56px;padding:0;overflow:hidden;background:rgba(158,158,158,.2);box-shadow:0 1px 1.5px 0 rgba(0,0,0,.12),0 1px 1px 0 rgba(0,0,0,.24);position:relative;line-height:normal}.mdl-button--fab .material-icons{position:absolute;top:50%;left:50%;transform:translate(-12px,-12px);line-height:24px;width:24px}.mdl-button--fab.mdl-button--mini-fab{height:40px;min-width:40px;width:40px}.mdl-button--fab .mdl-button__ripple-container{border-radius:50%;-webkit-mask-image:-webkit-radial-gradient(circle,#fff,#000)}.mdl-button--fab:active{box-shadow:0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12),0 2px 4px -1px rgba(0,0,0,.2);background-color:rgba(158,158,158,.4)}.mdl-button--fab:focus:not(:active){box-shadow:0 0 8px rgba(0,0,0,.18),0 8px 16px rgba(0,0,0,.36);background-color:rgba(158,158,158,.4)}.mdl-button--fab.mdl-button--colored{background:#ff4081;color:#fff}.mdl-button--fab.mdl-button--colored:hover{background-color:#ff4081}.mdl-button--fab.mdl-button--colored:focus:not(:active){background-color:#ff4081}.mdl-button--fab.mdl-button--colored:active{background-color:#ff4081}.mdl-button--fab.mdl-button--colored .mdl-ripple{background:#fff}.mdl-button--icon{border-radius:50%;font-size:24px;height:32px;margin-left:0;margin-right:0;min-width:32px;width:32px;padding:0;overflow:hidden;color:inherit;line-height:normal}.mdl-button--icon .material-icons{position:absolute;top:50%;left:50%;transform:translate(-12px,-12px);line-height:24px;width:24px}.mdl-button--icon.mdl-button--mini-icon{height:24px;min-width:24px;width:24px}.mdl-button--icon.mdl-button--mini-icon .material-icons{top:0;left:0}.mdl-button--icon .mdl-button__ripple-container{border-radius:50%;-webkit-mask-image:-webkit-radial-gradient(circle,#fff,#000)}.mdl-button__ripple-container{display:block;height:100%;left:0;position:absolute;top:0;width:100%;z-index:0;overflow:hidden}.mdl-button.mdl-button--disabled .mdl-button__ripple-container .mdl-ripple,.mdl-button[disabled] .mdl-button__ripple-container .mdl-ripple{background-color:transparent}.mdl-button--primary.mdl-button--primary{color:#3f51b5}.mdl-button--primary.mdl-button--primary .mdl-ripple{background:#fff}.mdl-button--primary.mdl-button--primary.mdl-button--fab,.mdl-button--primary.mdl-button--primary.mdl-button--raised{color:#fff;background-color:#3f51b5}.mdl-button--accent.mdl-button--accent{color:#ff4081}.mdl-button--accent.mdl-button--accent .mdl-ripple{background:#fff}.mdl-button--accent.mdl-button--accent.mdl-button--fab,.mdl-button--accent.mdl-button--accent.mdl-button--raised{color:#fff;background-color:#ff4081}.mdl-button.mdl-button--disabled.mdl-button--disabled,.mdl-button[disabled][disabled]{color:rgba(0,0,0,.26);cursor:default;background-color:transparent}.mdl-button--fab.mdl-button--disabled.mdl-button--disabled,.mdl-button--fab[disabled][disabled]{background-color:rgba(0,0,0,.12);color:rgba(0,0,0,.26)}.mdl-button--raised.mdl-button--disabled.mdl-button--disabled,.mdl-button--raised[disabled][disabled]{background-color:rgba(0,0,0,.12);color:rgba(0,0,0,.26);box-shadow:none}.mdl-button--colored.mdl-button--disabled.mdl-button--disabled,.mdl-button--colored[disabled][disabled]{color:rgba(0,0,0,.26)}.mdl-button .material-icons{vertical-align:middle}.mdl-card{display:flex;flex-direction:column;font-size:16px;font-weight:400;min-height:200px;overflow:hidden;width:330px;z-index:1;position:relative;background:#fff;border-radius:2px;box-sizing:border-box}.mdl-card__media{background-color:#ff4081;background-repeat:repeat;background-position:50% 50%;background-size:cover;background-origin:padding-box;background-attachment:scroll;box-sizing:border-box}.mdl-card__title{align-items:center;color:#000;display:block;display:flex;justify-content:stretch;line-height:normal;padding:16px 16px;perspective-origin:165px 56px;transform-origin:165px 56px;box-sizing:border-box}.mdl-card__title.mdl-card--border{border-bottom:1px solid rgba(0,0,0,.1)}.mdl-card__title-text{align-self:flex-end;color:inherit;display:block;display:flex;font-size:24px;font-weight:300;line-height:normal;overflow:hidden;transform-origin:149px 48px;margin:0}.mdl-card__subtitle-text{font-size:14px;color:rgba(0,0,0,.54);margin:0}.mdl-card__supporting-text{color:rgba(0,0,0,.54);font-size:1rem;line-height:18px;overflow:hidden;padding:16px 16px;width:90%}.mdl-card__supporting-text.mdl-card--border{border-bottom:1px solid rgba(0,0,0,.1)}.mdl-card__actions{font-size:16px;line-height:normal;width:100%;background-color:rgba(0,0,0,0);padding:8px;box-sizing:border-box}.mdl-card__actions.mdl-card--border{border-top:1px solid rgba(0,0,0,.1)}.mdl-card--expand{flex-grow:1}.mdl-card__menu{position:absolute;right:16px;top:16px}.mdl-dialog{border:none;box-shadow:0 9px 46px 8px rgba(0,0,0,.14),0 11px 15px -7px rgba(0,0,0,.12),0 24px 38px 3px rgba(0,0,0,.2);width:280px}.mdl-dialog__title{padding:24px 24px 0;margin:0;font-size:2.5rem}.mdl-dialog__actions{padding:8px 8px 8px 24px;display:flex;flex-direction:row-reverse;flex-wrap:wrap}.mdl-dialog__actions>*{margin-right:8px;height:36px}.mdl-dialog__actions>:first-child{margin-right:0}.mdl-dialog__actions--full-width{padding:0 0 8px 0}.mdl-dialog__actions--full-width>*{height:48px;flex:0 0 100%;padding-right:16px;margin-right:0;text-align:right}.mdl-dialog__content{padding:20px 24px 24px 24px;color:rgba(0,0,0,.54)}.mdl-progress{display:block;position:relative;height:4px;width:500px;max-width:100%}.mdl-progress>.bar{display:block;position:absolute;top:0;bottom:0;width:0%;transition:width .2s cubic-bezier(.4,0,.2,1)}.mdl-progress>.progressbar{background-color:#3f51b5;z-index:1;left:0}.mdl-progress>.bufferbar{background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#3f51b5,#3f51b5);z-index:0;left:0}.mdl-progress>.auxbar{right:0}@supports (-webkit-appearance:none){.mdl-progress:not(.mdl-progress--indeterminate):not(.mdl-progress--indeterminate)>.auxbar,.mdl-progress:not(.mdl-progress__indeterminate):not(.mdl-progress__indeterminate)>.auxbar{background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#3f51b5,#3f51b5);mask:url(${h})}}.mdl-progress:not(.mdl-progress--indeterminate)>.auxbar,.mdl-progress:not(.mdl-progress__indeterminate)>.auxbar{background-image:linear-gradient(to right,rgba(255,255,255,.9),rgba(255,255,255,.9)),linear-gradient(to right,#3f51b5,#3f51b5)}.mdl-progress.mdl-progress--indeterminate>.bar1,.mdl-progress.mdl-progress__indeterminate>.bar1{background-color:#3f51b5;animation-name:indeterminate1;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.mdl-progress.mdl-progress--indeterminate>.bar3,.mdl-progress.mdl-progress__indeterminate>.bar3{background-image:none;background-color:#3f51b5;animation-name:indeterminate2;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}@keyframes indeterminate1{0%{left:0;width:0%}50%{left:25%;width:75%}75%{left:100%;width:0%}}@keyframes indeterminate2{0%{left:0;width:0%}50%{left:0;width:0%}75%{left:0;width:25%}100%{left:100%;width:0%}}.mdl-shadow--2dp{box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12)}.mdl-shadow--3dp{box-shadow:0 3px 4px 0 rgba(0,0,0,.14),0 3px 3px -2px rgba(0,0,0,.2),0 1px 8px 0 rgba(0,0,0,.12)}.mdl-shadow--4dp{box-shadow:0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12),0 2px 4px -1px rgba(0,0,0,.2)}.mdl-shadow--6dp{box-shadow:0 6px 10px 0 rgba(0,0,0,.14),0 1px 18px 0 rgba(0,0,0,.12),0 3px 5px -1px rgba(0,0,0,.2)}.mdl-shadow--8dp{box-shadow:0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12),0 5px 5px -3px rgba(0,0,0,.2)}.mdl-shadow--16dp{box-shadow:0 16px 24px 2px rgba(0,0,0,.14),0 6px 30px 5px rgba(0,0,0,.12),0 8px 10px -5px rgba(0,0,0,.2)}.mdl-shadow--24dp{box-shadow:0 9px 46px 8px rgba(0,0,0,.14),0 11px 15px -7px rgba(0,0,0,.12),0 24px 38px 3px rgba(0,0,0,.2)}.mdl-spinner{display:inline-block;position:relative;width:28px;height:28px}.mdl-spinner:not(.is-upgraded).is-active:after{content:"Loading..."}.mdl-spinner.is-upgraded.is-active{animation:mdl-spinner__container-rotate 1.568s linear infinite}@keyframes mdl-spinner__container-rotate{to{transform:rotate(360deg)}}.mdl-spinner__layer{position:absolute;width:100%;height:100%;opacity:0}.mdl-spinner__layer-1{border-color:#42a5f5}.mdl-spinner--single-color .mdl-spinner__layer-1{border-color:#3f51b5}.mdl-spinner.is-active .mdl-spinner__layer-1{animation:mdl-spinner__fill-unfill-rotate 5332ms cubic-bezier(.4,0,.2,1) infinite both,mdl-spinner__layer-1-fade-in-out 5332ms cubic-bezier(.4,0,.2,1) infinite both}.mdl-spinner__layer-2{border-color:#f44336}.mdl-spinner--single-color .mdl-spinner__layer-2{border-color:#3f51b5}.mdl-spinner.is-active .mdl-spinner__layer-2{animation:mdl-spinner__fill-unfill-rotate 5332ms cubic-bezier(.4,0,.2,1) infinite both,mdl-spinner__layer-2-fade-in-out 5332ms cubic-bezier(.4,0,.2,1) infinite both}.mdl-spinner__layer-3{border-color:#fdd835}.mdl-spinner--single-color .mdl-spinner__layer-3{border-color:#3f51b5}.mdl-spinner.is-active .mdl-spinner__layer-3{animation:mdl-spinner__fill-unfill-rotate 5332ms cubic-bezier(.4,0,.2,1) infinite both,mdl-spinner__layer-3-fade-in-out 5332ms cubic-bezier(.4,0,.2,1) infinite both}.mdl-spinner__layer-4{border-color:#4caf50}.mdl-spinner--single-color .mdl-spinner__layer-4{border-color:#3f51b5}.mdl-spinner.is-active .mdl-spinner__layer-4{animation:mdl-spinner__fill-unfill-rotate 5332ms cubic-bezier(.4,0,.2,1) infinite both,mdl-spinner__layer-4-fade-in-out 5332ms cubic-bezier(.4,0,.2,1) infinite both}@keyframes mdl-spinner__fill-unfill-rotate{12.5%{transform:rotate(135deg)}25%{transform:rotate(270deg)}37.5%{transform:rotate(405deg)}50%{transform:rotate(540deg)}62.5%{transform:rotate(675deg)}75%{transform:rotate(810deg)}87.5%{transform:rotate(945deg)}to{transform:rotate(1080deg)}}@keyframes mdl-spinner__layer-1-fade-in-out{from{opacity:.99}25%{opacity:.99}26%{opacity:0}89%{opacity:0}90%{opacity:.99}100%{opacity:.99}}@keyframes mdl-spinner__layer-2-fade-in-out{from{opacity:0}15%{opacity:0}25%{opacity:.99}50%{opacity:.99}51%{opacity:0}}@keyframes mdl-spinner__layer-3-fade-in-out{from{opacity:0}40%{opacity:0}50%{opacity:.99}75%{opacity:.99}76%{opacity:0}}@keyframes mdl-spinner__layer-4-fade-in-out{from{opacity:0}65%{opacity:0}75%{opacity:.99}90%{opacity:.99}100%{opacity:0}}.mdl-spinner__gap-patch{position:absolute;box-sizing:border-box;top:0;left:45%;width:10%;height:100%;overflow:hidden;border-color:inherit}.mdl-spinner__gap-patch .mdl-spinner__circle{width:1000%;left:-450%}.mdl-spinner__circle-clipper{display:inline-block;position:relative;width:50%;height:100%;overflow:hidden;border-color:inherit}.mdl-spinner__circle-clipper.mdl-spinner__left{float:left}.mdl-spinner__circle-clipper.mdl-spinner__right{float:right}.mdl-spinner__circle-clipper .mdl-spinner__circle{width:200%}.mdl-spinner__circle{box-sizing:border-box;height:100%;border-width:3px;border-style:solid;border-color:inherit;border-bottom-color:transparent!important;border-radius:50%;animation:none;position:absolute;top:0;right:0;bottom:0;left:0}.mdl-spinner__left .mdl-spinner__circle{border-right-color:transparent!important;transform:rotate(129deg)}.mdl-spinner.is-active .mdl-spinner__left .mdl-spinner__circle{animation:mdl-spinner__left-spin 1333ms cubic-bezier(.4,0,.2,1) infinite both}.mdl-spinner__right .mdl-spinner__circle{left:-100%;border-left-color:transparent!important;transform:rotate(-129deg)}.mdl-spinner.is-active .mdl-spinner__right .mdl-spinner__circle{animation:mdl-spinner__right-spin 1333ms cubic-bezier(.4,0,.2,1) infinite both}@keyframes mdl-spinner__left-spin{from{transform:rotate(130deg)}50%{transform:rotate(-5deg)}to{transform:rotate(130deg)}}@keyframes mdl-spinner__right-spin{from{transform:rotate(-130deg)}50%{transform:rotate(5deg)}to{transform:rotate(-130deg)}}.mdl-textfield{position:relative;font-size:16px;display:inline-block;box-sizing:border-box;width:300px;max-width:100%;margin:0;padding:20px 0}.mdl-textfield .mdl-button{position:absolute;bottom:20px}.mdl-textfield--align-right{text-align:right}.mdl-textfield--full-width{width:100%}.mdl-textfield--expandable{min-width:32px;width:auto;min-height:32px}.mdl-textfield--expandable .mdl-button--icon{top:16px}.mdl-textfield__input{border:none;border-bottom:1px solid rgba(0,0,0,.12);display:block;font-size:16px;font-family:Helvetica,Arial,sans-serif;margin:0;padding:4px 0;width:100%;background:0 0;text-align:left;color:inherit}.mdl-textfield__input[type=number]{-moz-appearance:textfield}.mdl-textfield__input[type=number]::-webkit-inner-spin-button,.mdl-textfield__input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.mdl-textfield.is-focused .mdl-textfield__input{outline:0}.mdl-textfield.is-invalid .mdl-textfield__input{border-color:#d50000;box-shadow:none}.mdl-textfield.is-disabled .mdl-textfield__input,fieldset[disabled] .mdl-textfield .mdl-textfield__input{background-color:transparent;border-bottom:1px dotted rgba(0,0,0,.12);color:rgba(0,0,0,.26)}.mdl-textfield textarea.mdl-textfield__input{display:block}.mdl-textfield__label{bottom:0;color:rgba(0,0,0,.26);font-size:16px;left:0;right:0;pointer-events:none;position:absolute;display:block;top:24px;width:100%;overflow:hidden;white-space:nowrap;text-align:left}.mdl-textfield.has-placeholder .mdl-textfield__label,.mdl-textfield.is-dirty .mdl-textfield__label{visibility:hidden}.mdl-textfield--floating-label .mdl-textfield__label{transition-duration:.2s;transition-timing-function:cubic-bezier(.4,0,.2,1)}.mdl-textfield--floating-label.has-placeholder .mdl-textfield__label{transition:none}.mdl-textfield.is-disabled.is-disabled .mdl-textfield__label,fieldset[disabled] .mdl-textfield .mdl-textfield__label{color:rgba(0,0,0,.26)}.mdl-textfield--floating-label.has-placeholder .mdl-textfield__label,.mdl-textfield--floating-label.is-dirty .mdl-textfield__label,.mdl-textfield--floating-label.is-focused .mdl-textfield__label{color:#3f51b5;font-size:12px;top:4px;visibility:visible}.mdl-textfield--floating-label.has-placeholder .mdl-textfield__expandable-holder .mdl-textfield__label,.mdl-textfield--floating-label.is-dirty .mdl-textfield__expandable-holder .mdl-textfield__label,.mdl-textfield--floating-label.is-focused .mdl-textfield__expandable-holder .mdl-textfield__label{top:-16px}.mdl-textfield--floating-label.is-invalid .mdl-textfield__label{color:#d50000;font-size:12px}.mdl-textfield__label:after{background-color:#3f51b5;bottom:20px;content:"";height:2px;left:45%;position:absolute;transition-duration:.2s;transition-timing-function:cubic-bezier(.4,0,.2,1);visibility:hidden;width:10px}.mdl-textfield.is-focused .mdl-textfield__label:after{left:0;visibility:visible;width:100%}.mdl-textfield.is-invalid .mdl-textfield__label:after{background-color:#d50000}.mdl-textfield__error{color:#d50000;position:absolute;font-size:12px;margin-top:3px;visibility:hidden;display:block}.mdl-textfield.is-invalid .mdl-textfield__error{visibility:visible}.mdl-textfield__expandable-holder{display:inline-block;position:relative;margin-left:32px;transition-duration:.2s;transition-timing-function:cubic-bezier(.4,0,.2,1);display:inline-block;max-width:.1px}.mdl-textfield.is-dirty .mdl-textfield__expandable-holder,.mdl-textfield.is-focused .mdl-textfield__expandable-holder{max-width:600px}.mdl-textfield__expandable-holder .mdl-textfield__label:after{bottom:0}dialog{position:absolute;left:0;right:0;width:-moz-fit-content;width:-webkit-fit-content;width:fit-content;height:-moz-fit-content;height:-webkit-fit-content;height:fit-content;margin:auto;border:solid;padding:1em;background:#fff;color:#000;display:block}dialog:not([open]){display:none}dialog+.backdrop{position:fixed;top:0;right:0;bottom:0;left:0;background:rgba(0,0,0,.1)}._dialog_overlay{position:fixed;top:0;right:0;bottom:0;left:0}dialog.fixed{position:fixed;top:50%;transform:translate(0,-50%)}.firebaseui-container{background-color:#fff;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;color:rgba(0,0,0,.87);direction:ltr;font:16px Roboto,arial,sans-serif;margin:0 auto;max-width:360px;overflow:visible;position:relative;text-align:left;width:100%}.firebaseui-container.mdl-card{overflow:visible}.firebaseui-card-header{padding:24px 24px 0 24px}.firebaseui-card-content{padding:0 24px}.firebaseui-card-footer{padding:0 24px}.firebaseui-card-actions{box-sizing:border-box;display:table;font-size:14px;padding:8px 24px 24px 24px;text-align:left;width:100%}.firebaseui-form-links{display:table-cell;vertical-align:middle;width:100%}.firebaseui-form-actions{display:table-cell;text-align:right;white-space:nowrap;width:100%}.firebaseui-subtitle,.firebaseui-title{color:rgba(0,0,0,.87);direction:ltr;font-size:20px;font-weight:500;line-height:24px;margin:0;padding:0;text-align:left}.firebaseui-title{padding-bottom:16px}.firebaseui-subtitle{margin:16px 0}.firebaseui-text{color:rgba(0,0,0,.87);direction:ltr;font-size:16px;line-height:24px;text-align:left}.firebaseui-id-page-password-recovery-email-sent p.firebaseui-text{margin:16px 0}.firebaseui-text-emphasis{font-weight:700}.firebaseui-error{color:#dd2c00;direction:ltr;font-size:12px;line-height:16px;margin:0;text-align:left}.firebaseui-text-input-error{margin:-16px 0 16px}.firebaseui-error-wrapper{min-height:16px}.firebaseui-list-item{direction:ltr;margin:0;padding:0;text-align:left}.firebaseui-hidden{display:none}.firebaseui-relative-wrapper{position:relative}.firebaseui-label{color:rgba(0,0,0,.54);direction:ltr;font-size:16px;text-align:left}.mdl-textfield--floating-label.is-dirty .mdl-textfield__label,.mdl-textfield--floating-label.is-focused .mdl-textfield__label{color:#757575}.firebaseui-input,.firebaseui-input-invalid{border-radius:0;color:rgba(0,0,0,.87);direction:ltr;font-size:16px;width:100%}input.firebaseui-input,input.firebaseui-input-invalid{direction:ltr;text-align:left}.firebaseui-input-invalid{border-color:#dd2c00}.firebaseui-textfield{width:100%}.firebaseui-textfield.mdl-textfield .firebaseui-input{border-color:rgba(0,0,0,.12)}.firebaseui-textfield.mdl-textfield .firebaseui-label::after{background-color:#3f51b5}.firebaseui-textfield-invalid.mdl-textfield .firebaseui-input{border-color:#dd2c00}.firebaseui-textfield-invalid.mdl-textfield .firebaseui-label::after{background-color:#dd2c00}.firebaseui-button{display:inline-block;height:36px;margin-left:8px;min-width:88px}.firebaseui-link{color:#4285f4;font-variant:normal;font-weight:400;text-decoration:none}.firebaseui-link:hover{text-decoration:underline}.firebaseui-indent{margin-left:1em}.firebaseui-tos{color:#757575;direction:ltr;font-size:12px;line-height:16px;margin-bottom:24px;margin-top:0;text-align:left}.firebaseui-provider-sign-in-footer>.firebaseui-tos{text-align:center}.firebaseui-tos-list{list-style:none;text-align:right}.firebaseui-inline-list-item{display:inline-block;margin-left:5px;margin-right:5px}.firebaseui-page-provider-sign-in,.firebaseui-page-select-tenant{background:inherit}.firebaseui-idp-list,.firebaseui-tenant-list{list-style:none;margin:1em 0;padding:0}.firebaseui-idp-button,.firebaseui-tenant-button{direction:ltr;font-weight:500;height:auto;line-height:normal;max-width:220px;min-height:40px;padding:8px 16px;text-align:left;width:100%}.firebaseui-idp-list>.firebaseui-list-item,.firebaseui-tenant-list>.firebaseui-list-item{margin-bottom:15px;text-align:center}.firebaseui-idp-icon-wrapper{display:table-cell;vertical-align:middle}.firebaseui-idp-icon{border:none;display:inline-block;height:18px;vertical-align:middle;width:18px}.firebaseui-idp-favicon{border:none;display:inline-block;height:14px;margin-right:5px;vertical-align:middle;width:14px}.firebaseui-idp-text{color:#fff;display:table-cell;font-size:14px;padding-left:16px;text-transform:none;vertical-align:middle}.firebaseui-idp-text.firebaseui-idp-text-long{display:table-cell}.firebaseui-idp-text.firebaseui-idp-text-short{display:none}@media (max-width:268px){.firebaseui-idp-text.firebaseui-idp-text-long{display:none}.firebaseui-idp-text.firebaseui-idp-text-short{display:table-cell}}@media (max-width:320px){.firebaseui-recaptcha-container>div>div{transform:scale(.9);-webkit-transform:scale(.9);transform-origin:0 0;-webkit-transform-origin:0 0}}.firebaseui-idp-google>.firebaseui-idp-text{color:#757575}[data-provider-id="yahoo.com"]>.firebaseui-idp-icon-wrapper>.firebaseui-idp-icon{height:22px;width:22px}.firebaseui-info-bar{background-color:#f9edbe;border:1px solid #f0c36d;box-shadow:0 2px 4px rgba(0,0,0,.2);-webkit-box-shadow:0 2px 4px rgba(0,0,0,.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,.2);left:10%;padding:8px 16px;position:absolute;right:10%;text-align:center;top:0}.firebaseui-info-bar-message{font-size:12px;margin:0}.firebaseui-dialog{box-sizing:border-box;color:rgba(0,0,0,.87);font:16px Roboto,arial,sans-serif;height:auto;max-height:fit-content;padding:24px;text-align:left}.firebaseui-dialog-icon-wrapper{display:table-cell;vertical-align:middle}.firebaseui-dialog-icon{float:left;height:40px;margin-right:24px;width:40px}.firebaseui-progress-dialog-message{display:table-cell;font-size:16px;font-weight:400;min-height:40px;vertical-align:middle}.firebaseui-progress-dialog-loading-icon{height:28px;margin:6px 30px 6px 6px;width:28px}.firebaseui-icon-done{background-image:url(https://www.gstatic.com/images/icons/material/system/2x/done_googgreen_36dp.png);background-position:center;background-repeat:no-repeat;background-size:36px 36px}.firebaseui-phone-number{display:flex}.firebaseui-country-selector{background-image:url(https://www.gstatic.com/images/icons/material/system/1x/arrow_drop_down_grey600_18dp.png);background-position:right center;background-repeat:no-repeat;background-size:18px auto;border-radius:0;border-bottom:1px solid rgba(0,0,0,.12);color:rgba(0,0,0,.87);flex-shrink:0;font-size:16px;font-weight:400;height:initial;line-height:normal;margin:20px 24px 20px 0;padding:4px 20px 4px 0;width:90px}.firebaseui-country-selector-flag{display:inline-block;margin-right:1ex}.firebaseui-flag{background-image:url(https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/flags_sprite_2x.png);background-size:100% auto;filter:drop-shadow(1px 1px 1px rgba(0, 0, 0, .54));height:14px;width:24px}.firebaseui-list-box-dialog{max-height:90%;overflow:auto;padding:8px 0 0 0}.firebaseui-list-box-actions{padding-bottom:8px}.firebaseui-list-box-icon-wrapper{display:table-cell;padding-right:24px;vertical-align:top}.firebaseui-list-box-label-wrapper{display:table-cell;vertical-align:top}.firebaseui-list-box-dialog-button{color:rgba(0,0,0,.87);direction:ltr;font-size:16px;font-weight:400;height:initial;line-height:normal;min-height:48px;padding:14px 24px;text-align:left;text-transform:none;width:100%}.firebaseui-phone-number-error{margin-left:114px}.mdl-progress.firebaseui-busy-indicator{height:2px;left:0;position:absolute;top:55px;width:100%}.mdl-spinner.firebaseui-busy-indicator{direction:initial;height:56px;left:0;margin:auto;position:absolute;right:0;top:30%;width:56px}.firebaseui-callback-indicator-container .firebaseui-busy-indicator{top:0}.firebaseui-callback-indicator-container{height:120px}.firebaseui-new-password-component{display:inline-block;position:relative;width:100%}.firebaseui-input-floating-button{background-position:center;background-repeat:no-repeat;display:block;height:24px;position:absolute;right:0;top:20px;width:24px}.firebaseui-input-toggle-on{background-image:url(https://www.gstatic.com/images/icons/material/system/1x/visibility_black_24dp.png)}.firebaseui-input-toggle-off{background-image:url(https://www.gstatic.com/images/icons/material/system/1x/visibility_off_black_24dp.png)}.firebaseui-input-toggle-focus{opacity:.87}.firebaseui-input-toggle-blur{opacity:.38}.firebaseui-recaptcha-wrapper{display:table;margin:0 auto;padding-bottom:8px}.firebaseui-recaptcha-container{display:table-cell}.firebaseui-recaptcha-error-wrapper{caption-side:bottom;display:table-caption}.firebaseui-change-phone-number-link{display:block}.firebaseui-resend-container{direction:ltr;margin:20px 0;text-align:center}.firebaseui-id-resend-countdown{color:rgba(0,0,0,.38)}.firebaseui-id-page-phone-sign-in-start .firebaseui-form-actions div{float:left}@media (max-width:480px){.firebaseui-container{box-shadow:none;max-width:none;width:100%}.firebaseui-card-header{border-bottom:1px solid #e0e0e0;margin-bottom:16px;padding:16px 24px 0 24px}.firebaseui-title{padding-bottom:16px}.firebaseui-card-actions{padding-right:24px}.firebaseui-busy-indicator{top:0}}.mdl-textfield__label{font-weight:400;margin-bottom:0}.firebaseui-id-page-blank{background:inherit;height:64px}.firebaseui-id-page-spinner{background:inherit;height:64px}.firebaseui-email-sent{background-image:url(https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/success_status.png);background-position:center;background-repeat:no-repeat;background-size:64px 64px;height:64px;margin-top:16px;text-align:center}.firebaseui-text-justify{text-align:justify}.firebaseui-flag-KY{background-position:0 0}.firebaseui-flag-AC{background-position:0 -14px}.firebaseui-flag-AE{background-position:0 -28px}.firebaseui-flag-AF{background-position:0 -42px}.firebaseui-flag-AG{background-position:0 -56px}.firebaseui-flag-AI{background-position:0 -70px}.firebaseui-flag-AL{background-position:0 -84px}.firebaseui-flag-AM{background-position:0 -98px}.firebaseui-flag-AO{background-position:0 -112px}.firebaseui-flag-AQ{background-position:0 -126px}.firebaseui-flag-AR{background-position:0 -140px}.firebaseui-flag-AS{background-position:0 -154px}.firebaseui-flag-AT{background-position:0 -168px}.firebaseui-flag-AU{background-position:0 -182px}.firebaseui-flag-AW{background-position:0 -196px}.firebaseui-flag-AX{background-position:0 -210px}.firebaseui-flag-AZ{background-position:0 -224px}.firebaseui-flag-BA{background-position:0 -238px}.firebaseui-flag-BB{background-position:0 -252px}.firebaseui-flag-BD{background-position:0 -266px}.firebaseui-flag-BE{background-position:0 -280px}.firebaseui-flag-BF{background-position:0 -294px}.firebaseui-flag-BG{background-position:0 -308px}.firebaseui-flag-BH{background-position:0 -322px}.firebaseui-flag-BI{background-position:0 -336px}.firebaseui-flag-BJ{background-position:0 -350px}.firebaseui-flag-BL{background-position:0 -364px}.firebaseui-flag-BM{background-position:0 -378px}.firebaseui-flag-BN{background-position:0 -392px}.firebaseui-flag-BO{background-position:0 -406px}.firebaseui-flag-BQ{background-position:0 -420px}.firebaseui-flag-BR{background-position:0 -434px}.firebaseui-flag-BS{background-position:0 -448px}.firebaseui-flag-BT{background-position:0 -462px}.firebaseui-flag-BV{background-position:0 -476px}.firebaseui-flag-BW{background-position:0 -490px}.firebaseui-flag-BY{background-position:0 -504px}.firebaseui-flag-BZ{background-position:0 -518px}.firebaseui-flag-CA{background-position:0 -532px}.firebaseui-flag-CC{background-position:0 -546px}.firebaseui-flag-CD{background-position:0 -560px}.firebaseui-flag-CF{background-position:0 -574px}.firebaseui-flag-CG{background-position:0 -588px}.firebaseui-flag-CH{background-position:0 -602px}.firebaseui-flag-CI{background-position:0 -616px}.firebaseui-flag-CK{background-position:0 -630px}.firebaseui-flag-CL{background-position:0 -644px}.firebaseui-flag-CM{background-position:0 -658px}.firebaseui-flag-CN{background-position:0 -672px}.firebaseui-flag-CO{background-position:0 -686px}.firebaseui-flag-CP{background-position:0 -700px}.firebaseui-flag-CR{background-position:0 -714px}.firebaseui-flag-CU{background-position:0 -728px}.firebaseui-flag-CV{background-position:0 -742px}.firebaseui-flag-CW{background-position:0 -756px}.firebaseui-flag-CX{background-position:0 -770px}.firebaseui-flag-CY{background-position:0 -784px}.firebaseui-flag-CZ{background-position:0 -798px}.firebaseui-flag-DE{background-position:0 -812px}.firebaseui-flag-DG{background-position:0 -826px}.firebaseui-flag-DJ{background-position:0 -840px}.firebaseui-flag-DK{background-position:0 -854px}.firebaseui-flag-DM{background-position:0 -868px}.firebaseui-flag-DO{background-position:0 -882px}.firebaseui-flag-DZ{background-position:0 -896px}.firebaseui-flag-EA{background-position:0 -910px}.firebaseui-flag-EC{background-position:0 -924px}.firebaseui-flag-EE{background-position:0 -938px}.firebaseui-flag-EG{background-position:0 -952px}.firebaseui-flag-EH{background-position:0 -966px}.firebaseui-flag-ER{background-position:0 -980px}.firebaseui-flag-ES{background-position:0 -994px}.firebaseui-flag-ET{background-position:0 -1008px}.firebaseui-flag-EU{background-position:0 -1022px}.firebaseui-flag-FI{background-position:0 -1036px}.firebaseui-flag-FJ{background-position:0 -1050px}.firebaseui-flag-FK{background-position:0 -1064px}.firebaseui-flag-FM{background-position:0 -1078px}.firebaseui-flag-FO{background-position:0 -1092px}.firebaseui-flag-FR{background-position:0 -1106px}.firebaseui-flag-GA{background-position:0 -1120px}.firebaseui-flag-GB{background-position:0 -1134px}.firebaseui-flag-GD{background-position:0 -1148px}.firebaseui-flag-GE{background-position:0 -1162px}.firebaseui-flag-GF{background-position:0 -1176px}.firebaseui-flag-GG{background-position:0 -1190px}.firebaseui-flag-GH{background-position:0 -1204px}.firebaseui-flag-GI{background-position:0 -1218px}.firebaseui-flag-GL{background-position:0 -1232px}.firebaseui-flag-GM{background-position:0 -1246px}.firebaseui-flag-GN{background-position:0 -1260px}.firebaseui-flag-GP{background-position:0 -1274px}.firebaseui-flag-GQ{background-position:0 -1288px}.firebaseui-flag-GR{background-position:0 -1302px}.firebaseui-flag-GS{background-position:0 -1316px}.firebaseui-flag-GT{background-position:0 -1330px}.firebaseui-flag-GU{background-position:0 -1344px}.firebaseui-flag-GW{background-position:0 -1358px}.firebaseui-flag-GY{background-position:0 -1372px}.firebaseui-flag-HK{background-position:0 -1386px}.firebaseui-flag-HM{background-position:0 -1400px}.firebaseui-flag-HN{background-position:0 -1414px}.firebaseui-flag-HR{background-position:0 -1428px}.firebaseui-flag-HT{background-position:0 -1442px}.firebaseui-flag-HU{background-position:0 -1456px}.firebaseui-flag-IC{background-position:0 -1470px}.firebaseui-flag-ID{background-position:0 -1484px}.firebaseui-flag-IE{background-position:0 -1498px}.firebaseui-flag-IL{background-position:0 -1512px}.firebaseui-flag-IM{background-position:0 -1526px}.firebaseui-flag-IN{background-position:0 -1540px}.firebaseui-flag-IO{background-position:0 -1554px}.firebaseui-flag-IQ{background-position:0 -1568px}.firebaseui-flag-IR{background-position:0 -1582px}.firebaseui-flag-IS{background-position:0 -1596px}.firebaseui-flag-IT{background-position:0 -1610px}.firebaseui-flag-JE{background-position:0 -1624px}.firebaseui-flag-JM{background-position:0 -1638px}.firebaseui-flag-JO{background-position:0 -1652px}.firebaseui-flag-JP{background-position:0 -1666px}.firebaseui-flag-KE{background-position:0 -1680px}.firebaseui-flag-KG{background-position:0 -1694px}.firebaseui-flag-KH{background-position:0 -1708px}.firebaseui-flag-KI{background-position:0 -1722px}.firebaseui-flag-KM{background-position:0 -1736px}.firebaseui-flag-KN{background-position:0 -1750px}.firebaseui-flag-KP{background-position:0 -1764px}.firebaseui-flag-KR{background-position:0 -1778px}.firebaseui-flag-KW{background-position:0 -1792px}.firebaseui-flag-AD{background-position:0 -1806px}.firebaseui-flag-KZ{background-position:0 -1820px}.firebaseui-flag-LA{background-position:0 -1834px}.firebaseui-flag-LB{background-position:0 -1848px}.firebaseui-flag-LC{background-position:0 -1862px}.firebaseui-flag-LI{background-position:0 -1876px}.firebaseui-flag-LK{background-position:0 -1890px}.firebaseui-flag-LR{background-position:0 -1904px}.firebaseui-flag-LS{background-position:0 -1918px}.firebaseui-flag-LT{background-position:0 -1932px}.firebaseui-flag-LU{background-position:0 -1946px}.firebaseui-flag-LV{background-position:0 -1960px}.firebaseui-flag-LY{background-position:0 -1974px}.firebaseui-flag-MA{background-position:0 -1988px}.firebaseui-flag-MC{background-position:0 -2002px}.firebaseui-flag-MD{background-position:0 -2016px}.firebaseui-flag-ME{background-position:0 -2030px}.firebaseui-flag-MF{background-position:0 -2044px}.firebaseui-flag-MG{background-position:0 -2058px}.firebaseui-flag-MH{background-position:0 -2072px}.firebaseui-flag-MK{background-position:0 -2086px}.firebaseui-flag-ML{background-position:0 -2100px}.firebaseui-flag-MM{background-position:0 -2114px}.firebaseui-flag-MN{background-position:0 -2128px}.firebaseui-flag-MO{background-position:0 -2142px}.firebaseui-flag-MP{background-position:0 -2156px}.firebaseui-flag-MQ{background-position:0 -2170px}.firebaseui-flag-MR{background-position:0 -2184px}.firebaseui-flag-MS{background-position:0 -2198px}.firebaseui-flag-MT{background-position:0 -2212px}.firebaseui-flag-MU{background-position:0 -2226px}.firebaseui-flag-MV{background-position:0 -2240px}.firebaseui-flag-MW{background-position:0 -2254px}.firebaseui-flag-MX{background-position:0 -2268px}.firebaseui-flag-MY{background-position:0 -2282px}.firebaseui-flag-MZ{background-position:0 -2296px}.firebaseui-flag-NA{background-position:0 -2310px}.firebaseui-flag-NC{background-position:0 -2324px}.firebaseui-flag-NE{background-position:0 -2338px}.firebaseui-flag-NF{background-position:0 -2352px}.firebaseui-flag-NG{background-position:0 -2366px}.firebaseui-flag-NI{background-position:0 -2380px}.firebaseui-flag-NL{background-position:0 -2394px}.firebaseui-flag-NO{background-position:0 -2408px}.firebaseui-flag-NP{background-position:0 -2422px}.firebaseui-flag-NR{background-position:0 -2436px}.firebaseui-flag-NU{background-position:0 -2450px}.firebaseui-flag-NZ{background-position:0 -2464px}.firebaseui-flag-OM{background-position:0 -2478px}.firebaseui-flag-PA{background-position:0 -2492px}.firebaseui-flag-PE{background-position:0 -2506px}.firebaseui-flag-PF{background-position:0 -2520px}.firebaseui-flag-PG{background-position:0 -2534px}.firebaseui-flag-PH{background-position:0 -2548px}.firebaseui-flag-PK{background-position:0 -2562px}.firebaseui-flag-PL{background-position:0 -2576px}.firebaseui-flag-PM{background-position:0 -2590px}.firebaseui-flag-PN{background-position:0 -2604px}.firebaseui-flag-PR{background-position:0 -2618px}.firebaseui-flag-PS{background-position:0 -2632px}.firebaseui-flag-PT{background-position:0 -2646px}.firebaseui-flag-PW{background-position:0 -2660px}.firebaseui-flag-PY{background-position:0 -2674px}.firebaseui-flag-QA{background-position:0 -2688px}.firebaseui-flag-RE{background-position:0 -2702px}.firebaseui-flag-RO{background-position:0 -2716px}.firebaseui-flag-RS{background-position:0 -2730px}.firebaseui-flag-RU{background-position:0 -2744px}.firebaseui-flag-RW{background-position:0 -2758px}.firebaseui-flag-SA{background-position:0 -2772px}.firebaseui-flag-SB{background-position:0 -2786px}.firebaseui-flag-SC{background-position:0 -2800px}.firebaseui-flag-SD{background-position:0 -2814px}.firebaseui-flag-SE{background-position:0 -2828px}.firebaseui-flag-SG{background-position:0 -2842px}.firebaseui-flag-SH{background-position:0 -2856px}.firebaseui-flag-SI{background-position:0 -2870px}.firebaseui-flag-SJ{background-position:0 -2884px}.firebaseui-flag-SK{background-position:0 -2898px}.firebaseui-flag-SL{background-position:0 -2912px}.firebaseui-flag-SM{background-position:0 -2926px}.firebaseui-flag-SN{background-position:0 -2940px}.firebaseui-flag-SO{background-position:0 -2954px}.firebaseui-flag-SR{background-position:0 -2968px}.firebaseui-flag-SS{background-position:0 -2982px}.firebaseui-flag-ST{background-position:0 -2996px}.firebaseui-flag-SV{background-position:0 -3010px}.firebaseui-flag-SX{background-position:0 -3024px}.firebaseui-flag-SY{background-position:0 -3038px}.firebaseui-flag-SZ{background-position:0 -3052px}.firebaseui-flag-TA{background-position:0 -3066px}.firebaseui-flag-TC{background-position:0 -3080px}.firebaseui-flag-TD{background-position:0 -3094px}.firebaseui-flag-TF{background-position:0 -3108px}.firebaseui-flag-TG{background-position:0 -3122px}.firebaseui-flag-TH{background-position:0 -3136px}.firebaseui-flag-TJ{background-position:0 -3150px}.firebaseui-flag-TK{background-position:0 -3164px}.firebaseui-flag-TL{background-position:0 -3178px}.firebaseui-flag-TM{background-position:0 -3192px}.firebaseui-flag-TN{background-position:0 -3206px}.firebaseui-flag-TO{background-position:0 -3220px}.firebaseui-flag-TR{background-position:0 -3234px}.firebaseui-flag-TT{background-position:0 -3248px}.firebaseui-flag-TV{background-position:0 -3262px}.firebaseui-flag-TW{background-position:0 -3276px}.firebaseui-flag-TZ{background-position:0 -3290px}.firebaseui-flag-UA{background-position:0 -3304px}.firebaseui-flag-UG{background-position:0 -3318px}.firebaseui-flag-UM{background-position:0 -3332px}.firebaseui-flag-UN{background-position:0 -3346px}.firebaseui-flag-US{background-position:0 -3360px}.firebaseui-flag-UY{background-position:0 -3374px}.firebaseui-flag-UZ{background-position:0 -3388px}.firebaseui-flag-VA{background-position:0 -3402px}.firebaseui-flag-VC{background-position:0 -3416px}.firebaseui-flag-VE{background-position:0 -3430px}.firebaseui-flag-VG{background-position:0 -3444px}.firebaseui-flag-VI{background-position:0 -3458px}.firebaseui-flag-VN{background-position:0 -3472px}.firebaseui-flag-VU{background-position:0 -3486px}.firebaseui-flag-WF{background-position:0 -3500px}.firebaseui-flag-WS{background-position:0 -3514px}.firebaseui-flag-XK{background-position:0 -3528px}.firebaseui-flag-YE{background-position:0 -3542px}.firebaseui-flag-YT{background-position:0 -3556px}.firebaseui-flag-ZA{background-position:0 -3570px}.firebaseui-flag-ZM{background-position:0 -3584px}.firebaseui-flag-ZW{background-position:0 -3598px}`,""]);const d=u},365:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var n=i(1601),r=i.n(n),o=i(6314),s=i.n(o)()(r());s.push([t.id,'body {\n  margin: 0;\n  padding: 0;\n  background-color: rgb(0, 0, 0);\n  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;\n}\n\n.loading-screen {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.096);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.loader {\n  border: 8px solid #f3f3f3;\n  border-top: 8px solid #3498db;\n  border-radius: 50%;\n  width: 50px;\n  height: 50px;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n/* Fading in animation */\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n.fadeInAnimation {\n  animation-name: fadeIn;\n  animation-duration: 0.5s; /* Adjust duration as needed */\n  animation-fill-mode: forwards;\n}\n\n/* Fading out animation */\n@keyframes fadeOut {\n  from {\n    opacity: 1;\n  }\n  to {\n    opacity: 0;\n  }\n}\n\n.fadeOutAnimation {\n  animation-name: fadeOut;\n  animation-duration: 0.5s; /* Adjust duration as needed */\n  animation-fill-mode: forwards; /* Keep opacity at 0 after animation */\n}\n\n#menu {\n  background: grey;\n  position: relative;\n  justify-content: center;\n  z-index: 2000;\n  border-radius: 7px;\n  border: none;\n  width: 100%;\n  height: 1.7rem;\n  margin: 10px 0;\n}\n\n#menu a {\n  border-radius: 7px 0 0 7px;\n  color: #404040;\n  margin: 0;\n  padding: 0 10px;\n  text-decoration: none;\n  border-right: 1px solid rgba(0, 0, 0, 0.25);\n  text-align: center;\n  flex: 1 0 auto;\n  font-size: 1rem;\n}\n\n#menu a:last-child {\n  border: none;\n  border-radius: 0px 7px 7px 0;\n}\n\n#menu a:hover {\n  background-color: rgb(172, 172, 172);\n  color: #ffffff;\n}\n\n#menu a.active {\n  background-color: #d6611e;\n  color: #ffffff;\n}\n\n#menu a.active:hover {\n  background: #c2581b;\n}\n\n.sign-in-container {\n  position: absolute;\n  left: 0;\n  right: 0;\n  margin-left: auto;\n  margin-right: auto;\n  width: 40vw;\n  top: 30vh;\n}\n\n#firebaseui-auth-container,\n#loader {\n  position: relative;\n  z-index: 200;\n}\n\n.grey-out {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(86, 86, 86, 0.196);\n  backdrop-filter: blur(12px);\n  z-index: 100;\n}\n\n#header {\n  display: flex;\n  justify-content: space-between;\n  position: relative;\n  height: 5vh;\n  padding: 20px 30px;\n  margin: 10px 10px;\n  z-index: 50;\n}\n\n#header .left-side img {\n  -webkit-filter: drop-shadow(1px 1px 0 black) drop-shadow(-1px -1px 0 black);\n  filter: drop-shadow(1px 1px 0 black) drop-shadow(-1px -1px 0 black);\n}\n\n#header .right-side {\n  display: flex;\n  align-items: center;\n  background-color: #37373762;\n  box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.596);\n  backdrop-filter: blur(8px) saturate(80%);\n  border-radius: 20px;\n  padding: 0px 10px;\n}\n\n#header .right-side .nav-text:hover {\n  font-weight: bolder;\n}\n\na.nav,\ndiv.nav {\n  color: rgb(252, 252, 252);\n  text-decoration: none;\n  padding-right: 1vw;\n  padding-left: 2vw;\n  font-weight: 400;\n  width: 4vw;\n}\n\n.dropdown {\n  display: inline-block;\n}\n\n.dropdown-content {\n  display: none;\n  position: absolute;\n  background-color: #c9c9c9f3;\n  top: 5vh;\n  border-bottom-left-radius: 10px;\n  border-bottom-right-radius: 10px;\n  color: rgb(252, 252, 252);\n  font-weight: 400;\n  box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);\n  overflow: hidden;\n  width: 18vw;\n}\n\n.dropdown-content a {\n  color: black;\n  padding: 12px 16px;\n  display: block;\n  text-align: left;\n  text-decoration: none;\n}\n\n.dropdown-content a:hover {\n  background-color: #ffffff;\n}\n\n.dropdown:hover .dropdown-content {\n  display: block;\n}\n\n.map-container {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100vh;\n}\n\n#map {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n\n#shift-button {\n  position: absolute;\n  padding: 0;\n  right: 7px;\n  z-index: 2;\n  background-color: #ff0b0b00;\n  border: none;\n  cursor: pointer;\n}\n\n#shift-button:hover {\n  filter: brightness(300%);\n}\n\n.console-container.shifted {\n  transform: translateX(-77%);\n  transition:\n    transform 0.5s ease,\n    width 0.5s ease;\n  width: 200px !important;\n}\n\n.flipped {\n  transform: scaleX(-1);\n  transition: transform 0.5s ease;\n}\n\n.console-container.shifted .console {\n  opacity: 0;\n  transition: opacity 0.1s ease-in;\n}\n\n.console-container {\n  position: absolute;\n  top: 7vh;\n  margin: 3vh 0 3vh -2vw;\n  width: 25vw;\n  height: 80vh;\n  background-color: #37373721;\n  padding: 10px 30px;\n  border-radius: 20px;\n  box-shadow: 0px 0px 50px rgba(0, 0, 0, 0.596);\n  backdrop-filter: blur(10px) saturate(80%);\n  z-index: 1;\n  resize: horizontal;\n  overflow: hidden;\n  max-width: 40vw;\n  min-width: 250px;\n  transition:\n    transform 0.5s ease,\n    opacity 0.5s ease-in;\n}\n\n.console.resizable {\n  display: flex;\n  height: 95%;\n  overflow: scroll;\n  /* overflow-y:auto; */\n  overflow-x: hidden;\n}\n\n.console.resizable::before {\n  content: "";\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 100px; /* Adjust height as needed for fade effect */\n  pointer-events: none; /* Ensure pseudo-element does not interfere with mouse events */\n  background: linear-gradient(to top, rgba(255, 255, 255, 0), #22222291);\n  z-index: -1;\n}\n.console.resizable::after {\n  content: "";\n  position: fixed;\n  bottom: 0px;\n  left: 0;\n  right: 0;\n  height: 60px; /* Adjust height as needed for fade effect */\n  pointer-events: none; /* Ensure pseudo-element does not interfere with mouse events */\n  background: linear-gradient(to bottom, rgba(255, 255, 255, 0), #22222294);\n  z-index: 5;\n}\n\n::-webkit-scrollbar {\n  width: 2.3em;\n}\n\n::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0.157);\n  border-radius: 100px;\n  border: 15px solid transparent;\n  background-clip: content-box;\n  margin-top: 40px;\n}\n\n::-webkit-scrollbar-thumb {\n  background: rgba(95, 95, 95, 0.568);\n  border-radius: 100px;\n  border: 15px solid transparent;\n  background-clip: content-box;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: rgba(202, 202, 202, 0.568);\n  border-radius: 100px;\n  border: 15px solid transparent;\n  background-clip: content-box;\n}\n\n.console {\n  position: fixed;\n  margin-left: 1.5vw;\n  color: white;\n  text-align: left;\n  display: flex;\n  flex-direction: column;\n  width: calc(100% - 2.5vw - 10px);\n}\n\n.realtime-div {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  flex-wrap: wrap;\n  margin-top: 1.5em;\n  margin-bottom: 0.5em;\n}\n\n#query-date {\n  color: rgb(100, 100, 100);\n  border: none;\n  border-radius: 10px;\n  padding: 3px 15px;\n  margin: 2px;\n  box-sizing: border-box;\n  flex: 0 5 205px;\n  height: 2em;\n}\n\nform .datetime-div {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  flex-wrap: wrap;\n}\n\n.range-div {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  height: 1.5em;\n  flex-wrap: wrap;\n  margin-top: 5px;\n}\n\n.form-resize {\n  display: flex;\n  flex-wrap: wrap;\n}\n\ninput[type="range"] {\n  accent-color: rgb(255, 255, 255);\n  flex: 1 1 100px;\n}\n\n.range-div {\n  margin-bottom: 0.5em;\n}\n\ninput[type="range"]:hover {\n  cursor: pointer;\n}\n\n.submit {\n  justify-content: right;\n  margin-top: 5px;\n  display: flex;\n  width: 100%;\n}\n\n#submit-query:disabled {\n  background-color: grey !important;\n  cursor: not-allowed !important;\n  font-weight: normal !important;\n  color: lightgrey;\n}\n\n#submit-query:hover {\n  font-weight: bolder;\n  cursor: pointer;\n  background-color: #1e85da;\n}\n\n#submit-query {\n  color: white;\n  background: #2196f3;\n  width: 100%;\n  border: none;\n  border-radius: 7px;\n  margin-top: 10px;\n  height: 2em;\n}\n\n/* The switch - the box around the slider */\n.switch {\n  position: relative;\n  display: inline-block;\n  width: 40px;\n  height: 22px;\n}\n\n/* Hide default HTML checkbox */\n.switch input {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n\n/* The slider */\n.slider {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #ccc;\n  -webkit-transition: 0.4s;\n  transition: 0.4s;\n}\n\n.slider:before {\n  position: absolute;\n  content: "";\n  height: 14px;\n  width: 14px;\n  left: 4px;\n  bottom: 4px;\n  background-color: white;\n  -webkit-transition: 0.4s;\n  transition: 0.4s;\n}\n\ninput:checked + .slider {\n  background-color: #2196f3;\n}\n\ninput:focus + .slider {\n  box-shadow: 0 0 1px #2196f3;\n}\n\ninput:checked + .slider:before {\n  -webkit-transform: translateX(16px);\n  -ms-transform: translateX(16px);\n  transform: translateX(18px);\n}\n\n/* Rounded sliders */\n.slider.round {\n  border-radius: 34px;\n}\n\n.slider.round:before {\n  border-radius: 50%;\n}\n\n.map-styles {\n  position: absolute;\n  display: flex;\n  flex-wrap: wrap;\n  border-radius: 0.5rem;\n  background-color: #444444;\n  box-sizing: border-box;\n  box-shadow: 0 0 0px 1px rgba(0, 0, 0, 0.06);\n  padding: 0.25rem;\n  width: 12vw;\n  max-width: 215px;\n  min-width: 100px;\n  font-size: 11px;\n  z-index: 2;\n  right: 50px;\n  bottom: 30px;\n  gap: 8px;\n}\n\n.map-styles .radio {\n  flex: 1 1 auto;\n  text-align: center;\n}\n\n.map-styles .radio input {\n  display: none;\n}\n\n.map-styles .radio .name {\n  display: flex;\n  cursor: pointer;\n  align-items: center;\n  justify-content: center;\n  border-radius: 0.3rem;\n  border: none;\n  padding: 0.3rem 0;\n  color: rgb(255, 255, 255);\n  transition: all 0.15s ease-in-out;\n}\n\n.map-styles .radio input:checked + .name {\n  background-color: #575757;\n  font-weight: 600;\n}\n\n#console-content {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  justify-content: flex-start;\n}\n\n#pointImage {\n  height: auto;\n  width: 100%;\n  max-width: 100%;\n  border-radius: 10px;\n}\n\n.class-data {\n  display: flex;\n  align-items: flex-start;\n  justify-content: center;\n  position: relative;\n  height: auto;\n  min-height: 45vh;\n  width: 100%;\n}\n\n.mapboxgl-ctrl-scale {\n  position: absolute;\n  bottom: 0;\n  left: 50vw;\n  transform: translateX(-50%);\n  z-index: 1000;\n  background-color: rgba(126, 126, 126, 0.7);\n  border: 1px solid #1d1d1d;\n  font-size: 8px;\n  color: black;\n}\n\n#point-info {\n  display: flex;\n  flex-wrap: wrap;\n  margin-bottom: 0.7em;\n}\n\n#point-info div {\n  display: inline-block;\n  flex-basis: 50%;\n  box-sizing: border-box;\n}\n',""]);const a=s},6314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",n=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),n&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),n&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,n,r,o){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(n)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var c=0;c<t.length;c++){var u=[].concat(t[c]);n&&s[u[0]]||(void 0!==o&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),i&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=i):u[2]=i),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),e.push(u))}},e}},4417:t=>{"use strict";t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]|(%20)/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t):t}},1601:t=>{"use strict";t.exports=function(t){return t[1]}},3999:(t,e,i)=>{var n;!function(){var r=window.CustomEvent;function o(t){for(;t;){if("dialog"===t.localName)return t;t=t.parentElement}return null}function s(t){t&&t.blur&&t!==document.body&&t.blur()}function a(t,e){for(var i=0;i<t.length;++i)if(t[i]===e)return!0;return!1}function l(t){return!(!t||!t.hasAttribute("method"))&&"dialog"===t.getAttribute("method").toLowerCase()}function c(t){if(this.dialog_=t,this.replacedStyleTop_=!1,this.openAsModal_=!1,t.hasAttribute("role")||t.setAttribute("role","dialog"),t.show=this.show.bind(this),t.showModal=this.showModal.bind(this),t.close=this.close.bind(this),"returnValue"in t||(t.returnValue=""),"MutationObserver"in window)new MutationObserver(this.maybeHideModal.bind(this)).observe(t,{attributes:!0,attributeFilter:["open"]});else{var e,i=!1,n=function(){i?this.downgradeModal():this.maybeHideModal(),i=!1}.bind(this),r=function(r){if(r.target===t){i|="DOMNodeRemoved"===r.type.substr(0,14),window.clearTimeout(e),e=window.setTimeout(n,0)}};["DOMAttrModified","DOMNodeRemoved","DOMNodeRemovedFromDocument"].forEach((function(e){t.addEventListener(e,r)}))}Object.defineProperty(t,"open",{set:this.setOpen.bind(this),get:t.hasAttribute.bind(t,"open")}),this.backdrop_=document.createElement("div"),this.backdrop_.className="backdrop",this.backdrop_.addEventListener("click",this.backdropClick_.bind(this))}r&&"object"!=typeof r||((r=function(t,e){e=e||{};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,!!e.bubbles,!!e.cancelable,e.detail||null),i}).prototype=window.Event.prototype),c.prototype={get dialog(){return this.dialog_},maybeHideModal:function(){this.dialog_.hasAttribute("open")&&document.body.contains(this.dialog_)||this.downgradeModal()},downgradeModal:function(){this.openAsModal_&&(this.openAsModal_=!1,this.dialog_.style.zIndex="",this.replacedStyleTop_&&(this.dialog_.style.top="",this.replacedStyleTop_=!1),this.backdrop_.parentNode&&this.backdrop_.parentNode.removeChild(this.backdrop_),u.dm.removeDialog(this))},setOpen:function(t){t?this.dialog_.hasAttribute("open")||this.dialog_.setAttribute("open",""):(this.dialog_.removeAttribute("open"),this.maybeHideModal())},backdropClick_:function(t){if(this.dialog_.hasAttribute("tabindex"))this.dialog_.focus();else{var e=document.createElement("div");this.dialog_.insertBefore(e,this.dialog_.firstChild),e.tabIndex=-1,e.focus(),this.dialog_.removeChild(e)}var i=document.createEvent("MouseEvents");i.initMouseEvent(t.type,t.bubbles,t.cancelable,window,t.detail,t.screenX,t.screenY,t.clientX,t.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,t.relatedTarget),this.dialog_.dispatchEvent(i),t.stopPropagation()},focus_:function(){var t=this.dialog_.querySelector("[autofocus]:not([disabled])");if(!t&&this.dialog_.tabIndex>=0&&(t=this.dialog_),!t){var e=["button","input","keygen","select","textarea"].map((function(t){return t+":not([disabled])"}));e.push('[tabindex]:not([disabled]):not([tabindex=""])'),t=this.dialog_.querySelector(e.join(", "))}s(document.activeElement),t&&t.focus()},updateZIndex:function(t,e){if(t<e)throw new Error("dialogZ should never be < backdropZ");this.dialog_.style.zIndex=t,this.backdrop_.style.zIndex=e},show:function(){this.dialog_.open||(this.setOpen(!0),this.focus_())},showModal:function(){if(this.dialog_.hasAttribute("open"))throw new Error("Failed to execute 'showModal' on dialog: The element is already open, and therefore cannot be opened modally.");if(!document.body.contains(this.dialog_))throw new Error("Failed to execute 'showModal' on dialog: The element is not in a Document.");if(!u.dm.pushDialog(this))throw new Error("Failed to execute 'showModal' on dialog: There are too many open modal dialogs.");(function(t){for(;t&&t!==document.body;){var e=window.getComputedStyle(t),i=function(t,i){return!(void 0===e[t]||e[t]===i)};if(e.opacity<1||i("zIndex","auto")||i("transform","none")||i("mixBlendMode","normal")||i("filter","none")||i("perspective","none")||"isolate"===e.isolation||"fixed"===e.position||"touch"===e.webkitOverflowScrolling)return!0;t=t.parentElement}return!1})(this.dialog_.parentElement)&&console.warn("A dialog is being shown inside a stacking context. This may cause it to be unusable. For more information, see this link: https://github.com/GoogleChrome/dialog-polyfill/#stacking-context"),this.setOpen(!0),this.openAsModal_=!0,u.needsCentering(this.dialog_)?(u.reposition(this.dialog_),this.replacedStyleTop_=!0):this.replacedStyleTop_=!1,this.dialog_.parentNode.insertBefore(this.backdrop_,this.dialog_.nextSibling),this.focus_()},close:function(t){if(!this.dialog_.hasAttribute("open"))throw new Error("Failed to execute 'close' on dialog: The element does not have an 'open' attribute, and therefore cannot be closed.");this.setOpen(!1),void 0!==t&&(this.dialog_.returnValue=t);var e=new r("close",{bubbles:!1,cancelable:!1});this.dialog_.dispatchEvent(e)}};var u={reposition:function(t){var e=document.body.scrollTop||document.documentElement.scrollTop,i=e+(window.innerHeight-t.offsetHeight)/2;t.style.top=Math.max(e,i)+"px"},isInlinePositionSetByStylesheet:function(t){for(var e=0;e<document.styleSheets.length;++e){var i=document.styleSheets[e],n=null;try{n=i.cssRules}catch(t){}if(n)for(var r=0;r<n.length;++r){var o=n[r],s=null;try{s=document.querySelectorAll(o.selectorText)}catch(t){}if(s&&a(s,t)){var l=o.style.getPropertyValue("top"),c=o.style.getPropertyValue("bottom");if(l&&"auto"!==l||c&&"auto"!==c)return!0}}}return!1},needsCentering:function(t){return!("absolute"!==window.getComputedStyle(t).position||"auto"!==t.style.top&&""!==t.style.top||"auto"!==t.style.bottom&&""!==t.style.bottom||u.isInlinePositionSetByStylesheet(t))},forceRegisterDialog:function(t){if((window.HTMLDialogElement||t.showModal)&&console.warn("This browser already supports <dialog>, the polyfill may not work correctly",t),"dialog"!==t.localName)throw new Error("Failed to register dialog: The element is not a dialog.");new c(t)},registerDialog:function(t){t.showModal||u.forceRegisterDialog(t)},DialogManager:function(){this.pendingDialogStack=[];var t=this.checkDOM_.bind(this);this.overlay=document.createElement("div"),this.overlay.className="_dialog_overlay",this.overlay.addEventListener("click",function(e){this.forwardTab_=void 0,e.stopPropagation(),t([])}.bind(this)),this.handleKey_=this.handleKey_.bind(this),this.handleFocus_=this.handleFocus_.bind(this),this.zIndexLow_=1e5,this.zIndexHigh_=100150,this.forwardTab_=void 0,"MutationObserver"in window&&(this.mo_=new MutationObserver((function(e){var i=[];e.forEach((function(t){for(var e,n=0;e=t.removedNodes[n];++n)e instanceof Element&&("dialog"===e.localName&&i.push(e),i=i.concat(e.querySelectorAll("dialog")))})),i.length&&t(i)})))}};if(u.DialogManager.prototype.blockDocument=function(){document.documentElement.addEventListener("focus",this.handleFocus_,!0),document.addEventListener("keydown",this.handleKey_),this.mo_&&this.mo_.observe(document,{childList:!0,subtree:!0})},u.DialogManager.prototype.unblockDocument=function(){document.documentElement.removeEventListener("focus",this.handleFocus_,!0),document.removeEventListener("keydown",this.handleKey_),this.mo_&&this.mo_.disconnect()},u.DialogManager.prototype.updateStacking=function(){for(var t,e=this.zIndexHigh_,i=0;t=this.pendingDialogStack[i];++i)t.updateZIndex(--e,--e),0===i&&(this.overlay.style.zIndex=--e);var n=this.pendingDialogStack[0];n?(n.dialog.parentNode||document.body).appendChild(this.overlay):this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay)},u.DialogManager.prototype.containedByTopDialog_=function(t){for(;t=o(t);){for(var e,i=0;e=this.pendingDialogStack[i];++i)if(e.dialog===t)return 0===i;t=t.parentElement}return!1},u.DialogManager.prototype.handleFocus_=function(t){if(!this.containedByTopDialog_(t.target)&&(t.preventDefault(),t.stopPropagation(),s(t.target),void 0!==this.forwardTab_)){var e=this.pendingDialogStack[0];return e.dialog.compareDocumentPosition(t.target)&Node.DOCUMENT_POSITION_PRECEDING&&(this.forwardTab_?e.focus_():document.documentElement.focus()),!1}},u.DialogManager.prototype.handleKey_=function(t){if(this.forwardTab_=void 0,27===t.keyCode){t.preventDefault(),t.stopPropagation();var e=new r("cancel",{bubbles:!1,cancelable:!0}),i=this.pendingDialogStack[0];i&&i.dialog.dispatchEvent(e)&&i.dialog.close()}else 9===t.keyCode&&(this.forwardTab_=!t.shiftKey)},u.DialogManager.prototype.checkDOM_=function(t){this.pendingDialogStack.slice().forEach((function(e){-1!==t.indexOf(e.dialog)?e.downgradeModal():e.maybeHideModal()}))},u.DialogManager.prototype.pushDialog=function(t){var e=(this.zIndexHigh_-this.zIndexLow_)/2-1;return!(this.pendingDialogStack.length>=e||(1===this.pendingDialogStack.unshift(t)&&this.blockDocument(),this.updateStacking(),0))},u.DialogManager.prototype.removeDialog=function(t){var e=this.pendingDialogStack.indexOf(t);-1!==e&&(this.pendingDialogStack.splice(e,1),0===this.pendingDialogStack.length&&this.unblockDocument(),this.updateStacking())},u.dm=new u.DialogManager,u.formSubmitter=null,u.useValue=null,void 0===window.HTMLDialogElement){var h=document.createElement("form");if(h.setAttribute("method","dialog"),"dialog"!==h.method){var d=Object.getOwnPropertyDescriptor(HTMLFormElement.prototype,"method");if(d){var p=d.get;d.get=function(){return l(this)?"dialog":p.call(this)};var f=d.set;d.set=function(t){return"string"==typeof t&&"dialog"===t.toLowerCase()?this.setAttribute("method",t):f.call(this,t)},Object.defineProperty(HTMLFormElement.prototype,"method",d)}}document.addEventListener("click",(function(t){if(u.formSubmitter=null,u.useValue=null,!t.defaultPrevented){var e=t.target;if(e&&l(e.form)){if(!("submit"===e.type&&["button","input"].indexOf(e.localName)>-1)){if("input"!==e.localName||"image"!==e.type)return;u.useValue=t.offsetX+","+t.offsetY}o(e)&&(u.formSubmitter=e)}}}),!1);var m=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=function(){if(!l(this))return m.call(this);var t=o(this);t&&t.close()},document.addEventListener("submit",(function(t){var e=t.target;if(l(e)){t.preventDefault();var i=o(e);if(i){var n=u.formSubmitter;n&&n.form===e?i.close(u.useValue||n.value):i.close(),u.formSubmitter=null}}}),!0)}u.forceRegisterDialog=u.forceRegisterDialog,u.registerDialog=u.registerDialog,"amd"in i.amdD?void 0===(n=function(){return u}.call(e,i,e,t))||(t.exports=n):"object"==typeof t.exports?t.exports=u:window.dialogPolyfill=u}()},3735:t=>{!function(t){function e(){var t=1<=arguments.length?[].slice.call(arguments,0):[],e=t.shift(),i=t.shift();Error.apply(this,t),this.message=this.message||"Invalid Geometry: item: "+JSON.stringify(e)+", params: "+JSON.stringify(i)}t.version="0.5.0",t.defaults={doThrows:{invalidGeometry:!1}},e.prototype=Error,t.errors={InvalidGeometryError:e},t.isGeometryValid=function(t){return!(!t||!Object.keys(t).length)&&!!t.type&&!!t.coordinates&&Array.isArray(t.coordinates)&&!!t.coordinates.length},t.parse=function(t,e,s){var a,l,c=function(t,e){var i=t||{};for(var n in e)e.hasOwnProperty(n)&&!i[n]&&(i[n]=e[n]);return i}(e,this.defaults);if(n.length=0,function(t){for(var e in t.geom={},t)t.hasOwnProperty(e)&&-1!==i.indexOf(e)&&(t.geom[e]=t[e],delete t[e]);!function(t){for(var e in t)t.hasOwnProperty(e)&&("string"==typeof t[e]?n.push(t[e]):"object"==typeof t[e]&&(n.push(t[e][0]),n.push(t[e][1])));if(0===n.length)throw new Error("No geometry attributes specified")}(t.geom)}(c),l=function(t){var e;return t.exclude||t.include?t.include?e=function(e){t.include.forEach((function(t){e[t]=this[t]}),this)}:t.exclude&&(e=function(e){for(var i in this)this.hasOwnProperty(i)&&-1===n.indexOf(i)&&-1===t.exclude.indexOf(i)&&(e[i]=this[i])}):e=function(t){for(var e in this)this.hasOwnProperty(e)&&-1===n.indexOf(e)&&(t[e]=this[e])},function(){var i={};return e.call(this,i),t.extra&&function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}(i,t.extra),i}}(c),Array.isArray(t)?(a={type:"FeatureCollection",features:[]},t.forEach((function(t){a.features.push(o({item:t,params:c,propFunc:l}))})),r(a,c)):r(a=o({item:t,params:c,propFunc:l}),c),!s||"function"!=typeof s)return a;s(a)};var i=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","GeoJSON"],n=[];function r(t,e){if(e.crs&&function(t){if("name"===t.type){if(t.properties&&t.properties.name)return!0;throw new Error('Invalid CRS. Properties must contain "name" key')}if("link"===t.type){if(t.properties&&t.properties.href&&t.properties.type)return!0;throw new Error('Invalid CRS. Properties must contain "href" and "type" key')}throw new Error('Invald CRS. Type attribute must be "name" or "link"')}(e.crs)&&(e.isPostgres?t.geometry.crs=e.crs:t.crs=e.crs),e.bbox&&(t.bbox=e.bbox),e.extraGlobal)for(var i in t.properties={},e.extraGlobal)t.properties[i]=e.extraGlobal[i]}function o(t){var e=t.item,i=t.params,n=t.propFunc,r={type:"Feature"};return r.geometry=a(e,i),r.properties=n.call(e),r}function s(t){return/^.+\..+$/.test(t)}function a(i,n){var r={};for(var o in n.geom){var l=n.geom[o];if("string"==typeof l&&i.hasOwnProperty(l))"GeoJSON"===o?r=i[l]:(r.type=o,r.coordinates=i[l]);else if("object"!=typeof l||Array.isArray(l)){if(Array.isArray(l)&&i.hasOwnProperty(l[0])&&i.hasOwnProperty(l[1]))r.type=o,r.coordinates=[Number(i[l[1]]),Number(i[l[0]])];else if(Array.isArray(l)&&s(l[0])&&s(l[1])){for(var c=[],u=0;u<l.length;u++){for(var h=l[u].split("."),d=i,p=0;p<h.length;p++){if(!d.hasOwnProperty(h[p]))return!1;d=d[h[p]]}c[u]=d}r.type=o,r.coordinates=[Number(c[1]),Number(c[0])]}}else{var f=Object.keys(l).map((function(t){var e=l[t];return a(i[t],{geom:{Point:e}})}));r.type=o,r.coordinates=[].concat(f.map((function(t){return t.coordinates})))}}if(n.doThrows&&n.doThrows.invalidGeometry&&!t.isGeometryValid(r))throw new e(i,n);return r}}(t.exports)},842:function(t){t.exports=function(){"use strict";var t,e,i;function n(n,r){if(t)if(e){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk); self.onerror = null;",s={};t(s),i=r(s),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=r;else t=r}return n(0,(function(t){var e="3.3.0";let i;const n={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==i){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{i=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch(e){i=t}}return i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!n.API_URL)return null;try{const t=new URL(n.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch(t){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function r(t){return n.API_URL_REGEX.test(t)}function o(t){return 0===t.indexOf("mapbox:")}function s(t){return n.API_CDN_URL_REGEX.test(t)}function a(t){return n.API_SPRITE_REGEX.test(t)}function l(t){return n.API_STYLE_REGEX.test(t)&&!a(t)}const c={create:"create",load:"load",fullLoad:"fullLoad"};function u(t){const e=t.name.split("?")[0];return s(e)&&e.includes("mapbox-gl.js")?"javascript":s(e)&&e.includes("mapbox-gl.css")?"css":function(t){return n.API_FONTS_REGEX.test(t)}(e)?"fontRange":a(e)?"sprite":l(e)?"style":function(t){return n.API_TILEJSON_REGEX.test(t)}(e)?"tilejson":"other"}function h(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var d=p;function p(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=n}p.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,n=0;n<8;n++){var r=this.sampleCurveX(i)-t;if(Math.abs(r)<e)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=r/o}var s=0,a=1;for(i=t,n=0;n<20&&(r=this.sampleCurveX(i),!(Math.abs(r-t)<e));n++)t>r?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var f=h(d),m=g;function g(t,e){this.x=t,this.y=e}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),r=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-n*(this.y-e.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(t){return t instanceof g?t:Array.isArray(t)?new g(t[0],t[1]):t};var _=h(m);const y=Math.PI/180,v=180/Math.PI;function x(t){return t*y}function b(t){return t*v}const w=[[0,0],[1,0],[1,1],[0,1]];function E(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function S(t,e,i,n){const r=new f(t,e,i,n);return function(t){return r.solve(t)}}const T=S(.25,.1,.25,1);function M(t,e,i){return Math.min(i,Math.max(e,t))}function I(t,e,i){return(i=M((i-t)/(e-t),0,1))*i*(3-2*i)}function C(t,e,i){const n=i-e,r=((t-e)%n+n)%n+e;return r===e?i:r}function A(t,e,i){if(!t.length)return i(null,[]);let n=t.length;const r=new Array(t.length);let o=null;t.forEach(((t,s)=>{e(t,((t,e)=>{t&&(o=t),r[s]=e,0==--n&&i(o,r)}))}))}function P(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}let L=1;function R(){return L++}function D(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function k(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function N(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function O(t,e){t.forEach((t=>{e[t]&&(e[t]=e[t].bind(e))}))}function F(t,e){return-1!==t.indexOf(e,t.length-e.length)}function z(t,e,i){const n={};for(const r in t)n[r]=e.call(i||this,t[r],r,t);return n}function B(t,e,i){const n={};for(const r in t)e.call(i||this,t[r],r,t)&&(n[r]=t[r]);return n}function U(t){return Array.isArray(t)?t.map(U):"object"==typeof t&&t?z(t,U):t}const V={};function j(t){V[t]||("undefined"!=typeof console&&console.warn(t),V[t]=!0)}function G(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function H(t){let e=0;for(let i,n,r=0,o=t.length,s=o-1;r<o;s=r++)i=t[r],n=t[s],e+=(n.x-i.x)*(i.y+n.y);return e}function W([t,e,i]){const n=x(e+90),r=x(i);return{x:t*Math.cos(n)*Math.sin(r),y:t*Math.sin(n)*Math.sin(r),z:t*Math.cos(r),azimuthal:e,polar:i}}function q(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function X(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,i,n,r)=>{const o=n||r;return e[i]=!o||o.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let $,Y,Z,K,J,Q,tt=null;function et(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}function it(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function nt(t,e,i,n){for(;e<i;){const r=e+i>>1;t[r]<n?e=r+1:i=r}return e}function rt(t,e,i,n){for(;e<i;){const r=e+i>>1;t[r]<=n?e=r+1:i=r}return e}function ot(){return null==$&&($=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),$}const st={now:()=>void 0!==K?K:performance.now(),setNow(t){K=t},restoreNow(){K=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:n}=t;J||(J=document.createElement("canvas"));const r=J.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return(i>J.width||n>J.height)&&(J.width=i,J.height=n),r.clearRect(-e,-e,i+2*e,n+2*e),r.drawImage(t,0,0,i,n),r.getImageData(-e,-e,i+2*e,n+2*e)},resolveURL:t=>(Y||(Y=document.createElement("a")),Y.href=t,Y.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==Z&&(Z=window.matchMedia("(prefers-reduced-motion: reduce)")),Z.matches)},hasCanvasFingerprintNoise(){if(void 0!==Q)return Q;if(!ot())return Q=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let i=0;for(let n=0;n<t.width;++n)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(n,0,1,1);const n=e.getImageData(0,0,t.width,t.height);i=0;for(let t=0;t<n.data.length;++t)if(t%4!=3&&i++!==n.data[t])return Q=!0,!0;return Q=!1,!1}},at="mapbox-tiles";let lt,ct,ut=500,ht=50;function dt(){try{return caches}catch(t){}}function pt(){const t=dt();t&&!lt&&(lt=t.open(at))}function ft(t){const e=t.indexOf("?");if(e<0)return t;const i=["language","worldview"],n=new URLSearchParams,r=new URLSearchParams(t.slice(e));for(const t of i){const e=r.get(t);e&&n.set(t,e)}return`${t.slice(0,e)}?${n.toString()}`}function mt(t,e){const i=t.indexOf("?");if(i<0)return`${t}?${new URLSearchParams(e).toString()}`;const n=new URLSearchParams(t.slice(i));for(const t in e)n.set(t,e[t]);return`${t.slice(0,i)}?${n.toString()}`}let gt=1/0;const _t={supported:!1,testSupport:function(t){!xt&&vt&&(bt?Et(t):yt=t)}};let yt,vt,xt=!1,bt=!1;const wt="undefined"!=typeof self?self:{};function Et(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,vt),t.isContextLost())return;_t.supported=!0}catch(t){}t.deleteTexture(e),xt=!0}wt.document&&(vt=wt.document.createElement("img"),vt.onload=function(){yt&&Et(yt),yt=null,bt=!0},vt.onerror=function(){xt=!0,yt=null},vt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const St={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(St);class Tt extends Error{constructor(t,e,i){401===e&&r(i)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Mt=q()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,It=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(Mt())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(t,e){const i=new AbortController,n=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:Mt(),referrerPolicy:t.referrerPolicy,signal:i.signal});let o=!1,s=!1;const a=(l=n.url).indexOf("sku=")>0&&r(l);var l;"json"===t.type&&n.headers.set("Accept","application/json");const c=(i,r,o)=>{if(s)return;if(i&&"SecurityError"!==i.message&&j(i.toString()),r&&o)return u(r);const l=Date.now();fetch(n).then((i=>{if(i.ok){const t=a?i.clone():null;return u(i,t,l)}return e(new Tt(i.statusText,i.status,t.url))})).catch((i=>{"AbortError"!==i.name&&e(new Error(`${i.message} ${t.url}`))}))},u=(i,r,a)=>{("arrayBuffer"===t.type?i.arrayBuffer():"json"===t.type?i.json():i.text()).then((t=>{s||(r&&a&&function(t,e,i){if(pt(),!lt)return;const n=X(e.headers.get("Cache-Control")||"");if(n["no-store"])return;const r={status:e.status,statusText:e.statusText,headers:new Headers};e.headers.forEach(((t,e)=>r.headers.set(e,t))),n["max-age"]&&r.headers.set("Expires",new Date(i+1e3*n["max-age"]).toUTCString());const o=r.headers.get("Expires");if(!o)return;if(new Date(o).getTime()-i<42e4)return;let s=ft(t.url);if(206===e.status){const e=t.headers.get("Range");if(!e)return;r.status=200,s=mt(s,{range:e})}!function(t,e){if(void 0===ct)try{new Response(new ReadableStream),ct=!0}catch(t){ct=!1}ct?e(t.body):t.blob().then(e)}(e,(t=>{const e=new Response(t,r);pt(),lt&&lt.then((t=>t.put(s,e))).catch((t=>j(t.message)))}))}(n,r,a),o=!0,e(null,t,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((t=>{s||e(new Error(t.message))}))};return a?function(t,e){if(pt(),!lt)return e(null);lt.then((i=>{let n=ft(t.url);const r=t.headers.get("Range");r&&(n=mt(n,{range:r})),i.match(n).then((t=>{const r=function(t){if(!t)return!1;const e=new Date(t.headers.get("Expires")||0),i=X(t.headers.get("Cache-Control")||"");return e>Date.now()&&!i["no-cache"]}(t);i.delete(n),r&&i.put(n,t.clone()),e(null,t,r)})).catch(e)})).catch(e)}(n,c):c(null,null),{cancel:()=>{s=!0,o||i.abort()}}}(t,e);if(q()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(t,e){const i=new XMLHttpRequest;i.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(i.responseType="arraybuffer");for(const e in t.headers)i.setRequestHeader(e,t.headers[e]);return"json"===t.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===t.credentials,i.onerror=()=>{e(new Error(i.statusText))},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let n=i.response;if("json"===t.type)try{n=JSON.parse(i.response)}catch(t){return e(t)}e(null,n,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else e(new Tt(i.statusText,i.status,t.url))},i.send(t.body),{cancel:()=>i.abort()}}(t,e)},Ct=function(t,e){return It(P(t,{type:"arrayBuffer"}),e)};function At(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const Pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Lt,Rt;Lt=[],Rt=0;const Dt=function(t,e){if(_t.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Rt>=n.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Lt.push(i),i}Rt++;let i=!1;const r=()=>{if(!i)for(i=!0,Rt--;Lt.length&&Rt<n.MAX_PARALLEL_IMAGE_REQUESTS;){const t=Lt.shift(),{requestParameters:e,callback:i,cancelled:n}=t;n||(t.cancel=Dt(e,i).cancel)}},o=Ct(t,((t,i,n,o)=>{r(),t?e(t):i&&(self.createImageBitmap?function(t,e){const i=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(i).then((t=>{e(null,t)})).catch((t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(i,((t,i)=>e(t,i,n,o))):function(t,e){const i=new Image;i.onload=()=>{e(null,i),URL.revokeObjectURL(i.src),i.onload=null,requestAnimationFrame((()=>{i.src=Pt}))},i.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(t)],{type:"image/png"});i.src=t.byteLength?URL.createObjectURL(n):Pt}(i,((t,i)=>e(t,i,n,o))))}));return{cancel:()=>{o.cancel(),r()}}},kt="01",Nt="NO_ACCESS_TOKEN",Ot=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ft(t){const e=t.match(Ot);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function zt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Bt="mapbox.eventData";function Ut(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map((t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(t){return null}}class Vt{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const e=Ut(n.ACCESS_TOKEN);let i="";return i=e&&e.u?btoa(encodeURIComponent(e.u).replace(/%([0-9A-F]{2})/g,((t,e)=>String.fromCharCode(Number("0x"+e))))):n.ACCESS_TOKEN||"",t?`${Bt}.${t}:${i}`:`${Bt}:${i}`}fetchEventData(){const t=et("localStorage"),e=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{const t=localStorage.getItem(e);t&&(this.eventData=JSON.parse(t));const n=localStorage.getItem(i);n&&(this.anonId=n)}catch(t){j("Unable to read from LocalStorage")}}saveEventData(){const t=et("localStorage"),e=this.getStorageKey(),i=this.getStorageKey("uuid"),n=this.anonId;if(t&&n)try{localStorage.setItem(i,n),Object.keys(this.eventData).length>=1&&localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){j("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,e,i,r){if(!n.EVENTS_URL)return;const o=Ft(n.EVENTS_URL);o.params.push(`access_token=${r||n.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(t).toISOString()},a=e?P(s,e):s,l={url:zt(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=function(t,e){return It(P(t,{method:"POST"}),e)}(l,(t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(r)}))}queueRequest(t,e){this.queue.push(t),this.processRequests(e)}}const jt=new class extends Vt{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){n.EVENTS_URL&&n.ACCESS_TOKEN&&Array.isArray(t)&&t.some((t=>o(t)||r(t)))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Ut(n.ACCESS_TOKEN),r=i?i.u:n.ACCESS_TOKEN;let o=r!==this.eventData.tokenU;N(this.anonId)||(this.anonId=D(),o=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),e=new Date(s),i=(s-this.eventData.lastSuccess)/864e5;o=o||i>=1||i<-1||t.getDate()!==e.getDate()}else o=!0;o?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:e,skuId:kt,"enabled.telemetry":!1,userId:this.anonId},(t=>{t||(this.eventData.lastSuccess=s,this.eventData.tokenU=r)}),t):this.processRequests()}},Gt=jt.postTurnstileEvent.bind(jt),Ht=new class extends Vt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,r){this.skuToken=e,this.errorCb=r,n.EVENTS_URL&&(i||n.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Nt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:n}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),N(this.anonId)||(this.anonId=D()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:e,skuId:kt,skuToken:this.skuToken,userId:this.anonId},(t=>{t?this.errorCb(t):i&&(this.success[i]=!0)}),t))}remove(){this.errorCb=null}},Wt=Ht.postMapLoadEvent.bind(Ht),qt=new class extends Vt{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){n.EVENTS_URL&&(t||n.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:n}=this.queue.shift(),r=function(t){const i=performance.getEntriesByType("resource"),n=performance.getEntriesByType("mark"),r=function(t){const e={};if(t)for(const i in t)if("other"!==i)for(const n of t[i]){const t=`${i}ResolveRangeMin`,r=`${i}ResolveRangeMax`,o=`${i}RequestCount`,s=`${i}RequestCachedCount`;e[t]=Math.min(e[t]||1/0,n.startTime),e[r]=Math.max(e[r]||-1/0,n.responseEnd);const a=t=>{void 0===e[t]&&(e[t]=0),++e[t]};void 0!==n.transferSize&&0===n.transferSize&&a(s),a(o)}return e}(function(t,e){const i={};if(t)for(const n of t){const t=e(n);void 0===i[t]&&(i[t]=[]),i[t].push(n)}return i}(i,u)),o=window.devicePixelRatio,s=navigator.connection||navigator.mozConnection||navigator.webkitConnection,a=s?s.effectiveType:void 0,h={counters:[],metadata:[],attributes:[]},d=(t,e,i)=>{null!=i&&t.push({name:e,value:i.toString()})};for(const t in r)d(h.counters,t,r[t]);if(t.interactionRange[0]!==1/0&&t.interactionRange[1]!==-1/0&&(d(h.counters,"interactionRangeMin",t.interactionRange[0]),d(h.counters,"interactionRangeMax",t.interactionRange[1])),n)for(const t of Object.keys(c)){const e=c[t],i=n.find((t=>t.name===e));i&&d(h.counters,e,i.startTime)}return d(h.counters,"visibilityHidden",t.visibilityHidden),d(h.attributes,"style",function(t){if(t)for(const e of t){const t=e.name.split("?")[0];if(l(t)){const e=t.split("/").slice(-2);if(2===e.length)return`mapbox://styles/${e[0]}/${e[1]}`}}}(i)),d(h.attributes,"terrainEnabled",t.terrainEnabled?"true":"false"),d(h.attributes,"fogEnabled",t.fogEnabled?"true":"false"),d(h.attributes,"projection",t.projection),d(h.attributes,"zoom",t.zoom),d(h.metadata,"devicePixelRatio",o),d(h.metadata,"connectionEffectiveType",a),d(h.metadata,"navigatorUserAgent",navigator.userAgent),d(h.metadata,"screenWidth",window.screen.width),d(h.metadata,"screenHeight",window.screen.height),d(h.metadata,"windowWidth",window.innerWidth),d(h.metadata,"windowHeight",window.innerHeight),d(h.metadata,"mapWidth",t.width/o),d(h.metadata,"mapHeight",t.height/o),d(h.metadata,"webglRenderer",t.renderer),d(h.metadata,"webglVendor",t.vendor),d(h.metadata,"sdkVersion",e),d(h.metadata,"sdkIdentifier","mapbox-gl-js"),h}(n);for(const t of r.metadata);for(const t of r.counters);for(const t of r.attributes);this.postEvent(i,r,(()=>{}),t)}},Xt=qt.postPerformanceEvent.bind(qt),$t=new class extends Vt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,r){if(!n.API_URL||!n.SESSION_PATH)return;const o=Ft(n.API_URL+n.SESSION_PATH);o.params.push(`sku=${e||""}`),o.params.push(`access_token=${r||n.ACCESS_TOKEN||""}`);const s={url:zt(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(t,e){return It(P(t,{method:"GET"}),e)}(s,(t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(r)}))}getSessionAPI(t,e,i,r){this.skuToken=e,this.errorCb=r,n.SESSION_PATH&&n.API_URL&&(i||n.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Nt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,(t=>{t?this.errorCb(t):e&&(this.success[e]=!0)}),t)}remove(){this.errorCb=null}},Yt=$t.getSessionAPI.bind($t),Zt=new Set;function Kt(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function Jt(t,e,i){if(i&&i[t]){const n=i[t].indexOf(e);-1!==n&&i[t].splice(n,1)}}class Qt{constructor(t,e={}){P(this,e),this.type=t}}class te extends Qt{constructor(t,e={}){super("error",P({error:t},e))}}class ee{on(t,e){return this._listeners=this._listeners||{},Kt(t,e,this._listeners),this}off(t,e){return Jt(t,e,this._listeners),Jt(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Kt(t,e,this._oneTimeListeners),this):new Promise((e=>this.once(t,e)))}fire(t,e){"string"==typeof t&&(t=new Qt(t,e||{}));const i=t.type;if(this.listens(i)){t.target=this;const e=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of e)i.call(this,t);const n=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const e of n)Jt(i,e,this._oneTimeListeners),e.call(this,t);const r=this._eventedParent;r&&(P(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(t))}else t instanceof te&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}t.y=void 0;var ie={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ne(t){return(t=Math.round(t))<0?0:t>255?255:t}function re(t){return ne("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function oe(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function se(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{t.y={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in ie)return ie[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=i.indexOf("("),r=i.indexOf(")");if(-1!==n&&r+1===i.length){var o=i.substr(0,n),s=i.substr(n+1,r-(n+1)).split(","),a=1;switch(o){case"rgba":if(4!==s.length)return null;a=oe(s.pop());case"rgb":return 3!==s.length?null:[re(s[0]),re(s[1]),re(s[2]),a];case"hsla":if(4!==s.length)return null;a=oe(s.pop());case"hsl":if(3!==s.length)return null;var l=(parseFloat(s[0])%360+360)%360/360,c=oe(s[1]),u=oe(s[2]),h=u<=.5?u*(c+1):u+c-u*c,d=2*u-h;return[ne(255*se(d,h,l+1/3)),ne(255*se(d,h,l)),ne(255*se(d,h,l-1/3)),a];default:return null}}return null}}catch(t){}class ae{constructor(t,e,i,n=1){this.r=t,this.g=e,this.b=i,this.a=n}static parse(e){if(!e)return;if(e instanceof ae)return e;if("string"!=typeof e)return;const i=t.y(e);return i?new ae(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[t,e,i,n]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(i)},${n})`}toArray(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*t/n,255*e/n,255*i/n,n]}toArray01(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[t/n,e/n,i/n,n]}toArray01Scaled(t){const{r:e,g:i,b:n,a:r}=this;return 0===r?[0,0,0]:[e/r*t,i/r*t,n/r*t]}toArray01PremultipliedAlpha(){const{r:t,g:e,b:i,a:n}=this;return[t,e,i,n]}toArray01Linear(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[Math.pow(t/n,2.2),Math.pow(e/n,2.2),Math.pow(i/n,2.2),n]}}ae.black=new ae(0,0,0,1),ae.white=new ae(1,1,1,1),ae.transparent=new ae(0,0,0,0),ae.red=new ae(1,0,0,1),ae.blue=new ae(0,0,1,1);var le=ae;function ce(t,e,i){return t*(1-i)+e*i}function ue(t,e,i){return t.map(((t,n)=>ce(t,e[n],i)))}var he=Object.freeze({__proto__:null,array:ue,color:function(t,e,i){return new le(ce(t.r,e.r,i),ce(t.g,e.g,i),ce(t.b,e.b,i),ce(t.a,e.a,i))},number:ce});function de(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}class pe extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}var fe=pe;class me{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new me(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var ge=me;const _e={kind:"null"},ye={kind:"number"},ve={kind:"string"},xe={kind:"boolean"},be={kind:"color"},we={kind:"object"},Ee={kind:"value"},Se={kind:"collator"},Te={kind:"formatted"},Me={kind:"resolvedImage"};function Ie(t,e){return{kind:"array",itemType:t,N:e}}function Ce(t){if("array"===t.kind){const e=Ce(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Ae=[_e,ye,ve,xe,be,Te,we,Ie(Ee),Me];function Pe(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Pe(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of Ae)if(!Pe(t,e))return null}return`Expected ${Ce(t)} but found ${Ce(e)} instead.`}function Le(t,e){return e.some((e=>e.kind===t.kind))}function Re(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}class De{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ke{constructor(t,e,i,n,r){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=i,this.fontStack=n,this.textColor=r}}class Ne{constructor(t){this.sections=t}static fromString(t){return new Ne([new ke(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.namePrimary.length))}static factory(t){return t instanceof Ne?t:Ne.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.namePrimary]);continue}t.push(e.text);const i={};e.fontStack&&(i["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(i["font-scale"]=e.scale),e.textColor&&(i["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(i)}return t}}class Oe{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,e){return t?new Oe({namePrimary:t,nameSecondary:e,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Fe(t,e,i,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ze(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof le)return!0;if(t instanceof De)return!0;if(t instanceof Ne)return!0;if(t instanceof Oe)return!0;if(Array.isArray(t)){for(const e of t)if(!ze(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!ze(t[e]))return!1;return!0}return!1}function Be(t){if(null===t)return _e;if("string"==typeof t)return ve;if("boolean"==typeof t)return xe;if("number"==typeof t)return ye;if(t instanceof le)return be;if(t instanceof De)return Se;if(t instanceof Ne)return Te;if(t instanceof Oe)return Me;if(Array.isArray(t)){const e=t.length;let i;for(const e of t){const t=Be(e);if(i){if(i===t)continue;i=Ee;break}i=t}return Ie(i||Ee,e)}return we}function Ue(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof le||t instanceof Ne||t instanceof Oe?t.toString():JSON.stringify(t)}class Ve{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ze(t[1]))return e.error("invalid value");const i=t[1];let n=Be(i);const r=e.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new Ve(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof le?["rgba"].concat(this.value.toArray()):this.value instanceof Ne?this.value.serialize():this.value}}var je=Ve,Ge=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const He={string:ve,number:ye,boolean:xe,object:we};class We{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,n=1;const r=t[0];if("array"===r){let r,o;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in He)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=He[i],n++}else r=Ee;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],n++}i=Ie(r,o)}else i=He[r];const o=[];for(;n<t.length;n++){const i=e.parse(t[n],n,Ee);if(!i)return null;o.push(i)}return new We(i,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!Pe(this.type,Be(i)))return i;if(e===this.args.length-1)throw new Ge(`Expected value to be of type ${Ce(this.type)}, but found ${Ce(Be(i))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const i=t.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){e.push(i.kind);const n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map((t=>t.serialize())))}}var qe=We;class Xe{constructor(t){this.type=Te,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const n=[];let r=!1;for(let i=1;i<=t.length-1;++i){const o=t[i];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let t=null;if(o["font-scale"]&&(t=e.parse(o["font-scale"],1,ye),!t))return null;let i=null;if(o["text-font"]&&(i=e.parse(o["text-font"],1,Ie(ve)),!i))return null;let s=null;if(o["text-color"]&&(s=e.parse(o["text-color"],1,be),!s))return null;const a=n[n.length-1];a.scale=t,a.font=i,a.textColor=s}else{const o=e.parse(t[i],1,Ee);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:o,scale:null,font:null,textColor:null})}}return new Xe(n)}evaluate(t){return new Ne(this.sections.map((e=>{const i=e.content.evaluate(t);return Be(i)===Me?new ke("",i,null,null,null):new ke(Ue(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const i={};e.scale&&(i["font-scale"]=e.scale.serialize()),e.font&&(i["text-font"]=e.font.serialize()),e.textColor&&(i["text-color"]=e.textColor.serialize()),t.push(i)}return t}}class $e{constructor(t,e){this.type=Me,this.inputPrimary=t,this.inputSecondary=e}static parse(t,e){if(t.length<2)return e.error("Expected two or more arguments.");const i=e.parse(t[1],1,ve);if(!i)return e.error("No image name provided.");if(2===t.length)return new $e(i);const n=e.parse(t[2],1,ve);return n?new $e(i,n):e.error("Secondary image variant is not a string.")}evaluate(t){const e=Oe.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return e&&t.availableImages&&(e.available=t.availableImages.indexOf(e.namePrimary)>-1,e.nameSecondary&&e.available&&t.availableImages&&(e.available=t.availableImages.indexOf(e.nameSecondary)>-1)),e}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Ye(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}const Ze={"to-boolean":xe,"to-color":be,"to-number":ye,"to-string":ve};class Ke{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0],n=[];let r=_e;if("to-array"===i){if(!Array.isArray(t[1]))return null;const i=t[1].length;if(e.expectedType){if("array"!==e.expectedType.kind)return e.error(`Expected ${e.expectedType.kind} but found array.`);r=Ie(e.expectedType.itemType,i)}else{if(!(i>0&&ze(t[1][0])))return null;r=Ie(Be(t[1][0]),i)}for(let o=0;o<i;o++){const i=t[1][o];let s;if("array"===Ye(i))s=e.parse(i,void 0,r.itemType);else{const t=Ye(i);if(t!==r.itemType.kind)return e.error(`Expected ${r.itemType.kind} but found ${t}.`);s=e.registry.literal.parse(["literal",void 0===i?null:i],e)}if(!s)return null;n.push(s)}}else{if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");r=Ze[i];for(let i=1;i<t.length;i++){const r=e.parse(t[i],i,Ee);if(!r)return null;n.push(r)}}return new Ke(r,n)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,i;for(const n of this.args){if(e=n.evaluate(t),i=null,e instanceof le)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:Fe(e[0],e[1],e[2],e[3]),!i))return new le(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new Ge(i||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const n=Number(e);if(!isNaN(n))return n}throw new Ge(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?Ne.fromString(Ue(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Oe.fromString(Ue(this.args[0].evaluate(t))):"array"===this.type.kind?this.args.map((e=>e.evaluate(t))):Ue(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Xe([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new $e(this.args[0]).serialize();const t="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild((e=>{t.push(e.serialize())})),t}}var Je=Ke;const Qe=["Unknown","Point","LineString","Polygon"];var ti=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Qe[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(n*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=le.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class ei{constructor(t,e,i,n,r){this.name=t,this.type=e,this._evaluate=i,this.args=n,this._overloadIndex=r}evaluate(t){if(!this._evaluate){const t=ei.definitions[this.name];this._evaluate=Array.isArray(t)?t[2]:t.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,e){const i=t[0],n=ei.definitions[i];if(!n)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=[];let a=null,l=-1;for(const[n,c]of o){if(Array.isArray(n)&&n.length!==t.length-1)continue;s.push(n),l++,a=new bn(e.registry,e.path,null,e.scope,void 0,e._scope,e.options);const o=[];let u=!1;for(let e=1;e<t.length;e++){const i=t[e],r=Array.isArray(n)?n[e-1]:n.type,s=a.parse(i,1+o.length,r);if(!s){u=!0;break}o.push(s)}if(!u)if(Array.isArray(n)&&n.length!==o.length)a.error(`Expected ${n.length} arguments, but found ${o.length} instead.`);else{for(let t=0;t<o.length;t++){const e=Array.isArray(n)?n[t]:n.type,i=o[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new ei(i,r,c,o,l)}}if(1===s.length)e.errors.push(...a.errors);else{const i=(s.length?s:o.map((([t])=>t))).map(ii).join(" | "),n=[];for(let i=1;i<t.length;i++){const r=e.parse(t[i],1+n.length);if(!r)return null;n.push(Ce(r.type))}e.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(t,e){ei.definitions=e;for(const i in e)t[i]=ei}}function ii(t){return Array.isArray(t)?`(${t.map(Ce).join(", ")})`:`(${Ce(t.type)}...)`}var ni=ei;class ri{constructor(t,e,i){this.type=Se,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const n=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,xe);if(!n)return null;const r=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,xe);if(!r)return null;let o=null;return i.locale&&(o=e.parse(i.locale,1,ve),!o)?null:new ri(n,r,o)}evaluate(t){return new De(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var oi={exports:{}};oi.exports=function(){function t(i,n,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,l=n-r+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);t(i,n,Math.max(r,Math.floor(n-l*u/a+h)),Math.min(o,Math.floor(n+(a-l)*u/a+h)),s)}var d=i[n],p=r,f=o;for(e(i,r,n),s(i[o],d)>0&&e(i,r,o);p<f;){for(e(i,p,f),p++,f--;s(i[p],d)<0;)p++;for(;s(i[f],d)>0;)f--}0===s(i[r],d)?e(i,r,f):e(i,++f,o),f<=n&&(r=f+1),n<=f&&(o=f-1)}}function e(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function i(t,e){return t<e?-1:t>e?1:0}return function(e,n,r,o,s){t(e,n,r||0,o||e.length-1,s||i)}}();var si=h(oi.exports);function ai(t){let e=0;for(let i,n,r=0,o=t.length,s=o-1;r<o;s=r++)i=t[r],n=t[s],e+=(n.x-i.x)*(i.y+n.y);return e}function li(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ci(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function ui(t,e,i){const n=t[0]-e[0],r=t[1]-e[1],o=t[0]-i[0],s=t[1]-i[1];return n*s-o*r==0&&n*o<=0&&r*s<=0}function hi(t,e,i=!1){let n=!1;for(let a=0,l=e.length;a<l;a++){const l=e[a];for(let e=0,a=l.length,c=a-1;e<a;c=e++){const a=l[c],u=l[e];if(ui(t,a,u))return i;(o=a)[1]>(r=t)[1]!=(s=u)[1]>r[1]&&r[0]<(s[0]-o[0])*(r[1]-o[1])/(s[1]-o[1])+o[0]&&(n=!n)}}var r,o,s;return n}function di(t,e,i,n){const r=n[0]-i[0],o=n[1]-i[1],s=(t[0]-i[0])*o-r*(t[1]-i[1]),a=(e[0]-i[0])*o-r*(e[1]-i[1]);return s>0&&a<0||s<0&&a>0}function pi(t,e,i,n){return 0!=(r=[n[0]-i[0],n[1]-i[1]])[0]*(o=[e[0]-t[0],e[1]-t[1]])[1]-r[1]*o[0]&&!(!di(t,e,i,n)||!di(i,n,t,e));var r,o}const fi=8192;function mi(t,e){const i=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(i*r*fi),Math.round(n*r*fi)]}function gi(t,e){for(let i=0;i<e.length;i++)if(hi(t,e[i]))return!0;return!1}function _i(t,e,i){for(const n of i)for(let i=0,r=n.length,o=r-1;i<r;o=i++)if(pi(t,e,n[o],n[i]))return!0;return!1}function yi(t,e){for(let i=0;i<t.length;++i)if(!hi(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(_i(t[i],t[i+1],e))return!1;return!0}function vi(t,e){for(let i=0;i<e.length;i++)if(yi(t,e[i]))return!0;return!1}function xi(t,e,i){const n=[];for(let r=0;r<t.length;r++){const o=[];for(let n=0;n<t[r].length;n++){const s=mi(t[r][n],i);li(e,s),o.push(s)}n.push(o)}return n}function bi(t,e,i){const n=[];for(let r=0;r<t.length;r++){const o=xi(t[r],e,i);n.push(o)}return n}function wi(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){const e=.5*n;let r=t[0]-i[0]>e?-n:i[0]-t[0]>e?n:0;0===r&&(r=t[0]-i[2]>e?-n:i[2]-t[0]>e?n:0),t[0]+=r}li(e,t)}function Ei(t,e,i,n){const r=Math.pow(2,n.z)*fi,o=[n.x*fi,n.y*fi],s=[];if(!t)return s;for(const n of t)for(const t of n){const n=[t.x+o[0],t.y+o[1]];wi(n,e,i,r),s.push(n)}return s}function Si(t,e,i,n){const r=Math.pow(2,n.z)*fi,o=[n.x*fi,n.y*fi],s=[];if(!t)return s;for(const i of t){const t=[];for(const n of i){const i=[n.x+o[0],n.y+o[1]];li(e,i),t.push(i)}s.push(t)}if(e[2]-e[0]<=r/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const n of t)wi(n,e,i,r)}var a;return s}class Ti{constructor(t,e){this.type=xe,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ze(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const i=e.features[t].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Ti(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Ti(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Ti(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if(!r)return!1;if("Polygon"===e.type){const o=xi(e.coordinates,n,r),s=Ei(t.geometry(),i,n,r);if(!ci(i,n))return!1;for(const t of s)if(!hi(t,o))return!1}if("MultiPolygon"===e.type){const o=bi(e.coordinates,n,r),s=Ei(t.geometry(),i,n,r);if(!ci(i,n))return!1;for(const t of s)if(!gi(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if(!r)return!1;if("Polygon"===e.type){const o=xi(e.coordinates,n,r),s=Si(t.geometry(),i,n,r);if(!ci(i,n))return!1;for(const t of s)if(!yi(t,o))return!1}if("MultiPolygon"===e.type){const o=bi(e.coordinates,n,r),s=Si(t.geometry(),i,n,r);if(!ci(i,n))return!1;for(const t of s)if(!vi(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Mi=Ti,Ii={exports:{}};Ii.exports=function(){var t={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},e=1/298.257223563,i=e*(2-e),n=Math.PI/180,r=function(e,r){if(void 0===e)throw new Error("No latitude given.");if(r&&!t[r])throw new Error("Unknown unit "+r+". Use one of: "+Object.keys(t).join(", "));var o=6378.137*n*(r?t[r]:1),s=Math.cos(e*n),a=1/(1-i*(1-s*s)),l=Math.sqrt(a);this.kx=o*l*s,this.ky=o*l*a*(1-i)},o={units:{configurable:!0}};function s(t,e){return t[0]===e[0]&&t[1]===e[1]}function a(t,e,i){var n=l(e[0]-t[0]);return[t[0]+n*i,t[1]+(e[1]-t[1])*i]}function l(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}return r.fromTile=function(t,e,i){var o=Math.PI*(1-2*(t+.5)/Math.pow(2,e)),s=Math.atan(.5*(Math.exp(o)-Math.exp(-o)))/n;return new r(s,i)},o.units.get=function(){return t},r.prototype.distance=function(t,e){var i=l(t[0]-e[0])*this.kx,n=(t[1]-e[1])*this.ky;return Math.sqrt(i*i+n*n)},r.prototype.bearing=function(t,e){var i=l(e[0]-t[0])*this.kx;return Math.atan2(i,(e[1]-t[1])*this.ky)/n},r.prototype.destination=function(t,e,i){var r=i*n;return this.offset(t,Math.sin(r)*e,Math.cos(r)*e)},r.prototype.offset=function(t,e,i){return[t[0]+e/this.kx,t[1]+i/this.ky]},r.prototype.lineDistance=function(t){for(var e=0,i=0;i<t.length-1;i++)e+=this.distance(t[i],t[i+1]);return e},r.prototype.area=function(t){for(var e=0,i=0;i<t.length;i++)for(var n=t[i],r=0,o=n.length,s=o-1;r<o;s=r++)e+=l(n[r][0]-n[s][0])*(n[r][1]+n[s][1])*(i?-1:1);return Math.abs(e)/2*this.kx*this.ky},r.prototype.along=function(t,e){var i=0;if(e<=0)return t[0];for(var n=0;n<t.length-1;n++){var r=t[n],o=t[n+1],s=this.distance(r,o);if((i+=s)>e)return a(r,o,(e-(i-s))/s)}return t[t.length-1]},r.prototype.pointToSegmentDistance=function(t,e,i){var n=e[0],r=e[1],o=l(i[0]-n)*this.kx,s=(i[1]-r)*this.ky,a=0;return 0===o&&0===s||((a=(l(t[0]-n)*this.kx*o+(t[1]-r)*this.ky*s)/(o*o+s*s))>1?(n=i[0],r=i[1]):a>0&&(n+=o/this.kx*a,r+=s/this.ky*a)),o=l(t[0]-n)*this.kx,s=(t[1]-r)*this.ky,Math.sqrt(o*o+s*s)},r.prototype.pointOnLine=function(t,e){for(var i,n,r,o,s=1/0,a=0;a<t.length-1;a++){var c=t[a][0],u=t[a][1],h=l(t[a+1][0]-c)*this.kx,d=(t[a+1][1]-u)*this.ky,p=0;0===h&&0===d||((p=(l(e[0]-c)*this.kx*h+(e[1]-u)*this.ky*d)/(h*h+d*d))>1?(c=t[a+1][0],u=t[a+1][1]):p>0&&(c+=h/this.kx*p,u+=d/this.ky*p));var f=(h=l(e[0]-c)*this.kx)*h+(d=(e[1]-u)*this.ky)*d;f<s&&(s=f,i=c,n=u,r=a,o=p)}return{point:[i,n],index:r,t:Math.max(0,Math.min(1,o))}},r.prototype.lineSlice=function(t,e,i){var n=this.pointOnLine(i,t),r=this.pointOnLine(i,e);if(n.index>r.index||n.index===r.index&&n.t>r.t){var o=n;n=r,r=o}var a=[n.point],l=n.index+1,c=r.index;!s(i[l],a[0])&&l<=c&&a.push(i[l]);for(var u=l+1;u<=c;u++)a.push(i[u]);return s(i[c],r.point)||a.push(r.point),a},r.prototype.lineSliceAlong=function(t,e,i){for(var n=0,r=[],o=0;o<i.length-1;o++){var s=i[o],l=i[o+1],c=this.distance(s,l);if((n+=c)>t&&0===r.length&&r.push(a(s,l,(t-(n-c))/c)),n>=e)return r.push(a(s,l,(e-(n-c))/c)),r;n>t&&r.push(l)}return r},r.prototype.bufferPoint=function(t,e){var i=e/this.ky,n=e/this.kx;return[t[0]-n,t[1]-i,t[0]+n,t[1]+i]},r.prototype.bufferBBox=function(t,e){var i=e/this.ky,n=e/this.kx;return[t[0]-n,t[1]-i,t[2]+n,t[3]+i]},r.prototype.insideBBox=function(t,e){return l(t[0]-e[0])>=0&&l(t[0]-e[2])<=0&&t[1]>=e[1]&&t[1]<=e[3]},Object.defineProperties(r,o),r}();var Ci=h(Ii.exports),Ai={exports:{}};Ai.exports=function(){var t=function(t,i){if(void 0===t&&(t=[]),void 0===i&&(i=e),this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function e(t,e){return t<e?-1:t>e?1:0}return t.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(t){for(var e=this.data,i=this.compare,n=e[t];t>0;){var r=t-1>>1,o=e[r];if(i(n,o)>=0)break;e[t]=o,t=r}e[t]=n},t.prototype._down=function(t){for(var e=this.data,i=this.compare,n=this.length>>1,r=e[t];t<n;){var o=1+(t<<1),s=e[o],a=o+1;if(a<this.length&&i(e[a],s)<0&&(o=a,s=e[a]),i(s,r)>=0)break;e[t]=s,t=o}e[t]=r},t}();var Pi=h(Ai.exports),Li=8192;function Ri(t,e){return e.dist-t.dist}const Di=100,ki=50;function Ni(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function Oi(t){return t[1]-t[0]+1}function Fi(t,e){const i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function zi(t,e){if(t[0]>t[1])return[null,null];const i=Oi(t);if(e){if(2===i)return[t,null];const e=Math.floor(i/2);return[[t[0],t[0]+e],[t[0]+e,t[1]]]}{if(1===i)return[t,null];const e=Math.floor(i/2)-1;return[[t[0],t[0]+e],[t[0]+e+1,t[1]]]}}function Bi(t,e){const i=[1/0,1/0,-1/0,-1/0];if(!Fi(e,t.length))return i;for(let n=e[0];n<=e[1];++n)li(i,t[n]);return i}function Ui(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let n=0;n<t[i].length;++n)li(e,t[i][n]);return e}function Vi(t,e,i){if(Ni(t)||Ni(e))return NaN;let n=0,r=0;return t[2]<e[0]&&(n=e[0]-t[2]),t[0]>e[2]&&(n=t[0]-e[2]),t[1]>e[3]&&(r=t[1]-e[3]),t[3]<e[1]&&(r=e[1]-t[3]),i.distance([0,0],[n,r])}function ji(t){return 360*t-180}function Gi(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Hi(t,e){const i=Math.pow(2,e.z),n=(t.y/Li+e.y)/i;return[ji((t.x/Li+e.x)/i),Gi(n)]}function Wi(t,e){const i=[];for(let n=0;n<t.length;++n)i.push(Hi(t[n],e));return i}function qi(t,e,i){const n=i.pointOnLine(e,t).point;return i.distance(t,n)}function Xi(t,e,i,n,r){const o=i.slice(n[0],n[1]+1);let s=1/0;for(let i=e[0];i<=e[1];++i)if(0===(s=Math.min(s,qi(t[i],o,r))))return 0;return s}function $i(t,e,i,n,r){const o=Math.min(r.pointToSegmentDistance(t,i,n),r.pointToSegmentDistance(e,i,n)),s=Math.min(r.pointToSegmentDistance(i,t,e),r.pointToSegmentDistance(n,t,e));return Math.min(o,s)}function Yi(t,e,i,n,r){if(!Fi(e,t.length)||!Fi(n,i.length))return NaN;let o=1/0;for(let s=e[0];s<e[1];++s)for(let e=n[0];e<n[1];++e){if(pi(t[s],t[s+1],i[e],i[e+1]))return 0;o=Math.min(o,$i(t[s],t[s+1],i[e],i[e+1],r))}return o}function Zi(t,e,i,n,r){if(!Fi(e,t.length)||!Fi(n,i.length))return NaN;let o=1/0;for(let s=e[0];s<=e[1];++s)for(let e=n[0];e<=n[1];++e)if(0===(o=Math.min(o,r.distance(t[s],i[e]))))return o;return o}function Ki(t,e,i){if(hi(t,e,!0))return 0;let n=1/0;for(const r of e){const e=r.length;if(e<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(r[0]!==r[e-1]&&0===(n=Math.min(n,i.pointToSegmentDistance(t,r[e-1],r[0]))))return n;if(0===(n=Math.min(n,qi(t,r,i))))return n}return n}function Ji(t,e,i,n){if(!Fi(e,t.length))return NaN;for(let n=e[0];n<=e[1];++n)if(hi(t[n],i,!0))return 0;let r=1/0;for(let o=e[0];o<e[1];++o)for(const e of i)for(let i=0,s=e.length,a=s-1;i<s;a=i++){if(pi(t[o],t[o+1],e[a],e[i]))return 0;r=Math.min(r,$i(t[o],t[o+1],e[a],e[i],n))}return r}function Qi(t,e){for(const i of t)for(let t=0;t<=i.length-1;++t)if(hi(i[t],e,!0))return!0;return!1}function tn(t,e,i,n=1/0){const r=Ui(t),o=Ui(e);if(n!==1/0&&Vi(r,o,i)>=n)return n;if(ci(r,o)){if(Qi(t,e))return 0}else if(Qi(e,t))return 0;let s=n;for(const n of t)for(let t=0,r=n.length,o=r-1;t<r;o=t++)for(const r of e)for(let e=0,a=r.length,l=a-1;e<a;l=e++){if(pi(n[o],n[t],r[l],r[e]))return 0;s=Math.min(s,$i(n[o],n[t],r[l],r[e],i))}return s}function en(t,e,i,n,r,o,s){if(null===o||null===s)return;const a=Vi(Bi(n,o),Bi(r,s),i);a<e&&t.push({dist:a,range1:o,range2:s})}function nn(t,e,i,n,r=1/0){let o=Math.min(n.distance(t[0],i[0][0]),r);if(0===o)return o;const s=new Pi([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Ri),a=e?ki:Di,l=Ui(i);for(;s.length;){const r=s.pop();if(r.dist>=o)continue;const c=r.range1;if(Oi(c)<=a){if(!Fi(c,t.length))return NaN;if(e){const e=Ji(t,c,i,n);if(0===(o=Math.min(o,e)))return o}else for(let e=c[0];e<=c[1];++e){const r=Ki(t[e],i,n);if(0===(o=Math.min(o,r)))return o}}else{const i=zi(c,e);if(null!==i[0]){const e=Vi(Bi(t,i[0]),l,n);e<o&&s.push({dist:e,range1:i[0],range2:[0,0]})}if(null!==i[1]){const e=Vi(Bi(t,i[1]),l,n);e<o&&s.push({dist:e,range1:i[1],range2:[0,0]})}}}return o}function rn(t,e,i,n,r,o=1/0){let s=Math.min(o,r.distance(t[0],i[0]));if(0===s)return s;const a=new Pi([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],Ri),l=e?ki:Di,c=n?ki:Di;for(;a.length;){const o=a.pop();if(o.dist>=s)continue;const u=o.range1,h=o.range2;if(Oi(u)<=l&&Oi(h)<=c){if(!Fi(u,t.length)||!Fi(h,i.length))return NaN;if(e&&n?s=Math.min(s,Yi(t,u,i,h,r)):e||n?e&&!n?s=Math.min(s,Xi(i,h,t,u,r)):!e&&n&&(s=Math.min(s,Xi(t,u,i,h,r))):s=Math.min(s,Zi(t,u,i,h,r)),0===s)return s}else{const o=zi(u,e),l=zi(h,n);en(a,s,r,t,i,o[0],l[0]),en(a,s,r,t,i,o[0],l[1]),en(a,s,r,t,i,o[1],l[0]),en(a,s,r,t,i,o[1],l[1])}}return s}function on(t,e,i,n,r=1/0){let o=r;const s=Bi(t,[0,t.length-1]);for(const r of i)if(!(o!==1/0&&Vi(s,Bi(r,[0,r.length-1]),n)>=o)&&(o=Math.min(o,rn(t,e,r,!0,n,o)),0===o))return o;return o}function sn(t,e,i,n,r=1/0){let o=r;const s=Bi(t,[0,t.length-1]);for(const r of i){if(o!==1/0&&Vi(s,Ui(r),n)>=o)continue;const i=nn(t,e,r,n,o);if(isNaN(i))return i;if(0===(o=Math.min(o,i)))return o}return o}function an(t){return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}class ln{constructor(t,e){this.type=ye,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(ze(t[1])){const e=t[1];if("FeatureCollection"===e.type){for(let t=0;t<e.features.length;++t)if(an(e.features[t].geometry.type))return new ln(e,e.features[t].geometry)}else if("Feature"===e.type){if(an(e.geometry.type))return new ln(e,e.geometry)}else if(an(e.type))return new ln(e,e)}return e.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const e=t.geometry(),i=t.canonicalID();if(null!=e&&null!=i){if("Point"===t.geometryType())return function(t,e,i){const n=[];for(const i of t)for(const t of i)n.push(Hi(t,e));const r=new Ci(n[0][1],"meters");return"Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type?rn(n,!1,"Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,r):"MultiLineString"===i.type?on(n,!1,i.coordinates,r):"Polygon"===i.type||"MultiPolygon"===i.type?sn(n,!1,"Polygon"===i.type?[i.coordinates]:i.coordinates,r):null}(e,i,this.geometries);if("LineString"===t.geometryType())return function(t,e,i){const n=[];for(const i of t){const t=[];for(const n of i)t.push(Hi(n,e));n.push(t)}const r=new Ci(n[0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return on("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,n,r);if("MultiLineString"===i.type){let t=1/0;for(let e=0;e<i.coordinates.length;e++){const o=on(i.coordinates[e],!0,n,r,t);if(isNaN(o))return o;if(0===(t=Math.min(t,o)))return t}return t}if("Polygon"===i.type||"MultiPolygon"===i.type){let t=1/0;for(let e=0;e<n.length;e++){const o=sn(n[e],!0,"Polygon"===i.type?[i.coordinates]:i.coordinates,r,t);if(isNaN(o))return o;if(0===(t=Math.min(t,o)))return t}return t}return null}(e,i,this.geometries);if("Polygon"===t.geometryType())return function(t,e,i){const n=[];for(const i of function(t,e){const i=t.length;if(i<=1)return[t];const n=[];let r,o;for(let e=0;e<i;e++){const i=ai(t[e]);0!==i&&(t[e].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(r&&n.push(r),r=[t[e]]):r.push(t[e]))}return r&&n.push(r),n}(t)){const t=[];for(let n=0;n<i.length;++n)t.push(Wi(i[n],e));n.push(t)}const r=new Ci(n[0][0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return sn("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,n,r);if("MultiLineString"===i.type){let t=1/0;for(let e=0;e<i.coordinates.length;e++){const o=sn(i.coordinates[e],!0,n,r,t);if(isNaN(o))return o;if(0===(t=Math.min(t,o)))return t}return t}return"Polygon"===i.type||"MultiPolygon"===i.type?function(t,e,i){let n=1/0;for(const r of t)for(const t of e){const e=tn(r,t,i,n);if(isNaN(e))return e;if(0===(n=Math.min(n,e)))return n}return n}("Polygon"===i.type?[i.coordinates]:i.coordinates,n,r):null}(e,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var cn=ln;function un(t,e){switch(t){case"string":return Ue(e);case"number":return+e;case"boolean":return!!e;case"color":return le.parse(e);case"formatted":return Ne.fromString(Ue(e));case"resolvedImage":return Oe.fromString(Ue(e))}return e}function hn(t,e,i,n){return void 0!==n&&(t=n*Math.round(t/n)),void 0!==e&&t<e&&(t=e),void 0!==i&&t>i&&(t=i),t}class dn{constructor(t,e,i){this.type=t,this.key=e,this.scope=i}static parse(t,e){let i=e.expectedType;if(null==i&&(i=Ee),t.length<2||t.length>3)return e.error("Invalid number of arguments for 'config' expression.");const n=e.parse(t[1],1);if(!(n instanceof je))return e.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const r=e.parse(t[2],2);return r instanceof je?new dn(i,Ue(n.value),Ue(r.value)):e.error("Scope of 'config' expression must be a string literal.")}return new dn(i,Ue(n.value))}evaluate(t){const e=[this.key,this.scope,t.scope].filter(Boolean).join(""),i=t.getConfig(e);if(!i)return null;const{type:n,value:r,values:o,minValue:s,maxValue:a,stepValue:l}=i,c=i.default.evaluate(t);let u=c;if(r){const e=t.scope;t.scope=(e||"").split("").slice(1).join(""),u=r.evaluate(t),t.scope=e}return n&&(u=un(n,u)),void 0===u||void 0===s&&void 0===a&&void 0===l||("number"==typeof u?u=hn(u,s,a,l):Array.isArray(u)&&(u=u.map((t=>"number"==typeof t?hn(t,s,a,l):t)))),void 0!==r&&void 0!==u&&o&&!o.includes(u)&&(u=c,n&&(u=un(n,u))),(n&&n!==this.type||void 0!==u&&Be(u)!==this.type)&&(u=un(this.type.kind,u)),u}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}var pn=dn;function fn(t){if(t instanceof ni){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Mi)return!1;if(t instanceof cn)return!1;let e=!0;return t.eachChild((t=>{e&&!fn(t)&&(e=!1)})),e}function mn(t){if(t instanceof ni&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!mn(t)&&(e=!1)})),e}function gn(t){if(t instanceof pn)return!1;let e=!0;return t.eachChild((t=>{e&&!gn(t)&&(e=!1)})),e}function _n(t,e){if(t instanceof ni&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild((t=>{i&&!_n(t,e)&&(i=!1)})),i}class yn{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new yn(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var vn=yn;class xn{constructor(t,e=[],i,n=new ge,r=[],o,s){this.registry=t,this.path=e,this.key=e.map((t=>`[${t}]`)).join(""),this.scope=n,this.errors=r,this.expectedType=i,this._scope=o,this.options=s}parse(t,e,i,n,r={}){return e||i?this.concat(e,i,n)._parse(t,r):this._parse(t,r)}_parse(t,e){function i(t,e,i){return"assert"===i?new qe(e,[t]):"coerce"===i?new Je(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n="string"==typeof t[0]?this.registry[t[0]]:void 0;if(n){let r=n.parse(t,this);if(!r)return null;if(this.expectedType){const t=this.expectedType,n=r.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==n.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(t,n))return null}else r=i(r,t,e.typeAnnotation||"coerce");else r=i(r,t,e.typeAnnotation||"assert")}if(!(r instanceof je)&&"resolvedImage"!==r.type.kind&&wn(r)){const e=new ti(this._scope,this.options);try{r=new je(r.type,r.evaluate(e))}catch(t){return this.error(t.message),null}}return r}return Je.parse(["to-array",t],this)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const n="number"==typeof t?this.path.concat(t):this.path,r=i?this.scope.concat(i):this.scope;return new xn(this.registry,n,e||null,r,this.errors,this._scope,this.options)}error(t,...e){const i=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new fe(i,t))}checkSubtype(t,e){const i=Pe(t,e);return i&&this.error(i),i}}var bn=xn;function wn(t){if(t instanceof vn)return wn(t.boundExpression);if(t instanceof ni&&"error"===t.name)return!1;if(t instanceof ri)return!1;if(t instanceof Mi)return!1;if(t instanceof cn)return!1;if(t instanceof pn)return!1;const e=t instanceof Je||t instanceof qe;let i=!0;return t.eachChild((t=>{i=e?i&&wn(t):i&&t instanceof je})),!!i&&fn(t)&&_n(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function En(t,e){const i=t.length-1;let n,r,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),n=t[a],r=t[a+1],n<=e){if(a===i||e<r)return a;o=a+1}else{if(!(n>e))throw new Ge("Input is not a number.");s=a-1}return 0}class Sn{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,ye);if(!i)return null;const n=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let i=1;i<t.length;i+=2){const o=1===i?-1/0:t[i],s=t[i+1],a=i,l=i+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(s,l,r);if(!c)return null;r=r||c.type,n.push([o,c])}return new Sn(r,i,n)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;return n>=e[r-1]?i[r-1].evaluate(t):i[En(e,n)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}var Tn=Sn;const Mn=.95047,In=1.08883,Cn=4/29,An=6/29,Pn=3*An*An,Ln=An*An*An,Rn=Math.PI/180,Dn=180/Math.PI;function kn(t){return t>Ln?Math.pow(t,1/3):t/Pn+Cn}function Nn(t){return t>An?t*t*t:Pn*(t-Cn)}function On(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Fn(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function zn(t){const e=Fn(t.r),i=Fn(t.g),n=Fn(t.b),r=kn((.4124564*e+.3575761*i+.1804375*n)/Mn),o=kn((.2126729*e+.7151522*i+.072175*n)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-kn((.0193339*e+.119192*i+.9503041*n)/In)),alpha:t.a}}function Bn(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*Nn(e),i=Mn*Nn(i),n=In*Nn(n),new le(On(3.2404542*i-1.5371385*e-.4985314*n),On(-.969266*i+1.8760108*e+.041556*n),On(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}function Un(t,e,i){const n=e-t;return t+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const Vn={forward:zn,reverse:Bn,interpolate:function(t,e,i){return{l:ce(t.l,e.l,i),a:ce(t.a,e.a,i),b:ce(t.b,e.b,i),alpha:ce(t.alpha,e.alpha,i)}}},jn={forward:function(t){const{l:e,a:i,b:n}=zn(t),r=Math.atan2(n,i)*Dn;return{h:r<0?r+360:r,c:Math.sqrt(i*i+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Rn,i=t.c;return Bn({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Un(t.h,e.h,i),c:ce(t.c,e.c,i),l:ce(t.l,e.l,i),alpha:ce(t.alpha,e.alpha,i)}}};var Gn=Object.freeze({__proto__:null,hcl:jn,lab:Vn});class Hn{constructor(t,e,i,n,r){this.type=t,this.operator=e,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(const[t,e]of r)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,i,n){let r=0;if("exponential"===t.name)r=Wn(e,t.base,i,n);else if("linear"===t.name)r=Wn(e,1,i,n);else if("cubic-bezier"===t.name){const o=t.controlPoints;r=new f(o[0],o[1],o[2],o[3]).solve(Wn(e,1,i,n))}return r}static parse(t,e){let[i,n,r,...o]=t;if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const t=n[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:t}}else{if("cubic-bezier"!==n[0])return e.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const t=n.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,ye),!r)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=be:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<o.length;t+=2){const i=o[t],n=o[t+1],r=t+3,l=t+4;if("number"!=typeof i)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=i)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=e.parse(n,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Hn(a,i,n,r,s):e.error(`Type ${Ce(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;if(n>=e[r-1])return i[r-1].evaluate(t);const o=En(e,n),s=Hn.interpolationFactor(this.interpolation,n,e[o],e[o+1]),a=i[o].evaluate(t),l=i[o+1].evaluate(t);return"interpolate"===this.operator?he[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?jn.reverse(jn.interpolate(jn.forward(a),jn.forward(l),s)):Vn.reverse(Vn.interpolate(Vn.forward(a),Vn.forward(l),s))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function Wn(t,e,i,n){const r=n-i,o=t-i;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}var qn=Hn;class Xn{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const n=e.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const n of t.slice(1)){const t=e.parse(n,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,r.push(t)}const o=n&&r.some((t=>Pe(n,t.type)));return new Xn(o?Ee:i,r)}evaluate(t){let e,i=null,n=0;for(const r of this.args){if(n++,i=r.evaluate(t),i&&i instanceof Oe&&!i.available&&(e||(e=i),i=null,n===this.args.length))return e;if(null!==i)break}return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize())})),t}}var $n=Xn;class Yn{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let n=1;n<t.length-1;n+=2){const r=t[n];if("string"!=typeof r)return e.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);const o=e.parse(t[n+1],n+1);if(!o)return null;i.push([r,o])}const n=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return n?new Yn(i,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,i]of this.bindings)t.push(e,i.serialize());return t.push(this.result.serialize()),t}}var Zn=Yn;class Kn{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,ye),n=e.parse(t[2],2,Ie(e.expectedType||Ee));return i&&n?new Kn(n.type.itemType,i,n):null}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new Ge(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new Ge(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new Ge(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Jn=Kn;class Qn{constructor(t,e){this.type=xe,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Ee),n=e.parse(t[2],2,Ee);return i&&n?Le(i.type,[xe,ve,ye,_e,Ee])?new Qn(i,n):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ce(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(null==i)return!1;if(!Re(e,["boolean","string","number","null"]))throw new Ge(`Expected first argument to be of type boolean, string, number or null, but found ${Ce(Be(e))} instead.`);if(!Re(i,["string","array"]))throw new Ge(`Expected second argument to be of type array or string, but found ${Ce(Be(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var tr=Qn;class er{constructor(t,e,i){this.type=ye,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Ee),n=e.parse(t[2],2,Ee);if(!i||!n)return null;if(!Le(i.type,[xe,ve,ye,_e,Ee]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ce(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,ye);return r?new er(i,n,r):null}return new er(i,n)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!Re(e,["boolean","string","number","null"]))throw new Ge(`Expected first argument to be of type boolean, string, number or null, but found ${Ce(Be(e))} instead.`);if(!Re(i,["string","array"]))throw new Ge(`Expected second argument to be of type array or string, but found ${Ce(Be(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(t);return i.indexOf(e,n)}return i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ir=er;class nr{constructor(t,e,i,n,r,o){this.inputType=t,this.type=e,this.input=i,this.cases=n,this.outputs=r,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const r={},o=[];for(let s=2;s<t.length-1;s+=2){let a=t[s];const l=t[s+1];Array.isArray(a)||(a=[a]);const c=e.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,Be(t)))return null}else i=Be(t);if(void 0!==r[String(t)])return c.error("Branch labels must be unique.");r[String(t)]=o.length}const u=e.parse(l,s,n);if(!u)return null;n=n||u.type,o.push(u)}const s=e.parse(t[1],1,Ee);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,n);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(i,s.type)?null:new nr(i,n,s,r,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(Be(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),i=[],n={};for(const t of e){const e=n[this.cases[t]];void 0===e?(n[this.cases[t]]=i.length,i.push([this.cases[t],[t]])):i[e][1].push(t)}const r=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,n]of i)t.push(1===n.length?r(n[0]):n.map(r)),t.push(this.outputs[e].serialize());return t.push(this.otherwise.serialize()),t}}var rr=nr;class or{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const n=[];for(let r=1;r<t.length-1;r+=2){const o=e.parse(t[r],r,xe);if(!o)return null;const s=e.parse(t[r+1],r+1,i);if(!s)return null;n.push([o,s]),i=i||s.type}const r=e.parse(t[t.length-1],t.length-1,i);return r?new or(i,n,r):null}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize())})),t}}var sr=or;class ar{constructor(t,e,i,n){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Ee),n=e.parse(t[2],2,ye);if(!i||!n)return null;if(!Le(i.type,[Ie(Ee),ve,Ee]))return e.error(`Expected first argument to be of type array or string, but found ${Ce(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,ye);return r?new ar(i.type,i,n,r):null}return new ar(i.type,i,n)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!Re(e,["string","array"]))throw new Ge(`Expected first argument to be of type array or string, but found ${Ce(Be(e))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(t);return e.slice(i,n)}return e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var lr=ar;function cr(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function ur(t,e,i,n){return 0===n.compare(e,i)}function hr(t,e,i){const n="=="!==t&&"!="!==t;return class r{constructor(t,e,i){this.type=xe,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let o=e.parse(t[1],1,Ee);if(!o)return null;if(!cr(i,o.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${Ce(o.type)}'.`);let s=e.parse(t[2],2,Ee);if(!s)return null;if(!cr(i,s.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${Ce(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${Ce(o.type)}' and '${Ce(s.type)}'.`);n&&("value"===o.type.kind&&"value"!==s.type.kind?o=new qe(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new qe(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,Se),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const e=Be(o),i=Be(s);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new Ge(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const t=Be(o),i=Be(s);if("string"!==t.kind||"string"!==i.kind)return e(r,o,s)}return this.collator?i(r,o,s,this.collator.evaluate(r)):e(r,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize())})),e}}}const dr=hr("==",(function(t,e,i){return e===i}),ur),pr=hr("!=",(function(t,e,i){return e!==i}),(function(t,e,i,n){return!ur(0,e,i,n)})),fr=hr("<",(function(t,e,i){return e<i}),(function(t,e,i,n){return n.compare(e,i)<0})),mr=hr(">",(function(t,e,i){return e>i}),(function(t,e,i,n){return n.compare(e,i)>0})),gr=hr("<=",(function(t,e,i){return e<=i}),(function(t,e,i,n){return n.compare(e,i)<=0})),_r=hr(">=",(function(t,e,i){return e>=i}),(function(t,e,i,n){return n.compare(e,i)>=0}));class yr{constructor(t,e,i,n,r,o){this.type=ve,this.number=t,this.locale=e,this.currency=i,this.unit=n,this.minFractionDigits=r,this.maxFractionDigits=o}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,ye);if(!i)return null;const n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=e.parse(n.locale,1,ve),!r))return null;let o=null;if(n.currency&&(o=e.parse(n.currency,1,ve),!o))return null;let s=null;if(n.unit&&(s=e.parse(n.unit,1,ve),!s))return null;let a=null;if(n["min-fraction-digits"]&&(a=e.parse(n["min-fraction-digits"],1,ye),!a))return null;let l=null;return n["max-fraction-digits"]&&(l=e.parse(n["max-fraction-digits"],1,ye),!l)?null:new yr(i,r,o,s,a,l)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class vr{constructor(t){this.type=ye,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${Ce(i.type)} instead.`):new vr(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new Ge(`Expected value to be of type string or array, but found ${Ce(Be(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize())})),t}}function xr(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const br={"==":dr,"!=":pr,">":mr,"<":fr,">=":_r,"<=":gr,array:qe,at:Jn,boolean:qe,case:sr,coalesce:$n,collator:ri,format:Xe,image:$e,in:tr,"index-of":ir,interpolate:qn,"interpolate-hcl":qn,"interpolate-lab":qn,length:vr,let:Zn,literal:je,match:rr,number:qe,"number-format":yr,object:qe,slice:lr,step:Tn,string:qe,"to-boolean":Je,"to-color":Je,"to-number":Je,"to-string":Je,var:vn,within:Mi,distance:cn,config:pn};function wr(t,[e,i,n,r]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const o=r?r.evaluate(t):1,s=Fe(e,i,n,o);if(s)throw new Ge(s);return new le(e/255*o,i/255*o,n/255*o,o)}function Er(t,[e,i,n,r]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const o=r?r.evaluate(t):1,s=function(t,e,i,n){return"number"==typeof t&&t>=0&&t<=360?"number"==typeof e&&e>=0&&e<=100&&"number"==typeof i&&i>=0&&i<=100?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid hsla value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,n,o);if(s)throw new Ge(s);const a=`hsla(${e}, ${i}%, ${n}%, ${o})`,l=le.parse(a);if(!l)throw new Ge(`Failed to parse HSLA color: ${a}`);return l}function Sr(t,e){return t in e}function Tr(t,e){const i=e[t];return void 0===i?null:i}function Mr(t){return{type:t}}ni.register(br,{error:[{kind:"error"},[ve],(t,[e])=>{throw new Ge(e.evaluate(t))}],typeof:[ve,[Ee],(t,[e])=>Ce(Be(e.evaluate(t)))],"to-rgba":[Ie(ye,4),[be],(t,[e])=>e.evaluate(t).toArray()],rgb:[be,[ye,ye,ye],wr],rgba:[be,[ye,ye,ye,ye],wr],hsl:[be,[ye,ye,ye],Er],hsla:[be,[ye,ye,ye,ye],Er],has:{type:xe,overloads:[[[ve],(t,[e])=>Sr(e.evaluate(t),t.properties())],[[ve,we],(t,[e,i])=>Sr(e.evaluate(t),i.evaluate(t))]]},get:{type:Ee,overloads:[[[ve],(t,[e])=>Tr(e.evaluate(t),t.properties())],[[ve,we],(t,[e,i])=>Tr(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Ee,[ve],(t,[e])=>Tr(e.evaluate(t),t.featureState||{})],properties:[we,[],t=>t.properties()],"geometry-type":[ve,[],t=>t.geometryType()],id:[Ee,[],t=>t.id()],zoom:[ye,[],t=>t.globals.zoom],pitch:[ye,[],t=>t.globals.pitch||0],"distance-from-center":[ye,[],t=>t.distanceFromCenter()],"measure-light":[ye,[ve],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[ye,[],t=>t.globals.heatmapDensity||0],"line-progress":[ye,[],t=>t.globals.lineProgress||0],"raster-value":[ye,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[ye,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[ye,[],t=>t.globals.skyRadialProgress||0],accumulated:[Ee,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[ye,Mr(ye),(t,e)=>{let i=0;for(const n of e)i+=n.evaluate(t);return i}],"*":[ye,Mr(ye),(t,e)=>{let i=1;for(const n of e)i*=n.evaluate(t);return i}],"-":{type:ye,overloads:[[[ye,ye],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[ye],(t,[e])=>-e.evaluate(t)]]},"/":[ye,[ye,ye],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[ye,[ye,ye],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[ye,[],()=>Math.LN2],pi:[ye,[],()=>Math.PI],e:[ye,[],()=>Math.E],"^":[ye,[ye,ye],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[ye,[ye],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[ye,[ye],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[ye,[ye],(t,[e])=>Math.log(e.evaluate(t))],log2:[ye,[ye],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[ye,[ye],(t,[e])=>Math.sin(e.evaluate(t))],cos:[ye,[ye],(t,[e])=>Math.cos(e.evaluate(t))],tan:[ye,[ye],(t,[e])=>Math.tan(e.evaluate(t))],asin:[ye,[ye],(t,[e])=>Math.asin(e.evaluate(t))],acos:[ye,[ye],(t,[e])=>Math.acos(e.evaluate(t))],atan:[ye,[ye],(t,[e])=>Math.atan(e.evaluate(t))],min:[ye,Mr(ye),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[ye,Mr(ye),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[ye,[ye],(t,[e])=>Math.abs(e.evaluate(t))],round:[ye,[ye],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[ye,[ye],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[ye,[ye],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[xe,[ve,Ee],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[xe,[Ee],(t,[e])=>t.id()===e.value],"filter-type-==":[xe,[ve],(t,[e])=>t.geometryType()===e.value],"filter-<":[xe,[ve,Ee],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[xe,[Ee],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<n}],"filter->":[xe,[ve,Ee],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[xe,[Ee],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>n}],"filter-<=":[xe,[ve,Ee],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[xe,[Ee],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<=n}],"filter->=":[xe,[ve,Ee],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[xe,[Ee],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>=n}],"filter-has":[xe,[Ee],(t,[e])=>e.value in t.properties()],"filter-has-id":[xe,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[xe,[Ie(ve)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[xe,[Ie(Ee)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[xe,[ve,Ie(Ee)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[xe,[ve,Ie(Ee)],(t,[e,i])=>function(t,e,i,n){for(;i<=n;){const r=i+n>>1;if(e[r]===t)return!0;e[r]>t?n=r-1:i=r+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:xe,overloads:[[[xe,xe],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Mr(xe),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:xe,overloads:[[[xe,xe],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Mr(xe),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[xe,[xe],(t,[e])=>!e.evaluate(t)],"is-supported-script":[xe,[ve],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[ve,[ve],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[ve,[ve],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[ve,Mr(Ee),(t,e)=>e.map((e=>Ue(e.evaluate(t)))).join("")],"resolved-locale":[ve,[Se],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[ye,[ye,ye,Ee],(t,e)=>{const[i,n,r]=e.map((e=>e.evaluate(t)));if(i>n)return i;if(i===n)return i;let o;if("string"==typeof r)o=function(t){let e=0;if(0===t.length)return e;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}(r);else{if("number"!=typeof r)throw new Ge(`Invalid seed input: ${r}`);o=r}return i+xr(o)()*(n-i)}]});var Ir=br;function Cr(t){return{result:"success",value:t}}function Ar(t){return{result:"error",value:t}}function Pr(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Lr(t){return"data-driven"===t["property-type"]}function Rr(t){return Pr(t.expression,"measure-light")}function Dr(t){return Pr(t.expression,"zoom")}function kr(t){return!!t.expression&&t.expression.interpolated}function Nr(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Or(t){return t}function Fr(t,e){const i="color"===e.type,n=t.stops&&"object"==typeof t.stops[0][0],r=n||!(n||void 0!==t.property),o=t.type||(kr(e)?"exponential":"interval");if(i&&((t=de({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],le.parse(t[1])]))),t.default=le.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Gn[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let s,a,l;if("exponential"===o)s=Vr;else if("interval"===o)s=Ur;else if("categorical"===o){s=Br,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];l=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=jr}if(n){const i={},n=[];for(let e=0;e<t.stops.length;e++){const r=t.stops[e],o=r[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},n.push(o)),i[o].stops.push([r[0].value,r[1]])}const r=[];for(const t of n)r.push([i[t].zoom,Fr(i[t],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:qn.interpolationFactor.bind(void 0,o),zoomStops:r.map((t=>t[0])),evaluate:({zoom:i},n)=>Vr({stops:r,base:t.base},e,i).evaluate(i,n)}}if(r){const i="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:qn.interpolationFactor.bind(void 0,i),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:i})=>s(t,e,i,a,l)}}return{kind:"source",evaluate(i,n){const r=n&&n.properties?n.properties[t.property]:void 0;return void 0===r?zr(t.default,e.default):s(t,e,r,a,l)}}}function zr(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function Br(t,e,i,n,r){return zr(typeof i===r?n[i]:void 0,t.default,e.default)}function Ur(t,e,i){if("number"!==Ye(i))return zr(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const r=En(t.stops.map((t=>t[0])),i);return t.stops[r][1]}function Vr(t,e,i){const n=void 0!==t.base?t.base:1;if("number"!==Ye(i))return zr(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const o=En(t.stops.map((t=>t[0])),i),s=function(t,e,i,n){const r=n-i,o=t-i;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}(i,n,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1];let c=he[e.type]||Or;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=Gn[t.colorSpace];c=(t,i)=>e.reverse(e.interpolate(e.forward(t),e.forward(i),s))}return"function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==i)return c(e,i,s)}}:c(a,l,s)}function jr(t,e,i){return"color"===e.type?i=le.parse(i):"formatted"===e.type?i=Ne.fromString(i.toString()):"resolvedImage"===e.type?i=Oe.fromString(i.toString()):Ye(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),zr(i,t.default,e.default)}class Gr{constructor(t,e,i,n){this.expression=t,this._warningHistory={},this._evaluator=new ti(i,n),this._defaultValue=e?function(t){return"color"===t.type&&(Nr(t.default)||Array.isArray(t.default))?new le(0,0,0,0):"color"===t.type?le.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,n,r,o,s,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,n,r,o,s,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new Ge(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function Hr(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Ir}function Wr(t,e,i,n){const r=new bn(Ir,[],e?function(t){const e={color:be,string:ve,number:ye,enum:ve,boolean:xe,formatted:Te,resolvedImage:Me};return"array"===t.type?Ie(e[t.value]||Ee,t.length):e[t.type]}(e):void 0,void 0,void 0,i,n),o=r.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return o?Cr(new Gr(o,e,i,n)):Ar(r.errors)}class qr{constructor(t,e,i){this.kind=t,this._styleExpression=e,this.isLightConstant=i,this.isStateDependent="constant"!==t&&!mn(e.expression),this.isConfigDependent=!gn(e.expression)}evaluateWithoutErrorHandling(t,e,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,r,o)}evaluate(t,e,i,n,r,o){return this._styleExpression.evaluate(t,e,i,n,r,o)}}class Xr{constructor(t,e,i,n,r){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!mn(e.expression),this.isLightConstant=r,this.isConfigDependent=!gn(e.expression),this.interpolationType=n}evaluateWithoutErrorHandling(t,e,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,r,o)}evaluate(t,e,i,n,r,o){return this._styleExpression.evaluate(t,e,i,n,r,o)}interpolationFactor(t,e,i){return this.interpolationType?qn.interpolationFactor(this.interpolationType,t,e,i):0}}function $r(t,e,i,n){if("error"===(t=Wr(t,e,i,n)).result)return t;const r=t.value.expression,o=fn(r);if(!o&&!Lr(e))return Ar([new fe("","data expressions not supported")]);const s=_n(r,["zoom","pitch","distance-from-center"]);if(!s&&!Dr(e))return Ar([new fe("","zoom expressions not supported")]);const a=_n(r,["measure-light"]);if(!a&&!Rr(e))return Ar([new fe("","measure-light expression not supported")]);const l=e.expression&&e.expression.relaxZoomRestriction,c=Zr(r);return c||s||l?c instanceof fe?Ar([c]):c instanceof qn&&!kr(e)?Ar([new fe("",'"interpolate" expressions cannot be used with this property')]):Cr(c?new Xr(o?"camera":"composite",t.value,c.labels,c instanceof qn?c.interpolation:void 0,a):new qr(o?"constant":"source",t.value,a)):Ar([new fe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Yr{constructor(t,e){this._parameters=t,this._specification=e,de(this,Fr(this._parameters,this._specification))}static deserialize(t){return new Yr(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Zr(t){let e=null;if(t instanceof Zn)e=Zr(t.result);else if(t instanceof $n){for(const i of t.args)if(e=Zr(i),e)break}else(t instanceof Tn||t instanceof qn)&&t.input instanceof ni&&"zoom"===t.input.name&&(e=t);return e instanceof fe||t.eachChild((t=>{const i=Zr(t);i instanceof fe?e=i:e&&i&&e!==i&&(e=new fe("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var Kr=Qr,Jr=3;function Qr(t,e,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var r=new Int32Array(this.arrayBuffer);t=r[0],this.d=(e=r[1])+2*(i=r[2]);for(var o=0;o<this.d*this.d;o++){var s=r[Jr+o],a=r[Jr+o+1];n.push(s===a?null:r.subarray(s,a))}var l=r[Jr+n.length+1];this.keys=r.subarray(r[Jr+n.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var c=0;c<this.d*this.d;c++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var u=i/e*t;this.min=-u,this.max=t+u}Qr.prototype.insert=function(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},Qr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Qr.prototype._insertCell=function(t,e,i,n,r,o){this.cells[r].push(o)},Qr.prototype.query=function(t,e,i,n,r){var o=this.min,s=this.max;if(t<=o&&e<=o&&s<=i&&s<=n&&!r)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,i,n,this._queryCell,a,{},r),a},Qr.prototype._queryCell=function(t,e,i,n,r,o,s,a){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):t<=u[p+2]&&e<=u[p+3]&&i>=u[p+0]&&n>=u[p+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},Qr.prototype._forEachCell=function(t,e,i,n,r,o,s,a){for(var l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(i),h=this._convertToCellCoord(n),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&r.call(this,t,e,i,n,f,o,s,a))return}},Qr.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Qr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Qr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Jr+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var r=new Int32Array(e+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=e,s=0;s<t.length;s++){var a=t[s];r[Jr+s]=o,r.set(a,o),o+=a.length}return r[Jr+t.length]=o,r.set(this.keys,o),r[Jr+t.length+1]=o+=this.keys.length,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};var to=h(Kr);const eo={};function io(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),eo[e]={klass:t,omit:i.omit||[]}}io(Object,"Object"),to.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},to.deserialize=function(t){return new to(t.buffer)},Object.defineProperty(to,"name",{value:"Grid"}),io(to,"Grid"),io(le,"Color"),io(Error,"Error"),io(Ne,"Formatted"),io(ke,"FormattedSection"),io(Tt,"AJAXError"),io(Oe,"ResolvedImage"),io(Yr,"StylePropertyFunction"),io(Gr,"StyleExpression",{omit:["_evaluator"]}),io(Xr,"ZoomDependentExpression"),io(qr,"ZoomConstantExpression"),io(ni,"CompoundExpression",{omit:["_evaluate"]});for(const t in Ir)eo[Ir[t]._classRegistryKey]||io(Ir[t],`Expression${t}`);function no(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function ro(t){return self.ImageBitmap&&t instanceof ImageBitmap}function oo(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(no(t)||ro(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.add(i.buffer),i}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const n of t)i.push(oo(n,e));return i}if(t instanceof Map){const e={$name:"Map"};for(const[i,n]of t.entries())e[i]=oo(n);return e}if("object"==typeof t){const i=t.constructor,n=i._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const r=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const i in t)t.hasOwnProperty(i)&&(eo[n].omit.indexOf(i)>=0||(r[i]=oo(t[i],e)));t instanceof Error&&(r.message=t.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(r.$name=n),r}throw new Error("can't serialize object of type "+typeof t)}function so(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||no(t)||ro(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(so);if("object"==typeof t){const e=t.$name||"Object";if("Map"===e){const e=new Map;for(const i of Object.keys(t))"$name"!==i&&e.set(i,so(t[i]));return e}const{klass:i}=eo[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const n=Object.create(i.prototype);for(const e of Object.keys(t))"$name"!==e&&(n[e]=so(t[e]));return n}throw new Error("can't deserialize object of type "+typeof t)}const ao={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function lo(t){for(const e of t)if(ho(e.charCodeAt(0)))return!0;return!1}function co(t){for(const e of t)if(!uo(e.charCodeAt(0)))return!1;return!0}function uo(t){return!(ao.Arabic(t)||ao["Arabic Supplement"](t)||ao["Arabic Extended-A"](t)||ao["Arabic Presentation Forms-A"](t)||ao["Arabic Presentation Forms-B"](t))}function ho(t){return!(746!==t&&747!==t&&(t<4352||!(ao["Bopomofo Extended"](t)||ao.Bopomofo(t)||ao["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||ao["CJK Compatibility Ideographs"](t)||ao["CJK Compatibility"](t)||ao["CJK Radicals Supplement"](t)||ao["CJK Strokes"](t)||!(!ao["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||ao["CJK Unified Ideographs Extension A"](t)||ao["CJK Unified Ideographs"](t)||ao["Enclosed CJK Letters and Months"](t)||ao["Hangul Compatibility Jamo"](t)||ao["Hangul Jamo Extended-A"](t)||ao["Hangul Jamo Extended-B"](t)||ao["Hangul Jamo"](t)||ao["Hangul Syllables"](t)||ao.Hiragana(t)||ao["Ideographic Description Characters"](t)||ao.Kanbun(t)||ao["Kangxi Radicals"](t)||ao["Katakana Phonetic Extensions"](t)||ao.Katakana(t)&&12540!==t||!(!ao["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!ao["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||ao["Unified Canadian Aboriginal Syllabics"](t)||ao["Unified Canadian Aboriginal Syllabics Extended"](t)||ao["Vertical Forms"](t)||ao["Yijing Hexagram Symbols"](t)||ao["Yi Syllables"](t)||ao["Yi Radicals"](t))))}function po(t){return!(ho(t)||function(t){return!!(ao["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||ao["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||ao["Letterlike Symbols"](t)||ao["Number Forms"](t)||ao["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||ao["Control Pictures"](t)&&9251!==t||ao["Optical Character Recognition"](t)||ao["Enclosed Alphanumerics"](t)||ao["Geometric Shapes"](t)||ao["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ao["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ao["CJK Symbols and Punctuation"](t)||ao.Katakana(t)||ao["Private Use Area"](t)||ao["CJK Compatibility Forms"](t)||ao["Small Form Variants"](t)||ao["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function fo(t){return t>=1424&&t<=2303||ao["Arabic Presentation Forms-A"](t)||ao["Arabic Presentation Forms-B"](t)}function mo(t,e){return!(!e&&fo(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||ao.Khmer(t))}function go(t){for(const e of t)if(fo(e.charCodeAt(0)))return!0;return!1}const _o="deferred",yo="loading",vo="loaded";let xo=null,bo="unavailable",wo=null;const Eo=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(bo="error"),xo&&xo(t)};function So(){To.fire(new Qt("pluginStateChange",{pluginStatus:bo,pluginURL:wo}))}const To=new ee,Mo=function(){return bo},Io=function(){if(bo!==_o||!wo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");bo=yo,So(),wo&&Ct({url:wo},(t=>{t?Eo(t):(bo=vo,So())}))},Co={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>bo===vo||null!=Co.applyArabicShaping,isLoading:()=>bo===yo,setState(t){bo=t.pluginStatus,wo=t.pluginURL},isParsed:()=>null!=Co.applyArabicShaping&&null!=Co.processBidirectionalText&&null!=Co.processStyledBidirectionalText,getPluginURL:()=>wo};class Ao{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.transition=e.transition,this.pitch=e.pitch,this.brightness=e.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(t,e){for(const i of t)if(!mo(i.charCodeAt(0),e))return!1;return!0}(t,Co.isLoaded())}}class Po{constructor(t,e,i,n){this.property=t,this.value=e,this.expression=function(t,e,i,n){if(Nr(t))return new Yr(t,e);if(Hr(t)||Array.isArray(t)&&t.length>0){const r=$r(t,e,i,n);if("error"===r.result)throw new Error(r.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return r.value}{let i=t;return"string"==typeof t&&"color"===e.type&&(i=le.parse(t)),{kind:"constant",isConfigDependent:!1,evaluate:()=>i}}}(void 0===e?t.specification.default:e,t.specification,i,n)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)}}class Lo{constructor(t,e,i){this.property=t,this.value=new Po(t,void 0,e,i)}transitioned(t,e){return new Do(this.property,this.value,e,P({},t.transition,this.transition),t.now)}untransitioned(){return new Do(this.property,this.value,null,{},0)}}class Ro{constructor(t,e,i){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=e,this._options=i,this.isConfigDependent=!1}getValue(t){return U(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Lo(this._values[t].property,this._scope,this._options)),this._values[t].value=new Po(this._values[t].property,null===e?void 0:U(e),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,e){e&&(this._options=e);const i=this._properties.properties;if(t)for(const e in t){const n=t[e];if(F(e,"-transition")){const t=e.slice(0,-11);i[t]&&this.setTransition(t,n)}else i[e]&&this.setValue(e,n)}}getTransition(t){return U(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Lo(this._values[t].property)),this._values[t].transition=U(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i);const n=this.getTransition(e);void 0!==n&&(t[`${e}-transition`]=n)}return t}transitioned(t,e){const i=new ko(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].transitioned(t,e._values[n]);return i}untransitioned(){const t=new ko(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class Do{constructor(t,e,i,n,r){const o=n.delay||0,s=n.duration||0;r=r||0,this.property=t,this.value=e,this.begin=r+o,this.end=this.begin+s,t.specification.transition&&(n.delay||n.duration)&&(this.prior=i)}possiblyEvaluate(t,e,i){const n=t.now||0,r=this.value.possiblyEvaluate(t,e,i),o=this.prior;if(o){if(n>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(n<this.begin)return o.possiblyEvaluate(t,e,i);{const s=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,i),r,E(s))}}return r}}class ko{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,i){const n=new Fo(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(t,e,i);return n}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class No{constructor(t,e,i){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=e,this._options=i,this.isConfigDependent=!1}getValue(t){return U(this._values[t].value)}setValue(t,e){this._values[t]=new Po(this._values[t].property,null===e?void 0:U(e),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i)}return t}possiblyEvaluate(t,e,i){const n=new Fo(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(t,e,i);return n}}class Oo{constructor(t,e,i){this.property=t,this.value=e,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,i,n){return this.property.evaluate(this.value,this.parameters,t,e,i,n)}}class Fo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class zo{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,i){const n=he[this.specification.type];return n?n(t,e,i):t}}class Bo{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,i,n){return new Oo(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,n)}:t.expression,e)}interpolate(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Oo(this,{kind:"constant",value:void 0},t.parameters);const n=he[this.specification.type];return n?new Oo(this,{kind:"constant",value:n(t.value.value,e.value.value,i)},t.parameters):t}evaluate(t,e,i,n,r,o){return"constant"===t.kind?t.value:t.evaluate(e,i,n,r,o)}}class Uo{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,n){return!!t.expression.evaluate(e,null,{},i,n)}interpolate(){return!1}}class Vo{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const e=new Ao(0,{});for(const i in t){const n=t[i];n.specification.overridable&&this.overridableProperties.push(i);const r=this.defaultPropertyValues[i]=new Po(n,void 0),o=this.defaultTransitionablePropertyValues[i]=new Lo(n);this.defaultTransitioningPropertyValues[i]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=r.possiblyEvaluate(e)}}}function jo(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Go(t){if(Array.isArray(t))return t.map(Go);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Go(t[i]);return e}return jo(t)}io(Bo,"DataDrivenProperty"),io(zo,"DataConstantProperty"),io(Uo,"ColorRampProperty");var Ho=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Wo(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Wo(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function qo(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Wo(t)||(t=Qo(t));const i=t;let n=!0;try{n=function(t){if(!Yo(t))return t;let e=Go(t);return $o(e),e=Xo(e),e}(i)}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const r=Ho[`filter_${e}`],o=Wr(n,r);let s=null;if("error"===o.result)throw new Error(o.value.map((t=>`${t.key}: ${t.message}`)).join(", "));s=(t,e,i)=>o.value.evaluate(t,e,{},i);let a=null,l=null;if(n!==i){const t=Wr(i,r);if("error"===t.result)throw new Error(t.value.map((t=>`${t.key}: ${t.message}`)).join(", "));a=(e,i,n,r,o)=>t.value.evaluate(e,i,{},n,void 0,void 0,r,o),l=!fn(t.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:Jo(n),needFeature:!!l}}function Xo(t){if(!Array.isArray(t))return t;const e=function(t){if(Zo.has(t[0]))for(let e=1;e<t.length;e++)if(Yo(t[e]))return!0;return t}(t);return!0===e?e:e.map((t=>Xo(t)))}function $o(t){let e=!1;const i=[];if("case"===t[0]){for(let n=1;n<t.length-1;n+=2)e=e||Yo(t[n]),i.push(t[n+1]);i.push(t[t.length-1])}else if("match"===t[0]){e=e||Yo(t[1]);for(let e=2;e<t.length-1;e+=2)i.push(t[e+1]);i.push(t[t.length-1])}else if("step"===t[0]){e=e||Yo(t[1]);for(let e=1;e<t.length-1;e+=2)i.push(t[e+1])}e&&(t.length=0,t.push("any",...i));for(let e=1;e<t.length;e++)$o(t[e])}function Yo(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let e=1;e<t.length;e++)if(Yo(t[e]))return!0;return!1}const Zo=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ko(t,e){return t<e?-1:t>e?1:0}function Jo(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(Jo(t[e]))return!0;return!1}function Qo(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?ts(t[1],t[2],"=="):"!="===e?ns(ts(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?ts(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(Qo))):"all"===e?["all"].concat(t.slice(1).map(Qo)):"none"===e?["all"].concat(t.slice(1).map(Qo).map(ns)):"in"===e?es(t[1],t.slice(2)):"!in"===e?ns(es(t[1],t.slice(2))):"has"===e?is(t[1]):"!has"!==e||ns(is(t[1]));var i}function ts(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function es(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(Ko)]]:["filter-in-small",t,["literal",e]]}}function is(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ns(t){return["!",t]}const rs="";function os(t,e){return e?`${t}${rs}${e}`:t}const ss="-transition";class as extends ee{constructor(t,e,i,n){if(super(),this.id=t.id,this.fqid=os(this.id,i),this.type=t.type,this.scope=i,this.options=n,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&"slot"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),t.slot&&(this.slot=t.slot),e.layout&&(this._unevaluatedLayout=new No(e.layout,this.scope,n),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),e.paint)){this._transitionablePaint=new Ro(e.paint,this.scope,n);for(const e in t.paint)this.setPaintProperty(e,t.paint[e]);for(const e in t.layout)this.setLayoutProperty(e,t.layout[e]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fo(e.paint)}}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e){if("custom"===this.type&&"visibility"===t)return void(this.visibility=e);const i=this._unevaluatedLayout;i._properties.properties[t]&&(i.setValue(t,e),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,"visibility"===t&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return F(t,ss)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e){const i=this._transitionablePaint,n=i._properties.properties;if(F(t,ss)){const r=t.slice(0,-11);return n[r]&&i.setTransition(r,e||void 0),!1}if(!n[t])return!1;const r=i._values[t],o=r.value.isDataDriven(),s=r.value;i.setValue(t,e),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const a=i._values[t].value,l=a.isDataDriven(),c=F(t,"pattern")||"line-dasharray"===t;return l||o||c||this._handleOverridablePaintPropertyUpdate(t,s,a)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,e){return null}_handleOverridablePaintPropertyUpdate(t,e,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){return B({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof Oo&&Lr(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=qo(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&("shadow"===t.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}const ls={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class cs{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class us{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function hs(t,e=1){let i=0,n=0;return{members:t.map((t=>{const r=ls[t.type].BYTES_PER_ELEMENT,o=i=ds(i,Math.max(e,r)),s=t.components||1;return n=Math.max(n,r),i+=r*s,{name:t.name,type:t.type,components:s,offset:o}})),size:ds(i,Math.max(n,e)),alignment:e}}function ds(t,e){return Math.ceil(t/e)*e}class ps extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.int16[n+0]=e,this.int16[n+1]=i,t}}ps.prototype.bytesPerElement=4,io(ps,"StructArrayLayout2i4");class fs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.int16[r+0]=e,this.int16[r+1]=i,this.int16[r+2]=n,t}}fs.prototype.bytesPerElement=6,io(fs,"StructArrayLayout3i6");class ms extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=i,this.int16[o+2]=n,this.int16[o+3]=r,t}}ms.prototype.bytesPerElement=8,io(ms,"StructArrayLayout4i8");class gs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n,r)}emplace(t,e,i,n,r,o){const s=5*t;return this.int16[s+0]=e,this.int16[s+1]=i,this.int16[s+2]=n,this.int16[s+3]=r,this.int16[s+4]=o,t}}gs.prototype.bytesPerElement=10,io(gs,"StructArrayLayout5i10");class _s extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,r,o,s)}emplace(t,e,i,n,r,o,s,a){const l=6*t,c=12*t,u=3*t;return this.int16[l+0]=e,this.int16[l+1]=i,this.uint8[c+4]=n,this.uint8[c+5]=r,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,t}}_s.prototype.bytesPerElement=12,io(_s,"StructArrayLayout2i4ub1f12");class ys extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=n,this.float32[o+3]=r,t}}ys.prototype.bytesPerElement=16,io(ys,"StructArrayLayout4f16");class vs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n,r)}emplace(t,e,i,n,r,o){const s=6*t,a=3*t;return this.uint16[s+0]=e,this.uint16[s+1]=i,this.uint16[s+2]=n,this.uint16[s+3]=r,this.float32[a+2]=o,t}}vs.prototype.bytesPerElement=12,io(vs,"StructArrayLayout4ui1f12");class xs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const o=4*t;return this.uint16[o+0]=e,this.uint16[o+1]=i,this.uint16[o+2]=n,this.uint16[o+3]=r,t}}xs.prototype.bytesPerElement=8,io(xs,"StructArrayLayout4ui8");class bs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,r,o)}emplace(t,e,i,n,r,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=n,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,t}}bs.prototype.bytesPerElement=12,io(bs,"StructArrayLayout6i12");class ws extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,i,n,r,o,s,a,l,c,u,h)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,d){const p=12*t;return this.int16[p+0]=e,this.int16[p+1]=i,this.int16[p+2]=n,this.int16[p+3]=r,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,t}}ws.prototype.bytesPerElement=24,io(ws,"StructArrayLayout4i4ui4i24");class Es extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,r,o)}emplace(t,e,i,n,r,o,s){const a=10*t,l=5*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=n,this.float32[l+2]=r,this.float32[l+3]=o,this.float32[l+4]=s,t}}Es.prototype.bytesPerElement=20,io(Es,"StructArrayLayout3i3f20");class Ss extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}Ss.prototype.bytesPerElement=4,io(Ss,"StructArrayLayout1ul4");class Ts extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,t}}Ts.prototype.bytesPerElement=4,io(Ts,"StructArrayLayout2ui4");class Ms extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,t,e,i,n,r,o,s,a,l,c,u,h,d)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,d,p){const f=20*t,m=10*t;return this.int16[f+0]=e,this.int16[f+1]=i,this.int16[f+2]=n,this.int16[f+3]=r,this.int16[f+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,t}}Ms.prototype.bytesPerElement=40,io(Ms,"StructArrayLayout5i4f1i1ul2ui40");class Is extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,r,o,s)}emplace(t,e,i,n,r,o,s,a){const l=8*t;return this.int16[l+0]=e,this.int16[l+1]=i,this.int16[l+2]=n,this.int16[l+4]=r,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,t}}Is.prototype.bytesPerElement=16,io(Is,"StructArrayLayout3i2i2i16");class Cs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n,r)}emplace(t,e,i,n,r,o){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=n,this.int16[a+6]=r,this.int16[a+7]=o,t}}Cs.prototype.bytesPerElement=16,io(Cs,"StructArrayLayout2f1f2i16");class As extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const o=12*t,s=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=i,this.float32[s+1]=n,this.float32[s+2]=r,t}}As.prototype.bytesPerElement=12,io(As,"StructArrayLayout2ub2f12");class Ps extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,this.uint16[r+2]=n,t}}Ps.prototype.bytesPerElement=6,io(Ps,"StructArrayLayout3ui6");class Ls extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b){const w=30*t,E=15*t,S=60*t;return this.int16[w+0]=e,this.int16[w+1]=i,this.int16[w+2]=n,this.float32[E+2]=r,this.float32[E+3]=o,this.uint16[w+8]=s,this.uint16[w+9]=a,this.uint32[E+5]=l,this.uint32[E+6]=c,this.uint32[E+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[E+10]=f,this.float32[E+11]=m,this.uint8[S+48]=g,this.uint8[S+49]=_,this.uint8[S+50]=y,this.uint32[E+13]=v,this.int16[w+28]=x,this.uint8[S+58]=b,t}}Ls.prototype.bytesPerElement=60,io(Ls,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Rs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,E,S,T,M,I,C,A,P,L){const R=this.length;return this.resize(R+1),this.emplace(R,t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,E,S,T,M,I,C,A,P,L)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,E,S,T,M,I,C,A,P,L,R){const D=20*t,k=40*t,N=80*t;return this.float32[D+0]=e,this.float32[D+1]=i,this.int16[k+4]=n,this.int16[k+5]=r,this.int16[k+6]=o,this.int16[k+7]=s,this.int16[k+8]=a,this.int16[k+9]=l,this.int16[k+10]=c,this.int16[k+11]=u,this.int16[k+12]=h,this.uint16[k+13]=d,this.uint16[k+14]=p,this.uint16[k+15]=f,this.uint16[k+16]=m,this.uint16[k+17]=g,this.uint16[k+18]=_,this.uint16[k+19]=y,this.uint16[k+20]=v,this.uint16[k+21]=x,this.uint16[k+22]=b,this.uint16[k+23]=w,this.uint16[k+24]=E,this.uint16[k+25]=S,this.uint16[k+26]=T,this.uint16[k+27]=M,this.uint32[D+14]=I,this.float32[D+15]=C,this.float32[D+16]=A,this.float32[D+17]=P,this.float32[D+18]=L,this.uint8[N+76]=R,t}}Rs.prototype.bytesPerElement=80,io(Rs,"StructArrayLayout2f9i15ui1ul4f1ub80");class Ds extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}Ds.prototype.bytesPerElement=4,io(Ds,"StructArrayLayout1f4");class ks extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n,r)}emplace(t,e,i,n,r,o){const s=5*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=n,this.float32[s+3]=r,this.float32[s+4]=o,t}}ks.prototype.bytesPerElement=20,io(ks,"StructArrayLayout5f20");class Ns extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,r,o,s)}emplace(t,e,i,n,r,o,s,a){const l=7*t;return this.float32[l+0]=e,this.float32[l+1]=i,this.float32[l+2]=n,this.float32[l+3]=r,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,t}}Ns.prototype.bytesPerElement=28,io(Ns,"StructArrayLayout7f28");class Os extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const o=6*t;return this.uint32[3*t+0]=e,this.uint16[o+2]=i,this.uint16[o+3]=n,this.uint16[o+4]=r,t}}Os.prototype.bytesPerElement=12,io(Os,"StructArrayLayout1ul3ui12");class Fs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}Fs.prototype.bytesPerElement=2,io(Fs,"StructArrayLayout1ui2");class zs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.float32[r+0]=e,this.float32[r+1]=i,this.float32[r+2]=n,t}}zs.prototype.bytesPerElement=12,io(zs,"StructArrayLayout3f12");class Bs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.float32[n+0]=e,this.float32[n+1]=i,t}}Bs.prototype.bytesPerElement=8,io(Bs,"StructArrayLayout2f8");class Us extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g){const _=16*t;return this.float32[_+0]=e,this.float32[_+1]=i,this.float32[_+2]=n,this.float32[_+3]=r,this.float32[_+4]=o,this.float32[_+5]=s,this.float32[_+6]=a,this.float32[_+7]=l,this.float32[_+8]=c,this.float32[_+9]=u,this.float32[_+10]=h,this.float32[_+11]=d,this.float32[_+12]=p,this.float32[_+13]=f,this.float32[_+14]=m,this.float32[_+15]=g,t}}Us.prototype.bytesPerElement=64,io(Us,"StructArrayLayout16f64");class Vs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,r,o,s)}emplace(t,e,i,n,r,o,s,a){const l=10*t,c=5*t;return this.uint16[l+0]=e,this.uint16[l+1]=i,this.uint16[l+2]=n,this.uint16[l+3]=r,this.float32[c+2]=o,this.float32[c+3]=s,this.float32[c+4]=a,t}}Vs.prototype.bytesPerElement=20,io(Vs,"StructArrayLayout4ui3f20");class js extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint8[1*t+0]=e,t}}js.prototype.bytesPerElement=1,io(js,"StructArrayLayout1ub1");class Gs extends cs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Gs.prototype.size=40;class Hs extends Ms{get(t){return new Gs(this,t)}}io(Hs,"CollisionBoxArray");class Ws extends cs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Ws.prototype.size=60;class qs extends Ls{get(t){return new Ws(this,t)}}io(qs,"PlacedSymbolArray");class Xs extends cs{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Xs.prototype.size=80;class $s extends Rs{get(t){return new Xs(this,t)}}io($s,"SymbolInstanceArray");class Ys extends Ds{getoffsetX(t){return this.float32[1*t+0]}}io(Ys,"GlyphOffsetArray");class Zs extends ps{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}io(Zs,"SymbolLineVertexArray");class Ks extends cs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ks.prototype.size=12;class Js extends Os{get(t){return new Ks(this,t)}}io(Js,"FeatureIndexArray");class Qs extends Ts{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}io(Qs,"FillExtrusionCentroidArray");const ta=hs([{name:"a_pos",components:2,type:"Int16"}],4),ea=hs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ia{constructor(t=[]){this.segments=t}_prepareSegment(t,e,i,n){let r=this.segments[this.segments.length-1];return t>ia.MAX_VERTEX_ARRAY_LENGTH&&j(`Max vertices per segment is ${ia.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!r||r.vertexLength+t>ia.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==n)&&(r={vertexOffset:e,primitiveOffset:i,vertexLength:0,primitiveLength:0},void 0!==n&&(r.sortKey=n),this.segments.push(r)),r}prepareSegment(t,e,i,n){return this._prepareSegment(t,e.length,i.length,n)}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,i,n){return new ia([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:n,vaos:{},sortKey:0}])}}function na(t,e){return 256*(t=M(Math.floor(t),0,255))+M(Math.floor(e),0,255)}ia.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,io(ia,"SegmentVector");const ra=hs([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),oa=hs([{name:"a_dash",components:4,type:"Uint16"}]);var sa={exports:{}},aa={exports:{}};!function(t){t.exports=function(t,e){var i,n,r,o,s,a,l,c;for(n=t.length-(i=3&t.length),r=e,s=3432918353,a=461845907,c=0;c<n;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}}(aa);var la=aa.exports,ca={exports:{}};!function(t){t.exports=function(t,e){for(var i,n=t.length,r=e^n,o=0;n>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:r^=(255&t.charCodeAt(o+2))<<16;case 2:r^=(255&t.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}}(ca);var ua=la,ha=ca.exports;sa.exports=ua,sa.exports.murmur3=ua,sa.exports.murmur2=ha;var da=h(sa.exports);class pa{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,e,i,n){this.ids.push(fa(t)),this.positions.push(e,i,n)}eachPosition(t,e){const i=fa(t);let n=0,r=this.ids.length-1;for(;n<r;){const t=n+r>>1;this.ids[t]>=i?r=t:n=t+1}for(;this.ids[n]===i;)e(this.positions[3*n],this.positions[3*n+1],this.positions[3*n+2]),n++}static serialize(t,e){const i=new Float64Array(t.ids),n=new Uint32Array(t.positions);return ma(i,n,0,i.length-1),e&&(e.add(i.buffer),e.add(n.buffer)),{ids:i,positions:n}}static deserialize(t){const e=new pa;let i;e.ids=t.ids,e.positions=t.positions;for(const t of e.ids)t!==i&&e.uniqueIds.push(t),i=t;return e.indexed=!0,e}}function fa(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:da(String(t))}function ma(t,e,i,n){for(;i<n;){const r=t[i+n>>1];let o=i-1,s=n+1;for(;;){do{o++}while(t[o]<r);do{s--}while(t[s]>r);if(o>=s)break;ga(t,o,s),ga(e,3*o,3*s),ga(e,3*o+1,3*s+1),ga(e,3*o+2,3*s+2)}s-i<n-s?(ma(t,e,i,s),i=s+1):(ma(t,e,s+1,n),n=s)}}function ga(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}io(pa,"FeaturePositionMap");class _a{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,e){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,e),this.initialized=!0),!!this.location}}class ya extends _a{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class va extends _a{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class xa extends _a{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class ba extends _a{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class wa extends _a{constructor(t){super(t),this.current=[0,0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class Ea extends _a{constructor(t){super(t),this.current=le.transparent}set(t,e,i){this.fetchUniformLocation(t,e)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const Sa=new Float32Array(16);class Ta extends _a{constructor(t){super(t),this.current=Sa}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}const Ma=new Float32Array(9),Ia=new Float32Array(4);class Ca extends _a{constructor(t){super(t),this.current=Ia}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let t=0;t<4;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}function Aa(t){return[na(255*t.r,255*t.g),na(255*t.b,255*t.a)]}class Pa{constructor(t,e,i){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=i}setUniform(t,e,i,n,r){e.set(t,r,n.constantOr(this.value))}getBinding(t,e){return"color"===this.type?new Ea(t):new va(t)}}class La{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,e,i,n,r){const o="u_pattern"===r||"u_dash"===r?this.pattern:"u_pixel_ratio"===r?this.pixelRatio:null;o&&e.set(t,r,o)}getBinding(t,e){return"u_pattern"===e||"u_dash"===e?new wa(t):new va(t)}}class Ra{constructor(t,e,i,n){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new n}populatePaintArray(t,e,i,n,r,o,s){const a=this.paintVertexArray.length,l=this.expression.evaluate(new Ao(0,{brightness:o}),e,{},r,n,s);this.paintVertexArray.resize(t),this._setPaintValue(a,t,l)}updatePaintArray(t,e,i,n,r,o,s){const a=this.expression.evaluate({zoom:0,brightness:s},i,n,void 0,r);this._setPaintValue(t,e,a)}_setPaintValue(t,e,i){if("color"===this.type){const n=Aa(i);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Da{constructor(t,e,i,n,r,o){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=i,this.useIntegerZoom=n,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(t,e,i,n,r,o,s){const a=this.expression.evaluate(new Ao(this.zoom,{brightness:o}),e,{},r,n,s),l=this.expression.evaluate(new Ao(this.zoom+1,{brightness:o}),e,{},r,n,s),c=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(c,t,a,l)}updatePaintArray(t,e,i,n,r,o,s){const a=this.expression.evaluate({zoom:this.zoom,brightness:s},i,n,void 0,r),l=this.expression.evaluate({zoom:this.zoom+1,brightness:s},i,n,void 0,r);this._setPaintValue(t,e,a,l)}_setPaintValue(t,e,i,n){if("color"===this.type){const r=Aa(i),o=Aa(n);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1],o[0],o[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e,i,n,r){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,s=M(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(t,r,s)}getBinding(t,e){return new va(t)}}class ka{constructor(t,e,i,n,r){this.expression=t,this.layerId=r,this.paintVertexAttributes=("array"===i?oa:ra).members;for(let t=0;t<e.length;++t);this.paintVertexArray=new n}populatePaintArray(t,e,i){const n=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(n,t,e.patterns&&e.patterns[this.layerId],i)}updatePaintArray(t,e,i,n,r,o,s){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],o)}_setPaintValues(t,e,i,n){if(!n||!i)return;const r=n[i];if(!r)return;const{tl:o,br:s,pixelRatio:a}=r;for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,o[0],o[1],s[0],s[1],a)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Na{constructor(t,e,i=(()=>!0)){this.binders={},this._buffers=[];const n=[];for(const r in t.paint._values){const o=t.paint.get(r);if(!i(r))continue;if(!(o instanceof Oo&&Lr(o.property.specification)))continue;const s=za(r,t.type),a=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===r||r.endsWith("pattern"),h="line-dasharray"===r&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==a.kind||h)if("source"===a.kind||h||u){const e=Va(r,l,"source");this.binders[r]=u?new ka(a,s,l,e,t.id):new Ra(a,s,l,e),n.push(`/a_${r}`)}else{const t=Va(r,l,"composite");this.binders[r]=new Da(a,s,l,c,e,t),n.push(`/z_${r}`)}else this.binders[r]=u?new La(a.value,s):new Pa(a.value,s,l),n.push(`/u_${r}`)}this.cacheKey=n.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof Ra||e instanceof Da?e.maxValue:0}populatePaintArrays(t,e,i,n,r,o,s){for(const a in this.binders){const l=this.binders[a];(l instanceof Ra||l instanceof Da||l instanceof ka)&&l.populatePaintArray(t,e,i,n,r,o,s)}}setConstantPatternPositions(t){for(const e in this.binders){const i=this.binders[e];i instanceof La&&i.setConstantPatternPositions(t)}}updatePaintArrays(t,e,i,n,r,o,s,a){let l=!1;const c=Object.keys(t),u=0!==c.length,h=u?c:e.uniqueIds;for(const c in this.binders){const d=this.binders[c];if((d instanceof Ra||d instanceof Da||d instanceof ka)&&(!0===d.expression.isStateDependent||!1===d.expression.isLightConstant)){const p=r.paint.get(c);d.expression=p.value;for(const i of h){const r=t[i.toString()];e.eachPosition(i,((t,e,i)=>{const l=n.feature(t);d.updatePaintArray(e,i,l,r,o,s,a)}))}if(!u)for(const e of i.uniqueIds){const r=t[e.toString()];i.eachPosition(e,((t,e,i)=>{const l=n.feature(t);d.updatePaintArray(e,i,l,r,o,s,a)}))}l=!0}}return l}defines(){const t=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Pa||i instanceof La)&&t.push(...i.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Ra||i instanceof Da||i instanceof ka)for(let e=0;e<i.paintVertexAttributes.length;e++)t.push(i.paintVertexAttributes[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Pa||i instanceof La||i instanceof Da)for(const e of i.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const e=[];for(const i in this.binders){const n=this.binders[i];if(n instanceof Pa||n instanceof La||n instanceof Da)for(const r of n.uniformNames)e.push({name:r,property:i,binding:n.getBinding(t,r)})}return e}setUniforms(t,e,i,n,r){for(const{name:e,property:o,binding:s}of i)this.binders[o].setUniform(t,s,r,n.get(o),e)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const e=this.binders[t];(e instanceof Ra||e instanceof Da||e instanceof ka)&&e.paintVertexBuffer&&this._buffers.push(e.paintVertexBuffer)}}upload(t){for(const e in this.binders){const i=this.binders[e];(i instanceof Ra||i instanceof Da||i instanceof ka)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof Ra||e instanceof Da||e instanceof ka)&&e.destroy()}}}class Oa{constructor(t,e,i=(()=>!0)){this.programConfigurations={};for(const n of t)this.programConfigurations[n.id]=new Na(n,e,i);this.needsUpload=!1,this._featureMap=new pa,this._featureMapWithoutIds=new pa,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,e,i,n,r,o,s,a){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,n,r,o,s,a);void 0!==e.id?this._featureMap.add(e.id,i,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,i,n,r,o){for(const s of i)this.needsUpload=this.programConfigurations[s.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,e,s,n,r,o||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const Fa={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function za(t,e){return Fa[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Ba={"line-pattern":{source:vs,composite:vs},"fill-pattern":{source:vs,composite:vs},"fill-extrusion-pattern":{source:vs,composite:vs},"line-dasharray":{source:xs,composite:xs}},Ua={color:{source:Bs,composite:ys},number:{source:Ds,composite:Bs}};function Va(t,e,i){const n=Ba[t];return n&&n[i]||Ua[e][i]}io(Pa,"ConstantBinder"),io(La,"PatternConstantBinder"),io(Ra,"SourceExpressionBinder"),io(ka,"PatternCompositeBinder"),io(Da,"CompositeExpressionBinder"),io(Na,"ProgramConfiguration",{omit:["_buffers"]}),io(Oa,"ProgramConfigurationSet");const ja=Li/Math.PI/2,Ga=5,Ha=6,Wa=16383,qa=64,Xa=[qa,32,16],$a=-ja,Ya=ja;function Za(t,e,i,n=ja){return i=x(i),[t*Math.sin(i)*n,-e*n,t*Math.cos(i)*n]}function Ka(t,e,i){return Za(Math.cos(x(t)),Math.sin(x(t)),e,i)}const Ja=6371008.8,Qa=2*Math.PI*Ja;class tl{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new tl(C(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,n=t.lat*e,r=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return Ja*Math.acos(Math.min(r,1))}toBounds(t=0){const e=360*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return new el({lng:this.lng-i,lat:this.lat-e},{lng:this.lng+i,lat:this.lat+e})}toEcef(t){return Ka(this.lat,this.lng,ja+t*ja/Ja)}static convert(t){if(t instanceof tl)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new tl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new tl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class el{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof tl?new tl(t.lng,t.lat):tl.convert(t),this}setSouthWest(t){return this._sw=t instanceof tl?new tl(t.lng,t.lat):tl.convert(t),this}extend(t){const e=this._sw,i=this._ne;let n,r;if(t instanceof tl)n=t,r=t;else{if(!(t instanceof el))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(el.convert(t)):this.extend(tl.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(tl.convert(t)):this;if(n=t._sw,r=t._ne,!n||!r)return this}return e||i?(e.lng=Math.min(n.lng,e.lng),e.lat=Math.min(n.lat,e.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new tl(n.lng,n.lat),this._ne=new tl(r.lng,r.lat)),this}getCenter(){return new tl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new tl(this.getWest(),this.getNorth())}getSouthEast(){return new tl(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:i}=tl.convert(t);let n=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&n}static convert(t){return!t||t instanceof el?t:new el(t)}}var il={};!function(t,e){!function(t){function e(t,e,n){var r=i(256*t,256*(e=Math.pow(2,n)-e-1),n),o=i(256*(t+1),256*(e+1),n);return r[0]+","+r[1]+","+o[0]+","+o[1]}function i(t,e,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}t.getURL=function(t,i,n,r,o,s){return s=s||{},t+"?"+["bbox="+e(n,r,o),"format="+(s.format||"image/png"),"service="+(s.service||"WMS"),"version="+(s.version||"1.1.1"),"request="+(s.request||"GetMap"),"srs="+(s.srs||"EPSG:3857"),"width="+(s.width||256),"height="+(s.height||256),"layers="+i].join("&")},t.getTileBBox=e,t.getMercCoords=i,Object.defineProperty(t,"__esModule",{value:!0})}(e)}(0,il);var nl=il;class rl{constructor(t,e,i){this.z=t,this.x=e,this.y=i,this.key=al(0,t,t,e,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e){const i=nl.getTileBBox(this.x,this.y,this.z),n=function(t,e,i){let n,r="";for(let o=t;o>0;o--)n=1<<o-1,r+=(e&n?1:0)+(i&n?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ol{constructor(t,e){this.wrap=t,this.canonical=e,this.key=al(t,e.z,e.z,e.x,e.y)}}class sl{constructor(t,e,i,n,r){this.overscaledZ=t,this.wrap=e,this.canonical=new rl(i,+n,+r),this.key=0===e&&t===i?this.canonical.key:al(e,t,i,n,r)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new sl(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new sl(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e=!0){if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return al(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-t;return al(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new sl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return[new sl(e,this.wrap,e,i,n),new sl(e,this.wrap,e,i+1,n),new sl(e,this.wrap,e,i,n+1),new sl(e,this.wrap,e,i+1,n+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new sl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new sl(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ol(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function al(t,e,i,n,r){const o=1<<Math.min(i,22);let s=o*(r%o)+n%o;return t&&i<22&&(s+=o*o*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*s+i)+(e-i)}const ll=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new sl(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new sl(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new sl(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new sl(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];io(rl,"CanonicalTileID"),io(sl,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const cl=0,ul=25.5;function hl(t){return Qa*Math.cos(t*Math.PI/180)}function dl(t){return(180+t)/360}function pl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function fl(t,e){return t/hl(e)}function ml(t){return 360*t-180}function gl(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function _l(t,e){return t*hl(gl(e))}const yl=85.051129;function vl(t){return Math.cos(x(M(t,-yl,yl)))}function xl(t,e){const i=M(e,cl,ul),n=Math.pow(2,i);return vl(t)*Qa/(512*n)}function bl(t){return 1/Math.cos(t*Math.PI/180)}function wl(t,e=0){const i=Math.exp(Math.PI*(1-(t.y+e/Li)/(1<<t.z)*2));return 80150034*i/(i*i+1)/Li/(1<<t.z)}class El{constructor(t,e,i=0){this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){const i=tl.convert(t);return new El(dl(i.lng),pl(i.lat),fl(e,i.lat))}toLngLat(){return new tl(ml(this.x),gl(this.y))}toAltitude(){return _l(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Qa*bl(gl(this.y))}}function Sl(t,e,i,n,r,o,s,a,l){const c=(e+n)/2,u=(i+r)/2,h=new _(c,u);a(h),function(t,e,i,n,r,o){const s=i-r,a=n-o;return Math.abs((n-e)*s-(i-t)*a)/Math.hypot(s,a)}(h.x,h.y,o.x,o.y,s.x,s.y)>=l?(Sl(t,e,i,c,u,o,h,a,l),Sl(t,c,u,n,r,h,s,a,l)):t.push(s)}function Tl(t,e,i){let n=t[0],r=n.x,o=n.y;e(n);const s=[n];for(let a=1;a<t.length;a++){const l=t[a],{x:c,y:u}=l;e(l),Sl(s,r,o,c,u,n,l,e,i),r=c,o=u,n=l}return s}function Ml(t,e,i,n){if(n(e,i)){const r=e.add(i)._mult(.5);Ml(t,e,r,n),Ml(t,r,i,n)}else t.push(i)}function Il(t,e){let i=t[0];const n=[i];for(let r=1;r<t.length;r++){const o=t[r];Ml(n,i,o,e),i=o}return n}const Cl=Math.pow(2,14)-1,Al=-Cl-1;function Pl(t,e){const i=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=M(i,Al,Cl),t.y=M(n,Al,Cl),(i<t.x||i>t.x+1||n<t.y||n>t.y+1)&&j("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Ll(t,e,i){const n=t.loadGeometry(),r=t.extent,o=Li/r;if(e&&i&&i.projection.isReprojectedInTileSpace){const o=1<<e.z,{scale:s,x:a,y:l,projection:c}=i,u=t=>{const i=ml((e.x+t.x/r)/o),n=gl((e.y+t.y/r)/o),u=c.project(i,n);t.x=(u.x*s-a)*r,t.y=(u.y*s-l)*r};for(let e=0;e<n.length;e++)if(1!==t.type)n[e]=Tl(n[e],u,1);else{const t=[];for(const i of n[e])i.x<0||i.x>=r||i.y<0||i.y>=r||(u(i),t.push(i));n[e]=t}}for(const t of n)for(const e of t)Pl(e,o);return n}function Rl(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ll(t):[]}}function Dl(t,e,i,n,r){t.emplaceBack(2*e+(n+1)/2,2*i+(r+1)/2)}function kl(t,e,i){const n=16384;t.emplaceBack(e.x,e.y,e.z,i[0]*n,i[1]*n,i[2]*n)}class Nl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new ps,this.indexArray=new Ps,this.segments=new ia,this.programConfigurations=new Oa(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i,n){const r=this.layers[0],o=[];let s=null;"circle"===r.type&&(s=r.layout.get("circle-sort-key"));for(const{feature:e,id:r,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Rl(e,t);if(!this.layers[0]._featureFilter.filter(new Ao(this.zoom),c,i))continue;const u=s?s.evaluate(c,{},i):void 0,h={id:r,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:Ll(e,i,n),patterns:{},sortKey:u};o.push(h)}s&&o.sort(((t,e)=>t.sortKey-e.sortKey));let a=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new bs,a=n.projection);for(const n of o){const{geometry:r,index:o,sourceLayerIndex:s}=n,l=t[o].feature;this.addFeature(n,r,o,e.availableImages,i,a,e.brightness),e.featureIndex.insert(l,r,o,s,this.index)}}update(t,e,i,n,r){const o=0!==Object.keys(t).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,o?this.stateDependentLayers:this.layers,i,n,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ta.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,ea.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,e,i,n,r,o,s){for(const i of e)for(const e of i){const i=e.x,n=e.y;if(i<0||i>=Li||n<0||n>=Li)continue;if(o){const t=o.projectTilePoint(i,n,r),e=o.upVector(r,i,n),s=this.globeExtVertexArray;kl(s,t,e),kl(s,t,e),kl(s,t,e),kl(s,t,e)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),a=s.vertexLength;Dl(this.layoutVertexArray,i,n,-1,-1),Dl(this.layoutVertexArray,i,n,1,-1),Dl(this.layoutVertexArray,i,n,1,1),Dl(this.layoutVertexArray,i,n,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},n,r,s)}}function Ol(t,e){for(let i=0;i<t.length;i++)if(Wl(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Wl(t,e[i]))return!0;return!!Ul(t,e)}function Fl(t,e,i){return!!Wl(t,e)||!!jl(e,t,i)}function zl(t,e){if(1===t.length)return Hl(e,t[0]);for(let i=0;i<e.length;i++){const n=e[i];for(let e=0;e<n.length;e++)if(Wl(t,n[e]))return!0}for(let i=0;i<t.length;i++)if(Hl(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Ul(t,e[i]))return!0;return!1}function Bl(t,e,i){if(t.length>1){if(Ul(t,e))return!0;for(let n=0;n<e.length;n++)if(jl(e[n],t,i))return!0}for(let n=0;n<t.length;n++)if(jl(t[n],e,i))return!0;return!1}function Ul(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const n=t[i],r=t[i+1];for(let t=0;t<e.length-1;t++)if(Vl(n,r,e[t],e[t+1]))return!0}return!1}function Vl(t,e,i,n){return G(t,i,n)!==G(e,i,n)&&G(t,e,i)!==G(t,e,n)}function jl(t,e,i){const n=i*i;if(1===e.length)return t.distSqr(e[0])<n;for(let i=1;i<e.length;i++)if(Gl(t,e[i-1],e[i])<n)return!0;return!1}function Gl(t,e,i){const n=e.distSqr(i);if(0===n)return t.distSqr(e);const r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return t.distSqr(r<0?e:r>1?i:i.sub(e)._mult(r)._add(e))}function Hl(t,e){let i,n,r,o=!1;for(let s=0;s<t.length;s++){i=t[s];for(let t=0,s=i.length-1;t<i.length;s=t++)n=i[t],r=i[s],n.y>e.y!=r.y>e.y&&e.x<(r.x-n.x)*(e.y-n.y)/(r.y-n.y)+n.x&&(o=!o)}return o}function Wl(t,e){let i=!1;for(let n=0,r=t.length-1;n<t.length;r=n++){const o=t[n],s=t[r];o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function ql(t,e,i,n,r){for(const o of t)if(e<=o.x&&i<=o.y&&n>=o.x&&r>=o.y)return!0;const o=[new _(e,i),new _(e,r),new _(n,r),new _(n,i)];if(t.length>2)for(const e of o)if(Wl(t,e))return!0;for(let e=0;e<t.length-1;e++)if(Xl(t[e],t[e+1],o))return!0;return!1}function Xl(t,e,i){const n=i[0],r=i[2];if(t.x<n.x&&e.x<n.x||t.x>r.x&&e.x>r.x||t.y<n.y&&e.y<n.y||t.y>r.y&&e.y>r.y)return!1;const o=G(t,e,i[0]);return o!==G(t,e,i[1])||o!==G(t,e,i[2])||o!==G(t,e,i[3])}function $l(t,e,i,n,r,o){let s=e.y-t.y,a=t.x-e.x;if(o=o||0){const t=s*s+a*a;if(0===t)return!0;const e=Math.sqrt(t);s/=e,a/=e}return!((i.x-t.x)*s+(i.y-t.y)*a-o<0||(n.x-t.x)*s+(n.y-t.y)*a-o<0||(r.x-t.x)*s+(r.y-t.y)*a-o<0)}function Yl(t,e,i,n,r,o,s){return!($l(t,e,n,r,o,s)||$l(e,i,n,r,o,s)||$l(i,t,n,r,o,s)||$l(n,r,t,e,i,s)||$l(r,o,t,e,i,s)||$l(o,n,t,e,i,s))}function Zl(t,e,i){const n=e.paint.get(t).value;return"constant"===n.kind?n.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Kl(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Jl(t,e,i,n,r){if(!e[0]&&!e[1])return t;const o=_.convert(e)._mult(r);"viewport"===i&&o._rotate(-n);const s=[];for(let e=0;e<t.length;e++)s.push(t[e].sub(o));return s}function Ql(t,e,i,n){const r=_.convert(t)._mult(n);return"viewport"===e&&r._rotate(-i),r}io(Nl,"CircleBucket",{omit:["layers"]});const tc=new Vo({"circle-sort-key":new Bo(Ho.layout_circle["circle-sort-key"]),visibility:new zo(Ho.layout_circle.visibility)});var ec={paint:new Vo({"circle-radius":new Bo(Ho.paint_circle["circle-radius"]),"circle-color":new Bo(Ho.paint_circle["circle-color"]),"circle-blur":new Bo(Ho.paint_circle["circle-blur"]),"circle-opacity":new Bo(Ho.paint_circle["circle-opacity"]),"circle-translate":new zo(Ho.paint_circle["circle-translate"]),"circle-translate-anchor":new zo(Ho.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zo(Ho.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zo(Ho.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Bo(Ho.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Bo(Ho.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Bo(Ho.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new zo(Ho.paint_circle["circle-emissive-strength"])}),layout:tc},ic={},nc={};Object.defineProperty(nc,"__esModule",{value:!0}),nc.setMatrixArrayType=function(t){nc.ARRAY_TYPE=oc=t},nc.toRadian=function(t){return t*ac},nc.equals=function(t,e){return Math.abs(t-e)<=rc*Math.max(1,Math.abs(t),Math.abs(e))},nc.RANDOM=nc.ARRAY_TYPE=nc.EPSILON=void 0;var rc=1e-6;nc.EPSILON=rc;var oc="undefined"!=typeof Float32Array?Float32Array:Array;nc.ARRAY_TYPE=oc;var sc=Math.random;nc.RANDOM=sc;var ac=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var lc={};function cc(t){return cc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cc(t)}Object.defineProperty(lc,"__esModule",{value:!0}),lc.create=function(){var t=new uc.ARRAY_TYPE(4);return uc.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},lc.clone=function(t){var e=new uc.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},lc.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},lc.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},lc.fromValues=function(t,e,i,n){var r=new uc.ARRAY_TYPE(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r},lc.set=function(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t},lc.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},lc.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i*o-r*n;return s?(t[0]=o*(s=1/s),t[1]=-n*s,t[2]=-r*s,t[3]=i*s,t):null},lc.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},lc.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},lc.multiply=dc,lc.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+o*a,t[1]=r*l+s*a,t[2]=n*-a+o*l,t[3]=r*-a+s*l,t},lc.scale=function(t,e,i){var n=e[1],r=e[2],o=e[3],s=i[0],a=i[1];return t[0]=e[0]*s,t[1]=n*s,t[2]=r*a,t[3]=o*a,t},lc.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t},lc.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},lc.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},lc.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},lc.LDU=function(t,e,i,n){return t[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-t[2]*i[1],[t,e,i]},lc.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},lc.subtract=pc,lc.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},lc.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=e[0],a=e[1],l=e[2],c=e[3];return Math.abs(i-s)<=uc.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-a)<=uc.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-l)<=uc.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-c)<=uc.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},lc.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},lc.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},lc.sub=lc.mul=void 0;var uc=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==cc(t)&&"function"!=typeof t)return{default:t};var i=hc(void 0);if(i&&i.has(t))return i.get(t);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=r?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=t[o]}return n.default=t,i&&i.set(t,n),n}(nc);function hc(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(hc=function(t){return t?i:e})(t)}function dc(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=n*a+o*l,t[1]=r*a+s*l,t[2]=n*c+o*u,t[3]=r*c+s*u,t}function pc(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}lc.mul=dc,lc.sub=pc;var fc={};function mc(t){return mc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mc(t)}Object.defineProperty(fc,"__esModule",{value:!0}),fc.create=function(){var t=new gc.ARRAY_TYPE(6);return gc.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},fc.clone=function(t){var e=new gc.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},fc.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},fc.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},fc.fromValues=function(t,e,i,n,r,o){var s=new gc.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=i,s[3]=n,s[4]=r,s[5]=o,s},fc.set=function(t,e,i,n,r,o,s){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=s,t},fc.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=i*o-n*r;return l?(t[0]=o*(l=1/l),t[1]=-n*l,t[2]=-r*l,t[3]=i*l,t[4]=(r*a-o*s)*l,t[5]=(n*s-i*a)*l,t):null},fc.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},fc.multiply=yc,fc.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=Math.sin(i),u=Math.cos(i);return t[0]=n*u+o*c,t[1]=r*u+s*c,t[2]=n*-c+o*u,t[3]=r*-c+s*u,t[4]=a,t[5]=l,t},fc.scale=function(t,e,i){var n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=i[0],c=i[1];return t[0]=e[0]*l,t[1]=n*l,t[2]=r*c,t[3]=o*c,t[4]=s,t[5]=a,t},fc.translate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=n*c+o*u+a,t[5]=r*c+s*u+l,t},fc.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t[4]=0,t[5]=0,t},fc.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},fc.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},fc.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},fc.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},fc.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},fc.subtract=vc,fc.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},fc.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t},fc.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},fc.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=e[0],c=e[1],u=e[2],h=e[3],d=e[4],p=e[5];return Math.abs(i-l)<=gc.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-c)<=gc.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-u)<=gc.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(o-h)<=gc.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-d)<=gc.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-p)<=gc.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))},fc.sub=fc.mul=void 0;var gc=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==mc(t)&&"function"!=typeof t)return{default:t};var i=_c(void 0);if(i&&i.has(t))return i.get(t);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=r?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=t[o]}return n.default=t,i&&i.set(t,n),n}(nc);function _c(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(_c=function(t){return t?i:e})(t)}function yc(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=i[0],u=i[1],h=i[2],d=i[3],p=i[4],f=i[5];return t[0]=n*c+o*u,t[1]=r*c+s*u,t[2]=n*h+o*d,t[3]=r*h+s*d,t[4]=n*p+o*f+a,t[5]=r*p+s*f+l,t}function vc(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}fc.mul=yc,fc.sub=vc;var xc={};function bc(t){return bc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bc(t)}Object.defineProperty(xc,"__esModule",{value:!0}),xc.create=function(){var t=new wc.ARRAY_TYPE(9);return wc.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},xc.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},xc.clone=function(t){var e=new wc.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},xc.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},xc.fromValues=function(t,e,i,n,r,o,s,a,l){var c=new wc.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=n,c[4]=r,c[5]=o,c[6]=s,c[7]=a,c[8]=l,c},xc.set=function(t,e,i,n,r,o,s,a,l,c){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t[8]=c,t},xc.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},xc.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},xc.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*s-a*c,d=-u*o+a*l,p=c*o-s*l,f=i*h+n*d+r*p;return f?(t[0]=h*(f=1/f),t[1]=(-u*n+r*c)*f,t[2]=(a*n-r*s)*f,t[3]=d*f,t[4]=(u*i-r*l)*f,t[5]=(-a*i+r*o)*f,t[6]=p*f,t[7]=(-c*i+n*l)*f,t[8]=(s*i-n*o)*f,t):null},xc.adjoint=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=s*u-a*c,t[1]=r*c-n*u,t[2]=n*a-r*s,t[3]=a*l-o*u,t[4]=i*u-r*l,t[5]=r*o-i*a,t[6]=o*c-s*l,t[7]=n*l-i*c,t[8]=i*s-n*o,t},xc.determinant=function(t){var e=t[3],i=t[4],n=t[5],r=t[6],o=t[7],s=t[8];return t[0]*(s*i-n*o)+t[1]*(-s*e+n*r)+t[2]*(o*e-i*r)},xc.multiply=Sc,xc.translate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=i[0],p=i[1];return t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=d*n+p*s+c,t[7]=d*r+p*a+u,t[8]=d*o+p*l+h,t},xc.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=Math.sin(i),p=Math.cos(i);return t[0]=p*n+d*s,t[1]=p*r+d*a,t[2]=p*o+d*l,t[3]=p*s-d*n,t[4]=p*a-d*r,t[5]=p*l-d*o,t[6]=c,t[7]=u,t[8]=h,t},xc.scale=function(t,e,i){var n=i[0],r=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},xc.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},xc.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},xc.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},xc.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},xc.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i+i,a=n+n,l=r+r,c=i*s,u=n*s,h=n*a,d=r*s,p=r*a,f=r*l,m=o*s,g=o*a,_=o*l;return t[0]=1-h-f,t[3]=u-_,t[6]=d+g,t[1]=u+_,t[4]=1-c-f,t[7]=p-m,t[2]=d-g,t[5]=p+m,t[8]=1-c-h,t},xc.normalFromMat4=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=i*a-n*s,v=i*l-r*s,x=i*c-o*s,b=n*l-r*a,w=n*c-o*a,E=r*c-o*l,S=u*m-h*f,T=u*g-d*f,M=u*_-p*f,I=h*g-d*m,C=h*_-p*m,A=d*_-p*g,P=y*A-v*C+x*I+b*M-w*T+E*S;return P?(t[0]=(a*A-l*C+c*I)*(P=1/P),t[1]=(l*M-s*A-c*T)*P,t[2]=(s*C-a*M+c*S)*P,t[3]=(r*C-n*A-o*I)*P,t[4]=(i*A-r*M+o*T)*P,t[5]=(n*M-i*C-o*S)*P,t[6]=(m*E-g*w+_*b)*P,t[7]=(g*x-f*E-_*v)*P,t[8]=(f*w-m*x+_*y)*P,t):null},xc.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},xc.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},xc.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},xc.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},xc.subtract=Tc,xc.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},xc.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t},xc.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},xc.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=e[0],d=e[1],p=e[2],f=e[3],m=e[4],g=e[5],_=e[6],y=e[7],v=e[8];return Math.abs(i-h)<=wc.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-d)<=wc.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(r-p)<=wc.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(o-f)<=wc.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-m)<=wc.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-g)<=wc.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-_)<=wc.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-y)<=wc.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-v)<=wc.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))},xc.sub=xc.mul=void 0;var wc=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==bc(t)&&"function"!=typeof t)return{default:t};var i=Ec(void 0);if(i&&i.has(t))return i.get(t);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=r?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=t[o]}return n.default=t,i&&i.set(t,n),n}(nc);function Ec(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(Ec=function(t){return t?i:e})(t)}function Sc(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=i[0],p=i[1],f=i[2],m=i[3],g=i[4],_=i[5],y=i[6],v=i[7],x=i[8];return t[0]=d*n+p*s+f*c,t[1]=d*r+p*a+f*u,t[2]=d*o+p*l+f*h,t[3]=m*n+g*s+_*c,t[4]=m*r+g*a+_*u,t[5]=m*o+g*l+_*h,t[6]=y*n+v*s+x*c,t[7]=y*r+v*a+x*u,t[8]=y*o+v*l+x*h,t}function Tc(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}xc.mul=Sc,xc.sub=Tc;var Mc={};function Ic(t){return Ic="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ic(t)}Object.defineProperty(Mc,"__esModule",{value:!0}),Mc.create=function(){var t=new Cc.ARRAY_TYPE(16);return Cc.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Mc.clone=function(t){var e=new Cc.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Mc.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Mc.fromValues=function(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m){var g=new Cc.ARRAY_TYPE(16);return g[0]=t,g[1]=e,g[2]=i,g[3]=n,g[4]=r,g[5]=o,g[6]=s,g[7]=a,g[8]=l,g[9]=c,g[10]=u,g[11]=h,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g},Mc.set=function(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=h,t[11]=d,t[12]=p,t[13]=f,t[14]=m,t[15]=g,t},Mc.identity=Pc,Mc.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],r=e[3],o=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=r,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Mc.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=i*a-n*s,v=i*l-r*s,x=i*c-o*s,b=n*l-r*a,w=n*c-o*a,E=r*c-o*l,S=u*m-h*f,T=u*g-d*f,M=u*_-p*f,I=h*g-d*m,C=h*_-p*m,A=d*_-p*g,P=y*A-v*C+x*I+b*M-w*T+E*S;return P?(t[0]=(a*A-l*C+c*I)*(P=1/P),t[1]=(r*C-n*A-o*I)*P,t[2]=(m*E-g*w+_*b)*P,t[3]=(d*w-h*E-p*b)*P,t[4]=(l*M-s*A-c*T)*P,t[5]=(i*A-r*M+o*T)*P,t[6]=(g*x-f*E-_*v)*P,t[7]=(u*E-d*x+p*v)*P,t[8]=(s*C-a*M+c*S)*P,t[9]=(n*M-i*C-o*S)*P,t[10]=(f*w-m*x+_*y)*P,t[11]=(h*x-u*w-p*y)*P,t[12]=(a*T-s*I-l*S)*P,t[13]=(i*I-n*T+r*S)*P,t[14]=(m*v-f*b-g*y)*P,t[15]=(u*b-h*v+d*y)*P,t):null},Mc.adjoint=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15];return t[0]=a*(d*_-p*g)-h*(l*_-c*g)+m*(l*p-c*d),t[1]=-(n*(d*_-p*g)-h*(r*_-o*g)+m*(r*p-o*d)),t[2]=n*(l*_-c*g)-a*(r*_-o*g)+m*(r*c-o*l),t[3]=-(n*(l*p-c*d)-a*(r*p-o*d)+h*(r*c-o*l)),t[4]=-(s*(d*_-p*g)-u*(l*_-c*g)+f*(l*p-c*d)),t[5]=i*(d*_-p*g)-u*(r*_-o*g)+f*(r*p-o*d),t[6]=-(i*(l*_-c*g)-s*(r*_-o*g)+f*(r*c-o*l)),t[7]=i*(l*p-c*d)-s*(r*p-o*d)+u*(r*c-o*l),t[8]=s*(h*_-p*m)-u*(a*_-c*m)+f*(a*p-c*h),t[9]=-(i*(h*_-p*m)-u*(n*_-o*m)+f*(n*p-o*h)),t[10]=i*(a*_-c*m)-s*(n*_-o*m)+f*(n*c-o*a),t[11]=-(i*(a*p-c*h)-s*(n*p-o*h)+u*(n*c-o*a)),t[12]=-(s*(h*g-d*m)-u*(a*g-l*m)+f*(a*d-l*h)),t[13]=i*(h*g-d*m)-u*(n*g-r*m)+f*(n*d-r*h),t[14]=-(i*(a*g-l*m)-s*(n*g-r*m)+f*(n*l-r*a)),t[15]=i*(a*d-l*h)-s*(n*d-r*h)+u*(n*l-r*a),t},Mc.determinant=function(t){var e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15];return(e*s-i*o)*(h*g-d*m)-(e*a-n*o)*(u*g-d*f)+(e*l-r*o)*(u*m-h*f)+(i*a-n*s)*(c*g-d*p)-(i*l-r*s)*(c*m-h*p)+(n*l-r*a)*(c*f-u*p)},Mc.multiply=Lc,Mc.translate=function(t,e,i){var n,r,o,s,a,l,c,u,h,d,p,f,m=i[0],g=i[1],_=i[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*_+e[12],t[13]=e[1]*m+e[5]*g+e[9]*_+e[13],t[14]=e[2]*m+e[6]*g+e[10]*_+e[14],t[15]=e[3]*m+e[7]*g+e[11]*_+e[15]):(r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=n=e[0],t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=n*m+a*g+h*_+e[12],t[13]=r*m+l*g+d*_+e[13],t[14]=o*m+c*g+p*_+e[14],t[15]=s*m+u*g+f*_+e[15]),t},Mc.scale=function(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Mc.rotate=function(t,e,i,n){var r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,E,S,T,M,I,C=n[0],A=n[1],P=n[2],L=Math.hypot(C,A,P);return L<Cc.EPSILON?null:(C*=L=1/L,A*=L,P*=L,r=Math.sin(i),o=Math.cos(i),l=e[1],c=e[2],u=e[3],d=e[5],p=e[6],f=e[7],g=e[9],_=e[10],y=e[11],v=C*C*(s=1-o)+o,w=C*A*s-P*r,E=A*A*s+o,S=P*A*s+C*r,T=C*P*s+A*r,M=A*P*s-C*r,I=P*P*s+o,t[0]=(a=e[0])*v+(h=e[4])*(x=A*C*s+P*r)+(m=e[8])*(b=P*C*s-A*r),t[1]=l*v+d*x+g*b,t[2]=c*v+p*x+_*b,t[3]=u*v+f*x+y*b,t[4]=a*w+h*E+m*S,t[5]=l*w+d*E+g*S,t[6]=c*w+p*E+_*S,t[7]=u*w+f*E+y*S,t[8]=a*T+h*M+m*I,t[9]=l*T+d*M+g*I,t[10]=c*T+p*M+_*I,t[11]=u*T+f*M+y*I,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Mc.rotateX=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+c*n,t[5]=s*r+u*n,t[6]=a*r+h*n,t[7]=l*r+d*n,t[8]=c*r-o*n,t[9]=u*r-s*n,t[10]=h*r-a*n,t[11]=d*r-l*n,t},Mc.rotateY=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-c*n,t[1]=s*r-u*n,t[2]=a*r-h*n,t[3]=l*r-d*n,t[8]=o*n+c*r,t[9]=s*n+u*r,t[10]=a*n+h*r,t[11]=l*n+d*r,t},Mc.rotateZ=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+c*n,t[1]=s*r+u*n,t[2]=a*r+h*n,t[3]=l*r+d*n,t[4]=c*r-o*n,t[5]=u*r-s*n,t[6]=h*r-a*n,t[7]=d*r-l*n,t},Mc.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Mc.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mc.fromRotation=function(t,e,i){var n,r,o,s=i[0],a=i[1],l=i[2],c=Math.hypot(s,a,l);return c<Cc.EPSILON?null:(s*=c=1/c,a*=c,l*=c,n=Math.sin(e),r=Math.cos(e),t[0]=s*s*(o=1-r)+r,t[1]=a*s*o+l*n,t[2]=l*s*o-a*n,t[3]=0,t[4]=s*a*o-l*n,t[5]=a*a*o+r,t[6]=l*a*o+s*n,t[7]=0,t[8]=s*l*o+a*n,t[9]=a*l*o-s*n,t[10]=l*l*o+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Mc.fromXRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mc.fromYRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mc.fromZRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mc.fromRotationTranslation=Rc,Mc.fromQuat2=function(t,e){var i=new Cc.ARRAY_TYPE(3),n=-e[0],r=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=n*n+r*r+o*o+s*s;return h>0?(i[0]=2*(a*s+u*n+l*o-c*r)/h,i[1]=2*(l*s+u*r+c*n-a*o)/h,i[2]=2*(c*s+u*o+a*r-l*n)/h):(i[0]=2*(a*s+u*n+l*o-c*r),i[1]=2*(l*s+u*r+c*n-a*o),i[2]=2*(c*s+u*o+a*r-l*n)),Rc(t,e,i),t},Mc.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Mc.getScaling=Dc,Mc.getRotation=function(t,e){var i=new Cc.ARRAY_TYPE(3);Dc(i,e);var n=1/i[0],r=1/i[1],o=1/i[2],s=e[0]*n,a=e[1]*r,l=e[2]*o,c=e[4]*n,u=e[5]*r,h=e[6]*o,d=e[8]*n,p=e[9]*r,f=e[10]*o,m=s+u+f,g=0;return m>0?(g=2*Math.sqrt(m+1),t[3]=.25*g,t[0]=(h-p)/g,t[1]=(d-l)/g,t[2]=(a-c)/g):s>u&&s>f?(g=2*Math.sqrt(1+s-u-f),t[3]=(h-p)/g,t[0]=.25*g,t[1]=(a+c)/g,t[2]=(d+l)/g):u>f?(g=2*Math.sqrt(1+u-s-f),t[3]=(d-l)/g,t[0]=(a+c)/g,t[1]=.25*g,t[2]=(h+p)/g):(g=2*Math.sqrt(1+f-s-u),t[3]=(a-c)/g,t[0]=(d+l)/g,t[1]=(h+p)/g,t[2]=.25*g),t},Mc.fromRotationTranslationScale=function(t,e,i,n){var r=e[0],o=e[1],s=e[2],a=e[3],l=r+r,c=o+o,u=s+s,h=r*l,d=r*c,p=r*u,f=o*c,m=o*u,g=s*u,_=a*l,y=a*c,v=a*u,x=n[0],b=n[1],w=n[2];return t[0]=(1-(f+g))*x,t[1]=(d+v)*x,t[2]=(p-y)*x,t[3]=0,t[4]=(d-v)*b,t[5]=(1-(h+g))*b,t[6]=(m+_)*b,t[7]=0,t[8]=(p+y)*w,t[9]=(m-_)*w,t[10]=(1-(h+f))*w,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},Mc.fromRotationTranslationScaleOrigin=function(t,e,i,n,r){var o=e[0],s=e[1],a=e[2],l=e[3],c=o+o,u=s+s,h=a+a,d=o*c,p=o*u,f=o*h,m=s*u,g=s*h,_=a*h,y=l*c,v=l*u,x=l*h,b=n[0],w=n[1],E=n[2],S=r[0],T=r[1],M=r[2],I=(1-(m+_))*b,C=(p+x)*b,A=(f-v)*b,P=(p-x)*w,L=(1-(d+_))*w,R=(g+y)*w,D=(f+v)*E,k=(g-y)*E,N=(1-(d+m))*E;return t[0]=I,t[1]=C,t[2]=A,t[3]=0,t[4]=P,t[5]=L,t[6]=R,t[7]=0,t[8]=D,t[9]=k,t[10]=N,t[11]=0,t[12]=i[0]+S-(I*S+P*T+D*M),t[13]=i[1]+T-(C*S+L*T+k*M),t[14]=i[2]+M-(A*S+R*T+N*M),t[15]=1,t},Mc.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i+i,a=n+n,l=r+r,c=i*s,u=n*s,h=n*a,d=r*s,p=r*a,f=r*l,m=o*s,g=o*a,_=o*l;return t[0]=1-h-f,t[1]=u+_,t[2]=d-g,t[3]=0,t[4]=u-_,t[5]=1-c-f,t[6]=p+m,t[7]=0,t[8]=d+g,t[9]=p-m,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mc.frustum=function(t,e,i,n,r,o,s){var a=1/(i-e),l=1/(r-n),c=1/(o-s);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(r+n)*l,t[10]=(s+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*c,t[15]=0,t},Mc.perspectiveNO=kc,Mc.perspectiveZO=function(t,e,i,n,r){var o,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=r*(o=1/(n-r)),t[14]=r*n*o):(t[10]=-1,t[14]=-n),t},Mc.perspectiveFromFieldOfView=function(t,e,i,n){var r=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(s+a),c=2/(r+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(s-a)*l*.5,t[9]=(r-o)*c*.5,t[10]=n/(i-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*i/(i-n),t[15]=0,t},Mc.orthoNO=Nc,Mc.orthoZO=function(t,e,i,n,r,o,s){var a=1/(e-i),l=1/(n-r),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*l,t[14]=o*c,t[15]=1,t},Mc.lookAt=function(t,e,i,n){var r,o,s,a,l,c,u,h,d,p,f=e[0],m=e[1],g=e[2],_=n[0],y=n[1],v=n[2],x=i[0],b=i[1],w=i[2];return Math.abs(f-x)<Cc.EPSILON&&Math.abs(m-b)<Cc.EPSILON&&Math.abs(g-w)<Cc.EPSILON?Pc(t):(u=f-x,h=m-b,d=g-w,r=y*(d*=p=1/Math.hypot(u,h,d))-v*(h*=p),o=v*(u*=p)-_*d,s=_*h-y*u,(p=Math.hypot(r,o,s))?(r*=p=1/p,o*=p,s*=p):(r=0,o=0,s=0),a=h*s-d*o,l=d*r-u*s,c=u*o-h*r,(p=Math.hypot(a,l,c))?(a*=p=1/p,l*=p,c*=p):(a=0,l=0,c=0),t[0]=r,t[1]=a,t[2]=u,t[3]=0,t[4]=o,t[5]=l,t[6]=h,t[7]=0,t[8]=s,t[9]=c,t[10]=d,t[11]=0,t[12]=-(r*f+o*m+s*g),t[13]=-(a*f+l*m+c*g),t[14]=-(u*f+h*m+d*g),t[15]=1,t)},Mc.targetTo=function(t,e,i,n){var r=e[0],o=e[1],s=e[2],a=n[0],l=n[1],c=n[2],u=r-i[0],h=o-i[1],d=s-i[2],p=u*u+h*h+d*d;p>0&&(u*=p=1/Math.sqrt(p),h*=p,d*=p);var f=l*d-c*h,m=c*u-a*d,g=a*h-l*u;return(p=f*f+m*m+g*g)>0&&(f*=p=1/Math.sqrt(p),m*=p,g*=p),t[0]=f,t[1]=m,t[2]=g,t[3]=0,t[4]=h*g-d*m,t[5]=d*f-u*g,t[6]=u*m-h*f,t[7]=0,t[8]=u,t[9]=h,t[10]=d,t[11]=0,t[12]=r,t[13]=o,t[14]=s,t[15]=1,t},Mc.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Mc.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Mc.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},Mc.subtract=Oc,Mc.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},Mc.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t[9]=e[9]+i[9]*n,t[10]=e[10]+i[10]*n,t[11]=e[11]+i[11]*n,t[12]=e[12]+i[12]*n,t[13]=e[13]+i[13]*n,t[14]=e[14]+i[14]*n,t[15]=e[15]+i[15]*n,t},Mc.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Mc.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=e[0],v=e[1],x=e[2],b=e[3],w=e[4],E=e[5],S=e[6],T=e[7],M=e[8],I=e[9],C=e[10],A=e[11],P=e[12],L=e[13],R=e[14],D=e[15];return Math.abs(i-y)<=Cc.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(n-v)<=Cc.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-x)<=Cc.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(o-b)<=Cc.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-w)<=Cc.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-E)<=Cc.EPSILON*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(l-S)<=Cc.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-T)<=Cc.EPSILON*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-M)<=Cc.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(h-I)<=Cc.EPSILON*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(d-C)<=Cc.EPSILON*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(p-A)<=Cc.EPSILON*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(f-P)<=Cc.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-L)<=Cc.EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(g-R)<=Cc.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(_-D)<=Cc.EPSILON*Math.max(1,Math.abs(_),Math.abs(D))},Mc.sub=Mc.mul=Mc.ortho=Mc.perspective=void 0;var Cc=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Ic(t)&&"function"!=typeof t)return{default:t};var i=Ac(void 0);if(i&&i.has(t))return i.get(t);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=r?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=t[o]}return n.default=t,i&&i.set(t,n),n}(nc);function Ac(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(Ac=function(t){return t?i:e})(t)}function Pc(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Lc(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],_=e[14],y=e[15],v=i[0],x=i[1],b=i[2],w=i[3];return t[0]=v*n+x*a+b*h+w*m,t[1]=v*r+x*l+b*d+w*g,t[2]=v*o+x*c+b*p+w*_,t[3]=v*s+x*u+b*f+w*y,t[4]=(v=i[4])*n+(x=i[5])*a+(b=i[6])*h+(w=i[7])*m,t[5]=v*r+x*l+b*d+w*g,t[6]=v*o+x*c+b*p+w*_,t[7]=v*s+x*u+b*f+w*y,t[8]=(v=i[8])*n+(x=i[9])*a+(b=i[10])*h+(w=i[11])*m,t[9]=v*r+x*l+b*d+w*g,t[10]=v*o+x*c+b*p+w*_,t[11]=v*s+x*u+b*f+w*y,t[12]=(v=i[12])*n+(x=i[13])*a+(b=i[14])*h+(w=i[15])*m,t[13]=v*r+x*l+b*d+w*g,t[14]=v*o+x*c+b*p+w*_,t[15]=v*s+x*u+b*f+w*y,t}function Rc(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=n+n,l=r+r,c=o+o,u=n*a,h=n*l,d=n*c,p=r*l,f=r*c,m=o*c,g=s*a,_=s*l,y=s*c;return t[0]=1-(p+m),t[1]=h+y,t[2]=d-_,t[3]=0,t[4]=h-y,t[5]=1-(u+m),t[6]=f+g,t[7]=0,t[8]=d+_,t[9]=f-g,t[10]=1-(u+p),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Dc(t,e){var i=e[4],n=e[5],r=e[6],o=e[8],s=e[9],a=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,n,r),t[2]=Math.hypot(o,s,a),t}function kc(t,e,i,n,r){var o,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=(r+n)*(o=1/(n-r)),t[14]=2*r*n*o):(t[10]=-1,t[14]=-2*n),t}function Nc(t,e,i,n,r,o,s){var a=1/(e-i),l=1/(n-r),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*l,t[14]=(s+o)*c,t[15]=1,t}function Oc(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}Mc.perspective=kc,Mc.ortho=Nc,Mc.mul=Lc,Mc.sub=Oc;var Fc={},zc={};function Bc(t){return Bc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bc(t)}Object.defineProperty(zc,"__esModule",{value:!0}),zc.create=jc,zc.clone=function(t){var e=new Uc.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},zc.length=Gc,zc.fromValues=function(t,e,i){var n=new Uc.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=i,n},zc.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},zc.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},zc.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},zc.subtract=Hc,zc.multiply=Wc,zc.divide=qc,zc.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},zc.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},zc.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},zc.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},zc.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},zc.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},zc.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t},zc.distance=Xc,zc.squaredDistance=$c,zc.squaredLength=Yc,zc.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},zc.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},zc.normalize=function(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},zc.dot=Zc,zc.cross=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],l=i[2];return t[0]=r*l-o*a,t[1]=o*s-n*l,t[2]=n*a-r*s,t},zc.lerp=function(t,e,i,n){var r=e[0],o=e[1],s=e[2];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t[2]=s+n*(i[2]-s),t},zc.hermite=function(t,e,i,n,r,o){var s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,c=s*(o-1),u=s*(3-2*o);return t[0]=e[0]*a+i[0]*l+n[0]*c+r[0]*u,t[1]=e[1]*a+i[1]*l+n[1]*c+r[1]*u,t[2]=e[2]*a+i[2]*l+n[2]*c+r[2]*u,t},zc.bezier=function(t,e,i,n,r,o){var s=1-o,a=s*s,l=o*o,c=a*s,u=3*o*a,h=3*l*s,d=l*o;return t[0]=e[0]*c+i[0]*u+n[0]*h+r[0]*d,t[1]=e[1]*c+i[1]*u+n[1]*h+r[1]*d,t[2]=e[2]*c+i[2]*u+n[2]*h+r[2]*d,t},zc.random=function(t,e){e=e||1;var i=2*Uc.RANDOM()*Math.PI,n=2*Uc.RANDOM()-1,r=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*r,t[1]=Math.sin(i)*r,t[2]=n*e,t},zc.transformMat4=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[3]*n+i[7]*r+i[11]*o+i[15];return t[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/(s=s||1),t[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/s,t[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/s,t},zc.transformMat3=function(t,e,i){var n=e[0],r=e[1],o=e[2];return t[0]=n*i[0]+r*i[3]+o*i[6],t[1]=n*i[1]+r*i[4]+o*i[7],t[2]=n*i[2]+r*i[5]+o*i[8],t},zc.transformQuat=function(t,e,i){var n=i[0],r=i[1],o=i[2],s=e[0],a=e[1],l=e[2],c=r*l-o*a,u=o*s-n*l,h=n*a-r*s,d=r*h-o*u,p=o*c-n*h,f=n*u-r*c,m=2*i[3];return u*=m,h*=m,p*=2,f*=2,t[0]=s+(c*=m)+(d*=2),t[1]=a+u+p,t[2]=l+h+f,t},zc.rotateX=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0],o[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),o[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},zc.rotateY=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),o[1]=r[1],o[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},zc.rotateZ=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),o[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),o[2]=r[2],t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},zc.angle=function(t,e){var i=t[0],n=t[1],r=t[2],o=e[0],s=e[1],a=e[2],l=Math.sqrt(i*i+n*n+r*r)*Math.sqrt(o*o+s*s+a*a),c=l&&Zc(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))},zc.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},zc.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},zc.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},zc.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=e[0],s=e[1],a=e[2];return Math.abs(i-o)<=Uc.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-s)<=Uc.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=Uc.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))},zc.forEach=zc.sqrLen=zc.len=zc.sqrDist=zc.dist=zc.div=zc.mul=zc.sub=void 0;var Uc=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Bc(t)&&"function"!=typeof t)return{default:t};var i=Vc(void 0);if(i&&i.has(t))return i.get(t);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=r?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=t[o]}return n.default=t,i&&i.set(t,n),n}(nc);function Vc(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(Vc=function(t){return t?i:e})(t)}function jc(){var t=new Uc.ARRAY_TYPE(3);return Uc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Gc(t){return Math.hypot(t[0],t[1],t[2])}function Hc(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Wc(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function qc(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function Xc(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function $c(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return i*i+n*n+r*r}function Yc(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n}function Zc(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}zc.sub=Hc,zc.mul=Wc,zc.div=qc,zc.dist=Xc,zc.sqrDist=$c,zc.len=Gc,zc.sqrLen=Yc;var Kc,Jc=(Kc=jc(),function(t,e,i,n,r,o){var s,a;for(e||(e=3),i||(i=0),a=n?Math.min(n*e+i,t.length):t.length,s=i;s<a;s+=e)Kc[0]=t[s],Kc[1]=t[s+1],Kc[2]=t[s+2],r(Kc,Kc,o),t[s]=Kc[0],t[s+1]=Kc[1],t[s+2]=Kc[2];return t});zc.forEach=Jc;var Qc={};function tu(t){return tu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tu(t)}Object.defineProperty(Qc,"__esModule",{value:!0}),Qc.create=nu,Qc.clone=function(t){var e=new eu.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Qc.fromValues=function(t,e,i,n){var r=new eu.ARRAY_TYPE(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r},Qc.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Qc.set=function(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t},Qc.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Qc.subtract=ru,Qc.multiply=ou,Qc.divide=su,Qc.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Qc.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Qc.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},Qc.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},Qc.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Qc.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Qc.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},Qc.distance=au,Qc.squaredDistance=lu,Qc.length=cu,Qc.squaredLength=uu,Qc.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Qc.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Qc.normalize=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i*i+n*n+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=i*s,t[1]=n*s,t[2]=r*s,t[3]=o*s,t},Qc.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Qc.cross=function(t,e,i,n){var r=i[0]*n[1]-i[1]*n[0],o=i[0]*n[2]-i[2]*n[0],s=i[0]*n[3]-i[3]*n[0],a=i[1]*n[2]-i[2]*n[1],l=i[1]*n[3]-i[3]*n[1],c=i[2]*n[3]-i[3]*n[2],u=e[0],h=e[1],d=e[2],p=e[3];return t[0]=h*c-d*l+p*a,t[1]=-u*c+d*s-p*o,t[2]=u*l-h*s+p*r,t[3]=-u*a+h*o-d*r,t},Qc.lerp=function(t,e,i,n){var r=e[0],o=e[1],s=e[2],a=e[3];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t[2]=s+n*(i[2]-s),t[3]=a+n*(i[3]-a),t},Qc.random=function(t,e){var i,n,r,o,s,a;e=e||1;do{s=(i=2*eu.RANDOM()-1)*i+(n=2*eu.RANDOM()-1)*n}while(s>=1);do{a=(r=2*eu.RANDOM()-1)*r+(o=2*eu.RANDOM()-1)*o}while(a>=1);var l=Math.sqrt((1-s)/a);return t[0]=e*i,t[1]=e*n,t[2]=e*r*l,t[3]=e*o*l,t},Qc.transformMat4=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*s,t[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*s,t[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*s,t[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*s,t},Qc.transformQuat=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],l=i[2],c=i[3],u=c*n+a*o-l*r,h=c*r+l*n-s*o,d=c*o+s*r-a*n,p=-s*n-a*r-l*o;return t[0]=u*c+p*-s+h*-l-d*-a,t[1]=h*c+p*-a+d*-s-u*-l,t[2]=d*c+p*-l+u*-a-h*-s,t[3]=e[3],t},Qc.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Qc.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Qc.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Qc.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=e[0],a=e[1],l=e[2],c=e[3];return Math.abs(i-s)<=eu.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-a)<=eu.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-l)<=eu.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-c)<=eu.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},Qc.forEach=Qc.sqrLen=Qc.len=Qc.sqrDist=Qc.dist=Qc.div=Qc.mul=Qc.sub=void 0;var eu=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==tu(t)&&"function"!=typeof t)return{default:t};var i=iu(void 0);if(i&&i.has(t))return i.get(t);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=r?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=t[o]}return n.default=t,i&&i.set(t,n),n}(nc);function iu(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(iu=function(t){return t?i:e})(t)}function nu(){var t=new eu.ARRAY_TYPE(4);return eu.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function ru(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function ou(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function su(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function au(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function lu(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2],o=e[3]-t[3];return i*i+n*n+r*r+o*o}function cu(t){return Math.hypot(t[0],t[1],t[2],t[3])}function uu(t){var e=t[0],i=t[1],n=t[2],r=t[3];return e*e+i*i+n*n+r*r}Qc.sub=ru,Qc.mul=ou,Qc.div=su,Qc.dist=au,Qc.sqrDist=lu,Qc.len=cu,Qc.sqrLen=uu;var hu=function(){var t=nu();return function(e,i,n,r,o,s){var a,l;for(i||(i=4),n||(n=0),l=r?Math.min(r*i+n,e.length):e.length,a=n;a<l;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}();function du(t){return du="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},du(t)}Qc.forEach=hu,Object.defineProperty(Fc,"__esModule",{value:!0}),Fc.create=vu,Fc.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Fc.setAxisAngle=xu,Fc.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),n=Math.sin(i/2);return n>pu.EPSILON?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),i},Fc.getAngle=function(t,e){var i=Iu(t,e);return Math.acos(2*i*i-1)},Fc.multiply=bu,Fc.rotateX=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+s*a,t[1]=r*l+o*a,t[2]=o*l-r*a,t[3]=s*l-n*a,t},Fc.rotateY=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l-o*a,t[1]=r*l+s*a,t[2]=o*l+n*a,t[3]=s*l-r*a,t},Fc.rotateZ=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+r*a,t[1]=r*l-n*a,t[2]=o*l+s*a,t[3]=s*l-o*a,t},Fc.calculateW=function(t,e){var i=e[0],n=e[1],r=e[2];return t[0]=i,t[1]=n,t[2]=r,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r)),t},Fc.exp=wu,Fc.ln=Eu,Fc.pow=function(t,e,i){return Eu(t,e),Mu(t,t,i),wu(t,t),t},Fc.slerp=Su,Fc.random=function(t){var e=pu.RANDOM(),i=pu.RANDOM(),n=pu.RANDOM(),r=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=r*Math.sin(2*Math.PI*i),t[1]=r*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*n),t[3]=o*Math.cos(2*Math.PI*n),t},Fc.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i*i+n*n+r*r+o*o,a=s?1/s:0;return t[0]=-i*a,t[1]=-n*a,t[2]=-r*a,t[3]=o*a,t},Fc.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Fc.fromMat3=Tu,Fc.fromEuler=function(t,e,i,n){var r=.5*Math.PI/180;e*=r,i*=r,n*=r;var o=Math.sin(e),s=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(n),u=Math.cos(n);return t[0]=o*l*u-s*a*c,t[1]=s*a*u+o*l*c,t[2]=s*l*c-o*a*u,t[3]=s*l*u+o*a*c,t},Fc.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Fc.setAxes=Fc.sqlerp=Fc.rotationTo=Fc.equals=Fc.exactEquals=Fc.normalize=Fc.sqrLen=Fc.squaredLength=Fc.len=Fc.length=Fc.lerp=Fc.dot=Fc.scale=Fc.mul=Fc.add=Fc.set=Fc.copy=Fc.fromValues=Fc.clone=void 0;var pu=yu(nc),fu=yu(xc),mu=yu(zc),gu=yu(Qc);function _u(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(_u=function(t){return t?i:e})(t)}function yu(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==du(t)&&"function"!=typeof t)return{default:t};var i=_u(e);if(i&&i.has(t))return i.get(t);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=r?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=t[o]}return n.default=t,i&&i.set(t,n),n}function vu(){var t=new pu.ARRAY_TYPE(4);return pu.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function xu(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t}function bu(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=n*u+s*a+r*c-o*l,t[1]=r*u+s*l+o*a-n*c,t[2]=o*u+s*c+n*l-r*a,t[3]=s*u-n*a-r*l-o*c,t}function wu(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=Math.sqrt(i*i+n*n+r*r),a=Math.exp(o),l=s>0?a*Math.sin(s)/s:0;return t[0]=i*l,t[1]=n*l,t[2]=r*l,t[3]=a*Math.cos(s),t}function Eu(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=Math.sqrt(i*i+n*n+r*r),a=s>0?Math.atan2(s,o)/s:0;return t[0]=i*a,t[1]=n*a,t[2]=r*a,t[3]=.5*Math.log(i*i+n*n+r*r+o*o),t}function Su(t,e,i,n){var r,o,s,a,l,c=e[0],u=e[1],h=e[2],d=e[3],p=i[0],f=i[1],m=i[2],g=i[3];return(o=c*p+u*f+h*m+d*g)<0&&(o=-o,p=-p,f=-f,m=-m,g=-g),1-o>pu.EPSILON?(r=Math.acos(o),s=Math.sin(r),a=Math.sin((1-n)*r)/s,l=Math.sin(n*r)/s):(a=1-n,l=n),t[0]=a*c+l*p,t[1]=a*u+l*f,t[2]=a*h+l*m,t[3]=a*d+l*g,t}function Tu(t,e){var i,n=e[0]+e[4]+e[8];if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;i=Math.sqrt(e[3*r+r]-e[3*o+o]-e[3*s+s]+1),t[r]=.5*i,t[3]=(e[3*o+s]-e[3*s+o])*(i=.5/i),t[o]=(e[3*o+r]+e[3*r+o])*i,t[s]=(e[3*s+r]+e[3*r+s])*i}return t}Fc.clone=gu.clone,Fc.fromValues=gu.fromValues,Fc.copy=gu.copy,Fc.set=gu.set,Fc.add=gu.add,Fc.mul=bu;var Mu=gu.scale;Fc.scale=Mu;var Iu=gu.dot;Fc.dot=Iu,Fc.lerp=gu.lerp;var Cu=gu.length;Fc.length=Cu,Fc.len=Cu;var Au=gu.squaredLength;Fc.squaredLength=Au,Fc.sqrLen=Au;var Pu=gu.normalize;Fc.normalize=Pu,Fc.exactEquals=gu.exactEquals,Fc.equals=gu.equals;var Lu,Ru,Du,ku=(Lu=mu.create(),Ru=mu.fromValues(1,0,0),Du=mu.fromValues(0,1,0),function(t,e,i){var n=mu.dot(e,i);return n<-.999999?(mu.cross(Lu,Ru,e),mu.len(Lu)<1e-6&&mu.cross(Lu,Du,e),mu.normalize(Lu,Lu),xu(t,Lu,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(mu.cross(Lu,e,i),t[0]=Lu[0],t[1]=Lu[1],t[2]=Lu[2],t[3]=1+n,Pu(t,t))});Fc.rotationTo=ku;var Nu,Ou,Fu=(Nu=vu(),Ou=vu(),function(t,e,i,n,r,o){return Su(Nu,e,r,o),Su(Ou,i,n,o),Su(t,Nu,Ou,2*o*(1-o)),t});Fc.sqlerp=Fu;var zu,Bu=(zu=fu.create(),function(t,e,i,n){return zu[0]=i[0],zu[3]=i[1],zu[6]=i[2],zu[1]=n[0],zu[4]=n[1],zu[7]=n[2],zu[2]=-e[0],zu[5]=-e[1],zu[8]=-e[2],Pu(t,Tu(t,zu))});Fc.setAxes=Bu;var Uu={};function Vu(t){return Vu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vu(t)}Object.defineProperty(Uu,"__esModule",{value:!0}),Uu.create=function(){var t=new ju.ARRAY_TYPE(8);return ju.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Uu.clone=function(t){var e=new ju.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Uu.fromValues=function(t,e,i,n,r,o,s,a){var l=new ju.ARRAY_TYPE(8);return l[0]=t,l[1]=e,l[2]=i,l[3]=n,l[4]=r,l[5]=o,l[6]=s,l[7]=a,l},Uu.fromRotationTranslationValues=function(t,e,i,n,r,o,s){var a=new ju.ARRAY_TYPE(8);a[0]=t,a[1]=e,a[2]=i,a[3]=n;var l=.5*r,c=.5*o,u=.5*s;return a[4]=l*n+c*i-u*e,a[5]=c*n+u*t-l*i,a[6]=u*n+l*e-c*t,a[7]=-l*t-c*e-u*i,a},Uu.fromRotationTranslation=Xu,Uu.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Uu.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Uu.fromMat4=function(t,e){var i=Gu.create();Hu.getRotation(i,e);var n=new ju.ARRAY_TYPE(3);return Hu.getTranslation(n,e),Xu(t,i,n),t},Uu.copy=$u,Uu.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Uu.set=function(t,e,i,n,r,o,s,a,l){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t},Uu.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Uu.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Uu.getTranslation=function(t,e){var i=e[4],n=e[5],r=e[6],o=e[7],s=-e[0],a=-e[1],l=-e[2],c=e[3];return t[0]=2*(i*c+o*s+n*l-r*a),t[1]=2*(n*c+o*a+r*s-i*l),t[2]=2*(r*c+o*l+i*a-n*s),t},Uu.translate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=.5*i[0],l=.5*i[1],c=.5*i[2],u=e[4],h=e[5],d=e[6],p=e[7];return t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=s*a+r*c-o*l+u,t[5]=s*l+o*a-n*c+h,t[6]=s*c+n*l-r*a+d,t[7]=-n*a-r*l-o*c+p,t},Uu.rotateX=function(t,e,i){var n=-e[0],r=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=a*s+u*n+l*o-c*r,d=l*s+u*r+c*n-a*o,p=c*s+u*o+a*r-l*n,f=u*s-a*n-l*r-c*o;return Gu.rotateX(t,e,i),t[4]=h*(s=t[3])+f*(n=t[0])+d*(o=t[2])-p*(r=t[1]),t[5]=d*s+f*r+p*n-h*o,t[6]=p*s+f*o+h*r-d*n,t[7]=f*s-h*n-d*r-p*o,t},Uu.rotateY=function(t,e,i){var n=-e[0],r=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=a*s+u*n+l*o-c*r,d=l*s+u*r+c*n-a*o,p=c*s+u*o+a*r-l*n,f=u*s-a*n-l*r-c*o;return Gu.rotateY(t,e,i),t[4]=h*(s=t[3])+f*(n=t[0])+d*(o=t[2])-p*(r=t[1]),t[5]=d*s+f*r+p*n-h*o,t[6]=p*s+f*o+h*r-d*n,t[7]=f*s-h*n-d*r-p*o,t},Uu.rotateZ=function(t,e,i){var n=-e[0],r=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=a*s+u*n+l*o-c*r,d=l*s+u*r+c*n-a*o,p=c*s+u*o+a*r-l*n,f=u*s-a*n-l*r-c*o;return Gu.rotateZ(t,e,i),t[4]=h*(s=t[3])+f*(n=t[0])+d*(o=t[2])-p*(r=t[1]),t[5]=d*s+f*r+p*n-h*o,t[6]=p*s+f*o+h*r-d*n,t[7]=f*s-h*n-d*r-p*o,t},Uu.rotateByQuatAppend=function(t,e,i){var n=i[0],r=i[1],o=i[2],s=i[3],a=e[0],l=e[1],c=e[2],u=e[3];return t[0]=a*s+u*n+l*o-c*r,t[1]=l*s+u*r+c*n-a*o,t[2]=c*s+u*o+a*r-l*n,t[3]=u*s-a*n-l*r-c*o,t[4]=(a=e[4])*s+(u=e[7])*n+(l=e[5])*o-(c=e[6])*r,t[5]=l*s+u*r+c*n-a*o,t[6]=c*s+u*o+a*r-l*n,t[7]=u*s-a*n-l*r-c*o,t},Uu.rotateByQuatPrepend=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=n*u+s*a+r*c-o*l,t[1]=r*u+s*l+o*a-n*c,t[2]=o*u+s*c+n*l-r*a,t[3]=s*u-n*a-r*l-o*c,t[4]=n*(u=i[7])+s*(a=i[4])+r*(c=i[6])-o*(l=i[5]),t[5]=r*u+s*l+o*a-n*c,t[6]=o*u+s*c+n*l-r*a,t[7]=s*u-n*a-r*l-o*c,t},Uu.rotateAroundAxis=function(t,e,i,n){if(Math.abs(n)<ju.EPSILON)return $u(t,e);var r=Math.hypot(i[0],i[1],i[2]);n*=.5;var o=Math.sin(n),s=o*i[0]/r,a=o*i[1]/r,l=o*i[2]/r,c=Math.cos(n),u=e[0],h=e[1],d=e[2],p=e[3];t[0]=u*c+p*s+h*l-d*a,t[1]=h*c+p*a+d*s-u*l,t[2]=d*c+p*l+u*a-h*s,t[3]=p*c-u*s-h*a-d*l;var f=e[4],m=e[5],g=e[6],_=e[7];return t[4]=f*c+_*s+m*l-g*a,t[5]=m*c+_*a+g*s-f*l,t[6]=g*c+_*l+f*a-m*s,t[7]=_*c-f*s-m*a-g*l,t},Uu.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},Uu.multiply=Yu,Uu.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},Uu.lerp=function(t,e,i,n){var r=1-n;return Zu(e,i)<0&&(n=-n),t[0]=e[0]*r+i[0]*n,t[1]=e[1]*r+i[1]*n,t[2]=e[2]*r+i[2]*n,t[3]=e[3]*r+i[3]*n,t[4]=e[4]*r+i[4]*n,t[5]=e[5]*r+i[5]*n,t[6]=e[6]*r+i[6]*n,t[7]=e[7]*r+i[7]*n,t},Uu.invert=function(t,e){var i=Ju(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},Uu.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Uu.normalize=function(t,e){var i=Ju(e);if(i>0){i=Math.sqrt(i);var n=e[0]/i,r=e[1]/i,o=e[2]/i,s=e[3]/i,a=e[4],l=e[5],c=e[6],u=e[7],h=n*a+r*l+o*c+s*u;t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=(a-n*h)/i,t[5]=(l-r*h)/i,t[6]=(c-o*h)/i,t[7]=(u-s*h)/i}return t},Uu.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Uu.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Uu.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=e[0],h=e[1],d=e[2],p=e[3],f=e[4],m=e[5],g=e[6],_=e[7];return Math.abs(i-u)<=ju.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-h)<=ju.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-d)<=ju.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(o-p)<=ju.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-f)<=ju.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-m)<=ju.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-g)<=ju.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-_)<=ju.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))},Uu.sqrLen=Uu.squaredLength=Uu.len=Uu.length=Uu.dot=Uu.mul=Uu.setReal=Uu.getReal=void 0;var ju=qu(nc),Gu=qu(Fc),Hu=qu(Mc);function Wu(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(Wu=function(t){return t?i:e})(t)}function qu(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==Vu(t)&&"function"!=typeof t)return{default:t};var i=Wu(e);if(i&&i.has(t))return i.get(t);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=r?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=t[o]}return n.default=t,i&&i.set(t,n),n}function Xu(t,e,i){var n=.5*i[0],r=.5*i[1],o=.5*i[2],s=e[0],a=e[1],l=e[2],c=e[3];return t[0]=s,t[1]=a,t[2]=l,t[3]=c,t[4]=n*c+r*l-o*a,t[5]=r*c+o*s-n*l,t[6]=o*c+n*a-r*s,t[7]=-n*s-r*a-o*l,t}function $u(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Yu(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=i[4],l=i[5],c=i[6],u=i[7],h=e[4],d=e[5],p=e[6],f=e[7],m=i[0],g=i[1],_=i[2],y=i[3];return t[0]=n*y+s*m+r*_-o*g,t[1]=r*y+s*g+o*m-n*_,t[2]=o*y+s*_+n*g-r*m,t[3]=s*y-n*m-r*g-o*_,t[4]=n*u+s*a+r*c-o*l+h*y+f*m+d*_-p*g,t[5]=r*u+s*l+o*a-n*c+d*y+f*g+p*m-h*_,t[6]=o*u+s*c+n*l-r*a+p*y+f*_+h*g-d*m,t[7]=s*u-n*a-r*l-o*c+f*y-h*m-d*g-p*_,t}Uu.getReal=Gu.copy,Uu.setReal=Gu.copy,Uu.mul=Yu;var Zu=Gu.dot;Uu.dot=Zu;var Ku=Gu.length;Uu.length=Ku,Uu.len=Ku;var Ju=Gu.squaredLength;Uu.squaredLength=Ju,Uu.sqrLen=Ju;var Qu={};function th(t){return th="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},th(t)}Object.defineProperty(Qu,"__esModule",{value:!0}),Qu.create=nh,Qu.clone=function(t){var e=new eh.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Qu.fromValues=function(t,e){var i=new eh.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},Qu.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Qu.set=function(t,e,i){return t[0]=e,t[1]=i,t},Qu.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},Qu.subtract=rh,Qu.multiply=oh,Qu.divide=sh,Qu.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Qu.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Qu.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},Qu.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},Qu.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Qu.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},Qu.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t},Qu.distance=ah,Qu.squaredDistance=lh,Qu.length=ch,Qu.squaredLength=uh,Qu.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Qu.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Qu.normalize=function(t,e){var i=e[0],n=e[1],r=i*i+n*n;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t},Qu.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Qu.cross=function(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t},Qu.lerp=function(t,e,i,n){var r=e[0],o=e[1];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t},Qu.random=function(t,e){e=e||1;var i=2*eh.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},Qu.transformMat2=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r,t[1]=i[1]*n+i[3]*r,t},Qu.transformMat2d=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r+i[4],t[1]=i[1]*n+i[3]*r+i[5],t},Qu.transformMat3=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[3]*r+i[6],t[1]=i[1]*n+i[4]*r+i[7],t},Qu.transformMat4=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t},Qu.rotate=function(t,e,i,n){var r=e[0]-i[0],o=e[1]-i[1],s=Math.sin(n),a=Math.cos(n);return t[0]=r*a-o*s+i[0],t[1]=r*s+o*a+i[1],t},Qu.angle=function(t,e){var i=t[0],n=t[1],r=e[0],o=e[1],s=Math.sqrt(i*i+n*n)*Math.sqrt(r*r+o*o);return Math.acos(Math.min(Math.max(s&&(i*r+n*o)/s,-1),1))},Qu.zero=function(t){return t[0]=0,t[1]=0,t},Qu.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Qu.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Qu.equals=function(t,e){var i=t[0],n=t[1],r=e[0],o=e[1];return Math.abs(i-r)<=eh.EPSILON*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(n-o)<=eh.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))},Qu.forEach=Qu.sqrLen=Qu.sqrDist=Qu.dist=Qu.div=Qu.mul=Qu.sub=Qu.len=void 0;var eh=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==th(t)&&"function"!=typeof t)return{default:t};var i=ih(void 0);if(i&&i.has(t))return i.get(t);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=r?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=t[o]}return n.default=t,i&&i.set(t,n),n}(nc);function ih(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(ih=function(t){return t?i:e})(t)}function nh(){var t=new eh.ARRAY_TYPE(2);return eh.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function rh(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function oh(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function sh(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function ah(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function lh(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}function ch(t){return Math.hypot(t[0],t[1])}function uh(t){var e=t[0],i=t[1];return e*e+i*i}Qu.len=ch,Qu.sub=rh,Qu.mul=oh,Qu.div=sh,Qu.dist=ah,Qu.sqrDist=lh,Qu.sqrLen=uh;var hh=function(){var t=nh();return function(e,i,n,r,o,s){var a,l;for(i||(i=2),n||(n=0),l=r?Math.min(r*i+n,e.length):e.length,a=n;a<l;a+=i)t[0]=e[a],t[1]=e[a+1],o(t,t,s),e[a]=t[0],e[a+1]=t[1];return e}}();function dh(t){return dh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dh(t)}Qu.forEach=hh,Object.defineProperty(ic,"__esModule",{value:!0}),t.a7=ic.vec4=t.N=ic.vec3=ic.vec2=ic.quat2=t.bi=ic.quat=t.a6=ic.mat4=t.co=ic.mat3=ic.mat2d=t.b4=ic.mat2=ic.glMatrix=void 0;var ph=Sh(nc);ic.glMatrix=ph;var fh=Sh(lc);t.b4=ic.mat2=fh;var mh=Sh(fc);ic.mat2d=mh;var gh=Sh(xc);t.co=ic.mat3=gh;var _h=Sh(Mc);t.a6=ic.mat4=_h;var yh=Sh(Fc);t.bi=ic.quat=yh;var vh=Sh(Uu);ic.quat2=vh;var xh=Sh(Qu);ic.vec2=xh;var bh=Sh(zc);t.N=ic.vec3=bh;var wh=Sh(Qc);function Eh(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(Eh=function(t){return t?i:e})(t)}function Sh(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==dh(t)&&"function"!=typeof t)return{default:t};var i=Eh(e);if(i&&i.has(t))return i.get(t);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=r?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=t[o]}return n.default=t,i&&i.set(t,n),n}t.a7=ic.vec4=wh;class Th{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(e,i,n){const r=t.N.dot(i,this.dir);if(Math.abs(r)<1e-6)return!1;const o=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/r;return n[0]=this.pos[0]+this.dir[0]*o,n[1]=this.pos[1]+this.dir[1]*o,n[2]=this.pos[2]+this.dir[2]*o,!0}closestPointOnSphere(e,i,n){if(t.N.equals(this.pos,e)||0===i)return n[0]=n[1]=n[2]=0,!1;const[r,o,s]=this.dir,a=this.pos[0]-e[0],l=this.pos[1]-e[1],c=this.pos[2]-e[2],u=r*r+o*o+s*s,h=2*(a*r+l*o+c*s),d=h*h-4*u*(a*a+l*l+c*c-i*i);if(d<0){const t=Math.max(-h/2,0),e=a+r*t,u=l+o*t,d=c+s*t,p=Math.hypot(e,u,d);return n[0]=e*i/p,n[1]=u*i/p,n[2]=d*i/p,!1}{const t=(-h-Math.sqrt(d))/(2*u);if(t<0){const t=Math.hypot(a,l,c);return n[0]=a*i/t,n[1]=l*i/t,n[2]=c*i/t,!1}return n[0]=a+r*t,n[1]=l+o*t,n[2]=c+s*t,!0}}}class Mh{constructor(t,e,i,n,r){this.TL=t,this.TR=e,this.BR=i,this.BL=n,this.horizon=r}static fromInvProjectionMatrix(e,i,n){const r=[-1,1,1],o=[1,1,1],s=[1,-1,1],a=[-1,-1,1],l=t.N.transformMat4(r,r,e),c=t.N.transformMat4(o,o,e),u=t.N.transformMat4(s,s,e),h=t.N.transformMat4(a,a,e);return new Mh(l,c,u,h,i/n)}}function Ih(e,i,n){let r=1/0,o=-1/0;const s=[];for(const a of e){t.N.sub(s,a,i);const e=t.N.dot(s,n);r=Math.min(r,e),o=Math.max(o,e)}return[r,o]}function Ch(e,i){let n=!0;for(let r=0;r<e.planes.length;r++){const o=e.planes[r];let s=0;for(let e=0;e<i.length;e++)s+=t.N.dot(o,i[e])+o[3]>=0;if(0===s)return 0;s!==i.length&&(n=!1)}return n?2:1}function Ah(t,e){for(const i of t.projections){const n=Ih(e,t.points[0],i.axis);if(i.projection[1]<n[0]||i.projection[0]>n[1])return 0}return 1}function Ph(e,i){let n=0;const r=[0,0,0,0];for(let o=0;o<e.length;o++)r[0]=e[o][0],r[1]=e[o][1],r[2]=e[o][2],r[3]=1,t.a7.dot(r,i)>=0&&n++;return n}class Lh{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Rh.fromPoints(this.points),this.projections=[],this.frustumEdges=[t.N.sub([],this.points[2],this.points[3]),t.N.sub([],this.points[0],this.points[3]),t.N.sub([],this.points[4],this.points[0]),t.N.sub([],this.points[5],this.points[1]),t.N.sub([],this.points[6],this.points[2]),t.N.sub([],this.points[7],this.points[3])];for(const t of this.frustumEdges){const e=[0,-t[2],t[1]],i=[t[2],0,-t[0]];this.projections.push({axis:e,projection:Ih(this.points,this.points[0],e)}),this.projections.push({axis:i,projection:Ih(this.points,this.points[0],i)})}}static fromInvProjectionMatrix(e,i,n,r){const o=Math.pow(2,n),s=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((n=>{const s=t.a7.transformMat4([],n,e),a=1/s[3]/i*o;return t.a7.mul(s,s,[a,a,r?1/s[3]:a,a])})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const i=t.N.sub([],s[e[0]],s[e[1]]),n=t.N.sub([],s[e[2]],s[e[1]]),r=t.N.normalize([],t.N.cross([],i,n)),o=-t.N.dot(r,s[e[1]]);return r.concat(o)})),l=[];for(let t=0;t<s.length;t++)l.push([s[t][0],s[t][1],s[t][2]]);return new Lh(l,a)}intersectsPrecise(e,i,n){for(let t=0;t<i.length;t++)if(!Ph(e,i[t]))return 0;for(let t=0;t<this.planes.length;t++)if(!Ph(e,this.planes[t]))return 0;for(const i of n)for(const n of this.frustumEdges){const r=t.N.cross([],i,n),o=t.N.length(r);if(0===o)continue;t.N.scale(r,r,1/o);const s=Ih(this.points,this.points[0],r),a=Ih(e,this.points[0],r);if(s[0]>a[1]||a[0]>s[1])return 0}return 1}}class Rh{static fromPoints(e){const i=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const r of e)t.N.min(i,i,r),t.N.max(n,n,r);return new Rh(i,n)}static fromTileIdAndHeight(t,e,i){const n=1<<t.canonical.z,r=t.canonical.x,o=t.canonical.y;return new Rh([r/n,o/n,e],[(r+1)/n,(o+1)/n,i])}static applyTransform(e,i){const n=e.getCorners();for(let e=0;e<n.length;++e)t.N.transformMat4(n[e],n[e],i);return Rh.fromPoints(n)}static projectAabbCorners(e,i){const n=e.getCorners();for(let e=0;e<n.length;++e)t.N.transformMat4(n[e],n[e],i);return n}constructor(e,i){this.min=e,this.max=i,this.center=t.N.scale([],t.N.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],n=t.N.clone(this.min),r=t.N.clone(this.max);for(let t=0;t<i.length;t++)n[t]=i[t]?this.min[t]:this.center[t],r[t]=i[t]?this.center[t]:this.max[t];return r[2]=this.max[2],new Rh(n,r)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,e=this.max;return[[t[0],t[1],t[2]],[e[0],t[1],t[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],e[2]],[t[0],e[1],e[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Ch(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Ch(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,e){return e||this.intersects(t)?Ah(t,this.getCorners()):0}intersectsPreciseFlat(t,e){return e||this.intersectsFlat(t)?Ah(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let e=0;e<3;++e)if(this.min[e]>t.max[e]||t.min[e]>this.max[e])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t.min[e]),this.max[e]=Math.max(this.max[e],t.max[e])}encapsulatePoint(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t[e]),this.max[e]=Math.max(this.max[e],t[e])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}io(Rh,"Aabb");const Dh=hs([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:kh}=Dh,Nh=hs([{name:"a_pos_3",components:3,type:"Int16"}]);var Oh=hs([{name:"a_pos",type:"Int16",components:2}]);function Fh(t){return t*ja/Ja}const zh=[new Rh([$a,$a,$a],[Ya,Ya,Ya]),new Rh([$a,$a,$a],[0,0,Ya]),new Rh([0,$a,$a],[Ya,0,Ya]),new Rh([$a,0,$a],[0,Ya,Ya]),new Rh([0,0,$a],[Ya,Ya,Ya])];function Bh(e,i,n,r=!0){const o=t.N.scale([],e._camera.position,e.worldSize),s=[i,n,1,1];t.a7.transformMat4(s,s,e.pixelMatrixInverse),t.a7.scale(s,s,1/s[3]);const a=t.N.sub([],s,o),l=t.N.normalize([],a),c=e.globeMatrix,u=[c[12],c[13],c[14]],h=t.N.sub([],u,o),d=t.N.length(h),p=t.N.normalize([],h),f=e.worldSize/(2*Math.PI),m=t.N.dot(p,l),g=Math.asin(f/d);if(g<Math.acos(m)){if(!r)return null;const e=[],i=[];t.N.scale(e,l,d/m),t.N.normalize(i,t.N.sub(i,e,h)),t.N.normalize(l,t.N.add(l,h,t.N.scale(l,i,Math.tan(g)*d)))}const _=[];new Th(o,l).closestPointOnSphere(u,f,_);const y=t.N.normalize([],it(c,0)),v=t.N.normalize([],it(c,1)),x=t.N.normalize([],it(c,2)),w=t.N.dot(y,_),E=t.N.dot(v,_),S=t.N.dot(x,_),T=b(Math.asin(-E/f));let I=b(Math.atan2(w,S));I=e.center.lng+function(t,e){const i=(e-t+180)%360-180;return i<-180?i+360:i}(e.center.lng,I);const C=dl(I),A=M(pl(T),0,1);return new El(C,A)}class Uh{constructor(e,i,n){this.a=t.N.sub([],e,n),this.b=t.N.sub([],i,n),this.center=n;const r=t.N.normalize([],this.a),o=t.N.normalize([],this.b);this.angle=Math.acos(t.N.dot(r,o))}}function Vh(t,e){if(0===t.angle)return null;let i;return i=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(t,e,i,n){const r=Math.sin(i);return t*(Math.sin((1-n)*i)/r)+e*(Math.sin(n*i)/r)}(t.a[e],t.b[e],t.angle,M(i,0,1))+t.center[e]}function jh(t){if(t.z<=1)return zh[t.z+2*t.y+t.x];const e=Xh(qh(t));return Rh.fromPoints(e)}function Gh(e,i,n){return t.N.scale(e,e,1-n),t.N.scaleAndAdd(e,e,i,n)}function Hh(e,i,n){for(const r of e)t.N.transformMat4(r,r,i),t.N.scale(r,r,n)}function Wh(e,i,n,r){const o=i/e.worldSize,s=e.globeMatrix;if(n.z<=1){const t=jh(n).getCorners();return Hh(t,s,o),Rh.fromPoints(t)}const a=qh(n,r),l=Xh(a,ja+Fh(e._tileCoverLift));Hh(l,s,o);const c=Number.MAX_VALUE,u=[-c,-c,-c],h=[c,c,c];if(a.contains(e.center)){for(const e of l)t.N.min(h,h,e),t.N.max(u,u,e);u[2]=0;const i=e.point,n=[i.x*o,i.y*o,0];return t.N.min(h,h,n),t.N.max(u,u,n),new Rh(h,u)}if(e._tileCoverLift>0){for(const e of l)t.N.min(h,h,e),t.N.max(u,u,e);return new Rh(h,u)}const d=[s[12]*o,s[13]*o,s[14]*o],p=a.getCenter(),f=M(e.center.lat,-yl,yl),m=M(p.lat,-yl,yl),g=dl(e.center.lng),_=pl(f);let y=g-dl(p.lng);const v=_-pl(m);y>.5?y-=1:y<-.5&&(y+=1);let b=0;if(Math.abs(y)>Math.abs(v))b=y>=0?1:3;else{b=v>=0?0:2;const e=[s[4]*o,s[5]*o,s[6]*o],i=-Math.sin(x(v>=0?a.getSouth():a.getNorth()))*ja;t.N.scaleAndAdd(d,d,e,i)}const w=l[b],E=l[(b+1)%4],S=new Uh(w,E,d),T=[Vh(S,0)||w[0],Vh(S,1)||w[1],Vh(S,2)||w[2]],I=id(e.zoom);if(I>0){const r=function({x:t,y:e,z:i},n,r,o,s){const a=1/(1<<i);let l=t*a,c=l+a,u=e*a,h=u+a,d=0;const p=(l+c)/2-o;return p>.5?d=-1:p<-.5&&(d=1),l=((l+d)*n-(o*=n))*r+o,c=((c+d)*n-o)*r+o,u=(u*n-(s*=n))*r+s,h=(h*n-s)*r+s,[[l,h,0],[c,h,0],[c,u,0],[l,u,0]]}(n,i,e._pixelsPerMercatorPixel,g,_);for(let t=0;t<l.length;t++)Gh(l[t],r[t],I);const o=t.N.add([],r[b],r[(b+1)%4]);t.N.scale(o,o,.5),Gh(T,o,I)}for(const e of l)t.N.min(h,h,e),t.N.max(u,u,e);return h[2]=Math.min(w[2],E[2]),t.N.min(h,h,T),t.N.max(u,u,T),new Rh(h,u)}function qh({x:t,y:e,z:i},n=!1){const r=1/(1<<i),o=new tl(ml(t*r),e===(1<<i)-1&&n?-90:gl((e+1)*r)),s=new tl(ml((t+1)*r),0===e&&n?90:gl(e*r));return new el(o,s)}function Xh(t,e=ja){const i=x(t.getNorth()),n=x(t.getSouth()),r=Math.cos(i),o=Math.cos(n),s=Math.sin(i),a=Math.sin(n),l=t.getWest(),c=t.getEast();return[Za(o,a,l,e),Za(o,a,c,e),Za(r,s,c,e),Za(r,s,l,e)]}function $h(t,e,i,n){const r=1<<i.z,o=(t/Li+i.x)/r;return Ka(gl((e/Li+i.y)/r),ml(o),n)}function Yh({min:t,max:e}){return Wa/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Zh=new Float64Array(16);function Kh(e){const i=Yh(e),n=t.a6.fromScaling(Zh,[i,i,i]);return t.a6.translate(n,n,t.N.negate([],e.min))}function Jh(e){const i=t.a6.fromTranslation(Zh,e.min),n=1/Yh(e);return t.a6.scale(i,i,[n,n,n])}function Qh(t){const e=Li/(2*Math.PI);return t/(2*Math.PI)/e}function td(t,e){return Li/(512*Math.pow(2,t))*Yh(jh(e))}function ed(e,i,n,r,o){const s=Qh(n),a=[e,i,-n/(2*Math.PI)],l=t.a6.identity(new Float64Array(16));return t.a6.translate(l,l,a),t.a6.scale(l,l,[s,s,s]),t.a6.rotateX(l,l,x(-o)),t.a6.rotateY(l,l,x(-r)),l}function id(t){return I(Ga,Ha,t)}function nd(e,i){const n=Ka(i.lat,i.lng),r=function(e){const i=Ka(e._center.lat,e._center.lng),n=t.N.fromValues(0,1,0);let r=t.N.cross([],n,i);const o=t.a6.fromRotation([],-e.angle,i);r=t.N.transformMat4(r,r,o),t.a6.fromRotation(o,-e._pitch,r);const s=t.N.normalize([],i);return t.N.scale(s,s,Fh(e.cameraToCenterDistance/e.pixelsPerMeter)),t.N.transformMat4(s,s,o),t.N.add([],i,s)}(e),o=t.N.subtract([],r,n);return t.N.angle(o,n)}function rd(t,e){return nd(t,e)>Math.PI/2*1.01}const od=x(85),sd=Math.cos(od),ad=Math.sin(od),ld=t.a6.create(),cd=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e};function ud(e,i,n,r,o,s,a,l,c){if(s&&e.queryGeometry.isAboveHorizon)return!1;s&&(c*=e.pixelToTileUnitsFactor);const u=e.tileID.canonical,h=n.projection.upVectorScale(u,n.center.lat,n.worldSize).metersToTile;for(const d of i)for(const i of d){const d=i.add(l),p=o&&n.elevation?n.elevation.exaggeration()*o.getElevationAt(d.x,d.y,!0):0,f=n.projection.projectTilePoint(d.x,d.y,u);if(p>0){const t=n.projection.upVector(u,d.x,d.y);f.x+=t[0]*h*p,f.y+=t[1]*h*p,f.z+=t[2]*h*p}const m=s?d:hd(f.x,f.y,f.z,r),g=s?e.tilespaceRays.map((t=>fd(t,p))):e.queryGeometry.screenGeometry,_=t.a7.transformMat4([],[f.x,f.y,f.z,1],r);if(!a&&s?c*=_[3]/n.cameraToCenterDistance:a&&!s&&(c*=n.cameraToCenterDistance/_[3]),s){const t=gl((i.y/Li+u.y)/(1<<u.z));c/=n.projection.pixelsPerMeter(t,1)/fl(1,t)}if(Fl(g,m,c))return!0}return!1}function hd(e,i,n,r){const o=t.a7.transformMat4([],[e,i,n,1],r);return new _(o[0]/o[3],o[1]/o[3])}const dd=t.N.fromValues(0,0,0),pd=t.N.fromValues(0,0,1);function fd(e,i){const n=t.N.create();return dd[2]=i,e.intersectsPlane(dd,pd,n),new _(n[0],n[1])}class md extends Nl{}function gd(t,{width:e,height:i},n,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==e*i*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(e*i*n);return t.width=e,t.height=i,t.data=r,t}function _d(t,e,i){const{width:n,height:r}=e;n===t.width&&r===t.height||(yd(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,r)},i),t.width=n,t.height=r,t.data=e.data)}function yd(t,e,i,n,r,o,s){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const a=t.data,l=e.data,c=4===o&&s;for(let s=0;s<r.height;s++){const u=((i.y+s)*t.width+i.x)*o,h=((n.y+s)*e.width+n.x)*o;if(c)for(let t=0;t<r.width;t++){const e=u+t*o+3,i=h+t*o;l[i+0]=255,l[i+1]=255,l[i+2]=255,l[i+3]=a[e]}else for(let t=0;t<r.width*o;t++)l[h+t]=a[u+t]}return e}io(md,"HeatmapBucket",{omit:["layers"]});class vd{constructor(t,e){gd(this,t,1,e)}resize(t){_d(this,new vd(t),1)}clone(){return new vd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,r){yd(t,e,i,n,r,1)}}class xd{constructor(t,e){gd(this,t,4,e)}resize(t){_d(this,new xd(t),4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new xd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,r,o){yd(t,e,i,n,r,4,o)}}class bd{constructor(t,e){this.width=t.width,this.height=t.height,this.data=e instanceof Uint8Array?new Float32Array(e.buffer):e}}io(vd,"AlphaImage"),io(xd,"RGBAImage");const wd=new Vo({visibility:new zo(Ho.layout_heatmap.visibility)});var Ed={paint:new Vo({"heatmap-radius":new Bo(Ho.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Bo(Ho.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zo(Ho.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Uo(Ho.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zo(Ho.paint_heatmap["heatmap-opacity"])}),layout:wd};function Sd(t){const e={},i=t.resolution||256,n=t.clips?t.clips.length:1,r=t.image||new xd({width:i,height:n}),o=(i,n,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);s&&(r.data[i+n+0]=Math.floor(255*s.r/s.a),r.data[i+n+1]=Math.floor(255*s.g/s.a),r.data[i+n+2]=Math.floor(255*s.b/s.a),r.data[i+n+3]=Math.floor(255*s.a))};if(t.clips)for(let e=0,r=0;e<n;++e,r+=4*i)for(let n=0,s=0;n<i;n++,s+=4){const a=n/(i-1),{start:l,end:c}=t.clips[e];o(r,s,l*(1-a)+c*a)}else for(let t=0,e=0;t<i;t++,e+=4)o(0,e,t/(i-1));return r}const Td=new Vo({visibility:new zo(Ho.layout_hillshade.visibility)});var Md={paint:new Vo({"hillshade-illumination-direction":new zo(Ho.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new zo(Ho.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zo(Ho.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zo(Ho.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zo(Ho.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zo(Ho.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new zo(Ho.paint_hillshade["hillshade-emissive-strength"])}),layout:Td};const Id=hs([{name:"a_pos",components:2,type:"Int16"}],4),{members:Cd}=Id;var Ad={exports:{}};function Pd(t,e,i){i=i||2;var n,r,o,s,a,l,c,u=e&&e.length,h=u?e[0]*i:t.length,d=Ld(t,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,i,n){var r,o,s,a=[];for(r=0,o=e.length;r<o;r++)(s=Ld(t,e[r]*n,r<o-1?e[r+1]*n:t.length,n,!1))===s.next&&(s.steiner=!0),a.push(jd(s));for(a.sort(zd),r=0;r<a.length;r++)i=Bd(a[r],i);return i}(t,e,d,i)),t.length>80*i){n=o=t[0],r=s=t[1];for(var f=i;f<h;f+=i)(a=t[f])<n&&(n=a),(l=t[f+1])<r&&(r=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-n,s-r))?32767/c:0}return Dd(d,p,i,n,r,c,0),p}function Ld(t,e,i,n,r){var o,s;if(r===ep(t,e,i,n)>0)for(o=e;o<i;o+=n)s=Jd(o,t[o],t[o+1],s);else for(o=i-n;o>=e;o-=n)s=Jd(o,t[o],t[o+1],s);return s&&qd(s,s.next)&&(Qd(s),s=s.next),s}function Rd(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!qd(n,n.next)&&0!==Wd(n.prev,n,n.next))n=n.next;else{if(Qd(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function Dd(t,e,i,n,r,o,s){if(t){!s&&o&&function(t,e,i,n){var r=t;do{0===r.z&&(r.z=Vd(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,o,s,a,l,c=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,n=i,a=0,e=0;e<c&&(a++,n=n.nextZ);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;i=n}o.nextZ=null,c*=2}while(s>1)}(r)}(t,n,r,o);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?Nd(t,n,r,o):kd(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(l.i/i|0),Qd(t),t=l.next,c=l.next;else if((t=l)===c){s?1===s?Dd(t=Od(Rd(t),e,i),e,i,n,r,o,2):2===s&&Fd(t,e,i,n,r,o):Dd(Rd(t),e,i,n,r,o,1);break}}}function kd(t){var e=t.prev,i=t,n=t.next;if(Wd(e,i,n)>=0)return!1;for(var r=e.x,o=i.x,s=n.x,a=e.y,l=i.y,c=n.y,u=r<o?r<s?r:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=r>o?r>s?r:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,f=n.next;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Gd(r,a,o,l,s,c,f.x,f.y)&&Wd(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Nd(t,e,i,n){var r=t.prev,o=t,s=t.next;if(Wd(r,o,s)>=0)return!1;for(var a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,_=Vd(p,f,e,i,n),y=Vd(m,g,e,i,n),v=t.prevZ,x=t.nextZ;v&&v.z>=_&&x&&x.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==s&&Gd(a,u,l,h,c,d,v.x,v.y)&&Wd(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&Gd(a,u,l,h,c,d,x.x,x.y)&&Wd(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=_;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==s&&Gd(a,u,l,h,c,d,v.x,v.y)&&Wd(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&Gd(a,u,l,h,c,d,x.x,x.y)&&Wd(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Od(t,e,i){var n=t;do{var r=n.prev,o=n.next.next;!qd(r,o)&&Xd(r,n,n.next,o)&&Zd(r,o)&&Zd(o,r)&&(e.push(r.i/i|0),e.push(n.i/i|0),e.push(o.i/i|0),Qd(n),Qd(n.next),n=t=o),n=n.next}while(n!==t);return Rd(n)}function Fd(t,e,i,n,r,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Hd(s,a)){var l=Kd(s,a);return s=Rd(s,s.next),l=Rd(l,l.next),Dd(s,e,i,n,r,o,0),void Dd(l,e,i,n,r,o,0)}a=a.next}s=s.next}while(s!==t)}function zd(t,e){return t.x-e.x}function Bd(t,e){var i=function(t,e){var i,n=e,r=t.x,o=t.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s&&(s=a,i=n.x<n.next.x?n:n.next,a===r))return i}n=n.next}while(n!==e);if(!i)return null;var l,c=i,u=i.x,h=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&Gd(o<h?r:s,o,u,h,o<h?s:r,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(r-n.x),Zd(n,t)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&Ud(i,n)))&&(i=n,d=l)),n=n.next}while(n!==c);return i}(t,e);if(!i)return e;var n=Kd(i,t);return Rd(n,n.next),Rd(i,i.next)}function Ud(t,e){return Wd(t.prev,t,e.prev)<0&&Wd(e.next,t,t.next)<0}function Vd(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function jd(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Gd(t,e,i,n,r,o,s,a){return(r-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(n-a)>=(i-s)*(e-a)&&(i-s)*(o-a)>=(r-s)*(n-a)}function Hd(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Xd(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Zd(t,e)&&Zd(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(Wd(t.prev,t,e.prev)||Wd(t,e.prev,e))||qd(t,e)&&Wd(t.prev,t,t.next)>0&&Wd(e.prev,e,e.next)>0)}function Wd(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function qd(t,e){return t.x===e.x&&t.y===e.y}function Xd(t,e,i,n){var r=Yd(Wd(t,e,i)),o=Yd(Wd(t,e,n)),s=Yd(Wd(i,n,t)),a=Yd(Wd(i,n,e));return r!==o&&s!==a||!(0!==r||!$d(t,i,e))||!(0!==o||!$d(t,n,e))||!(0!==s||!$d(i,t,n))||!(0!==a||!$d(i,e,n))}function $d(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Yd(t){return t>0?1:t<0?-1:0}function Zd(t,e){return Wd(t.prev,t,t.next)<0?Wd(t,e,t.next)>=0&&Wd(t,t.prev,e)>=0:Wd(t,e,t.prev)<0||Wd(t,t.next,e)<0}function Kd(t,e){var i=new tp(t.i,t.x,t.y),n=new tp(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function Jd(t,e,i,n){var r=new tp(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Qd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function tp(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ep(t,e,i,n){for(var r=0,o=e,s=i-n;o<i;o+=n)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}Ad.exports=Pd,Ad.exports.default=Pd,Pd.deviation=function(t,e,i,n){var r=e&&e.length,o=Math.abs(ep(t,0,r?e[0]*i:t.length,i));if(r)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(ep(t,e[s]*i,s<a-1?e[s+1]*i:t.length,i));var l=0;for(s=0;s<n.length;s+=3){var c=n[s]*i,u=n[s+1]*i,h=n[s+2]*i;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Pd.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[r][o][s]);r>0&&i.holes.push(n+=t[r-1].length)}return i};var ip=h(Ad.exports);function np(t,e){const i=t.length;if(i<=1)return[t];const n=[];let r,o;for(let e=0;e<i;e++){const i=H(t[e]);0!==i&&(t[e].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(r&&n.push(r),r=[t[e]]):r.push(t[e]))}if(r&&n.push(r),e>1)for(let t=0;t<n.length;t++)n[t].length<=e||(si(n[t],e,1,n[t].length-1,rp),n[t]=n[t].slice(0,e));return n}function rp(t,e){return e.area-t.area}function op(t,e,i){const n=i.patternDependencies;let r=!1;for(const i of e){const e=i.paint.get(`${t}-pattern`);e.isConstant()||(r=!0);const o=e.constantOr(null);o&&(r=!0,n[o]=!0)}return r}function sp(t,e,i,n,r){const o=r.patternDependencies;for(const s of e){const e=s.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:n},i,{},r.availableImages);t=t&&t.name?t.name:t,o[t]=!0,i.patterns[s.id]=t}}return i}class ap{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ps,this.indexArray=new Ps,this.indexArray2=new Ts,this.programConfigurations=new Oa(t.layers,t.zoom),this.segments=new ia,this.segments2=new ia,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.projection=t.projection}populate(t,e,i,n){this.hasPattern=op("fill",this.layers,e);const r=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=Rl(s,t);if(!this.layers[0]._featureFilter.filter(new Ao(this.zoom),u,i))continue;const h=r?r.evaluate(u,{},i,e.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:Ll(s,i,n),patterns:{},sortKey:h};o.push(d)}r&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const n of o){const{geometry:r,index:o,sourceLayerIndex:s}=n;if(this.hasPattern){const t=sp("fill",this.layers,n,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(n,r,o,i,{},e.availableImages,e.brightness);e.featureIndex.insert(t[o].feature,r,o,s,this.index)}}update(t,e,i,n,r){const o=0!==Object.keys(t).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,o?this.stateDependentLayers:this.layers,i,n,r)}addFeatures(t,e,i,n,r,o){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i,n,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cd),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,i,n,r,o=[],s){for(const t of np(e,500)){let e=0;for(const i of t)e+=i.length;const i=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),n=i.vertexLength,r=[],o=[];for(const e of t){if(0===e.length)continue;e!==t[0]&&o.push(r.length/2);const i=this.segments2.prepareSegment(e.length,this.layoutVertexArray,this.indexArray2),n=i.vertexLength;this.layoutVertexArray.emplaceBack(e[0].x,e[0].y),this.indexArray2.emplaceBack(n+e.length-1,n),r.push(e[0].x),r.push(e[0].y);for(let t=1;t<e.length;t++)this.layoutVertexArray.emplaceBack(e[t].x,e[t].y),this.indexArray2.emplaceBack(n+t-1,n+t),r.push(e[t].x),r.push(e[t].y);i.vertexLength+=e.length,i.primitiveLength+=e.length}const s=ip(r,o);for(let t=0;t<s.length;t+=3)this.indexArray.emplaceBack(n+s[t],n+s[t+1],n+s[t+2]);i.vertexLength+=e,i.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,o,n,s)}}io(ap,"FillBucket",{omit:["layers","patternFeatures"]});const lp=new Vo({"fill-sort-key":new Bo(Ho.layout_fill["fill-sort-key"]),visibility:new zo(Ho.layout_fill.visibility)});var cp={paint:new Vo({"fill-antialias":new zo(Ho.paint_fill["fill-antialias"]),"fill-opacity":new Bo(Ho.paint_fill["fill-opacity"]),"fill-color":new Bo(Ho.paint_fill["fill-color"]),"fill-outline-color":new Bo(Ho.paint_fill["fill-outline-color"]),"fill-translate":new zo(Ho.paint_fill["fill-translate"]),"fill-translate-anchor":new zo(Ho.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bo(Ho.paint_fill["fill-pattern"]),"fill-emissive-strength":new zo(Ho.paint_fill["fill-emissive-strength"])}),layout:lp};const up=hs([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),hp=hs([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),dp=hs([{name:"a_centroid_pos",components:2,type:"Uint16"}]),pp=hs([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),fp=hs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:mp}=up;var gp={},_p=m,yp=vp;function vp(t,e,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=r,t.readFields(xp,this,e)}function xp(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[n]=r}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function bp(t){for(var e,i,n=0,r=0,o=t.length,s=o-1;r<o;s=r++)n+=((i=t[s]).x-(e=t[r]).x)*(e.y+i.y);return n}vp.types=["Unknown","Point","LineString","Polygon"],vp.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,r=0,o=0,s=0,a=[];t.pos<i;){if(r<=0){var l=t.readVarint();n=7&l,r=l>>3}if(r--,1===n||2===n)o+=t.readSVarint(),s+=t.readSVarint(),1===n&&(e&&a.push(e),e=[]),e.push(new _p(o,s));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&a.push(e),a},vp.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(n<=0){var u=t.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)(r+=t.readSVarint())<s&&(s=r),r>a&&(a=r),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},vp.prototype.toGeoJSON=function(t,e,i){var n,r,o=this.extent*Math.pow(2,i),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=vp.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];u(l=h);break;case 2:for(n=0;n<l.length;n++)u(l[n]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,n,r=[],o=0;o<e;o++){var s=bp(t[o]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(i&&r.push(i),i=[t[o]]):i.push(t[o]))}return i&&r.push(i),r}(l),n=0;n<l.length;n++)for(r=0;r<l[n].length;r++)u(l[n][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var wp=yp,Ep=Sp;function Sp(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Tp,this,e),this.length=this._features.length}function Tp(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(i))}Sp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new wp(this._pbf,e,this.extent,this._keys,this._values)};var Mp=Ep;function Ip(t,e,i){if(3===t){var n=new Mp(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}var Cp=gp.VectorTile=function(t,e){this.layers=t.readFields(Ip,{},e)},Ap=gp.VectorTileFeature=yp;function Pp(t,e,i,n){const r=[],o=0===n?(t,e,i,n,r,o)=>{t.push(new _(o,i+(o-e)/(n-e)*(r-i)))}:(t,e,i,n,r,o)=>{t.push(new _(e+(o-i)/(r-i)*(n-e),o))};for(const s of t){const t=[];for(const r of s){if(r.length<=2)continue;const s=[];for(let t=0;t<r.length-1;t++){const a=r[t].x,l=r[t].y,c=r[t+1].x,u=r[t+1].y,h=0===n?a:l,d=0===n?c:u;h<e?d>e&&o(s,a,l,c,u,e):h>i?d<i&&o(s,a,l,c,u,i):s.push(r[t]),d<e&&h>=e&&o(s,a,l,c,u,e),d>i&&h<=i&&o(s,a,l,c,u,i)}let a=r[r.length-1];const l=0===n?a.x:a.y;l>=e&&l<=i&&s.push(a),s.length&&(a=s[s.length-1],s[0].x===a.x&&s[0].y===a.y||s.push(s[0]),t.push(s))}t.length&&r.push(t)}return r}function Lp(t,e){return t.x-e.x||t.y-e.y}function Rp(t,e){return 0===Lp(t.min,e.min)&&0===Lp(t.max,e.max)}function Dp(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function kp(t,e,i){const n=1/Li,r=1/(1<<i.canonical.z),o=(e.x*n+i.canonical.x)*r+i.wrap,s=(e.y*n+i.canonical.y)*r;return{min:new _((t.x*n+i.canonical.x)*r+i.wrap,(t.y*n+i.canonical.y)*r),max:new _(o,s)}}function Np(t,e,i){const n=1<<i.canonical.z,r=((e.x-i.wrap)*n-i.canonical.x)*Li,o=(e.y*n-i.canonical.y)*Li;return{min:new _(((t.x-i.wrap)*n-i.canonical.x)*Li,(t.y*n-i.canonical.y)*Li),max:new _(r,o)}}function Op(t,e,i,n,r,o,s){const a=t.indices,l=t.vertices,c=[];for(let u=n;u<n+r;u+=3){const n=e[i[u+0]+o],r=e[i[u+1]+o],h=e[i[u+2]+o],d=Math.min(n.x,r.x,h.x),p=Math.max(n.x,r.x,h.x),f=Math.min(n.y,r.y,h.y),m=Math.max(n.y,r.y,h.y);c.length=0,t.grid.query(new _(d,f),new _(p,m),c);for(let t=0;t<c.length;t++){const e=c[t];if(Yl(l[a[3*e+0]],l[a[3*e+1]],l[a[3*e+2]],n,r,h,s))return!0}}return!1}function Fp(t,e,i,n){if(!t||!i)return!1;let r=t.vertices;if(!e.canonical.equals(n.canonical)||e.wrap!==n.wrap){if(i.vertices.length<t.vertices.length)return Fp(i,n,t,e);const o=e.canonical,s=n.canonical,a=Math.pow(2,s.z-o.z);r=t.vertices.map((t=>new _(t.x*o.x*Li*a-s.x*Li,t.y*o.y*Li*a-s.y*Li)))}return Op(i,r,t.indices,0,t.indices.length,0,0)}gp.VectorTileLayer=Ep;class zp{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,e){const i=this.toIdx(t,e);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function Bp(t,e,i,n){let r=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(n[s])<1e-15){if(i[s]<t[s]||i[s]>e[s])return null}else{const a=1/n[s];let l=(t[s]-i[s])*a,c=(e[s]-i[s])*a;if(l>c){const t=l;l=c,c=t}if(l>r&&(r=l),c<o&&(o=c),r>o)return null}return r}function Up(t,e,i,n,r,o,s,a,l,c,u){const h=n-t,d=r-e,p=o-i,f=s-t,m=a-e,g=l-i,_=u[1]*g-u[2]*m,y=u[2]*f-u[0]*g,v=u[0]*m-u[1]*f,x=h*_+d*y+p*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-t,E=c[1]-e,S=c[2]-i,T=(w*_+E*y+S*v)*b;if(T<0||T>1)return null;const M=E*p-S*d,I=S*h-w*p,C=w*d-E*h,A=(u[0]*M+u[1]*I+u[2]*C)*b;return A<0||T+A>1?null:(f*M+m*I+g*C)*b}function Vp(t,e,i){return(t-e)/(i-e)}function jp(t,e,i,n,r,o,s,a,l){const c=1<<i,u=o-n,h=s-r,d=(t+1)/c*u+n,p=(e+0)/c*h+r,f=(e+1)/c*h+r;a[0]=(t+0)/c*u+n,a[1]=p,l[0]=d,l[1]=f}class Gp{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),i=[];let n=Math.ceil(Math.pow(2,e));const r=1/n,o=(t,e,i,n,r)=>{const o=n?1:0,s=(t+1)*i-o,a=e*i,l=(e+1)*i-o;r[0]=t*i,r[1]=a,r[2]=s,r[3]=l};let s=new zp(n);const a=[];for(let e=0;e<n*n;e++){o(e%n,Math.floor(e/n),r,!1,a);const i=Wp(a[0],a[1],t),l=Wp(a[2],a[1],t),c=Wp(a[2],a[3],t),u=Wp(a[0],a[3],t);s.minimums.push(Math.min(i,l,c,u)),s.maximums.push(Math.max(i,l,c,u)),s.leaves.push(1)}for(i.push(s),n/=2;n>=1;n/=2){const t=i[i.length-1];s=new zp(n);for(let e=0;e<n*n;e++){o(e%n,Math.floor(e/n),2,!0,a);const i=t.getElevation(a[0],a[1]),r=t.getElevation(a[2],a[1]),l=t.getElevation(a[2],a[3]),c=t.getElevation(a[0],a[3]),u=t.isLeaf(a[0],a[1]),h=t.isLeaf(a[2],a[1]),d=t.isLeaf(a[2],a[3]),p=t.isLeaf(a[0],a[3]),f=Math.min(i.min,r.min,l.min,c.min),m=Math.max(i.max,r.max,l.max,c.max),g=u&&h&&d&&p;s.maximums.push(m),s.minimums.push(f),s.leaves.push(m-f<=5&&g?1:0)}i.push(s)}return i}(this.dem),i=e.length-1,n=e[i];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(e,0,0,i,0)}raycastRoot(t,e,i,n,r,o,s=1){return Bp([t,e,-100],[i,n,this.maximums[0]*s],r,o)}raycast(e,i,n,r,o,s,a=1){if(!this.nodeCount)return null;const l=this.raycastRoot(e,i,n,r,o,s,a);if(null==l)return null;const c=[],u=[],h=[],d=[],p=[{idx:0,t:l,nodex:0,nodey:0,depth:0}];for(;p.length>0;){const{idx:l,t:f,nodex:m,nodey:g,depth:_}=p.pop();if(this.leaves[l]){jp(m,g,_,e,i,n,r,h,d);const l=1<<_,c=(m+0)/l,u=(m+1)/l,p=(g+0)/l,y=(g+1)/l,v=Wp(c,p,this.dem)*a,x=Wp(u,p,this.dem)*a,b=Wp(u,y,this.dem)*a,w=Wp(c,y,this.dem)*a,E=Up(h[0],h[1],v,d[0],h[1],x,d[0],d[1],b,o,s),S=Up(d[0],d[1],b,h[0],d[1],w,h[0],h[1],v,o,s),T=Math.min(null!==E?E:Number.MAX_VALUE,null!==S?S:Number.MAX_VALUE);if(T!==Number.MAX_VALUE)return T;{const e=t.N.scaleAndAdd([],o,s,f);if(Hp(v,x,w,b,Vp(e[0],h[0],d[0]),Vp(e[1],h[1],d[1]))>=e[2])return f}continue}let y=0;for(let t=0;t<this._siblingOffset.length;t++){jp((m<<1)+this._siblingOffset[t][0],(g<<1)+this._siblingOffset[t][1],_+1,e,i,n,r,h,d),h[2]=-100,d[2]=this.maximums[this.childOffsets[l]+t]*a;const p=Bp(h,d,o,s);if(null!=p){const e=p;c[t]=e;let i=!1;for(let n=0;n<y&&!i;n++)e>=c[u[n]]&&(u.splice(n,0,t),i=!0);i||(u[y]=t),y++}}for(let t=0;t<y;t++){const e=u[t];p.push({idx:this.childOffsets[l]+e,t:c[e],nodex:(m<<1)+this._siblingOffset[e][0],nodey:(g<<1)+this._siblingOffset[e][1],depth:_+1})}}return null}_addNode(t,e,i){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(t,e,i,n,r){if(1===t[n].isLeaf(e,i))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const o=n-1,s=t[o];let a=0,l=0;for(let t=0;t<this._siblingOffset.length;t++){const n=2*e+this._siblingOffset[t][0],r=2*i+this._siblingOffset[t][1],o=s.getElevation(n,r),c=s.isLeaf(n,r),u=this._addNode(o.min,o.max,c);c&&(a|=1<<t),l||(l=u)}for(let n=0;n<this._siblingOffset.length;n++)a&1<<n||this._construct(t,2*e+this._siblingOffset[n][0],2*i+this._siblingOffset[n][1],o,l+n)}}function Hp(t,e,i,n,r,o){return ce(ce(t,i,o),ce(e,n,o),r)}function Wp(t,e,i){const n=i.dim,r=M(t*n-.5,0,n-1),o=M(e*n-.5,0,n-1),s=Math.floor(r),a=Math.floor(o),l=Math.min(s+1,n-1),c=Math.min(a+1,n-1);return Hp(i.get(s,a),i.get(l,a),i.get(s,c),i.get(l,c),r-s,o-a)}const qp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Xp(t,e,i){return(256*t*256+256*e+i)/10-1e4}function $p(t,e,i){return 256*t+e+i/256-32768}class Yp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,i,n=!1){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return j(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const r=this.dim=e.height-2,o=new Uint32Array(e.data.buffer);if(this.pixels=new Uint8Array(e.data.buffer),this.floatView=new Float32Array(e.data.buffer),this.borderReady=n,this._modifiedForSources={},!n){for(let t=0;t<r;t++)o[this._idx(-1,t)]=o[this._idx(0,t)],o[this._idx(r,t)]=o[this._idx(r-1,t)],o[this._idx(t,-1)]=o[this._idx(t,0)],o[this._idx(t,r)]=o[this._idx(t,r-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(r,-1)]=o[this._idx(r-1,0)],o[this._idx(-1,r)]=o[this._idx(0,r-1)],o[this._idx(r,r)]=o[this._idx(r-1,r-1)]}const s="terrarium"===i?$p:Xp;for(let t=0;t<o.length;++t){const e=4*t;this.floatView[t]=s(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=st.now()}_buildQuadTree(){this._tree=new Gp(this)}get(t,e,i=!1){i&&(t=M(t,-1,this.dim),e=M(e,-1,this.dim));const n=this._idx(t,e);return this.floatView[n]}set(t,e,i){const n=this._idx(t,e),r=this.floatView[n];return this.floatView[n]=i,i-r}static getUnpackVector(t){return qp[t]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}static pack(t,e){const i=[0,0,0,0],n=Yp.getUnpackVector(e);let r=Math.floor((t+n[3])/n[2]);return i[2]=r%256,r=Math.floor(r/256),i[1]=r%256,r=Math.floor(r/256),i[0]=r,i}getPixels(){return new bd({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let n=e*this.dim,r=e*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(e){case-1:n=r-1;break;case 1:r=n+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-e*this.dim,l=-i*this.dim;for(let e=o;e<s;e++)for(let i=n;i<r;i++){const n=4*this._idx(i,e),r=4*this._idx(i+a,e+l);this.pixels[n+0]=t.pixels[r+0],this.pixels[n+1]=t.pixels[r+1],this.pixels[n+2]=t.pixels[r+2],this.pixels[n+3]=t.pixels[r+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}io(Yp,"DEMData"),io(Gp,"DemMinMaxQuadTree",{omit:["dem"]});class Zp{constructor(t,e,i){this._demTile=t,this._dem=this._demTile.dem,this._scale=e,this._offset=i}static create(t,e,i){const n=i||t.findDEMTileFor(e);if(!n||!n.dem)return;const r=n.dem,o=n.tileID,s=1<<e.canonical.z-o.canonical.z;return new Zp(n,r.dim/Li/s,[(e.canonical.x/s-o.canonical.x)*r.dim,(e.canonical.y/s-o.canonical.y)*r.dim])}tileCoordToPixel(t,e){const i=e*this._scale+this._offset[1],n=Math.floor(t*this._scale+this._offset[0]),r=Math.floor(i);return new _(n,r)}getElevationAt(t,e,i,n){const r=t*this._scale+this._offset[0],o=e*this._scale+this._offset[1],s=Math.floor(r),a=Math.floor(o),l=this._dem;return n=!!n,i?ce(ce(l.get(s,a,n),l.get(s,a+1,n),o-a),ce(l.get(s+1,a,n),l.get(s+1,a+1,n),o-a),r-s):l.get(s,a,n)}getElevationAtPixel(t,e,i){return this._dem.get(t,e,!!i)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*fl(1,t)*this._dem.stride}}const Kp=Ap.types,Jp=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Qp=["fill-extrusion-flood-light-ground-radius"],tf=Math.pow(2,13),ef=Math.pow(2,15)-1,nf=new _(0,1),rf=2147483648;function of(t,e,i,n,r,o,s,a){t.emplaceBack((e<<1)+s,(i<<1)+o,(Math.floor(n*tf)<<1)+r,Math.round(a))}function sf(t,e,i,n,r,o){t.emplaceBack(e.x,e.y,(i.x<<1)+n,(i.y<<1)+r,o)}function af(t,e,i){const n=16384;t.emplaceBack(e.x,e.y,e.z,i[0]*n,i[1]*n,i[2]*n)}class lf{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class cf{constructor(){this.centroidXY=new _(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new _(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new _(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new _(this.max.x-this.min.x,this.max.y-this.min.y)}}class uf{constructor(){this.acc=new _(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,e){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=e.x,t.min.y=t.max.y=e.y)}appendEdge(t,e,i){this.accCount++,this.acc._add(e);let n=!!this.borders;e.x<t.min.x?(t.min.x=e.x,n=!0):e.x>t.max.x&&(t.max.x=e.x,n=!0),e.y<t.min.y?(t.min.y=e.y,n=!0):e.y>t.max.y&&(t.max.y=e.y,n=!0),((0===e.x||e.x===Li)&&e.x===i.x)!=((0===e.y||e.y===Li)&&e.y===i.y)&&this.processBorderOverlap(e,i),n&&this.checkBorderIntersection(e,i)}checkBorderIntersection(t,e){e.x<0!=t.x<0&&this.addBorderIntersection(0,ce(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>Li!=t.x>Li&&this.addBorderIntersection(1,ce(e.y,t.y,(Li-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,ce(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>Li!=t.y>Li&&this.addBorderIntersection(3,ce(e.x,t.x,(Li-e.y)/(t.y-e.y)))}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[t];e<i[0]&&(i[0]=e),e>i[1]&&(i[1]=e)}processBorderOverlap(t,e){if(t.x===e.x){if(t.y===e.y)return;const i=0===t.x?0:1;this.addBorderIntersection(i,e.y),this.addBorderIntersection(i,t.y)}else{const i=0===t.y?2:3;this.addBorderIntersection(i,e.x),this.addBorderIntersection(i,t.x)}}centroid(){return 0===this.accCount?new _(0,0):new _(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((t,e)=>t+ +(e[0]!==Number.MAX_VALUE)),0):0}}function hf(t,e){const i=t.add(e)._unit(),n=M(t.x*i.x+t.y*i.y,-1,1);var r,o,s;return r=Math.acos(n),Math.min(4,Math.max(-4,Math.tan(r)))/4*ef*((o=t).x*(s=e).y-o.y*s.x<0?-1:1)}const df=[t=>t.x<0,t=>t.x>Li,t=>t.y<0,t=>t.y>Li];function pf(t,e,i,n){const r=[4];if(0===n)return r;i._mult(n);const o=t.sub(i),s=e.sub(i),a=[t,e,o,s];for(let t=0;t<4;t++)for(const e of a)if(df[t](e)){r.push(t);break}return r}class ff{constructor(t){this.vertexArray=new gs,this.indexArray=new Ps,this.programConfigurations=new Oa(t.layers,t.zoom,(t=>Qp.includes(t))),this._segments=new ia,this.hiddenByLandmarkVertexArray=new js,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ia}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(t,e,i,n=!1){const r=t.length;if(r>2){let o=Math.max(0,this._segments.get().length-1);const s=this._segments._prepareSegment(4*r,this.vertexArray.length,2*this._segmentToGroundQuads[o].length);let a;o!==this._segments.get().length-1&&(o++,this._segmentToGroundQuads[o]=[],this._segmentToRegionTriCounts[o]=[0,0,0,0,0]);{const e=t[0],i=t[1];a=hf(e.sub(t[r-1])._perp()._unit(),i.sub(e)._perp()._unit())}for(let l=0;l<r;l++){const c=l===r-1?0:l+1,u=t[l],h=t[c],d=t[c===r-1?0:c+1],p=h.sub(u)._perp()._unit(),f=hf(p,d.sub(h)._perp()._unit()),m=a,g=f;if(vf(u,h,e)||n&&xf(u,e)&&xf(h,e)){a=f;continue}const _=s.vertexLength;sf(this.vertexArray,u,h,1,1,m),sf(this.vertexArray,u,h,1,0,m),sf(this.vertexArray,u,h,0,1,g),sf(this.vertexArray,u,h,0,0,g),s.vertexLength+=4;const y=pf(u,h,p,i);for(const t of y)this._segmentToGroundQuads[o].push({id:_,region:t}),this._segmentToRegionTriCounts[o][t]+=2,s.primitiveLength+=2;a=f}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),e=t.length;for(let t=0;t<e;t++)this._segmentToGroundQuads[t].sort(((t,e)=>t.region-e.region));for(let i=0;i<e;i++){const e=this._segmentToGroundQuads[i],n=t[i],r=this._segmentToRegionTriCounts[i];r.reduce(((t,e)=>t+e),0);let o=0;for(let t=0;t<=4;t++){const e=r[t];if(0!==e){let i=this.regionSegments[t];i||(i=this.regionSegments[t]=new ia);const r={vertexOffset:n.vertexOffset,primitiveOffset:n.primitiveOffset+o,vertexLength:n.vertexLength,primitiveLength:e};i.get().push(r)}o+=e}for(let t=0;t<e.length;t++){const i=e[t].id;this.indexArray.emplaceBack(i,i+1,i+3),this.indexArray.emplaceBack(i,i+3,i+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,e,i,n,r,o){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,e,i,n,r,o)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,hp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,e,i,n,r,o){this.hasData()&&this.programConfigurations.updatePaintArrays(t,e,i,n,r,o)}updateHiddenByLandmark(t){if(!this.hasData())return;const e=t.groundVertexCount+t.groundVertexArrayOffset;if(0===t.groundVertexCount)return;const i=t.flags&rf?1:0;for(let n=t.groundVertexArrayOffset;n<e;++n)this.hiddenByLandmarkVertexArray.emplace(n,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,pp.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const e=this.regionSegments[t];e&&e.destroy()}}}}class mf{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ps,this.footprintVertices=new ps,this.footprintSegments=[],this.layoutVertexArray=new ms,this.centroidVertexArray=new Qs,this.indexArray=new Ps,this.programConfigurations=new Oa(t.layers,t.zoom,(t=>Jp.includes(t))),this.segments=new ia,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.groundEffect=new ff(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,e,i,n){this.features=[],this.hasPattern=op("fill-extrusion",this.layers,e),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=wl(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:r,id:o,index:s,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,l=Rl(r,t);if(!this.layers[0]._featureFilter.filter(new Ao(this.zoom),l,i))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:t?l.geometry:Ll(r,i,n),properties:r.properties,type:r.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(sp("fill-extrusion",this.layers,c,this.zoom,e)):this.addFeature(c,c.geometry,s,i,{},e.availableImages,n,e.brightness),e.featureIndex.insert(r,c.geometry,s,a,this.index,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,e,i,n,r,o){for(const t of this.features){const{geometry:s}=t;this.addFeature(t,s,t.index,e,i,n,r,o)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(t,e,i,n,r){const o=0!==Object.keys(t).length;if(o&&!this.stateDependentLayers.length)return;const s=o?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,e,s,i,n,r),this.groundEffect.update(t,e,s,i,n,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,mp),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,fp.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,dp.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,n,r,o,s,a){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,c=[new _(0,0),new _(Li,Li)],u=s.projection,h="globe"===u.name,d="Polygon"===Kp[t.type],p=new uf;p.centroidDataIndex=this.centroidData.length;const f=new cf,m=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},n)<=0,g=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},n);f.height=g,f.vertexArrayOffset=this.layoutVertexArray.length,f.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new bs);const y=np(e,500);for(let t=y.length-1;t>=0;t--){const e=y[t];(0===e.length||(v=e[0]).every((t=>t.x<=0))||v.every((t=>t.x>=Li))||v.every((t=>t.y<=0))||v.every((t=>t.y>=Li)))&&y.splice(t,1)}var v;let x;if(h)x=Sf(y,c,n);else{x=[];for(const t of y)x.push({polygon:t,bounds:c})}const b=d?this.edgeRadius:0,w=b>0&&this.zoom<17,E=(t,e)=>{if(0===t.length)return!1;const i=t[t.length-1];return e.x===i.x&&e.y===i.y};for(const{polygon:t,bounds:e}of x){let i=0,r=0;for(const e of t)d&&!e[0].equals(e[e.length-1])&&e.push(e[0]),r+=d?e.length-1:e.length;const o=this.segments.prepareSegment((d?5:4)*r,this.layoutVertexArray,this.indexArray);f.footprintSegIdx<0&&(f.footprintSegIdx=this.footprintSegments.length),f.polygonSegIdx<0&&(f.polygonSegIdx=this.polygonSegments.length);const s={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},a=new lf;if(a.vertexOffset=this.footprintVertices.length,a.indexOffset=3*this.footprintIndices.length,a.ringIndices=[],d){const r=[],s=[];i=o.vertexLength;for(let i=0;i<t.length;i++){const c=t[i];c.length&&0!==i&&s.push(r.length/2);const d=[];let p,f;p=c[1].sub(c[0])._perp()._unit(),a.ringIndices.push(c.length-1);for(let t=1;t<c.length;t++){const e=c[t],i=c[t===c.length-1?1:t+1],s=e.clone();if(b){f=i.sub(e)._perp()._unit();const t=p.add(f)._unit(),n=b*Math.min(4,1/(p.x*t.x+p.y*t.y));s.x+=n*t.x,s.y+=n*t.y,s.x=Math.round(s.x),s.y=Math.round(s.y),p=f}!m||0!==b&&!w||E(d,s)||d.push(s),of(this.layoutVertexArray,s.x,s.y,0,0,1,1,0),o.vertexLength++,this.footprintVertices.emplaceBack(e.x,e.y),r.push(e.x,e.y),h&&af(this.layoutVertexExtArray,u.projectTilePoint(s.x,s.y,n),u.upVector(n,s.x,s.y))}m&&(0===b||w)&&(0!==d.length&&E(d,d[0])&&d.pop(),this.groundEffect.addData(d,e,l))}const c=ip(r,s);for(let t=0;t<c.length;t+=3)this.footprintIndices.emplaceBack(a.vertexOffset+c[t+0],a.vertexOffset+c[t+1],a.vertexOffset+c[t+2]),this.indexArray.emplaceBack(i+c[t],i+c[t+2],i+c[t+1]),o.primitiveLength++;a.indexCount+=c.length,a.vertexCount+=this.footprintVertices.length-a.vertexOffset}for(let r=0;r<t.length;r++){const s=t[r];p.startRing(f,s[0]);let a=s.length>4&&bf(s[s.length-2],s[0],s[1]),c=b?_f(s[s.length-2],s[0],s[1],b):0;const g=[];let _,y,v;y=s[1].sub(s[0])._perp()._unit();let x=!0;for(let t=1,r=0;t<s.length;t++){let l=s[t-1],d=s[t];const w=s[t===s.length-1?1:t+1];if(p.appendEdge(f,d,l),vf(d,l,e)){b&&(y=w.sub(d)._perp()._unit(),x=!x);continue}const S=d.sub(l)._perp(),T=S.x/(Math.abs(S.x)+Math.abs(S.y)),M=S.y>0?1:0,I=l.dist(d);if(r+I>32768&&(r=0),b){v=w.sub(d)._perp()._unit();let t=yf(l,d,w,gf(y,v),b);isNaN(t)&&(t=0);const e=d.sub(l)._unit();l=l.add(e.mult(c))._round(),d=d.add(e.mult(-t))._round(),c=t,y=v,m&&this.zoom>=17&&(E(g,l)||g.push(l),E(g,d)||g.push(d))}const C=o.vertexLength,A=s.length>4&&bf(l,d,w);let P=wf(r,a,x);if(of(this.layoutVertexArray,l.x,l.y,T,M,0,0,P),of(this.layoutVertexArray,l.x,l.y,T,M,0,1,P),r+=I,P=wf(r,A,!x),a=A,of(this.layoutVertexArray,d.x,d.y,T,M,0,0,P),of(this.layoutVertexArray,d.x,d.y,T,M,0,1,P),o.vertexLength+=4,this.indexArray.emplaceBack(C+0,C+1,C+2),this.indexArray.emplaceBack(C+1,C+3,C+2),o.primitiveLength+=2,b){const n=i+(1===t?s.length-2:t-2),r=1===t?i:n+1;if(this.indexArray.emplaceBack(C+1,n,C+3),this.indexArray.emplaceBack(n,r,C+3),o.primitiveLength+=2,void 0===_&&(_=C),!vf(w,s[t],e)){const e=t===s.length-1?_:o.vertexLength;this.indexArray.emplaceBack(C+2,C+3,e),this.indexArray.emplaceBack(C+3,e+1,e),this.indexArray.emplaceBack(C+3,r,e+1),o.primitiveLength+=3}x=!x}if(h){const t=this.layoutVertexExtArray,e=u.projectTilePoint(l.x,l.y,n),i=u.projectTilePoint(d.x,d.y,n),r=u.upVector(n,l.x,l.y),o=u.upVector(n,d.x,d.y);af(t,e,r),af(t,e,r),af(t,i,o),af(t,i,o)}}d&&(i+=s.length-1),m&&b&&this.zoom>=17&&(0!==g.length&&E(g,g[0])&&g.pop(),this.groundEffect.addData(g,e,l,b>0))}this.footprintSegments.push(a),s.triangleCount=this.indexArray.length-s.triangleArrayOffset,this.polygonSegments.push(s),++f.footprintSegLen,++f.polygonSegLen}if(f.vertexCount=this.layoutVertexArray.length-f.vertexArrayOffset,f.groundVertexCount=this.groundEffect.vertexArray.length-f.groundVertexArrayOffset,0!==f.vertexCount){if(f.centroidXY=p.borders?nf:this.encodeCentroid(p,f),this.centroidData.push(f),p.borders){this.featuresOnBorder.push(p);const t=this.featuresOnBorder.length-1;for(let e=0;e<p.borders.length;e++)p.borders[e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[e].push(t)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,o,n,a),this.groundEffect.addPaintPropertiesData(t,i,r,o,n,a),this.maxHeight=Math.max(this.maxHeight,g)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort(((e,i)=>this.featuresOnBorder[e].borders[t][0]-this.featuresOnBorder[i].borders[t][0]))}splitToSubtiles(){const t=[];for(let e=0;e<this.centroidData.length;e++){const i=this.centroidData[e],n=+(i.min.y+i.max.y>Li),r=2*n+(+(i.min.x+i.max.x>Li)^n);for(let n=0;n<i.polygonSegLen;n++){const o=i.polygonSegIdx+n;t.push({centroidIdx:e,subtile:r,polygonSegmentIdx:o,triangleSegmentIdx:this.polygonSegments[o].triangleSegIdx})}}const e=new Ps;t.sort(((t,e)=>t.triangleSegmentIdx===e.triangleSegmentIdx?t.subtile-e.subtile:t.triangleSegmentIdx-e.triangleSegmentIdx));let i=0,n=0,r=0;for(const e of t){if(e.triangleSegmentIdx!==i)break;r++}const o=t.length;for(;n!==t.length;){i=t[n].triangleSegmentIdx;let s=0,a=n,l=n;for(let e=a;e<r&&t[e].subtile===s;e++)l++;for(;a!==r;){const n=t[a];s=n.subtile;const o=this.centroidData[n.centroidIdx].min.clone(),c=this.centroidData[n.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[i].vertexOffset,primitiveOffset:e.length,vertexLength:this.segments.segments[i].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let i=a;i<l;i++){const n=t[i],r=this.polygonSegments[n.polygonSegmentIdx],s=this.centroidData[n.centroidIdx].min,a=this.centroidData[n.centroidIdx].max,l=this.indexArray.uint16;for(let t=r.triangleArrayOffset;t<r.triangleArrayOffset+r.triangleCount;t++)e.emplaceBack(l[3*t],l[3*t+1],l[3*t+2]);u.primitiveLength+=r.triangleCount,o.x=Math.min(o.x,s.x),o.y=Math.min(o.y,s.y),c.x=Math.max(c.x,a.x),c.y=Math.max(c.y,a.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:o,max:c}),a=l;for(let e=a;e<r&&t[e].subtile===t[a].subtile;e++)l++}n=r;for(let e=n;e<o&&t[e].triangleSegmentIdx===t[n].triangleSegmentIdx;e++)r++}e._trim(),this.indexArray=e}getVisibleSegments(t,e,i){let n=0,r=0;const o=1<<t.canonical.z;if(e){const i=e.getMinMaxForTile(t);i&&(n=i.min,r=i.max)}r+=this.maxHeight;const s=t.toUnwrapped();let a;const l=[s.canonical.x/o+s.wrap,s.canonical.y/o],c=[(s.canonical.x+1)/o+s.wrap,(s.canonical.y+1)/o],u=new ia,h=(t,e,i)=>[t[0]*(1-i[0])+e[0]*i[0],t[1]*(1-i[1])+e[1]*i[1]],d=[],p=[];for(const t of this.triangleSubSegments){d[0]=t.min.x/Li,d[1]=t.min.y/Li,p[0]=t.max.x/Li,p[1]=t.max.y/Li;const e=h(l,c,d),o=h(l,c,p);if(0===new Rh([e[0],e[1],n],[o[0],o[1],r]).intersectsPrecise(i)){a&&(u.segments.push(a),a=void 0);continue}const s=t.segment;a&&a.vertexOffset!==s.vertexOffset&&(u.segments.push(a),a=void 0),a?(a.vertexLength+=s.vertexLength,a.primitiveLength+=s.primitiveLength):a={vertexOffset:s.vertexOffset,primitiveLength:s.primitiveLength,vertexLength:s.vertexLength,primitiveOffset:s.primitiveOffset,sortKey:void 0,vaos:{}}}return a&&u.segments.push(a),u}encodeCentroid(t,e){const i=t.centroid(),n=e.span(),r=Math.min(7,Math.round(n.x*this.tileToMeter/10)),o=Math.min(7,Math.round(n.y*this.tileToMeter/10));return new _(M(i.x,1,Li-1)<<3|r,M(i.y,1,Li-1)<<3|o)}encodeBorderCentroid(t){if(!t.borders)return new _(0,0);const e=t.borders,i=Number.MAX_VALUE;if(e[0][0]!==i||e[1][0]!==i){const t=e[0][0]!==i?0:1;return new _(6|(e[0][0]!==i?0:65528),(e[t][0]+e[t][1])/2<<3|6)}{const t=e[2][0]!==i?2:3;return new _((e[t][0]+e[t][1])/2<<3|6,6|(e[2][0]!==i?0:65528))}}showCentroid(t){const e=this.centroidData[t.centroidDataIndex];e.flags&=rf,e.centroidXY.x=0,e.centroidXY.y=0,this.writeCentroidToBuffer(e)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const e=t.vertexArrayOffset,i=t.vertexCount+t.vertexArrayOffset,n=t.flags&rf?nf:t.centroidXY,r=this.centroidVertexArray.geta_centroid_pos0(e);if(this.centroidVertexArray.geta_centroid_pos1(e)!==n.y||r!==n.x){for(let t=e;t<i;++t)this.centroidVertexArray.emplace(t,n.x,n.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,e){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const i=e.getReplacementRegionsForTile(t.toUnwrapped());if(function(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i].sourceId!==e[i].sourceId||!Rp(t[i],e[i]))return!1;return!0}(this.activeReplacements,i))return;if(this.activeReplacements=i,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const t of this.centroidData)t.flags&=2147483647;const n=[];for(const e of this.activeReplacements){const i=Math.pow(2,e.footprintTileId.canonical.z-t.canonical.z);for(const r of this.centroidData)if(!(r.flags&rf||e.min.x>r.max.x||r.min.x>e.max.x||e.min.y>r.max.y||r.min.y>e.max.y))for(let o=0;o<r.footprintSegLen;o++){const s=this.footprintSegments[r.footprintSegIdx+o];if(n.length=0,Tf(this.footprintVertices,s.vertexOffset,s.vertexCount,e.footprintTileId.canonical,t.canonical,n),Op(e.footprint,n,this.footprintIndices.uint16,s.indexOffset,s.indexCount,-s.vertexOffset,-i)){r.flags|=rf;break}}}for(const t of this.centroidData)this.writeCentroidToBuffer(t);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,e,i){let n=!1;for(let r=0;r<i.footprintSegLen;r++){const o=this.footprintSegments[i.footprintSegIdx+r];let s=0;for(const i of o.ringIndices){for(let r=s,a=i+s-1;r<i+s;a=r++){const i=this.footprintVertices.int16[2*(r+o.vertexOffset)+0],s=this.footprintVertices.int16[2*(r+o.vertexOffset)+1],l=this.footprintVertices.int16[2*(a+o.vertexOffset)+1];s>e!=l>e&&t<(this.footprintVertices.int16[2*(a+o.vertexOffset)+0]-i)*(e-s)/(l-s)+i&&(n=!n)}s=i}}return n}getHeightAtTileCoord(t,e){let i=Number.NEGATIVE_INFINITY,n=!0;const r=4*(t+Li)*Li+(e+Li);if(this.partLookup.hasOwnProperty(r)){const t=this.partLookup[r];return t?{height:t.height,hidden:!!(t.flags&rf)}:void 0}for(const o of this.centroidData)t>o.max.x||o.min.x>t||e>o.max.y||o.min.y>e||this.footprintContainsPoint(t,e,o)&&o&&o.height>i&&(i=o.height,this.partLookup[r]=o,n=!!(o.flags&rf));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:n};this.partLookup[r]=void 0}}function gf(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function _f(t,e,i,n){const r=e.sub(t)._perp()._unit(),o=i.sub(e)._perp()._unit();return yf(t,e,i,gf(r,o),n)}function yf(t,e,i,n,r){const o=Math.sqrt(1-n*n);return Math.min(t.dist(e)/3,e.dist(i)/3,r*o/n)}function vf(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function xf(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function bf(t,e,i){if(t.x<0||t.x>=Li||e.x<0||e.x>=Li||i.x<0||i.x>=Li)return!1;const n=i.sub(e),r=n.perp(),o=t.sub(e);return(n.x*o.x+n.y*o.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(o.x*o.x+o.y*o.y))>-.866&&r.x*o.x+r.y*o.y<0}function wf(t,e,i){const n=e?2|t:-3&t;return i?1|n:-2&n}function Ef(){const t=Math.PI/32,e=Math.tan(t),i=Ja;return i*Math.sqrt(1+2*e*e)-i}function Sf(t,e,i){const n=1<<i.z,r=ml(i.x/n),o=ml((i.x+1)/n),s=gl(i.y/n),a=gl((i.y+1)/n);return function(t,e,i,n,r=0,o){const s=[];if(!t.length||!i||!n)return s;const a=(t,e)=>{for(const i of t)s.push({polygon:i,bounds:e})},l=Math.ceil(Math.log2(i)),c=Math.ceil(Math.log2(n)),u=l-c,h=[];for(let t=0;t<Math.abs(u);t++)h.push(u>0?0:1);for(let t=0;t<Math.min(l,c);t++)h.push(0),h.push(1);let d=t;if(d=Pp(d,e[0].y-r,e[1].y+r,1),d=Pp(d,e[0].x-r,e[1].x+r,0),!d.length)return s;const p=[];for(h.length?p.push({polygons:d,bounds:e,depth:0}):a(d,e);p.length;){const t=p.pop(),e=t.depth,i=h[e],n=t.bounds[0],s=t.bounds[1],l=0===i?n.x:n.y,c=0===i?s.x:s.y,u=o?o(i,l,c):.5*(l+c),d=Pp(t.polygons,l-r,u+r,i),f=Pp(t.polygons,u-r,c+r,i);if(d.length){const t=[n,new _(0===i?u:s.x,1===i?u:s.y)];h.length>e+1?p.push({polygons:d,bounds:t,depth:e+1}):a(d,t)}if(f.length){const t=[new _(0===i?u:n.x,1===i?u:n.y),s];h.length>e+1?p.push({polygons:f,bounds:t,depth:e+1}):a(f,t)}}return s}(t,e,Math.ceil((o-r)/11.25),Math.ceil((s-a)/11.25),1,((t,e,r)=>{if(0===t)return.5*(e+r);{const t=gl((i.y+e/Li)/n);return(pl(.5*(gl((i.y+r/Li)/n)+t))*n-i.y)*Li}}))}function Tf(t,e,i,n,r,o){const s=Math.pow(2,n.z-r.z);for(let a=0;a<i;a++){let i=t.int16[2*(a+e)+0],l=t.int16[2*(a+e)+1];i=(i+r.x*Li)*s-n.x*Li,l=(l+r.y*Li)*s-n.y*Li,o.push(new _(i,l))}}io(mf,"FillExtrusionBucket",{omit:["layers","features"]}),io(cf,"PartData"),io(lf,"FootprintSegment"),io(uf,"BorderCentroidData"),io(ff,"GroundEffect");const Mf=new Vo({visibility:new zo(Ho["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new zo(Ho["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var If={paint:new Vo({"fill-extrusion-opacity":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Bo(Ho["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bo(Ho["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Bo(Ho["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Bo(Ho["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Bo(Ho["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Bo(Ho["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new zo(Ho["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:Mf};class Cf extends _{constructor(t,e,i){super(t,e),this.z=i}}function Af(t,e){return t.x*e.x+t.y*e.y}function Pf(t,e){if(1===t.length){let i=0;const n=e[i++];let r;for(;!r||n.equals(r);)if(r=e[i++],!r)return 1/0;for(;i<e.length;i++){const o=e[i],s=t[0],a=r.sub(n),l=o.sub(n),c=s.sub(n),u=Af(a,a),h=Af(a,l),d=Af(l,l),p=Af(c,a),f=Af(c,l),m=u*d-h*h,g=(d*p-h*f)/m,_=(u*f-h*p)/m,y=n.z*(1-g-_)+r.z*g+o.z*_;if(isFinite(y))return y}return 1/0}{let t=1/0;for(const i of e)t=Math.min(t,i.z);return t}}function Lf(t,e,i,n,r,o,s,a){const l=s*r.getElevationAt(t,e,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(t,e,i){const n=Math.floor(e[0]/8),r=Math.floor(e[1]/8),o=10*(e[0]-8*n),s=10*(e[1]-8*r),a=t.getElevationAt(n,r,!0,!0),l=t.getMeterToDEM(i),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=t.tileCoordToPixel(n,r),d=2*c+1,p=2*u+1,f=function(t,e,i,n,r){return[t.getElevationAtPixel(e,i,!0),t.getElevationAtPixel(e+r,i,!0),t.getElevationAtPixel(e,i+r,!0),t.getElevationAtPixel(e+n,i+r,!0)]}(t,h.x-c,h.y-u,d,p),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),_=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*l*(m+g)/d),v=Math.min(.25,.5*l*_/p);return a+Math.max(y*o,v*s)}(r,o,a):l;return{base:l+(0===i)?-1:i,top:c?Math.max(u+n,l+i+2):l+n}}const Rf=hs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Df}=Rf,kf=hs([{name:"a_packed",components:4,type:"Float32"}]),{members:Nf}=kf;class Of{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.image=new vd({width:t,height:e}),this.positions={},this.uploaded=!1}getDash(t,e){const i=this.getKey(t,e);return this.positions[i]}trim(){const t=this.width,e=this.height=k(this.nextRow);this.image.resize({width:t,height:e})}getKey(t,e){return t.join(",")+e}getDashRanges(t,e,i){const n=[];let r=t.length%2==1?-t[t.length-1]*i:0,o=t[0]*i,s=!0;n.push({left:r,right:o,isDash:s,zeroLength:0===t[0]});let a=t[0];for(let e=1;e<t.length;e++){s=!s;const l=t[e];r=a*i,a+=l,o=a*i,n.push({left:r,right:o,isDash:s,zeroLength:0===l})}return n}addRoundDash(t,e,i){const n=e/2;for(let e=-i;e<=i;e++){const r=this.width*(this.nextRow+i+e);let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=e/i*(n+1);if(s.isDash){const t=n-Math.abs(d);h=Math.sqrt(u*u+t*t)}else h=n-Math.sqrt(u*u+d*d);this.image.data[r+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t,e){for(let e=t.length-1;e>=0;--e){const i=t[e],n=t[e+1];i.zeroLength?t.splice(e,1):n&&n.isDash===i.isDash&&(n.left=i.left,t.splice(e,1))}const i=t[0],n=t[t.length-1];i.isDash===n.isDash&&(i.left=n.left-this.width,n.right=i.right+this.width);const r=this.width*this.nextRow;let o=0,s=t[o];for(let i=0;i<this.width;i++){i/s.right>1&&(s=t[++o]);const n=Math.abs(i-s.left),a=Math.abs(i-s.right),l=Math.min(n,a);this.image.data[r+i]=Math.max(0,Math.min(255,(s.isDash?l:-l)+e+128))}}addDash(t,e){const i=this.getKey(t,e);if(this.positions[i])return this.positions[i];const n="round"===e,r=n?7:0,o=2*r+1;if(this.nextRow+o>this.height)return j("LineAtlas out of space"),null;0===t.length&&t.push(1);let s=0;for(let e=0;e<t.length;e++)t[e]<0&&(j("Negative value is found in line dasharray, replacing values with 0"),t[e]=0),s+=t[e];if(0!==s){const i=this.width/s,o=this.getDashRanges(t,this.width,i);n?this.addRoundDash(o,i,r):this.addRegularDash(o,"square"===e?.5*i:0)}const a=this.nextRow+r;this.nextRow+=o;const l={tl:[a,r],br:[s,0]};return this.positions[i]=l,l}}io(Of,"LineAtlas");const Ff=Ap.types,zf=Math.cos(Math.PI/180*37.5);class Bf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new _s,this.layoutVertexArray2=new ys,this.indexArray=new Ps,this.programConfigurations=new Oa(t.layers,t.zoom),this.segments=new ia,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i,n){this.hasPattern=op("line",this.layers,e);const r=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:e,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Rl(e,t);if(!this.layers[0]._featureFilter.filter(new Ao(this.zoom),c,i))continue;const u=r?r.evaluate(c,{},i):void 0,h={id:s,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:Ll(e,i,n),patterns:{},sortKey:u};o.push(h)}r&&o.sort(((t,e)=>t.sortKey-e.sortKey));const{lineAtlas:s,featureIndex:a}=e,l=this.addConstantDashes(s);for(const n of o){const{geometry:r,index:o,sourceLayerIndex:c}=n;if(l&&this.addFeatureDashes(n,s),this.hasPattern){const t=sp("line",this.layers,n,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(n,r,o,i,s.positions,e.availableImages,e.brightness);a.insert(t[o].feature,r,o,c,this.index)}}addConstantDashes(t){let e=!1;for(const i of this.layers){const n=i.paint.get("line-dasharray").value,r=i.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==r.kind)e=!0;else{const e=r.value,i=n.value;if(!i)continue;t.addDash(i,e)}}return e}addFeatureDashes(t,e){const i=this.zoom;for(const n of this.layers){const r=n.paint.get("line-dasharray").value,o=n.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===o.kind)continue;let s,a;if("constant"===r.kind){if(s=r.value,!s)continue}else s=r.evaluate({zoom:i},t);a="constant"===o.kind?o.value:o.evaluate({zoom:i},t),e.addDash(s,a),t.patterns[n.id]=e.getKey(s,a)}}update(t,e,i,n,r){const o=0!==Object.keys(t).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,o?this.stateDependentLayers:this.layers,i,n,r)}addFeatures(t,e,i,n,r,o){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i,n,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Nf)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Df),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,i,n,r,o,s){const a=this.layers[0].layout,l=a.get("line-join").evaluate(t,{}),c=a.get("line-cap").evaluate(t,{}),u=a.get("line-miter-limit"),h=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const i of e)this.addLine(i,t,l,c,u,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,o,n,s)}addLine(t,e,i,n,r,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===Ff[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let l=0;for(;l<a-1&&t[l].equals(t[l+1]);)l++;if(a<(s?3:2))return;"bevel"===i&&(r=1.05);const c=this.overscaling<=16?15*Li/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,s&&(h=t[a-2],m=t[l].sub(h)._unit()._perp());for(let e=l;e<a;e++){if(p=e===a-1?s?t[l+1]:void 0:t[e+1],p&&t[e].equals(p))continue;m&&(f=m),h&&(d=h),h=t[e],m=p?p.sub(h)._unit()._perp():f,f=f||m;let g=f.add(m);0===g.x&&0===g.y||g._unit();const _=f.x*m.x+f.y*m.y,y=g.x*m.x+g.y*m.y,v=0!==y?1/y:1/0,x=2*Math.sqrt(2-2*y),b=y<zf&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&e>l){const t=h.dist(d);if(t>2*c){const e=h.sub(h.sub(d)._mult(c/t)._round());this.updateDistance(d,e),this.addCurrentVertex(e,f,0,0,u),d=e}}const E=d&&p;let S=E?i:s?"butt":n;if(E&&"round"===S&&(v<o?S="miter":v<=2&&(S="fakeround")),"miter"===S&&v>r&&(S="bevel"),"bevel"===S&&(v>2&&(S="flipbevel"),v<r&&(S="miter")),d&&this.updateDistance(d,h),"miter"===S)g._mult(v),this.addCurrentVertex(h,g,0,0,u);else if("flipbevel"===S){if(v>100)g=m.mult(-1);else{const t=v*f.add(m).mag()/f.sub(m).mag();g._perp()._mult(t*(w?-1:1))}this.addCurrentVertex(h,g,0,0,u),this.addCurrentVertex(h,g.mult(-1),0,0,u)}else if("bevel"===S||"fakeround"===S){const t=-Math.sqrt(v*v-1),e=w?t:0,i=w?0:t;if(d&&this.addCurrentVertex(h,f,e,i,u),"fakeround"===S){const t=Math.round(180*x/Math.PI/20);for(let e=1;e<t;e++){let i=e/t;if(.5!==i){const t=i-.5;i+=i*t*(i-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*t*t+(.848013+_*(.215638*_-1.06021)))}const n=m.sub(f)._mult(i)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,n.x,n.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-e,-i,u)}else if("butt"===S)this.addCurrentVertex(h,g,0,0,u);else if("square"===S){const t=d?1:-1;d||this.addCurrentVertex(h,g,t,t,u),this.addCurrentVertex(h,g,0,0,u),d&&this.addCurrentVertex(h,g,t,t,u)}else"round"===S&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&e<a-1){const t=h.dist(p);if(t>2*c){const e=h.add(p.sub(h)._mult(c/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,m,0,0,u),h=e}}}}addCurrentVertex(t,e,i,n,r,o=!1){const s=e.y*n-e.x,a=-e.y-e.x*n;this.addHalfVertex(t,e.x+e.y*i,e.y-e.x*i,o,!1,i,r),this.addHalfVertex(t,s,a,o,!0,-n,r)}addHalfVertex({x:t,y:e},i,n,r,o,s,a){this.layoutVertexArray.emplaceBack((t<<1)+(r?1:0),(e<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*n)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}io(Bf,"LineBucket",{omit:["layers","patternFeatures"]});const Uf=new Vo({"line-cap":new Bo(Ho.layout_line["line-cap"]),"line-join":new Bo(Ho.layout_line["line-join"]),"line-miter-limit":new zo(Ho.layout_line["line-miter-limit"]),"line-round-limit":new zo(Ho.layout_line["line-round-limit"]),"line-sort-key":new Bo(Ho.layout_line["line-sort-key"]),visibility:new zo(Ho.layout_line.visibility)});var Vf={paint:new Vo({"line-opacity":new Bo(Ho.paint_line["line-opacity"]),"line-color":new Bo(Ho.paint_line["line-color"]),"line-translate":new zo(Ho.paint_line["line-translate"]),"line-translate-anchor":new zo(Ho.paint_line["line-translate-anchor"]),"line-width":new Bo(Ho.paint_line["line-width"]),"line-gap-width":new Bo(Ho.paint_line["line-gap-width"]),"line-offset":new Bo(Ho.paint_line["line-offset"]),"line-blur":new Bo(Ho.paint_line["line-blur"]),"line-dasharray":new Bo(Ho.paint_line["line-dasharray"]),"line-pattern":new Bo(Ho.paint_line["line-pattern"]),"line-gradient":new Uo(Ho.paint_line["line-gradient"]),"line-trim-offset":new zo(Ho.paint_line["line-trim-offset"]),"line-emissive-strength":new zo(Ho.paint_line["line-emissive-strength"]),"line-border-width":new Bo(Ho.paint_line["line-border-width"]),"line-border-color":new Bo(Ho.paint_line["line-border-color"])}),layout:Uf};function jf(t,e,i){return e*(Li/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}function Gf(t,e){return 1/jf(t,1,e.tileZoom)}function Hf(t,e,i,n){return t.translatePosMatrix(n||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Wf=t=>{const e=[];qf(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");return 0===i[0]&&0===i[1]||e.push("RENDER_LINE_TRIM_OFFSET"),0!==t.paint.get("line-border-width").constantOr(1)&&e.push("RENDER_LINE_BORDER"),e};function qf(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const Xf=new class extends Bo{possiblyEvaluate(t,e){return e=new Ao(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,n){return e=P({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,n)}}(Vf.paint.properties["line-width"].specification);function $f(t,e){return e>0?e+2*t:t}Xf.useIntegerZoom=!0;const Yf=hs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Zf=hs([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Kf=hs([{name:"a_projected_pos",components:4,type:"Float32"}],4);hs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jf=hs([{name:"a_z_offset",components:1,type:"Float32"}],4),Qf=hs([{name:"a_texb",components:2,type:"Uint16"}]),tm=hs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),em=hs([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);hs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const im=hs([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nm=hs([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);hs([{name:"triangle",components:3,type:"Uint16"}]),hs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),hs([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),hs([{type:"Float32",name:"offsetX"}]),hs([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var rm=24;const om=128;function sm(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Ao(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:n}=i;let r=0;for(;r<e.length&&e[r]<=t;)r++;r=Math.max(0,r-1);let o=r;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const s=e[r],a=e[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:n}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new Ao(s)),maxSize:i.evaluate(new Ao(a)),interpolationType:n}}}function am(t,{uSize:e,uSizeT:i},{lowerSize:n,upperSize:r}){return"source"===t.kind?n/om:"composite"===t.kind?ce(n/om,r/om,i):e}function lm(t,e){let i=0,n=0;if("constant"===t.kind)n=t.layoutSize;else if("source"!==t.kind){const{interpolationType:r,minZoom:o,maxZoom:s}=t,a=r?M(qn.interpolationFactor(r,e,o,s),0,1):0;"camera"===t.kind?n=ce(t.minSize,t.maxSize,a):i=a}return{uSizeT:i,uSize:n}}var cm=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:om,evaluateSizeForFeature:am,evaluateSizeForZoom:lm,getSizeData:sm});function um(t,e,i){return t.sections.forEach((t=>{t.text=function(t,e,i){const n=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),Co.applyArabicShaping&&(t=Co.applyArabicShaping(t)),t}(t.text,e,i)})),t}const hm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function dm(t){return""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t}function pm(t){return""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t}var fm={read:function(t,e,i,n,r){var o,s,a=8*r-n-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?r-1:0,d=i?-1:1,p=t[e+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=n;u>0;s=256*s+t[e+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=c}return(p?-1:1)*s*Math.pow(2,o-n)},write:function(t,e,i,n,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,f=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,r),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;t[i+p]=255&a,p+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;t[i+p]=255&s,p+=f,s/=256,c-=8);t[i+p-f]|=128*m}},mm=_m,gm=fm;function _m(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}_m.Varint=0,_m.Fixed64=1,_m.Bytes=2,_m.Fixed32=5;var ym=4294967296,vm=1/ym,xm="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function bm(t){return t.type===_m.Bytes?t.readVarint()+t.pos:t.pos+1}function wm(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Em(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}function Sm(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Tm(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Mm(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Im(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function Cm(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Am(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Pm(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Lm(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Rm(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Dm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function km(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Nm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}_m.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;this.type=7&n,t(r,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Dm(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Nm(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Dm(this.buf,this.pos)+Dm(this.buf,this.pos+4)*ym;return this.pos+=8,t},readSFixed64:function(){var t=Dm(this.buf,this.pos)+Nm(this.buf,this.pos+4)*ym;return this.pos+=8,t},readFloat:function(){var t=gm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=gm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,o=i.buf;if(n=(112&(r=o[i.pos++]))>>4,r<128)return wm(t,n,e);if(n|=(127&(r=o[i.pos++]))<<3,r<128)return wm(t,n,e);if(n|=(127&(r=o[i.pos++]))<<10,r<128)return wm(t,n,e);if(n|=(127&(r=o[i.pos++]))<<17,r<128)return wm(t,n,e);if(n|=(127&(r=o[i.pos++]))<<24,r<128)return wm(t,n,e);if(n|=(1&(r=o[i.pos++]))<<31,r<128)return wm(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&xm?function(t,e,i){return xm.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var n="",r=e;r<i;){var o,s,a,l=t[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=t[r+2],128==(192&(o=t[r+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=t[r+2],a=t[r+3],128==(192&(o=t[r+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=u}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==_m.Bytes)return t.push(this.readVarint(e));var i=bm(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==_m.Bytes)return t.push(this.readSVarint());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==_m.Bytes)return t.push(this.readBoolean());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==_m.Bytes)return t.push(this.readFloat());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==_m.Bytes)return t.push(this.readDouble());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==_m.Bytes)return t.push(this.readFixed32());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==_m.Bytes)return t.push(this.readSFixed32());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==_m.Bytes)return t.push(this.readFixed64());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==_m.Bytes)return t.push(this.readSFixed64());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===_m.Varint)for(;this.buf[this.pos++]>127;);else if(e===_m.Bytes)this.pos=this.readVarint()+this.pos;else if(e===_m.Fixed32)this.pos+=4;else{if(e!==_m.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),km(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),km(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),km(this.buf,-1&t,this.pos),km(this.buf,Math.floor(t*vm),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),km(this.buf,-1&t,this.pos),km(this.buf,Math.floor(t*vm),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,n;if(t>=0?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){n>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Em(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),gm.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),gm.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&Em(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,_m.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Sm,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Tm,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Cm,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Mm,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Im,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Am,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Pm,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Lm,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Rm,e)},writeBytesField:function(t,e){this.writeTag(t,_m.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,_m.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,_m.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,_m.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,_m.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,_m.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,_m.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,_m.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,_m.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,_m.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Om=h(mm);const Fm=3;function zm(t,e,i){e.glyphs=[],1===t&&i.readMessage(Bm,e)}function Bm(t,e,i){if(3===t){const{id:t,bitmap:n,width:r,height:o,left:s,top:a,advance:l}=i.readMessage(Um,{});e.glyphs.push({id:t,bitmap:new vd({width:r+2*Fm,height:o+2*Fm},n),metrics:{width:r,height:o,left:s,top:a,advance:l}})}else 4===t?e.ascender=i.readSVarint():5===t&&(e.descender=i.readSVarint())}function Um(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}const Vm=Fm,jm={horizontal:1,vertical:2,horizontalOnly:3};class Gm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const i=new Gm;return i.scale=t||1,i.fontStack=e,i}static forImage(t){const e=new Gm;return e.imageName=t,e}}class Hm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const i=new Hm;for(let n=0;n<t.sections.length;n++){const r=t.sections[n];r.image?i.addImageSection(r):i.addTextSection(r,e)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(t,e){let i="";for(let n=0;n<t.length;n++){const r=t.charCodeAt(n+1)||null,o=t.charCodeAt(n-1)||null;i+=!e&&(r&&po(r)&&!hm[t[n+1]]||o&&po(o)&&!hm[t[n-1]])||!hm[t[n]]?t[n]:hm[t[n]]}return i}(this.text,t)}trim(){let t=0;for(let e=0;e<this.text.length&&qm[this.text.charCodeAt(e)];e++)t++;let e=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&qm[this.text.charCodeAt(i)];i--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const i=new Hm;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(Gm.forText(t.scale,t.fontStack||e));const i=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(i)}addImageSection(t){const e=t.image?t.image.namePrimary:"";if(0===e.length)return void j("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(Gm.forImage(e)),this.sectionIndex.push(this.sections.length-1)):j("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wm(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f){const m=Hm.fromFeature(t,r);h===jm.vertical&&m.verticalizePunctuation(d);let g=[];const _=function(t,e,i,n,r,o){if(!t)return[];const s=[],a=function(t,e,i,n,r,o){let s=0;for(let i=0;i<t.length();i++){const a=t.getSection(i);s+=$m(t.getCodePoint(i),a,n,r,e,o)}return s/Math.max(1,Math.ceil(s/i))}(t,e,i,n,r,o),l=t.text.indexOf("")>=0;let c=0;for(let i=0;i<t.length();i++){const h=t.getSection(i),d=t.getCodePoint(i);if(qm[d]||(c+=$m(d,h,n,r,e,o)),i<t.length()-1){const e=!((u=d)<11904||!(ao["Bopomofo Extended"](u)||ao.Bopomofo(u)||ao["CJK Compatibility Forms"](u)||ao["CJK Compatibility Ideographs"](u)||ao["CJK Compatibility"](u)||ao["CJK Radicals Supplement"](u)||ao["CJK Strokes"](u)||ao["CJK Symbols and Punctuation"](u)||ao["CJK Unified Ideographs Extension A"](u)||ao["CJK Unified Ideographs"](u)||ao["Enclosed CJK Letters and Months"](u)||ao["Halfwidth and Fullwidth Forms"](u)||ao.Hiragana(u)||ao["Ideographic Description Characters"](u)||ao["Kangxi Radicals"](u)||ao["Katakana Phonetic Extensions"](u)||ao.Katakana(u)||ao["Vertical Forms"](u)||ao["Yi Radicals"](u)||ao["Yi Syllables"](u)));(Xm[d]||e||h.imageName)&&s.push(Km(i+1,c,a,s,Zm(d,t.getCodePoint(i+1),e&&l),!1))}}var u;return Jm(Km(t.length(),c,a,s,0,!0))}(m,c,o,e,n,p),{processBidirectionalText:y,processStyledBidirectionalText:v}=Co;if(y&&1===m.sections.length){const t=y(m.toString(),_);for(const e of t){const t=new Hm;t.text=e,t.sections=m.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);g.push(t)}}else if(v){const t=v(m.text,m.sectionIndex,_);for(const e of t){const t=new Hm;t.text=e[0],t.sectionIndex=e[1],t.sections=m.sections,g.push(t)}}else g=function(t,e){const i=[],n=t.text;let r=0;for(const n of e)i.push(t.substring(r,n)),r=n;return r<n.length&&i.push(t.substring(r,n.length)),i}(m,_);const x=[],b={positionedLines:x,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(t,e,i,n,r,o,s,a,l,c,u,h){let d=0,p=0,f=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const t of r){const i=t.getSections();for(const t of i){if(t.imageName)continue;const i=e[t.fontStack];if(i&&(g=void 0!==i.ascender&&void 0!==i.descender,!g))break}if(!g)break}let _=0;for(const s of r){s.trim();const r=s.getMaxScale(),a=(r-1)*rm,v={positionedGlyphs:[],lineOffset:0};t.positionedLines[_]=v;const x=v.positionedGlyphs;let b=0;if(!s.length()){p+=o,++_;continue}let w=0,E=0;for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),m=s.getCodePoint(o);let _=a.scale,v=null,S=null,T=null,M=rm,I=0;const C=!(l===jm.horizontal||!u&&!ho(m)||u&&(qm[m]||(y=m,ao.Arabic(y)||ao["Arabic Supplement"](y)||ao["Arabic Extended-A"](y)||ao["Arabic Presentation Forms-A"](y)||ao["Arabic Presentation Forms-B"](y))));if(a.imageName){const e=n[a.imageName];if(!e)continue;T=a.imageName,t.iconsInText=t.iconsInText||!0,S=e.paddedRect;const i=e.displaySize;_=_*rm/h,v={width:i[0],height:i[1],left:0,top:-Vm,advance:C?i[1]:i[0],localGlyph:!1},I=g?-v.height*_:r*rm-17-i[1]*_,M=v.advance;const o=(C?i[0]:i[1])*_-rm*r;o>0&&o>b&&(b=o)}else{const t=i[a.fontStack];if(!t)continue;t[m]&&(S=t[m]);const n=e[a.fontStack];if(!n)continue;const o=n.glyphs[m];if(!o)continue;if(v=o.metrics,M=8203!==m?rm:0,g){const t=void 0!==n.ascender?Math.abs(n.ascender):0,e=void 0!==n.descender?Math.abs(n.descender):0,i=(t+e)*_;w<i&&(w=i,E=(t-e)/2*_),I=-t*_}else I=(r-_)*rm-17}C?(t.verticalizable=!0,x.push({glyph:m,imageName:T,x:d,y:p+I,vertical:C,scale:_,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:S}),d+=M*_+c):(x.push({glyph:m,imageName:T,x:d,y:p+I,vertical:C,scale:_,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:S}),d+=v.advance*_+c)}0!==x.length&&(f=Math.max(d-c,f),g?tg(x,m,b,E,o*r/2):tg(x,m,b,0,o/2)),d=0;const S=o*r+b;v.lineOffset=Math.max(b,a),p+=S,++_}var y;const v=p,{horizontalAlign:x,verticalAlign:b}=Qm(s);(function(t,e,i,n,r,o){const s=(e-i)*r,a=-o*n;for(const e of t)for(const t of e.positionedGlyphs)t.x+=s,t.y+=a})(t.positionedLines,m,x,b,f,v),t.top+=-b*v,t.bottom=t.top+v,t.left+=-x*f,t.right=t.left+f,t.hasBaseline=g}(b,e,i,n,g,s,a,l,h,c,d,f),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(x)&&b}const qm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Xm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function $m(t,e,i,n,r,o){if(e.imageName){const t=n[e.imageName];return t?t.displaySize[0]*e.scale*rm/o+r:0}{const n=i[e.fontStack],o=n&&n.glyphs[t];return o?o.metrics.advance*e.scale+r:0}}function Ym(t,e,i,n){const r=Math.pow(t-e,2);return n?t<e?r/2:2*r:r+Math.abs(i)*i}function Zm(t,e,i){let n=0;return 10===t&&(n-=1e4),i&&(n+=150),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function Km(t,e,i,n,r,o){let s=null,a=Ym(e,i,r,o);for(const t of n){const n=Ym(e-t.x,i,r,o)+t.badness;n<=a&&(s=t,a=n)}return{index:t,x:e,priorBreak:s,badness:a}}function Jm(t){return t?Jm(t.priorBreak).concat(t.index):[]}function Qm(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function tg(t,e,i,n,r){if(!(e||i||n||r))return;const o=t.length-1,s=t[o],a=(s.x+s.metrics.advance*s.scale)*e;for(let e=0;e<=o;e++)t[e].x-=a,t[e].y+=i+n+r}function eg(t,e,i,n){const{horizontalAlign:r,verticalAlign:o}=Qm(n),s=i[0]-t.displaySize[0]*r,a=i[1]-t.displaySize[1]*o;return{imagePrimary:t,imageSecondary:e,top:a,bottom:a+t.displaySize[1],left:s,right:s+t.displaySize[0]}}function ig(t,e,i,n,r,o){const s=t.imagePrimary;let a;if(s.content){const t=s.content,e=s.pixelRatio||1;a=[t[0]/e,t[1]/e,s.displaySize[0]-t[2]/e,s.displaySize[1]-t[3]/e]}const l=e.left*o,c=e.right*o;let u,h,d,p;"width"===i||"both"===i?(p=r[0]+l-n[3],h=r[0]+c+n[1]):(p=r[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=e.top*o,m=e.bottom*o;return"height"===i||"both"===i?(u=r[1]+f-n[0],d=r[1]+m+n[2]):(u=r[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{imagePrimary:s,imageSecondary:void 0,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class ng extends _{constructor(t,e,i,n,r){super(t,e),this.angle=n,this.z=i,void 0!==r&&(this.segment=r)}clone(){return new ng(this.x,this.y,this.z,this.angle,this.segment)}}function rg(t,e,i,n,r){if(void 0===e.segment)return!0;let o=e,s=e.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const e=t[s],i=t[s+1];if(!i)return!1;let o=t[s-1].angleTo(e)-e.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>n;)c-=l.shift().angleDelta;if(c>r)return!1;s++,a+=e.dist(i)}return!0}function og(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function sg(t,e,i){return t?.6*e*i:0}function ag(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function lg(t,e,i,n,r,o){const s=sg(i,r,o),a=ag(i,n)*o;let l=0;const c=og(t)/2;for(let i=0;i<t.length-1;i++){const n=t[i],r=t[i+1],o=n.dist(r);if(l+o>c){const u=(c-l)/o,h=ce(n.x,r.x,u),d=ce(n.y,r.y,u),p=new ng(h,d,0,r.angleTo(n),i);return!s||rg(t,p,a,s,e)?p:void 0}l+=o}}function cg(t,e,i,n,r,o,s,a,l){const c=sg(n,o,s),u=ag(n,r),h=u*s,d=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),ug(t,d?e/2*a%e:(u/2+2*o)*s*a%e,e,c,i,h,d,!1,l)}function ug(t,e,i,n,r,o,s,a,l){const c=o/2,u=og(t);let h=0,d=e-i,p=[];for(let e=0;e<t.length-1;e++){const s=t[e],a=t[e+1],f=s.dist(a),m=a.angleTo(s);for(;d+i<h+f;){d+=i;const g=(d-h)/f,_=ce(s.x,a.x,g),y=ce(s.y,a.y,g);if(_>=0&&_<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const i=new ng(_,y,0,m,e);n&&!rg(t,i,o,n,r)||p.push(i)}}h+=f}return a||p.length||s||(p=ug(t,h/2,i,n,r,o,s,!0,l)),p}function hg(t,e,i,n,r){const o=[];for(let s=0;s<t.length;s++){const a=t[s];let l;for(let t=0;t<a.length-1;t++){let s=a[t],c=a[t+1];s.x<e&&c.x<e||(s.x<e?s=new _(e,s.y+(e-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x<e&&(c=new _(e,s.y+(e-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y<i&&c.y<i||(s.y<i?s=new _(s.x+(i-s.y)/(c.y-s.y)*(c.x-s.x),i)._round():c.y<i&&(c=new _(s.x+(i-s.y)/(c.y-s.y)*(c.x-s.x),i)._round()),s.x>=n&&c.x>=n||(s.x>=n?s=new _(n,s.y+(n-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x>=n&&(c=new _(n,s.y+(n-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y>=r&&c.y>=r||(s.y>=r?s=new _(s.x+(r-s.y)/(c.y-s.y)*(c.x-s.x),r)._round():c.y>=r&&(c=new _(s.x+(r-s.y)/(c.y-s.y)*(c.x-s.x),r)._round()),l&&s.equals(l[l.length-1])||(l=[s],o.push(l)),l.push(c)))))}}return o}function dg(t){let e=0,i=0;for(const n of t)e+=n.w*n.h,i=Math.max(i,n.w);t.sort(((t,e)=>e.h-t.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let r=0,o=0;for(const e of t)for(let t=n.length-1;t>=0;t--){const i=n[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,o=Math.max(o,e.y+e.h),r=Math.max(r,e.x+e.w),e.w===i.w&&e.h===i.h){const e=n.pop();t<n.length&&(n[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):e.w===i.w?(i.y+=e.h,i.h-=e.h):(n.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:r,h:o,fill:e/(r*o)||0}}io(ng,"Anchor");const pg=1;class fg{constructor(t,{pixelRatio:e,version:i,stretchX:n,stretchY:r,content:o}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=n,this.stretchY=r,this.content=o,this.version=i}get tl(){return[this.paddedRect.x+pg,this.paddedRect.y+pg]}get br(){return[this.paddedRect.x+this.paddedRect.w-pg,this.paddedRect.y+this.paddedRect.h-pg]}get displaySize(){return[(this.paddedRect.w-2*pg)/this.pixelRatio,(this.paddedRect.h-2*pg)/this.pixelRatio]}}class mg{constructor(t,e){const i={},n={};this.haveRenderCallbacks=[];const r=[];this.addImages(t,i,r),this.addImages(e,n,r);const{w:o,h:s}=dg(r),a=new xd({width:o||1,height:s||1});for(const e in t){const n=t[e],r=i[e].paddedRect;xd.copy(n.data,a,{x:0,y:0},{x:r.x+pg,y:r.y+pg},n.data,n.sdf)}for(const t in e){const i=e[t],r=n[t].paddedRect,o=r.x+pg,s=r.y+pg,l=i.data.width,c=i.data.height;xd.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),xd.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),xd.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),xd.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),xd.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=n}addImages(t,e,i){for(const n in t){const r=t[n],o={x:0,y:0,w:r.data.width+2*pg,h:r.data.height+2*pg};i.push(o),e[n]=new fg(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(t,e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((e=>t.hasImage(e,i))),t.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const n in t.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[n],t.getImage(n,i),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n,i),e)}patchUpdatedImage(t,e,i){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[n,r]=t.tl,o=!!Object.keys(this.patternPositions).length;i.update(e.data,{useMipmap:o},{x:n,y:r})}}io(fg,"ImagePosition"),io(mg,"ImageAtlas");const gg=1e20;function _g(t,e,i,n,r,o,s,a,l){for(let c=e;c<e+n;c++)yg(t,i*o+c,o,r,s,a,l);for(let c=i;c<i+r;c++)yg(t,c*o+e,1,n,s,a,l)}function yg(t,e,i,n,r,o,s){o[0]=0,s[0]=-gg,s[1]=gg,r[0]=t[e];for(let a=1,l=0,c=0;a<n;a++){r[a]=t[e+a*i];const n=a*a;do{const t=o[l];c=(r[a]-r[t]+n-t*t)/(a-t)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=gg}for(let a=0,l=0;a<n;a++){for(;s[l+1]<a;)l++;const n=o[l],c=a-n;t[e+a*i]=r[n]+c*c}}const vg=2,xg={none:0,ideographs:1,all:2};class bg{constructor(t,e,i){this.requestManager=t,this.localGlyphMode=e,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,e){this.urls[e]=t}getGlyphs(t,e,i){const r=[],o=this.urls[e]||n.GLYPHS_URL;for(const e in t)for(const i of t[e])r.push({stack:e,id:i});A(r,(({stack:t,id:e},i)=>{let n=this.entries[t];n||(n=this.entries[t]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let r=n.glyphs[e];if(void 0!==r)return void i(null,{stack:t,id:e,glyph:r});if(r=this._tinySDF(n,t,e),r)return n.glyphs[e]=r,void i(null,{stack:t,id:e,glyph:r});const s=Math.floor(e/256);if(256*s>65535)return void i(new Error("glyphs > 65535 not supported"));if(n.ranges[s])return void i(null,{stack:t,id:e,glyph:r});let a=n.requests[s];a||(a=n.requests[s]=[],bg.loadGlyphRange(t,s,o,this.requestManager,((t,e)=>{if(e){n.ascender=e.ascender,n.descender=e.descender;for(const t in e.glyphs)this._doesCharSupportLocalGlyph(+t)||(n.glyphs[+t]=e.glyphs[+t]);n.ranges[s]=!0}for(const i of a)i(t,e);delete n.requests[s]}))),a.push(((n,r)=>{n?i(n):r&&i(null,{stack:t,id:e,glyph:r.glyphs[e]||null})}))}),((t,e)=>{if(t)i(t);else if(e){const t={};for(const{stack:i,id:n,glyph:r}of e)void 0===t[i]&&(t[i]={}),void 0===t[i].glyphs&&(t[i].glyphs={}),t[i].glyphs[n]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics},t[i].ascender=this.entries[i].ascender,t[i].descender=this.entries[i].descender;i(null,t)}}))}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==xg.none&&(this.localGlyphMode===xg.all?!!this.localFontFamily:!!this.localFontFamily&&(ao["CJK Unified Ideographs"](t)||ao["Hangul Syllables"](t)||ao.Hiragana(t)||ao.Katakana(t)||ao["CJK Symbols and Punctuation"](t)||ao["CJK Unified Ideographs Extension A"](t)||ao["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,e,i){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(i))return;let r=t.tinySDF;if(!r){let i="400";/bold/i.test(e)?i="900":/medium/i.test(e)?i="500":/light/i.test(e)&&(i="200"),r=t.tinySDF=new bg.TinySDF({fontFamily:n,fontWeight:i,fontSize:24*vg,buffer:3*vg,radius:8*vg}),r.fontWeight=i}if(this.localGlyphs[r.fontWeight][i])return this.localGlyphs[r.fontWeight][i];const o=String.fromCodePoint(i),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=r.draw(o);return this.localGlyphs[r.fontWeight][i]={id:i,bitmap:new vd({width:a,height:l},s),metrics:{width:c/vg,height:u/vg,left:h/vg,top:d/vg-27,advance:p/vg,localGlyph:!0}}}}bg.loadGlyphRange=function(t,e,i,n,r){const o=256*e,s=o+255,a=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${o}-${s}`),St.Glyphs);Ct(a,((t,e)=>{if(t)r(t);else if(e){const t={},i=function(t){return new Om(t).readFields(zm,{})}(e);for(const e of i.glyphs)t[e.id]=e;r(null,{glyphs:t,ascender:i.ascender,descender:i.descender})}}))},bg.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:n=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=i;const a=this.size=t+4*e,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${t}px ${r}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(t),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),l=Math.min(this.size-this.buffer,s+Math.ceil(n)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this;f.clearRect(m,m,a,l),f.fillText(t,m,m+s);const y=f.getImageData(m,m,a,l);_.fill(gg,0,h),g.fill(0,0,h);for(let t=0;t<l;t++)for(let e=0;e<a;e++){const i=y.data[4*(t*a+e)+3]/255;if(0===i)continue;const n=(t+m)*c+e+m;if(1===i)_[n]=0,g[n]=gg;else{const t=.5-i;_[n]=t>0?t*t:0,g[n]=t<0?t*t:0}}_g(_,0,0,c,u,c,this.f,this.v,this.z),_g(g,m,m,a,l,c,this.f,this.v,this.z);for(let t=0;t<h;t++){const e=Math.sqrt(_[t])-Math.sqrt(g[t]);d[t]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};const wg=pg;function Eg(t,e,i,n){const r=[],o=t.imagePrimary,s=o.pixelRatio,a=o.paddedRect.w-2*wg,l=o.paddedRect.h-2*wg,c=t.right-t.left,u=t.bottom-t.top,h=o.stretchX||[[0,a]],d=o.stretchY||[[0,l]],p=(t,e)=>t+e[1]-e[0],f=h.reduce(p,0),m=d.reduce(p,0),g=a-f,y=l-m;let v=0,x=f,b=0,w=m,E=0,S=g,T=0,M=y;if(o.content&&n){const t=o.content;v=Sg(h,0,t[0]),b=Sg(d,0,t[1]),x=Sg(h,t[0],t[2]),w=Sg(d,t[1],t[3]),E=t[0]-v,T=t[1]-b,S=t[2]-t[0]-x,M=t[3]-t[1]-w}const I=(n,r,a,l)=>{const h=Mg(n.stretch-v,x,c,t.left),d=Ig(n.fixed-E,S,n.stretch,f),p=Mg(r.stretch-b,w,u,t.top),g=Ig(r.fixed-T,M,r.stretch,m),y=Mg(a.stretch-v,x,c,t.left),I=Ig(a.fixed-E,S,a.stretch,f),C=Mg(l.stretch-b,w,u,t.top),A=Ig(l.fixed-T,M,l.stretch,m),P=new _(h,p),L=new _(y,p),R=new _(y,C),D=new _(h,C),k=new _(d/s,g/s),N=new _(I/s,A/s),O=e*Math.PI/180;if(O){const t=Math.sin(O),e=Math.cos(O),i=[e,-t,t,e];P._matMult(i),L._matMult(i),D._matMult(i),R._matMult(i)}const F=n.stretch+n.fixed,z=a.stretch+a.fixed,B=r.stretch+r.fixed,U=l.stretch+l.fixed,V=t.imageSecondary;return{tl:P,tr:L,bl:D,br:R,texPrimary:{x:o.paddedRect.x+wg+F,y:o.paddedRect.y+wg+B,w:z-F,h:U-B},texSecondary:V?{x:V.paddedRect.x+wg+F,y:V.paddedRect.y+wg+B,w:z-F,h:U-B}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:k,pixelOffsetBR:N,minFontScaleX:S/s/c,minFontScaleY:M/s/u,isSDF:i}};if(n&&(o.stretchX||o.stretchY)){const t=Tg(h,g,f),e=Tg(d,y,m);for(let i=0;i<t.length-1;i++){const n=t[i],o=t[i+1];for(let t=0;t<e.length-1;t++)r.push(I(n,e[t],o,e[t+1]))}}else r.push(I({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:l+1}));return r}function Sg(t,e,i){let n=0;for(const r of t)n+=Math.max(e,Math.min(i,r[1]))-Math.max(e,Math.min(i,r[0]));return n}function Tg(t,e,i){const n=[{fixed:-wg,stretch:0}];for(const[e,i]of t){const t=n[n.length-1];n.push({fixed:e-t.stretch,stretch:t.stretch}),n.push({fixed:e-t.stretch,stretch:t.stretch+(i-e)})}return n.push({fixed:e+wg,stretch:i}),n}function Mg(t,e,i,n){return t/e*i+n}function Ig(t,e,i,n){return t-e*i/n}function Cg(t,e,i,n){const r=e+t.positionedLines[n].lineOffset;return 0===n?i+r/2:i+(r+(e+t.positionedLines[n-1].lineOffset))/2}function Ag(t,e=1,i=!1){let n=1/0,r=1/0,o=-1/0,s=-1/0;const a=t[0];for(let t=0;t<a.length;t++){const e=a[t];(!t||e.x<n)&&(n=e.x),(!t||e.y<r)&&(r=e.y),(!t||e.x>o)&&(o=e.x),(!t||e.y>s)&&(s=e.y)}const l=Math.min(o-n,s-r);let c=l/2;const u=new Pi([],Pg);if(0===l)return new _(n,r);for(let e=n;e<o;e+=l)for(let i=r;i<s;i+=l)u.push(new Lg(e+c,i+c,c,t));let h=function(t){let e=0,i=0,n=0;const r=t[0];for(let t=0,o=r.length,s=o-1;t<o;s=t++){const o=r[t],a=r[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,n+=(o.y+a.y)*l,e+=3*l}return new Lg(i/e,n/e,0,t)}(t),d=u.length;for(;u.length;){const n=u.pop();(n.d>h.d||!h.d)&&(h=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,d)),n.max-h.d<=e||(c=n.h/2,u.push(new Lg(n.p.x-c,n.p.y-c,c,t)),u.push(new Lg(n.p.x+c,n.p.y-c,c,t)),u.push(new Lg(n.p.x-c,n.p.y+c,c,t)),u.push(new Lg(n.p.x+c,n.p.y+c,c,t)),d+=4)}return i&&(console.log(`num probes: ${d}`),console.log(`best distance: ${h.d}`)),h.p}function Pg(t,e){return e.max-t.max}class Lg{constructor(t,e,i,n){this.p=new _(t,e),this.h=i,this.d=function(t,e){let i=!1,n=1/0;for(let r=0;r<e.length;r++){const o=e[r];for(let e=0,r=o.length,s=r-1;e<r;s=e++){const r=o[e],a=o[s];r.y>t.y!=a.y>t.y&&t.x<(a.x-r.x)*(t.y-r.y)/(a.y-r.y)+r.x&&(i=!i),n=Math.min(n,Gl(t,r,a))}}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}}const Rg=Number.POSITIVE_INFINITY,Dg=Math.sqrt(2);function kg(t,[e,i]){let n=0,r=0;if(i===Rg){e<0&&(e=0);const i=e/Dg;switch(t){case"top-right":case"top-left":r=i-7;break;case"bottom-right":case"bottom-left":r=7-i;break;case"bottom":r=7-e;break;case"top":r=e-7}switch(t){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=e;break;case"right":n=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":r=i-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-i}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}}return[n,r]}function Ng(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Og(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f){let m=o.textMaxSize.evaluate(e,{},h);void 0===m&&(m=s);const g=t.layers[0].layout,_=g.get("icon-offset").evaluate(e,{},h),y=Ug(i.horizontal)||i.vertical,v="globe"===d.name,b=rm,w=s/b,E=t.tilePixelRatio*m/b,S=(R=t.overscaling,t.zoom>18&&R>2&&(R>>=1),Math.max(Li/(512*R),1)*g.get("symbol-spacing")),T=g.get("text-padding")*t.tilePixelRatio,M=g.get("icon-padding")*t.tilePixelRatio,I=x(g.get("text-max-angle")),C="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement"),A="map"===g.get("icon-rotation-alignment")&&"point"!==g.get("symbol-placement"),P=g.get("symbol-placement"),L=S/2;var R;const D=g.get("icon-text-fit").evaluate(e,{},h),k=g.get("icon-text-fit-padding").evaluate(e,{},h),N="none"!==D;let O;!1===t.hasAnyIconTextFit&&N&&(t.hasAnyIconTextFit=!0),n&&N&&(t.allowVerticalPlacement&&i.vertical&&(O=ig(n,i.vertical,D,k,_,w)),y&&(n=ig(n,y,D,k,_,w)));const F=(s,a,m)=>{if(a.x<0||a.x>=Li||a.y<0||a.y>=Li)return;let g=null;if(v){const{x:t,y:e,z:i}=d.projectTilePoint(a.x,a.y,m);g={anchor:new ng(t,e,i,0,void 0),up:d.upVector(m,a.x,a.y)}}!function(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,E,S,T,M){const I=t.addToLineVertexArray(e,n);let C,A,P,L,R,D,k,N=0,O=0,F=0,z=0,B=-1,U=-1;const V={};let G=da("");const H=i?i.anchor:e,W="none"!==l.layout.get("icon-text-fit").evaluate(x,{},S);let q=0,X=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[q,X]=l.layout.get("text-offset").evaluate(x,{},S).map((t=>t*rm)):(q=l.layout.get("text-radial-offset").evaluate(x,{},S)*rm,X=Rg),t.allowVerticalPlacement&&r.vertical){const t=r.vertical;if(f)D=jg(t),a&&(k=jg(a));else{const i=l.layout.get("text-rotate").evaluate(x,{},S)+90;P=Vg(c,H,e,u,h,d,t,p,i,m),a&&(L=Vg(c,H,e,u,h,d,a,_,i))}}if(o){const n=l.layout.get("icon-rotate").evaluate(x,{},S),r=Eg(o,n,w,W),s=a?Eg(a,n,w,W):void 0;A=Vg(c,H,e,u,h,d,o,_,n),N=4*r.length;const p=t.iconSizeData;let f=null;"source"===p.kind?(f=[om*l.layout.get("icon-size").evaluate(x,{},S)],f[0]>zg&&j(`${t.layerIds[0]}: Value for "icon-size" is >= ${Fg}. Reduce your "icon-size".`)):"composite"===p.kind&&(f=[om*b.compositeIconSizes[0].evaluate(x,{},S),om*b.compositeIconSizes[1].evaluate(x,{},S)],(f[0]>zg||f[1]>zg)&&j(`${t.layerIds[0]}: Value for "icon-size" is >= ${Fg}. Reduce your "icon-size".`)),t.addSymbols(t.icon,r,f,v,y,x,!1,i,e,I.lineStartIndex,I.lineLength,-1,E,S,T,M),B=t.icon.placedSymbolArray.length-1,s&&(O=4*s.length,t.addSymbols(t.icon,s,f,v,y,x,jm.vertical,i,e,I.lineStartIndex,I.lineLength,-1,E,S,T,M),U=t.icon.placedSymbolArray.length-1)}for(const n in r.horizontal){const o=r.horizontal[n];C||(G=da(o.text),f?R=jg(o):C=Vg(c,H,e,u,h,d,o,p,l.layout.get("text-rotate").evaluate(x,{},S),m));const a=1===o.positionedLines.length;if(F+=Bg(t,i,e,o,s,l,f,x,m,I,r.vertical?jm.horizontal:jm.horizontalOnly,a?Object.keys(r.horizontal):[n],V,B,b,E,S,T),a)break}r.vertical&&(z+=Bg(t,i,e,r.vertical,s,l,f,x,m,I,jm.vertical,["vertical"],V,U,b,E,S,T));let $=-1;const Y=(t,e)=>t?Math.max(t,e):e;$=Y(R,$),$=Y(D,$),$=Y(k,$);const Z=$>-1?1:0;t.glyphOffsetArray.length>=65535&&j("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,H.x,H.y,H.z,V.right>=0?V.right:-1,V.center>=0?V.center:-1,V.left>=0?V.left:-1,V.vertical>=0?V.vertical:-1,B,U,G,void 0!==C?C:t.collisionBoxArray.length,void 0!==C?C+1:t.collisionBoxArray.length,void 0!==P?P:t.collisionBoxArray.length,void 0!==P?P+1:t.collisionBoxArray.length,void 0!==A?A:t.collisionBoxArray.length,void 0!==A?A+1:t.collisionBoxArray.length,L||t.collisionBoxArray.length,L?L+1:t.collisionBoxArray.length,u,F,z,N,O,Z,0,q,X,$,0,W?1:0)}(t,a,g,s,i,n,r,O,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,T,C,l,0,M,A,_,e,o,c,u,h,p,f)};if("line"===P)for(const r of hg(e.geometry,0,0,Li,Li)){const e=cg(r,S,I,i.vertical||y,n,b,E,t.overscaling,Li);for(const i of e)y&&Gg(t,y.text,L,i)||F(r,i,h)}else if("line-center"===P){for(const t of e.geometry)if(t.length>1){const e=lg(t,I,i.vertical||y,n,b,E);e&&F(t,e,h)}}else if("Polygon"===e.type)for(const t of np(e.geometry,0)){const e=Ag(t,16);F(t[0],new ng(e.x,e.y,0,0,void 0),h)}else if("LineString"===e.type)for(const t of e.geometry)F(t,new ng(t[0].x,t[0].y,0,0,void 0),h);else if("Point"===e.type)for(const t of e.geometry)for(const e of t)F([e],new ng(e.x,e.y,0,0,void 0),h)}const Fg=255,zg=Fg*om;function Bg(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y){const v=function(t,e,i,n,r,o,s,a){const l=[];if(0===e.positionedLines.length)return l;const c=n.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(t){const e=t[0],i=t[1],n=e*i;return n>0?[e,-i]:n<0?[-e,i]:0===e?[i,e]:[i,-e]}(i);let h=Math.abs(e.top-e.bottom);for(const t of e.positionedLines)h-=t.lineOffset;const d=e.positionedLines.length,p=h/d;let f=e.top-i[1];for(let t=0;t<d;++t){const n=e.positionedLines[t];f=Cg(e,p,f,t);for(const t of n.positionedGlyphs){if(!t.rect)continue;const n=t.rect||{};let o=Vm+1,h=!0,d=1,p=0;if(t.imageName){const e=s[t.imageName];if(!e)continue;if(e.sdf){j("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=e.pixelRatio,o=pg/d}const m=(r||a)&&t.vertical,g=t.metrics.advance*t.scale/2,y=t.metrics,v=t.rect;if(null===v)continue;a&&e.verticalizable&&(p=t.imageName?g-t.metrics.width*t.scale/2:0);const x=r?[t.x+g,t.y]:[0,0];let b=[0,0],w=[0,0],E=!1;r||(m?(w=[t.x+g+u[0],t.y+u[1]-p],E=!0):b=[t.x+g+i[0],t.y+i[1]-p]);const S=v.w*t.scale/(d*(t.localGlyph?vg:1)),T=v.h*t.scale/(d*(t.localGlyph?vg:1));let M,I,C,A;if(m){const e=t.y-f,i=new _(-g,g-e),n=-Math.PI/2,r=new _(...w);M=new _(-g+b[0],b[1]),M._rotateAround(n,i)._add(r),M.x+=-e+g,M.y-=(y.left-o)*t.scale;const s=t.imageName?y.advance*t.scale:rm*t.scale,a=String.fromCodePoint(t.glyph);dm(a)?M.x+=(1-o)*t.scale:pm(a)?M.x+=s-y.height*t.scale+(-o-1)*t.scale:M.x+=t.imageName||y.width+2*o===v.w&&y.height+2*o===v.h?(s-T)/2:(s-(y.height+2*o)*t.scale)/2,I=new _(M.x,M.y-S),C=new _(M.x+T,M.y),A=new _(M.x+T,M.y-S)}else{const e=(y.left-o)*t.scale-g+b[0],i=(-y.top-o)*t.scale+b[1],n=e+S,r=i+T;M=new _(e,i),I=new _(n,i),C=new _(e,r),A=new _(n,r)}if(c){let t;t=r?new _(0,0):E?new _(u[0],u[1]):new _(i[0],i[1]),M._rotateAround(c,t),I._rotateAround(c,t),C._rotateAround(c,t),A._rotateAround(c,t)}const P=new _(0,0),L=new _(0,0);l.push({tl:M,tr:I,bl:C,br:A,texPrimary:n,texSecondary:void 0,writingMode:e.writingMode,glyphOffset:x,sectionIndex:t.sectionIndex,isSDF:h,pixelOffsetTL:P,pixelOffsetBR:L,minFontScaleX:0,minFontScaleY:0})}}return l}(0,n,l,o,s,a,r,t.allowVerticalPlacement),x=t.textSizeData;let b=null;"source"===x.kind?(b=[om*o.layout.get("text-size").evaluate(a,{},g)],b[0]>zg&&j(`${t.layerIds[0]}: Value for "text-size" is >= ${Fg}. Reduce your "text-size".`)):"composite"===x.kind&&(b=[om*f.compositeTextSizes[0].evaluate(a,{},g),om*f.compositeTextSizes[1].evaluate(a,{},g)],(b[0]>zg||b[1]>zg)&&j(`${t.layerIds[0]}: Value for "text-size" is >= ${Fg}. Reduce your "text-size".`)),t.addSymbols(t.text,v,b,l,s,a,u,e,i,c.lineStartIndex,c.lineLength,p,m,g,y,!1);for(const e of h)d[e]=t.text.placedSymbolArray.length-1;return 4*v.length}function Ug(t){for(const e in t)return t[e];return null}function Vg(t,e,i,n,r,o,s,a,l,c){let u=s.top,h=s.bottom,d=s.left,p=s.right;const f=s.collisionPadding;if(f&&(d-=f[0],u-=f[1],p+=f[2],h+=f[3]),l){const t=new _(d,u),e=new _(p,u),i=new _(d,h),n=new _(p,h),r=x(l);let o=new _(0,0);c&&(o=new _(c[0],c[1])),t._rotateAround(r,o),e._rotateAround(r,o),i._rotateAround(r,o),n._rotateAround(r,o),d=Math.min(t.x,e.x,i.x,n.x),p=Math.max(t.x,e.x,i.x,n.x),u=Math.min(t.y,e.y,i.y,n.y),h=Math.max(t.y,e.y,i.y,n.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,d,u,p,h,a,n,r,o),t.length-1}function jg(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Gg(t,e,i,n){const r=t.compareText;if(e in r){const t=r[e];for(let e=t.length-1;e>=0;e--)if(n.dist(t[e])<i)return!0}else r[e]=[];return r[e].push(n),!1}function Hg(t,e){const i=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,r=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),o=Math.sin(i)*r/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),s=Math.sin(t._pitch)*o+r;return Math.min(1.01*s,r*(1/t._horizonShift))}function Wg(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),n=t.x*i,r=(t.x+1)*i,o=t.y*i,s=(t.y+1)*i,a=ml(n),l=ml(r),c=gl(o),u=gl(s),h=e.project(a,c),d=e.project(l,c),p=e.project(l,u),f=e.project(a,u);let m=Math.min(h.x,d.x,p.x,f.x),g=Math.min(h.y,d.y,p.y,f.y),_=Math.max(h.x,d.x,p.x,f.x),y=Math.max(h.y,d.y,p.y,f.y);const v=i/16;function x(t,i,n,r,o,s){const a=(n+o)/2,l=(r+s)/2,c=e.project(ml(a),gl(l)),u=Math.max(0,m-c.x,g-c.y,c.x-_,c.y-y);m=Math.min(m,c.x),_=Math.max(_,c.x),g=Math.min(g,c.y),y=Math.max(y,c.y),u>v&&(x(t,c,n,r,a,l),x(c,i,a,l,o,s))}x(h,d,n,o,r,o),x(d,p,r,o,r,s),x(p,f,r,s,n,s),x(f,h,n,s,n,o),m-=v,g-=v,_+=v,y+=v;const b=1/Math.max(_-m,y-g);return{scale:b,x:m*b,y:g*b,x2:_*b,y2:y*b,projection:e}}function qg(t,{x:e,y:i},n=0){return new _(((e-n)*t.scale-t.x)*Li,(i*t.scale-t.y)*Li)}const Xg=t.a6.identity(new Float32Array(16));class $g{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,e){return{x:0,y:0,z:0}}unproject(t,e){return new tl(0,0)}projectTilePoint(t,e,i){return{x:t,y:e,z:0}}locationPoint(t,e,i=!0){return t._coordinatePoint(t.locationCoordinate(e),i)}pixelsPerMeter(t,e){return fl(1,t)*e}pixelSpaceConversion(t,e,i){return 1}farthestPixelDistance(t){return Hg(t,t.pixelsPerMeter)}pointCoordinate(t,e,i,n){const r=t.horizonLineFromTop(!1),o=new _(e,Math.max(r,i));return t.rayIntersectionCoordinate(t.pointRayIntersection(o,n))}pointCoordinate3D(t,e,i){const n=new _(e,i);if(t.elevation)return t.elevation.pointCoordinate(n);{const e=this.pointCoordinate(t,n.x,n.y,0);return[e.x,e.y,e.z]}}isPointAboveHorizon(t,e){if(t.elevation)return!this.pointCoordinate3D(t,e.x,e.y);const i=t.horizonLineFromTop();return e.y<i}createInversionMatrix(t,e){return Xg}createTileMatrix(e,i,n){let r,o,s;const a=n.canonical,l=t.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const c=Wg(a,this);r=1,o=c.x+n.wrap*c.scale,s=c.y,t.a6.scale(l,l,[r/c.scale,r/c.scale,e.pixelsPerMeter/i])}else r=i/e.zoomScale(a.z),o=(a.x+Math.pow(2,a.z)*n.wrap)*r,s=a.y*r;return t.a6.translate(l,l,[o,s,0]),t.a6.scale(l,l,[r/Li,r/Li,1]),l}upVector(t,e,i){return[0,0,1]}upVectorScale(t,e,i){return{metersToTile:1}}}class Yg extends $g{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[e,i]=this.parallels=t.parallels||[29.5,45.5],n=Math.sin(x(e));this.n=(n+Math.sin(x(i)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(t,e){const{n:i,c:n,r0:r}=this,o=x(t-this.center[0]),s=x(e),a=Math.sqrt(n-2*i*Math.sin(s))/i;return{x:a*Math.sin(o*i),y:a*Math.cos(o*i)-r,z:0}}unproject(t,e){const{n:i,c:n,r0:r}=this,o=r+e;let s=Math.atan2(t,Math.abs(o))*Math.sign(o);o*i<0&&(s-=Math.PI*Math.sign(t)*Math.sign(o));const a=x(this.center[0])*i;s=C(s,-Math.PI-a,Math.PI-a);const l=M(b(s/i)+this.center[0],-180,180),c=Math.asin(M((n-(t*t+o*o)*i*i)/(2*i),-1,1)),u=M(b(c),-yl,yl);return new tl(l,u)}}const Zg=1.340264,Kg=-.081106,Jg=893e-6,Qg=.003796,t_=Math.sqrt(3)/2;class e_ extends $g{project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const i=Math.asin(t_*Math.sin(e)),n=i*i,r=n*n*n;return{x:.5*(t*Math.cos(i)/(t_*(Zg+3*Kg*n+r*(7*Jg+9*Qg*n)))/Math.PI+.5),y:1-.5*(i*(Zg+Kg*n+r*(Jg+Qg*n))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,n=i*i,r=n*n*n;for(let t,o,s,a=0;a<12&&(o=i*(Zg+Kg*n+r*(Jg+Qg*n))-e,s=Zg+3*Kg*n+r*(7*Jg+9*Qg*n),t=o/s,i=M(i-t,-Math.PI/3,Math.PI/3),n=i*i,r=n*n*n,!(Math.abs(t)<1e-12));++a);const o=t_*t*(Zg+3*Kg*n+r*(7*Jg+9*Qg*n))/Math.cos(i),s=Math.asin(Math.sin(i)/t_),a=M(180*o/Math.PI,-180,180),l=M(180*s/Math.PI,-yl,yl);return new tl(a,l)}}class i_ extends $g{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){return{x:.5+t/360,y:.5-e/360,z:0}}unproject(t,e){const i=360*(t-.5),n=M(360*(.5-e),-yl,yl);return new tl(i,n)}}const n_=Math.PI/2;function r_(t){return Math.tan((n_+t)/2)}class o_ extends $g{constructor(t){super(t),this.center=t.center||[0,30];const[e,i]=this.parallels=t.parallels||[30,30];let n=x(e),r=x(i);this.southernCenter=n+r<0,this.southernCenter&&(n=-n,r=-r);const o=Math.cos(n),s=r_(n);this.n=n===r?Math.sin(n):Math.log(o/Math.cos(r))/Math.log(r_(r)/s),this.f=o*Math.pow(r_(n),this.n)/this.n}project(t,e){e=x(e),this.southernCenter&&(e=-e),t=x(t-this.center[0]);const i=1e-6,{n,f:r}=this;r>0?e<-n_+i&&(e=-n_+i):e>n_-i&&(e=n_-i);const o=r/Math.pow(r_(e),n);let s=o*Math.sin(n*t),a=r-o*Math.cos(n*t);return s=.5*(s/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:s,y:this.southernCenter?a:1-a,z:0}}unproject(t,e){t=(2*t-.5)*Math.PI,this.southernCenter&&(e=1-e),e=(2*(1-e)-.5)*Math.PI;const{n:i,f:n}=this,r=n-e,o=Math.sign(r),s=Math.sign(i)*Math.sqrt(t*t+r*r);let a=Math.atan2(t,Math.abs(r))*o;r*i<0&&(a-=Math.PI*Math.sign(t)*o);const l=M(b(a/i)+this.center[0],-180,180),c=M(b(2*Math.atan(Math.pow(n/s,1/i))-n_),-yl,yl);return new tl(l,this.southernCenter?-c:c)}}class s_ extends $g{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,e){return{x:dl(t),y:pl(e),z:0}}unproject(t,e){const i=ml(t),n=gl(e);return new tl(i,n)}}const a_=x(yl);class l_ extends $g{project(t,e){const i=(e=x(e))*e,n=i*i;return{x:.5*((t=x(t))*(.8707-.131979*i+n*(n*(.003971*i-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+i*(.015085+n*(.028874*i-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,n=25,r=0,o=i*i;do{o=i*i;const t=o*o;r=(i*(1.007226+o*(.015085+t*(.028874*o-.044475-.005916*t)))-e)/(1.007226+o*(.045255+t*(.259866*o-.311325-.005916*11*t))),i=M(i-r,-a_,a_)}while(Math.abs(r)>1e-6&&--n>0);o=i*i;const s=M(b(t/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=b(i);return new tl(s,a)}}const c_=x(yl);class u_ extends $g{project(t,e){e=x(e),t=x(t);const i=Math.cos(e),n=2/Math.PI,r=Math.acos(i*Math.cos(t/2)),o=Math.sin(r)/r,s=.5*(t*n+2*i*Math.sin(t/2)/o)||0,a=.5*(e+Math.sin(e)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(t,e){let i=t=(2*t-.5)*Math.PI,n=e=(2*(1-e)-1)*Math.PI,r=25;const o=1e-6;let s=0,a=0;do{const r=Math.cos(n),o=Math.sin(n),l=2*o*r,c=o*o,u=r*r,h=Math.cos(i/2),d=Math.sin(i/2),p=2*h*d,f=d*d,m=1-u*h*h,g=m?1/m:0,_=m?Math.acos(r*h)*Math.sqrt(1/m):0,y=.5*(2*_*r*d+2*i/Math.PI)-t,v=.5*(_*o+n)-e,x=.5*g*(u*f+_*r*h*c)+1/Math.PI,b=g*(p*l/4-_*o*d),w=.125*g*(l*d-_*o*u*p),E=.5*g*(c*h+_*f*r)+.5,S=b*w-E*x;s=(v*b-y*E)/S,a=(y*w-v*x)/S,i=M(i-s,-Math.PI,Math.PI),n=M(n-a,-c_,c_)}while((Math.abs(s)>o||Math.abs(a)>o)&&--r>0);return new tl(b(i),b(n))}}class h_ extends $g{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(x(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){const{scale:i,cosPhi:n}=this;return{x:x(t)*n*i+.5,y:-Math.sin(x(e))/n*i+.5,z:0}}unproject(t,e){const{scale:i,cosPhi:n}=this,r=-(e-.5)/i,o=M(b((t-.5)/i)/n,-180,180),s=Math.asin(M(r*n,-1,1)),a=M(b(s),-yl,yl);return new tl(o,a)}}class d_ extends s_{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,n){const r=$h(e,i,n),o=Kh(jh(n));return t.N.transformMat4(r,r,o),{x:r[0],y:r[1],z:r[2]}}locationPoint(e,i){const n=Ka(i.lat,i.lng),r=t.N.normalize([],n),o=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,s=fl(1,0)*Li*o;t.N.scaleAndAdd(n,n,r,s);const a=t.a6.identity(new Float64Array(16));return t.a6.multiply(a,e.pixelMatrix,e.globeMatrix),t.N.transformMat4(n,n,a),new _(n[0],n[1])}pixelsPerMeter(t,e){return fl(1,0)*e}pixelSpaceConversion(t,e,i){const n=fl(1,t)*e,r=ce(fl(1,45)*e,n,i);return this.pixelsPerMeter(t,e)/r}createTileMatrix(e,i,n){const r=Jh(jh(n.canonical));return t.a6.multiply(new Float64Array(16),e.globeMatrix,r)}createInversionMatrix(e,i){const{center:n}=e,r=Kh(jh(i));return t.a6.rotateY(r,r,x(n.lng)),t.a6.rotateX(r,r,x(n.lat)),t.a6.scale(r,r,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(r)}pointCoordinate(t,e,i,n){return Bh(t,e,i,!0)||new El(0,0)}pointCoordinate3D(t,e,i){const n=this.pointCoordinate(t,e,i,0);return[n.x,n.y,n.z]}isPointAboveHorizon(t,e){return!Bh(t,e.x,e.y,!1)}farthestPixelDistance(e){const i=function(e,i){const n=e.cameraToCenterDistance,r=e._centerAltitude*i,o=e._camera,s=e._camera.forward(),a=t.N.add([],t.N.scale([],s,-n),[0,0,r]),l=e.worldSize/(2*Math.PI),c=[0,0,-l],u=e.width/e.height,h=Math.tan(e.fovAboveCenter),d=t.N.scale([],o.up(),h),p=t.N.scale([],o.right(),h*u),f=t.N.normalize([],t.N.add([],t.N.add([],s,d),p)),m=[];let g;if(new Th(a,f).closestPointOnSphere(c,l,m)){const i=t.N.add([],m,c),n=t.N.sub([],i,a);g=Math.cos(e.fovAboveCenter)*t.N.length(n)}else{const e=t.N.sub([],a,c),i=t.N.sub([],c,a);t.N.normalize(i,i);const n=t.N.length(e)-l;g=Math.sqrt(n*(n+2*l));const r=Math.acos(g/(l+n))-Math.acos(t.N.dot(s,i));g*=Math.cos(r)}return 1.01*g}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=id(e.zoom);if(n>0){const t=Hg(e,fl(1,e.center.lat)*e.worldSize),r=e.worldSize/(2*Math.PI),o=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ce(i,t+r*(1-Math.cos(o)),Math.pow(n,10))}return i}upVector(t,e,i){return $h(e,i,t,1)}upVectorScale(t){return{metersToTile:Fh(Yh(jh(t)))}}}function p_(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new s_(t);case"equirectangular":return new i_(t);case"naturalEarth":return new l_(t);case"equalEarth":return new e_(t);case"winkelTripel":return new u_(t);case"albers":return i?new h_(t):new Yg(t);case"lambertConformalConic":return i?new h_(t):new o_(t);case"globe":return new d_(t)}throw new Error(`Invalid projection name: ${t.name}`)}const f_=Ap.types,m_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function g_(t,e,i,n,r,o,s,a,l,c,u,h,d){const p=a?Math.min(zg,Math.round(a[0])):0,f=a?Math.min(zg,Math.round(a[1])):0;t.emplaceBack(e,i,Math.round(32*n),Math.round(32*r),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function __(t,e,i){t.emplaceBack(e,i)}function y_(t,e,i,n,r,o,s){t.emplaceBack(e,i,n,r,o,s)}function v_(t,e,i,n,r){t.emplaceBack(e,i,n,r),t.emplaceBack(e,i,n,r),t.emplaceBack(e,i,n,r),t.emplaceBack(e,i,n,r)}function x_(t){for(const e of t.sections)if(go(e.text))return!0;return!1}class b_{constructor(t){this.layoutVertexArray=new ws,this.indexArray=new Ps,this.programConfigurations=t,this.segments=new ia,this.dynamicLayoutVertexArray=new ys,this.opacityVertexArray=new Ss,this.placedSymbolArray=new qs,this.iconTransitioningVertexArray=new Ts,this.globeExtVertexArray=new Es,this.zOffsetVertexArray=new Ds}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(t,e,i,n,r){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Yf.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Kf.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,m_,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,Qf.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Zf.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||r)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Jf.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}io(b_,"SymbolBuffers");class w_{constructor(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new ia,this.collisionVertexArray=new As,this.collisionVertexArrayExt=new ys}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,tm.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,em.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}io(w_,"CollisionBuffers");class E_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=t.a6.identity([]),this.placementViewportMatrix=t.a6.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=sm(this.zoom,i["text-size"]),this.iconSizeData=sm(this.zoom,i["icon-size"]);const n=this.layers[0].layout,r=n.get("symbol-sort-key"),o=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map((t=>jm[t])),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=n.get("symbol-z-elevate")}createArrays(){this.text=new b_(new Oa(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new b_(new Oa(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new Ys,this.lineVertexArray=new Zs,this.symbolInstances=new $s}calculateGlyphDependencies(t,e,i,n,r){for(let i=0;i<t.length;i++){const o=t.codePointAt(i);if(void 0===o)break;if(e[o]=!0,n&&r&&o<=65535){const n=hm[t.charAt(i)];n&&(e[n.charCodeAt(0)]=!0)}}}populate(e,i,n,r){const o=this.layers[0],s=o.layout,a="globe"===this.projection.name,l=s.get("text-font"),c=s.get("text-field"),u=s.get("icon-image"),h=("constant"!==c.value.kind||c.value.value instanceof Ne&&!c.value.value.isEmpty()||c.value.value.toString().length>0)&&("constant"!==l.value.kind||l.value.value.length>0),d="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,p=s.get("symbol-sort-key");if(this.features=[],!h&&!d)return;const f=i.iconDependencies,m=i.glyphDependencies,g=i.availableImages,_=new Ao(this.zoom);for(const{feature:i,id:c,index:u,sourceLayerIndex:y}of e){const e=o._featureFilter.needGeometry,v=Rl(i,e);if(!o._featureFilter.filter(_,v,n))continue;if(e||(v.geometry=Ll(i,n,r)),a&&1!==i.type&&n.z<=5){const e=v.geometry,i=.98078528056,r=(e,r)=>{const o=$h(e.x,e.y,n,1),s=$h(r.x,r.y,n,1);return t.N.dot(o,s)<i};for(let t=0;t<e.length;t++)e[t]=Il(e[t],r)}let x,b;if(h){const t=o.getValueAndResolveTokens("text-field",v,n,g),e=Ne.factory(t);x_(e)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Mo()||this.hasRTLText&&Co.isParsed())&&(x=um(e,o,v))}if(d){const t=o.getValueAndResolveTokens("icon-image",v,n,g);b=t instanceof Oe?t:Oe.fromString(t)}if(!x&&!b)continue;const w=this.sortFeaturesByKey?p.evaluate(v,{},n):void 0;if(this.features.push({id:c,text:x,icon:b,index:u,sourceLayerIndex:y,geometry:v.geometry,properties:i.properties,type:f_[i.type],sortKey:w}),b&&(f[b.namePrimary]=!0,b.nameSecondary&&(f[b.nameSecondary]=!0)),x){const t=l.evaluate(v,{},n).join(","),e="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(jm.vertical)>=0;for(const i of x.sections)if(i.image)f[i.image.namePrimary]=!0;else{const n=lo(x.toString()),r=i.fontStack||t,o=m[r]=m[r]||{};this.calculateGlyphDependencies(i.text,o,e,this.allowVerticalPlacement,n)}}}"line"===s.get("symbol-placement")&&(this.features=function(t){const e={},i={},n=[];let r=0;function o(e){n.push(t[e]),r++}function s(t,e,r){const o=i[t];return delete i[t],i[e]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(r[0]),o}function a(t,i,r){const o=e[i];return delete e[i],e[t]=o,n[o].geometry[0].shift(),n[o].geometry[0]=r[0].concat(n[o].geometry[0]),o}function l(t,e,i){const n=i?e[0][e[0].length-1]:e[0][0];return`${t}:${n.x}:${n.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in e&&i[p]!==e[f]){const t=a(p,f,h),r=s(p,f,n[t].geometry);delete e[p],delete i[f],i[l(d,n[r].geometry,!0)]=r,n[t].geometry=null}else p in i?s(p,f,h):f in e?a(p,f,h):(o(c),e[p]=r-1,i[f]=r-1)}return n.filter((t=>t.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey))}update(t,e,i,n,r){const o=0!==Object.keys(t).length;if(o&&!this.stateDependentLayers.length)return;const s=o?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,e,s,i,n,r),this.icon.programConfigurations.updatePaintArrays(t,e,s,i,n,r)}updateZOffset(){const t=(t,e,n)=>{i+=e,i>t.length&&t.resize(i);for(let r=-e;r<0;r++)t.emplace(r+i,n)},e=(t,e,i)=>{n+=e,n>t.length&&t.resize(n);for(let r=-e;r<0;r++)t.emplace(r+n,i)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,n=0;for(let i=0;i<this.symbolInstances.length;i++){const n=this.symbolInstances.get(i),{numHorizontalGlyphVertices:r,numVerticalGlyphVertices:o,numIconVertices:s}=n,a=n.zOffset,l=s>0;if((r>0||o>0)&&(t(this.text.zOffsetVertexArray,r,a),t(this.text.zOffsetVertexArray,o,a)),l){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:i}=n;t>=0&&e(this.icon.zOffsetVertexArray,s,a),i>=0&&e(this.icon.zOffsetVertexArray,n.numVerticalIconVertices,a)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=p_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const i=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:t,y:i}of e)this.lineVertexArray.emplaceBack(t,i);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m){const g=t.indexArray,_=t.layoutVertexArray,y=t.globeExtVertexArray,v=t.segments.prepareSegment(4*e.length,_,g,this.canOverlap?o.sortKey:void 0),x=this.glyphOffsetArray.length,b=v.vertexLength,w=this.allowVerticalPlacement&&s===jm.vertical?Math.PI/2:0,E=o.text&&o.text.sections;for(let n=0;n<e.length;n++){const{tl:r,tr:s,bl:c,br:u,texPrimary:h,texSecondary:x,pixelOffsetTL:b,pixelOffsetBR:S,minFontScaleX:T,minFontScaleY:M,glyphOffset:I,isSDF:C,sectionIndex:A}=e[n],P=v.vertexLength,L=I[1];if(g_(_,l.x,l.y,r.x,L+r.y,h.x,h.y,i,C,b.x,b.y,T,M),g_(_,l.x,l.y,s.x,L+s.y,h.x+h.w,h.y,i,C,S.x,b.y,T,M),g_(_,l.x,l.y,c.x,L+c.y,h.x,h.y+h.h,i,C,b.x,S.y,T,M),g_(_,l.x,l.y,u.x,L+u.y,h.x+h.w,h.y+h.h,i,C,S.x,S.y,T,M),a){const{x:e,y:i,z:n}=a.anchor,[r,o,s]=a.up;y_(y,e,i,n,r,o,s),y_(y,e,i,n,r,o,s),y_(y,e,i,n,r,o,s),y_(y,e,i,n,r,o,s),v_(t.dynamicLayoutVertexArray,e,i,n,w)}else v_(t.dynamicLayoutVertexArray,l.x,l.y,l.z,w);if(m){const e=x||h;__(t.iconTransitioningVertexArray,e.x,e.y),__(t.iconTransitioningVertexArray,e.x+e.w,e.y),__(t.iconTransitioningVertexArray,e.x,e.y+e.h),__(t.iconTransitioningVertexArray,e.x+e.w,e.y+e.h)}g.emplaceBack(P,P+1,P+2),g.emplaceBack(P+1,P+2,P+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(I[0]),n!==e.length-1&&A===e[n+1].sectionIndex||t.programConfigurations.populatePaintArrays(_.length,o,o.index,{},d,p,f,E&&E[A])}const S=a?a.anchor:l;t.placedSymbolArray.emplaceBack(S.x,S.y,S.z,l.x,l.y,x,this.glyphOffsetArray.length-x,b,c,u,l.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],s,0,!1,0,h,0)}_commitLayoutVertex(t,e,i,n,r,o,s){t.emplaceBack(e,i,n,r,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(t,e,i,n,r,o,s){const a=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=a.vertexLength,c=s.tileAnchorX,u=s.tileAnchorY;for(let t=0;t<4;t++)i.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(i.collisionVertexArrayExt,e,t.padding,s.zOffset),this._commitLayoutVertex(i.layoutVertexArray,n,r,o,c,u,new _(t.x1,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,r,o,c,u,new _(t.x2,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,r,o,c,u,new _(t.x2,t.y2)),this._commitLayoutVertex(i.layoutVertexArray,n,r,o,c,u,new _(t.x1,t.y2)),a.vertexLength+=4;const h=i.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(t,e,i,n,r,o){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceTextSize(t,o,e,s);this._addCollisionDebugVertices(n,r,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(t,e,i,n,r,o){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceIconSize(t,e,o.placedIconSymbolIndex);this._addCollisionDebugVertices(n,r,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}generateCollisionDebugBuffers(t,e){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new w_(Is,im.members,Ts),this.iconCollisionBox=new w_(Is,im.members,Ts);const i=lm(this.iconSizeData,t),n=lm(this.textSizeData,t);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(n,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(n,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(t,e,i,n){const r=this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex>=0?e.rightJustifiedTextSymbolIndex:e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.leftJustifiedTextSymbolIndex>=0?e.leftJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex>=0?e.verticalPlacedTextSymbolIndex:n),o=am(this.textSizeData,t,r)/rm;return this.tilePixelRatio*o}getSymbolInstanceIconSize(t,e,i){const n=this.icon.placedSymbolArray.get(i),r=am(this.iconSizeData,t,n);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(t,e,i,n){t.emplaceBack(e,-i,-i,n),t.emplaceBack(e,i,-i,n),t.emplaceBack(e,i,i,n),t.emplaceBack(e,-i,i,n)}_updateTextDebugCollisionBoxes(t,e,i,n,r,o){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceTextSize(t,o,e,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,n.padding,o.zOffset)}}_updateIconDebugCollisionBoxes(t,e,i,n,r,o){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceIconSize(t,e,o.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,n.padding,o.zOffset)}}updateCollisionDebugBuffers(t,e){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=lm(this.iconSizeData,t),n=lm(this.textSizeData,t);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._updateTextDebugCollisionBoxes(n,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(n,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(i,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._updateIconDebugCollisionBoxes(i,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,e,i,n,r,o,s,a,l){const c={};if(e<i){const{x1:i,y1:n,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=t.get(e);c.textBox={x1:i,y1:n,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.textFeatureIndex=p}if(n<r){const{x1:e,y1:i,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=t.get(n);c.verticalTextBox={x1:e,y1:i,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalTextFeatureIndex=p}if(o<s){const{x1:e,y1:i,x2:n,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=t.get(o);c.iconBox={x1:e,y1:i,x2:n,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.iconFeatureIndex=p}if(a<l){const{x1:e,y1:i,x2:n,y2:r,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=t.get(a);c.verticalIconBox={x1:e,y1:i,x2:n,y2:r,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,e){const i=t.placedSymbolArray.get(e),n=i.vertexStartIndex+4*i.numGlyphs;for(let e=i.vertexStartIndex;e<n;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),i=Math.cos(t),n=[],r=[],o=[];for(let t=0;t<this.symbolInstances.length;++t){o.push(t);const s=this.symbolInstances.get(t);n.push(0|Math.round(e*s.tileAnchorX+i*s.tileAnchorY)),r.push(s.featureIndex)}return o.sort(((t,e)=>n[t]-n[e]||r[e]-r[t])),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((t,e)=>this.symbolInstances.get(e).zOffset-this.symbolInstances.get(t).zOffset))}addToSortKeyRanges(t,e){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:n,leftJustifiedTextSymbolIndex:r,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:a}=e;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),n>=0&&n!==i&&this.addIndicesForPlacedSymbol(this.text,n),r>=0&&r!==n&&r!==i&&this.addIndicesForPlacedSymbol(this.text,r),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}io(E_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),E_.addDynamicAttributes=v_;const S_=new Vo({"symbol-placement":new zo(Ho.layout_symbol["symbol-placement"]),"symbol-spacing":new zo(Ho.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zo(Ho.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Bo(Ho.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zo(Ho.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new zo(Ho.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new zo(Ho.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new zo(Ho.layout_symbol["icon-ignore-placement"]),"icon-optional":new zo(Ho.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zo(Ho.layout_symbol["icon-rotation-alignment"]),"icon-size":new Bo(Ho.layout_symbol["icon-size"]),"icon-text-fit":new Bo(Ho.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bo(Ho.layout_symbol["icon-text-fit-padding"]),"icon-image":new Bo(Ho.layout_symbol["icon-image"]),"icon-rotate":new Bo(Ho.layout_symbol["icon-rotate"]),"icon-padding":new zo(Ho.layout_symbol["icon-padding"]),"icon-keep-upright":new zo(Ho.layout_symbol["icon-keep-upright"]),"icon-offset":new Bo(Ho.layout_symbol["icon-offset"]),"icon-anchor":new Bo(Ho.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zo(Ho.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zo(Ho.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zo(Ho.layout_symbol["text-rotation-alignment"]),"text-field":new Bo(Ho.layout_symbol["text-field"]),"text-font":new Bo(Ho.layout_symbol["text-font"]),"text-size":new Bo(Ho.layout_symbol["text-size"]),"text-max-width":new Bo(Ho.layout_symbol["text-max-width"]),"text-line-height":new Bo(Ho.layout_symbol["text-line-height"]),"text-letter-spacing":new Bo(Ho.layout_symbol["text-letter-spacing"]),"text-justify":new Bo(Ho.layout_symbol["text-justify"]),"text-radial-offset":new Bo(Ho.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zo(Ho.layout_symbol["text-variable-anchor"]),"text-anchor":new Bo(Ho.layout_symbol["text-anchor"]),"text-max-angle":new zo(Ho.layout_symbol["text-max-angle"]),"text-writing-mode":new zo(Ho.layout_symbol["text-writing-mode"]),"text-rotate":new Bo(Ho.layout_symbol["text-rotate"]),"text-padding":new zo(Ho.layout_symbol["text-padding"]),"text-keep-upright":new zo(Ho.layout_symbol["text-keep-upright"]),"text-transform":new Bo(Ho.layout_symbol["text-transform"]),"text-offset":new Bo(Ho.layout_symbol["text-offset"]),"text-allow-overlap":new zo(Ho.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new zo(Ho.layout_symbol["text-ignore-placement"]),"text-optional":new zo(Ho.layout_symbol["text-optional"]),visibility:new zo(Ho.layout_symbol.visibility)});var T_={paint:new Vo({"icon-opacity":new Bo(Ho.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Bo(Ho.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Bo(Ho.paint_symbol["text-emissive-strength"]),"icon-color":new Bo(Ho.paint_symbol["icon-color"]),"icon-halo-color":new Bo(Ho.paint_symbol["icon-halo-color"]),"icon-halo-width":new Bo(Ho.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Bo(Ho.paint_symbol["icon-halo-blur"]),"icon-translate":new zo(Ho.paint_symbol["icon-translate"]),"icon-translate-anchor":new zo(Ho.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Bo(Ho.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Bo(Ho.paint_symbol["text-opacity"]),"text-color":new Bo(Ho.paint_symbol["text-color"],{runtimeType:be,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Bo(Ho.paint_symbol["text-halo-color"]),"text-halo-width":new Bo(Ho.paint_symbol["text-halo-width"]),"text-halo-blur":new Bo(Ho.paint_symbol["text-halo-blur"]),"text-translate":new zo(Ho.paint_symbol["text-translate"]),"text-translate-anchor":new zo(Ho.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new zo(Ho.paint_symbol["icon-color-saturation"])}),layout:S_};class M_{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:_e,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}io(M_,"FormatSectionOverride",{omit:["defaultValue"]});class I_ extends as{constructor(t,e,i){super(t,T_,e,i)}recalculate(t,e){super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const t=[];for(const e of i)t.indexOf(e)<0&&t.push(e);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,e,i,n){const r=this.layout.get(t).evaluate(e,{},i,n),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||Hr(o.value)||!r?r:function(t,e){return e.replace(/{([^{}]+)}/g,((e,i)=>i in t?String(t[i]):""))}(e.properties,r)}createBucket(t){return new E_(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of T_.paint.overridableProperties){if(!I_.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),i=new M_(e),n=new Gr(i,e.property.specification,this.scope,this.options);let r=null;r="constant"===e.value.kind||"source"===e.value.kind?new qr("source",n):new Xr("composite",n,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new Oo(e.property,r,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven())&&I_.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const i=t.get("text-field"),n=T_.paint.properties[e];let r=!1;const o=t=>{for(const e of t)if(n.overrides&&n.overrides.hasOverride(e))return void(r=!0)};if("constant"===i.value.kind&&i.value.value instanceof Ne)o(i.value.value.sections);else if("source"===i.value.kind){const t=e=>{r||(e instanceof je&&Be(e.value)===Te?o(e.value.sections):e instanceof Xe?o(e.sections):e.eachChild(t))},e=i.value;e._styleExpression&&t(e._styleExpression.expression)}return r}getProgramIds(){const t=0!==this.paint.get("icon-opacity").constantOr(1),e=0!==this.paint.get("text-opacity").constantOr(1),i=[];return t&&i.push("symbolIcon"),e&&i.push("symbolSDF"),i}getDefaultProgramParams(t,e){return{config:new Na(this,e),overrideFog:!1}}}const C_=new Vo({visibility:new zo(Ho.layout_background.visibility)});var A_={paint:new Vo({"background-color":new zo(Ho.paint_background["background-color"]),"background-pattern":new zo(Ho.paint_background["background-pattern"]),"background-opacity":new zo(Ho.paint_background["background-opacity"]),"background-emissive-strength":new zo(Ho.paint_background["background-emissive-strength"])}),layout:C_};const P_=new Vo({visibility:new zo(Ho.layout_raster.visibility)});var L_={paint:new Vo({"raster-opacity":new zo(Ho.paint_raster["raster-opacity"]),"raster-color":new Uo(Ho.paint_raster["raster-color"]),"raster-color-mix":new zo(Ho.paint_raster["raster-color-mix"]),"raster-color-range":new zo(Ho.paint_raster["raster-color-range"]),"raster-hue-rotate":new zo(Ho.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zo(Ho.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zo(Ho.paint_raster["raster-brightness-max"]),"raster-saturation":new zo(Ho.paint_raster["raster-saturation"]),"raster-contrast":new zo(Ho.paint_raster["raster-contrast"]),"raster-resampling":new zo(Ho.paint_raster["raster-resampling"]),"raster-fade-duration":new zo(Ho.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new zo(Ho.paint_raster["raster-emissive-strength"]),"raster-array-band":new zo(Ho.paint_raster["raster-array-band"]),"raster-elevation":new zo(Ho.paint_raster["raster-elevation"])}),layout:P_},R_=hs([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class D_{constructor(t,e,i,n){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,n)}update(t,e,i){const{width:n,height:r}=t,{context:o}=this,{gl:s}=o;if(s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),i||this.size&&this.size[0]===n&&this.size[1]===r){const{x:e,y:o}=i||{x:0,y:0};if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap)s.texSubImage2D(s.TEXTURE_2D,0,e,o,s.RGBA,s.UNSIGNED_BYTE,t);else{let i=this.format,a=s.UNSIGNED_BYTE;this.format===s.R32F&&(i=s.RED,a=s.FLOAT),s.texSubImage2D(s.TEXTURE_2D,0,e,o,n,r,i,a,t.data)}}else if(this.size=[n,r],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap){let e=this.format;this.format===s.R8&&(e=s.RED),s.texImage2D(s.TEXTURE_2D,0,this.format,e,s.UNSIGNED_BYTE,t)}else{let e=this.format,i=this.format,o=s.UNSIGNED_BYTE;this.format===s.DEPTH_COMPONENT&&(e=s.DEPTH_COMPONENT16,o=s.UNSIGNED_SHORT),this.format===s.R8&&(i=s.RED),this.format===s.R32F&&(o=s.FLOAT,i=s.RED),s.texImage2D(s.TEXTURE_2D,0,e,n,r,0,i,o,t.data)}this.useMipmap=Boolean(e&&e.useMipmap),this.useMipmap&&s.generateMipmap(s.TEXTURE_2D)}bind(t,e,i=!1){const{context:n}=this,{gl:r}=n;r.bindTexture(r.TEXTURE_2D,this.texture),t!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap&&!i?t===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),e!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrapS=e)}bindExtraParam(t,e,i,n){const{context:r}=this,{gl:o}=r;o.bindTexture(o.TEXTURE_2D,this.texture),e!==this.magFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,e),this.magFilter=e),t!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?t===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),i!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,i),this.wrapS=i),n!==this.wrapT&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,n),this.wrapT=n)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class k_{constructor(t,e){this.context=t,this.texture=e}bind(t,e){const{context:i}=this,{gl:n}=i;n.bindTexture(n.TEXTURE_2D,this.texture),t!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrapS=e)}}function N_(e,i,n,r,o,s,a,l){const c=[e,i,1,n,r,1,o,s,1],u=[a,l,1],h=t.co.adjoint([],c),[d,p,f]=t.N.transformMat3(u,u,h);return t.co.multiply(c,c,[d,0,0,0,p,0,0,0,f])}function O_(e,i,n,r,o,s,a,l){const c=function(e,i,n,r,o,s,a,l){const c=N_(0,0,1,0,1,1,0,1),u=N_(e,i,n,r,o,s,a,l),h=t.co.adjoint([],c);return t.co.multiply(u,u,h)}(e,i,n,r,o,s,a,l);return[c[2]/c[8]/Li,c[5]/c[8]/Li]}function F_(t){return[t[0],Math.min(Math.max(t[1],-yl),yl)]}class z_ extends ee{constructor(t,e,i,n){super(),this.id=t,this.dispatcher=i,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(n),this.options=e,this._dirty=!1}load(t,e){if(this._loaded=e||!1,this.fire(new Qt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=Dt(this.map._requestManager.transformRequest(this.url,St.Image),((e,i)=>{this._imageRequest=null,this._loaded=!0,e?this.fire(new te(e)):i&&(this.image=i instanceof HTMLImageElement?st.getImageData(i):i,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new k_(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Qt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof k_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let e=t[0][1],i=t[0][1];for(const n of t)n[1]>i&&(i=n[1]),n[1]<e&&(e=n[1]);const n=(i+e)/2;if(n>yl?this.onNorthPole=!0:n<-yl&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const e=t.map(El.fromLngLat);this.tileID=function(t){let e=1/0,i=1/0,n=-1/0,r=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),n=Math.max(n,o.x),r=Math.max(r,o.y);const o=Math.max(n-e,r-i),s=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),a=Math.pow(2,s);let l=Math.floor((e+n)/2*a);return l>1&&(l-=1),new rl(s,l,Math.floor((i+r)/2*a))}(e),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Qt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Wg(new rl(0,0,0),this.map.transform.projection),n=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(t){const e=t[1].x-t[0].x,i=t[1].y-t[0].y,n=t[2].x-t[1].x,r=t[2].y-t[1].y,o=t[3].x-t[2].x,s=t[3].y-t[2].y,a=t[0].x-t[3].x,l=t[0].y-t[3].y,c=e*r-n*i,u=n*s-o*r,h=o*l-a*s,d=a*i-e*l;return c>0&&u>0&&h>0&&d>0||c<0&&u<0&&h<0&&d<0}(n))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const r=Wg(this.tileID,this.map.transform.projection),[o,s,a,l]=this.coordinates.map((t=>{const e=r.projection.project(t[0],t[1]);return qg(r,e)._round()}));this.perspectiveTransform=O_(o.x,o.y,s.x,s.y,a.x,a.y,l.x,l.y);const c=this._boundsArray=new ms;c.emplaceBack(o.x,o.y,0,0),c.emplaceBack(s.x,s.y,Li,0),c.emplaceBack(l.x,l.y,0,Li),c.emplaceBack(a.x,a.y,Li,Li),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(c,R_.members),this.boundsSegments=ia.simpleSegment(0,0,4,2);const u=[],h=[F_((d=this.coordinates)[0]),F_(d[1]),F_(d[2]),F_(d[3])];var d;const[p,f,m,g]=function(t){let e=t[0][0],i=e,n=t[0][1],r=n;for(let o=1;o<t.length;o++)t[o][0]<e?e=t[o][0]:t[o][0]>i&&(i=t[o][0]),t[o][1]<n?n=t[o][1]:t[o][1]>r&&(r=t[o][1]);return[e,n,i-e,r-n]}(h);{const r=new ms,[o,s,a,l]=function(t){let e=t[0].x,i=e,n=t[0].y,r=n;for(let o=1;o<t.length;o++)t[o].x<e?e=t[o].x:t[o].x>i&&(i=t[o].x),t[o].y<n?n=t[o].y:t[o].y>r&&(r=t[o].y);return[e,n,i-e,r-n]}(n),c=t=>[(t.x-o)/a,(t.y-s)/l],[h,d,_,y]=n.map(c),v=function(e,i,n,r,o,s,a,l){const c=N_(0,0,1,0,1,1,0,1),u=N_(e,i,n,r,o,s,a,l),h=t.co.adjoint([],u);return t.co.multiply(c,c,h)}(h[0],h[1],d[0],d[1],_[0],_[1],y[0],y[1]);this.elevatedGlobePerspectiveTransform=O_(h[0],h[1],d[0],d[1],_[0],_[1],y[0],y[1]);const x=(e,i)=>{u.push(e.lng);const n=Math.round((e.lng-p)/m*Li),o=Math.round((e.lat-f)/g*Li),s=c(i),a=t.N.transformMat3([],[s[0],s[1],1],v),l=Math.round(a[0]/a[2]*Li),h=Math.round(a[1]/a[2]*Li);r.emplaceBack(n,o,l,h)},b=n[3].x-n[0].x,w=n[3].y-n[0].y,E=n[2].x-n[1].x,S=n[2].y-n[1].y;for(let t=0;t<65;t++){const e=t/64,r=[n[0].x+e*b,n[0].y+e*w],o=[n[1].x+e*E,n[1].y+e*S],s=o[0]-r[0],a=o[1]-r[1];for(let t=0;t<65;t++){const e=t/64,n={x:r[0]+s*e,y:r[1]+a*e,z:0};x(i.projection.unproject(n.x,n.y),n)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(r,R_.members)}{this.maxLongitudeTriangleSize=0;let t=[],i=new Ps;const n=(e,n,r)=>{i.emplaceBack(e,n,r);const o=u[e],s=u[n],a=u[r],l=Math.min(Math.min(o,s),a),c=Math.max(Math.max(o,s),a)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),t.push(l+c/2)};for(let t=0;t<64;t++)for(let e=0;e<64;e++){const i=65*t+e,r=i+1,o=i+65,s=o+1;n(i,o,r),n(r,o,s)}[t,i]=function(t,e){const i=Array.from({length:t.length},((t,e)=>e));i.sort(((e,i)=>t[e]-t[i]));const n=[],r=new Ps;for(let o=0;o<i.length;o++){const s=i[o];n.push(t[s]);const a=3*s,l=a+1;r.emplaceBack(e.uint16[a],e.uint16[l],e.uint16[l+1])}return[n,r]}(t,i),this.elevatedGlobeTrianglesCenterLongitudes=t,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(i)}this.elevatedGlobeSegments=ia.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,m/Li,0,g/Li,0,0,f,p,0])}prepare(){const t=0!==Object.keys(this.tiles).length;if(this.tileID&&!t)return;const e=this.map.painter.context,i=e.gl;!this._dirty||this.texture instanceof k_||(this.texture?this.texture.update(this.image):(this.texture=new D_(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(e)}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const e=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!e)return null;const i=this.elevatedGlobeTrianglesCenterLongitudes;let n=((t,e)=>t+360*Math.round((e-t)/360))(t+180,i[0]);const r=new ia,o=(t,i)=>{r.segments.push({vertexOffset:0,primitiveOffset:t,vertexLength:e.segments[0].vertexLength,primitiveLength:i,sortKey:void 0,vaos:{}})},s=.51*this.maxLongitudeTriangleSize;if(Math.abs(i[0]-n)<=s){const t=rt(i,0,i.length,n+s);return t===i.length||o(t,nt(i,t+1,i.length,n+360-s)-t),r}n<i[0]&&(n+=360);const a=nt(i,0,i.length,n-s);if(a===i.length)return o(0,i.length),r;o(0,a-0);const l=rt(i,a+1,i.length,n+s);return l!==i.length&&o(l,i.length-l),r}}const B_=(Math.pow(256,2)-1)/16907520;class U_ extends as{constructor(t,e,i){super(t,L_,e,i),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(t){return!(t&&t._source instanceof z_&&(t._source.onNorthPole||t._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(t){"raster-color"!==t&&"raster-color-range"!==t||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap())return;if(!this._curRampRange)return;const e=this._transitionablePaint._values["raster-color"].value.expression,[i,n]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(i)&&isNaN(n)||i===this._curRampRange[0]&&n===this._curRampRange[1]||(this.colorRamp=Sd({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:i,end:n}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[i,n])}}const V_=new Vo({visibility:new zo(Ho["layout_raster-particle"].visibility)});var j_={paint:new Vo({"raster-particle-array-band":new zo(Ho["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new zo(Ho["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Uo(Ho["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new zo(Ho["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new zo(Ho["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new zo(Ho["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new zo(Ho["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:V_};class G_ extends as{constructor(t,e,i){super(t,j_,e,i),this._updateColorRamp(),this.onRemove=t=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&t.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=st.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isLayerDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){"raster-particle-color"!==t&&"raster-particle-max-speed"!==t||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===t&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,e=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Sd({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:e}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=st.now()}}class H_ extends as{constructor(t,e){super(t,{},e),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(t){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const W_=new Vo({visibility:new zo(Ho.layout_sky.visibility)});var q_={paint:new Vo({"sky-type":new zo(Ho.paint_sky["sky-type"]),"sky-atmosphere-sun":new zo(Ho.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new zo(Ho.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new zo(Ho.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new zo(Ho.paint_sky["sky-gradient-radius"]),"sky-gradient":new Uo(Ho.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new zo(Ho.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new zo(Ho.paint_sky["sky-atmosphere-color"]),"sky-opacity":new zo(Ho.paint_sky["sky-opacity"])}),layout:W_};function X_(e,i,n){const r=[0,0,1],o=t.bi.identity([]);return t.bi.rotateY(o,o,n?-x(e)+Math.PI:x(e)),t.bi.rotateX(o,o,-x(i)),t.N.transformQuat(r,r,o),t.N.normalize(r,r)}var $_={paint:new Vo({})};function Y_(e,i){const n=K_(e.projection,e.zoom,e.width,e.height),r=function(e,i,n,r,o){const s=new tl(n.lng-180*J_,n.lat),a=new tl(n.lng+180*J_,n.lat),l=e.project(s.lng,s.lat),c=e.project(a.lng,a.lat),u=-Math.atan2(c.y-l.y,c.x-l.x),h=El.fromLngLat(n);h.y=M(h.y,-1+J_,1-J_);const d=h.toLngLat(),p=e.project(d.lng,d.lat),f=El.fromLngLat(d);f.x+=J_;const m=f.toLngLat(),g=e.project(m.lng,m.lat),_=ty(g.x-p.x,g.y-p.y,u),y=El.fromLngLat(d);y.y+=J_;const v=y.toLngLat(),x=e.project(v.lng,v.lat),b=ty(x.x-p.x,x.y-p.y,u),w=Math.abs(_.x)/Math.abs(b.y),E=t.a6.identity([]);t.a6.rotateZ(E,E,-u*(1-(o?0:r)));const S=t.a6.identity([]);return t.a6.scale(S,S,[1,1-(1-w)*r,1]),S[4]=-b.x/b.y*r,t.a6.rotateZ(S,S,u),t.a6.multiply(S,E,S),S}(e.projection,0,e.center,n,i),o=Z_(e);return t.a6.scale(r,r,[o,o,1]),r}function Z_(t){const e=t.projection,i=K_(t.projection,t.zoom,t.width,t.height),n=Q_(e,t.center),r=Q_(e,tl.convert(e.center));return Math.pow(2,n*i+(1-i)*r)}function K_(t,e,i,n,r=1/0){const o=t.range;if(!o)return 0;const s=Math.min(r,Math.max(i,n)),a=Math.log(s/1024)/Math.LN2;return I(o[0]+a,o[1]+a,e)}const J_=1/4e4;function Q_(t,e){const i=M(e.lat,-yl,yl),n=new tl(e.lng-180*J_,i),r=new tl(e.lng+180*J_,i),o=t.project(n.lng,i),s=t.project(r.lng,i),a=El.fromLngLat(n),l=El.fromLngLat(r),c=s.x-o.x,u=s.y-o.y,h=l.x-a.x,d=l.y-a.y,p=Math.sqrt((h*h+d*d)/(c*c+u*u));return Math.log(p)/Math.LN2}function ty(t,e,i){const n=Math.cos(i),r=Math.sin(i);return{x:t*n-e*r,y:t*r+e*n}}function ey(e,i,n){t.a6.identity(e),t.a6.rotateZ(e,e,x(i[2])),t.a6.rotateX(e,e,x(i[0])),t.a6.rotateY(e,e,x(i[1])),t.a6.scale(e,e,n),t.a6.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function iy(e,i,n,r,o,s,a,l){const c=[n[0]-i[0],n[1]-i[1],0],u=[r[0]-i[0],r[1]-i[1],0];if(t.N.length(c)<1e-12||t.N.length(u)<1e-12)return t.bi.identity(e);const h=t.N.cross([],c,u);t.N.normalize(h,h),t.N.subtract(u,r,i),c[2]=(s-o)*l,u[2]=(a-o)*l;const d=c;return t.N.cross(d,c,u),t.N.normalize(d,d),t.bi.rotationTo(e,h,d)}function ny(e,i,n=!1){const r=id(i.zoom),o=function(e,i,n){const r=i.worldSize,o=[e[12],e[13],e[14]],s=gl(o[1]/r),a=ml(o[0]/r),l=t.a6.identity([]),c=fl(1,s)*r,u=fl(1,0)*r*xl(s,i.zoom),h=1/Qh(r);let d=u*h;if(n){const t=K_(i.projection,i.zoom,i.width,i.height,1024);d=h*i.projection.pixelSpaceConversion(i.center.lat,r,t)}const p=Ka(s,a);t.N.add(p,p,t.N.scale([],t.N.normalize([],p),c*d*o[2]));const f=function(e){const i=[e[0],e[1],e[2]];let n=[0,1,0];const r=t.N.cross([],n,i);return t.N.cross(n,i,r),0===t.N.squaredLength(n)&&(n=[0,1,0],t.N.cross(r,i,n)),t.N.normalize(r,r),t.N.normalize(n,n),t.N.normalize(i,i),[r[0],r[1],r[2],0,n[0],n[1],n[2],0,i[0],i[1],i[2],0,e[0],e[1],e[2],1]}(p);t.a6.scale(l,l,[d,d,d*c]),t.a6.translate(l,l,[-o[0],-o[1],-o[2]]);const m=t.a6.multiply([],i.globeMatrix,f);return t.a6.multiply(m,m,l),t.a6.multiply(m,m,e),m}(e,i,n);if(r>0){const n=function(e,i){const n=i.worldSize,r=fl(1,0)*n*xl(i.center.lat,i.zoom)/Qh(n),o=fl(1,i.center.lat)*n,s=t.a6.identity([]);return t.a6.rotateY(s,s,x(i.center.lng)),t.a6.rotateX(s,s,x(i.center.lat)),t.a6.translate(s,s,[0,0,ja]),t.a6.scale(s,s,[r,r,r*o]),t.a6.translate(s,s,[i.point.x-.5*n,i.point.y-.5*n,0]),t.a6.multiply(s,s,e),t.a6.multiply(s,i.globeMatrix,s)}(e,i);return function(e,i,n){const r=(e,i,n)=>{const r=t.N.length(e),o=t.N.length(i),s=Gh(e,i,n);return t.N.scale(s,s,1/t.N.length(s)*ce(r,o,n))},o=r([e[0],e[1],e[2]],[i[0],i[1],i[2]],n),s=r([e[4],e[5],e[6]],[i[4],i[5],i[6]],n),a=r([e[8],e[9],e[10]],[i[8],i[9],i[10]],n),l=Gh([e[12],e[13],e[14]],[i[12],i[13],i[14]],n);return[o[0],o[1],o[2],0,s[0],s[1],s[2],0,a[0],a[1],a[2],0,l[0],l[1],l[2],1]}(o,n,r)}return o}function ry(t,e,i,n){const r=Rh.projectAabbCorners(n,i);let o=Number.MAX_VALUE,s=-1;for(let t=0;t<r.length;++t){const i=r[t];i[0]=(.5*i[0]+.5)*e.width,i[1]=(.5-.5*i[1])*e.height,i[2]<o&&(s=t,o=i[2])}const a=t=>new _(r[t][0],r[t][1]);let l;switch(s){case 0:case 6:l=[a(1),a(5),a(4),a(7),a(3),a(2),a(1)];break;case 1:case 7:l=[a(0),a(4),a(5),a(6),a(2),a(3),a(0)];break;case 3:case 5:l=[a(1),a(0),a(4),a(7),a(6),a(2),a(1)];break;default:l=[a(1),a(5),a(6),a(7),a(3),a(0),a(1)]}if(Ol(t,l))return o}const oy=hs([{name:"a_pos_3f",components:3,type:"Float32"}]),sy=hs([{name:"a_color_3f",components:3,type:"Float32"}]),ay=hs([{name:"a_color_4f",components:4,type:"Float32"}]),ly=hs([{name:"a_uv_2f",components:2,type:"Float32"}]),cy=hs([{name:"a_normal_3f",components:3,type:"Float32"}]),uy=hs([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),hy=hs([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class dy{constructor(t,e){this.feature=t,this.instancedDataOffset=e,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class py{constructor(){this.instancedDataArray=new Us,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class fy{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,e,i,n){this.tileToMeter=wl(i);const r=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:o,id:s,index:a,sourceLayerIndex:l}of t){const t=Rl(o,r);if(!this.layers[0]._featureFilter.filter(new Ao(this.zoom),t,i))continue;const c={id:s,sourceLayerIndex:l,index:a,geometry:r?t.geometry:Ll(o,i,n),properties:o.properties,type:o.type,patterns:{}},u=this.addFeature(c,c.geometry,t);u&&e.featureIndex.insert(o,c.geometry,a,l,this.index,this.instancesPerModel[u].instancedDataArray.length,Li/32)}this.lookup=null}update(t,e,i,n){for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];for(const e in t)i.idToFeaturesIndex.hasOwnProperty(e)&&this.evaluate(i.features[i.idToFeaturesIndex[e]],t[e],i,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const n=this.instancesPerModel[i];for(const i of n.features){const r=this.layers[0],o=i.feature,s=this.canonical,a=r.paint.get("model-rotation").evaluate(o,{},s),l=r.paint.get("model-scale").evaluate(o,{},s),c=r.paint.get("model-translation").evaluate(o,{},s);t.N.exactEquals(i.rotation,a)&&t.N.exactEquals(i.scale,l)&&t.N.exactEquals(i.translation,c)||(this.evaluate(i,i.featureStates,n,!0),e=!0)}}return e}isEmpty(){for(const t in this.instancesPerModel)if(0!==this.instancesPerModel[t].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];i.instancedDataArray.length<0||0===i.instancedDataArray.length||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=t.createVertexBuffer(i.instancedDataArray,uy.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const e=this.instancesPerModel[t];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy()}}addFeature(t,e,i){const n=this.layers[0],r=n.layout.get("model-id").evaluate(i,{},this.canonical);if(!r)return j(`modelId is not evaluated for layer ${n.id} and it is not going to get rendered.`),r;this.instancesPerModel[r]||(this.instancesPerModel[r]=new py);const o=this.instancesPerModel[r],s=o.instancedDataArray,a=new dy(i,s.length);for(const t of e)for(const e of t){if(e.x<0||e.x>=Li||e.y<0||e.y>=Li)continue;const t=(this.lookupDim-1)/Li,i=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[i])continue;this.lookup[i]=1}this.instanceCount++;const n=s.length;s.resize(n+1),o.instancesEvaluatedElevation.push(0),s.float32[16*n]=e.x,s.float32[16*n+1]=e.y}return a.instancedDataCount=o.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(t.id&&(o.idToFeaturesIndex[t.id]=o.features.length),o.features.push(a),this.evaluate(a,{},o,!1)),r}evaluate(t,e,i,n){const r=this.layers[0],o=t.feature,s=this.canonical,a=t.rotation=r.paint.get("model-rotation").evaluate(o,e,s),l=t.scale=r.paint.get("model-scale").evaluate(o,e,s),c=t.translation=r.paint.get("model-translation").evaluate(o,e,s),u=r.paint.get("model-color").evaluate(o,e,s);u.a=r.paint.get("model-color-mix-intensity").evaluate(o,e,s);const h=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),ey(h,a,l);const d=Math.round(100*u.a)+u.b/1.05;for(let e=0;e<t.instancedDataCount;++e){const r=t.instancedDataOffset+e,o=16*r,a=i.instancedDataArray.float32;let l=0;n&&(l=a[o+6]-i.instancesEvaluatedElevation[r]);const p=0|a[o+1];a[o]=(0|a[o])+u.r/1.05,a[o+1]=p+u.g/1.05,a[o+2]=d,a[o+3]=1/(s.z>10?this.tileToMeter:wl(s,p)),a[o+4]=c[0],a[o+5]=c[1],a[o+6]=c[2]+l,a[o+7]=h[0],a[o+8]=h[1],a[o+9]=h[2],a[o+10]=h[4],a[o+11]=h[5],a[o+12]=h[6],a[o+13]=h[8],a[o+14]=h[9],a[o+15]=h[10],i.instancesEvaluatedElevation[r]=c[2]}}}io(fy,"ModelBucket",{omit:["layers"]}),io(py,"PerModelAttributes"),io(dy,"ModelFeature");const my=new Vo({visibility:new zo(Ho.layout_model.visibility),"model-id":new Bo(Ho.layout_model["model-id"])});var gy={paint:new Vo({"model-opacity":new zo(Ho.paint_model["model-opacity"]),"model-rotation":new Bo(Ho.paint_model["model-rotation"]),"model-scale":new Bo(Ho.paint_model["model-scale"]),"model-translation":new Bo(Ho.paint_model["model-translation"]),"model-color":new Bo(Ho.paint_model["model-color"]),"model-color-mix-intensity":new Bo(Ho.paint_model["model-color-mix-intensity"]),"model-type":new zo(Ho.paint_model["model-type"]),"model-cast-shadows":new zo(Ho.paint_model["model-cast-shadows"]),"model-receive-shadows":new zo(Ho.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new zo(Ho.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Bo(Ho.paint_model["model-emissive-strength"]),"model-roughness":new Bo(Ho.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Bo(Ho.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new zo(Ho.paint_model["model-cutoff-fade-range"])}),layout:my};const _y=64,yy={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function vy(e,i,n,r,o,s,a,l,c,u=!1){const h=n.zoom,d=n.project(r),p=xl(r.lat,h),f=1/p;t.a6.identity(e),t.a6.translate(e,e,[d.x+a[0]*f,d.y+a[1]*f,a[2]]);let m=1,g=1;const _=n.worldSize;if(u){if("mercator"===n.projection.name){let e=0;n.elevation&&(e=n.elevation.getAtPointOrZero(new El(d.x/_,d.y/_),0));const i=t.a7.transformMat4([],[d.x,d.y,e,1],n.projMatrix)[3]/n.cameraToCenterDistance;m=i,g=i*xl(n.center.lat,h)}else if("globe"===n.projection.name){const i=ny(e,n),o=t.a6.multiply([],n.projMatrix,i),s=[0,0,0,1];t.a7.transformMat4(s,s,o);const a=s[3]/n.cameraToCenterDistance,l=id(h),c=n.projection.pixelsPerMeter(r.lat,_)*xl(r.lat,h),u=n.projection.pixelsPerMeter(n.center.lat,_)*xl(n.center.lat,h);m=a/ce(c,vl(n.center.lat),l),g=a*p/c,m*=u,g*=u}}else m=f;t.a6.scale(e,e,[m,m,g]);const y=[...e],v=i.orientation,x=[];if(ey(x,[v[0]+o[0],v[1]+o[1],v[2]+o[2]],s),t.a6.multiply(e,y,x),l&&n.elevation){let o=0;const s=[];if(c&&n.elevation){o=function(e,i,n,r,o){const s=i.elevation;if(!s)return 0;const a=Rh.projectAabbCorners(n,r),l=fl(1,o.lat)*i.worldSize,c=function(e,i){const n=[0,0,1],r=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const o of r){const r=e[o.corners[0]],s=e[o.corners[1]],a=e[o.corners[2]],l=[s[0]-r[0],s[1]-r[1],i*(s[2]-r[2])],c=t.N.cross(l,l,[a[0]-r[0],a[1]-r[1],i*(a[2]-r[2])]);t.N.normalize(c,c),o.dotProductWithUp=t.N.dot(c,n)}return r.sort(((t,e)=>t.dotProductWithUp-e.dotProductWithUp)),r[0].corners}(a,l),u=a[c[0]],h=a[c[1]],d=a[c[2]],p=a[c[3]],f=s.getAtPointOrZero(new El(u[0]/i.worldSize,u[1]/i.worldSize),0),m=s.getAtPointOrZero(new El(h[0]/i.worldSize,h[1]/i.worldSize),0),g=s.getAtPointOrZero(new El(d[0]/i.worldSize,d[1]/i.worldSize),0),_=s.getAtPointOrZero(new El(p[0]/i.worldSize,p[1]/i.worldSize),0),y=(f+_)/2,v=(m+g)/2;return y>v?m<g?iy(e,h,p,u,m,_,f,l):iy(e,d,u,p,g,f,_,l):f<_?iy(e,u,h,d,f,m,g,l):iy(e,p,d,h,_,g,m,l),Math.max(y,v)}(s,n,i.aabb,e,r);const a=t.a6.fromQuat([],s),l=t.a6.multiply([],a,x);t.a6.multiply(e,y,l)}else o=n.elevation.getAtPointOrZero(new El(d.x/_,d.y/_),0);0!==o&&(e[14]+=o)}}function xy(t,e,i=!1){t.uploaded||(t.gfxTexture=new D_(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function by(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,oy.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,cy.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,ly.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(12===t.colorArray.bytesPerElement?sy:ay).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,hy.members,!0)),t.segments=ia.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const n=t.material;n.pbrMetallicRoughness.baseColorTexture&&xy(n.pbrMetallicRoughness.baseColorTexture,e),n.pbrMetallicRoughness.metallicRoughnessTexture&&xy(n.pbrMetallicRoughness.metallicRoughnessTexture,e),n.normalTexture&&xy(n.normalTexture,e),n.occlusionTexture&&xy(n.occlusionTexture,e,i),n.emissionTexture&&xy(n.emissionTexture,e)}function wy(t,e,i){if(t.meshes)for(const n of t.meshes)by(n,e,i);if(t.children)for(const n of t.children)wy(n,e,i)}function Ey(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)Ey(e)}function Sy(t){if(t.meshes)for(const i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const e of t.children)Sy(e)}class Ty{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class My{constructor(){this.tasks={},this.taskQueue=[],O(["process"],this),this.invoker=new Ty(this.process),this.nextId=0}add(t,e){const i=this.nextId++,n=function({type:t,isSymbolTile:e,zoom:i}){return i=i||0,"message"===t?0:"maybePrepare"!==t||e?"parseTile"!==t||e?"parseTile"===t&&e?300-i:"maybePrepare"===t&&e?400-i:500:200-i:100-i}(e);if(0===n){q();try{t()}finally{}return null}return this.tasks[i]={fn:t,metadata:e,priority:n,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){q();try{if(this.taskQueue=this.taskQueue.filter((t=>!!this.tasks[t])),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn()}finally{}}pick(){let t=null,e=1/0;for(let i=0;i<this.taskQueue.length;i++){const n=this.tasks[this.taskQueue[i]];n.priority<e&&(e=n.priority,t=i)}if(null===t)return null;const i=this.taskQueue[t];return this.taskQueue.splice(t,1),i}remove(){this.invoker.remove()}}class Iy{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},O(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new My}send(t,e,i,n,r=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=o,this.callbacks[s]=i);const a=new Set;return this.target.postMessage({id:s,type:t,hasCallback:!!i,targetMapId:n,mustQueue:r,sourceMapId:this.mapId,data:oo(e,a)},a),{cancel:()=>{i&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[i];delete this.cancelCallbacks[i],t&&t.cancel()}else if(e.mustQueue||q()){const t=this.callbacks[i],n=this.scheduler.add((()=>this.processTask(i,e)),t&&t.metadata||{type:"message"});n&&(this.cancelCallbacks[i]=n)}else this.processTask(i,e)}processTask(t,e){if(delete this.cancelCallbacks[t],"<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(so(e.error)):i(null,so(e.data)))}else{const i=new Set,n=e.hasCallback?(e,n)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?oo(e):null,data:oo(n,i)},i)}:t=>{},r=so(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,r,n);else if(this.parent.getWorkerSource){const t=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,t[0],r.source,r.scope)[t[1]](r,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Cy{constructor(t,e){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=R();const i=this.workerPool.acquire(this.id);for(let t=0;t<i.length;t++){const n=new Cy.Actor(i[t],e,this.id);n.name=`Worker ${t}`,this.actors.push(n)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,e,i){A(this.actors,((i,n)=>{i.send(t,e,n)}),i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((t=>{t.remove()})),this.actors=[],this.workerPool.release(this.id)}}Cy.Actor=Iy;var Ay={workerUrl:"",workerClass:null,workerParams:void 0};function Py(){return null!=Ay.workerClass?new Ay.workerClass:new self.Worker(Ay.workerUrl,Ay.workerParams)}const Ly="mapboxgl_preloaded_worker_pool";class Ry{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ry.workerCount;)this.workers.push(new Py);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&0===this.numActive()&&(this.workers.forEach((t=>{t.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ly]}numActive(){return Object.keys(this.active).length}}let Dy;function ky(){return Dy||(Dy=new Ry),Dy}Ry.workerCount=2;let Ny,Oy,Fy,zy,By,Uy=null;function Vy(){return q()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Oy||n.DRACO_URL}function jy(){if(q()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(zy)return zy;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return zy=WebAssembly.validate(t)?n.MESHOPT_SIMD_URL:n.MESHOPT_URL,zy}const Gy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Hy={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Wy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function qy(t,e,i){const n=i.json.bufferViews.length,r=i.buffers.length;e.bufferView=n,i.json.bufferViews[n]={buffer:r,byteLength:t.byteLength},i.buffers[r]=t}const Xy="KHR_draco_mesh_compression";function $y(t,e){const i=t.extensions&&t.extensions[Xy];if(!i)return;const n=new Fy.Decoder,r=ev(e,i.bufferView),o=new Fy.Mesh;if(!n.DecodeArrayToMesh(r,r.byteLength,o))throw new Error("Failed to decode Draco mesh");const s=e.json.accessors[t.indices],a=Gy[s.componentType],l=s.count*a.BYTES_PER_ELEMENT,c=Fy._malloc(l);a===Uint16Array?n.GetTrianglesUInt16Array(o,l,c):n.GetTrianglesUInt32Array(o,l,c),qy(Fy.memory.buffer.slice(c,c+l),s,e),Fy._free(c);for(const r of Object.keys(i.attributes)){const s=n.GetAttributeByUniqueId(o,i.attributes[r]),a=e.json.accessors[t.attributes[r]],l=Hy[a.componentType],c=a.count*Wy[a.type]*Gy[a.componentType].BYTES_PER_ELEMENT,u=Fy._malloc(c);n.GetAttributeDataArrayForAllPoints(o,s,Fy[l],c,u),qy(Fy.memory.buffer.slice(u,u+c),a,e),Fy._free(u)}n.destroy(),o.destroy(),delete t.extensions[Xy]}const Yy="EXT_meshopt_compression";function Zy(t,e){if(!t.extensions||!t.extensions[Yy])return;const i=t.extensions[Yy],n=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),r=new Uint8Array(i.count*i.byteStride);By.decodeGltfBuffer(r,i.count,i.byteStride,n,i.mode,i.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=r.buffer,delete t.extensions[Yy]}const Ky=1179937895,Jy=new TextDecoder("utf8");function Qy(t,e){return new URL(t,e).href}function tv(t,e,i,n){return fetch(Qy(t.uri,n)).then((t=>t.arrayBuffer())).then((t=>{e.buffers[i]=t}))}function ev(t,e){const i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function iv(t,e,i,n){if(t.uri){const r=Qy(t.uri,n);return fetch(r).then((t=>t.blob())).then((t=>createImageBitmap(t))).then((t=>{e.images[i]=t}))}if(void 0!==t.bufferView){const n=ev(e,t.bufferView),r=new Blob([n],{type:t.mimeType});return createImageBitmap(r).then((t=>{e.images[i]=t}))}}function nv(t,e=0,i){const n={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===Ky){const i=new Uint32Array(t,e);let r=2;const o=(i[r++]>>2)-3,s=i[r++]>>2;if(r++,n.json=JSON.parse(Jy.decode(i.subarray(r,r+s))),r+=s,r<o){const o=i[r++];r++;const s=e+(r<<2);n.buffers[0]=t.slice(s,s+o)}}else n.json=JSON.parse(Jy.decode(new Uint8Array(t,e)));const{buffers:r,images:o,meshes:s,extensionsUsed:a,bufferViews:l}=n.json;let c=Promise.resolve();if(r){const t=[];for(let e=0;e<r.length;e++){const o=r[e];o.uri?t.push(tv(o,n,e,i)):n.buffers[e]||(n.buffers[e]=null)}c=Promise.all(t)}return c.then((()=>{const t=[],e=a&&a.includes(Xy),r=a&&a.includes(Yy);if(e&&t.push(function(){if(!Fy)return Ny||(Ny=function(t){let e,i=null;function n(){e=new Uint8Array(i.buffer)}function r(){throw new Error("Unexpected Draco error.")}const o={a:{a:r,d:function(t,i,n){return e.copyWithin(t,i,i+n)},c:function(t){const r=e.length,o=Math.max(t>>>0,Math.ceil(1.2*r)),s=Math.ceil((o-r)/65536);try{return i.grow(s),n(),!0}catch(t){return!1}},b:r}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(t,o):t.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,o)))).then((t=>{const{Rb:r,Qb:o,P:s,T:a,X:l,Ja:c,La:u,Qa:h,Va:d,Wa:p,eb:f,jb:m,f:g,e:_,yb:y,zb:v,Ab:x,Bb:b,Db:w,Gb:E}=t.instance.exports;i=_;const S=(()=>{let t=0,i=0,n=0,s=0;return a=>{n&&(r(s),r(t),i+=n,n=t=0),t||(i+=128,t=o(i));const l=a.length+7&-8;let c=t;l>=i&&(n=l,c=s=o(l));for(let t=0;t<a.length;t++)e[c+t]=a[t];return c}})();return n(),g(),{memory:_,_free:r,_malloc:o,Mesh:class{constructor(){this.ptr=s()}destroy(){a(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){m(this.ptr)}DecodeArrayToMesh(t,e,i){const n=S(t),r=u(this.ptr,n,e,i.ptr);return!!l(r)}GetAttributeByUniqueId(t,e){return{ptr:h(this.ptr,t.ptr,e)}}GetTrianglesUInt16Array(t,e,i){d(this.ptr,t.ptr,e,i)}GetTrianglesUInt32Array(t,e,i){p(this.ptr,t.ptr,e,i)}GetAttributeDataArrayForAllPoints(t,e,i,n,r){f(this.ptr,t.ptr,e.ptr,i,n,r)}},DT_INT8:y(),DT_UINT8:v(),DT_INT16:x(),DT_UINT16:b(),DT_UINT32:w(),DT_FLOAT32:E()}}))}(fetch(Vy())),Ny.then((t=>{Fy=t,Ny=void 0})))}()),r&&t.push(function(){if(By)return;const t=function(t){let e;const i=WebAssembly.instantiateStreaming(t,{}).then((t=>{e=t.instance,e.exports.__wasm_call_ctors()})),n={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},r={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:i,supported:!0,decodeGltfBuffer(t,i,o,s,a,l){!function(t,e,i,n,r,o,s){const a=t.exports.sbrk,l=n+3&-4,c=a(l*r),u=a(o.length),h=new Uint8Array(t.exports.memory.buffer);h.set(o,u);const d=e(c,n,r,u,o.length);if(0===d&&s&&s(c,l,r),i.set(h.subarray(c,c+n*r)),a(c-a(0)),0!==d)throw new Error(`Malformed buffer data: ${d}`)}(e,e.exports[r[a]],t,i,o,s,e.exports[n[l]])}}}(fetch(jy()));return t.ready.then((()=>{By=t}))}()),o)for(let e=0;e<o.length;e++)t.push(iv(o[e],n,e,i));return(t.length?Promise.all(t):Promise.resolve()).then((()=>{if(e&&s)for(const{primitives:t}of s)for(const e of t)$y(e,n);if(r&&s&&l)for(const t of l)Zy(t,n);return n}))}))}class rv{constructor(t,e,i){if(this.triangleCount=e.length/3,this.min=new _(0,0),this.max=new _(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===t.length||0===i)return;const n=t.map((t=>t.x)),r=t.map((t=>t.y));this.min=new _(Math.min(...n),Math.min(...r)),this.max=new _(Math.max(...n),Math.max(...r));const o=this.max.sub(this.min);o.x=Math.max(o.x,1),o.y=Math.max(o.y,1);const s=Math.max(o.x,o.y)/i;this.cellsX=Math.max(1,Math.ceil(o.x/s)),this.cellsY=Math.max(1,Math.ceil(o.y/s)),this.xScale=1/s,this.yScale=1/s;const a=[];for(let i=0;i<this.triangleCount;i++){const n=t[e[3*i+0]].sub(this.min),r=t[e[3*i+1]].sub(this.min),o=t[e[3*i+2]].sub(this.min),l=ov(Math.floor(Math.min(n.x,r.x,o.x)),this.xScale,this.cellsX),c=ov(Math.floor(Math.max(n.x,r.x,o.x)),this.xScale,this.cellsX),u=ov(Math.floor(Math.min(n.y,r.y,o.y)),this.yScale,this.cellsY),h=ov(Math.floor(Math.max(n.y,r.y,o.y)),this.yScale,this.cellsY),d=new _(0,0),p=new _(0,0),f=new _(0,0),m=new _(0,0);for(let t=u;t<=h;++t){d.y=p.y=t*s,f.y=m.y=(t+1)*s;for(let e=l;e<=c;++e)d.x=f.x=e*s,p.x=m.x=(e+1)*s,(Yl(n,r,o,d,p,m)||Yl(n,r,o,d,m,f))&&a.push({cellIdx:t*this.cellsX+e,triIdx:i})}}if(0===a.length)return;a.sort(((t,e)=>t.cellIdx-e.cellIdx||t.triIdx-e.triIdx));let l=0;for(;l<a.length;){const t=a[l].cellIdx,e={start:this.payload.length,len:0};for(;l<a.length&&a[l].cellIdx===t;)++e.len,this.payload.push(a[l++].triIdx);this.cells[t]=e}}query(t,e,i){if(0===this.triangleCount||0===this.cells.length)return;if(t.x>this.max.x||this.min.x>e.x)return;if(t.y>this.max.y||this.min.y>e.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let t=0;t<this.lookup.length;t++)this.lookup[t]=0;const n=ov(t.x-this.min.x,this.xScale,this.cellsX),r=ov(e.x-this.min.x,this.xScale,this.cellsX),o=ov(t.y-this.min.y,this.yScale,this.cellsY),s=ov(e.y-this.min.y,this.yScale,this.cellsY);for(let t=o;t<=s;t++)for(let e=n;e<=r;e++){const n=this.cells[t*this.cellsX+e];if(n)for(let t=0;t<n.len;t++){const e=this.payload[n.start+t],r=Math.floor(e/8),o=1<<e%8;if(!(this.lookup[r]&o)&&(this.lookup[r]|=o,i.push(e),i.length===this.triangleCount))return}}}}function ov(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}function sv(t,e){const i=t.json.bufferViews[e.bufferView],n=Gy[e.componentType];return new n(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Wy[e.type]*n.BYTES_PER_ELEMENT?i.byteStride/n.BYTES_PER_ELEMENT:Wy[e.type]))}function av(t,e,i,n){const r=Gy[e.componentType],o=function(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(r),s=t.json.bufferViews[e.bufferView],a=s.byteStride?s.byteStride/r.BYTES_PER_ELEMENT:Wy[e.type],l=i.float32,c=l.length/i.capacity;for(let t=0,i=0;t<e.count*a;t+=a,i+=c)for(let e=0;e<c;e++)l[i+e]=n[t+e]*o;i._trim()}function lv(t,e,i){const n=t.indices,r=t.attributes,o={};o.indexArray=new Ps;const s=e.json.accessors[n],a=s.count/3;o.indexArray.reserve(a);const l=sv(e,s);for(let t=0;t<a;t++)o.indexArray.emplaceBack(l[3*t],l[3*t+1],l[3*t+2]);o.indexArray._trim(),o.vertexArray=new zs;const c=e.json.accessors[r.POSITION];o.vertexArray.reserve(c.count);const u=sv(e,c);for(let t=0;t<c.count;t++)o.vertexArray.emplaceBack(u[3*t],u[3*t+1],u[3*t+2]);if(o.vertexArray._trim(),o.aabb=new Rh(c.min,c.max),o.centroid=function(t,e){const i=[0,0,0],n=t.length;if(n>0){for(let r=0;r<n;r++){const n=3*t[r];i[0]+=e[n],i[1]+=e[n+1],i[2]+=e[n+2]}i[0]/=n,i[1]/=n,i[2]/=n}return i}(l,u),void 0!==r.COLOR_0){const t=e.json.accessors[r.COLOR_0],i=Wy[t.type],n=sv(e,t);o.colorArray=3===i?new zs:new ys,o.colorArray.resize(t.count),av(e,t,o.colorArray,n)}if(void 0!==r.NORMAL){o.normalArray=new zs;const t=e.json.accessors[r.NORMAL];o.normalArray.resize(t.count);const i=sv(e,t);av(e,t,o.normalArray,i)}if(void 0!==r.TEXCOORD_0&&i.length>0){o.texcoordArray=new Bs;const t=e.json.accessors[r.TEXCOORD_0];o.texcoordArray.resize(t.count);const i=sv(e,t);av(e,t,o.texcoordArray,i)}if(void 0!==r._FEATURE_ID_RGBA4444){const t=e.json.accessors[r._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(o.featureData=sv(e,t))}void 0!==r._FEATURE_RGBA4444&&(o.featureData=new Uint32Array(sv(e,e.json.accessors[r._FEATURE_RGBA4444]).buffer));const h=t.material;return o.material=function(t,e){const{emissiveFactor:i=[0,0,0],alphaMode:n="OPAQUE",alphaCutoff:r=.5,normalTexture:o,occlusionTexture:s,emissiveTexture:a,doubleSided:l}=t,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:h=1,baseColorTexture:d,metallicRoughnessTexture:p}=t.pbrMetallicRoughness||{},f=s?e[s.index]:void 0;if(s&&s.extensions&&s.extensions.KHR_texture_transform&&f){const t=s.extensions.KHR_texture_transform;f.offsetScale=[t.offset[0],t.offset[1],t.scale[0],t.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new le(...c),metallicFactor:u,roughnessFactor:h,baseColorTexture:d?e[d.index]:void 0,metallicRoughnessTexture:p?e[p.index]:void 0},doubleSided:l,emissiveFactor:i,alphaMode:n,alphaCutoff:r,normalTexture:o?e[o.index]:void 0,occlusionTexture:f,emissionTexture:a?e[a.index]:void 0,defined:void 0===t.defined}}(void 0!==h?e.json.materials[h]:{defined:!1},i),o}function cv(e,i,n){const{matrix:r,rotation:o,translation:s,scale:a,mesh:l,extras:c,children:u}=e,h={};if(h.matrix=r||t.a6.fromRotationTranslationScale([],o||[0,0,0,1],s||[0,0,0],a||[1,1,1]),void 0!==l){h.meshes=n[l];const t=h.anchor=[0,0];for(const e of h.meshes){const{min:i,max:n}=e.aabb;t[0]+=i[0]+n[0],t[1]+=i[1]+n[1]}t[0]=Math.floor(t[0]/h.meshes.length/2),t[1]=Math.floor(t[1]/h.meshes.length/2)}if(c&&(c.id&&(h.id=c.id),c.lights&&(h.lights=function(t){if(!t.length)return[];const e=function(t){const e=atob(t),i=new Uint8Array(e.length);for(let t=0;t<e.length;t++)i[t]=e.codePointAt(t);return i}(t),i=[],n=e.length/24,r=new Uint16Array(e.buffer),o=new Float32Array(e.buffer);for(let t=0;t<n;t++){const e=r[2*t*6]/30,n=r[2*t*6+1]/30,s=r[2*t*6+10]/100,a=o[6*t+1],l=o[6*t+2],c=o[6*t+3],u=o[6*t+4],h=c-a,d=u-l,p=Math.hypot(h,d);i.push({pos:[a+.5*h,l+.5*d,n],normal:[d/p,-h/p,0],width:p,height:e,depth:s,points:[a,l,c,u]})}return i}(c.lights))),u){const t=[];for(const e of u)t.push(cv(i.json.nodes[e],i,n));h.children=t}return h}function uv(t){if(0===t.vertices.length||0===t.indices.length)return null;const[e,i]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let n=1;n<t.vertices.length;++n){const r=t.vertices[n];e.x=Math.min(e.x,r.x),e.y=Math.min(e.y,r.y),i.x=Math.max(i.x,r.x),i.y=Math.max(i.y,r.y)}const n=Math.ceil(Math.max(i.x-e.x,i.y-e.y)/256),r=Math.max(8,n),o=new rv(t.vertices,t.indices,r);return{vertices:t.vertices,indices:t.indices,grid:o,min:e,max:i}}function hv(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||0===e.length)return null;const i=e[0];if(!i||!Array.isArray(i)||0===i.length)return null;const n=[];for(const t of i){if(!Array.isArray(t)||2!==t.length)continue;const e=t[0],i=t[1];"number"==typeof e&&"number"==typeof i&&n.push(new _(e,i))}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let r=0;for(let t=0;t<n.length;t++){const e=n[t],i=n[(t+1)%n.length],o=n[(t+2)%n.length];r+=(e.x-i.x)*(o.y-i.y)-(o.x-i.x)*(e.y-i.y)}r>0&&n.reverse();const o=ip(n.flatMap((t=>[t.x,t.y])),[]);return 0===o.length?null:{vertices:n,indices:o}}function dv(t){const e=[],i=[];let n=0;for(const r of t){n=e.length;const t=r.vertexArray.float32,o=r.indexArray.uint16;for(let i=0;i<r.vertexArray.length;i++)e.push(new _(t[3*i+0],t[3*i+1]));for(let t=0;t<3*r.indexArray.length;t++)i.push(o[t]+n)}if(i.length%3!=0)return null;for(let t=0;t<i.length;t+=3){const n=e[i[t+0]],r=e[i[t+1]],o=e[i[t+2]];(n.x-r.x)*(o.y-r.y)-(o.x-r.x)*(n.y-r.y)>0&&([i[t+1],i[t+2]]=[i[t+2],i[t+1]])}return{vertices:e,indices:i}}function pv(t){const e=function(t,e){const i=[],n=WebGL2RenderingContext;if(t.json.textures)for(const r of t.json.textures){const o={magFilter:n.LINEAR,minFilter:n.NEAREST,wrapS:n.REPEAT,wrapT:n.REPEAT};void 0!==r.sampler&&Object.assign(o,t.json.samplers[r.sampler]),i.push({image:e[r.source],sampler:o,uploaded:!1})}return i}(t,t.images),i=function(t,e){const i=[];for(const n of t.json.meshes){const r=[];for(const i of n.primitives)r.push(lv(i,t,e));i.push(r)}return i}(t,e),{scenes:n,scene:r,nodes:o}=t.json,s=n?n[r||0].nodes:o,a=[];for(const e of s)a.push(cv(o[e],t,i));return function(t,e,i){const n={},r=new Set;for(let o=0;o<t.length;o++){const t=i[e[o]];if(!t.extras)continue;const s=t.extras["mapbox:footprint:version"],a=t.extras["mapbox:footprint:id"];(s||a)&&r.add(o),"1.0.0"===s&&a&&(n[a]=o)}for(let o=0;o<t.length;o++){if(r.has(o))continue;const s=t[o],a=i[e[o]];if(!a.extras)continue;let l=null;s.id in n&&(l=dv(t[n[s.id]].meshes)),l||(l=hv(a)),l&&(s.footprint=uv(l))}if(r.size>0){const e=Array.from(r.values()).sort(((t,e)=>t-e));for(let i=e.length-1;i>=0;i--)t.splice(e[i],1)}}(a,s,t.json.nodes),a}function fv(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,i=t.aabb.min[0]-1,n=t.aabb.min[1]-1,r=_y/(t.aabb.max[0]-i+2),o=_y/(t.aabb.max[1]-n+2);for(let s=0;s<e.length;s+=3){const a=e[s+2],l=(e[s+0]-i)*r|0,c=(e[s+1]-n)*o|0;a>t.heightmap[c*_y+l]&&(t.heightmap[c*_y+l]=a)}}function mv(e,i){const n={};n.indexArray=new Ps,n.indexArray.reserve(4*e.length),n.vertexArray=new zs,n.vertexArray.reserve(10*e.length),n.colorArray=new ys,n.vertexArray.reserve(10*e.length);let r=0;for(const o of e){const e=Math.min(10,Math.max(4,1.3*o.height))*i,s=[-o.normal[1],o.normal[0],0],a=Math.min(.29,.1*o.width/o.depth),l=o.width-2*o.depth*i*(a+.01),c=t.N.scaleAndAdd([],o.pos,s,l/2),u=t.N.scaleAndAdd([],o.pos,s,-l/2),h=[c[0],c[1],c[2]+o.height],d=[u[0],u[1],u[2]+o.height],p=t.N.scaleAndAdd([],o.normal,s,a);t.N.scale(p,p,e);const f=t.N.scaleAndAdd([],o.normal,s,-a);t.N.scale(f,f,e),t.N.add(p,c,p),t.N.add(f,u,f),c[2]+=.1,u[2]+=.1,n.vertexArray.emplaceBack(p[0],p[1],p[2]),n.vertexArray.emplaceBack(f[0],f[1],f[2]),n.vertexArray.emplaceBack(c[0],c[1],c[2]),n.vertexArray.emplaceBack(u[0],u[1],u[2]),n.vertexArray.emplaceBack(h[0],h[1],h[2]),n.vertexArray.emplaceBack(d[0],d[1],d[2]),n.vertexArray.emplaceBack(c[0],c[1],c[2]),n.vertexArray.emplaceBack(u[0],u[1],u[2]),n.vertexArray.emplaceBack(p[0],p[1],p[2]),n.vertexArray.emplaceBack(f[0],f[1],f[2]);const m=l/e/2;n.colorArray.emplaceBack(-m-a,-1,m,.8),n.colorArray.emplaceBack(m+a,-1,m,.8),n.colorArray.emplaceBack(-m,0,m,1.3),n.colorArray.emplaceBack(m,0,m,1.3),n.colorArray.emplaceBack(m+a,-.8,m,.7),n.colorArray.emplaceBack(m+a,-.8,m,.7),n.colorArray.emplaceBack(0,0,m,1.3),n.colorArray.emplaceBack(0,0,m,1.3),n.colorArray.emplaceBack(m+a,-1.2,m,.8),n.colorArray.emplaceBack(m+a,-1.2,m,.8),n.indexArray.emplaceBack(6+r,4+r,8+r),n.indexArray.emplaceBack(7+r,9+r,5+r),n.indexArray.emplaceBack(0+r,1+r,2+r),n.indexArray.emplaceBack(1+r,3+r,2+r),r+=10}const o={defined:!0,emissiveFactor:[0,0,0]},s={};return s.baseColorFactor=le.white,o.pbrMetallicRoughness=s,n.material=o,n.aabb=new Rh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}io(rv,"TriangleGridIndex");class gv{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const _v=["tile","layer","source","sourceLayer","state"];class yv{constructor(t,e,i,n,r){this.type="Feature",this._vectorTileFeature=t,this._z=e,this._x=i,this._y=n,this.properties=t.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const e of _v)void 0!==this[e]&&(t[e]=this[e]);return t}}class vv{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new to(Li,16,0),this.featureIndexArray=new Js,this.promoteId=e,this.is3DTile=!1}insert(t,e,i,n,r,o=0,s=0){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,r,o);const l=this.grid;for(let t=0;t<e.length;t++){const i=e[t],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<i.length;t++){const e=i[t];n[0]=Math.min(n[0],e.x),n[1]=Math.min(n[1],e.y),n[2]=Math.max(n[2],e.x),n[3]=Math.max(n[3],e.y)}0!==s&&(n[0]-=s,n[1]-=s,n[2]+=s,n[3]+=s),n[0]<Li&&n[1]<Li&&n[2]>=0&&n[3]>=0&&l.insert(a,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Cp(new Om(this.rawTileData)).layers,this.sourceLayerCoder=new gv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,e,i,n){this.loadVTLayers();const r=t.params||{},o=qo(r.filter),s=t.tileResult,a=t.transform,l=s.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((t,e,i,n)=>ql(s.bufferedTilespaceGeometry,t,e,i,n)));c.sort(bv);let u=null;a.elevation&&c.length>0&&(u=Zp.create(a.elevation,this.tileID));const h={};let d;for(let l=0;l<c.length;l++){const p=c[l];if(p===d)continue;d=p;const f=this.featureIndexArray.get(p);let m=null;if(this.is3DTile){const t=this.bucketLayerIDs[0][0],i=e[t];if("model"!==i.type)continue;const{queryFeature:n,intersectionZ:r}=i.queryIntersectsMatchingFeature(s,f.featureIndex,o,a);n&&this.appendToResult(h,t,f.featureIndex,n,r)}else this.loadMatchingFeature(h,f,o,r.layers,r.availableImages,e,i,n,((e,i,n,r=0)=>(m||(m=Ll(e,this.tileID.canonical,t.tileTransform)),i.queryIntersectsFeature(s,e,n,m,this.z,t.transform,t.pixelPosMatrix,u,r))))}return h}loadMatchingFeature(t,e,i,n,r,o,s,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=e,p=this.bucketLayerIDs[u];if(n&&!function(t,e){for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(n,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(i.needGeometry){const t=Rl(m,!0);if(!i.filter(new Ao(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!i.filter(new Ao(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let e=0;e<p.length;e++){const i=p[e];if(n&&n.indexOf(i)<0)continue;const u=o[i];if(!u)continue;let h={};void 0!==g&&a&&(h=a.getState(u.sourceLayer||"_geojsonTileLayer",g));const f=!l||l(m,u,h,d);if(!f)continue;const _=new yv(m,this.z,this.x,this.y,g),y=P({},s[i]);y.paint=xv(y.paint,u.paint,m,h,r),y.layout=xv(y.layout,u.layout,m,h,r),_.layer=y,this.appendToResult(t,i,c,_,f)}}appendToResult(t,e,i,n,r){let o=t[e];void 0===o&&(o=t[e]=[]),o.push({featureIndex:i,feature:n,intersectionZ:r})}lookupSymbolFeatures(t,e,i,n,r,o,s,a){const l={};this.loadVTLayers();const c=qo(r);for(const r of t)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:n,featureIndex:r,layoutVertexArrayOffset:0},c,o,s,a,e);return l}loadFeature(t){const{featureIndex:e,sourceLayerIndex:i}=t;this.loadVTLayers();const n=this.sourceLayerCoder.decode(i),r=this.vtFeatures[n];if(r[e])return r[e];const o=this.vtLayers[n].feature(e);return r[e]=o,o}hasLayer(t){for(const e of this.bucketLayerIDs)for(const i of e)if(t===i)return!0;return!1}getId(t,e){let i=t.id;if(this.promoteId){const n="string"==typeof this.promoteId?this.promoteId:this.promoteId[e];null!=n&&(i=t.properties[n]),"boolean"==typeof i&&(i=Number(i))}return i}}function xv(t,e,i,n,r){return z(t,((t,o)=>{const s=e instanceof Fo?e.get(o):null;return s&&s.evaluate?s.evaluate(i,n,r):s}))}function bv(t,e){return e-t}io(vv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const wv=new Float32Array(262144),Ev=new Uint8Array(262144);function Sv(t){let e=0;if(t.meshes)for(const i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(const i of t.children)e=Math.max(e,Sv(i));return e}function Tv(t,e,i){if(t.meshes)for(const n of t.meshes)n.aabb.min[0]!==1/0&&i.insert(e,n.aabb.min[0],n.aabb.min[1],n.aabb.max[0],n.aabb.max[1]);if(t.children)for(const n of t.children)Tv(n,e,i)}const Mv=["","wall","door","roof","window","lamp","logo"];class Iv{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:Sv(t)}}}getLocalBounds(){if(!this.node.meshes)return new Rh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const e=new Rh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.node.meshes)this.node.lightMeshIndex!==t&&e.encapsulate(i.aabb),t++;this.aabb=e}return this.aabb}}class Cv{constructor(t,e,i,n,r,o){this.id=e,this.modelTraits|=yy.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=yy.HasMapboxMeshFeatures),n&&(this.modelTraits|=yy.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=r,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const e of t)this.nodesInfo.push(new Iv(e)),Tv(e,o.featureIndexArray.length,o.grid),o.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,o.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const e=this.getNodesInfo();for(const i of e){const e=i.node;this.uploaded?this.updatePbrBuffer(e):wy(e,t,!0)}for(const t of e)Ey(t.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let e=!1;if(!t.meshes)return e;for(const i of t.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),e=!0);return e}needsReEvaluation(t,e,i){const n=t.transform.projectionOptions,r=t.style.getBrightness(),o=this.brightness!==r;return!!(!this.uploaded||this.dirty||n.name!==this.projection.name||Av(i.paint.get("model-color").value,o)||Av(i.paint.get("model-color-mix-intensity").value,o)||Av(i.paint.get("model-roughness").value,o)||Av(i.paint.get("model-emissive-strength").value,o)||Av(i.paint.get("model-height-based-emissive-strength-multiplier").value,o))&&(this.projection=n,this.brightness=r,!0)}evaluateScale(t,e){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const i=this.getNodesInfo(),n=this.id.canonical;for(const t of i){const i=t.feature;t.evaluatedScale=e.paint.get("model-scale").evaluate(i,{},n)}}evaluate(t){const e=this.getNodesInfo();for(const i of e){if(!i.node.meshes)continue;const e=i.feature,n=i.node.meshes&&i.node.meshes[0].featureData,r=i.evaluatedColor[2],o=i.evaluatedRMEA[2],s=this.id.canonical;if(i.hasTranslucentParts=!1,n){for(let n=0;n<Mv.length;n++){const r=Mv[n];r.length&&(e.properties.part=r);const o=t.paint.get("model-color").evaluate(e,{},s),a=t.paint.get("model-color-mix-intensity").evaluate(e,{},s);i.evaluatedColor[n]=[o.r,o.g,o.b,a],i.evaluatedRMEA[n][0]=t.paint.get("model-roughness").evaluate(e,{},s),i.evaluatedRMEA[n][2]=t.paint.get("model-emissive-strength").evaluate(e,{},s),i.evaluatedRMEA[n][3]=o.a,i.emissionHeightBasedParams[n]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(e,{},s),!i.hasTranslucentParts&&o.a<1&&(i.hasTranslucentParts=!0)}delete e.properties.part,Lv(i,r!==i.evaluatedColor[2]||o!==i.evaluatedRMEA[2],this.modelTraits)}else i.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(e,{},s);i.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},s),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,e,i,n){const r=t.findDEMTileFor(i);if(r&&(r.tileID.canonical!==this.terrainTile||e!==this.terrainExaggeration)){if(r.dem&&r.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=r.tileID.overscaledZ;const e=Zp.create(t,i,r);if(!e)return;this.modelTraits&yy.HasMapboxMeshFeatures&&this.updateDEM(t,e,i,n);for(const t of this.getNodesInfo()){const i=t.node;if(!i.footprint||!i.footprint.vertices||!i.footprint.vertices.length)continue;const n=i.footprint.vertices;let r=e.getElevationAt(n[0].x,n[0].y,!0,!0);for(let t=1;t<n.length;t++)r=Math.min(r,e.getElevationAt(n[t].x,n[t].y,!0,!0));i.elevation=r}}this.terrainTile=r.tileID.canonical,this.terrainExaggeration=e}}updateDEM(t,e,i,n){let r=e._dem._modifiedForSources[n];if(void 0===r&&(e._dem._modifiedForSources[n]=[],r=e._dem._modifiedForSources[n]),r.includes(i.canonical))return;const o=e._dem.dim;r.push(i.canonical);let s=!1;for(const t of this.getNodesInfo()){const i=t.node;if(!i.footprint||!i.footprint.grid)continue;const n=i.footprint.grid,r=e.tileCoordToPixel(n.min.x,n.min.y),a=e.tileCoordToPixel(n.max.x,n.max.y),l=Math.min(Math.min(o-a.y,r.x),Math.min(r.y,o-a.x));if(l<0)continue;const c=M(l,2,5);let u=Math.max(0,r.x-c),h=Math.max(0,r.y-c),d=Math.min(a.x+c,o-1),p=Math.min(a.y+c,o-1);for(let t=h;t<=p;++t)for(let e=u;e<=d;++e)Ev[t*o+e]=255;let f=0,m=0;for(let t=0;t<n.cellsY;++t)for(let i=0;i<n.cellsX;++i){if(!n.cells[t*n.cellsX+i])continue;const r=e.tileCoordToPixel(n.min.x+i/n.xScale,n.min.y+t/n.yScale),s=e.tileCoordToPixel(n.min.x+(i+1)/n.xScale,n.min.y+(t+1)/n.yScale);for(let t=r.y;t<=Math.min(s.y+1,o-1);++t)for(let i=r.x;i<=Math.min(s.x+1,o-1);++i)255===Ev[t*o+i]&&(Ev[t*o+i]=0,f+=e.getElevationAtPixel(i,t),m++)}const g=f/m;u=Math.max(1,r.x-c),h=Math.max(1,r.y-c),d=Math.min(a.x+c,o-2),p=Math.min(a.y+c,o-2),s=!0;for(let t=h;t<=p;++t)for(let i=u;i<=d;++i)0===Ev[t*o+i]&&(wv[t*o+i]=e._dem.set(i,t,g));for(let t=1;t<c;++t){u=Math.max(1,r.x-t),h=Math.max(1,r.y-t),d=Math.min(a.x+t,o-2),p=Math.min(a.y+t,o-2);for(let i=h;i<=p;++i)for(let n=u;n<=d;++n){const r=i*o+n;if(255===Ev[r]){let s=0,a=0,l=-1,u=-1;for(let e=-1;e<=1;++e)for(let r=-1;r<=1;++r){const c=(i+e)*o+n+r;if(Ev[c]>=t)continue;const h=wv[c],d=Math.abs(h);d>a&&(s=h,a=d,l=r,u=e)}if(a>.1){const o=1-(t+.5*Math.abs(l*u))/c;let a=e._dem.get(n,i)+s*o;const h=e._dem.get(n+l,i+u),d=e._dem.get(n-l,i-u,!0);(a-h)*(a-d)>0&&(a=(h+d)/2),wv[r]=e._dem.set(n,i,a),Ev[r]=t}}}}}s&&(e._demTile.needsDEMTextureUpload=!0,e._dem._timestamp=st.now())}getNodesInfo(){return this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const e of t)Ey(e.node),Sy(e.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,e){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const i=e.getReplacementRegionsForTile(t.toUnwrapped()),n=this.getNodesInfo();for(let t=0;t<this.nodesInfo.length;t++){const e=n[t].node;n[t].hiddenByReplacement=!!e.footprint&&!i.find((t=>t.footprint===e.footprint))}}getHeightAtTileCoord(t,e){const i=this.getNodesInfo(),n=[];for(let r=0;r<this.nodesInfo.length;r++){const o=i[r],s=o.node.meshes[0];if(t<s.aabb.min[0]||e<s.aabb.min[1]||t>s.aabb.max[0]||e>s.aabb.max[1])continue;const a=(t-s.aabb.min[0])/(s.aabb.max[0]-s.aabb.min[0])*_y|0,l=Math.min(63,(e-s.aabb.min[1])/(s.aabb.max[1]-s.aabb.min[1])*_y|0)*_y+Math.min(63,a);if(!(s.heightmap[l]<0&&o.node.footprint)){if(o.hiddenByReplacement)return;return{height:s.heightmap[l],maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]}}if(o.node.footprint.grid.query(new _(t,e),new _(t,e),n),n.length>0)return{height:void 0,maxHeight:o.feature.properties.height,hidden:o.hiddenByReplacement,verticalScale:o.evaluatedScale[2]}}}}function Av(t,e){return!t.isLightConstant&&e}function Pv(t,e,i,n,r,o,s,a){let l=(61440&e|(61440&e)>>4)>>8,c=(3840&e|(3840&e)>>4)>>4,u=240&e|(240&e)>>4;i[3]>0&&(l=ce(l,255*i[0],i[3]),c=ce(c,255*i[1],i[3]),u=ce(u,255*i[2],i[3]));const h=l<<8|c,d=u<<8|Math.floor(255*n[3]),p=function(t){const e=M(t,0,2);return Math.min(Math.round(.5*e*255),255)}(n[2])<<8|15*n[0]<<4|15*n[1],f=M(r[0],0,1),m=M(r[1],0,1),g=M(r[2],0,1),_=M(r[3],0,1);let y,v,x,b;if(f!==m&&s!==o&&m!==f){const t=s-o;v=1/(t*(m-f)),x=-(o+t*f)/(t*(m-f));const e=M(r[4],-1,1);b=Math.pow(10,e),y=255*g<<8|255*_}else y=65535,v=0,x=1,b=1;if(t.emplaceBack(h,d,p,y,v,x,b),a){const t=a.length;a.clear();for(let e=0;e<t;e++)a.emplaceBack(h,d,p,y,v,x,b)}}function Lv(t,e,i){const n=t.node;let r=0;const o=i&yy.HasMeshoptCompression;for(const i of n.meshes){if(n.lights&&n.lightMeshIndex===r)continue;if(!i.featureData)continue;i.featureArray=new Vs,i.featureArray.reserve(i.featureData.length);let s=e;for(const e of i.featureData){const r=o?65535&e:e>>16&65535,a=o?e>>16&65535:65535&e,l=(15&a)<8?15&a:0,c=t.evaluatedRMEA[l],u=t.evaluatedColor[l],h=t.emissionHeightBasedParams[l];let d;if(s&&2===l&&n.lights&&(d=new Vs,d.resize(10*n.lights.length)),Pv(i.featureArray,r,u,c,h,i.aabb.min[2],i.aabb.max[2],d),d&&s){s=!1;const t=n.meshes[n.lightMeshIndex];t.featureArray=d,t.featureArray._trim()}}i.featureArray._trim(),r++}}function Rv(t,e,i,n){const r=1<<t.z;e.lat=gl((n/Li+t.y)/r),e.lng=ml((i/Li+t.x)/r)}io(Cv,"Tiled3dModelBucket",{omit:["layers"]}),io(Iv,"Tiled3dModelFeature");const Dv={circle:class extends as{constructor(t,e,i){super(t,ec,e,i)}createBucket(t){return new Nl(t)}queryRadius(t){const e=t;return Zl("circle-radius",this,e)+Zl("circle-stroke-width",this,e)+Kl(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,n,r,o,s,a){const l=Ql(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return ud(t,n,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const i=cd(this);return{config:new Na(this,e),defines:i,overrideFog:!1}}},heatmap:class extends as{createBucket(t){return new md(t)}constructor(t,e,i){super(t,Ed,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Sd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Zl("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,n,r,o,s,a){const l=this.paint.get("heatmap-radius").evaluate(e,i);return ud(t,n,o,s,a,!0,!0,new _(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return"heatmap"===t?{config:new Na(this,e),overrideFog:!1}:{}}},hillshade:class extends as{constructor(t,e,i){super(t,Md,e,i)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends as{constructor(t,e,i){super(t,cp,e,i)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e){return{config:new Na(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new ap(t)}queryRadius(){return Kl(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,n,r,o){return!t.queryGeometry.isAboveHorizon&&zl(Jl(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends as{constructor(t,e,i){super(t,If,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new mf(t)}queryRadius(){return Kl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,i,n,r,o,s,a,l,c){const u=Ql(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(i,n),d=this.paint.get("fill-extrusion-base").evaluate(i,n),p=[0,0],f=l&&s.elevation,m=s.elevation?s.elevation.exaggeration():1,g=e.tile.getBucket(this);if(f&&g instanceof mf){const t=g.centroidVertexArray,e=c+1;e<t.length&&(p[0]=t.geta_centroid_pos0(e),p[1]=t.geta_centroid_pos1(e))}if(0===p[0]&&1===p[1])return!1;"globe"===s.projection.name&&(r=Sf([r],[new _(0,0),new _(Li,Li)],e.tileID.canonical).map((t=>t.polygon)).flat());const y=f?l:null,[v,x]=function(e,i,n,r,o,s,a,l,c,u,h){return"globe"===e.projection.name?function(e,i,n,r,o,s,a,l,c,u,h){const d=[],p=[],f=e.projection.upVectorScale(h,e.center.lat,e.worldSize).metersToTile,m=[0,0,0,1],g=[0,0,0,1],_=(t,e,i,n)=>{t[0]=e,t[1]=i,t[2]=n,t[3]=1},y=Ef();n>0&&(n+=y),r+=y;for(const y of i){const i=[],v=[];for(const d of y){const p=d.x+o.x,y=d.y+o.y,x=e.projection.projectTilePoint(p,y,h),b=e.projection.upVector(h,d.x,d.y);let w=n,E=r;if(a){const t=Lf(p,y,n,r,a,l,c,u);w+=t.base,E+=t.top}0!==n?_(m,x.x+b[0]*f*w,x.y+b[1]*f*w,x.z+b[2]*f*w):_(m,x.x,x.y,x.z),_(g,x.x+b[0]*f*E,x.y+b[1]*f*E,x.z+b[2]*f*E),t.N.transformMat4(m,m,s),t.N.transformMat4(g,g,s),i.push(new Cf(m[0],m[1],m[2])),v.push(new Cf(g[0],g[1],g[2]))}d.push(i),p.push(v)}return[d,p]}(e,i,n,r,o,s,a,l,c,u,h):a?function(e,i,n,r,o,s,a,l,c){const u=[],h=[],d=[0,0,0,1];for(const p of e){const e=[],f=[];for(const u of p){const h=u.x+r.x,p=u.y+r.y,m=Lf(h,p,i,n,s,a,l,c);d[0]=h,d[1]=p,d[2]=m.base,d[3]=1,t.a7.transformMat4(d,d,o),d[3]=Math.max(d[3],1e-5);const g=new Cf(d[0]/d[3],d[1]/d[3],d[2]/d[3]);d[0]=h,d[1]=p,d[2]=m.top,d[3]=1,t.a7.transformMat4(d,d,o),d[3]=Math.max(d[3],1e-5);const _=new Cf(d[0]/d[3],d[1]/d[3],d[2]/d[3]);e.push(g),f.push(_)}u.push(e),h.push(f)}return[u,h]}(i,n,r,o,s,a,l,c,u):function(t,e,i,n,r){const o=[],s=[],a=r[8]*e,l=r[9]*e,c=r[10]*e,u=r[11]*e,h=r[8]*i,d=r[9]*i,p=r[10]*i,f=r[11]*i;for(const e of t){const t=[],i=[];for(const o of e){const e=o.x+n.x,s=o.y+n.y,m=r[0]*e+r[4]*s+r[12],g=r[1]*e+r[5]*s+r[13],_=r[2]*e+r[6]*s+r[14],y=r[3]*e+r[7]*s+r[15],v=m+a,x=g+l,b=_+c,w=Math.max(y+u,1e-5),E=m+h,S=g+d,T=_+p,M=Math.max(y+f,1e-5);t.push(new Cf(v/w,x/w,b/w)),i.push(new Cf(E/M,S/M,T/M))}o.push(t),s.push(i)}return[o,s]}(i,n,r,o,s)}(s,r,d,h,u,a,y,p,m,s.center.lat,e.tileID.canonical),b=e.queryGeometry;return function(t,e,i){let n=1/0;zl(i,e)&&(n=Pf(i,e[0]));for(let r=0;r<e.length;r++){const o=e[r],s=t[r];for(let t=0;t<o.length-1;t++){const e=o[t],r=[e,o[t+1],s[t+1],s[t],e];Ol(i,r)&&(n=Math.min(n,Pf(i,r)))}}return n!==1/0&&n}(v,x,b.isPointQuery()?b.screenBounds:b.screenGeometry)}},line:class extends as{constructor(t,e,i){super(t,Vf,e,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Tn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Xf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Bf(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const i=Wf(this);return{config:new Na(this,e),defines:i,overrideFog:!1}}queryRadius(t){const e=t,i=$f(Zl("line-width",this,e),Zl("line-gap-width",this,e)),n=Zl("line-offset",this,e);return i/2+Math.abs(n)+Kl(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,n,r,o){if(t.queryGeometry.isAboveHorizon)return!1;const s=Jl(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),a=t.pixelToTileUnitsFactor/2*$f(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),l=this.paint.get("line-offset").evaluate(e,i);return l&&(n=function(t,e){const i=[],n=new _(0,0);for(let r=0;r<t.length;r++){const o=t[r],s=[];for(let t=0;t<o.length;t++){const i=o[t],r=o[t+1],a=0===t?n:i.sub(o[t-1])._unit()._perp(),l=t===o.length-1?n:r.sub(i)._unit()._perp(),c=a._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),s.push(c._mult(e)._add(i))}i.push(s)}return i}(n,l*t.pixelToTileUnitsFactor)),function(t,e,i){for(let n=0;n<e.length;n++){const r=e[n];if(t.length>=3)for(let e=0;e<r.length;e++)if(Wl(t,r[e]))return!0;if(Bl(t,r,i))return!0}return!1}(s,n,a)}isTileClipped(){return!0}},symbol:I_,background:class extends as{constructor(t,e,i){super(t,A_,e,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:U_,"raster-particle":G_,sky:class extends as{constructor(t,e,i){super(t,q_,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Sd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),n=!i,r=t.style.light,o=r.properties.get("position");return n&&"viewport"===r.properties.get("anchor")&&j("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?X_(o.azimuthal,90-o.polar,e):X_(i[0],90-i[1],e)}const i=this.paint.get("sky-gradient-center");return X_(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}},slot:class extends as{constructor(t,e,i){super(t,$_,e)}},model:class extends as{constructor(t,e,i){super(t,gy,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new fy(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof Cv?Li-1:0}queryIntersectsFeature(e,i,n,r,o,s){if(!this.modelManager)return!1;const a=this.modelManager,l=e.tile.getBucket(this);if(!(l&&l instanceof fy))return!1;const c=l;for(const n in c.instancesPerModel){const r=c.instancesPerModel[n];if(r.idToFeaturesIndex.hasOwnProperty(i.id)){const o=r.features[r.idToFeaturesIndex[i.id]],l=a.getModel(n,this.scope);if(!l)return!1;let u=t.a6.create();const h=new tl(0,0),d=c.canonical;let p=Number.MAX_VALUE;for(let i=0;i<o.instancedDataCount;++i){const n=16*(o.instancedDataOffset+i),a=r.instancedDataArray.float32,c=[a[n+4],a[n+5],a[n+6]];Rv(d,h,a[n],0|a[n+1]),vy(u,l,s,h,o.rotation,o.scale,c,!1,!1,!1),"globe"===s.projection.name&&(u=ny(u,s));const f=t.a6.multiply([],s.projMatrix,u),m=e.queryGeometry,g=ry(m.isPointQuery()?m.screenBounds:m.screenGeometry,s,f,l.aabb);null!=g&&(p=Math.min(g,p))}return p!==Number.MAX_VALUE&&p}}return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||"model-color"!==t&&"model-color-mix-intensity"!==t&&"model-rotation"!==t&&"model-scale"!==t&&"model-translation"!==t&&"model-emissive-strength"!==t)}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof Xr}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(e,i,n,r){const o=e.tile,s=o.getBucket(this);let a=null,l=Number.MAX_VALUE;if(!(s&&s instanceof Cv))return{queryFeature:a,intersectionZ:l};const c=s.getNodesInfo()[i];if(c.hiddenByReplacement||!c.node.meshes||!n.filter(new Ao(o.tileID.overscaledZ),c.feature,o.tileID.canonical))return{queryFeature:a,intersectionZ:l};const u=c.node,h=r.calculatePosMatrix(o.tileID.toUnwrapped(),r.worldSize),d=c.evaluatedScale;let p=0;r.elevation&&u.elevation&&(p=u.elevation*r.elevation.exaggeration()),t.a6.translate(h,h,[(u.anchor?u.anchor[0]:0)*(d[0]-1),(u.anchor?u.anchor[1]:0)*(d[1]-1),p]),t.a6.scale(h,h,d),t.a6.multiply(h,h,u.matrix);const f=e.queryGeometry,m=f.isPointQuery()?f.screenBounds:f.screenGeometry,g=function(e){const i=t.a6.multiply([],h,e.matrix),n=t.a6.multiply(i,r.expandedFarZProjMatrix,i);for(let t=0;t<e.meshes.length;++t){const i=e.meshes[t];if(t===e.lightMeshIndex)continue;const o=ry(m,r,n,i.aabb);null!=o&&(l=Math.min(o,l))}if(e.children)for(const t of e.children)g(t)};if(g(u),l===Number.MAX_VALUE)return{queryFeature:a,intersectionZ:l};const _=new tl(0,0);return Rv(o.tileID.canonical,_,c.node.anchor[0],c.node.anchor[1]),a={type:"Feature",geometry:{type:"Point",coordinates:[_.lng,_.lat]},properties:c.feature.properties,id:c.feature.id,state:{},layer:this.serialize()},{queryFeature:a,intersectionZ:l}}}},kv={read:function(t,e){return t.readFields(kv._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,i){1===t?e.header_length=i.readFixed32():2===t?e.x=i.readVarint():3===t?e.y=i.readVarint():4===t?e.z=i.readVarint():5===t&&e.layers.push(kv.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};kv.Filter.read=function(t,e){return t.readFields(kv.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},kv.Filter._readField=function(t,e,i){1===t?(e.delta_filter=kv.Filter.Delta.read(i,i.readVarint()+i.pos),e.filter="delta_filter"):2===t?(e.zigzag_filter=kv.Filter.Zigzag.read(i,i.readVarint()+i.pos),e.filter="zigzag_filter"):3===t?(e.bitshuffle_filter=kv.Filter.BitShuffle.read(i,i.readVarint()+i.pos),e.filter="bitshuffle_filter"):4===t&&(e.byteshuffle_filter=kv.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),e.filter="byteshuffle_filter")},kv.Filter.Delta={},kv.Filter.Delta.read=function(t,e){return t.readFields(kv.Filter.Delta._readField,{block_size:0},e)},kv.Filter.Delta._readField=function(t,e,i){1===t&&(e.block_size=i.readVarint())},kv.Filter.Zigzag={},kv.Filter.Zigzag.read=function(t,e){return t.readFields(kv.Filter.Zigzag._readField,{},e)},kv.Filter.Zigzag._readField=function(t,e,i){},kv.Filter.BitShuffle={},kv.Filter.BitShuffle.read=function(t,e){return t.readFields(kv.Filter.BitShuffle._readField,{},e)},kv.Filter.BitShuffle._readField=function(t,e,i){},kv.Filter.ByteShuffle={},kv.Filter.ByteShuffle.read=function(t,e){return t.readFields(kv.Filter.ByteShuffle._readField,{},e)},kv.Filter.ByteShuffle._readField=function(t,e,i){},kv.Codec={},kv.Codec.read=function(t,e){return t.readFields(kv.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},kv.Codec._readField=function(t,e,i){1===t?(e.gzip_data=kv.Codec.GzipData.read(i,i.readVarint()+i.pos),e.codec="gzip_data"):2===t?(e.jpeg_image=kv.Codec.JpegImage.read(i,i.readVarint()+i.pos),e.codec="jpeg_image"):3===t?(e.webp_image=kv.Codec.WebpImage.read(i,i.readVarint()+i.pos),e.codec="webp_image"):4===t&&(e.png_image=kv.Codec.PngImage.read(i,i.readVarint()+i.pos),e.codec="png_image")},kv.Codec.GzipData={},kv.Codec.GzipData.read=function(t,e){return t.readFields(kv.Codec.GzipData._readField,{},e)},kv.Codec.GzipData._readField=function(t,e,i){},kv.Codec.JpegImage={},kv.Codec.JpegImage.read=function(t,e){return t.readFields(kv.Codec.JpegImage._readField,{},e)},kv.Codec.JpegImage._readField=function(t,e,i){},kv.Codec.WebpImage={},kv.Codec.WebpImage.read=function(t,e){return t.readFields(kv.Codec.WebpImage._readField,{},e)},kv.Codec.WebpImage._readField=function(t,e,i){},kv.Codec.PngImage={},kv.Codec.PngImage.read=function(t,e){return t.readFields(kv.Codec.PngImage._readField,{},e)},kv.Codec.PngImage._readField=function(t,e,i){},kv.DataIndexEntry={},kv.DataIndexEntry.read=function(t,e){return t.readFields(kv.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},kv.DataIndexEntry._readField=function(t,e,i){1===t?e.first_byte=i.readFixed64():2===t?e.last_byte=i.readFixed64():3===t?e.filters.push(kv.Filter.read(i,i.readVarint()+i.pos)):4===t?e.codec=kv.Codec.read(i,i.readVarint()+i.pos):5===t?e.offset=i.readFloat():6===t?e.scale=i.readFloat():7===t&&e.bands.push(i.readString())},kv.Layer={},kv.Layer.read=function(t,e){return t.readFields(kv.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},kv.Layer._readField=function(t,e,i){1===t?e.version=i.readVarint():2===t?e.name=i.readString():3===t?e.units=i.readString():4===t?e.tilesize=i.readVarint():5===t?e.buffer=i.readVarint():6===t?e.pixel_format=i.readVarint():7===t&&e.data_index.push(kv.DataIndexEntry.read(i,i.readVarint()+i.pos))};const Nv={read:function(t,e){return t.readFields(Nv._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,i){2===t?(e.uint32_values=Nv.Uint32Values.read(i,i.readVarint()+i.pos),e.values="uint32_values"):3===t&&(e.fixed32_values=Nv.Fixed32Values.read(i,i.readVarint()+i.pos),e.values="fixed32_values")},Uint32Values:{}};Nv.Uint32Values.read=function(t,e){return t.readFields(Nv.Uint32Values._readField,{values:[]},e)},Nv.Uint32Values._readField=function(t,e,i){1===t&&(e.readValuesInto=function(t){if(2!==t.type)throw new Error(`Unsupported pbf type "${t.type}"`);const e=function(t){return 2===t.type?t.readVarint()+t.pos:t.pos+1}(t),i=t.pos;return t.pos=e,function(n){t.pos=i;let r=0;for(;t.pos<e;){const e=t.readVarint();n[r++]=e}return n}}(i))},Nv.Fixed32Values={},Nv.Fixed32Values.read=function(t,e){return t.readFields(Nv.Fixed32Values._readField,{values:[]},e)},Nv.Fixed32Values._readField=function(t,e,i){throw new Error("Not implemented")};class Ov{constructor(t=0,e=0,i=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=i,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const e=this.items[t];delete this.items[t],this.size--,null!==e.prev&&(e.prev.next=e.next),null!==e.next&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){return t.map((t=>[t,this.get(t)]))}evict(t=!1){if(t||this.size>0){const t=this.first;delete this.items[t.key],0==--this.size?(this.first=null,this.last=null):(this.first=t.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){let e;if(this.has(t)){const i=this.items[t];this.ttl>0&&i.expiry<=Date.now()?this.delete(t):(e=i.value,this.set(t,e,!0))}return e}has(t){return t in this.items}keys(){const t=[];let e=this.first;for(;null!==e;)t.push(e.key),e=e.next;return t}set(t,e,i=!1,n=this.resetTtl){let r;if(i||this.has(t)){if(r=this.items[t],r.value=e,!1===i&&n&&(r.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==r){const t=this.last,e=r.next,i=r.prev;this.first===r&&(this.first=r.next),r.next=null,r.prev=this.last,t.next=r,null!==i&&(i.next=e),null!==e&&(e.prev=i)}}else this.max>0&&this.size===this.max&&this.evict(!0),r=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},1==++this.size?this.first=r:this.last.next=r;return this.last=r,this}values(t=this.keys()){return t.map((t=>this.get(t)))}}function Fv(t,e){if(4!==e.length)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let n=2;n>=1;n--){const r=1===n?1:0,o=2===n?1:0;for(let n=0;n<e[0];n++){const s=e[1]*n;for(let n=r;n<e[1];n++){const r=e[2]*(n+s);for(let n=o;n<e[2];n++){const o=e[3]*(n+r);for(let n=0;n<e[3];n++){const e=o+n;t[e]+=t[e-i]}}}}i*=e[n]}return t}function zv(t){for(let e=0,i=t.length;e<i;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function Bv(t,e){switch(e){case"uint32":return t;case"uint16":for(let e=0;e<t.length;e+=2){const i=t[e],n=t[e+1];t[e]=(240&i)>>4|(61440&i)>>8|(240&n)<<4|61440&n,t[e+1]=15&i|(3840&i)>>4|(15&n)<<8|(3840&n)<<4}return t;case"uint8":for(let e=0;e<t.length;e+=4){const i=t[e],n=t[e+1],r=t[e+2],o=t[e+3];t[e+0]=(192&i)>>6|(192&n)>>4|(192&r)>>2|192&o,t[e+1]=(48&i)>>4|(48&n)>>2|48&r|(48&o)<<2,t[e+2]=(12&i)>>2|12&n|(12&r)<<2|(12&o)<<4,t[e+3]=3&i|(3&n)<<2|(3&r)<<4|(3&o)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Uv extends Error{constructor(t){super(t),this.name="MRTError"}}var Vv=Uint8Array,jv=Uint16Array,Gv=Int32Array,Hv=new Vv([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Wv=new Vv([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),qv=new Vv([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xv=function(t,e){for(var i=new jv(31),n=0;n<31;++n)i[n]=e+=1<<t[n-1];var r=new Gv(i[30]);for(n=1;n<30;++n)for(var o=i[n];o<i[n+1];++o)r[o]=o-i[n]<<5|n;return{b:i,r}},$v=Xv(Hv,2),Yv=$v.b,Zv=$v.r;Yv[28]=258,Zv[258]=28;for(var Kv=Xv(Wv,0).b,Jv=new jv(32768),Qv=0;Qv<32768;++Qv){var tx=(43690&Qv)>>1|(21845&Qv)<<1;Jv[Qv]=((65280&(tx=(61680&(tx=(52428&tx)>>2|(13107&tx)<<2))>>4|(3855&tx)<<4))>>8|(255&tx)<<8)>>1}var ex=function(t,e,i){for(var n=t.length,r=0,o=new jv(e);r<n;++r)t[r]&&++o[t[r]-1];var s,a=new jv(e);for(r=1;r<e;++r)a[r]=a[r-1]+o[r-1]<<1;if(i){s=new jv(1<<e);var l=15-e;for(r=0;r<n;++r)if(t[r])for(var c=r<<4|t[r],u=e-t[r],h=a[t[r]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)s[Jv[h]>>l]=c}else for(s=new jv(n),r=0;r<n;++r)t[r]&&(s[r]=Jv[a[t[r]-1]++]>>15-t[r]);return s},ix=new Vv(288);for(Qv=0;Qv<144;++Qv)ix[Qv]=8;for(Qv=144;Qv<256;++Qv)ix[Qv]=9;for(Qv=256;Qv<280;++Qv)ix[Qv]=7;for(Qv=280;Qv<288;++Qv)ix[Qv]=8;var nx=new Vv(32);for(Qv=0;Qv<32;++Qv)nx[Qv]=5;var rx=ex(ix,9,1),ox=ex(nx,5,1),sx=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},ax=function(t,e,i){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(7&e)&i},lx=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},cx=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ux=function(t,e,i){var n=new Error(e||cx[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,ux),!i)throw n;return n},hx=new Vv(0),dx="undefined"!=typeof TextDecoder&&new TextDecoder;try{dx.decode(hx,{stream:!0})}catch(t){}const px={gzip_data:"gzip"},fx={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},mx={uint32:1,uint16:2,uint8:4},gx={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class _x{constructor(t=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){return this.layers[t]}getHeaderLength(t){const e=new Uint8Array(t),i=new DataView(t);if(13!==e[0])throw new Uv("File is not a valid MRT.");return i.getUint32(1,!0)}parseHeader(t){const e=new Uint8Array(t),i=this.getHeaderLength(t);if(e.length<i)throw new Uv(`Expected header with length >= ${i} but got buffer of length ${e.length}`);const n=new Om(e.subarray(0,i)),r=kv.read(n);if(!isNaN(this.x)&&(this.x!==r.x||this.y!==r.y||this.z!==r.z))throw new Uv(`Invalid attempt to parse header ${r.z}/${r.x}/${r.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=r.x,this.y=r.y,this.z=r.z;for(const t of r.layers)this.layers[t.name]=new yx(t,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const e=[],i=this.getLayer(t.layerName);for(let n=0;n<i.dataIndex.length;n++){const r=i.dataIndex[n],o=r.first_byte-t.firstByte,s=r.last_byte+1-t.firstByte;if(n<t.firstBlock||n>t.lastBlock)continue;if(i._blocksInProgress.has(n))continue;const a={layerName:i.name,firstByte:o,lastByte:s,pixelFormat:i.pixelFormat,blockIndex:n,blockShape:[r.bands.length].concat(i.bandShape),buffer:i.buffer,codec:r.codec.codec,filters:r.filters.map((t=>t.filter))};i._blocksInProgress.add(n),e.push(a)}return new vx(e,(()=>{e.forEach((t=>i._blocksInProgress.delete(t.blockIndex)))}),((t,n)=>{if(e.forEach((t=>i._blocksInProgress.delete(t.blockIndex))),t)throw t;n.forEach((t=>{this.getLayer(t.layerName).processDecodedData(t)}))}))}}class yx{constructor({version:t,name:e,units:i,tilesize:n,pixel_format:r,buffer:o,data_index:s},a){if(this.version=t,1!==this.version)throw new Uv(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=e,this.units=i,this.tileSize=n,this.buffer=o,this.pixelFormat=fx[r],this.dataIndex=s,this.bandShape=[n+2*o,n+2*o,mx[this.pixelFormat]],this._decodedBlocks=function(t=1e3,e=0,i=!1){if(isNaN(t)||t<0)throw new TypeError("Invalid max value");if(isNaN(e)||e<0)throw new TypeError("Invalid ttl value");if("boolean"!=typeof i)throw new TypeError("Invalid resetTtl value");return new Ov(t,e,i)}(a?a.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(t){const e=t.blockIndex.toString();this._decodedBlocks.get(e)||this._decodedBlocks.set(e,t.data)}getBlockForBand(t){let e=0;switch(typeof t){case"string":for(const[i,n]of this.dataIndex.entries()){for(const[r,o]of n.bands.entries())if(o===t)return{bandIndex:e+r,blockIndex:i,blockBandIndex:r};e+=n.bands.length}break;case"number":for(const[i,n]of this.dataIndex.entries()){if(t>=e&&t<e+n.bands.length)return{bandIndex:t,blockIndex:i,blockBandIndex:t-e};e+=n.bands.length}break;default:throw new Uv(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new Uv(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let e=1/0,i=-1/0,n=1/0,r=-1/0;for(const o of t){const{blockIndex:t}=this.getBlockForBand(o);if(t<0)throw new Uv(`Invalid band: ${JSON.stringify(o)}`);const s=this.dataIndex[t];n=Math.min(n,t),r=Math.max(r,t),e=Math.min(e,s.first_byte),i=Math.max(i,s.last_byte)}return{layerName:this.name,firstByte:e,lastByte:i,firstBlock:n,lastBlock:r}}hasBand(t){const{blockIndex:e}=this.getBlockForBand(t);return e>=0}hasDataForBand(t){const{blockIndex:e}=this.getBlockForBand(t);return e>=0&&!!this._decodedBlocks.get(e.toString())}getBandView(t){const{blockIndex:e,blockBandIndex:i}=this.getBlockForBand(t),n=this._decodedBlocks.get(e.toString());if(!n)throw new Uv(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const r=this.dataIndex[e],o=this.bandShape.reduce(((t,e)=>t*e),1),s=i*o,a=n.subarray(s,s+o);return{data:a,bytes:new Uint8Array(a.buffer).subarray(a.byteOffset,a.byteOffset+a.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:r.offset,scale:r.scale}}}class vx{constructor(t,e,i){this.tasks=t,this._onCancel=e,this._onComplete=i,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,e){this._finalized||(this._onComplete(t,e),this._finalized=!0)}}_x.performDecoding=function(t,e){return Promise.all(e.tasks.map((e=>{const{layerName:i,firstByte:n,lastByte:r,pixelFormat:o,blockShape:s,blockIndex:a,filters:l,codec:c}=e,u=new Uint8Array(t).subarray(n,r+1),h=new Uint32Array(s[0]*s[1]*s[2]);let d;if("gzip_data"!==c)throw new Error(`Unhandled codec: ${c}`);return d=function(t,e){if(!globalThis.DecompressionStream&&"gzip_data"===e)return Promise.resolve(((o=function(t){31==t[0]&&139==t[1]&&8==t[2]||ux(6,"invalid gzip data");var e=t[3],i=10;4&e&&(i+=2+(t[10]|t[11]<<8));for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[i++]);return i+(2&e)}(r=t))+8>r.length&&ux(6,"invalid gzip data"),function(t,e,i,n){var r=t.length;if(!r||e.f&&!e.l)return i||new Vv(0);var o=!i,s=o||2!=e.i,a=e.i;o&&(i=new Vv(3*r));var l=function(t){var e=i.length;if(t>e){var n=new Vv(Math.max(2*e,t));n.set(i),i=n}},c=e.f||0,u=e.p||0,h=e.b||0,d=e.l,p=e.d,f=e.m,m=e.n,g=8*r;do{if(!d){c=ax(t,u,1);var _=ax(t,u+1,3);if(u+=3,!_){var y=t[(A=4+((u+7)/8|0))-4]|t[A-3]<<8,v=A+y;if(v>r){a&&ux(0);break}s&&l(h+y),i.set(t.subarray(A,v),h),e.b=h+=y,e.p=u=8*v,e.f=c;continue}if(1==_)d=rx,p=ox,f=9,m=5;else if(2==_){var x=ax(t,u,31)+257,b=ax(t,u+10,15)+4,w=x+ax(t,u+5,31)+1;u+=14;for(var E=new Vv(w),S=new Vv(19),T=0;T<b;++T)S[qv[T]]=ax(t,u+3*T,7);u+=3*b;var M=sx(S),I=(1<<M)-1,C=ex(S,M,1);for(T=0;T<w;){var A,P=C[ax(t,u,I)];if(u+=15&P,(A=P>>4)<16)E[T++]=A;else{var L=0,R=0;for(16==A?(R=3+ax(t,u,3),u+=2,L=E[T-1]):17==A?(R=3+ax(t,u,7),u+=3):18==A&&(R=11+ax(t,u,127),u+=7);R--;)E[T++]=L}}var D=E.subarray(0,x),k=E.subarray(x);f=sx(D),m=sx(k),d=ex(D,f,1),p=ex(k,m,1)}else ux(1);if(u>g){a&&ux(0);break}}s&&l(h+131072);for(var N=(1<<f)-1,O=(1<<m)-1,F=u;;F=u){var z=(L=d[lx(t,u)&N])>>4;if((u+=15&L)>g){a&&ux(0);break}if(L||ux(2),z<256)i[h++]=z;else{if(256==z){F=u,d=null;break}var B=z-254;z>264&&(B=ax(t,u,(1<<(j=Hv[T=z-257]))-1)+Yv[T],u+=j);var U=p[lx(t,u)&O],V=U>>4;if(U||ux(3),u+=15&U,k=Kv[V],V>3){var j=Wv[V];k+=lx(t,u)&(1<<j)-1,u+=j}if(u>g){a&&ux(0);break}s&&l(h+131072);var G=h+B;if(h<k){var H=0-k,W=Math.min(k,G);for(H+h<0&&ux(3);h<W;++h)i[h]=undefined[H+h]}for(;h<G;++h)i[h]=i[h-k]}}e.l=d,e.p=F,e.b=h,e.f=c,d&&(c=1,e.m=f,e.d=p,e.n=m)}while(!c);return h!=i.length&&o?function(t,e,i){return(null==e||e<0)&&(e=0),(null==i||i>t.length)&&(i=t.length),new Vv(t.subarray(e,i))}(i,0,h):i.subarray(0,h)}(r.subarray(o,-8),{i:2},new Vv(((i=r)[(n=i.length)-4]|i[n-3]<<8|i[n-2]<<16|i[n-1]<<24)>>>0))));var i,n,r,o;const s=px[e];if(!s)throw new Error(`Unhandled codec: ${e}`);const a=new globalThis.DecompressionStream(s);return new Response(new Blob([t]).stream().pipeThrough(a)).arrayBuffer().then((t=>new Uint8Array(t)))}(u,c).then((t=>{const e=Nv.read(new Om(t));if("uint32_values"===e.values)return e.uint32_values.readValuesInto(h),new(0,gx[o])(h.buffer);throw new Error(`Unhandled numeric data "${e.values}"`)})),d.then((t=>{for(let e=l.length-1;e>=0;e--)switch(l[e]){case"delta_filter":Fv(t,s);break;case"zigzag_filter":zv(t);break;case"bitshuffle_filter":Bv(t,o);break;default:throw new Error(`Unhandled filter "${l[e]}"`)}return{layerName:i,blockIndex:a,data:t}})).catch((t=>{throw t}))})))},io(vx,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const xx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class bx{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,i]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const n=i>>4;if(1!==n)throw new Error(`Got v${n} data when expected v1.`);const r=xx[15&i];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(t,2,1),[s]=new Uint32Array(t,4,1);return new bx(s,o,r,t)}constructor(t,e=64,i=Float64Array,n){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const r=xx.indexOf(this.ArrayType),o=2*t*this.ArrayType.BYTES_PER_ELEMENT,s=t*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${i}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return wx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:s}=this,a=[0,r.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=t&&a<=i&&c>=e&&c<=n&&l.push(r[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=t&&p<=i&&f>=e&&f<=n&&l.push(r[d]),(0===c?t<=p:e<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?i>=p:n>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:r,nodeSize:o}=this,s=[0,n.length-1,0],a=[],l=i*i;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let i=h;i<=u;i++)Mx(r[2*i],r[2*i+1],t,e)<=l&&a.push(n[i]);continue}const d=h+u>>1,p=r[2*d],f=r[2*d+1];Mx(p,f,t,e)<=l&&a.push(n[d]),(0===c?t-i<=p:e-i<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?t+i>=p:e+i>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function wx(t,e,i,n,r,o){if(r-n<=i)return;const s=n+r>>1;Ex(t,e,s,n,r,o),wx(t,e,i,n,s-1,1-o),wx(t,e,i,s+1,r,1-o)}function Ex(t,e,i,n,r,o){for(;r>n;){if(r-n>600){const s=r-n+1,a=i-n+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);Ex(t,e,i,Math.max(n,Math.floor(i-a*c/s+u)),Math.min(r,Math.floor(i+(s-a)*c/s+u)),o)}const s=e[2*i+o];let a=n,l=r;for(Sx(t,e,n,i),e[2*r+o]>s&&Sx(t,e,n,r);a<l;){for(Sx(t,e,a,l),a++,l--;e[2*a+o]<s;)a++;for(;e[2*l+o]>s;)l--}e[2*n+o]===s?Sx(t,e,n,l):(l++,Sx(t,e,l,r)),l<=i&&(n=l+1),i<=l&&(r=l-1)}}function Sx(t,e,i,n){Tx(t,i,n),Tx(e,2*i,2*n),Tx(e,2*i+1,2*n+1)}function Tx(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function Mx(t,e,i,n){const r=t-i,o=e-n;return r*r+o*o}t.$=qg,t.A=Nr,t.B=Rr,t.C=ni,t.D=Ho,t.E=ee,t.F=Vo,t.G=zo,t.H=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return W(t.expression.evaluate(e))}interpolate(t,e,i){return{x:ce(t.x,e.x,i),y:ce(t.y,e.y,i),z:ce(t.z,e.z,i),azimuthal:ce(t.azimuthal,e.azimuthal,i),polar:ce(t.polar,e.polar,i)}}},t.I=fg,t.J=Ro,t.K=Ao,t.L=El,t.M=class{constructor(t,e,i,n){this.id=t,this.position=null!=e?new tl(e[0],e[1]):new tl(0,0),this.orientation=null!=i?i:[0,0,0],this.nodes=n,this.uploaded=!1,this.aabb=new Rh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){if(t.a6.multiply(e.matrix,i,e.matrix),e.meshes)for(const t of e.meshes){const i=Rh.applyTransform(t.aabb,e.matrix);this.aabb.encapsulate(i)}if(e.children)for(const t of e.children)this._applyTransformations(t,e.matrix)}computeBoundsAndApplyParent(){const e=t.a6.identity([]);for(const t of this.nodes)this._applyTransformations(t,e)}computeModelMatrix(t,e,i,n,r,o,s=!1){vy(this.matrix,this,t.transform,this.position,e,i,n,r,o,s)}upload(t){if(!this.uploaded){for(const e of this.nodes)wy(e,t);for(const t of this.nodes)Ey(t);this.uploaded=!0}}destroy(){for(const t of this.nodes)Sy(t)}},t.O=I,t.P=_,t.Q=Fo,t.R=St,t.S=id,t.T=D_,t.U=ce,t.V=Li,t.W=ue,t.X=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([t,e]){const i=W([1,t,e]);return{x:i.x,y:i.y,z:i.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:ce(t.x,e.x,i),y:ce(t.y,e.y,i),z:ce(t.z,e.z,i)}}},t.Y=function(t,e,i=0,n=!0){const r=new _(i,i),o=t.sub(r),s=e.add(r),a=[o,new _(s.x,o.y),s,new _(o.x,s.y)];return n&&a.push(o.clone()),a},t.Z=Xr,t._=function(t,e){const i=[];for(let n=0;n<t.length;n++){const r=C(n-1,-1,t.length-1),o=C(n+1,-1,t.length-1),s=t[n],a=t[o],l=t[r].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*e/Math.sin(u/2));i.push(s.add(h))}return i},t.a=te,t.a$=function(t){const e=[];for(const i in t)e.push(t[i]);return e},t.a0=ql,t.a1=function(e,i,n=0){return t.N.fromValues(((i.x-n)*e.scale-e.x)*Li,(i.y*e.scale-e.y)*Li,_l(i.z,i.y))},t.a2=Th,t.a3=jf,t.a4=function(t){let e=1/0,i=1/0,n=-1/0,r=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),n=Math.max(n,o.x),r=Math.max(r,o.y);return{min:new _(e,i),max:new _(n,r)}},t.a5=dl,t.a8=Wl,t.a9=Tl,t.aA=xr,t.aB=ia,t.aC=R,t.aD=Hs,t.aE=E_,t.aF=function(){Co.isLoading()||Co.isLoaded()||"deferred"!==Mo()||Io()},t.aG=qo,t.aH=Rl,t.aI=yv,t.aJ=X,t.aK=Bf,t.aL=ap,t.aM=Ll,t.aN=ps,t.aO=Fs,t.aP=Oh,t.aQ=ip,t.aR=R_,t.aS=function(e,i){const n=id(i.zoom);if(0===n)return jh(e);const r=qh(e),o=Xh(r),s=dl(r.getWest())*i.worldSize,a=dl(r.getEast())*i.worldSize,l=pl(r.getNorth())*i.worldSize,c=pl(r.getSouth())*i.worldSize,u=[s,l,0],h=[a,l,0],d=[s,c,0],p=[a,c,0],f=t.a6.invert([],i.globeMatrix);return t.N.transformMat4(u,u,f),t.N.transformMat4(h,h,f),t.N.transformMat4(d,d,f),t.N.transformMat4(p,p,f),o[0]=Gh(o[0],d,n),o[1]=Gh(o[1],p,n),o[2]=Gh(o[2],h,n),o[3]=Gh(o[3],u,n),Rh.fromPoints(o)},t.aT=Kh,t.aU=$h,t.aV=Gh,t.aW=fs,t.aX=Nh,t.aY=O,t.aZ=_x,t.a_=Ct,t.aa=M,t.ab=ja,t.ac=function(t,e){const i={};for(let n=0;n<e.length;n++){const r=e[n];r in t&&(i[r]=t[r])}return i},t.ad=el,t.ae=pl,t.af=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,n){const r=this.entries[t]=this.entries[t]||{callbacks:[]};if(r.result){const[t,i]=r.result;return this.scheduler?this.scheduler.add((()=>{n(t,i)}),e):n(t,i),()=>{}}return r.callbacks.push(n),r.cancel||(r.cancel=i(((i,n)=>{r.result=[i,n];for(const t of r.callbacks)this.scheduler?this.scheduler.add((()=>{t(i,n)}),e):t(i,n);setTimeout((()=>delete this.entries[t]),3e3)}))),()=>{r.result||(r.callbacks=r.callbacks.filter((t=>t!==n)),r.callbacks.length||(r.cancel(),delete this.entries[t]))}}},t.ag=os,t.ah=function(t,e,i){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},(e=>{const n=Ct(t.request,((t,n,r,o)=>{t?e(t):n&&e(null,{vectorTile:i?void 0:new Cp(new Om(n)),rawData:n,cacheControl:r,expires:o})}));return()=>{n.cancel(),e()}}),e)},t.ai=function(t){gt++,gt>ht&&(t.getActor().send("enforceCacheSizeLimit",ut),gt=0)},t.aj=Gt,t.ak=ot,t.al=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},t.am=sl,t.an=U_,t.ao=G_,t.ap=z_,t.aq=function(t,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let e=0;e<t.length;e++){const n=document.createElement("source");At(t[e])||(i.crossOrigin="Anonymous"),n.src=t[e],i.appendChild(n)}return{cancel:()=>{}}},t.ar=k_,t.as=Wg,t.at=ml,t.au=gl,t.av=ms,t.aw=Ps,t.ax=le,t.ay=hs,t.az=zs,t.b=Qt,t.b$=Eo,t.b0=function(t,e){const i=[];for(const n in t)n in e||i.push(n);return i},t.b1=A,t.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.b3=function(e,i){const{x:n,y:r}=e.point,o=ed(n,r,e.worldSize/e._pixelsPerMercatorPixel,0,0);return t.a6.multiply(o,o,Jh(jh(i)))},t.b5=lm,t.b6=jm,t.b7=am,t.b8=function(t,e,i,n,r){const o=5*e+2;t.float32[o+0]=i,t.float32[o+1]=n,t.float32[o+2]=r},t.b9=v_,t.bA=K_,t.bB=Y_,t.bC=function(e){const i=Y_(e,!0);return t.b4.invert([],[i[0],i[1],i[4],i[5]])},t.bD=Mh,t.bE=function(t){const{x:e,y:i}=t.point,{lng:n,lat:r}=t._center;return ed(e,i,t.worldSize,n,r)},t.bF=b,t.bG=Ga,t.bH=function(t){const e=Math.round((t+45+360)%360/90)%4;return w[e]},t.bI=45,t.bJ=hl,t.bK=Ta,t.bL=xa,t.bM=ba,t.bN=va,t.bO=ya,t.bP=wa,t.bQ=function(t,e,i){const n=Math.sqrt(t*t+e*e+i*i),r=n>0?Math.acos(i/n)*v:0;let o=0!==t||0!==e?Math.atan2(-e,-t)*v+90:0;return o<0&&(o+=360),[n,o,r]},t.bR=wl,t.bS=Rh,t.bT=W,t.bU=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},t.bV=function(t){return t({pluginStatus:bo,pluginURL:wo}),To.on("pluginStateChange",t),t},t.bW=Cy,t.bX=ky,t.bY=bg,t.bZ=xg,t.b_=Mt,t.ba=hg,t.bb=Ol,t.bc=rm,t.bd=kg,t.be=Ng,t.bf=Qm,t.bg=bx,t.bh=C,t.bj=x,t.bk=it,t.bl=fl,t.bm=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},t.bn=tl,t.bo=p_,t.bp=ol,t.bq=Lh,t.br=Z_,t.bs=rl,t.bt=Wh,t.bu=function(t,e,i,n,r,o,s,a,l){if("globe"===l.name)return Wh(t,e,new rl(i,n,r),!1);const c=Wg({z:i,x:n,y:r},l);return new Rh([(o+c.x/c.scale)*e,e*(c.y/c.scale),s],[(o+c.x2/c.scale)*e,e*(c.y2/c.scale),a])},t.bv=function(t,e,i){let n=0;for(let r=0;r<2;++r){const o=i?i[r]:0;t[r]>o&&(n+=(t[r]-o)*(t[r]-o)),e[r]<o&&(n+=(o-e[r])*(o-e[r]))}return n},t.bw=yl,t.bx=Ha,t.by=function(e){const i=t.a6.identity(new Float64Array(16));t.a6.multiply(i,e.pixelMatrix,e.globeMatrix);const n=[0,$a,0],r=[0,Ya,0];return t.N.transformMat4(n,n,i),t.N.transformMat4(r,r,i),[n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!rd(e,new tl(e.center.lat,90)),r[0]>0&&r[0]<=e.width&&r[1]>0&&r[1]<=e.height&&!rd(e,new tl(e.center.lat,-90))]},t.bz=function(e,i){const{scale:n}=e.tileTransform,r=n*Li/(e.tileSize*Math.pow(2,i.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return t.b4.scale(new Float32Array(4),i.inverseAdjustmentMatrix,[r,r])},t.c=pv,t.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},t.c0=o,t.c1=U,t.c2=function(t,e,i){return"custom"===t.type?new H_(t,e):new Dv[t.type](t,e,i)},t.c3=function(t){const e=t.indexOf(rs);return e>=0?t.slice(0,e):t},t.c4=function(t){return t.indexOf(rs)>=0},t.c5=function(t){const e=t.indexOf(rs);return e>=0?t.slice(e+1):""},t.c6=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},t.c7=B,t.c8=To,t.c9=It,t.cA=Wf,t.cB=(t,e,i,n,r,o)=>{const s=t.transform;return{u_matrix:Hf(t,e,i,n),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:s.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:r,u_image:0,u_tile_units_to_pixels:Gf(e,s),u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:o}},t.cC=(t,e,i,n,r,o,s)=>{const a=t.transform,l=a.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:Hf(t,e,i,n),u_pixels_to_tile_units:l,u_device_pixel_ratio:o,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:r,u_texsize:qf(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Gf(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:s,u_emissive_strength:i.paint.get("line-emissive-strength")}},t.cD=k,t.cE=Sd,t.cF=Ef,t.cG=ll,t.cH=mf,t.cI=rf,t.cJ=450,t.cK=7,t.cL=B_,t.cM=256,t.cN=Jh,t.cO=ks,t.cP=Ns,t.cQ=function(t,e,i,n,r){return M((t-e)/(i-e)*(r-n)+n,n,r)},t.cR=xl,t.cS=ny,t.cT=[1,1,1],t.cU=Zp,t.cV=yy,t.cW=Ts,t.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=kp(new _(0,0),new _(Li,Li),t),i=[];for(const n of this._activeRegions){if(n.hiddenByOverlap)continue;if(!Dp(e,n))continue;const r=Np(n.min,n.max,t);i.push({min:r.min,max:r.max,sourceId:this._sourceIds[n.priority],footprint:n.footprint,footprintTileId:n.tileId})}return i}setSources(t){this._setSources(t.map((t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const e=[];for(const i of t.cache.getVisibleCoordinates()){const n=t.cache.getTile(i).buckets[t.layer];if(n)for(const t of n.getNodesInfo()){const n=t.node;n.footprint&&e.push({footprint:n.footprint,id:i.toUnwrapped()})}}return e}}))))}_addSource(t){const e=t.getFootprints();if(0!==e.length){for(const t of e){if(!t.footprint)continue;const e=kp(t.footprint.min,t.footprint.max,t.id);this._activeRegions.push({min:e.min,max:e.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:t.id,footprint:t.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort(((t,e)=>t.priority-e.priority||Lp(t.min,e.min)||Lp(t.max,e.max)));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,i=0;for(;!t&&e!==this._activeRegions.length;){const n=this._activeRegions[e],r=this._prevRegions[i];t=n.priority!==r.priority||!Rp(n,r),++e,++i}}if(t){++this._updateTime;const t=t=>{const e=this._activeRegions;if(t>=e.length)return t;const i=e[t].priority;for(;t<e.length&&e[t].priority===i;)++t;return t};if(this._sourceIds.length>1){let e=0,i=t(e);for(;e!==i;){let n=e;const r=e;for(;n!==i;){const t=this._activeRegions[n];t.hiddenByOverlap=!1;for(let e=0;e<r;e++){const i=this._activeRegions[e];if(!i.hiddenByOverlap&&Dp(t,i)&&(t.hiddenByOverlap=Fp(t.footprint,t.tileId,i.footprint,i.tileId),t.hiddenByOverlap))break}++n}e=i,i=t(e)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},t.cY=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const i=new ps,n=new Ps,r=[],o=t+1+2,s=e[0]+1,a=e[0]+1+(1+e.length),l=(t,e,i)=>{let n=t===o-1?t-2:0===t?t:t-1;return n+=i?24575:0,[n,e]};for(let t=0;t<o;++t)i.emplaceBack(...l(t,0,!0));for(let t=0;t<s;++t)for(let e=0;e<o;++e)i.emplaceBack(...l(e,t,(0===e||e===o-1)&&!0));for(let t=0;t<e.length;++t){const n=e[t];for(let t=0;t<o;++t)i.emplaceBack(...l(t,n,!0))}for(let t=0;t<e.length;++t){const s=n.length,l=e[t]+1+2,c=new Ps;for(let i=0;i<l-1;i++){const r=i===l-2,s=r?o*(a-e.length+t-i):o;for(let t=0;t<o-1;t++){const e=i*o+t;0===i||r||0===t||t===o-2?(c.emplaceBack(e+1,e,e+s),c.emplaceBack(e+s,e+s+1,e+1)):(n.emplaceBack(e+1,e,e+s),n.emplaceBack(e+s,e+s+1,e+1))}}const u=ia.simpleSegment(0,s,i.length,n.length-s);for(let t=0;t<c.uint16.length;t+=3)n.emplaceBack(c.uint16[t],c.uint16[t+1],c.uint16[t+2]);const h=ia.simpleSegment(0,s,i.length,n.length-s);r.push({withoutSkirts:u,withSkirts:h})}return{vertices:i,indices:n,segments:r}}_createGrid(t){const e=this._fillGridMeshWithLods(qa,Xa);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Oh.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Ps;for(let t=0;t<=qa;t++)e.emplaceBack(0,t+1,t+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new ks,n=new ks,r=new ks,o=new ks;this._poleSegments=[];for(let t=0,e=0;t<Ga;t++){const s=360/(1<<t);i.emplaceBack(0,-ja,0,.5,0),n.emplaceBack(0,-ja,0,.5,1),r.emplaceBack(0,-ja,0,.5,.5),o.emplaceBack(0,-ja,0,.5,.5);for(let t=0;t<=qa;t++){let e=t/qa,a=0;const l=ce(0,s,e),[c,u,h]=Za(sd,ad,l,ja);i.emplaceBack(c,u,h,e,a),n.emplaceBack(c,u,h,e,1-a);const d=x(l);e=.5+.5*Math.sin(d),a=.5+.5*Math.cos(d),r.emplaceBack(c,u,h,e,a),o.emplaceBack(c,u,h,e,1-a)}this._poleSegments.push(ia.simpleSegment(e,0,66,64)),e+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,kh,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(n,kh,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(r,kh,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(o,kh,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},t.cZ=function(t){return Zt.has(t)},t.c_=S,t.ca=Ea,t.cb=class extends _a{constructor(t){super(t),this.current=Ma}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let t=0;t<9;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},t.cc=E,t.cd=function(t,e,i){const n=id(i.zoom),r=t.style.map._antialias,o=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===n&&!r&&!o},t.ce=function(e){const i=e.pixelsPerMeter,n=i/fl(1,e.center.lat),r=t.a6.identity(new Float64Array(16));return t.a6.translate(r,r,[e.point.x,e.point.y,0]),t.a6.scale(r,r,[n,n,i]),Float32Array.from(r)},t.cf=qh,t.cg=function(t){const e=yl-5;t=M(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(x(t))),3);return Math.round(i*(Xa.length-1))},t.ch=function(e,i,n,r){const o=i.getNorth(),s=i.getSouth(),a=i.getWest(),l=i.getEast(),c=1<<e.z,u=l-a,h=o-s,d=u/qa,p=-h/Xa[n],f=[0,d,0,p,0,0,o,a,0];if(e.z>0){const e=180/r;t.co.multiply(f,f,[e/u+1,0,0,0,e/h+1,0,-.5*e/d,.5*e/p,1])}return f[2]=c,f[5]=e.x,f[8]=e.y,f},t.ci=jh,t.cj=function(e,i,n){const r=t.a6.identity(new Float64Array(16)),o=(i/(1<<e)-.5)*Math.PI*2;return t.a6.rotateY(r,n.globeMatrix,o),Float32Array.from(r)},t.ck=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,n=1<<i,r=Math.floor(t.x),o=Math.floor((t.x-r)*n),s=Math.floor(t.y*n),a=this.findDEMTileFor(new sl(i,r,i,o,s));return!(!a||!a.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const n=this._source();if(!n)return e;if(t.y<0||t.y>1)return e;const r=n.getSource().maxzoom,o=1<<r,s=Math.floor(t.x),a=t.x-s,l=new sl(r,s,r,Math.floor(a*o),Math.floor(t.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return e;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,p=(t.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(i?this.exaggeration():1)*ce(ce(u.get(f,m),u.get(f,m+1),p-m),ce(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(t,e,i){const n=1<<t.canonical.z;return this.getAtPointOrZero(new El(t.wrap+(t.canonical.x+e/Li)/n,(t.canonical.y+i/Li)/n))}getAtTileOffsetFunc(e,i,n,r){return o=>{const s=this.getAtTileOffset(e,o.x,o.y),a=r.upVector(e.canonical,o.x,o.y),l=r.upVectorScale(e.canonical,i,n).metersToTile;return t.N.scale(a,a,s*l),a}}getForTilePoints(t,e,i,n){if(this.isUsingMockSource())return!1;const r=Zp.create(this,t,n);return!!r&&(e.forEach((t=>{t[2]=this.exaggeration()*r.getElevationAt(t[0],t[1],i)})),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,n=e.tileID,r=1<<t.canonical.z-n.canonical.z;let o=t.canonical.x/r-n.canonical.x,s=t.canonical.y/r-n.canonical.y,a=0;for(let e=0;e<t.canonical.z-n.canonical.z&&!i.leaves[a];e++){o*=2,s*=2;const t=2*Math.floor(s)+Math.floor(o);a=i.childOffsets[a]+t,o%=1,s%=1}return{min:this.exaggeration()*i.minimums[a],max:this.exaggeration()*i.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(0===t.length)return null;let e=!1,i=Number.MAX_VALUE,n=Number.MIN_VALUE;for(const r of t){const t=this.getMinMaxForTile(r.tileID);t&&(i=Math.min(i,t.min),n=Math.max(n,t.max),e=!0)}return e?{min:i,max:n}:null}},t.cl=Fh,t.cm=bd,t.cn=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},t.cp=td,t.cq=256,t.cr=function(e,i){const n=[0,0,0],r=Kh(jh(i.canonical));return t.N.transformMat4(n,n,r),t.N.transformMat4(n,n,e),n},t.cs=t=>({u_camera_to_center_distance:new va(t),u_extrude_scale:new Ca(t),u_device_pixel_ratio:new va(t),u_matrix:new Ta(t),u_inv_rot_matrix:new Ta(t),u_merc_center:new xa(t),u_tile_id:new ba(t),u_zoom_transition:new va(t),u_up_dir:new ba(t),u_emissive_strength:new va(t)}),t.ct=t=>({u_matrix:new Ta(t),u_pixels_to_tile_units:new Ca(t),u_device_pixel_ratio:new va(t),u_units_to_pixels:new xa(t),u_dash_image:new ya(t),u_gradient_image:new ya(t),u_image_height:new va(t),u_texsize:new xa(t),u_tile_units_to_pixels:new va(t),u_alpha_discard_threshold:new va(t),u_trim_offset:new xa(t),u_emissive_strength:new va(t)}),t.cu=t=>({u_matrix:new Ta(t),u_texsize:new xa(t),u_pixels_to_tile_units:new Ca(t),u_device_pixel_ratio:new va(t),u_image:new ya(t),u_units_to_pixels:new xa(t),u_tile_units_to_pixels:new va(t),u_alpha_discard_threshold:new va(t),u_trim_offset:new xa(t)}),t.cv=Cs,t.cw=nm,t.cx=cm,t.cy=cd,t.cz=(t,e,i,n,r,o)=>{const s=t.transform,a="globe"===s.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(a){const t=td(s.zoom,e.canonical)*s._pixelsPerMercatorPixel;l=Float32Array.from([t,0,0,t])}else l=s.calculatePixelsToTileUnitsMatrix(i);else l=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(s.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:st.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:ld,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(a){c.u_inv_rot_matrix=n,c.u_merc_center=r,c.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],c.u_zoom_transition=id(s.zoom);const t=r[0]*Li,i=r[1]*Li;c.u_up_dir=s.projection.upVector(new rl(0,0,0),t,i)}return c},t.d=Dt,t.d0=T,t.d1=bl,t.d2=Ka,t.d3=function([t,e,i]){const n=Math.hypot(t,e,i),r=Math.atan2(t,i),o=.5*Math.PI-Math.acos(-e/n);return new tl(b(r),b(o))},t.d4=Ja,t.d5=n,t.d6=rd,t.d7=nd,t.d8=function(e){const i=[0,0,0],n=t.a6.identity(new Float64Array(16));return t.a6.multiply(n,e.pixelMatrix,e.globeMatrix),t.N.transformMat4(i,i,n),new _(i[0],i[1])},t.d9=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(t){if(null==tt){const e=t.navigator?t.navigator.userAgent:null;tt=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return tt}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.dA=vg,t.dB=gv,t.dC=vv,t.dD=Of,t.dE=z,t.dF=mg,t.dG=function(t,e,i,n,r,o,s,a,l,c,u){t.createArrays(),t.tilePixelRatio=Li/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const h=t.layers[0].layout,d=t.layers[0]._unevaluatedLayout._values,p={};if("composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:i}=t.textSizeData;p.compositeTextSizes=[d["text-size"].possiblyEvaluate(new Ao(e),a),d["text-size"].possiblyEvaluate(new Ao(i),a)]}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:i}=t.iconSizeData;p.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new Ao(e),a),d["icon-size"].possiblyEvaluate(new Ao(i),a)]}p.layoutTextSize=d["text-size"].possiblyEvaluate(new Ao(l+1),a),p.layoutIconSize=d["icon-size"].possiblyEvaluate(new Ao(l+1),a),p.textMaxSize=d["text-size"].possiblyEvaluate(new Ao(18),a);const f="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),m=h.get("text-size");let g=!1;for(const e of t.features)if(e.icon&&e.icon.nameSecondary){g=!0;break}for(const o of t.features){const l=h.get("text-font").evaluate(o,{},a).join(","),d=m.evaluate(o,{},a),_=p.layoutTextSize.evaluate(o,{},a),y=(p.layoutIconSize.evaluate(o,{},a),{horizontal:{},vertical:void 0}),v=o.text;let x,b=[0,0];if(v){const n=v.toString(),s=h.get("text-letter-spacing").evaluate(o,{},a)*rm,c=h.get("text-line-height").evaluate(o,{},a)*rm,u=co(n)?s:0,p=h.get("text-anchor").evaluate(o,{},a),m=h.get("text-variable-anchor");if(!m){const t=h.get("text-radial-offset").evaluate(o,{},a);b=t?kg(p,[t*rm,Rg]):h.get("text-offset").evaluate(o,{},a).map((t=>t*rm))}let g=f?"center":h.get("text-justify").evaluate(o,{},a);const x="point"===h.get("symbol-placement"),w=x?h.get("text-max-width").evaluate(o,{},a)*rm:1/0,E=o=>{t.allowVerticalPlacement&&lo(n)&&(y.vertical=Wm(v,e,i,r,l,w,c,p,o,u,b,jm.vertical,!0,_,d))};if(!f&&m){const t="auto"===g?m.map((t=>Ng(t))):[g];let n=!1;for(let o=0;o<t.length;o++){const s=t[o];if(!y.horizontal[s])if(n)y.horizontal[s]=y.horizontal[0];else{const t=Wm(v,e,i,r,l,w,c,"center",s,u,b,jm.horizontal,!1,_,d);t&&(y.horizontal[s]=t,n=1===t.positionedLines.length)}}E("left")}else{if("auto"===g&&(g=Ng(p)),x||h.get("text-writing-mode").indexOf("horizontal")>=0||!lo(n)){const t=Wm(v,e,i,r,l,w,c,p,g,u,b,jm.horizontal,!1,_,d);t&&(y.horizontal[g]=t)}E(x?"left":g)}}let w=!1;if(o.icon&&o.icon.namePrimary){const e=n[o.icon.namePrimary];e&&(x=eg(r[o.icon.namePrimary],o.icon.nameSecondary?r[o.icon.nameSecondary]:void 0,h.get("icon-offset").evaluate(o,{},a),h.get("icon-anchor").evaluate(o,{},a)),w=e.sdf,void 0===t.sdfIcons?t.sdfIcons=e.sdf:t.sdfIcons!==e.sdf&&j("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.pixelRatio||0!==h.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const E=Ug(y.horizontal)||y.vertical;t.iconsInText||(t.iconsInText=!!E&&E.iconsInText),(E||x)&&Og(t,o,y,x,n,p,_,0,b,w,s,a,c,u,g)}o&&t.generateCollisionDebugBuffers(l,t.collisionBoxArray)},t.dH=Cp,t.dI=Om,t.dJ=Yp,t.dK=h,t.dL=Ap,t.dM=gp,t.dN=m,t.dO=mm,t.dP=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==Ky){const i=new Uint32Array(t,0,7),[,,n,r,o,s]=i;e=i.byteLength+r+o+s+o,(n!==t.byteLength||e>=t.byteLength)&&j("Invalid b3dm header information.")}return nv(t,e)},t.dQ=function(t,e){const i=pv(t);for(const t of i){for(const e of t.meshes)fv(e);t.lights&&(t.lightMeshIndex=t.meshes.length,t.meshes.push(mv(t.lights,e)))}return i},t.dR=Cv,t.dS=Iy,t.dT=Co,t.dU=function(t){pt(),lt&&lt.then((e=>{e.keys().then((i=>{for(let n=0;n<i.length-t;n++)e.delete(i[n])}))}))},t.da=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",kt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,i){if(!o(t))return t;const n=Ft(t);return n.params.push(`sdk=js-${e}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||i)}normalizeGlyphsURL(t,e){if(!o(t))return t;const i=Ft(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(t,e){if(!o(t))return t;const i=Ft(t);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,n){if(!o(t))return t;const r=Ft(t);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),i&&r.params.push(`language=${i}`),n&&r.params.push(`worldview=${n}`),this._makeAPIURL(r,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,n){const r=Ft(t);return o(t)?(r.path=`/styles/v1${r.path}/sprite${e}${i}`,this._makeAPIURL(r,this._customAccessToken||n)):(r.path+=`${e}${i}`,zt(r))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!o(t))return t;const r=Ft(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==r.authority&&512===i?"@2x":""}${_t.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${n.RASTER_URL_PREFIX}${r.path}`:"rasterarrays"===r.authority?r.path=`/${n.RASTERARRAYS_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${n.TILE_URL_VERSION}${r.path}`);const s=this._customAccessToken||function(t){for(const e of t){const t=e.match(/^access_token=(.*)$/);if(t)return t[1]}return null}(r.params)||n.ACCESS_TOKEN;return n.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,s)}canonicalizeTileURL(t,e){const i=Ft(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${n.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?r+=`rasterarrays/${i.path.replace(`/${n.RASTERARRAYS_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${n.TILE_URL_VERSION}/`,"")}`;let o=i.params;return e&&(o=o.filter((t=>!t.match(/^access_token=/)))),o.length&&(r+=`?${o.join("&")}`),r}canonicalizeTileset(t,e){const i=!!e&&o(e),n=[];for(const e of t.tiles||[])r(e)?n.push(this.canonicalizeTileURL(e,i)):n.push(e);return n}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=Ft(n.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==r.path&&(t.path=`${r.path}${t.path}`),!n.REQUIRE_ACCESS_TOKEN)return zt(t);if(e=e||n.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter((t=>-1===t.indexOf("access_token"))),t.params.push(`access_token=${e||""}`),zt(t)}},t.db=function(t,e){e?Zt.add(t):Zt.delete(t)},t.dc=_t,t.dd=Xt,t.de=Yt,t.df=Nt,t.dg=Wt,t.dh=function(t){Zt.delete(t)},t.di=$t,t.dj=Ht,t.dk=e,t.dl=function(t,e){ut=t,ht=e},t.dm=function(t,e,i=!1){if(bo===_o||bo===yo||bo===vo)throw new Error("setRTLTextPlugin cannot be called multiple times.");wo=st.resolveURL(t),bo=_o,xo=e,So(),i||Io()},t.dn=Mo,t.dp=function(){ky().acquire(Ly)},t.dq=function(){const t=Dy;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Ly),Dy=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.dr=Ry,t.ds=function(t){const e=dt();if(!e)return;const i=e.delete(at);t&&i.catch(t).then((()=>t()))},t.dt=Ay,t.du=Vy,t.dv=function(t){Oy=st.resolveURL(t),Uy||(Uy=new Cy(ky(),new ee)),Uy.broadcast("setDracoUrl",Oy)},t.dw=jy,t.dx=function(t){zy=st.resolveURL(t),Uy||(Uy=new Cy(ky(),new ee)),Uy.broadcast("setMeshoptUrl",zy)},t.dy=io,t.dz=vd,t.e=P,t.f=st,t.g=function(t,e){return It(P(t,{type:"json"}),e)},t.h=xd,t.i=Ye,t.j=de,t.k=Lr,t.l=function(t){return fetch(t).then((t=>t.arrayBuffer())).then((e=>nv(e,0,t)))},t.m=Dr,t.n=Hr,t.o=Go,t.p=dg,t.q=$r,t.r=Wr,t.s=kr,t.t=mn,t.u=jo,t.v=_n,t.w=j,t.x=fn,t.z=Wo})),n(0,(function(t){function e(t){const e=t?t.url.toString():void 0;return e?performance.getEntriesByName(e):[]}function i(t){if("number"==typeof t||"boolean"==typeof t||"string"==typeof t||null==t)return JSON.stringify(t);if(Array.isArray(t)){let e="[";for(const n of t)e+=`${i(n)},`;return`${e}]`}let e="{";for(const n of Object.keys(t).sort())e+=`${n}:${i(t[n])},`;return`${e}}`}function n(e){let n="";for(const r of t.b2)n+=`/${i(e[r])}`;return n}class r{constructor(t){this.keyCache={},this._layers={},this._layerConfigs={},t&&this.replace(t)}replace(t,e){this._layerConfigs={},this._layers={},this.update(t,[],e)}update(e,i,r){this._options=r;for(const i of e)this._layerConfigs[i.id]=i,(this._layers[i.id]=t.c2(i,this.scope,this._options)).compileFilter(),this.keyCache[i.id]&&delete this.keyCache[i.id];for(const t of i)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const o=function(t,e){const i={};for(let r=0;r<t.length;r++){const o=e&&e[t[r].id]||n(t[r]);e&&(e[t[r].id]=o);let s=i[o];s||(s=i[o]=[]),s.push(t[r])}const r=[];for(const t in i)r.push(i[t]);return r}(t.a$(this._layerConfigs),this.keyCache);for(const t of o){const e=t.map((t=>this._layers[t.id])),i=e[0];if("none"===i.visibility)continue;const n=i.source||"";let r=this.familiesBySource[n];r||(r=this.familiesBySource[n]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=r[o];s||(s=r[o]=[]),s.push(e)}}}const o=1*t.dA;class s{constructor(e){const i={},n=[];for(const t in e){const r=e[t],s=i[t]={};for(const t in r.glyphs){const e=r.glyphs[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const i=e.metrics.localGlyph?o:1,a={x:0,y:0,w:e.bitmap.width+2*i,h:e.bitmap.height+2*i};n.push(a),s[t]=a}}const{w:r,h:s}=t.p(n),a=new t.dz({width:r||1,height:s||1});for(const n in e){const r=e[n];for(const e in r.glyphs){const s=r.glyphs[+e];if(!s||0===s.bitmap.width||0===s.bitmap.height)continue;const l=i[n][e],c=s.metrics.localGlyph?o:1;t.dz.copy(s.bitmap,a,{x:0,y:0},{x:l.x+c,y:l.y+c},s.bitmap)}}this.image=a,this.positions=i}}t.dy(s,"GlyphAtlas");class a{constructor(e){this.tileID=new t.am(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=t.as(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,i,n,r,o){this.status="parsing",this.data=e,this.collisionBoxArray=new t.aD;const a=new t.dB(Object.keys(e.layers).sort()),c=new t.dC(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h=new t.dD(256,256),d={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:h,availableImages:n,brightness:this.brightness},p=i.familiesBySource[this.source];for(const i in p){const r=e.layers[i];if(!r)continue;let o=!1,s=!1,h=!1;for(const t of p[i])"symbol"===t[0].type?o=!0:s=!0,t[0].is3D()&&"model"!==t[0].type&&(h=!0);if(this.extraShadowCaster&&!h)continue;if(!0===this.isSymbolTile&&!o)continue;if(!1===this.isSymbolTile&&!s)continue;1===r.version&&t.w(`Vector tile source "${this.source}" layer "${i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const f=a.encode(i),m=[];for(let t=0;t<r.length;t++){const e=r.feature(t),n=c.getId(e,i);m.push({feature:e,id:n,index:t,sourceLayerIndex:f})}for(const t of p[i]){const e=t[0];(!this.extraShadowCaster||e.is3D()&&"model"!==e.type)&&(void 0!==this.isSymbolTile&&"symbol"===e.type!==this.isSymbolTile||e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(l(t,this.zoom,d.brightness,n),(u[e.id]=e.createBucket({index:c.bucketLayerIDs.length,layers:t,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:f,sourceID:this.source,projection:this.projection.spec})).populate(m,d,this.tileID.canonical,this.tileTransform),c.bucketLayerIDs.push(t.map((t=>t.id)))))}}let f,m,g,_;h.trim();const y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},v=()=>{if(f)return this.status="done",o(f);if(this.extraShadowCaster)this.status="done",o(null,{buckets:t.a$(u).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:d.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(m&&g&&_){const e=new s(m),i=new t.dF(g,_);for(const r in u){const o=u[r];o instanceof t.aE?(l(o.layers,this.zoom,d.brightness,n),t.dG(o,m,e.positions,g,i.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):o.hasPattern&&(o instanceof t.aK||o instanceof t.aL||o instanceof t.cH)&&(l(o.layers,this.zoom,d.brightness,n),o.addFeatures(d,this.tileID.canonical,i.patternPositions,n,this.tileTransform,this.brightness))}this.status="done",o(null,{buckets:t.a$(u).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:h,imageAtlas:i,brightness:d.brightness})}};if(!this.extraShadowCaster){const e=t.dE(d.glyphDependencies,(t=>Object.keys(t).map(Number)));Object.keys(e).length?r.send("getGlyphs",{uid:this.uid,stacks:e,scope:this.scope},((t,e)=>{f||(f=t,m=e,v())}),void 0,!1,y):m={};const i=Object.keys(d.iconDependencies);i.length?r.send("getImages",{icons:i,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((t,e)=>{f||(f=t,g=e,v())}),void 0,!1,y):g={};const n=Object.keys(d.patternDependencies);n.length?r.send("getImages",{icons:n,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((t,e)=>{f||(f=t,_=e,v())}),void 0,!1,y):_={}}v()}}function l(e,i,n,r){const o=new t.K(i,{brightness:n});for(const t of e)t.recalculate(o,r)}class c extends t.E{constructor(e,i,n,r,o,s){super(),this.actor=e,this.layerIndex=i,this.availableImages=n,this.loadVectorData=o||t.ah,this.loading={},this.loaded={},this.deduped=new t.af(e.scheduler),this.isSpriteLoaded=r,this.scheduler=e.scheduler,this.brightness=s}loadTile(i,n){const r=i.uid,o=i&&i.request,s=o&&o.collectResourceTiming,l=this.loading[r]=new a(i);l.abort=this.loadVectorData(i,((a,c)=>{const u=!this.loading[r];if(delete this.loading[r],u||a||!c)return l.status="done",u||(this.loaded[r]=l),n(a);const h=c.rawData,d={};c.expires&&(d.expires=c.expires),c.cacheControl&&(d.cacheControl=c.cacheControl),l.vectorTile=c.vectorTile||new t.dH(new t.dI(h));const p=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,((i,r)=>{if(i||!r)return n(i);const a={};if(s){const t=e(o);t.length>0&&(a.resourceTiming=JSON.parse(JSON.stringify(t)))}n(null,t.e({rawTileData:h.slice(0)},r,d,a))}))};this.isSpriteLoaded?p():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(p,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):p()})),this.loaded=this.loaded||{},this.loaded[r]=l}))}reloadTile(e,i){const n=this.loaded,r=e.uid,o=this;if(n&&n[r]){const s=n[r];s.showCollisionBoxes=e.showCollisionBoxes,s.projection=e.projection,s.brightness=e.brightness,s.tileTransform=t.as(e.tileID.canonical,e.projection),s.extraShadowCaster=e.extraShadowCaster;const a=(t,e)=>{const n=s.reloadCallback;n&&(delete s.reloadCallback,s.parse(s.vectorTile,o.layerIndex,this.availableImages,o.actor,n)),i(t,e)};"parsing"===s.status?s.reloadCallback=a:"done"===s.status&&(s.vectorTile?s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,a):a())}else i(null,void 0)}abortTile(t,e){const i=t.uid,n=this.loading[i];n&&(n.abort&&n.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,n=t.uid;i&&i[n]&&delete i[n],e()}}class u{loadTile(e,i){const{uid:n,encoding:r,rawImageData:o,padding:s}=e,a=ImageBitmap&&o instanceof ImageBitmap?this.getImageData(o,s):o;i(null,new t.dJ(n,a,r,s<1))}getImageData(t,e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);const i=this.offscreenCanvasContext.getImageData(-e,-e,t.width+2*e,t.height+2*e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}class h{decodeRasterArray({task:e,buffer:i},n){t.aZ.performDecoding(i,e).then((t=>{n(null,t)}),(t=>{n(t)}))}}function d(t,e){if(0!==t.length){p(t[0],e);for(var i=1;i<t.length;i++)p(t[i],!e)}}function p(t,e){for(var i=0,n=0,r=0,o=t.length,s=o-1;r<o;s=r++){var a=(t[r][0]-t[s][0])*(t[s][1]+t[r][1]),l=i+a;n+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+n>=0!=!!e&&t.reverse()}var f=t.dK((function t(e,i){var n,r=e&&e.type;if("FeatureCollection"===r)for(n=0;n<e.features.length;n++)t(e.features[n],i);else if("GeometryCollection"===r)for(n=0;n<e.geometries.length;n++)t(e.geometries[n],i);else if("Feature"===r)t(e.geometry,i);else if("Polygon"===r)d(e.coordinates,i);else if("MultiPolygon"===r)for(n=0;n<e.coordinates.length;n++)d(e.coordinates[n],i);return e}));const m=t.dL.prototype.toGeoJSON;let g=class{constructor(e){this._feature=e,this.extent=t.V,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const i of this._feature.geometry)e.push([new t.P(i[0],i[1])]);return e}{const e=[];for(const i of this._feature.geometry){const n=[];for(const e of i)n.push(new t.P(e[0],e[1]));e.push(n)}return e}}toGeoJSON(t,e,i){return m.call(this,t,e,i)}},_=class{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.V,this.length=e.length,this._features=e}feature(t){return new g(this._features[t])}};var y={exports:{}},v=t.dN,x=t.dM.VectorTileFeature,b=w;function w(t,e){this.options=e||{},this.features=t,this.length=t.length}function E(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}w.prototype.feature=function(t){return new E(this.features[t],this.options.extent)},E.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],n=[],r=0;r<i.length;r++)n.push(new v(i[r][0],i[r][1]));this.geometry.push(n)}return this.geometry},E.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,r=-1/0,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[e,n,i,r]},E.prototype.toGeoJSON=x.prototype.toGeoJSON;var S=t.dO,T=b;function M(t){var e=new S;return function(t,e){for(var i in t.layers)e.writeMessage(3,I,t.layers[i])}(t,e),e.finish()}function I(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)n.feature=t.feature(i),e.writeMessage(2,C,n);var r=n.keys;for(i=0;i<r.length;i++)e.writeStringField(3,r[i]);var o=n.values;for(i=0;i<o.length;i++)e.writeMessage(4,D,o[i])}function C(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,A,t),e.writeVarintField(3,i.type),e.writeMessage(4,R,i)}function A(t,e){var i=t.feature,n=t.keys,r=t.values,o=t.keycache,s=t.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(n.push(a),o[a]=c=n.length-1),e.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(r.push(l),s[h]=d=r.length-1),e.writeVarint(d)}}}function P(t,e){return(e<<3)+(7&t)}function L(t){return t<<1^t>>31}function R(t,e){for(var i=t.loadGeometry(),n=t.type,r=0,o=0,s=i.length,a=0;a<s;a++){var l=i[a],c=1;1===n&&(c=l.length),e.writeVarint(P(1,c));for(var u=3===n?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==n&&e.writeVarint(P(2,u-1));var d=l[h].x-r,p=l[h].y-o;e.writeVarint(L(d)),e.writeVarint(L(p)),r+=d,o+=p}3===n&&e.writeVarint(P(7,1))}}function D(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}y.exports=M,y.exports.fromVectorTileJs=M,y.exports.fromGeojsonVt=function(t,e){e=e||{};var i={};for(var n in t)i[n]=new T(t[n].features,e),i[n].name=n,i[n].version=e.version,i[n].extent=e.extent;return M({layers:i})},y.exports.GeoJSONWrapper=T;var k=t.dK(y.exports);const N={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},O=Math.fround||(F=new Float32Array(1),t=>(F[0]=+t,F[0]));var F;const z=3,B=5,U=6;class V{constructor(t){this.options=Object.assign(Object.create(N),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:i,maxZoom:n}=this.options;e&&console.time("total time");const r=`prepare ${t.length} points`;e&&console.time(r),this.points=t;const o=[];for(let e=0;e<t.length;e++){const i=t[e];if(!i.geometry)continue;const[n,r]=i.geometry.coordinates,s=O(H(n)),a=O(W(r));o.push(s,a,1/0,e,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[n+1]=this._createTree(o);e&&console.timeEnd(r);for(let t=n;t>=i;t--){const i=+Date.now();s=this.trees[t]=this._createTree(this._cluster(s,t)),e&&console.log("z%d: %d clusters in %dms",t,s.numItems,+Date.now()-i)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,t[1]));let r=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,r=180;else if(i>r){const t=this.getClusters([i,n,180,o],e),s=this.getClusters([-180,n,r,o],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(H(i),W(o),H(r),W(n)),l=s.data,c=[];for(const t of a){const e=this.stride*t;c.push(l[e+B]>1?j(l,e,this.clusterProps):this.points[l[e+z]])}return c}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),n="No cluster with the specified id.",r=this.trees[i];if(!r)throw new Error(n);const o=r.data;if(e*this.stride>=o.length)throw new Error(n);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=r.within(o[e*this.stride],o[e*this.stride+1],s),l=[];for(const e of a){const i=e*this.stride;o[i+4]===t&&l.push(o[i+B]>1?j(o,i,this.clusterProps):this.points[o[i+z]])}if(0===l.length)throw new Error(n);return l}getLeaves(t,e,i){const n=[];return this._appendLeaves(n,t,e=e||10,i=i||0,0),n}getTile(t,e,i){const n=this.trees[this._limitZoom(t)],r=Math.pow(2,t),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/r,c=(i+1+a)/r,u={features:[]};return this._addTileFeatures(n.range((e-a)/r,l,(e+1+a)/r,c),n.data,e,i,r,u),0===e&&this._addTileFeatures(n.range(1-a/r,l,1,c),n.data,r,i,r,u),e===r-1&&this._addTileFeatures(n.range(0,l,a/r,c),n.data,-1,i,r,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,n,r){const o=this.getChildren(e);for(const e of o){const o=e.properties;if(o&&o.cluster?r+o.point_count<=n?r+=o.point_count:r=this._appendLeaves(t,o.cluster_id,i,n,r):r<n?r++:t.push(e),t.length===i)break}return r}_createTree(e){const i=new t.bg(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let t=0;t<e.length;t+=this.stride)i.add(e[t],e[t+1]);return i.finish(),i.data=e,i}_addTileFeatures(t,e,i,n,r,o){for(const s of t){const t=s*this.stride,a=e[t+B]>1;let l,c,u;if(a)l=G(e,t,this.clusterProps),c=e[t],u=e[t+1];else{const i=this.points[e[t+z]];l=i.properties;const[n,r]=i.geometry.coordinates;c=H(n),u=W(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-i)),Math.round(this.options.extent*(u*r-n))]],tags:l};let d;d=a||this.options.generateId?e[t+z]:this.points[e[t+z]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:i,extent:n,reduce:r,minPoints:o}=this.options,s=i/(n*Math.pow(2,e)),a=t.data,l=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=e)continue;a[i+2]=e;const n=a[i],u=a[i+1],h=t.within(a[i],a[i+1],s),d=a[i+B];let p=d;for(const t of h){const i=t*c;a[i+2]>e&&(p+=a[i+B])}if(p>d&&p>=o){let t,o=n*d,s=u*d,f=-1;const m=(i/c<<5)+(e+1)+this.points.length;for(const n of h){const l=n*c;if(a[l+2]<=e)continue;a[l+2]=e;const u=a[l+B];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=m,r&&(t||(t=this._map(a,i,!0),f=this.clusterProps.length,this.clusterProps.push(t)),r(t,this._map(a,l)))}a[i+4]=m,l.push(o/p,s/p,1/0,m,-1,p),r&&l.push(f)}else{for(let t=0;t<c;t++)l.push(a[i+t]);if(p>1)for(const t of h){const i=t*c;if(!(a[i+2]<=e)){a[i+2]=e;for(let t=0;t<c;t++)l.push(a[i+t])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,i){if(t[e+B]>1){const n=this.clusterProps[t[e+U]];return i?Object.assign({},n):n}const n=this.points[t[e+z]].properties,r=this.options.map(n);return i&&r===n?Object.assign({},r):r}}function j(t,e,i){return{type:"Feature",id:t[e+z],properties:G(t,e,i),geometry:{type:"Point",coordinates:[(n=t[e],360*(n-.5)),q(t[e+1])]}};var n}function G(t,e,i){const n=t[e+B],r=n>=1e4?`${Math.round(n/1e3)}k`:n>=1e3?Math.round(n/100)/10+"k":n,o=t[e+U],s=-1===o?{}:Object.assign({},i[o]);return Object.assign(s,{cluster:!0,cluster_id:t[e+z],point_count:n,point_count_abbreviated:r})}function H(t){return t/360+.5}function W(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function q(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}var X={exports:{}};X.exports=function(){function t(i,n,r,o){for(var s,a=o,l=r-n>>1,c=r-n,u=i[n],h=i[n+1],d=i[r],p=i[r+1],f=n+3;f<r;f+=3){var m=e(i[f],i[f+1],u,h,d,p);if(m>a)s=f,a=m;else if(m===a){var g=Math.abs(f-l);g<c&&(s=f,c=g)}}a>o&&(s-n>3&&t(i,n,s,o),i[s+2]=a,r-s>3&&t(i,s,r,o))}function e(t,e,i,n,r,o){var s=r-i,a=o-n;if(0!==s||0!==a){var l=((t-i)*s+(e-n)*a)/(s*s+a*a);l>1?(i=r,n=o):l>0&&(i+=s*l,n+=a*l)}return(s=t-i)*s+(a=e-n)*a}function i(t,e,i,r){var o={id:void 0===t?null:t,type:e,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)n(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var r=0;r<e.length;r++)n(t,e[r]);else if("MultiPolygon"===i)for(r=0;r<e.length;r++)for(var o=0;o<e[r].length;o++)n(t,e[r][o])}(o),o}function n(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function r(t,e,n,l){if(e.geometry){var c=e.geometry.coordinates,u=e.geometry.type,h=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),d=[],p=e.id;if(n.promoteId?p=e.properties[n.promoteId]:n.generateId&&(p=l||0),"Point"===u)o(c,d);else if("MultiPoint"===u)for(var f=0;f<c.length;f++)o(c[f],d);else if("LineString"===u)s(c,d,h,!1);else if("MultiLineString"===u){if(n.lineMetrics){for(f=0;f<c.length;f++)s(c[f],d=[],h,!1),t.push(i(p,"LineString",d,e.properties));return}a(c,d,h,!1)}else if("Polygon"===u)a(c,d,h,!0);else{if("MultiPolygon"!==u){if("GeometryCollection"===u){for(f=0;f<e.geometry.geometries.length;f++)r(t,{id:p,geometry:e.geometry.geometries[f],properties:e.properties},n,l);return}throw new Error("Input data is not a valid GeoJSON object.")}for(f=0;f<c.length;f++){var m=[];a(c[f],m,h,!0),d.push(m)}}t.push(i(p,u,d,e.properties))}}function o(t,e){e.push(l(t[0])),e.push(c(t[1])),e.push(0)}function s(e,i,n,r){for(var o,s,a=0,u=0;u<e.length;u++){var h=l(e[u][0]),d=c(e[u][1]);i.push(h),i.push(d),i.push(0),u>0&&(a+=r?(o*d-h*s)/2:Math.sqrt(Math.pow(h-o,2)+Math.pow(d-s,2))),o=h,s=d}var p=i.length-3;i[2]=1,t(i,0,p,n),i[p+2]=1,i.size=Math.abs(a),i.start=0,i.end=i.size}function a(t,e,i,n){for(var r=0;r<t.length;r++){var o=[];s(t[r],o,i,n),e.push(o)}}function l(t){return t/360+.5}function c(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function u(t,e,n,r,o,s,a,l){if(r/=e,s>=(n/=e)&&a<r)return t;if(a<n||s>=r)return null;for(var c=[],u=0;u<t.length;u++){var p=t[u],m=p.geometry,g=p.type,_=0===o?p.minX:p.minY,y=0===o?p.maxX:p.maxY;if(_>=n&&y<r)c.push(p);else if(!(y<n||_>=r)){var v=[];if("Point"===g||"MultiPoint"===g)h(m,v,n,r,o);else if("LineString"===g)d(m,v,n,r,o,!1,l.lineMetrics);else if("MultiLineString"===g)f(m,v,n,r,o,!1);else if("Polygon"===g)f(m,v,n,r,o,!0);else if("MultiPolygon"===g)for(var x=0;x<m.length;x++){var b=[];f(m[x],b,n,r,o,!0),b.length&&v.push(b)}if(v.length){if(l.lineMetrics&&"LineString"===g){for(x=0;x<v.length;x++)c.push(i(p.id,g,v[x],p.tags));continue}"LineString"!==g&&"MultiLineString"!==g||(1===v.length?(g="LineString",v=v[0]):g="MultiLineString"),"Point"!==g&&"MultiPoint"!==g||(g=3===v.length?"Point":"MultiPoint"),c.push(i(p.id,g,v,p.tags))}}}return c.length?c:null}function h(t,e,i,n,r){for(var o=0;o<t.length;o+=3){var s=t[o+r];s>=i&&s<=n&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function d(t,e,i,n,r,o,s){for(var a,l,c=p(t),u=0===r?g:_,h=t.start,d=0;d<t.length-3;d+=3){var f=t[d],y=t[d+1],v=t[d+2],x=t[d+3],b=t[d+4],w=0===r?f:y,E=0===r?x:b,S=!1;s&&(a=Math.sqrt(Math.pow(f-x,2)+Math.pow(y-b,2))),w<i?E>i&&(l=u(c,f,y,x,b,i),s&&(c.start=h+a*l)):w>n?E<n&&(l=u(c,f,y,x,b,n),s&&(c.start=h+a*l)):m(c,f,y,v),E<i&&w>=i&&(l=u(c,f,y,x,b,i),S=!0),E>n&&w<=n&&(l=u(c,f,y,x,b,n),S=!0),!o&&S&&(s&&(c.end=h+a*l),e.push(c),c=p(t)),s&&(h+=a)}var T=t.length-3;f=t[T],y=t[T+1],v=t[T+2],(w=0===r?f:y)>=i&&w<=n&&m(c,f,y,v),T=c.length-3,o&&T>=3&&(c[T]!==c[0]||c[T+1]!==c[1])&&m(c,c[0],c[1],c[2]),c.length&&e.push(c)}function p(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function f(t,e,i,n,r,o){for(var s=0;s<t.length;s++)d(t[s],e,i,n,r,o,!1)}function m(t,e,i,n){t.push(e),t.push(i),t.push(n)}function g(t,e,i,n,r,o){var s=(o-e)/(n-e);return t.push(o),t.push(i+(r-i)*s),t.push(1),s}function _(t,e,i,n,r,o){var s=(o-i)/(r-i);return t.push(e+(n-e)*s),t.push(o),t.push(1),s}function y(t,e){for(var n=[],r=0;r<t.length;r++){var o,s=t[r],a=s.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)o=v(s.geometry,e);else if("MultiLineString"===a||"Polygon"===a){o=[];for(var l=0;l<s.geometry.length;l++)o.push(v(s.geometry[l],e))}else if("MultiPolygon"===a)for(o=[],l=0;l<s.geometry.length;l++){for(var c=[],u=0;u<s.geometry[l].length;u++)c.push(v(s.geometry[l][u],e));o.push(c)}n.push(i(s.id,a,o,s.tags))}return n}function v(t,e){var i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(var n=0;n<t.length;n+=3)i.push(t[n]+e,t[n+1],t[n+2]);return i}function x(t,e){if(t.transformed)return t;var i,n,r,o=1<<t.z,s=t.x,a=t.y;for(i=0;i<t.features.length;i++){var l=t.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(n=0;n<c.length;n+=2)l.geometry.push(b(c[n],c[n+1],e,o,s,a));else for(n=0;n<c.length;n++){var h=[];for(r=0;r<c[n].length;r+=2)h.push(b(c[n][r],c[n][r+1],e,o,s,a));l.geometry.push(h)}}return t.transformed=!0,t}function b(t,e,i,n,r,o){return[Math.round(i*(t*n-r)),Math.round(i*(e*n-o))]}function w(t,e,i,n,r){for(var o=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){s.numFeatures++,E(s,t[a],o,r);var l=t[a].minX,c=t[a].minY,u=t[a].maxX,h=t[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function E(t,e,i,n){var r=e.geometry,o=e.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<r.length;a+=3)s.push(r[a]),s.push(r[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)S(s,r,t,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<r.length;a++)S(s,r[a],t,i,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)S(s,c[a],t,i,!0,0===a)}if(s.length){var u=e.tags||null;if("LineString"===o&&n.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==e.id&&(d.id=e.id),t.features.push(d)}}function S(t,e,i,n,r,o){var s=n*n;if(n>0&&e.size<(r?s:n))i.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===n||e[l+2]>s)&&(i.numSimplified++,a.push(e[l]),a.push(e[l+1])),i.numPoints++;r&&function(t,e){for(var i=0,n=0,r=t.length,o=r-2;n<r;o=n,n+=2)i+=(t[n]-t[o])*(t[n+1]+t[o+1]);if(i>0===e)for(n=0,r=t.length;n<r/2;n+=2){var s=t[n],a=t[n+1];t[n]=t[r-2-n],t[n+1]=t[r-1-n],t[r-2-n]=s,t[r-1-n]=a}}(a,o),t.push(a)}}function T(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)r(i,t.features[n],e,n);else r(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(t,e){var i=e.buffer/e.extent,n=t,r=u(t,1,-1-i,i,0,-1,2,e),o=u(t,1,1-i,2+i,0,-1,2,e);return(r||o)&&(n=u(t,1,-i,1+i,0,-1,2,e)||[],r&&(n=y(r,1).concat(n)),o&&(n=n.concat(y(o,-1)))),n}(n,e)).length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function M(t,e,i){return 32*((1<<t)*i+e)+t}return T.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},T.prototype.splitTile=function(t,e,i,n,r,o,s){for(var a=[t,e,i,n],l=this.options,c=l.debug;a.length;){n=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();var h=1<<e,d=M(e,i,n),p=this.tiles[d];if(!p&&(c>1&&console.time("creation"),p=this.tiles[d]=w(t,e,i,n,l),this.tileCoords.push({z:e,x:i,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,r){if(e===l.maxZoom||e===r)continue;var m=1<<r-e;if(i!==Math.floor(o/m)||n!==Math.floor(s/m))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){c>1&&console.time("clipping");var g,_,y,v,x,b,E=.5*l.buffer/l.extent,S=.5-E,T=.5+E,I=1+E;g=_=y=v=null,x=u(t,h,i-E,i+T,0,p.minX,p.maxX,l),b=u(t,h,i+S,i+I,0,p.minX,p.maxX,l),t=null,x&&(g=u(x,h,n-E,n+T,1,p.minY,p.maxY,l),_=u(x,h,n+S,n+I,1,p.minY,p.maxY,l),x=null),b&&(y=u(b,h,n-E,n+T,1,p.minY,p.maxY,l),v=u(b,h,n+S,n+I,1,p.minY,p.maxY,l),b=null),c>1&&console.timeEnd("clipping"),a.push(g||[],e+1,2*i,2*n),a.push(_||[],e+1,2*i,2*n+1),a.push(y||[],e+1,2*i+1,2*n),a.push(v||[],e+1,2*i+1,2*n+1)}}},T.prototype.getTile=function(t,e,i){var n=this.options,r=n.extent,o=n.debug;if(t<0||t>24)return null;var s=1<<t,a=M(t,e=(e%s+s)%s,i);if(this.tiles[a])return x(this.tiles[a],r);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,c=t,u=e,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[M(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?x(this.tiles[a],r):null):null},function(t,e){return new T(t,e)}}();var $=t.dK(X.exports);function Y(t,e){const i=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return e(null,null);const r=new _(n.features);let o=k(r);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:r,rawData:o.buffer})}class Z extends c{constructor(t,e,i,n,r,o){super(t,e,i,n,Y,o),r&&(this.loadGeoJSON=r)}loadData(i,n){const r=i&&i.request,o=r&&r.collectResourceTiming;this.loadGeoJSON(i,((s,a)=>{if(s||!a)return n(s);if("object"!=typeof a)return n(new Error(`Input data given to '${i.source}' is not a valid GeoJSON object.`));{f(a,!0);try{if(i.filter){const e=t.r(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));const n=a.features.filter((t=>e.value.evaluate({zoom:0},t)));a={type:"FeatureCollection",features:n}}this._geoJSONIndex=i.cluster?new V(function({superclusterOptions:e,clusterProperties:i}){if(!i||!e)return e;const n={},r={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(i);for(const e of a){const[o,s]=i[e],a=t.r(s),l=t.r("string"==typeof o?[o,["accumulated"],["get",e]]:o);n[e]=a.value,r[e]=l.value}return e.map=t=>{s.properties=t;const e={};for(const t of a)e[t]=n[t].evaluate(o,s);return e},e.reduce=(t,e)=>{s.properties=e;for(const e of a)o.accumulated=t[e],t[e]=r[e].evaluate(o,s)},e}(i)).load(a.features):$(a,i.geojsonVtOptions)}catch(s){return n(s)}this.loaded={};const l={};if(o){const t=e(r);t&&(l.resourceTiming={},l.resourceTiming[i.source]=JSON.parse(JSON.stringify(t)))}n(null,l)}}))}reloadTile(t,e){const i=this.loaded;return i&&i[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,i){if(e.request)t.g(e.request,i);else{if("string"!=typeof e.data)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(e.data))}catch(t){return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class K{constructor(e,i){this.tileID=new t.am(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=e.projection,this.brightness=i}parse(e,i,n,r){this.status="parsing";const o=new t.am(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),s={},a=i.familiesBySource[n.source],l=new t.dC(o,n.promoteId);return l.bucketLayerIDs=[],l.is3DTile=!0,t.dP(e).then((e=>{if(!e)return r(new Error("Could not parse tile"));const i=t.dQ(e,1/t.bR(n.tileID.canonical)),c=e.json.extensionsUsed&&e.json.extensionsUsed.includes("MAPBOX_mesh_features")||e.json.asset.extras&&e.json.asset.extras.MAPBOX_mesh_features,u=e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression"),h=new t.K(this.zoom,{brightness:this.brightness});for(const e in a)for(const n of a[e]){const e=n[0];l.bucketLayerIDs.push(n.map((t=>t.id))),e.recalculate(h,[]);const r=new t.dR(i,o,c,u,this.brightness,l);c||(r.needsUpload=!0),s[e.fqid]=r,r.evaluate(e)}this.status="done",r(null,{buckets:s,featureIndex:l})})).catch((t=>r(new Error(t.message))))}}class J{constructor(t,e,i,n,r,o){this.actor=t,this.layerIndex=e,this.brightness=o,this.loading={},this.loaded={}}loadTile(e,i){const n=e.uid,r=this.loading[n]=new K(e,this.brightness);t.a_(e.request,((t,o)=>{const s=!this.loading[n];return delete this.loading[n],s||t?(r.status="done",s||(this.loaded[n]=r),i(t)):o&&0!==o.byteLength?void r.parse(o,this.layerIndex,e,((t,e)=>{r.status="done",this.loaded=this.loaded||{},this.loaded[n]=r,t||!e?i(t):i(null,e)})):(r.status="done",this.loaded[n]=r,i())}))}reloadTile(t,e){const i=this.loaded,n=t.uid;if(i&&i[n]){const r=i[n];r.projection=t.projection,r.brightness=t.brightness;const o=(i,n)=>{r.reloadCallback&&(delete r.reloadCallback,this.loadTile(t,e)),e(i,n)};"parsing"===r.status?r.reloadCallback=o:"done"===r.status&&this.loadTile(t,e)}}abortTile(t,e){const i=t.uid;this.loading[i]&&delete this.loading[i],e()}removeTile(t,e){const i=this.loaded,n=t.uid;i&&i[n]&&delete i[n],e()}}class Q{constructor(e){this.self=e,this.actor=new t.dS(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.bo({name:"mercator"}),this.workerSourceTypes={vector:c,geojson:Z,"batched-model":J},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.dT.isParsed())throw new Error("RTL text plugin already registered.");t.dT.applyArabicShaping=e.applyArabicShaping,t.dT.processBidirectionalText=e.processBidirectionalText,t.dT.processStyledBidirectionalText=e.processStyledBidirectionalText}}clearCaches(t,e,i){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t],delete this.rasterArrayWorkerSource,i()}checkIfReady(t,e,i){i()}setReferrer(t,e){this.referrer=e}spriteLoaded(e,{scope:i,isLoaded:n}){if(this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),this.isSpriteLoaded[e][i]=n,this.workerSources[e]&&this.workerSources[e][i])for(const r in this.workerSources[e][i]){const o=this.workerSources[e][i][r];for(const e in o)o[e]instanceof c&&(o[e].isSpriteLoaded=n,o[e].fire(new t.b("isSpriteLoaded")))}}setImages(t,{scope:e,images:i},n){if(this.availableImages[t]||(this.availableImages[t]={}),this.availableImages[t][e]=i,this.workerSources[t]&&this.workerSources[t][e]){for(const n in this.workerSources[t][e]){const r=this.workerSources[t][e][n];for(const t in r)r[t].availableImages=i}n()}else n()}setProjection(e,i){this.projections[e]=t.bo(i)}setBrightness(t,e,i){this.brightness=e,i()}setLayers(t,e,i){this.getLayerIndex(t,e.scope).replace(e.layers,e.options),i()}updateLayers(t,e,i){this.getLayerIndex(t,e.scope).update(e.layers,e.removedIds,e.options),i()}loadTile(t,e,i){e.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,e.type,e.source,e.scope).loadTile(e,i)}loadDEMTile(t,e,i){this.getDEMWorkerSource(t,e.source,e.scope).loadTile(e,i)}decodeRasterArray(t,e,i){this.getRasterArrayWorkerSource().decodeRasterArray(e,i)}reloadTile(t,e,i){e.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,e.type,e.source,e.scope).reloadTile(e,i)}abortTile(t,e,i){this.getWorkerSource(t,e.type,e.source,e.scope).abortTile(e,i)}removeTile(t,e,i){this.getWorkerSource(t,e.type,e.source,e.scope).removeTile(e,i)}removeSource(t,e,i){if(!(this.workerSources[t]&&this.workerSources[t][e.scope]&&this.workerSources[t][e.scope][e.type]&&this.workerSources[t][e.scope][e.type][e.source]))return;const n=this.workerSources[t][e.scope][e.type][e.source];delete this.workerSources[t][e.scope][e.type][e.source],void 0!==n.removeSource?n.removeSource(e,i):i()}loadWorkerSource(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t.toString())}}syncRTLPluginState(e,i,n){try{t.dT.setState(i);const e=t.dT.getPluginURL();if(t.dT.isLoaded()&&!t.dT.isParsed()&&null!=e){this.self.importScripts(e);const i=t.dT.isParsed();n(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),i)}}catch(t){n(t.toString())}}setDracoUrl(t,e){this.dracoUrl=e}getAvailableImages(t,e){this.availableImages[t]||(this.availableImages[t]={});let i=this.availableImages[t][e];return i||(i=[]),i}getLayerIndex(t,e){this.layerIndexes[t]||(this.layerIndexes[t]={});let i=this.layerIndexes[t][e];return i||(i=this.layerIndexes[t][e]=new r,i.scope=e),i}getWorkerSource(t,e,i,n){if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][n]||(this.workerSources[t][n]={}),this.workerSources[t][n][e]||(this.workerSources[t][n][e]={}),this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),!this.workerSources[t][n][e][i]){const r={send:(e,i,n,r,o,s)=>{this.actor.send(e,i,n,t,o,s)},scheduler:this.actor.scheduler};this.workerSources[t][n][e][i]=new this.workerSourceTypes[e](r,this.getLayerIndex(t,n),this.getAvailableImages(t,n),this.isSpriteLoaded[t][n],void 0,this.brightness)}return this.workerSources[t][n][e][i]}getDEMWorkerSource(t,e,i){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][i]||(this.demWorkerSources[t][i]={}),this.demWorkerSources[t][i][e]||(this.demWorkerSources[t][i][e]=new u),this.demWorkerSources[t][i][e]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new h),this.rasterArrayWorkerSource}enforceCacheSizeLimit(e,i){t.dU(i)}getWorkerPerformanceMetrics(t,e,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Q(self)),Q})),n(0,(function(t){function e(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let n=0;n<t.length;n++)if(!e(t[n],i[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const n in t)if(!e(t[n],i[n]))return!1;return!0}return t===i}var i=n;function n(t){return!function(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,i=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(i);try{e=new Worker(n),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(n),t}()?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var i=e.getImageData(0,0,1,1);return i&&i.width===t.width}()?(void 0===r[e=t&&t.failIfMajorPerformanceCaveat]&&(r[e]=function(t){var e,i=function(t){var e=document.createElement("canvas"),i=Object.create(n.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=t,e.getContext("webgl2",i)}(t);if(!i)return!1;try{e=i.createShader(i.VERTEX_SHADER)}catch(t){return!1}return!(!e||i.isContextLost())&&(i.shaderSource(e,"void main() {}"),i.compileShader(e),!0===i.getShaderParameter(e,i.COMPILE_STATUS))}(e)),r[e]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var e}(t)}var r={};function o(t,e,i){const n=document.createElement(t);return null!=e&&(n.className=e),i&&i.appendChild(n),n}function s(t,e,i){const n=document.createElementNS("http://www.w3.org/2000/svg",t);for(const t of Object.keys(e))n.setAttributeNS(null,t,String(e[t]));return i&&i.appendChild(n),n}n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const a="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,l=a&&void 0!==a.userSelect?"userSelect":"WebkitUserSelect";let c;function u(){a&&l&&(c=a[l],a[l]="none")}function h(){a&&l&&(a[l]=c)}function d(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",d,!0)}function p(){window.addEventListener("click",d,!0),window.setTimeout((()=>{window.removeEventListener("click",d,!0)}),0)}function f(t,e){const i=t.getBoundingClientRect();return _(t,i,e)}function m(t,e){const i=t.getBoundingClientRect(),n=[];for(let r=0;r<e.length;r++)n.push(_(t,i,e[r]));return n}function g(t){return void 0!==window.InstallTrigger&&2===t.button&&t.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function _(e,i,n){const r=e.offsetWidth===i.width?1:e.offsetWidth/i.width;return new t.P((n.clientX-i.left)*r,(n.clientY-i.top)*r)}class y{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,e){this._updatedSourceCaches[t]=e,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const e=t.scope;this._updatedLayers[e]=this._updatedLayers[e]||new Set,this._updatedLayers[e].add(t.id),this.setDirty()}removeLayer(t){const e=t.scope;this._removedLayers[e]=this._removedLayers[e]||{},this._updatedLayers[e]=this._updatedLayers[e]||new Set,this._removedLayers[e][t.id]=t,this._updatedLayers[e].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const e in this._updatedLayers)t[e]=t[e]||{},t[e].updatedIds=Array.from(this._updatedLayers[e].values());for(const e in this._removedLayers)t[e]=t[e]||{},t[e].removedIds=Object.keys(this._removedLayers[e]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class v extends t.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(e,i){return t.l(this.requestManager.transformRequest(i,t.R.Model).url).then((i=>{if(!i)return;const n=t.c(i),r=new t.M(e,void 0,void 0,n);return r.computeBoundsAndApplyParent(),r})).catch((n=>{this.fire(new t.a(new Error(`Could not load model ${e} from ${i}: ${n.message}`)))}))}load(e,i){this.models[i]||(this.models[i]={});const n=Object.keys(e);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+n.length;const r=[];for(const t of n)r.push(this.loadModel(t,e[t]));Promise.allSettled(r).then((e=>{for(let t=0;t<e.length;t++){const{status:r,value:o}=e[t];"fulfilled"===r&&o&&(this.models[i][n[t]]=o)}this.numModelsLoading[i]-=n.length,this.fire(new t.b("data",{dataType:"style"}))})).catch((e=>{this.fire(new t.a(new Error(`Could not load models: ${e.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,e){return!!this.getModel(t,e)}getModel(t,e){return this.models[e]||(this.models[e]={}),this.models[e][t]}addModel(t,e,i){this.models[i]||(this.models[i]={}),this.hasModel(t,i)&&this.removeModel(t,i),this.load({[t]:this.requestManager.normalizeModelURL(e)},i)}addModels(t,e){const i={};for(const e in t)i[e]=this.requestManager.normalizeModelURL(t[e]);this.load(i,e)}removeModel(t,e){this.models[e]||(this.models[e]={});const i=this.models[e][t];delete this.models[e][t],i.destroy()}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,e){this.models[e]||(this.models[e]={});for(const i in this.models[e])this.models[e][i].upload(t.context)}}class x{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,n){const r=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},t.e(this.stateChanges[e][r],n),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==r&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][r]){this.deletedStates[e][r]={};for(const t in this.state[e][r])n[t]||(this.deletedStates[e][r][t]=null)}else for(const t in n)this.deletedStates[e]&&this.deletedStates[e][r]&&null===this.deletedStates[e][r][t]&&delete this.deletedStates[e][r][t]}removeFeatureState(t,e,i){if(null===this.deletedStates[t])return;const n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][n])for(i in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][i]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null}getState(e,i){const n=String(i),r=t.e({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const t=this.deletedStates[e][i];if(null===t)return{};for(const e in t)delete r[e]}return r}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(e,i){const n={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const i={};for(const n in this.stateChanges[e])this.state[e][n]||(this.state[e][n]={}),t.e(this.state[e][n],this.stateChanges[e][n]),i[n]=this.state[e][n];n[e]=i}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const i={};if(null===this.deletedStates[e])for(const t in this.state[e])i[t]={},this.state[e][t]={};else for(const t in this.deletedStates[e]){if(null===this.deletedStates[e][t])this.state[e][t]={};else if(this.state[e][t])for(const i of Object.keys(this.deletedStates[e][t]))delete this.state[e][t][i];i[t]=this.state[e][t]}n[e]=n[e]||{},t.e(n[e],i)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const t in e)e[t].setFeatureState(n,i)}}function b(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class w extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new t.h({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,e){if(this.loaded[e]!==t&&(this.loaded[e]=t,t)){for(const{ids:t,callback:i}of this.requestors)this._notify(t,e,i);this.requestors=[]}}hasImage(t,e){return!!this.getImage(t,e)}getImage(t,e){return this.images[e][t]}addImage(t,e,i){this._validate(t,i)&&(this.images[e][t]=i)}_validate(e,i){let n=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new t.a(new Error(`Image "${e}" has invalid "stretchX" value`))),n=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new t.a(new Error(`Image "${e}" has invalid "stretchY" value`))),n=!1),this._validateContent(i.content,i)||(this.fire(new t.a(new Error(`Image "${e}" has invalid "content" value`))),n=!1),n}_validateStretch(t,e){if(!t)return!0;let i=0;for(const n of t){if(n[0]<i||n[1]<n[0]||e<n[1])return!1;i=n[1]}return!0}_validateContent(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,e,i){i.version=this.images[e][t].version+1,this.images[e][t]=i,this.updatedImages[e][t]=!0}removeImage(t,e){const i=this.images[e][t];delete this.images[e][t],delete this.patterns[e][t],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,e,i){let n=!0;const r=!!this.loaded[e];if(!r)for(const i of t)this.images[e][i]||(n=!1);r||n?this._notify(t,e,i):this.requestors.push({ids:t,scope:e,callback:i})}getUpdatedImages(t){return this.updatedImages[t]}_notify(e,i,n){const r={};for(const n of e){this.images[i][n]||this.fire(new t.b("styleimagemissing",{id:n}));const e=this.images[i][n];e?r[n]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.w(`Image "${n}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,r)}getPixelSize(t){const{width:e,height:i}=this.atlasImage[t];return{width:e,height:i}}getPattern(e,i){const n=this.patterns[i][e],r=this.getImage(e,i);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{const n={w:r.data.width+2,h:r.data.height+2,x:0,y:0},o=new t.I(n,r);this.patterns[i][e]={bin:n,position:o}}return this._updatePatternAtlas(i),this.patterns[i][e].position}bind(e,i){const n=e.gl;let r=this.atlasTexture[i];r?this.dirty&&(r.update(this.atlasImage[i]),this.dirty=!1):(r=new t.T(e,this.atlasImage[i],n.RGBA),this.atlasTexture[i]=r),r.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(e){const i=[];for(const t in this.patterns[e])i.push(this.patterns[e][t].bin);const{w:n,h:r}=t.p(i),o=this.atlasImage[e];o.resize({width:n||1,height:r||1});for(const i in this.patterns[e]){const{bin:n}=this.patterns[e][i],r=n.x+1,s=n.y+1,a=this.images[e][i].data,l=a.width,c=a.height;t.h.copy(a,o,{x:0,y:0},{x:r,y:s},{width:l,height:c}),t.h.copy(a,o,{x:0,y:c-1},{x:r,y:s-1},{width:l,height:1}),t.h.copy(a,o,{x:0,y:0},{x:r,y:s+c},{width:l,height:1}),t.h.copy(a,o,{x:l-1,y:0},{x:r-1,y:s},{width:1,height:c}),t.h.copy(a,o,{x:0,y:0},{x:r+l,y:s},{width:1,height:c})}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,e){for(const i of t){if(this.callbackDispatchedThisFrame[e][i])continue;this.callbackDispatchedThisFrame[e][i]=!0;const t=this.images[e][i];b(t)&&this.updateImage(i,e,t)}}}class E{constructor(t,e,i,n){this.message=(t?`${t}: `:"")+i,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)}}class S extends E{}function T(e){const i=e.key,n=e.value,r=e.valueSpec||{},o=e.objectElementValidators||{},s=e.style,a=e.styleSpec;let l=[];const c=t.i(n);if("object"!==c)return[new E(i,n,`object expected, ${c} found`)];for(const t in n){const e=t.split(".")[0];let c;o[e]?c=o[e]:r[e]?c=$:o["*"]?c=o["*"]:r["*"]&&(c=$),c?l=l.concat(c({key:(i?`${i}.`:i)+t,value:n[t],valueSpec:r[e]||r["*"],style:s,styleSpec:a,object:n,objectKey:t},n)):l.push(new S(i,n[t],`unknown property "${t}"`))}for(const t in r)o[t]||r[t].required&&void 0===r[t].default&&void 0===n[t]&&l.push(new E(i,n,`missing required property "${t}"`));return l}function M(e){const i=e.value,n=e.valueSpec,r=e.style,o=e.styleSpec,s=e.key,a=e.arrayElementValidator||$;if("array"!==t.i(i))return[new E(s,i,`array expected, ${t.i(i)} found`)];if(n.length&&i.length!==n.length)return[new E(s,i,`array length ${n.length} expected, length ${i.length} found`)];if(n["min-length"]&&i.length<n["min-length"])return[new E(s,i,`array length at least ${n["min-length"]} expected, length ${i.length} found`)];let l={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};o.$version<7&&(l.function=n.function),"object"===t.i(n.value)&&(l=n.value);let c=[];for(let t=0;t<i.length;t++)c=c.concat(a({array:i,arrayIndex:t,value:i[t],valueSpec:l,style:r,styleSpec:o,key:`${s}[${t}]`},!0));return c}function I(e){const i=e.key,n=e.value,r=e.valueSpec;let o=t.i(n);if("number"===o&&n!=n&&(o="NaN"),"number"!==o)return[new E(i,n,`number expected, ${o} found`)];if("minimum"in r){let o=r.minimum;if("array"===t.i(r.minimum)&&(o=r.minimum[e.arrayIndex]),n<o)return[new E(i,n,`${n} is less than the minimum value ${o}`)]}if("maximum"in r){let o=r.maximum;if("array"===t.i(r.maximum)&&(o=r.maximum[e.arrayIndex]),n>o)return[new E(i,n,`${n} is greater than the maximum value ${o}`)]}return[]}function C(e){const i=e.valueSpec,n=t.u(e.value.type);let r,o,s,a={};const l="categorical"!==n&&void 0===e.value.property,c=!l,u="array"===t.i(e.value.stops)&&"array"===t.i(e.value.stops[0])&&"object"===t.i(e.value.stops[0][0]),h=T({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===n)return[new E(e.key,e.value,'identity function may not have a "stops" property')];let i=[];const r=e.value;return i=i.concat(M({key:e.key,value:r,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:d})),"array"===t.i(r)&&0===r.length&&i.push(new E(e.key,r,"array must have at least one stop")),i},default:function(t){return $({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===n&&l&&h.push(new E(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||h.push(new E(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!t.s(e.valueSpec)&&h.push(new E(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(c&&!t.k(e.valueSpec)?h.push(new E(e.key,e.value,"property functions not supported")):l&&!t.m(e.valueSpec)&&h.push(new E(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!u||void 0!==e.value.property||h.push(new E(e.key,e.value,'"property" property is required')),h;function d(e){let n=[];const r=e.value,l=e.key;if("array"!==t.i(r))return[new E(l,r,`array expected, ${t.i(r)} found`)];if(2!==r.length)return[new E(l,r,`array length 2 expected, length ${r.length} found`)];if(u){if("object"!==t.i(r[0]))return[new E(l,r,`object expected, ${t.i(r[0])} found`)];if(void 0===r[0].zoom)return[new E(l,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new E(l,r,"object stop key must have value")];const i=t.u(r[0].zoom);if("number"!=typeof i)return[new E(l,r[0].zoom,"stop zoom values must be numbers")];if(s&&s>i)return[new E(l,r[0].zoom,"stop zoom values must appear in ascending order")];i!==s&&(s=i,o=void 0,a={}),n=n.concat(T({key:`${l}[0]`,value:r[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:I,value:p}}))}else n=n.concat(p({key:`${l}[0]`,value:r[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},r));return t.n(t.o(r[1]))?n.concat([new E(`${l}[1]`,r[1],"expressions are not allowed in function stops.")]):n.concat($({key:`${l}[1]`,value:r[1],valueSpec:i,style:e.style,styleSpec:e.styleSpec}))}function p(e,s){const l=t.i(e.value),c=t.u(e.value),u=null!==e.value?e.value:s;if(r){if(l!==r)return[new E(e.key,u,`${l} stop domain type must match previous stop domain type ${r}`)]}else r=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return[new E(e.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==n){let r=`number expected, ${l} found`;return t.k(i)&&void 0===n&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new E(e.key,u,r)]}return"categorical"!==n||"number"!==l||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==n&&"number"===l&&"number"==typeof c&&"number"==typeof o&&void 0!==o&&c<o?[new E(e.key,u,"stop domain values must appear in ascending order")]:(o=c,"categorical"===n&&c in a?[new E(e.key,u,"stop domain values must be unique")]:(a[c]=!0,[])):[new E(e.key,u,`integer expected, found ${String(c)}`)]}}function A(e){const i=("property"===e.expressionContext?t.q:t.r)(t.o(e.value),e.valueSpec);if("error"===i.result)return i.value.map((t=>new E(`${e.key}${t.key}`,e.value,t.message)));const n=i.value.expression||i.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new E(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!t.t(n))return[new E(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return P(n,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!t.v(n,["zoom","feature-state"]))return[new E(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!t.x(n))return[new E(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function P(e,i){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const t of i.valueSpec.expression.parameters)n.delete(t);if(0===n.size)return[];const r=[];return e instanceof t.C&&n.has(e.name)?[new E(i.key,i.value,`["${e.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(e.eachChild((t=>{r.push(...P(t,i))})),r)}function L(e){const i=e.key,n=e.value,r=e.valueSpec,o=[];return Array.isArray(r.values)?-1===r.values.indexOf(t.u(n))&&o.push(new E(i,n,`expected one of [${r.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(r.values).indexOf(t.u(n))&&o.push(new E(i,n,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(n)} found`)),o}function R(e){return t.z(t.o(e.value))?A(t.j({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):D(e)}function D(e){const i=e.value,n=e.key;if("array"!==t.i(i))return[new E(n,i,`array expected, ${t.i(i)} found`)];const r=e.styleSpec;let o,s=[];if(i.length<1)return[new E(n,i,"filter array must have at least 1 element")];switch(s=s.concat(L({key:`${n}[0]`,value:i[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec})),t.u(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===t.u(i[1])&&s.push(new E(n,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&s.push(new E(n,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(o=t.i(i[1]),"string"!==o&&s.push(new E(`${n}[1]`,i[1],`string expected, ${o} found`)));for(let a=2;a<i.length;a++)o=t.i(i[a]),"$type"===t.u(i[1])?s=s.concat(L({key:`${n}[${a}]`,value:i[a],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==o&&"number"!==o&&"boolean"!==o&&s.push(new E(`${n}[${a}]`,i[a],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let t=1;t<i.length;t++)s=s.concat(D({key:`${n}[${t}]`,value:i[t],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":o=t.i(i[1]),2!==i.length?s.push(new E(n,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==o&&s.push(new E(`${n}[1]`,i[1],`string expected, ${o} found`))}return s}function k(e,i){const n=e.key,r=e.style,o=e.layer,s=e.styleSpec,a=e.value,l=e.objectKey,c=s[`${i}_${e.layerType}`];if(!c)return[];const u=l.match(/^(.*)-transition$/);if("paint"===i&&u&&c[u[1]]&&c[u[1]].transition)return $({key:n,value:a,valueSpec:s.transition,style:r,styleSpec:s});const h=e.valueSpec||c[l];if(!h)return[new S(n,a,`unknown property "${l}"`)];let d;if("string"===t.i(a)&&t.k(h)&&!h.tokens&&(d=/^{([^}]+)}$/.exec(a))){const t=`\`{ "type": "identity", "property": ${d?JSON.stringify(d[1]):'"_"'} }\``;return[new E(n,a,`"${l}" does not support interpolation syntax\nUse an identity property function instead: ${t}.`)]}const p=[];if("symbol"===e.layerType)"text-field"!==l||!r||r.glyphs||r.imports||p.push(new E(n,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&t.A(t.o(a))&&"identity"===t.u(a.type)&&p.push(new E(n,a,'"text-font" does not support identity functions'));else if("model"===e.layerType&&"paint"===i&&o&&o.layout&&o.layout.hasOwnProperty("model-id")&&t.k(h)&&(t.B(h)||t.m(h))){const e=t.q(t.o(a),h),i=e.value.expression||e.value._styleExpression.expression;i&&!t.v(i,["measure-light"])&&("model-emissive-strength"===l&&t.x(i)&&t.t(i)||p.push(new E(n,a,`${l} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return p.concat($({key:e.key,value:a,valueSpec:h,style:r,styleSpec:s,expressionContext:"property",propertyType:i,propertyKey:l}))}function N(t){return k(t,"paint")}function O(t){return k(t,"layout")}function F(e){let i=[];const n=e.value,r=e.key,o=e.style,s=e.styleSpec;n.type||n.ref||i.push(new E(r,n,'either "type" or "ref" is required'));let a=t.u(n.type);const l=t.u(n.ref);if(n.id){const s=t.u(n.id);for(let a=0;a<e.arrayIndex;a++){const e=o.layers[a];t.u(e.id)===s&&i.push(new E(r,n.id,`duplicate layer id "${n.id}", previously used at line ${e.id.__line__}`))}}if("ref"in n){let e;["type","source","source-layer","filter","layout"].forEach((t=>{t in n&&i.push(new E(r,n[t],`"${t}" is prohibited for ref layers`))})),o.layers.forEach((i=>{t.u(i.id)===l&&(e=i)})),e?e.ref?i.push(new E(r,n.ref,"ref cannot reference another ref layer")):a=t.u(e.type):"string"==typeof l&&i.push(new E(r,n.ref,`ref layer "${l}" not found`))}else if("background"!==a&&"sky"!==a&&"slot"!==a)if(n.source){const e=o.sources&&o.sources[n.source],s=e&&t.u(e.type);e?"vector"===s&&"raster"===a?i.push(new E(r,n.source,`layer "${n.id}" requires a raster source`)):"raster"===s&&"raster"!==a?i.push(new E(r,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==s||n["source-layer"]?"raster-dem"===s&&"hillshade"!==a?i.push(new E(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==s||["raster","raster-particle"].includes(a)?"line"!==a||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===s&&e.lineMetrics?"raster-particle"===a&&"raster-array"!==s&&i.push(new E(r,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):i.push(new E(r,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new E(r,n.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new E(r,n,`layer "${n.id}" must specify a "source-layer"`)):i.push(new E(r,n.source,`source "${n.source}" not found`))}else i.push(new E(r,n,'missing required property "source"'));return i=i.concat(T({key:r,value:n,valueSpec:s.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$({key:`${r}.type`,value:n.type,valueSpec:s.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"}),filter:e=>R(t.j({layerType:a},e)),layout:e=>T({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>O(t.j({layerType:a},e))}}),paint:e=>T({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>N(t.j({layerType:a,layer:n},e))}})}})),i}function z(e){const i=e.value,n=e.key,r=t.i(i);return"string"!==r?[new E(n,i,`string expected, ${r} found`)]:[]}const B={promoteId:function({key:e,value:i}){if("string"===t.i(i))return z({key:e,value:i});{const t=[];for(const n in i)t.push(...z({key:`${e}.${n}`,value:i[n]}));return t}}};function U(e){const i=e.value,n=e.key,r=e.styleSpec,o=e.style;if(!i.type)return[new E(n,i,'"type" is required')];const s=t.u(i.type);let a=[];switch(["vector","raster","raster-dem","raster-array"].includes(s)&&(i.url||i.tiles||a.push(new S(n,i,'Either "url" or "tiles" is required.'))),s){case"vector":case"raster":case"raster-dem":case"raster-array":return a=a.concat(T({key:n,value:i,valueSpec:r[`source_${s.replace("-","_")}`],style:e.style,styleSpec:r,objectElementValidators:B})),a;case"geojson":if(a=T({key:n,value:i,valueSpec:r.source_geojson,style:o,styleSpec:r,objectElementValidators:B}),i.cluster)for(const t in i.clusterProperties){const[e,r]=i.clusterProperties[t],o="string"==typeof e?[e,["accumulated"],["get",t]]:e;a.push(...A({key:`${n}.${t}.map`,value:r,expressionContext:"cluster-map"})),a.push(...A({key:`${n}.${t}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return a;case"video":return T({key:n,value:i,valueSpec:r.source_video,style:o,styleSpec:r});case"image":return T({key:n,value:i,valueSpec:r.source_image,style:o,styleSpec:r});case"canvas":return[new E(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return L({key:`${n}.type`,value:i.type,valueSpec:{values:V(r)},style:o,styleSpec:r})}}function V(t){return t.source.reduce(((e,i)=>{const n=t[i];return"enum"===n.type.type&&(e=e.concat(Object.keys(n.type.values))),e}),[])}function j(e){const i=e.value;let n=[];if(!i)return n;const r=t.i(i);return"string"!==r?(n=n.concat([new E(e.key,i,`string expected, "${r}" found`)]),n):(function(t){const e=-1===t.indexOf("://");try{return new URL(t,e?"http://example.com":void 0),!0}catch(t){return!1}}(i)||(n=n.concat([new E(e.key,i,`invalid url "${i}"`)])),n)}function G(e){const i=e.value,n=e.styleSpec,r=n.light,o=e.style;let s=[];const a=t.i(i);if(void 0===i)return s;if("object"!==a)return s=s.concat([new E("light",i,`object expected, ${a} found`)]),s;for(const t in i){const e=t.match(/^(.*)-transition$/);s=s.concat(e&&r[e[1]]&&r[e[1]].transition?$({key:t,value:i[t],valueSpec:n.transition,style:o,styleSpec:n}):r[t]?$({key:t,value:i[t],valueSpec:r[t],style:o,styleSpec:n}):[new E(t,i[t],`unknown property "${t}"`)])}return s}function H(e){const i=e.value;let n=[];if(!i)return n;const r=t.i(i);if("object"!==r)return n=n.concat([new E("light-3d",i,`object expected, ${r} found`)]),n;const o=e.styleSpec,s=o["light-3d"],a=e.key,l=e.style,c=e.style.lights;for(const t of["type","id"])if(!(t in i))return n=n.concat([new E("light-3d",i,`missing property ${t} on light`)]),n;if(i.type&&c)for(let r=0;r<e.arrayIndex;r++){const e=t.u(i.type),o=c[r];t.u(o.type)===e&&n.push(new E(a,i.id,`duplicate light type "${i.type}", previously defined at line ${o.id.__line__}`))}const u=`properties_light_${i.type}`;if(!(u in o))return n=n.concat([new E("light-3d",i,`Invalid light type ${i.type}`)]),n;const h=o[u];for(const r in i)if("properties"===r){const s=i[r],a=t.i(s);if("object"!==a)return n=n.concat([new E("properties",s,`object expected, ${a} found`)]),n;for(const t in s)n=n.concat(h[t]?$({key:t,value:s[t],valueSpec:h[t],style:l,styleSpec:o}):[new S(e.key,s[t],`unknown property "${t}"`)])}else{const t=r.match(/^(.*)-transition$/);n=n.concat(t&&s[t[1]]&&s[t[1]].transition?$({key:r,value:i[r],valueSpec:o.transition,style:l,styleSpec:o}):s[r]?$({key:r,value:i[r],valueSpec:s[r],style:l,styleSpec:o}):[new S(r,i[r],`unknown property "${r}"`)])}return n}function W(e){const i=e.value,n=e.key,r=e.style,o=e.styleSpec,s=o.terrain;let a=[];const l=t.i(i);if(void 0===i)return a;if("null"===l)return a;if("object"!==l)return a=a.concat([new E("terrain",i,`object expected, ${l} found`)]),a;for(const t in i){const e=t.match(/^(.*)-transition$/);a=a.concat(e&&s[e[1]]&&s[e[1]].transition?$({key:t,value:i[t],valueSpec:o.transition,style:r,styleSpec:o}):s[t]?$({key:t,value:i[t],valueSpec:s[t],style:r,styleSpec:o}):[new S(t,i[t],`unknown property "${t}"`)])}if(i.source){const e=r.sources&&r.sources[i.source],o=e&&t.u(e.type);e?"raster-dem"!==o&&a.push(new E(n,i.source,`terrain cannot be used with a source of type ${String(o)}, it only be used with a "raster-dem" source type`)):a.push(new E(n,i.source,`source "${i.source}" not found`))}else a.push(new E(n,i,'terrain is missing required property "source"'));return a}function q(e){const i=e.value,n=e.style,r=e.styleSpec,o=r.fog;let s=[];const a=t.i(i);if(void 0===i)return s;if("object"!==a)return s=s.concat([new E("fog",i,`object expected, ${a} found`)]),s;for(const t in i){const e=t.match(/^(.*)-transition$/);s=s.concat(e&&o[e[1]]&&o[e[1]].transition?$({key:t,value:i[t],valueSpec:r.transition,style:n,styleSpec:r}):o[t]?$({key:t,value:i[t],valueSpec:o[t],style:n,styleSpec:r}):[new S(t,i[t],`unknown property "${t}"`)])}return s}const X={"*":()=>[],array:M,boolean:function(e){const i=e.value,n=e.key,r=t.i(i);return"boolean"!==r?[new E(n,i,`boolean expected, ${r} found`)]:[]},number:I,color:function(e){const i=e.key,n=e.value,r=t.i(n);return"string"!==r?[new E(i,n,`color expected, ${r} found`)]:null===t.y(n)?[new E(i,n,`color expected, "${n}" found`)]:[]},enum:L,filter:R,function:C,layer:F,object:T,source:U,model:j,light:G,"light-3d":H,terrain:W,fog:q,string:z,formatted:function(t){return 0===z(t).length?[]:A(t)},resolvedImage:function(t){return 0===z(t).length?[]:A(t)},projection:function(e){const i=e.value,n=e.styleSpec,r=n.projection,o=e.style;let s=[];const a=t.i(i);if("object"===a)for(const t in i)s=s.concat($({key:t,value:i[t],valueSpec:r[t],style:o,styleSpec:n}));else"string"!==a&&(s=s.concat([new E("projection",i,`object or string expected, ${a} found`)]));return s},import:function(e){const{value:i,styleSpec:n}=e,{data:r,...o}=i;Object.defineProperty(o,"__line__",{value:i.__line__,enumerable:!1});let s=T(t.j({},e,{value:o,valueSpec:n.import}));return""===t.u(o.id)&&s.push(new E(`${e.key}.id`,o,"import id can't be an empty string")),r&&(s=s.concat(Z(r,n,{key:`${e.key}.data`}))),s}};function $(e,i=!1){const n=e.value,r=e.valueSpec,o=e.styleSpec;if(r.expression&&t.A(t.u(n)))return C(e);if(r.expression&&t.n(t.o(n)))return A(e);if(r.type&&X[r.type]){const n=X[r.type](e);return!0===i&&n.length>0&&"array"===t.i(e.value)?A(e):n}return T(t.j({},e,{valueSpec:r.type?o[r.type]:r}))}function Y(t){const e=t.value,i=t.key,n=z(t);return n.length||(-1===e.indexOf("{fontstack}")&&n.push(new E(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new E(i,e,'"glyphs" url must include a "{range}" token'))),n}function Z(e,i=t.D,n={}){return $({key:n.key||"",value:e,valueSpec:i.$root,styleSpec:i,style:e,objectElementValidators:{glyphs:Y,"*":()=>[]}})}function K(e,i=t.D){return lt(Z(e,i))}const J=t=>lt(U(t)),Q=t=>lt(G(t)),tt=t=>lt(H(t)),et=t=>lt(W(t)),it=t=>lt(q(t)),nt=t=>lt(F(t)),rt=t=>lt(R(t)),ot=t=>lt(N(t)),st=t=>lt(O(t)),at=t=>lt(j(t));function lt(t){return t.slice().sort(((t,e)=>t.line&&e.line?t.line-e.line:0))}function ct(e,i){let n=!1;if(i&&i.length)for(const r of i)r instanceof S?t.w(r.message):(e.fire(new t.a(new Error(r.message))),n=!0);return n}const ut=new t.F({anchor:new t.G(t.D.light.anchor),position:new t.H(t.D.light.position),color:new t.G(t.D.light.color),intensity:new t.G(t.D.light.intensity)});class ht extends t.E{constructor(e,i="flat"){super(),this._transitionable=new t.J(ut),this.setLight(e,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,e,i={}){this._validate(Q,t,i)||(this._transitionable.setTransitionOrValue(t),this.id=e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,n){return(!n||!1!==n.validate)&&ct(this,e.call(K,t.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.D})))}}const dt=new t.F({source:new t.G(t.D.terrain.source),exaggeration:new t.G(t.D.terrain.exaggeration)});let pt=class extends t.E{constructor(e,i,n,r){super(),this.scope=n,this._transitionable=new t.J(dt,n,r),this._transitionable.setTransitionOrValue(e,r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(t,e){this._transitionable.setTransitionOrValue(t,e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new t.K(e)).get("exaggeration")}isZoomDependent(){const e=this._transitionable._values.exaggeration;return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof t.Z}};const ft=45,mt=65,gt=.05;function _t(e,i,n,r){const o=t.O(ft,mt,n),[s,a]=yt(e,r);let l=1-Math.min(1,Math.exp((i-s)/(a-s)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*o*e.alpha}function yt(t,e){const i=.5/Math.tan(.5*e);return[t.range[0]+i,t.range[1]+i]}function vt(e,i,n,r,o){const s=t.N.transformMat4([],[i,n,r],o.mercatorFogMatrix);return _t(e,t.N.length(s),o.pitch,o._fov)}function xt(e,i,n,r,o,s,a){const l=[[n,r,0],[o,r,0],[o,s,0],[n,s,0]];let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(const e of l){const n=t.N.transformMat4([],e,i),r=t.N.length(n);c=Math.min(c,r),u=Math.max(u,r)}return[_t(e,c,a.pitch,a._fov),_t(e,u,a.pitch,a._fov)]}const bt=new t.F({range:new t.G(t.D.fog.range),color:new t.G(t.D.fog.color),"high-color":new t.G(t.D.fog["high-color"]),"space-color":new t.G(t.D.fog["space-color"]),"horizon-blend":new t.G(t.D.fog["horizon-blend"]),"star-intensity":new t.G(t.D.fog["star-intensity"]),"vertical-range":new t.G(t.D.fog["vertical-range"])});class wt extends t.E{constructor(e,i,n,r){super(),this._transitionable=new t.J(bt,n,new Map(r)),this.set(e,r),this._transitioning=this._transitionable.untransitioned(),this._transform=i,this.properties=new t.Q(bt)}get state(){const e=this._transform,i="globe"===e.projection.name,n=t.S(e.zoom),r=this.properties.get("range"),o=[.5,3];return{range:i?[t.U(o[0],r[0],n),t.U(o[1],r[1],n)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,i,n={}){if(this._validate(it,e,n))return;const r=t.e({},e);for(const e of Object.keys(t.D.fog))void 0===r[e]&&(r[e]=t.D.fog[e].default);this._options=r,this._transitionable.setTransitionOrValue(this._options,i)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:t.O(ft,mt,e))*i.a}getOpacityAtLatLng(e,i){return this._transform.projection.supportsFog?function(e,i,n){const r=t.L.fromLngLat(i),o=n.elevation?n.elevation.getAtPointOrZero(r):0;return vt(e,r.x,r.y,o,n)}(this.state,e,i):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];const i=this._transform.calculateFogTileMatrix(e.toUnwrapped());return xt(this.state,i,0,0,t.V,t.V,this._transform)}getOpacityForBounds(t,e,i,n,r){return this._transform.projection.supportsFog?xt(this.state,t,e,i,n,r,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?yt(this.state,t):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;const i=[4,5,6,7];for(const n of i){const i=e.points[n];let r;if(i[2]>=0)r=i;else{const o=e.points[n-4];r=t.W(o,i,o[2]/(o[2]-i[2]))}if(vt(this.state,r[0],r[1],0,this._transform)>=gt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,n){return(!n||!1!==n.validate)&&ct(this,e.call(K,t.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.D})))}}class Et extends t.E{constructor(e,i,n,r){super(),this.scope=n,this._options=e,this.properties=new t.Q(i),this._transitionable=new t.J(i,n,new Map(r)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,e){this._options=t,this._transitionable.setTransitionOrValue(t.properties,e)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const St=new t.F({color:new t.G(t.D.properties_light_ambient.color),intensity:new t.G(t.D.properties_light_ambient.intensity)}),Tt=new t.F({direction:new t.X(t.D.properties_light_directional.direction),color:new t.G(t.D.properties_light_directional.color),intensity:new t.G(t.D.properties_light_directional.intensity),"cast-shadows":new t.G(t.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new t.G(t.D.properties_light_directional["shadow-intensity"])});class Mt{constructor(t,e,i,n){this.screenBounds=t,this.cameraPoint=e,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(e,i){let n,r;if(e instanceof t.P||"number"==typeof e[0]){const o=t.P.convert(e);n=[o],r=i.isPointAboveHorizon(o)}else{const o=t.P.convert(e[0]),s=t.P.convert(e[1]);n=[o,s],r=t.Y(o,s).every((t=>i.isPointAboveHorizon(t)))}return new Mt(n,i.getCameraPoint(),r,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return t.Y(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],r=t.Y(i,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<n.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?r[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(r[3]=this.cameraPoint)),t._(r,e)}bufferedCameraGeometryGlobe(e){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],r=t.Y(i,n,e),o=this.cameraPoint.clone();switch(3*((o.y>i.y)+(o.y>n.y))+((o.x>i.x)+(o.x>n.x))){case 0:r[0]=o,r[4]=o.clone();break;case 1:r.splice(1,0,o);break;case 2:r[1]=o;break;case 3:r.splice(4,0,o);break;case 5:r.splice(2,0,o);break;case 6:r[3]=o;break;case 7:r.splice(3,0,o);break;case 8:r[2]=o}return r}containsTile(e,i,n,r=0){const o=e.queryPadding/i._pixelsPerMercatorPixel+1,s=n?this._bufferedCameraMercator(o,i):this._bufferedScreenMercator(o,i);let a=e.tileID.wrap+(s.unwrapped?r:0);const l=s.polygon.map((i=>t.$(e.tileTransform,i,a)));if(!t.a0(l,0,0,t.V,t.V))return;a=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);const c=this.screenGeometryMercator.polygon.map((i=>t.a1(e.tileTransform,i,a))),u=c.map((e=>new t.P(e[0],e[1]))),h=i.getFreeCameraOptions().position||new t.L(0,0,0),d=t.a1(e.tileTransform,h,a),p=c.map((e=>{const i=t.N.sub(e,e,d);return t.N.normalize(i,i),new t.a2(d,i)})),f=t.a3(e,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=t.a4(l),m.min.x=t.aa(m.min.x,0,t.V),m.min.y=t.aa(m.min.y,0,t.V),m.max.x=t.aa(m.max.x,0,t.V),m.max.y=t.aa(m.max.y,0,t.V),m),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:f};var m}_bufferedScreenMercator(t,e){const i=At(t);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let n;return n="globe"===e.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),e):{polygon:this.bufferedScreenGeometry(t).map((t=>e.pointCoordinate3D(t))),unwrapped:!0},this._screenRaycastCache[i]=n,n}}_bufferedCameraMercator(t,e){const i=At(t);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let n;return n="globe"===e.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),e):{polygon:this.bufferedCameraGeometry(t).map((t=>e.pointCoordinate3D(t))),unwrapped:!0},this._cameraRaycastCache[i]=n,n}}_projectAndResample(e,i){const n=function(e,i){const n=t.a6.multiply([],i.pixelMatrix,i.globeMatrix),r=[0,-t.ab,0,1],o=[0,t.ab,0,1],s=[0,0,0,1];t.a7.transformMat4(r,r,n),t.a7.transformMat4(o,o,n),t.a7.transformMat4(s,s,n);const a=new t.P(r[0]/r[3],r[1]/r[3]),l=new t.P(o[0]/o[3],o[1]/o[3]),c=t.a8(e,a)&&r[3]<s[3],u=t.a8(e,l)&&o[3]<s[3];if(!c&&!u)return null;const h=function(t,e,i){for(let n=1;n<t.length;n++){const r=Ct(e.pointCoordinate3D(t[n-1]).x),o=Ct(e.pointCoordinate3D(t[n]).x);if(i<0){if(r<o)return{idx:n,t:-r/(o-1-r)}}else if(o<r)return{idx:n,t:(1-r)/(o+1-r)}}return null}(e,i,c?-1:1);if(!h)return null;const{idx:d,t:p}=h;let f=d>1?It(e.slice(0,d),i):[],m=d<e.length?It(e.slice(d),i):[];f=f.map((e=>new t.P(Ct(e.x),e.y))),m=m.map((e=>new t.P(Ct(e.x),e.y)));const g=[...f];0===g.length&&g.push(m[m.length-1]);const _=t.U(g[g.length-1].y,(0===m.length?f[0]:m[0]).y,p);let y;return y=c?[new t.P(0,_),new t.P(0,0),new t.P(1,0),new t.P(1,_)]:[new t.P(1,_),new t.P(1,1),new t.P(0,1),new t.P(0,_)],g.push(...y),0===m.length?g.push(f[0]):g.push(...m),{polygon:g.map((e=>new t.L(e.x,e.y))),unwrapped:!1}}(e,i);if(n)return n;const r=function(e,i){let n=!1,r=-1/0,o=0;for(let t=0;t<e.length-1;t++)e[t].x>r&&(r=e[t].x,o=t);for(let t=0;t<e.length-1;t++){const i=(o+t)%(e.length-1),r=e[i],s=e[i+1];Math.abs(r.x-s.x)>.5&&(r.x<s.x?(r.x+=1,0===i&&(e[e.length-1].x+=1)):(s.x+=1,i+1===e.length-1&&(e[0].x+=1)),n=!0)}const s=t.a5(i.center.lng);return n&&s<Math.abs(s-1)&&e.forEach((t=>{t.x-=1})),{polygon:e,unwrapped:n}}(It(e,i).map((e=>new t.P(Ct(e.x),e.y))),i);return{polygon:r.polygon.map((e=>new t.L(e.x,e.y))),unwrapped:r.unwrapped}}}function It(e,i){return t.a9(e,(t=>{const e=i.pointCoordinate3D(t);t.x=e.x,t.y=e.y}),1/256)}function Ct(t){return t<0?1+t%1:t%1}function At(t){return 100*t|0}function Pt(e,i,n,r,o){const s=function(n,r){if(n)return o(n);if(r){e.url&&r.tiles&&e.tiles&&delete e.tiles;const n=t.ac(t.e(r,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);r.vector_layers&&(n.vectorLayers=r.vector_layers,n.vectorLayerIds=n.vectorLayers.map((t=>t.id))),r.raster_layers&&(n.rasterLayers=r.raster_layers,n.rasterLayerIds=n.rasterLayers.map((t=>t.id))),n.tiles=i.canonicalizeTileset(n,e.url),o(null,n)}};return e.url?t.g(i.transformRequest(i.normalizeSourceURL(e.url,null,n,r),t.R.Source),s):t.f.frame((()=>s(null,e)))}class Lt{constructor(e,i,n){this.bounds=t.ad.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=n||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),n=Math.floor(t.a5(this.bounds.getWest())*i),r=Math.floor(t.ae(this.bounds.getNorth())*i),o=Math.ceil(t.a5(this.bounds.getEast())*i),s=Math.ceil(t.ae(this.bounds.getSouth())*i);return e.x>=n&&e.x<o&&e.y>=r&&e.y<s}}class Rt extends t.E{constructor(e,i,n,r){if(super(),this.id=e,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.e(this,t.ac(i,["url","scheme","tileSize","promoteId"])),this._options=t.e({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new t.af}load(e){this._loaded=!1,this.fire(new t.b("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=Pt(this._options,this.map._requestManager,i,n,((r,o)=>{this._tileJSONRequest=null,this._loaded=!0,r?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new t.a(r))):o&&(t.e(this,o),o.bounds&&(this.tileBounds=new Lt(o.bounds,this.minzoom,this.maxzoom)),t.aj(o.tiles,this.map._requestManager._customAccessToken),this.fire(new t.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.b("data",{dataType:"source",sourceDataType:"content"}))),e&&e(r)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const e=t.ag(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return t.e({},this._options)}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(n,t.R.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:t.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster};if(r.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=i:e.request=e.actor.send("reloadTile",r,o.bind(this));else if(e.actor=this._tileWorkers[n]=this._tileWorkers[n]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",r,o.bind(this),void 0,!0);else{const i=t.ah.call({deduped:this._deduped},r,((t,i)=>{t||!i?o.call(this,t):(r.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},e.actor&&e.actor.send("loadTile",r,o.bind(this),void 0,!0))}),!0);e.request={cancel:i}}function o(n,r){return delete e.request,e.aborted?i(null):n&&404!==n.status?i(n):(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),t.ai(this.dispatcher),i(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Dt extends t.E{constructor(e,i,n,r){super(),this.id=e,this.dispatcher=n,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.e({type:"raster"},i),t.e(this,t.ac(i,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new t.b("dataloading",{dataType:"source"})),this._tileJSONRequest=Pt(this._options,this.map._requestManager,null,null,((i,n)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new t.a(i)):n&&(t.e(this,n),n.bounds&&(this.tileBounds=new Lt(n.bounds,this.minzoom,this.maxzoom)),t.aj(n.tiles),this.fire(new t.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.b("data",{dataType:"source",sourceDataType:"content"}))),e&&e(i)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const e=t.ag(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return t.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,i){const n=t.f.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);e.request=t.d(this.map._requestManager.transformRequest(r,t.R.Tile),((n,r,o,s)=>(delete e.request,e.aborted?(e.state="unloaded",i(null)):n?(e.state="errored",i(n)):r?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:o,expires:s}),e.setTexture(r,this.map.painter),e.state="loaded",t.ai(this.dispatcher),void i(null)):i(null))))}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e()}unloadTile(e,i){e.texture&&e.texture instanceof t.T?(e.destroy(!0),e.texture&&e.texture instanceof t.T&&this.map.painter.saveTileTexture(e.texture)):e.destroy(),i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class kt extends Dt{constructor(e,i,n,r){super(e,i,n,r),this.type="raster-array",this.maxzoom=22,this._options=t.e({type:"raster-array"},i)}triggerRepaint(t){const e=this.map.painter._terrain,i=this.map.style.getSourceCache(this.id);e&&e.enabled&&i&&e._clearRenderCacheForTile(i.id,t.tileID),this.map.triggerRepaint()}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),r=this.map._requestManager.transformRequest(n,t.R.Tile);e.requestParams=r,e.actor||(e.actor=this.dispatcher.getActor()),e.request=e.fetchHeader(void 0,((t,n,r,o)=>{if(delete e.request,e.aborted)return e.state="unloaded",i(null);if(t){if(20===t.code)return;return e.state="errored",i(t)}this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:r,expires:o}),e.state="empty",i(null)}))}unloadTile(e){const i=e.texture;i&&i instanceof t.T?(e.destroy(!0),this.map.painter.saveTileTexture(i)):(e.destroy(),e.flushQueues(),e._isHeaderLoaded=!1,delete e._mrt,delete e.textureDescriptor),e.fbo&&(e.fbo.destroy(),delete e.fbo),delete e.request,delete e.requestParams,delete e.neighboringTiles,e.state="unloaded"}prepareTile(e,i,n){e._isHeaderLoaded&&("empty"!==e.state&&(e.state="reloading"),e.fetchBand(i,n,((i,n)=>{if(i)return e.state="errored",this.fire(new t.a(i)),void this.triggerRepaint(e);n&&(e.setTexture(n,this.map.painter),e.state="loaded",this.triggerRepaint(e))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const e=this.rasterLayers.find((({id:e})=>e===t)),i=e&&e.fields,n=i&&i.bands&&i.bands;return n?n[0]:0}getTextureDescriptor(e,i,n){if(!e)return;const r=i.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!r)return;let o=null;i instanceof t.an?o=i.paint.get("raster-array-band"):i instanceof t.ao&&(o=i.paint.get("raster-particle-array-band"));const s=o||this.getInitialBand(r);if(null!=s)if(e.textureDescriptor){if(!e.updateNeeded(r,s)||n)return Object.assign({},e.textureDescriptor,{texture:e.texture})}else this.prepareTile(e,r,s)}}const Nt=32,Ot=33,Ft=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,n=0,r=0,o=0,s=0,a=0;for(1&e?r=o=s=Nt:i=n=a=Nt;(e>>=1)>1;){const t=i+r>>1,l=n+o>>1;1&e?(r=i,o=n,i=s,n=a):(i=r,n=o,r=s,o=a),s=t,a=l}const l=4*t;Ft[l+0]=i,Ft[l+1]=n,Ft[l+2]=r,Ft[l+3]=o}const zt=new Uint16Array(2178),Bt=new Uint8Array(1089),Ut=new Uint16Array(1089);function Vt(t){return 0===t?-.03125:32===t?.03125:0}class jt{constructor(t,e,i,n){this.id=jt.uniqueIdxCounter,jt.uniqueIdxCounter++,this.context=t;const r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||n||e.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=jt.uniqueIdxCounter,jt.uniqueIdxCounter++;const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}jt.uniqueIdxCounter=0;const Gt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ht{constructor(t,e,i,n,r,o){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.instanceCount=o,this.context=t;const s=t.gl;this.buffer=s.createBuffer(),t.bindVertexBuffer.set(this.buffer),s.bufferData(s.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||r||e.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let i=0;i<this.attributes.length;i++){const n=e.attributes[this.attributes[i].name];void 0!==n&&t.enableVertexAttribArray(n)}}setVertexAttribPointers(t,e,i){for(let n=0;n<this.attributes.length;n++){const r=this.attributes[n],o=e.attributes[r.name];void 0!==o&&t.vertexAttribPointer(o,r.components,t[Gt[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0))}}setVertexAttribDivisor(t,e,i){for(let n=0;n<this.attributes.length;n++){const r=e.attributes[this.attributes[n].name];void 0!==r&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(r,i)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Wt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qt extends Wt{getDefault(){return t.ax.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Xt extends Wt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class $t extends Wt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Yt extends Wt{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Zt extends Wt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Kt extends Wt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Jt extends Wt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Qt extends Wt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class te extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class ee extends Wt{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ie extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class ne extends Wt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class re extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class oe extends Wt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class se extends Wt{getDefault(){return t.ax.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ae extends Wt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class le extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class ce extends Wt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ue extends Wt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let he=class extends Wt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}};class de extends Wt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class pe extends Wt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class fe extends Wt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class me extends Wt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ge extends Wt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class _e extends Wt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ye extends Wt{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ve extends Wt{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class xe extends Wt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class be extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class we extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ee extends Wt{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class Se extends Ee{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Te extends Ee{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,this.attachment(),e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Me extends Ee{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,this.attachment(),e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ie extends Te{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ce{constructor(t,e,i,n,r){this.context=t,this.width=e,this.height=i;const o=this.framebuffer=t.gl.createFramebuffer();n&&(this.colorAttachment=new Se(t,o)),r&&(this.depthAttachmentType=r,this.depthAttachment="renderbuffer"===r?new Te(t,o):new Me(t,o))}destroy(){const t=this.context.gl;if(this.colorAttachment){const e=this.colorAttachment.get();e&&t.deleteTexture(e)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}else{const e=this.depthAttachment.get();e&&t.deleteTexture(e)}t.deleteFramebuffer(this.framebuffer)}}class Ae{constructor(t,e,i){this.func=t,this.mask=e,this.range=i}}Ae.ReadOnly=!1,Ae.ReadWrite=!0,Ae.disabled=new Ae(519,Ae.ReadOnly,[0,1]);const Pe=7680;class Le{constructor(t,e,i,n,r,o){this.test=t,this.ref=e,this.mask=i,this.fail=n,this.depthFail=r,this.pass=o}}Le.disabled=new Le({func:519,mask:0},0,0,Pe,Pe,Pe);const Re=771;class De{constructor(t,e,i,n){this.blendFunction=t,this.blendColor=e,this.mask=i,this.blendEquation=n}}De.Replace=[1,0,1,0],De.disabled=new De(De.Replace,t.ax.transparent,[!1,!1,!1,!1]),De.unblended=new De(De.Replace,t.ax.transparent,[!0,!0,!0,!0]),De.alphaBlended=new De([1,Re,1,Re],t.ax.transparent,[!0,!0,!0,!0]),De.multiply=new De([774,0,774,0],t.ax.transparent,[!0,!0,!0,!0]);const ke=1029,Ne=2305;class Oe{constructor(t,e,i){this.enable=t,this.mode=e,this.frontFace=i}}Oe.disabled=new Oe(!1,ke,Ne),Oe.backCCW=new Oe(!0,ke,Ne),Oe.backCW=new Oe(!0,ke,2304),Oe.frontCW=new Oe(!0,1028,2304),Oe.frontCCW=new Oe(!0,1028,Ne);class Fe{constructor(t,e){this.gl=t,this.clearColor=new qt(this),this.clearDepth=new Xt(this),this.clearStencil=new $t(this),this.colorMask=new Yt(this),this.depthMask=new Zt(this),this.stencilMask=new Kt(this),this.stencilFunc=new Jt(this),this.stencilOp=new Qt(this),this.stencilTest=new te(this),this.depthRange=new ee(this),this.depthTest=new ie(this),this.depthFunc=new ne(this),this.blend=new re(this),this.blendFunc=new oe(this),this.blendColor=new se(this),this.blendEquation=new ae(this),this.cullFace=new le(this),this.cullFaceSide=new ce(this),this.frontFace=new ue(this),this.program=new he(this),this.activeTexture=new de(this),this.viewport=new pe(this),this.bindFramebuffer=new fe(this),this.bindRenderbuffer=new me(this),this.bindTexture=new ge(this),this.bindVertexBuffer=new _e(this),this.bindElementBuffer=new ye(this),this.bindVertexArrayOES=new ve(this),this.pixelStoreUnpack=new xe(this),this.pixelStoreUnpackPremultiplyAlpha=new be(this),this.pixelStoreUnpackFlipY=new we(this),this.options=e?{...e}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e,i){return new jt(this,t,e,i)}createVertexBuffer(t,e,i,n,r){return new Ht(this,t,e,i,n,r)}createRenderbuffer(t,e,i){const n=this.gl,r=n.createRenderbuffer();return this.bindRenderbuffer.set(r),n.renderbufferStorage(n.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),r}createFramebuffer(t,e,i,n){return new Ce(this,t,e,i,n)}clear({color:t,depth:e,stencil:i,colorMask:n}){const r=this.gl;let o=0;t&&(o|=r.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(n||[!0,!0,!0,!0])),void 0!==e&&(o|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==i&&(o|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(o)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e(t.blendFunction,De.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var ze=t.ay([{name:"a_pos",type:"Float32",components:3}]);class Be{constructor(e,i,n,r){const o={width:n[0],height:n[1],data:null},s=e.gl;this.targetColorTexture=new t.T(e,o,s.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new t.T(e,o,s.RGBA,{useMipmap:!1}),this.context=e,this.setNumParticles(i,r),this.lastInvalidatedAt=0}setNumParticles(e,i){if(this.numParticles===i)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());const n=new t.az;n.reserve(Math.round(i));const r=t.aA(e.key);for(let t=0;t<i;t++)n.emplaceBack(r(),r(),r());this.particleVertices0=this.context.createVertexBuffer(n,ze.members,!0),this.particleVertices1=this.context.createVertexBuffer(n,ze.members,!0),this.particleSegment=t.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=i}update(e){return!(this.lastInvalidatedAt<e&&(this.lastInvalidatedAt=t.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}const Ue={type:2,extent:t.V,loadGeometry:()=>[[new t.P(0,0),new t.P(t.V+1,0),new t.P(t.V+1,t.V+1),new t.P(0,t.V+1),new t.P(0,0)]]};class Ve{constructor(e,i,n,r,o){this.tileID=e,this.uid=t.aC(),this.uses=0,this.tileSize=i,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=o,r&&r.style&&(this._lastUpdatedBrightness=r.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",r&&r.transform&&(this.projection=r.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<t.f.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=t.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(t,e){const i={};if(!e)return i;for(const n of t){const t=n.layerIds.map((t=>e.getLayer(t))).filter(Boolean);if(0!==t.length){n.layers=t,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map((e=>t.filter((t=>t.id===e))[0])));for(const e of t)i[e.fqid]=n}}return i}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const i=this.buckets[e];if(i instanceof t.aE){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const i=this.buckets[e];if(i instanceof t.aE&&i.hasRTLText){this.hasRTLText=!0,t.aF();break}}this.queryPadding=0;for(const t in this.buckets){const e=this.buckets[t],n=i.style.getOwnLayer(t);if(!n)continue;const r=n.queryRadius(e);this.queryPadding=Math.max(this.queryPadding,r)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new t.aD}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(e){for(const t in this.buckets){const i=this.buckets[t];i.uploadPending()&&i.upload(e)}const i=e.gl,n=this.imageAtlas;if(n&&!n.uploaded){const r=!!Object.keys(n.patternPositions).length;this.imageAtlasTexture=new t.T(e,n.image,i.RGBA,{useMipmap:r}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new t.T(e,this.glyphAtlasImage,i.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new t.T(e,this.lineAtlas.image,i.R8),this.lineAtlas.uploaded=!0)}prepare(t,e,i){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,i),!e||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const n=e.style.getBrightness();(this._lastUpdatedBrightness||n)&&(this._lastUpdatedBrightness&&n&&Math.abs(this._lastUpdatedBrightness-n)<.001||(this._lastUpdatedBrightness=n,this.updateBuckets(void 0,e)))}queryRenderedFeatures(t,e,i,n,r,o,s,a){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:s,transform:o,params:r,tileTransform:this.tileTransform},t,e,i):{}}querySourceFeatures(e,i){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const r=n.loadVTLayers(),o=i?i.sourceLayer:"",s=r._geojsonTileLayer||r[o];if(!s)return;const a=t.aG(i&&i.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let i=0;i<s.length;i++){const r=s.feature(i);if(a.needGeometry){const e=t.aH(r,!0);if(!a.filter(new t.K(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!a.filter(new t.K(this.tileID.overscaledZ),r))continue;const d=n.getId(r,o),p=new t.aI(r,l,c,u,d);p.tile=h,e.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const i=t.aJ(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const t=Date.now();let e=!1;if(this.expirationTime>t)e=!1;else if(i)if(this.expirationTime<i)e=!0;else{const n=this.expirationTime-i;n?this.expirationTime=t+Math.max(n,3e4):e=!0}else e=!0;e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length&&e&&this.updateBuckets(t,e)}updateBuckets(e,i){if(!this.latestFeatureIndex)return;const n=this.latestFeatureIndex.loadVTLayers(),r=i.style.listImages(),o=i.style.getBrightness();for(const s in this.buckets){if(!i.style.hasLayer(s))continue;const a=this.buckets[s],l=a.layers[0].sourceLayer||"_geojsonTileLayer",c=n[l];let u={};if(e&&(u=e[l],!c||!u||0===Object.keys(u).length))continue;if(a.update(u,c,r,this.imageAtlas&&this.imageAtlas.patternPositions||{},o),a instanceof t.aK||a instanceof t.aL){const t=i.style.getOwnSourceCache(a.layers[0].source);i._terrain&&i._terrain.enabled&&t&&a.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(t.id,this.tileID)}const h=i&&i.style&&i.style.getOwnLayer(s);h&&(this.queryPadding=Math.max(this.queryPadding,h.queryRadius(a)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<t.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=t.f.now()+e}setTexture(e,i){const n=i.context,r=n.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture&&this.texture instanceof t.T?this.texture.update(e,{useMipmap:!0}):(this.texture=new t.T(n,e,r.RGBA,{useMipmap:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE))}setDependencies(t,e){const i={};for(const t of e)i[t]=!0;this.dependencies[t]=i}hasDependency(t,e){for(const i of t){const t=this.dependencies[i];if(t)for(const i of e)if(t[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const n=t.aM(Ue,this.tileID.canonical,this.tileTransform)[0],r=new t.aN,o=new t.aO;for(let t=0;t<n.length;t++){const{x:e,y:i}=n[t];r.emplaceBack(e,i),o.emplaceBack(t)}o.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(o),this._tileDebugBuffer=e.createVertexBuffer(r,t.aP.members),this._tileDebugSegments=t.aB.simpleSegment(0,0,r.length,o.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const n=t.aM(Ue,this.tileID.canonical,this.tileTransform)[0];let r,o;if(this.isRaster){const e=function(e,i){const n=t.as(e,i),r=Math.pow(2,e.z);for(let o=0;o<Ot;o++)for(let s=0;s<Ot;s++){const a=t.at((e.x+(s+Vt(s))/Nt)/r),l=t.au((e.y+(o+Vt(o))/Nt)/r),c=i.project(a,l),u=o*Ot+s;zt[2*u+0]=Math.round((c.x*n.scale-n.x)*t.V),zt[2*u+1]=Math.round((c.y*n.scale-n.y)*t.V)}Bt.fill(0),Ut.fill(0);for(let t=2045;t>=0;t--){const e=4*t,i=Ft[e+0],n=Ft[e+1],r=Ft[e+2],o=Ft[e+3],s=i+r>>1,a=n+o>>1,l=s+a-n,c=a+i-s,u=n*Ot+i,h=o*Ot+r,d=a*Ot+s,p=Math.hypot((zt[2*u+0]+zt[2*h+0])/2-zt[2*d+0],(zt[2*u+1]+zt[2*h+1])/2-zt[2*d+1])>=16;Bt[d]=Bt[d]||(p?1:0),t<1022&&(Bt[d]=Bt[d]||Bt[(n+c>>1)*Ot+(i+l>>1)]||Bt[(o+c>>1)*Ot+(r+l>>1)])}const o=new t.av,s=new t.aw;let a=0;function l(e,i){const n=i*Ot+e;return 0===Ut[n]&&(o.emplaceBack(zt[2*n+0],zt[2*n+1],e*t.V/Nt,i*t.V/Nt),Ut[n]=++a),Ut[n]-1}function c(t,e,i,n,r,o){const a=t+i>>1,u=e+n>>1;if(Math.abs(t-r)+Math.abs(e-o)>1&&Bt[u*Ot+a])c(r,o,t,e,a,u),c(i,n,r,o,a,u);else{const a=l(t,e),c=l(i,n),u=l(r,o);s.emplaceBack(a,c,u)}}return c(0,0,Nt,Nt,Nt,0),c(Nt,Nt,0,0,0,Nt),{vertices:o,indices:s}}(this.tileID.canonical,i);r=e.vertices,o=e.indices}else{r=new t.av,o=new t.aw;for(const{x:t,y:e}of n)r.emplaceBack(t,e,0,0);const e=t.aQ(r.int16,void 0,4);for(let t=0;t<e.length;t+=3)o.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(r,t.aR.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(o),this._tileBoundsSegments=t.aB.simpleSegment(0,0,r.length,o.length)}_makeGlobeTileDebugBuffers(e,i){const n=i.projection;if(!n||"globe"!==n.name||i.freezeTileCoverage)return;const r=this.tileID.canonical,o=t.aS(r,i),s=t.aT(o),a=t.S(i.zoom);let l;a>0&&(l=t.a6.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,r,i,s,l,a),this._makeGlobeTileDebugTextBuffer(e,r,i,s,l,a)}_globePoint(e,i,n,r,o,s,a){let l=t.aU(e,i,n);if(s){const o=1<<n.z,c=t.a5(r.center.lng),u=t.ae(r.center.lat),h=(n.x+.5)/o-c;let d=0;h>.5?d=-1:h<-.5&&(d=1);let p=(e/t.V+n.x)/o+d,f=(i/t.V+n.y)/o;p=(p-c)*r._pixelsPerMercatorPixel+c,f=(f-u)*r._pixelsPerMercatorPixel+u;const m=[p*r.worldSize,f*r.worldSize,0];t.N.transformMat4(m,m,s),l=t.aV(l,m,a)}return t.N.transformMat4(l,l,o)}_makeGlobeTileDebugBorderBuffer(e,i,n,r,o,s){const a=new t.aN,l=new t.aO,c=new t.aW,u=(t,e,u,h,d)=>{const p=(u-t)/(d-1),f=(h-e)/(d-1),m=a.length;for(let u=0;u<d;u++){const h=t+u*p,d=e+u*f;a.emplaceBack(h,d);const g=this._globePoint(h,d,i,n,r,o,s);c.emplaceBack(g[0],g[1],g[2]),l.emplaceBack(m+u)}},h=t.V;u(0,0,h,0,16),u(h,0,h,h,16),u(h,h,0,h,16),u(0,h,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(l),this._tileDebugBuffer=e.createVertexBuffer(a,t.aP.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(c,t.aX.members),this._tileDebugSegments=t.aB.simpleSegment(0,0,a.length,l.length)}_makeGlobeTileDebugTextBuffer(e,i,n,r,o,s){const a=t.V/4,l=new t.aN,c=new t.aw,u=new t.aW,h=25;c.reserve(32),l.reserve(h),u.reserve(h);const d=(t,e)=>h*t+e;for(let t=0;t<h;t++){const e=t*a;for(let t=0;t<h;t++){const c=t*a;l.emplaceBack(c,e);const h=this._globePoint(c,e,i,n,r,o,s);u.emplaceBack(h[0],h[1],h[2])}}for(let t=0;t<4;t++)for(let e=0;e<4;e++){const i=d(t,e),n=d(t,e+1),r=d(t+1,e),o=d(t+1,e+1);c.emplaceBack(i,n,r),c.emplaceBack(r,n,o)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(c),this._tileDebugTextBuffer=e.createVertexBuffer(l,t.aP.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(u,t.aX.members),this._tileDebugTextSegments=t.aB.simpleSegment(0,0,h,32)}destroy(e=!1){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof t.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const je={vector:Rt,raster:Dt,"raster-dem":class extends Dt{constructor(e,i,n,r){super(e,i,n,r),this.type="raster-dem",this.maxzoom=22,this._options=t.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(t,n){t&&(e.state="errored",i(t)),n&&(e.dem=n,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",i(null))}e.request=t.d(this.map._requestManager.transformRequest(n,t.R.Tile),function(n,o,s,a){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(n)e.state="errored",i(n);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:s,expires:a});const i=ImageBitmap&&o instanceof ImageBitmap&&t.ak(),n=1-(o.width-t.al(o.width))/2;n<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const l=i?o:t.f.getImageData(o,n),c={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:n};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",c,r.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(e){const i=e.canonical,n=Math.pow(2,i.z),r=(i.x-1+n)%n,o=0===i.x?e.wrap-1:e.wrap,s=(i.x+1+n)%n,a=i.x+1===n?e.wrap+1:e.wrap,l={};return l[new t.am(e.overscaledZ,o,i.z,r,i.y).key]={backfilled:!1},l[new t.am(e.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new t.am(e.overscaledZ,o,i.z,r,i.y-1).key]={backfilled:!1},l[new t.am(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new t.am(e.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<n&&(l[new t.am(e.overscaledZ,o,i.z,r,i.y+1).key]={backfilled:!1},l[new t.am(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new t.am(e.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}},"raster-array":kt,geojson:class extends t.E{constructor(e,i,n,r){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(r),this._data=i.data,this._options=t.e({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const o=t.V/this.tileSize;this.workerOptions=t.e({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:t.V,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:t.V,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterLeaves(t,e,i,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:t,limit:e,offset:i},n),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.b("dataloading",{dataType:"source"})),this._loaded=!1;const e=t.e({},this.workerOptions);e.scope=this.scope;const i=this._data;"string"==typeof i?(e.request=this.map._requestManager.transformRequest(t.f.resolveURL(i),t.R.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,((e,i)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new t.a(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(e.resourceTiming=i.resourceTiming[this.id]),this.fire(new t.b("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(e,i){const n=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const r={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:t.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};e.request=this.actor.send(n,r,((t,r)=>(delete e.request,e.destroy(),e.aborted?i(null):t?i(t):(e.loadVectorData(r,this.map.painter,"reloadTile"===n),i(null)))),void 0,"loadTile"===n)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends t.ap{constructor(t,e,i,n){super(t,e,i,n),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,t.R.Source).url);t.aq(this.urls,((e,i)=>{this._loaded=!0,e?this.fire(new t.a(e)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new t.a(new E(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:t.ap,model:class extends t.E{constructor(t,e,i,n){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=e}load(){const e=[];for(const i in this._options.models){const n=this._options.models[i],r=t.l(this.map._requestManager.transformRequest(n.uri,t.R.Model).url).then((e=>{if(!e)return;const r=t.c(e),o=new t.M(i,n.position,n.orientation,r);o.computeBoundsAndApplyParent(),this.models.push(o)})).catch((e=>{this.fire(new t.a(new Error(`Could not load model ${i} from ${n.uri}: ${e.message}`)))}));e.push(r)}return Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new t.b("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((e=>{this.fire(new t.a(new Error(`Could not load models: ${e.message}`)))}))}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,e){}serialize(){return{type:"model"}}},"batched-model":class extends t.E{constructor(t,e,i,n){super(),this.type="batched-model",this.id=t,this.tileSize=512,this._options=e,this.tiles=this._options.tiles,this.maxzoom=e.maxzoom||19,this.minzoom=e.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(n)}onAdd(t){this.map=t,this.load()}load(e){this._loaded=!1,this.fire(new t.b("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=Pt(this._options,this.map._requestManager,i,n,((r,o)=>{this._tileJSONRequest=null,this._loaded=!0,r?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new t.a(r))):o&&(t.e(this,o),o.bounds&&(this.tileBounds=new Lt(o.bounds,this.minzoom,this.maxzoom)),t.aj(o.tiles,this.map._requestManager._customAccessToken),this.fire(new t.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.b("data",{dataType:"source",sourceDataType:"content"}))),e&&e(r)}))}hasTransition(){return!1}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loaded(){return this._loaded}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(n,t.R.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&"expired"!==e.state)if("loading"===e.state)e.reloadCallback=i;else{if(e.buckets){const t=Object.values(e.buckets);for(const e of t)e.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",r,o.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",r,o.bind(this),void 0,!0);function o(t,n){return e.aborted?i(null):t&&404!==t.status?i(t):(n&&(n.resourceTiming&&(e.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(n),e.buckets={...e.buckets,...n.buckets},n.featureIndex&&(e.latestFeatureIndex=n.featureIndex)),e.state="loaded",void i(null))}}serialize(){return t.e({},this._options)}},canvas:class extends t.ap{constructor(e,i,n,r){super(e,i,n,r),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((t=>!Array.isArray(t)||2!==t.length||t.some((t=>"number"!=typeof t))))||this.fire(new t.a(new E(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.a(new E(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.a(new E(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new t.a(new E(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.a(new E(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof t.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.T(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends t.E{constructor(e,i,n,r){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=i,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Lt(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),t.e(this,t.ac(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new t.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){const{x:e,y:i,z:n}=t.canonical;return this._implementation.hasTile({x:e,y:i,z:n})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){const{x:i,y:n,z:r}=t.tileID.canonical,o=new AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:i,y:n,z:r},{signal:o.signal})).then(function(i){return delete t.request,t.aborted?(t.state="unloaded",e(null)):void 0===i?(t.state="errored",e(null)):null===i?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",e(null)):function(t){return t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof ImageBitmap||t instanceof HTMLImageElement}(i)?(this.loadTileData(t,i),t.state="loaded",void e(null)):(t.state="errored",e(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((i=>{20!==i.code&&(t.state="errored",e(i))})),t.request.cancel=()=>o.abort()}loadTileData(t,e){t.setTexture(e,this._map.painter)}unloadTile(e,i){if(e.texture&&e.texture instanceof t.T?(e.destroy(!0),e.texture&&e.texture instanceof t.T&&this._map.painter.saveTileTexture(e.texture)):e.destroy(),this._implementation.unloadTile){const{x:t,y:i,z:n}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:i,z:n})}i()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z})))}_clearTiles(){const e=t.ag(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new t.b("data",{dataType:"source",sourceDataType:"content"}))}}},Ge=function(e,i,n,r){const o=new je[i.type](e,i,n,r);if(o.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${o.id}`);return t.aY(["load","abort","unload","serialize","prepare"],o),o};function He(e,i){const n=t.a6.identity([]);return t.a6.scale(n,n,[.5*e.width,.5*-e.height,1]),t.a6.translate(n,n,[1,-1,0]),t.a6.multiply(n,n,e.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(n)}function We(t,e,i,n,r,o,s,a=!1){const l=t.tilesIn(n,s,a);l.sort(Xe);const c=[];for(const n of l)c.push({wrappedTileID:n.tile.tileID.wrapped().key,queryResults:n.tile.queryRenderedFeatures(e,i,t._state,n,r,o,He(t.transform,n.tile.tileID),a)});const u=function(t){const e={},i={};for(const n of t){const t=n.queryResults,r=n.wrappedTileID,o=i[r]=i[r]||{};for(const i in t){const n=t[i],r=o[i]=o[i]||{},s=e[i]=e[i]||[];for(const t of n)r[t.featureIndex]||(r[t.featureIndex]=!0,s.push(t))}}return e}(c);for(const e in u)u[e].forEach((e=>{const i=e.feature,n=i.layer;n&&"background"!==n.type&&"sky"!==n.type&&"slot"!==n.type&&(i.source=n.source,n["source-layer"]&&(i.sourceLayer=n["source-layer"]),i.state=void 0!==i.id?t.getFeatureState(n["source-layer"],i.id):{})}));return u}function qe(t,e){const i=t.getRenderableIds().map((e=>t.getTileByID(e))),n=[],r={};for(let t=0;t<i.length;t++){const o=i[t],s=o.tileID.canonical.key;r[s]||(r[s]=!0,o.querySourceFeatures(n,e))}return n}function Xe(t,e){const i=t.tileID,n=e.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}class $e extends Ve{constructor(t,e,i,n,r){super(t,e,i,n,r),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,i){const n=i.context,r=n.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture&&this.texture instanceof t.T?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new t.T(n,e,r.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,i){const n=this._mrt=new t.aZ(30),r=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=t.a_(r,((t,r,o,s)=>{if(t)i(t);else try{const t=n.getHeaderLength(r);if(t>e)return void(this.request=this.fetchHeader(t,i));n.parseHeader(r),this._isHeaderLoaded=!0;let a=0;for(const t of Object.values(n.layers))a=Math.max(a,t.dataIndex[t.dataIndex.length-1].last_byte);r.byteLength>=a&&(this.entireBuffer=r),i(null,this.entireBuffer||r,o,s)}catch(t){i(t)}})),this.request}fetchBand(e,i,n){const r=this._mrt;if(!this._isHeaderLoaded||!r)return void n(new Error("Tile header is not ready"));const o=this.actor;if(!o)return void n(new Error("Can't fetch tile band without an actor"));let s;const a=(t,r)=>{s.complete(t,r),t?n(t):(this.updateTextureDescriptor(e,i),n(null,this.textureDescriptor&&this.textureDescriptor.img))},l=(t,e)=>{if(t)return n(t);const i=o.send("decodeRasterArray",{buffer:e,task:s},a,void 0,!0);this._workQueue.push((()=>{i&&i.cancel(),s.cancel()}))},c=r.getLayer(e);if(!c)return void n(new Error(`Unknown sourceLayer "${e}"`));if(c.hasDataForBand(i))return this.updateTextureDescriptor(e,i),void n(null,this.textureDescriptor?this.textureDescriptor.img:null);const u=c.getDataRange([i]);if(s=r.createDecodingTask(u),!s||s.tasks.length)if(this.flushQueues(),this.entireBuffer)l(null,this.entireBuffer.slice(u.firstByte,u.lastByte+1));else{const e=Object.assign({},this.requestParams,{headers:{Range:`bytes=${u.firstByte}-${u.lastByte}`}}),i=t.a_(e,l);this._fetchQueue.push((()=>{i.cancel(),s.cancel()}))}else n(null)}updateNeeded(t,e){return(!this.textureDescriptor||this.textureDescriptor.band!==e||this.textureDescriptor.layer!==t)&&"errored"!==this.state}updateTextureDescriptor(e,i){if(!this._mrt)return;const n=this._mrt.getLayer(e);if(!n||!n.hasBand(i)||!n.hasDataForBand(i))return;const{bytes:r,tileSize:o,buffer:s,offset:a,scale:l}=n.getBandView(i),c=o+2*s,u={data:r,width:c,height:c},h=this.texture;h&&h instanceof t.T&&h.update(u,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:i,img:u,buffer:s,offset:a,tileSize:o,format:n.pixelFormat,mix:[l,256*l,65536*l,16777216*l]}}}class Ye{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,i){const n=t.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const r={value:e,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout((()=>{this.remove(t,r)}),i)),this.data[n].push(r),this.order.push(n),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const i=t.wrapped().key,n=void 0===e?0:this.data[i].indexOf(e),r=this.data[i][n];return this.data[i].splice(n,1),r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(r.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const i in this.data)for(const n of this.data[i])t(n.value)||e.push(n);for(const t of e)this.remove(t.value.tileID,t)}}class Ze extends t.E{constructor(t,e,i){super(),this.id=t,this._onlySymbols=i,e.on("data",(t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),e.on("error",(()=>{this._sourceErrored=!0})),this._source=e,this._tiles={},this._cache=new Ye(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new x,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){const e=this._tiles[t];if("errored"!==e.state&&("loaded"!==e.state||!e.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,e){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,(()=>{}))}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,(()=>{}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return t.a$(this._tiles).map((t=>t.tileID)).sort(Ke).map((t=>t.key))}getRenderableIds(e,i){const n=[];for(const t in this._tiles)this._isIdRenderable(+t,e,i)&&n.push(this._tiles[t]);return e?n.sort(((e,i)=>{const n=e.tileID,r=i.tileID,o=new t.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),s=new t.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-r.overscaledZ||s.y-o.y||s.x-o.x})).map((t=>t.tileID.key)):n.map((t=>t.tileID)).sort(Ke).map((t=>t.key))}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e,i){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())&&(i||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,e){const i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))}_tileLoaded(e,i,n,r){if(r)if(e.state="errored",404!==r.status)this._source.fire(new t.a(r,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new t.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const t=this.map.painter.terrain;this.update(this.transform,t.getScaledDemTileSize(),!0),t.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=t.f.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.b("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const e=this.getRenderableIds();for(let n=0;n<e.length;n++){const r=e[n];if(t.neighboringTiles&&t.neighboringTiles[r]){const e=this.getTileByID(r);i(t,e),i(e,t)}}function i(t,e){if(!t.dem||t.dem.borderReady)return;t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let i=e.tileID.canonical.x-t.tileID.canonical.x;const n=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===i&&0===n||Math.abs(n)>1||(Math.abs(i)>1&&(1===Math.abs(i+r)?i+=r:1===Math.abs(i-r)&&(i-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,n),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,i,n){for(const r in this._tiles){let o=this._tiles[r];if(n[r]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(s=t)}let a=s;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){n[s.key]=s;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(let i=t.overscaledZ-1;i>=e;i--){const e=t.scaledTo(i),n=this._getLoadedTile(e);if(n)return n}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,e){e=e||this._source.tileSize;const i=Math.ceil(t.width/e)+1,n=Math.ceil(t.height/e)+1,r=Math.floor(i*n*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,r):r,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const i in this._tiles){const n=this._tiles[i];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),t[n.tileID.key]=n}this._tiles=t;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(e,i,n,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!n)return;let o;if(this.updateCacheSize(e,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)o=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new t.am(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)));else if(0!==this.tileCoverLift){const r=e.clone();r.tileCoverLift=this.tileCoverLift,o=r.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&"globe"===e.projection.name&&(o.push(new t.am(1,0,1,0,0)),o.push(new t.am(1,0,1,1,0)),o.push(new t.am(1,0,1,0,1)),o.push(new t.am(1,0,1,1,1)))}else o=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(o=o.filter((t=>this._source.hasTile(t))));else o=[];if(o.length>0&&this.castsShadows&&r&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Je(this._source.type)){const t=e.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!n}),s=Math.min(t,this._source.maxzoom),a=e.extendTileCoverForShadows(o,r,s);for(const t of a)this._shadowCasterTiles[t.key]=!0,o.push(t)}const s=this._updateRetainedTiles(o);if(Je(this._source.type)&&0!==o.length){const e={},i={},n=Object.keys(s);for(const r of n){const n=s[r],o=this._tiles[r];if(!o||o.fadeEndTime&&o.fadeEndTime<=t.f.now())continue;const a=this.findLoadedParent(n,Math.max(n.overscaledZ-Ze.maxOverzooming,this._source.minzoom));a&&(this._addTile(a.tileID),e[a.tileID.key]=a.tileID),i[r]=n}const r=o[o.length-1].overscaledZ;for(const t in this._tiles){const e=this._tiles[t];if(s[t]||!e.hasData())continue;let n=e.tileID;for(;n.overscaledZ>r;){n=n.scaledTo(n.overscaledZ-1);const r=this._tiles[n.key];if(r&&r.hasData()&&i[n.key]){s[t]=e.tileID;break}}}for(const t in e)s[t]||(this._coveredTiles[t]=!0,s[t]=e[t])}for(const t in s)this._tiles[t].clearFadeHold();const a=t.b0(this._tiles,s);for(const t of a){const e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(+t)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const e={};if(0===t.length)return e;const i={},n=t.reduce(((t,e)=>Math.min(t,e.overscaledZ)),1/0),r=t[0].overscaledZ,o=Math.max(r-Ze.maxOverzooming,this._source.minzoom),s=Math.max(r+Ze.maxUnderzooming,this._source.minzoom),a={};for(const i of t){const t=this._addTile(i);e[i.key]=i,t.hasData()||n<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,n,s,e);for(const n of t){let t=this._tiles[n.key];if(t.hasData())continue;if(n.canonical.z>=this._source.maxzoom){const t=n.children(this._source.maxzoom)[0],i=this.getTile(t);if(i&&i.hasData()){e[t.key]=t;continue}}else{const t=n.children(this._source.maxzoom);if(e[t[0].key]&&e[t[1].key]&&e[t[2].key]&&e[t[3].key])continue}let r=t.wasRequested();for(let s=n.overscaledZ-1;s>=o;--s){const o=n.scaledTo(s);if(i[o.key])break;if(i[o.key]=!0,t=this.getTile(o),!t&&r&&(t=this._addTile(o)),t&&(e[o.key]=o,r=t.wasRequested(),t.hasData()))break}}return e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let i,n=this._tiles[t].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){i=this._loadedParentTiles[n.key];break}e.push(n.key);const t=n.scaledTo(n.overscaledZ-1);if(i=this._getLoadedTile(t),i)break;n=t}for(const t of e)this._loadedParentTiles[t]=i}}_addTile(e){let i=this._tiles[e.key];if(i)return!0!==i.isExtraShadowCaster||!!this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const n=Boolean(i);if(!n){const t=this.map?this.map.painter:null,n=this._source.tileSize*e.overscaleFactor();i="raster-array"===this._source.type?new $e(e,n,this.transform.tileZoom,t,this._isRaster):new Ve(e,n,this.transform.tileZoom,t,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,n||this._source.fire(new t.b("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),i))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state||"empty"===e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,n){const r=[],o=this.transform;if(!o)return r;const s="globe"===o.projection.name,a=t.a5(o.center.lng);for(const l in this._tiles){const c=this._tiles[l];if(n&&c.clearQueryDebugViz(),c.holdingForFade())continue;let u;if(s){const e=c.tileID.canonical;if(0===e.z){const i=[Math.abs(t.aa(a,...Qe(e,-1))-a),Math.abs(t.aa(a,...Qe(e,1))-a)];u=[0,2*i.indexOf(Math.min(...i))-1]}else{const i=[Math.abs(t.aa(a,...Qe(e,-1))-a),Math.abs(t.aa(a,...Qe(e,0))-a),Math.abs(t.aa(a,...Qe(e,1))-a)];u=[i.indexOf(Math.min(...i))-1]}}else u=[0];for(const t of u){const n=e.containsTile(c,o,i,t);n&&r.push(n)}}return r}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,e){const i=this.getRenderableIds(t,e).map((t=>this._tiles[t].tileID)),n="globe"===this.transform.projection.name;for(const t of i)t.projMatrix=this.transform.calculateProjMatrix(t.toUnwrapped()),t.expandedProjMatrix=n?this.transform.calculateProjMatrix(t.toUnwrapped(),!1,!0):t.projMatrix;return i}sortCoordinatesByDistance(t){const e=t.slice(),i=this.transform._camera.position,n=this.transform._camera.forward(),r={};for(const t of e){const e=1/(1<<t.canonical.z);r[t.key]=((t.canonical.x+.5)*e+t.wrap-i[0])*n[0]+((t.canonical.y+.5)*e-i[1])*n[1]-i[2]*n[2]}return e.sort(((t,e)=>r[t.key]-r[e.key])),e}hasTransition(){if(this._source.hasTransition())return!0;if(Je(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=t.f.now())return!0}return!1}setFeatureState(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)}removeFeatureState(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,i){const n=this._tiles[t];n&&n.setDependencies(e,i)}reloadTilesForDependencies(t,e){for(const i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(t,e)))}_preloadTiles(e,i){if(!this._sourceLoaded){const t=()=>{this._sourceLoaded&&(this._source.off("data",t),this._preloadTiles(e,i))};return void this._source.on("data",t)}const n=new Map,r=Array.isArray(e)?e:[e],o=this.map.painter.terrain,s=this.usedForTerrain&&o?o.getScaledDemTileSize():this._source.tileSize;for(const t of r){const e=t.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const t of e)n.set(t.key,t);this.usedForTerrain&&t.updateElevation(!1)}const a=Array.from(n.values());t.b1(a,((t,e)=>{const i=new Ve(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,(t=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),e(t,i)}))}),i)}}function Ke(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Je(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function Qe(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Ze.maxOverzooming=10,Ze.maxUnderzooming=3;class ti{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,e=!1;for(const i in this.style._mergedLayers){const n=this.style._mergedLayers[i];if("fill-extrusion"===n.type)this.layers.push({layer:n,visible:t,visibilityChanged:e});else if("model"===n.type){const i=this.style.getLayerSource(n);i&&"batched-model"===i.type&&this.layers.push({layer:n,visible:t,visibilityChanged:e})}}}onNewFrame(t){this.layersGotHidden=!1;for(const e of this.layers){const i=e.layer;let n=!1;"fill-extrusion"===i.type?n=!i.isHidden(t)&&i.paint.get("fill-extrusion-opacity")>0:"model"===i.type&&(n=!i.isHidden(t)&&i.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!n&&e.visible,e.visible=n}}updateZOffset(t,e){this.currentBuildingBuckets=[];for(const t of this.layers){const i=t.layer,n=this.style.getLayerSourceCache(i);let r=1;"fill-extrusion"===i.type&&(r=t.visible?i.paint.get("fill-extrusion-vertical-scale"):0);let o=n?n.getTile(e):null;if(!o&&n&&e.canonical.z>n.getSource().minzoom){let t=e.scaledTo(Math.min(n.getSource().maxzoom,e.overscaledZ-1));for(;t.overscaledZ>=n.getSource().minzoom&&(o=n.getTile(t),!o&&0!==t.overscaledZ);)t=t.scaledTo(t.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:o?o.getBucket(i):null,tileID:o?o.tileID:e,verticalScale:r})}t.hasAnyZOffset=!1;let i=!1;for(let n=0;n<t.symbolInstances.length;n++){const r=t.symbolInstances.get(n),o=r.zOffset,s=this._getHeightAtTileOffset(e,r.tileAnchorX,r.tileAnchorY);r.zOffset=s!==Number.NEGATIVE_INFINITY?s:o,i||o===r.zOffset||(i=!0),t.hasAnyZOffset||0===r.zOffset||(t.hasAnyZOffset=!0)}i&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,i,n,r){let o=i,s=n;if(e.canonical.z!==r.canonical.z){const a=r.canonical,l=1/(1<<e.canonical.z-a.z);o=(i+e.canonical.x*t.V)*l-a.x*t.V|0,s=(n+e.canonical.y*t.V)*l-a.y*t.V|0}return{tileX:o,tileY:s}}_getHeightAtTileOffset(t,e,i){let n,r;for(let o=0;o<this.layers.length;++o){if("fill-extrusion"!==this.layers[o].layer.type)continue;const{bucket:s,tileID:a,verticalScale:l}=this.currentBuildingBuckets[o];if(!s)continue;const{tileX:c,tileY:u}=this._mapCoordToOverlappingTile(t,e,i,a),h=s.getHeightAtTileCoord(c,u);h&&void 0!==h.height&&(h.hidden?n=h.height:r=Math.max(h.height*l,r||0))}if(void 0!==r)return r;for(let r=0;r<this.layers.length;++r){const o=this.layers[r];if("model"!==o.layer.type||!o.visible)continue;const{bucket:s,tileID:a}=this.currentBuildingBuckets[r];if(!s)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(t,e,i,a),u=s.getHeightAtTileCoord(l,c);if(u&&!u.hidden)return void 0===u.height&&void 0!==n?Math.min(u.maxHeight,n)*u.verticalScale:(u.height||0)*u.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ei(e,i){const n={};for(const t in e)"ref"!==t&&(n[t]=e[t]);return t.b2.forEach((t=>{t in i&&(n[t]=i[t])})),n}function ii(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=ei(t[i],e[t[i].ref]));return t}const ni={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function ri(t,e,i){i.push({command:ni.addSource,args:[t,e[t]]})}function oi(t,e,i){e.push({command:ni.removeSource,args:[t]}),i[t]=!0}function si(t,e,i,n){oi(t,i,n),ri(t,e,i)}function ai(t,i,n){let r;for(r in t[n])if(t[n].hasOwnProperty(r)&&"data"!==r&&!e(t[n][r],i[n][r]))return!1;for(r in i[n])if(i[n].hasOwnProperty(r)&&"data"!==r&&!e(t[n][r],i[n][r]))return!1;return!0}function li(t,i,n,r,o,s){let a;for(a in i=i||{},t=t||{})t.hasOwnProperty(a)&&(e(t[a],i[a])||n.push({command:s,args:[r,a,i[a],o]}));for(a in i)i.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(e(t[a],i[a])||n.push({command:s,args:[r,a,i[a],o]}))}function ci(t){return t.id}function ui(t,e){return t[e.id]=e,t}class hi{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let t=1;t<this.points.length;t++)this._distances[t]=this._distances[t-1]+this.points[t].dist(this.points[t-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.aa(e,0,1);let i=1,n=this._distances[i];const r=e*this.paddedLength+this.padding;for(;n<r&&i<this._distances.length;)n=this._distances[++i];const o=i-1,s=this._distances[o],a=n-s,l=a>0?(r-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}class di{constructor(t,e,i){const n=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let t=0;t<this.xCellCount*this.yCellCount;t++)n.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)}insertCircle(t,e,i,n){this._forEachCell(e-n,i-n,e+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(n)}_insertBoxCell(t,e,i,n,r,o){this.boxCells[r].push(o)}_insertCircleCell(t,e,i,n,r,o){this.circleCells[r].push(o)}_query(t,e,i,n,r,o){if(i<0||t>this.width||n<0||e>this.height)return!r&&[];const s=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=n){if(r)return!0;for(let t=0;t<this.boxKeys.length;t++)s.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],n=this.circles[3*t+2];s.push({key:this.circleKeys[t],x1:e-n,y1:i-n,x2:e+n,y2:i+n})}return o?s.filter(o):s}return this._forEachCell(t,e,i,n,this._queryCell,s,{hitTest:r,seenUids:{box:{},circle:{}}},o),r?s.length>0:s}_queryCircle(t,e,i,n,r){const o=t-i,s=t+i,a=e-i,l=e+i;if(s<0||o>this.width||l<0||a>this.height)return!n&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:n,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},r),n?c.length>0:c}query(t,e,i,n,r){return this._query(t,e,i,n,!1,r)}hitTest(t,e,i,n,r){return this._query(t,e,i,n,!0,r)}hitTestCircle(t,e,i,n){return this._queryCircle(t,e,i,!0,n)}_queryCell(t,e,i,n,r,o,s,a){const l=s.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(t<=r[c+2]&&e<=r[c+3]&&i>=r[c+0]&&n>=r[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(r[u],r[u+1],r[u+2],t,e,i,n)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const t=r[u],e=r[u+1],i=r[u+2];o.push({key:this.circleKeys[c],x1:t-i,y1:e-i,x2:t+i,y2:e+i})}}}}}_queryCellCircle(t,e,i,n,r,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[r];if(null!==u){const t=this.bboxes;for(const e of u)if(!c.box[e]){c.box[e]=!0;const i=4*e;if(this._circleAndRectCollide(l.x,l.y,l.radius,t[i+0],t[i+1],t[i+2],t[i+3])&&(!a||a(this.boxKeys[e])))return o.push(!0),!0}}const h=this.circleCells[r];if(null!==h){const t=this.circles;for(const e of h)if(!c.circle[e]){c.circle[e]=!0;const i=3*e;if(this._circlesCollide(t[i],t[i+1],t[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[e])))return o.push(!0),!0}}}_forEachCell(t,e,i,n,r,o,s,a){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(n);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,t,e,i,n,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,n,r,o){const s=n-t,a=r-e,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(t,e,i,n,r,o,s){const a=(o-n)/2,l=Math.abs(t-(n+a));if(l>a+i)return!1;const c=(s-r)/2,u=Math.abs(e-(r+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=i*i}}const pi={unknown:0,flipRequired:1,flipNotRequired:2},fi=Math.tan(85*Math.PI/180);function mi(e,i,n,r,o,s,a){const l=t.a6.create();if(n)if("globe"===s.name){const e=t.b3(o,i);t.a6.multiply(l,l,e)}else{const e=t.b4.invert([],a);l[0]=e[0],l[1]=e[1],l[4]=e[2],l[5]=e[3],r||t.a6.rotateZ(l,l,o.angle)}else t.a6.multiply(l,o.labelPlaneMatrix,e);return l}function gi(t,e,i,n,r,o,s){const a=mi(t,e,i,n,r,o,s);return"globe"===o.name&&i||(a[2]=a[6]=a[10]=a[14]=0),a}function _i(e,i,n,r,o,s,a){if(n){if("globe"===s.name){const l=mi(e,i,n,r,o,s,a);return t.a6.invert(l,l),t.a6.multiply(l,e,l),l}{const i=t.a6.clone(e),n=t.a6.identity([]);return n[0]=a[0],n[1]=a[1],n[4]=a[2],n[5]=a[3],t.a6.multiply(i,i,n),r||t.a6.rotateZ(i,i,-o.angle),i}}return o.glCoordMatrix}function yi(e,i,n,r){const o=[e,i,n,1];n?t.a7.transformMat4(o,o,r):Ai(o,o,r);const s=o[3];return o[0]/=s,o[1]/=s,o[2]/=s,o}function vi(t,e){return Math.min(.5+t/e*.5,1.5)}function xi(t,e){const i=t[0]/t[3],n=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&n>=-e[1]&&n<=e[1]}function bi(e,i,n,r,o,s,a,l,c,u){const h=n.transform,d=r?e.textSizeData:e.iconSizeData,p=t.b5(d,n.transform.zoom),f="globe"===h.projection.name,m=[256/n.width*2+1,256/n.height*2+1],g=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;g.clear();let _=null;f&&(_=r?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const y=e.lineVertexArray,v=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,x=n.transform.width/n.transform.height;let b,w=!1;for(let r=0;r<v.length;r++){const f=v.get(r),{numGlyphs:E,writingMode:S}=f;if(S!==t.b6.vertical||w||b===t.b6.horizontal||(w=!0),b=S,(f.hidden||S===t.b6.vertical)&&!w){Ci(E,g);continue}w=!1;const T=new t.P(f.tileAnchorX,f.tileAnchorY);let{x:M,y:I,z:C}=h.projection.projectTilePoint(T.x,T.y,u.canonical);if(c){const[t,e,i]=c(T);M+=t,I+=e,C+=i}const A=[M,I,C,1];if(t.a7.transformMat4(A,A,i),!xi(A,m)){Ci(E,g);continue}const P=A[3],L=vi(n.transform.getCameraToCenterDistance(h.projection),P),R=t.b7(d,p,f),D=a?R/L:R*L,k=yi(M,I,C,o);if(k[3]<=0){Ci(E,g);continue}let N={};const O=a?null:c,F=Si(f,D,!1,l,i,o,s,e.glyphOffsetArray,y,g,_,k,T,N,x,O,h.projection,u,a);w=F.useVertical,O&&F.needsFlipping&&(N={}),(F.notEnoughRoom||w||F.needsFlipping&&Si(f,D,!0,l,i,o,s,e.glyphOffsetArray,y,g,_,k,T,N,x,O,h.projection,u,a).notEnoughRoom)&&Ci(E,g)}r?(e.text.dynamicLayoutVertexBuffer.updateData(g),_&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(_)):(e.icon.dynamicLayoutVertexBuffer.updateData(g),_&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(_))}function wi(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m){const{lineStartIndex:g,glyphStartIndex:_,segment:y}=a,v=_+a.numGlyphs,x=g+a.lineLength,b=e.getoffsetX(_),w=e.getoffsetX(v-1),E=Ii(t*b,i,n,r,o,s,y,g,x,l,c,u,h,d,!0,p,f,m);if(!E)return null;const S=Ii(t*w,i,n,r,o,s,y,g,x,l,c,u,h,d,!0,p,f,m);return S?{first:E,last:S}:null}function Ei(e,i,n,r){return e===t.b6.horizontal&&Math.abs(r)>Math.abs(n)?{useVertical:!0}:e===t.b6.vertical?r>0?{needsFlipping:!0}:null:i!==pi.unknown&&function(t,e){return 0===t||Math.abs(e/t)>fi}(n,r)?i===pi.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function Si(e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v){const x=i/24,b=e.lineOffsetX*x,w=e.lineOffsetY*x,{lineStartIndex:E,glyphStartIndex:S,numGlyphs:T,segment:M,writingMode:I,flipState:C}=e,A=E+e.lineLength,P=e=>{if(h){const[i,n,r]=e.up,o=u.length;t.b8(h,o+0,i,n,r),t.b8(h,o+1,i,n,r),t.b8(h,o+2,i,n,r),t.b8(h,o+3,i,n,r)}const[i,n,r]=e.point;t.b9(u,i,n,r,e.angle)};if(T>1){const t=wi(x,l,b,w,n,d,p,e,c,s,f,g,!1,_,y,v);if(!t)return{notEnoughRoom:!0};if(r&&!n){let[i,n,r]=t.first.point,[o,s,l]=t.last.point;[i,n]=yi(i,n,r,a),[o,s]=yi(o,s,l,a);const c=Ei(I,C,(o-i)*m,s-n);if(e.flipState=c&&c.needsFlipping?pi.flipRequired:pi.flipNotRequired,c)return c}P(t.first);for(let t=S+1;t<S+T-1;t++){const e=Ii(x*l.getoffsetX(t),b,w,n,d,p,M,E,A,c,s,f,g,!1,!1,_,y,v);if(!e)return u.length-=4*(t-S),{notEnoughRoom:!0};P(e)}P(t.last)}else{if(r&&!n){const i=yi(p.x,p.y,0,o),n=E+M+1,r=new t.P(c.getx(n),c.gety(n)),s=yi(r.x,r.y,0,o),a=s[3]>0?s:Mi(p,r,i,1,o,void 0,_,y.canonical),l=Ei(I,C,(a[0]-i[0])*m,a[1]-i[1]);if(e.flipState=l&&l.needsFlipping?pi.flipRequired:pi.flipNotRequired,l)return l}const i=Ii(x*l.getoffsetX(S),b,w,n,d,p,M,E,A,c,s,f,g,!1,!1,_,y,v);if(!i)return{notEnoughRoom:!0};P(i)}return{}}function Ti(t,e,i,n,r){const{x:o,y:s,z:a}=n.projectTilePoint(t.x,t.y,e);if(!r)return yi(o,s,a,i);const[l,c,u]=r(t);return yi(o+l,s+c,a+u,i)}function Mi(e,i,n,r,o,s,a,l){const c=Ti(e.sub(i)._unit()._add(e),l,o,a,s);return t.N.sub(c,n,c),t.N.normalize(c,c),t.N.scaleAndAdd(c,n,c,r)}function Ii(e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y){const v=r?e-i:e+i;let x=v>0?1:-1,b=0;r&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);let w=l+a+(x>0?0:1)|0,E=o,S=o,T=0,M=0;const I=Math.abs(v),C=[],A=[];let P=s,L=P;const R=()=>Mi(L,P,S,I-T+1,h,p,g,_.canonical);for(;T+M<=I;){if(w+=x,w<l||w>=c)return null;if(S=E,L=P,C.push(S),f&&A.push(L),P=new t.P(u.getx(w),u.gety(w)),E=d[w],!E){const t=Ti(P,_.canonical,h,g,p);E=t[3]>0?d[w]=t:R()}T+=M,M=t.N.distance(S,E)}m&&p&&(d[w]&&(E=R(),M=t.N.distance(S,E)),d[w]=E);const D=(I-T)/M,k=P.sub(L)._mult(D)._add(L),N=t.N.sub([],E,S),O=t.N.scaleAndAdd([],S,N,D);let F=[0,0,1],z=N[0],B=N[1];if(y&&(F=g.upVector(_.canonical,k.x,k.y),0!==F[0]||0!==F[1]||1!==F[2])){const e=[F[2],0,-F[0]],i=t.N.cross([],F,e);t.N.normalize(e,e),t.N.normalize(i,i),z=t.N.dot(N,e),B=t.N.dot(N,i)}if(n){const e=t.N.cross([],F,N);t.N.normalize(e,e),t.N.scaleAndAdd(O,O,e,n*x)}const U=b+Math.atan2(B,z);return C.push(O),f&&A.push(k),{point:O,angle:U,path:C,tilePath:A,up:F}}function Ci(t,e){const i=e.length,n=i+4*t;e.resize(n),e.float32.fill(-1/0,4*i,4*n)}function Ai(t,e,i){const n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t[3]=i[3]*n+i[7]*r+i[15],t}const Pi=100;class Li{constructor(t,e,i=new di(t.width+200,t.height+200,25),n=new di(t.width+200,t.height+200,25)){this.transform=t,this.grid=i,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Pi,this.screenBottomBoundary=t.height+Pi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=e}placeCollisionBox(t,e,i,n,r,o,s,a){let l=i.projectedAnchorX,c=i.projectedAnchorY,u=i.projectedAnchorZ;const h=i.elevation,d=i.tileID,p=t.getProjection();if(h&&d){const[t,e,n]=p.upVector(d.canonical,i.tileAnchorX,i.tileAnchorY),r=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=t*h*r,c+=e*h*r,u+=n*h*r}const f=this.projectAndGetPerspectiveRatio(s,l,c,u,i.tileID,"globe"===p.name||!!h||this.transform.pitch>0,p),m=o*f.perspectiveRatio,g=(i.x1*e+n.x-i.padding)*m+f.point.x,_=(i.y1*e+n.y-i.padding)*m+f.point.y,y=(i.x2*e+n.x+i.padding)*m+f.point.x,v=(i.y2*e+n.y+i.padding)*m+f.point.y,x=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(g,_,y,v)||!r&&this.grid.hitTest(g,_,y,v,a)||x?{box:[],offscreen:!1,occluded:f.occluded}:{box:[g,_,y,v],offscreen:this.isOffscreen(g,_,y,v),occluded:!1}}placeCollisionCircles(e,i,n,r,o,s,a,l,c,u,h,d,p,f,m){const g=[],_=this.transform.elevation,y=e.getProjection(),v=_?_.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,y):null,x=new t.P(n.tileAnchorX,n.tileAnchorY);let{x:b,y:w,z:E}=y.projectTilePoint(x.x,x.y,m.canonical);if(v){const[t,e,i]=v(x);b+=t,w+=e,E+=i}const S="globe"===y.name,T=this.projectAndGetPerspectiveRatio(a,b,w,E,m,S||!!_||this.transform.pitch>0,y),{perspectiveRatio:M}=T,I=(h?s/M:s*M)/t.bc,C=yi(b,w,E,l),A=T.signedDistanceFromCamera>0?wi(I,o,n.lineOffsetX*I,n.lineOffsetY*I,!1,C,x,n,r,l,{},_&&!h?v:null,h&&!!_,y,m,h):null;let P=!1,L=!1,R=!0;if(A&&!T.occluded){const e=.5*p*M+f,n=new t.P(-100,-100),r=new t.P(this.screenRightBoundary,this.screenBottomBoundary),o=new hi,{first:s,last:a}=A,l=s.path.length;let h=[];for(let t=l-1;t>=1;t--)h.push(s.path[t]);for(let t=1;t<a.path.length;t++)h.push(a.path[t]);const m=2.5*e;c&&(h=h.map((([t,e,i],n)=>(v&&!S&&(i=v(n<l-1?s.tilePath[l-1-n]:a.tilePath[n-l+2])[2]),yi(t,e,i,c)))),h.some((t=>t[3]<=0))&&(h=[]));let _=[];if(h.length>0){let e=1/0,i=-1/0,o=1/0,s=-1/0;for(const t of h)e=Math.min(e,t[0]),o=Math.min(o,t[1]),i=Math.max(i,t[0]),s=Math.max(s,t[1]);i>=n.x&&e<=r.x&&s>=n.y&&o<=r.y&&(_=[h.map((e=>new t.P(e[0],e[1])))],(e<n.x||i>r.x||o<n.y||s>r.y)&&(_=t.ba(_,n.x,n.y,r.x,r.y)))}for(const t of _){o.reset(t,.25*e);let n=0;n=o.length<=.5*e?1:Math.ceil(o.paddedLength/m)+1;for(let t=0;t<n;t++){const r=t/Math.max(n-1,1),s=o.lerp(r),a=s.x+Pi,l=s.y+Pi;g.push(a,l,e,0);const c=a-e,h=l-e,p=a+e,f=l+e;if(R=R&&this.isOffscreen(c,h,p,f),L=L||this.isInsideGrid(c,h,p,f),!i&&this.grid.hitTestCircle(a,l,e,d)&&(P=!0,!u))return{circles:[],offscreen:!1,collisionDetected:P,occluded:!1}}}}return{circles:!u&&P||!L?[]:g,offscreen:R,collisionDetected:P,occluded:T.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let n=1/0,r=1/0,o=-1/0,s=-1/0;for(const a of e){const e=new t.P(a.x+Pi,a.y+Pi);n=Math.min(n,e.x),r=Math.min(r,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y),i.push(e)}const a=this.grid.query(n,r,o,s).concat(this.ignoredGrid.query(n,r,o,s)),l={},c={};for(const e of a){const n=e.key;if(void 0===l[n.bucketInstanceId]&&(l[n.bucketInstanceId]={}),l[n.bucketInstanceId][n.featureIndex])continue;const r=[new t.P(e.x1,e.y1),new t.P(e.x2,e.y1),new t.P(e.x2,e.y2),new t.P(e.x1,e.y2)];t.bb(i,r)&&(l[n.bucketInstanceId][n.featureIndex]=!0,void 0===c[n.bucketInstanceId]&&(c[n.bucketInstanceId]=[]),c[n.bucketInstanceId].push(n.featureIndex))}return c}insertCollisionBox(t,e,i,n,r){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:n,collisionGroupID:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,i,n,r){const o=e?this.ignoredGrid:this.grid,s={bucketInstanceId:i,featureIndex:n,collisionGroupID:r};for(let e=0;e<t.length;e+=4)o.insertCircle(s,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(e,i,n,r,o,s,a){const l=[i,n,r,1];let c=!1;if(r||this.transform.pitch>0){if(t.a7.transformMat4(l,l,e),this.fogState&&o&&"globe"!==a.name){const e=function(e,i,n,r,o,s){const a=s.calculateFogTileMatrix(o),l=[i,n,r];return t.N.transformMat4(l,l,a),_t(e,t.N.length(l),s.pitch,s._fov)}(this.fogState,i,n,r,o.toUnwrapped(),this.transform);c=e>.9}}else Ai(l,l,e);const u=l[3];return{point:new t.P((l[0]/u+1)/2*this.transform.width+Pi,(-l[1]/u+1)/2*this.transform.height+Pi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/u*.5,1.5),signedDistanceFromCamera:u,occluded:s&&l[2]>u||c}}isOffscreen(t,e,i,n){return i<Pi||t>=this.screenRightBoundary||n<Pi||e>this.screenBottomBoundary}isInsideGrid(t,e,i,n){return i>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.a6.identity([]);return t.a6.translate(e,e,[-100,-100,0]),e}}function Ri(e,i,n){const r=i.createTileMatrix(e,e.worldSize,n.toUnwrapped());return t.a6.multiply(new Float32Array(16),e.projMatrix,r)}function Di(t,e,i){if(e.projection.name===i.projection.name)return t.projMatrix;const n=i.clone();return n.setProjection(e.projection),Ri(n,e.getProjection(),t)}function ki(t,e,i){return e.name===i.projection.name?t.projMatrix:Ri(i,e,t)}class Ni{constructor(t,e,i,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Oi{constructor(t,e,i,n,r,o=!1){this.text=new Ni(t?t.text:null,e,i,r),this.icon=new Ni(t?t.icon:null,e,n,r),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fi{constructor(t,e,i,n=!1){this.text=t,this.icon=e,this.skipFade=i,this.clipped=n}}class zi{constructor(){this.invProjMatrix=t.a6.create(),this.viewportMatrix=t.a6.create(),this.circles=[]}}class Bi{constructor(t,e,i,n,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=n,this.tileID=r}}class Ui{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function Vi(e,i,n,r,o){const{horizontalAlign:s,verticalAlign:a}=t.bf(e),l=-(s-.5)*i,c=-(a-.5)*n,u=t.bd(e,r);return new t.P(l+u[0]*o,c+u[1]*o)}function ji(e,i,n,r,o){const s=new t.P(e,i);return n&&s._rotate(r?o:-o),s}class Gi{constructor(t,e,i,n,r,o){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Li(this.transform,r),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new Ui(i),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,i,n,r){const o=n.getBucket(i),s=n.latestFeatureIndex;if(!o||!s||i.fqid!==o.layerIds[0])return;const a=o.layers[0].layout,l=n.collisionBoxArray,c=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),u=n.tileSize/t.V,h=n.tileID.toUnwrapped();this.transform.setProjection(o.projection);const d=(p=n.tileID,f=o.getProjection(),m=this.transform,f.name===this.projection?m.calculateProjMatrix(p.toUnwrapped()):Ri(m,f,p));var p,f,m;const g="map"===a.get("text-pitch-alignment"),_="map"===a.get("text-rotation-alignment");i.compileFilter();const y=i.dynamicFilter(),v=i.dynamicFilterNeedsFeature(),x=this.transform.calculatePixelsToTileUnitsMatrix(n),b=gi(d,n.tileID.canonical,g,_,this.transform,o.getProjection(),x);let w=null;if(g){const e=_i(d,n.tileID.canonical,g,_,this.transform,o.getProjection(),x);w=t.a6.multiply([],this.transform.labelPlaneMatrix,e)}let E=null;y&&n.latestFeatureIndex&&(E={unwrappedTileID:h,dynamicFilter:y,dynamicFilterNeedsFeature:v,featureIndex:n.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new Bi(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,n.tileID);const S={bucket:o,layout:a,posMatrix:d,textLabelPlaneMatrix:b,labelToScreenMatrix:w,clippingData:E,scale:c,textPixelRatio:u,holdingForFade:n.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:t.b5(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.b5(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(r)for(const t of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r}=t;e.push({sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r,parameters:S})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:S})}attemptAnchorPlacement(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_){const{textOffset0:y,textOffset1:v,crossTileID:x}=h,b=[y,v],w=Vi(t,i,n,b,r),E=this.collisionIndex.placeCollisionBox(p,r,e,ji(w.x,w.y,o,s,this.transform.angle),u,a,l,c.predicate);if(m){const t=p.getSymbolInstanceIconSize(_,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,t,m,ji(w.x,w.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)return}if(E.box.length>0){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[x]&&this.prevPlacement.placements[x]&&this.prevPlacement.placements[x].text&&(e=this.prevPlacement.variableOffsets[x].anchor),this.variableOffsets[x]={textOffset:b,width:i,height:n,anchor:t,textScale:r,prevAnchor:e},this.markUsedJustification(p,t,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[x]=f),{shift:w,placedGlyphBoxes:E}}}placeLayerBucketPart(e,i,n,r){const{bucket:o,layout:s,posMatrix:a,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:u,textPixelRatio:h,holdingForFade:d,collisionBoxArray:p,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:m,collisionGroup:g}=e.parameters,_=s.get("text-optional"),y=s.get("icon-optional"),v=s.get("text-allow-overlap"),x=s.get("icon-allow-overlap"),b="map"===s.get("text-rotation-alignment"),w="map"===s.get("text-pitch-alignment"),E="viewport-y"===s.get("symbol-z-order"),S=s.get("symbol-z-elevate");this.transform.setProjection(o.projection);let T=v&&(x||!o.hasIconData()||y),M=x&&(v||!o.hasTextData()||_);!o.collisionArrays&&p&&o.deserializeCollisionBoxes(p),n&&r&&o.updateCollisionDebugBuffers(this.transform.zoom,p);const I=(e,r,p)=>{const{crossTileID:E,numVerticalGlyphVertices:S}=e;if(u){const n={zoom:this.transform.zoom,pitch:this.transform.pitch};let r=null;if(u.dynamicFilterNeedsFeature){const t=this.retainedQueryData[o.bucketInstanceId];r=u.featureIndex.loadFeature({featureIndex:e.featureIndex,bucketIndex:t.bucketIndex,sourceLayerIndex:t.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(n,r,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new t.P(e.tileAnchorX,e.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[E]=new Fi(!1,!1,!1,!0),void i.add(E)}if(i.has(E))return;if(d)return void(this.placements[E]=new Fi(!1,!1,!1));let I=!1,C=!1,A=!0,P=!1,L=!1,R=null,D={box:null,offscreen:null,occluded:null},k={box:null,offscreen:null,occluded:null},N=null,O=null,F=null,z=0,B=0,U=0;p.textFeatureIndex?z=p.textFeatureIndex:e.useRuntimeCollisionCircles&&(z=e.featureIndex),p.verticalTextFeatureIndex&&(B=p.verticalTextFeatureIndex);const V=t=>{t.tileID=this.retainedQueryData[o.bucketInstanceId].tileID;const i=this.transform.elevation;t.elevation=e.zOffset+(i?i.getAtTileOffset(t.tileID,t.tileAnchorX,t.tileAnchorY):0)},j=p.textBox;if(j){V(j);const i=i=>{let n=t.b6.horizontal;if(o.allowVerticalPlacement&&!i&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[E];t&&(this.placedOrientations[E]=t,n=t,this.markUsedOrientation(o,n,e))}return n},n=(e,i)=>{if(o.allowVerticalPlacement&&S>0&&p.verticalTextBox){for(const n of o.writingModes)if(n===t.b6.vertical?(D=i(),k=D):D=e(),D&&D.box&&D.box.length)break}else D=e()};if(s.get("text-variable-anchor")){let l=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[E]){const t=this.prevPlacement.variableOffsets[E];l.indexOf(t.anchor)>0&&(l=l.filter((e=>e!==t.anchor)),l.unshift(t.anchor))}const c=(t,i,n)=>{const s=o.getSymbolInstanceTextSize(f,e,this.transform.zoom,r),c=(t.x2-t.x1)*s+2*t.padding,u=(t.y2-t.y1)*s+2*t.padding,d=e.hasIconTextFit&&!x?i:null;d&&V(d);let p={box:[],offscreen:!1,occluded:!1};const _=v?2*l.length:l.length;for(let i=0;i<_;++i){const _=this.attemptAnchorPlacement(l[i%l.length],t,c,u,s,b,w,h,a,g,i>=l.length,e,r,o,n,d,f,m);if(_&&(p=_.placedGlyphBoxes,p&&p.box&&p.box.length)){I=!0,R=_.shift;break}}return p};n((()=>c(j,p.iconBox,t.b6.horizontal)),(()=>{const e=p.verticalTextBox;return e&&V(e),o.allowVerticalPlacement&&!(D&&D.box&&D.box.length)&&S>0&&e?c(e,p.verticalIconBox,t.b6.vertical):{box:null,offscreen:null,occluded:null}})),D&&(I=D.box,A=D.offscreen,P=D.occluded);const u=i(!(!D||!D.box));if(!I&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[E];t&&(this.variableOffsets[E]=t,this.markUsedJustification(o,t.anchor,e,u))}}else{const s=(i,n)=>{const s=o.getSymbolInstanceTextSize(f,e,this.transform.zoom,r),l=this.collisionIndex.placeCollisionBox(o,s,i,new t.P(0,0),v,h,a,g.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(o,n,e),this.placedOrientations[E]=n),l};n((()=>s(j,t.b6.horizontal)),(()=>{const e=p.verticalTextBox;return o.allowVerticalPlacement&&S>0&&e?(V(e),s(e,t.b6.vertical)):{box:null,offscreen:null,occluded:null}})),i(!!(D&&D.box&&D.box.length))}}if(N=D,I=N&&N.box&&N.box.length>0,A=N&&N.offscreen,P=N&&N.occluded,e.useRuntimeCollisionCircles){const i=o.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex),r=t.b7(o.textSizeData,f,i),u=s.get("text-padding");O=this.collisionIndex.placeCollisionCircles(o,v,i,o.lineVertexArray,o.glyphOffsetArray,r,a,l,c,n,w,g.predicate,e.collisionCircleDiameter*r/t.bc,u,this.retainedQueryData[o.bucketInstanceId].tileID),I=v||O.circles.length>0&&!O.collisionDetected,A=A&&O.offscreen,P=O.occluded}if(p.iconFeatureIndex&&(U=p.iconFeatureIndex),p.iconBox){const i=i=>{V(i);const n=e.hasIconTextFit&&R?ji(R.x,R.y,b,w,this.transform.angle):new t.P(0,0),r=o.getSymbolInstanceIconSize(m,this.transform.zoom,e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(o,r,i,n,x,h,a,g.predicate)};k&&k.box&&k.box.length&&p.verticalIconBox?(F=i(p.verticalIconBox),C=F.box.length>0):(F=i(p.iconBox),C=F.box.length>0),A=A&&F.offscreen,L=F.occluded}const G=_||0===e.numHorizontalGlyphVertices&&0===S,H=y||0===e.numIconVertices;if(G||H?H?G||(C=C&&I):I=C&&I:C=I=C&&I,I&&N&&N.box&&this.collisionIndex.insertCollisionBox(N.box,s.get("text-ignore-placement"),o.bucketInstanceId,k&&k.box&&B?B:z,g.ID),C&&F&&this.collisionIndex.insertCollisionBox(F.box,s.get("icon-ignore-placement"),o.bucketInstanceId,U,g.ID),O&&(I&&this.collisionIndex.insertCollisionCircles(O.circles,s.get("text-ignore-placement"),o.bucketInstanceId,z,g.ID),n)){const t=o.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new zi);for(let t=0;t<O.circles.length;t+=4)e.circles.push(O.circles[t+0]),e.circles.push(O.circles[t+1]),e.circles.push(O.circles[t+2]),e.circles.push(O.collisionDetected?1:0)}const W="globe"!==o.projection.name;T=T&&(W||!P),M=M&&(W||!L),this.placements[E]=new Fi(I||T,C||M,A||o.justReloaded),i.add(E)};if(S&&this.buildingIndex&&(this.buildingIndex.updateZOffset(o,this.retainedQueryData[o.bucketInstanceId].tileID),o.updateZOffset()),E){const e=o.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const i=e[t];I(o.symbolInstances.get(i),i,o.collisionArrays[i])}o.hasAnyZOffset&&t.w(`${o.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(o.hasAnyZOffset){const t=o.getSortedIndexesByZOffset();for(let e=0;e<t.length;++e){const i=t[e];I(o.symbolInstances.get(i),i,o.collisionArrays[i])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)I(o.symbolInstances.get(t),t,o.collisionArrays[t]);if(n&&o.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[o.bucketInstanceId];t.a6.invert(e.invProjMatrix,a),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(e,i,n,r){const{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l,crossTileID:c}=n,u=t.be(i),h=r===t.b6.vertical?l:"left"===u?o:"center"===u?s:"right"===u?a:-1;o>=0&&(e.text.placedSymbolArray.get(o).crossTileID=h>=0&&o!==h?0:c),s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=h>=0&&s!==h?0:c),a>=0&&(e.text.placedSymbolArray.get(a).crossTileID=h>=0&&a!==h?0:c),l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=h>=0&&l!==h?0:c)}markUsedOrientation(e,i,n){const r=i===t.b6.horizontal||i===t.b6.horizontalOnly?i:0,o=i===t.b6.vertical?i:0,{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=n,u=e.text.placedSymbolArray;s>=0&&(u.get(s).placedOrientation=r),a>=0&&(u.get(a).placedOrientation=r),l>=0&&(u.get(l).placedOrientation=r),c>=0&&(u.get(c).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const n=e?e.symbolFadeChange(t):1,r=e?e.opacities:{},o=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const t in this.placements){const e=this.placements[t],o=r[t];o?(this.opacities[t]=new Oi(o,n,e.text,e.icon,null,e.clipped),i=i||e.text!==o.text.placed||e.icon!==o.icon.placed):(this.opacities[t]=new Oi(null,n,e.text,e.icon,e.skipFade,e.clipped),i=i||e.text||e.icon)}for(const t in r){const e=r[t];if(!this.opacities[t]){const r=new Oi(e,n,!1,!1);r.isHidden()||(this.opacities[t]=r,i=i||e.text.placed||e.icon.placed)}}for(const t in o)this.variableOffsets[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.variableOffsets[t]=o[t]);for(const t in s)this.placedOrientations[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.placedOrientations[t]=s[t]);i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const i=new Set;for(const n of e){const e=n.getBucket(t);e&&n.latestFeatureIndex&&t.fqid===e.layerIds[0]&&(this.updateBucketOpacities(e,i,n.collisionBoxArray),e.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(e,n.tileID),e.updateZOffset()))}}updateBucketOpacities(e,i,n){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const r=e.layers[0].layout,o=!!e.layers[0].dynamicFilter(),s=new Oi(null,0,!1,!1,!0),a=r.get("text-allow-overlap"),l=r.get("icon-allow-overlap"),c=r.get("text-variable-anchor"),u="map"===r.get("text-rotation-alignment"),h="map"===r.get("text-pitch-alignment"),d=new Oi(null,0,a&&(l||!e.hasIconData()||r.get("icon-optional")),l&&(a||!e.hasTextData()||r.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(n);const p=(t,e,i)=>{for(let n=0;n<e/4;n++)t.opacityVertexArray.emplaceBack(i)};let f=0;for(let n=0;n<e.symbolInstances.length;n++){const r=e.symbolInstances.get(n),{numHorizontalGlyphVertices:a,numVerticalGlyphVertices:l,crossTileID:m,numIconVertices:g}=r,_=i.has(m);let y=this.opacities[m];_?y=s:y||(y=d,this.opacities[m]=y),i.add(m);const v=a>0||l>0,x=g>0,b=this.placedOrientations[m],w=b===t.b6.vertical,E=b===t.b6.horizontal||b===t.b6.horizontalOnly;if(!v&&!x||y.isHidden()||f++,v){const t=Ji(y.text);p(e.text,a,w?Qi:t),p(e.text,l,E?Qi:t);const i=y.text.isHidden(),{leftJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:c}=r,u=e.text.placedSymbolArray,h=i||w?1:0;n>=0&&(u.get(n).hidden=h),o>=0&&(u.get(o).hidden=h),s>=0&&(u.get(s).hidden=h),c>=0&&(u.get(c).hidden=i||E?1:0);const d=this.variableOffsets[m];d&&this.markUsedJustification(e,d.anchor,r,b);const f=this.placedOrientations[m];f&&(this.markUsedJustification(e,"left",r,f),this.markUsedOrientation(e,f,r))}if(x){const t=Ji(y.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:n}=r,o=e.icon.placedSymbolArray,s=y.icon.isHidden()?1:0;i>=0&&(p(e.icon,g,w?Qi:t),o.get(i).hidden=s),n>=0&&(p(e.icon,r.numVerticalIconVertices,E?Qi:t),o.get(n).hidden=s)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const i=e.collisionArrays[n];if(i){let n=new t.P(0,0),s=!0;if(i.textBox||i.verticalTextBox){if(c){const t=this.variableOffsets[m];t?(n=Vi(t.anchor,t.width,t.height,t.textOffset,t.textScale),u&&n._rotate(h?this.transform.angle:-this.transform.angle)):s=!1}o&&(s=!y.clipped),i.textBox&&Hi(e.textCollisionBox.collisionVertexArray,y.text.placed,!s||w,n.x,n.y),i.verticalTextBox&&Hi(e.textCollisionBox.collisionVertexArray,y.text.placed,!s||E,n.x,n.y)}const a=s&&Boolean(!E&&i.verticalIconBox);i.iconBox&&Hi(e.iconCollisionBox.collisionVertexArray,y.icon.placed,a,r.hasIconTextFit?n.x:0,r.hasIconTextFit?n.y:0),i.verticalIconBox&&Hi(e.iconCollisionBox.collisionVertexArray,y.icon.placed,!a,r.hasIconTextFit?n.x:0,r.hasIconTextFit?n.y:0)}}}if(e.fullyClipped=0===f,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function Hi(t,e,i,n,r){t.emplaceBack(e?1:0,i?1:0,n||0,r||0),t.emplaceBack(e?1:0,i?1:0,n||0,r||0),t.emplaceBack(e?1:0,i?1:0,n||0,r||0),t.emplaceBack(e?1:0,i?1:0,n||0,r||0)}const Wi=Math.pow(2,25),qi=Math.pow(2,24),Xi=Math.pow(2,17),$i=Math.pow(2,16),Yi=Math.pow(2,9),Zi=Math.pow(2,8),Ki=Math.pow(2,1);function Ji(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*Wi+e*qi+i*Xi+e*$i+i*Yi+e*Zi+i*Ki+e}const Qi=0;class tn{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,e,i,n,r){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,n,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((t,e)=>t.sortKey-e.sortKey)));this._currentPartIndex<o.length;){const t=o[this._currentPartIndex];if(e.placeLayerBucketPart(t,this._seenCrossTileIDs,i,0===t.symbolInstanceStart),this._currentPartIndex++,r())return!0}return!1}}class en{constructor(t,e,i,n,r,o,s,a,l){this.placement=new Gi(t,r,o,s,a,l),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(e,i,n,r){const o=t.f.now(),s=()=>{const e=t.f.now()-o;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const o=i[e[this._currentPlacementIndex]],a=this.placement.collisionIndex.transform.zoom;if("symbol"===o.type&&(!o.minzoom||o.minzoom<=a)&&(!o.maxzoom||o.maxzoom>a)){const e=o,i=e.layout.get("symbol-z-elevate"),a=this._inProgressLayer=this._inProgressLayer||new tn(e),l=t.ag(o.source,o.scope);if(a.continuePlacement(i?r[l]:n[l],this.placement,this._showCollisionBoxes,o,s))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const nn=512/t.V/2;class rn{constructor(e,i,n){this.tileID=e,this.bucketInstanceId=n,this.index=new t.bg(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const r=e.canonical.x*t.V,o=e.canonical.y*t.V;for(let t=0;t<i.length;t++){const{key:e,crossTileID:n,tileAnchorX:s,tileAnchorY:a}=i.get(t),l=Math.floor((r+s)*nn),c=Math.floor((o+a)*nn);this.index.add(l,c),this.keys.push(e),this.crossTileIDs.push(n)}this.index.finish()}findMatches(e,i,n){const r=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),o=nn/Math.pow(2,i.canonical.z-this.tileID.canonical.z),s=i.canonical.x*t.V,a=i.canonical.y*t.V;for(let t=0;t<e.length;t++){const i=e.get(t);if(i.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=i,h=Math.floor((s+c)*o),d=Math.floor((a+u)*o),p=this.index.range(h-r,d-r,h+r,d+r);for(const t of p){const e=this.crossTileIDs[t];if(this.keys[t]===l&&!n.has(e)){n.add(e),i.crossTileID=e;break}}}}}class on{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class sn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const t in this.indexes){const i=this.indexes[t],n={};for(const t in i){const r=i[t];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),n[r.tileID.key]=r}this.indexes[t]=n}this.lng=t}addBucket(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let t=0;t<e.symbolInstances.length;t++)e.symbolInstances.get(t).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const n=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){const r=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in r){const o=r[i];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,n)}else{const o=r[t.scaledTo(Number(i)).key];o&&o.findMatches(e.symbolInstances,t,n)}}for(let t=0;t<e.symbolInstances.length;t++){const r=e.symbolInstances.get(t);r.crossTileID||(r.crossTileID=i.generate(),n.add(r.crossTileID))}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new rn(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const i of e.crossTileIDs)this.usedCrossTileIDs[t].delete(i)}removeStaleBuckets(t){let e=!1;for(const i in this.indexes){const n=this.indexes[i];for(const r in n)t[n[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[r]),delete n[r],e=!0)}return e}}class an{constructor(){this.layerIndexes={},this.crossTileIDs=new on,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,i,n){let r=this.layerIndexes[t.fqid];void 0===r&&(r=this.layerIndexes[t.fqid]=new sn);let o=!1;const s={};"globe"!==n.name&&r.handleWrapJump(i);for(const i of e){const e=i.getBucket(t);e&&t.fqid===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(i.tileID,e,this.crossTileIDs)&&(o=!0),s[e.bucketInstanceId]=!0)}return r.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(t){const e={};t.forEach((t=>{e[t]=!0}));for(const t in this.layerIndexes)e[t]||delete this.layerIndexes[t]}}class ln{constructor(t=0,e=0,i=0,n=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=n}interpolate(e,i,n){return null!=i.top&&null!=e.top&&(this.top=t.U(e.top,i.top,n)),null!=i.bottom&&null!=e.bottom&&(this.bottom=t.U(e.bottom,i.bottom,n)),null!=i.left&&null!=e.left&&(this.left=t.U(e.left,i.left,n)),null!=i.right&&null!=e.right&&(this.right=t.U(e.right,i.right,n)),this}getCenter(e,i){const n=t.aa((this.left+e-this.right)/2,0,e),r=t.aa((this.top+i-this.bottom)/2,0,i);return new t.P(n,r)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ln(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function cn(e,i){const n=t.bk(e,3);t.a6.fromQuat(e,i),t.bm(e,3,n)}function un(e,i){const n=t.bi.identity([]);return t.bi.rotateZ(n,n,-i),t.bi.rotateX(n,n,-e),n}function hn(e,i){const n=[e[0],e[1],0],r=[i[0],i[1],0];if(t.N.length(n)>=1e-15){const e=t.N.normalize([],n);t.N.scale(r,e,t.N.dot(r,e)),i[0]=r[0],i[1]=r[1]}const o=t.N.cross([],i,e);if(t.N.len(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return un(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),s)}class dn{constructor(t,e){this.position=t,this.orientation=e}get position(){return this._position}set position(e){if(e){const i=e instanceof t.L?e:new t.L(e[0],e[1],e[2]);this._renderWorldCopies&&(i.x=t.bh(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(e,i){if(this.orientation=null,!this.position)return;const n=this.position,r=this._elevation?this._elevation.getAtPointOrZero(t.L.fromLngLat(e)):0,o=t.L.fromLngLat(e,r),s=[o.x-n.x,o.y-n.y,o.z-n.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=hn(s,i)}setPitchBearing(e,i){this.orientation=un(t.bj(e),t.bj(-i))}}class pn{constructor(e,i){this._transform=t.a6.identity([]),this.orientation=i,this.position=e}get mercatorPosition(){const e=this.position;return new t.L(e[0],e[1],e[2])}get position(){const e=t.bk(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var i;e&&t.bm(this._transform,3,[(i=e)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||t.bi.identity([]),e&&cn(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,e){this._orientation=un(t,e),cn(this._transform,this._orientation)}forward(){const e=t.bk(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=t.bk(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=t.bk(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,i){const n=new Float64Array(16);return t.a6.invert(n,this.getWorldToCamera(e,i)),n}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,i,n){const r=this.position;t.N.scale(r,r,-e);const o=new Float64Array(16);return t.a6.fromScaling(o,[n,n,n]),t.a6.translate(o,o,r),o[10]*=i,o}getWorldToCamera(e,i){const n=new Float64Array(16),r=new Float64Array(4),o=this.position;return t.bi.conjugate(r,this._orientation),t.N.scale(o,o,-e),t.a6.fromQuat(n,r),t.a6.translate(n,n,o),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=i,n[9]*=i,n[10]*=i,n[11]*=i,n}getCameraToClipPerspective(e,i,n,r){const o=new Float64Array(16);return t.a6.perspective(o,e,i,n,r),o}getCameraToClipOrthographic(e,i,n,r,o,s){const a=new Float64Array(16);return t.a6.ortho(a,e,i,n,r,o,s),a}getDistanceToElevation(e,i=!1){const n=0===e?0:t.bl(e,i?t.au(this.position[1]):this.position[1]),r=this.forward();return(n-this.position[2])/r[2]}clone(){return new pn([...this.position],[...this.orientation])}}const fn=(t,e,i)=>(1-i)*t+i*e,mn=t=>t*t*t*t*t;class gn{constructor(e,i,n,r,o,s,a){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=i||22,this._minPitch=null==n?0:n,this._maxPitch=null==r?60:r,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new t.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ln,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new pn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new gn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(t,e=!1){const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(t||i)&&this._constrainCamera(e),this._calcMatrices()}getProjection(){return t.ac(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=t.bo(this.projectionOptions);const r=!e(n,this.getProjection());return r&&this._calcMatrices(),this.mercatorFromTransition=!1,r}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.bo({name:"mercator"});const i=e!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return t.bh(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const i=-e*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=t.b4.create(),t.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const i=t.aa(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=t.bj(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,e=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!e||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;e||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let r=0,o=0;for(let s=0;s<i.length;s++){const a=new t.P(i[s][0]*this.width,n+i[s][1]*(this.height-n)),l=e.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*c,o+=c}return 0===o?NaN:r/o}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,e=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*e,n=this._mercatorZfromZoom(t),r=this._mercatorZfromZoom(this._maxZoom),o=Math.max(n-i,r);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(e){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let n;n=e.z<this._camera.position[2]?[i.x,i.y,i.z]:[e.x,e.y,e.z];const r=t.N.length(t.N.sub([],this._camera.position,n));return t.aa(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let i=!1;if(e.orientation&&!t.bi.exactEquals(e.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(e.orientation)),e.position){const n=[e.position.x,e.position.y,e.position.z];t.N.exactEquals(n,this._camera.position)||(this._setCameraPosition(n),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,i=new dn;return i.position=new t.L(e[0],e[1],e[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(e){if(!t.bi.length(e))return!1;t.bi.normalize(e,e);const i=t.N.transformQuat([],[0,0,-1],e),n=t.N.transformQuat([],[0,-1,0],e);if(n[2]<0)return!1;const r=hn(i,n);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(e){const i=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;e[2]=t.aa(e[2],r/n,r/i),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const i=[new t.bp(0,e)];if(this.renderWorldCopies){const n=this.pointCoordinate(new t.P(0,0)),r=this.pointCoordinate(new t.P(this.width,0)),o=this.pointCoordinate(new t.P(this.width,this.height)),s=this.pointCoordinate(new t.P(0,this.height)),a=Math.floor(Math.min(n.x,r.x,o.x,s.x)),l=Math.floor(Math.max(n.x,r.x,o.x,s.x)),c=1;for(let n=a-c;n<=l+c;n++)0!==n&&i.push(new t.bp(n,e))}return i}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,i,n){let r=[];if(0===i[0]&&0===i[1])return r;for(const n of e){const e=n.canonical,o=n.overscaledZ,s=n.wrap,a=1<<e.z,l=e.x+1<a,c=e.x>0,u=e.y+1<a,h=e.y>0,d=n.wrap-(c?0:1),p=n.wrap+(l?0:1),f=c?e.x-1:a-1,m=l?e.x+1:0;i[0]<0?(r.push(new t.am(o,p,e.z,m,e.y)),i[1]<0&&u&&(r.push(new t.am(o,s,e.z,e.x,e.y+1)),r.push(new t.am(o,p,e.z,m,e.y+1))),i[1]>0&&h&&(r.push(new t.am(o,s,e.z,e.x,e.y-1)),r.push(new t.am(o,p,e.z,m,e.y-1)))):i[0]>0?(r.push(new t.am(o,d,e.z,f,e.y)),i[1]<0&&u&&(r.push(new t.am(o,s,e.z,e.x,e.y+1)),r.push(new t.am(o,d,e.z,f,e.y+1))),i[1]>0&&h&&(r.push(new t.am(o,s,e.z,e.x,e.y-1)),r.push(new t.am(o,d,e.z,f,e.y-1)))):i[1]<0&&u?r.push(new t.am(o,s,e.z,e.x,e.y+1)):h&&r.push(new t.am(o,s,e.z,e.x,e.y-1))}if(r.length>1){r.sort(((t,e)=>t.overscaledZ-e.overscaledZ||t.wrap-e.wrap||t.canonical.z-e.canonical.z||t.canonical.x-e.canonical.x||t.canonical.y-e.canonical.y));let t=0,e=0;for(;e<r.length;)r[e].equals(r[t])?++e:r[++t]=r[e++];r.length=t+1}const o=[];for(const t of r)r.some((e=>t.isChildOf(e)))||o.push(t);return r=o.filter((t=>!e.some((e=>!!(t.overscaledZ<n&&e.isChildOf(t))||t.equals(e)||t.isChildOf(e))))),r}coveringTiles(e){let i=this.coveringZoomLevel(e);const n=i,r=this.elevation&&this.elevation.exaggeration(),o=r&&!e.isTerrainDEM,s="mercator"===this.projection.name;if(void 0!==e.minzoom&&i<e.minzoom)return[];void 0!==e.maxzoom&&i>e.maxzoom&&(i=e.maxzoom);const a=this.locationCoordinate(this.center),l=this.center.lat,c=1<<i,u=[c*a.x,c*a.y,0],h="globe"===this.projection.name,d=!h,p=t.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,d),f=h?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),m=c*t.bl(1,this.center.lat),g=this._camera.position[2]/t.bl(1,this.center.lat),_=[c*f.x,c*f.y,g*(d?1:m)],y=h||r,v=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),x=this.isLODDisabled(!0)?i:0;let b;if(this._elevation&&e.isTerrainDEM)b=1e4*this._elevation.exaggeration();else if(this._elevation){const t=this._elevation.getMinMaxForVisibleTiles();b=t?t.max:this._centerAltitude}else b=this._centerAltitude;const w=e.isTerrainDEM?-b:this._elevation?this._elevation.getMinElevationBelowMSL():0,E=this.projection.isReprojectedInTileSpace?t.br(this):1,S=e=>{const i=1/4e4,n=new t.L(e.x+i,e.y,e.z),r=new t.L(e.x,e.y+i,e.z),o=e.toLngLat(),s=n.toLngLat(),a=r.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=this.locationCoordinate(a),h=Math.hypot(c.x-l.x,c.y-l.y),d=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*d)*E/i},T=e=>{const i=b,n=w;return{aabb:t.bu(this,c,0,0,0,e,n,i,this.projection),zoom:0,x:0,y:0,minZ:n,maxZ:i,wrap:e,fullyVisible:!1}},M=[];let I=[];const C=i,A=e.reparseOverscaled?n:i,P=t=>t*t,L=P((g-this._centerAltitude)*m),R=t=>{if(!this._elevation||!t.tileID||!s)return;const e=this._elevation.getMinMaxForTile(t.tileID),i=t.aabb;e?(i.min[2]=e.min,i.max[2]=e.max,i.center[2]=(i.min[2]+i.max[2])/2):(t.shouldSplit=D(t),t.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},D=e=>{if(e.zoom<x)return!0;if(e.zoom===C)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const i=e.aabb.distanceX(_),r=e.aabb.distanceY(_);let s=L,a=1;if(h){s=P(e.aabb.distanceZ(_));const i=Math.pow(2,e.zoom),n=t.au((e.y+1)/i),r=t.au(e.y/i),o=Math.min(Math.max(l,n),r),c=t.bJ(o)/t.bJ(l);if(a=o===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,c/this._mercatorScaleRatio),this.zoom<=t.bG&&e.zoom===C-1&&c>=.9)return!0}else if(o&&(s=P(e.aabb.distanceZ(_)*m)),this.projection.isReprojectedInTileSpace&&n<=5){const i=Math.pow(2,e.zoom),n=S(new t.L((e.x+.5)/i,(e.y+.5)/i));a=n>.85?1:n}const c=i*i+r*r+s,u=P((1<<C-e.zoom)*v*a*((t,e)=>{if(e*P(.707)<t)return 1;const i=Math.sqrt(e/t);return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(s,L),c));return c<u};if(this.renderWorldCopies)for(let t=1;t<=3;t++)M.push(T(-t)),M.push(T(t));for(M.push(T(0));M.length>0;){const n=M.pop(),r=n.x,a=n.y;let l=n.fullyVisible;const d=()=>"globe"===this.projection.name&&(0===n.y||n.y===(1<<n.zoom)-1);if(!l){let e=y?n.aabb.intersects(p):n.aabb.intersectsFlat(p);if(0===e&&d()){const i=new t.bs(n.zoom,r,a);e=t.bt(this,c,i,!0).intersects(p)}if(0===e)continue;l=2===e}if(n.zoom!==C&&D(n))for(let e=0;e<4;e++){const i=(r<<1)+e%2,u=(a<<1)+(e>>1),d={aabb:s?n.aabb.quadrant(e):t.bu(this,c,n.zoom+1,i,u,n.wrap,n.minZ,n.maxZ,this.projection),zoom:n.zoom+1,x:i,y:u,wrap:n.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:n.minZ,maxZ:n.maxZ};o&&!h&&(d.tileID=new t.am(n.zoom+1===C?A:n.zoom+1,n.wrap,n.zoom+1,i,u),R(d)),M.push(d)}else{const o=n.zoom===C?A:n.zoom;if(e.minzoom&&e.minzoom>o)continue;if(!l){let e=y?n.aabb.intersectsPrecise(p):n.aabb.intersectsPreciseFlat(p);if(0===e&&d()){const i=new t.bs(n.zoom,r,a);e=t.bt(this,c,i,!0).intersectsPrecise(p)}if(0===e)continue}const s=u[0]-(.5+r+(n.wrap<<n.zoom))*(1<<i-n.zoom),h=u[1]-.5-a,f=n.tileID?n.tileID:new t.am(o,n.wrap,n.zoom,r,a);I.push({tileID:f,distanceSq:s*s+h*h})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,n=this.horizonLineFromTop();I=I.filter((r=>{const o=[0,0,0,1],s=[t.V,t.V,0,1],a=this.calculateFogTileMatrix(r.tileID.toUnwrapped());t.a7.transformMat4(o,o,a),t.a7.transformMat4(s,s,a);const l=t.a7.min([],o,s),c=t.a7.max([],o,s),u=t.bv(l,c);if(0===u)return!0;let h=!1;const d=this._elevation;if(d&&u>i&&0!==n){const i=this.calculateProjMatrix(r.tileID.toUnwrapped());let o;e.isTerrainDEM||(o=d.getMinMaxForTile(r.tileID)),o||(o={min:w,max:b});const s=t.bH(this.rotation),a=[s[0]*t.V,s[1]*t.V,o.max];t.N.transformMat4(a,a,i),h=(1-a[1])*this.height*.5<n}return u<i||h}))}return I.sort(((t,e)=>t.distanceSq-e.distanceSq)).map((t=>t.tileID))}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const i=t.aa(e.lat,-t.bw,t.bw),n=this.projection.project(e.lng,i);return new t.P(n.x*this.worldSize,n.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,i){let n,r;const o=this.centerPoint;if("globe"===this.projection.name){const t=this.worldSize;n=(i.x-o.x)/t,r=(i.y-o.y)/t}else{const t=this.pointCoordinate(i),e=this.pointCoordinate(o);n=t.x-e.x,r=t.y-e.y}const s=this.locationCoordinate(e);this.setLocation(new t.L(s.x-n,s.y-r))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(e,i){const n=i?t.bl(i,e.lat):void 0,r=this.projection.project(e.lng,e.lat);return new t.L(r.x,r.y,n)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(e,i){const n=null!=i?i:this._centerAltitude,r=[e.x,e.y,0,1],o=[e.x,e.y,1,1];t.a7.transformMat4(r,r,this.pixelMatrixInverse),t.a7.transformMat4(o,o,this.pixelMatrixInverse);const s=o[3];t.a7.scale(r,r,1/r[3]),t.a7.scale(o,o,1/s);const a=r[2],l=o[2];return{p0:r,p1:o,t:a===l?0:(n-a)/(l-a)}}screenPointToMercatorRay(e){const i=[e.x,e.y,0,1],n=[e.x,e.y,1,1];return t.a7.transformMat4(i,i,this.pixelMatrixInverse),t.a7.transformMat4(n,n,this.pixelMatrixInverse),t.a7.scale(i,i,1/i[3]),t.a7.scale(n,n,1/n[3]),i[2]=t.bl(i[2],this._center.lat)*this.worldSize,n[2]=t.bl(n[2],this._center.lat)*this.worldSize,t.a7.scale(i,i,1/this.worldSize),t.a7.scale(n,n,1/this.worldSize),new t.a2([i[0],i[1],i[2]],t.N.normalize([],t.N.sub([],n,i)))}rayIntersectionCoordinate(e){const{p0:i,p1:n,t:r}=e,o=t.bl(i[2],this._center.lat),s=t.bl(n[2],this._center.lat);return new t.L(t.U(i[0],n[0],r)/this.worldSize,t.U(i[1],n[1],r)/this.worldSize,t.U(o,s,r))}pointCoordinate(t,e=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,e)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let i=this.projection.pointCoordinate3D(this,e.x,e.y);if(i)return new t.L(i[0],i[1],i[2]);let n=0,r=this.horizonLineFromTop();if(e.y>r)return this.pointCoordinate(e);const o=.02*r,s=e.clone();for(let e=0;e<10&&r-n>o;e++){s.y=t.U(n,r,.66);const e=this.projection.pointCoordinate3D(this,s.x,s.y);e?(r=s.y,i=e):n=s.y}return i?new t.L(i[0],i[1],i[2]):this.pointCoordinate(e)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=t.bx)return!this.isPointAboveHorizon(e);const i=this.pointCoordinate(e);return i.y>=0&&i.y<=1}_coordinatePoint(e,i){const n=i&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,r=[e.x*this.worldSize,e.y*this.worldSize,n+e.toAltitude(),1];return t.a7.transformMat4(r,r,this.pixelMatrix),r[3]>0?new t.P(r[0]/r[3],r[1]/r[3]):new t.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:i}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,r=this.width-this._edgeInsets.right,o=this.pointLocation3D(new t.P(i,e)),s=this.pointLocation3D(new t.P(r,e)),a=this.pointLocation3D(new t.P(r,n)),l=this.pointLocation3D(new t.P(i,n));let c=Math.min(o.lng,s.lng,a.lng,l.lng),u=Math.max(o.lng,s.lng,a.lng,l.lng),h=Math.min(o.lat,s.lat,a.lat,l.lat),d=Math.max(o.lat,s.lat,a.lat,l.lat);const p=Math.pow(2,-this.zoom)/16*270,f="globe"===this.projection.name?1:4,m=(e,i,n,r,o)=>{const s=(e+n)/2,a=(i+r)/2,l=new t.P(s,a),{lng:g,lat:_}=this.pointLocation3D(l),y=Math.max(0,c-g,h-_,g-u,_-d);c=Math.min(c,g),u=Math.max(u,g),h=Math.min(h,_),d=Math.max(d,_),(o<f||y>p)&&(m(e,i,s,a,o+1),m(s,a,n,r,o+1))};if(m(i,e,r,e,1),m(r,e,r,n,1),m(r,n,i,n,1),m(i,n,i,e,1),"globe"===this.projection.name){const[e,i]=t.by(this);e?(d=90,u=180,c=-180):i&&(h=-90,u=180,c=-180)}return new t.ad(new t.bn(c,h),new t.bn(u,d))}_getBoundsRectangular(e,i){const{top:n,left:r}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,a=new t.P(r,n),l=new t.P(s,n),c=new t.P(s,o),u=new t.P(r,o);let h=this.pointCoordinate(a,e),d=this.pointCoordinate(l,e);const p=this.pointCoordinate(c,i),f=this.pointCoordinate(u,i),m=(t,e)=>(e.y-t.y)/(e.x-t.x);return h.y>1&&d.y>=0?h=new t.L((1-f.y)/m(f,h)+f.x,1):h.y<0&&d.y<=1&&(h=new t.L(-f.y/m(f,h)+f.x,0)),d.y>1&&h.y>=0?d=new t.L((1-p.y)/m(p,d)+p.x,1):d.y<0&&h.y<=1&&(d=new t.L(-p.y/m(p,d)+p.x,0)),(new t.ad).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(p))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const e=t.visibleDemTiles.reduce(((t,e)=>{if(e.dem){const i=e.dem.tree;t.min=Math.min(t.min,i.minimums[0]),t.max=Math.max(t.max,i.maximums[0])}return t}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(e.min*t.exaggeration(),e.max*t.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-e*(1-this._horizonShift);return t?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-t.bw,this.maxLat=t.bw,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.a5(this.minLng)*this.tileSize,this.worldMaxX=t.a5(this.maxLng)*this.tileSize,this.worldMinY=t.ae(this.maxLat)*this.tileSize,this.worldMaxY=t.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,e){return this.projection.createTileMatrix(this,e,t)}calculateDistanceTileData(e){const i=e.key,n=this._distanceTileDataCache;if(n[i])return n[i];const r=e.canonical,o=1/this.height,s=this.cameraWorldSize,a=s/this.zoomScale(r.z),l=(r.x+Math.pow(2,r.z)*e.wrap)*a,c=r.y*a,u=this.point;u.x*=s/this.worldSize,u.y*=s/this.worldSize;const h=this.angle,d=Math.sin(-h),p=-Math.cos(-h);return n[i]={bearing:[d,p],center:[(u.x-l)*o,(u.y-c)*o],scale:a/t.V*o},n[i]}calculateFogTileMatrix(e){const i=e.key,n=this._fogTileMatrixCache;if(n[i])return n[i];const r=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return t.a6.multiply(r,this.worldToFogMatrix,r),n[i]=new Float32Array(r),n[i]}calculateProjMatrix(e,i=!1,n=!1){const r=e.key;let o;if(o=n?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,o[r])return o[r];const s=this.calculatePosMatrix(e,this.worldSize);let a;return a=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,t.a6.multiply(s,a,s),o[r]=new Float32Array(s),o[r]}calculatePixelsToTileUnitsMatrix(e){const i=e.tileID.key,n=this._pixelsToTileUnitsCache;if(n[i])return n[i];const r=t.bz(e,this);return n[i]=r,n[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const e=1/this.worldSize,i=t.a6.fromScaling([],[e,e,e]);return t.a6.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const e=this._elevation;this._updateCameraState();const i=t.bl(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(i),r=this._camera.forward(),o=t.bl(1,this._center.lat);n[2]/=o,r[2]/=o,t.N.normalize(r,r);const s=e.raycast(n,r,e.exaggeration());if(s){const e=t.N.scaleAndAdd([],n,r,s),i=new t.L(e[0],e[1],t.bl(e[2],t.au(e[1]))),a=(i.z+t.N.length([i.x-n[0],i.y-n[1],i.z-n[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(e=!1){if(!this._elevation)return;const i=this._elevation,n=t.bl(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(n),o=i.getAtPointOrZero(new t.L(...r)),s=this.pixelsPerMeter/this.worldSize*o,a=this._minimumHeightOverTerrain(),l=r[2]-s;if(l<=a)if(l<0||e){const e=this.locationCoordinate(this._center,this._centerAltitude),i=[r[0],r[1],e.z-r[2]],n=t.N.length(i);i[2]-=(a-l)/this._pixelsPerMercatorPixel;const o=t.N.length(i);if(0===o)return;t.N.scale(i,i,n/o*this._pixelsPerMercatorPixel),this._camera.position=[r[0],r[1],e.z*this._pixelsPerMercatorPixel-i[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const i=this.center;return i.lat=t.aa(i.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(i.lng=t.aa(i.lng,this.minLng,this.maxLng)),this.center=i,void(this._constraining=!1)}const i=this._unmodified,{x:n,y:r}=this.point;let o=0,s=n,a=r;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,h=this.worldMaxY*this.scale;if(r-c<u&&(a=u+c),r+c>h&&(a=h-c),h-u<this.height&&(o=Math.max(o,this.height/(h-u)),a=(h+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const t=this.worldMinX*this.scale,e=this.worldMaxX*this.scale,i=this.worldSize/2-(t+e)/2;s=(n+i+this.worldSize)%this.worldSize-i,s-l<t&&(s=t+l),s+l>e&&(s=e-l),e-t<this.width&&(o=Math.max(o,this.width/(e-t)),s=(e+t)/2)}s===n&&a===r||(this.center=this.unproject(new t.P(s,a))),o&&(this.zoom+=this.scaleZoom(o)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,i="globe"===this.projection.name,n=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=t.bl(1,this.center.lat)/t.bl(1,t.bI));const r=t.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,r),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const o="meters"===this.projection.zAxisUnit?n:1,s=this._camera.getWorldToCamera(this.worldSize,o);let a;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-e.x/this.width,l[9]=2*e.y/this.height,this.isOrthographic){let t=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),i=t*this.aspect,n=-i,r=-t;i-=e.x,n-=e.x,t+=e.y,r+=e.y,a=this._camera.getCameraToClipOrthographic(n,i,r,t,this._nearZ,this._farZ),((t,e,i,n)=>{for(let r=0;r<16;r++)t[r]=fn(e[r],i[r],n)})(a,a,l,mn(this.pitch>=15?1:this.pitch/15))}else a=l;const c=t.a6.mul([],l,s);let u=t.a6.mul([],a,s);if(this.projection.isReprojectedInTileSpace){const e=this.locationCoordinate(this.center),i=t.a6.identity([]);t.a6.translate(i,i,[e.x*this.worldSize,e.y*this.worldSize,0]),t.a6.multiply(i,i,t.bB(this)),t.a6.translate(i,i,[-e.x*this.worldSize,-e.y*this.worldSize,0]),t.a6.multiply(u,u,i),t.a6.multiply(c,c,i),this.inverseAdjustmentMatrix=t.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=t.a6.scale([],u,[this.worldSize,this.worldSize,this.worldSize/o,1]),this.projMatrix=u,this.invProjMatrix=t.a6.invert(new Float64Array(16),this.projMatrix),i){const i=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);i[8]=2*-e.x/this.width,i[9]=2*e.y/this.height,this.expandedFarZProjMatrix=t.a6.mul([],i,s)}else this.expandedFarZProjMatrix=this.projMatrix;const h=t.a6.invert([],a);this.frustumCorners=t.bD.fromInvProjectionMatrix(h,this.horizonLineFromTop(),this.height),this.cameraFrustum=t.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const d=new Float32Array(16);t.a6.identity(d),t.a6.scale(d,d,[1,-1,1]),t.a6.rotateX(d,d,this._pitch),t.a6.rotateZ(d,d,this.angle);const p=t.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=t.a6.clone(p);const f=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;p[8]=2*-e.x/this.width,p[9]=2*(e.y+f)/this.height,this.skyboxMatrix=t.a6.multiply(d,p,d);const m=this.point,g=m.x,_=m.y,y=this.width%2/2,v=this.height%2/2,x=Math.cos(this.angle),b=Math.sin(this.angle),w=g-Math.round(g)+x*y+b*v,E=_-Math.round(_)+x*v+b*y,S=new Float64Array(u);if(t.a6.translate(S,S,[w>.5?w-1:w,E>.5?E-1:E,0]),this.alignedProjMatrix=S,u=t.a6.create(),t.a6.scale(u,u,[this.width/2,-this.height/2,1]),t.a6.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=t.a6.create(),t.a6.scale(u,u,[1,-1,1]),t.a6.translate(u,u,[-1,-1,0]),t.a6.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=t.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},u=t.a6.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=t.bE(this);const e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t.N.transformMat4(e,e,s),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,n=this._camera.position,r=1/this.height/this._pixelsPerMercatorPixel,o=[e,e,i];t.N.scale(o,o,r),t.N.scale(n,n,-1),t.N.multiply(n,n,o);const s=t.a6.create();t.a6.translate(s,s,n),t.a6.scale(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,i,r)}_computeCameraPosition(t){const e=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),n=this.point,r=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*e-t/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-i[0]*r,n.y/this.worldSize-i[1]*r,t/this.worldSize*this._centerAltitude-i[2]*r]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=this._camera.position[2],r=e[2];let o=1;this.projection.wrap&&(this.center=this.center.wrap()),r>0&&(o=Math.min((i-n)/r,1)),this._camera.position=t.N.scaleAndAdd([],this._camera.position,e,o),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,i=this._camera.forward(),{pitch:n,bearing:r}=this._camera.getPitchBearing(),o=t.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.bj(this._maxPitch)),a=Math.max((e[2]-o)/Math.cos(n),s),l=this._zoomFromMercatorZ(a);t.N.scaleAndAdd(e,e,i,a),this._pitch=t.aa(n,t.bj(this.minPitch),t.bj(this.maxPitch)),this.angle=t.bh(r,-Math.PI,Math.PI),this._setZoom(t.aa(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.L(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(e){let i=0,n=t.bx,r=0,o=1/0;for(;n-i>1e-6&&n>i;){const t=i+.5*(n-i),s=this.tileSize*Math.pow(2,t),a=this.getCameraToCenterDistance(this.projection,t,s),l=this.scaleZoom(a/(e*this.tileSize)),c=Math.abs(t-l);c<o&&(o=c,r=t),t<l?i=t:n=t}return r}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,i){const n=Math.min(e.x,i.x),r=Math.max(e.x,i.x),o=Math.min(e.y,i.y),s=Math.max(e.y,i.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new t.P(n,o),new t.P(r,s),new t.P(n,s),new t.P(r,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const t of a){const e=this.pointRayIntersection(t);if(e.t<0)return!0;const i=this.rayIntersectionCoordinate(e);if(i.x<l||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.P(0,0),new t.P(this.width,this.height))}zoomDeltaToMovement(e,i){const n=t.N.length(t.N.sub([],this._camera.position,e)),r=this._zoomFromMercatorZ(n)+i;return n-this._mercatorZfromZoom(r)}getCameraPoint(){if("globe"===this.projection.name){const e=function([e,i,n],r){const o=[e,i,n,1];t.a7.transformMat4(o,o,r);const s=o[3]=Math.max(o[3],1e-6);return o[0]/=s,o[1]/=s,o[2]/=s,o}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.P(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,e))}}getCameraToCenterDistance(e,i=this.zoom,n=this.worldSize){const r=t.bA(e,i,this.width,this.height,1024),o=e.pixelSpaceConversion(this.center.lat,n,r);let s=.5/Math.tan(.5*this._fov)*this.height*o;return this.isOrthographic&&(s=fn(1,s,mn(this.pitch>=15?1:this.pitch/15))),s}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&t.a6.multiply(e,e,this.globeMatrix),e}getFrustum(e){return t.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,"meters"===this.projection.zAxisUnit)}}const _n={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},yn=(e,i)=>{if(i>0&&e.terrain&&t.w("Cutoff is currently disabled on terrain"),i<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=e.transform,r=Math.max(Math.abs(n._zoom-(e.minCutoffZoom-1)),1),o=n.isLODDisabled(!1)?t.O(60,45,n.pitch):t.O(30,15,n.pitch),s=n._farZ-n._nearZ,a=i*n.height,l=((1-(c=o))*n.cameraToCenterDistance+c*(n._farZ+a))*r;var c;return{shouldRenderCutoff:o<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(l-n._nearZ)/s,(l-a-n._nearZ)/s]}}},vn={cascadeCount:2,shadowMapResolution:2048};class xn{constructor(t,e){this.aabb=t,this.lastCascade=e}}class bn{add(t,e){const i=this.receivers[t.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],e.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],e.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],e.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],e.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],e.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],e.max[2])):this.receivers[t.key]=new xn(e,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(e,i,n){const r=t.bS.fromPoints(e.points);let o=0;for(const e in this.receivers){const s=this.receivers[e];if(!s)continue;if(!r.intersectsAabb(s.aabb))continue;s.aabb.min=r.closestPoint(s.aabb.min),s.aabb.max=r.closestPoint(s.aabb.max);const a=s.aabb.getCorners();for(let e=0;e<n.length;e++){let r=!0;for(const o of a){const s=[o[0]*i,o[1]*i,o[2]];if(t.N.transformMat4(s,s,n[e].matrix),s[0]<-1||s[0]>1||s[1]<-1||s[1]>1){r=!1;break}}if(s.lastCascade=e,o=Math.max(o,e),r)break}}return o+1}}class wn{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new bn,this._depthMode=new Ae(t.context.gl.LEQUAL,Ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,t.tp.registerParameter(vn,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(vn,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,i){const n=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const r=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||r<=0)return;if(this._shadowLayerCount=n.style.order.reduce(((t,i)=>{const r=n.style._mergedLayers[i];return t+(r.hasShadowPass()&&!r.isHidden(e.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this._enabled)return;const o=n.context,s=vn.shadowMapResolution,a=vn.shadowMapResolution;if(0===this._cascades.length||vn.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let e=0;e<vn.cascadeCount;++e){const e=n._shadowMapDebug,i=o.gl,r=o.createFramebuffer(s,a,e,"texture"),l=new t.T(o,{width:s,height:a,data:null},i.DEPTH_COMPONENT);if(r.depthAttachment.set(l.texture),e){const e=new t.T(o,{width:s,height:a,data:null},i.RGBA);r.colorAttachment.set(e.texture)}this._cascades.push({framebuffer:r,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new t.bq,scale:0})}}this.shadowDirection=Sn(i);let l=0;if(e.elevation){const t=e.elevation,i=[1e4,-1e4];t.visibleDemTiles.filter((t=>t.dem)).forEach((t=>{const e=t.dem.tree;i[0]=Math.min(i[0],e.minimums[0]),i[1]=Math.max(i[1],e.maximums[0])})),1e4!==i[0]&&(l=(i[1]-i[0])*t.exaggeration())}const c=1.5*e.cameraToCenterDistance,u=3*c,h=new Float64Array(16);for(let i=0;i<this._cascades.length;++i){const n=this._cascades[i];let r=e.height/50,o=1;1===vn.cascadeCount?o=u:0===i?o=c:(r=c,o=u);const[s,a]=Mn(e,this.shadowDirection,r,o,vn.shadowMapResolution,l);n.scale=e.scale,n.matrix=s,n.boundingSphereRadius=a,t.a6.invert(h,n.matrix),n.frustum=t.bq.fromInvProjectionMatrix(h,1,0,!0),n.far=o}const d=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[d].far,this._cascades[d].far],this._uniformValues.u_shadow_intensity=r,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/vn.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=vn.shadowMapResolution,this._uniformValues.u_shadowmap_0=_n.ShadowMap0,this._uniformValues.u_shadowmap_1=_n.ShadowMap0+1,this._groundShadowTiles=n.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const p=n.transform.elevation;for(const t of this._groundShadowTiles){let e={min:0,max:0};if(p){const i=p.getMinMaxForTile(t);i&&(e=i)}this.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}get enabled(){return this._enabled}set enabled(t){this._enabled=t}drawShadowPass(e,i){if(!this._enabled)return;const n=this.painter,r=n.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(n.transform.getFrustum(0),n.transform.worldSize,this._cascades),r.viewport.set([0,0,vn.shadowMapResolution,vn.shadowMapResolution]);for(let o=0;o<this._numCascadesToRender;++o){n.currentShadowCascade=o,r.bindFramebuffer.set(this._cascades[o].framebuffer.framebuffer),r.clear({color:t.ax.white,depth:1});for(const t of e.order){const r=e._mergedLayers[t];if(!r.hasShadowPass()||r.isHidden(n.transform.zoom))continue;const o=e.getLayerSourceCache(r),s=o?i[o.id]:void 0;("model"===r.type||s&&s.length)&&n.renderLayer(n,o,r,s)}}n.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const t=this.painter,e=t.style,i=t.context,n=e.directionalLight,r=e.ambientLight;if(!n||!r)return;const o=[],s=yn(t,t.longestCutoffRange);s.shouldRenderCutoff&&o.push("RENDER_CUTOFF");const a=Tn(n,r),l=new Ae(i.gl.LEQUAL,Ae.ReadOnly,t.depthRangeFor3D);for(const e of this._groundShadowTiles){const n=e.toUnwrapped(),r=t.isTileAffectedByFog(e),c=t.getOrCreateProgram("groundShadow",{defines:o,overrideFog:r});this.setupShadows(n,c),t.uploadCommonUniforms(i,c,n,null,s);const u={u_matrix:t.transform.calculateProjMatrix(n),u_ground_shadow_factor:a};c.draw(t,i.gl.TRIANGLES,l,Le.disabled,De.multiply,Oe.disabled,u,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?De.unblended:De.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){const i=this.painter.transform,n=i.calculatePosMatrix(e,i.worldSize);return t.a6.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}calculateShadowPassMatrixFromMatrix(e){return t.a6.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,i,n,r=0){if(!this._enabled)return;const o=this.painter.transform,s=this.painter.context,a=s.gl,l=this._uniformValues,c=new Float64Array(16),u=o.calculatePosMatrix(e,o.worldSize);for(let e=0;e<this._cascades.length;e++)t.a6.multiply(c,this._cascades[e].matrix,u),l[0===e?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(c),s.activeTexture.set(a.TEXTURE0+_n.ShadowMap0+e),this._cascades[e].texture.bind(a.NEAREST,a.CLAMP_TO_EDGE);if(this.useNormalOffset=!!n,this.useNormalOffset){const i=t.bR(e.canonical),s=2/o.tileSize*t.V/vn.shadowMapResolution,a=s*this._cascades[0].boundingSphereRadius,c=s*this._cascades[this._cascades.length-1].boundingSphereRadius,u=("vector-tile"===n?1:3)/Math.pow(2,r-e.canonical.z-(1-o.zoom+Math.floor(o.zoom)));l.u_shadow_normal_offset=[i,a*u,c*u],l.u_shadow_bias=[6e-5,.0012,.012]}else l.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(s,l)}setupShadowsFromMatrix(e,i,n=!1){if(!this._enabled)return;const r=this.painter.context,o=r.gl,s=this._uniformValues,a=new Float64Array(16);for(let i=0;i<vn.cascadeCount;i++)t.a6.multiply(a,this._cascades[i].matrix,e),s[0===i?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(a),r.activeTexture.set(o.TEXTURE0+_n.ShadowMap0+i),this._cascades[i].texture.bind(o.NEAREST,o.CLAMP_TO_EDGE);if(this.useNormalOffset=n,n){const t=5;s.u_shadow_normal_offset=[1,t,t],s.u_shadow_bias=[6e-5,.0012,.012]}else s.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(r,s)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,i,n,r){if(r[2]>=0)return{};const o=function(e,i,n){const r=n/(1<<e.canonical.z);return new t.bS([e.canonical.x*r+e.wrap*n,e.canonical.y*r+e.wrap*n,0],[(e.canonical.x+1)*r+e.wrap*n,(e.canonical.y+1)*r+e.wrap*n,i])}(e,i,n).getCorners(),s=i/-r[2];r[0]<0?(t.N.add(o[0],o[0],[r[0]*s,0,0]),t.N.add(o[3],o[3],[r[0]*s,0,0])):r[0]>0&&(t.N.add(o[1],o[1],[r[0]*s,0,0]),t.N.add(o[2],o[2],[r[0]*s,0,0])),r[1]<0?(t.N.add(o[0],o[0],[0,r[1]*s,0]),t.N.add(o[1],o[1],[0,r[1]*s,0])):r[1]>0&&(t.N.add(o[2],o[2],[0,r[1]*s,0]),t.N.add(o[3],o[3],[0,r[1]*s,0]));const a={};return a.vertices=o,a.planes=[En(o[1],o[0],o[4]),En(o[2],o[1],o[5]),En(o[3],o[2],o[6]),En(o[0],o[3],o[7])],a}addShadowReceiver(e,i,n){this._receivers.add(e,t.bS.fromTileIdAndHeight(e,i,n))}getMaxCascadeForTile(t){const e=this._receivers.get(t);return e&&e.lastCascade?e.lastCascade:0}}function En(e,i,n){const r=t.N.sub([],n,i),o=t.N.sub([],e,i),s=t.N.cross([],r,o),a=t.N.length(s);return 0===a?[0,0,1,0]:(t.N.scale(s,s,1/a),[s[0],s[1],s[2],-t.N.dot(s,i)])}function Sn(e){const i=e.properties.get("direction"),n=t.bQ(i.x,i.y,i.z);n[2]=t.aa(n[2],0,75);const r=t.bT([n[0],n[1],n[2]]);return t.N.fromValues(r.x,r.y,r.z)}function Tn(e,i){const n=e.properties.get("color"),r=e.properties.get("intensity"),o=e.properties.get("direction"),s=[o.x,o.y,o.z],a=i.properties.get("color"),l=i.properties.get("intensity"),c=Math.max(t.N.dot([0,0,1],s),0),u=[0,0,0];t.N.scale(u,a.toArray01Linear().slice(0,3),l);const h=[0,0,0];return t.N.scale(h,n.toArray01Linear().slice(0,3),c*r),t.bU([u[0]>0?u[0]/(u[0]+h[0]):0,u[1]>0?u[1]/(u[1]+h[1]):0,u[2]>0?u[2]/(u[2]+h[2]):0])}function Mn(e,i,n,r,o,s){const a=e.zoom,l=e.scale,c=e.worldSize,u=1/c,h=e.aspect,d=Math.sqrt(1+h*h)*Math.tan(.5*e.fovX),p=d*d,f=r-n,m=r+n;let g,_;p>f/m?(g=r,_=r*d):(g=.5*m*(1+p),_=.5*Math.sqrt(f*f+2*(r*r+n*n)*p+m*m*p*p));const y=e.projection.pixelsPerMeter(e.center.lat,c),v=e._camera.getCameraToWorldMercator(),x=[0,0,-g*u];t.N.transformMat4(x,x,v);let b=_*u;const w=e._edgeInsets;if(!(0===w.left&&0===w.top&&0===w.right&&0===w.bottom||w.left===w.right&&w.top===w.bottom)){const i=e._camera.getWorldToCamera(e.worldSize,"meters"===e.projection.zAxisUnit?y:1),o=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,n,r);o[8]=2*-e.centerOffset.x/e.width,o[9]=2*e.centerOffset.y/e.height;const s=new Float64Array(16);t.a6.mul(s,o,i);const u=new Float64Array(16);t.a6.invert(u,s);const h=t.bq.fromInvProjectionMatrix(u,c,a,!0);for(const i of h.points){const n=((E=i)[0]/=l,E[1]/=l,E[2]=t.bl(E[2],e._center.lat),E);b=Math.max(b,t.N.len(t.N.subtract([],x,n)))}}var E;b*=o/(o-1);const S=Math.acos(i[2]),T=Math.atan2(-i[0],-i[1]),M=new pn;M.position=x,M.setPitchBearing(S,T);const I=M.getWorldToCamera(c,y),C=b*c,A=Math.min(e._mercatorZfromZoom(17)*c*-2,-2*C),P=M.getCameraToClipOrthographic(-C,C,-C,C,A,(C+s*y)/i[2]),L=new Float64Array(16);t.a6.multiply(L,P,I);const R=t.N.fromValues(Math.floor(1e6*x[0])/1e6*c,Math.floor(1e6*x[1])/1e6*c,0),D=.5*o,k=[0,0,0];t.N.transformMat4(k,R,L),t.N.scale(k,k,D);const N=[Math.floor(k[0]),Math.floor(k[1]),Math.floor(k[2])],O=[0,0,0];t.N.sub(O,k,N),t.N.scale(O,O,-1/D);const F=new Float64Array(16);return t.a6.identity(F),t.a6.translate(F,F,O),t.a6.multiply(L,F,L),[L,C]}const In=(t,e)=>ct(t,e&&e.filter((t=>"source.canvas"!==t.identifier))),Cn=t.ac(ni,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),An=t.ac(ni,["setCenter","setZoom","setBearing","setPitch"]),Pn={version:8,layers:[],sources:{}},Ln={duration:300,delay:0},Rn=new Set(["fill","line","background","hillshade","raster"]);class Dn extends t.E{constructor(e,i={}){super(),this.map=e,this.scope=i.scope||"",this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=t.e({},Ln),this._buildingIndex=new ti(this),this.crossTileSymbolIndex=new an,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new y,this.dispatcher=i.dispatcher?i.dispatcher:new t.bW(t.bX(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new w,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new t.bY(e._requestManager,i.localFontFamily?t.bZ.all:i.localIdeographFontFamily?t.bZ.ideographs:t.bZ.none,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new v(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=i.configOptions?i.configOptions:new Map,this._configDependentLayers=i.configDependentLayers?i.configDependentLayers:new Set,this._config=i.config,this.dispatcher.broadcast("setReferrer",t.b_());const n=this;this._rtlTextPluginCallback=Dn.registerForPluginStateChange((e=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},((e,i)=>{if(t.b$(e),i&&i.every((t=>t)))for(const t in n._sourceCaches){const e=n._sourceCaches[t],i=e.getSource().type;"vector"!==i&&"geojson"!==i||e.reload()}}))})),this.on("data",(t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.getOwnSource(t.sourceId);if(e&&e.vectorLayerIds)for(const t in this._layers){const i=this._layers[t];i.source===e.id&&this._validateLayer(i)}}))}loadURL(e,i={}){this.fire(new t.b("dataloading",{dataType:"style"}));const n="boolean"==typeof i.validate?i.validate:!t.c0(e);e=this.map._requestManager.normalizeStyleURL(e,i.accessToken),this.resolvedImports.add(e);const r=this.importsCache.get(e);if(r)return this._load(r,n);const o=this.map._requestManager.transformRequest(e,t.R.Style);this._request=t.g(o,((i,r)=>{if(this._request=null,i)this.fire(new t.a(i));else if(r)return this.importsCache.set(e,r),this._load(r,n)}))}loadJSON(e,i={}){this.fire(new t.b("dataloading",{dataType:"style"})),this._request=t.f.frame((()=>{this._request=null,this._load(e,!1!==i.validate)}))}loadEmpty(){this.fire(new t.b("dataloading",{dataType:"style"})),this._load(Pn,!1)}_loadImports(e,i,n){if(this.importDepth>=4)return t.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const r=[];for(const t of e){const e=this._createFragmentStyle(t),o=new Promise((t=>{e.once("style.import.load",t),e.once("error",t)})).then((()=>this.mergeAll()));if(r.push(o),this.resolvedImports.has(t.url)){e.loadEmpty();continue}const s=t.data||this.importsCache.get(t.url);s?e.loadJSON(s,{validate:i}):t.url?e.loadURL(t.url,{validate:i}):e.loadEmpty();const a={style:e,id:t.id,config:t.config};if(n){const t=this.fragments.findIndex((({id:t})=>t===n));this.fragments=this.fragments.slice(0,t).concat(a).concat(this.fragments.slice(t))}else this.fragments.push(a)}return Promise.allSettled(r)}_createFragmentStyle(e){const i=this.scope?t.ag(e.id,this.scope):e.id,n=new Dn(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:e.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return n.setEventedParent(this.map,{style:n}),n}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new t.b(e?"style.load":"style.import.load"))}_load(e,i){const n=e.schema;if(this.isRootStyle()&&(e.fragment||n&&!1!==e.fragment)){const n=t.e({},Pn,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(n,i)}if(this.setConfig(this._config,n),i&&In(this,K(e)))return;this._loaded=!0,this.stylesheet=t.c1(e);for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1,isInitialLoad:!0});e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const r=ii(this.stylesheet.layers);if(this._order=r.map((t=>t.id)),this.stylesheet.light&&t.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const t=this.stylesheet.lights[0];this.light=new ht(t.properties,t.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ht(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const e of r){const i=t.c2(e,this.scope,this.options);i.isConfigDependent&&this._configDependentLayers.add(i.fqid),i.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i,this._serializedLayers[i.id]=i.serialize();const n=this.getOwnLayerSourceCache(i),r=!!this.directionalLight&&this.directionalLight.shadowsEnabled();n&&i.canCastShadows()&&r&&(n.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const o=this.stylesheet.terrain;o&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=t.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?t.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(o,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new t.b("data",{dataType:"style"})),e.imports?this._loadImports(e.imports,i).then((()=>this._reloadImports())):this._reloadImports()}isRootStyle(){return 0===this.importDepth}mergeAll(){let e,i,n,r,o,s,a,l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((t=>{if(t.stylesheet){if(null!=t.light&&(e=t.light),t.stylesheet.lights)for(const e of t.stylesheet.lights)"ambient"===e.type&&null!=t.ambientLight&&(i=t.ambientLight),"directional"===e.type&&null!=t.directionalLight&&(n=t.directionalLight);r=this._prioritizeTerrain(r,t.terrain,t.stylesheet.terrain),t.stylesheet.fog&&null!=t.fog&&(o=t.fog),null!=t.stylesheet.camera&&(l=t.stylesheet.camera),null!=t.stylesheet.projection&&(s=t.stylesheet.projection),null!=t.stylesheet.transition&&(a=t.stylesheet.transition)}})),this.light=e,this.ambientLight=i,this.directionalLight=n,this.fog=o,null===r?delete this.terrain:this.terrain=r,this.camera=l||{"camera-projection":"perspective"},this.projection=s||{name:"mercator"},this.transition=t.e({},Ln,a),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const e=i=>{for(const t of i.fragments)e(t.style);t(i)};e(this)}_prioritizeTerrain(t,e,i){const n=t&&0===t.drapeRenderMode;return null===i?e&&0===e.drapeRenderMode?e:n?t:null:null!=e&&(!t||n||e&&1===e.drapeRenderMode)?e:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((e=>{t=this._prioritizeTerrain(t,e.terrain,e.stylesheet.terrain)})),null===t?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((e=>{null!=e.stylesheet.projection&&(t=e.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const e={},i={},n={};this.forEachFragmentStyle((r=>{for(const i in r._sourceCaches){const n=t.ag(i,r.scope);e[n]=r._sourceCaches[i]}for(const e in r._otherSourceCaches){const n=t.ag(e,r.scope);i[n]=r._otherSourceCaches[e]}for(const e in r._symbolSourceCaches){const i=t.ag(e,r.scope);n[i]=r._symbolSourceCaches[e]}})),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=n}mergeLayers(){const e={},i=[],n={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((n=>{for(const r of n._order){const o=n._layers[r];if("slot"===o.type){const i=t.c3(r);if(e[i])continue;e[i]=[]}o.slot&&e[o.slot]?e[o.slot].push(o):i.push(o)}})),this._mergedOrder=[];const r=(i=[])=>{for(const o of i)if("slot"===o.type){const i=t.c3(o.id);e[i]&&r(e[i])}else{const e=t.ag(o.id,o.scope);this._mergedOrder.push(e),n[e]=o,o.is3D()&&(this._has3DLayers=!0),"circle"===o.type&&(this._hasCircleLayers=!0),"symbol"===o.type&&(this._hasSymbolLayers=!0)}};r(i),this._mergedLayers=n,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=t.e({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(e,i,n){let r,o,s;const a=t.f.devicePixelRatio>1?"@2x":"";let l=t.g(i.transformRequest(i.normalizeSpriteURL(e,a,".json"),t.R.SpriteJSON),((t,e)=>{l=null,s||(s=t,r=e,u())})),c=t.d(i.transformRequest(i.normalizeSpriteURL(e,a,".png"),t.R.SpriteImage),((t,e)=>{c=null,s||(s=t,o=e,u())}));function u(){if(s)n(s);else if(r&&o){const e=t.f.getImageData(o),i={};for(const n in r){const{width:o,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=r[n],f=new t.h({width:o,height:s});t.h.copy(e,f,{x:a,y:l},{x:0,y:0},{width:o,height:s}),i[n]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p}}n(null,i)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(e,this.map._requestManager,((e,i)=>{if(this._spriteRequest=null,e)this.fire(new t.a(e));else if(i)for(const t in i)this.imageManager.addImage(t,this.scope,i[t]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.b("data",{dataType:"style"}))}))}_validateLayer(e){const i=this.getOwnSource(e.source);if(!i)return;const n=e.sourceLayer;n&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(n))&&this.fire(new t.a(new Error(`Source layer "${n}" does not exist on source "${i.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,e)=>{const i=this.fragments[e];return i&&i.style&&(t.data=i.style.serialize()),t}))}_serializeSources(){const t={};for(const e in this._sourceCaches){const i=this._sourceCaches[e].getSource();t[i.id]||(t[i.id]=i.serialize())}return t}_serializeLayers(t){const e=[];for(const i of t){const t=this._layers[i];t&&"custom"!==t.type&&e.push(t.serialize())}return e}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&("function"==typeof t.isLayerDraped?t.isLayerDraped(this.getLayerSourceCache(t)):Rn.has(t.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){const i=this.getOwnLayer(e);if(i)return i;this.fire(new t.a(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){const i=this.getOwnSource(e);if(i)return i;this.fire(new t.a(new Error(`The source '${e}' does not exist in the map's style.`)))}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);const i=this.calculateLightsBrightness();e.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));const n=this._changes.isDirty();if(this._changes.isDirty()){const t=this._changes.getLayerUpdatesByScope();for(const e in t){const{updatedIds:i,removedIds:n}=t[e];(i||n)&&this._updateWorkerLayers(e,i,n)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}const r={};for(const t in this._mergedSourceCaches){const e=this._mergedSourceCaches[t];r[t]=e.used,e.used=!1,e.tileCoverLift=0}for(const t of this._mergedOrder){const i=this._mergedLayers[t];if(i.recalculate(e,this._availableImages),!i.isHidden(e.zoom)){const t=this.getLayerSourceCache(i);t&&(t.used=!0,t.tileCoverLift=Math.max(t.tileCoverLift,i.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let t=i.minzoom||0;t<(i.maxzoom||25.5);t++){const t=this.map.painter;if(t){const n=i.getProgramIds();if(!n)continue;for(const r of n){const n=i.getDefaultProgramParams(r,e.zoom);n&&(t.style=this,this.fog&&(t._fogVisible=!0,n.overrideFog=!0,t.getOrCreateProgram(r,n)),t._fogVisible=!1,n.overrideFog=!1,t.getOrCreateProgram(r,n),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(n.overrideRtt=!0,t.getOrCreateProgram(r,n)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const e in r){const i=this._mergedSourceCaches[e];r[e]!==i.used&&i.getSource().fire(new t.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),n&&this.fire(new t.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const e in this._sourceCaches)this._sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,e,i){const n=this.getFragmentStyle(t);n&&this.dispatcher.broadcast("updateLayers",{layers:e?n._serializeLayers(e):[],scope:t,removedIds:i||[],options:n.options})}setState(i){if(this._checkLoaded(),In(this,K(i)))return!1;(i=t.c1(i)).layers=ii(i.layers);const n=function(t,i){if(!t)return[{command:ni.setStyle,args:[i]}];let n=[];try{if(!e(t.version,i.version))return[{command:ni.setStyle,args:[i]}];e(t.center,i.center)||n.push({command:ni.setCenter,args:[i.center]}),e(t.zoom,i.zoom)||n.push({command:ni.setZoom,args:[i.zoom]}),e(t.bearing,i.bearing)||n.push({command:ni.setBearing,args:[i.bearing]}),e(t.pitch,i.pitch)||n.push({command:ni.setPitch,args:[i.pitch]}),e(t.sprite,i.sprite)||n.push({command:ni.setSprite,args:[i.sprite]}),e(t.glyphs,i.glyphs)||n.push({command:ni.setGlyphs,args:[i.glyphs]}),e(t.imports,i.imports)||function(t=[],i=[],n){i=i||[];const r=(t=t||[]).map(ci),o=i.map(ci),s=t.reduce(ui,{}),a=i.reduce(ui,{}),l=r.slice();let c,u,h,d;for(c=0,u=0;c<r.length;c++)h=r[c],a.hasOwnProperty(h)?u++:(n.push({command:ni.removeImport,args:[h]}),l.splice(l.indexOf(h,u),1));for(c=0,u=0;c<o.length;c++)h=o[o.length-1-c],l[l.length-1-c]!==h&&(s.hasOwnProperty(h)?(n.push({command:ni.removeImport,args:[h]}),l.splice(l.lastIndexOf(h,l.length-u),1)):u++,d=l[l.length-c],n.push({command:ni.addImport,args:[a[h],d]}),l.splice(l.length-c,0,h));for(const t of i){const i=s[t.id];i&&!e(i,t)&&n.push({command:ni.updateImport,args:[t.id,t]})}}(t.imports,i.imports,n),e(t.transition,i.transition)||n.push({command:ni.setTransition,args:[i.transition]}),e(t.light,i.light)||n.push({command:ni.setLight,args:[i.light]}),e(t.fog,i.fog)||n.push({command:ni.setFog,args:[i.fog]}),e(t.projection,i.projection)||n.push({command:ni.setProjection,args:[i.projection]}),e(t.lights,i.lights)||n.push({command:ni.setLights,args:[i.lights]}),e(t.camera,i.camera)||n.push({command:ni.setCamera,args:[i.camera]});const r={},o=[];!function(t,i,n,r){let o;for(o in i=i||{},t=t||{})t.hasOwnProperty(o)&&(i.hasOwnProperty(o)||oi(o,n,r));for(o in i){if(!i.hasOwnProperty(o))continue;const s=i[o];t.hasOwnProperty(o)?e(t[o],s)||("geojson"===t[o].type&&"geojson"===s.type&&ai(t,i,o)?n.push({command:ni.setGeoJSONSourceData,args:[o,s.data]}):si(o,i,n,r)):ri(o,i,n)}}(t.sources,i.sources,o,r);const s=[];t.layers&&t.layers.forEach((t=>{t.source&&r[t.source]?n.push({command:ni.removeLayer,args:[t.id]}):s.push(t)}));let a=t.terrain;a&&r[a.source]&&(n.push({command:ni.setTerrain,args:[void 0]}),a=void 0),n=n.concat(o),e(a,i.terrain)||n.push({command:ni.setTerrain,args:[i.terrain]}),function(t,i,n){i=i||[];const r=(t=t||[]).map(ci),o=i.map(ci),s=t.reduce(ui,{}),a=i.reduce(ui,{}),l=r.slice(),c=Object.create(null);let u,h,d,p,f,m,g;for(u=0,h=0;u<r.length;u++)d=r[u],a.hasOwnProperty(d)?h++:(n.push({command:ni.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<o.length;u++)d=o[o.length-1-u],l[l.length-1-u]!==d&&(s.hasOwnProperty(d)?(n.push({command:ni.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-u],n.push({command:ni.addLayer,args:[a[d],m]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<o.length;u++)if(d=o[u],p=s[d],f=a[d],!c[d]&&!e(p,f))if(e(p.source,f.source)&&e(p["source-layer"],f["source-layer"])&&e(p.type,f.type)){for(g in li(p.layout,f.layout,n,d,null,ni.setLayoutProperty),li(p.paint,f.paint,n,d,null,ni.setPaintProperty),e(p.slot,f.slot)||n.push({command:ni.setSlot,args:[d,f.slot]}),e(p.filter,f.filter)||n.push({command:ni.setFilter,args:[d,f.filter]}),e(p.minzoom,f.minzoom)&&e(p.maxzoom,f.maxzoom)||n.push({command:ni.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?li(p[g],f[g],n,d,g.slice(6),ni.setPaintProperty):e(p[g],f[g])||n.push({command:ni.setLayerProperty,args:[d,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?li(p[g],f[g],n,d,g.slice(6),ni.setPaintProperty):e(p[g],f[g])||n.push({command:ni.setLayerProperty,args:[d,g,f[g]]}))}else n.push({command:ni.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],n.push({command:ni.addLayer,args:[f,m]})}(s,i.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:ni.setStyle,args:[i]}]}return n}(this.serialize(),i).filter((t=>!(t.command in An)));if(0===n.length)return!1;const r=n.filter((t=>!(t.command in Cn)));if(r.length>0)throw new Error(`Unimplemented: ${r.map((t=>t.command)).join(", ")}.`);return n.forEach((t=>{this[t.command].apply(this,t.args)})),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,i){return this.getImage(e)?this.fire(new t.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,i),this._afterImageUpdated(e),this)}updateImage(t,e){this.imageManager.updateImage(t,this.scope,e)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new t.a(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(e),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new t.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,e,i={}){return this._checkLoaded(),this._validate(at,`models.${t}`,e,null,i)||(this.modelManager.addModel(t,e,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new t.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,i,n={}){if(this._checkLoaded(),void 0!==this.getOwnSource(e))throw new Error(`There is already a source with ID "${e}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(J,`sources.${e}`,i,null,n))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const r=Ge(e,i,this.dispatcher,this);r.scope=this.scope,r.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(r.id),source:r.serialize(),sourceId:r.id})));const o=e=>{const i=(e?"symbol:":"other:")+r.id,n=t.ag(i,this.scope),o=this._sourceCaches[i]=new Ze(n,r,e);(e?this._symbolSourceCaches:this._otherSourceCaches)[r.id]=o,o.onAdd(this.map)};o(!1),"vector"!==i.type&&"geojson"!==i.type||o(!0),r.onAdd&&r.onAdd(this.map),n.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(e){this._checkLoaded();const i=this.getOwnSource(e);if(!i)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new t.a(new Error(`Source "${e}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===e)return this.fire(new t.a(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const n=this.getOwnSourceCaches(e);for(const e of n){const i=t.c3(e.id);delete this._sourceCaches[i],this._changes.discardSourceCacheUpdate(e.id),e.fire(new t.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:e.getSource().id})),e.setEventedParent(null),e.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,e){this._checkLoaded(),this.getOwnSource(t).setData(e),this._changes.setDirty()}getOwnSource(t){const e=this.getOwnSourceCache(t);return e&&e.getSource()}getOwnSources(){const t=[];for(const e in this._otherSourceCaches){const i=this.getOwnSourceCache(e);i&&t.push(i.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const e in t){const i=t[e]._tiles;for(const t in i){const e=i[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const t of e){if(this._validate(tt,"lights",t))return;switch(t.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(t),e.updateTransitions(i)}else this.ambientLight=new Et(t,St,this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(t),e.updateTransitions(i)}else this.directionalLight=new Et(t,Tt,this.scope,this.options)}}const n=new t.K(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const e=this.directionalLight,i=this.ambientLight;if(!e||!i)return;const n=t=>.2126*(t[0]<=.03928?t[0]/12.92:Math.pow((t[0]+.055)/1.055,2.4))+.7152*(t[1]<=.03928?t[1]/12.92:Math.pow((t[1]+.055)/1.055,2.4))+.0722*(t[2]<=.03928?t[2]/12.92:Math.pow((t[2]+.055)/1.055,2.4)),r=e.properties.get("color").toArray01(),o=e.properties.get("intensity"),s=e.properties.get("direction"),a=1-t.bQ(s.x,s.y,s.z)[2]/90,l=n(r)*o*a,c=i.properties.get("color").toArray01(),u=i.properties.get("intensity");return(l+n(c)*u)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;if(t.c4(e)){const i=t.c5(e),n=this.fragments.find((({id:t})=>t===i));if(!n)throw new Error(`Style import not found: ${e}`);const r=t.c3(e);return n.style.getFragmentStyle(r)}{const t=this.fragments.find((({id:t})=>t===e));if(!t)throw new Error(`Style import not found: ${e}`);return t.style}}getConfigProperty(e,i){const n=this.getFragmentStyle(e);if(!n)return null;const r=t.ag(i,n.scope),o=n.options.get(r),s=o?o.value||o.default:null;return s?s.serialize():null}setConfigProperty(e,i,n){const r=t.r(n);if("success"!==r.result)return void In(this,r.value);const o=r.value.expression,s=this.getFragmentStyle(e);if(!s)return;const a=t.ag(i,s.scope),l=s.options.get(a);l&&(this.options.set(a,{...l,value:o}),this.updateConfigDependencies())}setConfig(e,i){if(this._config=e,e||i)if(i)for(const n in i){let r,o;const s=t.r(i[n].default);if("success"===s.result&&(r=s.value.expression),e&&void 0!==e[n]){const i=t.r(e[n]);"success"===i.result&&(o=i.value.expression)}const{minValue:a,maxValue:l,stepValue:c,type:u,values:h}=i[n];if(r){const e=t.ag(n,this.scope);this.options.set(e,{default:r,value:o,minValue:a,maxValue:l,stepValue:c,type:u,values:h})}else this.fire(new t.a(new Error(`No schema defined for config option "${n}".`)))}else this.fire(new t.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const t of this._configDependentLayers){const e=this.getLayer(t);e&&(e.possiblyEvaluateVisibility(),this._updateLayer(e))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(e,i,n={}){this._checkLoaded();const r=e.id;if(this._layers[r])return void this.fire(new t.a(new Error(`Layer with id "${r}" already exists on this map`)));let o;if("custom"===e.type){if(In(this,t.c6(e)))return;o=t.c2(e,this.scope,this.options)}else{if("object"==typeof e.source&&(this.addSource(r,e.source),e=t.c1(e),e=t.e(e,{source:r})),this._validate(nt,`layers.${r}`,e,{arrayIndex:-1},n))return;o=t.c2(e,this.scope,this.options),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[o.id]=o.serialize()}o.isConfigDependent&&this._configDependentLayers.add(o.fqid);let s=this._order.length;if(i){const e=this._order.indexOf(i);if(-1===e)return void this.fire(new t.a(new Error(`Layer with id "${i}" does not exist on this map.`)));o.slot===this._layers[i].slot?s=e:t.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(s,0,r),this._layerOrderChanged=!0,this._layers[r]=o;const a=this.getOwnLayerSourceCache(o),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();a&&o.canCastShadows()&&l&&(a.castsShadows=!0);const c=this._changes.getRemovedLayer(o);if(c&&o.source&&a&&"custom"!==o.type){this._changes.discardLayerRemoval(o);const e=t.ag(o.source,o.scope);c.type!==o.type?this._changes.updateSourceCache(e,"clear"):(this._changes.updateSourceCache(e,"reload"),a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),o.scope=this.scope,this.mergeLayers()}moveLayer(e,i){this._checkLoaded();const n=this._checkLayer(e);if(!n)return;if(e===i)return;const r=this._order.indexOf(e);this._order.splice(r,1);let o=this._order.length;if(i){const e=this._order.indexOf(i);if(-1===e)return void this.fire(new t.a(new Error(`Layer with id "${i}" does not exist on this map.`)));n.slot===this._layers[i].slot?o=e:t.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(o,0,e),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const e=this._checkLayer(t);if(!e)return;e.setEventedParent(null);const i=this._order.indexOf(t);this._order.splice(i,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(e.fqid),this._changes.removeLayer(e);const n=this.getOwnLayerSourceCache(e);if(n&&n.castsShadows){let t=!1;for(const i in this._layers)if(this._layers[i].source===e.source&&this._layers[i].canCastShadows()){t=!0;break}n.castsShadows=t}e.onRemove&&e.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const e in this._layers)if(this._layers[e].type===t)return!0;return!1}setLayerZoomRange(t,e,i){this._checkLoaded();const n=this._checkLayer(t);n&&(n.minzoom===e&&n.maxzoom===i||(null!=e&&(n.minzoom=e),null!=i&&(n.maxzoom=i),this._updateLayer(n)))}setSlot(t,e){this._checkLoaded();const i=this._checkLayer(t);i&&i.slot!==e&&(i.slot=e,this._updateLayer(i))}setFilter(i,n,r={}){this._checkLoaded();const o=this._checkLayer(i);if(o&&!e(o.filter,n))return null==n?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(rt,`layers.${o.id}.filter`,n,{layerType:o.type},r)||(o.filter=t.c1(n),this._updateLayer(o)))}getFilter(e){const i=this._checkLayer(e);if(i)return t.c1(i.filter)}setLayoutProperty(i,n,r,o={}){this._checkLoaded();const s=this._checkLayer(i);if(s&&!e(s.getLayoutProperty(n),r)){if(null!=r&&(!o||!1!==o.validate)&&In(s,st.call(K,{key:`layers.${i}.layout.${n}`,layerType:s.type,objectKey:n,value:r,styleSpec:t.D,style:{glyphs:!0,sprite:!0}})))return;s.setLayoutProperty(n,r),s.isConfigDependent&&this._configDependentLayers.add(s.fqid),this._updateLayer(s)}}getLayoutProperty(t,e){const i=this._checkLayer(t);if(i)return i.getLayoutProperty(e)}setPaintProperty(i,n,r,o={}){this._checkLoaded();const s=this._checkLayer(i);if(!s)return;if(e(s.getPaintProperty(n),r))return;if(null!=r&&(!o||!1!==o.validate)&&In(s,ot.call(K,{key:`layers.${i}.paint.${n}`,layerType:s.type,objectKey:n,value:r,styleSpec:t.D})))return;const a=s.setPaintProperty(n,r);s.isConfigDependent&&this._configDependentLayers.add(s.fqid),a&&this._updateLayer(s),this._changes.updatePaintProperties(s)}getPaintProperty(t,e){const i=this._checkLayer(t);if(i)return i.getPaintProperty(e)}setFeatureState(e,i){this._checkLoaded();const n=e.source,r=e.sourceLayer,o=this._checkSource(n);if(!o)return;const s=o.type;if("geojson"===s&&r)return void this.fire(new t.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!r)return void this.fire(new t.a(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new t.a(new Error("The feature id parameter must be provided.")));const a=this.getOwnSourceCaches(n);for(const t of a)t.setFeatureState(r,e.id,i)}removeFeatureState(e,i){this._checkLoaded();const n=e.source,r=this._checkSource(n);if(!r)return;const o=r.type,s="vector"===o?e.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new t.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new t.a(new Error("A feature id is required to remove its specific state property.")));const a=this.getOwnSourceCaches(n);for(const t of a)t.removeFeatureState(s,e.id,i)}getFeatureState(e){this._checkLoaded();const i=e.source,n=e.sourceLayer,r=this._checkSource(i);if(r){if("vector"!==r.type||n)return void 0===e.id&&this.fire(new t.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(n,e.id);this.fire(new t.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=t.e({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return t.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const e=this.getTerrain(),i=e&&this.terrain&&this.terrain.scope===this.scope?e:this.stylesheet.terrain;return t.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(t=>void 0!==t))}_updateLayer(e){this._changes.updateLayer(e);const i=this.getLayerSourceCache(e),n=t.ag(e.source,e.scope),r=this._changes.getUpdatedSourceCaches();e.source&&!r[n]&&i&&"raster"!==i.getSource().type&&(this._changes.updateSourceCache(n,"reload"),i.pause()),e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._mergedLayers[t].type||"model"===this._mergedLayers[t].type,i=this.order,n={},r=[];for(let o=i.length-1;o>=0;o--){const s=i[o];if(e(s)){n[s]=o;for(const e of t){const t=e[s];if(t)for(const e of t)r.push(e)}}}r.sort(((t,e)=>e.intersectionZ-t.intersectionZ));const o=[];for(let s=i.length-1;s>=0;s--){const a=i[s];if(e(a))for(let t=r.length-1;t>=0;t--){const e=r[t].feature;if(n[e.layer.id]<s)break;o.push(e),r.pop()}else for(const e of t){const t=e[a];if(t)for(const e of t)o.push(e.feature)}}return o}queryRenderedFeatures(e,i,n){i&&i.filter&&this._validate(rt,"queryRenderedFeatures.filter",i.filter,null,i),i.scope=this.scope,i.availableImages=this._availableImages,i.serializedLayers=this._serializedLayers;const r={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new t.a(new Error("parameters.layers must be an Array."))),[];for(const e of i.layers){const i=this._mergedLayers[e];if(!i)return this.fire(new t.a(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];r[i.source]=!0}}const o=[],s=i.serializedLayers||{},a=i&&i.layers?i.layers.some((t=>{const e=this.getLayer(t);return e&&e.is3D()})):this.has3DLayers(),l=Mt.createFromScreenPoints(e,n);for(const t in this._mergedSourceCaches){const e=this._mergedSourceCaches[t].getSource();if(!e||e.scope!==i.scope)continue;const c=this._mergedSourceCaches[t].getSource().id;i.layers&&!r[c]||o.push(We(this._mergedSourceCaches[t],this._mergedLayers,s,l,i,n,a,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(t,e,i,n,r,o,s){const a={},l=o.queryRenderedSymbols(n),c=[];for(const t of Object.keys(l).map(Number))c.push(s[t]);c.sort(Xe);for(const i of c){const n=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],e,i.bucketIndex,i.sourceLayerIndex,r.filter,r.layers,r.availableImages,t);for(const t in n){const e=a[t]=a[t]||[],r=n[t];r.sort(((t,e)=>{const n=i.featureSortOrder;if(n){const i=n.indexOf(t.featureIndex);return n.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(const t of r)e.push(t)}}for(const e in a)a[e].forEach((n=>{const r=n.feature,o=i(t[e]);if(!o)return;const s=o.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=s}));return a}(this._mergedLayers,s,this.getLayerSourceCache.bind(this),l.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(t,e){e&&e.filter&&this._validate(rt,"querySourceFeatures.filter",e.filter,null,e);const i=this.getOwnSourceCaches(t);let n=[];for(const t of i)n=n.concat(qe(t,e));return n}addSourceType(t,e,i){return Dn.getSourceType(t)?i(new Error(`A source type called "${t}" already exists.`)):(Dn.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,i,n={}){this._checkLoaded();const r=this.light.getLight();let o=!1;for(const i in t)if(!e(t[i],r[i])){o=!0;break}if(!o)return;const s=this._getTransitionParameters();this.light.setLight(t,i,n),this.light.updateTransitions(s)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,n=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()&&0!==n||delete this.terrain,null===i?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let r=i;const o=null==i.source;if(1===n){if("object"==typeof r.source){const e="terrain-dem-src";this.addSource(e,r.source),r=t.c1(r),r=t.e(r,{source:e})}const e=t.e({},r),i={};if(this.terrain&&o){e.source=this.terrain.get().source;const t=this.terrain?this.getFragmentStyle(this.terrain.scope):null;t&&(i.style=t.serialize())}if(this._validate(et,"terrain",e,i))return}if(!this.terrain||this.terrain.scope!==this.scope&&!o||this.terrain&&n!==this.terrain.drapeRenderMode){if(!r)return;this._createTerrain(r,n),this.fire(new t.b("data",{dataType:"style"}))}else{const n=this.terrain,o=n.get();for(const e of Object.keys(t.D.terrain))!r.hasOwnProperty(e)&&t.D.terrain[e].default&&(r[e]=t.D.terrain[e].default);for(const r in i)if(!e(i[r],o[r])){n.set(i,this.options),this.stylesheet.terrain=i;const e=this._getTransitionParameters({duration:0});n.updateTransitions(e),this.fire(new t.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const e=this.fog=new wt(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=e.get();const i=this._getTransitionParameters({duration:0});e.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!e(i.get(),t)){i.set(t,this.options),this.stylesheet.fog=i.get();const e=this._getTransitionParameters({duration:0});i.updateTransitions(e)}}else this._createFog(t);this._markersNeedUpdate=!0}_getTransitionParameters(e){return{now:t.f.now(),transition:t.e(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],e=[];for(const i in this._mergedLayers)this.isLayerDraped(this._mergedLayers[i])?t.push(i):e.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...e)}_createTerrain(t,e){const i=this.terrain=new pt(t,e,this.scope,this.options);1===e&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const n=this._getTransitionParameters({duration:0});i.updateTransitions(n)}_force3DLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"symbol"===e.type&&this._updateLayer(e)}}_validate(e,i,n,r,o={}){if(o&&!1===o.validate)return!1;const s=t.e({},this.serialize());return In(this,e.call(K,t.e({key:i,style:s,value:n,styleSpec:t.D},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const e=this.getSourceCaches(t);for(const t of e)t.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const e=this.getSourceCaches(t);for(const t of e)t.resume(),t.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}updateSources(t){let e;this.directionalLight&&(e=Sn(this.directionalLight));for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(t,void 0,void 0,e)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(e,i,n,r,o=!1){let s=!1,a=!1;const l={},c={};for(const i of this._mergedOrder){const n=this._mergedLayers[i];if("symbol"!==n.type)continue;const r=t.ag(n.source,n.scope);let o=l[r];if(!o){const t=this.getLayerSourceCache(n);if(!t)continue;const e=t.getRenderableIds(!0).map((e=>t.getTileByID(e)));c[r]=e.slice(),o=l[r]=e.sort(((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)))}const a=this.crossTileSymbolIndex.addLayer(n,o,e.center.lng,e.projection);s=s||a}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),o=o||this._layerOrderChanged||0===n,this._layerOrderChanged&&this.fire(new t.b("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.f.now(),e.zoom))&&(this.pauseablePlacement=new en(e,this._mergedOrder,o,i,n,r,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,l,c),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.f.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s){this._buildingIndex.onNewFrame(e.zoom);for(const e of this._mergedOrder){const i=this._mergedLayers[e];"symbol"===i.type&&this.placement.updateLayerOpacities(i,l[t.ag(i.source,i.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.f.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(e,i){this._checkLoaded();const n=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==n.findIndex((({id:t})=>t===e.id)))return this.fire(new t.a(new Error(`Import with id '${e.id}' already exists in the map's style.`)));if(!i)return n.push(e),this._loadImports([e],!0),this;const r=n.findIndex((({id:t})=>t===i));return-1===r?this.fire(new t.a(new Error(`Import with id "${i}" does not exist on this map.`))):(this.stylesheet.imports=n.slice(0,r).concat(e).concat(n.slice(r)),this._loadImports([e],!0,i),this)}updateImport(t,i){this._checkLoaded();const n=this.stylesheet.imports||[],r=this.getImportIndex(t);return-1===r?this:"string"==typeof i?(this.setImportUrl(t,i),this):(i.url&&i.url!==n[r].url&&this.setImportUrl(t,i.url),e(i.config,n[r].config)||this.setImportConfig(t,i.config),e(i.data,n[r].data)||this.setImportData(t,i.data),this)}moveImport(t,e){this._checkLoaded();let i=this.stylesheet.imports||[];const n=this.getImportIndex(t);if(-1===n)return this;const r=this.getImportIndex(e);if(-1===r)return this;const o=i[n],s=this.fragments[n];return i=i.filter((({id:e})=>e!==t)),this.fragments=this.fragments.filter((({id:e})=>e!==t)),this.stylesheet.imports=i.slice(0,r).concat(o).concat(i.slice(r)),this.fragments=this.fragments.slice(0,r).concat(s).concat(this.fragments.slice(r)),this.mergeLayers(),this}setImportUrl(t,e){this._checkLoaded();const i=this.stylesheet.imports||[],n=this.getImportIndex(t);if(-1===n)return this;i[n].url=e;const r=this.fragments[n];return r.style=this._createFragmentStyle(i[n]),r.style.on("style.import.load",(()=>this.mergeAll())),r.style.loadURL(e),this}setImportData(t,e){this._checkLoaded();const i=this.getImportIndex(t),n=this.stylesheet.imports||[];return-1===i?this:e?(this.fragments[i].style.setState(e),this._reloadImports(),this):(delete n[i].data,this.setImportUrl(t,n[i].url))}setImportConfig(t,e){this._checkLoaded();const i=this.getImportIndex(t),n=this.stylesheet.imports||[];if(-1===i)return this;e?n[i].config=e:delete n[i].config;const r=this.fragments[i],o=r.style.stylesheet&&r.style.stylesheet.schema;return r.config=e,r.style.setConfig(e,o),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const e=this.stylesheet.imports||[],i=this.getImportIndex(t);return-1===i||(e.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports()),this}getImportIndex(e){const i=(this.stylesheet.imports||[]).findIndex((t=>t.id===e));return-1===i&&this.fire(new t.a(new Error(`Import '${e}' does not exist in the map's style and cannot be updated.`))),i}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const e in this._mergedOtherSourceCaches){const i=this._mergedOtherSourceCaches[e];i&&t.push(i.getSource())}return t}getSource(t,e){const i=this.getSourceCache(t,e);return i&&i.getSource()}getLayerSource(t){const e=this.getLayerSourceCache(t);return e&&e.getSource()}getSourceCache(e,i){const n=t.ag(e,i);return this._mergedOtherSourceCaches[n]}getLayerSourceCache(e){const i=t.ag(e.source,e.scope);return"symbol"===e.type?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(t){const e=[];return this._mergedOtherSourceCaches[t]&&e.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&e.push(this._mergedSymbolSourceCaches[t]),e}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const e in t){const i=t[e];"reload"===i?this.reloadSource(e):"clear"===i&&this.clearSource(e)}}updateLayers(t){const e=this._changes.getUpdatedPaintProperties();for(const i of e){const e=this.getLayer(i);e&&e.updateTransitions(t)}}getImages(t,e,i){this.imageManager.getImages(e.icons,e.scope,i),this._updateTilesForChangedImages();const n=t=>{t&&t.setDependencies(e.tileID.key,e.type,e.icons)};n(this._otherSourceCaches[e.source]),n(this._symbolSourceCaches[e.source])}getGlyphs(t,e,i){this.glyphManager.getGlyphs(e.stacks,e.scope,i)}getResource(e,i,n){return t.c9(i,n)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const e=[];return this._otherSourceCaches[t]&&e.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&e.push(this._symbolSourceCaches[t]),e}_isSourceCacheLoaded(e){const i=this.getOwnSourceCaches(e);return 0===i.length?(this.fire(new t.a(new Error(`There is no source with ID '${e}'`))),!1):i.every((t=>t.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Dn.getSourceType=function(t){return je[t]},Dn.setSourceType=function(t,e){je[t]=e},Dn.registerForPluginStateChange=t.bV;var kn="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",Nn="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}",On="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Fn="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",zn="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Bn="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Un="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Vn="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",jn="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);\n#ifdef DATA_FORMAT_UINT32\nvec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;\n#else\nvec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));\n#endif\nreturn velocity/max(u_max_speed,length(velocity));}\n#endif",Gn="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Hn="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Wn=[];Kn(kn,Wn),Kn(On,Wn),Kn(Nn,Wn);const qn={"_prelude_fog.vertex.glsl":Bn,"_prelude_terrain.vertex.glsl":zn,"_prelude_shadow.vertex.glsl":Gn,"_prelude_fog.fragment.glsl":Un,"_prelude_shadow.fragment.glsl":Hn,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Vn,"_prelude_raster_particle.glsl":jn},Xn={};Jn("",zn),Jn(Un,Bn),Jn(Hn,Gn),Jn(Vn,""),Jn(jn,"");const $n=Jn(Nn,On),Yn=kn;var Zn={background:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Jn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Jn('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Jn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Jn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Jn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Jn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Jn("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Jn('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Jn("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Jn("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nvec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Jn("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'precision highp float;\n#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}'),rasterParticleTexture:Jn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Jn("void main() {}",'#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);\n#ifdef DATA_FORMAT_UINT32\nvec2 dp=vec2(0);\n#else\nvec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;\n#endif\nvec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(\nvec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)\n);}'),symbolIcon:Jn('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:Jn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Jn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Jn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Jn('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Fn),skyboxGradient:Jn('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Fn),skyboxCapture:Jn("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Jn('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Jn("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Jn("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function Kn(t,e){const i=t.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let t of i)if(t=t.trim(),"#"===t[0]&&t.includes("if")&&!t.includes("endif")){t=t.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const i=t.split(" ");for(const t of i)e.includes(t)||e.push(t)}}function Jn(t,e){const i=/#include\s+"([^"]+)"/g,n=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let r=e.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);r&&(r=r.map((t=>{const e=t.split(" ");return e[e.length-1]})),r=[...new Set(r)]);const o={},s=[],a=[];if(t=t.replace(i,((t,e)=>(a.push(e),""))),(e=e.replace(i,((t,e)=>(s.push(e),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...Wn];Kn(t,l),Kn(e,l);for(const t of[...s,...a])qn[t]||console.error(`Undefined include: ${t}`),Xn[t]||(Xn[t]=[],Kn(qn[t],Xn[t])),l=[...l,...Xn[t]];return{fragmentSource:t=t.replace(n,((t,e,i,n,r)=>(o[r]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nin ${i} ${n} ${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"initialize"===e?`\n#ifdef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:"define-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${r}\n    in ${i} ${n} ${r};\n#endif\n`:"initialize-attribute"===e?"":void 0))),vertexSource:e=e.replace(n,((t,e,i,n,r)=>{const s="float"===n?"vec2":n,a=r.match(/color/)?"color":s;return"define-attribute-vertex-shader-only"===e?`\n#ifdef HAS_ATTRIBUTE_a_${r}\nin ${i} ${n} a_${r};\n#endif\n`:o[r]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nin ${i} ${s} a_${r};\nout ${i} ${n} ${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"initialize"===e?"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${a}(a_${r}, u_${r}_t);\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:"define-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${r}\n    in ${i} ${n} a_${r};\n    out ${i} ${n} ${r};\n#endif\n`:"initialize-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${r}\n    ${r} = a_${r};\n#endif\n`:void 0:"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nin ${i} ${s} a_${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"define-instanced"===e?"mat4"===a?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${r}0;\nin vec4 a_${r}1;\nin vec4 a_${r}2;\nin vec4 a_${r}3;\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${i} ${s} a_${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"initialize-attribute-custom"===e?`\n#ifdef HAS_ATTRIBUTE_a_${r}\n    ${i} ${n} ${r} = a_${r};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = a_${r};\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = unpack_mix_${a}(a_${r}, u_${r}_t);\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`})),staticAttributes:r,usedDefines:l,vertexIncludes:s,fragmentIncludes:a}}class Qn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,e,i,n,r,o,s,a){this.context=t;let l=this.boundPaintVertexBuffers.length!==n.length;for(let t=0;!l&&t<n.length;t++)this.boundPaintVertexBuffers[t]!==n[t]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==s.length;for(let t=0;!c&&t<s.length;t++)this.boundDynamicVertexBuffers[t]!==s[t]&&(c=!0);if(!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||l||c||this.boundIndexBuffer!==r||this.boundVertexOffset!==o)this.freshBind(e,i,n,r,o,s,a);else{t.bindVertexArrayOES.set(this.vao);for(const i of s)i&&(i.bind(),a&&i.instanceCount&&i.setVertexAttribDivisor(t.gl,e,a));r&&r.dynamicDraw&&r.bind()}}freshBind(t,e,i,n,r,o,s){const a=t.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=r,this.boundDynamicVertexBuffers=o,e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,r);for(const e of i)e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,r);for(const e of o)e&&(e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,r),s&&e.instanceCount&&e.setVertexAttribDivisor(c,t,s));n&&n.bind(),l.currentNumAttributes=a}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function tr(e,i){const n=Math.pow(2,i.canonical.z),r=i.canonical.y;return[new t.L(0,r/n).toLngLat().lat,new t.L(0,(r+1)/n).toLngLat().lat]}function er(e,i,n,r,o,s,a){const l=e.context,c=l.gl,u=n.hillshadeFBO;if(!u)return;e.prepareDrawTile();const h=e.isTileAffectedByFog(i),d=e.getOrCreateProgram("hillshade",{overrideFog:h});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const p=((e,i,n,r)=>{const o=n.paint.get("hillshade-shadow-color"),s=n.paint.get("hillshade-highlight-color"),a=n.paint.get("hillshade-accent-color"),l=n.paint.get("hillshade-emissive-strength");let c=t.bj(n.paint.get("hillshade-illumination-direction"));if("viewport"===n.paint.get("hillshade-illumination-anchor"))c-=e.transform.angle;else if(e.style&&e.style.enable3dLights()&&e.style.directionalLight){const i=e.style.directionalLight.properties.get("direction"),n=t.bQ(i.x,i.y,i.z);c=t.bj(n[1])}const u=!e.options.moving;return{u_matrix:r||e.transform.calculateProjMatrix(i.tileID.toUnwrapped(),u),u_image:0,u_latrange:tr(0,i.tileID),u_light:[n.paint.get("hillshade-exaggeration"),c],u_shadow:o,u_highlight:s,u_emissive_strength:l,u_accent:a}})(e,n,r,e.terrain?i.projMatrix:null);e.uploadCommonUniforms(l,d,i.toUnwrapped());const{tileBoundsBuffer:f,tileBoundsIndexBuffer:m,tileBoundsSegments:g}=e.getTileBoundsBuffers(n);d.draw(e,c.TRIANGLES,o,s,a,Oe.disabled,p,r.id,f,m,g)}function ir(e,i,n){if(!i.needsDEMTextureUpload)return;const r=e.context,o=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(n.stride);const s=n.getPixels();i.demTexture?i.demTexture.update(s,{premultiply:!1}):i.demTexture=new t.T(r,s,o.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function nr(e,i,n){const r=e.context,o=r.gl;if(!i.dem)return;const s=i.dem;if(r.activeTexture.set(o.TEXTURE1),ir(e,i,s),!i.demTexture)return;i.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE);const a=s.dim;r.activeTexture.set(o.TEXTURE0);let l=i.hillshadeFBO;if(!l){const e=new t.T(r,{width:a,height:a,data:null},o.RGBA);e.bind(o.LINEAR,o.CLAMP_TO_EDGE),l=i.hillshadeFBO=r.createFramebuffer(a,a,!0,"renderbuffer"),l.colorAttachment.set(e.texture)}r.bindFramebuffer.set(l.framebuffer),r.viewport.set([0,0,a,a]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:u,tileBoundsSegments:h}=e.getMercatorTileBoundsBuffers(),d=[];e.linearFloatFilteringSupported()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:d}).draw(e,o.TRIANGLES,Ae.disabled,Le.disabled,De.unblended,Oe.disabled,((e,i)=>{const n=i.stride,r=t.a6.create();return t.a6.ortho(r,0,t.V,-t.V,0,0,1),t.a6.translate(r,r,[0,-t.V,0]),{u_matrix:r,u_image:1,u_dimension:[n,n],u_zoom:e.overscaledZ}})(i.tileID,s),n.id,c,u,h),i.needsHillshadePrepare=!1}const rr=e=>({u_matrix:new t.bK(e),u_image0:new t.bO(e),u_skirt_height:new t.bN(e),u_ground_shadow_factor:new t.bM(e)}),or=(t,e,i)=>({u_matrix:t,u_image0:0,u_skirt_height:e,u_ground_shadow_factor:i}),sr=(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(n),u_merc_matrix:i,u_zoom_transition:r,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:m?Float32Array.from(m):new Float32Array(9),u_skirt_height:p,u_far_z_cutoff:f});function ar(t,e){return null!=t&&null!=e&&!(!t.hasData()||!e.hasData())&&null!=t.demTexture&&null!=e.demTexture&&t.tileID.key!==e.tileID.key}const lr=new class{constructor(){this.operations={}}newMorphing(t,e,i,n,r){if(t in this.operations){const e=this.operations[t];e.to.tileID.key!==i.tileID.key&&(e.queued=i)}else this.operations[t]={startTime:n,phase:0,duration:r,from:e,to:i,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const i=this.operations[e];for(i.phase=(t-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},cr={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ur(t,e,i){if(0===e)return 0;const n=e<1&&514===i?.25/e:1;return 6*Math.pow(1.5,22-t)*Math.max(e,1)*n}function hr(t,e){const i=1<<t.z;return!e&&(0===t.x||t.x===i-1)||0===t.y||t.y===i-1}const dr=t=>({u_matrix:t});function pr(e,i,n,r,o){if(o>0){const s=t.f.now(),a=(s-e.timeAdded)/o,l=i?(s-i.timeAdded)/o:-1,c=n.getSource(),u=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!i||Math.abs(i.tileID.overscaledZ-u)>Math.abs(e.tileID.overscaledZ-u),d=h&&e.refreshedUponExpiration?1:t.aa(h?a:1-l,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class fr extends Ze{constructor(e){const i={type:"raster-dem",maxzoom:e.transform.maxZoom},n=new t.bW(t.bX(),null),r=Ge("mock-dem",i,n,e.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,e){t.state="loaded",e(null)}}class mr extends Ze{constructor(e){const i=Ge("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new t.bW(t.bX(),null),e.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,e,i){if(t.freezeTileCoverage)return;this.transform=t;const n=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((e,i)=>{if(e[i.key]="",!this._tiles[i.key]){const e=new Ve(i,this._source.tileSize*i.overscaleFactor(),t.tileZoom);e.state="loaded",this._tiles[i.key]=e}return e}),{});for(const t in this._tiles)t in n||(this.freeFBO(t),this._tiles[t].unloadVectorData(),delete this._tiles[t])}freeFBO(t){const e=this.proxyCachedFBO[t];if(void 0!==e){const i=Object.values(e);this.renderCachePool.push(...i),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class gr extends t.am{constructor(t,e,i){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=e,this.projMatrix=i}}class _r extends t.ck{constructor(e,i){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},e.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),e.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),e.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,r,o]=function(e){const i=new t.aN,n=new t.aw,r=131;i.reserve(17161),n.reserve(33800);const o=t.V/128,s=t.V+o/2,a=s+o;for(let e=-o;e<a;e+=o)for(let n=-o;n<a;n+=o){const r=n<0||n>s||e<0||e>s?24575:0,o=t.aa(Math.round(n),0,t.V),a=t.aa(Math.round(e),0,t.V);i.emplaceBack(o+r,a)}const l=(t,e)=>{const i=e*r+t;n.emplaceBack(i+1,i,i+r),n.emplaceBack(i+r,i+r+1,i+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)l(e,t);return[0,129].forEach((t=>{for(let e=0;e<130;e++)l(e,t),l(t,e)})),[i,n,32768]}(),s=e.context;this.gridBuffer=s.createVertexBuffer(n,t.aP.members),this.gridIndexBuffer=s.createIndexBuffer(r),this.gridSegments=t.aB.simpleSegment(0,0,n.length,r.length),this.gridNoSkirtSegments=t.aB.simpleSegment(0,0,n.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new mr(i.map),this.orthoMatrix=t.a6.create(),t.a6.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,t.V,0,t.V,0,1);const a=s.gl;this._overlapStencilMode=new Le({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new fr(i.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(e,i,n){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);const r=e.terrain.properties,o=0===e.terrain.drapeRenderMode,s=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=t.f.now();const a=e.terrain&&e.terrain.scope,l=r.get("source"),c=o?this._mockSourceCache:e.getSourceCache(l,a);if(!c)return void t.w(`Couldn't find terrain source "${l}".`);if(this.sourceCache=c,this._exaggeration=s?this.calculateExaggeration(i):r.get("exaggeration"),!i.projection.requiresDraping&&s&&0===this._exaggeration)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&t.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const e=this.getScaledDemTileSize();this.sourceCache.update(i,e,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),i.updateElevation(!0,n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(e){const i=this._previousCameraAltitude,n=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=n;const r=null!=i?n-i:Number.MAX_VALUE;if(Math.abs(r)<2)return this._exaggeration;const o=e.zoom,s=this._style.terrain;if(!this._previousUpdateTimestamp)return s.getExaggeration(o);let a=o-this._previousZoom;const l=this._previousUpdateTimestamp;let c=o;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(o-c)>.5&&(a=.5*(o-c+a)),a*r<0&&(c+=a)),this._evaluationZoom=c;const u=s.getExaggeration(c),h=u===s.getExaggeration(Math.max(0,c-.1));if(h&&Math.abs(u-this._exaggeration)<.01)return u;let d=Math.min(.1,.00375*(this._updateTimestamp-l));return(h||u<.1||Math.abs(a)<1e-4)&&(d=Math.min(.2,4*d)),t.U(this._exaggeration,u,d)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(t.L.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.proxyCoords=i.getIds().map((t=>{const e=i.getTileByID(t).tileID;return e.projMatrix=n.calculateProjMatrix(e.toUnwrapped()),e}));!function(e,i){const n=i.transform.pointCoordinate(i.transform.getCameraPoint()),r=new t.P(n.x,n.y);e.sort(((e,i)=>{if(i.overscaledZ-e.overscaledZ)return i.overscaledZ-e.overscaledZ;const n=new t.P(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),o=new t.P(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),s=r.mult(1<<e.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(n)-s.distSqr(o)}))}(r,this.painter);const o=this.proxyToSource||{};this.proxyToSource={},r.forEach((t=>{this.proxyToSource[t.key]={}})),this.terrainTileForTile={};const s=this._style._mergedSourceCaches;for(const t in s){const i=s[t];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,e[t],o),i.usedForTerrain)continue;const n=e[t];i.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[i.id]=r.map((t=>new gr(t,t.key,this.orthoMatrix))),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1;const a={};this._visibleDemTiles=[];for(const t of this.proxyCoords){const e=this.terrainTileForTile[t.key];if(!e)continue;const i=e.tileID.key;i in a||(this._visibleDemTiles.push(e),a[i]=i)}}_assignTerrainTiles(t){this._initializing||t.forEach((t=>{if(this.terrainTileForTile[t.key])return;const e=this._findTileCoveringTileID(t,this.sourceCache);e&&(this.terrainTileForTile[t.key]=e)}))}_prepareDEMTextures(){const t=this.painter.context,e=t.gl;for(const i in this.terrainTileForTile){const n=this.terrainTileForTile[i],r=n.dem;!r||n.demTexture&&!n.needsDEMTextureUpload||(t.activeTexture.set(e.TEXTURE1),ir(this.painter,n,r))}}_prepareDemTileUniforms(t,e,i,n){if(!e||null==e.demTexture)return!1;const r=t.tileID.canonical,o=Math.pow(2,e.tileID.canonical.z-r.z),s=n||"";return i[`u_dem_tl${s}`]=[r.x*o%1,r.y*o%1],i[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,i=e.gl;if(!this._emptyDepthBufferTexture){const n=new t.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new t.T(e,n,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const e=this._visibleDemTiles.reduce(((e,i)=>{if(!i.dem)return e;const n=i.dem.tree.minimums[0];return n>0&&t++,e+n}),0);return t?e/t:0}_updateEmptyDEMTexture(){const e=this.painter.context,i=e.gl;e.activeTexture.set(i.TEXTURE2);const n=this._getLoadedAreaMinimum(),[r,o]=(()=>{const e=new t.cm({width:1,height:1},new Float32Array([n]));return[i.R32F,e]})();this._emptyDEMTextureDirty=!1;let s=this._emptyDEMTexture;return s?s.update(o,{premultiply:!1}):s=this._emptyDEMTexture=new t.T(e,o,r,{premultiply:!1}),s}setupElevationDraw(e,i,n){const r=this.painter.context,o=r.gl,s={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};s.u_exaggeration=this.exaggeration();let a=null,l=null,c=1;if(n&&n.morphing&&this._useVertexMorphing){const t=n.morphing.srcDemTile,i=n.morphing.dstDemTile;c=n.morphing.phase,t&&i&&(this._prepareDemTileUniforms(e,t,s,"_prev")&&(l=t),this._prepareDemTileUniforms(e,i,s)&&(a=i))}const u=t=>t&&t.demTexture&&this.painter.linearFloatFilteringSupported()?o.LINEAR:o.NEAREST,h=t=>{s.u_dem_size=1===t.size[0]?1:t.size[0]-2};if(l&&a)r.activeTexture.set(o.TEXTURE2),a.demTexture.bind(u(a),o.CLAMP_TO_EDGE),r.activeTexture.set(o.TEXTURE4),l.demTexture.bind(u(l),o.CLAMP_TO_EDGE),a.demTexture&&h(a.demTexture),s.u_dem_lerp=c;else{a=this.terrainTileForTile[e.tileID.key],r.activeTexture.set(o.TEXTURE2);const t=this._prepareDemTileUniforms(e,a,s)?a.demTexture:this.emptyDEMTexture;t.bind(u(a),o.CLAMP_TO_EDGE),h(t)}if(r.activeTexture.set(o.TEXTURE3),n&&n.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),s.u_depth_size_inv=[1,1]),n&&n.useMeterToDem&&a){const e=(1<<a.tileID.canonical.z)*t.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=e}if(n&&n.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),i.setTerrainUniformValues(r,s),"globe"===this.painter.transform.projection.name){const t=this.globeUniformValues(this.painter.transform,e.tileID.canonical,n&&n.useDenormalizedUpVectorScale);i.setGlobeUniformValues(r,t)}}globeUniformValues(e,i,n){const r=e.projection;return{u_tile_tl_up:r.upVector(i,0,0),u_tile_tr_up:r.upVector(i,t.V,0),u_tile_br_up:r.upVector(i,t.V,t.V),u_tile_bl_up:r.upVector(i,0,t.V),u_tile_up_scale:n?t.cl(1):r.upVectorScale(i,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const i=this.painter,n=this.painter.context;0!==e.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(e,i,n,r,o){if("globe"===e.transform.projection.name)!function(e,i,n,r,o){const s=e.context,a=s.gl;let l,c;const u=e.transform,h=t.cd(e,s,u),d=(t,i)=>{if(c===i)return;const n=[cr[i],"PROJECTION_GLOBE_VIEW"];h&&n.push("CUSTOM_ANTIALIASING");const r=e.isTileAffectedByFog(t);l=e.getOrCreateProgram("globeRaster",{defines:n,overrideFog:r}),c=i},p=e.colorModeForRenderPass(),f=new Ae(a.LEQUAL,Ae.ReadWrite,e.depthRangeFor3D);lr.update(o);const m=t.ce(u),g=[t.a5(u.center.lng),t.ae(u.center.lat)],_=e.globeSharedBuffers,y=[u.width*t.f.devicePixelRatio,u.height*t.f.devicePixelRatio],v=Float32Array.from(u.globeMatrix),x={useDenormalizedUpVectorScale:!0};{const u=e.transform,h=ur(u.zoom,i.exaggeration(),i.sourceCache._source.tileSize);c=-1;const b=a.TRIANGLES;for(const c of r){const r=n.getTile(c),w=Le.disabled,E=i.prevTerrainTileForTile[c.key],S=i.terrainTileForTile[c.key];ar(E,S)&&lr.newMorphing(c.key,E,S,o,250),s.activeTexture.set(a.TEXTURE0),r.texture&&r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const T=lr.getMorphValuesForProxy(c.key),M=T?1:0;T&&t.j(x,{morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:t.cc(T.phase)}});const I=t.cf(c.canonical),C=t.cg(I.getCenter().lat),A=t.ch(c.canonical,I,C,u.worldSize/u._pixelsPerMercatorPixel),P=t.aT(t.ci(c.canonical)),L=sr(u.expandedFarZProjMatrix,v,m,P,t.S(u.zoom),g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,h,u._farZ,A);if(d(c,M),l&&(i.setupElevationDraw(r,l,x),e.uploadCommonUniforms(s,l,c.toUnwrapped()),_)){const[t,i,n]=_.getGridBuffers(C,0!==h);l.draw(e,b,f,w,p,Oe.backCCW,L,"globe_raster",t,i,n)}}}if(_&&(e.renderDefaultNorthPole||e.renderDefaultSouthPole)){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];h&&o.push("CUSTOM_ANTIALIASING"),l=e.getOrCreateProgram("globeRaster",{defines:o});for(const o of r){const{x:r,y:c,z:h}=o.canonical,d=0===c,m=c===(1<<h)-1,[v,b,w,E]=_.getPoleBuffers(h,!1);if(E&&(d||m)){const c=n.getTile(o);s.activeTexture.set(a.TEXTURE0),c.texture&&c.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let _=t.cj(h,r,u);const S=t.aT(t.ci(o.canonical)),T=(t,i)=>t.draw(e,a.TRIANGLES,f,Le.disabled,p,Oe.disabled,sr(u.expandedFarZProjMatrix,_,_,S,0,g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,0,u._farZ),"globe_pole_raster",i,w,E);i.setupElevationDraw(c,l,x),e.uploadCommonUniforms(s,l,o.toUnwrapped()),d&&e.renderDefaultNorthPole&&T(l,v),m&&e.renderDefaultSouthPole&&(_=t.a6.scale(t.a6.create(),_,[1,-1,1]),T(l,b))}}}}(e,i,n,r,o);else{const s=e.context,a=s.gl;let l,c;const u=e.shadowRenderer,h=yn(e,e.longestCutoffRange),d=t=>{if(c===t)return;const i=[];i.push(cr[t]),h.shouldRenderCutoff&&i.push("RENDER_CUTOFF"),l=e.getOrCreateProgram("terrainRaster",{defines:i}),c=t},p=e.colorModeForRenderPass(),f=new Ae(a.LEQUAL,Ae.ReadWrite,e.depthRangeFor3D);lr.update(o);const m=e.transform,g=ur(m.zoom,i.exaggeration(),i.sourceCache._source.tileSize);let _=[0,0,0];if(u){const t=e.style.directionalLight,i=e.style.ambientLight;t&&i&&(_=Tn(t,i))}{c=-1;const y=a.TRIANGLES,[v,x]=[i.gridIndexBuffer,i.gridSegments];for(const c of r){const r=n.getTile(c),b=Le.disabled,w=i.prevTerrainTileForTile[c.key],E=i.terrainTileForTile[c.key];ar(w,E)&&lr.newMorphing(c.key,w,E,o,250),s.activeTexture.set(a.TEXTURE0),r.texture&&r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const S=lr.getMorphValuesForProxy(c.key),T=S?1:0;let M;S&&(M={morphing:{srcDemTile:S.from,dstDemTile:S.to,phase:t.cc(S.phase)}});const I=or(c.projMatrix,hr(c.canonical,m.renderWorldCopies)?g/10:g,_);if(d(T),!l)continue;i.setupElevationDraw(r,l,M);const C=c.toUnwrapped();u&&u.setupShadows(C,l),e.uploadCommonUniforms(s,l,C,null,h),l.draw(e,y,f,b,p,Oe.backCCW,I,"terrain_raster",i.gridBuffer,v,x)}}}}(i,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const i=this.painter,n=this.painter.context,r=this.proxySourceCache,o=this.proxiedCoords[r.id],s=this._drapedRenderBatches.shift(),a=i.style.order,l=[];let c=0;for(const u of o){const o=r.getTileByID(u.proxyTileKey),h=r.proxyCachedFBO[u.key]?r.proxyCachedFBO[u.key][e]:void 0,d=void 0!==h?r.renderCache[h]:this.pool[c++],p=void 0!==h;if(o.texture=d.tex,p&&!d.dirty){l.push(o.tileID);continue}let f;n.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(n.clear({color:t.ax.transparent,stencil:0}),d.dirty=!1);for(let t=s.start;t<=s.end;++t){const e=i.style._mergedLayers[a[t]];if(e.isHidden(i.transform.zoom))continue;const r=i.style.getLayerSourceCache(e),o=r?this.proxyToSource[u.key][r.id]:[u];if(!o)continue;const s=o;n.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(r?r.id:null)&&(this._setupStencil(d,o,e,r),f=r?r.id:null),i.renderLayer(i,r,e,s)}if(0===this._drapedRenderBatches.length)for(const t of this._pendingGroundEffectLayers){const e=i.style._mergedLayers[a[t]];if(e.isHidden(i.transform.zoom))continue;const r=i.style.getLayerSourceCache(e),o=r?this.proxyToSource[u.key][r.id]:[u];if(!o)continue;const s=o;n.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(r?r.id:null)&&(this._setupStencil(d,o,e,r),f=r?r.id:null),i.renderLayer(i,r,e,s)}this.renderedToTile?(d.dirty=!0,l.push(o.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),s.end+1}postRender(){}isLayerOrderingCorrect(t){const e=t.order.length;let i=-1,n=e;for(let r=0;r<e;++r)this._style.isLayerDraped(t._mergedLayers[t.order[r]])?i=Math.max(i,r):n=Math.min(n,r);return n>i}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((t=>t.dem)).forEach((e=>{t=Math.min(t,e.dem.tree.minimums[0])})),0===t?t:(t-30)*this._exaggeration}raycast(t,e,i){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter((t=>t.dem)).map((n=>{const r=n.tileID,o=1<<r.overscaledZ,{x:s,y:a}=r.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:n.dem.tree.raycastRoot(l,u,c,h,t,e,i),tile:n}}));n.sort(((t,e)=>(null!==t.t?t.t:Number.MAX_VALUE)-(null!==e.t?e.t:Number.MAX_VALUE)));for(const r of n){if(null==r.t)return null;const n=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,t,e,i);if(null!=n)return n}return null}_createFBO(){const e=this.painter.context,i=e.gl,n=this.drapeBufferSize;e.activeTexture.set(i.TEXTURE0);const r=new t.T(e,{width:n[0],height:n[1],data:null},i.RGBA);r.bind(i.LINEAR,i.CLAMP_TO_EDGE);const o=e.createFramebuffer(n[0],n[1],!0,null);return o.colorAttachment.set(r.texture),o.depthAttachment=new Ie(e,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:o,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const e=this._style._mergedLayers[t],i=e.isHidden(this.painter.transform.zoom);return"custom"===e.type?!i&&e.shouldRedrape():!i&&e.hasTransition()}))}_clearLineLayersFromRenderCache(){let e=!1;for(const t of this._style.getSources())if(t instanceof Rt){e=!0;break}if(!e)return;const i={};for(let e=0;e<this._style.order.length;++e){const n=this._style._mergedLayers[this._style.order[e]],r=this._style.getLayerSourceCache(n);if(r&&!i[r.id]&&!n.isHidden(this.painter.transform.zoom)&&"line"===n.type&&n.widthExpression()instanceof t.Z){i[r.id]=!0;for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][r.id];if(e)for(const t of e)this._clearRenderCacheForTile(r.id,t)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e]._source instanceof Dt){t=!0;break}if(!t)return;const e={};for(let t=0;t<this._style.order.length;++t){const i=this._style._mergedLayers[this._style.order[t]],n=this._style.getLayerSourceCache(i);if(!n||e[n.id])continue;if(i.isHidden(this.painter.transform.zoom)||"raster"!==i.type)continue;const r=i.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][n.id];if(e)for(const t of e){const e=pr(n.getTile(t),n.findLoadedParent(t,0),n,this.painter.transform,r);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(n.id,t)}}}}_setupDrapedRenderBatches(){const e=this._style.order,i=e.length;if(0===i)return;const n=[];this._pendingGroundEffectLayers=[];let r,o=0,s=this._style._mergedLayers[e[o]];for(;!this._style.isLayerDraped(s)&&s.isHidden(this.painter.transform.zoom)&&++o<i;)s=this._style._mergedLayers[e[o]];for(;o<i;++o){const t=this._style._mergedLayers[e[o]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===r&&(r=o):("fill-extrusion"===t.type&&this._pendingGroundEffectLayers.push(o),void 0!==r&&(n.push({start:r,end:o-1}),r=void 0)))}if(void 0!==r&&n.push({start:r,end:o-1}),0!==n.length){const e=n[n.length-1];this._pendingGroundEffectLayers.every((t=>t>e.end))||t.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=n}_setupRenderCache(t){const e=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,e.renderCache.length>e.renderCachePool.length){const t=Object.values(e.proxyCachedFBO);e.proxyCachedFBO={};for(let i=0;i<t.length;++i){const n=Object.values(t[i]);e.renderCachePool.push(...n)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,n=this._tilesDirty;for(let r=i.length-1;r>=0;r--){const o=i[r];if(e.getTileByID(o.key),void 0!==e.proxyCachedFBO[o.key]){const i=t[o.key],r=this.proxyToSource[o.key];let s=0;for(const t in r){const e=r[t],o=i[t];if(!o||o.length!==e.length||e.some(((e,i)=>e!==o[i]||n[t]&&n[t].hasOwnProperty(e.key)))){s=-1;break}++s}for(const t in e.proxyCachedFBO[o.key])e.renderCache[e.proxyCachedFBO[o.key][t]].dirty=s<0||s!==Object.values(i).length}}const r=[...this._drapedRenderBatches];r.sort(((t,e)=>e.end-e.start-(t.end-t.start)));for(const t of r)for(const n of i){if(e.proxyCachedFBO[n.key])continue;let i=e.renderCachePool.pop();void 0===i&&e.renderCache.length<50&&(i=e.renderCache.length,e.renderCache.push(this._createFBO())),void 0!==i&&(e.proxyCachedFBO[n.key]={},e.proxyCachedFBO[n.key][t.start]=i,e.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(t,e,i,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const r=this.painter.context,o=r.gl;if(e.length<=1)return void(this._overlapStencilType=!1);let s;if(i.isTileClipped())s=e.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(e[0].overscaledZ>e[e.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(e,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Le.disabled}_renderTileClippingMasks(t,e){const i=this.painter,n=this.painter.context,r=n.gl;i._tileClippingMaskIDs={},n.setColorMode(De.disabled),n.setDepthMode(Ae.disabled);const o=i.getOrCreateProgram("clippingMask");for(const n of t){const t=i._tileClippingMaskIDs[n.key]=--e;o.draw(i,r.TRIANGLES,Ae.disabled,new Le({func:r.ALWAYS,mask:0},t,255,r.KEEP,r.KEEP,r.REPLACE),De.disabled,Oe.disabled,dr(n.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(e){const i=this.painter.transform;if(e.x<0||e.x>i.width||e.y<0||e.y>i.height)return null;const n=[e.x,e.y,1,1];t.a7.transformMat4(n,n,i.pixelMatrixInverse),t.a7.scale(n,n,1/n[3]),n[0]/=i.worldSize,n[1]/=i.worldSize;const r=i._camera.position,o=t.bl(1,i.center.lat),s=[r[0],r[1],r[2]/o,0],a=t.N.subtract([],n.slice(0,3),s);t.N.normalize(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(t.N.scaleAndAdd(s,s,a,l),s[3]=s[2],s[2]*=o,s):null}drawDepth(){const e=this.painter,i=e.context,n=this.proxySourceCache,r=Math.ceil(e.width),o=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const e=i.gl,n=i.createFramebuffer(r,o,!0,"renderbuffer");i.activeTexture.set(e.TEXTURE0);const s=new t.T(i,{width:r,height:o,data:null},e.RGBA);s.bind(e.NEAREST,e.CLAMP_TO_EDGE),n.colorAttachment.set(s.texture);const a=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,r,o);n.depthAttachment.set(a),this._depthFBO=n,this._depthTexture=s}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,r,o]),function(t,e,i,n){if("globe"===t.transform.projection.name)return;const r=t.context,o=r.gl;r.clear({depth:1});const s=t.getOrCreateProgram("terrainDepth"),a=new Ae(o.LESS,Ae.ReadWrite,t.depthRangeFor3D);for(const r of n){const n=i.getTile(r),l=or(r.projMatrix,0,[0,0,0]);e.setupElevationDraw(n,s),s.draw(t,o.TRIANGLES,a,Le.disabled,De.unblended,Oe.backCCW,l,"terrain_depth",e.gridBuffer,e.gridIndexBuffer,e.gridNoSkirtSegments)}}(e,this,n,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,i,n){if(e.getSource()instanceof t.ap)return this._setupProxiedCoordsForImageSource(e,i,n);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const r=this.proxiedCoords[e.id]=[],o=this.proxyCoords;for(let t=0;t<o.length;t++){const i=o[t],s=this._findTileCoveringTileID(i,e);if(s){const t=this._createProxiedId(i,s,n[i.key]&&n[i.key][e.id]);r.push(t),this.proxyToSource[i.key][e.id]=[t]}}let s=!1;const a=new Set;for(let t=0;t<i.length;t++){const o=e.getTile(i[t]);if(!o||!o.hasData())continue;const l=this._findTileCoveringTileID(o.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==o.tileID.canonical.z){const t=this.proxyToSource[l.tileID.key][e.id],i=this._createProxiedId(l.tileID,o,n[l.tileID.key]&&n[l.tileID.key][e.id]);t?t.splice(t.length-1,0,i):this.proxyToSource[l.tileID.key][e.id]=[i];const c=this.proxyToSource[l.tileID.key][e.id];a.has(c)||a.add(c),r.push(i),s=!0}}if(this._sourceTilesOverlap[e.id]=s,s&&this._debugParams.sortTilesHiZFirst)for(const t of a)t.sort(((t,e)=>e.overscaledZ-t.overscaledZ))}_setupProxiedCoordsForImageSource(e,i,n){if(!e.getSource().loaded())return;const r=this.proxiedCoords[e.id]=[],o=this.proxyCoords,s=e.getSource(),a=s.tileID;if(!a)return;const l=new t.P(a.x,a.y)._div(1<<a.z),c=s.coordinates.map(t.L.fromLngLat).reduce(((t,e)=>(t.min.x=Math.min(t.min.x,e.x-l.x),t.min.y=Math.min(t.min.y,e.y-l.y),t.max.x=Math.max(t.max.x,e.x-l.x),t.max.y=Math.max(t.max.y,e.y-l.y),t)),{min:new t.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(e,i)=>{const n=e.wrap+e.canonical.x/(1<<e.canonical.z),r=e.canonical.y/(1<<e.canonical.z),o=t.V/(1<<e.canonical.z),s=i.wrap+i.canonical.x/(1<<i.canonical.z),a=i.canonical.y/(1<<i.canonical.z);return n+o<s+c.min.x||n>s+c.max.x||r+o<a+c.min.y||r>a+c.max.y};for(let t=0;t<o.length;t++){const s=o[t];for(let t=0;t<i.length;t++){const o=e.getTile(i[t]);if(!o||!o.hasData())continue;if(u(s,o.tileID))continue;const a=this._createProxiedId(s,o,n[s.key]&&n[s.key][e.id]),l=this.proxyToSource[s.key][e.id];l?l.push(a):this.proxyToSource[s.key][e.id]=[a],r.push(a)}}}_createProxiedId(e,i,n){let r=this.orthoMatrix;if(n){const t=n.find((t=>t.key===i.tileID.key));if(t)return t}if(i.tileID.key!==e.key){const n=e.canonical.z-i.tileID.canonical.z;let o,s,a;r=t.a6.create();const l=i.tileID.wrap-e.wrap<<e.overscaledZ;n>0?(o=t.V>>n,s=o*((i.tileID.canonical.x<<n)-e.canonical.x+l),a=o*((i.tileID.canonical.y<<n)-e.canonical.y)):(o=t.V<<-n,s=t.V*(i.tileID.canonical.x-(e.canonical.x+l<<-n)),a=t.V*(i.tileID.canonical.y-(e.canonical.y<<-n))),t.a6.ortho(r,0,o,0,o,0,1),t.a6.translate(r,r,[s,a,0])}return new gr(i.tileID,e.key,r)}_findTileCoveringTileID(e,i){let n=i.getTile(e);if(n&&n.hasData())return n;const r=this._findCoveringTileCache[i.id],o=r[e.key];if(n=o?i.getTileByID(o):null,n&&n.hasData()||null===o)return n;let s=n?n.tileID:e,a=s.overscaledZ;const l=i.getSource().minzoom,c=[];if(!o){const r=i.getSource().maxzoom;if(e.canonical.z>=r){const n=e.canonical.z-r;i.getSource().reparseOverscaled?(a=Math.max(e.canonical.z+2,i.transform.tileZoom),s=new t.am(a,e.wrap,r,e.canonical.x>>n,e.canonical.y>>n)):0!==n&&(a=r,s=new t.am(a,e.wrap,r,e.canonical.x>>n,e.canonical.y>>n))}s.key!==e.key&&(c.push(s.key),n=i.getTile(s))}const u=t=>{c.forEach((e=>{r[e]=t})),c.length=0};for(a-=1;a>=l&&(!n||!n.hasData());a--){n&&u(n.tileID.key);const t=s.calculateScaledKey(a);if(n=i.getTileByID(t),n&&n.hasData())break;const e=r[t];if(null===e)break;void 0===e?c.push(t):n=i.getTileByID(e)}return u(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,e){let i=this._tilesDirty[t];i||(i=this._tilesDirty[t]={}),i[e.key]=!0}}function yr(e,i,n){const r=function(e,i,n){const r=t.N.dot(i,e),o=t.N.dot(n,[.2126,.7152,.0722]),s=(t,e,i)=>(1-i)*t+i*e,a=s(1-.3*Math.min(o,1),1,Math.min(r+1,1));return s(.92,1,Math.asin(t.aa(i[2],-1,1))/Math.PI+.5)*a}(e,[0,0,1],i),o=[0,0,0];t.N.scale(o,n.slice(0,3),r);const s=[0,0,0];t.N.scale(s,i.slice(0,3),e[2]);const a=[0,0,0];return t.N.add(a,o,s),t.bU(a)}const vr=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],xr=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class br{static cacheKey(t,e,i,n){let r=`${e}${n?n.cacheKey:""}`;for(const e of i)t.usedDefines.includes(e)&&(r+=`/${e}`);return r}constructor(e,i,n,r,o,s,a){const l=e.gl;this.program=l.createProgram(),this.configuration=r,this.name=i,this.fixedDefines=[...s];const c=r?r.getBinderAttributes():[],u=(n.staticAttributes||[]).concat(c);let h=r?r.defines():[];h=h.concat(s.map((t=>`#define ${t}`)));const d="#version 300 es\n";let p=d+h.concat("precision mediump float;",Yn,$n.fragmentSource).join("\n");for(const t of n.fragmentIncludes)p+=`\n${qn[t]}`;p+=`\n${n.fragmentSource}`;let f=d+h.concat("precision highp float;",Yn,$n.vertexSource).join("\n");for(const t of n.vertexIncludes)f+=`\n${qn[t]}`;f+=`\n${n.vertexSource}`;const m=l.createShader(l.FRAGMENT_SHADER);if(l.isContextLost())return void(this.failedToCreate=!0);l.shaderSource(m,p),l.compileShader(m),l.attachShader(this.program,m);const g=l.createShader(l.VERTEX_SHADER);if(l.isContextLost())this.failedToCreate=!0;else{l.shaderSource(g,f),l.compileShader(g),l.attachShader(this.program,g),this.attributes={},this.numAttributes=u.length;for(let t=0;t<this.numAttributes;t++)if(u[t]){const e=u[t].startsWith("a_")?u[t]:`a_${u[t]}`;l.bindAttribLocation(this.program,t,e),this.attributes[e]=t}a&&a.shaderVaryings.length>0&&l.transformFeedbackVaryings(this.program,a.shaderVaryings,a.bufferMode),l.linkProgram(this.program),l.deleteShader(g),l.deleteShader(m),this.fixedUniforms=o(e),this.binderUniforms=r?r.getUniforms(e):[],s.includes("TERRAIN")&&(this.terrainUniforms=(e=>({u_dem:new t.bO(e),u_dem_prev:new t.bO(e),u_dem_tl:new t.bL(e),u_dem_scale:new t.bN(e),u_dem_tl_prev:new t.bL(e),u_dem_scale_prev:new t.bN(e),u_dem_size:new t.bN(e),u_dem_lerp:new t.bN(e),u_exaggeration:new t.bN(e),u_depth:new t.bO(e),u_depth_size_inv:new t.bL(e),u_meter_to_dem:new t.bN(e),u_label_plane_matrix_inv:new t.bK(e)}))(e)),s.includes("GLOBE")&&(this.globeUniforms=(e=>({u_tile_tl_up:new t.bM(e),u_tile_tr_up:new t.bM(e),u_tile_br_up:new t.bM(e),u_tile_bl_up:new t.bM(e),u_tile_up_scale:new t.bN(e)}))(e)),s.includes("FOG")&&(this.fogUniforms=(e=>({u_fog_matrix:new t.bK(e),u_fog_range:new t.bL(e),u_fog_color:new t.bP(e),u_fog_horizon_blend:new t.bN(e),u_fog_vertical_limit:new t.bL(e),u_fog_temporal_offset:new t.bN(e),u_frustum_tl:new t.bM(e),u_frustum_tr:new t.bM(e),u_frustum_br:new t.bM(e),u_frustum_bl:new t.bM(e),u_globe_pos:new t.bM(e),u_globe_radius:new t.bN(e),u_globe_transition:new t.bN(e),u_is_globe:new t.bO(e),u_viewport:new t.bL(e)}))(e)),s.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(e=>({u_cutoff_params:new t.bP(e)}))(e)),s.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(e=>({u_lighting_ambient_color:new t.bM(e),u_lighting_directional_dir:new t.bM(e),u_lighting_directional_color:new t.bM(e),u_ground_radiance:new t.bM(e)}))(e)),s.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(e=>({u_light_matrix_0:new t.bK(e),u_light_matrix_1:new t.bK(e),u_fade_range:new t.bL(e),u_shadow_normal_offset:new t.bM(e),u_shadow_intensity:new t.bN(e),u_shadow_texel_size:new t.bN(e),u_shadow_map_resolution:new t.bN(e),u_shadow_direction:new t.bM(e),u_shadow_bias:new t.bM(e),u_shadowmap_0:new t.bO(e),u_shadowmap_1:new t.bO(e)}))(e))}}setTerrainUniformValues(t,e){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t]&&i[t].set(this.program,t,e[t])}}setGlobeUniformValues(t,e){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t]&&i[t].set(this.program,t,e[t])}}setFogUniformValues(t,e){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setCutoffUniformValues(t,e){if(!this.cutoffUniforms)return;const i=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setLightsUniformValues(t,e){if(!this.lightsUniforms)return;const i=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setShadowUniformValues(t,e){if(this.failedToCreate||!this.shadowUniforms)return;const i=this.shadowUniforms;t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}_drawDebugWireframe(e,i,n,r,o,s,a,l,c,u){const h=e.options.wireframe;if(!1===h.terrain&&!1===h.layers2D&&!1===h.layers3D)return;const d=e.context;if(!(()=>!(!h.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!h.layers2D||e._terrain&&e._terrain.renderingToTexture||!vr.includes(this.name))||!(!h.layers3D||!xr.includes(this.name)))())return;const p=d.gl,f=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,o,d);if(!f)return;const m=[...this.fixedDefines];m.push("DEBUG_WIREFRAME");const g=e.getOrCreateProgram(this.name,{config:this.configuration,defines:m});d.program.set(g.program);const _=(t,e,i)=>{if(e[t]&&i[t])for(const n in e[t])i[t][n]&&i[t][n].set(i.program,n,e[t][n].current)};c&&c.setUniforms(g.program,d,g.binderUniforms,a,{zoom:l}),_("fixedUniforms",this,g),_("terrainUniforms",this,g),_("globeUniforms",this,g),_("fogUniforms",this,g),_("lightsUniforms",this,g),_("shadowUniforms",this,g),f.bind(),d.setColorMode(new De([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.ZERO,p.ONE],t.ax.transparent,[!0,!0,!0,!1])),d.setDepthMode(new Ae(i.func===p.LESS?p.LEQUAL:i.func,Ae.ReadOnly,i.range)),d.setStencilMode(Le.disabled);const y=3*s.primitiveLength*2,v=3*s.primitiveOffset*2*2;u&&u>1?p.drawElementsInstanced(p.LINES,y,p.UNSIGNED_SHORT,v,u):p.drawElements(p.LINES,y,p.UNSIGNED_SHORT,v),o.bind(),d.program.set(this.program),d.setDepthMode(i),d.setStencilMode(n),d.setColorMode(r)}draw(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g){const _=t.context,y=_.gl;if(this.failedToCreate)return;_.program.set(this.program),_.setDepthMode(i),_.setStencilMode(n),_.setColorMode(r),_.setCullFace(o);for(const t of Object.keys(this.fixedUniforms))this.fixedUniforms[t].set(this.program,t,s[t]);p&&p.setUniforms(this.program,_,this.binderUniforms,h,{zoom:d});const v={[y.POINTS]:1,[y.LINES]:2,[y.TRIANGLES]:3,[y.LINE_STRIP]:1}[e],x=g&&g.length>0;if(x){for(const t of g)y.bindBufferBase(y.TRANSFORM_FEEDBACK_BUFFER,t.targetIndex,t.buffer.buffer);y.beginTransformFeedback(e)}const b=m&&m>0?1:void 0;for(const o of u.get()){const s=o.vaos||(o.vaos={});(s[a]||(s[a]=new Qn)).bind(_,this,l,p?p.getPaintVertexBuffers():[],c,o.vertexOffset,f||[],b),m&&m>1?y.drawElementsInstanced(e,o.primitiveLength*v,y.UNSIGNED_SHORT,o.primitiveOffset*v*2,m):c?y.drawElements(e,o.primitiveLength*v,y.UNSIGNED_SHORT,o.primitiveOffset*v*2):y.drawArrays(e,o.vertexOffset,o.vertexLength),e===y.TRIANGLES&&c&&this._drawDebugWireframe(t,i,n,r,c,o,h,d,p,m)}x&&y.endTransformFeedback()}}function wr(e,i){const n=Math.pow(2,i.tileID.overscaledZ),r=i.tileSize*Math.pow(2,e.transform.tileZoom)/n,o=r*(i.tileID.canonical.x+i.tileID.wrap*n),s=r*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/t.a3(i,1,e.transform.tileZoom),u_pixel_coord_upper:[o>>16,s>>16],u_pixel_coord_lower:[65535&o,65535&s]}}const Er=t.a6.create(),Sr=(e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g)=>{const _=i.style.light,y=_.properties.get("position"),v=[y.x,y.y,y.z],x=t.co.create();"viewport"===_.properties.get("anchor")&&(t.co.fromRotation(x,-i.transform.angle),t.N.transformMat3(v,v,x));const b=_.properties.get("color"),w=i.transform,E={u_matrix:e,u_lightpos:v,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+n,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Er,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:o,u_edge_radius:s,u_flood_light_color:d,u_vertical_scale:p,u_flood_light_intensity:f,u_ground_shadow_factor:m,u_emissive_strength:g};return"globe"===w.projection.name&&(E.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],E.u_zoom_transition=c,E.u_inv_rot_matrix=h,E.u_merc_center=u,E.u_up_dir=w.projection.upVector(new t.bs(0,0,0),u[0]*t.V,u[1]*t.V),E.u_height_lift=l),E},Tr=(t,e,i)=>({u_matrix:t,u_edge_radius:e,u_vertical_scale:i}),Mr=(e,i,n,r,o,s,a,l,c,u,h,d,p,f)=>{const m=Sr(e,i,n,r,o,s,a,c,u,h,d,p,f,1,[0,0,0],0),g={u_height_factor:-Math.pow(2,a.overscaledZ)/l.tileSize/8};return t.e(m,wr(i,l),g)},Ir=(t,e)=>({u_matrix:t,u_emissive_strength:e}),Cr=(e,i,n,r)=>t.e(Ir(e,i),wr(n,r)),Ar=(t,e,i)=>({u_matrix:t,u_world:i,u_emissive_strength:e}),Pr=(e,i,n,r,o)=>t.e(Cr(e,i,n,r),{u_world:o}),Lr=(e,i,n,r)=>{const o=t.V/n.tileSize;return{u_matrix:e,u_camera_to_center_distance:i.getCameraToCenterDistance(r),u_extrude_scale:[i.pixelsToGLUnits[0]/o,i.pixelsToGLUnits[1]/o]}},Rr=(t,e,i=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}),Dr=t.a6.create(),kr=(e,i,n,r,o,s,a)=>{const l=e.transform,c="globe"===l.projection.name,u=c?t.cp(l.zoom,i.canonical)*l._pixelsPerMercatorPixel:t.a3(n,1,s),h={u_matrix:i.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:Dr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=r,h.u_merc_center=o,h.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],h.u_zoom_transition=t.S(l.zoom);const e=o[0]*t.V,n=o[1]*t.V;h.u_up_dir=l.projection.upVector(new t.bs(0,0,0),e,n)}return h};function Nr(t,[e,i,n,r],[o,s]){if(o===s)return[0,0,0,0];const a=255*(t-1)/(t*(s-o));return[e*a,i*a,n*a,r*a]}function Or(t,e,[i,n]){return i===n?0:.5/t+(e-i)*(t-1)/(t*(n-i))}const Fr=(e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b)=>{return{u_matrix:e,u_normalize_matrix:i,u_globe_matrix:n,u_merc_matrix:r,u_grid_matrix:o,u_tl_parent:s,u_scale_parent:u,u_fade_t:h.mix,u_opacity:h.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(E=d.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(w=d.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:zr(d.paint.get("raster-hue-rotate")),u_perspective_transform:p,u_raster_elevation:f,u_zoom_transition:a,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:Nr(t.cq,g,y),u_colorization_offset:Or(t.cq,_,y),u_color_ramp:m,u_texture_offset:[x/(v+2*x),v/(v+2*x)],u_texture_res:[v+2*x,v+2*x],u_emissive_strength:b};var w,E};function zr(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const Br=(t,e,i,n,r,o,s,a,l,c,u,h)=>({u_matrix:t,u_normalize_matrix:e,u_globe_matrix:i,u_merc_matrix:n,u_grid_matrix:r,u_tl_parent:o,u_scale_parent:c,u_fade_t:u.mix,u_opacity:u.opacity,u_image0:0,u_image1:1,u_raster_elevation:h,u_zoom_transition:s,u_merc_center:a,u_cutoff_params:l}),Ur=(t,e,i,n,r,o,s,a)=>({u_tile_offset:t,u_velocity:e,u_color_ramp:n,u_velocity_res:i,u_max_speed:r,u_texture_offset:o,u_data_scale:s,u_data_offset:a}),Vr=(t,e,i,n,r,o,s,a)=>({u_velocity:t,u_velocity_res:e,u_max_speed:i,u_speed_factor:n,u_lifetime_delta:r,u_rand_seed:Math.random(),u_texture_offset:o,u_data_scale:s,u_data_offset:a}),jr=t.a6.create(),Gr=(e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y)=>{const v=o.transform,x={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:v.getCameraToCenterDistance(g),u_rotate_symbol:+n,u_aspect_ratio:v.width/v.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+r,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:jr,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:jr,u_up_vector:[0,-1,0],u_icon_transition:y||0,u_icon_saturation:_};return"globe"===g.name&&(x.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],x.u_zoom_transition=d,x.u_inv_rot_matrix=f,x.u_merc_center=p,x.u_camera_forward=v._camera.forward(),x.u_ecef_origin=t.cr(v.globeMatrix,h.toUnwrapped()),x.u_tile_matrix=Float32Array.from(v.globeMatrix),x.u_up_vector=m),x},Hr=(e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_)=>t.e(Gr(e,i,n,r,o,s,a,l,c,u,d,p,f,m,g,_,1),{u_gamma_scale:r?o.transform.getCameraToCenterDistance(_)*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:t.f.devicePixelRatio,u_is_halo:+h,undefined:void 0}),Wr=(e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g)=>t.e(Hr(e,i,n,r,o,s,a,l,!0,c,!0,h,d,p,f,m,g),{u_texsize_icon:u,u_texture_icon:1}),qr=(t,e,i,n)=>({u_matrix:t,u_emissive_strength:e,u_opacity:i,u_color:n}),Xr=(e,i,n,r,o,s,a)=>t.e(function(e,i,n,r){const o=n.imageManager.getPattern(e.toString(),i),{width:s,height:a}=n.imageManager.getPixelSize(i),l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,n.transform.tileZoom)/l,u=c*(r.tileID.canonical.x+r.tileID.wrap*l),h=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl:o.tl,u_pattern_br:o.br,u_texsize:[s,a],u_pattern_size:o.displaySize,u_tile_units_to_pixels:1/t.a3(r,1,n.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(o,s,r,a),{u_matrix:e,u_emissive_strength:i,u_opacity:n}),$r=(e,i,n,r,o,s,a,l,c,u,h,d,p=[0,0,0],f)=>{const m=r.style.light,g=m.properties.get("position"),_=[-g.x,-g.y,g.z],y=t.co.create();"viewport"===m.properties.get("anchor")&&(t.co.fromRotation(y,-r.transform.angle),t.N.transformMat3(_,_,y));const v="MASK"===u.alphaMode,x=m.properties.get("color"),b=d.paint.get("model-ambient-occlusion-intensity"),w=d.paint.get("model-color").constantOr(t.ax.white),E=d.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:i,u_normal_matrix:n,u_lightpos:_,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_camera_pos:p,u_opacity:o,u_baseTextureIsAlpha:0,u_alphaMask:+v,u_alphaCutoff:u.alphaCutoff,u_baseColorFactor:[s.r,s.g,s.b,s.a],u_emissiveFactor:[a[0],a[1],a[2],1],u_metallicFactor:l,u_roughnessFactor:c,u_baseColorTexture:_n.BaseColor,u_metallicRoughnessTexture:_n.MetallicRoughness,u_normalTexture:_n.Normal,u_occlusionTexture:_n.Occlusion,u_emissionTexture:_n.Emission,u_color_mix:[w.r,w.g,w.b,E],u_aoIntensity:b,u_emissive_strength:h,u_occlusionTextureTransform:f||[0,0,0,0]}},Yr=new Float32Array(16),Zr=(t,e=Yr,i=Yr)=>({u_matrix:t,u_instance:e,u_node_matrix:i}),Kr={fillExtrusion:e=>({u_matrix:new t.bK(e),u_lightpos:new t.bM(e),u_lightintensity:new t.bN(e),u_lightcolor:new t.bM(e),u_vertical_gradient:new t.bN(e),u_opacity:new t.bN(e),u_edge_radius:new t.bN(e),u_ao:new t.bL(e),u_tile_id:new t.bM(e),u_zoom_transition:new t.bN(e),u_inv_rot_matrix:new t.bK(e),u_merc_center:new t.bL(e),u_up_dir:new t.bM(e),u_height_lift:new t.bN(e),u_flood_light_color:new t.bM(e),u_vertical_scale:new t.bN(e),u_flood_light_intensity:new t.bN(e),u_ground_shadow_factor:new t.bM(e),u_emissive_strength:new t.bN(e)}),fillExtrusionDepth:e=>({u_matrix:new t.bK(e),u_edge_radius:new t.bN(e),u_vertical_scale:new t.bN(e)}),fillExtrusionPattern:e=>({u_matrix:new t.bK(e),u_lightpos:new t.bM(e),u_lightintensity:new t.bN(e),u_lightcolor:new t.bM(e),u_vertical_gradient:new t.bN(e),u_height_factor:new t.bN(e),u_edge_radius:new t.bN(e),u_ao:new t.bL(e),u_tile_id:new t.bM(e),u_zoom_transition:new t.bN(e),u_inv_rot_matrix:new t.bK(e),u_merc_center:new t.bL(e),u_up_dir:new t.bM(e),u_height_lift:new t.bN(e),u_image:new t.bO(e),u_texsize:new t.bL(e),u_pixel_coord_upper:new t.bL(e),u_pixel_coord_lower:new t.bL(e),u_tile_units_to_pixels:new t.bN(e),u_opacity:new t.bN(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new t.bK(e),u_opacity:new t.bN(e),u_ao_pass:new t.bN(e),u_meter_to_tile:new t.bN(e),u_ao:new t.bL(e),u_flood_light_intensity:new t.bN(e),u_flood_light_color:new t.bM(e),u_attenuation:new t.bN(e),u_edge_radius:new t.bN(e),u_fb:new t.bO(e),u_fb_size:new t.bN(e)}),fill:e=>({u_matrix:new t.bK(e),u_emissive_strength:new t.bN(e)}),fillPattern:e=>({u_matrix:new t.bK(e),u_emissive_strength:new t.bN(e),u_image:new t.bO(e),u_texsize:new t.bL(e),u_pixel_coord_upper:new t.bL(e),u_pixel_coord_lower:new t.bL(e),u_tile_units_to_pixels:new t.bN(e)}),fillOutline:e=>({u_matrix:new t.bK(e),u_emissive_strength:new t.bN(e),u_world:new t.bL(e)}),fillOutlinePattern:e=>({u_matrix:new t.bK(e),u_emissive_strength:new t.bN(e),u_world:new t.bL(e),u_image:new t.bO(e),u_texsize:new t.bL(e),u_pixel_coord_upper:new t.bL(e),u_pixel_coord_lower:new t.bL(e),u_tile_units_to_pixels:new t.bN(e)}),circle:t.cs,collisionBox:e=>({u_matrix:new t.bK(e),u_camera_to_center_distance:new t.bN(e),u_extrude_scale:new t.bL(e)}),collisionCircle:e=>({u_matrix:new t.bK(e),u_inv_matrix:new t.bK(e),u_camera_to_center_distance:new t.bN(e),u_viewport_size:new t.bL(e)}),debug:e=>({u_color:new t.ca(e),u_matrix:new t.bK(e),u_overlay:new t.bO(e),u_overlay_scale:new t.bN(e)}),clippingMask:e=>({u_matrix:new t.bK(e)}),heatmap:e=>({u_extrude_scale:new t.bN(e),u_intensity:new t.bN(e),u_matrix:new t.bK(e),u_inv_rot_matrix:new t.bK(e),u_merc_center:new t.bL(e),u_tile_id:new t.bM(e),u_zoom_transition:new t.bN(e),u_up_dir:new t.bM(e)}),heatmapTexture:e=>({u_image:new t.bO(e),u_color_ramp:new t.bO(e),u_opacity:new t.bN(e)}),hillshade:e=>({u_matrix:new t.bK(e),u_image:new t.bO(e),u_latrange:new t.bL(e),u_light:new t.bL(e),u_shadow:new t.ca(e),u_highlight:new t.ca(e),u_emissive_strength:new t.bN(e),u_accent:new t.ca(e)}),hillshadePrepare:e=>({u_matrix:new t.bK(e),u_image:new t.bO(e),u_dimension:new t.bL(e),u_zoom:new t.bN(e)}),line:t.ct,linePattern:t.cu,raster:e=>({u_matrix:new t.bK(e),u_normalize_matrix:new t.bK(e),u_globe_matrix:new t.bK(e),u_merc_matrix:new t.bK(e),u_grid_matrix:new t.cb(e),u_tl_parent:new t.bL(e),u_scale_parent:new t.bN(e),u_fade_t:new t.bN(e),u_opacity:new t.bN(e),u_image0:new t.bO(e),u_image1:new t.bO(e),u_brightness_low:new t.bN(e),u_brightness_high:new t.bN(e),u_saturation_factor:new t.bN(e),u_contrast_factor:new t.bN(e),u_spin_weights:new t.bM(e),u_perspective_transform:new t.bL(e),u_raster_elevation:new t.bN(e),u_zoom_transition:new t.bN(e),u_merc_center:new t.bL(e),u_cutoff_params:new t.bP(e),u_colorization_mix:new t.bP(e),u_colorization_offset:new t.bN(e),u_color_ramp:new t.bO(e),u_texture_offset:new t.bL(e),u_texture_res:new t.bL(e),u_emissive_strength:new t.bN(e)}),rasterParticle:e=>({u_matrix:new t.bK(e),u_normalize_matrix:new t.bK(e),u_globe_matrix:new t.bK(e),u_merc_matrix:new t.bK(e),u_grid_matrix:new t.cb(e),u_tl_parent:new t.bL(e),u_scale_parent:new t.bN(e),u_fade_t:new t.bN(e),u_opacity:new t.bN(e),u_image0:new t.bO(e),u_image1:new t.bO(e),u_raster_elevation:new t.bN(e),u_zoom_transition:new t.bN(e),u_merc_center:new t.bL(e),u_cutoff_params:new t.bP(e)}),rasterParticleTexture:e=>({u_texture:new t.bO(e),u_opacity:new t.bN(e)}),rasterParticleDraw:e=>({u_tile_offset:new t.bL(e),u_velocity:new t.bO(e),u_color_ramp:new t.bO(e),u_velocity_res:new t.bL(e),u_max_speed:new t.bN(e),u_texture_offset:new t.bL(e),u_data_scale:new t.bP(e),u_data_offset:new t.bN(e)}),rasterParticleUpdate:e=>({u_velocity:new t.bO(e),u_velocity_res:new t.bL(e),u_max_speed:new t.bN(e),u_speed_factor:new t.bN(e),u_lifetime_delta:new t.bN(e),u_rand_seed:new t.bN(e),u_texture_offset:new t.bL(e),u_data_scale:new t.bP(e),u_data_offset:new t.bN(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new t.bO(e),u_is_size_feature_constant:new t.bO(e),u_size_t:new t.bN(e),u_size:new t.bN(e),u_camera_to_center_distance:new t.bN(e),u_rotate_symbol:new t.bO(e),u_aspect_ratio:new t.bN(e),u_fade_change:new t.bN(e),u_matrix:new t.bK(e),u_label_plane_matrix:new t.bK(e),u_coord_matrix:new t.bK(e),u_is_text:new t.bO(e),u_pitch_with_map:new t.bO(e),u_texsize:new t.bL(e),u_tile_id:new t.bM(e),u_zoom_transition:new t.bN(e),u_inv_rot_matrix:new t.bK(e),u_merc_center:new t.bL(e),u_camera_forward:new t.bM(e),u_tile_matrix:new t.bK(e),u_up_vector:new t.bM(e),u_ecef_origin:new t.bM(e),u_texture:new t.bO(e),u_icon_transition:new t.bN(e),u_icon_saturation:new t.bN(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new t.bO(e),u_is_size_feature_constant:new t.bO(e),u_size_t:new t.bN(e),u_size:new t.bN(e),u_camera_to_center_distance:new t.bN(e),u_rotate_symbol:new t.bO(e),u_aspect_ratio:new t.bN(e),u_fade_change:new t.bN(e),u_matrix:new t.bK(e),u_label_plane_matrix:new t.bK(e),u_coord_matrix:new t.bK(e),u_is_text:new t.bO(e),u_pitch_with_map:new t.bO(e),u_texsize:new t.bL(e),u_texture:new t.bO(e),u_gamma_scale:new t.bN(e),u_device_pixel_ratio:new t.bN(e),u_tile_id:new t.bM(e),u_zoom_transition:new t.bN(e),u_inv_rot_matrix:new t.bK(e),u_merc_center:new t.bL(e),u_camera_forward:new t.bM(e),u_tile_matrix:new t.bK(e),u_up_vector:new t.bM(e),u_ecef_origin:new t.bM(e),u_is_halo:new t.bO(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new t.bO(e),u_is_size_feature_constant:new t.bO(e),u_size_t:new t.bN(e),u_size:new t.bN(e),u_camera_to_center_distance:new t.bN(e),u_rotate_symbol:new t.bO(e),u_aspect_ratio:new t.bN(e),u_fade_change:new t.bN(e),u_matrix:new t.bK(e),u_label_plane_matrix:new t.bK(e),u_coord_matrix:new t.bK(e),u_is_text:new t.bO(e),u_pitch_with_map:new t.bO(e),u_texsize:new t.bL(e),u_texsize_icon:new t.bL(e),u_texture:new t.bO(e),u_texture_icon:new t.bO(e),u_gamma_scale:new t.bN(e),u_device_pixel_ratio:new t.bN(e),u_is_halo:new t.bO(e)}),background:e=>({u_matrix:new t.bK(e),u_emissive_strength:new t.bN(e),u_opacity:new t.bN(e),u_color:new t.ca(e)}),backgroundPattern:e=>({u_matrix:new t.bK(e),u_emissive_strength:new t.bN(e),u_opacity:new t.bN(e),u_image:new t.bO(e),u_pattern_tl:new t.bL(e),u_pattern_br:new t.bL(e),u_texsize:new t.bL(e),u_pattern_size:new t.bL(e),u_pixel_coord_upper:new t.bL(e),u_pixel_coord_lower:new t.bL(e),u_tile_units_to_pixels:new t.bN(e)}),terrainRaster:rr,terrainDepth:rr,skybox:e=>({u_matrix:new t.bK(e),u_sun_direction:new t.bM(e),u_cubemap:new t.bO(e),u_opacity:new t.bN(e),u_temporal_offset:new t.bN(e)}),skyboxGradient:e=>({u_matrix:new t.bK(e),u_color_ramp:new t.bO(e),u_center_direction:new t.bM(e),u_radius:new t.bN(e),u_opacity:new t.bN(e),u_temporal_offset:new t.bN(e)}),skyboxCapture:e=>({u_matrix_3f:new t.cb(e),u_sun_direction:new t.bM(e),u_sun_intensity:new t.bN(e),u_color_tint_r:new t.bP(e),u_color_tint_m:new t.bP(e),u_luminance:new t.bN(e)}),globeRaster:e=>({u_proj_matrix:new t.bK(e),u_globe_matrix:new t.bK(e),u_normalize_matrix:new t.bK(e),u_merc_matrix:new t.bK(e),u_zoom_transition:new t.bN(e),u_merc_center:new t.bL(e),u_image0:new t.bO(e),u_grid_matrix:new t.cb(e),u_skirt_height:new t.bN(e),u_far_z_cutoff:new t.bN(e),u_frustum_tl:new t.bM(e),u_frustum_tr:new t.bM(e),u_frustum_br:new t.bM(e),u_frustum_bl:new t.bM(e),u_globe_pos:new t.bM(e),u_globe_radius:new t.bN(e),u_viewport:new t.bL(e)}),globeAtmosphere:e=>({u_frustum_tl:new t.bM(e),u_frustum_tr:new t.bM(e),u_frustum_br:new t.bM(e),u_frustum_bl:new t.bM(e),u_horizon:new t.bN(e),u_transition:new t.bN(e),u_fadeout_range:new t.bN(e),u_color:new t.bP(e),u_high_color:new t.bP(e),u_space_color:new t.bP(e),u_temporal_offset:new t.bN(e),u_horizon_angle:new t.bN(e)}),model:e=>({u_matrix:new t.bK(e),u_lighting_matrix:new t.bK(e),u_normal_matrix:new t.bK(e),u_lightpos:new t.bM(e),u_lightintensity:new t.bN(e),u_lightcolor:new t.bM(e),u_camera_pos:new t.bM(e),u_opacity:new t.bN(e),u_baseColorFactor:new t.bP(e),u_emissiveFactor:new t.bP(e),u_metallicFactor:new t.bN(e),u_roughnessFactor:new t.bN(e),u_baseTextureIsAlpha:new t.bO(e),u_alphaMask:new t.bO(e),u_alphaCutoff:new t.bN(e),u_baseColorTexture:new t.bO(e),u_metallicRoughnessTexture:new t.bO(e),u_normalTexture:new t.bO(e),u_occlusionTexture:new t.bO(e),u_emissionTexture:new t.bO(e),u_color_mix:new t.bP(e),u_aoIntensity:new t.bN(e),u_emissive_strength:new t.bN(e),u_occlusionTextureTransform:new t.bP(e)}),modelDepth:e=>({u_matrix:new t.bK(e),u_instance:new t.bK(e),u_node_matrix:new t.bK(e)}),groundShadow:e=>({u_matrix:new t.bK(e),u_ground_shadow_factor:new t.bM(e)}),stars:e=>({u_matrix:new t.bK(e),u_up:new t.bM(e),u_right:new t.bM(e),u_intensity_multiplier:new t.bN(e)})};let Jr;function Qr(e,i,n,r,o,s,a){const l=e.context,c=l.gl,u=e.transform,h=e.getOrCreateProgram("collisionBox"),d=[];let p=0,f=0;for(let l=0;l<r.length;l++){const m=r[l],g=i.getTile(m),_=g.getBucket(n);if(!_)continue;const y=Di(m,_,u);let v=y;0===o[0]&&0===o[1]||(v=e.translatePosMatrix(y,g,o,s));const x=a?_.textCollisionBox:_.iconCollisionBox,b=_.collisionCircleArray;if(b.length>0){const e=t.a6.create(),i=v;t.a6.mul(e,_.placementInvProjMatrix,u.glCoordMatrix),t.a6.mul(e,e,_.placementViewportMatrix),d.push({circleArray:b,circleOffset:f,transform:i,invTransform:e,projection:_.getProjection()}),p+=b.length/4,f=p}x&&(e.terrain&&e.terrain.setupElevationDraw(g,h),h.draw(e,c.LINES,Ae.disabled,Le.disabled,e.colorModeForRenderPass(),Oe.disabled,Lr(v,u,g,_.getProjection()),n.id,x.layoutVertexBuffer,x.indexBuffer,x.segments,null,u.zoom,null,[x.collisionVertexBuffer,x.collisionVertexBufferExt]))}if(!a||!d.length)return;const m=e.getOrCreateProgram("collisionCircle"),g=new t.cv;g.resize(4*p),g._trim();let _=0;for(const t of d)for(let e=0;e<t.circleArray.length/4;e++){const i=4*e,n=t.circleArray[i+0],r=t.circleArray[i+1],o=t.circleArray[i+2],s=t.circleArray[i+3];g.emplace(_++,n,r,o,s,0),g.emplace(_++,n,r,o,s,1),g.emplace(_++,n,r,o,s,2),g.emplace(_++,n,r,o,s,3)}(!Jr||Jr.length<2*p)&&(Jr=function(e){const i=2*e,n=new t.aw;n.resize(i),n._trim();for(let t=0;t<i;t++){const e=6*t;n.uint16[e+0]=4*t+0,n.uint16[e+1]=4*t+1,n.uint16[e+2]=4*t+2,n.uint16[e+3]=4*t+2,n.uint16[e+4]=4*t+3,n.uint16[e+5]=4*t+0}return n}(p));const y=l.createIndexBuffer(Jr,!0),v=l.createVertexBuffer(g,t.cw.members,!0);for(const i of d){const r={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(x=u).getCameraToCenterDistance(i.projection),u_viewport_size:[x.width,x.height]};m.draw(e,c.TRIANGLES,Ae.disabled,Le.disabled,e.colorModeForRenderPass(),Oe.disabled,r,n.id,v,y,t.aB.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,u.zoom)}var x;v.destroy(),y.destroy()}const to=t.a6.create();function eo(e){const i=e._camera.getWorldToCamera(e.worldSize,1),n=t.a6.multiply([],i,e.globeMatrix);t.a6.invert(n,n);const r=[0,0,0],o=[0,1,0,0];return t.a7.transformMat4(o,o,n),r[0]=o[0],r[1]=o[1],r[2]=o[2],t.N.normalize(r,r),r}function io({width:e,height:i,anchor:n,textOffset:r,textScale:o},s){const{horizontalAlign:a,verticalAlign:l}=t.bf(n),c=-(a-.5)*e,u=-(l-.5)*i,h=t.bd(n,r);return new t.P((c/o+h[0])*s,(u/o+h[1])*s)}function no(e,i,n,r,o,s,a,l,c,u,h){const d=e.text.placedSymbolArray,p=e.text.dynamicLayoutVertexArray,f=e.icon.dynamicLayoutVertexArray,m={},g=e.getProjection(),_=ki(l,g,s),y=s.elevation,v=g.upVectorScale(l.canonical,s.center.lat,s.worldSize).metersToTile;p.clear();for(let f=0;f<d.length;f++){const x=d.get(f),{tileAnchorX:b,tileAnchorY:w,numGlyphs:E}=x,S=x.hidden||!x.crossTileID||e.allowVerticalPlacement&&!x.placedOrientation?null:r[x.crossTileID];if(S){let r=0,d=0,f=0;if(y){const t=y?y.getAtTileOffset(l,b,w):0,[e,i,n]=g.upVector(l.canonical,b,w);r=t*e*v,d=t*i*v,f=t*n*v}let[T,M,I,C]=yi(x.projectedAnchorX+r,x.projectedAnchorY+d,x.projectedAnchorZ+f,n?_:a);const A=vi(s.getCameraToCenterDistance(g),C);let P=o.evaluateSizeForFeature(e.textSizeData,u,x)*A/t.bc;n&&(P*=e.tilePixelRatio/c);const L=io(S,P);n?(({x:T,y:M,z:I}=g.projectTilePoint(b+L.x,w+L.y,l.canonical)),[T,M,I]=yi(T+r,M+d,I+f,a)):(i&&L._rotate(-s.angle),T+=L.x,M+=L.y,I=0);const R=e.allowVerticalPlacement&&x.placedOrientation===t.b6.vertical?Math.PI/2:0;for(let e=0;e<E;e++)t.b9(p,T,M,I,R);h&&x.associatedIconIndex>=0&&(m[x.associatedIconIndex]={x:T,y:M,z:I,angle:R})}else Ci(E,p)}if(h){f.clear();const i=e.icon.placedSymbolArray;for(let e=0;e<i.length;e++){const n=i.get(e),{numGlyphs:r}=n,o=m[e];if(n.hidden||!o)Ci(r,f);else{const{x:e,y:i,z:n,angle:s}=o;for(let o=0;o<r;o++)t.b9(f,e,i,n,s)}}e.icon.dynamicLayoutVertexBuffer.updateData(f)}e.text.dynamicLayoutVertexBuffer.updateData(p)}function ro(e,i,n,r,o,s,a={}){const l=n.paint.get("icon-translate"),c=n.paint.get("text-translate"),u=n.paint.get("icon-translate-anchor"),h=n.paint.get("text-translate-anchor"),d=n.layout.get("icon-rotation-alignment"),p=n.layout.get("text-rotation-alignment"),f=n.layout.get("icon-pitch-alignment"),m=n.layout.get("text-pitch-alignment"),g=n.layout.get("icon-keep-upright"),_=n.layout.get("text-keep-upright"),y=n.paint.get("icon-color-saturation"),v=e.context,x=v.gl,b=e.transform,w="map"===d,E="map"===p,S="map"===f,T="map"===m,M=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let I=!1;const C=e.depthModeForSublayer(0,Ae.ReadOnly),A=[t.a5(b.center.lng),t.ae(b.center.lat)],P=n.layout.get("text-variable-anchor"),L="globe"===b.projection.name,R=[],D=[0,-1,0];for(const o of r){const r=i.getTile(o),s=r.getBucket(n);if(!s)continue;if("mercator"===s.projection.name&&L)continue;if(s.fullyClipped)continue;const d="globe"===s.projection.name,p=d?t.S(b.zoom):0,f=ki(o,s.getProjection(),b),m=b.calculatePixelsToTileUnitsMatrix(r),v=P&&s.hasTextData(),C=s.hasIconTextFit()&&v&&s.hasIconData(),k=s.getProjection().createInversionMatrix(b,o.canonical),N=()=>{const i=w&&"point"!==n.layout.get("symbol-placement"),a=[],c=i||C,h=n.paint.get("icon-image-cross-fade").constantOr(0);e.terrainRenderModeElevated()&&S&&a.push("PITCH_WITH_MAP_TERRAIN"),d&&(a.push("PROJECTION_GLOBE_VIEW"),c&&a.push("PROJECTED_POS_ON_VIEWPORT")),h>0&&a.push("ICON_TRANSITION"),s.icon.zOffsetVertexBuffer&&a.push("Z_OFFSET"),y<1&&a.push("SATURATION");const _=s.icon.programConfigurations.get(n.id),v=e.getOrCreateProgram(s.sdfIcons?"symbolSDF":"symbolIcon",{config:_,defines:a});let E;const T=r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],M=s.iconSizeData,I=t.b5(M,b.zoom),P=S||0!==b.pitch,R=mi(f,r.tileID.canonical,S,w,b,s.getProjection(),m),N=_i(f,r.tileID.canonical,S,w,b,s.getProjection(),m),O=e.translatePosMatrix(N,r,l,u,!0),F=e.translatePosMatrix(f,r,l,u),z=c?to:R,B=w&&!S&&!i;let U=D;!L&&!b.mercatorFromTransition||w||(U=eo(b));const V=d?U:D;E=s.sdfIcons&&!s.iconsInText?Hr(M.kind,I,B,S,e,F,z,O,!1,T,!0,o,p,A,k,V,s.getProjection()):Gr(M.kind,I,B,S,e,F,z,O,!1,T,o,p,A,k,V,s.getProjection(),y,h);const j=r.imageAtlasTexture?r.imageAtlasTexture:null,G=1!==n.layout.get("icon-size").constantOr(0)||s.iconsNeedLinear,H=s.sdfIcons||e.options.rotating||e.options.zooming||G||P?x.LINEAR:x.NEAREST,W=s.sdfIcons&&0!==n.paint.get("icon-halo-width").constantOr(1),q=e.terrain&&S&&i?t.a6.invert(t.a6.create(),R):to;if(i&&s.icon){const t=b.elevation,i=t?t.getAtTileOffsetFunc(o,b.center.lat,b.worldSize,s.getProjection()):null,n=gi(f,r.tileID.canonical,S,w,b,s.getProjection(),m);bi(s,f,e,!1,n,N,S,g,i,o)}return{program:v,buffers:s.icon,uniformValues:E,atlasTexture:j,atlasTextureIcon:null,atlasInterpolation:H,atlasInterpolationIcon:null,isSDF:s.sdfIcons,hasHalo:W,tile:r,labelPlaneMatrixInv:q}},O=()=>{const i=E&&"point"!==n.layout.get("symbol-placement"),a=[],l=i||P||C;e.terrainRenderModeElevated()&&T&&a.push("PITCH_WITH_MAP_TERRAIN"),d&&(a.push("PROJECTION_GLOBE_VIEW"),l&&a.push("PROJECTED_POS_ON_VIEWPORT")),s.text.zOffsetVertexBuffer&&a.push("Z_OFFSET");const u=s.text.programConfigurations.get(n.id),g=e.getOrCreateProgram(s.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:u,defines:a});let y,v=[0,0],w=null;const S=s.textSizeData;s.iconsInText&&(v=r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],w=r.imageAtlasTexture?r.imageAtlasTexture:null,y=T||0!==b.pitch||e.options.rotating||e.options.zooming||"composite"===S.kind||"camera"===S.kind?x.LINEAR:x.NEAREST);const M=r.glyphAtlasTexture?r.glyphAtlasTexture.size:[0,0],I=t.b5(S,b.zoom),R=mi(f,r.tileID.canonical,T,E,b,s.getProjection(),m),N=_i(f,r.tileID.canonical,T,E,b,s.getProjection(),m),O=e.translatePosMatrix(N,r,c,h,!0),F=e.translatePosMatrix(f,r,c,h),z=l?to:R,B=E&&!T&&!i;let U=D;!L&&!b.mercatorFromTransition||E||(U=eo(b));const V=d?U:D;let j;j=s.iconsInText?Wr(S.kind,I,B,T,e,F,z,O,M,v,o,p,A,k,V,s.getProjection()):Hr(S.kind,I,B,T,e,F,z,O,!0,M,!0,o,p,A,k,V,s.getProjection());const G=r.glyphAtlasTexture?r.glyphAtlasTexture:null,H=x.LINEAR,W=0!==n.paint.get("text-halo-width").constantOr(1),q=e.terrain&&T&&i?t.a6.invert(t.a6.create(),R):to;if(i&&s.text){const t=b.elevation,i=t?t.getAtTileOffsetFunc(o,b.center.lat,b.worldSize,s.getProjection()):null,n=gi(f,r.tileID.canonical,T,E,b,s.getProjection(),m);bi(s,f,e,!0,n,N,T,_,i,o)}return{program:g,buffers:s.text,uniformValues:j,atlasTexture:G,atlasTextureIcon:w,atlasInterpolation:H,atlasInterpolationIcon:y,isSDF:!0,hasHalo:W,tile:r,labelPlaneMatrixInv:q}},F=s.icon.segments.get().length,z=s.text.segments.get().length,B=F&&!a.onlyText?N():null,U=z&&!a.onlyIcons?O():null,V=n.paint.get("icon-opacity").constantOr(1),j=n.paint.get("text-opacity").constantOr(1);if(M&&s.canOverlap){I=!0;const e=V&&!a.onlyText?s.icon.segments.get():[],i=j&&!a.onlyIcons?s.text.segments.get():[];for(const i of e)R.push({segments:new t.aB([i]),sortKey:i.sortKey,state:B});for(const e of i)R.push({segments:new t.aB([e]),sortKey:e.sortKey,state:U})}else a.onlyText||R.push({segments:V?s.icon.segments:new t.aB([]),sortKey:0,state:B}),a.onlyIcons||R.push({segments:j?s.text.segments:new t.aB([]),sortKey:0,state:U})}I&&R.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of R){const i=t.state;if(i)if(e.terrain&&e.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:b.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:i.labelPlaneMatrixInv}),v.activeTexture.set(x.TEXTURE0),i.atlasTexture&&i.atlasTexture.bind(i.atlasInterpolation,x.CLAMP_TO_EDGE,!0),i.atlasTextureIcon&&(v.activeTexture.set(x.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,x.CLAMP_TO_EDGE,!0)),e.uploadCommonLightUniforms(e.context,i.program),i.hasHalo){const r=i.uniformValues;r.u_is_halo=1,oo(i.buffers,t.segments,n,e,i.program,C,o,s,r,2),r.u_is_halo=0}else{if(i.isSDF){const r=i.uniformValues;i.hasHalo&&(r.u_is_halo=1,oo(i.buffers,t.segments,n,e,i.program,C,o,s,r,1)),r.u_is_halo=0}oo(i.buffers,t.segments,n,e,i.program,C,o,s,i.uniformValues,1)}}}function oo(t,e,i,n,r,o,s,a,l,c){const u=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.iconTransitioningVertexBuffer,t.globeExtVertexBuffer,t.zOffsetVertexBuffer];r.draw(n,n.context.gl.TRIANGLES,o,s,a,Oe.disabled,l,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,n.transform.zoom,t.programConfigurations.get(i.id),u,c)}function so(t,e,i,n,r,o,s){const a=t.context.gl,l=i.paint.get("fill-pattern"),c=l&&l.constantOr(1);let u,h,d,p,f;s?(h=c&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",u=a.LINES):(h=c?"fillPattern":"fill",u=a.TRIANGLES);for(const m of n){const n=e.getTile(m);if(c&&!n.patternsLoaded())continue;const g=n.getBucket(i);if(!g)continue;t.prepareDrawTile();const _=g.programConfigurations.get(i.id),y=t.isTileAffectedByFog(m),v=t.getOrCreateProgram(h,{config:_,overrideFog:y});c&&(t.context.activeTexture.set(a.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),_.updatePaintBuffers());const x=l.constantOr(null);if(x&&n.imageAtlas){const t=n.imageAtlas.patternPositions[x.toString()];t&&_.setConstantPatternPositions(t)}const b=t.translatePosMatrix(m.projMatrix,n,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),w=i.paint.get("fill-emissive-strength");if(s){p=g.indexBuffer2,f=g.segments2;const e=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[a.drawingBufferWidth,a.drawingBufferHeight];d="fillOutlinePattern"===h&&c?Pr(b,w,t,n,e):Ar(b,w,e)}else p=g.indexBuffer,f=g.segments,d=c?Cr(b,w,t,n):Ir(b,w);t.uploadCommonUniforms(t.context,v,m.toUnwrapped()),v.draw(t,u,r,t.stencilModeForClipping(m),o,Oe.disabled,d,i.id,g.layoutVertexBuffer,p,f,i.paint,t.transform.zoom,_,void 0)}}function ao(e,i,n,r,o,s,a,l){n.resetLayerRenderingStats(e);const c=e.context,u=c.gl,h=e.transform,d=n.paint.get("fill-extrusion-pattern"),p=d.constantOr(1),f=n.paint.get("fill-extrusion-opacity"),m=e.style.enable3dLights(),g=n.paint.get(m&&!p?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),g],y=n.layout.get("fill-extrusion-edge-radius"),v=y>0&&!n.paint.get("fill-extrusion-rounded-roof"),x=v?0:y,b="globe"===h.projection.name?t.cF():0,w="globe"===h.projection.name,E=w?t.S(h.zoom):0,S=[t.a5(h.center.lng),t.ae(h.center.lat)],T=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),M=n.paint.get("fill-extrusion-flood-light-intensity"),I=n.paint.get("fill-extrusion-vertical-scale"),C=yn(e,n.paint.get("fill-extrusion-cutoff-fade-range")),A=n.paint.get("fill-extrusion-emissive-strength"),P=[];let L;w&&P.push("PROJECTION_GLOBE_VIEW"),_[0]>0&&P.push("FAUX_AO"),v&&P.push("ZERO_ROOF_RADIUS"),l&&P.push("HAS_CENTROID"),M>0&&P.push("FLOOD_LIGHT"),C.shouldRenderCutoff&&P.push("RENDER_CUTOFF");const R="shadow"===e.renderPass,D=e.shadowRenderer,k=R&&!!D;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let N=[0,0,0];if(D){const t=e.style.directionalLight,i=e.style.ambientLight;t&&i&&(N=Tn(t,i)),L=P.concat(["SHADOWS_SINGLE_CASCADE"])}const O=k?"fillExtrusionDepth":p?"fillExtrusionPattern":"fillExtrusion",F=n.getLayerRenderingStats();for(const t of r){const r=i.getTile(t),m=r.getBucket(n);if(!m||m.projection.name!==h.projection.name)continue;let g=!1;D&&(g=0===D.getMaxCascadeForTile(t.toUnwrapped()));const y=e.isTileAffectedByFog(t),v=m.programConfigurations.get(n.id),k=e.getOrCreateProgram(O,{config:v,defines:g?L:P,overrideFog:y});if(e.terrain&&e.terrain.setupElevationDraw(r,k,{useMeterToDem:!0}),!m.centroidVertexBuffer){const t=k.attributes.a_centroid_pos;void 0!==t&&u.vertexAttrib2f(t,0,0)}!R&&D&&D.setupShadows(r.tileID.toUnwrapped(),k,"vector-tile",r.tileID.overscaledZ),p&&(e.context.activeTexture.set(u.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),v.updatePaintBuffers());const z=d.constantOr(null);if(z&&r.imageAtlas){const t=r.imageAtlas.patternPositions[z.toString()];t&&v.setConstantPatternPositions(t)}const B=n.paint.get("fill-extrusion-vertical-gradient");let U;if(R&&D){if(fo(r.tileID,m,e))continue;const t=D.calculateShadowPassMatrixFromTile(r.tileID.toUnwrapped());U=Tr(t,x,I)}else{const i=e.translatePosMatrix(t.expandedProjMatrix,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),o=h.projection.createInversionMatrix(h,t.canonical);U=p?Mr(i,e,B,f,_,x,t,r,b,E,S,o,T,I):Sr(i,e,B,f,_,x,t,b,E,S,o,T,I,M,N,A)}e.uploadCommonUniforms(c,k,t.toUnwrapped(),null,C);let V=m.segments;if("mercator"===h.projection.name&&!R&&(V=m.getVisibleSegments(r.tileID,e.terrain,e.transform.getFrustum(0)),!V.get().length))continue;if(F)if(R)for(const t of V.get())F.numRenderedVerticesInShadowPass+=t.primitiveLength;else for(const t of V.get())F.numRenderedVerticesInTransparentPass+=t.primitiveLength;const j=[];(e.terrain||l)&&j.push(m.centroidVertexBuffer),w&&j.push(m.layoutVertexExtBuffer),k.draw(e,c.gl.TRIANGLES,o,s,a,Oe.backCCW,U,n.id,m.layoutVertexBuffer,m.indexBuffer,V,n.paint,e.transform.zoom,v,j)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function lo(e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v){const x=e.context,b=x.gl,w=e.transform,E=e.transform.zoom,S=[],T=yn(e,n.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===u?(S.push("CLEAR_SUBPASS"),v&&(S.push("CLEAR_FROM_TEXTURE"),x.activeTexture.set(b.TEXTURE0),v.bind(b.LINEAR,b.CLAMP_TO_EDGE))):"sdf"===u&&S.push("SDF_SUBPASS"),_&&S.push("HAS_CENTROID"),T.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const M=n.layout.get("fill-extrusion-edge-radius"),I=(t,i,r,u,y)=>{const b=i.programConfigurations.get(n.id),w=e.isTileAffectedByFog(t),I=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:b,defines:S,overrideFog:w}),C=((t,e,i,n,r,o,s,a,l,c,u)=>({u_matrix:e,u_opacity:i,u_ao_pass:n?1:0,u_meter_to_tile:r,u_ao:o,u_flood_light_intensity:s,u_flood_light_color:a,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u}))(0,u,h,c,y,[d,p*y],f,m,g,E>=17?0:M*y,v?v.size[0]:0),A=[];_&&A.push(i.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(x,I,t.toUnwrapped(),null,T),I.draw(e,x.gl.TRIANGLES,o,s,a,l,C,n.id,i.vertexBuffer,i.indexBuffer,r,n.paint,E,b,A)};for(const o of r){const r=i.getTile(o),s=r.getBucket(n);if(!s||s.projection.name!==w.projection.name||!s.groundEffect||s.groundEffect&&!s.groundEffect.hasData())continue;const a=s.groundEffect,l=1/s.tileToMeter;{const t=e.translatePosMatrix(o.projMatrix,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),i=a.getDefaultSegment();I(o,a,i,t,l)}if(y)for(let s=0;s<4;s++){const a=t.cG[s](o),c=i.getTile(a);if(!c)continue;const u=c.getBucket(n);if(!u||u.projection.name!==w.projection.name||!u.groundEffect||u.groundEffect&&!u.groundEffect.hasData())continue;const h=u.groundEffect;let d,p;0===s?(d=[-t.V,0,0],p=1):1===s?(d=[t.V,0,0],p=0):2===s?(d=[0,-t.V,0],p=3):(d=[0,t.V,0],p=2);const f=h.regionSegments[p];if(!f)continue;const m=new Float32Array(16);t.a6.translate(m,o.projMatrix,d),I(o,h,f,e.translatePosMatrix(m,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),l)}}}function co(e,i,n,r,o,s,a){0===r.centroidVertexArray.length&&r.createCentroidsBuffer();const l=s?s.findDEMTileFor(n):null;if(!(l&&l.dem||a))return;const c=e=>new t.P(Math.ceil((e+t.cJ)*t.cK),0),u=t=>{const e=i.getSource().minzoom,n=t=>{const e=i.getTileByID(t);if(e&&e.hasData())return e.getBucket(o)},r=[0,-1,1];for(const i of r){if(t.overscaledZ+i<e)continue;const r=n(t.calculateScaledKey(t.overscaledZ+i));if(r)return r}},h=[0,0,0],d=(e,i)=>(h[0]=Math.min(e.min.y,i.min.y),h[1]=Math.max(e.max.y,i.max.y),h[2]=t.V-i.min.x>e.max.x?i.min.x-t.V:e.max.x,h),p=(e,i)=>(h[0]=Math.min(e.min.x,i.min.x),h[1]=Math.max(e.max.x,i.max.x),h[2]=t.V-i.min.y>e.max.y?i.min.y-t.V:e.max.y,h),f=[(t,e)=>d(t,e),(t,e)=>d(e,t),(t,e)=>p(t,e),(t,e)=>p(e,t)],m=(e,i,r,o,a,c,u)=>{if(!s)return 0;const h=[[c?r:e,c?e:r,0],[c?r:i,c?i:r,0]],d=u<0?t.V+u:u,p=[c?d:(e+i)/2,c?(e+i)/2:d,0];return 0===r&&u<0||0!==r&&u>0?s.getForTilePoints(a,[p],!0,o):h.push(p),s.getForTilePoints(n,h,!0,l),Math.max(h[0][2],h[1][2],p[2])/s.exaggeration()};for(let e=0;e<4;e++){const i=r.borderFeatureIndices[e];if(0===i.length)continue;const o=t.cG[e](n),l=u(o);if(!(l&&l instanceof t.cH))continue;if(r.borderDoneWithNeighborZ[e]===l.canonical.z)continue;0===l.centroidVertexArray.length&&l.createCentroidsBuffer();const h=s?s.findDEMTileFor(o):null;if(!(h&&h.dem||a))continue;const d=(e<2?1:5)-e,p=l.borderDoneWithNeighborZ[d]!==r.canonical.z,y=l.borderFeatureIndices[d];let v=0;if(r.canonical.z!==l.canonical.z){for(const t of i)r.showCentroid(r.featuresOnBorder[t]);if(p)for(const t of y)l.showCentroid(l.featuresOnBorder[t]);r.borderDoneWithNeighborZ[e]=l.canonical.z,l.borderDoneWithNeighborZ[d]=r.canonical.z}for(const n of i){const i=r.featuresOnBorder[n],s=r.centroidData[i.centroidDataIndex],u=i.borders[e];let p;for(;v<y.length;){p=l.featuresOnBorder[y[v]];const t=p.borders[d];if(t[1]>u[0]+3||t[0]>u[0]-3)break;l.showCentroid(p),v++}if(p&&v<y.length){const n=v;let x=0;for(;!(p.borders[d][0]>u[1]-3)&&(x++,++v!==y.length);)p=l.featuresOnBorder[y[v]];if(p=l.featuresOnBorder[y[n]],x>1){const t=p.borders[d];Math.abs(u[0]-t[0])<3&&Math.abs(u[1]-t[1])<3&&(x=1,v=n+1)}else if(0===x){r.showCentroid(i);continue}const b=l.centroidData[p.centroidDataIndex];a&&1===x&&(((g=s).flags|(_=b).flags)&t.cI?(g.flags|=t.cI,_.flags|=t.cI):(g.flags&=~t.cI,_.flags&=~t.cI));const w=i.intersectsCount()>1||p.intersectsCount()>1;if(x>1)v=n,s.centroidXY=b.centroidXY=new t.P(0,0);else if(h&&h.dem&&!w){const i=f[e](s,b),n=e%2?t.V-1:0,r=m(i[0],Math.min(t.V-1,i[1]),n,h,o,e<2,i[2]);s.centroidXY=b.centroidXY=c(r)}else w?s.centroidXY=b.centroidXY=new t.P(0,0):(s.centroidXY=r.encodeBorderCentroid(i),b.centroidXY=l.encodeBorderCentroid(p));r.writeCentroidToBuffer(s),l.writeCentroidToBuffer(b)}else r.showCentroid(i)}r.borderDoneWithNeighborZ[e]=l.canonical.z,l.borderDoneWithNeighborZ[d]=r.canonical.z}var g,_;(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(e)}const uo=[1,0,0],ho=[0,1,0],po=[0,0,1];function fo(e,i,n){const r=n.transform,o=n.shadowRenderer;if(!o)return!0;const s=e.toUnwrapped(),a=r.tileSize*o._cascades[n.currentShadowCascade].scale;let l=i.maxHeight;if(r.elevation){const t=r.elevation.getMinMaxForTile(e);t&&(l+=t.max)}const c=[...o.shadowDirection];c[2]=-c[2];const u=o.computeSimplifiedTileShadowVolume(s,l,a,c);if(!u)return!1;const h=[uo,ho,po,c,[c[0],0,c[2]],[0,c[1],c[2]]],d="globe"===r.projection.name,p=r.scaleZoom(a),f=t.bq.fromInvProjectionMatrix(r.invProjMatrix,r.worldSize,p,!d),m=o.getCurrentCascadeFrustum();return 0===f.intersectsPrecise(u.vertices,u.planes,h)||0===m.intersectsPrecise(u.vertices,u.planes,h)}function mo(e){return[e[0]*t.cL,e[1]*t.cL,e[2]*t.cL,0]}function go(e,i,n,r,o,s,a,l,c){const u=r.getSource(),h=n.globeSharedBuffers;if(!h)return;let d,p,f;if(i&&(d=r.getTile(i)),u instanceof t.ap?(p=u.texture,f=t.cj(0,0,n.transform)):d&&i&&(p=d.texture,f=t.cj(i.canonical.z,i.canonical.x,n.transform)),!p||!f)return;e||(f=t.a6.scale(t.a6.create(),f,[1,-1,1]));const m=n.context,g=m.gl,_="nearest"===o.paint.get("raster-resampling")?g.NEAREST:g.LINEAR,y=n.colorModeForDrapableLayerRenderPass(s),v=a.defines;v.push("GLOBE_POLES");const x=new Ae(g.LEQUAL,Ae.ReadWrite,n.depthRangeFor3D),b=Float32Array.from(n.transform.expandedFarZProjMatrix),w=Float32Array.from(t.aT(t.ci(new t.bs(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),m.activeTexture.set(g.TEXTURE0),p.bind(_,g.CLAMP_TO_EDGE),m.activeTexture.set(g.TEXTURE1),p.bind(_,g.CLAMP_TO_EDGE),p.useMipmap&&m.extTextureFilterAnisotropic&&n.transform.pitch>20&&g.texParameterf(g.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax);const[E,S,T,M]=i?h.getPoleBuffers(i.canonical.z,!1):h.getPoleBuffers(0,!0),I=o.paint.get("raster-elevation");let C;e?(C=E,n.renderDefaultNorthPole=0!==I):(C=S,n.renderDefaultSouthPole=0!==I);const A=mo(a.mix),P=((t,e,i,n,r,o,s,a,l,c,u,h,d)=>Fr(t,e,i,new Float32Array(16),new Float32Array(9),[0,0],n,[0,0],[0,0,0,0],1,{opacity:1,mix:0},o,[0,0]||0,a,2,c,u,h,1,0,d))(b,w,f,t.S(n.transform.zoom),0,o,0,I,0,A,a.offset,a.range,s),L=n.getOrCreateProgram("raster",{defines:v});n.uploadCommonUniforms(m,L,null),L.draw(n,g.TRIANGLES,x,c,y,l,P,o.id,C,T,M)}function _o(t){const e=t._nearZ,i=t.projection.farthestPixelDistance(t),n=i-e,r=.2*t.height,o=e+r;return[e,i,(o-r-e)/n,(o-e)/n]}function yo(t,e,i,n){if(t)return e instanceof kt&&t instanceof $e?e.getTextureDescriptor(t,i,!0):{texture:t.texture,mix:mo(n.mix),offset:n.offset,buffer:0,tileSize:1}}function vo(e,i,n){if(!e)return null;const r=i.getTextureDescriptor(e,n,!0);if(!r)return null;let{texture:o,mix:s,offset:a,tileSize:l,buffer:c,format:u}=r;if(!o||!u)return null;let h=!1;return"uint32"===u&&(h=!0,s[3]=0,s=Nr(t.cM,s,[0,n.paint.get("raster-particle-max-speed")]),a=Or(t.cM,a,[0,n.paint.get("raster-particle-max-speed")])),{texture:o,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:h,scale:s,offset:a,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[u]]}}function xo(t){const e=t._nearZ,i=t.projection.farthestPixelDistance(t),n=i-e,r=.2*t.height,o=e+r;return[e,i,(o-r-e)/n,(o-e)/n]}const bo=new t.ax(1,0,0,1),wo=new t.ax(0,1,0,1),Eo=new t.ax(0,0,1,1),So=new t.ax(1,0,1,1),To=new t.ax(0,1,1,1);function Mo(e,i,n,r,o,s,a){const l=e.context,c=e.transform,u=l.gl,h="globe"===c.projection.name,d=h?["PROJECTION_GLOBE_VIEW"]:[];let p=t.a6.clone(n.projMatrix);if(h&&t.S(c.zoom)>0){const e=t.aS(n.canonical,c),i=t.cN(e);p=t.a6.multiply(new Float32Array(16),c.globeMatrix,i),t.a6.multiply(p,c.projMatrix,p)}const f=t.a6.create();f[12]+=2*o/(t.f.devicePixelRatio*c.width),f[13]+=2*s/(t.f.devicePixelRatio*c.height),t.a6.multiply(p,f,p);const m=e.getOrCreateProgram("debug",{defines:d}),g=i.getTileByID(n.key);e.terrain&&e.terrain.setupElevationDraw(g,m);const _=Ae.disabled,y=Le.disabled,v=e.colorModeForRenderPass(),x="$debug";l.activeTexture.set(u.TEXTURE0),e.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),h?g._makeGlobeTileDebugBuffers(e.context,c):g._makeDebugTileBoundsBuffers(e.context,c.projection);const b=g._tileDebugBuffer||e.debugBuffer,w=g._tileDebugIndexBuffer||e.debugIndexBuffer,E=g._tileDebugSegments||e.debugSegments;if(m.draw(e,u.LINE_STRIP,_,y,v,Oe.disabled,Rr(p,r),x,b,w,E,null,null,null,[g._globeTileDebugBorderBuffer]),a){const t=g.latestRawTileData,i=Math.floor((t&&t.byteLength||0)/1024);let r=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(r+=` => ${n.overscaledZ}`),r+=` ${g.state}`,r+=` ${i}kb`,function(t,e){t.initDebugOverlayCanvas();const i=t.debugOverlayCanvas,n=t.context.gl,r=t.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,i.width,i.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(e,5,5),r.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(e,r)}const S=i.getTile(n).tileSize,T=512/Math.min(S,512)*(n.overscaledZ/c.zoom)*.5,M=g._tileDebugTextBuffer||e.debugBuffer,I=g._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,C=g._tileDebugTextSegments||e.debugSegments;m.draw(e,u.TRIANGLES,_,y,De.alphaBlended,Oe.disabled,Rr(p,t.ax.transparent,T),x,M,I,C,null,null,null,[g._globeTileDebugTextBuffer])}function Io(t,e,i,n){Ao(t,0,e+i/2,t.transform.width,i,n)}function Co(t,e,i,n){Ao(t,e-i/2,0,i,t.transform.height,n)}function Ao(e,i,n,r,o,s){const a=e.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*t.f.devicePixelRatio,n*t.f.devicePixelRatio,r*t.f.devicePixelRatio,o*t.f.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}const Po=t.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Lo}=Po;function Ro(t,e,i,n){t.emplaceBack(e,i,n)}class Do{constructor(e){this.vertexArray=new t.az,this.indices=new t.aw,Ro(this.vertexArray,-1,-1,1),Ro(this.vertexArray,1,-1,1),Ro(this.vertexArray,-1,1,1),Ro(this.vertexArray,1,1,1),Ro(this.vertexArray,-1,-1,-1),Ro(this.vertexArray,1,-1,-1),Ro(this.vertexArray,-1,1,-1),Ro(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Lo),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=t.aB.simpleSegment(0,0,36,12)}}function ko(e,i,n,r,o,s){const a=e.context.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),u=i.paint.get("sky-atmosphere-sun-intensity"),h=((t,e,i,n,r)=>({u_matrix_3f:t,u_sun_direction:e,u_sun_intensity:i,u_color_tint_r:[n.r,n.g,n.b,n.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(t.co.fromMat4(t.co.create(),r),o,u,l,c);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,i.skyboxTexture,0),n.draw(e,a.TRIANGLES,Ae.disabled,Le.disabled,De.unblended,Oe.frontCW,h,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const No=t.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Oo{constructor(e){const i=new t.cO;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const n=new t.aw;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(i,No.members),this.indexBuffer=e.createIndexBuffer(n),this.segments=t.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Fo=t.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class zo{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Bo{constructor(e){this.colorModeAlphaBlendedWriteRGB=new De([1,Re,1,Re],t.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new De([1,0,1,0],t.ax.transparent,[!1,!1,!1,!0]),this.params=new zo,this.updateNeeded=!0,e.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),e.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),e.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),e.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(e){const i=e.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Oo(i);const e=this.params.sizeRange,n=this.params.intensityRange,r=function(e){const i=t.aA(30),n=[];for(let r=0;r<e;++r){const e=2*Math.PI*i(),r=Math.acos(1-2*i())-.5*Math.PI;n.push(t.N.fromValues(Math.cos(r)*Math.cos(e),Math.cos(r)*Math.sin(e),Math.sin(r)))}return n}(this.params.starsCount),o=t.aA(300),s=new t.cP,a=new t.aw;let l=0;for(let i=0;i<r.length;++i){const c=t.N.scale([],r[i],200),u=Math.max(0,1+.01*e*(1*o()-.5)),h=Math.max(0,1+.01*n*(1*o()-.5));s.emplaceBack(c[0],c[1],c[2],-1,-1,u,h),s.emplaceBack(c[0],c[1],c[2],1,-1,u,h),s.emplaceBack(c[0],c[1],c[2],1,1,u,h),s.emplaceBack(c[0],c[1],c[2],-1,1,u,h),a.emplaceBack(l+0,l+1,l+2),a.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=i.createVertexBuffer(s,Fo.members),this.starsIdx=i.createIndexBuffer(a),this.starsSegments=t.aB.simpleSegment(0,0,s.length,a.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,i){const n=e.context,r=n.gl,o=e.transform,s=new Ae(r.LEQUAL,Ae.ReadOnly,[0,1]),a=t.S(o.zoom),l=i.properties.get("color").toArray01(),c=i.properties.get("high-color").toArray01(),u=i.properties.get("space-color").toArray01PremultipliedAlpha(),h=5e-4,d=t.cQ(i.properties.get("horizon-blend"),0,1,h,.25),p=t.cd(e,n,o)&&d===h?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,f=e.frameCounter/1e3%1,m=t.N.length(o.globeCenterInViewSpace),g=Math.sqrt(Math.pow(m,2)-Math.pow(p,2)),_=Math.acos(g/m),y=t=>{const i="globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];t&&i.push("ALPHA_PASS");const h=e.getOrCreateProgram("globeAtmosphere",{defines:i}),p=((t,e,i,n,r,o,s,a,l,c,u,h)=>({u_frustum_tl:t,u_frustum_tr:e,u_frustum_br:i,u_frustum_bl:n,u_horizon:r,u_transition:o,u_fadeout_range:s,u_color:a,u_high_color:l,u_space_color:c,u_temporal_offset:u,u_horizon_angle:h}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,a,d,l,c,u,f,_);e.uploadCommonUniforms(n,h);const m=this.atmosphereBuffer;m&&h.draw(e,r.TRIANGLES,s,Le.disabled,t?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Oe.backCW,p,t?"atmosphere_glow_alpha":"atmosphere_glow",m.vertexBuffer,m.indexBuffer,m.segments)};y(!1),y(!0)}drawStars(e,i){const n=t.aa(i.properties.get("star-intensity"),0,1);if(0===n)return;const r=e.context,o=r.gl,s=e.transform,a=e.getOrCreateProgram("stars"),l=t.bi.identity([]);t.bi.rotateX(l,l,-s._pitch),t.bi.rotateZ(l,l,-s.angle),t.bi.rotateX(l,l,t.bj(s._center.lat)),t.bi.rotateY(l,l,-t.bj(s._center.lng));const c=t.a6.fromQuat(new Float32Array(16),l),u=t.a6.multiply([],s.starsProjMatrix,c),h=t.co.fromMat4([],c),d=t.co.invert([],h),p=[0,1,0];t.N.transformMat3(p,p,d),t.N.scale(p,p,this.params.sizeMultiplier);const f=[1,0,0];t.N.transformMat3(f,f,d),t.N.scale(f,f,this.params.sizeMultiplier);const m=(g=p,_=f,y=n,{u_matrix:Float32Array.from(u),u_up:g,u_right:_,u_intensity_multiplier:y});var g,_,y;e.uploadCommonUniforms(r,a),this.starsVx&&this.starsIdx&&a.draw(e,o.TRIANGLES,Ae.disabled,Le.disabled,this.colorModeAlphaBlendedWriteRGB,Oe.disabled,m,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Uo(e,i){const n=[...e],r=i.cameraWorldSizeForFog/i.worldSize,o=t.a6.identity([]);return t.a6.scale(o,o,[r,r,1]),t.a6.multiply(n,o,n),t.a6.multiply(n,i.worldToFogMatrix,n),n}function Vo(t,e,i,n){const r=i.material,o=n.context,{baseColorTexture:s,metallicRoughnessTexture:a}=r.pbrMetallicRoughness,{normalTexture:l,occlusionTexture:c,emissionTexture:u}=r;function h(e,i,n){if(e&&(t.push(i),o.activeTexture.set(o.gl.TEXTURE0+n),e.gfxTexture)){const{minFilter:t,magFilter:i,wrapS:n,wrapT:r}=e.sampler;e.gfxTexture.bindExtraParam(t,i,n,r)}}h(s,"HAS_TEXTURE_u_baseColorTexture",_n.BaseColor),h(a,"HAS_TEXTURE_u_metallicRoughnessTexture",_n.MetallicRoughness),h(l,"HAS_TEXTURE_u_normalTexture",_n.Normal),h(c,"HAS_TEXTURE_u_occlusionTexture",_n.Occlusion),h(u,"HAS_TEXTURE_u_emissionTexture",_n.Emission),i.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),e.push(i.texcoordBuffer)),i.colorBuffer&&(t.push(12===i.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),e.push(i.colorBuffer)),i.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),e.push(i.normalBuffer)),i.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),e.push(i.pbrBuffer)),"OPAQUE"!==r.alphaMode&&"MASK"!==r.alphaMode||t.push("UNPREMULT_TEXTURE_IN_SHADER"),r.defined||t.push("DIFFUSE_SHADED"),t.push("USE_STANDARD_DERIVATIVES")}function jo(e,i,n,r,o,s){const a=n.paint.get("model-opacity"),l=i.context,c=new Ae(i.context.gl.LEQUAL,Ae.ReadWrite,i.depthRangeFor3D),u=i.transform,h=e.mesh,d=h.material,p=d.pbrMetallicRoughness,f=i.style.fog;let m;m="pixels"===i.transform.projection.zAxisUnit?[...e.nodeModelMatrix]:t.a6.multiply([],r.zScaleMatrix,e.nodeModelMatrix),t.a6.multiply(m,r.negCameraPosMatrix,m);const g=t.a6.invert([],m);t.a6.transpose(g,g);const _=n.paint.get("model-emissive-strength").constantOr(0),y=$r(new Float32Array(e.worldViewProjection),new Float32Array(m),new Float32Array(g),i,a,p.baseColorFactor,d.emissiveFactor,p.metallicFactor,p.roughnessFactor,d,_,n),v={defines:[]},x=[];Vo(v.defines,x,h,i);const b=i.shadowRenderer;b&&(b.useNormalOffset=!1);let w=null;if(f){const t=Uo(e.nodeModelMatrix,i.transform);if(w=new Float32Array(t),"globe"!==u.projection.name){const e=h.aabb.min,i=h.aabb.max,[n,r]=f.getOpacityForBounds(t,e[0],e[1],i[0],i[1]);v.overrideFog=n>=gt||r>=gt}}const E=yn(i,n.paint.get("model-cutoff-fade-range"));E.shouldRenderCutoff&&v.defines.push("RENDER_CUTOFF");const S=i.getOrCreateProgram("model",v);i.uploadCommonUniforms(l,S,null,w,E),"shadow"!==i.renderPass&&b&&b.setupShadowsFromMatrix(e.nodeModelMatrix,S),S.draw(i,l.gl.TRIANGLES,c,o,s,h.material.doubleSided?Oe.disabled:Oe.backCCW,y,n.id,h.vertexBuffer,h.indexBuffer,h.segments,n.paint,i.transform.zoom,void 0,x)}function Go(e,i,n,r,o,s,a){let l;l="globe"===e.projection.name?t.cS(n,e):[...n],t.a6.multiply(l,l,i.matrix);const c=t.a6.multiply([],r,l);if(i.meshes)for(const e of i.meshes){if("BLEND"!==e.material.alphaMode){a.push({mesh:e,depth:0,modelIndex:o,worldViewProjection:c,nodeModelMatrix:l});continue}const i=t.N.transformMat4([],e.centroid,c);i[2]>0&&s.push({mesh:e,depth:i[2],modelIndex:o,worldViewProjection:c,nodeModelMatrix:l})}if(i.children)for(const t of i.children)Go(e,t,n,r,o,s,a)}function Ho(t,e,i,n){const r=i.shadowRenderer;if(!r)return;const o=r.getShadowPassDepthMode(),s=r.getShadowPassColorMode(),a=r.calculateShadowPassMatrixFromMatrix(e),l=Zr(a);i.getOrCreateProgram("modelDepth",{defines:i._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,o,Le.disabled,s,Oe.backCCW,l,n.id,t.vertexBuffer,t.indexBuffer,t.segments,n.paint,i.transform.zoom,void 0,void 0)}function Wo(e,i,n){const r=i.updateZoomBasedPaintProperties(),o=function(e,i,n){let r,o,s,a=e.terrain?e.terrain.exaggeration():0;if(e.terrain&&a>0){const i=e.terrain,o=i.findDEMTileFor(n);o&&o.dem?r=t.cU.create(i,n,o):a=0}if(0===a&&(i.terrainElevationMin=0,i.terrainElevationMax=0),a===i.validForExaggeration&&(0===a||r&&r._demTile&&r._demTile.tileID===i.validForDEMTile.id&&r._dem._timestamp===i.validForDEMTile.timestamp))return!1;for(const t in i.instancesPerModel){const e=i.instancesPerModel[t];for(let t=0;t<e.instancedDataArray.length;++t){const n=(r?a*r.getElevationAt(0|e.instancedDataArray.float32[16*t],0|e.instancedDataArray.float32[16*t+1],!0,!0):0)+e.instancesEvaluatedElevation[t];e.instancedDataArray.float32[16*t+6]=n,o=o?Math.min(i.terrainElevationMin,n):n,s=s?Math.max(i.terrainElevationMax,n):n}}return i.terrainElevationMin=o||0,i.terrainElevationMax=s||0,i.validForExaggeration=a,i.validForDEMTile=r&&r._demTile?{id:r._demTile.tileID,timestamp:r._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,i,n);(r||o)&&(i.uploaded=!1,i.upload(e.context))}const qo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new t.bS([0,0,0],[t.V,t.V,0])};function Xo(e,i){const n=1<<e.canonical.z,r=i.getFreeCameraOptions().position,o=i.elevation,s=e.canonical.x/n,a=(e.canonical.x+1)/n,l=e.canonical.y/n,c=(e.canonical.y+1)/n;let u=i._centerAltitude;if(o){const t=o.getMinMaxForTile(e);t&&t.max>u&&(u=t.max)}const h=t.aa(r.x,s,a)-r.x,d=t.aa(r.y,l,c)-r.y,p=t.bl(u,i.center.lat)-r.z;return i._zoomFromMercatorZ(Math.sqrt(h*h+d*d+p*p))}function $o(t,e,i,n,r,o,s){const a=t.context,l="shadow"===t.renderPass,c=t.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new Ae(a.gl.LEQUAL,Ae.ReadWrite,t.depthRangeFor3D),h=t.isTileAffectedByFog(o);if(i.meshes)for(const d of i.meshes){const p=["MODEL_POSITION_ON_GPU"],f=[];let m,g,_;n.instancedDataArray.length>20&&p.push("INSTANCED_ARRAYS");const y=yn(t,e.paint.get("model-cutoff-fade-range"));if(y.shouldRenderCutoff&&p.push("RENDER_CUTOFF"),l&&c)m=t.getOrCreateProgram("modelDepth",{defines:p}),g=Zr(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(i.matrix)),_=c.getShadowPassColorMode();else{Vo(p,f,d,t),m=t.getOrCreateProgram("model",{defines:p,overrideFog:h});const n=d.material,l=n.pbrMetallicRoughness,u=e.paint.get("model-opacity"),v=e.paint.get("model-emissive-strength").constantOr(0);g=$r(o.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),t,u,l.baseColorFactor,n.emissiveFactor,l.metallicFactor,l.roughnessFactor,n,v,e,r),c&&(s.shadowUniformsInitialized?m.setShadowUniformValues(a,c.getShadowUniformValues()):(c.setupShadows(o.toUnwrapped(),m,"model-tile",o.overscaledZ),s.shadowUniformsInitialized=!0)),_=y.shouldRenderCutoff||u<1||"OPAQUE"!==n.alphaMode?De.alphaBlended:De.unblended}t.uploadCommonUniforms(a,m,o.toUnwrapped(),null,y);const v=d.material.doubleSided?Oe.disabled:Oe.backCCW;if(n.instancedDataArray.length>20)f.push(n.instancedDataBuffer),m.draw(t,a.gl.TRIANGLES,u,Le.disabled,_,v,g,e.id,d.vertexBuffer,d.indexBuffer,d.segments,e.paint,t.transform.zoom,void 0,f,n.instancedDataArray.length);else{const i=l?"u_instance":"u_normal_matrix";for(let r=0;r<n.instancedDataArray.length;++r)g[i]=new Float32Array(n.instancedDataArray.arrayBuffer,64*r,16),m.draw(t,a.gl.TRIANGLES,u,Le.disabled,_,v,g,e.id,d.vertexBuffer,d.indexBuffer,d.segments,e.paint,t.transform.zoom,void 0,f)}}if(i.children)for(const a of i.children)$o(t,e,a,n,r,o,s)}const Yo=[1,-1,1];function Zo(e,i,n,r){if(!n.modelManager)return!0;const o=n.modelManager;if(!n.shadowRenderer)return!0;const s=n.shadowRenderer,a=i.aabb;let l=!0,c=e.maxHeight;if(0===c){let t=0;for(const i in e.instancesPerModel){const e=o.getModel(i,r);e?t=Math.max(t,Math.max(Math.max(e.aabb.max[0],e.aabb.max[1]),e.aabb.max[2])):l=!1}c=e.maxScale*t*1.41+e.maxVerticalOffset,l&&(e.maxHeight=c)}a.max[2]=c,a.min[2]+=e.terrainElevationMin,a.max[2]+=e.terrainElevationMax,t.N.transformMat4(a.min,a.min,i.tileMatrix),t.N.transformMat4(a.max,a.max,i.tileMatrix);const u=a.intersects(s.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(e.isInsideFirstShadowMapFrustum=2===u),0===u}class Ko{}class Jo{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,i,n){{const t=this._storage.get(i.id);if(t)return t.lastUsedFrameIdx=e,t.buf}const r=n.gl,o=r.getBufferParameter(r.ELEMENT_ARRAY_BUFFER,r.BUFFER_SIZE),s=new ArrayBuffer(o),a=new Int16Array(s);r.getBufferSubData(r.ELEMENT_ARRAY_BUFFER,0,new Int16Array(s));const l=new t.cW;for(let t=0;t<o/2;t+=3){const e=a[t],i=a[t+1],n=a[t+2];l.emplaceBack(e,i),l.emplaceBack(i,n),l.emplaceBack(n,e)}const c=n.bindVertexArrayOES.current,u=new Ko;return u.buf=new jt(n,l),u.lastUsedFrameIdx=e,this._storage.set(i.id,u),n.bindVertexArrayOES.set(c),u.buf}update(t){for(const[e,i]of this._storage)t-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(e))}destroy(){for(const[t,e]of this._storage)e.buf.destroy(),this._storage.delete(t)}}class Qo{registerParameter(t,e,i,n,r){}registerButton(t,e,i){}}const ts={symbol:function(e,i,n,r,o){if("translucent"!==e.renderPass)return;const s=Le.disabled,a=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(e,i,n,r,o,s,a){const l=i.transform,c="map"===o,u="map"===s;for(const i of e){const e=r.getTile(i),o=e.getBucket(n);if(!o||!o.text||!o.text.segments.get().length)continue;const s=t.b5(o.textSizeData,l.zoom),h=ki(i,o.getProjection(),l),d=l.calculatePixelsToTileUnitsMatrix(e),p=mi(h,e.tileID.canonical,u,c,l,o.getProjection(),d),f=o.hasIconTextFit()&&o.hasIconData();if(s){const n=Math.pow(2,l.zoom-e.tileID.overscaledZ);no(o,c,u,a,t.cx,l,p,i,n,s,f)}}}(r,e,n,i,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),o);const l=0!==n.paint.get("icon-opacity").constantOr(1),c=0!==n.paint.get("text-opacity").constantOr(1);void 0!==n.layout.get("symbol-sort-key").constantOr(1)&&(l||c)?ro(e,i,n,r,s,a):(l&&ro(e,i,n,r,s,a,{onlyIcons:!0}),c&&ro(e,i,n,r,s,a,{onlyText:!0})),i.map.showCollisionBoxes&&(Qr(e,i,n,r,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Qr(e,i,n,r,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(e,i,n,r){if("translucent"!==e.renderPass)return;const o=n.paint.get("circle-opacity"),s=n.paint.get("circle-stroke-width"),a=n.paint.get("circle-stroke-opacity"),l=void 0!==n.layout.get("circle-sort-key").constantOr(1),c=n.paint.get("circle-emissive-strength");if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const u=e.context,h=u.gl,d=e.transform,p=e.depthModeForSublayer(0,Ae.ReadOnly),f=Le.disabled,m=e.colorModeForDrapableLayerRenderPass(c),g="globe"===d.projection.name,_=[t.a5(d.center.lng),t.ae(d.center.lat)],y=[];for(let o=0;o<r.length;o++){const s=r[o],a=i.getTile(s),c=a.getBucket(n);if(!c||c.projection.name!==d.projection.name)continue;const u=c.programConfigurations.get(n.id),h=t.cy(n),p=e.isTileAffectedByFog(s);g&&h.push("PROJECTION_GLOBE_VIEW");const f=e.getOrCreateProgram("circle",{config:u,defines:h,overrideFog:p}),m=c.layoutVertexBuffer,v=c.globeExtVertexBuffer,x=c.indexBuffer,b=d.projection.createInversionMatrix(d,s.canonical),w={programConfiguration:u,program:f,layoutVertexBuffer:m,globeExtVertexBuffer:v,indexBuffer:x,uniformValues:t.cz(e,s,a,b,_,n),tile:a};if(l){const e=c.segments.get();for(const i of e)y.push({segments:new t.aB([i]),sortKey:i.sortKey,state:w})}else y.push({segments:c.segments,sortKey:0,state:w})}l&&y.sort(((t,e)=>t.sortKey-e.sortKey));const v={useDepthForOcclusion:d.depthOcclusionForSymbolsAndCircles};for(const t of y){const{programConfiguration:i,program:r,layoutVertexBuffer:o,globeExtVertexBuffer:s,indexBuffer:a,uniformValues:l,tile:c}=t.state,g=t.segments;e.terrain&&e.terrain.setupElevationDraw(c,r,v),e.uploadCommonUniforms(u,r,c.tileID.toUnwrapped()),r.draw(e,h.TRIANGLES,p,f,m,Oe.disabled,l,n.id,o,a,g,n.paint,d.zoom,i,[s])}},heatmap:function(e,i,n,r){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const o=e.context,s=o.gl,a=Le.disabled,l=new De([s.ONE,s.ONE,s.ONE,s.ONE],t.ax.transparent,[!0,!0,!0,!0]);!function(t,e,i,n){const r=t.gl,o=e.width*n,s=e.height*n;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,o,s]);let a=i.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),a=i.heatmapFbo=t.createFramebuffer(o,s,!0,null),function(t,e,i,n,r,o){const s=t.gl;s.texImage2D(s.TEXTURE_2D,0,t.extRenderToTextureHalfFloat?s.RGBA16F:s.RGBA,r,o,0,s.RGBA,t.extRenderToTextureHalfFloat?s.HALF_FLOAT:s.UNSIGNED_BYTE,null),n.colorAttachment.set(i)}(t,0,e,a,o,s)}else r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),t.bindFramebuffer.set(a.framebuffer)}(o,e,n,"globe"===e.transform.projection.name?.5:.25),o.clear({color:t.ax.transparent});const c=e.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:[],d=u?Oe.frontCCW:Oe.disabled,p=[t.a5(c.center.lng),t.ae(c.center.lat)];for(let t=0;t<r.length;t++){const f=r[t];if(i.hasRenderableParent(f))continue;const m=i.getTile(f),g=m.getBucket(n);if(!g||g.projection.name!==c.projection.name)continue;const _=e.isTileAffectedByFog(f),y=g.programConfigurations.get(n.id),v=e.getOrCreateProgram("heatmap",{config:y,defines:h,overrideFog:_}),{zoom:x}=e.transform;e.terrain&&e.terrain.setupElevationDraw(m,v),e.uploadCommonUniforms(o,v,f.toUnwrapped());const b=c.projection.createInversionMatrix(c,f.canonical);v.draw(e,s.TRIANGLES,Ae.disabled,a,l,d,kr(e,f,m,b,p,x,n.paint.get("heatmap-intensity")),n.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,n.paint,e.transform.zoom,y,u?[g.globeExtVertexBuffer]:null)}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,i){const n=e.context,r=n.gl,o=i.heatmapFbo;if(!o)return;n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),n.activeTexture.set(r.TEXTURE1);let s=i.colorRampTexture;s||(s=i.colorRampTexture=new t.T(n,i.colorRamp,r.RGBA)),s.bind(r.LINEAR,r.CLAMP_TO_EDGE),e.getOrCreateProgram("heatmapTexture").draw(e,r.TRIANGLES,Ae.disabled,Le.disabled,e.colorModeForRenderPass(),Oe.disabled,((t,e,i,n)=>({u_image:0,u_color_ramp:1,u_opacity:e.paint.get("heatmap-opacity")}))(0,i),i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom)}(e,n))},line:function(e,i,n,r){if("translucent"!==e.renderPass)return;const o=n.paint.get("line-opacity"),s=n.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=n.paint.get("line-emissive-strength"),l=e.depthModeForSublayer(0,Ae.ReadOnly),c=e.colorModeForDrapableLayerRenderPass(a),u=e.terrain&&e.terrain.renderingToTexture?1:t.f.devicePixelRatio,h=n.paint.get("line-dasharray"),d=h.constantOr(1),p=n.layout.get("line-cap"),f=n.paint.get("line-pattern"),m=f.constantOr(1),g=n.paint.get("line-pattern").constantOr(1),_=1!==n.paint.get("line-opacity").constantOr(1);let y=!g&&_;const v=n.paint.get("line-gradient"),x=m?"linePattern":"line",b=e.context,w=b.gl,E=t.cA(n);e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(y=!1);for(const o of r){const r=i.getTile(o);if(m&&!r.patternsLoaded())continue;const s=r.getBucket(n);if(!s)continue;e.prepareDrawTile();const a=s.programConfigurations.get(n.id),g=e.isTileAffectedByFog(o),_=e.getOrCreateProgram(x,{config:a,defines:E,overrideFog:g}),S=f.constantOr(null);if(S&&r.imageAtlas){const t=r.imageAtlas.patternPositions[S.toString()];t&&a.setConstantPatternPositions(t)}const T=h.constantOr(null),M=p.constantOr(null);if(!m&&T&&M&&r.lineAtlas){const t=r.lineAtlas.getDash(T,M);t&&a.setConstantPatternPositions(t)}let[I,C]=n.paint.get("line-trim-offset");if("round"===M||"square"===M){const t=1;I!==C&&(0===I&&(I-=t),1===C&&(C+=t))}const A=e.terrain?o.projMatrix:null,P=m?t.cB(e,r,n,A,u,[I,C]):t.cC(e,r,n,A,s.lineClipsArray.length,u,[I,C]);if(v){const r=s.gradients[n.id];let a=r.texture;if(n.gradientVersion!==r.version){let l=256;if(n.stepInterpolant){const n=i.getSource().maxzoom,r=o.canonical.z===n?Math.ceil(1<<e.transform.maxZoom-o.canonical.z):1;l=t.aa(t.cD(s.maxLineLength/t.V*1024*r),256,b.maxTextureSize)}r.gradient=t.cE({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:r.gradient||void 0,clips:s.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new t.T(b,r.gradient,w.RGBA),r.version=n.gradientVersion,a=r.texture}b.activeTexture.set(w.TEXTURE1),a.bind(n.stepInterpolant?w.NEAREST:w.LINEAR,w.CLAMP_TO_EDGE)}d&&(b.activeTexture.set(w.TEXTURE0),r.lineAtlasTexture&&r.lineAtlasTexture.bind(w.LINEAR,w.REPEAT),a.updatePaintBuffers()),m&&(b.activeTexture.set(w.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),a.updatePaintBuffers()),e.uploadCommonUniforms(b,_,o.toUnwrapped());const L=t=>{_.draw(e,w.TRIANGLES,l,t,c,Oe.disabled,P,n.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,n.paint,e.transform.zoom,a,[s.layoutVertexBuffer2])};if(y){const t=e.stencilModeForClipping(o).ref;0===t&&e.terrain&&b.clear({stencil:0});const i={func:w.EQUAL,mask:255};P.u_alpha_discard_threshold=.8,L(new Le(i,t,255,w.KEEP,w.KEEP,w.INVERT)),P.u_alpha_discard_threshold=0,L(new Le(i,t,255,w.KEEP,w.KEEP,w.KEEP))}else L(e.stencilModeForClipping(o))}y&&(e.resetStencilClippingMasks(),e.terrain&&b.clear({stencil:0}))},fill:function(e,i,n,r){const o=n.paint.get("fill-color"),s=n.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=n.paint.get("fill-emissive-strength"),l=e.colorModeForDrapableLayerRenderPass(a),c=n.paint.get("fill-pattern"),u=e.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===o.constantOr(t.ax.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(e.renderPass===u){const t=e.depthModeForSublayer(1,"opaque"===e.renderPass?Ae.ReadWrite:Ae.ReadOnly);so(e,i,n,r,t,l,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){const t=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Ae.ReadOnly);so(e,i,n,r,t,l,!0)}},"fill-extrusion":function(e,i,n,r){const o=n.paint.get("fill-extrusion-opacity"),s=e.context,a=s.gl,l=e.terrain,c=l&&l.renderingToTexture;if(0===o)return;const u=e.conflationActive&&e.layerUsedInConflation(n,i.getSource());if(u&&function(t,e,i,n){for(const r of n){const n=e.getTile(r).getBucket(i);n&&(n.updateReplacement(r,t.replacementSource),n.uploadCentroid(t.context))}}(e,i,n,r),l||u)for(const t of r){const r=i.getTile(t).getBucket(n);r&&co(e.context,i,t,r,n,l,u)}if("shadow"===e.renderPass&&e.shadowRenderer){const s=e.shadowRenderer;if(l&&o<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof t.Z)return;const a=s.getShadowPassDepthMode(),c=s.getShadowPassColorMode();ao(e,i,n,r,a,Le.disabled,c,u)}else if("translucent"===e.renderPass){const h=!n.paint.get("fill-extrusion-pattern").constantOr(1),d=n.paint.get("fill-extrusion-color").constantOr(t.ax.white);if(!c&&0!==d.a){const t=new Ae(e.context.gl.LEQUAL,Ae.ReadWrite,e.depthRangeFor3D);1===o&&h?ao(e,i,n,r,t,Le.disabled,De.unblended,u):(ao(e,i,n,r,t,Le.disabled,De.disabled,u),ao(e,i,n,r,t,e.stencilModeFor3D(),e.colorModeForRenderPass(),u),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&h&&(!l&&"globe"!==e.transform.projection.name||c)){const o=n.paint.get("fill-extrusion-opacity"),h=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),d=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),p=n.paint.get("fill-extrusion-flood-light-intensity"),f=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),m=h>0&&d>0,g=p>0,_=(t,e,i)=>(1-i)*t+i*e,y=s=>{const l=e.depthModeForSublayer(1,Ae.ReadOnly,a.LEQUAL,!0),c=n.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),m=_(.1,3,c),g=e._showOverdrawInspector;if(!g){const c=new Le({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),g=new De([a.ONE,a.ONE,a.ONE,a.ONE],t.ax.transparent,[!1,!1,!1,!0],a.MIN);lo(e,i,n,r,l,c,g,Oe.disabled,s,"sdf",o,h,d,p,f,m,u,!1)}{const c=g?Le.disabled:new Le({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),_=g?e.colorModeForRenderPass():new De([a.ONE_MINUS_DST_ALPHA,a.DST_ALPHA,a.ONE,a.ONE],t.ax.transparent,[!0,!0,!0,!0]);lo(e,i,n,r,l,c,_,Oe.disabled,s,"color",o,h,d,p,f,m,u,!1)}};if(c){const c=(s,l,c)=>{const m=e.depthModeForSublayer(1,Ae.ReadOnly,a.LEQUAL,!1),g=n.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),y=_(.1,3,g);{const c=new De([a.ONE,a.ONE,a.ONE,a.ONE],t.ax.transparent,[!1,!1,!1,!0]);lo(e,i,n,r,m,Le.disabled,c,Oe.disabled,s,"clear",o,h,d,p,f,y,u,l)}{const c=new Le({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),g=new De([a.ONE,a.ONE,a.ONE,a.ONE],t.ax.transparent,[!1,!1,!1,!0],a.MIN);lo(e,i,n,r,m,c,g,Oe.disabled,s,"sdf",o,h,d,p,f,y,u,l)}{const c=s?a.ZERO:a.ONE_MINUS_DST_ALPHA,g=new Le({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),_=new De([c,a.DST_ALPHA,a.ONE_MINUS_DST_ALPHA,a.ZERO],t.ax.transparent,[!0,!0,!0,!0]);lo(e,i,n,r,m,g,_,Oe.disabled,s,"color",o,h,d,p,f,y,u,l)}{const g=new De([a.ONE,a.ONE,a.ONE,s?a.ZERO:a.ONE],t.ax.transparent,[!1,!1,!1,!0],s?a.FUNC_ADD:a.MAX);lo(e,i,n,r,m,Le.disabled,g,Oe.disabled,s,"clear",o,h,d,p,f,y,u,l,c)}};if(m||g){let i;if(e.prepareDrawTile(),l){const e=l.drapeBufferSize[0],n=l.drapeBufferSize[1];i=l.framebufferCopyTexture,i&&(!i||i.size[0]===e&&i.size[1]===n)||(i&&i.destroy(),i=l.framebufferCopyTexture=new t.T(s,new t.h({width:e,height:n}),a.RGBA)),i.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,e,n,0)}m&&c(!0,!1,i),g&&c(!1,!0,i)}}else m&&y(!0),g&&y(!1)}}},hillshade:function(t,e,i,n){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;if(t.style.disableElevatedTerrain)return;const r=t.context,o=t.terrain&&t.terrain.renderingToTexture,[s,a]="translucent"!==t.renderPass||o?[{},n]:t.stencilConfigForOverlap(n);for(const n of a){const r=e.getTile(n);if(r.needsHillshadePrepare&&"offscreen"===t.renderPass)nr(t,r,i);else if("translucent"===t.renderPass){const e=t.depthModeForSublayer(0,Ae.ReadOnly),a=i.paint.get("hillshade-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(a),c=o&&t.terrain?t.terrain.stencilModeForRTTOverlap(n):s[n.overscaledZ];er(t,n,r,i,e,c,l)}}r.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(e,i,n,r,o,s){if("translucent"!==e.renderPass)return;if(0===n.paint.get("raster-opacity"))return;const a="globe"===e.transform.projection.name,l=0!==n.paint.get("raster-elevation"),c=l&&a;if(e.renderElevatedRasterBackface&&!c)return;const u=e.context,h=u.gl,d=i.getSource(),p=function(e,i,n,r){const o=i.paint.get("raster-color"),s="raster-array"===e.type,a=[],l=i.paint.get("raster-resampling"),c=i.paint.get("raster-color-mix");let u=i.paint.get("raster-color-range");const h=[c[0],c[1],c[2],0],d=c[3];let p="nearest"===l?r.NEAREST:r.LINEAR;if(s&&(a.push("RASTER_ARRAY"),o||a.push("RASTER_COLOR"),"linear"===l&&a.push("RASTER_ARRAY_LINEAR"),p=r.NEAREST,!u&&e.rasterLayers)){const t=e.rasterLayers.find((({id:t})=>t===i.sourceLayer));t&&t.fields&&t.fields.range&&(u=t.fields.range)}if(u=u||[0,1],o){a.push("RASTER_COLOR"),n.activeTexture.set(r.TEXTURE2),i.updateColorRamp(u);let e=i.colorRampTexture;e||(e=i.colorRampTexture=new t.T(n,i.colorRamp,r.RGBA)),e.bind(r.LINEAR,r.CLAMP_TO_EDGE)}return{mix:h,range:u,offset:d,defines:a,resampling:p}}(d,n,u,h);if(d instanceof t.ap&&!r.length&&!a)return;const f=n.paint.get("raster-emissive-strength"),m=e.colorModeForDrapableLayerRenderPass(f),g=e.terrain&&e.terrain.renderingToTexture,_=!e.options.moving,y="nearest"===n.paint.get("raster-resampling")?h.NEAREST:h.LINEAR;if(d instanceof t.ap&&!r.length&&(d.onNorthPole||d.onSouthPole)){const t=l?e.stencilModeFor3D():Le.disabled;return void go(!!d.onNorthPole,null,e,i,n,f,p,Oe.disabled,t)}if(!r.length)return;const[v,x]=d instanceof t.ap||g?[{},r]:e.stencilConfigForOverlap(r),b=x[x.length-1].overscaledZ;c&&p.defines.push("PROJECTION_GLOBE_VIEW"),l&&p.defines.push("RENDER_CUTOFF");const w=(r,o,x)=>{for(const w of r){const r=w.toUnwrapped(),E=i.getTile(w);if(g&&(!E||!E.hasData()))continue;u.activeTexture.set(h.TEXTURE0);const S=yo(E,d,n,p);if(!S||!S.texture)continue;const{texture:T,mix:M,offset:I,tileSize:C,buffer:A}=S;let P,L;g?(P=Ae.disabled,L=w.projMatrix):l?(P=new Ae(h.LEQUAL,Ae.ReadWrite,e.depthRangeFor3D),L=a?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(r,_)):(P=e.depthModeForSublayer(w.overscaledZ-b,1===n.paint.get("raster-opacity")?Ae.ReadWrite:Ae.ReadOnly,h.LESS),L=e.transform.calculateProjMatrix(r,_));const R=e.terrain&&g?e.terrain.stencilModeForRTTOverlap(w):v[w.overscaledZ],D=s?0:n.paint.get("raster-fade-duration");E.registerFadeDuration(D);const k=i.findLoadedParent(w,0),N=pr(E,k,i,e.transform,D);let O,F;e.terrain&&e.terrain.prepareDrawTile(),u.activeTexture.set(h.TEXTURE0),T.bind(y,h.CLAMP_TO_EDGE),u.activeTexture.set(h.TEXTURE1),k?(k.texture&&k.texture.bind(y,h.CLAMP_TO_EDGE),O=Math.pow(2,k.tileID.overscaledZ-E.tileID.overscaledZ),F=[E.tileID.canonical.x*O%1,E.tileID.canonical.y*O%1]):T.bind(y,h.CLAMP_TO_EDGE),T.useMipmap&&u.extTextureFilterAnisotropic&&e.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const z=e.transform;let B;const U=l?_o(z):[0,0,0,0];let V,j,G,H,W,q=0;if(c&&d instanceof t.ap&&d.coordinates.length>3)V=Float32Array.from(t.aT(t.ci(new t.bs(0,0,0)))),j=Float32Array.from(z.globeMatrix),G=Float32Array.from(t.ce(z)),H=[t.a5(z.center.lng),t.ae(z.center.lat)],B=d.elevatedGlobePerspectiveTransform,W=d.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const e=t.cf(w.canonical);q=t.cg(e.getCenter().lat),V=Float32Array.from(t.aT(t.ci(w.canonical))),j=Float32Array.from(z.globeMatrix),G=Float32Array.from(t.ce(z)),H=[t.a5(z.center.lng),t.ae(z.center.lat)],B=[0,0],W=Float32Array.from(t.ch(w.canonical,e,q,z.worldSize/z._pixelsPerMercatorPixel))}else B=d instanceof t.ap?d.perspectiveTransform:[0,0],V=new Float32Array(16),j=new Float32Array(9),G=new Float32Array(16),H=[0,0],W=new Float32Array(9);const X=Fr(L,V,j,G,W,F||[0,0],t.S(e.transform.zoom),H,U,O||1,N,n,B,l?n.paint.get("raster-elevation"):0,2,M,I,p.range,C,A,f),$=e.isTileAffectedByFog(w),Y=e.getOrCreateProgram("raster",{defines:p.defines,overrideFog:$});if(e.uploadCommonUniforms(u,Y,r),d instanceof t.ap){const i=d.elevatedGlobeVertexBuffer,r=d.elevatedGlobeIndexBuffer;if(g||!a)d.boundsBuffer&&d.boundsSegments&&Y.draw(e,h.TRIANGLES,P,Le.disabled,m,Oe.disabled,X,n.id,d.boundsBuffer,e.quadTriangleIndexBuffer,d.boundsSegments);else if(i&&r){const s=z.zoom<=t.bG?d.elevatedGlobeSegments:d.getSegmentsForLongitude(z.center.lng);s&&Y.draw(e,h.TRIANGLES,P,Le.disabled,m,o,X,n.id,i,r,s)}}else if(c){P=new Ae(h.LEQUAL,Ae.ReadOnly,e.depthRangeFor3D);const t=e.globeSharedBuffers;if(t){const[i,r,s]=t.getGridBuffers(q,!1);Y.draw(e,h.TRIANGLES,P,x||R,e.colorModeForRenderPass(),o,X,n.id,i,r,s)}}else{const{tileBoundsBuffer:t,tileBoundsIndexBuffer:i,tileBoundsSegments:r}=e.getTileBoundsBuffers(E);Y.draw(e,h.TRIANGLES,P,R,m,Oe.disabled,X,n.id,t,i,r)}}if(!(d instanceof t.ap)&&c)for(const t of r){const r=t.canonical.y===(1<<t.canonical.z)-1;0===t.canonical.y&&go(!0,t,e,i,n,f,p,o,x||Le.disabled),r&&go(!1,t,e,i,n,f,p,o===Oe.frontCW?Oe.backCW:Oe.frontCW,x||Le.disabled)}};c?w(x,e.renderElevatedRasterBackface?Oe.backCW:Oe.frontCW,e.stencilModeFor3D()):w(x,Oe.disabled,void 0),e.resetStencilClippingMasks()},"raster-particle":function(e,i,n,r,o,s){"offscreen"===e.renderPass&&function(e,i,n,r){if(!r.length)return;const o=e.context,s=o.gl,a=i.getSource();if(!(a instanceof kt))return;const l=[];for(const t of r){const e=i.getTile(t);if(!(e instanceof $e))continue;const r=vo(e,a,n);if(!r)continue;const s=[r.tileSize,r.tileSize];let c=n.tileFramebuffer;c||(c=n.tileFramebuffer=o.createFramebuffer(s[0],s[1],!0,null));let u=e.rasterParticleState;const h=n.paint.get("raster-particle-count");u||(u=e.rasterParticleState=new Be(o,t,s,h));const d=u.update(n.lastInvalidatedAt);u.numParticles!==h&&u.setNumParticles(t,h);const p=u.targetColorTexture;u.targetColorTexture=u.backgroundColorTexture,u.backgroundColorTexture=p;const f=u.particleVertices0;u.particleVertices0=u.particleVertices1,u.particleVertices1=f,l.push([t,r,u,d])}if(0===l.length)return;const c=t.f.now(),u=n.previousDrawTimestamp?.001*(c-n.previousDrawTimestamp):.0167;if(n.previousDrawTimestamp=c,n.hasColorMap()){o.activeTexture.set(s.TEXTURE0+2);let e=n.colorRampTexture;e||(e=n.colorRampTexture=new t.T(o,n.colorRamp,s.RGBA)),e.bind(s.LINEAR,s.CLAMP_TO_EDGE)}o.bindFramebuffer.set(n.tileFramebuffer.framebuffer),o.activeTexture.set(s.TEXTURE0),function(e,i,n){const r=e.context,o=r.gl,s=i.tileFramebuffer;r.activeTexture.set(o.TEXTURE0);const a={u_texture:0,u_opacity:1.05*(c=i.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=e.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const c of n){const[,,n,u]=c;s.colorAttachment.set(n.targetColorTexture.texture),r.viewport.set([0,0,s.width,s.height]),r.clear({color:t.ax.transparent}),u&&(n.backgroundColorTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),l.draw(e,o.TRIANGLES,Ae.disabled,Le.disabled,De.alphaBlended,Oe.disabled,a,i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments))}}(e,n,l),function(e,i,n,r){const o=e.context.gl,s=n.tileFramebuffer,a="globe"===e.transform.projection.name,l=n.paint.get("raster-particle-max-speed");for(const c of r){const[r,u,h]=c;u.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.colorAttachment.set(h.targetColorTexture.texture);const d=e.getOrCreateProgram("rasterParticleDraw",{defines:u.defines,overrideFog:!1}),p=u.scalarData?[]:[0,1,2,3].map((e=>t.cG[e](r)));p.push(r);const f=r.canonical.x,m=r.canonical.y;for(const t of p){const s=i.getTile(a?t.wrapped():t);if(!s)continue;const c=s.rasterParticleState;if(!c)continue;const h=Ur([t.canonical.x+(1<<t.canonical.z)*(t.wrap-r.wrap)-f,t.canonical.y-m],0,u.texture.size,2,l,u.textureOffset,u.scale,u.offset);d.draw(e,o.POINTS,Ae.disabled,Le.disabled,De.alphaBlended,Oe.disabled,h,n.id,c.particleVertices0,void 0,c.particleSegment)}}}(e,i,n,l),function(t,e,i,n){const r=t.context.gl;let o=e.transformFeedbackObject;o||(o=e.transformFeedbackObject=r.createTransformFeedback()),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.transformFeedbackObject);const s=e.paint.get("raster-particle-max-speed"),a=n*e.paint.get("raster-particle-speed-factor")*.3,l=(c=e.paint.get("raster-particle-reset-rate-factor"),Math.pow(c,6));var c;for(const n of i){const[,i,o]=n;i.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE);const c=Vr(0,i.texture.size,s,a,l,i.textureOffset,i.scale,i.offset);t.getOrCreateProgram("rasterParticleUpdate",{defines:i.defines,transformFeedback:{bufferMode:r.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(t,r.POINTS,Ae.disabled,Le.disabled,De.disabled,Oe.disabled,c,e.id,o.particleVertices0,void 0,o.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:o.particleVertices1,targetIndex:0}])}r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null)}(e,n,l,u)}(e,i,n,r),"translucent"===e.renderPass&&(function(e,i,n,r,o){const s=e.context,a=s.gl,l=!e.options.moving,c="globe"===e.transform.projection.name;if(!r.length)return;const[u,h]=e.stencilConfigForOverlap(r),d=[];c&&d.push("PROJECTION_GLOBE_VIEW");for(const r of h){const o=r.toUnwrapped(),h=i.getTile(r);if(!h.rasterParticleState)continue;const p=h.rasterParticleState,f=100;h.registerFadeDuration(f);const m=i.findLoadedParent(r,0),g=pr(h,m,i,e.transform,f);let _,y;e.terrain&&e.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),p.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),m&&m.rasterParticleState?(m.rasterParticleState.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),_=Math.pow(2,m.tileID.overscaledZ-h.tileID.overscaledZ),y=[h.tileID.canonical.x*_%1,h.tileID.canonical.y*_%1]):p.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const v=c?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(o,l),x=e.transform,b=xo(x),w=t.cf(r.canonical),E=t.cg(w.getCenter().lat);let S,T,M,I,C;c?(S=Float32Array.from(t.aT(t.ci(r.canonical))),T=Float32Array.from(x.globeMatrix),M=Float32Array.from(t.ce(x)),I=[t.a5(x.center.lng),t.ae(x.center.lat)],C=Float32Array.from(t.ch(r.canonical,w,E,x.worldSize/x._pixelsPerMercatorPixel))):(S=new Float32Array(16),T=new Float32Array(9),M=new Float32Array(16),I=[0,0],C=new Float32Array(9));const A=Br(v,S,T,M,C,y||[0,0],t.S(e.transform.zoom),I,b,_||1,g,250),P=e.isTileAffectedByFog(r),L=e.getOrCreateProgram("rasterParticle",{defines:d,overrideFog:P});if(e.uploadCommonUniforms(s,L,o),c){const t=new Ae(a.LEQUAL,Ae.ReadWrite,e.depthRangeFor3D),i=0,r=e.globeSharedBuffers;if(r){const[o,s,l]=r.getGridBuffers(E,0!==i);L.draw(e,a.TRIANGLES,t,Le.disabled,De.alphaBlended,Oe.backCCW,A,n.id,o,s,l)}}else{const t=e.depthModeForSublayer(0,Ae.ReadOnly),i=u[r.overscaledZ],{tileBoundsBuffer:o,tileBoundsIndexBuffer:s,tileBoundsSegments:l}=e.getTileBoundsBuffers(h);L.draw(e,a.TRIANGLES,t,i,De.alphaBlended,Oe.disabled,A,n.id,o,s,l)}}e.resetStencilClippingMasks()}(e,i,n,r),e.style.map.triggerRepaint())},background:function(t,e,i,n){const r=i.paint.get("background-color"),o=i.paint.get("background-opacity"),s=i.paint.get("background-emissive-strength");if(0===o)return;const a=t.context,l=a.gl,c=t.transform,u=c.tileSize,h=i.paint.get("background-pattern");if(t.isPatternMissing(h,i.scope))return;const d=!h&&1===r.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==d)return;const p=Le.disabled,f=t.depthModeForSublayer(0,"opaque"===d?Ae.ReadWrite:Ae.ReadOnly),m=t.colorModeForDrapableLayerRenderPass(s),g=h?"backgroundPattern":"background";let _,y=n;y||(_=t.getBackgroundTiles(),y=Object.values(_).map((t=>t.tileID))),h&&(a.activeTexture.set(l.TEXTURE0),t.imageManager.bind(t.context,i.scope));for(const d of y){const y=t.isTileAffectedByFog(d),v=t.getOrCreateProgram(g,{overrideFog:y}),x=d.toUnwrapped(),b=n?d.projMatrix:t.transform.calculateProjMatrix(x);t.prepareDrawTile();const w=e?e.getTile(d):_?_[d.key]:new Ve(d,u,c.zoom,t),E=h?Xr(b,s,o,t,h,i.scope,{tileID:d,tileSize:u}):qr(b,s,o,r);t.uploadCommonUniforms(a,v,x);const{tileBoundsBuffer:S,tileBoundsIndexBuffer:T,tileBoundsSegments:M}=t.getTileBoundsBuffers(w);v.draw(t,l.TRIANGLES,f,p,m,Oe.disabled,E,i.id,S,T,M)}},sky:function(e,i,n){const r=e._atmosphere?t.S(e.transform.zoom):1,o=n.paint.get("sky-opacity")*r;if(0===o)return;const s=e.context,a=n.paint.get("sky-type"),l=new Ae(s.gl.LEQUAL,Ae.ReadOnly,[0,1]),c=e.frameCounter/1e3%1;"atmosphere"===a?"offscreen"===e.renderPass?n.needsSkyboxCapture(e)&&(function(e,i,n,r){const o=e.context,s=o.gl;let a=i.skyboxFbo;if(!a){a=i.skyboxFbo=o.createFramebuffer(32,32,!0,null),i.skyboxGeometry=new Do(o),i.skyboxTexture=o.gl.createTexture(),s.bindTexture(s.TEXTURE_CUBE_MAP,i.skyboxTexture),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR);for(let t=0;t<6;++t)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,s.RGBA,32,32,0,s.RGBA,s.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(a.framebuffer),o.viewport.set([0,0,32,32]);const l=i.getCenter(e,!0),c=e.getOrCreateProgram("skyboxCapture"),u=new Float64Array(16);t.a6.identity(u),t.a6.rotateY(u,u,.5*-Math.PI),ko(e,i,c,u,l,0),t.a6.identity(u),t.a6.rotateY(u,u,.5*Math.PI),ko(e,i,c,u,l,1),t.a6.identity(u),t.a6.rotateX(u,u,.5*-Math.PI),ko(e,i,c,u,l,2),t.a6.identity(u),t.a6.rotateX(u,u,.5*Math.PI),ko(e,i,c,u,l,3),t.a6.identity(u),ko(e,i,c,u,l,4),t.a6.identity(u),t.a6.rotateY(u,u,Math.PI),ko(e,i,c,u,l,5),o.viewport.set([0,0,e.width,e.height])}(e,n),n.markSkyboxValid(e)):"sky"===e.renderPass&&function(t,e,i,n,r){const o=t.context,s=o.gl,a=t.transform,l=t.getOrCreateProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,e.skyboxTexture);const c=((t,e,i,n,r)=>({u_matrix:t,u_sun_direction:e,u_cubemap:0,u_opacity:n,u_temporal_offset:r}))(a.skyboxMatrix,e.getCenter(t,!1),0,n,r);t.uploadCommonUniforms(o,l),l.draw(t,s.TRIANGLES,i,Le.disabled,t.colorModeForRenderPass(),Oe.backCW,c,"skybox",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}(e,n,l,o,c):"gradient"===a&&"sky"===e.renderPass&&function(e,i,n,r,o){const s=e.context,a=s.gl,l=e.transform,c=e.getOrCreateProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new Do(s)),s.activeTexture.set(a.TEXTURE0);let u=i.colorRampTexture;u||(u=i.colorRampTexture=new t.T(s,i.colorRamp,a.RGBA)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((e,i,n,r,o)=>({u_matrix:e,u_color_ramp:0,u_center_direction:i,u_radius:t.bj(n),u_opacity:r,u_temporal_offset:o}))(l.skyboxMatrix,i.getCenter(e,!1),i.paint.get("sky-gradient-radius"),r,o);e.uploadCommonUniforms(s,c),c.draw(e,a.TRIANGLES,n,Le.disabled,e.colorModeForRenderPass(),Oe.backCW,h,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(e,n,l,o,c)},debug:function(e,i,n,r,o,s){for(let a=0;a<n.length;a++)if(o){const o=1,l=.8,c=new t.ax(r.r*l,r.g*l,r.b*l,1);Mo(e,i,n[a],r,-o,-o,s),Mo(e,i,n[a],r,-o,o,s),Mo(e,i,n[a],r,o,o,s),Mo(e,i,n[a],r,o,-o,s),Mo(e,i,n[a],c,0,0,s)}else Mo(e,i,n[a],r,0,0,s)},custom:function(e,i,n,r){const o=e.context,s=n.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&n.isLayerDraped(i)){if("offscreen"===e.renderPass){const i=s.prerender;if(i){if(e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const n=e.transform.pointMerc;i.call(s,o.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),t.S(e.transform.zoom),[n.x,n.y],e.transform.pixelsPerMeterRatio)}else i.call(s,o.gl,e.transform.customLayerMatrix());o.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass){if(e.terrain&&e.terrain.renderingToTexture){const i=s.renderToTile;if(i){const n=r[0].canonical,a=new t.L(n.x+r[0].wrap*(1<<n.z),n.y,n.z);o.setDepthMode(Ae.disabled),o.setStencilMode(Le.disabled),o.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),i.call(s,o.gl,a),o.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),o.setStencilMode(Le.disabled);const i="3d"===s.renderingMode?new Ae(e.context.gl.LEQUAL,Ae.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,Ae.ReadOnly);if(o.setDepthMode(i),"globe"===e.transform.projection.name){const i=e.transform.pointMerc;s.render(o.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),t.S(e.transform.zoom),[i.x,i.y],e.transform.pixelsPerMeterRatio)}else s.render(o.gl,e.transform.customLayerMatrix());o.setDirty(),e.setBaseState(),o.bindFramebuffer.set(null)}}else t.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,i,n,r){if("opaque"===e.renderPass)return;const o=n.paint.get("model-opacity");if(0===o)return;const s=n.paint.get("model-cast-shadows");if("shadow"===e.renderPass){if(!s)return;if(e.terrain&&o<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof t.Z)return}const a=e.shadowRenderer,l=n.paint.get("model-receive-shadows");a&&(a.useNormalOffset=!0,l||(a.enabled=!1));const c=()=>{a&&(a.useNormalOffset=!0,l||(a.enabled=!0))},u=i.getSource();if("light-beam"===e.renderPass&&"batched-model"!==u.type)return;if("vector"===u.type||"geojson"===u.type)return function(e,i,n,r){const o=e.transform;if("mercator"!==o.projection.name)return void t.w(`Drawing 3D models for ${o.projection.name} projection is not yet implemented`);const s=o.getFreeCameraOptions().position;if(!e.modelManager)return;const a=e.modelManager;n.modelManager=a;const l=e.shadowRenderer;if(!n._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const c=n._unevaluatedLayout._values["model-id"],u={...n.layout.get("model-id").parameters};for(const h of r){const r=i.getTile(h).getBucket(n);if(!r||r.projection.name!==o.projection.name)continue;const d=Xo(h,o);u.zoom=d;const p=c.possiblyEvaluate(u);if(Wo(e,r,h),qo.shadowUniformsInitialized=!1,qo.useSingleShadowCascade=!!l&&0===l.getMaxCascadeForTile(h.toUnwrapped()),"shadow"===e.renderPass&&l){if(1===e.currentShadowCascade&&r.isInsideFirstShadowMapFrustum)continue;const i=o.calculatePosMatrix(h.toUnwrapped(),o.worldSize);if(qo.tileMatrix.set(i),qo.shadowTileMatrix=Float32Array.from(l.calculateShadowPassMatrixFromMatrix(i)),qo.aabb.min.fill(0),qo.aabb.max[0]=qo.aabb.max[1]=t.V,qo.aabb.max[2]=0,Zo(r,qo,e,n.scope))continue}const f=1<<h.canonical.z,m=[((s.x-h.wrap)*f-h.canonical.x)*t.V,(s.y*f-h.canonical.y)*t.V,s.z*f*t.V];for(let t in r.instancesPerModel){const i=r.instancesPerModel[t];i.features.length>0&&(t=p.evaluate(i.features[0].feature,{}));const o=a.getModel(t,n.scope);if(o&&o.uploaded)for(const t of o.nodes)$o(e,n,t,i,m,h,qo)}}}(e,i,n,r),void c();if(!u.loaded())return;if("batched-model"===u.type)return function(e,i,n,r){n.resetLayerRenderingStats(e);const o=e.context,s=e.transform,a=e.style.fog,l=e.shadowRenderer;if("mercator"!==s.projection.name)return void t.w(`Drawing 3D landmark models for ${s.projection.name} projection is not yet implemented`);const c=e.transform.getFreeCameraOptions().position,u=t.N.scale([],[c.x,c.y,c.z],e.transform.worldSize);t.N.negate(u,u);const h=t.a6.identity([]),d=t.cR(s.center.lat,s.zoom),p=t.a6.fromScaling([],[1,1,1/d]);t.a6.translate(h,h,u);const f=n.paint.get("model-opacity"),m=new Ae(o.gl.LEQUAL,Ae.ReadWrite,e.depthRangeFor3D),g=new Ae(o.gl.LEQUAL,Ae.ReadOnly,e.depthRangeFor3D),_=new t.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),y="shadow"===e.renderPass,v=y&&l?l.getCurrentCascadeFrustum():s.getFrustum(s.scaleZoom(s.worldSize)),x=n.getLayerRenderingStats(),b=function(c,u){for(const d of r){const r=i.getTile(d).getBucket(n);if(!r||!r.uploaded)continue;let b=!1;l&&(b=0===l.getMaxCascadeForTile(d.toUnwrapped()));const w=s.calculatePosMatrix(d.toUnwrapped(),s.worldSize),E=r.modelTraits;for(const i of r.getNodesInfo()){if(i.hiddenByReplacement)continue;if(!i.node.meshes)continue;const r=i.evaluatedScale,S=i.node;let T=0;if(e.terrain&&S.elevation&&(T=S.elevation*e.terrain.exaggeration()),r[0]<=1&&r[1]<=1&&r[2]<=1&&0===(()=>{const e=i.getLocalBounds();return _.min=[...e.min],_.max=[...e.max],_.min[2]+=T,_.max[2]+=T,t.N.transformMat4(_.min,_.min,w),t.N.transformMat4(_.max,_.max,w),_})().intersects(v))continue;const M="light-beam"===e.renderPass,I=[...w];t.a6.translate(I,I,[(S.anchor?S.anchor[0]:0)*(r[0]-1),(S.anchor?S.anchor[1]:0)*(r[1]-1),T]),t.N.exactEquals(r,t.cT)||t.a6.scale(I,I,r),t.a6.multiply(I,I,S.matrix);const C=t.a6.multiply([],p,I);t.a6.multiply(C,h,C);const A=t.a6.invert([],C);t.a6.transpose(A,A),t.a6.scale(A,A,Yo);const P=t.a6.multiply([],s.expandedFarZProjMatrix,I),L=E&t.cV.HasMapboxMeshFeatures,R=L?0:i.evaluatedRMEA[0][2];for(let t=0;t<S.meshes.length;++t){const r=S.meshes[t],h=t===S.lightMeshIndex;if(h){if(!M&&!e.terrain&&e.shadowRenderer){e.currentLayer<e.firstLightBeamLayer&&(e.firstLightBeamLayer=e.currentLayer);continue}}else if(M)continue;const p={defines:[]},_=[];if(Vo(p.defines,_,r,e),L||p.defines.push("DIFFUSE_SHADED"),b&&p.defines.push("SHADOWS_SINGLE_CASCADE"),x&&(y?x.numRenderedVerticesInShadowPass+=r.vertexArray.length:x.numRenderedVerticesInTransparentPass+=r.vertexArray.length),y){Ho(r,I,e,n);continue}let v=null;if(a){const t=Uo(I,e.transform);if(v=new Float32Array(t),"globe"!==s.projection.name){const e=r.aabb.min,i=r.aabb.max,[n,o]=a.getOpacityForBounds(t,e[0],e[1],i[0],i[1]);p.overrideFog=n>=gt||o>=gt}}const w=r.material;let E;w.occlusionTexture&&w.occlusionTexture.offsetScale&&(E=w.occlusionTexture.offsetScale,p.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!y&&l&&(l.useNormalOffset=!!r.normalBuffer);const T=e.getOrCreateProgram("model",p);!y&&l&&l.setupShadowsFromMatrix(I,T,l.useNormalOffset),e.uploadCommonUniforms(o,T,d.toUnwrapped(),v);const D=w.pbrMetallicRoughness;D.metallicFactor=.9,D.roughnessFactor=.5;const k=$r(new Float32Array(P),new Float32Array(C),new Float32Array(A),e,f,D.baseColorFactor,w.emissiveFactor,D.metallicFactor,D.roughnessFactor,w,R,n,[0,0,0],E);T.draw(e,o.gl.TRIANGLES,u&&!h?m:g,Le.disabled,c?h||f<1||i.hasTranslucentParts?De.alphaBlended:De.unblended:De.disabled,Oe.backCCW,k,n.id,r.vertexBuffer,r.indexBuffer,r.segments,n.paint,e.transform.zoom,void 0,_)}}}};(function(t,e,i,n){const r=t.terrain?t.terrain.exaggeration():0,o=t.transform.zoom;for(const s of n){const n=e.getTile(s).getBucket(i);n&&(t.conflationActive&&n.updateReplacement(s,t.replacementSource),n.evaluateScale(t,i),t.terrain&&r>0&&n.elevationUpdate(t.terrain,r,s,i.source),n.needsReEvaluation(t,o,i)&&n.evaluate(i))}})(e,i,n,r),1===f?b(!0,!0):(b(!1,!0),b(!0,!1))}(e,i,n,r),void c();const h=u.getModels(),d=[],p=e.transform.getFreeCameraOptions().position,f=t.N.scale([],[p.x,p.y,p.z],e.transform.worldSize);t.N.negate(f,f);const m=[],g=[];let _=0;for(const i of h){const r=n.paint.get("model-rotation").constantOr(null),o=n.paint.get("model-scale").constantOr(null),s=n.paint.get("model-translation").constantOr(null);i.computeModelMatrix(e,r,o,s,!0,!0,!1);const a=t.a6.identity([]),l=t.cR(i.position.lat,e.transform.zoom),c=t.a6.fromScaling([],[1,1,1/l]);t.a6.translate(a,a,f),d.push({zScaleMatrix:c,negCameraPosMatrix:a});for(const t of i.nodes)Go(e.transform,t,i.matrix,e.transform.expandedFarZProjMatrix,_,m,g);_++}if(m.sort(((t,e)=>e.depth-t.depth)),"shadow"!==e.renderPass){if(1===o)for(const t of g)jo(t,e,n,d[t.modelIndex],Le.disabled,e.colorModeForRenderPass());else{for(const t of g)jo(t,e,n,d[t.modelIndex],Le.disabled,De.disabled);for(const t of g)jo(t,e,n,d[t.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(const t of m)jo(t,e,n,d[t.modelIndex],Le.disabled,e.colorModeForRenderPass());c()}else{for(const t of g)Ho(t.mesh,t.nodeModelMatrix,e,n);for(const t of m)Ho(t.mesh,t.nodeModelMatrix,e,n);c()}}},es={model:function(t,e,i){const n=t.scope,r=e.getSource();if(!r.loaded())return;if("vector"===r.type||"geojson"===r.type)return void(i.modelManager&&i.modelManager.upload(i,n));if("batched-model"===r.type)return;const o=r.getModels();for(const t of o)t.upload(i.context)},raster:function(t,e,i){const n=e.getSource();if(!(n instanceof kt&&n.loaded()))return;const r=t.sourceLayer||n.rasterLayerIds&&n.rasterLayerIds[0];if(!r)return;const o=t.paint.get("raster-array-band")||n.getInitialBand(r);if(null==o)return;const s=e.getIds().map((t=>e.getTileByID(t)));for(const t of s)t.updateNeeded(r,o)&&n.prepareTile(t,r,o)},"raster-particle":function(t,e,i){const n=e.getSource();if(!(n instanceof kt&&n.loaded()))return;const r=t.sourceLayer||n.rasterLayerIds&&n.rasterLayerIds[0];if(!r)return;const o=t.paint.get("raster-particle-array-band")||n.getInitialBand(r);if(null==o)return;const s=e.getIds().map((t=>e.getTileByID(t)));for(const t of s)t.updateNeeded(r,o)&&n.prepareTile(t,r,o)}};class is{constructor(e,i,n,r){this.context=new Fe(e,i),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=r,this._debugParams={showTerrainProxyTiles:!1},r.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),this.setup(),this.numSublayers=Ze.maxUnderzooming+Ze.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new t.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new wn(this),this._wireframeDebugCache=new Jo,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(t,e){const i=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new _r(this,t));const n=this._terrain;this.transform.elevation=i?n:null,n.update(t,this.transform,e),this.transform.elevation&&!n.enabled&&(this.transform.elevation=null)}_updateFog(t){const e=t.fog;if(!e||"globe"===this.transform.projection.name||e.getOpacity(this.transform.pitch)<1||e.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,n]=e.getFovAdjustedRange(this.transform._fov);if(i>n)return void(this.transform.fogCullDistSq=null);const r=i+.78*(n-i);this.transform.fogCullDistSq=r*r}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,i){if(this.width=e*t.f.devicePixelRatio,this.height=i*t.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style.order)this.style._mergedLayers[t].resize()}setup(){const e=this.context,i=new t.aN;i.emplaceBack(0,0),i.emplaceBack(t.V,0),i.emplaceBack(0,t.V),i.emplaceBack(t.V,t.V),this.tileExtentBuffer=e.createVertexBuffer(i,t.aP.members),this.tileExtentSegments=t.aB.simpleSegment(0,0,4,2);const n=new t.aN;n.emplaceBack(0,0),n.emplaceBack(t.V,0),n.emplaceBack(0,t.V),n.emplaceBack(t.V,t.V),this.debugBuffer=e.createVertexBuffer(n,t.aP.members),this.debugSegments=t.aB.simpleSegment(0,0,4,5);const r=new t.aN;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(-1,1),r.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(r,t.aP.members),this.viewportSegments=t.aB.simpleSegment(0,0,4,2);const o=new t.av;o.emplaceBack(0,0,0,0),o.emplaceBack(t.V,0,t.V,0),o.emplaceBack(0,t.V,0,t.V),o.emplaceBack(t.V,t.V,t.V,t.V),this.mercatorBoundsBuffer=e.createVertexBuffer(o,t.aR.members),this.mercatorBoundsSegments=t.aB.simpleSegment(0,0,4,2);const s=new t.aw;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);const a=new t.aO;for(const t of[0,1,3,2,0])a.emplaceBack(t);this.debugIndexBuffer=e.createIndexBuffer(a),this.emptyTexture=new t.T(e,new t.h({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=t.a6.create();const l=this.context.gl;this.stencilClearMode=new Le({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Ae.disabled,this.stencilClearMode,De.disabled,Oe.disabled,dr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,e,i){if(!e||this.currentStencilSource===e.id||!t.isTileClipped()||!i||0===i.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let t=!1;for(const e of i)if(void 0===this._tileClippingMaskIDs[e.key]){t=!0;break}if(!t)return}this.currentStencilSource=e.id;const n=this.context,r=n.gl;this.nextStencilID+i.length>256&&this.clearStencil(),n.setColorMode(De.disabled),n.setDepthMode(Ae.disabled);const o=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of i){const i=e.getTile(t),n=this._tileClippingMaskIDs[t.key]=this.nextStencilID++,{tileBoundsBuffer:s,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=this.getTileBoundsBuffers(i);o.draw(this,r.TRIANGLES,Ae.disabled,new Le({func:r.ALWAYS,mask:0},n,255,r.KEEP,r.KEEP,r.REPLACE),De.disabled,Oe.disabled,dr(t.projMatrix),"$clipping",s,a,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,e=this.context.gl;return new Le({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const e=this.context.gl;return new Le({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)}stencilConfigForOverlap(t){const e=this.context.gl,i=t.sort(((t,e)=>e.overscaledZ-t.overscaledZ)),n=i[i.length-1].overscaledZ,r=i[0].overscaledZ-n+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const t={};for(let i=0;i<r;i++)t[i+n]=new Le({func:e.GEQUAL,mask:255},i+this.nextStencilID,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID+=r,[t,i]}return[{[n]:Le.disabled},i]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new De([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new t.ax(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?De.unblended:De.alphaBlended}colorModeForDrapableLayerRenderPass(e){const i=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new De([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new t.ax(0,0,0,void 0===e?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,e,i,n=!1){if(!this.opaquePassEnabledForLayer()&&!n)return Ae.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ae(i||this.context.gl.LEQUAL,e,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){this._wireframeDebugCache.update(this.frameCounter),this.style=e,this.options=i;const n=this.style._mergedLayers,r=this.style.order,o=r.map((t=>n[t])),s=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.f.now()),this.imageManager.beginFrame();let a=0,l=!1;for(const t in s){const e=s[t];e.used&&(e.prepare(this.context),e.getSource().usedInConflation&&++a)}for(const t of o)t.isHidden(this.transform.zoom)||this.prepareLayer(t);const c={},u={},h={},d={},p={};for(const t in s){const e=s[t];c[t]=e.getVisibleCoordinates(),u[t]=c[t].slice().reverse(),h[t]=e.getVisibleCoordinates(!0).reverse(),d[t]=e.getShadowCasterCoordinates(),p[t]=e.sortCoordinatesByDistance(c[t])}const f=t=>{const e=this.style.getLayerSourceCache(t);return e&&e.used?e.getSource():null};if(a){const t=[];for(const e of o)this.layerUsedInConflation(e,f(e))&&t.push(e);if(t&&t.length>1){const e=[];for(const i of t){const t=this.style.getLayerSourceCache(i);t&&t.used&&t.getSource().usedInConflation&&e.push({layer:i.fqid,cache:t})}this.replacementSource.setSources(e),l=!0}}l||this.replacementSource.clear(),this.conflationActive=l,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const t of o){const e=t.cutoffRange();if(this.longestCutoffRange=Math.max(e,this.longestCutoffRange),e>0){const e=f(t);e&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom)),t.minzoom&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let t=0;t<o.length;t++)if(o[t].is3D()){this.opaquePassCutoff=t;break}const m=this.style&&this.style.fog;m?(this._fogVisible=0!==m.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=m.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(h),this.opaquePassCutoff=0);const g=this._shadowRenderer;if(g){g.updateShadowParameters(this.transform,this.style.directionalLight);for(const t in s)for(const e of c[t]){let t={min:0,max:0};this.terrain&&(t=this.terrain.getMinMaxForTile(e)||t),g.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new t.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Bo(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!t.cZ(this.context.gl))return;this.renderPass="offscreen";for(const t of o){const i=e.getLayerSourceCache(t);if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const n=i?u[i.id]:void 0;("custom"===t.type||"raster"===t.type||"raster-particle"===t.type||t.isSky()||n&&n.length)&&this.renderLayer(this,i,t,n)}this.depthRangeFor3D=[0,1-(o.length+2)*this.numSublayers*this.depthEpsilon];const _=this.terrain;_&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&_.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,d)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const y="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),v=(()=>{if(i.showOverdrawInspector)return t.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!y){const e=this.style.fog.properties.get("color").toArray01();return new t.ax(...e)}if(this.style.fog&&this.transform.projection.supportsFog&&y){const e=this.style.fog.properties.get("space-color").toArray01();return new t.ax(...e)}return t.ax.transparent})();if(this.context.clear({color:v,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const t=o[this.currentLayer],i=e.getLayerSourceCache(t);if(t.isSky())continue;const n=i?(t.is3D()?p:u)[i.id]:void 0;this._renderTileClippingMasks(t,i,n),this.renderLayer(this,i,t,n)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||t.S(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const t=o[this.currentLayer],i=e.getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,i,t,i?u[i.id]:void 0)}function x(t,e){let i;return e&&(i=("symbol"===t.type?h:t.is3D()?p:u)[e.id]),i}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<r.length;){const t=o[this.currentLayer];if("raster"===t.type){const i=e.getLayerSourceCache(t);this.renderLayer(this,i,t,x(t,i))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let b=0;for(g&&(b=g.getShadowCastingLayerCount());this.currentLayer<r.length;){const t=o[this.currentLayer],i=e.getLayerSourceCache(t);if(t.isSky())++this.currentLayer;else if(_&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=_.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(t,i,i?c[i.id]:void 0),this.renderLayer(this,i,t,x(t,i)),!_&&g&&b>0&&t.hasShadowPass()&&0==--b&&(g.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const t=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=t;this.currentLayer++){const t=o[this.currentLayer];if(!t.hasLightBeamPass())continue;const i=e.getLayerSourceCache(t);this.renderLayer(this,i,t,i?u[i.id]:void 0)}this.currentLayer=t,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let i=null;o.forEach((t=>{const n=e.getLayerSourceCache(t);n&&!t.isHidden(this.transform.zoom)&&n.getVisibleCoordinates().length&&(!i||i.getSource().maxzoom<n.getSource().maxzoom)&&(i=n)})),i&&this.options.showTileBoundaries&&ts.debug(this,i,i.getVisibleCoordinates(),t.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ts.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new t.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(t){const e=t.transform.padding;Io(t,t.transform.height-(e.top||0),3,bo),Io(t,e.bottom||0,3,wo),Co(t,e.left||0,3,Eo),Co(t,t.transform.width-(e.right||0),3,So);const i=t.transform.centerPoint;!function(t,e,i,n){Ao(t,e-1,i-10,2,20,n),Ao(t,e-10,i-1,20,2,n)}(t,i.x,t.transform.height-i.y,To)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),l||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:e}=this.transform.projection,i=!e||!e.includes(t.type);if(es[t.type]&&(i||this.terrain&&"custom"===t.type)){const e=this.style.getLayerSourceCache(t);es[t.type](t,e,this)}this.gpuTimingEnd()}renderLayer(t,e,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||"raster-particle"===i.type||n&&n.length)&&(this.id=i.id,this.gpuTimingStart(i),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(i.type)||t.terrain&&"custom"===i.type)&&ts[i.type](t,e,i,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery,i=this.context.gl;let n=this.gpuTimers[t.id];n||(n=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:i.createQuery()}),n.calls++,i.beginQuery(e.TIME_ELAPSED_EXT,n.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,e=this.context.gl,i=e.createQuery();this.deferredRenderGpuTimeQueries.push(i),e.beginQuery(t.TIME_ELAPSED_EXT,i)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const e={};for(const i in t){const n=t[i],r=this.context.extTimerQuery,o=r.getQueryParameter(n.query,this.context.gl.QUERY_RESULT)/1e6;r.deleteQueryEXT(n.query),e[i]=o}return e}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const e=this.context.extTimerQuery,i=this.context.gl;let n=0;for(const r of t)n+=e.getQueryParameter(r,i.QUERY_RESULT)/1e6,e.deleteQueryEXT(r);return n}translatePosMatrix(e,i,n,r,o){if(!n[0]&&!n[1])return e;const s=o?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(s){const t=Math.sin(s),e=Math.cos(s);n=[n[0]*e-n[1]*t,n[0]*t+n[1]*e]}const a=[o?n[0]:t.a3(i,n[0],this.transform.zoom),o?n[1]:t.a3(i,n[1],this.transform.zoom),0],l=new Float32Array(16);return t.a6.translate(l,e,a),l}saveTileTexture(t){const e=t.size[0],i=this._tileTextures[e];i?i.push(t):this._tileTextures[e]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t,e){return null===t||void 0!==t&&!this.imageManager.getPattern(t.toString(),e)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(t,e,i){const n=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,r=this.terrain&&0===this.terrain.exaggeration(),o=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===t||"terrainRaster"===t?(o.push("LIGHTING_3D_MODE"),o.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):n||o.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||o.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?o.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):o.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(o.push("TERRAIN"),this.linearFloatFilteringSupported()&&o.push("TERRAIN_DEM_FLOAT_FORMAT"),r&&o.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&o.push("GLOBE"),!this._fogVisible||n||void 0!==e&&!e||o.push("FOG","FOG_DITHERING"),n&&o.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&o.push("OVERDRAW_INSPECTOR"),o}getOrCreateProgram(t,e){this.cache=this.cache||{};const i=e&&e.defines||[],n=e&&e.config,r=e&&e.transformFeedback,o=this.currentGlobalDefines(t,e&&e.overrideFog,e&&e.overrideRtt).concat(i),s=br.cacheKey(Zn[t],t,o,n);return this.cache[s]||(this.cache[s]=new br(this.context,t,Zn[t],n,Kr[t],o,r)),this.cache[s]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,i){if(this.style.enable3dLights()){const n=this.style.directionalLight,r=this.style.ambientLight;if(n&&r){const o=((e,i)=>{const n=e.properties.get("direction"),r=e.properties.get("color").toArray01(),o=e.properties.get("intensity"),s=i.properties.get("color").toArray01(),a=i.properties.get("intensity"),l=[n.x,n.y,n.z],c=t.cn(s,a),u=t.cn(r,o);return{u_lighting_ambient_color:c,u_lighting_directional_dir:l,u_lighting_directional_color:u,u_ground_radiance:yr(l,u,c)}})(n,r);i.setLightsUniformValues(e,o)}}}uploadCommonUniforms(e,i,n,r,o){if(this.uploadCommonLightUniforms(e,i),this.terrain&&this.terrain.renderingToTexture)return;const s=this.style.fog;if(s){const o=s.getOpacity(this.transform.pitch),a=((e,i,n,r,o,s,a,l,c,u,h,d)=>{const p=e.transform,f=i.properties.get("color").toArray01();f[3]=r;const m=e.frameCounter/1e3%1,[g,_]=i.properties.get("vertical-range");return{u_fog_matrix:n?p.calculateFogTileMatrix(n):d||e.identityMat,u_fog_range:i.getFovAdjustedRange(p._fov),u_fog_color:f,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(g,_),_],u_fog_temporal_offset:m,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:t.S(p.zoom),u_is_globe:+("globe"===p.projection.name)}})(this,s,n,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.f.devicePixelRatio,this.transform.height*t.f.devicePixelRatio],r);i.setFogUniformValues(e,a)}o&&i.setCutoffUniformValues(e,o.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,e=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(const n of i)e[n.key]=t[n.key]||new Ve(n,512,this.transform.tileZoom,this);return e}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(t,e){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||"building"!==t.sourceLayer&&(!e||"batched-model"!==e.type))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let e=this._cachedTileFogOpacities[t.key];return e||(this._cachedTileFogOpacities[t.key]=e=this.style.fog.getOpacityForTile(t)),e[0]>=gt||e[1]>=gt}}function ns(t,e){let i=!1,n=null;const r=()=>{n=null,i&&(t(),n=setTimeout(r,e),i=!1)};return()=>(i=!0,n||r(),n)}class rs{constructor(e){this._hashName=e&&encodeURIComponent(e),t.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ns(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const e=os(t);if(this._hashName){const t=this._hashName;let i=!1;const n=location.hash.slice(1).split("&").map((n=>{const r=n.split("=")[0];return r===t?(i=!0,`${r}=${e}`):n})).filter((t=>t));return i||n.push(`${t}=${e}`),`#${n.join("&")}`}return`#${e}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((t=>t.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const e=this._getCurrentHash();if(e.length>=3&&!e.some((t=>isNaN(t)))){const i=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(e[3]||0):t.getBearing();return t.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:i,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function os(t,e){const i=t.getCenter(),n=Math.round(100*t.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,r),s=Math.round(i.lng*o)/o,a=Math.round(i.lat*o)/o,l=t.getBearing(),c=t.getPitch();let u=e?`/${s}/${a}/${n}`:`${n}/${a}/${s}`;return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),u}const ss={linearity:.3,easing:t.c_(0,0,.3,1)},as=t.e({deceleration:2500,maxSpeed:1400},ss),ls=t.e({deceleration:20,maxSpeed:1400},ss),cs=t.e({deceleration:1e3,maxSpeed:360},ss),us=t.e({deceleration:1e3,maxSpeed:90},ss);class hs{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.f.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=t.f.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)i.zoom+=t.zoomDelta||0,i.bearing+=t.bearingDelta||0,i.pitch+=t.pitchDelta||0,t.panDelta&&i.pan._add(t.panDelta),t.around&&(i.around=t.around),t.pinchAround&&(i.pinchAround=t.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(i.pan.mag()){const o=ps(i.pan.mag(),n,t.e({},as,e||{}));r.offset=i.pan.mult(o.amount/i.pan.mag()),r.center=this._map.transform.center,ds(r,o)}if(i.zoom){const t=ps(i.zoom,n,ls);r.zoom=this._map.transform.zoom+t.amount,ds(r,t)}if(i.bearing){const e=ps(i.bearing,n,cs);r.bearing=this._map.transform.bearing+t.aa(e.amount,-179,179),ds(r,e)}if(i.pitch){const t=ps(i.pitch,n,us);r.pitch=this._map.transform.pitch+t.amount,ds(r,t)}if(r.zoom||r.bearing){const t=void 0===i.pinchAround?i.around:i.pinchAround;r.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),r.noMoveStart=!0,r}}function ds(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function ps(e,i,n){const{maxSpeed:r,linearity:o,deceleration:s}=n,a=t.aa(e*o/(i/1e3),-r,r),l=Math.abs(a)/(s*o);return{easing:n.easing,duration:1e3*l,amount:a*(l/2)}}class fs extends t.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,n,r={}){const o=f(i.getCanvasContainer(),n),s=i.unproject(o);super(e,t.e({point:o,lngLat:s,originalEvent:n},r)),this._defaultPrevented=!1,this.target=i}}class ms extends t.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,n){const r="touchend"===e?n.changedTouches:n.touches,o=m(i.getCanvasContainer(),r),s=o.map((t=>i.unproject(t))),a=o.reduce(((t,e,i,n)=>t.add(e.div(n.length))),new t.P(0,0));super(e,{points:o,point:a,lngLats:s,lngLat:i.unproject(a),originalEvent:n}),this._defaultPrevented=!1}}class gs extends t.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t,{originalEvent:i}),this._defaultPrevented=!1}}class _s{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new gs(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new fs(t.type,this._map,t))}mouseup(t){this._map.fire(new fs(t.type,this._map,t))}preclick(e){const i=t.e({},e);i.type="preclick",this._map.fire(new fs(i.type,this._map,i))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||(this.preclick(t),this._map.fire(new fs(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new fs(t.type,this._map,t))}mouseover(t){this._map.fire(new fs(t.type,this._map,t))}mouseout(t){this._map.fire(new fs(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ms(t.type,this._map,t))}touchmove(t){this._map.fire(new ms(t.type,this._map,t))}touchend(t){this._map.fire(new ms(t.type,this._map,t))}touchcancel(t){this._map.fire(new ms(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ys{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new fs(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new fs(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vs{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(u(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const i=e,n=this._startPos,r=this._lastPos;if(!n||!r||r.equals(i)||!this._box&&i.dist(n)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=o("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const s=Math.min(n.x,i.x),a=Math.max(n.x,i.x),l=Math.min(n.y,i.y),c=Math.max(n.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${s}px,${l}px)`,this._box.style.width=a-s+"px",this._box.style.height=c-l+"px")}))}mouseupWindow(e,i){if(!this._active)return;const n=this._startPos,r=i;if(n&&0===e.button){if(this.reset(),p(),n.x!==r.x||n.y!==r.y)return this._map.fire(new t.b("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(n,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new t.b(e,{originalEvent:i}))}}function xs(t,e){const i={};for(let n=0;n<t.length;n++)i[t[n].identifier]=e[n];return i}class bs{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,i,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){const i=new t.P(0,0);for(const t of e)i._add(t);return i.div(e.length)}(i),this.touches=xs(n,i)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const n=xs(i,e);for(const t in this.touches){const e=n[t];(!e||e.dist(this.touches[t])>30)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class ws{constructor(t){this.singleTap=new bs(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const n=this.singleTap.touchend(t,e,i);if(n){const e=t.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(n)<30;if(e&&i||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class Es{constructor(){this._zoomIn=new ws({numTouches:1,numTaps:2}),this._zoomOut=new ws({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const n=this._zoomIn.touchend(t,e,i),r=this._zoomOut.touchend(t,e,i);return n?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(n)},{originalEvent:t})}):r?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(r)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ss={0:1,2:2};class Ts{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){if(this._lastPoint)return;const i=g(t);this._correctButton(t,i)&&(this._lastPoint=e,this._eventButton=i)}mousemoveWindow(t,e){const i=this._lastPoint;if(i)if(t.preventDefault(),null!=this._eventButton&&function(t,e){const i=Ss[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(i,e)}mouseupWindow(t){this._lastPoint&&g(t)===this._eventButton&&(this._moved&&p(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ms extends Ts{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class Is extends Ts{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=.8*(e.x-t.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(t){t.preventDefault()}}class Cs extends Ts{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=-.5*(e.y-t.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(t){t.preventDefault()}}class As{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),t.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(e,i,n){if(this._active&&!(n.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===n.length&&!t.c$())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,i,n)}}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,n){n.length>0&&(this._active=!0);const r=xs(n,i),o=new t.P(0,0),s=new t.P(0,0);let a=0;for(const t in r){const e=r[t],i=this._touches[t];i&&(o._add(e),s._add(e.sub(i)),a++,r[t]=e)}if(this._touches=r,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Ps{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,e,i){return{}}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){const n=this._firstTwoTouches;if(!n)return;t.preventDefault();const[r,o]=n,s=Ls(i,e,r),a=Ls(i,e,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,t)}touchend(t,e,i){if(!this._firstTwoTouches)return;const[n,r]=this._firstTwoTouches,o=Ls(i,e,n),s=Ls(i,e,r);o&&s||(this._active&&p(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ls(t,e,i){for(let n=0;n<t.length;n++)if(t[n].identifier===i)return e[n]}function Rs(t,e){return Math.log(t/e)/Math.LN2}class Ds extends Ps{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Rs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Rs(this._distance,i),pinchAround:e}}}function ks(t,e){return 180*t.angleWith(e)/Math.PI}class Ns extends Ps{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const i=this._vector;if(this._vector=t[0].sub(t[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ks(this._vector,i),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const n=ks(t,i);return Math.abs(n)<e}}function Os(t){return Math.abs(t.y)>Math.abs(t.x)}class Fs extends Ps{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Os(t[0].sub(t[1]))&&(this._valid=!1)}_move(e,i,n){const r=this._lastPoints;if(!r)return;const o=e[0].sub(r[0]),s=e[1].sub(r[1]);return this._map._cooperativeGestures&&!t.c$()&&n.touches.length<3||(this._valid=this.gestureBeginsVertically(o,s,n.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(o.y+s.y)/2*-.5})}gestureBeginsVertically(t,e,i){if(void 0!==this._valid)return this._valid;const n=t.mag()>=2,r=e.mag()>=2;if(!n&&!r)return;if(!n||!r)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return Os(t)&&Os(e)&&o}}const zs={panStep:100,bearingStep:15,pitchStep:10};class Bs{constructor(){const t=zs;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,n=0,r=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?n=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Us,zoom:e?Math.round(a)+e*(t.shiftKey?2:1):a,bearing:s.getBearing()+i*this._bearingStep,pitch:s.getPitch()+n*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Us(t){return t*(2-t)}const Vs=4.000244140625,js=1/450;class Gs{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=js,t.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||t.c$()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const n=t.f.now(),r=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==i&&i%Vs==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=f(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform;"wheel"===this._type&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>Vs?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==n&&(n=1/n);const r=i(),o=Math.pow(2,r),s="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(s*n))),"wheel"===this._type&&(this._startZoom=r,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:i(),r=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&r&&o){const e=Math.min((t.f.now()-this._lastWheelEventTime)/200,1),i=o(e);s=t.U(r,n,i),e<1?this._frameId||(this._frameId=!0):a=!0}else s=n,a=!0;this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let l=s-i();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!a,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=t.d0;if(this._prevEase){const e=this._prevEase,n=(t.f.now()-e.start)/e.duration,r=e.easing(n+.01)-e.easing(n),o=.27/Math.sqrt(r*r+1e-4)*.01,s=Math.sqrt(.0729-o*o);i=t.c_(o,s,.25,1)}return this._prevEase={start:t.f.now(),duration:e,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Hs{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ws{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(t.shiftKey?-1:1),around:i.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qs{constructor(){this._tap=new ws({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,e,i){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=e[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(t,e,i))}touchmove(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const n=e[0],r=n.y-this._swipePoint.y;return this._swipePoint=n,t.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(t,e,i)}touchend(t,e,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(t,e,i)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xs{constructor(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $s{constructor(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ys{constructor(t,e,i,n){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Zs=t=>t.zoom||t.drag||t.pitch||t.rotate;class Ks extends t.b{}class Js{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,i){const n=t.N.sub([],i,e);this.radius=t.N.length(n[2]<0?t.N.div([],n,this.constants):[n[0],n[1],0])}projectRay(e){t.N.div(e,e,this.constants),t.N.normalize(e,e),t.N.mul(e,e,this.constants);const i=t.N.scale([],e,this.radius);if(i[2]>0){const e=t.N.scale([],[0,0,1],t.N.dot(i,[0,0,1])),n=t.N.scale([],t.N.normalize([],[i[0],i[1],0]),this.radius),r=t.N.add([],i,t.N.scale([],t.N.sub([],t.N.add([],n,e),i),2));i[0]=r[0],i[1]=r[1]}return i}}function Qs(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class ta{constructor(e,i){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hs(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Js,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),t.aY(["handleEvent","handleWindowEvent"],this);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[window,"blur",void 0]];for(const[t,e,i]of this._listeners){const n=t===document?this.handleWindowEvent:this.handleEvent;t.addEventListener(e,n,i)}}destroy(){for(const[t,e,i]of this._listeners){const n=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(e,n,i)}}_addDefaultHandlers(t){const e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new _s(e,t));const n=e.boxZoom=new vs(e,t);this._add("boxZoom",n);const r=new Es,o=new Ws;e.doubleClickZoom=new Hs(o,r),this._add("tapZoom",r),this._add("clickZoom",o);const s=new qs;this._add("tapDragZoom",s);const a=e.touchPitch=new Fs(e);this._add("touchPitch",a);const l=new Is(t),c=new Cs(t);e.dragRotate=new $s(t,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new Ms(t),h=new As(e,t);e.dragPan=new Xs(i,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new Ns,p=new Ds;e.touchZoomRotate=new Ys(i,p,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ys(e));const f=e.scrollZoom=new Gs(e,this);this._add("scrollZoom",f,["mousePan"]);const m=e.keyboard=new Bs;this._add("keyboard",m);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[i]&&e[i].enable(t[i])}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zs(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,e,i){for(const n in t)if(n!==i&&(!e||e.indexOf(n)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const e=[];for(const i of t)this._el.contains(i.target)&&e.push(i);return e}handleEvent(t,e){this._updatingCamera=!0;const i="renderFrame"===t.type,n=i?void 0:t,r={needsRenderFrame:!1},o={},s={},a=t.touches?this._getMapTouches(t.touches):void 0,l=a?m(this._el,a):i?void 0:f(this._el,t);for(const{handlerName:i,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;this._blockedByActive(s,u,i)?c.reset():c[e||t.type]&&(h=c[e||t.type](t,l,a),this.mergeHandlerResult(r,o,h,i,n),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||c.isActive())&&(s[i]=c)}const c={};for(const t in this._previousActiveHandlers)s[t]||(c[t]=n);this._previousActiveHandlers=s,(Object.keys(c).length||Qs(r))&&(this._changes.push([r,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||Qs(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=r;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(e,i,n,r,o){if(!n)return;t.e(e,n);const s={handlerName:r,originalEvent:n.originalEvent||o};void 0!==n.zoomDelta&&(i.zoom=s),void 0!==n.panDelta&&(i.drag=s),void 0!==n.pitchDelta&&(i.pitch=s),void 0!==n.bearingDelta&&(i.rotate=s)}_applyChanges(){const e={},i={},n={};for(const[r,o,s]of this._changes)r.panDelta&&(e.panDelta=(e.panDelta||new t.P(0,0))._add(r.panDelta)),r.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(e.around=r.around),void 0!==r.aroundCoord&&(e.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(e.pinchAround=r.pinchAround),r.noInertia&&(e.noInertia=r.noInertia),t.e(i,o),t.e(n,s);this._updateMapTransform(e,i,n),this._changes=[]}_updateMapTransform(e,i,n){const r=this._map,o=r.transform,s=t=>[t.x,t.y,t.z];if((t=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!Qs(e)){const t=o.zoom;o.cameraElevationReference="sea",null!=this._originalZoom&&o._orthographicProjectionAtLowPitch&&"globe"!==o.projection.name&&0===o.pitch?(o.cameraElevationReference="ground",o.zoom=this._originalZoom):(o.recenterOnTerrain(),o.cameraElevationReference="ground"),t!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&r._stop(!0),!Qs(e))return void this._fireEvents(i,n,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:p}=e;o._isCameraConstrained&&(l>0&&(l=0),o._isCameraConstrained=!1),void 0!==p&&(h=p),(l||(t=>i[t]&&!this._eventsInProgress[t])("drag"))&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._originalZoom=o.zoom,this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",r._stop(!0),h=h||r.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(a)if("mercator"===o.projection.name){const t=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h).dir),e=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h.sub(a)).dir);f[0]=e[0]-t[0],f[1]=e[1]-t[1]}else{const e=o.pointCoordinate(h);if("globe"===o.projection.name){a=a.rotate(-o.angle);const i=o._pixelsPerMercatorPixel/o.worldSize;f[0]=-a.x*t.d1(t.au(e.y))*i,f[1]=-a.y*t.d1(o.center.lat)*i}else{const t=o.pointCoordinate(h.sub(a));e&&t&&(f[0]=t.x-e.x,f[1]=t.y-e.y)}}const m=o.zoom,g=[0,0,0];if(l){const e=s(d||o.pointCoordinate3D(h)),i={dir:t.N.normalize([],t.N.sub([],e,o._camera.position))};if(i.dir[2]<0){const n=o.zoomDeltaToMovement(e,l);t.N.scale(g,i.dir,n)}}const _=t.N.add(f,f,g);o._translateCameraConstrained(_),l&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,n,!0)}_fireEvents(e,i,n){const r=Zs(this._eventsInProgress),o=Zs(e),s={};for(const t in e){const{originalEvent:i}=e[t];this._eventsInProgress[t]||(s[`${t}start`]=i),this._eventsInProgress[t]=e[t]}!r&&o&&this._fireEvent("movestart",o.originalEvent);for(const t in s)this._fireEvent(t,s[t]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:i}=e[t];this._fireEvent(t,i)}const a={};let l;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:n}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],l=i[e]||n,a[`${t}end`]=l)}for(const t in a)this._fireEvent(t,a[t]);const c=Zs(this._eventsInProgress);if(n&&(r||o)&&!c){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;e?(i(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:l})):(this._map.fire(new t.b("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new t.b(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new Ks("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ea="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ia extends t.E{constructor(e,i){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=!1!==i.respectPrefersReducedMotion,t.aY(["_renderFrameCallback"],this)}getCenter(){return new t.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,i,n){return e=t.P.convert(e).mult(-1),this.panTo(this.transform.center,t.e({offset:e},i),n)}panTo(e,i,n){return this.easeTo(t.e({center:e},i),n)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,i,n){return this.easeTo(t.e({zoom:e},i),n)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,i,n){return this.easeTo(t.e({bearing:e},i),n)}resetNorth(e,i){return this.rotateTo(0,t.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(t.e({bearing:0,pitch:0,duration:1e3},e),i),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(e,i){e=t.ad.convert(e);const n=i&&i.bearing||0,r=i&&i.pitch||0,o=e.getNorthWest(),s=e.getSouthEast();return this._cameraForBounds(this.transform,o,s,n,r,i)}_extendCameraOptions(e){const i={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=t.e({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const t=e.padding;e.padding={top:t,bottom:t,right:t,left:t}}return e.padding=t.e(i,e.padding),e}_minimumAABBFrustumDistance(t,e){const i=e.max[0]-e.min[0],n=e.max[1]-e.min[1];return i/n>t.aspect?i/(2*Math.tan(.5*t.fovX)*t.aspect):n/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(e,i,n,r,o,s){const a=e.clone(),l=this._extendCameraOptions(s);a.bearing=r,a.pitch=o;const c=t.bn.convert(i),u=t.bn.convert(n),h=.5*(c.lat+u.lat),d=.5*(c.lng+u.lng),p=t.d2(h,d),f=t.N.normalize([],p),m=t.N.normalize([],t.N.cross([],f,[0,1,0])),g=t.N.cross([],m,f),_=[m[0],m[1],m[2],0,g[0],g[1],g[2],0,f[0],f[1],f[2],0,0,0,0,1],y=[p,t.d2(c.lat,c.lng),t.d2(u.lat,c.lng),t.d2(u.lat,u.lng),t.d2(c.lat,u.lng),t.d2(h,c.lng),t.d2(h,u.lng),t.d2(c.lat,d),t.d2(u.lat,d)];let v=t.bS.fromPoints(y.map((e=>[t.N.dot(m,e),t.N.dot(g,e),t.N.dot(f,e)])));const x=t.N.transformMat4([],v.center,_);0===t.N.squaredLength(x)&&t.N.set(x,0,0,1),t.N.normalize(x,x),t.N.scale(x,x,t.ab),a.center=t.d3(x);const b=a.getWorldToCameraMatrix(),w=t.a6.invert(new Float64Array(16),b);v=t.bS.applyTransform(v,t.a6.multiply([],b,_)),t.N.transformMat4(x,x,b);const E=.5*(v.max[2]-v.min[2]),S=this._minimumAABBFrustumDistance(a,v),T=t.N.scale([],[0,0,1],E),M=t.N.add(T,x,T),I=S+(0===a.pitch?0:t.N.distance(x,M)),C=a.globeCenterInViewSpace,A=t.N.sub([],x,[C[0],C[1],C[2]]);t.N.normalize(A,A),t.N.scale(A,A,I);const P=t.N.add([],x,A);t.N.transformMat4(P,P,w);const L=t.d4/t.ab,R=t.N.length(P),D=t.bl(Math.max(R*L-t.d4,Number.EPSILON),0),k=Math.min(a.zoomFromMercatorZAdjusted(D),l.maxZoom);return k>.5*(t.bG+t.bx)?(a.setProjection({name:"mercator"}),a.zoom=k,this._cameraForBounds(a,i,n,r,o,s)):{center:a.center,zoom:k,bearing:r,pitch:o}}queryTerrainElevation(e,i){const n=this.transform.elevation;return n?(i=t.e({},{exaggerated:!0},i),n.getAtPoint(t.L.fromLngLat(e),null,i.exaggerated)):null}_cameraForBounds(e,i,n,r,o,s){if("globe"===e.projection.name)return this._cameraForBoundsOnGlobe(e,i,n,r,o,s);const a=e.clone(),l=this._extendCameraOptions(s),c=a.padding;a.bearing=r,a.pitch=o;const u=t.bn.convert(i),h=t.bn.convert(n),d=new t.bn(u.lng,h.lat),p=new t.bn(h.lng,u.lat),f=a.project(u),m=a.project(h),g=this.queryTerrainElevation(u),_=this.queryTerrainElevation(h),y=this.queryTerrainElevation(d),v=this.queryTerrainElevation(p),x=[[f.x,f.y,Math.min(g||0,_||0,y||0,v||0)],[m.x,m.y,Math.max(g||0,_||0,y||0,v||0)]];let b=t.bS.fromPoints(x);const w=a.getWorldToCameraMatrix(),E=t.a6.invert(new Float64Array(16),w);b=t.bS.applyTransform(b,w);const S=t.N.sub([],b.max,b.min),T=c.left||0,M=c.right||0,I=c.bottom||0,C=c.top||0,{left:A,right:P,top:L,bottom:R}=l.padding,D=.5*(T+M),k=.5*(C+I),N=Math.min(a.scaleZoom(a.scale*Math.min((a.width-(T+M+A+P))/S[0],(a.height-(I+C+R+L))/S[1])),l.maxZoom),O=a.scale/a.zoomScale(N);b=new t.bS([b.min[0]-(A+D)*O,b.min[1]-(R+k)*O,b.min[2]],[b.max[0]+(P+D)*O,b.max[1]+(L+k)*O,b.max[2]]);const F=.5*S[2],z=this._minimumAABBFrustumDistance(a,b),B=[0,0,1,0];t.a7.transformMat4(B,B,w),t.a7.normalize(B,B);const U=t.N.scale([],B,z+F),V=t.N.add([],b.center,U),j=("number"==typeof l.offset.x&&"number"==typeof l.offset.y?new t.P(l.offset.x,l.offset.y):t.P.convert(l.offset)).rotate(-t.bj(r));b.center[0]-=j.x*O,b.center[1]+=j.y*O,t.N.transformMat4(b.center,b.center,E),t.N.transformMat4(V,V,E);const G=[b.center[0],b.center[1],V[2]*a.pixelsPerMeter];t.N.scale(G,G,1/a.worldSize);const H=t.at(G[0]),W=t.au(G[1]),q=Math.min(a._zoomFromMercatorZ(G[2]),l.maxZoom),X=new t.bn(H,W);return a.mercatorFromTransition&&q<.5*(t.bG+t.bx)?(a.setProjection({name:"globe"}),a.zoom=q,this._cameraForBounds(a,i,n,r,o,s)):{center:X,zoom:q,bearing:r,pitch:o}}fitBounds(t,e,i){const n=this.cameraForBounds(t,e);return this._fitInternal(n,e,i)}fitScreenCoordinates(e,i,n,r,o){const s=t.P.convert(e),a=t.P.convert(i),l=new t.P(Math.min(s.x,a.x),Math.min(s.y,a.y)),c=new t.P(Math.max(s.x,a.x),Math.max(s.y,a.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(s,a))return this;const u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(c),d=this.transform.pointLocation3D(new t.P(l.x,c.y)),p=this.transform.pointLocation3D(new t.P(c.x,l.y)),f=[Math.min(u.lng,h.lng,d.lng,p.lng),Math.min(u.lat,h.lat,d.lat,p.lat)],m=[Math.max(u.lng,h.lng,d.lng,p.lng),Math.max(u.lat,h.lat,d.lat,p.lat)],g=r&&r.pitch?r.pitch:this.getPitch(),_=this._cameraForBounds(this.transform,f,m,n,g,r);return this._fitInternal(_,r,o)}_fitInternal(e,i,n){return e?(delete(i=t.e(e,i)).padding,i.linear?this.easeTo(i,n):this.flyTo(i,n)):this}jumpTo(e,i){this.stop();const n=e.preloadOnly?this.transform.clone():this.transform;let r=!1,o=!1,s=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=t.bn.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(o=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(s=!0,n.pitch=+e.pitch),null==e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),e.preloadOnly?(this._preloadTiles(n),this):(this.fire(new t.b("movestart",i)).fire(new t.b("move",i)),r&&this.fire(new t.b("zoomstart",i)).fire(new t.b("zoom",i)).fire(new t.b("zoomend",i)),o&&this.fire(new t.b("rotatestart",i)).fire(new t.b("rotate",i)).fire(new t.b("rotateend",i)),s&&this.fire(new t.b("pitchstart",i)).fire(new t.b("pitch",i)).fire(new t.b("pitchend",i)),this.fire(new t.b("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.w(ea),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,i){const n=this.transform;if(!n.projection.supportsFreeCamera)return t.w(ea),this;this.stop();const r=n.zoom,o=n.pitch,s=n.bearing;n.setFreeCameraOptions(e);const a=r!==n.zoom,l=o!==n.pitch,c=s!==n.bearing;return this.fire(new t.b("movestart",i)).fire(new t.b("move",i)),a&&this.fire(new t.b("zoomstart",i)).fire(new t.b("zoom",i)).fire(new t.b("zoomend",i)),c&&this.fire(new t.b("rotatestart",i)).fire(new t.b("rotate",i)).fire(new t.b("rotateend",i)),l&&this.fire(new t.b("pitchstart",i)).fire(new t.b("pitch",i)).fire(new t.b("pitchend",i)),this.fire(new t.b("moveend",i)),this}easeTo(e,i){this._stop(!1,e.easeId),(!1===(e=t.e({offset:[0,0],duration:500,easing:t.d0},e)).animate||this._prefersReducedMotion(e))&&(e.duration=0);const n=this.transform,r=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?+e.zoom:r,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:n.padding,d=t.P.convert(e.offset);let p,f,m;if("globe"===n.projection.name){const i=t.L.fromLngLat(n.center),r=d.rotate(-n.angle);i.x+=r.x/n.worldSize,i.y+=r.y/n.worldSize;const o=i.toLngLat(),s=t.bn.convert(e.center||o);this._normalizeCenter(s),p=n.centerPoint.add(r),f=new t.P(i.x,i.y).mult(n.worldSize),m=new t.P(t.a5(s.lng),t.ae(s.lat)).mult(n.worldSize).sub(f)}else{p=n.centerPoint.add(d);const i=n.pointLocation(p),r=t.bn.convert(e.center||i);this._normalizeCenter(r),f=n.project(i),m=n.project(r).sub(f)}const g=n.zoomScale(l-r);let _,y;e.around&&(_=t.bn.convert(e.around),y=n.locationPoint(_));const v=this._zooming||l!==r,x=this._rotating||o!==c,b=this._pitching||u!==s,w=!n.isPaddingEqual(h),E=n=>E=>{if(v&&(n.zoom=t.U(r,l,E)),x&&(n.bearing=t.U(o,c,E)),b&&(n.pitch=t.U(s,u,E)),w&&(n.interpolatePadding(a,h,E),p=n.centerPoint.add(d)),_)n.setLocationAtPoint(_,y);else{const t=n.zoomScale(n.zoom-r),e=l>r?Math.min(2,g):Math.max(.5,g),i=Math.pow(e,1-E),o=n.unproject(f.add(m.mult(E*i)).mult(t));n.setLocationAtPoint(n.renderWorldCopies?o.wrap():o,p)}return e.preloadOnly||this._fireMoveEvents(i),n};if(e.preloadOnly){const t=this._emulate(E,e.duration,n);return this._preloadTiles(t),this}const S={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=x,this._pitching=b,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,S),this._ease(E(n),(t=>{"sea"===n.cameraElevationReference&&n.recenterOnTerrain(),this._afterEase(i,t)}),e),this}_prepareEase(e,i,n={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),i||n.moving||this.fire(new t.b("movestart",e)),this._zooming&&!n.zooming&&this.fire(new t.b("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new t.b("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new t.b("pitchstart",e))}_fireMoveEvents(e){this.fire(new t.b("move",e)),this._zooming&&this.fire(new t.b("zoom",e)),this._rotating&&this.fire(new t.b("rotate",e)),this._pitching&&this.fire(new t.b("pitch",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const n=this._zooming,r=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,n&&this.fire(new t.b("zoomend",e)),r&&this.fire(new t.b("rotateend",e)),o&&this.fire(new t.b("pitchend",e)),this.fire(new t.b("moveend",e))}flyTo(e,i){if(this._prefersReducedMotion(e)){const n=t.ac(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,i)}this.stop(),e=t.e({offset:[0,0],speed:1.2,curve:1.42,easing:t.d0},e);const n=this.transform,r=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a="zoom"in e?t.aa(+e.zoom,n.minZoom,n.maxZoom):r,l="bearing"in e?this._normalizeBearing(e.bearing,o):o,c="pitch"in e?+e.pitch:s,u=n.zoomScale(a-r),h=t.P.convert(e.offset),d=n.centerPoint.add(h),p=n.pointLocation(d);let f=e.center;if(f&&e.padding){const t=this._cameraForBounds(this.transform,f,f,l,c,e);t&&(f=t.center)}f=t.bn.convert(f||p),this._normalizeCenter(f);const m=n.project(p),g=n.project(f).sub(m);let _=e.curve;const y=Math.max(n.width,n.height),v=y/u,x=g.mag();if("minZoom"in e){const i=t.aa(Math.min(e.minZoom,r,a),n.minZoom,n.maxZoom),o=y/n.zoomScale(i-r);_=Math.sqrt(o/x*2)}const b=_*_;function w(t){const e=(v*v-y*y+(t?-1:1)*b*b*x*x)/(2*(t?v:y)*b*x);return Math.log(Math.sqrt(e*e+1)-e)}function E(t){return(Math.exp(t)-Math.exp(-t))/2}function S(t){return(Math.exp(t)+Math.exp(-t))/2}const T=w(0);let M=function(t){return S(T)/S(T+_*t)},I=function(t){return y*((S(T)*(E(e=T+_*t)/S(e))-E(T))/b)/x;var e},C=(w(1)-T)/_;if(Math.abs(x)<1e-6||!isFinite(C)){if(Math.abs(y-v)<1e-6)return this.easeTo(e,i);const t=v<y?-1:1;C=Math.abs(Math.log(v/y))/_,I=function(){return 0},M=function(e){return Math.exp(t*_*e)}}e.duration="duration"in e?+e.duration:1e3*C/("screenSpeed"in e?+e.screenSpeed/_:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const A=o!==l,P=c!==s,L=n=>u=>{const h=u*C,p=1/M(h);n.zoom=1===u?a:r+n.scaleZoom(p),A&&(n.bearing=t.U(o,l,u)),P&&(n.pitch=t.U(s,c,u));const _=1===u?f:n.unproject(m.add(g.mult(I(h))).mult(p));return n.setLocationAtPoint(n.renderWorldCopies?_.wrap():_,d),n._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(i),n};if(e.preloadOnly){const t=this._emulate(L,e.duration,n);return this._preloadTiles(t),this}return this._zooming=!0,this._rotating=A,this._pitching=P,this._prepareEase(i,!1),this._ease(L(n),(()=>this._afterEase(i)),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const t=this._onEaseEnd;this._onEaseEnd=void 0,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,i,n){!1===n.animate||0===n.duration?(e(1),i()):(this._easeStart=t.f.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((t.f.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,i){e=t.bh(e,-180,180);const n=Math.abs(e-i);return Math.abs(e-360-i)<n&&(e-=360),Math.abs(e+360-i)<n&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(e.maxBounds)return;if("globe"!==e.projection.name&&!e.renderWorldCopies)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&t.f.prefersReducedMotion&&!(e&&e.essential)}_emulate(t,e,i){const n=Math.ceil(15*e/1e3),r=[],o=t(i.clone());for(let t=0;t<=n;t++){const e=o(t/n);r.push(e.clone())}return r}}class na{constructor(e={}){this.options=e,t.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const e=this.options&&this.options.compact;return this._map=t,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o("button","mapboxgl-ctrl-attrib-button",this._container),o("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const i=this._map._getUIString(`AttributionControl.${e}`);t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.d5.ACCESS_TOKEN}];if(e){const n=i.reduce(((t,e,n)=>(e.value&&(t+=`${e.key}=${e.value}${n<i.length-1?"&":""}`),t)),"?");e.href=`${t.d5.FEEDBACK_URL}/${n}#${os(this._map,!0)}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style._mergedSourceCaches;for(const i in e){const n=e[i];if(n.used){const e=n.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t.sort(((t,e)=>t.length-e.length)),t=t.filter(((e,i)=>{for(let n=i+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const i=t.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,t.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ra{constructor(){t.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=o("div","mapboxgl-ctrl");const e=o("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const e in t){const i=t[e].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}}}class oa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const e of i)if(e.id===t)return void(e.cancelled=!0)}run(t=0){const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function sa(e,i,n){if(e=new t.bn(e.lng,e.lat),i){const r=new t.bn(e.lng-360,e.lat),o=new t.bn(e.lng+360,e.lat),s=360*Math.ceil(Math.abs(e.lng-n.center.lng)/360),a=n.locationPoint(e).distSqr(i),l=i.x<0||i.y<0||i.x>n.width||i.y>n.height;n.locationPoint(r).distSqr(i)<a&&(l||Math.abs(r.lng-n.center.lng)<s)?e=r:n.locationPoint(o).distSqr(i)<a&&(l||Math.abs(o.lng-n.center.lng)<s)&&(e=o)}for(;Math.abs(e.lng-n.center.lng)>180;){const t=n.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=n.width&&t.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}const aa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class la extends t.E{constructor(e,i){if(super(),(e instanceof HTMLElement||i)&&(e=t.e({element:e},i)),t.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=t.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=o("div");const i=41,n=27,r=s("svg",{display:"block",height:i*this._scale+"px",width:n*this._scale+"px",viewBox:`0 0 ${n} ${i}`},this._element),a=s("radialGradient",{id:"shadowGradient"},s("defs",{},r));s("stop",{offset:"10%","stop-opacity":.4},a),s("stop",{offset:"100%","stop-opacity":.05},a),s("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r),s("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),s("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),s("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),this._offset=t.P.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(t=>{t.preventDefault()})),this._element.addEventListener("mousedown",(t=>{t.preventDefault()}));const n=this._element.classList;for(const t in aa)n.remove(`mapboxgl-marker-anchor-${t}`);n.add(`mapboxgl-marker-anchor-${this._anchor}`);const r=e&&e.className?e.className.trim().split(/\s+/):[];n.add(...r),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.bn.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,i=13.5,n=Math.sqrt(Math.pow(i,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[n,-1*(e-i+n)],"bottom-right":[-n,-1*(e-i+n)],left:[i,-1*(e-i)],right:[-i,-1*(e-i)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,e=this._pos;if(!t||!e)return!1;const i=t.unproject(e),n=t.getFreeCameraOptions();if(!n.position)return!1;const r=n.position.toLngLat();return r.distanceTo(i)<.9*r.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const i=this._pos;if(!i||i.x<0||i.x>e.transform.width||i.y<0||i.y>e.transform.height)return void this._clearFadeTimer();const n=e.unproject(i);let r;e._showingGlobe()&&t.d6(e.transform,this._lngLat)?r=0:(r=1-e._queryFogOpacity(n),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(r*=this._occludedOpacity)),this._element.style.opacity=`${r}`,this._element.style.pointerEvents=r>0?"auto":"none",this._popup&&this._popup._setOpacity(r),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const e=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px)\n            ${aa[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${e.x}px,${e.y}px)\n        `}_calculateXYTransform(){const e=this._pos,i=this._map,n=this.getPitchAlignment();if(!i||!e||"map"!==n)return"";if(!i._showingGlobe()){const t=i.getPitch();return t?`rotateX(${t}deg)`:""}const r=t.bF(t.d7(i.transform,this._lngLat)),o=e.sub(t.d8(i.transform)),s=Math.abs(o.x)+Math.abs(o.y);if(0===s)return"";const a=r/s;return`rotateX(${-o.y*a}deg) rotateY(${o.x*a}deg)`}_calculateZTransform(){const e=this._pos,i=this._map;if(!i||!e)return"";let n=0;const r=this.getRotationAlignment();if("map"===r)if(i._showingGlobe()){const e=i.project(new t.bn(this._lngLat.lng,this._lngLat.lat+.001)),r=i.project(new t.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(e);n=t.bF(Math.atan2(r.y,r.x))-90}else n=-i.getBearing();else if("horizon"===r){const r=t.O(4,6,i.getZoom()),o=t.d8(i.transform);o.y+=r*i.transform.height;const s=e.sub(o),a=t.bF(Math.atan2(s.y,s.x));n=(a>90?a-270:a+90)*(1-r)}return n+=this._rotation,n?`rotateZ(${n}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const e=this._map;e&&(e.transform.renderWorldCopies&&(this._lngLat=sa(this._lngLat,this._pos,e.transform)),this._pos=e.project(this._lngLat),!0===t?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),e._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(e._showingGlobe()||e.getTerrain()||e.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(e){return this._offset=t.P.convert(e),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(e){const i=this._map;if(!i)return;const n=this._pointerdownPos,r=this._positionDelta;if(n&&r){if(!this._isDragging){const t=this._clickTolerance||i._clickTolerance;if(e.point.dist(n)<t)return;this._isDragging=!0}this._pos=e.point.sub(r),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.b("dragstart"))),this.fire(new t.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new t.b("dragend")),this._state="inactive"}_addDragHandler(t){const e=this._map,i=this._pos;e&&i&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(i),this._pointerdownPos=t.point,this._state="pending",e.on("mousemove",this._onMove),e.on("touchmove",this._onMove),e.once("mouseup",this._onUp),e.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const e=this._map;return e&&(t?(e.on("mousedown",this._addDragHandler),e.on("touchstart",this._addDragHandler)):(e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ca={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ua=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ha(e=new t.P(0,0),i="bottom"){if("number"==typeof e){const n=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(i){case"top":return new t.P(0,e);case"top-left":return new t.P(n,n);case"top-right":return new t.P(-n,n);case"bottom":return new t.P(0,-e);case"bottom-left":return new t.P(n,-n);case"bottom-right":return new t.P(-n,-n);case"left":return new t.P(e,0);case"right":return new t.P(-e,0)}return new t.P(0,0)}return e instanceof t.P||Array.isArray(e)?t.P.convert(e):t.P.convert(e[i]||[0,0])}class da{constructor(t){this.jumpTo(t)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const i=t.cc((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,e,i){this._start=this.getValue(e),this._end=t,this._startTime=e,this._endTime=e+i}}const pa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},fa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class ma{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const ga={showCompass:!0,showZoom:!0,visualizePitch:!1};class _a{constructor(e,i,n=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new Is({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,n&&(this.mousePitch=new Cs({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),u()}move(t,e){const i=this.map,n=this.mouseRotate.mousemoveWindow(t,e),r=n&&n.bearingDelta;if(r&&i.setBearing(i.getBearing()+r),this.mousePitch){const n=this.mousePitch.mousemoveWindow(t,e),r=n&&n.pitchDelta;r&&i.setPitch(i.getPitch()+r)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(t.e({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),f(this.element,e)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,f(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=m(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=m(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ya={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},va={maxWidth:100,unit:"metric"},xa={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ba={version:t.dk,supported:i,setRTLTextPlugin:t.dm,getRTLTextPluginStatus:t.dn,Map:class extends ia{constructor(e){const i=e;if(null!=(e=t.e({},fa,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&t.d9(window)&&(e.antialias=!1,t.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new gn(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._repaint=!1,this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new oa,this._domRenderTaskQueue=new oa,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.aC(),this._locale=t.e({},pa,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new da(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new t.da(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,this._contextCreateOptions=e.contextCreateOptions?{...e.contextCreateOptions}:{},"string"==typeof e.container){const t=document.getElementById(e.container);if(!t)throw new Error(`Container '${e.container.toString()}' not found.`);this._container=t}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&t.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),t.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new ma,this._tp=e.devtools?new Qo(this):new Qo,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,(t=>{this.repaint=t})),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,(t=>{this.showTileAABBs=t})),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,(t=>{this.showPadding=t})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,(()=>{this._update()})),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ta(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||t.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new rs("string"==typeof e.hash&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==i.center&&null==i.zoom||(this.transform._unmodified=!1),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});const n=e.bounds;n&&(this.resize(),this.fitBounds(n,t.e({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new na({customAttribution:e.customAttribution})),this._logoControl=new ra,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new t.b(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new t.b(`${e.dataType}dataloading`,e))}))}_getMapId(){return this._mapId}addControl(e,i){if(void 0===i&&(i=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=e.onAdd(this);this._controls.push(e);const r=this._controlPositions[i];return-1!==i.indexOf("bottom")?r.insertBefore(n,r.firstChild):r.appendChild(n),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(e);return i>-1&&this._controls.splice(i,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new t.b("movestart",e)).fire(new t.b("move",e)),this.fire(new t.b("resize",e)),i&&this.fire(new t.b("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(t.ad.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new t.b("zoomstart")).fire(new t.b("zoom")).fire(new t.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new t.b("zoomstart")).fire(new t.b("zoom")).fire(new t.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new t.b("pitchstart")).fire(new t.b("pitch")).fire(new t.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new t.b("pitchstart")).fire(new t.b("pitch")).fire(new t.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return"auto"===t?navigator.language:Array.isArray(t)?0===t.length?void 0:t.map((t=>"auto"===t?navigator.language:t)):t}setLanguage(t){const e=this._parseLanguage(t);if(!this.style||e===this._language)return this;this._language=e,this.style.reloadSources();for(const t of this._controls)t._setLanguage&&t._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){return this.style&&t!==this._worldview?(this._worldview=t,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(t){return this._lazyInitEmptyStyle(),t?"string"==typeof t&&(t={name:t}):t=null,this._useExplicitProjection=!!t,this._prioritizeAndUpdateProjection(t,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const e=this.transform,i=e.projection.name;let n;"globe"===i&&e.zoom>=t.bx?(e.setMercatorFromTransition(),n=!0):"mercator"===i&&e.zoom<t.bx&&(e.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(t,e){return this._updateProjection(t||e||{name:"mercator"})}_updateProjection(e){let i;return i="globe"===e.name&&this.transform.zoom>=t.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(t.bn.convert(e))}unproject(e){return this.transform.pointLocation3D(t.P.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(t,e,i){if("mouseenter"===t||"mouseover"===t){let n=!1;const r=r=>{const o=e.filter((t=>this.getLayer(t))),s=o.length?this.queryRenderedFeatures(r.point,{layers:o}):[];s.length?n||(n=!0,i.call(this,new fs(t,this,r.originalEvent,{features:s}))):n=!1},o=()=>{n=!1};return{layers:new Set(e),listener:i,delegates:{mousemove:r,mouseout:o}}}if("mouseleave"===t||"mouseout"===t){let n=!1;const r=r=>{const o=e.filter((t=>this.getLayer(t)));(o.length?this.queryRenderedFeatures(r.point,{layers:o}):[]).length?n=!0:n&&(n=!1,i.call(this,new fs(t,this,r.originalEvent)))},o=e=>{n&&(n=!1,i.call(this,new fs(t,this,e.originalEvent)))};return{layers:new Set(e),listener:i,delegates:{mousemove:r,mouseout:o}}}{const n=t=>{const n=e.filter((t=>this.getLayer(t))),r=n.length?this.queryRenderedFeatures(t.point,{layers:n}):[];r.length&&(t.features=r,i.call(this,t),delete t.features)};return{layers:new Set(e),listener:i,delegates:{[t]:n}}}}on(t,e,i){if(void 0===i)return super.on(t,e);if(Array.isArray(e)||(e=[e]),e)for(const t of e)if(!this._isValidId(t))return this;const n=this._createDelegatedListener(t,e,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(n);for(const t in n.delegates)this.on(t,n.delegates[t]);return this}once(t,e,i){if(void 0===i)return super.once(t,e);if(Array.isArray(e)||(e=[e]),e)for(const t of e)if(!this._isValidId(t))return this;const n=this._createDelegatedListener(t,e,i);for(const t in n.delegates)this.once(t,n.delegates[t]);return this}off(t,e,i){if(void 0===i)return super.off(t,e);e=new Set(Array.isArray(e)?e:[e]);for(const t of e)if(!this._isValidId(t))return this;const n=(t,e)=>{if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0},r=this._delegatedListeners?this._delegatedListeners[t]:void 0;return r&&(t=>{for(let r=0;r<t.length;r++){const o=t[r];if(o.listener===i&&n(o.layers,e)){for(const t in o.delegates)this.off(t,o.delegates[t]);return t.splice(r,1),this}}})(r),this}queryRenderedFeatures(e,i){if(!this.style)return[];if(void 0!==i||void 0===e||e instanceof t.P||Array.isArray(e)||(i=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers))for(const t of i.layers)if(!this._isValidId(t))return[];return this.style.queryRenderedFeatures(e,i,this.transform)}querySourceFeatures(t,e){return this._isValidId(t)?this.style.querySourceFeatures(t,e):[]}isPointOnSurface(e){const{name:i}=this.transform.projection;return"globe"!==i&&"mercator"!==i&&t.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.P.convert(e))}setStyle(e,i){return!1!==(i=t.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(e,i))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t&&(this.style=new Dn(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Dn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,i){if("string"==typeof e){const n=this._requestManager.normalizeStyleURL(e),r=this._requestManager.transformRequest(n,t.R.Style);t.g(r,((e,n)=>{e?this.fire(new t.a(e)):n&&this._updateDiff(n,i)}))}else"object"==typeof e&&this._updateDiff(e,i)}_updateDiff(e,i){try{this.style.setState(e)&&this._update(!0)}catch(n){t.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(e,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.w("There is no style added to the map."),!1)}_isValidId(e){return null==e?(this.fire(new t.a(new Error("IDs can't be empty."))),!1):!t.c4(e)||(this.fire(new t.a(new Error(`IDs can't contain special symbols: "${e}".`))),!1)}addSource(t,e){return this._isValidId(t)?(this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)):this}isSourceLoaded(t){return!!this._isValidId(t)&&!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(t,e,i){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)}removeSource(t){return this._isValidId(t)?(this.style.removeSource(t),this._updateTerrain(),this._update(!0)):this}getSource(t){return this._isValidId(t)?this.style.getOwnSource(t):null}addImage(e,i,{pixelRatio:n=1,sdf:r=!1,stretchX:o,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:l,height:c,data:u}=t.f.getImageData(i);this.style.addImage(e,{data:new t.h({width:l,height:c},u),pixelRatio:n,stretchX:o,stretchY:s,content:a,sdf:r,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new t.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=i,u=i;this.style.addImage(e,{data:new t.h({width:l,height:c},new Uint8Array(u.data)),pixelRatio:n,stretchX:o,stretchY:s,content:a,sdf:r,version:0,userImage:u}),u.onAdd&&u.onAdd(this,e)}}updateImage(e,i){this._lazyInitEmptyStyle();const n=this.style.getImage(e);if(!n)return void this.fire(new t.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?t.f.getImageData(i):i,{width:o,height:s}=r,a=r.data;if(void 0===o||void 0===s)return void this.fire(new t.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==n.data.width||s!==n.data.height)return void this.fire(new t.a(new Error(`The width and height of the updated image (${o}, ${s})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`)));const l=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);n.data.replace(a,l),this.style.updateImage(e,n)}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new t.a(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(e,i){t.d(this._requestManager.transformRequest(e,t.R.Image),((e,n)=>{i(e,n instanceof HTMLImageElement?t.f.getImageData(n):n)}))}listImages(){return this.style.listImages()}addModel(t,e){this._lazyInitEmptyStyle(),this.style.addModel(t,e)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new t.a(new Error("Missing required model id"))),!1)}removeModel(t){this.style.removeModel(t)}listModels(){return this.style.listModels()}addLayer(t,e){return this._isValidId(t.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)):this}getSlot(t){const e=this.getLayer(t);return e&&e.slot||null}setSlot(t,e){return this.style.setSlot(t,e),this.style.mergeLayers(),this._update(!0)}addImport(t,e){return this.style.addImport(t,e),this}updateImport(t,e){return"string"!=typeof e&&e.id!==t?(this.removeImport(t),this.addImport(e)):(this.style.updateImport(t,e),this._update(!0))}removeImport(t){return this.style.removeImport(t),this}moveImport(t,e){return this.style.moveImport(t,e),this._update(!0)}moveLayer(t,e){return this._isValidId(t)?(this.style.moveLayer(t,e),this._update(!0)):this}removeLayer(t){return this._isValidId(t)?(this.style.removeLayer(t),this._update(!0)):this}getLayer(t){return this._isValidId(t)?this.style.getOwnLayer(t):null}setLayerZoomRange(t,e,i){return this._isValidId(t)?(this.style.setLayerZoomRange(t,e,i),this._update(!0)):this}setFilter(t,e,i={}){return this._isValidId(t)?(this.style.setFilter(t,e,i),this._update(!0)):this}getFilter(t){return this._isValidId(t)?this.style.getFilter(t):null}setPaintProperty(t,e,i,n={}){return this._isValidId(t)?(this.style.setPaintProperty(t,e,i,n),this._update(!0)):this}getPaintProperty(t,e){return this._isValidId(t)?this.style.getPaintProperty(t,e):null}setLayoutProperty(t,e,i,n={}){return this._isValidId(t)?(this.style.setLayoutProperty(t,e,i,n),this._update(!0)):this}getLayoutProperty(t,e){return this._isValidId(t)?this.style.getLayoutProperty(t,e):null}getConfigProperty(t,e){return this.style.getConfigProperty(t,e)}setConfigProperty(t,e,i){return this.style.setConfigProperty(t,e,i),this._update(!0)}setLights(t){if(this._lazyInitEmptyStyle(),t&&1===t.length&&"flat"===t[0].type){const e=t[0];e.properties?this.style.setFlatLight(e.properties,e.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(t),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const t=this.style.getLights()||[];return 0===t.length&&t.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),t}setLight(t,e={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:t}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(t){return this.style.setCamera(t),this._triggerCameraUpdate(t)}_triggerCameraUpdate(t){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===t["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.bn.convert(e),this.transform):0}setFeatureState(t,e){return this._isValidId(t.source)?(this.style.setFeatureState(t,e),this._update()):this}removeFeatureState(t,e){return this._isValidId(t.source)?(this.style.removeFeatureState(t,e),this._update()):this}getFeatureState(t){return this._isValidId(t.source)?this.style.getFeatureState(t):null}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,e=this._container.getBoundingClientRect().height||300;let i,n,r,o=this._container;for(;o&&(!n||!r);){const t=window.getComputedStyle(o).transform;t&&"none"!==t&&(i=t.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&"0"!==i[0]&&"1"!==i[0]&&(n=i[0]),i[3]&&"0"!==i[3]&&"1"!==i[3]&&(r=i[3])),o=o.parentElement}this._containerWidth=n?Math.abs(t/n):t,this._containerHeight=r?Math.abs(e/r):e}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=o("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=o("div","mapboxgl-canvas-container",t);this._canvas=o("canvas","mapboxgl-canvas",e),this._interactive&&(e.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=o("div","mapboxgl-control-container",t),n=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((t=>{n[t]=o("div",`mapboxgl-ctrl-${t}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,i){const n=t.f.devicePixelRatio||1;this._canvas.width=n*Math.ceil(e),this._canvas.height=n*Math.ceil(i),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${i}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_addPopup(t){this._popups.push(t)}_removePopup(t){const e=this._popups.indexOf(t);-1!==e&&this._popups.splice(e,1)}_setupPainter(){const e=t.e({},i.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",e);n?(t.db(n,!0),this.painter=new is(n,this._contextCreateOptions,this.transform,this._tp),this.on("data",(t=>{"source"===t.dataType&&this.painter.setTileLoadedFlag(!0)})),t.dc.testSupport(n)):this.fire(new t.a(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.b("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.b("webglcontextrestored",{originalEvent:e}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(e){let i;this.fire(new t.b("renderstart"));const n=this.painter.context.extTimerQuery,r=t.f.now(),o=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=o.createQuery(),o.beginQuery(n.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,i=this.transform.pitch,n=t.f.now(),r=new t.K(e,{now:n,fadeDuration:s,pitch:i,transition:this.style.transition});this.style.update(r)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(r),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):a=this._updateAverageElevation(r),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const e=t.f.now()-r;o.endQuery(n.TIME_ELAPSED_EXT),setTimeout((()=>{const n=o.getQueryParameter(i,o.QUERY_RESULT)/1e6;o.deleteQuery(i),this.fire(new t.b("gpu-timing-frame",{cpuTime:e,gpuTime:n}))}),50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(e);this.fire(new t.b("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const e=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(e);this.fire(new t.b("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(l||this._repaint)this.triggerRepaint();else{const e=!this.isMoving()&&this.loaded();if(e&&(a=this._updateAverageElevation(r,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new t.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new t.b("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._performanceMetricsCollection&&t.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(t){for(const e of this._markers)t&&!this.getRenderWorldCopies()&&(e._lngLat=e._lngLat.wrap()),e._update();for(const e of this._popups)!t||this.getRenderWorldCopies()||e._trackPointer||(e._lngLat=e._lngLat.wrap()),e._update()}_updateAverageElevation(t,e=!1){const i=t=>(this.transform.averageElevation=t,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);const n=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(n||(e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const e=this.transform.averageElevation;let r=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(r)?r=0:this._averageElevationLastSampledAt=t;const o=Math.abs(e-r);if(o>1){if(this._isInitialLoad||n)return this._averageElevation.jumpTo(r),i(r);this._averageElevation.easeTo(r,t,300)}else if(o>1e-4)return this._averageElevation.jumpTo(r),i(r)}return!!this._averageElevation.isEasing(t)&&i(this._averageElevation.getValue(t))}_authenticate(){t.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(e=>{if(e&&(e.message===t.df||401===e.status)){const e=this.painter.context.gl;t.db(e,!1),this._logoControl instanceof ra&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),t.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const t=this._isDragging();this.painter.updateTerrain(this.style,t)}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const i=this.painter.context.gl,n=i.createFramebuffer();function r(t){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0);const e=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,e),e}return i.bindFramebuffer(i.FRAMEBUFFER,n),this._canvasPixelComparison(r(t),e.canvasCopies.map(r),e.timeStamps)}_canvasPixelComparison(t,e,i){let n=i[1]-i[0];const r=t.length/4;for(let o=0;o<e.length;o++){const s=e[o];let a=0;for(let e=0;e<s.length;e+=4)s[e]===t[e]&&s[e+1]===t[e+1]&&s[e+2]===t[e+2]&&s[e+3]===t[e+3]&&(a+=1);n+=(i[o+2]-i[o+1])*(1-a/r)}return n}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),t.dh(this.painter.context.gl),t.di.remove(),t.dj.remove(),this._removed=!0,this.fire(new t.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=t.f.frame((t=>{const e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,e&&this._render(t)})))}_preloadTiles(e){const i=this.style?Object.values(this.style._sourceCaches):[];return t.b1(i,((t,i)=>t._preloadTiles(e,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(t){this._showParseStatus!==t&&(this._showParseStatus=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(t){this._showLayers2DWireframe!==t&&(this._showLayers2DWireframe=t,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(t){this._showLayers3DWireframe!==t&&(this._showLayers3DWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(t){this._showTileAABBs!==t&&(this._showTileAABBs=t,t&&this._update())}_setCacheLimits(e,i){t.dl(e,i)}get version(){return t.dk}},NavigationControl:class{constructor(e){this.options=t.e({},ga,e),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(t.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),o("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),o("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const e=this._map;e&&(this.options.visualizePitch?e.resetNorthPitch({},{originalEvent:t}):e.resetNorth({},{originalEvent:t}))})),this._compassIcon=o("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),i=e===t.getMaxZoom(),n=e===t.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=e)}))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _a(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const i=o("button",t,this._container);return i.type="button",i.addEventListener("click",e),i}_setButtonTitle(t,e){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",i),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends t.E{constructor(e){super();const i=navigator.geolocation;this.options=t.e({geolocation:i},ya,e),t.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ns(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){const e=(e=!!this.options.geolocation)=>{this._supportsGeolocation=e,t(e)};void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then((t=>e("denied"!==t.state))).catch((()=>e())):e()}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return!!e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.b("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.b("geolocate",e)),this._finish()}}_updateCamera(e){const i=new t.bn(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,r=this._map.getBearing(),o=t.e({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(n),o,{geolocateSource:!0})}_updateMarker(e){if(e){const i=new t.bn(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,i=t.bl(1,e._center.lat)*e.worldSize,n=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.b("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=o("button","mapboxgl-ctrl-geolocate",this._container),o("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o("div","mapboxgl-user-location"),this._dotElement.appendChild(o("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new la({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new la({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.b("trackuserlocationend")))}))}}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:!0===t.absolute&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e&&t()})).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:na,ScaleControl:class{constructor(e){this.options=t.e({},va,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(t){return!1}}(),t.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const t=this.options.maxWidth||100,e=this._map,i=e._containerHeight/2,n=e._containerWidth/2-t/2,r=e.unproject([n,i]),o=e.unproject([n+t,i]),s=r.distanceTo(o);if("imperial"===this.options.unit){const e=3.2808*s;e>5280?this._setScale(t,e/5280,"mile"):this._setScale(t,e,"foot")}else"nautical"===this.options.unit?this._setScale(t,s/1852,"nautical-mile"):s>=1e3?this._setScale(t,s/1e3,"kilometer"):this._setScale(t,s,"meter")}_setScale(t,e,i){this._map._requestDomTask((()=>{const n=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(i),e*i}(e),r=n/e;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==i?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(n):`${n}&nbsp;${xa[i]}`,this._container.style.width=t*r+"px"}))}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:t.w("Full screen control 'container' must be a DOM element.")),t.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=o("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.E{constructor(e){super(),this.options=t.e(Object.create(ca),e),t.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new t.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new t.b("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=t.bn.convert(e),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(document.createTextNode(t))}setHTML(t){const e=document.createDocumentFragment(),i=document.createElement("body");let n;for(i.innerHTML=t;n=i.firstChild,n;)e.appendChild(n);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=o("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const t=this._closeButton=o("button","mapboxgl-popup-close-button",e);t.type="button",t.setAttribute("aria-label","Close popup"),t.setAttribute("aria-hidden","true"),t.innerHTML="&#215;",t.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,i=this._container,n=this._pos;if(!e||!i||!n)return"bottom";const r=i.offsetWidth,o=i.offsetHeight,s=n.x<r/2,a=n.x>e.transform.width-r/2;if(n.y+t<o)return s?"top-left":a?"top-right":"top";if(n.y>e.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(e){const i=this._map,n=this._content;if(!i||!this._lngLat&&!this._trackPointer||!n)return;let r=this._container;if(r||(r=this._container=o("div","mapboxgl-popup",i.getContainer()),this._tip=o("div","mapboxgl-popup-tip",r),r.appendChild(n)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sa(this._lngLat,this._pos,i.transform)),!this._trackPointer||e){const t=this._pos=this._trackPointer&&e?e:i.project(this._lngLat),n=ha(this.options.offset),r=this._anchor=this._getAnchor(n.y),o=ha(this.options.offset,r),s=t.add(o).round();i._requestDomTask((()=>{this._container&&r&&(this._container.style.transform=`${aa[r]} translate(${s.x}px,${s.y}px)`)}))}if(!this._marker&&i._showingGlobe()){const e=t.d6(i.transform,this._lngLat)?0:1;this._setOpacity(e)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(ua);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=`${t}`),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:la,Style:Dn,LngLat:t.bn,LngLatBounds:t.ad,Point:t.P,MercatorCoordinate:t.L,FreeCameraOptions:dn,Evented:t.E,config:t.d5,prewarm:t.dp,clearPrewarmedResources:t.dq,get accessToken(){return t.d5.ACCESS_TOKEN},set accessToken(e){t.d5.ACCESS_TOKEN=e},get baseApiUrl(){return t.d5.API_URL},set baseApiUrl(e){t.d5.API_URL=e},get workerCount(){return t.dr.workerCount},set workerCount(e){t.dr.workerCount=e},get maxParallelImageRequests(){return t.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.d5.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){t.ds(e)},get workerUrl(){return t.dt.workerUrl},set workerUrl(e){t.dt.workerUrl=e},get workerClass(){return t.dt.workerClass},set workerClass(e){t.dt.workerClass=e},get workerParams(){return t.dt.workerParams},set workerParams(e){t.dt.workerParams=e},get dracoUrl(){return t.du()},set dracoUrl(e){t.dv(e)},get meshoptUrl(){return t.dw()},set meshoptUrl(e){t.dx(e)},setNow:t.f.setNow,restoreNow:t.f.restoreNow};return ba})),i}()},9544:()=>{!function(){"use strict";var t=function(t){this.element_=t,this.init()};window.MaterialButton=t,t.prototype.Constant_={},t.prototype.CssClasses_={RIPPLE_EFFECT:"mdl-js-ripple-effect",RIPPLE_CONTAINER:"mdl-button__ripple-container",RIPPLE:"mdl-ripple"},t.prototype.blurHandler_=function(t){t&&this.element_.blur()},t.prototype.disable=function(){this.element_.disabled=!0},t.prototype.disable=t.prototype.disable,t.prototype.enable=function(){this.element_.disabled=!1},t.prototype.enable=t.prototype.enable,t.prototype.init=function(){if(this.element_){if(this.element_.classList.contains(this.CssClasses_.RIPPLE_EFFECT)){var t=document.createElement("span");t.classList.add(this.CssClasses_.RIPPLE_CONTAINER),this.rippleElement_=document.createElement("span"),this.rippleElement_.classList.add(this.CssClasses_.RIPPLE),t.appendChild(this.rippleElement_),this.boundRippleBlurHandler=this.blurHandler_.bind(this),this.rippleElement_.addEventListener("mouseup",this.boundRippleBlurHandler),this.element_.appendChild(t)}this.boundButtonBlurHandler=this.blurHandler_.bind(this),this.element_.addEventListener("mouseup",this.boundButtonBlurHandler),this.element_.addEventListener("mouseleave",this.boundButtonBlurHandler)}},componentHandler.register({constructor:t,classAsString:"MaterialButton",cssClass:"mdl-js-button",widget:!0})}()},2511:()=>{var t={upgradeDom:function(t,e){},upgradeElement:function(t,e){},upgradeElements:function(t){},upgradeAllRegistered:function(){},registerUpgradedCallback:function(t,e){},register:function(t){},downgradeElements:function(t){}};(t=function(){"use strict";var t=[],e=[],i="mdlComponentConfigInternal_";function n(e,i){for(var n=0;n<t.length;n++)if(t[n].className===e)return void 0!==i&&(t[n]=i),t[n];return!1}function r(t){var e=t.getAttribute("data-upgraded");return null===e?[""]:e.split(",")}function o(t,e){return-1!==r(t).indexOf(e)}function s(t,e,i){if("CustomEvent"in window&&"function"==typeof window.CustomEvent)return new CustomEvent(t,{bubbles:e,cancelable:i});var n=document.createEvent("Events");return n.initEvent(t,e,i),n}function a(e,i){if(void 0===e&&void 0===i)for(var r=0;r<t.length;r++)a(t[r].className,t[r].cssClass);else{var o=e;if(void 0===i){var s=n(o);s&&(i=s.cssClass)}for(var c=document.querySelectorAll("."+i),u=0;u<c.length;u++)l(c[u],o)}}function l(a,l){if(!("object"==typeof a&&a instanceof Element))throw new Error("Invalid argument provided to upgrade MDL element.");var c=s("mdl-componentupgrading",!0,!0);if(a.dispatchEvent(c),!c.defaultPrevented){var u=r(a),h=[];if(l)o(a,l)||h.push(n(l));else{var d=a.classList;t.forEach((function(t){d.contains(t.cssClass)&&-1===h.indexOf(t)&&!o(a,t.className)&&h.push(t)}))}for(var p,f=0,m=h.length;f<m;f++){if(!(p=h[f]))throw new Error("Unable to find a registered component for the given class.");u.push(p.className),a.setAttribute("data-upgraded",u.join(","));var g=new p.classConstructor(a);g[i]=p,e.push(g);for(var _=0,y=p.callbacks.length;_<y;_++)p.callbacks[_](a);p.widget&&(a[p.className]=g);var v=s("mdl-componentupgraded",!0,!1);a.dispatchEvent(v)}}}function c(t){if(t){var n=e.indexOf(t);e.splice(n,1);var r=t.element_.getAttribute("data-upgraded").split(","),o=r.indexOf(t[i].classAsString);r.splice(o,1),t.element_.setAttribute("data-upgraded",r.join(","));var a=s("mdl-componentdowngraded",!0,!1);t.element_.dispatchEvent(a)}}return{upgradeDom:a,upgradeElement:l,upgradeElements:function t(e){Array.isArray(e)||(e=e instanceof Element?[e]:Array.prototype.slice.call(e));for(var i,n=0,r=e.length;n<r;n++)(i=e[n])instanceof HTMLElement&&(l(i),i.children.length>0&&t(i.children))},upgradeAllRegistered:function(){for(var e=0;e<t.length;e++)a(t[e].className)},registerUpgradedCallback:function(t,e){var i=n(t);i&&i.callbacks.push(e)},register:function(e){var r=!0;void 0===e.widget&&void 0===e.widget||(r=e.widget||e.widget);var o={classConstructor:e.constructor||e.constructor,className:e.classAsString||e.classAsString,cssClass:e.cssClass||e.cssClass,widget:r,callbacks:[]};if(t.forEach((function(t){if(t.cssClass===o.cssClass)throw new Error("The provided cssClass has already been registered: "+t.cssClass);if(t.className===o.className)throw new Error("The provided className has already been registered")})),e.constructor.prototype.hasOwnProperty(i))throw new Error("MDL component classes must not have "+i+" defined as a property.");n(e.classAsString,o)||t.push(o)},downgradeElements:function(t){var i=function(t){e.filter((function(e){return e.element_===t})).forEach(c)};if(t instanceof Array||t instanceof NodeList)for(var n=0;n<t.length;n++)i(t[n]);else{if(!(t instanceof Node))throw new Error("Invalid argument provided to downgrade MDL nodes.");i(t)}}}}()).ComponentConfigPublic,t.ComponentConfig,t.Component,t.upgradeDom=t.upgradeDom,t.upgradeElement=t.upgradeElement,t.upgradeElements=t.upgradeElements,t.upgradeAllRegistered=t.upgradeAllRegistered,t.registerUpgradedCallback=t.registerUpgradedCallback,t.register=t.register,t.downgradeElements=t.downgradeElements,window.componentHandler=t,window.componentHandler=t,window.addEventListener("load",(function(){"use strict";"classList"in document.createElement("div")&&"querySelector"in document&&"addEventListener"in window&&Array.prototype.forEach?(document.documentElement.classList.add("mdl-js"),t.upgradeAllRegistered()):(t.upgradeElement=function(){},t.register=function(){})}))},9550:()=>{!function(){"use strict";var t=function(t){this.element_=t,this.init()};window.MaterialProgress=t,t.prototype.Constant_={},t.prototype.CssClasses_={INDETERMINATE_CLASS:"mdl-progress__indeterminate"},t.prototype.setProgress=function(t){this.element_.classList.contains(this.CssClasses_.INDETERMINATE_CLASS)||(this.progressbar_.style.width=t+"%")},t.prototype.setProgress=t.prototype.setProgress,t.prototype.setBuffer=function(t){this.bufferbar_.style.width=t+"%",this.auxbar_.style.width=100-t+"%"},t.prototype.setBuffer=t.prototype.setBuffer,t.prototype.init=function(){if(this.element_){var t=document.createElement("div");t.className="progressbar bar bar1",this.element_.appendChild(t),this.progressbar_=t,(t=document.createElement("div")).className="bufferbar bar bar2",this.element_.appendChild(t),this.bufferbar_=t,(t=document.createElement("div")).className="auxbar bar bar3",this.element_.appendChild(t),this.auxbar_=t,this.progressbar_.style.width="0%",this.bufferbar_.style.width="100%",this.auxbar_.style.width="0%",this.element_.classList.add("is-upgraded")}},componentHandler.register({constructor:t,classAsString:"MaterialProgress",cssClass:"mdl-js-progress",widget:!0})}()},6822:()=>{!function(){"use strict";var t=function(t){this.element_=t,this.init()};window.MaterialSpinner=t,t.prototype.Constant_={MDL_SPINNER_LAYER_COUNT:4},t.prototype.CssClasses_={MDL_SPINNER_LAYER:"mdl-spinner__layer",MDL_SPINNER_CIRCLE_CLIPPER:"mdl-spinner__circle-clipper",MDL_SPINNER_CIRCLE:"mdl-spinner__circle",MDL_SPINNER_GAP_PATCH:"mdl-spinner__gap-patch",MDL_SPINNER_LEFT:"mdl-spinner__left",MDL_SPINNER_RIGHT:"mdl-spinner__right"},t.prototype.createLayer=function(t){var e=document.createElement("div");e.classList.add(this.CssClasses_.MDL_SPINNER_LAYER),e.classList.add(this.CssClasses_.MDL_SPINNER_LAYER+"-"+t);var i=document.createElement("div");i.classList.add(this.CssClasses_.MDL_SPINNER_CIRCLE_CLIPPER),i.classList.add(this.CssClasses_.MDL_SPINNER_LEFT);var n=document.createElement("div");n.classList.add(this.CssClasses_.MDL_SPINNER_GAP_PATCH);var r=document.createElement("div");r.classList.add(this.CssClasses_.MDL_SPINNER_CIRCLE_CLIPPER),r.classList.add(this.CssClasses_.MDL_SPINNER_RIGHT);for(var o=[i,n,r],s=0;s<o.length;s++){var a=document.createElement("div");a.classList.add(this.CssClasses_.MDL_SPINNER_CIRCLE),o[s].appendChild(a)}e.appendChild(i),e.appendChild(n),e.appendChild(r),this.element_.appendChild(e)},t.prototype.createLayer=t.prototype.createLayer,t.prototype.stop=function(){this.element_.classList.remove("is-active")},t.prototype.stop=t.prototype.stop,t.prototype.start=function(){this.element_.classList.add("is-active")},t.prototype.start=t.prototype.start,t.prototype.init=function(){if(this.element_){for(var t=1;t<=this.Constant_.MDL_SPINNER_LAYER_COUNT;t++)this.createLayer(t);this.element_.classList.add("is-upgraded")}},componentHandler.register({constructor:t,classAsString:"MaterialSpinner",cssClass:"mdl-js-spinner",widget:!0})}()},7930:()=>{!function(){"use strict";var t=function(t){this.element_=t,this.maxRows=this.Constant_.NO_MAX_ROWS,this.init()};window.MaterialTextfield=t,t.prototype.Constant_={NO_MAX_ROWS:-1,MAX_ROWS_ATTRIBUTE:"maxrows"},t.prototype.CssClasses_={LABEL:"mdl-textfield__label",INPUT:"mdl-textfield__input",IS_DIRTY:"is-dirty",IS_FOCUSED:"is-focused",IS_DISABLED:"is-disabled",IS_INVALID:"is-invalid",IS_UPGRADED:"is-upgraded",HAS_PLACEHOLDER:"has-placeholder"},t.prototype.onKeyDown_=function(t){var e=t.target.value.split("\n").length;13===t.keyCode&&e>=this.maxRows&&t.preventDefault()},t.prototype.onFocus_=function(t){this.element_.classList.add(this.CssClasses_.IS_FOCUSED)},t.prototype.onBlur_=function(t){this.element_.classList.remove(this.CssClasses_.IS_FOCUSED)},t.prototype.onReset_=function(t){this.updateClasses_()},t.prototype.updateClasses_=function(){this.checkDisabled(),this.checkValidity(),this.checkDirty(),this.checkFocus()},t.prototype.checkDisabled=function(){this.input_.disabled?this.element_.classList.add(this.CssClasses_.IS_DISABLED):this.element_.classList.remove(this.CssClasses_.IS_DISABLED)},t.prototype.checkDisabled=t.prototype.checkDisabled,t.prototype.checkFocus=function(){Boolean(this.element_.querySelector(":focus"))?this.element_.classList.add(this.CssClasses_.IS_FOCUSED):this.element_.classList.remove(this.CssClasses_.IS_FOCUSED)},t.prototype.checkFocus=t.prototype.checkFocus,t.prototype.checkValidity=function(){this.input_.validity&&(this.input_.validity.valid?this.element_.classList.remove(this.CssClasses_.IS_INVALID):this.element_.classList.add(this.CssClasses_.IS_INVALID))},t.prototype.checkValidity=t.prototype.checkValidity,t.prototype.checkDirty=function(){this.input_.value&&this.input_.value.length>0?this.element_.classList.add(this.CssClasses_.IS_DIRTY):this.element_.classList.remove(this.CssClasses_.IS_DIRTY)},t.prototype.checkDirty=t.prototype.checkDirty,t.prototype.disable=function(){this.input_.disabled=!0,this.updateClasses_()},t.prototype.disable=t.prototype.disable,t.prototype.enable=function(){this.input_.disabled=!1,this.updateClasses_()},t.prototype.enable=t.prototype.enable,t.prototype.change=function(t){this.input_.value=t||"",this.updateClasses_()},t.prototype.change=t.prototype.change,t.prototype.init=function(){if(this.element_&&(this.label_=this.element_.querySelector("."+this.CssClasses_.LABEL),this.input_=this.element_.querySelector("."+this.CssClasses_.INPUT),this.input_)){this.input_.hasAttribute(this.Constant_.MAX_ROWS_ATTRIBUTE)&&(this.maxRows=parseInt(this.input_.getAttribute(this.Constant_.MAX_ROWS_ATTRIBUTE),10),isNaN(this.maxRows)&&(this.maxRows=this.Constant_.NO_MAX_ROWS)),this.input_.hasAttribute("placeholder")&&this.element_.classList.add(this.CssClasses_.HAS_PLACEHOLDER),this.boundUpdateClassesHandler=this.updateClasses_.bind(this),this.boundFocusHandler=this.onFocus_.bind(this),this.boundBlurHandler=this.onBlur_.bind(this),this.boundResetHandler=this.onReset_.bind(this),this.input_.addEventListener("input",this.boundUpdateClassesHandler),this.input_.addEventListener("focus",this.boundFocusHandler),this.input_.addEventListener("blur",this.boundBlurHandler),this.input_.addEventListener("reset",this.boundResetHandler),this.maxRows!==this.Constant_.NO_MAX_ROWS&&(this.boundKeyDownHandler=this.onKeyDown_.bind(this),this.input_.addEventListener("keydown",this.boundKeyDownHandler));var t=this.element_.classList.contains(this.CssClasses_.IS_INVALID);this.updateClasses_(),this.element_.classList.add(this.CssClasses_.IS_UPGRADED),t&&this.element_.classList.add(this.CssClasses_.IS_INVALID),this.input_.hasAttribute("autofocus")&&(this.element_.focus(),this.checkFocus())}},componentHandler.register({constructor:t,classAsString:"MaterialTextfield",cssClass:"mdl-js-textfield",widget:!0})}()},5072:t=>{"use strict";var e=[];function i(t){for(var i=-1,n=0;n<e.length;n++)if(e[n].identifier===t){i=n;break}return i}function n(t,n){for(var o={},s=[],a=0;a<t.length;a++){var l=t[a],c=n.base?l[0]+n.base:l[0],u=o[c]||0,h="".concat(c," ").concat(u);o[c]=u+1;var d=i(h),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)e[d].references++,e[d].updater(p);else{var f=r(p,n);n.byIndex=a,e.splice(a,0,{identifier:h,updater:f,references:1})}s.push(h)}return s}function r(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,r){var o=n(t=t||[],r=r||{});return function(t){t=t||[];for(var s=0;s<o.length;s++){var a=i(o[s]);e[a].references--}for(var l=n(t,r),c=0;c<o.length;c++){var u=i(o[c]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}o=l}}},7659:t=>{"use strict";var e={};t.exports=function(t,i){var n=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(i)}},540:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},5056:(t,e,i)=>{"use strict";t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},7825:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var n="";i.supports&&(n+="@supports (".concat(i.supports,") {")),i.media&&(n+="@media ".concat(i.media," {"));var r=void 0!==i.layer;r&&(n+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),n+=i.css,r&&(n+="}"),i.media&&(n+="}"),i.supports&&(n+="}");var o=i.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},1113:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},1625:()=>{document.getElementById("loadingScreen").style.opacity=1,window.addEventListener("load",(function(){setTimeout((function(){let t=document.querySelectorAll(".loadup");function e(t){return new Promise((e=>{let i=0;const n=setInterval((function(){i+=.02,t.style.opacity=Math.min(i,1),i>=1&&(clearInterval(n),e())}),10)}))}(async function(){for(let i of t)await e(i)})().then((()=>{document.getElementById("loadingScreen").style.display="none"}))}),500)}))},259:(t,e,i)=>{"use strict";var n=i(2697);function r(t){var e=[1/0,1/0,-1/0,-1/0];return n.coordEach(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}r.default=r,e.A=r},8611:(t,e)=>{"use strict";function i(t,e,i){void 0===i&&(i={});var n={type:"Feature"};return(0===i.id||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=e||{},n.geometry=t,n}function n(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!p(t[0])||!p(t[1]))throw new Error("coordinates must contain numbers");return i({type:"Point",coordinates:t},e,n)}function r(t,e,n){void 0===n&&(n={});for(var r=0,o=t;r<o.length;r++){var s=o[r];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw new Error("First and last Position are not equivalent.")}return i({type:"Polygon",coordinates:t},e,n)}function o(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return i({type:"LineString",coordinates:t},e,n)}function s(t,e){void 0===e&&(e={});var i={type:"FeatureCollection"};return e.id&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.features=t,i}function a(t,e,n){return void 0===n&&(n={}),i({type:"MultiLineString",coordinates:t},e,n)}function l(t,e,n){return void 0===n&&(n={}),i({type:"MultiPoint",coordinates:t},e,n)}function c(t,e,n){return void 0===n&&(n={}),i({type:"MultiPolygon",coordinates:t},e,n)}function u(t,i){void 0===i&&(i="kilometers");var n=e.factors[i];if(!n)throw new Error(i+" units is invalid");return t*n}function h(t,i){void 0===i&&(i="kilometers");var n=e.factors[i];if(!n)throw new Error(i+" units is invalid");return t/n}function d(t){return t%(2*Math.PI)*180/Math.PI}function p(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=6371008.8,e.factors={centimeters:100*e.earthRadius,centimetres:100*e.earthRadius,degrees:e.earthRadius/111325,feet:3.28084*e.earthRadius,inches:39.37*e.earthRadius,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:1e3*e.earthRadius,millimetres:1e3*e.earthRadius,nauticalmiles:e.earthRadius/1852,radians:1,yards:1.0936*e.earthRadius},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},e.feature=i,e.geometry=function(t,e,i){switch(void 0===i&&(i={}),t){case"Point":return n(e).geometry;case"LineString":return o(e).geometry;case"Polygon":return r(e).geometry;case"MultiPoint":return l(e).geometry;case"MultiLineString":return a(e).geometry;case"MultiPolygon":return c(e).geometry;default:throw new Error(t+" is invalid")}},e.point=n,e.points=function(t,e,i){return void 0===i&&(i={}),s(t.map((function(t){return n(t,e)})),i)},e.polygon=r,e.polygons=function(t,e,i){return void 0===i&&(i={}),s(t.map((function(t){return r(t,e)})),i)},e.lineString=o,e.lineStrings=function(t,e,i){return void 0===i&&(i={}),s(t.map((function(t){return o(t,e)})),i)},e.featureCollection=s,e.multiLineString=a,e.multiPoint=l,e.multiPolygon=c,e.geometryCollection=function(t,e,n){return void 0===n&&(n={}),i({type:"GeometryCollection",geometries:t},e,n)},e.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var i=Math.pow(10,e||0);return Math.round(t*i)/i},e.radiansToLength=u,e.lengthToRadians=h,e.lengthToDegrees=function(t,e){return d(h(t,e))},e.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},e.radiansToDegrees=d,e.degreesToRadians=function(t){return t%360*Math.PI/180},e.convertLength=function(t,e,i){if(void 0===e&&(e="kilometers"),void 0===i&&(i="kilometers"),!(t>=0))throw new Error("length must be a positive number");return u(h(t,e),i)},e.convertArea=function(t,i,n){if(void 0===i&&(i="meters"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("area must be a positive number");var r=e.areaFactors[i];if(!r)throw new Error("invalid original units");var o=e.areaFactors[n];if(!o)throw new Error("invalid final units");return t/r*o},e.isNumber=p,e.isObject=function(t){return!!t&&t.constructor===Object},e.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!p(t))throw new Error("bbox must only contain numbers")}))},e.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}},2697:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(8611);function r(t,e,i){if(null!==t)for(var n,o,s,a,l,c,u,h,d=0,p=0,f=t.type,m="FeatureCollection"===f,g="Feature"===f,_=m?t.features.length:1,y=0;y<_;y++){l=(h=!!(u=m?t.features[y].geometry:g?t.geometry:t)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var v=0;v<l;v++){var x=0,b=0;if(null!==(a=h?u.geometries[v]:u)){c=a.coordinates;var w=a.type;switch(d=!i||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===e(c,p,y,x,b))return!1;p++,x++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(!1===e(c[n],p,y,x,b))return!1;p++,"MultiPoint"===w&&x++}"LineString"===w&&x++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(o=0;o<c[n].length-d;o++){if(!1===e(c[n][o],p,y,x,b))return!1;p++}"MultiLineString"===w&&x++,"Polygon"===w&&b++}"Polygon"===w&&x++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(b=0,o=0;o<c[n].length;o++){for(s=0;s<c[n][o].length-d;s++){if(!1===e(c[n][o][s],p,y,x,b))return!1;p++}b++}x++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===r(a.geometries[n],e,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(t,e){var i;switch(t.type){case"FeatureCollection":for(i=0;i<t.features.length&&!1!==e(t.features[i].properties,i);i++);break;case"Feature":e(t.properties,0)}}function s(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var i=0;i<t.features.length&&!1!==e(t.features[i],i);i++);}function a(t,e){var i,n,r,o,s,a,l,c,u,h,d=0,p="FeatureCollection"===t.type,f="Feature"===t.type,m=p?t.features.length:1;for(i=0;i<m;i++){for(a=p?t.features[i].geometry:f?t.geometry:t,c=p?t.features[i].properties:f?t.properties:{},u=p?t.features[i].bbox:f?t.bbox:void 0,h=p?t.features[i].id:f?t.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,r=0;r<s;r++)if(null!==(o=l?a.geometries[r]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,d,c,u,h))return!1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===e(o.geometries[n],d,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,d,c,u,h))return!1;d++}}function l(t,e){a(t,(function(t,i,r,o,s){var a,l=null===t?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return!1!==e(n.feature(t,r,{bbox:o,id:s}),i,0)&&void 0}switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var c=0;c<t.coordinates.length;c++){var u={type:a,coordinates:t.coordinates[c]};if(!1===e(n.feature(u,r),i,c))return!1}}))}function c(t,e){l(t,(function(t,i,o){var s=0;if(t.geometry){var a=t.geometry.type;if("Point"!==a&&"MultiPoint"!==a){var l,c=0,u=0,h=0;return!1!==r(t,(function(r,a,d,p,f){if(void 0===l||i>c||p>u||f>h)return l=r,c=i,u=p,h=f,void(s=0);var m=n.lineString([l,r],t.properties);if(!1===e(m,i,o,f,s))return!1;s++,l=r}))&&void 0}}}))}function u(t,e){if(!t)throw new Error("geojson is required");l(t,(function(t,i,r){if(null!==t.geometry){var o=t.geometry.type,s=t.geometry.coordinates;switch(o){case"LineString":if(!1===e(t,i,r,0,0))return!1;break;case"Polygon":for(var a=0;a<s.length;a++)if(!1===e(n.lineString(s[a],t.properties),i,r,a))return!1}}}))}e.coordAll=function(t){var e=[];return r(t,(function(t){e.push(t)})),e},e.coordEach=r,e.coordReduce=function(t,e,i,n){var o=i;return r(t,(function(t,n,r,s,a){o=0===n&&void 0===i?t:e(o,t,n,r,s,a)}),n),o},e.featureEach=s,e.featureReduce=function(t,e,i){var n=i;return s(t,(function(t,r){n=0===r&&void 0===i?t:e(n,t,r)})),n},e.findPoint=function(t,e){if(e=e||{},!n.isObject(e))throw new Error("options is invalid");var i,r=e.featureIndex||0,o=e.multiFeatureIndex||0,s=e.geometryIndex||0,a=e.coordIndex||0,l=e.properties;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),l=l||t.features[r].properties,i=t.features[r].geometry;break;case"Feature":l=l||t.properties,i=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":i=t;break;default:throw new Error("geojson is invalid")}if(null===i)return null;var c=i.coordinates;switch(i.type){case"Point":return n.point(c,l,e);case"MultiPoint":return o<0&&(o=c.length+o),n.point(c[o],l,e);case"LineString":return a<0&&(a=c.length+a),n.point(c[a],l,e);case"Polygon":return s<0&&(s=c.length+s),a<0&&(a=c[s].length+a),n.point(c[s][a],l,e);case"MultiLineString":return o<0&&(o=c.length+o),a<0&&(a=c[o].length+a),n.point(c[o][a],l,e);case"MultiPolygon":return o<0&&(o=c.length+o),s<0&&(s=c[o].length+s),a<0&&(a=c[o][s].length-a),n.point(c[o][s][a],l,e)}throw new Error("geojson is invalid")},e.findSegment=function(t,e){if(e=e||{},!n.isObject(e))throw new Error("options is invalid");var i,r=e.featureIndex||0,o=e.multiFeatureIndex||0,s=e.geometryIndex||0,a=e.segmentIndex||0,l=e.properties;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),l=l||t.features[r].properties,i=t.features[r].geometry;break;case"Feature":l=l||t.properties,i=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":i=t;break;default:throw new Error("geojson is invalid")}if(null===i)return null;var c=i.coordinates;switch(i.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=c.length+a-1),n.lineString([c[a],c[a+1]],l,e);case"Polygon":return s<0&&(s=c.length+s),a<0&&(a=c[s].length+a-1),n.lineString([c[s][a],c[s][a+1]],l,e);case"MultiLineString":return o<0&&(o=c.length+o),a<0&&(a=c[o].length+a-1),n.lineString([c[o][a],c[o][a+1]],l,e);case"MultiPolygon":return o<0&&(o=c.length+o),s<0&&(s=c[o].length+s),a<0&&(a=c[o][s].length-a-1),n.lineString([c[o][s][a],c[o][s][a+1]],l,e)}throw new Error("geojson is invalid")},e.flattenEach=l,e.flattenReduce=function(t,e,i){var n=i;return l(t,(function(t,r,o){n=0===r&&0===o&&void 0===i?t:e(n,t,r,o)})),n},e.geomEach=a,e.geomReduce=function(t,e,i){var n=i;return a(t,(function(t,r,o,s,a){n=0===r&&void 0===i?t:e(n,t,r,o,s,a)})),n},e.lineEach=u,e.lineReduce=function(t,e,i){var n=i;return u(t,(function(t,r,o,s){n=0===r&&void 0===i?t:e(n,t,r,o,s)})),n},e.propEach=o,e.propReduce=function(t,e,i){var n=i;return o(t,(function(t,r){n=0===r&&void 0===i?t:e(n,t,r)})),n},e.segmentEach=c,e.segmentReduce=function(t,e,i){var n=i,r=!1;return c(t,(function(t,o,s,a,l){n=!1===r&&void 0===i?t:e(n,t,o,s,a,l),r=!0})),n}},9343:(t,e,i)=>{"use strict";var n=i(8897),r=i(8179),o=r(n("String.prototype.indexOf"));t.exports=function(t,e){var i=n(t,!!e);return"function"==typeof i&&o(t,".prototype.")>-1?r(i):i}},8179:(t,e,i)=>{"use strict";var n=i(4499),r=i(8897),o=i(8973),s=i(1711),a=r("%Function.prototype.apply%"),l=r("%Function.prototype.call%"),c=r("%Reflect.apply%",!0)||n.call(l,a),u=i(7539),h=r("%Math.max%");t.exports=function(t){if("function"!=typeof t)throw new s("a function is required");var e=c(n,l,arguments);return o(e,1+h(0,t.length-(arguments.length-1)),!0)};var d=function(){return c(n,a,arguments)};u?u(t.exports,"apply",{value:d}):t.exports.apply=d},5114:(t,e,i)=>{"use strict";var n=i(8108),r=i(922),o=i(4440),s=i(1247).orient2d;function a(t,e,i){e=Math.max(0,void 0===e?2:e),i=i||0;var r=function(t){for(var e=t[0],i=t[0],n=t[0],r=t[0],s=0;s<t.length;s++){var a=t[s];a[0]<e[0]&&(e=a),a[0]>n[0]&&(n=a),a[1]<i[1]&&(i=a),a[1]>r[1]&&(r=a)}var l=[e,i,n,r],c=l.slice();for(s=0;s<t.length;s++)o(t[s],l)||c.push(t[s]);return function(t){t.sort(v);for(var e=[],i=0;i<t.length;i++){for(;e.length>=2&&p(e[e.length-2],e[e.length-1],t[i])<=0;)e.pop();e.push(t[i])}for(var n=[],r=t.length-1;r>=0;r--){for(;n.length>=2&&p(n[n.length-2],n[n.length-1],t[r])<=0;)n.pop();n.push(t[r])}return n.pop(),e.pop(),e.concat(n)}(c)}(t),s=new n(16);s.toBBox=function(t){return{minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]}},s.compareMinX=function(t,e){return t[0]-e[0]},s.compareMinY=function(t,e){return t[1]-e[1]},s.load(t);for(var a,c=[],u=0;u<r.length;u++){var h=r[u];s.remove(h),a=m(h,a),c.push(a)}var d=new n(16);for(u=0;u<c.length;u++)d.insert(f(c[u]));for(var _=e*e,y=i*i;c.length;){var x=c.shift(),b=x.p,w=x.next.p,E=g(b,w);if(!(E<y)){var S=E/_;(h=l(s,x.prev.p,b,w,x.next.next.p,S,d))&&Math.min(g(h,b),g(h,w))<=S&&(c.push(x),c.push(m(h,x)),s.remove(h),d.remove(x),d.insert(f(x)),d.insert(f(x.next)))}}x=a;var T=[];do{T.push(x.p),x=x.next}while(x!==a);return T.push(x.p),T}function l(t,e,i,n,o,s,a){for(var l=new r([],c),h=t.data;h;){for(var p=0;p<h.children.length;p++){var f=h.children[p],m=h.leaf?_(f,i,n):u(i,n,f);m>s||l.push({node:f,dist:m})}for(;l.length&&!l.peek().node.children;){var g=l.pop(),y=g.node,v=_(y,e,i),x=_(y,n,o);if(g.dist<v&&g.dist<x&&d(i,y,a)&&d(n,y,a))return y}(h=l.pop())&&(h=h.node)}return null}function c(t,e){return t.dist-e.dist}function u(t,e,i){if(h(t,i)||h(e,i))return 0;var n=y(t[0],t[1],e[0],e[1],i.minX,i.minY,i.maxX,i.minY);if(0===n)return 0;var r=y(t[0],t[1],e[0],e[1],i.minX,i.minY,i.minX,i.maxY);if(0===r)return 0;var o=y(t[0],t[1],e[0],e[1],i.maxX,i.minY,i.maxX,i.maxY);if(0===o)return 0;var s=y(t[0],t[1],e[0],e[1],i.minX,i.maxY,i.maxX,i.maxY);return 0===s?0:Math.min(n,r,o,s)}function h(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function d(t,e,i){for(var n,r,o,s,a=Math.min(t[0],e[0]),l=Math.min(t[1],e[1]),c=Math.max(t[0],e[0]),u=Math.max(t[1],e[1]),h=i.search({minX:a,minY:l,maxX:c,maxY:u}),d=0;d<h.length;d++)if(n=h[d].p,r=h[d].next.p,o=t,n!==(s=e)&&r!==o&&p(n,r,o)>0!=p(n,r,s)>0&&p(o,s,n)>0!=p(o,s,r)>0)return!1;return!0}function p(t,e,i){return s(t[0],t[1],e[0],e[1],i[0],i[1])}function f(t){var e=t.p,i=t.next.p;return t.minX=Math.min(e[0],i[0]),t.minY=Math.min(e[1],i[1]),t.maxX=Math.max(e[0],i[0]),t.maxY=Math.max(e[1],i[1]),t}function m(t,e){var i={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(i.next=e.next,i.prev=e,e.next.prev=i,e.next=i):(i.prev=i,i.next=i),i}function g(t,e){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function _(t,e,i){var n=e[0],r=e[1],o=i[0]-n,s=i[1]-r;if(0!==o||0!==s){var a=((t[0]-n)*o+(t[1]-r)*s)/(o*o+s*s);a>1?(n=i[0],r=i[1]):a>0&&(n+=o*a,r+=s*a)}return(o=t[0]-n)*o+(s=t[1]-r)*s}function y(t,e,i,n,r,o,s,a){var l,c,u,h,d=i-t,p=n-e,f=s-r,m=a-o,g=t-r,_=e-o,y=d*d+p*p,v=d*f+p*m,x=f*f+m*m,b=d*g+p*_,w=f*g+m*_,E=y*x-v*v,S=E,T=E;0===E?(c=0,S=1,h=w,T=x):(h=y*w-v*b,(c=v*w-x*b)<0?(c=0,h=w,T=x):c>S&&(c=S,h=w+v,T=x)),h<0?(h=0,-b<0?c=0:-b>y?c=S:(c=-b,S=y)):h>T&&(h=T,-b+v<0?c=0:-b+v>y?c=S:(c=-b+v,S=y));var M=(1-(u=0===h?0:h/T))*r+u*s-((1-(l=0===c?0:c/S))*t+l*i),I=(1-u)*o+u*a-((1-l)*e+l*n);return M*M+I*I}function v(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}r.default&&(r=r.default),t.exports=a,t.exports.default=a},8108:function(t){t.exports=function(){"use strict";function t(t,n,r,o,s){!function t(i,n,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,l=n-r+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);t(i,n,Math.max(r,Math.floor(n-l*u/a+h)),Math.min(o,Math.floor(n+(a-l)*u/a+h)),s)}var d=i[n],p=r,f=o;for(e(i,r,n),s(i[o],d)>0&&e(i,r,o);p<f;){for(e(i,p,f),p++,f--;s(i[p],d)<0;)p++;for(;s(i[f],d)>0;)f--}0===s(i[r],d)?e(i,r,f):e(i,++f,o),f<=n&&(r=f+1),n<=f&&(o=f-1)}}(t,n,r||0,o||t.length-1,s||i)}function e(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function i(t,e){return t<e?-1:t>e?1:0}var n=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function o(t,e){s(t,0,t.children.length,e,t)}function s(t,e,i,n,r){r||(r=f(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o=e;o<i;o++){var s=t.children[o];a(r,t.leaf?n(s):s)}return r}function a(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function h(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function p(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function f(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(e,i,n,r,o){for(var s=[i,n];s.length;)if(!((n=s.pop())-(i=s.pop())<=r)){var a=i+Math.ceil((n-i)/r/2)*r;t(e,a,i,n,o),s.push(i,a,a,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(t){var e=this.data,i=[];if(!p(t,e))return i;for(var n=this.toBBox,r=[];e;){for(var o=0;o<e.children.length;o++){var s=e.children[o],a=e.leaf?n(s):s;p(t,a)&&(e.leaf?i.push(s):d(t,a)?this._all(s,i):r.push(s))}e=r.pop()}return i},n.prototype.collides=function(t){var e=this.data;if(!p(t,e))return!1;for(var i=[];e;){for(var n=0;n<e.children.length;n++){var r=e.children[n],o=e.leaf?this.toBBox(r):r;if(p(t,o)){if(e.leaf||d(t,o))return!0;i.push(r)}}e=i.pop()}return!1},n.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},n.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},n.prototype.clear=function(){return this.data=f([]),this},n.prototype.remove=function(t,e){if(!t)return this;for(var i,n,o,s=this.data,a=this.toBBox(t),l=[],c=[];s||l.length;){if(s||(s=l.pop(),n=l[l.length-1],i=c.pop(),o=!0),s.leaf){var u=r(t,s.children,e);if(-1!==u)return s.children.splice(u,1),l.push(s),this._condense(l),this}o||s.leaf||!d(s,a)?n?(i++,s=n.children[i],o=!1):s=null:(l.push(s),c.push(i),i=0,n=s,s=s.children[0])}return this},n.prototype.toBBox=function(t){return t},n.prototype.compareMinX=function(t,e){return t.minX-e.minX},n.prototype.compareMinY=function(t,e){return t.minY-e.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(t){return this.data=t,this},n.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},n.prototype._build=function(t,e,i,n){var r,s=i-e+1,a=this._maxEntries;if(s<=a)return o(r=f(t.slice(e,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,n-1))),(r=f([])).leaf=!1,r.height=n;var l=Math.ceil(s/a),c=l*Math.ceil(Math.sqrt(a));m(t,e,i,c,this.compareMinX);for(var u=e;u<=i;u+=c){var h=Math.min(u+c-1,i);m(t,u,h,l,this.compareMinY);for(var d=u;d<=h;d+=l){var p=Math.min(d+l-1,h);r.children.push(this._build(t,d,p,n-1))}}return o(r,this.toBBox),r},n.prototype._chooseSubtree=function(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){for(var r=1/0,o=1/0,s=void 0,a=0;a<e.children.length;a++){var l=e.children[a],c=u(l),h=(d=t,p=l,(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-c);h<o?(o=h,r=c<r?c:r,s=l):h===o&&c<r&&(r=c,s=l)}e=s||e.children[0]}var d,p;return e},n.prototype._insert=function(t,e,i){var n=i?t:this.toBBox(t),r=[],o=this._chooseSubtree(n,this.data,e,r);for(o.children.push(t),a(o,n);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(n,r,e)},n.prototype._split=function(t,e){var i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var s=this._chooseSplitIndex(i,r,n),a=f(i.children.splice(s,i.children.length-s));a.height=i.height,a.leaf=i.leaf,o(i,this.toBBox),o(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},n.prototype._splitRoot=function(t,e){this.data=f([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(t,e,i){for(var n,r,o,a,l,c,h,d=1/0,p=1/0,f=e;f<=i-e;f++){var m=s(t,0,f,this.toBBox),g=s(t,f,i,this.toBBox),_=(r=m,o=g,void 0,void 0,void 0,void 0,a=Math.max(r.minX,o.minX),l=Math.max(r.minY,o.minY),c=Math.min(r.maxX,o.maxX),h=Math.min(r.maxY,o.maxY),Math.max(0,c-a)*Math.max(0,h-l)),y=u(m)+u(g);_<d?(d=_,n=f,p=y<p?y:p):_===d&&y<p&&(p=y,n=f)}return n||i-e},n.prototype._chooseSplitAxis=function(t,e,i){var n=t.leaf?this.compareMinX:l,r=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,r)&&t.children.sort(n)},n.prototype._allDistMargin=function(t,e,i,n){t.children.sort(n);for(var r=this.toBBox,o=s(t,0,e,r),l=s(t,i-e,i,r),c=h(o)+h(l),u=e;u<i-e;u++){var d=t.children[u];a(o,t.leaf?r(d):d),c+=h(o)}for(var p=i-e-1;p>=e;p--){var f=t.children[p];a(l,t.leaf?r(f):f),c+=h(l)}return c},n.prototype._adjustParentBBoxes=function(t,e,i){for(var n=i;n>=0;n--)a(e[n],t)},n.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():o(t[e],this.toBBox)},n}()},3498:(t,e,i)=>{var n=i(3425),r=i(5456),o=i(9513),s=i(7647),a=i(9353),l=i(228),c=Date.prototype.getTime;function u(t){return null==t}function h(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length||"function"!=typeof t.copy||"function"!=typeof t.slice||t.length>0&&"number"!=typeof t[0])}t.exports=function t(e,i,d){var p=d||{};return!!(p.strict?o(e,i):e===i)||(!e||!i||"object"!=typeof e&&"object"!=typeof i?p.strict?o(e,i):e==i:function(e,i,o){var d,p;if(typeof e!=typeof i)return!1;if(u(e)||u(i))return!1;if(e.prototype!==i.prototype)return!1;if(r(e)!==r(i))return!1;var f=s(e),m=s(i);if(f!==m)return!1;if(f||m)return e.source===i.source&&a(e)===a(i);if(l(e)&&l(i))return c.call(e)===c.call(i);var g=h(e),_=h(i);if(g!==_)return!1;if(g||_){if(e.length!==i.length)return!1;for(d=0;d<e.length;d++)if(e[d]!==i[d])return!1;return!0}if(typeof e!=typeof i)return!1;try{var y=n(e),v=n(i)}catch(t){return!1}if(y.length!==v.length)return!1;for(y.sort(),v.sort(),d=y.length-1;d>=0;d--)if(y[d]!=v[d])return!1;for(d=y.length-1;d>=0;d--)if(!t(e[p=y[d]],i[p],o))return!1;return!0}(e,i,p))}},9381:(t,e,i)=>{"use strict";var n=i(7539),r=i(6296),o=i(1711),s=i(1399);t.exports=function(t,e,i){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new o("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new o("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new o("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new o("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new o("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new o("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],h=!!s&&s(t,e);if(n)n(t,e,{configurable:null===c&&h?h.configurable:!c,enumerable:null===a&&h?h.enumerable:!a,value:i,writable:null===l&&h?h.writable:!l});else{if(!u&&(a||l||c))throw new r("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=i}}},5144:(t,e,i)=>{"use strict";var n=i(3425),r="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),o=Object.prototype.toString,s=Array.prototype.concat,a=i(9381),l=i(6900)(),c=function(t,e,i,n){if(e in t)if(!0===n){if(t[e]===i)return}else if("function"!=typeof(r=n)||"[object Function]"!==o.call(r)||!n())return;var r;l?a(t,e,i,!0):a(t,e,i)},u=function(t,e){var i=arguments.length>2?arguments[2]:{},o=n(e);r&&(o=s.call(o,Object.getOwnPropertySymbols(e)));for(var a=0;a<o.length;a+=1)c(t,o[a],e[o[a]],i[o[a]])};u.supportsDescriptors=!!l,t.exports=u},649:t=>{function e(t,e,i,n){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(t,e,i,n)}e.prototype.run=function(t,e,i,n){this._init(t,e,i,n);for(var r=0;r<this._datasetLength;r++)if(1!==this._visited[r]){this._visited[r]=1;var o=this._regionQuery(r);if(o.length<this.minPts)this.noise.push(r);else{var s=this.clusters.length;this.clusters.push([]),this._addToCluster(r,s),this._expandCluster(s,o)}}return this.clusters},e.prototype._init=function(t,e,i,n){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this.noise=[],this._datasetLength=t.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}e&&(this.epsilon=e),i&&(this.minPts=i),n&&(this.distance=n)},e.prototype._expandCluster=function(t,e){for(var i=0;i<e.length;i++){var n=e[i];if(1!==this._visited[n]){this._visited[n]=1;var r=this._regionQuery(n);r.length>=this.minPts&&(e=this._mergeArrays(e,r))}1!==this._assigned[n]&&this._addToCluster(n,t)}},e.prototype._addToCluster=function(t,e){this.clusters[e].push(t),this._assigned[t]=1},e.prototype._regionQuery=function(t){for(var e=[],i=0;i<this._datasetLength;i++)this.distance(this.dataset[t],this.dataset[i])<this.epsilon&&e.push(i);return e},e.prototype._mergeArrays=function(t,e){for(var i=e.length,n=0;n<i;n++){var r=e[n];t.indexOf(r)<0&&t.push(r)}return t},e.prototype._euclideanDistance=function(t,e){for(var i=0,n=Math.min(t.length,e.length);n--;)i+=(t[n]-e[n])*(t[n]-e[n]);return Math.sqrt(i)},t.exports&&(t.exports=e)},4759:t=>{function e(t,e,i){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(t,e,i)}e.prototype.init=function(t,e,i){this.assignments=[],this.centroids=[],void 0!==t&&(this.dataset=t),void 0!==e&&(this.k=e),void 0!==i&&(this.distance=i)},e.prototype.run=function(t,e){this.init(t,e);for(var i=this.dataset.length,n=0;n<this.k;n++)this.centroids[n]=this.randomCentroid();for(var r=!0;r;){r=this.assign();for(var o=0;o<this.k;o++){for(var s=new Array(u),a=0,l=0;l<u;l++)s[l]=0;for(var c=0;c<i;c++){var u=this.dataset[c].length;if(o===this.assignments[c]){for(l=0;l<u;l++)s[l]+=this.dataset[c][l];a++}}if(a>0){for(l=0;l<u;l++)s[l]/=a;this.centroids[o]=s}else this.centroids[o]=this.randomCentroid(),r=!0}}return this.getClusters()},e.prototype.randomCentroid=function(){var t,e,i=this.dataset.length-1;do{e=Math.round(Math.random()*i),t=this.dataset[e]}while(this.centroids.indexOf(t)>=0);return t},e.prototype.assign=function(){for(var t,e=!1,i=this.dataset.length,n=0;n<i;n++)(t=this.argmin(this.dataset[n],this.centroids,this.distance))!=this.assignments[n]&&(this.assignments[n]=t,e=!0);return e},e.prototype.getClusters=function(){for(var t,e=new Array(this.k),i=0;i<this.assignments.length;i++)void 0===e[t=this.assignments[i]]&&(e[t]=[]),e[t].push(i);return e},e.prototype.argmin=function(t,e,i){for(var n,r=Number.MAX_VALUE,o=0,s=e.length,a=0;a<s;a++)(n=i(t,e[a]))<r&&(r=n,o=a);return o},e.prototype.distance=function(t,e){for(var i=0,n=Math.min(t.length,e.length);n--;){var r=t[n]-e[n];i+=r*r}return Math.sqrt(i)},t.exports&&(t.exports=e)},9336:(t,e,i)=>{if(t.exports)var n=i(2799);function r(t,e,i,n){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(t,e,i,n)}r.prototype.run=function(t,e,i,r){this._init(t,e,i,r);for(var o=0,s=this.dataset.length;o<s;o++)if(1!==this._processed[o]){this._processed[o]=1,this.clusters.push([o]);var a=this.clusters.length-1;this._orderedList.push(o);var l=new n(null,null,"asc"),c=this._regionQuery(o);void 0!==this._distanceToCore(o)&&(this._updateQueue(o,c,l),this._expandCluster(a,l))}return this.clusters},r.prototype.getReachabilityPlot=function(){for(var t=[],e=0,i=this._orderedList.length;e<i;e++){var n=this._orderedList[e],r=this._reachability[n];t.push([n,r])}return t},r.prototype._init=function(t,e,i,n){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}e&&(this.epsilon=e),i&&(this.minPts=i),n&&(this.distance=n)},r.prototype._updateQueue=function(t,e,i){var n=this;this._coreDistance=this._distanceToCore(t),e.forEach((function(e){if(void 0===n._processed[e]){var r=n.distance(n.dataset[t],n.dataset[e]),o=Math.max(n._coreDistance,r);void 0===n._reachability[e]?(n._reachability[e]=o,i.insert(e,o)):o<n._reachability[e]&&(n._reachability[e]=o,i.remove(e),i.insert(e,o))}}))},r.prototype._expandCluster=function(t,e){for(var i=e.getElements(),n=0,r=i.length;n<r;n++){var o=i[n];if(void 0===this._processed[o]){var s=this._regionQuery(o);this._processed[o]=1,this.clusters[t].push(o),this._orderedList.push(o),void 0!==this._distanceToCore(o)&&(this._updateQueue(o,s,e),this._expandCluster(t,e))}}},r.prototype._distanceToCore=function(t){for(var e=this.epsilon,i=0;i<e;i++)if(this._regionQuery(t,i).length>=this.minPts)return i},r.prototype._regionQuery=function(t,e){e=e||this.epsilon;for(var i=[],n=0,r=this.dataset.length;n<r;n++)this.distance(this.dataset[t],this.dataset[n])<e&&i.push(n);return i},r.prototype._euclideanDistance=function(t,e){for(var i=0,n=Math.min(t.length,e.length);n--;)i+=(t[n]-e[n])*(t[n]-e[n]);return Math.sqrt(i)},t.exports&&(t.exports=r)},2799:t=>{function e(t,e,i){this._queue=[],this._priorities=[],this._sorting="desc",this._init(t,e,i)}e.prototype.insert=function(t,e){for(var i=this._queue.length,n=i;n--;){var r=this._priorities[n];"desc"===this._sorting?e>r&&(i=n):e<r&&(i=n)}this._insertAt(t,e,i)},e.prototype.remove=function(t){for(var e=this._queue.length;e--;)if(t===this._queue[e]){this._queue.splice(e,1),this._priorities.splice(e,1);break}},e.prototype.forEach=function(t){this._queue.forEach(t)},e.prototype.getElements=function(){return this._queue},e.prototype.getElementPriority=function(t){return this._priorities[t]},e.prototype.getPriorities=function(){return this._priorities},e.prototype.getElementsWithPriorities=function(){for(var t=[],e=0,i=this._queue.length;e<i;e++)t.push([this._queue[e],this._priorities[e]]);return t},e.prototype._init=function(t,e,i){if(t&&e){if(this._queue=[],this._priorities=[],t.length!==e.length)throw new Error("Arrays must have the same length");for(var n=0;n<t.length;n++)this.insert(t[n],e[n])}i&&(this._sorting=i)},e.prototype._insertAt=function(t,e,i){this._queue.length===i?(this._queue.push(t),this._priorities.push(e)):(this._queue.splice(i,0,t),this._priorities.splice(i,0,e))},t.exports&&(t.exports=e)},8932:(t,e,i)=>{t.exports&&(t.exports={DBSCAN:i(649),KMEANS:i(4759),OPTICS:i(9336),PriorityQueue:i(2799)})},5230:t=>{"use strict";function e(t,e,n){n=n||2;var o,s,a,l,h,d,f,m=e&&e.length,g=m?e[0]*n:t.length,_=i(t,0,g,n,!0),y=[];if(!_||_.next===_.prev)return y;if(m&&(_=function(t,e,n,r){var o,s,a,l=[];for(o=0,s=e.length;o<s;o++)(a=i(t,e[o]*r,o<s-1?e[o+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),l.push(p(a));for(l.sort(c),o=0;o<l.length;o++)n=u(l[o],n);return n}(t,e,_,n)),t.length>80*n){o=a=t[0],s=l=t[1];for(var v=n;v<g;v+=n)(h=t[v])<o&&(o=h),(d=t[v+1])<s&&(s=d),h>a&&(a=h),d>l&&(l=d);f=0!==(f=Math.max(a-o,l-s))?32767/f:0}return r(_,y,n,o,s,f,0),y}function i(t,e,i,n,r){var o,s;if(r===M(t,e,i,n)>0)for(o=e;o<i;o+=n)s=E(o,t[o],t[o+1],s);else for(o=i-n;o>=e;o-=n)s=E(o,t[o],t[o+1],s);return s&&_(s,s.next)&&(S(s),s=s.next),s}function n(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!_(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{if(S(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function r(t,e,i,c,u,h,p){if(t){!p&&h&&function(t,e,i,n){var r=t;do{0===r.z&&(r.z=d(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,o,s,a,l,c=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,n=i,a=0,e=0;e<c&&(a++,n=n.nextZ);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;i=n}o.nextZ=null,c*=2}while(s>1)}(r)}(t,c,u,h);for(var f,m,g=t;t.prev!==t.next;)if(f=t.prev,m=t.next,h?s(t,c,u,h):o(t))e.push(f.i/i|0),e.push(t.i/i|0),e.push(m.i/i|0),S(t),t=m.next,g=m.next;else if((t=m)===g){p?1===p?r(t=a(n(t),e,i),e,i,c,u,h,2):2===p&&l(t,e,i,c,u,h):r(n(t),e,i,c,u,h,1);break}}}function o(t){var e=t.prev,i=t,n=t.next;if(g(e,i,n)>=0)return!1;for(var r=e.x,o=i.x,s=n.x,a=e.y,l=i.y,c=n.y,u=r<o?r<s?r:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=r>o?r>s?r:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,m=n.next;m!==e;){if(m.x>=u&&m.x<=d&&m.y>=h&&m.y<=p&&f(r,a,o,l,s,c,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function s(t,e,i,n){var r=t.prev,o=t,s=t.next;if(g(r,o,s)>=0)return!1;for(var a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,p=s.y,m=a<l?a<c?a:c:l<c?l:c,_=u<h?u<p?u:p:h<p?h:p,y=a>l?a>c?a:c:l>c?l:c,v=u>h?u>p?u:p:h>p?h:p,x=d(m,_,e,i,n),b=d(y,v,e,i,n),w=t.prevZ,E=t.nextZ;w&&w.z>=x&&E&&E.z<=b;){if(w.x>=m&&w.x<=y&&w.y>=_&&w.y<=v&&w!==r&&w!==s&&f(a,u,l,h,c,p,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,E.x>=m&&E.x<=y&&E.y>=_&&E.y<=v&&E!==r&&E!==s&&f(a,u,l,h,c,p,E.x,E.y)&&g(E.prev,E,E.next)>=0)return!1;E=E.nextZ}for(;w&&w.z>=x;){if(w.x>=m&&w.x<=y&&w.y>=_&&w.y<=v&&w!==r&&w!==s&&f(a,u,l,h,c,p,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;E&&E.z<=b;){if(E.x>=m&&E.x<=y&&E.y>=_&&E.y<=v&&E!==r&&E!==s&&f(a,u,l,h,c,p,E.x,E.y)&&g(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function a(t,e,i){var r=t;do{var o=r.prev,s=r.next.next;!_(o,s)&&y(o,r,r.next,s)&&b(o,s)&&b(s,o)&&(e.push(o.i/i|0),e.push(r.i/i|0),e.push(s.i/i|0),S(r),S(r.next),r=t=s),r=r.next}while(r!==t);return n(r)}function l(t,e,i,o,s,a){var l=t;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&m(l,c)){var u=w(l,c);return l=n(l,l.next),u=n(u,u.next),r(l,e,i,o,s,a,0),void r(u,e,i,o,s,a,0)}c=c.next}l=l.next}while(l!==t)}function c(t,e){return t.x-e.x}function u(t,e){var i=function(t,e){var i,n=e,r=t.x,o=t.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s&&(s=a,i=n.x<n.next.x?n:n.next,a===r))return i}n=n.next}while(n!==e);if(!i)return null;var l,c=i,u=i.x,d=i.y,p=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&f(o<d?r:s,o,u,d,o<d?s:r,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(r-n.x),b(n,t)&&(l<p||l===p&&(n.x>i.x||n.x===i.x&&h(i,n)))&&(i=n,p=l)),n=n.next}while(n!==c);return i}(t,e);if(!i)return e;var r=w(i,t);return n(r,r.next),n(i,i.next)}function h(t,e){return g(t.prev,t,e.prev)<0&&g(e.next,t,t.next)<0}function d(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function f(t,e,i,n,r,o,s,a){return(r-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(n-a)>=(i-s)*(e-a)&&(i-s)*(o-a)>=(r-s)*(n-a)}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&y(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(b(t,e)&&b(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(g(t.prev,t,e.prev)||g(t,e.prev,e))||_(t,e)&&g(t.prev,t,t.next)>0&&g(e.prev,e,e.next)>0)}function g(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function _(t,e){return t.x===e.x&&t.y===e.y}function y(t,e,i,n){var r=x(g(t,e,i)),o=x(g(t,e,n)),s=x(g(i,n,t)),a=x(g(i,n,e));return r!==o&&s!==a||!(0!==r||!v(t,i,e))||!(0!==o||!v(t,n,e))||!(0!==s||!v(i,t,n))||!(0!==a||!v(i,e,n))}function v(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function x(t){return t>0?1:t<0?-1:0}function b(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function w(t,e){var i=new T(t.i,t.x,t.y),n=new T(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function E(t,e,i,n){var r=new T(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function T(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(t,e,i,n){for(var r=0,o=e,s=i-n;o<i;o+=n)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}t.exports=e,t.exports.default=e,e.deviation=function(t,e,i,n){var r=e&&e.length,o=r?e[0]*i:t.length,s=Math.abs(M(t,0,o,i));if(r)for(var a=0,l=e.length;a<l;a++){var c=e[a]*i,u=a<l-1?e[a+1]*i:t.length;s-=Math.abs(M(t,c,u,i))}var h=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,p=n[a+1]*i,f=n[a+2]*i;h+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},e.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[r][o][s]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i}},7539:(t,e,i)=>{"use strict";var n=i(8897)("%Object.defineProperty%",!0)||!1;if(n)try{n({},"a",{value:1})}catch(t){n=!1}t.exports=n},3841:t=>{"use strict";t.exports=EvalError},219:t=>{"use strict";t.exports=Error},6190:t=>{"use strict";t.exports=RangeError},3950:t=>{"use strict";t.exports=ReferenceError},6296:t=>{"use strict";t.exports=SyntaxError},1711:t=>{"use strict";t.exports=TypeError},3221:t=>{"use strict";t.exports=URIError},5845:t=>{"use strict";var e=Object.prototype.toString,i=Math.max,n=function(t,e){for(var i=[],n=0;n<t.length;n+=1)i[n]=t[n];for(var r=0;r<e.length;r+=1)i[r+t.length]=e[r];return i};t.exports=function(t){var r=this;if("function"!=typeof r||"[object Function]"!==e.apply(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var o,s=function(t,e){for(var i=[],n=1,r=0;n<t.length;n+=1,r+=1)i[r]=t[n];return i}(arguments),a=i(0,r.length-s.length),l=[],c=0;c<a;c++)l[c]="$"+c;if(o=Function("binder","return function ("+function(t,e){for(var i="",n=0;n<t.length;n+=1)i+=t[n],n+1<t.length&&(i+=",");return i}(l)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof o){var e=r.apply(this,n(s,arguments));return Object(e)===e?e:this}return r.apply(t,n(s,arguments))})),r.prototype){var u=function(){};u.prototype=r.prototype,o.prototype=new u,u.prototype=null}return o}},4499:(t,e,i)=>{"use strict";var n=i(5845);t.exports=Function.prototype.bind||n},1442:t=>{"use strict";var e=function(){return"string"==typeof function(){}.name},i=Object.getOwnPropertyDescriptor;if(i)try{i([],"length")}catch(t){i=null}e.functionsHaveConfigurableNames=function(){if(!e()||!i)return!1;var t=i((function(){}),"name");return!!t&&!!t.configurable};var n=Function.prototype.bind;e.boundFunctionsHaveNames=function(){return e()&&"function"==typeof n&&""!==function(){}.bind().name},t.exports=e},7639:(t,e,i)=>{var n=i(3498),r=function(t){this.precision=t&&t.precision?t.precision:17,this.direction=!(!t||!t.direction)&&t.direction,this.pseudoNode=!(!t||!t.pseudoNode)&&t.pseudoNode,this.objectComparator=t&&t.objectComparator?t.objectComparator:a};function o(t){return t.coordinates.map((function(e){return{type:t.type.replace("Multi",""),coordinates:e}}))}function s(t,e){return t.hasOwnProperty("coordinates")?t.coordinates.length===e.coordinates.length:t.length===e.length}function a(t,e){return n(t,e,{strict:!0})}r.prototype.compare=function(t,e){if(t.type!==e.type||!s(t,e))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,e.coordinates);case"LineString":return this.compareLine(t.coordinates,e.coordinates,0,!1);case"Polygon":return this.comparePolygon(t,e);case"Feature":return this.compareFeature(t,e);default:if(0===t.type.indexOf("Multi")){var i=this,n=o(t),r=o(e);return n.every((function(t){return this.some((function(e){return i.compare(t,e)}))}),r)}}return!1},r.prototype.compareCoord=function(t,e){if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(t[i].toFixed(this.precision)!==e[i].toFixed(this.precision))return!1;return!0},r.prototype.compareLine=function(t,e,i,n){if(!s(t,e))return!1;var r=this.pseudoNode?t:this.removePseudo(t),o=this.pseudoNode?e:this.removePseudo(e);if(!n||this.compareCoord(r[0],o[0])||(o=this.fixStartIndex(o,r))){var a=this.compareCoord(r[i],o[i]);return this.direction||a?this.comparePath(r,o):!!this.compareCoord(r[i],o[o.length-(1+i)])&&this.comparePath(r.slice().reverse(),o)}},r.prototype.fixStartIndex=function(t,e){for(var i,n=-1,r=0;r<t.length;r++)if(this.compareCoord(t[r],e[0])){n=r;break}return n>=0&&(i=[].concat(t.slice(n,t.length),t.slice(1,n+1))),i},r.prototype.comparePath=function(t,e){var i=this;return t.every((function(t,e){return i.compareCoord(t,this[e])}),e)},r.prototype.comparePolygon=function(t,e){if(this.compareLine(t.coordinates[0],e.coordinates[0],1,!0)){var i=t.coordinates.slice(1,t.coordinates.length),n=e.coordinates.slice(1,e.coordinates.length),r=this;return i.every((function(t){return this.some((function(e){return r.compareLine(t,e,1,!0)}))}),n)}return!1},r.prototype.compareFeature=function(t,e){return!(t.id!==e.id||!this.objectComparator(t.properties,e.properties)||!this.compareBBox(t,e))&&this.compare(t.geometry,e.geometry)},r.prototype.compareBBox=function(t,e){return!!(!t.bbox&&!e.bbox||t.bbox&&e.bbox&&this.compareCoord(t.bbox,e.bbox))},r.prototype.removePseudo=function(t){return t},t.exports=r},9565:(t,e,i)=>{var n=i(3861),r=i(8611),o=i(2697),s=i(259).A,a=o.featureEach,l=(o.coordEach,r.polygon,r.featureCollection);function c(t){var e=new n(t);return e.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:s(t),n.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:s(t),e.push(t)})):a(t,(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:s(t),e.push(t)})),n.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:s(t),n.prototype.remove.call(this,t,e)},e.clear=function(){return n.prototype.clear.call(this)},e.search=function(t){var e=n.prototype.search.call(this,this.toBBox(t));return l(e)},e.collides=function(t){return n.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=n.prototype.all.call(this);return l(t)},e.toJSON=function(){return n.prototype.toJSON.call(this)},e.fromJSON=function(t){return n.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=s(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=s(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}t.exports=c,t.exports.default=c},3861:function(t){t.exports=function(){"use strict";function t(t,n,r,o,s){!function t(i,n,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,l=n-r+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);t(i,n,Math.max(r,Math.floor(n-l*u/a+h)),Math.min(o,Math.floor(n+(a-l)*u/a+h)),s)}var d=i[n],p=r,f=o;for(e(i,r,n),s(i[o],d)>0&&e(i,r,o);p<f;){for(e(i,p,f),p++,f--;s(i[p],d)<0;)p++;for(;s(i[f],d)>0;)f--}0===s(i[r],d)?e(i,r,f):e(i,++f,o),f<=n&&(r=f+1),n<=f&&(o=f-1)}}(t,n,r||0,o||t.length-1,s||i)}function e(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function i(t,e){return t<e?-1:t>e?1:0}var n=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function o(t,e){s(t,0,t.children.length,e,t)}function s(t,e,i,n,r){r||(r=f(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o=e;o<i;o++){var s=t.children[o];a(r,t.leaf?n(s):s)}return r}function a(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function h(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function p(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function f(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(e,i,n,r,o){for(var s=[i,n];s.length;)if(!((n=s.pop())-(i=s.pop())<=r)){var a=i+Math.ceil((n-i)/r/2)*r;t(e,a,i,n,o),s.push(i,a,a,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(t){var e=this.data,i=[];if(!p(t,e))return i;for(var n=this.toBBox,r=[];e;){for(var o=0;o<e.children.length;o++){var s=e.children[o],a=e.leaf?n(s):s;p(t,a)&&(e.leaf?i.push(s):d(t,a)?this._all(s,i):r.push(s))}e=r.pop()}return i},n.prototype.collides=function(t){var e=this.data;if(!p(t,e))return!1;for(var i=[];e;){for(var n=0;n<e.children.length;n++){var r=e.children[n],o=e.leaf?this.toBBox(r):r;if(p(t,o)){if(e.leaf||d(t,o))return!0;i.push(r)}}e=i.pop()}return!1},n.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},n.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},n.prototype.clear=function(){return this.data=f([]),this},n.prototype.remove=function(t,e){if(!t)return this;for(var i,n,o,s=this.data,a=this.toBBox(t),l=[],c=[];s||l.length;){if(s||(s=l.pop(),n=l[l.length-1],i=c.pop(),o=!0),s.leaf){var u=r(t,s.children,e);if(-1!==u)return s.children.splice(u,1),l.push(s),this._condense(l),this}o||s.leaf||!d(s,a)?n?(i++,s=n.children[i],o=!1):s=null:(l.push(s),c.push(i),i=0,n=s,s=s.children[0])}return this},n.prototype.toBBox=function(t){return t},n.prototype.compareMinX=function(t,e){return t.minX-e.minX},n.prototype.compareMinY=function(t,e){return t.minY-e.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(t){return this.data=t,this},n.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},n.prototype._build=function(t,e,i,n){var r,s=i-e+1,a=this._maxEntries;if(s<=a)return o(r=f(t.slice(e,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,n-1))),(r=f([])).leaf=!1,r.height=n;var l=Math.ceil(s/a),c=l*Math.ceil(Math.sqrt(a));m(t,e,i,c,this.compareMinX);for(var u=e;u<=i;u+=c){var h=Math.min(u+c-1,i);m(t,u,h,l,this.compareMinY);for(var d=u;d<=h;d+=l){var p=Math.min(d+l-1,h);r.children.push(this._build(t,d,p,n-1))}}return o(r,this.toBBox),r},n.prototype._chooseSubtree=function(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){for(var r=1/0,o=1/0,s=void 0,a=0;a<e.children.length;a++){var l=e.children[a],c=u(l),h=(d=t,p=l,(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-c);h<o?(o=h,r=c<r?c:r,s=l):h===o&&c<r&&(r=c,s=l)}e=s||e.children[0]}var d,p;return e},n.prototype._insert=function(t,e,i){var n=i?t:this.toBBox(t),r=[],o=this._chooseSubtree(n,this.data,e,r);for(o.children.push(t),a(o,n);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(n,r,e)},n.prototype._split=function(t,e){var i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var s=this._chooseSplitIndex(i,r,n),a=f(i.children.splice(s,i.children.length-s));a.height=i.height,a.leaf=i.leaf,o(i,this.toBBox),o(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},n.prototype._splitRoot=function(t,e){this.data=f([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(t,e,i){for(var n,r,o,a,l,c,h,d=1/0,p=1/0,f=e;f<=i-e;f++){var m=s(t,0,f,this.toBBox),g=s(t,f,i,this.toBBox),_=(r=m,o=g,void 0,void 0,void 0,void 0,a=Math.max(r.minX,o.minX),l=Math.max(r.minY,o.minY),c=Math.min(r.maxX,o.maxX),h=Math.min(r.maxY,o.maxY),Math.max(0,c-a)*Math.max(0,h-l)),y=u(m)+u(g);_<d?(d=_,n=f,p=y<p?y:p):_===d&&y<p&&(p=y,n=f)}return n||i-e},n.prototype._chooseSplitAxis=function(t,e,i){var n=t.leaf?this.compareMinX:l,r=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,r)&&t.children.sort(n)},n.prototype._allDistMargin=function(t,e,i,n){t.children.sort(n);for(var r=this.toBBox,o=s(t,0,e,r),l=s(t,i-e,i,r),c=h(o)+h(l),u=e;u<i-e;u++){var d=t.children[u];a(o,t.leaf?r(d):d),c+=h(o)}for(var p=i-e-1;p>=e;p--){var f=t.children[p];a(l,t.leaf?r(f):f),c+=h(l)}return c},n.prototype._adjustParentBBoxes=function(t,e,i){for(var n=i;n>=0;n--)a(e[n],t)},n.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():o(t[e],this.toBBox)},n}()},8897:(t,e,i)=>{"use strict";var n,r=i(219),o=i(3841),s=i(6190),a=i(3950),l=i(6296),c=i(1711),u=i(3221),h=Function,d=function(t){try{return h('"use strict"; return ('+t+").constructor;")()}catch(t){}},p=Object.getOwnPropertyDescriptor;if(p)try{p({},"")}catch(t){p=null}var f=function(){throw new c},m=p?function(){try{return f}catch(t){try{return p(arguments,"callee").get}catch(t){return f}}}():f,g=i(4923)(),_=i(9372)(),y=Object.getPrototypeOf||(_?function(t){return t.__proto__}:null),v={},x="undefined"!=typeof Uint8Array&&y?y(Uint8Array):n,b={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":g&&y?y([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":v,"%AsyncGenerator%":v,"%AsyncGeneratorFunction%":v,"%AsyncIteratorPrototype%":v,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":r,"%eval%":eval,"%EvalError%":o,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":h,"%GeneratorFunction%":v,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":g&&y?y(y([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&g&&y?y((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":s,"%ReferenceError%":a,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&g&&y?y((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":g&&y?y(""[Symbol.iterator]()):n,"%Symbol%":g?Symbol:n,"%SyntaxError%":l,"%ThrowTypeError%":m,"%TypedArray%":x,"%TypeError%":c,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":u,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};if(y)try{null.error}catch(t){var w=y(y(t));b["%Error.prototype%"]=w}var E=function t(e){var i;if("%AsyncFunction%"===e)i=d("async function () {}");else if("%GeneratorFunction%"===e)i=d("function* () {}");else if("%AsyncGeneratorFunction%"===e)i=d("async function* () {}");else if("%AsyncGenerator%"===e){var n=t("%AsyncGeneratorFunction%");n&&(i=n.prototype)}else if("%AsyncIteratorPrototype%"===e){var r=t("%AsyncGenerator%");r&&y&&(i=y(r.prototype))}return b[e]=i,i},S={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},T=i(4499),M=i(4313),I=T.call(Function.call,Array.prototype.concat),C=T.call(Function.apply,Array.prototype.splice),A=T.call(Function.call,String.prototype.replace),P=T.call(Function.call,String.prototype.slice),L=T.call(Function.call,RegExp.prototype.exec),R=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,D=/\\(\\)?/g,k=function(t,e){var i,n=t;if(M(S,n)&&(n="%"+(i=S[n])[0]+"%"),M(b,n)){var r=b[n];if(r===v&&(r=E(n)),void 0===r&&!e)throw new c("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:r}}throw new l("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new c("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new c('"allowMissing" argument must be a boolean');if(null===L(/^%?[^%]*%?$/,t))throw new l("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=function(t){var e=P(t,0,1),i=P(t,-1);if("%"===e&&"%"!==i)throw new l("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==e)throw new l("invalid intrinsic syntax, expected opening `%`");var n=[];return A(t,R,(function(t,e,i,r){n[n.length]=i?A(r,D,"$1"):e||t})),n}(t),n=i.length>0?i[0]:"",r=k("%"+n+"%",e),o=r.name,s=r.value,a=!1,u=r.alias;u&&(n=u[0],C(i,I([0,1],u)));for(var h=1,d=!0;h<i.length;h+=1){var f=i[h],m=P(f,0,1),g=P(f,-1);if(('"'===m||"'"===m||"`"===m||'"'===g||"'"===g||"`"===g)&&m!==g)throw new l("property names with quotes must have matching quotes");if("constructor"!==f&&d||(a=!0),M(b,o="%"+(n+="."+f)+"%"))s=b[o];else if(null!=s){if(!(f in s)){if(!e)throw new c("base intrinsic for "+t+" exists, but the property is not available.");return}if(p&&h+1>=i.length){var _=p(s,f);s=(d=!!_)&&"get"in _&&!("originalValue"in _.get)?_.get:s[f]}else d=M(s,f),s=s[f];d&&!a&&(b[o]=s)}}return s}},1399:(t,e,i)=>{"use strict";var n=i(8897)("%Object.getOwnPropertyDescriptor%",!0);if(n)try{n([],"length")}catch(t){n=null}t.exports=n},6900:(t,e,i)=>{"use strict";var n=i(7539),r=function(){return!!n};r.hasArrayLengthDefineBug=function(){if(!n)return null;try{return 1!==n([],"length",{value:1}).length}catch(t){return!0}},t.exports=r},9372:t=>{"use strict";var e={__proto__:null,foo:{}},i=Object;t.exports=function(){return{__proto__:e}.foo===e.foo&&!(e instanceof i)}},4923:(t,e,i)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,r=i(4361);t.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&r()}},4361:t=>{"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),i=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var n=Object.getOwnPropertySymbols(t);if(1!==n.length||n[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(t,e);if(42!==r.value||!0!==r.enumerable)return!1}return!0}},1432:(t,e,i)=>{"use strict";var n=i(4361);t.exports=function(){return n()&&!!Symbol.toStringTag}},4313:(t,e,i)=>{"use strict";var n=Function.prototype.call,r=Object.prototype.hasOwnProperty,o=i(4499);t.exports=o.call(n,r)},5456:(t,e,i)=>{"use strict";var n=i(1432)(),r=i(9343)("Object.prototype.toString"),o=function(t){return!(n&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===r(t)},s=function(t){return!!o(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==r(t)&&"[object Function]"===r(t.callee)},a=function(){return o(arguments)}();o.isLegacyArguments=s,t.exports=a?o:s},228:(t,e,i)=>{"use strict";var n=Date.prototype.getDay,r=Object.prototype.toString,o=i(1432)();t.exports=function(t){return"object"==typeof t&&null!==t&&(o?function(t){try{return n.call(t),!0}catch(t){return!1}}(t):"[object Date]"===r.call(t))}},7647:(t,e,i)=>{"use strict";var n,r,o,s,a=i(9343),l=i(1432)();if(l){n=a("Object.prototype.hasOwnProperty"),r=a("RegExp.prototype.exec"),o={};var c=function(){throw o};s={toString:c,valueOf:c},"symbol"==typeof Symbol.toPrimitive&&(s[Symbol.toPrimitive]=c)}var u=a("Object.prototype.toString"),h=Object.getOwnPropertyDescriptor;t.exports=l?function(t){if(!t||"object"!=typeof t)return!1;var e=h(t,"lastIndex");if(!e||!n(e,"value"))return!1;try{r(t,s)}catch(t){return t===o}}:function(t){return!(!t||"object"!=typeof t&&"function"!=typeof t)&&"[object RegExp]"===u(t)}},1664:t=>{"use strict";var e=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(t){n[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,r){for(var o,s,a=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),l=1;l<arguments.length;l++){for(var c in o=Object(arguments[l]))i.call(o,c)&&(a[c]=o[c]);if(e){s=e(o);for(var u=0;u<s.length;u++)n.call(o,s[u])&&(a[s[u]]=o[s[u]])}}return a}},6223:t=>{"use strict";var e=function(t){return t!=t};t.exports=function(t,i){return 0===t&&0===i?1/t==1/i:t===i||!(!e(t)||!e(i))}},9513:(t,e,i)=>{"use strict";var n=i(5144),r=i(8179),o=i(6223),s=i(3809),a=i(2700),l=r(s(),Object);n(l,{getPolyfill:s,implementation:o,shim:a}),t.exports=l},3809:(t,e,i)=>{"use strict";var n=i(6223);t.exports=function(){return"function"==typeof Object.is?Object.is:n}},2700:(t,e,i)=>{"use strict";var n=i(3809),r=i(5144);t.exports=function(){var t=n();return r(Object,{is:t},{is:function(){return Object.is!==t}}),t}},1895:(t,e,i)=>{"use strict";var n;if(!Object.keys){var r=Object.prototype.hasOwnProperty,o=Object.prototype.toString,s=i(8825),a=Object.prototype.propertyIsEnumerable,l=!a.call({toString:null},"toString"),c=a.call((function(){}),"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],h=function(t){var e=t.constructor;return e&&e.prototype===t},d={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!d["$"+t]&&r.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{h(window[t])}catch(t){return!0}}catch(t){return!0}return!1}();n=function(t){var e=null!==t&&"object"==typeof t,i="[object Function]"===o.call(t),n=s(t),a=e&&"[object String]"===o.call(t),d=[];if(!e&&!i&&!n)throw new TypeError("Object.keys called on a non-object");var f=c&&i;if(a&&t.length>0&&!r.call(t,0))for(var m=0;m<t.length;++m)d.push(String(m));if(n&&t.length>0)for(var g=0;g<t.length;++g)d.push(String(g));else for(var _ in t)f&&"prototype"===_||!r.call(t,_)||d.push(String(_));if(l)for(var y=function(t){if("undefined"==typeof window||!p)return h(t);try{return h(t)}catch(t){return!1}}(t),v=0;v<u.length;++v)y&&"constructor"===u[v]||!r.call(t,u[v])||d.push(u[v]);return d}}t.exports=n},3425:(t,e,i)=>{"use strict";var n=Array.prototype.slice,r=i(8825),o=Object.keys,s=o?function(t){return o(t)}:i(1895),a=Object.keys;s.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return r(t)?a(n.call(t)):a(t)})}else Object.keys=s;return Object.keys||s},t.exports=s},8825:t=>{"use strict";var e=Object.prototype.toString;t.exports=function(t){var i=e.call(t),n="[object Arguments]"===i;return n||(n="[object Array]"!==i&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===e.call(t.callee)),n}},5021:t=>{t.exports=function(t,e,i,n){var r=t[0],o=t[1],s=!1;void 0===i&&(i=0),void 0===n&&(n=e.length);for(var a=(n-i)/2,l=0,c=a-1;l<a;c=l++){var u=e[i+2*l+0],h=e[i+2*l+1],d=e[i+2*c+0],p=e[i+2*c+1];h>o!=p>o&&r<(d-u)*(o-h)/(p-h)+u&&(s=!s)}return s}},4440:(t,e,i)=>{var n=i(5021),r=i(4141);t.exports=function(t,e,i,o){return e.length>0&&Array.isArray(e[0])?r(t,e,i,o):n(t,e,i,o)},t.exports.nested=r,t.exports.flat=n},4141:t=>{t.exports=function(t,e,i,n){var r=t[0],o=t[1],s=!1;void 0===i&&(i=0),void 0===n&&(n=e.length);for(var a=n-i,l=0,c=a-1;l<a;c=l++){var u=e[l+i][0],h=e[l+i][1],d=e[c+i][0],p=e[c+i][1];h>o!=p>o&&r<(d-u)*(o-h)/(p-h)+u&&(s=!s)}return s}},1640:function(t){t.exports=function(){"use strict";function t(t,e){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var e=function(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null};function i(t,e){return t>e?1:t<e?-1:0}function n(t,i,n){for(var r=new e(null,null),o=r,s=r;;){var a=n(t,i.key);if(a<0){if(null===i.left)break;if(n(t,i.left.key)<0){var l=i.left;if(i.left=l.right,l.right=i,null===(i=l).left)break}s.left=i,s=i,i=i.left}else{if(!(a>0))break;if(null===i.right)break;if(n(t,i.right.key)>0&&(l=i.right,i.right=l.left,l.left=i,null===(i=l).right))break;o.right=i,o=i,i=i.right}}return o.right=i.left,s.left=i.right,i.left=r.right,i.right=r.left,i}function r(t,i,r,o){var s=new e(t,i);if(null===r)return s.left=s.right=null,s;var a=o(t,(r=n(t,r,o)).key);return a<0?(s.left=r.left,s.right=r,r.left=null):a>=0&&(s.right=r.right,s.left=r,r.right=null),s}function o(t,e,i){var r=null,o=null;if(e){var s=i((e=n(t,e,i)).key,t);0===s?(r=e.left,o=e.right):s<0?(o=e.right,e.right=null,r=e):(r=e.left,e.left=null,o=e)}return{left:r,right:o}}function s(t,e,i,n,r){if(t){n(e+(i?" ":" ")+r(t)+"\n");var o=e+(i?"    ":"   ");t.left&&s(t.left,o,!1,n,r),t.right&&s(t.right,o,!0,n,r)}}var a=function(){function a(t){void 0===t&&(t=i),this._root=null,this._size=0,this._comparator=t}return a.prototype.insert=function(t,e){return this._size++,this._root=r(t,e,this._root,this._comparator)},a.prototype.add=function(t,i){var r=new e(t,i);null===this._root&&(r.left=r.right=null,this._size++,this._root=r);var o=this._comparator,s=n(t,this._root,o),a=o(t,s.key);return 0===a?this._root=s:(a<0?(r.left=s.left,r.right=s,s.left=null):a>0&&(r.right=s.right,r.left=s,s.right=null),this._size++,this._root=r),this._root},a.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},a.prototype._remove=function(t,e,i){var r;return null===e?null:0===i(t,(e=n(t,e,i)).key)?(null===e.left?r=e.right:(r=n(t,e.left,i)).right=e.right,this._size--,r):e},a.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=n(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},a.prototype.findStatic=function(t){for(var e=this._root,i=this._comparator;e;){var n=i(t,e.key);if(0===n)return e;e=n<0?e.left:e.right}return null},a.prototype.find=function(t){return this._root&&(this._root=n(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},a.prototype.contains=function(t){for(var e=this._root,i=this._comparator;e;){var n=i(t,e.key);if(0===n)return!0;e=n<0?e.left:e.right}return!1},a.prototype.forEach=function(t,e){for(var i=this._root,n=[],r=!1;!r;)null!==i?(n.push(i),i=i.left):0!==n.length?(i=n.pop(),t.call(e,i),i=i.right):r=!0;return this},a.prototype.range=function(t,e,i,n){for(var r=[],o=this._comparator,s=this._root;0!==r.length||s;)if(s)r.push(s),s=s.left;else{if(o((s=r.pop()).key,e)>0)break;if(o(s.key,t)>=0&&i.call(n,s))return this;s=s.right}return this},a.prototype.keys=function(){var t=[];return this.forEach((function(e){var i=e.key;return t.push(i)})),t},a.prototype.values=function(){var t=[];return this.forEach((function(e){var i=e.data;return t.push(i)})),t},a.prototype.min=function(){return this._root?this.minNode(this._root).key:null},a.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},a.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},a.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},a.prototype.at=function(t){for(var e=this._root,i=!1,n=0,r=[];!i;)if(e)r.push(e),e=e.left;else if(r.length>0){if(e=r.pop(),n===t)return e;n++,e=e.right}else i=!0;return null},a.prototype.next=function(t){var e=this._root,i=null;if(t.right){for(i=t.right;i.left;)i=i.left;return i}for(var n=this._comparator;e;){var r=n(t.key,e.key);if(0===r)break;r<0?(i=e,e=e.left):e=e.right}return i},a.prototype.prev=function(t){var e=this._root,i=null;if(null!==t.left){for(i=t.left;i.right;)i=i.right;return i}for(var n=this._comparator;e;){var r=n(t.key,e.key);if(0===r)break;r<0?e=e.left:(i=e,e=e.right)}return i},a.prototype.clear=function(){return this._root=null,this._size=0,this},a.prototype.toList=function(){return function(t){for(var i=t,n=[],r=!1,o=new e(null,null),s=o;!r;)i?(n.push(i),i=i.left):n.length>0?i=(i=s=s.next=n.pop()).right:r=!0;return s.next=null,o.next}(this._root)},a.prototype.load=function(t,i,n){void 0===i&&(i=[]),void 0===n&&(n=!1);var r=t.length,o=this._comparator;if(n&&u(t,i,0,r-1,o),null===this._root)this._root=l(t,i,0,r),this._size=r;else{var s=function(t,i,n){for(var r=new e(null,null),o=r,s=t,a=i;null!==s&&null!==a;)n(s.key,a.key)<0?(o.next=s,s=s.next):(o.next=a,a=a.next),o=o.next;return null!==s?o.next=s:null!==a&&(o.next=a),r.next}(this.toList(),function(t,i){for(var n=new e(null,null),r=n,o=0;o<t.length;o++)r=r.next=new e(t[o],i[o]);return r.next=null,n.next}(t,i),o);r=this._size+r,this._root=c({head:s},0,r)}return this},a.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),a.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return s(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},a.prototype.update=function(t,e,i){var s=this._comparator,a=o(t,this._root,s),l=a.left,c=a.right;s(t,e)<0?c=r(e,i,c,s):l=r(e,i,l,s),this._root=function(t,e,i){return null===e?t:(null===t||((e=n(t.key,e,i)).left=t),e)}(l,c,s)},a.prototype.split=function(t){return o(t,this._root,this._comparator)},a.prototype[Symbol.iterator]=function(){var e,i,n;return t(this,(function(t){switch(t.label){case 0:e=this._root,i=[],n=!1,t.label=1;case 1:return n?[3,6]:null===e?[3,2]:(i.push(e),e=e.left,[3,5]);case 2:return 0===i.length?[3,4]:[4,e=i.pop()];case 3:return t.sent(),e=e.right,[3,5];case 4:n=!0,t.label=5;case 5:return[3,1];case 6:return[2]}}))},a}();function l(t,i,n,r){var o=r-n;if(o>0){var s=n+Math.floor(o/2),a=t[s],c=i[s],u=new e(a,c);return u.left=l(t,i,n,s),u.right=l(t,i,s+1,r),u}return null}function c(t,e,i){var n=i-e;if(n>0){var r=e+Math.floor(n/2),o=c(t,e,r),s=t.head;return s.left=o,t.head=t.head.next,s.right=c(t,r+1,i),s}return null}function u(t,e,i,n,r){if(!(i>=n)){for(var o=t[i+n>>1],s=i-1,a=n+1;;){do{s++}while(r(t[s],o)<0);do{a--}while(r(t[a],o)>0);if(s>=a)break;var l=t[s];t[s]=t[a],t[a]=l,l=e[s],e[s]=e[a],e[a]=l}u(t,e,i,a,r),u(t,e,a+1,n,r)}}const h=(t,e)=>t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y,d=(t,e)=>{if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;const i=t.ll.x<e.ll.x?e.ll.x:t.ll.x,n=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:i,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:n,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}};let p=Number.EPSILON;void 0===p&&(p=Math.pow(2,-52));const f=p*p,m=(t,e)=>{if(-p<t&&t<p&&-p<e&&e<p)return 0;const i=t-e;return i*i<f*t*e?0:t<e?-1:1};class g{constructor(){this.tree=new a,this.round(0)}round(t){const e=this.tree.add(t),i=this.tree.prev(e);if(null!==i&&0===m(e.key,i.key))return this.tree.remove(t),i.key;const n=this.tree.next(e);return null!==n&&0===m(e.key,n.key)?(this.tree.remove(t),n.key):t}}const _=new class{constructor(){this.reset()}reset(){this.xRounder=new g,this.yRounder=new g}round(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}},y=11102230246251565e-32,v=134217729,x=(3+8*y)*y;function b(t,e,i,n,r){let o,s,a,l,c=e[0],u=n[0],h=0,d=0;u>c==u>-c?(o=c,c=e[++h]):(o=u,u=n[++d]);let p=0;if(h<t&&d<i)for(u>c==u>-c?(s=c+o,a=o-(s-c),c=e[++h]):(s=u+o,a=o-(s-u),u=n[++d]),o=s,0!==a&&(r[p++]=a);h<t&&d<i;)u>c==u>-c?(s=o+c,l=s-o,a=o-(s-l)+(c-l),c=e[++h]):(s=o+u,l=s-o,a=o-(s-l)+(u-l),u=n[++d]),o=s,0!==a&&(r[p++]=a);for(;h<t;)s=o+c,l=s-o,a=o-(s-l)+(c-l),c=e[++h],o=s,0!==a&&(r[p++]=a);for(;d<i;)s=o+u,l=s-o,a=o-(s-l)+(u-l),u=n[++d],o=s,0!==a&&(r[p++]=a);return 0===o&&0!==p||(r[p++]=o),p}function w(t){return new Float64Array(t)}const E=22204460492503146e-32,S=11093356479670487e-47,T=w(4),M=w(8),I=w(12),C=w(16),A=w(4);function P(t,e,i,n,r,o){const s=(e-o)*(i-r),a=(t-r)*(n-o),l=s-a,c=Math.abs(s+a);return Math.abs(l)>=33306690738754716e-32*c?l:-function(t,e,i,n,r,o,s){let a,l,c,u,h,d,p,f,m,g,_,y,w,P,L,R,D,k;const N=t-r,O=i-r,F=e-o,z=n-o;P=N*z,d=v*N,p=d-(d-N),f=N-p,d=v*z,m=d-(d-z),g=z-m,L=f*g-(P-p*m-f*m-p*g),R=F*O,d=v*F,p=d-(d-F),f=F-p,d=v*O,m=d-(d-O),g=O-m,D=f*g-(R-p*m-f*m-p*g),_=L-D,h=L-_,T[0]=L-(_+h)+(h-D),y=P+_,h=y-P,w=P-(y-h)+(_-h),_=w-R,h=w-_,T[1]=w-(_+h)+(h-R),k=y+_,h=k-y,T[2]=y-(k-h)+(_-h),T[3]=k;let B=function(t,e){let i=e[0];for(let n=1;n<t;n++)i+=e[n];return i}(4,T),U=E*s;if(B>=U||-B>=U)return B;if(h=t-N,a=t-(N+h)+(h-r),h=i-O,c=i-(O+h)+(h-r),h=e-F,l=e-(F+h)+(h-o),h=n-z,u=n-(z+h)+(h-o),0===a&&0===l&&0===c&&0===u)return B;if(U=S*s+x*Math.abs(B),B+=N*u+z*a-(F*c+O*l),B>=U||-B>=U)return B;P=a*z,d=v*a,p=d-(d-a),f=a-p,d=v*z,m=d-(d-z),g=z-m,L=f*g-(P-p*m-f*m-p*g),R=l*O,d=v*l,p=d-(d-l),f=l-p,d=v*O,m=d-(d-O),g=O-m,D=f*g-(R-p*m-f*m-p*g),_=L-D,h=L-_,A[0]=L-(_+h)+(h-D),y=P+_,h=y-P,w=P-(y-h)+(_-h),_=w-R,h=w-_,A[1]=w-(_+h)+(h-R),k=y+_,h=k-y,A[2]=y-(k-h)+(_-h),A[3]=k;const V=b(4,T,4,A,M);P=N*u,d=v*N,p=d-(d-N),f=N-p,d=v*u,m=d-(d-u),g=u-m,L=f*g-(P-p*m-f*m-p*g),R=F*c,d=v*F,p=d-(d-F),f=F-p,d=v*c,m=d-(d-c),g=c-m,D=f*g-(R-p*m-f*m-p*g),_=L-D,h=L-_,A[0]=L-(_+h)+(h-D),y=P+_,h=y-P,w=P-(y-h)+(_-h),_=w-R,h=w-_,A[1]=w-(_+h)+(h-R),k=y+_,h=k-y,A[2]=y-(k-h)+(_-h),A[3]=k;const j=b(V,M,4,A,I);P=a*u,d=v*a,p=d-(d-a),f=a-p,d=v*u,m=d-(d-u),g=u-m,L=f*g-(P-p*m-f*m-p*g),R=l*c,d=v*l,p=d-(d-l),f=l-p,d=v*c,m=d-(d-c),g=c-m,D=f*g-(R-p*m-f*m-p*g),_=L-D,h=L-_,A[0]=L-(_+h)+(h-D),y=P+_,h=y-P,w=P-(y-h)+(_-h),_=w-R,h=w-_,A[1]=w-(_+h)+(h-R),k=y+_,h=k-y,A[2]=y-(k-h)+(_-h),A[3]=k;const G=b(j,I,4,A,C);return C[G-1]}(t,e,i,n,r,o,c)}const L=(t,e)=>t.x*e.y-t.y*e.x,R=(t,e)=>t.x*e.x+t.y*e.y,D=(t,e,i)=>{const n=P(t.x,t.y,e.x,e.y,i.x,i.y);return n>0?-1:n<0?1:0},k=t=>Math.sqrt(R(t,t)),N=(t,e,i)=>{const n={x:e.x-t.x,y:e.y-t.y},r={x:i.x-t.x,y:i.y-t.y};return L(r,n)/k(r)/k(n)},O=(t,e,i)=>{const n={x:e.x-t.x,y:e.y-t.y},r={x:i.x-t.x,y:i.y-t.y};return R(r,n)/k(r)/k(n)},F=(t,e,i)=>0===e.y?null:{x:t.x+e.x/e.y*(i-t.y),y:i},z=(t,e,i)=>0===e.x?null:{x:i,y:t.y+e.y/e.x*(i-t.x)};class B{static compare(t,e){const i=B.comparePoints(t.point,e.point);return 0!==i?i:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:V.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}constructor(t,e){void 0===t.events?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const i=this.point.events[e];if(void 0===i.segment.consumedBy)for(let n=e+1;n<t;n++){const t=this.point.events[n];void 0===t.consumedBy&&i.otherSE.point.events===t.otherSE.point.events&&i.segment.consume(t.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,i=this.point.events.length;e<i;e++){const i=this.point.events[e];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}getLeftmostComparator(t){const e=new Map,i=i=>{const n=i.otherSE;e.set(i,{sine:N(this.point,t.point,n.point),cosine:O(this.point,t.point,n.point)})};return(t,n)=>{e.has(t)||i(t),e.has(n)||i(n);const{sine:r,cosine:o}=e.get(t),{sine:s,cosine:a}=e.get(n);return r>=0&&s>=0?o<a?1:o>a?-1:0:r<0&&s<0?o<a?-1:o>a?1:0:s<r?-1:s>r?1:0}}}let U=0;class V{static compare(t,e){const i=t.leftSE.point.x,n=e.leftSE.point.x,r=t.rightSE.point.x,o=e.rightSE.point.x;if(o<i)return 1;if(r<n)return-1;const s=t.leftSE.point.y,a=e.leftSE.point.y,l=t.rightSE.point.y,c=e.rightSE.point.y;if(i<n){if(a<s&&a<l)return 1;if(a>s&&a>l)return-1;const i=t.comparePoint(e.leftSE.point);if(i<0)return 1;if(i>0)return-1;const n=e.comparePoint(t.rightSE.point);return 0!==n?n:-1}if(i>n){if(s<a&&s<c)return-1;if(s>a&&s>c)return 1;const i=e.comparePoint(t.leftSE.point);if(0!==i)return i;const n=t.comparePoint(e.rightSE.point);return n<0?1:n>0?-1:1}if(s<a)return-1;if(s>a)return 1;if(r<o){const i=e.comparePoint(t.rightSE.point);if(0!==i)return i}if(r>o){const i=t.comparePoint(e.rightSE.point);if(i<0)return 1;if(i>0)return-1}if(r!==o){const t=l-s,e=r-i,u=c-a,h=o-n;if(t>e&&u<h)return 1;if(t<e&&u>h)return-1}return r>o?1:r<o||l<c?-1:l>c?1:t.id<e.id?-1:t.id>e.id?1:0}constructor(t,e,i,n){this.id=++U,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=i,this.windings=n}static fromRing(t,e,i){let n,r,o;const s=B.comparePoints(t,e);if(s<0)n=t,r=e,o=1;else{if(!(s>0))throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);n=e,r=t,o=-1}const a=new B(n,!0),l=new B(r,!1);return new V(a,l,[i],[o])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const e=this.leftSE.point,i=this.rightSE.point,n=this.vector();if(e.x===i.x)return t.x===e.x?0:t.x<e.x?1:-1;const r=(t.y-e.y)/n.y,o=e.x+r*n.x;if(t.x===o)return 0;const s=(t.x-e.x)/n.x,a=e.y+s*n.y;return t.y===a?0:t.y<a?-1:1}getIntersection(t){const e=this.bbox(),i=t.bbox(),n=d(e,i);if(null===n)return null;const r=this.leftSE.point,o=this.rightSE.point,s=t.leftSE.point,a=t.rightSE.point,l=h(e,s)&&0===this.comparePoint(s),c=h(i,r)&&0===t.comparePoint(r),u=h(e,a)&&0===this.comparePoint(a),p=h(i,o)&&0===t.comparePoint(o);if(c&&l)return p&&!u?o:!p&&u?a:null;if(c)return u&&r.x===a.x&&r.y===a.y?null:r;if(l)return p&&o.x===s.x&&o.y===s.y?null:s;if(p&&u)return null;if(p)return o;if(u)return a;const f=((t,e,i,n)=>{if(0===e.x)return z(i,n,t.x);if(0===n.x)return z(t,e,i.x);if(0===e.y)return F(i,n,t.y);if(0===n.y)return F(t,e,i.y);const r=L(e,n);if(0==r)return null;const o={x:i.x-t.x,y:i.y-t.y},s=L(o,e)/r,a=L(o,n)/r;return{x:(t.x+a*e.x+(i.x+s*n.x))/2,y:(t.y+a*e.y+(i.y+s*n.y))/2}})(r,this.vector(),s,t.vector());return null===f?null:h(n,f)?_.round(f.x,f.y):null}split(t){const e=[],i=void 0!==t.events,n=new B(t,!0),r=new B(t,!1),o=this.rightSE;this.replaceRightSE(r),e.push(r),e.push(n);const s=new V(n,o,this.rings.slice(),this.windings.slice());return B.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),B.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(n.checkForConsuming(),r.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,e=this.windings.length;t<e;t++)this.windings[t]*=-1}consume(t){let e=this,i=t;for(;e.consumedBy;)e=e.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const n=V.compare(e,i);if(0!==n){if(n>0){const t=e;e=i,i=t}if(e.prev===i){const t=e;e=i,i=t}for(let t=0,n=i.rings.length;t<n;t++){const n=i.rings[t],r=i.windings[t],o=e.rings.indexOf(n);-1===o?(e.rings.push(n),e.windings.push(r)):e.windings[o]+=r}i.rings=null,i.windings=null,i.consumedBy=e,i.leftSE.consumedBy=e.leftSE,i.rightSE.consumedBy=e.rightSE}}prevInResult(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}beforeState(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}afterState(){if(void 0!==this._afterState)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,i=this._afterState.windings,n=this._afterState.multiPolys;for(let t=0,n=this.rings.length;t<n;t++){const n=this.rings[t],r=this.windings[t],o=e.indexOf(n);-1===o?(e.push(n),i.push(r)):i[o]+=r}const r=[],o=[];for(let t=0,n=e.length;t<n;t++){if(0===i[t])continue;const n=e[t],s=n.poly;if(-1===o.indexOf(s))if(n.isExterior)r.push(s);else{-1===o.indexOf(s)&&o.push(s);const t=r.indexOf(n.poly);-1!==t&&r.splice(t,1)}}for(let t=0,e=r.length;t<e;t++){const e=r[t].multiPoly;-1===n.indexOf(e)&&n.push(e)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(K.type){case"union":{const i=0===t.length,n=0===e.length;this._isInResult=i!==n;break}case"intersection":{let i,n;t.length<e.length?(i=t.length,n=e.length):(i=e.length,n=t.length),this._isInResult=n===K.numMultiPolys&&i<n;break}case"xor":{const i=Math.abs(t.length-e.length);this._isInResult=i%2==1;break}case"difference":{const i=t=>1===t.length&&t[0].isSubject;this._isInResult=i(t)!==i(e);break}default:throw new Error(`Unrecognized operation type found ${K.type}`)}return this._isInResult}}class j{constructor(t,e,i){if(!Array.isArray(t)||0===t.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=i,this.segments=[],"number"!=typeof t[0][0]||"number"!=typeof t[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const n=_.round(t[0][0],t[0][1]);this.bbox={ll:{x:n.x,y:n.y},ur:{x:n.x,y:n.y}};let r=n;for(let e=1,i=t.length;e<i;e++){if("number"!=typeof t[e][0]||"number"!=typeof t[e][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let i=_.round(t[e][0],t[e][1]);i.x===r.x&&i.y===r.y||(this.segments.push(V.fromRing(r,i,this)),i.x<this.bbox.ll.x&&(this.bbox.ll.x=i.x),i.y<this.bbox.ll.y&&(this.bbox.ll.y=i.y),i.x>this.bbox.ur.x&&(this.bbox.ur.x=i.x),i.y>this.bbox.ur.y&&(this.bbox.ur.y=i.y),r=i)}n.x===r.x&&n.y===r.y||this.segments.push(V.fromRing(r,n,this))}getSweepEvents(){const t=[];for(let e=0,i=this.segments.length;e<i;e++){const i=this.segments[e];t.push(i.leftSE),t.push(i.rightSE)}return t}}class G{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new j(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let e=1,i=t.length;e<i;e++){const i=new j(t[e],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,i=this.interiorRings.length;e<i;e++){const i=this.interiorRings[e].getSweepEvents();for(let e=0,n=i.length;e<n;e++)t.push(i[e])}return t}}class H{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof t[0][0][0]&&(t=[t])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let e=0,i=t.length;e<i;e++){const i=new G(t[e],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,i=this.polys.length;e<i;e++){const i=this.polys[e].getSweepEvents();for(let e=0,n=i.length;e<n;e++)t.push(i[e])}return t}}class W{static factory(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];if(!n.isInResult()||n.ringOut)continue;let r=null,o=n.leftSE,s=n.rightSE;const a=[o],l=o.point,c=[];for(;r=o,o=s,a.push(o),o.point!==l;)for(;;){const t=o.getAvailableLinkedEvents();if(0===t.length){const t=a[0].point,e=a[a.length-1].point;throw new Error(`Unable to complete output ring starting at [${t.x}, ${t.y}]. Last matching segment found ends at [${e.x}, ${e.y}].`)}if(1===t.length){s=t[0].otherSE;break}let i=null;for(let t=0,e=c.length;t<e;t++)if(c[t].point===o.point){i=t;break}if(null!==i){const t=c.splice(i)[0],n=a.splice(t.index);n.unshift(n[0].otherSE),e.push(new W(n.reverse()));continue}c.push({index:a.length,point:o.point});const n=o.getLeftmostComparator(r);s=t.sort(n)[0].otherSE;break}e.push(new W(a))}return e}constructor(t){this.events=t;for(let e=0,i=t.length;e<i;e++)t[e].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const e=[t];for(let i=1,n=this.events.length-1;i<n;i++){const n=this.events[i].point,r=this.events[i+1].point;0!==D(n,t,r)&&(e.push(n),t=n)}if(1===e.length)return null;const i=e[0],n=e[1];0===D(i,t,n)&&e.shift(),e.push(e[0]);const r=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:e.length-1,s=this.isExteriorRing()?e.length:-1,a=[];for(let t=o;t!=s;t+=r)a.push([e[t].x,e[t].y]);return a}isExteriorRing(){if(void 0===this._isExteriorRing){const t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}enclosingRing(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let e=1,i=this.events.length;e<i;e++){const i=this.events[e];B.compare(t,i)>0&&(t=i)}let e=t.segment.prevInResult(),i=e?e.prevInResult():null;for(;;){if(!e)return null;if(!i)return e.ringOut;if(i.ringOut!==e.ringOut)return i.ringOut.enclosingRing()!==e.ringOut?e.ringOut:e.ringOut.enclosingRing();e=i.prevInResult(),i=e?e.prevInResult():null}}}class q{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(let e=0,i=this.interiorRings.length;e<i;e++){const i=this.interiorRings[e].getGeom();null!==i&&t.push(i)}return t}}class X{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,i=this.polys.length;e<i;e++){const i=this.polys[e].getGeom();null!==i&&t.push(i)}return t}_composePolys(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];if(!n.poly)if(n.isExteriorRing())e.push(new q(n));else{const t=n.enclosingRing();t.poly||e.push(new q(t)),t.poly.addInterior(n)}}return e}}class ${constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V.compare;this.queue=t,this.tree=new a(e),this.segments=[]}process(t){const e=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),i;const n=t.isLeft?this.tree.add(e):this.tree.find(e);if(!n)throw new Error(`Unable to find segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] in SweepLine tree.`);let r,o,s=n,a=n;for(;void 0===r;)s=this.tree.prev(s),null===s?r=null:void 0===s.key.consumedBy&&(r=s.key);for(;void 0===o;)a=this.tree.next(a),null===a?o=null:void 0===a.key.consumedBy&&(o=a.key);if(t.isLeft){let n=null;if(r){const t=r.getIntersection(e);if(null!==t&&(e.isAnEndpoint(t)||(n=t),!r.isAnEndpoint(t))){const e=this._splitSafely(r,t);for(let t=0,n=e.length;t<n;t++)i.push(e[t])}}let s=null;if(o){const t=o.getIntersection(e);if(null!==t&&(e.isAnEndpoint(t)||(s=t),!o.isAnEndpoint(t))){const e=this._splitSafely(o,t);for(let t=0,n=e.length;t<n;t++)i.push(e[t])}}if(null!==n||null!==s){let t=null;t=null===n?s:null===s||B.comparePoints(n,s)<=0?n:s,this.queue.remove(e.rightSE),i.push(e.rightSE);const r=e.split(t);for(let t=0,e=r.length;t<e;t++)i.push(r[t])}i.length>0?(this.tree.remove(e),i.push(t)):(this.segments.push(e),e.prev=r)}else{if(r&&o){const t=r.getIntersection(o);if(null!==t){if(!r.isAnEndpoint(t)){const e=this._splitSafely(r,t);for(let t=0,n=e.length;t<n;t++)i.push(e[t])}if(!o.isAnEndpoint(t)){const e=this._splitSafely(o,t);for(let t=0,n=e.length;t<n;t++)i.push(e[t])}}}this.tree.remove(e)}return i}_splitSafely(t,e){this.tree.remove(t);const i=t.rightSE;this.queue.remove(i);const n=t.split(e);return n.push(i),void 0===t.consumedBy&&this.tree.add(t),n}}const Y="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Z="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;const K=new class{run(t,e,i){K.type=t,_.reset();const n=[new H(e,!0)];for(let t=0,e=i.length;t<e;t++)n.push(new H(i[t],!1));if(K.numMultiPolys=n.length,"difference"===K.type){const t=n[0];let e=1;for(;e<n.length;)null!==d(n[e].bbox,t.bbox)?e++:n.splice(e,1)}if("intersection"===K.type)for(let t=0,e=n.length;t<e;t++){const e=n[t];for(let i=t+1,r=n.length;i<r;i++)if(null===d(e.bbox,n[i].bbox))return[]}const r=new a(B.compare);for(let t=0,e=n.length;t<e;t++){const e=n[t].getSweepEvents();for(let t=0,i=e.length;t<i;t++)if(r.insert(e[t]),r.size>Y)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const o=new $(r);let s=r.size,l=r.pop();for(;l;){const t=l.key;if(r.size===s){const e=t.segment;throw new Error(`Unable to pop() ${t.isLeft?"left":"right"} SweepEvent [${t.point.x}, ${t.point.y}] from segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] from queue.`)}if(r.size>Y)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(o.segments.length>Z)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const e=o.process(t);for(let t=0,i=e.length;t<i;t++){const i=e[t];void 0===i.consumedBy&&r.insert(i)}s=r.size,l=r.pop()}_.reset();const c=W.factory(o.segments);return new X(c).getGeom()}};return{union:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return K.run("union",t,i)},intersection:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return K.run("intersection",t,i)},xor:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return K.run("xor",t,i)},difference:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return K.run("difference",t,i)}}}()},4067:function(t){t.exports=function(){"use strict";function t(i,n,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,l=n-r+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);t(i,n,Math.max(r,Math.floor(n-l*u/a+h)),Math.min(o,Math.floor(n+(a-l)*u/a+h)),s)}var d=i[n],p=r,f=o;for(e(i,r,n),s(i[o],d)>0&&e(i,r,o);p<f;){for(e(i,p,f),p++,f--;s(i[p],d)<0;)p++;for(;s(i[f],d)>0;)f--}0===s(i[r],d)?e(i,r,f):e(i,++f,o),f<=n&&(r=f+1),n<=f&&(o=f-1)}}function e(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function i(t,e){return t<e?-1:t>e?1:0}return function(e,n,r,o,s){t(e,n,r||0,o||e.length-1,s||i)}}()},5011:(t,e,i)=>{"use strict";t.exports=r,t.exports.default=r;var n=i(4067);function r(t,e){if(!(this instanceof r))return new r(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function o(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function s(t,e){a(t,0,t.children.length,e,t)}function a(t,e,i,n,r){r||(r=m(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o,s=e;s<i;s++)o=t.children[s],l(r,t.leaf?n(o):o);return r}function l(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function c(t,e){return t.minX-e.minX}function u(t,e){return t.minY-e.minY}function h(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function d(t){return t.maxX-t.minX+(t.maxY-t.minY)}function p(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function f(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function m(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,e,i,r,o){for(var s,a=[e,i];a.length;)(i=a.pop())-(e=a.pop())<=r||(s=e+Math.ceil((i-e)/r/2)*r,n(t,s,e,i,o),a.push(e,s,s,i))}r.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],n=this.toBBox;if(!f(t,e))return i;for(var r,o,s,a,l=[];e;){for(r=0,o=e.children.length;r<o;r++)s=e.children[r],f(t,a=e.leaf?n(s):s)&&(e.leaf?i.push(s):p(t,a)?this._all(s,i):l.push(s));e=l.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!f(t,e))return!1;for(var n,r,o,s,a=[];e;){for(n=0,r=e.children.length;n<r;n++)if(o=e.children[n],f(t,s=e.leaf?i(o):o)){if(e.leaf||p(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=m([]),this},remove:function(t,e){if(!t)return this;for(var i,n,r,s,a=this.data,l=this.toBBox(t),c=[],u=[];a||c.length;){if(a||(a=c.pop(),n=c[c.length-1],i=u.pop(),s=!0),a.leaf&&-1!==(r=o(t,a.children,e)))return a.children.splice(r,1),c.push(a),this._condense(c),this;s||a.leaf||!p(a,l)?n?(i++,a=n.children[i],s=!1):a=null:(c.push(a),u.push(i),i=0,n=a,a=a.children[0])}return this},toBBox:function(t){return t},compareMinX:c,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,n){var r,o=i-e+1,a=this._maxEntries;if(o<=a)return s(r=m(t.slice(e,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),(r=m([])).leaf=!1,r.height=n;var l,c,u,h,d=Math.ceil(o/a),p=d*Math.ceil(Math.sqrt(a));for(g(t,e,i,p,this.compareMinX),l=e;l<=i;l+=p)for(g(t,l,u=Math.min(l+p-1,i),d,this.compareMinY),c=l;c<=u;c+=d)h=Math.min(c+d-1,u),r.children.push(this._build(t,c,h,n-1));return s(r,this.toBBox),r},_chooseSubtree:function(t,e,i,n){for(var r,o,s,a,l,c,u,d,p,f;n.push(e),!e.leaf&&n.length-1!==i;){for(u=d=1/0,r=0,o=e.children.length;r<o;r++)l=h(s=e.children[r]),p=t,f=s,(c=(Math.max(f.maxX,p.maxX)-Math.min(f.minX,p.minX))*(Math.max(f.maxY,p.maxY)-Math.min(f.minY,p.minY))-l)<d?(d=c,u=l<u?l:u,a=s):c===d&&l<u&&(u=l,a=s);e=a||e.children[0]}return e},_insert:function(t,e,i){var n=this.toBBox,r=i?t:n(t),o=[],s=this._chooseSubtree(r,this.data,e,o);for(s.children.push(t),l(s,r);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(r,o,e)},_split:function(t,e){var i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var o=this._chooseSplitIndex(i,r,n),a=m(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,s(i,this.toBBox),s(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},_splitRoot:function(t,e){this.data=m([t,e]),this.data.height=t.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var n,r,o,s,l,c,u,d,p,f,m,g,_,y;for(c=u=1/0,n=e;n<=i-e;n++)p=r=a(t,0,n,this.toBBox),f=o=a(t,n,i,this.toBBox),void 0,void 0,void 0,void 0,m=Math.max(p.minX,f.minX),g=Math.max(p.minY,f.minY),_=Math.min(p.maxX,f.maxX),y=Math.min(p.maxY,f.maxY),s=Math.max(0,_-m)*Math.max(0,y-g),l=h(r)+h(o),s<c?(c=s,d=n,u=l<u?l:u):s===c&&l<u&&(u=l,d=n);return d},_chooseSplitAxis:function(t,e,i){var n=t.leaf?this.compareMinX:c,r=t.leaf?this.compareMinY:u;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,r)&&t.children.sort(n)},_allDistMargin:function(t,e,i,n){t.children.sort(n);var r,o,s=this.toBBox,c=a(t,0,e,s),u=a(t,i-e,i,s),h=d(c)+d(u);for(r=e;r<i-e;r++)o=t.children[r],l(c,t.leaf?s(o):o),h+=d(c);for(r=i-e-1;r>=e;r--)o=t.children[r],l(u,t.leaf?s(o):o),h+=d(u);return h},_adjustParentBBoxes:function(t,e,i){for(var n=i;n>=0;n--)l(e[n],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():s(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},4207:(t,e,i)=>{"use strict";var n=i(3426),r=i(1711),o=Object;t.exports=n((function(){if(null==this||this!==o(this))throw new r("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t}),"get flags",!0)},9353:(t,e,i)=>{"use strict";var n=i(5144),r=i(8179),o=i(4207),s=i(2318),a=i(2156),l=r(s());n(l,{getPolyfill:s,implementation:o,shim:a}),t.exports=l},2318:(t,e,i)=>{"use strict";var n=i(4207),r=i(5144).supportsDescriptors,o=Object.getOwnPropertyDescriptor;t.exports=function(){if(r&&"gim"===/a/gim.flags){var t=o(RegExp.prototype,"flags");if(t&&"function"==typeof t.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var e="",i={};if(Object.defineProperty(i,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(i,"sticky",{get:function(){e+="y"}}),"dy"===e)return t.get}}return n}},2156:(t,e,i)=>{"use strict";var n=i(5144).supportsDescriptors,r=i(2318),o=Object.getOwnPropertyDescriptor,s=Object.defineProperty,a=TypeError,l=Object.getPrototypeOf,c=/a/;t.exports=function(){if(!n||!l)throw new a("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=r(),e=l(c),i=o(e,"flags");return i&&i.get===t||s(e,"flags",{configurable:!0,enumerable:!1,get:t}),t}},1247:function(t,e){!function(t){"use strict";const e=134217729;function i(t,e,i,n,r){let o,s,a,l,c=e[0],u=n[0],h=0,d=0;u>c==u>-c?(o=c,c=e[++h]):(o=u,u=n[++d]);let p=0;if(h<t&&d<i)for(u>c==u>-c?(a=o-((s=c+o)-c),c=e[++h]):(a=o-((s=u+o)-u),u=n[++d]),o=s,0!==a&&(r[p++]=a);h<t&&d<i;)u>c==u>-c?(a=o-((s=o+c)-(l=s-o))+(c-l),c=e[++h]):(a=o-((s=o+u)-(l=s-o))+(u-l),u=n[++d]),o=s,0!==a&&(r[p++]=a);for(;h<t;)a=o-((s=o+c)-(l=s-o))+(c-l),c=e[++h],o=s,0!==a&&(r[p++]=a);for(;d<i;)a=o-((s=o+u)-(l=s-o))+(u-l),u=n[++d],o=s,0!==a&&(r[p++]=a);return 0===o&&0!==p||(r[p++]=o),p}function n(t){return new Float64Array(t)}const r=n(4),o=n(8),s=n(12),a=n(16),l=n(4);t.orient2d=function(t,n,c,u,h,d){const p=(n-d)*(c-h),f=(t-h)*(u-d),m=p-f;if(0===p||0===f||p>0!=f>0)return m;const g=Math.abs(p+f);return Math.abs(m)>=33306690738754716e-32*g?m:-function(t,n,c,u,h,d,p){let f,m,g,_,y,v,x,b,w,E,S,T,M,I,C,A,P,L;const R=t-h,D=c-h,k=n-d,N=u-d;y=(C=(b=R-(x=(v=e*R)-(v-R)))*(E=N-(w=(v=e*N)-(v-N)))-((I=R*N)-x*w-b*w-x*E))-(S=C-(P=(b=k-(x=(v=e*k)-(v-k)))*(E=D-(w=(v=e*D)-(v-D)))-((A=k*D)-x*w-b*w-x*E))),r[0]=C-(S+y)+(y-P),y=(M=I-((T=I+S)-(y=T-I))+(S-y))-(S=M-A),r[1]=M-(S+y)+(y-A),y=(L=T+S)-T,r[2]=T-(L-y)+(S-y),r[3]=L;let O=function(t,e){let i=e[0];for(let t=1;t<4;t++)i+=e[t];return i}(0,r),F=22204460492503146e-32*p;if(O>=F||-O>=F)return O;if(f=t-(R+(y=t-R))+(y-h),g=c-(D+(y=c-D))+(y-h),m=n-(k+(y=n-k))+(y-d),_=u-(N+(y=u-N))+(y-d),0===f&&0===m&&0===g&&0===_)return O;if(F=11093356479670487e-47*p+33306690738754706e-32*Math.abs(O),(O+=R*_+N*f-(k*g+D*m))>=F||-O>=F)return O;y=(C=(b=f-(x=(v=e*f)-(v-f)))*(E=N-(w=(v=e*N)-(v-N)))-((I=f*N)-x*w-b*w-x*E))-(S=C-(P=(b=m-(x=(v=e*m)-(v-m)))*(E=D-(w=(v=e*D)-(v-D)))-((A=m*D)-x*w-b*w-x*E))),l[0]=C-(S+y)+(y-P),y=(M=I-((T=I+S)-(y=T-I))+(S-y))-(S=M-A),l[1]=M-(S+y)+(y-A),y=(L=T+S)-T,l[2]=T-(L-y)+(S-y),l[3]=L;const z=i(4,r,4,l,o);y=(C=(b=R-(x=(v=e*R)-(v-R)))*(E=_-(w=(v=e*_)-(v-_)))-((I=R*_)-x*w-b*w-x*E))-(S=C-(P=(b=k-(x=(v=e*k)-(v-k)))*(E=g-(w=(v=e*g)-(v-g)))-((A=k*g)-x*w-b*w-x*E))),l[0]=C-(S+y)+(y-P),y=(M=I-((T=I+S)-(y=T-I))+(S-y))-(S=M-A),l[1]=M-(S+y)+(y-A),y=(L=T+S)-T,l[2]=T-(L-y)+(S-y),l[3]=L;const B=i(z,o,4,l,s);y=(C=(b=f-(x=(v=e*f)-(v-f)))*(E=_-(w=(v=e*_)-(v-_)))-((I=f*_)-x*w-b*w-x*E))-(S=C-(P=(b=m-(x=(v=e*m)-(v-m)))*(E=g-(w=(v=e*g)-(v-g)))-((A=m*g)-x*w-b*w-x*E))),l[0]=C-(S+y)+(y-P),y=(M=I-((T=I+S)-(y=T-I))+(S-y))-(S=M-A),l[1]=M-(S+y)+(y-A),y=(L=T+S)-T,l[2]=T-(L-y)+(S-y),l[3]=L;const U=i(B,s,4,l,a);return a[U-1]}(t,n,c,u,h,d,g)},t.orient2dfast=function(t,e,i,n,r,o){return(e-o)*(i-r)-(t-r)*(n-o)},Object.defineProperty(t,"__esModule",{value:!0})}(e)},8973:(t,e,i)=>{"use strict";var n=i(8897),r=i(9381),o=i(6900)(),s=i(1399),a=i(1711),l=n("%Math.floor%");t.exports=function(t,e){if("function"!=typeof t)throw new a("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||l(e)!==e)throw new a("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],n=!0,c=!0;if("length"in t&&s){var u=s(t,"length");u&&!u.configurable&&(n=!1),u&&!u.writable&&(c=!1)}return(n||c||!i)&&(o?r(t,"length",e,!0,!0):r(t,"length",e)),t}},3426:(t,e,i)=>{"use strict";var n=i(9381),r=i(6900)(),o=i(1442).functionsHaveConfigurableNames(),s=i(1711);t.exports=function(t,e){if("function"!=typeof t)throw new s("`fn` is not a function");return arguments.length>2&&!!arguments[2]&&!o||(r?n(t,"name",e,!0,!0):n(t,"name",e)),t}},4058:t=>{"use strict";t.exports={eudist:function(t,e,i){for(var n=t.length,r=0,o=0;o<n;o++){var s=(t[o]||0)-(e[o]||0);r+=s*s}return i?Math.sqrt(r):r},mandist:function(t,e,i){for(var n=t.length,r=0,o=0;o<n;o++)r+=Math.abs((t[o]||0)-(e[o]||0));return i?Math.sqrt(r):r},dist:function(t,e,i){var n=Math.abs(t-e);return i?n:n*n}}},9270:(t,e,i)=>{"use strict";var n=i(4058),r=n.eudist,o=n.dist;t.exports={kmrand:function(t,e){for(var i={},n=[],r=e<<2,o=t.length,s=t[0].length>0;n.length<e&&r-- >0;){var a=t[Math.floor(Math.random()*o)],l=s?a.join("_"):""+a;i[l]||(i[l]=!0,n.push(a))}if(n.length<e)throw new Error("Error initializating clusters");return n},kmpp:function(t,e){var i=t[0].length?r:o,n=[],s=t.length,a=t[0].length>0,l=t[Math.floor(Math.random()*s)];for(a&&l.join("_"),n.push(l);n.length<e;){for(var c=[],u=n.length,h=0,d=[],p=0;p<s;p++){for(var f=1/0,m=0;m<u;m++){var g=i(t[p],n[m]);g<=f&&(f=g)}c[p]=f}for(var _=0;_<s;_++)h+=c[_];for(var y=0;y<s;y++)d[y]={i:y,v:t[y],pr:c[y]/h,cs:0};d.sort((function(t,e){return t.pr-e.pr})),d[0].cs=d[0].pr;for(var v=1;v<s;v++)d[v].cs=d[v-1].cs+d[v].pr;for(var x=Math.random(),b=0;b<s-1&&d[b++].cs<x;);n.push(d[b-1].v)}return n}}},2024:(t,e,i)=>{"use strict";var n=i(4058),r=i(9270),o=n.eudist,s=(n.mandist,n.dist,r.kmrand),a=r.kmpp;function l(t,e,i){i=i||[];for(var n=0;n<t;n++)i[n]=e;return i}t.exports=function(t,e,i,n){var r=[],c=[],u=[],h=[],d=!1,p=n||1e4,f=t.length,m=t[0].length,g=m>0,_=[];if(i)r="kmrand"==i?s(t,e):"kmpp"==i?a(t,e):i;else for(var y={};r.length<e;){var v=Math.floor(Math.random()*f);y[v]||(y[v]=!0,r.push(t[v]))}do{l(e,0,_);for(var x=0;x<f;x++){for(var b=1/0,w=0,E=0;E<e;E++)(h=g?o(t[x],r[E]):Math.abs(t[x]-r[E]))<=b&&(b=h,w=E);u[x]=w,_[w]++}for(var S=[],T=(c=[],0);T<e;T++)S[T]=g?l(m,0,S[T]):0,c[T]=r[T];if(g){for(var M=0;M<e;M++)r[M]=[];for(var I=0;I<f;I++)for(var C=S[u[I]],A=t[I],P=0;P<m;P++)C[P]+=A[P];d=!0;for(var L=0;L<e;L++){for(var R=r[L],D=S[L],k=c[L],N=_[L],O=0;O<m;O++)R[O]=D[O]/N||0;if(d)for(var F=0;F<m;F++)if(k[F]!=R[F]){d=!1;break}}}else{for(var z=0;z<f;z++)S[u[z]]+=t[z];for(var B=0;B<e;B++)r[B]=S[B]/_[B]||0;d=!0;for(var U=0;U<e;U++)if(c[U]!=r[U]){d=!1;break}}d=d||--p<=0}while(!d);return{it:1e4-p,k:e,idxs:u,centroids:r}}},922:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});class n{constructor(t=[],e=r){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,n=e[t];for(;t>0;){const r=t-1>>1,o=e[r];if(i(n,o)>=0)break;e[t]=o,t=r}e[t]=n}_down(t){const{data:e,compare:i}=this,n=this.length>>1,r=e[t];for(;t<n;){let n=1+(t<<1),o=e[n];const s=n+1;if(s<this.length&&i(e[s],o)<0&&(n=s,o=e[s]),i(o,r)>=0)break;e[t]=o,t=n}e[t]=r}}function r(t,e){return t<e?-1:t>e?1:0}},7155:function(t,e){!function(t){"use strict";function e(){}function i(t){this.message=t||""}function n(t){this.message=t||""}function r(t){this.message=t||""}function o(){}function s(t){return null===t?kt:t.color}function a(t){return null===t?null:t.parent}function l(t,e){null!==t&&(t.color=e)}function c(t){return null===t?null:t.left}function u(t){return null===t?null:t.right}function h(){this.root_=null,this.size_=0}function d(){}function p(){this.array_=[],arguments[0]instanceof xt&&this.addAll(arguments[0])}function f(){}function m(t){this.message=t||""}function g(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(null==this)throw new TypeError(this+" is not an object");var e=Object(this),i=Math.max(Math.min(e.length,9007199254740991),0)||0,n=1 in arguments&&parseInt(Number(arguments[1]),10)||0;n=n<0?Math.max(i+n,0):Math.min(n,i);var r=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:i;for(r=r<0?Math.max(i+arguments[2],0):Math.min(r,i);n<r;)e[n]=t,++n;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!=t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var _=function(){};_.prototype.interfaces_=function(){return[]},_.prototype.getClass=function(){return _},_.prototype.equalsWithTolerance=function(t,e,i){return Math.abs(t-e)<=i};var y=function(t){function e(e){t.call(this,e),this.name="IllegalArgumentException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),v=function(){},x={MAX_VALUE:{configurable:!0}};v.isNaN=function(t){return Number.isNaN(t)},v.doubleToLongBits=function(t){return t},v.longBitsToDouble=function(t){return t},v.isInfinite=function(t){return!Number.isFinite(t)},x.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(v,x);var b=function(){},w=function(){},E=function(){},S=function t(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},T={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};S.prototype.setOrdinate=function(t,e){switch(t){case S.X:this.x=e;break;case S.Y:this.y=e;break;case S.Z:this.z=e;break;default:throw new y("Invalid ordinate index: "+t)}},S.prototype.equals2D=function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!_.equalsWithTolerance(this.x,e.x,i)&&!!_.equalsWithTolerance(this.y,e.y,i)}},S.prototype.getOrdinate=function(t){switch(t){case S.X:return this.x;case S.Y:return this.y;case S.Z:return this.z}throw new y("Invalid ordinate index: "+t)},S.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||v.isNaN(this.z))&&v.isNaN(t.z)},S.prototype.equals=function(t){return t instanceof S&&this.equals2D(t)},S.prototype.equalInZ=function(t,e){return _.equalsWithTolerance(this.z,t.z,e)},S.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},S.prototype.clone=function(){},S.prototype.copy=function(){return new S(this)},S.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},S.prototype.distance3D=function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return Math.sqrt(e*e+i*i+n*n)},S.prototype.distance=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},S.prototype.hashCode=function(){var t=17;return 37*(t=37*t+S.hashCode(this.x))+S.hashCode(this.y)},S.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z},S.prototype.interfaces_=function(){return[b,w,e]},S.prototype.getClass=function(){return S},S.hashCode=function(){if(1===arguments.length)return v.doubleToLongBits(arguments[0]),Math.trunc(0)},T.DimensionalComparator.get=function(){return M},T.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},T.NULL_ORDINATE.get=function(){return v.NaN},T.X.get=function(){return 0},T.Y.get=function(){return 1},T.Z.get=function(){return 2},Object.defineProperties(S,T);var M=function(t){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(2!==e&&3!==e)throw new y("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};M.prototype.compare=function(t,e){var i=t,n=e,r=M.compare(i.x,n.x);if(0!==r)return r;var o=M.compare(i.y,n.y);return 0!==o?o:this._dimensionsToTest<=2?0:M.compare(i.z,n.z)},M.prototype.interfaces_=function(){return[E]},M.prototype.getClass=function(){return M},M.compare=function(t,e){return t<e?-1:t>e?1:v.isNaN(t)?v.isNaN(e)?0:-1:v.isNaN(e)?1:0};var I=function(){};I.prototype.create=function(){},I.prototype.interfaces_=function(){return[]},I.prototype.getClass=function(){return I};var C=function(){},A={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};C.prototype.interfaces_=function(){return[]},C.prototype.getClass=function(){return C},C.toLocationSymbol=function(t){switch(t){case C.EXTERIOR:return"e";case C.BOUNDARY:return"b";case C.INTERIOR:return"i";case C.NONE:return"-"}throw new y("Unknown location value: "+t)},A.INTERIOR.get=function(){return 0},A.BOUNDARY.get=function(){return 1},A.EXTERIOR.get=function(){return 2},A.NONE.get=function(){return-1},Object.defineProperties(C,A);var P=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},L=function(){},R={LOG_10:{configurable:!0}};L.prototype.interfaces_=function(){return[]},L.prototype.getClass=function(){return L},L.log10=function(t){var e=Math.log(t);return v.isInfinite(e)||v.isNaN(e)?e:e/L.LOG_10},L.min=function(t,e,i,n){var r=t;return e<r&&(r=e),i<r&&(r=i),n<r&&(r=n),r},L.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],i=arguments[2];return t<e?e:t>i?i:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var n=arguments[0],r=arguments[1],o=arguments[2];return n<r?r:n>o?o:n}},L.wrap=function(t,e){return t<0?e- -t%e:t%e},L.max=function(){if(3===arguments.length){var t=arguments[1],e=arguments[2],i=arguments[0];return t>i&&(i=t),e>i&&(i=e),i}if(4===arguments.length){var n=arguments[1],r=arguments[2],o=arguments[3],s=arguments[0];return n>s&&(s=n),r>s&&(s=r),o>s&&(s=o),s}},L.average=function(t,e){return(t+e)/2},R.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(L,R);var D=function(t){this.str=t};D.prototype.append=function(t){this.str+=t},D.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},D.prototype.toString=function(t){return this.str};var k=function(t){this.value=t};k.prototype.intValue=function(){return this.value},k.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},k.isNaN=function(t){return Number.isNaN(t)};var N=function(){};N.isWhitespace=function(t){return t<=32&&t>=0||127===t},N.toUpperCase=function(t){return t.toUpperCase()};var O=function t(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length)if("number"==typeof arguments[0]){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var i=arguments[0];this.init(i)}else"string"==typeof arguments[0]&&t.call(this,t.parse(arguments[0]));else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.init(n,r)}},F={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};O.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo},O.prototype.extractSignificantDigits=function(t,e){var i=this.abs(),n=O.magnitude(i._hi),r=O.TEN.pow(n);(i=i.divide(r)).gt(O.TEN)?(i=i.divide(O.TEN),n+=1):i.lt(O.ONE)&&(i=i.multiply(O.TEN),n-=1);for(var o=n+1,s=new D,a=O.MAX_PRINT_DIGITS-1,l=0;l<=a;l++){t&&l===o&&s.append(".");var c=Math.trunc(i._hi);if(c<0)break;var u=!1,h=0;c>9?(u=!0,h="9"):h="0"+c,s.append(h),i=i.subtract(O.valueOf(c)).multiply(O.TEN),u&&i.selfAdd(O.TEN);var d=!0,p=O.magnitude(i._hi);if(p<0&&Math.abs(p)>=a-l&&(d=!1),!d)break}return e[0]=n,s.toString()},O.prototype.sqr=function(){return this.multiply(this)},O.prototype.doubleValue=function(){return this._hi+this._lo},O.prototype.subtract=function(){if(arguments[0]instanceof O){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},O.prototype.equals=function(){if(1===arguments.length){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}},O.prototype.isZero=function(){return 0===this._hi&&0===this._lo},O.prototype.selfSubtract=function(){if(arguments[0]instanceof O){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},O.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},O.prototype.min=function(t){return this.le(t)?this:t},O.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof O){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var i,n,r,o,s=arguments[0],a=arguments[1],l=null,c=null,u=null,h=null;return r=this._hi/s,h=(l=(u=O.SPLIT*r)-(l=u-r))*(c=(h=O.SPLIT*s)-(c=h-s))-(o=r*s)+l*(n=s-c)+(i=r-l)*c+i*n,h=r+(u=(this._hi-o-h+this._lo-r*a)/s),this._hi=h,this._lo=r-h+u,this}},O.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},O.prototype.divide=function(){if(arguments[0]instanceof O){var t,e,i,n,r=arguments[0],o=null,s=null,a=null,l=null;return t=(i=this._hi/r._hi)-(o=(a=O.SPLIT*i)-(o=a-i)),l=o*(s=(l=O.SPLIT*r._hi)-(s=l-r._hi))-(n=i*r._hi)+o*(e=r._hi-s)+t*s+t*e,a=(this._hi-n-l+this._lo-i*r._lo)/r._hi,new O(l=i+a,i-l+a)}if("number"==typeof arguments[0]){var c=arguments[0];return v.isNaN(c)?O.createNaN():O.copy(this).selfDivide(c,0)}},O.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo},O.prototype.pow=function(t){if(0===t)return O.valueOf(1);var e=new O(this),i=O.valueOf(1),n=Math.abs(t);if(n>1)for(;n>0;)n%2==1&&i.selfMultiply(e),(n/=2)>0&&(e=e.sqr());else i=e;return t<0?i.reciprocal():i},O.prototype.ceil=function(){if(this.isNaN())return O.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new O(t,e)},O.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0},O.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},O.prototype.setValue=function(){if(arguments[0]instanceof O){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},O.prototype.max=function(t){return this.ge(t)?this:t},O.prototype.sqrt=function(){if(this.isZero())return O.valueOf(0);if(this.isNegative())return O.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,i=O.valueOf(e),n=this.subtract(i.sqr())._hi*(.5*t);return i.add(n)},O.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof O){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var e,i,n,r,o,s=arguments[0],a=null;return a=(n=this._hi+s)-(r=n-this._hi),i=(o=(a=s-r+(this._hi-a))+this._lo)+(n-(e=n+o)),this._hi=e+i,this._lo=i+(e-this._hi),this}}else if(2===arguments.length){var l,c,u,h,d=arguments[0],p=arguments[1],f=null,m=null,g=null;u=this._hi+d,c=this._lo+p,m=u-(g=u-this._hi),f=c-(h=c-this._lo);var _=(l=u+(g=(m=d-g+(this._hi-m))+c))+(g=(f=p-h+(this._lo-f))+(g+(u-l))),y=g+(l-_);return this._hi=_,this._lo=y,this}},O.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof O){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var i,n,r=arguments[0],o=arguments[1],s=null,a=null,l=null,c=null;s=(l=O.SPLIT*this._hi)-this._hi,c=O.SPLIT*r,s=l-s,i=this._hi-s,a=c-r;var u=(l=this._hi*r)+(c=s*(a=c-a)-l+s*(n=r-a)+i*a+i*n+(this._hi*o+this._lo*r)),h=c+(s=l-u);return this._hi=u,this._lo=h,this}},O.prototype.selfSqr=function(){return this.selfMultiply(this)},O.prototype.floor=function(){if(this.isNaN())return O.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new O(t,e)},O.prototype.negate=function(){return this.isNaN()?this:new O(-this._hi,-this._lo)},O.prototype.clone=function(){},O.prototype.multiply=function(){if(arguments[0]instanceof O){var t=arguments[0];return t.isNaN()?O.createNaN():O.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return v.isNaN(e)?O.createNaN():O.copy(this).selfMultiply(e,0)}},O.prototype.isNaN=function(){return v.isNaN(this._hi)},O.prototype.intValue=function(){return Math.trunc(this._hi)},O.prototype.toString=function(){var t=O.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()},O.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),i=this.extractSignificantDigits(!0,e),n=e[0]+1,r=i;if("."===i.charAt(0))r="0"+i;else if(n<0)r="0."+O.stringOfChar("0",-n)+i;else if(-1===i.indexOf(".")){var o=n-i.length;r=i+O.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+r:r},O.prototype.reciprocal=function(){var t,e,i,n,r=null,o=null,s=null,a=null;t=(i=1/this._hi)-(r=(s=O.SPLIT*i)-(r=s-i)),o=(a=O.SPLIT*this._hi)-this._hi;var l=i+(s=(1-(n=i*this._hi)-(a=r*(o=a-o)-n+r*(e=this._hi-o)+t*o+t*e)-i*this._lo)/this._hi);return new O(l,i-l+s)},O.prototype.toSciNotation=function(){if(this.isZero())return O.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),i=this.extractSignificantDigits(!1,e),n=O.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===i.charAt(0))throw new Error("Found leading zero: "+i);var r="";i.length>1&&(r=i.substring(1));var o=i.charAt(0)+"."+r;return this.isNegative()?"-"+o+n:o+n},O.prototype.abs=function(){return this.isNaN()?O.NaN:this.isNegative()?this.negate():new O(this)},O.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},O.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo},O.prototype.add=function(){if(arguments[0]instanceof O){var t=arguments[0];return O.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return O.copy(this).selfAdd(e)}},O.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof O){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this._hi=i,this._lo=n}},O.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo},O.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},O.prototype.trunc=function(){return this.isNaN()?O.NaN:this.isPositive()?this.floor():this.ceil()},O.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},O.prototype.interfaces_=function(){return[e,b,w]},O.prototype.getClass=function(){return O},O.sqr=function(t){return O.valueOf(t).selfMultiply(t)},O.valueOf=function(){return"string"==typeof arguments[0]?O.parse(arguments[0]):"number"==typeof arguments[0]?new O(arguments[0]):void 0},O.sqrt=function(t){return O.valueOf(t).sqrt()},O.parse=function(t){for(var e=0,i=t.length;N.isWhitespace(t.charAt(e));)e++;var n=!1;if(e<i){var r=t.charAt(e);"-"!==r&&"+"!==r||(e++,"-"===r&&(n=!0))}for(var o=new O,s=0,a=0,l=0;!(e>=i);){var c=t.charAt(e);if(e++,N.isDigit(c)){var u=c-"0";o.selfMultiply(O.TEN),o.selfAdd(u),s++}else{if("."!==c){if("e"===c||"E"===c){var h=t.substring(e);try{l=k.parseInt(h)}catch(e){throw e instanceof Error?new Error("Invalid exponent "+h+" in string "+t):e}break}throw new Error("Unexpected character '"+c+"' at position "+e+" in string "+t)}a=s}}var d=o,p=s-a-l;if(0===p)d=o;else if(p>0){var f=O.TEN.pow(p);d=o.divide(f)}else if(p<0){var m=O.TEN.pow(-p);d=o.multiply(m)}return n?d.negate():d},O.createNaN=function(){return new O(v.NaN,v.NaN)},O.copy=function(t){return new O(t)},O.magnitude=function(t){var e=Math.abs(t),i=Math.log(e)/Math.log(10),n=Math.trunc(Math.floor(i));return 10*Math.pow(10,n)<=e&&(n+=1),n},O.stringOfChar=function(t,e){for(var i=new D,n=0;n<e;n++)i.append(t);return i.toString()},F.PI.get=function(){return new O(3.141592653589793,12246467991473532e-32)},F.TWO_PI.get=function(){return new O(6.283185307179586,24492935982947064e-32)},F.PI_2.get=function(){return new O(1.5707963267948966,6123233995736766e-32)},F.E.get=function(){return new O(2.718281828459045,14456468917292502e-32)},F.NaN.get=function(){return new O(v.NaN,v.NaN)},F.EPS.get=function(){return 123259516440783e-46},F.SPLIT.get=function(){return 134217729},F.MAX_PRINT_DIGITS.get=function(){return 32},F.TEN.get=function(){return O.valueOf(10)},F.ONE.get=function(){return O.valueOf(1)},F.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},F.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(O,F);var z=function(){},B={DP_SAFE_EPSILON:{configurable:!0}};z.prototype.interfaces_=function(){return[]},z.prototype.getClass=function(){return z},z.orientationIndex=function(t,e,i){var n=z.orientationIndexFilter(t,e,i);if(n<=1)return n;var r=O.valueOf(e.x).selfAdd(-t.x),o=O.valueOf(e.y).selfAdd(-t.y),s=O.valueOf(i.x).selfAdd(-e.x),a=O.valueOf(i.y).selfAdd(-e.y);return r.selfMultiply(a).selfSubtract(o.selfMultiply(s)).signum()},z.signOfDet2x2=function(t,e,i,n){return t.multiply(n).selfSubtract(e.multiply(i)).signum()},z.intersection=function(t,e,i,n){var r=O.valueOf(n.y).selfSubtract(i.y).selfMultiply(O.valueOf(e.x).selfSubtract(t.x)),o=O.valueOf(n.x).selfSubtract(i.x).selfMultiply(O.valueOf(e.y).selfSubtract(t.y)),s=r.subtract(o),a=O.valueOf(n.x).selfSubtract(i.x).selfMultiply(O.valueOf(t.y).selfSubtract(i.y)),l=O.valueOf(n.y).selfSubtract(i.y).selfMultiply(O.valueOf(t.x).selfSubtract(i.x)),c=a.subtract(l).selfDivide(s).doubleValue(),u=O.valueOf(t.x).selfAdd(O.valueOf(e.x).selfSubtract(t.x).selfMultiply(c)).doubleValue(),h=O.valueOf(e.x).selfSubtract(t.x).selfMultiply(O.valueOf(t.y).selfSubtract(i.y)),d=O.valueOf(e.y).selfSubtract(t.y).selfMultiply(O.valueOf(t.x).selfSubtract(i.x)),p=h.subtract(d).selfDivide(s).doubleValue(),f=O.valueOf(i.y).selfAdd(O.valueOf(n.y).selfSubtract(i.y).selfMultiply(p)).doubleValue();return new S(u,f)},z.orientationIndexFilter=function(t,e,i){var n=null,r=(t.x-i.x)*(e.y-i.y),o=(t.y-i.y)*(e.x-i.x),s=r-o;if(r>0){if(o<=0)return z.signum(s);n=r+o}else{if(!(r<0))return z.signum(s);if(o>=0)return z.signum(s);n=-r-o}var a=z.DP_SAFE_EPSILON*n;return s>=a||-s>=a?z.signum(s):2},z.signum=function(t){return t>0?1:t<0?-1:0},B.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(z,B);var U=function(){},V={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};V.X.get=function(){return 0},V.Y.get=function(){return 1},V.Z.get=function(){return 2},V.M.get=function(){return 3},U.prototype.setOrdinate=function(t,e,i){},U.prototype.size=function(){},U.prototype.getOrdinate=function(t,e){},U.prototype.getCoordinate=function(){},U.prototype.getCoordinateCopy=function(t){},U.prototype.getDimension=function(){},U.prototype.getX=function(t){},U.prototype.clone=function(){},U.prototype.expandEnvelope=function(t){},U.prototype.copy=function(){},U.prototype.getY=function(t){},U.prototype.toCoordinateArray=function(){},U.prototype.interfaces_=function(){return[w]},U.prototype.getClass=function(){return U},Object.defineProperties(U,V);var j=function(){},G=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(j),H=function(){};H.arraycopy=function(t,e,i,n,r){for(var o=0,s=e;s<e+r;s++)i[n+o]=t[s],o++},H.getProperty=function(t){return{"line.separator":"\n"}[t]};var W=function t(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var i=arguments[0],n=arguments[1];this.x=i,this.y=n,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var r=arguments[0],o=arguments[1];this.x=r.y*o.w-o.y*r.w,this.y=o.x*r.w-r.x*o.w,this.w=r.x*o.y-o.x*r.y}else if(arguments[0]instanceof S&&arguments[1]instanceof S){var s=arguments[0],a=arguments[1];this.x=s.y-a.y,this.y=a.x-s.x,this.w=s.x*a.y-a.x*s.y}}else if(3===arguments.length){var l=arguments[0],c=arguments[1],u=arguments[2];this.x=l,this.y=c,this.w=u}else if(4===arguments.length){var h=arguments[0],d=arguments[1],p=arguments[2],f=arguments[3],m=h.y-d.y,g=d.x-h.x,_=h.x*d.y-d.x*h.y,y=p.y-f.y,v=f.x-p.x,x=p.x*f.y-f.x*p.y;this.x=g*x-v*_,this.y=y*_-m*x,this.w=m*v-y*g}};W.prototype.getY=function(){var t=this.y/this.w;if(v.isNaN(t)||v.isInfinite(t))throw new G;return t},W.prototype.getX=function(){var t=this.x/this.w;if(v.isNaN(t)||v.isInfinite(t))throw new G;return t},W.prototype.getCoordinate=function(){var t=new S;return t.x=this.getX(),t.y=this.getY(),t},W.prototype.interfaces_=function(){return[]},W.prototype.getClass=function(){return W},W.intersection=function(t,e,i,n){var r=t.y-e.y,o=e.x-t.x,s=t.x*e.y-e.x*t.y,a=i.y-n.y,l=n.x-i.x,c=i.x*n.y-n.x*i.y,u=r*l-a*o,h=(o*c-l*s)/u,d=(a*s-r*c)/u;if(v.isNaN(h)||v.isInfinite(h)||v.isNaN(d)||v.isInfinite(d))throw new G;return new S(h,d)};var q=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof S){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var i=arguments[0];this.init(i)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],l=arguments[3];this.init(o,s,a,l)}},X={serialVersionUID:{configurable:!0}};q.prototype.getArea=function(){return this.getWidth()*this.getHeight()},q.prototype.equals=function(t){if(!(t instanceof q))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()},q.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new q;var e=this._minx>t._minx?this._minx:t._minx,i=this._miny>t._miny?this._miny:t._miny,n=this._maxx<t._maxx?this._maxx:t._maxx,r=this._maxy<t._maxy?this._maxy:t._maxy;return new q(e,n,i,r)},q.prototype.isNull=function(){return this._maxx<this._minx},q.prototype.getMaxX=function(){return this._maxx},q.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof S){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof q){var e=arguments[0];return!this.isNull()&&!e.isNull()&&e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];return!this.isNull()&&i>=this._minx&&i<=this._maxx&&n>=this._miny&&n<=this._maxy}},q.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof q){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof S){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];return!this.isNull()&&!(i>this._maxx||i<this._minx||n>this._maxy||n<this._miny)}},q.prototype.getMinY=function(){return this._miny},q.prototype.getMinX=function(){return this._minx},q.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof S){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof q){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this.isNull()?(this._minx=i,this._maxx=i,this._miny=n,this._maxy=n):(i<this._minx&&(this._minx=i),i>this._maxx&&(this._maxx=i),n<this._miny&&(this._miny=n),n>this._maxy&&(this._maxy=n))}},q.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},q.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},q.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0},q.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},q.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},q.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},q.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},q.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e},q.prototype.expandBy=function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=i,this._maxy+=i,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},q.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof q){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof S){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];return this.covers(i,n)}},q.prototype.centre=function(){return this.isNull()?null:new S((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},q.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof S){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof q){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this.init(i.x,n.x,i.y,n.y)}else if(4===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];r<o?(this._minx=r,this._maxx=o):(this._minx=o,this._maxx=r),s<a?(this._miny=s,this._maxy=a):(this._miny=a,this._maxy=s)}},q.prototype.getMaxY=function(){return this._maxy},q.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var i=0;return this._maxy<t._miny?i=t._miny-this._maxy:this._miny>t._maxy&&(i=this._miny-t._maxy),0===e?i:0===i?e:Math.sqrt(e*e+i*i)},q.prototype.hashCode=function(){var t=17;return 37*(t=37*(t=37*(t=37*t+S.hashCode(this._minx))+S.hashCode(this._maxx))+S.hashCode(this._miny))+S.hashCode(this._maxy)},q.prototype.interfaces_=function(){return[b,e]},q.prototype.getClass=function(){return q},q.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],i=arguments[2];return i.x>=(t.x<e.x?t.x:e.x)&&i.x<=(t.x>e.x?t.x:e.x)&&i.y>=(t.y<e.y?t.y:e.y)&&i.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2],s=arguments[3],a=Math.min(o.x,s.x),l=Math.max(o.x,s.x),c=Math.min(n.x,r.x),u=Math.max(n.x,r.x);return!(c>l||u<a||(a=Math.min(o.y,s.y),l=Math.max(o.y,s.y),c=Math.min(n.y,r.y),u=Math.max(n.y,r.y),c>l||u<a))}},X.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(q,X);var $={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Y=function(t){this.geometryFactory=t||new _e};Y.prototype.read=function(t){var e,i,n;t=t.replace(/[\n\r]/g," ");var r=$.typeStr.exec(t);if(-1!==t.search("EMPTY")&&((r=$.emptyTypeStr.exec(t))[2]=void 0),r&&(i=r[1].toLowerCase(),n=r[2],K[i]&&(e=K[i].apply(this,[n]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},Y.prototype.write=function(t){return this.extractGeometry(t)},Y.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!Z[e])return null;var i=e.toUpperCase();return t.isEmpty()?i+" EMPTY":i+"("+Z[e].apply(this,[t])+")"};var Z={coordinate:function(t){return t.x+" "+t.y},point:function(t){return Z.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=[],i=0,n=t._geometries.length;i<n;++i)e.push("("+Z.point.apply(this,[t._geometries[i]])+")");return e.join(",")},linestring:function(t){for(var e=[],i=0,n=t._points._coordinates.length;i<n;++i)e.push(Z.coordinate.apply(this,[t._points._coordinates[i]]));return e.join(",")},linearring:function(t){for(var e=[],i=0,n=t._points._coordinates.length;i<n;++i)e.push(Z.coordinate.apply(this,[t._points._coordinates[i]]));return e.join(",")},multilinestring:function(t){for(var e=[],i=0,n=t._geometries.length;i<n;++i)e.push("("+Z.linestring.apply(this,[t._geometries[i]])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+Z.linestring.apply(this,[t._shell])+")");for(var i=0,n=t._holes.length;i<n;++i)e.push("("+Z.linestring.apply(this,[t._holes[i]])+")");return e.join(",")},multipolygon:function(t){for(var e=[],i=0,n=t._geometries.length;i<n;++i)e.push("("+Z.polygon.apply(this,[t._geometries[i]])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],i=0,n=t._geometries.length;i<n;++i)e.push(this.extractGeometry(t._geometries[i]));return e.join(",")}},K={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split($.spaces);return this.geometryFactory.createPoint(new S(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){if(void 0===t)return this.geometryFactory.createMultiPoint();for(var e,i=t.trim().split(","),n=[],r=0,o=i.length;r<o;++r)e=i[r].replace($.trimParens,"$1"),n.push(K.point.apply(this,[e]));return this.geometryFactory.createMultiPoint(n)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,i=t.trim().split(","),n=[],r=0,o=i.length;r<o;++r)e=i[r].trim().split($.spaces),n.push(new S(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(n)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,i=t.trim().split(","),n=[],r=0,o=i.length;r<o;++r)e=i[r].trim().split($.spaces),n.push(new S(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(t){if(void 0===t)return this.geometryFactory.createMultiLineString();for(var e,i=t.trim().split($.parenComma),n=[],r=0,o=i.length;r<o;++r)e=i[r].replace($.trimParens,"$1"),n.push(K.linestring.apply(this,[e]));return this.geometryFactory.createMultiLineString(n)},polygon:function(t){if(void 0===t)return this.geometryFactory.createPolygon();for(var e,i,n,r,o=t.trim().split($.parenComma),s=[],a=0,l=o.length;a<l;++a)e=o[a].replace($.trimParens,"$1"),i=K.linestring.apply(this,[e]),n=this.geometryFactory.createLinearRing(i._points),0===a?r=n:s.push(n);return this.geometryFactory.createPolygon(r,s)},multipolygon:function(t){if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var e,i=t.trim().split($.doubleParenComma),n=[],r=0,o=i.length;r<o;++r)e=i[r].replace($.trimParens,"$1"),n.push(K.polygon.apply(this,[e]));return this.geometryFactory.createMultiPolygon(n)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();for(var e=(t=t.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),i=[],n=0,r=e.length;n<r;++n)i.push(this.read(e[n]));return this.geometryFactory.createGeometryCollection(i)}},J=function(t){this.parser=new Y(t)};J.prototype.write=function(t){return this.parser.write(t)},J.toLineString=function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var Q=function(t){function e(e){t.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),tt=function(t){function e(){if(t.call(this),0===arguments.length)t.call(this);else if(1===arguments.length){var e=arguments[0];t.call(this,e)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Q),et=function(){};et.prototype.interfaces_=function(){return[]},et.prototype.getClass=function(){return et},et.shouldNeverReachHere=function(){if(0===arguments.length)et.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new tt("Should never reach here"+(null!==t?": "+t:""))}},et.isTrue=function(){var t;if(1===arguments.length)et.isTrue(arguments[0],null);else if(2===arguments.length&&(t=arguments[1],!arguments[0]))throw null===t?new tt:new tt(t)},et.equals=function(){var t,e,i;if(2===arguments.length)et.equals(t=arguments[0],e=arguments[1],null);else if(3===arguments.length&&(t=arguments[0],i=arguments[2],!(e=arguments[1]).equals(t)))throw new tt("Expected "+t+" but encountered "+e+(null!==i?": "+i:""))};var it=function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new S,this._intPt[1]=new S,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},nt={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};it.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]},it.prototype.getTopologySummary=function(){var t=new D;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},it.prototype.computeIntersection=function(t,e,i,n){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=i,this._inputLines[1][1]=n,this._result=this.computeIntersect(t,e,i,n)},it.prototype.getIntersectionNum=function(){return this._result},it.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0];this.getEdgeDistance(t,0)>this.getEdgeDistance(t,1)?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}},it.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},it.prototype.setPrecisionModel=function(t){this._precisionModel=t},it.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=arguments[0],e=0;e<this._result;e++)if(!this._intPt[e].equals2D(this._inputLines[t][0])&&!this._intPt[e].equals2D(this._inputLines[t][1]))return!0;return!1}},it.prototype.getIntersection=function(t){return this._intPt[t]},it.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},it.prototype.hasIntersection=function(){return this._result!==it.NO_INTERSECTION},it.prototype.getEdgeDistance=function(t,e){return it.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])},it.prototype.isCollinear=function(){return this._result===it.COLLINEAR_INTERSECTION},it.prototype.toString=function(){return J.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+J.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},it.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]},it.prototype.isIntersection=function(t){for(var e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1},it.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]},it.prototype.interfaces_=function(){return[]},it.prototype.getClass=function(){return it},it.computeEdgeDistance=function(t,e,i){var n=Math.abs(i.x-e.x),r=Math.abs(i.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(i))o=n>r?n:r;else{var s=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);0!==(o=n>r?s:a)||t.equals(e)||(o=Math.max(s,a))}return et.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o},it.nonRobustComputeEdgeDistance=function(t,e,i){var n=t.x-e.x,r=t.y-e.y,o=Math.sqrt(n*n+r*r);return et.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o},nt.DONT_INTERSECT.get=function(){return 0},nt.DO_INTERSECT.get=function(){return 1},nt.COLLINEAR.get=function(){return 2},nt.NO_INTERSECTION.get=function(){return 0},nt.POINT_INTERSECTION.get=function(){return 1},nt.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(it,nt);var rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(t){var e=new q(this._inputLines[0][0],this._inputLines[0][1]),i=new q(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&i.contains(t)},e.prototype.computeIntersection=function(){if(3!==arguments.length)return t.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],i=arguments[1],n=arguments[2];if(this._isProper=!1,q.intersects(i,n,e)&&0===at.orientationIndex(i,n,e)&&0===at.orientationIndex(n,i,e))return this._isProper=!0,(e.equals(i)||e.equals(n))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION},e.prototype.normalizeToMinimum=function(t,e,i,n,r){r.x=this.smallestInAbsValue(t.x,e.x,i.x,n.x),r.y=this.smallestInAbsValue(t.y,e.y,i.y,n.y),t.x-=r.x,t.y-=r.y,e.x-=r.x,e.y-=r.y,i.x-=r.x,i.y-=r.y,n.x-=r.x,n.y-=r.y},e.prototype.safeHCoordinateIntersection=function(t,i,n,r){var o=null;try{o=W.intersection(t,i,n,r)}catch(s){if(!(s instanceof G))throw s;o=e.nearestEndpoint(t,i,n,r)}return o},e.prototype.intersection=function(t,i,n,r){var o=this.intersectionWithNormalization(t,i,n,r);return this.isInSegmentEnvelopes(o)||(o=new S(e.nearestEndpoint(t,i,n,r))),null!==this._precisionModel&&this._precisionModel.makePrecise(o),o},e.prototype.smallestInAbsValue=function(t,e,i,n){var r=t,o=Math.abs(r);return Math.abs(e)<o&&(r=e,o=Math.abs(e)),Math.abs(i)<o&&(r=i,o=Math.abs(i)),Math.abs(n)<o&&(r=n),r},e.prototype.checkDD=function(t,e,i,n,r){var o=z.intersection(t,e,i,n),s=this.isInSegmentEnvelopes(o);H.out.println("DD in env = "+s+"  --------------------- "+o),r.distance(o)>1e-4&&H.out.println("Distance = "+r.distance(o))},e.prototype.intersectionWithNormalization=function(t,e,i,n){var r=new S(t),o=new S(e),s=new S(i),a=new S(n),l=new S;this.normalizeToEnvCentre(r,o,s,a,l);var c=this.safeHCoordinateIntersection(r,o,s,a);return c.x+=l.x,c.y+=l.y,c},e.prototype.computeCollinearIntersection=function(e,i,n,r){var o=q.intersects(e,i,n),s=q.intersects(e,i,r),a=q.intersects(n,r,e),l=q.intersects(n,r,i);return o&&s?(this._intPt[0]=n,this._intPt[1]=r,t.COLLINEAR_INTERSECTION):a&&l?(this._intPt[0]=e,this._intPt[1]=i,t.COLLINEAR_INTERSECTION):o&&a?(this._intPt[0]=n,this._intPt[1]=e,!n.equals(e)||s||l?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):o&&l?(this._intPt[0]=n,this._intPt[1]=i,!n.equals(i)||s||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&a?(this._intPt[0]=r,this._intPt[1]=e,!r.equals(e)||o||l?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&l?(this._intPt[0]=r,this._intPt[1]=i,!r.equals(i)||o||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(t,e,i,n,r){var o=t.x<e.x?t.x:e.x,s=t.y<e.y?t.y:e.y,a=t.x>e.x?t.x:e.x,l=t.y>e.y?t.y:e.y,c=i.x<n.x?i.x:n.x,u=i.y<n.y?i.y:n.y,h=i.x>n.x?i.x:n.x,d=i.y>n.y?i.y:n.y,p=((o>c?o:c)+(a<h?a:h))/2,f=((s>u?s:u)+(l<d?l:d))/2;r.x=p,r.y=f,t.x-=r.x,t.y-=r.y,e.x-=r.x,e.y-=r.y,i.x-=r.x,i.y-=r.y,n.x-=r.x,n.y-=r.y},e.prototype.computeIntersect=function(e,i,n,r){if(this._isProper=!1,!q.intersects(e,i,n,r))return t.NO_INTERSECTION;var o=at.orientationIndex(e,i,n),s=at.orientationIndex(e,i,r);if(o>0&&s>0||o<0&&s<0)return t.NO_INTERSECTION;var a=at.orientationIndex(n,r,e),l=at.orientationIndex(n,r,i);return a>0&&l>0||a<0&&l<0?t.NO_INTERSECTION:0===o&&0===s&&0===a&&0===l?this.computeCollinearIntersection(e,i,n,r):(0===o||0===s||0===a||0===l?(this._isProper=!1,e.equals2D(n)||e.equals2D(r)?this._intPt[0]=e:i.equals2D(n)||i.equals2D(r)?this._intPt[0]=i:0===o?this._intPt[0]=new S(n):0===s?this._intPt[0]=new S(r):0===a?this._intPt[0]=new S(e):0===l&&(this._intPt[0]=new S(i))):(this._isProper=!0,this._intPt[0]=this.intersection(e,i,n,r)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(t,e,i,n){var r=t,o=at.distancePointLine(t,i,n),s=at.distancePointLine(e,i,n);return s<o&&(o=s,r=e),(s=at.distancePointLine(i,t,e))<o&&(o=s,r=i),(s=at.distancePointLine(n,t,e))<o&&(o=s,r=n),r},e}(it),ot=function(){};ot.prototype.interfaces_=function(){return[]},ot.prototype.getClass=function(){return ot},ot.orientationIndex=function(t,e,i){var n=e.x-t.x,r=e.y-t.y,o=i.x-e.x,s=i.y-e.y;return ot.signOfDet2x2(n,r,o,s)},ot.signOfDet2x2=function(t,e,i,n){var r=null,o=null,s=null;if(r=1,0===t||0===n)return 0===e||0===i?0:e>0?i>0?-r:r:i>0?r:-r;if(0===e||0===i)return n>0?t>0?r:-r:t>0?-r:r;if(e>0?n>0?e<=n||(r=-r,o=t,t=i,i=o,o=e,e=n,n=o):e<=-n?(r=-r,i=-i,n=-n):(o=t,t=-i,i=o,o=e,e=-n,n=o):n>0?-e<=n?(r=-r,t=-t,e=-e):(o=-t,t=i,i=o,o=-e,e=n,n=o):e>=n?(t=-t,e=-e,i=-i,n=-n):(r=-r,o=-t,t=-i,i=o,o=-e,e=-n,n=o),t>0){if(!(i>0))return r;if(!(t<=i))return r}else{if(i>0)return-r;if(!(t>=i))return-r;r=-r,t=-t,i=-i}for(;;){if((n-=(s=Math.floor(i/t))*e)<0)return-r;if(n>e)return r;if(t>(i-=s*t)+i){if(e<n+n)return r}else{if(e>n+n)return-r;i=t-i,n=e-n,r=-r}if(0===n)return 0===i?0:-r;if(0===i)return r;if((e-=(s=Math.floor(t/i))*n)<0)return r;if(e>n)return-r;if(i>(t-=s*i)+t){if(n<e+e)return-r}else{if(n>e+e)return r;t=i-t,e=n-e,r=-r}if(0===e)return 0===t?0:r;if(0===t)return-r}};var st=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};st.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var i=t.x,n=e.x;return i>n&&(i=e.x,n=t.x),this._p.x>=i&&this._p.x<=n&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var r=t.x-this._p.x,o=t.y-this._p.y,s=e.x-this._p.x,a=e.y-this._p.y,l=ot.signOfDet2x2(r,o,s,a);if(0===l)return this._isPointOnSegment=!0,null;a<o&&(l=-l),l>0&&this._crossingCount++}},st.prototype.isPointInPolygon=function(){return this.getLocation()!==C.EXTERIOR},st.prototype.getLocation=function(){return this._isPointOnSegment?C.BOUNDARY:this._crossingCount%2==1?C.INTERIOR:C.EXTERIOR},st.prototype.isOnSegment=function(){return this._isPointOnSegment},st.prototype.interfaces_=function(){return[]},st.prototype.getClass=function(){return st},st.locatePointInRing=function(){if(arguments[0]instanceof S&&P(arguments[1],U)){for(var t=arguments[1],e=new st(arguments[0]),i=new S,n=new S,r=1;r<t.size();r++)if(t.getCoordinate(r,i),t.getCoordinate(r-1,n),e.countSegment(i,n),e.isOnSegment())return e.getLocation();return e.getLocation()}if(arguments[0]instanceof S&&arguments[1]instanceof Array){for(var o=arguments[1],s=new st(arguments[0]),a=1;a<o.length;a++){var l=o[a],c=o[a-1];if(s.countSegment(l,c),s.isOnSegment())return s.getLocation()}return s.getLocation()}};var at=function(){},lt={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};at.prototype.interfaces_=function(){return[]},at.prototype.getClass=function(){return at},at.orientationIndex=function(t,e,i){return z.orientationIndex(t,e,i)},at.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,i=t[0].x,n=1;n<t.length-1;n++){var r=t[n].x-i,o=t[n+1].y;e+=r*(t[n-1].y-o)}return e/2}if(P(arguments[0],U)){var s=arguments[0],a=s.size();if(a<3)return 0;var l=new S,c=new S,u=new S;s.getCoordinate(0,c),s.getCoordinate(1,u);var h=c.x;u.x-=h;for(var d=0,p=1;p<a-1;p++)l.y=c.y,c.x=u.x,c.y=u.y,s.getCoordinate(p+1,u),u.x-=h,d+=c.x*(l.y-u.y);return d/2}},at.distanceLineLine=function(t,e,i,n){if(t.equals(e))return at.distancePointLine(t,i,n);if(i.equals(n))return at.distancePointLine(n,t,e);var r=!1;if(q.intersects(t,e,i,n)){var o=(e.x-t.x)*(n.y-i.y)-(e.y-t.y)*(n.x-i.x);if(0===o)r=!0;else{var s=(t.y-i.y)*(n.x-i.x)-(t.x-i.x)*(n.y-i.y),a=((t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y))/o,l=s/o;(l<0||l>1||a<0||a>1)&&(r=!0)}}else r=!0;return r?L.min(at.distancePointLine(t,i,n),at.distancePointLine(e,i,n),at.distancePointLine(i,t,e),at.distancePointLine(n,t,e)):0},at.isPointInRing=function(t,e){return at.locatePointInRing(t,e)!==C.EXTERIOR},at.computeLength=function(t){var e=t.size();if(e<=1)return 0;var i=0,n=new S;t.getCoordinate(0,n);for(var r=n.x,o=n.y,s=1;s<e;s++){t.getCoordinate(s,n);var a=n.x,l=n.y,c=a-r,u=l-o;i+=Math.sqrt(c*c+u*u),r=a,o=l}return i},at.isCCW=function(t){var e=t.length-1;if(e<3)throw new y("Ring has fewer than 4 points, so orientation cannot be determined");for(var i=t[0],n=0,r=1;r<=e;r++){var o=t[r];o.y>i.y&&(i=o,n=r)}var s=n;do{(s-=1)<0&&(s=e)}while(t[s].equals2D(i)&&s!==n);var a=n;do{a=(a+1)%e}while(t[a].equals2D(i)&&a!==n);var l=t[s],c=t[a];if(l.equals2D(i)||c.equals2D(i)||l.equals2D(c))return!1;var u=at.computeOrientation(l,i,c);return 0===u?l.x>c.x:u>0},at.locatePointInRing=function(t,e){return st.locatePointInRing(t,e)},at.distancePointLinePerpendicular=function(t,e,i){var n=(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y),r=((e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y))/n;return Math.abs(r)*Math.sqrt(n)},at.computeOrientation=function(t,e,i){return at.orientationIndex(t,e,i)},at.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new y("Line array must contain at least one vertex");for(var i=t.distance(e[0]),n=0;n<e.length-1;n++){var r=at.distancePointLine(t,e[n],e[n+1]);r<i&&(i=r)}return i}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];if(s.x===a.x&&s.y===a.y)return o.distance(s);var l=(a.x-s.x)*(a.x-s.x)+(a.y-s.y)*(a.y-s.y),c=((o.x-s.x)*(a.x-s.x)+(o.y-s.y)*(a.y-s.y))/l;if(c<=0)return o.distance(s);if(c>=1)return o.distance(a);var u=((s.y-o.y)*(a.x-s.x)-(s.x-o.x)*(a.y-s.y))/l;return Math.abs(u)*Math.sqrt(l)}},at.isOnLine=function(t,e){for(var i=new rt,n=1;n<e.length;n++){var r=e[n-1],o=e[n];if(i.computeIntersection(t,r,o),i.hasIntersection())return!0}return!1},lt.CLOCKWISE.get=function(){return-1},lt.RIGHT.get=function(){return at.CLOCKWISE},lt.COUNTERCLOCKWISE.get=function(){return 1},lt.LEFT.get=function(){return at.COUNTERCLOCKWISE},lt.COLLINEAR.get=function(){return 0},lt.STRAIGHT.get=function(){return at.COLLINEAR},Object.defineProperties(at,lt);var ct=function(){};ct.prototype.filter=function(t){},ct.prototype.interfaces_=function(){return[]},ct.prototype.getClass=function(){return ct};var ut=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},ht={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};ut.prototype.isGeometryCollection=function(){return this.getSortIndex()===ut.SORTINDEX_GEOMETRYCOLLECTION},ut.prototype.getFactory=function(){return this._factory},ut.prototype.getGeometryN=function(t){return this},ut.prototype.getArea=function(){return 0},ut.prototype.isRectangle=function(){return!1},ut.prototype.equals=function(){if(arguments[0]instanceof ut){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof ut))return!1;var i=e;return this.equalsExact(i)}},ut.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)},ut.prototype.geometryChanged=function(){this.apply(ut.geometryChangedFilter)},ut.prototype.geometryChangedAction=function(){this._envelope=null},ut.prototype.equalsNorm=function(t){return null!==t&&this.norm().equalsExact(t.norm())},ut.prototype.getLength=function(){return 0},ut.prototype.getNumGeometries=function(){return 1},ut.prototype.compareTo=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var i=arguments[0],n=arguments[1];return this.getSortIndex()!==i.getSortIndex()?this.getSortIndex()-i.getSortIndex():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(i,n)}},ut.prototype.getUserData=function(){return this._userData},ut.prototype.getSRID=function(){return this._SRID},ut.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},ut.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===ut.SORTINDEX_GEOMETRYCOLLECTION)throw new y("This method does not support GeometryCollection arguments")},ut.prototype.equal=function(t,e,i){return 0===i?t.equals(e):t.distance(e)<=i},ut.prototype.norm=function(){var t=this.copy();return t.normalize(),t},ut.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},ut.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new q(this._envelope)},ut.prototype.setSRID=function(t){this._SRID=t},ut.prototype.setUserData=function(t){this._userData=t},ut.prototype.compare=function(t,e){for(var i=t.iterator(),n=e.iterator();i.hasNext()&&n.hasNext();){var r=i.next(),o=n.next(),s=r.compareTo(o);if(0!==s)return s}return i.hasNext()?1:n.hasNext()?-1:0},ut.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},ut.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===ut.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===ut.SORTINDEX_MULTIPOINT||this.getSortIndex()===ut.SORTINDEX_MULTILINESTRING||this.getSortIndex()===ut.SORTINDEX_MULTIPOLYGON},ut.prototype.interfaces_=function(){return[w,b,e]},ut.prototype.getClass=function(){return ut},ut.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},ut.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},ht.serialVersionUID.get=function(){return 0x799ea46522854c00},ht.SORTINDEX_POINT.get=function(){return 0},ht.SORTINDEX_MULTIPOINT.get=function(){return 1},ht.SORTINDEX_LINESTRING.get=function(){return 2},ht.SORTINDEX_LINEARRING.get=function(){return 3},ht.SORTINDEX_MULTILINESTRING.get=function(){return 4},ht.SORTINDEX_POLYGON.get=function(){return 5},ht.SORTINDEX_MULTIPOLYGON.get=function(){return 6},ht.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},ht.geometryChangedFilter.get=function(){return dt},Object.defineProperties(ut,ht);var dt=function(){};dt.interfaces_=function(){return[ct]},dt.filter=function(t){t.geometryChangedAction()};var pt=function(){};pt.prototype.filter=function(t){},pt.prototype.interfaces_=function(){return[]},pt.prototype.getClass=function(){return pt};var ft=function(){},mt={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};ft.prototype.isInBoundary=function(t){},ft.prototype.interfaces_=function(){return[]},ft.prototype.getClass=function(){return ft},mt.Mod2BoundaryNodeRule.get=function(){return gt},mt.EndPointBoundaryNodeRule.get=function(){return _t},mt.MultiValentEndPointBoundaryNodeRule.get=function(){return yt},mt.MonoValentEndPointBoundaryNodeRule.get=function(){return vt},mt.MOD2_BOUNDARY_RULE.get=function(){return new gt},mt.ENDPOINT_BOUNDARY_RULE.get=function(){return new _t},mt.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new yt},mt.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new vt},mt.OGC_SFS_BOUNDARY_RULE.get=function(){return ft.MOD2_BOUNDARY_RULE},Object.defineProperties(ft,mt);var gt=function(){};gt.prototype.isInBoundary=function(t){return t%2==1},gt.prototype.interfaces_=function(){return[ft]},gt.prototype.getClass=function(){return gt};var _t=function(){};_t.prototype.isInBoundary=function(t){return t>0},_t.prototype.interfaces_=function(){return[ft]},_t.prototype.getClass=function(){return _t};var yt=function(){};yt.prototype.isInBoundary=function(t){return t>1},yt.prototype.interfaces_=function(){return[ft]},yt.prototype.getClass=function(){return yt};var vt=function(){};vt.prototype.isInBoundary=function(t){return 1===t},vt.prototype.interfaces_=function(){return[ft]},vt.prototype.getClass=function(){return vt};var xt=function(){};xt.prototype.add=function(){},xt.prototype.addAll=function(){},xt.prototype.isEmpty=function(){},xt.prototype.iterator=function(){},xt.prototype.size=function(){},xt.prototype.toArray=function(){},xt.prototype.remove=function(){},(i.prototype=new Error).name="IndexOutOfBoundsException";var bt=function(){};bt.prototype.hasNext=function(){},bt.prototype.next=function(){},bt.prototype.remove=function(){};var wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(xt);(n.prototype=new Error).name="NoSuchElementException";var Et=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof xt&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,xt]},e.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.set=function(t,e){var i=this.array_[t];return this.array_[t]=e,i},e.prototype.iterator=function(){return new St(this)},e.prototype.get=function(t){if(t<0||t>=this.size())throw new i;return this.array_[t]},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t},e.prototype.remove=function(t){for(var e=!1,i=0,n=this.array_.length;i<n;i++)if(this.array_[i]===t){this.array_.splice(i,1),e=!0;break}return e},e}(wt),St=function(t){function e(e){t.call(this),this.arrayList_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new n;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(bt),Tt=function(t){function e(){if(t.call(this),0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this.ensureCapacity(i.length),this.add(i,n)}}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={coordArrayType:{configurable:!0}};return i.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(t){return this.get(t)},e.prototype.addAll=function(){if(2===arguments.length){for(var e=arguments[1],i=!1,n=arguments[0].iterator();n.hasNext();)this.add(n.next(),e),i=!0;return i}return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var e=t.prototype.clone.call(this),i=0;i<this.size();i++)e.add(i,this.get(i).copy());return e},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){if(1===arguments.length){var e=arguments[0];t.prototype.add.call(this,e)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var i=arguments[0],n=arguments[1];return this.add(i,n,!0),!0}if(arguments[0]instanceof S&&"boolean"==typeof arguments[1]){var r=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(r))return null;t.prototype.add.call(this,r)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1];return this.add(o,s),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var a=arguments[0],l=arguments[1];if(arguments[2])for(var c=0;c<a.length;c++)this.add(a[c],l);else for(var u=a.length-1;u>=0;u--)this.add(a[u],l);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof S){var h=arguments[0],d=arguments[1];if(!arguments[2]){var p=this.size();if(p>0){if(h>0&&this.get(h-1).equals2D(d))return null;if(h<p&&this.get(h).equals2D(d))return null}}t.prototype.add.call(this,h,d)}}else if(4===arguments.length){var f=arguments[0],m=arguments[1],g=arguments[2],_=arguments[3],y=1;g>_&&(y=-1);for(var v=g;v!==_;v+=y)this.add(f[v],m);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new S(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,i),e}(Et),Mt=function(){},It={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};It.ForwardComparator.get=function(){return Ct},It.BidirectionalComparator.get=function(){return At},It.coordArrayType.get=function(){return new Array(0).fill(null)},Mt.prototype.interfaces_=function(){return[]},Mt.prototype.getClass=function(){return Mt},Mt.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))},Mt.ptNotInList=function(t,e){for(var i=0;i<t.length;i++){var n=t[i];if(Mt.indexOf(n,e)<0)return n}return null},Mt.scroll=function(t,e){var i=Mt.indexOf(e,t);if(i<0)return null;var n=new Array(t.length).fill(null);H.arraycopy(t,i,n,0,t.length-i),H.arraycopy(t,0,n,t.length-i,i),H.arraycopy(n,0,t,0,t.length)},Mt.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(!t[i].equals(e[i]))return!1;return!0}if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2];if(n===r)return!0;if(null===n||null===r)return!1;if(n.length!==r.length)return!1;for(var s=0;s<n.length;s++)if(0!==o.compare(n[s],r[s]))return!1;return!0}},Mt.intersection=function(t,e){for(var i=new Tt,n=0;n<t.length;n++)e.intersects(t[n])&&i.add(t[n],!0);return i.toCoordinateArray()},Mt.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},Mt.removeRepeatedPoints=function(t){return Mt.hasRepeatedPoints(t)?new Tt(t,!1).toCoordinateArray():t},Mt.reverse=function(t){for(var e=t.length-1,i=Math.trunc(e/2),n=0;n<=i;n++){var r=t[n];t[n]=t[e-n],t[e-n]=r}},Mt.removeNull=function(t){for(var e=0,i=0;i<t.length;i++)null!==t[i]&&e++;var n=new Array(e).fill(null);if(0===e)return n;for(var r=0,o=0;o<t.length;o++)null!==t[o]&&(n[r++]=t[o]);return n},Mt.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),i=0;i<t.length;i++)e[i]=new S(t[i]);return e}if(5===arguments.length)for(var n=arguments[0],r=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],l=0;l<a;l++)o[s+l]=new S(n[r+l])},Mt.isEqualReversed=function(t,e){for(var i=0;i<t.length;i++){var n=t[i],r=e[t.length-i-1];if(0!==n.compareTo(r))return!1}return!0},Mt.envelope=function(t){for(var e=new q,i=0;i<t.length;i++)e.expandToInclude(t[i]);return e},Mt.toCoordinateArray=function(t){return t.toArray(Mt.coordArrayType)},Mt.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},Mt.indexOf=function(t,e){for(var i=0;i<e.length;i++)if(t.equals(e[i]))return i;return-1},Mt.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var i=t.length-1-e,n=t[e].compareTo(t[i]);if(0!==n)return n}return 1},Mt.compare=function(t,e){for(var i=0;i<t.length&&i<e.length;){var n=t[i].compareTo(e[i]);if(0!==n)return n;i++}return i<e.length?-1:i<t.length?1:0},Mt.minCoordinate=function(t){for(var e=null,i=0;i<t.length;i++)(null===e||e.compareTo(t[i])>0)&&(e=t[i]);return e},Mt.extract=function(t,e,i){e=L.clamp(e,0,t.length);var n=(i=L.clamp(i,-1,t.length))-e+1;i<0&&(n=0),e>=t.length&&(n=0),i<e&&(n=0);var r=new Array(n).fill(null);if(0===n)return r;for(var o=0,s=e;s<=i;s++)r[o++]=t[s];return r},Object.defineProperties(Mt,It);var Ct=function(){};Ct.prototype.compare=function(t,e){return Mt.compare(t,e)},Ct.prototype.interfaces_=function(){return[E]},Ct.prototype.getClass=function(){return Ct};var At=function(){};At.prototype.compare=function(t,e){var i=t,n=e;if(i.length<n.length)return-1;if(i.length>n.length)return 1;if(0===i.length)return 0;var r=Mt.compare(i,n);return Mt.isEqualReversed(i,n)?0:r},At.prototype.OLDcompare=function(t,e){var i=t,n=e;if(i.length<n.length)return-1;if(i.length>n.length)return 1;if(0===i.length)return 0;for(var r=Mt.increasingDirection(i),o=Mt.increasingDirection(n),s=r>0?0:i.length-1,a=o>0?0:i.length-1,l=0;l<i.length;l++){var c=i[s].compareTo(n[a]);if(0!==c)return c;s+=r,a+=o}return 0},At.prototype.interfaces_=function(){return[E]},At.prototype.getClass=function(){return At};var Pt=function(){};Pt.prototype.get=function(){},Pt.prototype.put=function(){},Pt.prototype.size=function(){},Pt.prototype.values=function(){},Pt.prototype.entrySet=function(){};var Lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Pt);(r.prototype=new Error).name="OperationNotSupported",(o.prototype=new xt).contains=function(){};var Rt=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof xt&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(t){for(var e=0,i=this.array_.length;e<i;e++)if(this.array_[e]===t)return!0;return!1},e.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.remove=function(t){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t},e.prototype.iterator=function(){return new Dt(this)},e}(o),Dt=function(t){function e(e){t.call(this),this.hashSet_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new n;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new r},e}(bt),kt=0;(h.prototype=new Lt).get=function(t){for(var e=this.root_;null!==e;){var i=t.compareTo(e.key);if(i<0)e=e.left;else{if(!(i>0))return e.value;e=e.right}}return null},h.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:kt,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var i,n,r=this.root_;do{if(i=r,(n=t.compareTo(r.key))<0)r=r.left;else{if(!(n>0)){var o=r.value;return r.value=e,o}r=r.right}}while(null!==r);var s={key:t,left:null,right:null,value:e,parent:i,color:kt,getValue:function(){return this.value},getKey:function(){return this.key}};return n<0?i.left=s:i.right=s,this.fixAfterInsertion(s),this.size_++,null},h.prototype.fixAfterInsertion=function(t){for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)if(a(t)===c(a(a(t)))){var e=u(a(a(t)));1===s(e)?(l(a(t),kt),l(e,kt),l(a(a(t)),1),t=a(a(t))):(t===u(a(t))&&(t=a(t),this.rotateLeft(t)),l(a(t),kt),l(a(a(t)),1),this.rotateRight(a(a(t))))}else{var i=c(a(a(t)));1===s(i)?(l(a(t),kt),l(i,kt),l(a(a(t)),1),t=a(a(t))):(t===c(a(t))&&(t=a(t),this.rotateRight(t)),l(a(t),kt),l(a(a(t)),1),this.rotateLeft(a(a(t))))}this.root_.color=kt},h.prototype.values=function(){var t=new Et,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=h.successor(e));)t.add(e.value);return t},h.prototype.entrySet=function(){var t=new Rt,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=h.successor(e));)t.add(e);return t},h.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}},h.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}},h.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},h.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var i=t.parent,n=t;null!==i&&n===i.right;)n=i,i=i.parent;return i},h.prototype.size=function(){return this.size_};var Nt=function(){};Nt.prototype.interfaces_=function(){return[]},Nt.prototype.getClass=function(){return Nt},d.prototype=new o,(p.prototype=new d).contains=function(t){for(var e=0,i=this.array_.length;e<i;e++)if(0===this.array_[e].compareTo(t))return!0;return!1},p.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,i=this.array_.length;e<i;e++)if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0;return this.array_.push(t),!0},p.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},p.prototype.remove=function(t){throw new r},p.prototype.size=function(){return this.array_.length},p.prototype.isEmpty=function(){return 0===this.array_.length},p.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t},p.prototype.iterator=function(){return new Ot(this)};var Ot=function(t){this.treeSet_=t,this.position_=0};Ot.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new n;return this.treeSet_.array_[this.position_++]},Ot.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Ot.prototype.remove=function(){throw new r};var Ft=function(){};Ft.sort=function(){var t,e,i,n,r=arguments[0];if(1===arguments.length)n=function(t,e){return t.compareTo(e)},r.sort(n);else if(2===arguments.length)i=arguments[1],n=function(t,e){return i.compare(t,e)},r.sort(n);else if(3===arguments.length){(e=r.slice(arguments[1],arguments[2])).sort();var o=r.slice(0,arguments[1]).concat(e,r.slice(arguments[2],r.length));for(r.splice(0,r.length),t=0;t<o.length;t++)r.push(o[t])}else if(4===arguments.length)for(e=r.slice(arguments[1],arguments[2]),i=arguments[3],n=function(t,e){return i.compare(t,e)},e.sort(n),o=r.slice(0,arguments[1]).concat(e,r.slice(arguments[2],r.length)),r.splice(0,r.length),t=0;t<o.length;t++)r.push(o[t])},Ft.asList=function(t){for(var e=new Et,i=0,n=t.length;i<n;i++)e.add(t[i]);return e};var zt=function(){},Bt={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Bt.P.get=function(){return 0},Bt.L.get=function(){return 1},Bt.A.get=function(){return 2},Bt.FALSE.get=function(){return-1},Bt.TRUE.get=function(){return-2},Bt.DONTCARE.get=function(){return-3},Bt.SYM_FALSE.get=function(){return"F"},Bt.SYM_TRUE.get=function(){return"T"},Bt.SYM_DONTCARE.get=function(){return"*"},Bt.SYM_P.get=function(){return"0"},Bt.SYM_L.get=function(){return"1"},Bt.SYM_A.get=function(){return"2"},zt.prototype.interfaces_=function(){return[]},zt.prototype.getClass=function(){return zt},zt.toDimensionSymbol=function(t){switch(t){case zt.FALSE:return zt.SYM_FALSE;case zt.TRUE:return zt.SYM_TRUE;case zt.DONTCARE:return zt.SYM_DONTCARE;case zt.P:return zt.SYM_P;case zt.L:return zt.SYM_L;case zt.A:return zt.SYM_A}throw new y("Unknown dimension value: "+t)},zt.toDimensionValue=function(t){switch(N.toUpperCase(t)){case zt.SYM_FALSE:return zt.FALSE;case zt.SYM_TRUE:return zt.TRUE;case zt.SYM_DONTCARE:return zt.DONTCARE;case zt.SYM_P:return zt.P;case zt.SYM_L:return zt.L;case zt.SYM_A:return zt.A}throw new y("Unknown dimension symbol: "+t)},Object.defineProperties(zt,Bt);var Ut=function(){};Ut.prototype.filter=function(t){},Ut.prototype.interfaces_=function(){return[]},Ut.prototype.getClass=function(){return Ut};var Vt=function(){};Vt.prototype.filter=function(t,e){},Vt.prototype.isDone=function(){},Vt.prototype.isGeometryChanged=function(){},Vt.prototype.interfaces_=function(){return[]},Vt.prototype.getClass=function(){return Vt};var jt=function(t){function e(e,i){if(t.call(this,i),this._geometries=e||[],t.hasNullElements(this._geometries))throw new y("geometries must not contain null elements")}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var t=new q,e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t},e.prototype.getGeometryN=function(t){return this._geometries[t]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,i=0;i<this._geometries.length;i++)for(var n=this._geometries[i].getCoordinates(),r=0;r<n.length;r++)t[++e]=n[r];return t},e.prototype.getArea=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e;if(this._geometries.length!==n._geometries.length)return!1;for(var r=0;r<this._geometries.length;r++)if(!this._geometries[r].equalsExact(n._geometries[r],i))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<this._geometries.length;t++)this._geometries[t].normalize();Ft.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var t=zt.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t},e.prototype.getDimension=function(){for(var t=zt.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t},e.prototype.getLength=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),i=0;i<this._geometries.length;i++)e[i]=this._geometries[i].reverse();return this.getFactory().createGeometryCollection(e)},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=new p(Ft.asList(this._geometries)),i=new p(Ft.asList(t._geometries));return this.compare(e,i)}if(2===arguments.length){for(var n=arguments[1],r=arguments[0],o=this.getNumGeometries(),s=r.getNumGeometries(),a=0;a<o&&a<s;){var l=this.getGeometryN(a),c=r.getGeometryN(a),u=l.compareToSameClass(c,n);if(0!==u)return u;a++}return a<o?1:a<s?-1:0}},e.prototype.apply=function(){if(P(arguments[0],pt))for(var t=arguments[0],e=0;e<this._geometries.length;e++)this._geometries[e].apply(t);else if(P(arguments[0],Vt)){var i=arguments[0];if(0===this._geometries.length)return null;for(var n=0;n<this._geometries.length&&(this._geometries[n].apply(i),!i.isDone());n++);i.isGeometryChanged()&&this.geometryChanged()}else if(P(arguments[0],Ut)){var r=arguments[0];r.filter(this);for(var o=0;o<this._geometries.length;o++)this._geometries[o].apply(r)}else if(P(arguments[0],ct)){var s=arguments[0];s.filter(this);for(var a=0;a<this._geometries.length;a++)this._geometries[a].apply(s)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),et.shouldNeverReachHere(),null},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._geometries=new Array(this._geometries.length).fill(null);for(var i=0;i<this._geometries.length;i++)e._geometries[i]=this._geometries[i].clone();return e},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.isEmpty=function(){for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(e,i),e}(ut),Gt=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ut.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,i)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?zt.FALSE:0},e.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),i=0;i<this._geometries.length;i++)e[t-1-i]=this._geometries[i].reverse();return this.getFactory().createMultiLineString(e)},e.prototype.getBoundary=function(){return new Ht(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Nt]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(e,i),e}(jt),Ht=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var t=arguments[0],e=ft.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this._geom=i,this._geomFact=i.getFactory(),this._bnRule=n}};Ht.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)},Ht.prototype.getBoundary=function(){return this._geom instanceof Yt?this.boundaryLineString(this._geom):this._geom instanceof Gt?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Ht.prototype.boundaryLineString=function(t){return this._geom.isEmpty()?this.getEmptyMultiPoint():t.isClosed()?this._bnRule.isInBoundary(2)?t.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},Ht.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Ht.prototype.computeBoundaryCoordinates=function(t){var e=new Et;this._endpointMap=new h;for(var i=0;i<t.getNumGeometries();i++){var n=t.getGeometryN(i);0!==n.getNumPoints()&&(this.addEndpoint(n.getCoordinateN(0)),this.addEndpoint(n.getCoordinateN(n.getNumPoints()-1)))}for(var r=this._endpointMap.entrySet().iterator();r.hasNext();){var o=r.next(),s=o.getValue().count;this._bnRule.isInBoundary(s)&&e.add(o.getKey())}return Mt.toCoordinateArray(e)},Ht.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);null===e&&(e=new Wt,this._endpointMap.put(t,e)),e.count++},Ht.prototype.interfaces_=function(){return[]},Ht.prototype.getClass=function(){return Ht},Ht.getBoundary=function(){return 1===arguments.length?new Ht(arguments[0]).getBoundary():2===arguments.length?new Ht(arguments[0],arguments[1]).getBoundary():void 0};var Wt=function(){this.count=null};Wt.prototype.interfaces_=function(){return[]},Wt.prototype.getClass=function(){return Wt};var qt=function(){},Xt={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};qt.prototype.interfaces_=function(){return[]},qt.prototype.getClass=function(){return qt},qt.chars=function(t,e){for(var i=new Array(e).fill(null),n=0;n<e;n++)i[n]=t;return String(i)},qt.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new function(){},i=new function(){}(e);return t.printStackTrace(i),e.toString()}if(2===arguments.length){for(var n=arguments[1],r="",o=new function(){}(new function(){}(qt.getStackTrace(arguments[0]))),s=0;s<n;s++)try{r+=o.readLine()+qt.NEWLINE}catch(t){if(!(t instanceof f))throw t;et.shouldNeverReachHere()}return r}},qt.split=function(t,e){for(var i=e.length,n=new Et,r=""+t,o=r.indexOf(e);o>=0;){var s=r.substring(0,o);n.add(s),o=(r=r.substring(o+i)).indexOf(e)}r.length>0&&n.add(r);for(var a=new Array(n.size()).fill(null),l=0;l<a.length;l++)a[l]=n.get(l);return a},qt.toString=function(){if(1===arguments.length){var t=arguments[0];return qt.SIMPLE_ORDINATE_FORMAT.format(t)}},qt.spaces=function(t){return qt.chars(" ",t)},Xt.NEWLINE.get=function(){return H.getProperty("line.separator")},Xt.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(qt,Xt);var $t=function(){};$t.prototype.interfaces_=function(){return[]},$t.prototype.getClass=function(){return $t},$t.copyCoord=function(t,e,i,n){for(var r=Math.min(t.getDimension(),i.getDimension()),o=0;o<r;o++)i.setOrdinate(n,o,t.getOrdinate(e,o))},$t.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&t.getOrdinate(0,U.X)===t.getOrdinate(e-1,U.X)&&t.getOrdinate(0,U.Y)===t.getOrdinate(e-1,U.Y)},$t.isEqual=function(t,e){var i=t.size();if(i!==e.size())return!1;for(var n=Math.min(t.getDimension(),e.getDimension()),r=0;r<i;r++)for(var o=0;o<n;o++){var s=t.getOrdinate(r,o),a=e.getOrdinate(r,o);if(!(t.getOrdinate(r,o)===e.getOrdinate(r,o)||v.isNaN(s)&&v.isNaN(a)))return!1}return!0},$t.extend=function(t,e,i){var n=t.create(i,e.getDimension()),r=e.size();if($t.copy(e,0,n,0,r),r>0)for(var o=r;o<i;o++)$t.copy(e,r-1,n,o,1);return n},$t.reverse=function(t){for(var e=t.size()-1,i=Math.trunc(e/2),n=0;n<=i;n++)$t.swap(t,n,e-n)},$t.swap=function(t,e,i){if(e===i)return null;for(var n=0;n<t.getDimension();n++){var r=t.getOrdinate(e,n);t.setOrdinate(e,n,t.getOrdinate(i,n)),t.setOrdinate(i,n,r)}},$t.copy=function(t,e,i,n,r){for(var o=0;o<r;o++)$t.copyCoord(t,e+o,i,n+o)},$t.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var i=t.getDimension(),n=new D;n.append("(");for(var r=0;r<e;r++){r>0&&n.append(" ");for(var o=0;o<i;o++)o>0&&n.append(","),n.append(qt.toString(t.getOrdinate(r,o)))}return n.append(")"),n.toString()}},$t.ensureValidRing=function(t,e){var i=e.size();return 0===i?e:i<=3?$t.createClosedRing(t,e,4):e.getOrdinate(0,U.X)===e.getOrdinate(i-1,U.X)&&e.getOrdinate(0,U.Y)===e.getOrdinate(i-1,U.Y)?e:$t.createClosedRing(t,e,i+1)},$t.createClosedRing=function(t,e,i){var n=t.create(i,e.getDimension()),r=e.size();$t.copy(e,0,n,0,r);for(var o=r;o<i;o++)$t.copy(e,0,n,o,1);return n};var Yt=function(t){function e(e,i){t.call(this,i),this._points=null,this.init(e)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new q:this._points.expandEnvelope(new q)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e;if(this._points.size()!==n._points.size())return!1;for(var r=0;r<this._points.size();r++)if(!this.equal(this._points.getCoordinate(r),n._points.getCoordinate(r),i))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<Math.trunc(this._points.size()/2);t++){var e=this._points.size()-1-t;if(!this._points.getCoordinate(t).equals(this._points.getCoordinate(e)))return this._points.getCoordinate(t).compareTo(this._points.getCoordinate(e))>0&&$t.reverse(this._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?zt.FALSE:0},e.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return at.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var t=this._points.copy();return $t.reverse(t),this.getFactory().createLineString(t)},e.prototype.compareToSameClass=function(){if(1===arguments.length){for(var t=arguments[0],e=0,i=0;e<this._points.size()&&i<t._points.size();){var n=this._points.getCoordinate(e).compareTo(t._points.getCoordinate(i));if(0!==n)return n;e++,i++}return e<this._points.size()?1:i<t._points.size()?-1:0}if(2===arguments.length){var r=arguments[0];return arguments[1].compare(this._points,r._points)}},e.prototype.apply=function(){if(P(arguments[0],pt))for(var t=arguments[0],e=0;e<this._points.size();e++)t.filter(this._points.getCoordinate(e));else if(P(arguments[0],Vt)){var i=arguments[0];if(0===this._points.size())return null;for(var n=0;n<this._points.size()&&(i.filter(this._points,n),!i.isDone());n++);i.isGeometryChanged()&&this.geometryChanged()}else(P(arguments[0],Ut)||P(arguments[0],ct))&&arguments[0].filter(this)},e.prototype.getBoundary=function(){return new Ht(this).getBoundary()},e.prototype.isEquivalentClass=function(t){return t instanceof e},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._points=this._points.clone(),e},e.prototype.getCoordinateN=function(t){return this._points.getCoordinate(t)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return 0===this._points.size()},e.prototype.init=function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new y("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t},e.prototype.isCoordinate=function(t){for(var e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(t){return this.getFactory().createPoint(this._points.getCoordinate(t))},e.prototype.interfaces_=function(){return[Nt]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,i),e}(ut),Zt=function(){};Zt.prototype.interfaces_=function(){return[]},Zt.prototype.getClass=function(){return Zt};var Kt=function(t){function e(e,i){t.call(this,i),this._coordinates=e||null,this.init(this._coordinates)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new q;var t=new q;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),i))}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return zt.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0];return this.getCoordinate().compareTo(t.getCoordinate())}if(2===arguments.length){var e=arguments[0];return arguments[1].compare(this._coordinates,e._coordinates)}},e.prototype.apply=function(){if(P(arguments[0],pt)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(P(arguments[0],Vt)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this._coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else(P(arguments[0],Ut)||P(arguments[0],ct))&&arguments[0].filter(this)},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._coordinates=this._coordinates.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this._coordinates.size()},e.prototype.init=function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),et.isTrue(t.size()<=1),this._coordinates=t},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Zt]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,i),e}(ut),Jt=function(){};Jt.prototype.interfaces_=function(){return[]},Jt.prototype.getClass=function(){return Jt};var Qt=function(t){function e(e,i,n){if(t.call(this,n),this._shell=null,this._holes=null,null===e&&(e=this.getFactory().createLinearRing()),null===i&&(i=[]),t.hasNullElements(i))throw new y("holes must not contain null elements");if(e.isEmpty()&&t.hasNonEmptyElements(i))throw new y("shell is empty but holes are not");this._shell=e,this._holes=i}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,i=this._shell.getCoordinates(),n=0;n<i.length;n++)t[++e]=i[n];for(var r=0;r<this._holes.length;r++)for(var o=this._holes[r].getCoordinates(),s=0;s<o.length;s++)t[++e]=o[s];return t},e.prototype.getArea=function(){var t=0;t+=Math.abs(at.signedArea(this._shell.getCoordinateSequence()));for(var e=0;e<this._holes.length;e++)t-=Math.abs(at.signedArea(this._holes[e].getCoordinateSequence()));return t},e.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),i=0;i<5;i++){var n=t.getX(i);if(n!==e.getMinX()&&n!==e.getMaxX())return!1;var r=t.getY(i);if(r!==e.getMinY()&&r!==e.getMaxY())return!1}for(var o=t.getX(0),s=t.getY(0),a=1;a<=4;a++){var l=t.getX(a),c=t.getY(a);if(l!==o==(c!==s))return!1;o=l,s=c}return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e,r=this._shell,o=n._shell;if(!r.equalsExact(o,i))return!1;if(this._holes.length!==n._holes.length)return!1;for(var s=0;s<this._holes.length;s++)if(!this._holes[s].equalsExact(n._holes[s],i))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var t=0;t<this._holes.length;t++)this.normalize(this._holes[t],!1);Ft.sort(this._holes)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(e.isEmpty())return null;var n=new Array(e.getCoordinates().length-1).fill(null);H.arraycopy(e.getCoordinates(),0,n,0,n.length);var r=Mt.minCoordinate(e.getCoordinates());Mt.scroll(n,r),H.arraycopy(n,0,e.getCoordinates(),0,n.length),e.getCoordinates()[n.length]=n[0],at.isCCW(e.getCoordinates())===i&&Mt.reverse(e.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var t=0;t+=this._shell.getLength();for(var e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=this._shell.getNumPoints(),e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t},e.prototype.reverse=function(){var t=this.copy();t._shell=this._shell.copy().reverse(),t._holes=new Array(this._holes.length).fill(null);for(var e=0;e<this._holes.length;e++)t._holes[e]=this._holes[e].copy().reverse();return t},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=this._shell,i=t._shell;return e.compareToSameClass(i)}if(2===arguments.length){var n=arguments[1],r=arguments[0],o=this._shell,s=r._shell,a=o.compareToSameClass(s,n);if(0!==a)return a;for(var l=this.getNumInteriorRing(),c=r.getNumInteriorRing(),u=0;u<l&&u<c;){var h=this.getInteriorRingN(u),d=r.getInteriorRingN(u),p=h.compareToSameClass(d,n);if(0!==p)return p;u++}return u<l?1:u<c?-1:0}},e.prototype.apply=function(t){if(P(t,pt)){this._shell.apply(t);for(var e=0;e<this._holes.length;e++)this._holes[e].apply(t)}else if(P(t,Vt)){if(this._shell.apply(t),!t.isDone())for(var i=0;i<this._holes.length&&(this._holes[i].apply(t),!t.isDone());i++);t.isGeometryChanged()&&this.geometryChanged()}else if(P(t,Ut))t.filter(this);else if(P(t,ct)){t.filter(this),this._shell.apply(t);for(var n=0;n<this._holes.length;n++)this._holes[n].apply(t)}},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(var e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._shell=this._shell.clone(),e._holes=new Array(this._holes.length).fill(null);for(var i=0;i<this._holes.length;i++)e._holes[i]=this._holes[i].clone();return e},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var t=this._shell.copy(),i=new Array(this._holes.length).fill(null),n=0;n<i.length;n++)i[n]=this._holes[n].copy();return new e(t,i,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(t){return this._holes[t]},e.prototype.interfaces_=function(){return[Jt]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,i),e}(ut),te=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ut.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,i)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._geometries[e].getCoordinate()}return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return zt.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Zt]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(e,i),e}(jt),ee=function(t){function e(e,i){e instanceof S&&i instanceof _e&&(e=i.getCoordinateSequenceFactory().create(e)),t.call(this,e,i),this.validateConstruction()}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ut.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return zt.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var t=this._points.copy();return $t.reverse(t),this.getFactory().createLinearRing(t)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new y("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new y("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},i.MINIMUM_VALID_SIZE.get=function(){return 4},i.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,i),e}(Yt),ie=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ut.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,i)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),i=0;i<this._geometries.length;i++)e[i]=this._geometries[i].reverse();return this.getFactory().createMultiPolygon(e)},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new Et,e=0;e<this._geometries.length;e++)for(var i=this._geometries[e].getBoundary(),n=0;n<i.getNumGeometries();n++)t.add(i.getGeometryN(n));var r=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(r))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Jt]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,i),e}(jt),ne=function(t){this._factory=t||null,this._isUserDataCopied=!1},re={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};ne.prototype.setCopyUserData=function(t){this._isUserDataCopied=t},ne.prototype.edit=function(t,e){if(null===t)return null;var i=this.editInternal(t,e);return this._isUserDataCopied&&i.setUserData(t.getUserData()),i},ne.prototype.editInternal=function(t,e){return null===this._factory&&(this._factory=t.getFactory()),t instanceof jt?this.editGeometryCollection(t,e):t instanceof Qt?this.editPolygon(t,e):t instanceof Kt||t instanceof Yt?e.edit(t,this._factory):(et.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},ne.prototype.editGeometryCollection=function(t,e){for(var i=e.edit(t,this._factory),n=new Et,r=0;r<i.getNumGeometries();r++){var o=this.edit(i.getGeometryN(r),e);null===o||o.isEmpty()||n.add(o)}return i.getClass()===te?this._factory.createMultiPoint(n.toArray([])):i.getClass()===Gt?this._factory.createMultiLineString(n.toArray([])):i.getClass()===ie?this._factory.createMultiPolygon(n.toArray([])):this._factory.createGeometryCollection(n.toArray([]))},ne.prototype.editPolygon=function(t,e){var i=e.edit(t,this._factory);if(null===i&&(i=this._factory.createPolygon(null)),i.isEmpty())return i;var n=this.edit(i.getExteriorRing(),e);if(null===n||n.isEmpty())return this._factory.createPolygon();for(var r=new Et,o=0;o<i.getNumInteriorRing();o++){var s=this.edit(i.getInteriorRingN(o),e);null===s||s.isEmpty()||r.add(s)}return this._factory.createPolygon(n,r.toArray([]))},ne.prototype.interfaces_=function(){return[]},ne.prototype.getClass=function(){return ne},ne.GeometryEditorOperation=function(){},re.NoOpGeometryOperation.get=function(){return oe},re.CoordinateOperation.get=function(){return se},re.CoordinateSequenceOperation.get=function(){return ae},Object.defineProperties(ne,re);var oe=function(){};oe.prototype.edit=function(t,e){return t},oe.prototype.interfaces_=function(){return[ne.GeometryEditorOperation]},oe.prototype.getClass=function(){return oe};var se=function(){};se.prototype.edit=function(t,e){var i=this.editCoordinates(t.getCoordinates(),t);return null===i?t:t instanceof ee?e.createLinearRing(i):t instanceof Yt?e.createLineString(i):t instanceof Kt?i.length>0?e.createPoint(i[0]):e.createPoint():t},se.prototype.interfaces_=function(){return[ne.GeometryEditorOperation]},se.prototype.getClass=function(){return se};var ae=function(){};ae.prototype.edit=function(t,e){return t instanceof ee?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Yt?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Kt?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},ae.prototype.interfaces_=function(){return[ne.GeometryEditorOperation]},ae.prototype.getClass=function(){return ae};var le=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var e=0;e<t;e++)this._coordinates[e]=new S}else if(P(arguments[0],U)){var i=arguments[0];if(null===i)return this._coordinates=new Array(0).fill(null),null;this._dimension=i.getDimension(),this._coordinates=new Array(i.size()).fill(null);for(var n=0;n<this._coordinates.length;n++)this._coordinates[n]=i.getCoordinateCopy(n)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var r=arguments[0],o=arguments[1];this._coordinates=r,this._dimension=o,null===r&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var s=arguments[0],a=arguments[1];this._coordinates=new Array(s).fill(null),this._dimension=a;for(var l=0;l<s;l++)this._coordinates[l]=new S}},ce={serialVersionUID:{configurable:!0}};le.prototype.setOrdinate=function(t,e,i){switch(e){case U.X:this._coordinates[t].x=i;break;case U.Y:this._coordinates[t].y=i;break;case U.Z:this._coordinates[t].z=i;break;default:throw new y("invalid ordinateIndex")}},le.prototype.size=function(){return this._coordinates.length},le.prototype.getOrdinate=function(t,e){switch(e){case U.X:return this._coordinates[t].x;case U.Y:return this._coordinates[t].y;case U.Z:return this._coordinates[t].z}return v.NaN},le.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this._coordinates[t]}if(2===arguments.length){var e=arguments[0],i=arguments[1];i.x=this._coordinates[e].x,i.y=this._coordinates[e].y,i.z=this._coordinates[e].z}},le.prototype.getCoordinateCopy=function(t){return new S(this._coordinates[t])},le.prototype.getDimension=function(){return this._dimension},le.prototype.getX=function(t){return this._coordinates[t].x},le.prototype.clone=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].clone();return new le(t,this._dimension)},le.prototype.expandEnvelope=function(t){for(var e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t},le.prototype.copy=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].copy();return new le(t,this._dimension)},le.prototype.toString=function(){if(this._coordinates.length>0){var t=new D(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}return"()"},le.prototype.getY=function(t){return this._coordinates[t].y},le.prototype.toCoordinateArray=function(){return this._coordinates},le.prototype.interfaces_=function(){return[U,e]},le.prototype.getClass=function(){return le},ce.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(le,ce);var ue=function(){},he={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};ue.prototype.readResolve=function(){return ue.instance()},ue.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new le(arguments[0]);if(P(arguments[0],U))return new le(arguments[0])}else if(2===arguments.length){var t=arguments[0],e=arguments[1];return e>3&&(e=3),e<2?new le(t):new le(t,e)}},ue.prototype.interfaces_=function(){return[I,e]},ue.prototype.getClass=function(){return ue},ue.instance=function(){return ue.instanceObject},he.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},he.instanceObject.get=function(){return new ue},Object.defineProperties(ue,he);var de=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return this.map_.get(t)||null},e.prototype.put=function(t,e){return this.map_.set(t,e),e},e.prototype.values=function(){for(var t=new Et,e=this.map_.values(),i=e.next();!i.done;)t.add(i.value),i=e.next();return t},e.prototype.entrySet=function(){var t=new Rt;return this.map_.entries().forEach((function(e){return t.add(e)})),t},e.prototype.size=function(){return this.map_.size()},e}(Pt),pe=function t(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=t.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof me){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var i=arguments[0];this._modelType=t.FIXED,this.setScale(i)}else if(arguments[0]instanceof t){var n=arguments[0];this._modelType=n._modelType,this._scale=n._scale}},fe={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};pe.prototype.equals=function(t){if(!(t instanceof pe))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale},pe.prototype.compareTo=function(t){var e=t,i=this.getMaximumSignificantDigits(),n=e.getMaximumSignificantDigits();return new k(i).compareTo(new k(n))},pe.prototype.getScale=function(){return this._scale},pe.prototype.isFloating=function(){return this._modelType===pe.FLOATING||this._modelType===pe.FLOATING_SINGLE},pe.prototype.getType=function(){return this._modelType},pe.prototype.toString=function(){var t="UNKNOWN";return this._modelType===pe.FLOATING?t="Floating":this._modelType===pe.FLOATING_SINGLE?t="Floating-Single":this._modelType===pe.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},pe.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var t=arguments[0];return v.isNaN(t)||this._modelType===pe.FLOATING_SINGLE?t:this._modelType===pe.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof S){var e=arguments[0];if(this._modelType===pe.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},pe.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===pe.FLOATING?t=16:this._modelType===pe.FLOATING_SINGLE?t=6:this._modelType===pe.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},pe.prototype.setScale=function(t){this._scale=Math.abs(t)},pe.prototype.interfaces_=function(){return[e,b]},pe.prototype.getClass=function(){return pe},pe.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e},fe.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},fe.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(pe,fe);var me=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},ge={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};me.prototype.readResolve=function(){return me.nameToTypeMap.get(this._name)},me.prototype.toString=function(){return this._name},me.prototype.interfaces_=function(){return[e]},me.prototype.getClass=function(){return me},ge.serialVersionUID.get=function(){return-552860263173159e4},ge.nameToTypeMap.get=function(){return new de},Object.defineProperties(me,ge),pe.Type=me,pe.FIXED=new me("FIXED"),pe.FLOATING=new me("FLOATING"),pe.FLOATING_SINGLE=new me("FLOATING SINGLE");var _e=function t(){this._precisionModel=new pe,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?P(arguments[0],I)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof pe&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},ye={serialVersionUID:{configurable:!0}};_e.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new S(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new S(t.getMinX(),t.getMinY()),new S(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new S(t.getMinX(),t.getMinY()),new S(t.getMinX(),t.getMaxY()),new S(t.getMaxX(),t.getMaxY()),new S(t.getMaxX(),t.getMinY()),new S(t.getMinX(),t.getMinY())]),null)},_e.prototype.createLineString=function(t){return t?t instanceof Array?new Yt(this.getCoordinateSequenceFactory().create(t),this):P(t,U)?new Yt(t,this):void 0:new Yt(this.getCoordinateSequenceFactory().create([]),this)},_e.prototype.createMultiLineString=function(){return 0===arguments.length?new Gt(null,this):1===arguments.length?new Gt(arguments[0],this):void 0},_e.prototype.buildGeometry=function(t){for(var e=null,i=!1,n=!1,r=t.iterator();r.hasNext();){var o=r.next(),s=o.getClass();null===e&&(e=s),s!==e&&(i=!0),o.isGeometryCollectionOrDerived()&&(n=!0)}if(null===e)return this.createGeometryCollection();if(i||n)return this.createGeometryCollection(_e.toGeometryArray(t));var a=t.iterator().next();if(t.size()>1){if(a instanceof Qt)return this.createMultiPolygon(_e.toPolygonArray(t));if(a instanceof Yt)return this.createMultiLineString(_e.toLineStringArray(t));if(a instanceof Kt)return this.createMultiPoint(_e.toPointArray(t));et.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a},_e.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},_e.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof S){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(P(arguments[0],U))return new Kt(arguments[0],this)}},_e.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},_e.prototype.createPolygon=function(){if(0===arguments.length)return new Qt(null,null,this);if(1===arguments.length){if(P(arguments[0],U)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof ee){var i=arguments[0];return this.createPolygon(i,null)}}else if(2===arguments.length)return new Qt(arguments[0],arguments[1],this)},_e.prototype.getSRID=function(){return this._SRID},_e.prototype.createGeometryCollection=function(){return 0===arguments.length?new jt(null,this):1===arguments.length?new jt(arguments[0],this):void 0},_e.prototype.createGeometry=function(t){return new ne(this).edit(t,{edit:function(){if(2===arguments.length){var t=arguments[0];return this._coordinateSequenceFactory.create(t)}}})},_e.prototype.getPrecisionModel=function(){return this._precisionModel},_e.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(P(arguments[0],U))return new ee(arguments[0],this)}},_e.prototype.createMultiPolygon=function(){return 0===arguments.length?new ie(null,this):1===arguments.length?new ie(arguments[0],this):void 0},_e.prototype.createMultiPoint=function(){if(0===arguments.length)return new te(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new te(arguments[0],this);if(arguments[0]instanceof Array){var t=arguments[0];return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(P(arguments[0],U)){var e=arguments[0];if(null===e)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(e.size()).fill(null),n=0;n<e.size();n++){var r=this.getCoordinateSequenceFactory().create(1,e.getDimension());$t.copy(e,n,r,0,1),i[n]=this.createPoint(r)}return this.createMultiPoint(i)}}},_e.prototype.interfaces_=function(){return[e]},_e.prototype.getClass=function(){return _e},_e.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.getDefaultCoordinateSequenceFactory=function(){return ue.instance()},_e.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},ye.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(_e,ye);var ve=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],xe=function(t){this.geometryFactory=t||new _e};xe.prototype.read=function(t){var e,i=(e="string"==typeof t?JSON.parse(t):t).type;if(!be[i])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==ve.indexOf(i)?be[i].apply(this,[e.coordinates]):"GeometryCollection"===i?be[i].apply(this,[e.geometries]):be[i].apply(this,[e])},xe.prototype.write=function(t){var e=t.getGeometryType();if(!we[e])throw new Error("Geometry is not supported");return we[e].apply(this,[t])};var be={Feature:function(t){var e={};for(var i in t)e[i]=t[i];if(t.geometry){var n=t.geometry.type;if(!be[n])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=be.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var i=0;i<t.features.length;++i)e.features.push(this.read(t.features[i]))}return t.bbox&&(e.bbox=this.parse.bbox.apply(this,[t.bbox])),e},coordinates:function(t){for(var e=[],i=0;i<t.length;++i){var n=t[i];e.push(new S(n[0],n[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new S(t[0],t[1]),new S(t[2],t[1]),new S(t[2],t[3]),new S(t[0],t[3]),new S(t[0],t[1])])},Point:function(t){var e=new S(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],i=0;i<t.length;++i)e.push(be.Point.apply(this,[t[i]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=be.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],i=0;i<t.length;++i)e.push(be.LineString.apply(this,[t[i]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=be.coordinates.apply(this,[t[0]]),i=this.geometryFactory.createLinearRing(e),n=[],r=1;r<t.length;++r){var o=t[r],s=be.coordinates.apply(this,[o]),a=this.geometryFactory.createLinearRing(s);n.push(a)}return this.geometryFactory.createPolygon(i,n)},MultiPolygon:function(t){for(var e=[],i=0;i<t.length;++i){var n=t[i];e.push(be.Polygon.apply(this,[n]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],i=0;i<t.length;++i){var n=t[i];e.push(this.read(n))}return this.geometryFactory.createGeometryCollection(e)}},we={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:we.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var n=t._geometries[i],r=we.Point.apply(this,[n]);e.push(r.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],i=t.getCoordinates(),n=0;n<i.length;++n){var r=i[n];e.push(we.coordinate.apply(this,[r]))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var n=t._geometries[i],r=we.LineString.apply(this,[n]);e.push(r.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],i=we.LineString.apply(this,[t._shell]);e.push(i.coordinates);for(var n=0;n<t._holes.length;++n){var r=t._holes[n],o=we.LineString.apply(this,[r]);e.push(o.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var n=t._geometries[i],r=we.Polygon.apply(this,[n]);e.push(r.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var n=t._geometries[i],r=n.getGeometryType();e.push(we[r].apply(this,[n]))}return{type:"GeometryCollection",geometries:e}}},Ee=function(t){this.geometryFactory=t||new _e,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new xe(this.geometryFactory)};Ee.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===pe.FIXED&&this.reducePrecision(e),e},Ee.prototype.reducePrecision=function(t){var e,i;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,i=t.points.length;e<i;e++)this.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,i=t.geometries.length;e<i;e++)this.reducePrecision(t.geometries[e])};var Se=function(){this.parser=new xe(this.geometryFactory)};Se.prototype.write=function(t){return this.parser.write(t)};var Te=function(){},Me={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};Te.prototype.interfaces_=function(){return[]},Te.prototype.getClass=function(){return Te},Te.opposite=function(t){return t===Te.LEFT?Te.RIGHT:t===Te.RIGHT?Te.LEFT:t},Me.ON.get=function(){return 0},Me.LEFT.get=function(){return 1},Me.RIGHT.get=function(){return 2},Object.defineProperties(Te,Me),(m.prototype=new Error).name="EmptyStackException",(g.prototype=new wt).add=function(t){return this.array_.push(t),!0},g.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]},g.prototype.push=function(t){return this.array_.push(t),t},g.prototype.pop=function(t){if(0===this.array_.length)throw new m;return this.array_.pop()},g.prototype.peek=function(){if(0===this.array_.length)throw new m;return this.array_[this.array_.length-1]},g.prototype.empty=function(){return 0===this.array_.length},g.prototype.isEmpty=function(){return this.empty()},g.prototype.search=function(t){return this.array_.indexOf(t)},g.prototype.size=function(){return this.array_.length},g.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t};var Ie=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Ie.prototype.getCoordinate=function(){return this._minCoord},Ie.prototype.getRightmostSide=function(t,e){var i=this.getRightmostSideOfSegment(t,e);return i<0&&(i=this.getRightmostSideOfSegment(t,e-1)),i<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),i},Ie.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();et.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],i=t[this._minIndex+1],n=at.computeOrientation(this._minCoord,i,e),r=!1;(e.y<this._minCoord.y&&i.y<this._minCoord.y&&n===at.COUNTERCLOCKWISE||e.y>this._minCoord.y&&i.y>this._minCoord.y&&n===at.CLOCKWISE)&&(r=!0),r&&(this._minIndex=this._minIndex-1)},Ie.prototype.getRightmostSideOfSegment=function(t,e){var i=t.getEdge().getCoordinates();if(e<0||e+1>=i.length)return-1;if(i[e].y===i[e+1].y)return-1;var n=Te.LEFT;return i[e].y<i[e+1].y&&(n=Te.RIGHT),n},Ie.prototype.getEdge=function(){return this._orientedDe},Ie.prototype.checkForRightmostCoordinate=function(t){for(var e=t.getEdge().getCoordinates(),i=0;i<e.length-1;i++)(null===this._minCoord||e[i].x>this._minCoord.x)&&(this._minDe=t,this._minIndex=i,this._minCoord=e[i])},Ie.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode().getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},Ie.prototype.findEdge=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next();i.isForward()&&this.checkForRightmostCoordinate(i)}et.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Te.LEFT&&(this._orientedDe=this._minDe.getSym())},Ie.prototype.interfaces_=function(){return[]},Ie.prototype.getClass=function(){return Ie};var Ce=function(t){function e(i,n){t.call(this,e.msgWithCoord(i,n)),this.pt=n?new S(n):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(t,e){return e?t:t+" [ "+e+" ]"},e}(Q),Ae=function(){this.array_=[]};Ae.prototype.addLast=function(t){this.array_.push(t)},Ae.prototype.removeFirst=function(){return this.array_.shift()},Ae.prototype.isEmpty=function(){return 0===this.array_.length};var Pe=function(){this._finder=null,this._dirEdgeList=new Et,this._nodes=new Et,this._rightMostCoord=null,this._env=null,this._finder=new Ie};Pe.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();)t.next().setVisited(!1)},Pe.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},Pe.prototype.computeNodeDepth=function(t){for(var e=null,i=t.getEdges().iterator();i.hasNext();){var n=i.next();if(n.isVisited()||n.getSym().isVisited()){e=n;break}}if(null===e)throw new Ce("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var r=t.getEdges().iterator();r.hasNext();){var o=r.next();o.setVisited(!0),this.copySymDepths(o)}},Pe.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(Te.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},Pe.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},Pe.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(Te.RIGHT)>=1&&e.getDepth(Te.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},Pe.prototype.computeDepths=function(t){var e=new Rt,i=new Ae,n=t.getNode();for(i.addLast(n),e.add(n),t.setVisited(!0);!i.isEmpty();){var r=i.removeFirst();e.add(r),this.computeNodeDepth(r);for(var o=r.getEdges().iterator();o.hasNext();){var s=o.next().getSym();if(!s.isVisited()){var a=s.getNode();e.contains(a)||(i.addLast(a),e.add(a))}}}},Pe.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0},Pe.prototype.getEnvelope=function(){if(null===this._env){for(var t=new q,e=this._dirEdgeList.iterator();e.hasNext();)for(var i=e.next().getEdge().getCoordinates(),n=0;n<i.length-1;n++)t.expandToInclude(i[n]);this._env=t}return this._env},Pe.prototype.addReachable=function(t){var e=new g;for(e.add(t);!e.empty();){var i=e.pop();this.add(i,e)}},Pe.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(Te.LEFT,t.getDepth(Te.RIGHT)),e.setDepth(Te.RIGHT,t.getDepth(Te.LEFT))},Pe.prototype.add=function(t,e){t.setVisited(!0),this._nodes.add(t);for(var i=t.getEdges().iterator();i.hasNext();){var n=i.next();this._dirEdgeList.add(n);var r=n.getSym().getNode();r.isVisited()||e.push(r)}},Pe.prototype.getNodes=function(){return this._nodes},Pe.prototype.getDirectedEdges=function(){return this._dirEdgeList},Pe.prototype.interfaces_=function(){return[b]},Pe.prototype.getClass=function(){return Pe};var Le=function t(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];this.init(e.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[Te.ON]=i}else if(arguments[0]instanceof t){var n=arguments[0];if(this.init(n.location.length),null!==n)for(var r=0;r<this.location.length;r++)this.location[r]=n.location[r]}}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.init(3),this.location[Te.ON]=o,this.location[Te.LEFT]=s,this.location[Te.RIGHT]=a}};Le.prototype.setAllLocations=function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},Le.prototype.isNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==C.NONE)return!1;return!0},Le.prototype.setAllLocationsIfNull=function(t){for(var e=0;e<this.location.length;e++)this.location[e]===C.NONE&&(this.location[e]=t)},Le.prototype.isLine=function(){return 1===this.location.length},Le.prototype.merge=function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[Te.ON]=this.location[Te.ON],e[Te.LEFT]=C.NONE,e[Te.RIGHT]=C.NONE,this.location=e}for(var i=0;i<this.location.length;i++)this.location[i]===C.NONE&&i<t.location.length&&(this.location[i]=t.location[i])},Le.prototype.getLocations=function(){return this.location},Le.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[Te.LEFT];this.location[Te.LEFT]=this.location[Te.RIGHT],this.location[Te.RIGHT]=t},Le.prototype.toString=function(){var t=new D;return this.location.length>1&&t.append(C.toLocationSymbol(this.location[Te.LEFT])),t.append(C.toLocationSymbol(this.location[Te.ON])),this.location.length>1&&t.append(C.toLocationSymbol(this.location[Te.RIGHT])),t.toString()},Le.prototype.setLocations=function(t,e,i){this.location[Te.ON]=t,this.location[Te.LEFT]=e,this.location[Te.RIGHT]=i},Le.prototype.get=function(t){return t<this.location.length?this.location[t]:C.NONE},Le.prototype.isArea=function(){return this.location.length>1},Le.prototype.isAnyNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===C.NONE)return!0;return!1},Le.prototype.setLocation=function(){if(1===arguments.length){var t=arguments[0];this.setLocation(Te.ON,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this.location[e]=i}},Le.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(C.NONE)},Le.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]},Le.prototype.allPositionsEqual=function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},Le.prototype.interfaces_=function(){return[]},Le.prototype.getClass=function(){return Le};var Re=function t(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new Le(e),this.elt[1]=new Le(e)}else if(arguments[0]instanceof t){var i=arguments[0];this.elt[0]=new Le(i.elt[0]),this.elt[1]=new Le(i.elt[1])}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.elt[0]=new Le(C.NONE),this.elt[1]=new Le(C.NONE),this.elt[n].setLocation(r)}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.elt[0]=new Le(o,s,a),this.elt[1]=new Le(o,s,a)}else if(4===arguments.length){var l=arguments[0],c=arguments[1],u=arguments[2],h=arguments[3];this.elt[0]=new Le(C.NONE,C.NONE,C.NONE),this.elt[1]=new Le(C.NONE,C.NONE,C.NONE),this.elt[l].setLocations(c,u,h)}};Re.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},Re.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)},Re.prototype.isNull=function(t){return this.elt[t].isNull()},Re.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this.elt[e].setAllLocationsIfNull(i)}},Re.prototype.isLine=function(t){return this.elt[t].isLine()},Re.prototype.merge=function(t){for(var e=0;e<2;e++)null===this.elt[e]&&null!==t.elt[e]?this.elt[e]=new Le(t.elt[e]):this.elt[e].merge(t.elt[e])},Re.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Re.prototype.getLocation=function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(Te.ON)}if(2===arguments.length){var e=arguments[0],i=arguments[1];return this.elt[e].get(i)}},Re.prototype.toString=function(){var t=new D;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},Re.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},Re.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()},Re.prototype.setLocation=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(Te.ON,e)}else if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];this.elt[i].setLocation(n,r)}},Re.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},Re.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)},Re.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Le(this.elt[t].location[0]))},Re.prototype.interfaces_=function(){return[]},Re.prototype.getClass=function(){return Re},Re.toLineLabel=function(t){for(var e=new Re(C.NONE),i=0;i<2;i++)e.setLocation(i,t.getLocation(i));return e};var De=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new Et,this._pts=new Et,this._label=new Re(C.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Et,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};De.prototype.computeRing=function(){if(null!==this._ring)return null;for(var t=new Array(this._pts.size()).fill(null),e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=at.isCCW(this._ring.getCoordinates())},De.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},De.prototype.computePoints=function(t){this._startDe=t;var e=t,i=!0;do{if(null===e)throw new Ce("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new Ce("Directed Edge visited twice during ring-building at "+e.getCoordinate());this._edges.add(e);var n=e.getLabel();et.isTrue(n.isArea()),this.mergeLabel(n),this.addPoints(e.getEdge(),e.isForward(),i),i=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this._startDe)},De.prototype.getLinearRing=function(){return this._ring},De.prototype.getCoordinate=function(t){return this._pts.get(t)},De.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var t=this._startDe;do{var e=t.getNode().getEdges().getOutgoingDegree(this);e>this._maxNodeDegree&&(this._maxNodeDegree=e),t=this.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2},De.prototype.addPoints=function(t,e,i){var n=t.getCoordinates();if(e){var r=1;i&&(r=0);for(var o=r;o<n.length;o++)this._pts.add(n[o])}else{var s=n.length-2;i&&(s=n.length-1);for(var a=s;a>=0;a--)this._pts.add(n[a])}},De.prototype.isHole=function(){return this._isHole},De.prototype.setInResult=function(){var t=this._startDe;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this._startDe)},De.prototype.containsPoint=function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!at.isPointInRing(t,e.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();)if(i.next().containsPoint(t))return!1;return!0},De.prototype.addHole=function(t){this._holes.add(t)},De.prototype.isShell=function(){return null===this._shell},De.prototype.getLabel=function(){return this._label},De.prototype.getEdges=function(){return this._edges},De.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},De.prototype.getShell=function(){return this._shell},De.prototype.mergeLabel=function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[1],i=arguments[0].getLocation(e,Te.RIGHT);if(i===C.NONE)return null;if(this._label.getLocation(e)===C.NONE)return this._label.setLocation(e,i),null}},De.prototype.setShell=function(t){this._shell=t,null!==t&&t.addHole(this)},De.prototype.toPolygon=function(t){for(var e=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)e[i]=this._holes.get(i).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},De.prototype.interfaces_=function(){return[]},De.prototype.getClass=function(){return De};var ke=function(t){function e(){var e=arguments[0],i=arguments[1];t.call(this,e,i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(t,e){t.setMinEdgeRing(e)},e.prototype.getNext=function(t){return t.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(De),Ne=function(t){function e(){var e=arguments[0],i=arguments[1];t.call(this,e,i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var t=new Et,e=this._startDe;do{if(null===e.getMinEdgeRing()){var i=new ke(e,this._geometryFactory);t.add(i)}e=e.getNext()}while(e!==this._startDe);return t},e.prototype.setEdgeRing=function(t,e){t.setEdgeRing(e)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var t=this._startDe;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this._startDe)},e.prototype.getNext=function(t){return t.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(De),Oe=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._label=t}};Oe.prototype.setVisited=function(t){this._isVisited=t},Oe.prototype.setInResult=function(t){this._isInResult=t},Oe.prototype.isCovered=function(){return this._isCovered},Oe.prototype.isCoveredSet=function(){return this._isCoveredSet},Oe.prototype.setLabel=function(t){this._label=t},Oe.prototype.getLabel=function(){return this._label},Oe.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0},Oe.prototype.updateIM=function(t){et.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)},Oe.prototype.isInResult=function(){return this._isInResult},Oe.prototype.isVisited=function(){return this._isVisited},Oe.prototype.interfaces_=function(){return[]},Oe.prototype.getClass=function(){return Oe};var Fe=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var e=arguments[0],i=arguments[1];this._coord=e,this._edges=i,this._label=new Re(0,C.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1},e.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(t){t.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(t){},e.prototype.computeMergedLocation=function(t,e){var i=C.NONE;if(i=this._label.getLocation(e),!t.isNull(e)){var n=t.getLocation(e);i!==C.BOUNDARY&&(i=n)}return i},e.prototype.setLabel=function(){if(2!==arguments.length)return t.prototype.setLabel.apply(this,arguments);var e=arguments[0],i=arguments[1];null===this._label?this._label=new Re(e,i):this._label.setLocation(e,i)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){if(arguments[0]instanceof e){var t=arguments[0];this.mergeLabel(t._label)}else if(arguments[0]instanceof Re)for(var i=arguments[0],n=0;n<2;n++){var r=this.computeMergedLocation(i,n);this._label.getLocation(n)===C.NONE&&this._label.setLocation(n,r)}},e.prototype.add=function(t){this._edges.insert(t),t.setNode(this)},e.prototype.setLabelBoundary=function(t){if(null===this._label)return null;var e=C.NONE;null!==this._label&&(e=this._label.getLocation(t));var i=null;if(e===C.BOUNDARY)i=C.INTERIOR;else i=C.BOUNDARY;this._label.setLocation(t,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Oe),ze=function(){this.nodeMap=new h,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};ze.prototype.find=function(t){return this.nodeMap.get(t)},ze.prototype.addNode=function(){if(arguments[0]instanceof S){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof Fe){var i=arguments[0],n=this.nodeMap.get(i.getCoordinate());return null===n?(this.nodeMap.put(i.getCoordinate(),i),i):(n.mergeLabel(i),n)}},ze.prototype.print=function(t){for(var e=this.iterator();e.hasNext();)e.next().print(t)},ze.prototype.iterator=function(){return this.nodeMap.values().iterator()},ze.prototype.values=function(){return this.nodeMap.values()},ze.prototype.getBoundaryNodes=function(t){for(var e=new Et,i=this.iterator();i.hasNext();){var n=i.next();n.getLabel().getLocation(t)===C.BOUNDARY&&e.add(n)}return e},ze.prototype.add=function(t){var e=t.getCoordinate();this.addNode(e).add(t)},ze.prototype.interfaces_=function(){return[]},ze.prototype.getClass=function(){return ze};var Be=function(){},Ue={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Be.prototype.interfaces_=function(){return[]},Be.prototype.getClass=function(){return Be},Be.isNorthern=function(t){return t===Be.NE||t===Be.NW},Be.isOpposite=function(t,e){return t!==e&&2==(t-e+4)%4},Be.commonHalfPlane=function(t,e){if(t===e)return t;if(2==(t-e+4)%4)return-1;var i=t<e?t:e;return 0===i&&3===(t>e?t:e)?3:i},Be.isInHalfPlane=function(t,e){return e===Be.SE?t===Be.SE||t===Be.SW:t===e||t===e+1},Be.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new y("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Be.NE:Be.SE:e>=0?Be.NW:Be.SW}if(arguments[0]instanceof S&&arguments[1]instanceof S){var i=arguments[0],n=arguments[1];if(n.x===i.x&&n.y===i.y)throw new y("Cannot compute the quadrant for two identical points "+i);return n.x>=i.x?n.y>=i.y?Be.NE:Be.SE:n.y>=i.y?Be.NW:Be.SW}},Ue.NE.get=function(){return 0},Ue.NW.get=function(){return 1},Ue.SW.get=function(){return 2},Ue.SE.get=function(){return 3},Object.defineProperties(Be,Ue);var Ve=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var e=arguments[0],i=arguments[1],n=arguments[2];this._edge=e,this.init(i,n),this._label=null}else if(4===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this._edge=r,this.init(o,s),this._label=a}};Ve.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:at.computeOrientation(t._p0,t._p1,this._p1)},Ve.prototype.getDy=function(){return this._dy},Ve.prototype.getCoordinate=function(){return this._p0},Ve.prototype.setNode=function(t){this._node=t},Ve.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),i=this.getClass().getName(),n=i.lastIndexOf("."),r=i.substring(n+1);t.print("  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)},Ve.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)},Ve.prototype.getDirectedCoordinate=function(){return this._p1},Ve.prototype.getDx=function(){return this._dx},Ve.prototype.getLabel=function(){return this._label},Ve.prototype.getEdge=function(){return this._edge},Ve.prototype.getQuadrant=function(){return this._quadrant},Ve.prototype.getNode=function(){return this._node},Ve.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),i=e.lastIndexOf(".");return"  "+e.substring(i+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label},Ve.prototype.computeLabel=function(t){},Ve.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Be.quadrant(this._dx,this._dy),et.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},Ve.prototype.interfaces_=function(){return[b]},Ve.prototype.getClass=function(){return Ve};var je=function(t){function e(){var e=arguments[0],i=arguments[1];if(t.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=i,i)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var n=e.getNumPoints()-1;this.init(e.getCoordinate(n),e.getCoordinate(n-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(t){return this._depth[t]},e.prototype.setVisited=function(t){this._isVisited=t},e.prototype.computeDirectedLabel=function(){this._label=new Re(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(t,e){if(-999!==this._depth[t]&&this._depth[t]!==e)throw new Ce("assigned depths do not match",this.getCoordinate());this._depth[t]=e},e.prototype.isInteriorAreaEdge=function(){for(var t=!0,e=0;e<2;e++)this._label.isArea(e)&&this._label.getLocation(e,Te.LEFT)===C.INTERIOR&&this._label.getLocation(e,Te.RIGHT)===C.INTERIOR||(t=!1);return t},e.prototype.setNextMin=function(t){this._nextMin=t},e.prototype.print=function(e){t.prototype.print.call(this,e),e.print(" "+this._depth[Te.LEFT]+"/"+this._depth[Te.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},e.prototype.setMinEdgeRing=function(t){this._minEdgeRing=t},e.prototype.isLineEdge=function(){var t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,C.EXTERIOR),i=!this._label.isArea(1)||this._label.allPositionsEqual(1,C.EXTERIOR);return t&&e&&i},e.prototype.setEdgeRing=function(t){this._edgeRing=t},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t},e.prototype.setInResult=function(t){this._isInResult=t},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)},e.prototype.setSym=function(t){this._sym=t},e.prototype.setVisitedEdge=function(t){this.setVisited(t),this._sym.setVisited(t)},e.prototype.setEdgeDepths=function(t,e){var i=this.getEdge().getDepthDelta();this._isForward||(i=-i);var n=1;t===Te.LEFT&&(n=-1);var r=Te.opposite(t),o=e+i*n;this.setDepth(t,e),this.setDepth(r,o)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(t){this._next=t},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(t,e){return t===C.EXTERIOR&&e===C.INTERIOR?1:t===C.INTERIOR&&e===C.EXTERIOR?-1:0},e}(Ve),Ge=function(){};Ge.prototype.createNode=function(t){return new Fe(t,null)},Ge.prototype.interfaces_=function(){return[]},Ge.prototype.getClass=function(){return Ge};var He=function(){if(this._edges=new Et,this._nodes=null,this._edgeEndList=new Et,0===arguments.length)this._nodes=new ze(new Ge);else if(1===arguments.length){var t=arguments[0];this._nodes=new ze(t)}};He.prototype.printEdges=function(t){t.println("Edges:");for(var e=0;e<this._edges.size();e++){t.println("edge "+e+":");var i=this._edges.get(e);i.print(t),i.eiList.print(t)}},He.prototype.find=function(t){return this._nodes.find(t)},He.prototype.addNode=function(){if(arguments[0]instanceof Fe){var t=arguments[0];return this._nodes.addNode(t)}if(arguments[0]instanceof S){var e=arguments[0];return this._nodes.addNode(e)}},He.prototype.getNodeIterator=function(){return this._nodes.iterator()},He.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()},He.prototype.debugPrintln=function(t){H.out.println(t)},He.prototype.isBoundaryNode=function(t,e){var i=this._nodes.find(e);if(null===i)return!1;var n=i.getLabel();return null!==n&&n.getLocation(t)===C.BOUNDARY},He.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()},He.prototype.matchInSameDirection=function(t,e,i,n){return!!t.equals(i)&&at.computeOrientation(t,e,n)===at.COLLINEAR&&Be.quadrant(t,e)===Be.quadrant(i,n)},He.prototype.getEdgeEnds=function(){return this._edgeEndList},He.prototype.debugPrint=function(t){H.out.print(t)},He.prototype.getEdgeIterator=function(){return this._edges.iterator()},He.prototype.findEdgeInSameDirection=function(t,e){for(var i=0;i<this._edges.size();i++){var n=this._edges.get(i),r=n.getCoordinates();if(this.matchInSameDirection(t,e,r[0],r[1]))return n;if(this.matchInSameDirection(t,e,r[r.length-1],r[r.length-2]))return n}return null},He.prototype.insertEdge=function(t){this._edges.add(t)},He.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var i=e.next();if(i.getEdge()===t)return i}return null},He.prototype.addEdges=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next();this._edges.add(i);var n=new je(i,!0),r=new je(i,!1);n.setSym(r),r.setSym(n),this.add(n),this.add(r)}},He.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)},He.prototype.getNodes=function(){return this._nodes.values()},He.prototype.findEdge=function(t,e){for(var i=0;i<this._edges.size();i++){var n=this._edges.get(i),r=n.getCoordinates();if(t.equals(r[0])&&e.equals(r[1]))return n}return null},He.prototype.interfaces_=function(){return[]},He.prototype.getClass=function(){return He},He.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()};var We=function(){this._geometryFactory=null,this._shellList=new Et;var t=arguments[0];this._geometryFactory=t};We.prototype.sortShellsAndHoles=function(t,e,i){for(var n=t.iterator();n.hasNext();){var r=n.next();r.isHole()?i.add(r):e.add(r)}},We.prototype.computePolygons=function(t){for(var e=new Et,i=t.iterator();i.hasNext();){var n=i.next().toPolygon(this._geometryFactory);e.add(n)}return e},We.prototype.placeFreeHoles=function(t,e){for(var i=e.iterator();i.hasNext();){var n=i.next();if(null===n.getShell()){var r=this.findEdgeRingContaining(n,t);if(null===r)throw new Ce("unable to assign hole to a shell",n.getCoordinate(0));n.setShell(r)}}},We.prototype.buildMinimalEdgeRings=function(t,e,i){for(var n=new Et,r=t.iterator();r.hasNext();){var o=r.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var s=o.buildMinimalRings(),a=this.findShell(s);null!==a?(this.placePolygonHoles(a,s),e.add(a)):i.addAll(s)}else n.add(o)}return n},We.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();)if(e.next().containsPoint(t))return!0;return!1},We.prototype.buildMaximalEdgeRings=function(t){for(var e=new Et,i=t.iterator();i.hasNext();){var n=i.next();if(n.isInResult()&&n.getLabel().isArea()&&null===n.getEdgeRing()){var r=new Ne(n,this._geometryFactory);e.add(r),r.setInResult()}}return e},We.prototype.placePolygonHoles=function(t,e){for(var i=e.iterator();i.hasNext();){var n=i.next();n.isHole()&&n.setShell(t)}},We.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},We.prototype.findEdgeRingContaining=function(t,e){for(var i=t.getLinearRing(),n=i.getEnvelopeInternal(),r=i.getCoordinateN(0),o=null,s=null,a=e.iterator();a.hasNext();){var l=a.next(),c=l.getLinearRing(),u=c.getEnvelopeInternal();null!==o&&(s=o.getLinearRing().getEnvelopeInternal());var h=!1;u.contains(n)&&at.isPointInRing(r,c.getCoordinates())&&(h=!0),h&&(null===o||s.contains(u))&&(o=l)}return o},We.prototype.findShell=function(t){for(var e=0,i=null,n=t.iterator();n.hasNext();){var r=n.next();r.isHole()||(i=r,e++)}return et.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),i},We.prototype.add=function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0];He.linkResultDirectedEdges(arguments[1]);var i=this.buildMaximalEdgeRings(e),n=new Et,r=this.buildMinimalEdgeRings(i,this._shellList,n);this.sortShellsAndHoles(r,this._shellList,n),this.placeFreeHoles(this._shellList,n)}},We.prototype.interfaces_=function(){return[]},We.prototype.getClass=function(){return We};var qe=function(){};qe.prototype.getBounds=function(){},qe.prototype.interfaces_=function(){return[]},qe.prototype.getClass=function(){return qe};var Xe=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};Xe.prototype.getItem=function(){return this._item},Xe.prototype.getBounds=function(){return this._bounds},Xe.prototype.interfaces_=function(){return[qe,e]},Xe.prototype.getClass=function(){return Xe};var $e=function(){this._size=null,this._items=null,this._size=0,this._items=new Et,this._items.add(null)};$e.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t},$e.prototype.size=function(){return this._size},$e.prototype.reorder=function(t){for(var e=null,i=this._items.get(t);2*t<=this._size&&((e=2*t)!==this._size&&this._items.get(e+1).compareTo(this._items.get(e))<0&&e++,this._items.get(e).compareTo(i)<0);t=e)this._items.set(t,this._items.get(e));this._items.set(t,i)},$e.prototype.clear=function(){this._size=0,this._items.clear()},$e.prototype.isEmpty=function(){return 0===this._size},$e.prototype.add=function(t){this._items.add(null),this._size+=1;var e=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,t)},$e.prototype.interfaces_=function(){return[]},$e.prototype.getClass=function(){return $e};var Ye=function(){};Ye.prototype.visitItem=function(t){},Ye.prototype.interfaces_=function(){return[]},Ye.prototype.getClass=function(){return Ye};var Ze=function(){};Ze.prototype.insert=function(t,e){},Ze.prototype.remove=function(t,e){},Ze.prototype.query=function(){},Ze.prototype.interfaces_=function(){return[]},Ze.prototype.getClass=function(){return Ze};var Ke=function(){if(this._childBoundables=new Et,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._level=t}},Je={serialVersionUID:{configurable:!0}};Ke.prototype.getLevel=function(){return this._level},Ke.prototype.size=function(){return this._childBoundables.size()},Ke.prototype.getChildBoundables=function(){return this._childBoundables},Ke.prototype.addChildBoundable=function(t){et.isTrue(null===this._bounds),this._childBoundables.add(t)},Ke.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},Ke.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},Ke.prototype.interfaces_=function(){return[qe,e]},Ke.prototype.getClass=function(){return Ke},Je.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(Ke,Je);var Qe=function(){};Qe.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}},Qe.min=function(t){return Qe.sort(t),t.get(0)},Qe.sort=function(t,e){var i=t.toArray();e?Ft.sort(i,e):Ft.sort(i);for(var n=t.iterator(),r=0,o=i.length;r<o;r++)n.next(),n.set(i[r])},Qe.singletonList=function(t){var e=new Et;return e.add(t),e};var ti=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],i=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=i,this._distance=this.distance()};ti.prototype.expandToQueue=function(t,e){var i=ti.isComposite(this._boundable1),n=ti.isComposite(this._boundable2);if(i&&n)return ti.area(this._boundable1)>ti.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(i)return this.expand(this._boundable1,this._boundable2,t,e),null;if(n)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new y("neither boundable is composite")},ti.prototype.isLeaves=function(){return!(ti.isComposite(this._boundable1)||ti.isComposite(this._boundable2))},ti.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},ti.prototype.expand=function(t,e,i,n){for(var r=t.getChildBoundables().iterator();r.hasNext();){var o=r.next(),s=new ti(o,e,this._itemDistance);s.getDistance()<n&&i.add(s)}},ti.prototype.getBoundable=function(t){return 0===t?this._boundable1:this._boundable2},ti.prototype.getDistance=function(){return this._distance},ti.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},ti.prototype.interfaces_=function(){return[b]},ti.prototype.getClass=function(){return ti},ti.area=function(t){return t.getBounds().getArea()},ti.isComposite=function(t){return t instanceof Ke};var ei=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new Et,this._nodeCapacity=null,0===arguments.length){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(1===arguments.length){var i=arguments[0];et.isTrue(i>1,"Node capacity must be greater than 1"),this._nodeCapacity=i}},ii={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};ei.prototype.getNodeCapacity=function(){return this._nodeCapacity},ei.prototype.lastNode=function(t){return t.get(t.size()-1)},ei.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var i=e.next();i instanceof Ke?t+=this.size(i):i instanceof Xe&&(t+=1)}return t}},ei.prototype.removeItem=function(t,e){for(var i=null,n=t.getChildBoundables().iterator();n.hasNext();){var r=n.next();r instanceof Xe&&r.getItem()===e&&(i=r)}return null!==i&&(t.getChildBoundables().remove(i),!0)},ei.prototype.itemsTree=function(){if(0===arguments.length){this.build();var t=this.itemsTree(this._root);return null===t?new Et:t}if(1===arguments.length){for(var e=arguments[0],i=new Et,n=e.getChildBoundables().iterator();n.hasNext();){var r=n.next();if(r instanceof Ke){var o=this.itemsTree(r);null!==o&&i.add(o)}else r instanceof Xe?i.add(r.getItem()):et.shouldNeverReachHere()}return i.size()<=0?null:i}},ei.prototype.insert=function(t,e){et.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Xe(t,e))},ei.prototype.boundablesAtLevel=function(){if(1===arguments.length){var t=arguments[0],e=new Et;return this.boundablesAtLevel(t,this._root,e),e}if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];if(et.isTrue(i>-2),n.getLevel()===i)return r.add(n),null;for(var o=n.getChildBoundables().iterator();o.hasNext();){var s=o.next();s instanceof Ke?this.boundablesAtLevel(i,s,r):(et.isTrue(s instanceof Xe),-1===i&&r.add(s))}return null}},ei.prototype.query=function(){if(1===arguments.length){var t=arguments[0];this.build();var e=new Et;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,e),e}if(2===arguments.length){var i=arguments[0],n=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.query(i,this._root,n)}else if(3===arguments.length)if(P(arguments[2],Ye)&&arguments[0]instanceof Object&&arguments[1]instanceof Ke)for(var r=arguments[0],o=arguments[2],s=arguments[1].getChildBoundables(),a=0;a<s.size();a++){var l=s.get(a);this.getIntersectsOp().intersects(l.getBounds(),r)&&(l instanceof Ke?this.query(r,l,o):l instanceof Xe?o.visitItem(l.getItem()):et.shouldNeverReachHere())}else if(P(arguments[2],wt)&&arguments[0]instanceof Object&&arguments[1]instanceof Ke)for(var c=arguments[0],u=arguments[2],h=arguments[1].getChildBoundables(),d=0;d<h.size();d++){var p=h.get(d);this.getIntersectsOp().intersects(p.getBounds(),c)&&(p instanceof Ke?this.query(c,p,u):p instanceof Xe?u.add(p.getItem()):et.shouldNeverReachHere())}},ei.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},ei.prototype.getRoot=function(){return this.build(),this._root},ei.prototype.remove=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.remove(t,this._root,e)}if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2],o=this.removeItem(n,r);if(o)return!0;for(var s=null,a=n.getChildBoundables().iterator();a.hasNext();){var l=a.next();if(this.getIntersectsOp().intersects(l.getBounds(),i)&&l instanceof Ke&&(o=this.remove(i,l,r))){s=l;break}}return null!==s&&s.getChildBoundables().isEmpty()&&n.getChildBoundables().remove(s),o}},ei.prototype.createHigherLevels=function(t,e){et.isTrue(!t.isEmpty());var i=this.createParentBoundables(t,e+1);return 1===i.size()?i.get(0):this.createHigherLevels(i,e+1)},ei.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var i=e.next();if(i instanceof Ke){var n=this.depth(i);n>t&&(t=n)}}return t+1}},ei.prototype.createParentBoundables=function(t,e){et.isTrue(!t.isEmpty());var i=new Et;i.add(this.createNode(e));var n=new Et(t);Qe.sort(n,this.getComparator());for(var r=n.iterator();r.hasNext();){var o=r.next();this.lastNode(i).getChildBoundables().size()===this.getNodeCapacity()&&i.add(this.createNode(e)),this.lastNode(i).addChildBoundable(o)}return i},ei.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},ei.prototype.interfaces_=function(){return[e]},ei.prototype.getClass=function(){return ei},ei.compareDoubles=function(t,e){return t>e?1:t<e?-1:0},ii.IntersectsOp.get=function(){return ni},ii.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},ii.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(ei,ii);var ni=function(){},ri=function(){};ri.prototype.distance=function(t,e){},ri.prototype.interfaces_=function(){return[]},ri.prototype.getClass=function(){return ri};var oi=function(t){function i(e){e=e||i.DEFAULT_NODE_CAPACITY,t.call(this,e)}t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return i.prototype.createParentBoundablesFromVerticalSlices=function(t,e){et.isTrue(t.length>0);for(var i=new Et,n=0;n<t.length;n++)i.addAll(this.createParentBoundablesFromVerticalSlice(t[n],e));return i},i.prototype.createNode=function(t){return new si(t)},i.prototype.size=function(){return 0===arguments.length?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},i.prototype.insert=function(){if(2!==arguments.length)return t.prototype.insert.apply(this,arguments);var e=arguments[0],i=arguments[1];if(e.isNull())return null;t.prototype.insert.call(this,e,i)},i.prototype.getIntersectsOp=function(){return i.intersectsOp},i.prototype.verticalSlices=function(t,e){for(var i=Math.trunc(Math.ceil(t.size()/e)),n=new Array(e).fill(null),r=t.iterator(),o=0;o<e;o++){n[o]=new Et;for(var s=0;r.hasNext()&&s<i;){var a=r.next();n[o].add(a),s++}}return n},i.prototype.query=function(){if(1===arguments.length){var e=arguments[0];return t.prototype.query.call(this,e)}if(2===arguments.length){var i=arguments[0],n=arguments[1];t.prototype.query.call(this,i,n)}else if(3===arguments.length)if(P(arguments[2],Ye)&&arguments[0]instanceof Object&&arguments[1]instanceof Ke){var r=arguments[0],o=arguments[1],s=arguments[2];t.prototype.query.call(this,r,o,s)}else if(P(arguments[2],wt)&&arguments[0]instanceof Object&&arguments[1]instanceof Ke){var a=arguments[0],l=arguments[1],c=arguments[2];t.prototype.query.call(this,a,l,c)}},i.prototype.getComparator=function(){return i.yComparator},i.prototype.createParentBoundablesFromVerticalSlice=function(e,i){return t.prototype.createParentBoundables.call(this,e,i)},i.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return t.prototype.remove.call(this,e,i)}return t.prototype.remove.apply(this,arguments)},i.prototype.depth=function(){return 0===arguments.length?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},i.prototype.createParentBoundables=function(t,e){et.isTrue(!t.isEmpty());var n=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),r=new Et(t);Qe.sort(r,i.xComparator);var o=this.verticalSlices(r,Math.trunc(Math.ceil(Math.sqrt(n))));return this.createParentBoundablesFromVerticalSlices(o,e)},i.prototype.nearestNeighbour=function(){if(1===arguments.length){if(P(arguments[0],ri)){var t=arguments[0],e=new ti(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(e)}if(arguments[0]instanceof ti){var n=arguments[0];return this.nearestNeighbour(n,v.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof i&&P(arguments[1],ri)){var r=arguments[0],o=arguments[1],s=new ti(this.getRoot(),r.getRoot(),o);return this.nearestNeighbour(s)}if(arguments[0]instanceof ti&&"number"==typeof arguments[1]){var a=arguments[0],l=arguments[1],c=null,u=new $e;for(u.add(a);!u.isEmpty()&&l>0;){var h=u.poll(),d=h.getDistance();if(d>=l)break;h.isLeaves()?(l=d,c=h):h.expandToQueue(u,l)}return[c.getBoundable(0).getItem(),c.getBoundable(1).getItem()]}}else if(3===arguments.length){var p=arguments[2],f=new Xe(arguments[0],arguments[1]),m=new ti(this.getRoot(),f,p);return this.nearestNeighbour(m)[0]}},i.prototype.interfaces_=function(){return[Ze,e]},i.prototype.getClass=function(){return i},i.centreX=function(t){return i.avg(t.getMinX(),t.getMaxX())},i.avg=function(t,e){return(t+e)/2},i.centreY=function(t){return i.avg(t.getMinY(),t.getMaxY())},n.STRtreeNode.get=function(){return si},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[E]},compare:function(e,n){return t.compareDoubles(i.centreX(e.getBounds()),i.centreX(n.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[E]},compare:function(e,n){return t.compareDoubles(i.centreY(e.getBounds()),i.centreY(n.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(t,e){return t.intersects(e)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(i,n),i}(ei),si=function(t){function e(){var e=arguments[0];t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var i=e.next();null===t?t=new q(i.getBounds()):t.expandToInclude(i.getBounds())}return t},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ke),ai=function(){};ai.prototype.interfaces_=function(){return[]},ai.prototype.getClass=function(){return ai},ai.relativeSign=function(t,e){return t<e?-1:t>e?1:0},ai.compare=function(t,e,i){if(e.equals2D(i))return 0;var n=ai.relativeSign(e.x,i.x),r=ai.relativeSign(e.y,i.y);switch(t){case 0:return ai.compareValue(n,r);case 1:return ai.compareValue(r,n);case 2:return ai.compareValue(r,-n);case 3:return ai.compareValue(-n,r);case 4:return ai.compareValue(-n,-r);case 5:return ai.compareValue(-r,-n);case 6:return ai.compareValue(-r,n);case 7:return ai.compareValue(n,-r)}return et.shouldNeverReachHere("invalid octant value"),0},ai.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var li=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3];this._segString=t,this.coord=new S(e),this.segmentIndex=i,this._segmentOctant=n,this._isInterior=!e.equals2D(t.getCoordinate(i))};li.prototype.getCoordinate=function(){return this.coord},li.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},li.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:ai.compare(this._segmentOctant,this.coord,e.coord)},li.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},li.prototype.isInterior=function(){return this._isInterior},li.prototype.interfaces_=function(){return[b]},li.prototype.getClass=function(){return li};var ci=function(){this._nodeMap=new h,this._edge=null;var t=arguments[0];this._edge=t};ci.prototype.getSplitCoordinates=function(){var t=new Tt;this.addEndpoints();for(var e=this.iterator(),i=e.next();e.hasNext();){var n=e.next();this.addEdgeCoordinates(i,n,t),i=n}return t.toCoordinateArray()},ci.prototype.addCollapsedNodes=function(){var t=new Et;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var i=e.next().intValue();this.add(this._edge.getCoordinate(i),i)}},ci.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},ci.prototype.findCollapsesFromExistingVertices=function(t){for(var e=0;e<this._edge.size()-2;e++){var i=this._edge.getCoordinate(e),n=this._edge.getCoordinate(e+2);i.equals2D(n)&&t.add(new k(e+1))}},ci.prototype.addEdgeCoordinates=function(t,e,i){var n=this._edge.getCoordinate(e.segmentIndex),r=e.isInterior()||!e.coord.equals2D(n);i.add(new S(t.coord),!1);for(var o=t.segmentIndex+1;o<=e.segmentIndex;o++)i.add(this._edge.getCoordinate(o));r&&i.add(new S(e.coord))},ci.prototype.iterator=function(){return this._nodeMap.values().iterator()},ci.prototype.addSplitEdges=function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),i=e.next();e.hasNext();){var n=e.next(),r=this.createSplitEdge(i,n);t.add(r),i=n}},ci.prototype.findCollapseIndex=function(t,e,i){if(!t.coord.equals2D(e.coord))return!1;var n=e.segmentIndex-t.segmentIndex;return e.isInterior()||n--,1===n&&(i[0]=t.segmentIndex+1,!0)},ci.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=new Array(1).fill(null),i=this.iterator(),n=i.next();i.hasNext();){var r=i.next();this.findCollapseIndex(n,r,e)&&t.add(new k(e[0])),n=r}},ci.prototype.getEdge=function(){return this._edge},ci.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)},ci.prototype.createSplitEdge=function(t,e){var i=e.segmentIndex-t.segmentIndex+2,n=this._edge.getCoordinate(e.segmentIndex),r=e.isInterior()||!e.coord.equals2D(n);r||i--;var o=new Array(i).fill(null),s=0;o[s++]=new S(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this._edge.getCoordinate(a);return r&&(o[s]=new S(e.coord)),new pi(o,this._edge.getData())},ci.prototype.add=function(t,e){var i=new li(this._edge,t,e,this._edge.getSegmentOctant(e)),n=this._nodeMap.get(i);return null!==n?(et.isTrue(n.coord.equals2D(t),"Found equal nodes with different coordinates"),n):(this._nodeMap.put(i,i),i)},ci.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),i=t.get(0).getCoordinate(0);if(!i.equals2D(e[0]))throw new Q("bad split edge start point at "+i);var n=t.get(t.size()-1).getCoordinates(),r=n[n.length-1];if(!r.equals2D(e[e.length-1]))throw new Q("bad split edge end point at "+r)},ci.prototype.interfaces_=function(){return[]},ci.prototype.getClass=function(){return ci};var ui=function(){};ui.prototype.interfaces_=function(){return[]},ui.prototype.getClass=function(){return ui},ui.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new y("Cannot compute the octant for point ( "+t+", "+e+" )");var i=Math.abs(t),n=Math.abs(e);return t>=0?e>=0?i>=n?0:1:i>=n?7:6:e>=0?i>=n?3:2:i>=n?4:5}if(arguments[0]instanceof S&&arguments[1]instanceof S){var r=arguments[0],o=arguments[1],s=o.x-r.x,a=o.y-r.y;if(0===s&&0===a)throw new y("Cannot compute the octant for two identical points "+r);return ui.octant(s,a)}};var hi=function(){};hi.prototype.getCoordinates=function(){},hi.prototype.size=function(){},hi.prototype.getCoordinate=function(t){},hi.prototype.isClosed=function(){},hi.prototype.setData=function(t){},hi.prototype.getData=function(){},hi.prototype.interfaces_=function(){return[]},hi.prototype.getClass=function(){return hi};var di=function(){};di.prototype.addIntersection=function(t,e){},di.prototype.interfaces_=function(){return[hi]},di.prototype.getClass=function(){return di};var pi=function(){this._nodeList=new ci(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};pi.prototype.getCoordinates=function(){return this._pts},pi.prototype.size=function(){return this._pts.length},pi.prototype.getCoordinate=function(t){return this._pts[t]},pi.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},pi.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},pi.prototype.setData=function(t){this._data=t},pi.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:ui.octant(t,e)},pi.prototype.getData=function(){return this._data},pi.prototype.addIntersection=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var i=arguments[1],n=arguments[3],r=new S(arguments[0].getIntersection(n));this.addIntersection(r,i)}},pi.prototype.toString=function(){return J.toLineString(new le(this._pts))},pi.prototype.getNodeList=function(){return this._nodeList},pi.prototype.addIntersectionNode=function(t,e){var i=e,n=i+1;if(n<this._pts.length){var r=this._pts[n];t.equals2D(r)&&(i=n)}return this._nodeList.add(t,i)},pi.prototype.addIntersections=function(t,e,i){for(var n=0;n<t.getIntersectionNum();n++)this.addIntersection(t,e,i,n)},pi.prototype.interfaces_=function(){return[di]},pi.prototype.getClass=function(){return pi},pi.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new Et;return pi.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var i=arguments[1],n=arguments[0].iterator();n.hasNext();)n.next().getNodeList().addSplitEdges(i)};var fi=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new S,this.p1=new S;else if(1===arguments.length){var t=arguments[0];this.p0=new S(t.p0),this.p1=new S(t.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var e=arguments[0],i=arguments[1],n=arguments[2],r=arguments[3];this.p0=new S(e,i),this.p1=new S(n,r)}},mi={serialVersionUID:{configurable:!0}};fi.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},fi.prototype.orientationIndex=function(){if(arguments[0]instanceof fi){var t=arguments[0],e=at.orientationIndex(this.p0,this.p1,t.p0),i=at.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&i>=0||e<=0&&i<=0?Math.max(e,i):0}if(arguments[0]instanceof S){var n=arguments[0];return at.orientationIndex(this.p0,this.p1,n)}},fi.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])},fi.prototype.isVertical=function(){return this.p0.x===this.p1.x},fi.prototype.equals=function(t){if(!(t instanceof fi))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},fi.prototype.intersection=function(t){var e=new rt;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},fi.prototype.project=function(){if(arguments[0]instanceof S){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new S(t);var e=this.projectionFactor(t),i=new S;return i.x=this.p0.x+e*(this.p1.x-this.p0.x),i.y=this.p0.y+e*(this.p1.y-this.p0.y),i}if(arguments[0]instanceof fi){var n=arguments[0],r=this.projectionFactor(n.p0),o=this.projectionFactor(n.p1);if(r>=1&&o>=1)return null;if(r<=0&&o<=0)return null;var s=this.project(n.p0);r<0&&(s=this.p0),r>1&&(s=this.p1);var a=this.project(n.p1);return o<0&&(a=this.p0),o>1&&(a=this.p1),new fi(s,a)}},fi.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},fi.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},fi.prototype.getCoordinate=function(t){return 0===t?this.p0:this.p1},fi.prototype.distancePerpendicular=function(t){return at.distancePointLinePerpendicular(t,this.p0,this.p1)},fi.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},fi.prototype.midPoint=function(){return fi.midPoint(this.p0,this.p1)},fi.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,i=this.p1.y-this.p0.y,n=e*e+i*i;return n<=0?v.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*i)/n},fi.prototype.closestPoints=function(t){var e=this.intersection(t);if(null!==e)return[e,e];var i=new Array(2).fill(null),n=v.MAX_VALUE,r=null,o=this.closestPoint(t.p0);n=o.distance(t.p0),i[0]=o,i[1]=t.p0;var s=this.closestPoint(t.p1);(r=s.distance(t.p1))<n&&(n=r,i[0]=s,i[1]=t.p1);var a=t.closestPoint(this.p0);(r=a.distance(this.p0))<n&&(n=r,i[0]=this.p0,i[1]=a);var l=t.closestPoint(this.p1);return(r=l.distance(this.p1))<n&&(n=r,i[0]=this.p1,i[1]=l),i},fi.prototype.closestPoint=function(t){var e=this.projectionFactor(t);return e>0&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},fi.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},fi.prototype.getLength=function(){return this.p0.distance(this.p1)},fi.prototype.compareTo=function(t){var e=t,i=this.p0.compareTo(e.p0);return 0!==i?i:this.p1.compareTo(e.p1)},fi.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t},fi.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)},fi.prototype.lineIntersection=function(t){try{return W.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof G))throw t}return null},fi.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},fi.prototype.pointAlongOffset=function(t,e){var i=this.p0.x+t*(this.p1.x-this.p0.x),n=this.p0.y+t*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,s=Math.sqrt(r*r+o*o),a=0,l=0;if(0!==e){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");a=e*r/s,l=e*o/s}return new S(i-l,n+a)},fi.prototype.setCoordinates=function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=i.x,this.p1.y=i.y}},fi.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||v.isNaN(e))&&(e=1),e},fi.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},fi.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},fi.prototype.distance=function(){if(arguments[0]instanceof fi){var t=arguments[0];return at.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof S){var e=arguments[0];return at.distancePointLine(e,this.p0,this.p1)}},fi.prototype.pointAlong=function(t){var e=new S;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},fi.prototype.hashCode=function(){var t=v.doubleToLongBits(this.p0.x);t^=31*v.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),i=v.doubleToLongBits(this.p1.x);return i^=31*v.doubleToLongBits(this.p1.y),e^Math.trunc(i)^Math.trunc(i>>32)},fi.prototype.interfaces_=function(){return[b,e]},fi.prototype.getClass=function(){return fi},fi.midPoint=function(t,e){return new S((t.x+e.x)/2,(t.y+e.y)/2)},mi.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(fi,mi);var gi=function(){this.tempEnv1=new q,this.tempEnv2=new q,this._overlapSeg1=new fi,this._overlapSeg2=new fi};gi.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[1],e=arguments[2],i=arguments[3];arguments[0].getLineSegment(t,this._overlapSeg1),e.getLineSegment(i,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},gi.prototype.interfaces_=function(){return[]},gi.prototype.getClass=function(){return gi};var _i=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3];this._pts=t,this._start=e,this._end=i,this._context=n};_i.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]},_i.prototype.computeSelect=function(t,e,i,n){var r=this._pts[e],o=this._pts[i];if(n.tempEnv1.init(r,o),i-e==1)return n.select(this,e),null;if(!t.intersects(n.tempEnv1))return null;var s=Math.trunc((e+i)/2);e<s&&this.computeSelect(t,e,s,n),s<i&&this.computeSelect(t,s,i,n)},_i.prototype.getCoordinates=function(){for(var t=new Array(this._end-this._start+1).fill(null),e=0,i=this._start;i<=this._end;i++)t[e++]=this._pts[i];return t},_i.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)},_i.prototype.setId=function(t){this._id=t},_i.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)},_i.prototype.getEnvelope=function(){if(null===this._env){var t=this._pts[this._start],e=this._pts[this._end];this._env=new q(t,e)}return this._env},_i.prototype.getEndIndex=function(){return this._end},_i.prototype.getStartIndex=function(){return this._start},_i.prototype.getContext=function(){return this._context},_i.prototype.getId=function(){return this._id},_i.prototype.computeOverlapsInternal=function(t,e,i,n,r,o){var s=this._pts[t],a=this._pts[e],l=i._pts[n],c=i._pts[r];if(e-t==1&&r-n==1)return o.overlap(this,t,i,n),null;if(o.tempEnv1.init(s,a),o.tempEnv2.init(l,c),!o.tempEnv1.intersects(o.tempEnv2))return null;var u=Math.trunc((t+e)/2),h=Math.trunc((n+r)/2);t<u&&(n<h&&this.computeOverlapsInternal(t,u,i,n,h,o),h<r&&this.computeOverlapsInternal(t,u,i,h,r,o)),u<e&&(n<h&&this.computeOverlapsInternal(u,e,i,n,h,o),h<r&&this.computeOverlapsInternal(u,e,i,h,r,o))},_i.prototype.interfaces_=function(){return[]},_i.prototype.getClass=function(){return _i};var yi=function(){};yi.prototype.interfaces_=function(){return[]},yi.prototype.getClass=function(){return yi},yi.getChainStartIndices=function(t){var e=0,i=new Et;i.add(new k(e));do{var n=yi.findChainEnd(t,e);i.add(new k(n)),e=n}while(e<t.length-1);return yi.toIntArray(i)},yi.findChainEnd=function(t,e){for(var i=e;i<t.length-1&&t[i].equals2D(t[i+1]);)i++;if(i>=t.length-1)return t.length-1;for(var n=Be.quadrant(t[i],t[i+1]),r=e+1;r<t.length&&(t[r-1].equals2D(t[r])||Be.quadrant(t[r-1],t[r])===n);)r++;return r-1},yi.getChains=function(){if(1===arguments.length)return yi.getChains(arguments[0],null);if(2===arguments.length){for(var t=arguments[0],e=arguments[1],i=new Et,n=yi.getChainStartIndices(t),r=0;r<n.length-1;r++){var o=new _i(t,n[r],n[r+1],e);i.add(o)}return i}},yi.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),i=0;i<e.length;i++)e[i]=t.get(i).intValue();return e};var vi=function(){};vi.prototype.computeNodes=function(t){},vi.prototype.getNodedSubstrings=function(){},vi.prototype.interfaces_=function(){return[]},vi.prototype.getClass=function(){return vi};var xi=function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}};xi.prototype.setSegmentIntersector=function(t){this._segInt=t},xi.prototype.interfaces_=function(){return[vi]},xi.prototype.getClass=function(){return xi};var bi=function(t){function e(e){e?t.call(this,e):t.call(this),this._monoChains=new Et,this._index=new oi,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return pi.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(t){for(var e=yi.getChains(t.getCoordinates(),t).iterator();e.hasNext();){var i=e.next();i.setId(this._idCounter++),this._index.insert(i.getEnvelope(),i),this._monoChains.add(i)}},e.prototype.computeNodes=function(t){this._nodedSegStrings=t;for(var e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var t=new wi(this._segInt),e=this._monoChains.iterator();e.hasNext();)for(var i=e.next(),n=this._index.query(i.getEnvelope()).iterator();n.hasNext();){var r=n.next();if(r.getId()>i.getId()&&(i.computeOverlaps(r,t),this._nOverlaps++),this._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},i.SegmentOverlapAction.get=function(){return wi},Object.defineProperties(e,i),e}(xi),wi=function(t){function e(){t.call(this),this._si=null;var e=arguments[0];this._si=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(4!==arguments.length)return t.prototype.overlap.apply(this,arguments);var e=arguments[1],i=arguments[2],n=arguments[3],r=arguments[0].getContext(),o=i.getContext();this._si.processIntersections(r,e,o,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(gi),Ei=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setQuadrantSegments(e)}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this.setQuadrantSegments(i),this.setEndCapStyle(n)}else if(4===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this.setQuadrantSegments(r),this.setEndCapStyle(o),this.setJoinStyle(s),this.setMitreLimit(a)}},Si={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Ei.prototype.getEndCapStyle=function(){return this._endCapStyle},Ei.prototype.isSingleSided=function(){return this._isSingleSided},Ei.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=Ei.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Ei.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==Ei.JOIN_ROUND&&(this._quadrantSegments=Ei.DEFAULT_QUADRANT_SEGMENTS)},Ei.prototype.getJoinStyle=function(){return this._joinStyle},Ei.prototype.setJoinStyle=function(t){this._joinStyle=t},Ei.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t},Ei.prototype.getSimplifyFactor=function(){return this._simplifyFactor},Ei.prototype.getQuadrantSegments=function(){return this._quadrantSegments},Ei.prototype.setEndCapStyle=function(t){this._endCapStyle=t},Ei.prototype.getMitreLimit=function(){return this._mitreLimit},Ei.prototype.setMitreLimit=function(t){this._mitreLimit=t},Ei.prototype.setSingleSided=function(t){this._isSingleSided=t},Ei.prototype.interfaces_=function(){return[]},Ei.prototype.getClass=function(){return Ei},Ei.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},Si.CAP_ROUND.get=function(){return 1},Si.CAP_FLAT.get=function(){return 2},Si.CAP_SQUARE.get=function(){return 3},Si.JOIN_ROUND.get=function(){return 1},Si.JOIN_MITRE.get=function(){return 2},Si.JOIN_BEVEL.get=function(){return 3},Si.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Si.DEFAULT_MITRE_LIMIT.get=function(){return 5},Si.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(Ei,Si);var Ti=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=at.COUNTERCLOCKWISE,this._inputLine=t||null},Mi={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Ti.prototype.isDeletable=function(t,e,i,n){var r=this._inputLine[t],o=this._inputLine[e],s=this._inputLine[i];return!!this.isConcave(r,o,s)&&!!this.isShallow(r,o,s,n)&&this.isShallowSampled(r,o,t,i,n)},Ti.prototype.deleteShallowConcavities=function(){for(var t=1,e=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(e),n=!1;i<this._inputLine.length;){var r=!1;this.isDeletable(t,e,i,this._distanceTol)&&(this._isDeleted[e]=Ti.DELETE,r=!0,n=!0),t=r?i:e,e=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(e)}return n},Ti.prototype.isShallowConcavity=function(t,e,i,n){return at.computeOrientation(t,e,i)===this._angleOrientation&&at.distancePointLine(e,t,i)<n},Ti.prototype.isShallowSampled=function(t,e,i,n,r){var o=Math.trunc((n-i)/Ti.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var s=i;s<n;s+=o)if(!this.isShallow(t,e,this._inputLine[s],r))return!1;return!0},Ti.prototype.isConcave=function(t,e,i){return at.computeOrientation(t,e,i)===this._angleOrientation},Ti.prototype.simplify=function(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=at.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var e=!1;do{e=this.deleteShallowConcavities()}while(e);return this.collapseLine()},Ti.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===Ti.DELETE;)e++;return e},Ti.prototype.isShallow=function(t,e,i,n){return at.distancePointLine(e,t,i)<n},Ti.prototype.collapseLine=function(){for(var t=new Tt,e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==Ti.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()},Ti.prototype.interfaces_=function(){return[]},Ti.prototype.getClass=function(){return Ti},Ti.simplify=function(t,e){return new Ti(t).simplify(e)},Mi.INIT.get=function(){return 0},Mi.DELETE.get=function(){return 1},Mi.KEEP.get=function(){return 1},Mi.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Ti,Mi);var Ii=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Et},Ci={COORDINATE_ARRAY_TYPE:{configurable:!0}};Ii.prototype.getCoordinates=function(){return this._ptList.toArray(Ii.COORDINATE_ARRAY_TYPE)},Ii.prototype.setPrecisionModel=function(t){this._precisionModel=t},Ii.prototype.addPt=function(t){var e=new S(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)},Ii.prototype.revere=function(){},Ii.prototype.addPts=function(t,e){if(e)for(var i=0;i<t.length;i++)this.addPt(t[i]);else for(var n=t.length-1;n>=0;n--)this.addPt(t[n])},Ii.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance},Ii.prototype.toString=function(){return(new _e).createLineString(this.getCoordinates()).toString()},Ii.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new S(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)},Ii.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t},Ii.prototype.interfaces_=function(){return[]},Ii.prototype.getClass=function(){return Ii},Ci.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Ii,Ci);var Ai=function(){},Pi={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Ai.prototype.interfaces_=function(){return[]},Ai.prototype.getClass=function(){return Ai},Ai.toDegrees=function(t){return 180*t/Math.PI},Ai.normalize=function(t){for(;t>Math.PI;)t-=Ai.PI_TIMES_2;for(;t<=-Math.PI;)t+=Ai.PI_TIMES_2;return t},Ai.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],i=arguments[1],n=i.x-e.x,r=i.y-e.y;return Math.atan2(r,n)}},Ai.isAcute=function(t,e,i){var n=t.x-e.x,r=t.y-e.y;return n*(i.x-e.x)+r*(i.y-e.y)>0},Ai.isObtuse=function(t,e,i){var n=t.x-e.x,r=t.y-e.y;return n*(i.x-e.x)+r*(i.y-e.y)<0},Ai.interiorAngle=function(t,e,i){var n=Ai.angle(e,t),r=Ai.angle(e,i);return Math.abs(r-n)},Ai.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Ai.PI_TIMES_2;t>=Ai.PI_TIMES_2&&(t=0)}else{for(;t>=Ai.PI_TIMES_2;)t-=Ai.PI_TIMES_2;t<0&&(t=0)}return t},Ai.angleBetween=function(t,e,i){var n=Ai.angle(e,t),r=Ai.angle(e,i);return Ai.diff(n,r)},Ai.diff=function(t,e){var i=null;return(i=t<e?e-t:t-e)>Math.PI&&(i=2*Math.PI-i),i},Ai.toRadians=function(t){return t*Math.PI/180},Ai.getTurn=function(t,e){var i=Math.sin(e-t);return i>0?Ai.COUNTERCLOCKWISE:i<0?Ai.CLOCKWISE:Ai.NONE},Ai.angleBetweenOriented=function(t,e,i){var n=Ai.angle(e,t),r=Ai.angle(e,i)-n;return r<=-Math.PI?r+Ai.PI_TIMES_2:r>Math.PI?r-Ai.PI_TIMES_2:r},Pi.PI_TIMES_2.get=function(){return 2*Math.PI},Pi.PI_OVER_2.get=function(){return Math.PI/2},Pi.PI_OVER_4.get=function(){return Math.PI/4},Pi.COUNTERCLOCKWISE.get=function(){return at.COUNTERCLOCKWISE},Pi.CLOCKWISE.get=function(){return at.CLOCKWISE},Pi.NONE.get=function(){return at.COLLINEAR},Object.defineProperties(Ai,Pi);var Li=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new fi,this._seg1=new fi,this._offset0=new fi,this._offset1=new fi,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],i=arguments[1],n=arguments[2];this._precisionModel=e,this._bufParams=i,this._li=new rt,this._filletAngleQuantum=Math.PI/2/i.getQuadrantSegments(),i.getQuadrantSegments()>=8&&i.getJoinStyle()===Ei.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)},Ri={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Li.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var i=at.computeOrientation(this._s0,this._s1,this._s2),n=i===at.CLOCKWISE&&this._side===Te.LEFT||i===at.COUNTERCLOCKWISE&&this._side===Te.RIGHT;0===i?this.addCollinear(e):n?this.addOutsideTurn(i,e):this.addInsideTurn(i,e)},Li.prototype.addLineEndCap=function(t,e){var i=new fi(t,e),n=new fi;this.computeOffsetSegment(i,Te.LEFT,this._distance,n);var r=new fi;this.computeOffsetSegment(i,Te.RIGHT,this._distance,r);var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o);switch(this._bufParams.getEndCapStyle()){case Ei.CAP_ROUND:this._segList.addPt(n.p1),this.addFilletArc(e,a+Math.PI/2,a-Math.PI/2,at.CLOCKWISE,this._distance),this._segList.addPt(r.p1);break;case Ei.CAP_FLAT:this._segList.addPt(n.p1),this._segList.addPt(r.p1);break;case Ei.CAP_SQUARE:var l=new S;l.x=Math.abs(this._distance)*Math.cos(a),l.y=Math.abs(this._distance)*Math.sin(a);var c=new S(n.p1.x+l.x,n.p1.y+l.y),u=new S(r.p1.x+l.x,r.p1.y+l.y);this._segList.addPt(c),this._segList.addPt(u)}},Li.prototype.getCoordinates=function(){return this._segList.getCoordinates()},Li.prototype.addMitreJoin=function(t,e,i,n){var r=!0,o=null;try{o=W.intersection(e.p0,e.p1,i.p0,i.p1),(n<=0?1:o.distance(t)/Math.abs(n))>this._bufParams.getMitreLimit()&&(r=!1)}catch(t){if(!(t instanceof G))throw t;o=new S(0,0),r=!1}r?this._segList.addPt(o):this.addLimitedMitreJoin(e,i,n,this._bufParams.getMitreLimit())},Li.prototype.addFilletCorner=function(t,e,i,n,r){var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o),l=i.x-t.x,c=i.y-t.y,u=Math.atan2(c,l);n===at.CLOCKWISE?a<=u&&(a+=2*Math.PI):a>=u&&(a-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,a,u,n,r),this._segList.addPt(i)},Li.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Li.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Ei.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Ei.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))},Li.prototype.createSquare=function(t){this._segList.addPt(new S(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new S(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new S(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new S(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()},Li.prototype.addSegments=function(t,e){this._segList.addPts(t,e)},Li.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},Li.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},Li.prototype.initSideSegments=function(t,e,i){this._s1=t,this._s2=e,this._side=i,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,i,this._distance,this._offset1)},Li.prototype.addLimitedMitreJoin=function(t,e,i,n){var r=this._seg0.p1,o=Ai.angle(r,this._seg0.p0),s=Ai.angleBetweenOriented(this._seg0.p0,r,this._seg1.p1)/2,a=Ai.normalize(o+s),l=Ai.normalize(a+Math.PI),c=n*i,u=i-c*Math.abs(Math.sin(s)),h=r.x+c*Math.cos(l),d=r.y+c*Math.sin(l),p=new S(h,d),f=new fi(r,p),m=f.pointAlongOffset(1,u),g=f.pointAlongOffset(1,-u);this._side===Te.LEFT?(this._segList.addPt(m),this._segList.addPt(g)):(this._segList.addPt(g),this._segList.addPt(m))},Li.prototype.computeOffsetSegment=function(t,e,i,n){var r=e===Te.LEFT?1:-1,o=t.p1.x-t.p0.x,s=t.p1.y-t.p0.y,a=Math.sqrt(o*o+s*s),l=r*i*o/a,c=r*i*s/a;n.p0.x=t.p0.x-c,n.p0.y=t.p0.y+l,n.p1.x=t.p1.x-c,n.p1.y=t.p1.y+l},Li.prototype.addFilletArc=function(t,e,i,n,r){var o=n===at.CLOCKWISE?-1:1,s=Math.abs(e-i),a=Math.trunc(s/this._filletAngleQuantum+.5);if(a<1)return null;for(var l=s/a,c=0,u=new S;c<s;){var h=e+o*c;u.x=t.x+r*Math.cos(h),u.y=t.y+r*Math.sin(h),this._segList.addPt(u),c+=l}},Li.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Li.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var i=new S((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i);var n=new S((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},Li.prototype.createCircle=function(t){var e=new S(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},Li.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)},Li.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Ii,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Li.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Li.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Ei.JOIN_BEVEL||this._bufParams.getJoinStyle()===Ei.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,at.CLOCKWISE,this._distance))},Li.prototype.closeRing=function(){this._segList.closeRing()},Li.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},Li.prototype.interfaces_=function(){return[]},Li.prototype.getClass=function(){return Li},Ri.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Ri.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Ri.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Ri.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Li,Ri);var Di=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};Di.prototype.getOffsetCurve=function(t,e){if(this._distance=e,0===e)return null;var i=e<0,n=Math.abs(e),r=this.getSegGen(n);t.length<=1?this.computePointCurve(t[0],r):this.computeOffsetCurve(t,i,r);var o=r.getCoordinates();return i&&Mt.reverse(o),o},Di.prototype.computeSingleSidedBufferCurve=function(t,e,i){var n=this.simplifyTolerance(this._distance);if(e){i.addSegments(t,!0);var r=Ti.simplify(t,-n),o=r.length-1;i.initSideSegments(r[o],r[o-1],Te.LEFT),i.addFirstSegment();for(var s=o-2;s>=0;s--)i.addNextSegment(r[s],!0)}else{i.addSegments(t,!1);var a=Ti.simplify(t,n),l=a.length-1;i.initSideSegments(a[0],a[1],Te.LEFT),i.addFirstSegment();for(var c=2;c<=l;c++)i.addNextSegment(a[c],!0)}i.addLastSegment(),i.closeRing()},Di.prototype.computeRingBufferCurve=function(t,e,i){var n=this.simplifyTolerance(this._distance);e===Te.RIGHT&&(n=-n);var r=Ti.simplify(t,n),o=r.length-1;i.initSideSegments(r[o-1],r[0],e);for(var s=1;s<=o;s++){var a=1!==s;i.addNextSegment(r[s],a)}i.closeRing()},Di.prototype.computeLineBufferCurve=function(t,e){var i=this.simplifyTolerance(this._distance),n=Ti.simplify(t,i),r=n.length-1;e.initSideSegments(n[0],n[1],Te.LEFT);for(var o=2;o<=r;o++)e.addNextSegment(n[o],!0);e.addLastSegment(),e.addLineEndCap(n[r-1],n[r]);var s=Ti.simplify(t,-i),a=s.length-1;e.initSideSegments(s[a],s[a-1],Te.LEFT);for(var l=a-2;l>=0;l--)e.addNextSegment(s[l],!0);e.addLastSegment(),e.addLineEndCap(s[1],s[0]),e.closeRing()},Di.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case Ei.CAP_ROUND:e.createCircle(t);break;case Ei.CAP_SQUARE:e.createSquare(t)}},Di.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided())return null;if(0===e)return null;var i=Math.abs(e),n=this.getSegGen(i);if(t.length<=1)this.computePointCurve(t[0],n);else if(this._bufParams.isSingleSided()){var r=e<0;this.computeSingleSidedBufferCurve(t,r,n)}else this.computeLineBufferCurve(t,n);return n.getCoordinates()},Di.prototype.getBufferParameters=function(){return this._bufParams},Di.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()},Di.prototype.getRingCurve=function(t,e,i){if(this._distance=i,t.length<=2)return this.getLineCurve(t,i);if(0===i)return Di.copyCoordinates(t);var n=this.getSegGen(i);return this.computeRingBufferCurve(t,e,n),n.getCoordinates()},Di.prototype.computeOffsetCurve=function(t,e,i){var n=this.simplifyTolerance(this._distance);if(e){var r=Ti.simplify(t,-n),o=r.length-1;i.initSideSegments(r[o],r[o-1],Te.LEFT),i.addFirstSegment();for(var s=o-2;s>=0;s--)i.addNextSegment(r[s],!0)}else{var a=Ti.simplify(t,n),l=a.length-1;i.initSideSegments(a[0],a[1],Te.LEFT),i.addFirstSegment();for(var c=2;c<=l;c++)i.addNextSegment(a[c],!0)}i.addLastSegment()},Di.prototype.getSegGen=function(t){return new Li(this._precisionModel,this._bufParams,t)},Di.prototype.interfaces_=function(){return[]},Di.prototype.getClass=function(){return Di},Di.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),i=0;i<e.length;i++)e[i]=new S(t[i]);return e};var ki=function(){this._subgraphs=null,this._seg=new fi,this._cga=new at;var t=arguments[0];this._subgraphs=t},Ni={DepthSegment:{configurable:!0}};ki.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var t=arguments[0],e=new Et,i=this._subgraphs.iterator();i.hasNext();){var n=i.next(),r=n.getEnvelope();t.y<r.getMinY()||t.y>r.getMaxY()||this.findStabbedSegments(t,n.getDirectedEdges(),e)}return e}if(3===arguments.length)if(P(arguments[2],wt)&&arguments[0]instanceof S&&arguments[1]instanceof je){for(var o=arguments[0],s=arguments[1],a=arguments[2],l=s.getEdge().getCoordinates(),c=0;c<l.length-1;c++)if(this._seg.p0=l[c],this._seg.p1=l[c+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<o.x||this._seg.isHorizontal()||o.y<this._seg.p0.y||o.y>this._seg.p1.y||at.computeOrientation(this._seg.p0,this._seg.p1,o)===at.RIGHT)){var u=s.getDepth(Te.LEFT);this._seg.p0.equals(l[c])||(u=s.getDepth(Te.RIGHT));var h=new Oi(this._seg,u);a.add(h)}}else if(P(arguments[2],wt)&&arguments[0]instanceof S&&P(arguments[1],wt))for(var d=arguments[0],p=arguments[2],f=arguments[1].iterator();f.hasNext();){var m=f.next();m.isForward()&&this.findStabbedSegments(d,m,p)}},ki.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:Qe.min(e)._leftDepth},ki.prototype.interfaces_=function(){return[]},ki.prototype.getClass=function(){return ki},Ni.DepthSegment.get=function(){return Oi},Object.defineProperties(ki,Ni);var Oi=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new fi(t),this._leftDepth=e};Oi.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var i=this._upwardSeg.orientationIndex(e._upwardSeg);return 0!==i||0!=(i=-1*e._upwardSeg.orientationIndex(this._upwardSeg))?i:this._upwardSeg.compareTo(e._upwardSeg)},Oi.prototype.compareX=function(t,e){var i=t.p0.compareTo(e.p0);return 0!==i?i:t.p1.compareTo(e.p1)},Oi.prototype.toString=function(){return this._upwardSeg.toString()},Oi.prototype.interfaces_=function(){return[b]},Oi.prototype.getClass=function(){return Oi};var Fi=function(t,e,i){this.p0=t||null,this.p1=e||null,this.p2=i||null};Fi.prototype.area=function(){return Fi.area(this.p0,this.p1,this.p2)},Fi.prototype.signedArea=function(){return Fi.signedArea(this.p0,this.p1,this.p2)},Fi.prototype.interpolateZ=function(t){if(null===t)throw new y("Supplied point is null.");return Fi.interpolateZ(t,this.p0,this.p1,this.p2)},Fi.prototype.longestSideLength=function(){return Fi.longestSideLength(this.p0,this.p1,this.p2)},Fi.prototype.isAcute=function(){return Fi.isAcute(this.p0,this.p1,this.p2)},Fi.prototype.circumcentre=function(){return Fi.circumcentre(this.p0,this.p1,this.p2)},Fi.prototype.area3D=function(){return Fi.area3D(this.p0,this.p1,this.p2)},Fi.prototype.centroid=function(){return Fi.centroid(this.p0,this.p1,this.p2)},Fi.prototype.inCentre=function(){return Fi.inCentre(this.p0,this.p1,this.p2)},Fi.prototype.interfaces_=function(){return[]},Fi.prototype.getClass=function(){return Fi},Fi.area=function(t,e,i){return Math.abs(((i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y))/2)},Fi.signedArea=function(t,e,i){return((i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y))/2},Fi.det=function(t,e,i,n){return t*n-e*i},Fi.interpolateZ=function(t,e,i,n){var r=e.x,o=e.y,s=i.x-r,a=n.x-r,l=i.y-o,c=n.y-o,u=s*c-a*l,h=t.x-r,d=t.y-o,p=(c*h-a*d)/u,f=(-l*h+s*d)/u;return e.z+p*(i.z-e.z)+f*(n.z-e.z)},Fi.longestSideLength=function(t,e,i){var n=t.distance(e),r=e.distance(i),o=i.distance(t),s=n;return r>s&&(s=r),o>s&&(s=o),s},Fi.isAcute=function(t,e,i){return!!Ai.isAcute(t,e,i)&&!!Ai.isAcute(e,i,t)&&!!Ai.isAcute(i,t,e)},Fi.circumcentre=function(t,e,i){var n=i.x,r=i.y,o=t.x-n,s=t.y-r,a=e.x-n,l=e.y-r,c=2*Fi.det(o,s,a,l),u=Fi.det(s,o*o+s*s,l,a*a+l*l),h=Fi.det(o,o*o+s*s,a,a*a+l*l);return new S(n-u/c,r+h/c)},Fi.perpendicularBisector=function(t,e){var i=e.x-t.x,n=e.y-t.y,r=new W(t.x+i/2,t.y+n/2,1),o=new W(t.x-n+i/2,t.y+i+n/2,1);return new W(r,o)},Fi.angleBisector=function(t,e,i){var n=e.distance(t),r=n/(n+e.distance(i)),o=i.x-t.x,s=i.y-t.y;return new S(t.x+r*o,t.y+r*s)},Fi.area3D=function(t,e,i){var n=e.x-t.x,r=e.y-t.y,o=e.z-t.z,s=i.x-t.x,a=i.y-t.y,l=i.z-t.z,c=r*l-o*a,u=o*s-n*l,h=n*a-r*s,d=c*c+u*u+h*h;return Math.sqrt(d)/2},Fi.centroid=function(t,e,i){var n=(t.x+e.x+i.x)/3,r=(t.y+e.y+i.y)/3;return new S(n,r)},Fi.inCentre=function(t,e,i){var n=e.distance(i),r=t.distance(i),o=t.distance(e),s=n+r+o,a=(n*t.x+r*e.x+o*i.x)/s,l=(n*t.y+r*e.y+o*i.y)/s;return new S(a,l)};var zi=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Et;var t=arguments[0],e=arguments[1],i=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=i};zi.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),i=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(i,C.EXTERIOR,C.INTERIOR)},zi.prototype.addPolygon=function(t){var e=this._distance,i=Te.LEFT;this._distance<0&&(e=-this._distance,i=Te.RIGHT);var n=t.getExteriorRing(),r=Mt.removeRepeatedPoints(n.getCoordinates());if(this._distance<0&&this.isErodedCompletely(n,this._distance))return null;if(this._distance<=0&&r.length<3)return null;this.addPolygonRing(r,e,i,C.EXTERIOR,C.INTERIOR);for(var o=0;o<t.getNumInteriorRing();o++){var s=t.getInteriorRingN(o),a=Mt.removeRepeatedPoints(s.getCoordinates());this._distance>0&&this.isErodedCompletely(s,-this._distance)||this.addPolygonRing(a,e,Te.opposite(i),C.INTERIOR,C.EXTERIOR)}},zi.prototype.isTriangleErodedCompletely=function(t,e){var i=new Fi(t[0],t[1],t[2]),n=i.inCentre();return at.distancePointLine(n,i.p0,i.p1)<Math.abs(e)},zi.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=Mt.removeRepeatedPoints(t.getCoordinates()),i=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(i,C.EXTERIOR,C.INTERIOR)},zi.prototype.addCurve=function(t,e,i){if(null===t||t.length<2)return null;var n=new pi(t,new Re(0,C.BOUNDARY,e,i));this._curveList.add(n)},zi.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},zi.prototype.addPolygonRing=function(t,e,i,n,r){if(0===e&&t.length<ee.MINIMUM_VALID_SIZE)return null;var o=n,s=r;t.length>=ee.MINIMUM_VALID_SIZE&&at.isCCW(t)&&(o=r,s=n,i=Te.opposite(i));var a=this._curveBuilder.getRingCurve(t,i,e);this.addCurve(a,o,s)},zi.prototype.add=function(t){if(t.isEmpty())return null;t instanceof Qt?this.addPolygon(t):t instanceof Yt?this.addLineString(t):t instanceof Kt?this.addPoint(t):(t instanceof te||t instanceof Gt||t instanceof ie||t instanceof jt)&&this.addCollection(t)},zi.prototype.isErodedCompletely=function(t,e){var i=t.getCoordinates();if(i.length<4)return e<0;if(4===i.length)return this.isTriangleErodedCompletely(i,e);var n=t.getEnvelopeInternal(),r=Math.min(n.getHeight(),n.getWidth());return e<0&&2*Math.abs(e)>r},zi.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var i=t.getGeometryN(e);this.add(i)}},zi.prototype.interfaces_=function(){return[]},zi.prototype.getClass=function(){return zi};var Bi=function(){};Bi.prototype.locate=function(t){},Bi.prototype.interfaces_=function(){return[]},Bi.prototype.getClass=function(){return Bi};var Ui=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};Ui.prototype.next=function(){if(this._atStart)return this._atStart=!1,Ui.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new n;var t=this._parent.getGeometryN(this._index++);return t instanceof jt?(this._subcollectionIterator=new Ui(t),this._subcollectionIterator.next()):t},Ui.prototype.remove=function(){throw new Error(this.getClass().getName())},Ui.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},Ui.prototype.interfaces_=function(){return[bt]},Ui.prototype.getClass=function(){return Ui},Ui.isAtomic=function(t){return!(t instanceof jt)};var Vi=function(){this._geom=null;var t=arguments[0];this._geom=t};Vi.prototype.locate=function(t){return Vi.locate(t,this._geom)},Vi.prototype.interfaces_=function(){return[Bi]},Vi.prototype.getClass=function(){return Vi},Vi.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&at.isPointInRing(t,e.getCoordinates())},Vi.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var i=e.getExteriorRing();if(!Vi.isPointInRing(t,i))return!1;for(var n=0;n<e.getNumInteriorRing();n++){var r=e.getInteriorRingN(n);if(Vi.isPointInRing(t,r))return!1}return!0},Vi.containsPoint=function(t,e){if(e instanceof Qt)return Vi.containsPointInPolygon(t,e);if(e instanceof jt)for(var i=new Ui(e);i.hasNext();){var n=i.next();if(n!==e&&Vi.containsPoint(t,n))return!0}return!1},Vi.locate=function(t,e){return e.isEmpty()?C.EXTERIOR:Vi.containsPoint(t,e)?C.INTERIOR:C.EXTERIOR};var ji=function(){this._edgeMap=new h,this._edgeList=null,this._ptInAreaLocation=[C.NONE,C.NONE]};ji.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),i=e-1;return 0===e&&(i=this._edgeList.size()-1),this._edgeList.get(i)},ji.prototype.propagateSideLabels=function(t){for(var e=C.NONE,i=this.iterator();i.hasNext();){var n=i.next().getLabel();n.isArea(t)&&n.getLocation(t,Te.LEFT)!==C.NONE&&(e=n.getLocation(t,Te.LEFT))}if(e===C.NONE)return null;for(var r=e,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getLabel();if(a.getLocation(t,Te.ON)===C.NONE&&a.setLocation(t,Te.ON,r),a.isArea(t)){var l=a.getLocation(t,Te.LEFT),c=a.getLocation(t,Te.RIGHT);if(c!==C.NONE){if(c!==r)throw new Ce("side location conflict",s.getCoordinate());l===C.NONE&&et.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),r=l}else et.isTrue(a.getLocation(t,Te.LEFT)===C.NONE,"found single null side"),a.setLocation(t,Te.RIGHT,r),a.setLocation(t,Te.LEFT,r)}}},ji.prototype.getCoordinate=function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},ji.prototype.print=function(t){H.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();)e.next().print(t)},ji.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},ji.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var i=e.size()-1,n=e.get(i).getLabel().getLocation(t,Te.LEFT);et.isTrue(n!==C.NONE,"Found unlabelled area edge");for(var r=n,o=this.iterator();o.hasNext();){var s=o.next().getLabel();et.isTrue(s.isArea(t),"Found non-area edge");var a=s.getLocation(t,Te.LEFT),l=s.getLocation(t,Te.RIGHT);if(a===l)return!1;if(l!==r)return!1;r=a}return!0},ji.prototype.findIndex=function(t){this.iterator();for(var e=0;e<this._edgeList.size();e++)if(this._edgeList.get(e)===t)return e;return-1},ji.prototype.iterator=function(){return this.getEdges().iterator()},ji.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new Et(this._edgeMap.values())),this._edgeList},ji.prototype.getLocation=function(t,e,i){return this._ptInAreaLocation[t]===C.NONE&&(this._ptInAreaLocation[t]=Vi.locate(e,i[t].getGeometry())),this._ptInAreaLocation[t]},ji.prototype.toString=function(){var t=new D;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var i=e.next();t.append(i),t.append("\n")}return t.toString()},ji.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();)e.next().computeLabel(t)},ji.prototype.computeLabelling=function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],i=this.iterator();i.hasNext();)for(var n=i.next().getLabel(),r=0;r<2;r++)n.isLine(r)&&n.getLocation(r)===C.BOUNDARY&&(e[r]=!0);for(var o=this.iterator();o.hasNext();)for(var s=o.next(),a=s.getLabel(),l=0;l<2;l++)if(a.isAnyNull(l)){var c=C.NONE;if(e[l])c=C.EXTERIOR;else{var u=s.getCoordinate();c=this.getLocation(l,u,t)}a.setAllLocationsIfNull(l,c)}},ji.prototype.getDegree=function(){return this._edgeMap.size()},ji.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null},ji.prototype.interfaces_=function(){return[]},ji.prototype.getClass=function(){return ji};var Gi=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var t=null,e=null,i=this._SCANNING_FOR_INCOMING,n=0;n<this._resultAreaEdgeList.size();n++){var r=this._resultAreaEdgeList.get(n),o=r.getSym();if(r.getLabel().isArea())switch(null===t&&r.isInResult()&&(t=r),i){case this._SCANNING_FOR_INCOMING:if(!o.isInResult())continue;e=o,i=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!r.isInResult())continue;e.setNext(r),i=this._SCANNING_FOR_INCOMING}}if(i===this._LINKING_TO_OUTGOING){if(null===t)throw new Ce("no outgoing dirEdge found",this.getCoordinate());et.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),e.setNext(t)}},e.prototype.insert=function(t){var e=t;this.insertEdgeEnd(e,e)},e.prototype.getRightmostEdge=function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var i=t.get(0);if(1===e)return i;var n=t.get(e-1),r=i.getQuadrant(),o=n.getQuadrant();return Be.isNorthern(r)&&Be.isNorthern(o)?i:Be.isNorthern(r)||Be.isNorthern(o)?0!==i.getDy()?i:0!==n.getDy()?n:(et.shouldNeverReachHere("found two horizontal edges incident on node"),null):n},e.prototype.print=function(t){H.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var i=e.next();t.print("out "),i.print(t),t.println(),t.print("in "),i.getSym().print(t),t.println()}},e.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Et;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(t){for(var e=this.iterator();e.hasNext();){var i=e.next().getLabel();i.setAllLocationsIfNull(0,t.getLocation(0)),i.setAllLocationsIfNull(1,t.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var t=null,e=null,i=this._edgeList.size()-1;i>=0;i--){var n=this._edgeList.get(i),r=n.getSym();null===e&&(e=r),null!==t&&r.setNext(t),t=n}e.setNext(t)},e.prototype.computeDepths=function(){if(1===arguments.length){var t=arguments[0],e=this.findIndex(t),i=t.getDepth(Te.LEFT),n=t.getDepth(Te.RIGHT),r=this.computeDepths(e+1,this._edgeList.size(),i);if(this.computeDepths(0,e,r)!==n)throw new Ce("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var o=arguments[1],s=arguments[2],a=arguments[0];a<o;a++){var l=this._edgeList.get(a);l.setEdgeDepths(Te.RIGHT,s),s=l.getDepth(Te.LEFT)}return s}},e.prototype.mergeSymLabels=function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(t){for(var e=null,i=null,n=this._SCANNING_FOR_INCOMING,r=this._resultAreaEdgeList.size()-1;r>=0;r--){var o=this._resultAreaEdgeList.get(r),s=o.getSym();switch(null===e&&o.getEdgeRing()===t&&(e=o),n){case this._SCANNING_FOR_INCOMING:if(s.getEdgeRing()!==t)continue;i=s,n=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(o.getEdgeRing()!==t)continue;i.setNextMin(o),n=this._SCANNING_FOR_INCOMING}}n===this._LINKING_TO_OUTGOING&&(et.isTrue(null!==e,"found null for first outgoing dirEdge"),et.isTrue(e.getEdgeRing()===t,"unable to link last incoming dirEdge"),i.setNextMin(e))},e.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();)e.next().isInResult()&&t++;return t}if(1===arguments.length){for(var i=arguments[0],n=0,r=this.iterator();r.hasNext();)r.next().getEdgeRing()===i&&n++;return n}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var t=C.NONE,e=this.iterator();e.hasNext();){var i=e.next(),n=i.getSym();if(!i.isLineEdge()){if(i.isInResult()){t=C.INTERIOR;break}if(n.isInResult()){t=C.EXTERIOR;break}}}if(t===C.NONE)return null;for(var r=t,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getSym();s.isLineEdge()?s.getEdge().setCovered(r===C.INTERIOR):(s.isInResult()&&(r=C.EXTERIOR),a.isInResult()&&(r=C.INTERIOR))}},e.prototype.computeLabelling=function(e){t.prototype.computeLabelling.call(this,e),this._label=new Re(C.NONE);for(var i=this.iterator();i.hasNext();)for(var n=i.next().getEdge().getLabel(),r=0;r<2;r++){var o=n.getLocation(r);o!==C.INTERIOR&&o!==C.BOUNDARY||this._label.setLocation(r,C.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ji),Hi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(t){return new Fe(t,new Gi)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ge),Wi=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};Wi.prototype.compareTo=function(t){var e=t;return Wi.compareOriented(this._pts,this._orientation,e._pts,e._orientation)},Wi.prototype.interfaces_=function(){return[b]},Wi.prototype.getClass=function(){return Wi},Wi.orientation=function(t){return 1===Mt.increasingDirection(t)},Wi.compareOriented=function(t,e,i,n){for(var r=e?1:-1,o=n?1:-1,s=e?t.length:-1,a=n?i.length:-1,l=e?0:t.length-1,c=n?0:i.length-1;;){var u=t[l].compareTo(i[c]);if(0!==u)return u;var h=(l+=r)===s,d=(c+=o)===a;if(h&&!d)return-1;if(!h&&d)return 1;if(h&&d)return 0}};var qi=function(){this._edges=new Et,this._ocaMap=new h};qi.prototype.print=function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this._edges.size();e++){var i=this._edges.get(e);e>0&&t.print(","),t.print("(");for(var n=i.getCoordinates(),r=0;r<n.length;r++)r>0&&t.print(","),t.print(n[r].x+" "+n[r].y);t.println(")")}t.print(")  ")},qi.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},qi.prototype.findEdgeIndex=function(t){for(var e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1},qi.prototype.iterator=function(){return this._edges.iterator()},qi.prototype.getEdges=function(){return this._edges},qi.prototype.get=function(t){return this._edges.get(t)},qi.prototype.findEqualEdge=function(t){var e=new Wi(t.getCoordinates());return this._ocaMap.get(e)},qi.prototype.add=function(t){this._edges.add(t);var e=new Wi(t.getCoordinates());this._ocaMap.put(e,t)},qi.prototype.interfaces_=function(){return[]},qi.prototype.getClass=function(){return qi};var Xi=function(){};Xi.prototype.processIntersections=function(t,e,i,n){},Xi.prototype.isDone=function(){},Xi.prototype.interfaces_=function(){return[]},Xi.prototype.getClass=function(){return Xi};var $i=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};$i.prototype.isTrivialIntersection=function(t,e,i,n){if(t===i&&1===this._li.getIntersectionNum()){if($i.isAdjacentSegments(e,n))return!0;if(t.isClosed()){var r=t.size()-1;if(0===e&&n===r||0===n&&e===r)return!0}}return!1},$i.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},$i.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},$i.prototype.getLineIntersector=function(){return this._li},$i.prototype.hasProperIntersection=function(){return this._hasProper},$i.prototype.processIntersections=function(t,e,i,n){if(t===i&&e===n)return null;this.numTests++;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[n],a=i.getCoordinates()[n+1];this._li.computeIntersection(r,o,s,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,i,n)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),i.addIntersections(this._li,n,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},$i.prototype.hasIntersection=function(){return this._hasIntersection},$i.prototype.isDone=function(){return!1},$i.prototype.hasInteriorIntersection=function(){return this._hasInterior},$i.prototype.interfaces_=function(){return[Xi]},$i.prototype.getClass=function(){return $i},$i.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var Yi=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],i=arguments[2];this.coord=new S(t),this.segmentIndex=e,this.dist=i};Yi.prototype.getSegmentIndex=function(){return this.segmentIndex},Yi.prototype.getCoordinate=function(){return this.coord},Yi.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},Yi.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},Yi.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},Yi.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Yi.prototype.getDistance=function(){return this.dist},Yi.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},Yi.prototype.interfaces_=function(){return[b]},Yi.prototype.getClass=function(){return Yi};var Zi=function(){this._nodeMap=new h,this.edge=null;var t=arguments[0];this.edge=t};Zi.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},Zi.prototype.iterator=function(){return this._nodeMap.values().iterator()},Zi.prototype.addSplitEdges=function(t){this.addEndpoints();for(var e=this.iterator(),i=e.next();e.hasNext();){var n=e.next(),r=this.createSplitEdge(i,n);t.add(r),i=n}},Zi.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},Zi.prototype.createSplitEdge=function(t,e){var i=e.segmentIndex-t.segmentIndex+2,n=this.edge.pts[e.segmentIndex],r=e.dist>0||!e.coord.equals2D(n);r||i--;var o=new Array(i).fill(null),s=0;o[s++]=new S(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this.edge.pts[a];return r&&(o[s]=e.coord),new en(o,new Re(this.edge._label))},Zi.prototype.add=function(t,e,i){var n=new Yi(t,e,i),r=this._nodeMap.get(n);return null!==r?r:(this._nodeMap.put(n,n),n)},Zi.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1},Zi.prototype.interfaces_=function(){return[]},Zi.prototype.getClass=function(){return Zi};var Ki=function(){};Ki.prototype.getChainStartIndices=function(t){var e=0,i=new Et;i.add(new k(e));do{var n=this.findChainEnd(t,e);i.add(new k(n)),e=n}while(e<t.length-1);return Ki.toIntArray(i)},Ki.prototype.findChainEnd=function(t,e){for(var i=Be.quadrant(t[e],t[e+1]),n=e+1;n<t.length&&Be.quadrant(t[n-1],t[n])===i;)n++;return n-1},Ki.prototype.interfaces_=function(){return[]},Ki.prototype.getClass=function(){return Ki},Ki.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),i=0;i<e.length;i++)e[i]=t.get(i).intValue();return e};var Ji=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new q,this.env2=new q;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new Ki;this.startIndex=e.getChainStartIndices(this.pts)};Ji.prototype.getCoordinates=function(){return this.pts},Ji.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,i=this.pts[this.startIndex[t+1]].x;return e>i?e:i},Ji.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,i=this.pts[this.startIndex[t+1]].x;return e<i?e:i},Ji.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[i],e.startIndex[i+1],n)}else if(6===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],l=arguments[4],c=arguments[5],u=this.pts[r],h=this.pts[o],d=s.pts[a],p=s.pts[l];if(o-r==1&&l-a==1)return c.addIntersections(this.e,r,s.e,a),null;if(this.env1.init(u,h),this.env2.init(d,p),!this.env1.intersects(this.env2))return null;var f=Math.trunc((r+o)/2),m=Math.trunc((a+l)/2);r<f&&(a<m&&this.computeIntersectsForChain(r,f,s,a,m,c),m<l&&this.computeIntersectsForChain(r,f,s,m,l,c)),f<o&&(a<m&&this.computeIntersectsForChain(f,o,s,a,m,c),m<l&&this.computeIntersectsForChain(f,o,s,m,l,c))}},Ji.prototype.getStartIndexes=function(){return this.startIndex},Ji.prototype.computeIntersects=function(t,e){for(var i=0;i<this.startIndex.length-1;i++)for(var n=0;n<t.startIndex.length-1;n++)this.computeIntersectsForChain(i,t,n,e)},Ji.prototype.interfaces_=function(){return[]},Ji.prototype.getClass=function(){return Ji};var Qi=function t(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var e=0;e<2;e++)for(var i=0;i<3;i++)this._depth[e][i]=t.NULL_VALUE},tn={NULL_VALUE:{configurable:!0}};Qi.prototype.getDepth=function(t,e){return this._depth[t][e]},Qi.prototype.setDepth=function(t,e,i){this._depth[t][e]=i},Qi.prototype.isNull=function(){if(0===arguments.length){for(var t=0;t<2;t++)for(var e=0;e<3;e++)if(this._depth[t][e]!==Qi.NULL_VALUE)return!1;return!0}if(1===arguments.length){var i=arguments[0];return this._depth[i][1]===Qi.NULL_VALUE}if(2===arguments.length){var n=arguments[0],r=arguments[1];return this._depth[n][r]===Qi.NULL_VALUE}},Qi.prototype.normalize=function(){for(var t=0;t<2;t++)if(!this.isNull(t)){var e=this._depth[t][1];this._depth[t][2]<e&&(e=this._depth[t][2]),e<0&&(e=0);for(var i=1;i<3;i++){var n=0;this._depth[t][i]>e&&(n=1),this._depth[t][i]=n}}},Qi.prototype.getDelta=function(t){return this._depth[t][Te.RIGHT]-this._depth[t][Te.LEFT]},Qi.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?C.EXTERIOR:C.INTERIOR},Qi.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},Qi.prototype.add=function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<2;e++)for(var i=1;i<3;i++){var n=t.getLocation(e,i);n!==C.EXTERIOR&&n!==C.INTERIOR||(this.isNull(e,i)?this._depth[e][i]=Qi.depthAtLocation(n):this._depth[e][i]+=Qi.depthAtLocation(n))}else if(3===arguments.length){var r=arguments[0],o=arguments[1];arguments[2]===C.INTERIOR&&this._depth[r][o]++}},Qi.prototype.interfaces_=function(){return[]},Qi.prototype.getClass=function(){return Qi},Qi.depthAtLocation=function(t){return t===C.EXTERIOR?0:t===C.INTERIOR?1:Qi.NULL_VALUE},tn.NULL_VALUE.get=function(){return-1},Object.defineProperties(Qi,tn);var en=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new Zi(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Qi,this._depthDelta=0,1===arguments.length){var i=arguments[0];e.call(this,i,null)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.pts=n,this._label=r}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new e(t,Re.toLineLabel(this._label))},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(t){this._isIsolated=t},e.prototype.setName=function(t){this._name=t},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var i=t;if(this.pts.length!==i.pts.length)return!1;for(var n=!0,r=!0,o=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(i.pts[s])||(n=!1),this.pts[s].equals2D(i.pts[--o])||(r=!1),!n&&!r)return!1;return!0},e.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},e.prototype.print=function(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(t){e.updateIM(this._label,t)},e.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(t){t.print("edge "+this._name+": ");for(var e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")},e.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new Ji(this)),this._mce},e.prototype.getEnvelope=function(){if(null===this._env){this._env=new q;for(var t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env},e.prototype.addIntersection=function(t,e,i,n){var r=new S(t.getIntersection(n)),o=e,s=t.getEdgeDistance(i,n),a=o+1;if(a<this.pts.length){var l=this.pts[a];r.equals2D(l)&&(o=a,s=0)}this.eiList.add(r,o,s)},e.prototype.toString=function(){var t=new D;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()},e.prototype.isPointwiseEqual=function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},e.prototype.setDepthDelta=function(t){this._depthDelta=t},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(t,e,i){for(var n=0;n<t.getIntersectionNum();n++)this.addIntersection(t,e,i,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(2!==arguments.length)return t.prototype.updateIM.apply(this,arguments);var e=arguments[0],i=arguments[1];i.setAtLeastIfValid(e.getLocation(0,Te.ON),e.getLocation(1,Te.ON),1),e.isArea()&&(i.setAtLeastIfValid(e.getLocation(0,Te.LEFT),e.getLocation(1,Te.LEFT),2),i.setAtLeastIfValid(e.getLocation(0,Te.RIGHT),e.getLocation(1,Te.RIGHT),2))},e}(Oe),nn=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new qi,this._bufParams=t||null};nn.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t},nn.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var i=e.getLabel(),n=t.getLabel();e.isPointwiseEqual(t)||(n=new Re(t.getLabel())).flip(),i.merge(n);var r=nn.depthDelta(n),o=e.getDepthDelta()+r;e.setDepthDelta(o)}else this._edgeList.add(t),t.setDepthDelta(nn.depthDelta(t.getLabel()))},nn.prototype.buildSubgraphs=function(t,e){for(var i=new Et,n=t.iterator();n.hasNext();){var r=n.next(),o=r.getRightmostCoordinate(),s=new ki(i).getDepth(o);r.computeDepth(s),r.findResultEdges(),i.add(r),e.add(r.getDirectedEdges(),r.getNodes())}},nn.prototype.createSubgraphs=function(t){for(var e=new Et,i=t.getNodes().iterator();i.hasNext();){var n=i.next();if(!n.isVisited()){var r=new Pe;r.create(n),e.add(r)}}return Qe.sort(e,Qe.reverseOrder()),e},nn.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},nn.prototype.getNoder=function(t){if(null!==this._workingNoder)return this._workingNoder;var e=new bi,i=new rt;return i.setPrecisionModel(t),e.setSegmentIntersector(new $i(i)),e},nn.prototype.buffer=function(t,e){var i=this._workingPrecisionModel;null===i&&(i=t.getPrecisionModel()),this._geomFact=t.getFactory();var n=new Di(i,this._bufParams),r=new zi(t,e,n).getCurves();if(r.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(r,i),this._graph=new He(new Hi),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),s=new We(this._geomFact);this.buildSubgraphs(o,s);var a=s.getPolygons();return a.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(a)},nn.prototype.computeNodedEdges=function(t,e){var i=this.getNoder(e);i.computeNodes(t);for(var n=i.getNodedSubstrings().iterator();n.hasNext();){var r=n.next(),o=r.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var s=r.getData(),a=new en(r.getCoordinates(),new Re(s));this.insertUniqueEdge(a)}}},nn.prototype.setNoder=function(t){this._workingNoder=t},nn.prototype.interfaces_=function(){return[]},nn.prototype.getClass=function(){return nn},nn.depthDelta=function(t){var e=t.getLocation(0,Te.LEFT),i=t.getLocation(0,Te.RIGHT);return e===C.INTERIOR&&i===C.EXTERIOR?1:e===C.EXTERIOR&&i===C.INTERIOR?-1:0},nn.convertSegStrings=function(t){for(var e=new _e,i=new Et;t.hasNext();){var n=t.next(),r=e.createLineString(n.getCoordinates());i.add(r)}return e.buildGeometry(i)};var rn=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2],o=arguments[3];this._noder=i,this._scaleFactor=n,this._offsetX=r,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}};rn.prototype.rescale=function(){if(P(arguments[0],xt))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.rescale(e.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],n=0;n<i.length;n++)i[n].x=i[n].x/this._scaleFactor+this._offsetX,i[n].y=i[n].y/this._scaleFactor+this._offsetY;2===i.length&&i[0].equals2D(i[1])&&H.out.println(i)}},rn.prototype.scale=function(){if(P(arguments[0],xt)){for(var t=arguments[0],e=new Et,i=t.iterator();i.hasNext();){var n=i.next();e.add(new pi(this.scale(n.getCoordinates()),n.getData()))}return e}if(arguments[0]instanceof Array){for(var r=arguments[0],o=new Array(r.length).fill(null),s=0;s<r.length;s++)o[s]=new S(Math.round((r[s].x-this._offsetX)*this._scaleFactor),Math.round((r[s].y-this._offsetY)*this._scaleFactor),r[s].z);return Mt.removeRepeatedPoints(o)}},rn.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},rn.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t},rn.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)},rn.prototype.interfaces_=function(){return[vi]},rn.prototype.getClass=function(){return rn};var on=function(){this._li=new rt,this._segStrings=null;var t=arguments[0];this._segStrings=t},sn={fact:{configurable:!0}};on.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next().getCoordinates();this.checkEndPtVertexIntersections(e[0],this._segStrings),this.checkEndPtVertexIntersections(e[e.length-1],this._segStrings)}else if(2===arguments.length)for(var i=arguments[0],n=arguments[1].iterator();n.hasNext();)for(var r=n.next().getCoordinates(),o=1;o<r.length-1;o++)if(r[o].equals(i))throw new Q("found endpt/interior pt intersection at index "+o+" :pt "+i)},on.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();)for(var e=t.next(),i=this._segStrings.iterator();i.hasNext();){var n=i.next();this.checkInteriorIntersections(e,n)}else if(2===arguments.length)for(var r=arguments[0],o=arguments[1],s=r.getCoordinates(),a=o.getCoordinates(),l=0;l<s.length-1;l++)for(var c=0;c<a.length-1;c++)this.checkInteriorIntersections(r,l,o,c);else if(4===arguments.length){var u=arguments[0],h=arguments[1],d=arguments[2],p=arguments[3];if(u===d&&h===p)return null;var f=u.getCoordinates()[h],m=u.getCoordinates()[h+1],g=d.getCoordinates()[p],_=d.getCoordinates()[p+1];if(this._li.computeIntersection(f,m,g,_),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,f,m)||this.hasInteriorIntersection(this._li,g,_)))throw new Q("found non-noded intersection at "+f+"-"+m+" and "+g+"-"+_)}},on.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},on.prototype.checkCollapses=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next();this.checkCollapses(e)}else if(1===arguments.length)for(var i=arguments[0].getCoordinates(),n=0;n<i.length-2;n++)this.checkCollapse(i[n],i[n+1],i[n+2])},on.prototype.hasInteriorIntersection=function(t,e,i){for(var n=0;n<t.getIntersectionNum();n++){var r=t.getIntersection(n);if(!r.equals(e)&&!r.equals(i))return!0}return!1},on.prototype.checkCollapse=function(t,e,i){if(t.equals(i))throw new Q("found non-noded collapse at "+on.fact.createLineString([t,e,i]))},on.prototype.interfaces_=function(){return[]},on.prototype.getClass=function(){return on},sn.fact.get=function(){return new _e},Object.defineProperties(on,sn);var an=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],i=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=i,e<=0)throw new y("Scale factor must be non-zero");1!==e&&(this._pt=new S(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new S,this._p1Scaled=new S),this.initCorners(this._pt)},ln={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};an.prototype.intersectsScaled=function(t,e){var i=Math.min(t.x,e.x),n=Math.max(t.x,e.x),r=Math.min(t.y,e.y),o=Math.max(t.y,e.y),s=this._maxx<i||this._minx>n||this._maxy<r||this._miny>o;if(s)return!1;var a=this.intersectsToleranceSquare(t,e);return et.isTrue(!(s&&a),"Found bad envelope test"),a},an.prototype.initCorners=function(t){this._minx=t.x-.5,this._maxx=t.x+.5,this._miny=t.y-.5,this._maxy=t.y+.5,this._corner[0]=new S(this._maxx,this._maxy),this._corner[1]=new S(this._minx,this._maxy),this._corner[2]=new S(this._minx,this._miny),this._corner[3]=new S(this._maxx,this._miny)},an.prototype.intersects=function(t,e){return 1===this._scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},an.prototype.scale=function(t){return Math.round(t*this._scaleFactor)},an.prototype.getCoordinate=function(){return this._originalPt},an.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},an.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var t=an.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new q(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv},an.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},an.prototype.intersectsToleranceSquare=function(t,e){var i=!1,n=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper()||i&&n||t.equals(this._pt)||e.equals(this._pt)))))},an.prototype.addSnappedNode=function(t,e){var i=t.getCoordinate(e),n=t.getCoordinate(e+1);return!!this.intersects(i,n)&&(t.addIntersection(this.getCoordinate(),e),!0)},an.prototype.interfaces_=function(){return[]},an.prototype.getClass=function(){return an},ln.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(an,ln);var cn=function(){this.tempEnv1=new q,this.selectedSegment=new fi};cn.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var t=arguments[1];arguments[0].getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}},cn.prototype.interfaces_=function(){return[]},cn.prototype.getClass=function(){return cn};var un=function(){this._index=null;var t=arguments[0];this._index=t},hn={HotPixelSnapAction:{configurable:!0}};un.prototype.snap=function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],i=arguments[1],n=arguments[2],r=e.getSafeEnvelope(),o=new dn(e,i,n);return this._index.query(r,{interfaces_:function(){return[Ye]},visitItem:function(t){t.select(r,o)}}),o.isNodeAdded()}},un.prototype.interfaces_=function(){return[]},un.prototype.getClass=function(){return un},hn.HotPixelSnapAction.get=function(){return dn},Object.defineProperties(un,hn);var dn=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],i=arguments[1],n=arguments[2];this._hotPixel=e,this._parentEdge=i,this._hotPixelVertexIndex=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(2!==arguments.length)return t.prototype.select.apply(this,arguments);var e=arguments[1],i=arguments[0].getContext();if(null!==this._parentEdge&&i===this._parentEdge&&e===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(i,e)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(cn),pn=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new Et};pn.prototype.processIntersections=function(t,e,i,n){if(t===i&&e===n)return null;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[n],a=i.getCoordinates()[n+1];if(this._li.computeIntersection(r,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var l=0;l<this._li.getIntersectionNum();l++)this._interiorIntersections.add(this._li.getIntersection(l));t.addIntersections(this._li,e,0),i.addIntersections(this._li,n,1)}},pn.prototype.isDone=function(){return!1},pn.prototype.getInteriorIntersections=function(){return this._interiorIntersections},pn.prototype.interfaces_=function(){return[Xi]},pn.prototype.getClass=function(){return pn};var fn=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new rt,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};fn.prototype.checkCorrectness=function(t){var e=pi.getNodedSubstrings(t),i=new on(e);try{i.checkValid()}catch(t){if(!(t instanceof j))throw t;t.printStackTrace()}},fn.prototype.getNodedSubstrings=function(){return pi.getNodedSubstrings(this._nodedSegStrings)},fn.prototype.snapRound=function(t,e){var i=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(i),this.computeVertexSnaps(t)},fn.prototype.findInteriorIntersections=function(t,e){var i=new pn(e);return this._noder.setSegmentIntersector(i),this._noder.computeNodes(t),i.getInteriorIntersections()},fn.prototype.computeVertexSnaps=function(){if(P(arguments[0],xt))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.computeVertexSnaps(e)}else if(arguments[0]instanceof pi)for(var i=arguments[0],n=i.getCoordinates(),r=0;r<n.length;r++){var o=new an(n[r],this._scaleFactor,this._li);this._pointSnapper.snap(o,i,r)&&i.addIntersection(n[r],r)}},fn.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new bi,this._pointSnapper=new un(this._noder.getIndex()),this.snapRound(t,this._li)},fn.prototype.computeIntersectionSnaps=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next(),n=new an(i,this._scaleFactor,this._li);this._pointSnapper.snap(n)}},fn.prototype.interfaces_=function(){return[vi]},fn.prototype.getClass=function(){return fn};var mn=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Ei,this._resultGeometry=null,this._saveException=null,1===arguments.length){var t=arguments[0];this._argGeom=t}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this._argGeom=e,this._bufParams=i}},gn={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};mn.prototype.bufferFixedPrecision=function(t){var e=new rn(new fn(new pe(1)),t.getScale()),i=new nn(this._bufParams);i.setWorkingPrecisionModel(t),i.setNoder(e),this._resultGeometry=i.buffer(this._argGeom,this._distance)},mn.prototype.bufferReducedPrecision=function(){var t=this;if(0===arguments.length){for(var e=mn.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(e){if(!(e instanceof Ce))throw e;t._saveException=e}if(null!==t._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var i=arguments[0],n=mn.precisionScaleFactor(this._argGeom,this._distance,i),r=new pe(n);this.bufferFixedPrecision(r)}},mn.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===pe.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},mn.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)},mn.prototype.bufferOriginalPrecision=function(){try{var t=new nn(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof Q))throw t;this._saveException=t}},mn.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry},mn.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)},mn.prototype.interfaces_=function(){return[]},mn.prototype.getClass=function(){return mn},mn.bufferOp=function(){if(2===arguments.length){var t=arguments[1];return new mn(arguments[0]).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof ut&&"number"==typeof arguments[1]){var e=arguments[1],i=arguments[2],n=new mn(arguments[0]);return n.setQuadrantSegments(i),n.getResultGeometry(e)}if(arguments[2]instanceof Ei&&arguments[0]instanceof ut&&"number"==typeof arguments[1]){var r=arguments[1];return new mn(arguments[0],arguments[2]).getResultGeometry(r)}}else if(4===arguments.length){var o=arguments[1],s=arguments[2],a=arguments[3],l=new mn(arguments[0]);return l.setQuadrantSegments(s),l.setEndCapStyle(a),l.getResultGeometry(o)}},mn.precisionScaleFactor=function(t,e,i){var n=t.getEnvelopeInternal(),r=L.max(Math.abs(n.getMaxX()),Math.abs(n.getMaxY()),Math.abs(n.getMinX()),Math.abs(n.getMinY()))+2*(e>0?e:0),o=i-Math.trunc(Math.log(r)/Math.log(10)+1);return Math.pow(10,o)},gn.CAP_ROUND.get=function(){return Ei.CAP_ROUND},gn.CAP_BUTT.get=function(){return Ei.CAP_FLAT},gn.CAP_FLAT.get=function(){return Ei.CAP_FLAT},gn.CAP_SQUARE.get=function(){return Ei.CAP_SQUARE},gn.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(mn,gn);var _n=function(){this._pt=[new S,new S],this._distance=v.NaN,this._isNull=!0};_n.prototype.getCoordinates=function(){return this._pt},_n.prototype.getCoordinate=function(t){return this._pt[t]},_n.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var n=e.distance(i);n<this._distance&&this.initialize(e,i,n)}},_n.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(n),this._distance=r,this._isNull=!1}},_n.prototype.getDistance=function(){return this._distance},_n.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var n=e.distance(i);n>this._distance&&this.initialize(e,i,n)}},_n.prototype.interfaces_=function(){return[]},_n.prototype.getClass=function(){return _n};var yn=function(){};yn.prototype.interfaces_=function(){return[]},yn.prototype.getClass=function(){return yn},yn.computeDistance=function(){if(arguments[2]instanceof _n&&arguments[0]instanceof Yt&&arguments[1]instanceof S)for(var t=arguments[1],e=arguments[2],i=arguments[0].getCoordinates(),n=new fi,r=0;r<i.length-1;r++){n.setCoordinates(i[r],i[r+1]);var o=n.closestPoint(t);e.setMinimum(o,t)}else if(arguments[2]instanceof _n&&arguments[0]instanceof Qt&&arguments[1]instanceof S){var s=arguments[0],a=arguments[1],l=arguments[2];yn.computeDistance(s.getExteriorRing(),a,l);for(var c=0;c<s.getNumInteriorRing();c++)yn.computeDistance(s.getInteriorRingN(c),a,l)}else if(arguments[2]instanceof _n&&arguments[0]instanceof ut&&arguments[1]instanceof S){var u=arguments[0],h=arguments[1],d=arguments[2];if(u instanceof Yt)yn.computeDistance(u,h,d);else if(u instanceof Qt)yn.computeDistance(u,h,d);else if(u instanceof jt)for(var p=u,f=0;f<p.getNumGeometries();f++){var m=p.getGeometryN(f);yn.computeDistance(m,h,d)}else d.setMinimum(u.getCoordinate(),h)}else if(arguments[2]instanceof _n&&arguments[0]instanceof fi&&arguments[1]instanceof S){var g=arguments[1],_=arguments[2],y=arguments[0].closestPoint(g);_.setMinimum(y,g)}};var vn=function(t){this._maxPtDist=new _n,this._inputGeom=t||null},xn={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};vn.prototype.computeMaxMidpointDistance=function(t){var e=new wn(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},vn.prototype.computeMaxVertexDistance=function(t){var e=new bn(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},vn.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()},vn.prototype.getDistancePoints=function(){return this._maxPtDist},vn.prototype.interfaces_=function(){return[]},vn.prototype.getClass=function(){return vn},xn.MaxPointDistanceFilter.get=function(){return bn},xn.MaxMidpointDistanceFilter.get=function(){return wn},Object.defineProperties(vn,xn);var bn=function(t){this._maxPtDist=new _n,this._minPtDist=new _n,this._geom=t||null};bn.prototype.filter=function(t){this._minPtDist.initialize(),yn.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},bn.prototype.getMaxPointDistance=function(){return this._maxPtDist},bn.prototype.interfaces_=function(){return[pt]},bn.prototype.getClass=function(){return bn};var wn=function(t){this._maxPtDist=new _n,this._minPtDist=new _n,this._geom=t||null};wn.prototype.filter=function(t,e){if(0===e)return null;var i=t.getCoordinate(e-1),n=t.getCoordinate(e),r=new S((i.x+n.x)/2,(i.y+n.y)/2);this._minPtDist.initialize(),yn.computeDistance(this._geom,r,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},wn.prototype.isDone=function(){return!1},wn.prototype.isGeometryChanged=function(){return!1},wn.prototype.getMaxPointDistance=function(){return this._maxPtDist},wn.prototype.interfaces_=function(){return[Vt]},wn.prototype.getClass=function(){return wn};var En=function(t){this._comps=t||null};En.prototype.filter=function(t){t instanceof Qt&&this._comps.add(t)},En.prototype.interfaces_=function(){return[Ut]},En.prototype.getClass=function(){return En},En.getPolygons=function(){if(1===arguments.length)return En.getPolygons(arguments[0],new Et);if(2===arguments.length){var t=arguments[0],e=arguments[1];return t instanceof Qt?e.add(t):t instanceof jt&&t.apply(new En(e)),e}};var Sn=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this._lines=t}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this._lines=e,this._isForcedToLineString=i}};Sn.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof ee){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof Yt&&this._lines.add(t)},Sn.prototype.setForceToLineString=function(t){this._isForcedToLineString=t},Sn.prototype.interfaces_=function(){return[ct]},Sn.prototype.getClass=function(){return Sn},Sn.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(Sn.getLines(t))}if(2===arguments.length){var e=arguments[0],i=arguments[1];return e.getFactory().buildGeometry(Sn.getLines(e,i))}},Sn.getLines=function(){if(1===arguments.length)return Sn.getLines(arguments[0],!1);if(2===arguments.length){if(P(arguments[0],xt)&&P(arguments[1],xt)){for(var t=arguments[1],e=arguments[0].iterator();e.hasNext();){var i=e.next();Sn.getLines(i,t)}return t}if(arguments[0]instanceof ut&&"boolean"==typeof arguments[1]){var n=arguments[0],r=arguments[1],o=new Et;return n.apply(new Sn(o,r)),o}if(arguments[0]instanceof ut&&P(arguments[1],xt)){var s=arguments[0],a=arguments[1];return s instanceof Yt?a.add(s):s.apply(new Sn(a)),a}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&P(arguments[0],xt)&&P(arguments[1],xt)){for(var l=arguments[1],c=arguments[2],u=arguments[0].iterator();u.hasNext();){var h=u.next();Sn.getLines(h,l,c)}return l}if("boolean"==typeof arguments[2]&&arguments[0]instanceof ut&&P(arguments[1],xt)){var d=arguments[1],p=arguments[2];return arguments[0].apply(new Sn(d,p)),d}}};var Tn=function(){if(this._boundaryRule=ft.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new y("Rule must be non-null");this._boundaryRule=t}};Tn.prototype.locateInternal=function(){if(arguments[0]instanceof S&&arguments[1]instanceof Qt){var t=arguments[0],e=arguments[1];if(e.isEmpty())return C.EXTERIOR;var i=e.getExteriorRing(),n=this.locateInPolygonRing(t,i);if(n===C.EXTERIOR)return C.EXTERIOR;if(n===C.BOUNDARY)return C.BOUNDARY;for(var r=0;r<e.getNumInteriorRing();r++){var o=e.getInteriorRingN(r),s=this.locateInPolygonRing(t,o);if(s===C.INTERIOR)return C.EXTERIOR;if(s===C.BOUNDARY)return C.BOUNDARY}return C.INTERIOR}if(arguments[0]instanceof S&&arguments[1]instanceof Yt){var a=arguments[0],l=arguments[1];if(!l.getEnvelopeInternal().intersects(a))return C.EXTERIOR;var c=l.getCoordinates();return l.isClosed()||!a.equals(c[0])&&!a.equals(c[c.length-1])?at.isOnLine(a,c)?C.INTERIOR:C.EXTERIOR:C.BOUNDARY}if(arguments[0]instanceof S&&arguments[1]instanceof Kt){var u=arguments[0];return arguments[1].getCoordinate().equals2D(u)?C.INTERIOR:C.EXTERIOR}},Tn.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?at.locatePointInRing(t,e.getCoordinates()):C.EXTERIOR},Tn.prototype.intersects=function(t,e){return this.locate(t,e)!==C.EXTERIOR},Tn.prototype.updateLocationInfo=function(t){t===C.INTERIOR&&(this._isIn=!0),t===C.BOUNDARY&&this._numBoundaries++},Tn.prototype.computeLocation=function(t,e){if(e instanceof Kt&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof Yt)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Qt)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Gt)for(var i=e,n=0;n<i.getNumGeometries();n++){var r=i.getGeometryN(n);this.updateLocationInfo(this.locateInternal(t,r))}else if(e instanceof ie)for(var o=e,s=0;s<o.getNumGeometries();s++){var a=o.getGeometryN(s);this.updateLocationInfo(this.locateInternal(t,a))}else if(e instanceof jt)for(var l=new Ui(e);l.hasNext();){var c=l.next();c!==e&&this.computeLocation(t,c)}},Tn.prototype.locate=function(t,e){return e.isEmpty()?C.EXTERIOR:e instanceof Yt||e instanceof Qt?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?C.BOUNDARY:this._numBoundaries>0||this._isIn?C.INTERIOR:C.EXTERIOR)},Tn.prototype.interfaces_=function(){return[]},Tn.prototype.getClass=function(){return Tn};var Mn=function t(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)t.call(this,arguments[0],t.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var e=arguments[0],i=arguments[1],n=arguments[2];this._component=e,this._segIndex=i,this._pt=n}},In={INSIDE_AREA:{configurable:!0}};Mn.prototype.isInsideArea=function(){return this._segIndex===Mn.INSIDE_AREA},Mn.prototype.getCoordinate=function(){return this._pt},Mn.prototype.getGeometryComponent=function(){return this._component},Mn.prototype.getSegmentIndex=function(){return this._segIndex},Mn.prototype.interfaces_=function(){return[]},Mn.prototype.getClass=function(){return Mn},In.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Mn,In);var Cn=function(t){this._pts=t||null};Cn.prototype.filter=function(t){t instanceof Kt&&this._pts.add(t)},Cn.prototype.interfaces_=function(){return[Ut]},Cn.prototype.getClass=function(){return Cn},Cn.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof Kt?Qe.singletonList(t):Cn.getPoints(t,new Et)}if(2===arguments.length){var e=arguments[0],i=arguments[1];return e instanceof Kt?i.add(e):e instanceof jt&&e.apply(new Cn(i)),i}};var An=function(){this._locations=null;var t=arguments[0];this._locations=t};An.prototype.filter=function(t){(t instanceof Kt||t instanceof Yt||t instanceof Qt)&&this._locations.add(new Mn(t,0,t.getCoordinate()))},An.prototype.interfaces_=function(){return[Ut]},An.prototype.getClass=function(){return An},An.getLocations=function(t){var e=new Et;return t.apply(new An(e)),e};var Pn=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Tn,this._minDistanceLocation=null,this._minDistance=v.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=i,this._geom[1]=n,this._terminateDistance=r}};Pn.prototype.computeContainmentDistance=function(){if(0===arguments.length){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1],n=1-e,r=En.getPolygons(this._geom[e]);if(r.size()>0){var o=An.getLocations(this._geom[n]);if(this.computeContainmentDistance(o,r,i),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[n]=i[0],this._minDistanceLocation[e]=i[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&P(arguments[0],wt)&&P(arguments[1],wt)){for(var s=arguments[0],a=arguments[1],l=arguments[2],c=0;c<s.size();c++)for(var u=s.get(c),h=0;h<a.size();h++)if(this.computeContainmentDistance(u,a.get(h),l),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Mn&&arguments[1]instanceof Qt){var d=arguments[0],p=arguments[1],f=arguments[2],m=d.getCoordinate();if(C.EXTERIOR!==this._ptLocator.locate(m,p))return this._minDistance=0,f[0]=d,f[1]=new Mn(p,m),null}},Pn.prototype.computeMinDistanceLinesPoints=function(t,e,i){for(var n=0;n<t.size();n++)for(var r=t.get(n),o=0;o<e.size();o++){var s=e.get(o);if(this.computeMinDistance(r,s,i),this._minDistance<=this._terminateDistance)return null}},Pn.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=Sn.getLines(this._geom[0]),i=Sn.getLines(this._geom[1]),n=Cn.getPoints(this._geom[0]),r=Cn.getPoints(this._geom[1]);return this.computeMinDistanceLines(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,r,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(i,n,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(n,r,t),void this.updateMinDistance(t,!1))))},Pn.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Pn.prototype.updateMinDistance=function(t,e){if(null===t[0])return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])},Pn.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Pn.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof Yt&&arguments[1]instanceof Kt){var t=arguments[0],e=arguments[1],i=arguments[2];if(t.getEnvelopeInternal().distance(e.getEnvelopeInternal())>this._minDistance)return null;for(var n=t.getCoordinates(),r=e.getCoordinate(),o=0;o<n.length-1;o++){var s=at.distancePointLine(r,n[o],n[o+1]);if(s<this._minDistance){this._minDistance=s;var a=new fi(n[o],n[o+1]).closestPoint(r);i[0]=new Mn(t,o,a),i[1]=new Mn(e,0,r)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Yt&&arguments[1]instanceof Yt){var l=arguments[0],c=arguments[1],u=arguments[2];if(l.getEnvelopeInternal().distance(c.getEnvelopeInternal())>this._minDistance)return null;for(var h=l.getCoordinates(),d=c.getCoordinates(),p=0;p<h.length-1;p++)for(var f=0;f<d.length-1;f++){var m=at.distanceLineLine(h[p],h[p+1],d[f],d[f+1]);if(m<this._minDistance){this._minDistance=m;var g=new fi(h[p],h[p+1]),_=new fi(d[f],d[f+1]),y=g.closestPoints(_);u[0]=new Mn(l,p,y[0]),u[1]=new Mn(c,f,y[1])}if(this._minDistance<=this._terminateDistance)return null}}},Pn.prototype.computeMinDistancePoints=function(t,e,i){for(var n=0;n<t.size();n++)for(var r=t.get(n),o=0;o<e.size();o++){var s=e.get(o),a=r.getCoordinate().distance(s.getCoordinate());if(a<this._minDistance&&(this._minDistance=a,i[0]=new Mn(r,0,r.getCoordinate()),i[1]=new Mn(s,0,s.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},Pn.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new y("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Pn.prototype.computeMinDistanceLines=function(t,e,i){for(var n=0;n<t.size();n++)for(var r=t.get(n),o=0;o<e.size();o++){var s=e.get(o);if(this.computeMinDistance(r,s,i),this._minDistance<=this._terminateDistance)return null}},Pn.prototype.interfaces_=function(){return[]},Pn.prototype.getClass=function(){return Pn},Pn.distance=function(t,e){return new Pn(t,e).distance()},Pn.isWithinDistance=function(t,e,i){return new Pn(t,e,i).distance()<=i},Pn.nearestPoints=function(t,e){return new Pn(t,e).nearestPoints()};var Ln=function(){this._pt=[new S,new S],this._distance=v.NaN,this._isNull=!0};Ln.prototype.getCoordinates=function(){return this._pt},Ln.prototype.getCoordinate=function(t){return this._pt[t]},Ln.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var n=e.distance(i);n<this._distance&&this.initialize(e,i,n)}},Ln.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(n),this._distance=r,this._isNull=!1}},Ln.prototype.toString=function(){return J.toLineString(this._pt[0],this._pt[1])},Ln.prototype.getDistance=function(){return this._distance},Ln.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var n=e.distance(i);n>this._distance&&this.initialize(e,i,n)}},Ln.prototype.interfaces_=function(){return[]},Ln.prototype.getClass=function(){return Ln};var Rn=function(){};Rn.prototype.interfaces_=function(){return[]},Rn.prototype.getClass=function(){return Rn},Rn.computeDistance=function(){if(arguments[2]instanceof Ln&&arguments[0]instanceof Yt&&arguments[1]instanceof S)for(var t=arguments[0],e=arguments[1],i=arguments[2],n=new fi,r=t.getCoordinates(),o=0;o<r.length-1;o++){n.setCoordinates(r[o],r[o+1]);var s=n.closestPoint(e);i.setMinimum(s,e)}else if(arguments[2]instanceof Ln&&arguments[0]instanceof Qt&&arguments[1]instanceof S){var a=arguments[0],l=arguments[1],c=arguments[2];Rn.computeDistance(a.getExteriorRing(),l,c);for(var u=0;u<a.getNumInteriorRing();u++)Rn.computeDistance(a.getInteriorRingN(u),l,c)}else if(arguments[2]instanceof Ln&&arguments[0]instanceof ut&&arguments[1]instanceof S){var h=arguments[0],d=arguments[1],p=arguments[2];if(h instanceof Yt)Rn.computeDistance(h,d,p);else if(h instanceof Qt)Rn.computeDistance(h,d,p);else if(h instanceof jt)for(var f=h,m=0;m<f.getNumGeometries();m++){var g=f.getGeometryN(m);Rn.computeDistance(g,d,p)}else p.setMinimum(h.getCoordinate(),d)}else if(arguments[2]instanceof Ln&&arguments[0]instanceof fi&&arguments[1]instanceof S){var _=arguments[1],y=arguments[2],v=arguments[0].closestPoint(_);y.setMinimum(v,_)}};var Dn=function(){this._g0=null,this._g1=null,this._ptDist=new Ln,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},kn={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Dn.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},Dn.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new y("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t},Dn.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)},Dn.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},Dn.prototype.computeOrientedDistance=function(t,e,i){var n=new Nn(e);if(t.apply(n),i.setMaximum(n.getMaxPointDistance()),this._densifyFrac>0){var r=new On(e,this._densifyFrac);t.apply(r),i.setMaximum(r.getMaxPointDistance())}},Dn.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},Dn.prototype.interfaces_=function(){return[]},Dn.prototype.getClass=function(){return Dn},Dn.distance=function(){if(2===arguments.length)return new Dn(arguments[0],arguments[1]).distance();if(3===arguments.length){var t=arguments[2],e=new Dn(arguments[0],arguments[1]);return e.setDensifyFraction(t),e.distance()}},kn.MaxPointDistanceFilter.get=function(){return Nn},kn.MaxDensifiedByFractionDistanceFilter.get=function(){return On},Object.defineProperties(Dn,kn);var Nn=function(){this._maxPtDist=new Ln,this._minPtDist=new Ln,this._euclideanDist=new Rn,this._geom=null;var t=arguments[0];this._geom=t};Nn.prototype.filter=function(t){this._minPtDist.initialize(),Rn.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Nn.prototype.getMaxPointDistance=function(){return this._maxPtDist},Nn.prototype.interfaces_=function(){return[pt]},Nn.prototype.getClass=function(){return Nn};var On=function(){this._maxPtDist=new Ln,this._minPtDist=new Ln,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};On.prototype.filter=function(t,e){if(0===e)return null;for(var i=t.getCoordinate(e-1),n=t.getCoordinate(e),r=(n.x-i.x)/this._numSubSegs,o=(n.y-i.y)/this._numSubSegs,s=0;s<this._numSubSegs;s++){var a=i.x+s*r,l=i.y+s*o,c=new S(a,l);this._minPtDist.initialize(),Rn.computeDistance(this._geom,c,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},On.prototype.isDone=function(){return!1},On.prototype.isGeometryChanged=function(){return!1},On.prototype.getMaxPointDistance=function(){return this._maxPtDist},On.prototype.interfaces_=function(){return[Vt]},On.prototype.getClass=function(){return On};var Fn=function(t,e,i){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=i||null},zn={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Fn.prototype.checkMaximumDistance=function(t,e,i){var n=new Dn(e,t);if(n.setDensifyFraction(.25),this._maxDistanceFound=n.orientedDistance(),this._maxDistanceFound>i){this._isValid=!1;var r=n.getCoordinates();this._errorLocation=r[1],this._errorIndicator=t.getFactory().createLineString(r),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+J.toLineString(r[0],r[1])+")"}},Fn.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=Fn.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Fn.VERBOSE&&H.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Fn.prototype.checkNegativeValid=function(){if(!(this._input instanceof Qt||this._input instanceof ie||this._input instanceof jt))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)},Fn.prototype.getErrorIndicator=function(){return this._errorIndicator},Fn.prototype.checkMinimumDistance=function(t,e,i){var n=new Pn(t,e,i);if(this._minDistanceFound=n.distance(),this._minDistanceFound<i){this._isValid=!1;var r=n.nearestPoints();this._errorLocation=n.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(r),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+J.toLineString(r[0],r[1])+" )"}},Fn.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)},Fn.prototype.getErrorLocation=function(){return this._errorLocation},Fn.prototype.getPolygonLines=function(t){for(var e=new Et,i=new Sn(e),n=En.getPolygons(t).iterator();n.hasNext();)n.next().apply(i);return t.getFactory().buildGeometry(e)},Fn.prototype.getErrorMessage=function(){return this._errMsg},Fn.prototype.interfaces_=function(){return[]},Fn.prototype.getClass=function(){return Fn},zn.VERBOSE.get=function(){return!1},zn.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Fn,zn);var Bn=function(t,e,i){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=i||null},Un={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Bn.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},Bn.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*Bn.MAX_ENV_DIFF_FRAC;0===t&&(t=.001);var e=new q(this._input.getEnvelopeInternal());e.expandBy(this._distance);var i=new q(this._result.getEnvelopeInternal());i.expandBy(t),i.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(i)),this.report("Envelope")},Bn.prototype.checkDistance=function(){var t=new Fn(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")},Bn.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},Bn.prototype.checkPolygonal=function(){this._result instanceof Qt||this._result instanceof ie||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},Bn.prototype.getErrorIndicator=function(){return this._errorIndicator},Bn.prototype.getErrorLocation=function(){return this._errorLocation},Bn.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},Bn.prototype.report=function(t){if(!Bn.VERBOSE)return null;H.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))},Bn.prototype.getErrorMessage=function(){return this._errorMsg},Bn.prototype.interfaces_=function(){return[]},Bn.prototype.getClass=function(){return Bn},Bn.isValidMsg=function(t,e,i){var n=new Bn(t,e,i);return n.isValid()?null:n.getErrorMessage()},Bn.isValid=function(t,e,i){return!!new Bn(t,e,i).isValid()},Un.VERBOSE.get=function(){return!1},Un.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Bn,Un);var Vn=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};Vn.prototype.getCoordinates=function(){return this._pts},Vn.prototype.size=function(){return this._pts.length},Vn.prototype.getCoordinate=function(t){return this._pts[t]},Vn.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},Vn.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:ui.octant(this.getCoordinate(t),this.getCoordinate(t+1))},Vn.prototype.setData=function(t){this._data=t},Vn.prototype.getData=function(){return this._data},Vn.prototype.toString=function(){return J.toLineString(new le(this._pts))},Vn.prototype.interfaces_=function(){return[hi]},Vn.prototype.getClass=function(){return Vn};var jn=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new Et,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};jn.prototype.getInteriorIntersection=function(){return this._interiorIntersection},jn.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t},jn.prototype.getIntersectionSegments=function(){return this._intSegments},jn.prototype.count=function(){return this._intersectionCount},jn.prototype.getIntersections=function(){return this._intersections},jn.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},jn.prototype.setKeepIntersections=function(t){this._keepIntersections=t},jn.prototype.processIntersections=function(t,e,i,n){if(!this._findAllIntersections&&this.hasIntersection())return null;if(t===i&&e===n)return null;if(this._isCheckEndSegmentsOnly&&!this.isEndSegment(t,e)&&!this.isEndSegment(i,n))return null;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[n],a=i.getCoordinates()[n+1];this._li.computeIntersection(r,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=r,this._intSegments[1]=o,this._intSegments[2]=s,this._intSegments[3]=a,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},jn.prototype.isEndSegment=function(t,e){return 0===e||e>=t.size()-2},jn.prototype.hasIntersection=function(){return null!==this._interiorIntersection},jn.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},jn.prototype.interfaces_=function(){return[Xi]},jn.prototype.getClass=function(){return jn},jn.createAllIntersectionsFinder=function(t){var e=new jn(t);return e.setFindAllIntersections(!0),e},jn.createAnyIntersectionFinder=function(t){return new jn(t)},jn.createIntersectionCounter=function(t){var e=new jn(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var Gn=function(){this._li=new rt,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};Gn.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},Gn.prototype.getIntersections=function(){return this._segInt.getIntersections()},Gn.prototype.isValid=function(){return this.execute(),this._isValid},Gn.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},Gn.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new jn(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new bi;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},Gn.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Ce(this.getErrorMessage(),this._segInt.getInteriorIntersection())},Gn.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+J.toLineString(t[0],t[1])+" and "+J.toLineString(t[2],t[3])},Gn.prototype.interfaces_=function(){return[]},Gn.prototype.getClass=function(){return Gn},Gn.computeIntersections=function(t){var e=new Gn(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var Hn=function t(){this._nv=null;var e=arguments[0];this._nv=new Gn(t.toSegmentStrings(e))};Hn.prototype.checkValid=function(){this._nv.checkValid()},Hn.prototype.interfaces_=function(){return[]},Hn.prototype.getClass=function(){return Hn},Hn.toSegmentStrings=function(t){for(var e=new Et,i=t.iterator();i.hasNext();){var n=i.next();e.add(new Vn(n.getCoordinates(),n))}return e},Hn.checkValid=function(t){new Hn(t).checkValid()};var Wn=function(t){this._mapOp=t};Wn.prototype.map=function(t){for(var e=new Et,i=0;i<t.getNumGeometries();i++){var n=this._mapOp.map(t.getGeometryN(i));n.isEmpty()||e.add(n)}return t.getFactory().createGeometryCollection(_e.toGeometryArray(e))},Wn.prototype.interfaces_=function(){return[]},Wn.prototype.getClass=function(){return Wn},Wn.map=function(t,e){return new Wn(e).map(t)};var qn=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new Et,this._resultLineList=new Et;var t=arguments[0],e=arguments[1],i=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=i};qn.prototype.collectLines=function(t){for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var i=e.next();this.collectLineEdge(i,t,this._lineEdgesList),this.collectBoundaryTouchEdge(i,t,this._lineEdgesList)}},qn.prototype.labelIsolatedLine=function(t,e){var i=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,i)},qn.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList},qn.prototype.collectLineEdge=function(t,e,i){var n=t.getLabel(),r=t.getEdge();t.isLineEdge()&&(t.isVisited()||!Mr.isResultOfOp(n,e)||r.isCovered()||(i.add(r),t.setVisitedEdge(!0)))},qn.prototype.findCoveredLineEdges=function(){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();)t.next().getEdges().findCoveredLineEdges();for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var i=e.next(),n=i.getEdge();if(i.isLineEdge()&&!n.isCoveredSet()){var r=this._op.isCoveredByA(i.getCoordinate());n.setCovered(r)}}},qn.prototype.labelIsolatedLines=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next(),n=i.getLabel();i.isIsolated()&&(n.isNull(0)?this.labelIsolatedLine(i,0):this.labelIsolatedLine(i,1))}},qn.prototype.buildLines=function(t){for(var e=this._lineEdgesList.iterator();e.hasNext();){var i=e.next(),n=this._geometryFactory.createLineString(i.getCoordinates());this._resultLineList.add(n),i.setInResult(!0)}},qn.prototype.collectBoundaryTouchEdge=function(t,e,i){var n=t.getLabel();return t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult()?null:(et.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(Mr.isResultOfOp(n,e)&&e===Mr.INTERSECTION&&(i.add(t.getEdge()),t.setVisitedEdge(!0))))},qn.prototype.interfaces_=function(){return[]},qn.prototype.getClass=function(){return qn};var Xn=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new Et;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};Xn.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var i=this._geometryFactory.createPoint(e);this._resultPointList.add(i)}},Xn.prototype.extractNonCoveredResultNodes=function(t){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();){var i=e.next();if(!(i.isInResult()||i.isIncidentEdgeInResult()||0!==i.getEdges().getDegree()&&t!==Mr.INTERSECTION)){var n=i.getLabel();Mr.isResultOfOp(n,t)&&this.filterCoveredNodeToPoint(i)}}},Xn.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList},Xn.prototype.interfaces_=function(){return[]},Xn.prototype.getClass=function(){return Xn};var $n=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};$n.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},$n.prototype.transformPolygon=function(t,e){var i=!0,n=this.transformLinearRing(t.getExteriorRing(),t);null!==n&&n instanceof ee&&!n.isEmpty()||(i=!1);for(var r=new Et,o=0;o<t.getNumInteriorRing();o++){var s=this.transformLinearRing(t.getInteriorRingN(o),t);null===s||s.isEmpty()||(s instanceof ee||(i=!1),r.add(s))}if(i)return this._factory.createPolygon(n,r.toArray([]));var a=new Et;return null!==n&&a.add(n),a.addAll(r),this._factory.buildGeometry(a)},$n.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)},$n.prototype.getInputGeometry=function(){return this._inputGeom},$n.prototype.transformMultiLineString=function(t,e){for(var i=new Et,n=0;n<t.getNumGeometries();n++){var r=this.transformLineString(t.getGeometryN(n),t);null!==r&&(r.isEmpty()||i.add(r))}return this._factory.buildGeometry(i)},$n.prototype.transformCoordinates=function(t,e){return this.copy(t)},$n.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},$n.prototype.transformMultiPoint=function(t,e){for(var i=new Et,n=0;n<t.getNumGeometries();n++){var r=this.transformPoint(t.getGeometryN(n),t);null!==r&&(r.isEmpty()||i.add(r))}return this._factory.buildGeometry(i)},$n.prototype.transformMultiPolygon=function(t,e){for(var i=new Et,n=0;n<t.getNumGeometries();n++){var r=this.transformPolygon(t.getGeometryN(n),t);null!==r&&(r.isEmpty()||i.add(r))}return this._factory.buildGeometry(i)},$n.prototype.copy=function(t){return t.copy()},$n.prototype.transformGeometryCollection=function(t,e){for(var i=new Et,n=0;n<t.getNumGeometries();n++){var r=this.transform(t.getGeometryN(n));null!==r&&(this._pruneEmptyGeometry&&r.isEmpty()||i.add(r))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(_e.toGeometryArray(i)):this._factory.buildGeometry(i)},$n.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof Kt)return this.transformPoint(t,null);if(t instanceof te)return this.transformMultiPoint(t,null);if(t instanceof ee)return this.transformLinearRing(t,null);if(t instanceof Yt)return this.transformLineString(t,null);if(t instanceof Gt)return this.transformMultiLineString(t,null);if(t instanceof Qt)return this.transformPolygon(t,null);if(t instanceof ie)return this.transformMultiPolygon(t,null);if(t instanceof jt)return this.transformGeometryCollection(t,null);throw new y("Unknown Geometry subtype: "+t.getClass().getName())},$n.prototype.transformLinearRing=function(t,e){var i=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===i)return this._factory.createLinearRing(null);var n=i.size();return n>0&&n<4&&!this._preserveType?this._factory.createLineString(i):this._factory.createLinearRing(i)},$n.prototype.interfaces_=function(){return[]},$n.prototype.getClass=function(){return $n};var Yn=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new fi,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Yt&&"number"==typeof arguments[1]){var e=arguments[1];t.call(this,arguments[0].getCoordinates(),e)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var i=arguments[0],n=arguments[1];this._srcPts=i,this._isClosed=t.isClosed(i),this._snapTolerance=n}};Yn.prototype.snapVertices=function(t,e){for(var i=this._isClosed?t.size()-1:t.size(),n=0;n<i;n++){var r=t.get(n),o=this.findSnapForVertex(r,e);null!==o&&(t.set(n,new S(o)),0===n&&this._isClosed&&t.set(t.size()-1,new S(o)))}},Yn.prototype.findSnapForVertex=function(t,e){for(var i=0;i<e.length;i++){if(t.equals2D(e[i]))return null;if(t.distance(e[i])<this._snapTolerance)return e[i]}return null},Yn.prototype.snapTo=function(t){var e=new Tt(this._srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},Yn.prototype.snapSegments=function(t,e){if(0===e.length)return null;var i=e.length;e[0].equals2D(e[e.length-1])&&(i=e.length-1);for(var n=0;n<i;n++){var r=e[n],o=this.findSegmentIndexToSnap(r,t);o>=0&&t.add(o+1,new S(r),!1)}},Yn.prototype.findSegmentIndexToSnap=function(t,e){for(var i=v.MAX_VALUE,n=-1,r=0;r<e.size()-1;r++){if(this._seg.p0=e.get(r),this._seg.p1=e.get(r+1),this._seg.p0.equals2D(t)||this._seg.p1.equals2D(t)){if(this._allowSnappingToSourceVertices)continue;return-1}var o=this._seg.distance(t);o<this._snapTolerance&&o<i&&(i=o,n=r)}return n},Yn.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t},Yn.prototype.interfaces_=function(){return[]},Yn.prototype.getClass=function(){return Yn},Yn.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])};var Zn=function(t){this._srcGeom=t||null},Kn={SNAP_PRECISION_FACTOR:{configurable:!0}};Zn.prototype.snapTo=function(t,e){var i=this.extractTargetCoordinates(t);return new Jn(e,i).transform(this._srcGeom)},Zn.prototype.snapToSelf=function(t,e){var i=this.extractTargetCoordinates(this._srcGeom),n=new Jn(t,i,!0).transform(this._srcGeom),r=n;return e&&P(r,Jt)&&(r=n.buffer(0)),r},Zn.prototype.computeSnapTolerance=function(t){return this.computeMinimumSegmentLength(t)/10},Zn.prototype.extractTargetCoordinates=function(t){for(var e=new p,i=t.getCoordinates(),n=0;n<i.length;n++)e.add(i[n]);return e.toArray(new Array(0).fill(null))},Zn.prototype.computeMinimumSegmentLength=function(t){for(var e=v.MAX_VALUE,i=0;i<t.length-1;i++){var n=t[i].distance(t[i+1]);n<e&&(e=n)}return e},Zn.prototype.interfaces_=function(){return[]},Zn.prototype.getClass=function(){return Zn},Zn.snap=function(t,e,i){var n=new Array(2).fill(null),r=new Zn(t);n[0]=r.snapTo(e,i);var o=new Zn(e);return n[1]=o.snapTo(n[0],i),n},Zn.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=Zn.computeSizeBasedSnapTolerance(t),i=t.getPrecisionModel();if(i.getType()===pe.FIXED){var n=1/i.getScale()*2/1.415;n>e&&(e=n)}return e}if(2===arguments.length){var r=arguments[0],o=arguments[1];return Math.min(Zn.computeOverlaySnapTolerance(r),Zn.computeOverlaySnapTolerance(o))}},Zn.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*Zn.SNAP_PRECISION_FACTOR},Zn.snapToSelf=function(t,e,i){return new Zn(t).snapToSelf(e,i)},Kn.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(Zn,Kn);var Jn=function(t){function e(e,i,n){t.call(this),this._snapTolerance=e||null,this._snapPts=i||null,this._isSelfSnap=void 0!==n&&n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(t,e){var i=new Yn(t,this._snapTolerance);return i.setAllowSnappingToSourceVertices(this._isSelfSnap),i.snapTo(e)},e.prototype.transformCoordinates=function(t,e){var i=t.toCoordinateArray(),n=this.snapLine(i,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}($n),Qn=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Qn.prototype.getCommon=function(){return v.longBitsToDouble(this._commonBits)},Qn.prototype.add=function(t){var e=v.doubleToLongBits(t);return this._isFirst?(this._commonBits=e,this._commonSignExp=Qn.signExpBits(this._commonBits),this._isFirst=!1,null):Qn.signExpBits(e)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=Qn.numCommonMostSigMantissaBits(this._commonBits,e),void(this._commonBits=Qn.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},Qn.prototype.toString=function(){if(1===arguments.length){var t=arguments[0],e=v.longBitsToDouble(t),i="0000000000000000000000000000000000000000000000000000000000000000"+v.toBinaryString(t),n=i.substring(i.length-64);return n.substring(0,1)+"  "+n.substring(1,12)+"(exp) "+n.substring(12)+" [ "+e+" ]"}},Qn.prototype.interfaces_=function(){return[]},Qn.prototype.getClass=function(){return Qn},Qn.getBit=function(t,e){return t&1<<e?1:0},Qn.signExpBits=function(t){return t>>52},Qn.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},Qn.numCommonMostSigMantissaBits=function(t,e){for(var i=0,n=52;n>=0;n--){if(Qn.getBit(t,n)!==Qn.getBit(e,n))return i;i++}return 52};var tr=function(){this._commonCoord=null,this._ccFilter=new ir},er={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};tr.prototype.addCommonBits=function(t){var e=new nr(this._commonCoord);t.apply(e),t.geometryChanged()},tr.prototype.removeCommonBits=function(t){if(0===this._commonCoord.x&&0===this._commonCoord.y)return t;var e=new S(this._commonCoord);e.x=-e.x,e.y=-e.y;var i=new nr(e);return t.apply(i),t.geometryChanged(),t},tr.prototype.getCommonCoordinate=function(){return this._commonCoord},tr.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},tr.prototype.interfaces_=function(){return[]},tr.prototype.getClass=function(){return tr},er.CommonCoordinateFilter.get=function(){return ir},er.Translater.get=function(){return nr},Object.defineProperties(tr,er);var ir=function(){this._commonBitsX=new Qn,this._commonBitsY=new Qn};ir.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)},ir.prototype.getCommonCoordinate=function(){return new S(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},ir.prototype.interfaces_=function(){return[pt]},ir.prototype.getClass=function(){return ir};var nr=function(){this.trans=null;var t=arguments[0];this.trans=t};nr.prototype.filter=function(t,e){var i=t.getOrdinate(e,0)+this.trans.x,n=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,i),t.setOrdinate(e,1,n)},nr.prototype.isDone=function(){return!1},nr.prototype.isGeometryChanged=function(){return!0},nr.prototype.interfaces_=function(){return[Vt]},nr.prototype.getClass=function(){return nr};var rr=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};rr.prototype.selfSnap=function(t){return new Zn(t).snapTo(t,this._snapTolerance)},rr.prototype.removeCommonBits=function(t){this._cbr=new tr,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e},rr.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t},rr.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),i=Mr.overlayOp(e[0],e[1],t);return this.prepareResult(i)},rr.prototype.checkValid=function(t){t.isValid()||H.out.println("Snapped geometry is invalid")},rr.prototype.computeSnapTolerance=function(){this._snapTolerance=Zn.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},rr.prototype.snap=function(t){var e=this.removeCommonBits(t);return Zn.snap(e[0],e[1],this._snapTolerance)},rr.prototype.interfaces_=function(){return[]},rr.prototype.getClass=function(){return rr},rr.overlayOp=function(t,e,i){return new rr(t,e).getResultGeometry(i)},rr.union=function(t,e){return rr.overlayOp(t,e,Mr.UNION)},rr.intersection=function(t,e){return rr.overlayOp(t,e,Mr.INTERSECTION)},rr.symDifference=function(t,e){return rr.overlayOp(t,e,Mr.SYMDIFFERENCE)},rr.difference=function(t,e){return rr.overlayOp(t,e,Mr.DIFFERENCE)};var or=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};or.prototype.getResultGeometry=function(t){var e=null,i=!1,n=null;try{e=Mr.overlayOp(this._geom[0],this._geom[1],t),i=!0}catch(t){if(!(t instanceof Q))throw t;n=t}if(!i)try{e=rr.overlayOp(this._geom[0],this._geom[1],t)}catch(t){throw t instanceof Q?n:t}return e},or.prototype.interfaces_=function(){return[]},or.prototype.getClass=function(){return or},or.overlayOp=function(t,e,i){return new or(t,e).getResultGeometry(i)},or.union=function(t,e){return or.overlayOp(t,e,Mr.UNION)},or.intersection=function(t,e){return or.overlayOp(t,e,Mr.INTERSECTION)},or.symDifference=function(t,e){return or.overlayOp(t,e,Mr.SYMDIFFERENCE)},or.difference=function(t,e){return or.overlayOp(t,e,Mr.DIFFERENCE)};var sr=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};sr.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},sr.prototype.interfaces_=function(){return[]},sr.prototype.getClass=function(){return sr};var ar=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var e=arguments[0],i=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=i}else if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2];this._eventType=t.INSERT,this._label=n,this._xValue=r,this._obj=o}},lr={INSERT:{configurable:!0},DELETE:{configurable:!0}};ar.prototype.isDelete=function(){return this._eventType===ar.DELETE},ar.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t},ar.prototype.getObject=function(){return this._obj},ar.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0},ar.prototype.getInsertEvent=function(){return this._insertEvent},ar.prototype.isInsert=function(){return this._eventType===ar.INSERT},ar.prototype.isSameLabel=function(t){return null!==this._label&&this._label===t._label},ar.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},ar.prototype.interfaces_=function(){return[b]},ar.prototype.getClass=function(){return ar},lr.INSERT.get=function(){return 1},lr.DELETE.get=function(){return 2},Object.defineProperties(ar,lr);var cr=function(){};cr.prototype.interfaces_=function(){return[]},cr.prototype.getClass=function(){return cr};var ur=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],i=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=i};ur.prototype.isTrivialIntersection=function(t,e,i,n){if(t===i&&1===this._li.getIntersectionNum()){if(ur.isAdjacentSegments(e,n))return!0;if(t.isClosed()){var r=t.getNumPoints()-1;if(0===e&&n===r||0===n&&e===r)return!0}}return!1},ur.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},ur.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t},ur.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},ur.prototype.isBoundaryPointInternal=function(t,e){for(var i=e.iterator();i.hasNext();){var n=i.next().getCoordinate();if(t.isIntersection(n))return!0}return!1},ur.prototype.hasProperIntersection=function(){return this._hasProper},ur.prototype.hasIntersection=function(){return this._hasIntersection},ur.prototype.isDone=function(){return this._isDone},ur.prototype.isBoundaryPoint=function(t,e){return!(null===e||!this.isBoundaryPointInternal(t,e[0])&&!this.isBoundaryPointInternal(t,e[1]))},ur.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e},ur.prototype.addIntersections=function(t,e,i,n){if(t===i&&e===n)return null;this.numTests++;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[n],a=i.getCoordinates()[n+1];this._li.computeIntersection(r,o,s,a),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),i.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,i,n)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(t.addIntersections(this._li,e,0),i.addIntersections(this._li,n,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},ur.prototype.interfaces_=function(){return[]},ur.prototype.getClass=function(){return ur},ur.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var hr=function(t){function e(){t.call(this),this.events=new Et,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){Qe.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},e.prototype.computeIntersections=function(){if(1===arguments.length){var t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var e=0;e<this.events.size();e++){var i=this.events.get(e);if(i.isInsert()&&this.processOverlaps(e,i.getDeleteEventIndex(),i,t),t.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof ur&&P(arguments[0],wt)&&P(arguments[1],wt)){var n=arguments[0],r=arguments[1],o=arguments[2];this.addEdges(n,n),this.addEdges(r,r),this.computeIntersections(o)}else if("boolean"==typeof arguments[2]&&P(arguments[0],wt)&&arguments[1]instanceof ur){var s=arguments[0],a=arguments[1];arguments[2]?this.addEdges(s,null):this.addEdges(s),this.computeIntersections(a)}},e.prototype.addEdge=function(t,e){for(var i=t.getMonotoneChainEdge(),n=i.getStartIndexes(),r=0;r<n.length-1;r++){var o=new sr(i,r),s=new ar(e,i.getMinX(r),o);this.events.add(s),this.events.add(new ar(i.getMaxX(r),s))}},e.prototype.processOverlaps=function(t,e,i,n){for(var r=i.getObject(),o=t;o<e;o++){var s=this.events.get(o);if(s.isInsert()){var a=s.getObject();i.isSameLabel(s)||(r.computeIntersections(a,n),this.nOverlaps++)}}},e.prototype.addEdges=function(){if(1===arguments.length)for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.addEdge(e,e)}else if(2===arguments.length)for(var i=arguments[1],n=arguments[0].iterator();n.hasNext();){var r=n.next();this.addEdge(r,i)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(cr),dr=function(){this._min=v.POSITIVE_INFINITY,this._max=v.NEGATIVE_INFINITY},pr={NodeComparator:{configurable:!0}};dr.prototype.getMin=function(){return this._min},dr.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)},dr.prototype.getMax=function(){return this._max},dr.prototype.toString=function(){return J.toLineString(new S(this._min,0),new S(this._max,0))},dr.prototype.interfaces_=function(){return[]},dr.prototype.getClass=function(){return dr},pr.NodeComparator.get=function(){return fr},Object.defineProperties(dr,pr);var fr=function(){};fr.prototype.compare=function(t,e){var i=t,n=e,r=(i._min+i._max)/2,o=(n._min+n._max)/2;return r<o?-1:r>o?1:0},fr.prototype.interfaces_=function(){return[E]},fr.prototype.getClass=function(){return fr};var mr=function(t){function e(){t.call(this),this._item=null;var e=arguments[0],i=arguments[1],n=arguments[2];this._min=e,this._max=i,this._item=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(t,e,i){if(!this.intersects(t,e))return null;i.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(dr),gr=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var e=arguments[0],i=arguments[1];this._node1=e,this._node2=i,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(t,e){this._min=Math.min(t._min,e._min),this._max=Math.max(t._max,e._max)},e.prototype.query=function(t,e,i){if(!this.intersects(t,e))return null;null!==this._node1&&this._node1.query(t,e,i),null!==this._node2&&this._node2.query(t,e,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(dr),_r=function(){this._leaves=new Et,this._root=null,this._level=0};_r.prototype.buildTree=function(){Qe.sort(this._leaves,new dr.NodeComparator);for(var t=this._leaves,e=null,i=new Et;;){if(this.buildLevel(t,i),1===i.size())return i.get(0);e=t,t=i,i=e}},_r.prototype.insert=function(t,e,i){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new mr(t,e,i))},_r.prototype.query=function(t,e,i){this.init(),this._root.query(t,e,i)},_r.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},_r.prototype.printNode=function(t){H.out.println(J.toLineString(new S(t._min,this._level),new S(t._max,this._level)))},_r.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},_r.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var i=0;i<t.size();i+=2){var n=t.get(i);if(null===(i+1<t.size()?t.get(i):null))e.add(n);else{var r=new gr(t.get(i),t.get(i+1));e.add(r)}}},_r.prototype.interfaces_=function(){return[]},_r.prototype.getClass=function(){return _r};var yr=function(){this._items=new Et};yr.prototype.visitItem=function(t){this._items.add(t)},yr.prototype.getItems=function(){return this._items},yr.prototype.interfaces_=function(){return[Ye]},yr.prototype.getClass=function(){return yr};var vr=function(){this._index=null;var t=arguments[0];if(!P(t,Jt))throw new y("Argument must be Polygonal");this._index=new wr(t)},xr={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};vr.prototype.locate=function(t){var e=new st(t),i=new br(e);return this._index.query(t.y,t.y,i),e.getLocation()},vr.prototype.interfaces_=function(){return[Bi]},vr.prototype.getClass=function(){return vr},xr.SegmentVisitor.get=function(){return br},xr.IntervalIndexedGeometry.get=function(){return wr},Object.defineProperties(vr,xr);var br=function(){this._counter=null;var t=arguments[0];this._counter=t};br.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},br.prototype.interfaces_=function(){return[Ye]},br.prototype.getClass=function(){return br};var wr=function(){this._index=new _r;var t=arguments[0];this.init(t)};wr.prototype.init=function(t){for(var e=Sn.getLines(t).iterator();e.hasNext();){var i=e.next().getCoordinates();this.addLine(i)}},wr.prototype.addLine=function(t){for(var e=1;e<t.length;e++){var i=new fi(t[e-1],t[e]),n=Math.min(i.p0.y,i.p1.y),r=Math.max(i.p0.y,i.p1.y);this._index.insert(n,r,i)}},wr.prototype.query=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],i=new yr;return this._index.query(t,e,i),i.getItems()}if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2];this._index.query(n,r,o)}},wr.prototype.interfaces_=function(){return[]},wr.prototype.getClass=function(){return wr};var Er=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new de,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Tn,2===arguments.length){var e=arguments[0],i=arguments[1],n=ft.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=i,this._boundaryNodeRule=n,null!==i&&this.add(i)}else if(3===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2];this._argIndex=r,this._parentGeom=o,this._boundaryNodeRule=s,null!==o&&this.add(o)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(t,i){var n=this._nodes.addNode(i).getLabel(),r=1;n.getLocation(t,Te.ON)===C.BOUNDARY&&r++;var o=e.determineBoundary(this._boundaryNodeRule,r);n.setLocation(t,o)},e.prototype.computeSelfNodes=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var i=arguments[1],n=arguments[2],r=new ur(arguments[0],!0,!1);r.setIsDoneIfProperInt(n);var o=this.createEdgeSetIntersector(),s=this._parentGeom instanceof ee||this._parentGeom instanceof Qt||this._parentGeom instanceof ie,a=i||!s;return o.computeIntersections(this._edges,r,a),this.addSelfIntersectionNodes(this._argIndex),r}},e.prototype.computeSplitEdges=function(t){for(var e=this._edges.iterator();e.hasNext();)e.next().eiList.addSplitEdges(t)},e.prototype.computeEdgeIntersections=function(t,e,i){var n=new ur(e,i,!0);return n.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,t._edges,n),n},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof Kt){var t=arguments[0].getCoordinate();this.insertPoint(this._argIndex,t,C.INTERIOR)}else if(arguments[0]instanceof S){var e=arguments[0];this.insertPoint(this._argIndex,e,C.INTERIOR)}},e.prototype.addPolygon=function(t){this.addPolygonRing(t.getExteriorRing(),C.EXTERIOR,C.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var i=t.getInteriorRingN(e);this.addPolygonRing(i,C.INTERIOR,C.EXTERIOR)}},e.prototype.addEdge=function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this._argIndex,e[0],C.BOUNDARY),this.insertPoint(this._argIndex,e[e.length-1],C.BOUNDARY)},e.prototype.addLineString=function(t){var e=Mt.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=e[0],null;var i=new en(e,new Re(this._argIndex,C.INTERIOR));this._lineEdgeMap.put(t,i),this.insertEdge(i),et.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,e[0]),this.insertBoundaryPoint(this._argIndex,e[e.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),i=0,n=t.iterator();n.hasNext();){var r=n.next();e[i++]=r.getCoordinate().copy()}return e},e.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(t,e,i){if(this.isBoundaryNode(t,e))return null;i===C.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,i)},e.prototype.addPolygonRing=function(t,e,i){if(t.isEmpty())return null;var n=Mt.removeRepeatedPoints(t.getCoordinates());if(n.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=n[0],null;var r=e,o=i;at.isCCW(n)&&(r=i,o=e);var s=new en(n,new Re(this._argIndex,C.BOUNDARY,r,o));this._lineEdgeMap.put(t,s),this.insertEdge(s),this.insertPoint(this._argIndex,n[0],C.BOUNDARY)},e.prototype.insertPoint=function(t,e,i){var n=this._nodes.addNode(e),r=n.getLabel();null===r?n._label=new Re(t,i):r.setLocation(t,i)},e.prototype.createEdgeSetIntersector=function(){return new hr},e.prototype.addSelfIntersectionNodes=function(t){for(var e=this._edges.iterator();e.hasNext();)for(var i=e.next(),n=i.getLabel().getLocation(t),r=i.eiList.iterator();r.hasNext();){var o=r.next();this.addSelfIntersectionNode(t,o.coord,n)}},e.prototype.add=function(){if(1!==arguments.length)return t.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof ie&&(this._useBoundaryDeterminationRule=!1),e instanceof Qt)this.addPolygon(e);else if(e instanceof Yt)this.addLineString(e);else if(e instanceof Kt)this.addPoint(e);else if(e instanceof te)this.addCollection(e);else if(e instanceof Gt)this.addCollection(e);else if(e instanceof ie)this.addCollection(e);else{if(!(e instanceof jt))throw new Error(e.getClass().getName());this.addCollection(e)}},e.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var i=t.getGeometryN(e);this.add(i)}},e.prototype.locate=function(t){return P(this._parentGeom,Jt)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new vr(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)},e.prototype.findEdge=function(){if(1===arguments.length){var e=arguments[0];return this._lineEdgeMap.get(e)}return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(t,e){return t.isInBoundary(e)?C.BOUNDARY:C.INTERIOR},e}(He),Sr=function(){if(this._li=new rt,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Er(0,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1],n=ft.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(i.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(i.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Er(0,e,n),this._arg[1]=new Er(1,i,n)}else if(3===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2];r.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(r.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Er(0,r,s),this._arg[1]=new Er(1,o,s)}};Sr.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()},Sr.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)},Sr.prototype.interfaces_=function(){return[]},Sr.prototype.getClass=function(){return Sr};var Tr=function(){};Tr.prototype.interfaces_=function(){return[]},Tr.prototype.getClass=function(){return Tr},Tr.map=function(){if(arguments[0]instanceof ut&&P(arguments[1],Tr.MapOp)){for(var t=arguments[0],e=arguments[1],i=new Et,n=0;n<t.getNumGeometries();n++){var r=e.map(t.getGeometryN(n));null!==r&&i.add(r)}return t.getFactory().buildGeometry(i)}if(P(arguments[0],xt)&&P(arguments[1],Tr.MapOp)){for(var o=arguments[0],s=arguments[1],a=new Et,l=o.iterator();l.hasNext();){var c=l.next(),u=s.map(c);null!==u&&a.add(u)}return a}},Tr.MapOp=function(){};var Mr=function(t){function e(){var e=arguments[0],i=arguments[1];t.call(this,e,i),this._ptLocator=new Tn,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new qi,this._resultPolyList=new Et,this._resultLineList=new Et,this._resultPointList=new Et,this._graph=new He(new Hi),this._geomFact=e.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var i=e.getLabel(),n=t.getLabel();e.isPointwiseEqual(t)||(n=new Re(t.getLabel())).flip();var r=e.getDepth();r.isNull()&&r.add(i),r.add(n),i.merge(n)}else this._edgeList.add(t)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),i=e.getSym();e.isInResult()&&i.isInResult()&&(e.setInResult(!1),i.setInResult(!1))}},e.prototype.isCoveredByLA=function(t){return!!this.isCovered(t,this._resultLineList)||!!this.isCovered(t,this._resultPolyList)},e.prototype.computeGeometry=function(t,i,n,r){var o=new Et;return o.addAll(t),o.addAll(i),o.addAll(n),o.isEmpty()?e.createEmptyResult(r,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(o)},e.prototype.mergeSymLabels=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().mergeSymLabels()},e.prototype.isCovered=function(t,e){for(var i=e.iterator();i.hasNext();){var n=i.next();if(this._ptLocator.locate(t,n)!==C.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var t=new Et,e=this._edgeList.iterator();e.hasNext();){var i=e.next();i.isCollapsed()&&(e.remove(),t.add(i.getCollapsedEdge()))}this._edgeList.addAll(t)},e.prototype.updateNodeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),i=e.getEdges().getLabel();e.getLabel().merge(i)}},e.prototype.getResultGeometry=function(t){return this.computeOverlay(t),this._resultGeom},e.prototype.insertUniqueEdges=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next();this.insertUniqueEdge(i)}},e.prototype.computeOverlay=function(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var e=new Et;this._arg[0].computeSplitEdges(e),this._arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Hn.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var i=new We(this._geomFact);i.add(this._graph),this._resultPolyList=i.getPolygons();var n=new qn(this,this._geomFact,this._ptLocator);this._resultLineList=n.build(t);var r=new Xn(this,this._geomFact,this._ptLocator);this._resultPointList=r.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)},e.prototype.labelIncompleteNode=function(t,e){var i=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setLocation(e,i)},e.prototype.copyPoints=function(t){for(var e=this._arg[t].getNodeIterator();e.hasNext();){var i=e.next();this._graph.addNode(i.getCoordinate()).setLabel(t,i.getLabel().getLocation(t))}},e.prototype.findResultAreaEdges=function(t){for(var i=this._graph.getEdgeEnds().iterator();i.hasNext();){var n=i.next(),r=n.getLabel();r.isArea()&&!n.isInteriorAreaEdge()&&e.isResultOfOp(r.getLocation(0,Te.RIGHT),r.getLocation(1,Te.RIGHT),t)&&n.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var t=this._edgeList.iterator();t.hasNext();){var e=t.next(),i=e.getLabel(),n=e.getDepth();if(!n.isNull()){n.normalize();for(var r=0;r<2;r++)i.isNull(r)||!i.isArea()||n.isNull(r)||(0===n.getDelta(r)?i.toLine(r):(et.isTrue(!n.isNull(r,Te.LEFT),"depth of LEFT side has not been initialized"),i.setLocation(r,Te.LEFT,n.getLocation(r,Te.LEFT)),et.isTrue(!n.isNull(r,Te.RIGHT),"depth of RIGHT side has not been initialized"),i.setLocation(r,Te.RIGHT,n.getLocation(r,Te.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),i=e.getLabel();e.isIsolated()&&(i.isNull(0)?this.labelIncompleteNode(e,0):this.labelIncompleteNode(e,1)),e.getEdges().updateLabelling(i)}},e.prototype.isCoveredByA=function(t){return!!this.isCovered(t,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Sr);Mr.overlayOp=function(t,e,i){return new Mr(t,e).getResultGeometry(i)},Mr.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return Mr.createEmptyResult(Mr.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var i=e;return Wn.map(t,{interfaces_:function(){return[Tr.MapOp]},map:function(t){return t.intersection(i)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),or.overlayOp(t,e,Mr.INTERSECTION)},Mr.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Mr.createEmptyResult(Mr.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),or.overlayOp(t,e,Mr.SYMDIFFERENCE)},Mr.resultDimension=function(t,e,i){var n=e.getDimension(),r=i.getDimension(),o=-1;switch(t){case Mr.INTERSECTION:o=Math.min(n,r);break;case Mr.UNION:o=Math.max(n,r);break;case Mr.DIFFERENCE:o=n;break;case Mr.SYMDIFFERENCE:o=Math.max(n,r)}return o},Mr.createEmptyResult=function(t,e,i,n){var r=null;switch(Mr.resultDimension(t,e,i)){case-1:r=n.createGeometryCollection(new Array(0).fill(null));break;case 0:r=n.createPoint();break;case 1:r=n.createLineString();break;case 2:r=n.createPolygon()}return r},Mr.difference=function(t,e){return t.isEmpty()?Mr.createEmptyResult(Mr.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),or.overlayOp(t,e,Mr.DIFFERENCE))},Mr.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],i=t.getLocation(0),n=t.getLocation(1);return Mr.isResultOfOp(i,n,e)}if(3===arguments.length){var r=arguments[0],o=arguments[1];switch(r===C.BOUNDARY&&(r=C.INTERIOR),o===C.BOUNDARY&&(o=C.INTERIOR),arguments[2]){case Mr.INTERSECTION:return r===C.INTERIOR&&o===C.INTERIOR;case Mr.UNION:return r===C.INTERIOR||o===C.INTERIOR;case Mr.DIFFERENCE:return r===C.INTERIOR&&o!==C.INTERIOR;case Mr.SYMDIFFERENCE:return r===C.INTERIOR&&o!==C.INTERIOR||r!==C.INTERIOR&&o===C.INTERIOR}return!1}},Mr.INTERSECTION=1,Mr.UNION=2,Mr.DIFFERENCE=3,Mr.SYMDIFFERENCE=4;var Ir=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Tn,this._seg=new fi;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};Ir.prototype.isWithinToleranceOfBoundary=function(t){for(var e=0;e<this._linework.getNumGeometries();e++)for(var i=this._linework.getGeometryN(e).getCoordinateSequence(),n=0;n<i.size()-1;n++)if(i.getCoordinate(n,this._seg.p0),i.getCoordinate(n+1,this._seg.p1),this._seg.distance(t)<=this._boundaryDistanceTolerance)return!0;return!1},Ir.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?C.BOUNDARY:this._ptLocator.locate(t,this._g)},Ir.prototype.extractLinework=function(t){var e=new Cr;t.apply(e);var i=e.getLinework(),n=_e.toLineStringArray(i);return t.getFactory().createMultiLineString(n)},Ir.prototype.interfaces_=function(){return[]},Ir.prototype.getClass=function(){return Ir};var Cr=function(){this._linework=null,this._linework=new Et};Cr.prototype.getLinework=function(){return this._linework},Cr.prototype.filter=function(t){if(t instanceof Qt){var e=t;this._linework.add(e.getExteriorRing());for(var i=0;i<e.getNumInteriorRing();i++)this._linework.add(e.getInteriorRingN(i))}},Cr.prototype.interfaces_=function(){return[Ut]},Cr.prototype.getClass=function(){return Cr};var Ar=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};Ar.prototype.extractPoints=function(t,e,i){for(var n=t.getCoordinates(),r=0;r<n.length-1;r++)this.computeOffsetPoints(n[r],n[r+1],e,i)},Ar.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e},Ar.prototype.getPoints=function(t){for(var e=new Et,i=Sn.getLines(this._g).iterator();i.hasNext();){var n=i.next();this.extractPoints(n,t,e)}return e},Ar.prototype.computeOffsetPoints=function(t,e,i,n){var r=e.x-t.x,o=e.y-t.y,s=Math.sqrt(r*r+o*o),a=i*r/s,l=i*o/s,c=(e.x+t.x)/2,u=(e.y+t.y)/2;if(this._doLeft){var h=new S(c-l,u+a);n.add(h)}if(this._doRight){var d=new S(c+l,u-a);n.add(d)}},Ar.prototype.interfaces_=function(){return[]},Ar.prototype.getClass=function(){return Ar};var Pr=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new Et;var e=arguments[0],i=arguments[1],n=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,i),this._geom=[e,i,n],this._locFinder=[new Ir(this._geom[0],this._boundaryDistanceTolerance),new Ir(this._geom[1],this._boundaryDistanceTolerance),new Ir(this._geom[2],this._boundaryDistanceTolerance)]},Lr={TOLERANCE:{configurable:!0}};Pr.prototype.reportResult=function(t,e,i){H.out.println("Overlay result invalid - A:"+C.toLocationSymbol(e[0])+" B:"+C.toLocationSymbol(e[1])+" expected:"+(i?"i":"e")+" actual:"+C.toLocationSymbol(e[2]))},Pr.prototype.isValid=function(t){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(t)},Pr.prototype.checkValid=function(){if(1===arguments.length){for(var t=arguments[0],e=0;e<this._testCoords.size();e++){var i=this._testCoords.get(e);if(!this.checkValid(t,i))return this._invalidLocation=i,!1}return!0}if(2===arguments.length){var n=arguments[0],r=arguments[1];return this._location[0]=this._locFinder[0].getLocation(r),this._location[1]=this._locFinder[1].getLocation(r),this._location[2]=this._locFinder[2].getLocation(r),!!Pr.hasLocation(this._location,C.BOUNDARY)||this.isValidResult(n,this._location)}},Pr.prototype.addTestPts=function(t){var e=new Ar(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))},Pr.prototype.isValidResult=function(t,e){var i=Mr.isResultOfOp(e[0],e[1],t),n=!(i^e[2]===C.INTERIOR);return n||this.reportResult(t,e,i),n},Pr.prototype.getInvalidLocation=function(){return this._invalidLocation},Pr.prototype.interfaces_=function(){return[]},Pr.prototype.getClass=function(){return Pr},Pr.hasLocation=function(t,e){for(var i=0;i<3;i++)if(t[i]===e)return!0;return!1},Pr.computeBoundaryDistanceTolerance=function(t,e){return Math.min(Zn.computeSizeBasedSnapTolerance(t),Zn.computeSizeBasedSnapTolerance(e))},Pr.isValid=function(t,e,i,n){return new Pr(t,e,n).isValid(i)},Lr.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Pr,Lr);var Rr=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};Rr.prototype.extractElements=function(t,e){if(null===t)return null;for(var i=0;i<t.getNumGeometries();i++){var n=t.getGeometryN(i);this._skipEmpty&&n.isEmpty()||e.add(n)}},Rr.prototype.combine=function(){for(var t=new Et,e=this._inputGeoms.iterator();e.hasNext();){var i=e.next();this.extractElements(i,t)}return 0===t.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)},Rr.prototype.interfaces_=function(){return[]},Rr.prototype.getClass=function(){return Rr},Rr.combine=function(){return 1===arguments.length?new Rr(arguments[0]).combine():2===arguments.length?new Rr(Rr.createList(arguments[0],arguments[1])).combine():3===arguments.length?new Rr(Rr.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},Rr.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},Rr.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],i=new Et;return i.add(t),i.add(e),i}if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2],s=new Et;return s.add(n),s.add(r),s.add(o),s}};var Dr=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,null===this._inputPolys&&(this._inputPolys=new Et)},kr={STRTREE_NODE_CAPACITY:{configurable:!0}};Dr.prototype.reduceToGeometries=function(t){for(var e=new Et,i=t.iterator();i.hasNext();){var n=i.next(),r=null;P(n,wt)?r=this.unionTree(n):n instanceof ut&&(r=n),e.add(r)}return e},Dr.prototype.extractByEnvelope=function(t,e,i){for(var n=new Et,r=0;r<e.getNumGeometries();r++){var o=e.getGeometryN(r);o.getEnvelopeInternal().intersects(t)?n.add(o):i.add(o)}return this._geomFactory.buildGeometry(n)},Dr.prototype.unionOptimized=function(t,e){var i=t.getEnvelopeInternal(),n=e.getEnvelopeInternal();if(!i.intersects(n))return Rr.combine(t,e);if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var r=i.intersection(n);return this.unionUsingEnvelopeIntersection(t,e,r)},Dr.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new oi(Dr.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var i=e.next();t.insert(i.getEnvelopeInternal(),i)}this._inputPolys=null;var n=t.itemsTree();return this.unionTree(n)},Dr.prototype.binaryUnion=function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],i=arguments[1],n=arguments[2];if(n-i<=1){var r=Dr.getGeometry(e,i);return this.unionSafe(r,null)}if(n-i==2)return this.unionSafe(Dr.getGeometry(e,i),Dr.getGeometry(e,i+1));var o=Math.trunc((n+i)/2),s=this.binaryUnion(e,i,o),a=this.binaryUnion(e,o,n);return this.unionSafe(s,a)}},Dr.prototype.repeatedUnion=function(t){for(var e=null,i=t.iterator();i.hasNext();){var n=i.next();e=null===e?n.copy():e.union(n)}return e},Dr.prototype.unionSafe=function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},Dr.prototype.unionActual=function(t,e){return Dr.restrictToPolygons(t.union(e))},Dr.prototype.unionTree=function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},Dr.prototype.unionUsingEnvelopeIntersection=function(t,e,i){var n=new Et,r=this.extractByEnvelope(i,t,n),o=this.extractByEnvelope(i,e,n),s=this.unionActual(r,o);return n.add(s),Rr.combine(n)},Dr.prototype.bufferUnion=function(){if(1===arguments.length){var t=arguments[0];return t.get(0).getFactory().buildGeometry(t).buffer(0)}if(2===arguments.length){var e=arguments[0],i=arguments[1];return e.getFactory().createGeometryCollection([e,i]).buffer(0)}},Dr.prototype.interfaces_=function(){return[]},Dr.prototype.getClass=function(){return Dr},Dr.restrictToPolygons=function(t){if(P(t,Jt))return t;var e=En.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(_e.toPolygonArray(e))},Dr.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},Dr.union=function(t){return new Dr(t).union()},kr.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Dr,kr);var Nr=function(){};Nr.prototype.interfaces_=function(){return[]},Nr.prototype.getClass=function(){return Nr},Nr.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Mr.createEmptyResult(Mr.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),or.overlayOp(t,e,Mr.UNION)},t.GeoJSONReader=Ee,t.GeoJSONWriter=Se,t.OverlayOp=Mr,t.UnionOp=Nr,t.BufferOp=mn,Object.defineProperty(t,"__esModule",{value:!0})}(e)},8048:t=>{"use strict";t.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+Cjxzdmcgd2lkdGg9IjEyIiBoZWlnaHQ9IjQiIHZpZXdQb3J0PSIwIDAgMTIgNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxlbGxpcHNlIGN4PSIyIiBjeT0iMiIgcng9IjIiIHJ5PSIyIj4KICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImN4IiBmcm9tPSIyIiB0bz0iLTEwIiBkdXI9IjAuNnMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiAvPgogIDwvZWxsaXBzZT4KICA8ZWxsaXBzZSBjeD0iMTQiIGN5PSIyIiByeD0iMiIgcnk9IjIiIGNsYXNzPSJsb2FkZXIiPgogICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iY3giIGZyb209IjE0IiB0bz0iMiIgZHVyPSIwLjZzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgLz4KICA8L2VsbGlwc2U+Cjwvc3ZnPgo="}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var o=e[n]={id:n,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.exports}i.m=t,i.amdD=function(){throw new Error("define cannot be used indirect")},i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.b=document.baseURI||self.location.href,i.nc=void 0,(()=>{"use strict";var t={};i.r(t),i.d(t,{FirebaseError:()=>x,SDK_VERSION:()=>Kt,_DEFAULT_ENTRY_NAME:()=>Nt,_addComponent:()=>Ut,_addOrOverwriteComponent:()=>Vt,_apps:()=>Ft,_clearComponents:()=>Xt,_components:()=>Bt,_getProvider:()=>Gt,_isFirebaseApp:()=>Wt,_isFirebaseServerApp:()=>qt,_registerComponent:()=>jt,_removeServiceInstance:()=>Ht,_serverApps:()=>zt,deleteApp:()=>ie,getApp:()=>te,getApps:()=>ee,initializeApp:()=>Jt,initializeServerApp:()=>Qt,onLog:()=>re,registerVersion:()=>ne,setLogLevel:()=>oe}),i(1625);var e=i(842),n=i.n(e);const r=function(t){const e=[];let i=0;for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);r<128?e[i++]=r:r<2048?(e[i++]=r>>6|192,e[i++]=63&r|128):55296==(64512&r)&&n+1<t.length&&56320==(64512&t.charCodeAt(n+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++n)),e[i++]=r>>18|240,e[i++]=r>>12&63|128,e[i++]=r>>6&63|128,e[i++]=63&r|128):(e[i++]=r>>12|224,e[i++]=r>>6&63|128,e[i++]=63&r|128)}return e},o={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let e=0;e<t.length;e+=3){const r=t[e],o=e+1<t.length,s=o?t[e+1]:0,a=e+2<t.length,l=a?t[e+2]:0,c=r>>2,u=(3&r)<<4|s>>4;let h=(15&s)<<2|l>>6,d=63&l;a||(d=64,o||(h=64)),n.push(i[c],i[u],i[h],i[d])}return n.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(r(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let i=0,n=0;for(;i<t.length;){const r=t[i++];if(r<128)e[n++]=String.fromCharCode(r);else if(r>191&&r<224){const o=t[i++];e[n++]=String.fromCharCode((31&r)<<6|63&o)}else if(r>239&&r<365){const o=((7&r)<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++])-65536;e[n++]=String.fromCharCode(55296+(o>>10)),e[n++]=String.fromCharCode(56320+(1023&o))}else{const o=t[i++],s=t[i++];e[n++]=String.fromCharCode((15&r)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let e=0;e<t.length;){const r=i[t.charAt(e++)],o=e<t.length?i[t.charAt(e)]:0;++e;const a=e<t.length?i[t.charAt(e)]:64;++e;const l=e<t.length?i[t.charAt(e)]:64;if(++e,null==r||null==o||null==a||null==l)throw new s;const c=r<<2|o>>4;if(n.push(c),64!==a){const t=o<<4&240|a>>2;if(n.push(t),64!==l){const t=a<<6&192|l;n.push(t)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(t){return function(t){const e=r(t);return o.encodeByteArray(e,!0)}(t).replace(/\./g,"")},l=function(t){try{return o.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function c(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(const i in e)e.hasOwnProperty(i)&&"__proto__"!==i&&(t[i]=c(t[i],e[i]));return t}const u=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==i.g)return i.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&l(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},h=()=>{var t;return null===(t=u())||void 0===t?void 0:t.config};class d{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,i))}}}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function f(){var t;const e=null===(t=u())||void 0===t?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(i.g.process)}catch(t){return!1}}function m(){return"object"==typeof self&&self.self===self}function g(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function _(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function y(){const t=p();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function v(){try{return"object"==typeof indexedDB}catch(t){return!1}}class x extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name="FirebaseError",Object.setPrototypeOf(this,x.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,b.prototype.create)}}class b{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){const i=e[0]||{},n=`${this.service}/${t}`,r=this.errors[t],o=r?function(t,e){return t.replace(w,((t,i)=>{const n=e[i];return null!=n?String(n):`<${i}?>`}))}(r,i):"Error",s=`${this.serviceName}: ${o} (${n}).`;return new x(n,s,i)}}const w=/\{\$([^}]+)}/g;function E(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function S(t,e){if(t===e)return!0;const i=Object.keys(t),n=Object.keys(e);for(const r of i){if(!n.includes(r))return!1;const i=t[r],o=e[r];if(T(i)&&T(o)){if(!S(i,o))return!1}else if(i!==o)return!1}for(const t of n)if(!i.includes(t))return!1;return!0}function T(t){return null!==t&&"object"==typeof t}function M(t){const e=[];for(const[i,n]of Object.entries(t))Array.isArray(n)?n.forEach((t=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(i)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function I(t){const e={};return t.replace(/^\?/,"").split("&").forEach((t=>{if(t){const[i,n]=t.split("=");e[decodeURIComponent(i)]=decodeURIComponent(n)}})),e}function C(t){const e=t.indexOf("?");if(!e)return"";const i=t.indexOf("#",e);return t.substring(e,i>0?i:void 0)}function A(t,e){const i=new P(t,e);return i.subscribe.bind(i)}class P{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((()=>{t(this)})).catch((t=>{this.error(t)}))}next(t){this.forEachObserver((e=>{e.next(t)}))}error(t){this.forEachObserver((e=>{e.error(t)})),this.close(t)}complete(){this.forEachObserver((t=>{t.complete()})),this.close()}subscribe(t,e,i){let n;if(void 0===t&&void 0===e&&void 0===i)throw new Error("Missing Observer.");n=function(t,e){if("object"!=typeof t||null===t)return!1;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(t)?t:{next:t,error:e,complete:i},void 0===n.next&&(n.next=L),void 0===n.error&&(n.error=L),void 0===n.complete&&(n.complete=L);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(t){}})),this.observers.push(n),r}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function L(){}function R(t){return t&&t._delegate?t._delegate:t}class D{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const k="[DEFAULT]";class N{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new d;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:e});i&&t.resolve(i)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const i=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),n=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(i)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:i})}catch(t){if(n)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:k})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:i});e.resolve(t)}catch(t){}}}}clearInstance(t=k){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=k){return this.instances.has(t)}getOptions(t=k){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:i,options:e});for(const[t,e]of this.instancesDeferred.entries())i===this.normalizeInstanceIdentifier(t)&&e.resolve(n);return n}onInit(t,e){var i;const n=this.normalizeInstanceIdentifier(e),r=null!==(i=this.onInitCallbacks.get(n))&&void 0!==i?i:new Set;r.add(t),this.onInitCallbacks.set(n,r);const o=this.instances.get(n);return o&&t(o,n),()=>{r.delete(t)}}invokeOnInitCallbacks(t,e){const i=this.onInitCallbacks.get(e);if(i)for(const n of i)try{n(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=t,n===k?void 0:n),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch(t){}var n;return i||null}normalizeInstanceIdentifier(t=k){return this.component?this.component.multipleInstances?t:k:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class O{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new N(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const F=[];var z;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(z||(z={}));const B={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},U=z.INFO,V={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},j=(t,e,...i)=>{if(e<t.logLevel)return;const n=(new Date).toISOString(),r=V[e];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[r](`[${n}]  ${t.name}:`,...i)};class G{constructor(t){this.name=t,this._logLevel=U,this._logHandler=j,this._userLogHandler=null,F.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in z))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?B[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...t),this._logHandler(this,z.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...t),this._logHandler(this,z.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,z.INFO,...t),this._logHandler(this,z.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,z.WARN,...t),this._logHandler(this,z.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...t),this._logHandler(this,z.ERROR,...t)}}const H=(t,e)=>e.some((e=>t instanceof e));let W,q;const X=new WeakMap,$=new WeakMap,Y=new WeakMap,Z=new WeakMap,K=new WeakMap;let J={get(t,e,i){if(t instanceof IDBTransaction){if("done"===e)return $.get(t);if("objectStoreNames"===e)return t.objectStoreNames||Y.get(t);if("store"===e)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return tt(t[e])},set:(t,e,i)=>(t[e]=i,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function Q(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(q||(q=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(et(this),t),tt(X.get(this))}:function(...t){return tt(e.apply(et(this),t))}:function(t,...i){const n=e.call(et(this),t,...i);return Y.set(n,t.sort?t.sort():[t]),tt(n)}:(t instanceof IDBTransaction&&function(t){if($.has(t))return;const e=new Promise(((e,i)=>{const n=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",o),t.removeEventListener("abort",o)},r=()=>{e(),n()},o=()=>{i(t.error||new DOMException("AbortError","AbortError")),n()};t.addEventListener("complete",r),t.addEventListener("error",o),t.addEventListener("abort",o)}));$.set(t,e)}(t),H(t,W||(W=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,J):t);var e}function tt(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,i)=>{const n=()=>{t.removeEventListener("success",r),t.removeEventListener("error",o)},r=()=>{e(tt(t.result)),n()},o=()=>{i(t.error),n()};t.addEventListener("success",r),t.addEventListener("error",o)}));return e.then((e=>{e instanceof IDBCursor&&X.set(e,t)})).catch((()=>{})),K.set(e,t),e}(t);if(Z.has(t))return Z.get(t);const e=Q(t);return e!==t&&(Z.set(t,e),K.set(e,t)),e}const et=t=>K.get(t),it=["get","getKey","getAll","getAllKeys","count"],nt=["put","add","delete","clear"],rt=new Map;function ot(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(rt.get(e))return rt.get(e);const i=e.replace(/FromIndex$/,""),n=e!==i,r=nt.includes(i);if(!(i in(n?IDBIndex:IDBObjectStore).prototype)||!r&&!it.includes(i))return;const o=async function(t,...e){const o=this.transaction(t,r?"readwrite":"readonly");let s=o.store;return n&&(s=s.index(e.shift())),(await Promise.all([s[i](...e),r&&o.done]))[0]};return rt.set(e,o),o}var st;st=J,J={...st,get:(t,e,i)=>ot(t,e)||st.get(t,e,i),has:(t,e)=>!!ot(t,e)||st.has(t,e)};class at{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const lt="@firebase/app",ct="0.10.2",ut=new G("@firebase/app"),ht="@firebase/app-compat",dt="@firebase/analytics-compat",pt="@firebase/analytics",ft="@firebase/app-check-compat",mt="@firebase/app-check",gt="@firebase/auth",_t="@firebase/auth-compat",yt="@firebase/database",vt="@firebase/database-compat",xt="@firebase/functions",bt="@firebase/functions-compat",wt="@firebase/installations",Et="@firebase/installations-compat",St="@firebase/messaging",Tt="@firebase/messaging-compat",Mt="@firebase/performance",It="@firebase/performance-compat",Ct="@firebase/remote-config",At="@firebase/remote-config-compat",Pt="@firebase/storage",Lt="@firebase/storage-compat",Rt="@firebase/firestore",Dt="@firebase/firestore-compat",kt="firebase",Nt="[DEFAULT]",Ot={[lt]:"fire-core",[ht]:"fire-core-compat",[pt]:"fire-analytics",[dt]:"fire-analytics-compat",[mt]:"fire-app-check",[ft]:"fire-app-check-compat",[gt]:"fire-auth",[_t]:"fire-auth-compat",[yt]:"fire-rtdb",[vt]:"fire-rtdb-compat",[xt]:"fire-fn",[bt]:"fire-fn-compat",[wt]:"fire-iid",[Et]:"fire-iid-compat",[St]:"fire-fcm",[Tt]:"fire-fcm-compat",[Mt]:"fire-perf",[It]:"fire-perf-compat",[Ct]:"fire-rc",[At]:"fire-rc-compat",[Pt]:"fire-gcs",[Lt]:"fire-gcs-compat",[Rt]:"fire-fst",[Dt]:"fire-fst-compat","fire-js":"fire-js",[kt]:"fire-js-all"},Ft=new Map,zt=new Map,Bt=new Map;function Ut(t,e){try{t.container.addComponent(e)}catch(i){ut.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,i)}}function Vt(t,e){t.container.addOrOverwriteComponent(e)}function jt(t){const e=t.name;if(Bt.has(e))return ut.debug(`There were multiple attempts to register component ${e}.`),!1;Bt.set(e,t);for(const e of Ft.values())Ut(e,t);for(const e of zt.values())Ut(e,t);return!0}function Gt(t,e){const i=t.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),t.container.getProvider(e)}function Ht(t,e,i=Nt){Gt(t,e).clearInstance(i)}function Wt(t){return void 0!==t.options}function qt(t){return void 0!==t.settings}function Xt(){Bt.clear()}const $t=new b("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Yt{constructor(t,e,i){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new D("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw $t.create("app-deleted",{appName:this._name})}}class Zt extends Yt{constructor(t,e,i,n){const r=void 0!==e.automaticDataCollectionEnabled&&e.automaticDataCollectionEnabled,o={name:i,automaticDataCollectionEnabled:r};void 0!==t.apiKey?super(t,o,n):super(t.options,o,n),this._serverConfig=Object.assign({automaticDataCollectionEnabled:r},e),this._finalizationRegistry=new FinalizationRegistry((()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,e.releaseOnDeref=void 0,ne(lt,ct,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(t){this.isDeleted||(this._refCount++,void 0!==t&&this._finalizationRegistry.register(t,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){ie(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw $t.create("server-app-deleted")}}const Kt="10.11.1";function Jt(t,e={}){let i=t;"object"!=typeof e&&(e={name:e});const n=Object.assign({name:Nt,automaticDataCollectionEnabled:!1},e),r=n.name;if("string"!=typeof r||!r)throw $t.create("bad-app-name",{appName:String(r)});if(i||(i=h()),!i)throw $t.create("no-options");const o=Ft.get(r);if(o){if(S(i,o.options)&&S(n,o.config))return o;throw $t.create("duplicate-app",{appName:r})}const s=new O(r);for(const t of Bt.values())s.addComponent(t);const a=new Yt(i,n,s);return Ft.set(r,a),a}function Qt(t,e){if(m())throw $t.create("invalid-server-app-environment");let i;void 0===e.automaticDataCollectionEnabled&&(e.automaticDataCollectionEnabled=!1),i=Wt(t)?t.options:t;const n=Object.assign(Object.assign({},e),i);if(void 0!==n.releaseOnDeref&&delete n.releaseOnDeref,void 0!==e.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw $t.create("finalization-registry-not-supported",{});const r=""+(o=JSON.stringify(n),[...o].reduce(((t,e)=>Math.imul(31,t)+e.charCodeAt(0)|0),0));var o;const s=zt.get(r);if(s)return s.incRefCount(e.releaseOnDeref),s;const a=new O(r);for(const t of Bt.values())a.addComponent(t);const l=new Zt(i,e,r,a);return zt.set(r,l),l}function te(t=Nt){const e=Ft.get(t);if(!e&&t===Nt&&h())return Jt();if(!e)throw $t.create("no-app",{appName:t});return e}function ee(){return Array.from(Ft.values())}async function ie(t){let e=!1;const i=t.name;Ft.has(i)?(e=!0,Ft.delete(i)):zt.has(i)&&t.decRefCount()<=0&&(zt.delete(i),e=!0),e&&(await Promise.all(t.container.getProviders().map((t=>t.delete()))),t.isDeleted=!0)}function ne(t,e,i){var n;let r=null!==(n=Ot[t])&&void 0!==n?n:t;i&&(r+=`-${i}`);const o=r.match(/\s|\//),s=e.match(/\s|\//);if(o||s){const t=[`Unable to register library "${r}" with version "${e}":`];return o&&t.push(`library name "${r}" contains illegal characters (whitespace or "/")`),o&&s&&t.push("and"),s&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void ut.warn(t.join(" "))}jt(new D(`${r}-version`,(()=>({library:r,version:e})),"VERSION"))}function re(t,e){if(null!==t&&"function"!=typeof t)throw $t.create("invalid-log-argument");!function(t,e){for(const i of F){let n=null;e&&e.level&&(n=B[e.level]),i.userLogHandler=null===t?null:(e,i,...r)=>{const o=r.map((t=>{if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}})).filter((t=>t)).join(" ");i>=(null!=n?n:e.logLevel)&&t({level:z[i].toLowerCase(),message:o,args:r,type:e.name})}}}(t,e)}function oe(t){var e;e=t,F.forEach((t=>{t.setLogLevel(e)}))}const se="firebase-heartbeat-database",ae=1,le="firebase-heartbeat-store";let ce=null;function ue(){return ce||(ce=function(t,e,{blocked:i,upgrade:n,blocking:r,terminated:o}={}){const s=indexedDB.open(t,e),a=tt(s);return n&&s.addEventListener("upgradeneeded",(t=>{n(tt(s.result),t.oldVersion,t.newVersion,tt(s.transaction),t)})),i&&s.addEventListener("blocked",(t=>i(t.oldVersion,t.newVersion,t))),a.then((t=>{o&&t.addEventListener("close",(()=>o())),r&&t.addEventListener("versionchange",(t=>r(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(se,ae,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(le)}catch(t){console.warn(t)}}}).catch((t=>{throw $t.create("idb-open",{originalErrorMessage:t.message})}))),ce}async function he(t,e){try{const i=(await ue()).transaction(le,"readwrite"),n=i.objectStore(le);await n.put(e,de(t)),await i.done}catch(t){if(t instanceof x)ut.warn(t.message);else{const e=$t.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});ut.warn(e.message)}}}function de(t){return`${t.name}!${t.options.appId}`}class pe{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new me(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=fe();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==n&&!this._heartbeatsCache.heartbeats.some((t=>t.date===n)))return this._heartbeatsCache.heartbeats.push({date:n,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=fe(),{heartbeatsToSend:i,unsentEntries:n}=function(t,e=1024){const i=[];let n=t.slice();for(const r of t){const t=i.find((t=>t.agent===r.agent));if(t){if(t.dates.push(r.date),ge(i)>e){t.dates.pop();break}}else if(i.push({agent:r.agent,dates:[r.date]}),ge(i)>e){i.pop();break}n=n.slice(1)}return{heartbeatsToSend:i,unsentEntries:n}}(this._heartbeatsCache.heartbeats),r=a(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function fe(){return(new Date).toISOString().substring(0,10)}class me{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!v()&&new Promise(((t,e)=>{try{let i=!0;const n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),i||self.indexedDB.deleteDatabase(n),t(!0)},r.onupgradeneeded=()=>{i=!1},r.onerror=()=>{var t;e((null===(t=r.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await ue()).transaction(le),i=await e.objectStore(le).get(de(t));return await e.done,i}catch(t){if(t instanceof x)ut.warn(t.message);else{const e=$t.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});ut.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const i=await this.read();return he(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const i=await this.read();return he(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}}}function ge(t){return a(JSON.stringify({version:2,heartbeats:t})).length}jt(new D("platform-logger",(t=>new at(t)),"PRIVATE")),jt(new D("heartbeat",(t=>new pe(t)),"PRIVATE")),ne(lt,ct,""),ne(lt,ct,"esm2017"),ne("fire-js",""),ne("firebase","10.11.1","app");var _e,ye="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ve={},xe=xe||{},be=ye||self;function we(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function Ee(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Se="closure_uid_"+(1e9*Math.random()>>>0),Te=0;function Me(t,e,i){return t.call.apply(t.bind,arguments)}function Ie(t,e,i){if(!t)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,n),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function Ce(t,e,i){return(Ce=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Me:Ie).apply(null,arguments)}function Ae(t,e){var i=Array.prototype.slice.call(arguments,1);return function(){var e=i.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Pe(t,e){function i(){}i.prototype=e.prototype,t.$=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.ac=function(t,i,n){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return e.prototype[i].apply(t,r)}}function Le(){this.s=this.s,this.o=this.o}Le.prototype.s=!1,Le.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,Se)&&t[Se]||(t[Se]=++Te))},Le.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Re=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let i=0;i<t.length;i++)if(i in t&&t[i]===e)return i;return-1};function De(t){const e=t.length;if(0<e){const i=Array(e);for(let n=0;n<e;n++)i[n]=t[n];return i}return[]}function ke(t,e){for(let e=1;e<arguments.length;e++){const i=arguments[e];if(we(i)){const e=t.length||0,n=i.length||0;t.length=e+n;for(let r=0;r<n;r++)t[e+r]=i[r]}else t.push(i)}}function Ne(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Ne.prototype.h=function(){this.defaultPrevented=!0};var Oe=function(){if(!be.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};be.addEventListener("test",t,e),be.removeEventListener("test",t,e)}catch(t){}return t}();function Fe(t){return/^[\s\xa0]*$/.test(t)}function ze(){var t=be.navigator;return t&&(t=t.userAgent)?t:""}function Be(t){return-1!=ze().indexOf(t)}function Ue(t){return Ue[" "](t),t}Ue[" "]=function(){};var Ve,je,Ge,He=Be("Opera"),We=Be("Trident")||Be("MSIE"),qe=Be("Edge"),Xe=qe||We,$e=Be("Gecko")&&!(-1!=ze().toLowerCase().indexOf("webkit")&&!Be("Edge"))&&!(Be("Trident")||Be("MSIE"))&&!Be("Edge"),Ye=-1!=ze().toLowerCase().indexOf("webkit")&&!Be("Edge");function Ze(){var t=be.document;return t?t.documentMode:void 0}t:{var Ke="",Je=(je=ze(),$e?/rv:([^\);]+)(\)|;)/.exec(je):qe?/Edge\/([\d\.]+)/.exec(je):We?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(je):Ye?/WebKit\/(\S+)/.exec(je):He?/(?:Version)[ \/]?(\S+)/.exec(je):void 0);if(Je&&(Ke=Je?Je[1]:""),We){var Qe=Ze();if(null!=Qe&&Qe>parseFloat(Ke)){Ve=String(Qe);break t}}Ve=Ke}be.document&&We?Ge=Ze()||parseInt(Ve,10)||void 0:Ge=void 0;var ti=Ge;function ei(t,e){if(Ne.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var i=this.type=t.type,n=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if($e){t:{try{Ue(e.nodeName);var r=!0;break t}catch(t){}r=!1}r||(e=null)}}else"mouseover"==i?e=t.fromElement:"mouseout"==i&&(e=t.toElement);this.relatedTarget=e,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:ii[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&ei.$.h.call(this)}}Pe(ei,Ne);var ii={2:"touch",3:"pen",4:"mouse"};ei.prototype.h=function(){ei.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ni="closure_listenable_"+(1e6*Math.random()|0),ri=0;function oi(t,e,i,n,r){this.listener=t,this.proxy=null,this.src=e,this.type=i,this.capture=!!n,this.la=r,this.key=++ri,this.fa=this.ia=!1}function si(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function ai(t,e,i){for(const n in t)e.call(i,t[n],n,t)}function li(t){const e={};for(const i in t)e[i]=t[i];return e}const ci="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ui(t,e){let i,n;for(let e=1;e<arguments.length;e++){for(i in n=arguments[e],n)t[i]=n[i];for(let e=0;e<ci.length;e++)i=ci[e],Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}}function hi(t){this.src=t,this.g={},this.h=0}function di(t,e){var i=e.type;if(i in t.g){var n,r=t.g[i],o=Re(r,e);(n=0<=o)&&Array.prototype.splice.call(r,o,1),n&&(si(e),0==t.g[i].length&&(delete t.g[i],t.h--))}}function pi(t,e,i,n){for(var r=0;r<t.length;++r){var o=t[r];if(!o.fa&&o.listener==e&&o.capture==!!i&&o.la==n)return r}return-1}hi.prototype.add=function(t,e,i,n,r){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=pi(t,e,n,r);return-1<s?(e=t[s],i||(e.ia=!1)):((e=new oi(e,this.src,o,!!n,r)).ia=i,t.push(e)),e};var fi="closure_lm_"+(1e6*Math.random()|0),mi={};function gi(t,e,i,n,r){if(n&&n.once)return yi(t,e,i,n,r);if(Array.isArray(e)){for(var o=0;o<e.length;o++)gi(t,e[o],i,n,r);return null}return i=Ti(i),t&&t[ni]?t.O(e,i,Ee(n)?!!n.capture:!!n,r):_i(t,e,i,!1,n,r)}function _i(t,e,i,n,r,o){if(!e)throw Error("Invalid event type");var s=Ee(r)?!!r.capture:!!r,a=Ei(t);if(a||(t[fi]=a=new hi(t)),(i=a.add(e,i,n,s,o)).proxy)return i;if(n=function(){const t=wi;return function e(i){return t.call(e.src,e.listener,i)}}(),i.proxy=n,n.src=t,n.listener=i,t.addEventListener)Oe||(r=s),void 0===r&&(r=!1),t.addEventListener(e.toString(),n,r);else if(t.attachEvent)t.attachEvent(bi(e.toString()),n);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(n)}return i}function yi(t,e,i,n,r){if(Array.isArray(e)){for(var o=0;o<e.length;o++)yi(t,e[o],i,n,r);return null}return i=Ti(i),t&&t[ni]?t.P(e,i,Ee(n)?!!n.capture:!!n,r):_i(t,e,i,!0,n,r)}function vi(t,e,i,n,r){if(Array.isArray(e))for(var o=0;o<e.length;o++)vi(t,e[o],i,n,r);else n=Ee(n)?!!n.capture:!!n,i=Ti(i),t&&t[ni]?(t=t.i,(e=String(e).toString())in t.g&&-1<(i=pi(o=t.g[e],i,n,r))&&(si(o[i]),Array.prototype.splice.call(o,i,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=Ei(t))&&(e=t.g[e.toString()],t=-1,e&&(t=pi(e,i,n,r)),(i=-1<t?e[t]:null)&&xi(i))}function xi(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[ni])di(e.i,t);else{var i=t.type,n=t.proxy;e.removeEventListener?e.removeEventListener(i,n,t.capture):e.detachEvent?e.detachEvent(bi(i),n):e.addListener&&e.removeListener&&e.removeListener(n),(i=Ei(e))?(di(i,t),0==i.h&&(i.src=null,e[fi]=null)):si(t)}}}function bi(t){return t in mi?mi[t]:mi[t]="on"+t}function wi(t,e){if(t.fa)t=!0;else{e=new ei(e,this);var i=t.listener,n=t.la||t.src;t.ia&&xi(t),t=i.call(n,e)}return t}function Ei(t){return(t=t[fi])instanceof hi?t:null}var Si="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ti(t){return"function"==typeof t?t:(t[Si]||(t[Si]=function(e){return t.handleEvent(e)}),t[Si])}function Mi(){Le.call(this),this.i=new hi(this),this.S=this,this.J=null}function Ii(t,e){var i,n=t.J;if(n)for(i=[];n;n=n.J)i.push(n);if(t=t.S,n=e.type||e,"string"==typeof e)e=new Ne(e,t);else if(e instanceof Ne)e.target=e.target||t;else{var r=e;ui(e=new Ne(n,t),r)}if(r=!0,i)for(var o=i.length-1;0<=o;o--){var s=e.g=i[o];r=Ci(s,n,!0,e)&&r}if(r=Ci(s=e.g=t,n,!0,e)&&r,r=Ci(s,n,!1,e)&&r,i)for(o=0;o<i.length;o++)r=Ci(s=e.g=i[o],n,!1,e)&&r}function Ci(t,e,i,n){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.fa&&s.capture==i){var a=s.listener,l=s.la||s.src;s.ia&&di(t.i,s),r=!1!==a.call(l,n)&&r}}return r&&!n.defaultPrevented}Pe(Mi,Le),Mi.prototype[ni]=!0,Mi.prototype.removeEventListener=function(t,e,i,n){vi(this,t,e,i,n)},Mi.prototype.N=function(){if(Mi.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var i=e.g[t],n=0;n<i.length;n++)si(i[n]);delete e.g[t],e.h--}}this.J=null},Mi.prototype.O=function(t,e,i,n){return this.i.add(String(t),e,!1,i,n)},Mi.prototype.P=function(t,e,i,n){return this.i.add(String(t),e,!0,i,n)};var Ai=be.JSON.stringify;function Pi(){var t=Fi;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Li=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Ri),(t=>t.reset()));class Ri{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Di(t){var e=1;t=t.split(":");const i=[];for(;0<e&&t.length;)i.push(t.shift()),e--;return t.length&&i.push(t.join(":")),i}function ki(t){be.setTimeout((()=>{throw t}),0)}let Ni,Oi=!1,Fi=new class{constructor(){this.h=this.g=null}add(t,e){const i=Li.get();i.set(t,e),this.h?this.h.next=i:this.g=i,this.h=i}},zi=()=>{const t=be.Promise.resolve(void 0);Ni=()=>{t.then(Bi)}};var Bi=()=>{for(var t;t=Pi();){try{t.h.call(t.g)}catch(t){ki(t)}var e=Li;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Oi=!1};function Ui(t,e){Mi.call(this),this.h=t||1,this.g=e||be,this.j=Ce(this.qb,this),this.l=Date.now()}function Vi(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function ji(t,e,i){if("function"==typeof t)i&&(t=Ce(t,i));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Ce(t.handleEvent,t)}return 2147483647<Number(e)?-1:be.setTimeout(t,e||0)}function Gi(t){t.g=ji((()=>{t.g=null,t.i&&(t.i=!1,Gi(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}Pe(Ui,Mi),(_e=Ui.prototype).ga=!1,_e.T=null,_e.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ii(this,"tick"),this.ga&&(Vi(this),this.start()))}},_e.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},_e.N=function(){Ui.$.N.call(this),Vi(this),delete this.g};class Hi extends Le{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Gi(this)}N(){super.N(),this.g&&(be.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Wi(t){Le.call(this),this.h=t,this.g={}}Pe(Wi,Le);var qi=[];function Xi(t,e,i,n){Array.isArray(i)||(i&&(qi[0]=i.toString()),i=qi);for(var r=0;r<i.length;r++){var o=gi(e,i[r],n||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function $i(t){ai(t.g,(function(t,e){this.g.hasOwnProperty(e)&&xi(t)}),t),t.g={}}function Yi(){this.g=!0}function Zi(t,e,i,n){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var i=JSON.parse(e);if(i)for(t=0;t<i.length;t++)if(Array.isArray(i[t])){var n=i[t];if(!(2>n.length)){var r=n[1];if(Array.isArray(r)&&!(1>r.length)){var o=r[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<r.length;s++)r[s]=""}}}return Ai(i)}catch(t){return e}}(t,i)+(n?" "+n:"")}))}Wi.prototype.N=function(){Wi.$.N.call(this),$i(this)},Wi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Yi.prototype.Ea=function(){this.g=!1},Yi.prototype.info=function(){};var Ki={},Ji=null;function Qi(){return Ji=Ji||new Mi}function tn(t){Ne.call(this,Ki.Ta,t)}function en(t){const e=Qi();Ii(e,new tn(e))}function nn(t,e){Ne.call(this,Ki.STAT_EVENT,t),this.stat=e}function rn(t){const e=Qi();Ii(e,new nn(e,t))}function on(t,e){Ne.call(this,Ki.Ua,t),this.size=e}function sn(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return be.setTimeout((function(){t()}),e)}Ki.Ta="serverreachability",Pe(tn,Ne),Ki.STAT_EVENT="statevent",Pe(nn,Ne),Ki.Ua="timingevent",Pe(on,Ne);var an={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ln={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function cn(){}function un(t){return t.h||(t.h=t.i())}function hn(){}cn.prototype.h=null;var dn,pn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function fn(){Ne.call(this,"d")}function mn(){Ne.call(this,"c")}function gn(){}function _n(t,e,i,n){this.l=t,this.j=e,this.m=i,this.W=n||1,this.U=new Wi(this),this.P=vn,t=Xe?125:void 0,this.V=new Ui(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new yn}function yn(){this.i=null,this.g="",this.h=!1}Pe(fn,Ne),Pe(mn,Ne),Pe(gn,cn),gn.prototype.g=function(){return new XMLHttpRequest},gn.prototype.i=function(){return{}},dn=new gn;var vn=45e3,xn={},bn={};function wn(t,e,i){t.L=1,t.A=Vn(On(e)),t.u=i,t.S=!0,En(t,null)}function En(t,e){t.G=Date.now(),In(t),t.B=On(t.A);var i=t.B,n=t.W;Array.isArray(n)||(n=[String(n)]),tr(i.i,"t",n),t.o=0,i=t.l.J,t.h=new yn,t.g=to(t.l,i?e:null,!t.u),0<t.O&&(t.M=new Hi(Ce(t.Pa,t,t.g),t.O)),Xi(t.U,t.g,"readystatechange",t.nb),e=t.I?li(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),en(),function(t,e,i,n,r,o){t.info((function(){if(t.g)if(o)for(var s="",a=o.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");s=2<=h.length&&"type"==h[1]?s+(u+"=")+c+"&":s+(u+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+n+") [attempt "+r+"]: "+e+"\n"+i+"\n"+s}))}(t.j,t.v,t.B,t.m,t.W,t.u)}function Sn(t){return!!t.g&&"GET"==t.v&&2!=t.L&&t.l.Ha}function Tn(t,e,i){let n,r=!0;for(;!t.J&&t.o<i.length;){if(n=Mn(t,i),n==bn){4==e&&(t.s=4,rn(14),r=!1),Zi(t.j,t.m,null,"[Incomplete Response]");break}if(n==xn){t.s=4,rn(15),Zi(t.j,t.m,i,"[Invalid Chunk]"),r=!1;break}Zi(t.j,t.m,n,null),Rn(t,n)}Sn(t)&&0!=t.o&&(t.h.g=t.h.g.slice(t.o),t.o=0),4!=e||0!=i.length||t.h.h||(t.s=1,rn(16),r=!1),t.i=t.i&&r,r?0<i.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+i.length),qr(e),e.M=!0,rn(11))):(Zi(t.j,t.m,i,"[Invalid Chunked Response]"),Ln(t),Pn(t))}function Mn(t,e){var i=t.o,n=e.indexOf("\n",i);return-1==n?bn:(i=Number(e.substring(i,n)),isNaN(i)?xn:(n+=1)+i>e.length?bn:(e=e.slice(n,n+i),t.o=n+i,e))}function In(t){t.Y=Date.now()+t.P,Cn(t,t.P)}function Cn(t,e){if(null!=t.C)throw Error("WatchDog timer not null");t.C=sn(Ce(t.lb,t),e)}function An(t){t.C&&(be.clearTimeout(t.C),t.C=null)}function Pn(t){0==t.l.H||t.J||Yr(t.l,t)}function Ln(t){An(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,Vi(t.V),$i(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Rn(t,e){try{var i=t.l;if(0!=i.H&&(i.g==t||ar(i.i,t)))if(!t.K&&ar(i.i,t)&&3==i.H){try{var n=i.Ja.g.parse(e)}catch(t){n=null}if(Array.isArray(n)&&3==n.length){var r=n;if(0==r[0]){t:if(!i.u){if(i.g){if(!(i.g.G+3e3<t.G))break t;$r(i),zr(i)}Wr(i),rn(18)}}else i.Fa=r[1],0<i.Fa-i.V&&37500>r[2]&&i.G&&0==i.A&&!i.v&&(i.v=sn(Ce(i.ib,i),6e3));if(1>=sr(i.i)&&i.oa){try{i.oa()}catch(t){}i.oa=void 0}}else Kr(i,11)}else if((t.K||i.g==t)&&$r(i),!Fe(e))for(r=i.Ja.g.parse(e),e=0;e<r.length;e++){let c=r[e];if(i.V=c[0],c=c[1],2==i.H)if("c"==c[0]){i.K=c[1],i.pa=c[2];const e=c[3];null!=e&&(i.ra=e,i.l.info("VER="+i.ra));const r=c[4];null!=r&&(i.Ga=r,i.l.info("SVER="+i.Ga));const u=c[5];null!=u&&"number"==typeof u&&0<u&&(n=1.5*u,i.L=n,i.l.info("backChannelRequestTimeoutMs_="+n)),n=i;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var o=n.i;o.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(o.j=o.l,o.g=new Set,o.h&&(lr(o,o.h),o.h=null))}if(n.F){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(n.Da=t,Un(n.I,n.F,t))}}i.H=3,i.h&&i.h.Ba(),i.ca&&(i.S=Date.now()-t.G,i.l.info("Handshake RTT: "+i.S+"ms"));var s=t;if((n=i).wa=Qr(n,n.J?n.pa:null,n.Y),s.K){cr(n.i,s);var a=s,l=n.L;l&&a.setTimeout(l),a.C&&(An(a),In(a)),n.g=s}else Hr(n);0<i.j.length&&Ur(i)}else"stop"!=c[0]&&"close"!=c[0]||Kr(i,7);else 3==i.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Kr(i,7):Fr(i):"noop"!=c[0]&&i.h&&i.h.Aa(c),i.A=0)}en()}catch(t){}}function Dn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(we(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var i=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(we(t)||"string"==typeof t){var e=[];t=t.length;for(var i=0;i<t;i++)e.push(i);return e}e=[],i=0;for(const n in t)e[i++]=n;return e}}}(t),n=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(we(t)){for(var e=[],i=t.length,n=0;n<i;n++)e.push(t[n]);return e}for(n in e=[],i=0,t)e[i++]=t[n];return e}(t),r=n.length,o=0;o<r;o++)e.call(void 0,n[o],i&&i[o],t)}(_e=_n.prototype).setTimeout=function(t){this.P=t},_e.nb=function(t){t=t.target;const e=this.M;e&&3==Lr(t)?e.l():this.Pa(t)},_e.Pa=function(t){try{if(t==this.g)t:{const u=Lr(this.g);var e=this.g.Ia();if(this.g.da(),!(3>u)&&(3!=u||Xe||this.g&&(this.h.h||this.g.ja()||Rr(this.g)))){this.J||4!=u||7==e||en(),An(this);var i=this.g.da();this.ca=i;e:if(Sn(this)){var n=Rr(this.g);t="";var r=n.length,o=4==Lr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ln(this),Pn(this);var s="";break e}this.h.i=new be.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(n[e],{stream:o&&e==r-1});n.length=0,this.h.g+=t,this.o=0,s=this.h.g}else s=this.g.ja();if(this.i=200==i,function(t,e,i,n,r,o,s){t.info((function(){return"XMLHTTP RESP ("+n+") [ attempt "+r+"]: "+e+"\n"+i+"\n"+o+" "+s}))}(this.j,this.v,this.B,this.m,this.W,u,i),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Fe(a)){var c=a;break e}}c=null}if(!(i=c)){this.i=!1,this.s=3,rn(12),Ln(this),Pn(this);break t}Zi(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Rn(this,i)}this.S?(Tn(this,u,s),Xe&&this.i&&3==u&&(Xi(this.U,this.V,"tick",this.mb),this.V.start())):(Zi(this.j,this.m,s,null),Rn(this,s)),4==u&&Ln(this),this.i&&!this.J&&(4==u?Yr(this.l,this):(this.i=!1,In(this)))}else(function(t){const e={};t=(t.g&&2<=Lr(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<t.length;n++){if(Fe(t[n]))continue;var i=Di(t[n]);const r=i[0];if("string"!=typeof(i=i[1]))continue;i=i.trim();const o=e[r]||[];e[r]=o,o.push(i)}!function(t,e){for(const i in t)e.call(void 0,t[i],i,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==i&&0<s.indexOf("Unknown SID")?(this.s=3,rn(12)):(this.s=0,rn(13)),Ln(this),Pn(this)}}}catch(t){}},_e.mb=function(){if(this.g){var t=Lr(this.g),e=this.g.ja();this.o<e.length&&(An(this),Tn(this,t,e),this.i&&4!=t&&In(this))}},_e.cancel=function(){this.J=!0,Ln(this)},_e.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.B),2!=this.L&&(en(),rn(17)),Ln(this),this.s=2,Pn(this)):Cn(this,this.Y-t)};var kn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Nn(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Nn){this.h=t.h,Fn(this,t.j),this.s=t.s,this.g=t.g,zn(this,t.m),this.l=t.l;var e=t.i,i=new Zn;i.i=e.i,e.g&&(i.g=new Map(e.g),i.h=e.h),Bn(this,i),this.o=t.o}else t&&(e=String(t).match(kn))?(this.h=!1,Fn(this,e[1]||"",!0),this.s=jn(e[2]||""),this.g=jn(e[3]||"",!0),zn(this,e[4]),this.l=jn(e[5]||"",!0),Bn(this,e[6]||"",!0),this.o=jn(e[7]||"")):(this.h=!1,this.i=new Zn(null,this.h))}function On(t){return new Nn(t)}function Fn(t,e,i){t.j=i?jn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function zn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Bn(t,e,i){e instanceof Zn?(t.i=e,function(t,e){e&&!t.j&&(Kn(t),t.i=null,t.g.forEach((function(t,e){var i=e.toLowerCase();e!=i&&(Jn(this,e),tr(this,i,t))}),t)),t.j=e}(t.i,t.h)):(i||(e=Gn(e,$n)),t.i=new Zn(e,t.h))}function Un(t,e,i){t.i.set(e,i)}function Vn(t){return Un(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function jn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Gn(t,e,i){return"string"==typeof t?(t=encodeURI(t).replace(e,Hn),i&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Hn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Nn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Gn(e,Wn,!0),":");var i=this.g;return(i||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Gn(e,Wn,!0),"@"),t.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.m)&&t.push(":",String(i))),(i=this.l)&&(this.g&&"/"!=i.charAt(0)&&t.push("/"),t.push(Gn(i,"/"==i.charAt(0)?Xn:qn,!0))),(i=this.i.toString())&&t.push("?",i),(i=this.o)&&t.push("#",Gn(i,Yn)),t.join("")};var Wn=/[#\/\?@]/g,qn=/[#\?:]/g,Xn=/[#\?]/g,$n=/[#\?@]/g,Yn=/#/g;function Zn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Kn(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var i=0;i<t.length;i++){var n=t[i].indexOf("="),r=null;if(0<=n){var o=t[i].substring(0,n);r=t[i].substring(n+1)}else o=t[i];e(o,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.i,(function(e,i){t.add(decodeURIComponent(e.replace(/\+/g," ")),i)})))}function Jn(t,e){Kn(t),e=er(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Qn(t,e){return Kn(t),e=er(t,e),t.g.has(e)}function tr(t,e,i){Jn(t,e),0<i.length&&(t.i=null,t.g.set(er(t,e),De(i)),t.h+=i.length)}function er(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(_e=Zn.prototype).add=function(t,e){Kn(this),this.i=null,t=er(this,t);var i=this.g.get(t);return i||this.g.set(t,i=[]),i.push(e),this.h+=1,this},_e.forEach=function(t,e){Kn(this),this.g.forEach((function(i,n){i.forEach((function(i){t.call(e,i,n,this)}),this)}),this)},_e.ta=function(){Kn(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),i=[];for(let n=0;n<e.length;n++){const r=t[n];for(let t=0;t<r.length;t++)i.push(e[n])}return i},_e.Z=function(t){Kn(this);let e=[];if("string"==typeof t)Qn(this,t)&&(e=e.concat(this.g.get(er(this,t))));else{t=Array.from(this.g.values());for(let i=0;i<t.length;i++)e=e.concat(t[i])}return e},_e.set=function(t,e){return Kn(this),this.i=null,Qn(this,t=er(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},_e.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},_e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var i=0;i<e.length;i++){var n=e[i];const o=encodeURIComponent(String(n)),s=this.Z(n);for(n=0;n<s.length;n++){var r=o;""!==s[n]&&(r+="="+encodeURIComponent(String(s[n]))),t.push(r)}}return this.i=t.join("&")};var ir=class{constructor(t,e){this.g=t,this.map=e}};function nr(t){this.l=t||rr,t=be.PerformanceNavigationTiming?0<(t=be.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(be.g&&be.g.Ka&&be.g.Ka()&&be.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var rr=10;function or(t){return!!t.h||!!t.g&&t.g.size>=t.j}function sr(t){return t.h?1:t.g?t.g.size:0}function ar(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function lr(t,e){t.g?t.g.add(e):t.h=e}function cr(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ur(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const i of t.g.values())e=e.concat(i.F);return e}return De(t.i)}nr.prototype.cancel=function(){if(this.i=ur(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var hr=class{stringify(t){return be.JSON.stringify(t,void 0)}parse(t){return be.JSON.parse(t,void 0)}};function dr(){this.g=new hr}function pr(t,e,i){const n=i||"";try{Dn(t,(function(t,i){let r=t;Ee(t)&&(r=Ai(t)),e.push(n+i+"="+encodeURIComponent(r))}))}catch(t){throw e.push(n+"type="+encodeURIComponent("_badmap")),t}}function fr(t,e,i,n,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(n)}catch(t){}}function mr(t){this.l=t.ec||null,this.j=t.ob||!1}function gr(t,e){Mi.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=_r,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Pe(mr,cn),mr.prototype.g=function(){return new gr(this.l,this.j)},mr.prototype.i=function(t){return function(){return t}}({}),Pe(gr,Mi);var _r=0;function yr(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function vr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,xr(t)}function xr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(_e=gr.prototype).open=function(t,e){if(this.readyState!=_r)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,xr(this)},_e.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||be).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},_e.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,vr(this)),this.readyState=_r},_e.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,xr(this)),this.g&&(this.readyState=3,xr(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==be.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;yr(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},_e.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?vr(this):xr(this),3==this.readyState&&yr(this)}},_e.Za=function(t){this.g&&(this.response=this.responseText=t,vr(this))},_e.Ya=function(t){this.g&&(this.response=t,vr(this))},_e.ka=function(){this.g&&vr(this)},_e.setRequestHeader=function(t,e){this.v.append(t,e)},_e.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},_e.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var i=e.next();!i.done;)i=i.value,t.push(i[0]+": "+i[1]),i=e.next();return t.join("\r\n")},Object.defineProperty(gr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var br=be.JSON.parse;function wr(t){Mi.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Er,this.L=this.M=!1}Pe(wr,Mi);var Er="",Sr=/^https?$/i,Tr=["POST","PUT"];function Mr(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Ir(t),Ar(t)}function Ir(t){t.F||(t.F=!0,Ii(t,"complete"),Ii(t,"error"))}function Cr(t){if(t.h&&void 0!==xe&&(!t.C[1]||4!=Lr(t)||2!=t.da()))if(t.v&&4==Lr(t))ji(t.La,0,t);else if(Ii(t,"readystatechange"),4==Lr(t)){t.h=!1;try{const s=t.da();t:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var i;if(!(i=e)){var n;if(n=0===s){var r=String(t.I).match(kn)[1]||null;!r&&be.self&&be.self.location&&(r=be.self.location.protocol.slice(0,-1)),n=!Sr.test(r?r.toLowerCase():"")}i=n}if(i)Ii(t,"complete"),Ii(t,"success");else{t.m=6;try{var o=2<Lr(t)?t.g.statusText:""}catch(t){o=""}t.j=o+" ["+t.da()+"]",Ir(t)}}finally{Ar(t)}}}function Ar(t,e){if(t.g){Pr(t);const i=t.g,n=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Ii(t,"ready");try{i.onreadystatechange=n}catch(t){}}}function Pr(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(be.clearTimeout(t.A),t.A=null)}function Lr(t){return t.g?t.g.readyState:0}function Rr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case Er:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Dr(t){let e="";return ai(t,(function(t,i){e+=i,e+=":",e+=t,e+="\r\n"})),e}function kr(t,e,i){t:{for(n in i){var n=!1;break t}n=!0}n||(i=Dr(i),"string"==typeof t?null!=i&&encodeURIComponent(String(i)):Un(t,e,i))}function Nr(t,e,i){return i&&i.internalChannelParams&&i.internalChannelParams[t]||e}function Or(t){this.Ga=0,this.j=[],this.l=new Yi,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Nr("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Nr("baseRetryDelayMs",5e3,t),this.hb=Nr("retryDelaySeedMs",1e4,t),this.eb=Nr("forwardChannelMaxRetries",2,t),this.xa=Nr("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new nr(t&&t.concurrentRequestLimit),this.Ja=new dr,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Fr(t){if(Br(t),3==t.H){var e=t.W++,i=On(t.I);if(Un(i,"SID",t.K),Un(i,"RID",e),Un(i,"TYPE","terminate"),jr(t,i),(e=new _n(t,t.l,e)).L=2,e.A=Vn(On(i)),i=!1,be.navigator&&be.navigator.sendBeacon)try{i=be.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!i&&be.Image&&((new Image).src=e.A,i=!0),i||(e.g=to(e.l,null),e.g.ha(e.A)),e.G=Date.now(),In(e)}Jr(t)}function zr(t){t.g&&(qr(t),t.g.cancel(),t.g=null)}function Br(t){zr(t),t.u&&(be.clearTimeout(t.u),t.u=null),$r(t),t.i.cancel(),t.m&&("number"==typeof t.m&&be.clearTimeout(t.m),t.m=null)}function Ur(t){if(!or(t.i)&&!t.m){t.m=!0;var e=t.Na;Ni||zi(),Oi||(Ni(),Oi=!0),Fi.add(e,t),t.C=0}}function Vr(t,e){var i;i=e?e.m:t.W++;const n=On(t.I);Un(n,"SID",t.K),Un(n,"RID",i),Un(n,"AID",t.V),jr(t,n),t.o&&t.s&&kr(n,t.o,t.s),i=new _n(t,t.l,i,t.C+1),null===t.o&&(i.I=t.s),e&&(t.j=e.F.concat(t.j)),e=Gr(t,i,1e3),i.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),lr(t.i,i),wn(i,n,e)}function jr(t,e){t.na&&ai(t.na,(function(t,i){Un(e,i,t)})),t.h&&Dn({},(function(t,i){Un(e,i,t)}))}function Gr(t,e,i){i=Math.min(t.j.length,i);var n=t.h?Ce(t.h.Va,t.h,t):null;t:{var r=t.j;let e=-1;for(;;){const t=["count="+i];-1==e?0<i?(e=r[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let o=!0;for(let s=0;s<i;s++){let i=r[s].g;const a=r[s].map;if(i-=e,0>i)e=Math.max(0,r[s].g-100),o=!1;else try{pr(a,t,"req"+i+"_")}catch(t){n&&n(a)}}if(o){n=t.join("&");break t}}}return t=t.j.splice(0,i),e.F=t,n}function Hr(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Ni||zi(),Oi||(Ni(),Oi=!0),Fi.add(e,t),t.A=0}}function Wr(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=sn(Ce(t.Ma,t),Zr(t,t.A)),t.A++,0))}function qr(t){null!=t.B&&(be.clearTimeout(t.B),t.B=null)}function Xr(t){t.g=new _n(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=On(t.wa);Un(e,"RID","rpc"),Un(e,"SID",t.K),Un(e,"AID",t.V),Un(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Un(e,"TO",t.qa),Un(e,"TYPE","xmlhttp"),jr(t,e),t.o&&t.s&&kr(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var i=t.g;t=t.pa,i.L=1,i.A=Vn(On(e)),i.u=null,i.S=!0,En(i,t)}function $r(t){null!=t.v&&(be.clearTimeout(t.v),t.v=null)}function Yr(t,e){var i=null;if(t.g==e){$r(t),qr(t),t.g=null;var n=2}else{if(!ar(t.i,e))return;i=e.F,cr(t.i,e),n=1}if(0!=t.H)if(e.i)if(1==n){i=e.u?e.u.length:0,e=Date.now()-e.G;var r=t.C;Ii(n=Qi(),new on(n,i)),Ur(t)}else Hr(t);else if(3==(r=e.s)||0==r&&0<e.ca||!(1==n&&function(t,e){return!(sr(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=sn(Ce(t.Na,t,e),Zr(t,t.C)),t.C++,0)))}(t,e)||2==n&&Wr(t)))switch(i&&0<i.length&&(e=t.i,e.i=e.i.concat(i)),r){case 1:Kr(t,5);break;case 4:Kr(t,10);break;case 3:Kr(t,6);break;default:Kr(t,2)}}function Zr(t,e){let i=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(i*=2),i*e}function Kr(t,e){if(t.l.info("Error code "+e),2==e){var i=null;t.h&&(i=null);var n=Ce(t.pb,t);i||(i=new Nn("//www.google.com/images/cleardot.gif"),be.location&&"http"==be.location.protocol||Fn(i,"https"),Vn(i)),function(t,e){const i=new Yi;if(be.Image){const n=new Image;n.onload=Ae(fr,i,n,"TestLoadImage: loaded",!0,e),n.onerror=Ae(fr,i,n,"TestLoadImage: error",!1,e),n.onabort=Ae(fr,i,n,"TestLoadImage: abort",!1,e),n.ontimeout=Ae(fr,i,n,"TestLoadImage: timeout",!1,e),be.setTimeout((function(){n.ontimeout&&n.ontimeout()}),1e4),n.src=t}else e(!1)}(i.toString(),n)}else rn(2);t.H=0,t.h&&t.h.za(e),Jr(t),Br(t)}function Jr(t){if(t.H=0,t.ma=[],t.h){const e=ur(t.i);0==e.length&&0==t.j.length||(ke(t.ma,e),ke(t.ma,t.j),t.i.i.length=0,De(t.j),t.j.length=0),t.h.ya()}}function Qr(t,e,i){var n=i instanceof Nn?On(i):new Nn(i);if(""!=n.g)e&&(n.g=e+"."+n.g),zn(n,n.m);else{var r=be.location;n=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var o=new Nn(null);n&&Fn(o,n),e&&(o.g=e),r&&zn(o,r),i&&(o.l=i),n=o}return i=t.F,e=t.Da,i&&e&&Un(n,i,e),Un(n,"VER",t.ra),jr(t,n),n}function to(t,e,i){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ha&&!t.va?new wr(new mr({ob:i})):new wr(t.va)).Oa(t.J),e}function eo(){}function io(){if(We&&!(10<=Number(ti)))throw Error("Environmental error: no available transport.")}function no(t,e){Mi.call(this),this.g=new Or(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Fe(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Fe(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new so(this)}function ro(t){fn.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const i in e){t=i;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function oo(){mn.call(this),this.status=1}function so(t){this.g=t}function ao(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function lo(t,e,i){i||(i=0);var n=Array(16);if("string"==typeof e)for(var r=0;16>r;++r)n[r]=e.charCodeAt(i++)|e.charCodeAt(i++)<<8|e.charCodeAt(i++)<<16|e.charCodeAt(i++)<<24;else for(r=0;16>r;++r)n[r]=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24;e=t.g[0],i=t.g[1],r=t.g[2];var o=t.g[3],s=e+(o^i&(r^o))+n[0]+3614090360&4294967295;s=(i=(r=(o=(e=(i=(r=(o=(e=(i=(r=(o=(e=(i=(r=(o=(e=(i=(r=(o=(e=(i=(r=(o=(e=(i=(r=(o=(e=(i=(r=(o=(e=(i=(r=(o=(e=(i=(r=(o=(e=(i=(r=(o=(e=(i=(r=(o=(e=(i=(r=(o=(e=(i=(r=(o=(e=(i=(r=(o=(e=i+(s<<7&4294967295|s>>>25))+((s=o+(r^e&(i^r))+n[1]+3905402710&4294967295)<<12&4294967295|s>>>20))+((s=r+(i^o&(e^i))+n[2]+606105819&4294967295)<<17&4294967295|s>>>15))+((s=i+(e^r&(o^e))+n[3]+3250441966&4294967295)<<22&4294967295|s>>>10))+((s=e+(o^i&(r^o))+n[4]+4118548399&4294967295)<<7&4294967295|s>>>25))+((s=o+(r^e&(i^r))+n[5]+1200080426&4294967295)<<12&4294967295|s>>>20))+((s=r+(i^o&(e^i))+n[6]+2821735955&4294967295)<<17&4294967295|s>>>15))+((s=i+(e^r&(o^e))+n[7]+4249261313&4294967295)<<22&4294967295|s>>>10))+((s=e+(o^i&(r^o))+n[8]+1770035416&4294967295)<<7&4294967295|s>>>25))+((s=o+(r^e&(i^r))+n[9]+2336552879&4294967295)<<12&4294967295|s>>>20))+((s=r+(i^o&(e^i))+n[10]+4294925233&4294967295)<<17&4294967295|s>>>15))+((s=i+(e^r&(o^e))+n[11]+2304563134&4294967295)<<22&4294967295|s>>>10))+((s=e+(o^i&(r^o))+n[12]+1804603682&4294967295)<<7&4294967295|s>>>25))+((s=o+(r^e&(i^r))+n[13]+4254626195&4294967295)<<12&4294967295|s>>>20))+((s=r+(i^o&(e^i))+n[14]+2792965006&4294967295)<<17&4294967295|s>>>15))+((s=i+(e^r&(o^e))+n[15]+1236535329&4294967295)<<22&4294967295|s>>>10))+((s=e+(r^o&(i^r))+n[1]+4129170786&4294967295)<<5&4294967295|s>>>27))+((s=o+(i^r&(e^i))+n[6]+3225465664&4294967295)<<9&4294967295|s>>>23))+((s=r+(e^i&(o^e))+n[11]+643717713&4294967295)<<14&4294967295|s>>>18))+((s=i+(o^e&(r^o))+n[0]+3921069994&4294967295)<<20&4294967295|s>>>12))+((s=e+(r^o&(i^r))+n[5]+3593408605&4294967295)<<5&4294967295|s>>>27))+((s=o+(i^r&(e^i))+n[10]+38016083&4294967295)<<9&4294967295|s>>>23))+((s=r+(e^i&(o^e))+n[15]+3634488961&4294967295)<<14&4294967295|s>>>18))+((s=i+(o^e&(r^o))+n[4]+3889429448&4294967295)<<20&4294967295|s>>>12))+((s=e+(r^o&(i^r))+n[9]+568446438&4294967295)<<5&4294967295|s>>>27))+((s=o+(i^r&(e^i))+n[14]+3275163606&4294967295)<<9&4294967295|s>>>23))+((s=r+(e^i&(o^e))+n[3]+4107603335&4294967295)<<14&4294967295|s>>>18))+((s=i+(o^e&(r^o))+n[8]+1163531501&4294967295)<<20&4294967295|s>>>12))+((s=e+(r^o&(i^r))+n[13]+2850285829&4294967295)<<5&4294967295|s>>>27))+((s=o+(i^r&(e^i))+n[2]+4243563512&4294967295)<<9&4294967295|s>>>23))+((s=r+(e^i&(o^e))+n[7]+1735328473&4294967295)<<14&4294967295|s>>>18))+((s=i+(o^e&(r^o))+n[12]+2368359562&4294967295)<<20&4294967295|s>>>12))+((s=e+(i^r^o)+n[5]+4294588738&4294967295)<<4&4294967295|s>>>28))+((s=o+(e^i^r)+n[8]+2272392833&4294967295)<<11&4294967295|s>>>21))+((s=r+(o^e^i)+n[11]+1839030562&4294967295)<<16&4294967295|s>>>16))+((s=i+(r^o^e)+n[14]+4259657740&4294967295)<<23&4294967295|s>>>9))+((s=e+(i^r^o)+n[1]+2763975236&4294967295)<<4&4294967295|s>>>28))+((s=o+(e^i^r)+n[4]+1272893353&4294967295)<<11&4294967295|s>>>21))+((s=r+(o^e^i)+n[7]+4139469664&4294967295)<<16&4294967295|s>>>16))+((s=i+(r^o^e)+n[10]+3200236656&4294967295)<<23&4294967295|s>>>9))+((s=e+(i^r^o)+n[13]+681279174&4294967295)<<4&4294967295|s>>>28))+((s=o+(e^i^r)+n[0]+3936430074&4294967295)<<11&4294967295|s>>>21))+((s=r+(o^e^i)+n[3]+3572445317&4294967295)<<16&4294967295|s>>>16))+((s=i+(r^o^e)+n[6]+76029189&4294967295)<<23&4294967295|s>>>9))+((s=e+(i^r^o)+n[9]+3654602809&4294967295)<<4&4294967295|s>>>28))+((s=o+(e^i^r)+n[12]+3873151461&4294967295)<<11&4294967295|s>>>21))+((s=r+(o^e^i)+n[15]+530742520&4294967295)<<16&4294967295|s>>>16))+((s=i+(r^o^e)+n[2]+3299628645&4294967295)<<23&4294967295|s>>>9))+((s=e+(r^(i|~o))+n[0]+4096336452&4294967295)<<6&4294967295|s>>>26))+((s=o+(i^(e|~r))+n[7]+1126891415&4294967295)<<10&4294967295|s>>>22))+((s=r+(e^(o|~i))+n[14]+2878612391&4294967295)<<15&4294967295|s>>>17))+((s=i+(o^(r|~e))+n[5]+4237533241&4294967295)<<21&4294967295|s>>>11))+((s=e+(r^(i|~o))+n[12]+1700485571&4294967295)<<6&4294967295|s>>>26))+((s=o+(i^(e|~r))+n[3]+2399980690&4294967295)<<10&4294967295|s>>>22))+((s=r+(e^(o|~i))+n[10]+4293915773&4294967295)<<15&4294967295|s>>>17))+((s=i+(o^(r|~e))+n[1]+2240044497&4294967295)<<21&4294967295|s>>>11))+((s=e+(r^(i|~o))+n[8]+1873313359&4294967295)<<6&4294967295|s>>>26))+((s=o+(i^(e|~r))+n[15]+4264355552&4294967295)<<10&4294967295|s>>>22))+((s=r+(e^(o|~i))+n[6]+2734768916&4294967295)<<15&4294967295|s>>>17))+((s=i+(o^(r|~e))+n[13]+1309151649&4294967295)<<21&4294967295|s>>>11))+((o=(e=i+((s=e+(r^(i|~o))+n[4]+4149444226&4294967295)<<6&4294967295|s>>>26))+((s=o+(i^(e|~r))+n[11]+3174756917&4294967295)<<10&4294967295|s>>>22))^((r=o+((s=r+(e^(o|~i))+n[2]+718787259&4294967295)<<15&4294967295|s>>>17))|~e))+n[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(r+(s<<21&4294967295|s>>>11))&4294967295,t.g[2]=t.g[2]+r&4294967295,t.g[3]=t.g[3]+o&4294967295}function co(t,e){this.h=e;for(var i=[],n=!0,r=t.length-1;0<=r;r--){var o=0|t[r];n&&o==e||(i[r]=o,n=!1)}this.g=i}(_e=wr.prototype).Oa=function(t){this.M=t},_e.ha=function(t,e,i,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():dn.g(),this.C=this.u?un(this.u):un(dn),this.g.onreadystatechange=Ce(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void Mr(this,t)}if(t=i||"",i=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var r in n)i.set(r,n[r]);else{if("function"!=typeof n.keys||"function"!=typeof n.get)throw Error("Unknown input type for opt_headers: "+String(n));for(const t of n.keys())i.set(t,n.get(t))}n=Array.from(i.keys()).find((t=>"content-type"==t.toLowerCase())),r=be.FormData&&t instanceof be.FormData,!(0<=Re(Tr,e))||n||r||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of i)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Pr(this),0<this.B&&((this.L=function(t){return We&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ce(this.ua,this)):this.A=ji(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Mr(this,t)}},_e.ua=function(){void 0!==xe&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ii(this,"timeout"),this.abort(8))},_e.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ii(this,"complete"),Ii(this,"abort"),Ar(this))},_e.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ar(this,!0)),wr.$.N.call(this)},_e.La=function(){this.s||(this.G||this.v||this.l?Cr(this):this.kb())},_e.kb=function(){Cr(this)},_e.isActive=function(){return!!this.g},_e.da=function(){try{return 2<Lr(this)?this.g.status:-1}catch(t){return-1}},_e.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},_e.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),br(e)}},_e.Ia=function(){return this.m},_e.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(_e=Or.prototype).ra=8,_e.H=1,_e.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const r=new _n(this,this.l,t);let o=this.s;if(this.U&&(o?(o=li(o),ui(o,this.U)):o=this.U),null!==this.o||this.O||(r.I=o,o=null),this.P)t:{for(var e=0,i=0;i<this.j.length;i++){var n=this.j[i];if(void 0===(n="__data__"in n.map&&"string"==typeof(n=n.map.__data__)?n.length:void 0))break;if(4096<(e+=n)){e=i;break t}if(4096===e||i===this.j.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Gr(this,r,e),Un(i=On(this.I),"RID",t),Un(i,"CVER",22),this.F&&Un(i,"X-HTTP-Session-Id",this.F),jr(this,i),o&&(this.O?e="headers="+encodeURIComponent(String(Dr(o)))+"&"+e:this.o&&kr(i,this.o,o)),lr(this.i,r),this.bb&&Un(i,"TYPE","init"),this.P?(Un(i,"$req",e),Un(i,"SID","null"),r.aa=!0,wn(r,i,null)):wn(r,i,e),this.H=2}}else 3==this.H&&(t?Vr(this,t):0==this.j.length||or(this.i)||Vr(this))},_e.Ma=function(){if(this.u=null,Xr(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=sn(Ce(this.jb,this),t)}},_e.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,rn(10),zr(this),Xr(this))},_e.ib=function(){null!=this.v&&(this.v=null,zr(this),Wr(this),rn(19))},_e.pb=function(t){t?(this.l.info("Successfully pinged google.com"),rn(2)):(this.l.info("Failed to ping google.com"),rn(1))},_e.isActive=function(){return!!this.h&&this.h.isActive(this)},(_e=eo.prototype).Ba=function(){},_e.Aa=function(){},_e.za=function(){},_e.ya=function(){},_e.isActive=function(){return!0},_e.Va=function(){},io.prototype.g=function(t,e){return new no(t,e)},Pe(no,Mi),no.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,i=this.h||void 0;rn(0),t.Y=e,t.na=i||{},t.G=t.aa,t.I=Qr(t,null,t.Y),Ur(t)},no.prototype.close=function(){Fr(this.g)},no.prototype.u=function(t){var e=this.g;if("string"==typeof t){var i={};i.__data__=t,t=i}else this.v&&((i={}).__data__=Ai(t),t=i);e.j.push(new ir(e.fb++,t)),3==e.H&&Ur(e)},no.prototype.N=function(){this.g.h=null,delete this.j,Fr(this.g),delete this.g,no.$.N.call(this)},Pe(ro,fn),Pe(oo,mn),Pe(so,eo),so.prototype.Ba=function(){Ii(this.g,"a")},so.prototype.Aa=function(t){Ii(this.g,new ro(t))},so.prototype.za=function(t){Ii(this.g,new oo)},so.prototype.ya=function(){Ii(this.g,"b")},Pe(ao,(function(){this.blockSize=-1})),ao.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},ao.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var i=e-this.blockSize,n=this.m,r=this.h,o=0;o<e;){if(0==r)for(;o<=i;)lo(this,t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(n[r++]=t.charCodeAt(o++),r==this.blockSize){lo(this,n),r=0;break}}else for(;o<e;)if(n[r++]=t[o++],r==this.blockSize){lo(this,n),r=0;break}}this.h=r,this.i+=e},ao.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var i=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&i,i/=256;for(this.j(t),t=Array(16),e=i=0;4>e;++e)for(var n=0;32>n;n+=8)t[i++]=this.g[e]>>>n&255;return t};var uo={};function ho(t){return-128<=t&&128>t?function(t,e){var i=uo;return Object.prototype.hasOwnProperty.call(i,t)?i[t]:i[t]=function(t){return new co([0|t],0>t?-1:0)}(t)}(t):new co([0|t],0>t?-1:0)}function po(t){if(isNaN(t)||!isFinite(t))return mo;if(0>t)return xo(po(-t));for(var e=[],i=1,n=0;t>=i;n++)e[n]=t/i|0,i*=fo;return new co(e,0)}var fo=4294967296,mo=ho(0),go=ho(1),_o=ho(16777216);function yo(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function vo(t){return-1==t.h}function xo(t){for(var e=t.g.length,i=[],n=0;n<e;n++)i[n]=~t.g[n];return new co(i,~t.h).add(go)}function bo(t,e){return t.add(xo(e))}function wo(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function Eo(t,e){this.g=t,this.h=e}function So(t,e){if(yo(e))throw Error("division by zero");if(yo(t))return new Eo(mo,mo);if(vo(t))return e=So(xo(t),e),new Eo(xo(e.g),xo(e.h));if(vo(e))return e=So(t,xo(e)),new Eo(xo(e.g),e.h);if(30<t.g.length){if(vo(t)||vo(e))throw Error("slowDivide_ only works with positive integers.");for(var i=go,n=e;0>=n.X(t);)i=To(i),n=To(n);var r=Mo(i,1),o=Mo(n,1);for(n=Mo(n,2),i=Mo(i,2);!yo(n);){var s=o.add(n);0>=s.X(t)&&(r=r.add(i),o=s),n=Mo(n,1),i=Mo(i,1)}return e=bo(t,r.R(e)),new Eo(r,e)}for(r=mo;0<=t.X(e);){for(i=Math.max(1,Math.floor(t.ea()/e.ea())),n=48>=(n=Math.ceil(Math.log(i)/Math.LN2))?1:Math.pow(2,n-48),s=(o=po(i)).R(e);vo(s)||0<s.X(t);)s=(o=po(i-=n)).R(e);yo(o)&&(o=go),r=r.add(o),t=bo(t,s)}return new Eo(r,t)}function To(t){for(var e=t.g.length+1,i=[],n=0;n<e;n++)i[n]=t.D(n)<<1|t.D(n-1)>>>31;return new co(i,t.h)}function Mo(t,e){var i=e>>5;e%=32;for(var n=t.g.length-i,r=[],o=0;o<n;o++)r[o]=0<e?t.D(o+i)>>>e|t.D(o+i+1)<<32-e:t.D(o+i);return new co(r,t.h)}(_e=co.prototype).ea=function(){if(vo(this))return-xo(this).ea();for(var t=0,e=1,i=0;i<this.g.length;i++){var n=this.D(i);t+=(0<=n?n:fo+n)*e,e*=fo}return t},_e.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(yo(this))return"0";if(vo(this))return"-"+xo(this).toString(t);for(var e=po(Math.pow(t,6)),i=this,n="";;){var r=So(i,e).g,o=((0<(i=bo(i,r.R(e))).g.length?i.g[0]:i.h)>>>0).toString(t);if(yo(i=r))return o+n;for(;6>o.length;)o="0"+o;n=o+n}},_e.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},_e.X=function(t){return vo(t=bo(this,t))?-1:yo(t)?0:1},_e.abs=function(){return vo(this)?xo(this):this},_e.add=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],n=0,r=0;r<=e;r++){var o=n+(65535&this.D(r))+(65535&t.D(r)),s=(o>>>16)+(this.D(r)>>>16)+(t.D(r)>>>16);n=s>>>16,o&=65535,s&=65535,i[r]=s<<16|o}return new co(i,-2147483648&i[i.length-1]?-1:0)},_e.R=function(t){if(yo(this)||yo(t))return mo;if(vo(this))return vo(t)?xo(this).R(xo(t)):xo(xo(this).R(t));if(vo(t))return xo(this.R(xo(t)));if(0>this.X(_o)&&0>t.X(_o))return po(this.ea()*t.ea());for(var e=this.g.length+t.g.length,i=[],n=0;n<2*e;n++)i[n]=0;for(n=0;n<this.g.length;n++)for(var r=0;r<t.g.length;r++){var o=this.D(n)>>>16,s=65535&this.D(n),a=t.D(r)>>>16,l=65535&t.D(r);i[2*n+2*r]+=s*l,wo(i,2*n+2*r),i[2*n+2*r+1]+=o*l,wo(i,2*n+2*r+1),i[2*n+2*r+1]+=s*a,wo(i,2*n+2*r+1),i[2*n+2*r+2]+=o*a,wo(i,2*n+2*r+2)}for(n=0;n<e;n++)i[n]=i[2*n+1]<<16|i[2*n];for(n=e;n<2*e;n++)i[n]=0;return new co(i,0)},_e.gb=function(t){return So(this,t).h},_e.and=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],n=0;n<e;n++)i[n]=this.D(n)&t.D(n);return new co(i,this.h&t.h)},_e.or=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],n=0;n<e;n++)i[n]=this.D(n)|t.D(n);return new co(i,this.h|t.h)},_e.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],n=0;n<e;n++)i[n]=this.D(n)^t.D(n);return new co(i,this.h^t.h)},io.prototype.createWebChannel=io.prototype.g,no.prototype.send=no.prototype.u,no.prototype.open=no.prototype.m,no.prototype.close=no.prototype.close,an.NO_ERROR=0,an.TIMEOUT=8,an.HTTP_ERROR=6,ln.COMPLETE="complete",hn.EventType=pn,pn.OPEN="a",pn.CLOSE="b",pn.ERROR="c",pn.MESSAGE="d",Mi.prototype.listen=Mi.prototype.O,wr.prototype.listenOnce=wr.prototype.P,wr.prototype.getLastError=wr.prototype.Sa,wr.prototype.getLastErrorCode=wr.prototype.Ia,wr.prototype.getStatus=wr.prototype.da,wr.prototype.getResponseJson=wr.prototype.Wa,wr.prototype.getResponseText=wr.prototype.ja,wr.prototype.send=wr.prototype.ha,wr.prototype.setWithCredentials=wr.prototype.Oa,ao.prototype.digest=ao.prototype.l,ao.prototype.reset=ao.prototype.reset,ao.prototype.update=ao.prototype.j,co.prototype.add=co.prototype.add,co.prototype.multiply=co.prototype.R,co.prototype.modulo=co.prototype.gb,co.prototype.compare=co.prototype.X,co.prototype.toNumber=co.prototype.ea,co.prototype.toString=co.prototype.toString,co.prototype.getBits=co.prototype.D,co.fromNumber=po,co.fromString=function t(e,i){if(0==e.length)throw Error("number format error: empty string");if(2>(i=i||10)||36<i)throw Error("radix out of range: "+i);if("-"==e.charAt(0))return xo(t(e.substring(1),i));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=po(Math.pow(i,8)),r=mo,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),a=parseInt(e.substring(o,o+s),i);8>s?(s=po(Math.pow(i,s)),r=r.R(s).add(po(a))):r=(r=r.R(n)).add(po(a))}return r};var Io=ve.createWebChannelTransport=function(){return new io},Co=ve.getStatEventTarget=function(){return Qi()},Ao=ve.ErrorCode=an,Po=ve.EventType=ln,Lo=ve.Event=Ki,Ro=ve.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Do=ve.FetchXmlHttpFactory=mr,ko=ve.WebChannel=hn,No=ve.XhrIo=wr,Oo=ve.Md5=ao,Fo=ve.Integer=co;const zo="@firebase/firestore";class Bo{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Bo.UNAUTHENTICATED=new Bo(null),Bo.GOOGLE_CREDENTIALS=new Bo("google-credentials-uid"),Bo.FIRST_PARTY=new Bo("first-party-uid"),Bo.MOCK_USER=new Bo("mock-user");let Uo="10.11.1";const Vo=new G("@firebase/firestore");function jo(){return Vo.logLevel}function Go(t,...e){if(Vo.logLevel<=z.DEBUG){const i=e.map(qo);Vo.debug(`Firestore (${Uo}): ${t}`,...i)}}function Ho(t,...e){if(Vo.logLevel<=z.ERROR){const i=e.map(qo);Vo.error(`Firestore (${Uo}): ${t}`,...i)}}function Wo(t,...e){if(Vo.logLevel<=z.WARN){const i=e.map(qo);Vo.warn(`Firestore (${Uo}): ${t}`,...i)}}function qo(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Xo(t="Unexpected state"){const e=`FIRESTORE (${Uo}) INTERNAL ASSERTION FAILED: `+t;throw Ho(e),new Error(e)}function $o(t,e){t||Xo()}function Yo(t,e){return t}const Zo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ko extends x{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Jo{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Qo{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class ts{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Bo.UNAUTHENTICATED)))}shutdown(){}}class es{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class is{constructor(t){this.t=t,this.currentUser=Bo.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let i=this.i;const n=t=>this.i!==i?(i=this.i,e(t)):Promise.resolve();let r=new Jo;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Jo,t.enqueueRetryable((()=>n(this.currentUser)))};const o=()=>{const e=r;t.enqueueRetryable((async()=>{await e.promise,await n(this.currentUser)}))},s=t=>{Go("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit((t=>s(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?s(t):(Go("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Jo)}}),0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Go("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?($o("string"==typeof e.accessToken),new Qo(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return $o(null===t||"string"==typeof t),new Bo(t)}}class ns{constructor(t,e,i){this.l=t,this.h=e,this.P=i,this.type="FirstParty",this.user=Bo.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class rs{constructor(t,e,i){this.l=t,this.h=e,this.P=i}getToken(){return Promise.resolve(new ns(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Bo.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class os{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ss{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const i=t=>{null!=t.error&&Go("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const i=t.token!==this.R;return this.R=t.token,Go("FirebaseAppCheckTokenProvider",`Received ${i?"new":"existing"} token.`),i?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>i(e)))};const n=t=>{Go("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>n(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?n(t):Go("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?($o("string"==typeof t.token),this.R=t.token,new os(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function as(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),i=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(i);else for(let e=0;e<t;e++)i[e]=Math.floor(256*Math.random());return i}class ls{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const i=as(40);for(let n=0;n<i.length;++n)e.length<20&&i[n]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[n]%62))}return e}}function cs(t,e){return t<e?-1:t>e?1:0}function us(t,e,i){return t.length===e.length&&t.every(((t,n)=>i(t,e[n])))}class hs{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ko(Zo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ko(Zo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ko(Zo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ko(Zo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return hs.fromMillis(Date.now())}static fromDate(t){return hs.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),i=Math.floor(1e6*(t-1e3*e));return new hs(e,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?cs(this.nanoseconds,t.nanoseconds):cs(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ds{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ds(t)}static min(){return new ds(new hs(0,0))}static max(){return new ds(new hs(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ps{constructor(t,e,i){void 0===e?e=0:e>t.length&&Xo(),void 0===i?i=t.length-e:i>t.length-e&&Xo(),this.segments=t,this.offset=e,this.len=i}get length(){return this.len}isEqual(t){return 0===ps.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ps?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,i=this.limit();e<i;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const i=Math.min(t.length,e.length);for(let n=0;n<i;n++){const i=t.get(n),r=e.get(n);if(i<r)return-1;if(i>r)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class fs extends ps{construct(t,e,i){return new fs(t,e,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const i of t){if(i.indexOf("//")>=0)throw new Ko(Zo.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);e.push(...i.split("/").filter((t=>t.length>0)))}return new fs(e)}static emptyPath(){return new fs([])}}const ms=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class gs extends ps{construct(t,e,i){return new gs(t,e,i)}static isValidIdentifier(t){return ms.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),gs.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new gs(["__name__"])}static fromServerFormat(t){const e=[];let i="",n=0;const r=()=>{if(0===i.length)throw new Ko(Zo.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(i),i=""};let o=!1;for(;n<t.length;){const e=t[n];if("\\"===e){if(n+1===t.length)throw new Ko(Zo.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[n+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Ko(Zo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);i+=e,n+=2}else"`"===e?(o=!o,n++):"."!==e||o?(i+=e,n++):(r(),n++)}if(r(),o)throw new Ko(Zo.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new gs(e)}static emptyPath(){return new gs([])}}class _s{constructor(t){this.path=t}static fromPath(t){return new _s(fs.fromString(t))}static fromName(t){return new _s(fs.fromString(t).popFirst(5))}static empty(){return new _s(fs.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===fs.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return fs.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new _s(new fs(t.slice()))}}function ys(t){return new vs(t.readTime,t.key,-1)}class vs{constructor(t,e,i){this.readTime=t,this.documentKey=e,this.largestBatchId=i}static min(){return new vs(ds.min(),_s.empty(),-1)}static max(){return new vs(ds.max(),_s.empty(),-1)}}function xs(t,e){let i=t.readTime.compareTo(e.readTime);return 0!==i?i:(i=_s.comparator(t.documentKey,e.documentKey),0!==i?i:cs(t.largestBatchId,e.largestBatchId))}const bs="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ws{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Es(t){if(t.code!==Zo.FAILED_PRECONDITION||t.message!==bs)throw t;Go("LocalStore","Unexpectedly lost primary lease")}class Ss{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Xo(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Ss(((i,n)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(i,n)},this.catchCallback=t=>{this.wrapFailure(e,t).next(i,n)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Ss?e:Ss.resolve(e)}catch(t){return Ss.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Ss.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Ss.reject(e)}static resolve(t){return new Ss(((e,i)=>{e(t)}))}static reject(t){return new Ss(((e,i)=>{i(t)}))}static waitFor(t){return new Ss(((e,i)=>{let n=0,r=0,o=!1;t.forEach((t=>{++n,t.next((()=>{++r,o&&r===n&&e()}),(t=>i(t)))})),o=!0,r===n&&e()}))}static or(t){let e=Ss.resolve(!1);for(const i of t)e=e.next((t=>t?Ss.resolve(t):i()));return e}static forEach(t,e){const i=[];return t.forEach(((t,n)=>{i.push(e.call(this,t,n))})),this.waitFor(i)}static mapArray(t,e){return new Ss(((i,n)=>{const r=t.length,o=new Array(r);let s=0;for(let a=0;a<r;a++){const l=a;e(t[l]).next((t=>{o[l]=t,++s,s===r&&i(o)}),(t=>n(t)))}}))}static doWhile(t,e){return new Ss(((i,n)=>{const r=()=>{!0===t()?e().next((()=>{r()}),n):i()};r()}))}}function Ts(t){return"IndexedDbTransactionError"===t.name}class Ms{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ie(t),this.se=t=>e.writeSequenceNumber(t))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}function Is(t){return null==t}function Cs(t){return 0===t&&1/t==-1/0}Ms.oe=-1;function As(t){let e=0;for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&e++;return e}function Ps(t,e){for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&e(i,t[i])}function Ls(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Rs{constructor(t,e){this.comparator=t,this.root=e||ks.EMPTY}insert(t,e){return new Rs(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ks.BLACK,null,null))}remove(t){return new Rs(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ks.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const i=this.comparator(t,e.key);if(0===i)return e.value;i<0?e=e.left:i>0&&(e=e.right)}return null}indexOf(t){let e=0,i=this.root;for(;!i.isEmpty();){const n=this.comparator(t,i.key);if(0===n)return e+i.left.size;n<0?i=i.left:(e+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,i)=>(t(e,i),!1)))}toString(){const t=[];return this.inorderTraversal(((e,i)=>(t.push(`${e}:${i}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ds(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ds(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ds(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ds(this.root,t,this.comparator,!0)}}class Ds{constructor(t,e,i,n){this.isReverse=n,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?i(t.key,e):1,e&&n&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(0===r){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class ks{constructor(t,e,i,n,r){this.key=t,this.value=e,this.color=null!=i?i:ks.RED,this.left=null!=n?n:ks.EMPTY,this.right=null!=r?r:ks.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,i,n,r){return new ks(null!=t?t:this.key,null!=e?e:this.value,null!=i?i:this.color,null!=n?n:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,i){let n=this;const r=i(t,n.key);return n=r<0?n.copy(null,null,null,n.left.insert(t,e,i),null):0===r?n.copy(null,e,null,null,null):n.copy(null,null,null,null,n.right.insert(t,e,i)),n.fixUp()}removeMin(){if(this.left.isEmpty())return ks.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let i,n=this;if(e(t,n.key)<0)n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===e(t,n.key)){if(n.right.isEmpty())return ks.EMPTY;i=n.right.min(),n=n.copy(i.key,i.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,ks.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,ks.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Xo();if(this.right.isRed())throw Xo();const t=this.left.check();if(t!==this.right.check())throw Xo();return t+(this.isRed()?0:1)}}ks.EMPTY=null,ks.RED=!0,ks.BLACK=!1,ks.EMPTY=new class{constructor(){this.size=0}get key(){throw Xo()}get value(){throw Xo()}get color(){throw Xo()}get left(){throw Xo()}get right(){throw Xo()}copy(t,e,i,n,r){return this}insert(t,e,i){return new ks(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ns{constructor(t){this.comparator=t,this.data=new Rs(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,i)=>(t(e),!1)))}forEachInRange(t,e){const i=this.data.getIteratorFrom(t[0]);for(;i.hasNext();){const n=i.getNext();if(this.comparator(n.key,t[1])>=0)return;e(n.key)}}forEachWhile(t,e){let i;for(i=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();i.hasNext();)if(!t(i.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Os(this.data.getIterator())}getIteratorFrom(t){return new Os(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Ns))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),i=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,n=i.getNext().key;if(0!==this.comparator(t,n))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Ns(this.comparator);return e.data=t,e}}class Os{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Fs{constructor(t){this.fields=t,t.sort(gs.comparator)}static empty(){return new Fs([])}unionWith(t){let e=new Ns(gs.comparator);for(const t of this.fields)e=e.add(t);for(const i of t)e=e.add(i);return new Fs(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return us(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class zs extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Bs{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new zs("Invalid base64 string: "+t):t}}(t);return new Bs(e)}static fromUint8Array(t){const e=function(t){let e="";for(let i=0;i<t.length;++i)e+=String.fromCharCode(t[i]);return e}(t);return new Bs(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return cs(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Bs.EMPTY_BYTE_STRING=new Bs("");const Us=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Vs(t){if($o(!!t),"string"==typeof t){let e=0;const i=Us.exec(t);if($o(!!i),i[1]){let t=i[1];t=(t+"000000000").substr(0,9),e=Number(t)}const n=new Date(t);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:js(t.seconds),nanos:js(t.nanos)}}function js(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Gs(t){return"string"==typeof t?Bs.fromBase64String(t):Bs.fromUint8Array(t)}function Hs(t){var e,i;return"server_timestamp"===(null===(i=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===i?void 0:i.stringValue)}function Ws(t){const e=t.mapValue.fields.__previous_value__;return Hs(e)?Ws(e):e}function qs(t){const e=Vs(t.mapValue.fields.__local_write_time__.timestampValue);return new hs(e.seconds,e.nanos)}class Xs{constructor(t,e,i,n,r,o,s,a,l){this.databaseId=t,this.appId=e,this.persistenceKey=i,this.host=n,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.longPollingOptions=a,this.useFetchStreams=l}}class $s{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new $s("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof $s&&t.projectId===this.projectId&&t.database===this.database}}const Ys={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Zs(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Hs(t)?4:ua(t)?9007199254740991:10:Xo()}function Ks(t,e){if(t===e)return!0;const i=Zs(t);if(i!==Zs(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return qs(t).isEqual(qs(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const i=Vs(t.timestampValue),n=Vs(e.timestampValue);return i.seconds===n.seconds&&i.nanos===n.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Gs(t.bytesValue).isEqual(Gs(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return js(t.geoPointValue.latitude)===js(e.geoPointValue.latitude)&&js(t.geoPointValue.longitude)===js(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return js(t.integerValue)===js(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const i=js(t.doubleValue),n=js(e.doubleValue);return i===n?Cs(i)===Cs(n):isNaN(i)&&isNaN(n)}return!1}(t,e);case 9:return us(t.arrayValue.values||[],e.arrayValue.values||[],Ks);case 10:return function(t,e){const i=t.mapValue.fields||{},n=e.mapValue.fields||{};if(As(i)!==As(n))return!1;for(const t in i)if(i.hasOwnProperty(t)&&(void 0===n[t]||!Ks(i[t],n[t])))return!1;return!0}(t,e);default:return Xo()}}function Js(t,e){return void 0!==(t.values||[]).find((t=>Ks(t,e)))}function Qs(t,e){if(t===e)return 0;const i=Zs(t),n=Zs(e);if(i!==n)return cs(i,n);switch(i){case 0:case 9007199254740991:return 0;case 1:return cs(t.booleanValue,e.booleanValue);case 2:return function(t,e){const i=js(t.integerValue||t.doubleValue),n=js(e.integerValue||e.doubleValue);return i<n?-1:i>n?1:i===n?0:isNaN(i)?isNaN(n)?0:-1:1}(t,e);case 3:return ta(t.timestampValue,e.timestampValue);case 4:return ta(qs(t),qs(e));case 5:return cs(t.stringValue,e.stringValue);case 6:return function(t,e){const i=Gs(t),n=Gs(e);return i.compareTo(n)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const i=t.split("/"),n=e.split("/");for(let t=0;t<i.length&&t<n.length;t++){const e=cs(i[t],n[t]);if(0!==e)return e}return cs(i.length,n.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const i=cs(js(t.latitude),js(e.latitude));return 0!==i?i:cs(js(t.longitude),js(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const i=t.values||[],n=e.values||[];for(let t=0;t<i.length&&t<n.length;++t){const e=Qs(i[t],n[t]);if(e)return e}return cs(i.length,n.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Ys.mapValue&&e===Ys.mapValue)return 0;if(t===Ys.mapValue)return 1;if(e===Ys.mapValue)return-1;const i=t.fields||{},n=Object.keys(i),r=e.fields||{},o=Object.keys(r);n.sort(),o.sort();for(let t=0;t<n.length&&t<o.length;++t){const e=cs(n[t],o[t]);if(0!==e)return e;const s=Qs(i[n[t]],r[o[t]]);if(0!==s)return s}return cs(n.length,o.length)}(t.mapValue,e.mapValue);default:throw Xo()}}function ta(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return cs(t,e);const i=Vs(t),n=Vs(e),r=cs(i.seconds,n.seconds);return 0!==r?r:cs(i.nanos,n.nanos)}function ea(t){return ia(t)}function ia(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Vs(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Gs(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return _s.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",i=!0;for(const n of t.values||[])i?i=!1:e+=",",e+=ia(n);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let i="{",n=!0;for(const r of e)n?n=!1:i+=",",i+=`${r}:${ia(t.fields[r])}`;return i+"}"}(t.mapValue):Xo()}function na(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function ra(t){return!!t&&"integerValue"in t}function oa(t){return!!t&&"arrayValue"in t}function sa(t){return!!t&&"nullValue"in t}function aa(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function la(t){return!!t&&"mapValue"in t}function ca(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ps(t.mapValue.fields,((t,i)=>e.mapValue.fields[t]=ca(i))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(t.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=ca(t.arrayValue.values[i]);return e}return Object.assign({},t)}function ua(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class ha{constructor(t){this.value=t}static empty(){return new ha({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let i=0;i<t.length-1;++i)if(e=(e.mapValue.fields||{})[t.get(i)],!la(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ca(e)}setAll(t){let e=gs.emptyPath(),i={},n=[];t.forEach(((t,r)=>{if(!e.isImmediateParentOf(r)){const t=this.getFieldsMap(e);this.applyChanges(t,i,n),i={},n=[],e=r.popLast()}t?i[r.lastSegment()]=ca(t):n.push(r.lastSegment())}));const r=this.getFieldsMap(e);this.applyChanges(r,i,n)}delete(t){const e=this.field(t.popLast());la(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ks(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let i=0;i<t.length;++i){let n=e.mapValue.fields[t.get(i)];la(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},e.mapValue.fields[t.get(i)]=n),e=n}return e.mapValue.fields}applyChanges(t,e,i){Ps(e,((e,i)=>t[e]=i));for(const e of i)delete t[e]}clone(){return new ha(ca(this.value))}}class da{constructor(t,e,i,n,r,o,s){this.key=t,this.documentType=e,this.version=i,this.readTime=n,this.createTime=r,this.data=o,this.documentState=s}static newInvalidDocument(t){return new da(t,0,ds.min(),ds.min(),ds.min(),ha.empty(),0)}static newFoundDocument(t,e,i,n){return new da(t,1,e,ds.min(),i,n,0)}static newNoDocument(t,e){return new da(t,2,e,ds.min(),ds.min(),ha.empty(),0)}static newUnknownDocument(t,e){return new da(t,3,e,ds.min(),ds.min(),ha.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(ds.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ha.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ha.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ds.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof da&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new da(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class pa{constructor(t,e){this.position=t,this.inclusive=e}}function fa(t,e,i){let n=0;for(let r=0;r<t.position.length;r++){const o=e[r],s=t.position[r];if(n=o.field.isKeyField()?_s.comparator(_s.fromName(s.referenceValue),i.key):Qs(s,i.data.field(o.field)),"desc"===o.dir&&(n*=-1),0!==n)break}return n}function ma(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let i=0;i<t.position.length;i++)if(!Ks(t.position[i],e.position[i]))return!1;return!0}class ga{constructor(t,e="asc"){this.field=t,this.dir=e}}function _a(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class ya{}class va extends ya{constructor(t,e,i){super(),this.field=t,this.op=e,this.value=i}static create(t,e,i){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,i):new Ma(t,e,i):"array-contains"===e?new Pa(t,i):"in"===e?new La(t,i):"not-in"===e?new Ra(t,i):"array-contains-any"===e?new Da(t,i):new va(t,e,i)}static createKeyFieldInFilter(t,e,i){return"in"===e?new Ia(t,i):new Ca(t,i)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Qs(e,this.value)):null!==e&&Zs(this.value)===Zs(e)&&this.matchesComparison(Qs(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Xo()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class xa extends ya{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new xa(t,e)}matches(t){return ba(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function ba(t){return"and"===t.op}function wa(t){return function(t){for(const e of t.filters)if(e instanceof xa)return!1;return!0}(t)&&ba(t)}function Ea(t){if(t instanceof va)return t.field.canonicalString()+t.op.toString()+ea(t.value);if(wa(t))return t.filters.map((t=>Ea(t))).join(",");{const e=t.filters.map((t=>Ea(t))).join(",");return`${t.op}(${e})`}}function Sa(t,e){return t instanceof va?function(t,e){return e instanceof va&&t.op===e.op&&t.field.isEqual(e.field)&&Ks(t.value,e.value)}(t,e):t instanceof xa?function(t,e){return e instanceof xa&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,i,n)=>t&&Sa(i,e.filters[n])),!0)}(t,e):void Xo()}function Ta(t){return t instanceof va?function(t){return`${t.field.canonicalString()} ${t.op} ${ea(t.value)}`}(t):t instanceof xa?function(t){return t.op.toString()+" {"+t.getFilters().map(Ta).join(" ,")+"}"}(t):"Filter"}class Ma extends va{constructor(t,e,i){super(t,e,i),this.key=_s.fromName(i.referenceValue)}matches(t){const e=_s.comparator(t.key,this.key);return this.matchesComparison(e)}}class Ia extends va{constructor(t,e){super(t,"in",e),this.keys=Aa(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Ca extends va{constructor(t,e){super(t,"not-in",e),this.keys=Aa(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Aa(t,e){var i;return((null===(i=e.arrayValue)||void 0===i?void 0:i.values)||[]).map((t=>_s.fromName(t.referenceValue)))}class Pa extends va{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return oa(e)&&Js(e.arrayValue,this.value)}}class La extends va{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Js(this.value.arrayValue,e)}}class Ra extends va{constructor(t,e){super(t,"not-in",e)}matches(t){if(Js(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Js(this.value.arrayValue,e)}}class Da extends va{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!oa(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Js(this.value.arrayValue,t)))}}class ka{constructor(t,e=null,i=[],n=[],r=null,o=null,s=null){this.path=t,this.collectionGroup=e,this.orderBy=i,this.filters=n,this.limit=r,this.startAt=o,this.endAt=s,this.ue=null}}function Na(t,e=null,i=[],n=[],r=null,o=null,s=null){return new ka(t,e,i,n,r,o,s)}function Oa(t){const e=Yo(t);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>Ea(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Is(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>ea(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>ea(t))).join(",")),e.ue=t}return e.ue}function Fa(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<t.orderBy.length;i++)if(!_a(t.orderBy[i],e.orderBy[i]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(!Sa(t.filters[i],e.filters[i]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ma(t.startAt,e.startAt)&&ma(t.endAt,e.endAt)}function za(t){return _s.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Ba{constructor(t,e=null,i=[],n=[],r=null,o="F",s=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=i,this.filters=n,this.limit=r,this.limitType=o,this.startAt=s,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Ua(t){return new Ba(t)}function Va(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function ja(t){return null!==t.collectionGroup}function Ga(t){const e=Yo(t);if(null===e.ce){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",n=function(t){let e=new Ns(gs.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);n.forEach((n=>{t.has(n.canonicalString())||n.isKeyField()||e.ce.push(new ga(n,i))})),t.has(gs.keyField().canonicalString())||e.ce.push(new ga(gs.keyField(),i))}return e.ce}function Ha(t){const e=Yo(t);return e.le||(e.le=function(t,e){if("F"===t.limitType)return Na(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new ga(t.field,e)}));const i=t.endAt?new pa(t.endAt.position,t.endAt.inclusive):null,n=t.startAt?new pa(t.startAt.position,t.startAt.inclusive):null;return Na(t.path,t.collectionGroup,e,t.filters,t.limit,i,n)}}(e,Ga(t))),e.le}function Wa(t,e){const i=t.filters.concat([e]);return new Ba(t.path,t.collectionGroup,t.explicitOrderBy.slice(),i,t.limit,t.limitType,t.startAt,t.endAt)}function qa(t,e,i){return new Ba(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,i,t.startAt,t.endAt)}function Xa(t,e){return Fa(Ha(t),Ha(e))&&t.limitType===e.limitType}function $a(t){return`${Oa(Ha(t))}|lt:${t.limitType}`}function Ya(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>Ta(t))).join(", ")}]`),Is(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>ea(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>ea(t))).join(",")),`Target(${e})`}(Ha(t))}; limitType=${t.limitType})`}function Za(t,e){return e.isFoundDocument()&&function(t,e){const i=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(i):_s.isDocumentKey(t.path)?t.path.isEqual(i):t.path.isImmediateParentOf(i)}(t,e)&&function(t,e){for(const i of Ga(t))if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1;return!0}(t,e)&&function(t,e){for(const i of t.filters)if(!i.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,i){const n=fa(t,e,i);return t.inclusive?n<=0:n<0}(t.startAt,Ga(t),e)||t.endAt&&!function(t,e,i){const n=fa(t,e,i);return t.inclusive?n>=0:n>0}(t.endAt,Ga(t),e))}(t,e)}function Ka(t){return(e,i)=>{let n=!1;for(const r of Ga(t)){const t=Ja(r,e,i);if(0!==t)return t;n=n||r.field.isKeyField()}return 0}}function Ja(t,e,i){const n=t.field.isKeyField()?_s.comparator(e.key,i.key):function(t,e,i){const n=e.data.field(t),r=i.data.field(t);return null!==n&&null!==r?Qs(n,r):Xo()}(t.field,e,i);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return Xo()}}class Qa{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),i=this.inner[e];if(void 0!==i)for(const[e,n]of i)if(this.equalsFn(e,t))return n}has(t){return void 0!==this.get(t)}set(t,e){const i=this.mapKeyFn(t),n=this.inner[i];if(void 0===n)return this.inner[i]=[[t,e]],void this.innerSize++;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return void(n[i]=[t,e]);n.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),i=this.inner[e];if(void 0===i)return!1;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return 1===i.length?delete this.inner[e]:i.splice(n,1),this.innerSize--,!0;return!1}forEach(t){Ps(this.inner,((e,i)=>{for(const[e,n]of i)t(e,n)}))}isEmpty(){return Ls(this.inner)}size(){return this.innerSize}}const tl=new Rs(_s.comparator);function el(){return tl}const il=new Rs(_s.comparator);function nl(...t){let e=il;for(const i of t)e=e.insert(i.key,i);return e}function rl(t){let e=il;return t.forEach(((t,i)=>e=e.insert(t,i.overlayedDocument))),e}function ol(){return al()}function sl(){return al()}function al(){return new Qa((t=>t.toString()),((t,e)=>t.isEqual(e)))}new Rs(_s.comparator);const ll=new Ns(_s.comparator);function cl(...t){let e=ll;for(const i of t)e=e.add(i);return e}const ul=new Ns(cs);function hl(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Cs(e)?"-0":e}}function dl(t){return{integerValue:""+t}}function pl(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!Cs(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?dl(e):hl(t,e)}class fl{constructor(){this._=void 0}}function ml(t,e,i){return t instanceof _l?function(t,e){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Hs(e)&&(e=Ws(e)),e&&(i.fields.__previous_value__=e),{mapValue:i}}(i,e):t instanceof yl?vl(t,e):t instanceof xl?bl(t,e):function(t,e){const i=function(t,e){return t instanceof wl?function(t){return ra(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}(t,e),n=El(i)+El(t.Pe);return ra(i)&&ra(t.Pe)?dl(n):hl(t.serializer,n)}(t,e)}function gl(t,e,i){return t instanceof yl?vl(t,e):t instanceof xl?bl(t,e):i}class _l extends fl{}class yl extends fl{constructor(t){super(),this.elements=t}}function vl(t,e){const i=Sl(e);for(const e of t.elements)i.some((t=>Ks(t,e)))||i.push(e);return{arrayValue:{values:i}}}class xl extends fl{constructor(t){super(),this.elements=t}}function bl(t,e){let i=Sl(e);for(const e of t.elements)i=i.filter((t=>!Ks(t,e)));return{arrayValue:{values:i}}}class wl extends fl{constructor(t,e){super(),this.serializer=t,this.Pe=e}}function El(t){return js(t.integerValue||t.doubleValue)}function Sl(t){return oa(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Tl{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Tl}static exists(t){return new Tl(void 0,t)}static updateTime(t){return new Tl(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ml(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Il{}function Cl(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Fl(t.key,Tl.none()):new Rl(t.key,t.data,Tl.none());{const i=t.data,n=ha.empty();let r=new Ns(gs.comparator);for(let t of e.fields)if(!r.has(t)){let e=i.field(t);null===e&&t.length>1&&(t=t.popLast(),e=i.field(t)),null===e?n.delete(t):n.set(t,e),r=r.add(t)}return new Dl(t.key,n,new Fs(r.toArray()),Tl.none())}}function Al(t,e,i){t instanceof Rl?function(t,e,i){const n=t.value.clone(),r=Nl(t.fieldTransforms,e,i.transformResults);n.setAll(r),e.convertToFoundDocument(i.version,n).setHasCommittedMutations()}(t,e,i):t instanceof Dl?function(t,e,i){if(!Ml(t.precondition,e))return void e.convertToUnknownDocument(i.version);const n=Nl(t.fieldTransforms,e,i.transformResults),r=e.data;r.setAll(kl(t)),r.setAll(n),e.convertToFoundDocument(i.version,r).setHasCommittedMutations()}(t,e,i):function(t,e,i){e.convertToNoDocument(i.version).setHasCommittedMutations()}(0,e,i)}function Pl(t,e,i,n){return t instanceof Rl?function(t,e,i,n){if(!Ml(t.precondition,e))return i;const r=t.value.clone(),o=Ol(t.fieldTransforms,n,e);return r.setAll(o),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null}(t,e,i,n):t instanceof Dl?function(t,e,i,n){if(!Ml(t.precondition,e))return i;const r=Ol(t.fieldTransforms,n,e),o=e.data;return o.setAll(kl(t)),o.setAll(r),e.convertToFoundDocument(e.version,o).setHasLocalMutations(),null===i?null:i.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,i,n):function(t,e,i){return Ml(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):i}(t,e,i)}function Ll(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&us(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof yl&&e instanceof yl||t instanceof xl&&e instanceof xl?us(t.elements,e.elements,Ks):t instanceof wl&&e instanceof wl?Ks(t.Pe,e.Pe):t instanceof _l&&e instanceof _l}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Rl extends Il{constructor(t,e,i,n=[]){super(),this.key=t,this.value=e,this.precondition=i,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class Dl extends Il{constructor(t,e,i,n,r=[]){super(),this.key=t,this.data=e,this.fieldMask=i,this.precondition=n,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function kl(t){const e=new Map;return t.fieldMask.fields.forEach((i=>{if(!i.isEmpty()){const n=t.data.field(i);e.set(i,n)}})),e}function Nl(t,e,i){const n=new Map;$o(t.length===i.length);for(let r=0;r<i.length;r++){const o=t[r],s=o.transform,a=e.data.field(o.field);n.set(o.field,gl(s,a,i[r]))}return n}function Ol(t,e,i){const n=new Map;for(const r of t){const t=r.transform,o=i.data.field(r.field);n.set(r.field,ml(t,o,e))}return n}class Fl extends Il{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class zl{constructor(t,e,i,n){this.batchId=t,this.localWriteTime=e,this.baseMutations=i,this.mutations=n}applyToRemoteDocument(t,e){const i=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const n=this.mutations[e];n.key.isEqual(t.key)&&Al(n,t,i[e])}}applyToLocalView(t,e){for(const i of this.baseMutations)i.key.isEqual(t.key)&&(e=Pl(i,t,e,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(t.key)&&(e=Pl(i,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const i=sl();return this.mutations.forEach((n=>{const r=t.get(n.key),o=r.overlayedDocument;let s=this.applyToLocalView(o,r.mutatedFields);s=e.has(n.key)?null:s;const a=Cl(o,s);null!==a&&i.set(n.key,a),o.isValidDocument()||o.convertToNoDocument(ds.min())})),i}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),cl())}isEqual(t){return this.batchId===t.batchId&&us(this.mutations,t.mutations,((t,e)=>Ll(t,e)))&&us(this.baseMutations,t.baseMutations,((t,e)=>Ll(t,e)))}}class Bl{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ul{constructor(t,e){this.count=t,this.unchangedNames=e}}var Vl,jl;function Gl(t){if(void 0===t)return Ho("GRPC error has no .code"),Zo.UNKNOWN;switch(t){case Vl.OK:return Zo.OK;case Vl.CANCELLED:return Zo.CANCELLED;case Vl.UNKNOWN:return Zo.UNKNOWN;case Vl.DEADLINE_EXCEEDED:return Zo.DEADLINE_EXCEEDED;case Vl.RESOURCE_EXHAUSTED:return Zo.RESOURCE_EXHAUSTED;case Vl.INTERNAL:return Zo.INTERNAL;case Vl.UNAVAILABLE:return Zo.UNAVAILABLE;case Vl.UNAUTHENTICATED:return Zo.UNAUTHENTICATED;case Vl.INVALID_ARGUMENT:return Zo.INVALID_ARGUMENT;case Vl.NOT_FOUND:return Zo.NOT_FOUND;case Vl.ALREADY_EXISTS:return Zo.ALREADY_EXISTS;case Vl.PERMISSION_DENIED:return Zo.PERMISSION_DENIED;case Vl.FAILED_PRECONDITION:return Zo.FAILED_PRECONDITION;case Vl.ABORTED:return Zo.ABORTED;case Vl.OUT_OF_RANGE:return Zo.OUT_OF_RANGE;case Vl.UNIMPLEMENTED:return Zo.UNIMPLEMENTED;case Vl.DATA_LOSS:return Zo.DATA_LOSS;default:return Xo()}}(jl=Vl||(Vl={}))[jl.OK=0]="OK",jl[jl.CANCELLED=1]="CANCELLED",jl[jl.UNKNOWN=2]="UNKNOWN",jl[jl.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",jl[jl.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",jl[jl.NOT_FOUND=5]="NOT_FOUND",jl[jl.ALREADY_EXISTS=6]="ALREADY_EXISTS",jl[jl.PERMISSION_DENIED=7]="PERMISSION_DENIED",jl[jl.UNAUTHENTICATED=16]="UNAUTHENTICATED",jl[jl.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",jl[jl.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",jl[jl.ABORTED=10]="ABORTED",jl[jl.OUT_OF_RANGE=11]="OUT_OF_RANGE",jl[jl.UNIMPLEMENTED=12]="UNIMPLEMENTED",jl[jl.INTERNAL=13]="INTERNAL",jl[jl.UNAVAILABLE=14]="UNAVAILABLE",jl[jl.DATA_LOSS=15]="DATA_LOSS";const Hl=new Fo([4294967295,4294967295],0);function Wl(t){const e=(new TextEncoder).encode(t),i=new Oo;return i.update(e),new Uint8Array(i.digest())}function ql(t){const e=new DataView(t.buffer),i=e.getUint32(0,!0),n=e.getUint32(4,!0),r=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Fo([i,n],0),new Fo([r,o],0)]}class Xl{constructor(t,e,i){if(this.bitmap=t,this.padding=e,this.hashCount=i,e<0||e>=8)throw new $l(`Invalid padding: ${e}`);if(i<0)throw new $l(`Invalid hash count: ${i}`);if(t.length>0&&0===this.hashCount)throw new $l(`Invalid hash count: ${i}`);if(0===t.length&&0!==e)throw new $l(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=Fo.fromNumber(this.Ie)}Ee(t,e,i){let n=t.add(e.multiply(Fo.fromNumber(i)));return 1===n.compare(Hl)&&(n=new Fo([n.getBits(0),n.getBits(1)],0)),n.modulo(this.Te).toNumber()}de(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Ie)return!1;const e=Wl(t),[i,n]=ql(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(i,n,t);if(!this.de(e))return!1}return!0}static create(t,e,i){const n=t%8==0?0:8-t%8,r=new Uint8Array(Math.ceil(t/8)),o=new Xl(r,n,e);return i.forEach((t=>o.insert(t))),o}insert(t){if(0===this.Ie)return;const e=Wl(t),[i,n]=ql(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(i,n,t);this.Ae(e)}}Ae(t){const e=Math.floor(t/8),i=t%8;this.bitmap[e]|=1<<i}}class $l extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Yl{constructor(t,e,i,n,r){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=i,this.documentUpdates=n,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(t,e,i){const n=new Map;return n.set(t,Zl.createSynthesizedTargetChangeForCurrentChange(t,e,i)),new Yl(ds.min(),n,new Rs(cs),el(),cl())}}class Zl{constructor(t,e,i,n,r){this.resumeToken=t,this.current=e,this.addedDocuments=i,this.modifiedDocuments=n,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(t,e,i){return new Zl(i,e,cl(),cl(),cl())}}class Kl{constructor(t,e,i,n){this.Re=t,this.removedTargetIds=e,this.key=i,this.Ve=n}}class Jl{constructor(t,e){this.targetId=t,this.me=e}}class Ql{constructor(t,e,i=Bs.EMPTY_BYTE_STRING,n=null){this.state=t,this.targetIds=e,this.resumeToken=i,this.cause=n}}class tc{constructor(){this.fe=0,this.ge=nc(),this.pe=Bs.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}Ce(){let t=cl(),e=cl(),i=cl();return this.ge.forEach(((n,r)=>{switch(r){case 0:t=t.add(n);break;case 2:e=e.add(n);break;case 1:i=i.add(n);break;default:Xo()}})),new Zl(this.pe,this.ye,t,e,i)}ve(){this.we=!1,this.ge=nc()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,$o(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class ec{constructor(t){this.Le=t,this.Be=new Map,this.ke=el(),this.qe=ic(),this.Qe=new Rs(cs)}Ke(t){for(const e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(const e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,(e=>{const i=this.Ge(e);switch(t.state){case 0:this.ze(e)&&i.De(t.resumeToken);break;case 1:i.Oe(),i.Se||i.ve(),i.De(t.resumeToken);break;case 2:i.Oe(),i.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(i.Ne(),i.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),i.De(t.resumeToken));break;default:Xo()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach(((t,i)=>{this.ze(i)&&e(i)}))}He(t){const e=t.targetId,i=t.me.count,n=this.Je(e);if(n){const r=n.target;if(za(r))if(0===i){const t=new _s(r.path);this.Ue(e,t,da.newNoDocument(t,ds.min()))}else $o(1===i);else{const n=this.Ye(e);if(n!==i){const i=this.Ze(t),r=i?this.Xe(i,t,n):1;if(0!==r){this.je(e);const t=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,t)}}}}}Ze(t){const e=t.me.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:i="",padding:n=0},hashCount:r=0}=e;let o,s;try{o=Gs(i).toUint8Array()}catch(t){if(t instanceof zs)return Wo("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{s=new Xl(o,n,r)}catch(t){return Wo(t instanceof $l?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===s.Ie?null:s}Xe(t,e,i){return e.me.count===i-this.nt(t,e.targetId)?0:2}nt(t,e){const i=this.Le.getRemoteKeysForTarget(e);let n=0;return i.forEach((i=>{const r=this.Le.tt(),o=`projects/${r.projectId}/databases/${r.database}/documents/${i.path.canonicalString()}`;t.mightContain(o)||(this.Ue(e,i,null),n++)})),n}rt(t){const e=new Map;this.Be.forEach(((i,n)=>{const r=this.Je(n);if(r){if(i.current&&za(r.target)){const e=new _s(r.target.path);null!==this.ke.get(e)||this.it(n,e)||this.Ue(n,e,da.newNoDocument(e,t))}i.be&&(e.set(n,i.Ce()),i.ve())}}));let i=cl();this.qe.forEach(((t,e)=>{let n=!0;e.forEachWhile((t=>{const e=this.Je(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(n=!1,!1)})),n&&(i=i.add(t))})),this.ke.forEach(((e,i)=>i.setReadTime(t)));const n=new Yl(t,e,this.Qe,this.ke,i);return this.ke=el(),this.qe=ic(),this.Qe=new Rs(cs),n}$e(t,e){if(!this.ze(t))return;const i=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,i),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,i){if(!this.ze(t))return;const n=this.Ge(t);this.it(t,e)?n.Fe(e,1):n.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),i&&(this.ke=this.ke.insert(e,i))}removeTarget(t){this.Be.delete(t)}Ye(t){const e=this.Ge(t).Ce();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new tc,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new Ns(cs),this.qe=this.qe.insert(t,e)),e}ze(t){const e=null!==this.Je(t);return e||Go("WatchChangeAggregator","Detected inactive target",t),e}Je(t){const e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new tc),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.Ue(t,e,null)}))}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function ic(){return new Rs(_s.comparator)}function nc(){return new Rs(_s.comparator)}const rc={asc:"ASCENDING",desc:"DESCENDING"},oc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},sc={and:"AND",or:"OR"};class ac{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function lc(t,e){return t.useProto3Json||Is(e)?e:{value:e}}function cc(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function uc(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function hc(t){return $o(!!t),ds.fromTimestamp(function(t){const e=Vs(t);return new hs(e.seconds,e.nanos)}(t))}function dc(t,e){return pc(t,e).canonicalString()}function pc(t,e){const i=function(t){return new fs(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?i:i.child(e)}function fc(t){const e=fs.fromString(t);return $o(Ac(e)),e}function mc(t,e){const i=fc(e);if(i.get(1)!==t.databaseId.projectId)throw new Ko(Zo.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+t.databaseId.projectId);if(i.get(3)!==t.databaseId.database)throw new Ko(Zo.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+t.databaseId.database);return new _s(yc(i))}function gc(t,e){return dc(t.databaseId,e)}function _c(t){return new fs(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function yc(t){return $o(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function vc(t,e){return{documents:[gc(t,e.path)]}}function xc(t,e){const i={structuredQuery:{}},n=e.path;let r;null!==e.collectionGroup?(r=n,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=n.popLast(),i.structuredQuery.from=[{collectionId:n.lastSegment()}]),i.parent=gc(t,r);const o=function(t){if(0!==t.length)return Cc(xa.create(t,"and"))}(e.filters);o&&(i.structuredQuery.where=o);const s=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Mc(t.field),direction:Ec(t.dir)}}(t)))}(e.orderBy);s&&(i.structuredQuery.orderBy=s);const a=lc(t,e.limit);return null!==a&&(i.structuredQuery.limit=a),e.startAt&&(i.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{_t:i,parent:r}}function bc(t){let e=function(t){const e=fc(t);return 4===e.length?fs.emptyPath():yc(e)}(t.parent);const i=t.structuredQuery,n=i.from?i.from.length:0;let r=null;if(n>0){$o(1===n);const t=i.from[0];t.allDescendants?r=t.collectionId:e=e.child(t.collectionId)}let o=[];i.where&&(o=function(t){const e=wc(t);return e instanceof xa&&wa(e)?e.getFilters():[e]}(i.where));let s=[];i.orderBy&&(s=function(t){return t.map((t=>function(t){return new ga(Ic(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(i.orderBy));let a=null;i.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Is(e)?null:e}(i.limit));let l=null;i.startAt&&(l=function(t){const e=!!t.before,i=t.values||[];return new pa(i,e)}(i.startAt));let c=null;return i.endAt&&(c=function(t){const e=!t.before,i=t.values||[];return new pa(i,e)}(i.endAt)),function(t,e,i,n,r,o,s,a){return new Ba(t,e,i,n,r,o,s,a)}(e,r,s,o,a,"F",l,c)}function wc(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Ic(t.unaryFilter.field);return va.create(e,"==",{doubleValue:NaN});case"IS_NULL":const i=Ic(t.unaryFilter.field);return va.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const n=Ic(t.unaryFilter.field);return va.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Ic(t.unaryFilter.field);return va.create(r,"!=",{nullValue:"NULL_VALUE"});default:return Xo()}}(t):void 0!==t.fieldFilter?function(t){return va.create(Ic(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Xo()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return xa.create(t.compositeFilter.filters.map((t=>wc(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Xo()}}(t.compositeFilter.op))}(t):Xo()}function Ec(t){return rc[t]}function Sc(t){return oc[t]}function Tc(t){return sc[t]}function Mc(t){return{fieldPath:t.canonicalString()}}function Ic(t){return gs.fromServerFormat(t.fieldPath)}function Cc(t){return t instanceof va?function(t){if("=="===t.op){if(aa(t.value))return{unaryFilter:{field:Mc(t.field),op:"IS_NAN"}};if(sa(t.value))return{unaryFilter:{field:Mc(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(aa(t.value))return{unaryFilter:{field:Mc(t.field),op:"IS_NOT_NAN"}};if(sa(t.value))return{unaryFilter:{field:Mc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Mc(t.field),op:Sc(t.op),value:t.value}}}(t):t instanceof xa?function(t){const e=t.getFilters().map((t=>Cc(t)));return 1===e.length?e[0]:{compositeFilter:{op:Tc(t.op),filters:e}}}(t):Xo()}function Ac(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Pc{constructor(t,e,i,n,r=ds.min(),o=ds.min(),s=Bs.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=i,this.sequenceNumber=n,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s,this.expectedCount=a}withSequenceNumber(t){return new Pc(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Pc(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Pc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Pc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Lc{constructor(t){this.ut=t}}function Rc(t){const e=bc({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?qa(e,e.limit,"L"):e}class Dc{constructor(){}ht(t,e){this.Pt(t,e),e.It()}Pt(t,e){if("nullValue"in t)this.Tt(e,5);else if("booleanValue"in t)this.Tt(e,10),e.Et(t.booleanValue?1:0);else if("integerValue"in t)this.Tt(e,15),e.Et(js(t.integerValue));else if("doubleValue"in t){const i=js(t.doubleValue);isNaN(i)?this.Tt(e,13):(this.Tt(e,15),Cs(i)?e.Et(0):e.Et(i))}else if("timestampValue"in t){let i=t.timestampValue;this.Tt(e,20),"string"==typeof i&&(i=Vs(i)),e.dt(`${i.seconds||""}`),e.Et(i.nanos||0)}else if("stringValue"in t)this.At(t.stringValue,e),this.Rt(e);else if("bytesValue"in t)this.Tt(e,30),e.Vt(Gs(t.bytesValue)),this.Rt(e);else if("referenceValue"in t)this.ft(t.referenceValue,e);else if("geoPointValue"in t){const i=t.geoPointValue;this.Tt(e,45),e.Et(i.latitude||0),e.Et(i.longitude||0)}else"mapValue"in t?ua(t)?this.Tt(e,Number.MAX_SAFE_INTEGER):(this.gt(t.mapValue,e),this.Rt(e)):"arrayValue"in t?(this.yt(t.arrayValue,e),this.Rt(e)):Xo()}At(t,e){this.Tt(e,25),this.wt(t,e)}wt(t,e){e.dt(t)}gt(t,e){const i=t.fields||{};this.Tt(e,55);for(const t of Object.keys(i))this.At(t,e),this.Pt(i[t],e)}yt(t,e){const i=t.values||[];this.Tt(e,50);for(const t of i)this.Pt(t,e)}ft(t,e){this.Tt(e,37),_s.fromName(t).path.forEach((t=>{this.Tt(e,60),this.wt(t,e)}))}Tt(t,e){t.Et(e)}Rt(t){t.Et(2)}}Dc.St=new Dc;class kc{constructor(){this.on=new Nc}addToCollectionParentIndex(t,e){return this.on.add(e),Ss.resolve()}getCollectionParents(t,e){return Ss.resolve(this.on.getEntries(e))}addFieldIndex(t,e){return Ss.resolve()}deleteFieldIndex(t,e){return Ss.resolve()}deleteAllFieldIndexes(t){return Ss.resolve()}createTargetIndexes(t,e){return Ss.resolve()}getDocumentsMatchingTarget(t,e){return Ss.resolve(null)}getIndexType(t,e){return Ss.resolve(0)}getFieldIndexes(t,e){return Ss.resolve([])}getNextCollectionGroupToUpdate(t){return Ss.resolve(null)}getMinOffset(t,e){return Ss.resolve(vs.min())}getMinOffsetFromCollectionGroup(t,e){return Ss.resolve(vs.min())}updateCollectionGroup(t,e,i){return Ss.resolve()}updateIndexEntries(t,e){return Ss.resolve()}}class Nc{constructor(){this.index={}}add(t){const e=t.lastSegment(),i=t.popLast(),n=this.index[e]||new Ns(fs.comparator),r=!n.has(i);return this.index[e]=n.add(i),r}has(t){const e=t.lastSegment(),i=t.popLast(),n=this.index[e];return n&&n.has(i)}getEntries(t){return(this.index[t]||new Ns(fs.comparator)).toArray()}}new Uint8Array(0);class Oc{constructor(t,e,i){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=i}static withCacheSize(t){return new Oc(t,Oc.DEFAULT_COLLECTION_PERCENTILE,Oc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Oc.DEFAULT_COLLECTION_PERCENTILE=10,Oc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Oc.DEFAULT=new Oc(41943040,Oc.DEFAULT_COLLECTION_PERCENTILE,Oc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Oc.DISABLED=new Oc(-1,0,0);class Fc{constructor(t){this.xn=t}next(){return this.xn+=2,this.xn}static On(){return new Fc(0)}static Nn(){return new Fc(-1)}}class zc{constructor(){this.changes=new Qa((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,da.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const i=this.changes.get(e);return void 0!==i?Ss.resolve(i):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Bc{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Uc{constructor(t,e,i,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=i,this.indexManager=n}getDocument(t,e){let i=null;return this.documentOverlayCache.getOverlay(t,e).next((n=>(i=n,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==i&&Pl(i.mutation,t,Fs.empty(),hs.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,cl()).next((()=>e))))}getLocalViewOfDocuments(t,e,i=cl()){const n=ol();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,i).next((t=>{let e=nl();return t.forEach(((t,i)=>{e=e.insert(t,i.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const i=ol();return this.populateOverlays(t,i,e).next((()=>this.computeViews(t,e,i,cl())))}populateOverlays(t,e,i){const n=[];return i.forEach((t=>{e.has(t)||n.push(t)})),this.documentOverlayCache.getOverlays(t,n).next((t=>{t.forEach(((t,i)=>{e.set(t,i)}))}))}computeViews(t,e,i,n){let r=el();const o=al(),s=al();return e.forEach(((t,e)=>{const s=i.get(e.key);n.has(e.key)&&(void 0===s||s.mutation instanceof Dl)?r=r.insert(e.key,e):void 0!==s?(o.set(e.key,s.mutation.getFieldMask()),Pl(s.mutation,e,s.mutation.getFieldMask(),hs.now())):o.set(e.key,Fs.empty())})),this.recalculateAndSaveOverlays(t,r).next((t=>(t.forEach(((t,e)=>o.set(t,e))),e.forEach(((t,e)=>{var i;return s.set(t,new Bc(e,null!==(i=o.get(t))&&void 0!==i?i:null))})),s)))}recalculateAndSaveOverlays(t,e){const i=al();let n=new Rs(((t,e)=>t-e)),r=cl();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const r of t)r.keys().forEach((t=>{const o=e.get(t);if(null===o)return;let s=i.get(t)||Fs.empty();s=r.applyToLocalView(o,s),i.set(t,s);const a=(n.get(r.batchId)||cl()).add(t);n=n.insert(r.batchId,a)}))})).next((()=>{const o=[],s=n.getReverseIterator();for(;s.hasNext();){const n=s.getNext(),a=n.key,l=n.value,c=sl();l.forEach((t=>{if(!r.has(t)){const n=Cl(e.get(t),i.get(t));null!==n&&c.set(t,n),r=r.add(t)}})),o.push(this.documentOverlayCache.saveOverlays(t,a,c))}return Ss.waitFor(o)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,i,n){return function(t){return _s.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):ja(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,i,n):this.getDocumentsMatchingCollectionQuery(t,e,i,n)}getNextDocuments(t,e,i,n){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,i,n).next((r=>{const o=n-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,i.largestBatchId,n-r.size):Ss.resolve(ol());let s=-1,a=r;return o.next((e=>Ss.forEach(e,((e,i)=>(s<i.largestBatchId&&(s=i.largestBatchId),r.get(e)?Ss.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,r))).next((()=>this.computeViews(t,a,e,cl()))).next((t=>({batchId:s,changes:rl(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new _s(e)).next((t=>{let e=nl();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,i,n){const r=e.collectionGroup;let o=nl();return this.indexManager.getCollectionParents(t,r).next((s=>Ss.forEach(s,(s=>{const a=function(t,e){return new Ba(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(r));return this.getDocumentsMatchingCollectionQuery(t,a,i,n).next((t=>{t.forEach(((t,e)=>{o=o.insert(t,e)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(t,e,i,n){let r;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,i.largestBatchId).next((o=>(r=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,i,r,n)))).next((t=>{r.forEach(((e,i)=>{const n=i.getKey();null===t.get(n)&&(t=t.insert(n,da.newInvalidDocument(n)))}));let i=nl();return t.forEach(((t,n)=>{const o=r.get(t);void 0!==o&&Pl(o.mutation,n,Fs.empty(),hs.now()),Za(e,n)&&(i=i.insert(t,n))})),i}))}}class Vc{constructor(t){this.serializer=t,this.ur=new Map,this.cr=new Map}getBundleMetadata(t,e){return Ss.resolve(this.ur.get(e))}saveBundleMetadata(t,e){return this.ur.set(e.id,function(t){return{id:t.id,version:t.version,createTime:hc(t.createTime)}}(e)),Ss.resolve()}getNamedQuery(t,e){return Ss.resolve(this.cr.get(e))}saveNamedQuery(t,e){return this.cr.set(e.name,function(t){return{name:t.name,query:Rc(t.bundledQuery),readTime:hc(t.readTime)}}(e)),Ss.resolve()}}class jc{constructor(){this.overlays=new Rs(_s.comparator),this.lr=new Map}getOverlay(t,e){return Ss.resolve(this.overlays.get(e))}getOverlays(t,e){const i=ol();return Ss.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&i.set(e,t)})))).next((()=>i))}saveOverlays(t,e,i){return i.forEach(((i,n)=>{this.lt(t,e,n)})),Ss.resolve()}removeOverlaysForBatchId(t,e,i){const n=this.lr.get(i);return void 0!==n&&(n.forEach((t=>this.overlays=this.overlays.remove(t))),this.lr.delete(i)),Ss.resolve()}getOverlaysForCollection(t,e,i){const n=ol(),r=e.length+1,o=new _s(e.child("")),s=this.overlays.getIteratorFrom(o);for(;s.hasNext();){const t=s.getNext().value,o=t.getKey();if(!e.isPrefixOf(o.path))break;o.path.length===r&&t.largestBatchId>i&&n.set(t.getKey(),t)}return Ss.resolve(n)}getOverlaysForCollectionGroup(t,e,i,n){let r=new Rs(((t,e)=>t-e));const o=this.overlays.getIterator();for(;o.hasNext();){const t=o.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>i){let e=r.get(t.largestBatchId);null===e&&(e=ol(),r=r.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const s=ol(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>s.set(t,e))),!(s.size()>=n)););return Ss.resolve(s)}lt(t,e,i){const n=this.overlays.get(i.key);if(null!==n){const t=this.lr.get(n.largestBatchId).delete(i.key);this.lr.set(n.largestBatchId,t)}this.overlays=this.overlays.insert(i.key,new Bl(e,i));let r=this.lr.get(e);void 0===r&&(r=cl(),this.lr.set(e,r)),this.lr.set(e,r.add(i.key))}}class Gc{constructor(){this.hr=new Ns(Hc.Pr),this.Ir=new Ns(Hc.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(t,e){const i=new Hc(t,e);this.hr=this.hr.add(i),this.Ir=this.Ir.add(i)}Er(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.dr(new Hc(t,e))}Ar(t,e){t.forEach((t=>this.removeReference(t,e)))}Rr(t){const e=new _s(new fs([])),i=new Hc(e,t),n=new Hc(e,t+1),r=[];return this.Ir.forEachInRange([i,n],(t=>{this.dr(t),r.push(t.key)})),r}Vr(){this.hr.forEach((t=>this.dr(t)))}dr(t){this.hr=this.hr.delete(t),this.Ir=this.Ir.delete(t)}mr(t){const e=new _s(new fs([])),i=new Hc(e,t),n=new Hc(e,t+1);let r=cl();return this.Ir.forEachInRange([i,n],(t=>{r=r.add(t.key)})),r}containsKey(t){const e=new Hc(t,0),i=this.hr.firstAfterOrEqual(e);return null!==i&&t.isEqual(i.key)}}class Hc{constructor(t,e){this.key=t,this.gr=e}static Pr(t,e){return _s.comparator(t.key,e.key)||cs(t.gr,e.gr)}static Tr(t,e){return cs(t.gr,e.gr)||_s.comparator(t.key,e.key)}}class Wc{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.pr=1,this.yr=new Ns(Hc.Pr)}checkEmpty(t){return Ss.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,i,n){const r=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new zl(r,e,i,n);this.mutationQueue.push(o);for(const e of n)this.yr=this.yr.add(new Hc(e.key,r)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Ss.resolve(o)}lookupMutationBatch(t,e){return Ss.resolve(this.wr(e))}getNextMutationBatchAfterBatchId(t,e){const i=e+1,n=this.Sr(i),r=n<0?0:n;return Ss.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return Ss.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(t){return Ss.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const i=new Hc(e,0),n=new Hc(e,Number.POSITIVE_INFINITY),r=[];return this.yr.forEachInRange([i,n],(t=>{const e=this.wr(t.gr);r.push(e)})),Ss.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let i=new Ns(cs);return e.forEach((t=>{const e=new Hc(t,0),n=new Hc(t,Number.POSITIVE_INFINITY);this.yr.forEachInRange([e,n],(t=>{i=i.add(t.gr)}))})),Ss.resolve(this.br(i))}getAllMutationBatchesAffectingQuery(t,e){const i=e.path,n=i.length+1;let r=i;_s.isDocumentKey(r)||(r=r.child(""));const o=new Hc(new _s(r),0);let s=new Ns(cs);return this.yr.forEachWhile((t=>{const e=t.key.path;return!!i.isPrefixOf(e)&&(e.length===n&&(s=s.add(t.gr)),!0)}),o),Ss.resolve(this.br(s))}br(t){const e=[];return t.forEach((t=>{const i=this.wr(t);null!==i&&e.push(i)})),e}removeMutationBatch(t,e){$o(0===this.Dr(e.batchId,"removed")),this.mutationQueue.shift();let i=this.yr;return Ss.forEach(e.mutations,(n=>{const r=new Hc(n.key,e.batchId);return i=i.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,n.key)})).next((()=>{this.yr=i}))}Fn(t){}containsKey(t,e){const i=new Hc(e,0),n=this.yr.firstAfterOrEqual(i);return Ss.resolve(e.isEqual(n&&n.key))}performConsistencyCheck(t){return this.mutationQueue.length,Ss.resolve()}Dr(t,e){return this.Sr(t)}Sr(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}wr(t){const e=this.Sr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class qc{constructor(t){this.Cr=t,this.docs=new Rs(_s.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const i=e.key,n=this.docs.get(i),r=n?n.size:0,o=this.Cr(e);return this.docs=this.docs.insert(i,{document:e.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(t,i.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const i=this.docs.get(e);return Ss.resolve(i?i.document.mutableCopy():da.newInvalidDocument(e))}getEntries(t,e){let i=el();return e.forEach((t=>{const e=this.docs.get(t);i=i.insert(t,e?e.document.mutableCopy():da.newInvalidDocument(t))})),Ss.resolve(i)}getDocumentsMatchingQuery(t,e,i,n){let r=el();const o=e.path,s=new _s(o.child("")),a=this.docs.getIteratorFrom(s);for(;a.hasNext();){const{key:t,value:{document:s}}=a.getNext();if(!o.isPrefixOf(t.path))break;t.path.length>o.length+1||xs(ys(s),i)<=0||(n.has(s.key)||Za(e,s))&&(r=r.insert(s.key,s.mutableCopy()))}return Ss.resolve(r)}getAllFromCollectionGroup(t,e,i,n){Xo()}vr(t,e){return Ss.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Xc(this)}getSize(t){return Ss.resolve(this.size)}}class Xc extends zc{constructor(t){super(),this._r=t}applyChanges(t){const e=[];return this.changes.forEach(((i,n)=>{n.isValidDocument()?e.push(this._r.addEntry(t,n)):this._r.removeEntry(i)})),Ss.waitFor(e)}getFromCache(t,e){return this._r.getEntry(t,e)}getAllFromCache(t,e){return this._r.getEntries(t,e)}}class $c{constructor(t){this.persistence=t,this.Fr=new Qa((t=>Oa(t)),Fa),this.lastRemoteSnapshotVersion=ds.min(),this.highestTargetId=0,this.Mr=0,this.Or=new Gc,this.targetCount=0,this.Nr=Fc.On()}forEachTarget(t,e){return this.Fr.forEach(((t,i)=>e(i))),Ss.resolve()}getLastRemoteSnapshotVersion(t){return Ss.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Ss.resolve(this.Mr)}allocateTargetId(t){return this.highestTargetId=this.Nr.next(),Ss.resolve(this.highestTargetId)}setTargetsMetadata(t,e,i){return i&&(this.lastRemoteSnapshotVersion=i),e>this.Mr&&(this.Mr=e),Ss.resolve()}kn(t){this.Fr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Nr=new Fc(e),this.highestTargetId=e),t.sequenceNumber>this.Mr&&(this.Mr=t.sequenceNumber)}addTargetData(t,e){return this.kn(e),this.targetCount+=1,Ss.resolve()}updateTargetData(t,e){return this.kn(e),Ss.resolve()}removeTargetData(t,e){return this.Fr.delete(e.target),this.Or.Rr(e.targetId),this.targetCount-=1,Ss.resolve()}removeTargets(t,e,i){let n=0;const r=[];return this.Fr.forEach(((o,s)=>{s.sequenceNumber<=e&&null===i.get(s.targetId)&&(this.Fr.delete(o),r.push(this.removeMatchingKeysForTargetId(t,s.targetId)),n++)})),Ss.waitFor(r).next((()=>n))}getTargetCount(t){return Ss.resolve(this.targetCount)}getTargetData(t,e){const i=this.Fr.get(e)||null;return Ss.resolve(i)}addMatchingKeys(t,e,i){return this.Or.Er(e,i),Ss.resolve()}removeMatchingKeys(t,e,i){this.Or.Ar(e,i);const n=this.persistence.referenceDelegate,r=[];return n&&e.forEach((e=>{r.push(n.markPotentiallyOrphaned(t,e))})),Ss.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this.Or.Rr(e),Ss.resolve()}getMatchingKeysForTargetId(t,e){const i=this.Or.mr(e);return Ss.resolve(i)}containsKey(t,e){return Ss.resolve(this.Or.containsKey(e))}}class Yc{constructor(t,e){this.Lr={},this.overlays={},this.Br=new Ms(0),this.kr=!1,this.kr=!0,this.referenceDelegate=t(this),this.qr=new $c(this),this.indexManager=new kc,this.remoteDocumentCache=function(t){return new qc(t)}((t=>this.referenceDelegate.Qr(t))),this.serializer=new Lc(e),this.Kr=new Vc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new jc,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let i=this.Lr[t.toKey()];return i||(i=new Wc(e,this.referenceDelegate),this.Lr[t.toKey()]=i),i}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(t,e,i){Go("MemoryPersistence","Starting transaction:",t);const n=new Zc(this.Br.next());return this.referenceDelegate.$r(),i(n).next((t=>this.referenceDelegate.Ur(n).next((()=>t)))).toPromise().then((t=>(n.raiseOnCommittedEvent(),t)))}Wr(t,e){return Ss.or(Object.values(this.Lr).map((i=>()=>i.containsKey(t,e))))}}class Zc extends ws{constructor(t){super(),this.currentSequenceNumber=t}}class Kc{constructor(t){this.persistence=t,this.Gr=new Gc,this.zr=null}static jr(t){return new Kc(t)}get Hr(){if(this.zr)return this.zr;throw Xo()}addReference(t,e,i){return this.Gr.addReference(i,e),this.Hr.delete(i.toString()),Ss.resolve()}removeReference(t,e,i){return this.Gr.removeReference(i,e),this.Hr.add(i.toString()),Ss.resolve()}markPotentiallyOrphaned(t,e){return this.Hr.add(e.toString()),Ss.resolve()}removeTarget(t,e){this.Gr.Rr(e.targetId).forEach((t=>this.Hr.add(t.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Hr.add(t.toString())))})).next((()=>i.removeTargetData(t,e)))}$r(){this.zr=new Set}Ur(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ss.forEach(this.Hr,(i=>{const n=_s.fromPath(i);return this.Jr(t,n).next((t=>{t||e.removeEntry(n,ds.min())}))})).next((()=>(this.zr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Jr(t,e).next((t=>{t?this.Hr.delete(e.toString()):this.Hr.add(e.toString())}))}Qr(t){return 0}Jr(t,e){return Ss.or([()=>Ss.resolve(this.Gr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Wr(t,e)])}}class Jc{constructor(t,e,i,n){this.targetId=t,this.fromCache=e,this.ki=i,this.qi=n}static Qi(t,e){let i=cl(),n=cl();for(const t of e.docChanges)switch(t.type){case 0:i=i.add(t.doc.key);break;case 1:n=n.add(t.doc.key)}return new Jc(t,e.fromCache,i,n)}}class Qc{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class tu{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=!f()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(t){const e=t.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}(p())>0?6:4}initialize(t,e){this.Gi=t,this.indexManager=e,this.Ki=!0}getDocumentsMatchingQuery(t,e,i,n){const r={result:null};return this.zi(t,e).next((t=>{r.result=t})).next((()=>{if(!r.result)return this.ji(t,e,n,i).next((t=>{r.result=t}))})).next((()=>{if(r.result)return;const i=new Qc;return this.Hi(t,e,i).next((n=>{if(r.result=n,this.$i)return this.Ji(t,e,i,n.size)}))})).next((()=>r.result))}Ji(t,e,i,n){return i.documentReadCount<this.Ui?(jo()<=z.DEBUG&&Go("QueryEngine","SDK will not create cache indexes for query:",Ya(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),Ss.resolve()):(jo()<=z.DEBUG&&Go("QueryEngine","Query:",Ya(e),"scans",i.documentReadCount,"local documents and returns",n,"documents as results."),i.documentReadCount>this.Wi*n?(jo()<=z.DEBUG&&Go("QueryEngine","The SDK decides to create cache indexes for query:",Ya(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ha(e))):Ss.resolve())}zi(t,e){if(Va(e))return Ss.resolve(null);let i=Ha(e);return this.indexManager.getIndexType(t,i).next((n=>0===n?null:(null!==e.limit&&1===n&&(e=qa(e,null,"F"),i=Ha(e)),this.indexManager.getDocumentsMatchingTarget(t,i).next((n=>{const r=cl(...n);return this.Gi.getDocuments(t,r).next((n=>this.indexManager.getMinOffset(t,i).next((i=>{const o=this.Yi(e,n);return this.Zi(e,o,r,i.readTime)?this.zi(t,qa(e,null,"F")):this.Xi(t,o,e,i)}))))})))))}ji(t,e,i,n){return Va(e)||n.isEqual(ds.min())?Ss.resolve(null):this.Gi.getDocuments(t,i).next((r=>{const o=this.Yi(e,r);return this.Zi(e,o,i,n)?Ss.resolve(null):(jo()<=z.DEBUG&&Go("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Ya(e)),this.Xi(t,o,e,function(t,e){const i=t.toTimestamp().seconds,n=t.toTimestamp().nanoseconds+1,r=ds.fromTimestamp(1e9===n?new hs(i+1,0):new hs(i,n));return new vs(r,_s.empty(),e)}(n,-1)).next((t=>t)))}))}Yi(t,e){let i=new Ns(Ka(t));return e.forEach(((e,n)=>{Za(t,n)&&(i=i.add(n))})),i}Zi(t,e,i,n){if(null===t.limit)return!1;if(i.size!==e.size)return!0;const r="F"===t.limitType?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(n)>0)}Hi(t,e,i){return jo()<=z.DEBUG&&Go("QueryEngine","Using full collection scan to execute query:",Ya(e)),this.Gi.getDocumentsMatchingQuery(t,e,vs.min(),i)}Xi(t,e,i,n){return this.Gi.getDocumentsMatchingQuery(t,i,n).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class eu{constructor(t,e,i,n){this.persistence=t,this.es=e,this.serializer=n,this.ts=new Rs(cs),this.ns=new Qa((t=>Oa(t)),Fa),this.rs=new Map,this.ss=t.getRemoteDocumentCache(),this.qr=t.getTargetCache(),this.Kr=t.getBundleCache(),this.os(i)}os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Uc(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ts)))}}async function iu(t,e){const i=Yo(t);return await i.persistence.runTransaction("Handle user change","readonly",(t=>{let n;return i.mutationQueue.getAllMutationBatches(t).next((r=>(n=r,i.os(e),i.mutationQueue.getAllMutationBatches(t)))).next((e=>{const r=[],o=[];let s=cl();for(const t of n){r.push(t.batchId);for(const e of t.mutations)s=s.add(e.key)}for(const t of e){o.push(t.batchId);for(const e of t.mutations)s=s.add(e.key)}return i.localDocuments.getDocuments(t,s).next((t=>({_s:t,removedBatchIds:r,addedBatchIds:o})))}))}))}function nu(t){const e=Yo(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.qr.getLastRemoteSnapshotVersion(t)))}async function ru(t,e,i){const n=Yo(t),r=n.ts.get(e),o=i?"readwrite":"readwrite-primary";try{i||await n.persistence.runTransaction("Release target",o,(t=>n.persistence.referenceDelegate.removeTarget(t,r)))}catch(t){if(!Ts(t))throw t;Go("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}n.ts=n.ts.remove(e),n.ns.delete(r.target)}function ou(t,e,i){const n=Yo(t);let r=ds.min(),o=cl();return n.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,i){const n=Yo(t),r=n.ns.get(i);return void 0!==r?Ss.resolve(n.ts.get(r)):n.qr.getTargetData(e,i)}(n,t,Ha(e)).next((e=>{if(e)return r=e.lastLimboFreeSnapshotVersion,n.qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{o=t}))})).next((()=>n.es.getDocumentsMatchingQuery(t,e,i?r:ds.min(),i?o:cl()))).next((t=>(function(t,e,i){let n=t.rs.get(e)||ds.min();i.forEach(((t,e)=>{e.readTime.compareTo(n)>0&&(n=e.readTime)})),t.rs.set(e,n)}(n,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,ls:o})))))}class su{constructor(){this.activeTargetIds=ul}ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}As(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Es(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class au{constructor(){this.eo=new su,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,i){}addLocalQueryTarget(t){return this.eo.ds(t),this.no[t]||"not-current"}updateQueryState(t,e,i){this.no[t]=e}removeLocalQueryTarget(t){this.eo.As(t)}isLocalQueryTarget(t){return this.eo.activeTargetIds.has(t)}clearQueryState(t){delete this.no[t]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(t){return this.eo.activeTargetIds.has(t)}start(){return this.eo=new su,Promise.resolve()}handleUserChange(t,e,i){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class lu{ro(t){}shutdown(){}}class cu{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(t){this.ao.push(t)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){Go("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ao)t(0)}_o(){Go("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ao)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let uu=null;function hu(){return null===uu?uu=268435456+Math.round(2147483648*Math.random()):uu++,"0x"+uu.toString(16)}const du={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class pu{constructor(t){this.co=t.co,this.lo=t.lo}ho(t){this.Po=t}Io(t){this.To=t}Eo(t){this.Ao=t}onMessage(t){this.Ro=t}close(){this.lo()}send(t){this.co(t)}Vo(){this.Po()}mo(){this.To()}fo(t){this.Ao(t)}po(t){this.Ro(t)}}const fu="WebChannelConnection";class mu extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.yo=e+"://"+t.host,this.wo=`projects/${i}/databases/${n}`,this.So="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${n}`}get bo(){return!1}Do(t,e,i,n,r){const o=hu(),s=this.Co(t,e.toUriEncodedString());Go("RestConnection",`Sending RPC '${t}' ${o}:`,s,i);const a={"google-cloud-resource-prefix":this.wo,"x-goog-request-params":this.So};return this.vo(a,n,r),this.Fo(t,s,a,i).then((e=>(Go("RestConnection",`Received RPC '${t}' ${o}: `,e),e)),(e=>{throw Wo("RestConnection",`RPC '${t}' ${o} failed with error: `,e,"url: ",s,"request:",i),e}))}Mo(t,e,i,n,r,o){return this.Do(t,e,i,n,r)}vo(t,e,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Uo,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,i)=>t[i]=e)),i&&i.headers.forEach(((e,i)=>t[i]=e))}Co(t,e){const i=du[t];return`${this.yo}/v1/${e}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Fo(t,e,i,n){const r=hu();return new Promise(((o,s)=>{const a=new No;a.setWithCredentials(!0),a.listenOnce(Po.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Ao.NO_ERROR:const e=a.getResponseJson();Go(fu,`XHR for RPC '${t}' ${r} received:`,JSON.stringify(e)),o(e);break;case Ao.TIMEOUT:Go(fu,`RPC '${t}' ${r} timed out`),s(new Ko(Zo.DEADLINE_EXCEEDED,"Request time out"));break;case Ao.HTTP_ERROR:const i=a.getStatus();if(Go(fu,`RPC '${t}' ${r} failed with status:`,i,"response text:",a.getResponseText()),i>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Zo).indexOf(e)>=0?e:Zo.UNKNOWN}(e.status);s(new Ko(t,e.message))}else s(new Ko(Zo.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new Ko(Zo.UNAVAILABLE,"Connection failed."));break;default:Xo()}}finally{Go(fu,`RPC '${t}' ${r} completed.`)}}));const l=JSON.stringify(n);Go(fu,`RPC '${t}' ${r} sending request:`,n),a.send(e,"POST",l,i,15)}))}xo(t,e,i){const n=hu(),r=[this.yo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Io(),s=Co(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.xmlHttpFactory=new Do({})),this.vo(a.initMessageHeaders,e,i),a.encodeInitMessageHeaders=!0;const c=r.join("");Go(fu,`Creating RPC '${t}' stream ${n}: ${c}`,a);const u=o.createWebChannel(c,a);let h=!1,d=!1;const p=new pu({co:e=>{d?Go(fu,`Not sending because RPC '${t}' stream ${n} is closed:`,e):(h||(Go(fu,`Opening RPC '${t}' stream ${n} transport.`),u.open(),h=!0),Go(fu,`RPC '${t}' stream ${n} sending:`,e),u.send(e))},lo:()=>u.close()}),f=(t,e,i)=>{t.listen(e,(t=>{try{i(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return f(u,ko.EventType.OPEN,(()=>{d||(Go(fu,`RPC '${t}' stream ${n} transport opened.`),p.Vo())})),f(u,ko.EventType.CLOSE,(()=>{d||(d=!0,Go(fu,`RPC '${t}' stream ${n} transport closed`),p.fo())})),f(u,ko.EventType.ERROR,(e=>{d||(d=!0,Wo(fu,`RPC '${t}' stream ${n} transport errored:`,e),p.fo(new Ko(Zo.UNAVAILABLE,"The operation could not be completed")))})),f(u,ko.EventType.MESSAGE,(e=>{var i;if(!d){const r=e.data[0];$o(!!r);const o=r,s=o.error||(null===(i=o[0])||void 0===i?void 0:i.error);if(s){Go(fu,`RPC '${t}' stream ${n} received error:`,s);const e=s.status;let i=function(t){const e=Vl[t];if(void 0!==e)return Gl(e)}(e),r=s.message;void 0===i&&(i=Zo.INTERNAL,r="Unknown error status: "+e+" with message "+s.message),d=!0,p.fo(new Ko(i,r)),u.close()}else Go(fu,`RPC '${t}' stream ${n} received:`,r),p.po(r)}})),f(s,Lo.STAT_EVENT,(e=>{e.stat===Ro.PROXY?Go(fu,`RPC '${t}' stream ${n} detected buffering proxy`):e.stat===Ro.NOPROXY&&Go(fu,`RPC '${t}' stream ${n} detected no buffering proxy`)})),setTimeout((()=>{p.mo()}),0),p}}function gu(){return"undefined"!=typeof document?document:null}function _u(t){return new ac(t,!0)}class yu{constructor(t,e,i=1e3,n=1.5,r=6e4){this.si=t,this.timerId=e,this.Oo=i,this.No=n,this.Lo=r,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(t){this.cancel();const e=Math.floor(this.Bo+this.$o()),i=Math.max(0,Date.now()-this.qo),n=Math.max(0,e-i);n>0&&Go("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.Bo} ms, delay with jitter: ${e} ms, last attempt: ${i} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,n,(()=>(this.qo=Date.now(),t()))),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){null!==this.ko&&(this.ko.skipDelay(),this.ko=null)}cancel(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}}class vu{constructor(t,e,i,n,r,o,s,a){this.si=t,this.Wo=i,this.Go=n,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=s,this.listener=a,this.state=0,this.zo=0,this.jo=null,this.Ho=null,this.stream=null,this.Jo=new yu(t,e)}Yo(){return 1===this.state||5===this.state||this.Zo()}Zo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Xo()}async stop(){this.Yo()&&await this.close(0)}e_(){this.state=0,this.Jo.reset()}t_(){this.Zo()&&null===this.jo&&(this.jo=this.si.enqueueAfterDelay(this.Wo,6e4,(()=>this.n_())))}r_(t){this.i_(),this.stream.send(t)}async n_(){if(this.Zo())return this.close(0)}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}async close(t,e){this.i_(),this.s_(),this.Jo.cancel(),this.zo++,4!==t?this.Jo.reset():e&&e.code===Zo.RESOURCE_EXHAUSTED?(Ho(e.toString()),Ho("Using maximum backoff delay to prevent overloading the backend."),this.Jo.Qo()):e&&e.code===Zo.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.o_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Eo(e)}o_(){}auth(){this.state=1;const t=this.__(this.zo),e=this.zo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,i])=>{this.zo===e&&this.a_(t,i)}),(e=>{t((()=>{const t=new Ko(Zo.UNKNOWN,"Fetching auth token failed: "+e.message);return this.u_(t)}))}))}a_(t,e){const i=this.__(this.zo);this.stream=this.c_(t,e),this.stream.ho((()=>{i((()=>this.listener.ho()))})),this.stream.Io((()=>{i((()=>(this.state=2,this.Ho=this.si.enqueueAfterDelay(this.Go,1e4,(()=>(this.Zo()&&(this.state=3),Promise.resolve()))),this.listener.Io())))})),this.stream.Eo((t=>{i((()=>this.u_(t)))})),this.stream.onMessage((t=>{i((()=>this.onMessage(t)))}))}Xo(){this.state=5,this.Jo.Ko((async()=>{this.state=0,this.start()}))}u_(t){return Go("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}__(t){return e=>{this.si.enqueueAndForget((()=>this.zo===t?e():(Go("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class xu extends vu{constructor(t,e,i,n,r,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,i,n,o),this.serializer=r}c_(t,e){return this.connection.xo("Listen",t,e)}onMessage(t){this.Jo.reset();const e=function(t,e){let i;if("targetChange"in e){e.targetChange;const n=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Xo()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],o=function(t,e){return t.useProto3Json?($o(void 0===e||"string"==typeof e),Bs.fromBase64String(e||"")):($o(void 0===e||e instanceof Buffer||e instanceof Uint8Array),Bs.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=e.targetChange.cause,a=s&&function(t){const e=void 0===t.code?Zo.UNKNOWN:Gl(t.code);return new Ko(e,t.message||"")}(s);i=new Ql(n,r,o,a||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const r=mc(t,n.document.name),o=hc(n.document.updateTime),s=n.document.createTime?hc(n.document.createTime):ds.min(),a=new ha({mapValue:{fields:n.document.fields}}),l=da.newFoundDocument(r,o,s,a),c=n.targetIds||[],u=n.removedTargetIds||[];i=new Kl(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const r=mc(t,n.document),o=n.readTime?hc(n.readTime):ds.min(),s=da.newNoDocument(r,o),a=n.removedTargetIds||[];i=new Kl([],a,s.key,s)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const r=mc(t,n.document),o=n.removedTargetIds||[];i=new Kl([],o,r,null)}else{if(!("filter"in e))return Xo();{e.filter;const t=e.filter;t.targetId;const{count:n=0,unchangedNames:r}=t,o=new Ul(n,r),s=t.targetId;i=new Jl(s,o)}}return i}(this.serializer,t),i=function(t){if(!("targetChange"in t))return ds.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?ds.min():e.readTime?hc(e.readTime):ds.min()}(t);return this.listener.l_(e,i)}h_(t){const e={};e.database=_c(this.serializer),e.addTarget=function(t,e){let i;const n=e.target;if(i=za(n)?{documents:vc(t,n)}:{query:xc(t,n)._t},i.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){i.resumeToken=uc(t,e.resumeToken);const n=lc(t,e.expectedCount);null!==n&&(i.expectedCount=n)}else if(e.snapshotVersion.compareTo(ds.min())>0){i.readTime=cc(t,e.snapshotVersion.toTimestamp());const n=lc(t,e.expectedCount);null!==n&&(i.expectedCount=n)}return i}(this.serializer,t);const i=function(t,e){const i=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Xo()}}(e.purpose);return null==i?null:{"goog-listen-tags":i}}(this.serializer,t);i&&(e.labels=i),this.r_(e)}P_(t){const e={};e.database=_c(this.serializer),e.removeTarget=t,this.r_(e)}}class bu extends class{}{constructor(t,e,i,n){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=i,this.serializer=n,this.V_=!1}m_(){if(this.V_)throw new Ko(Zo.FAILED_PRECONDITION,"The client has already been terminated.")}Do(t,e,i,n){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,o])=>this.connection.Do(t,pc(e,i),n,r,o))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Zo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Ko(Zo.UNKNOWN,t.toString())}))}Mo(t,e,i,n,r){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,s])=>this.connection.Mo(t,pc(e,i),n,o,s,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Zo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Ko(Zo.UNKNOWN,t.toString())}))}terminate(){this.V_=!0,this.connection.terminate()}}class wu{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve()))))}D_(t){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.S_("Offline")))}set(t){this.C_(),this.g_=0,"Online"===t&&(this.y_=!1),this.S_(t)}S_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}b_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(Ho(e),this.y_=!1):Go("OnlineStateTracker",e)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class Eu{constructor(t,e,i,n,r){this.localStore=t,this.datastore=e,this.asyncQueue=i,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=r,this.O_.ro((t=>{i.enqueueAndForget((async()=>{Ru(this)&&(Go("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Yo(t);e.M_.add(4),await Tu(e),e.N_.set("Unknown"),e.M_.delete(4),await Su(e)}(this))}))})),this.N_=new wu(i,n)}}async function Su(t){if(Ru(t))for(const e of t.x_)await e(!0)}async function Tu(t){for(const e of t.x_)await e(!1)}function Mu(t,e){const i=Yo(t);i.F_.has(e.targetId)||(i.F_.set(e.targetId,e),Lu(i)?Pu(i):Uu(i).Zo()&&Cu(i,e))}function Iu(t,e){const i=Yo(t),n=Uu(i);i.F_.delete(e),n.Zo()&&Au(i,e),0===i.F_.size&&(n.Zo()?n.t_():Ru(i)&&i.N_.set("Unknown"))}function Cu(t,e){if(t.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ds.min())>0){const i=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}Uu(t).h_(e)}function Au(t,e){t.L_.xe(e),Uu(t).P_(e)}function Pu(t){t.L_=new ec({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.F_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),Uu(t).start(),t.N_.w_()}function Lu(t){return Ru(t)&&!Uu(t).Yo()&&t.F_.size>0}function Ru(t){return 0===Yo(t).M_.size}function Du(t){t.L_=void 0}async function ku(t){t.N_.set("Online")}async function Nu(t){t.F_.forEach(((e,i)=>{Cu(t,e)}))}async function Ou(t,e){Du(t),Lu(t)?(t.N_.D_(e),Pu(t)):t.N_.set("Unknown")}async function Fu(t,e,i){if(t.N_.set("Online"),e instanceof Ql&&2===e.state&&e.cause)try{await async function(t,e){const i=e.cause;for(const n of e.targetIds)t.F_.has(n)&&(await t.remoteSyncer.rejectListen(n,i),t.F_.delete(n),t.L_.removeTarget(n))}(t,e)}catch(i){Go("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),await zu(t,i)}else if(e instanceof Kl?t.L_.Ke(e):e instanceof Jl?t.L_.He(e):t.L_.We(e),!i.isEqual(ds.min()))try{const e=await nu(t.localStore);i.compareTo(e)>=0&&await function(t,e){const i=t.L_.rt(e);return i.targetChanges.forEach(((i,n)=>{if(i.resumeToken.approximateByteSize()>0){const r=t.F_.get(n);r&&t.F_.set(n,r.withResumeToken(i.resumeToken,e))}})),i.targetMismatches.forEach(((e,i)=>{const n=t.F_.get(e);if(!n)return;t.F_.set(e,n.withResumeToken(Bs.EMPTY_BYTE_STRING,n.snapshotVersion)),Au(t,e);const r=new Pc(n.target,e,i,n.sequenceNumber);Cu(t,r)})),t.remoteSyncer.applyRemoteEvent(i)}(t,i)}catch(e){Go("RemoteStore","Failed to raise snapshot:",e),await zu(t,e)}}async function zu(t,e,i){if(!Ts(e))throw e;t.M_.add(1),await Tu(t),t.N_.set("Offline"),i||(i=()=>nu(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Go("RemoteStore","Retrying IndexedDB access"),await i(),t.M_.delete(1),await Su(t)}))}async function Bu(t,e){const i=Yo(t);i.asyncQueue.verifyOperationInProgress(),Go("RemoteStore","RemoteStore received new credentials");const n=Ru(i);i.M_.add(3),await Tu(i),n&&i.N_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.M_.delete(3),await Su(i)}function Uu(t){return t.B_||(t.B_=function(t,e,i){const n=Yo(t);return n.m_(),new xu(e,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,i)}(t.datastore,t.asyncQueue,{ho:ku.bind(null,t),Io:Nu.bind(null,t),Eo:Ou.bind(null,t),l_:Fu.bind(null,t)}),t.x_.push((async e=>{e?(t.B_.e_(),Lu(t)?Pu(t):t.N_.set("Unknown")):(await t.B_.stop(),Du(t))}))),t.B_}class Vu{constructor(t,e,i,n,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=i,this.op=n,this.removalCallback=r,this.deferred=new Jo,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,i,n,r){const o=Date.now()+i,s=new Vu(t,e,o,n,r);return s.start(i),s}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ko(Zo.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ju(t,e){if(Ho("AsyncQueue",`${e}: ${t}`),Ts(t))return new Ko(Zo.UNAVAILABLE,`${e}: ${t}`);throw t}class Gu{constructor(t){this.comparator=t?(e,i)=>t(e,i)||_s.comparator(e.key,i.key):(t,e)=>_s.comparator(t.key,e.key),this.keyedMap=nl(),this.sortedSet=new Rs(this.comparator)}static emptySet(t){return new Gu(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,i)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Gu))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),i=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,n=i.getNext().key;if(!t.isEqual(n))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const i=new Gu;return i.comparator=this.comparator,i.keyedMap=t,i.sortedSet=e,i}}class Hu{constructor(){this.q_=new Rs(_s.comparator)}track(t){const e=t.doc.key,i=this.q_.get(e);i?0!==t.type&&3===i.type?this.q_=this.q_.insert(e,t):3===t.type&&1!==i.type?this.q_=this.q_.insert(e,{type:i.type,doc:t.doc}):2===t.type&&2===i.type?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===i.type?this.q_=this.q_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===i.type?this.q_=this.q_.remove(e):1===t.type&&2===i.type?this.q_=this.q_.insert(e,{type:1,doc:i.doc}):0===t.type&&1===i.type?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):Xo():this.q_=this.q_.insert(e,t)}Q_(){const t=[];return this.q_.inorderTraversal(((e,i)=>{t.push(i)})),t}}class Wu{constructor(t,e,i,n,r,o,s,a,l){this.query=t,this.docs=e,this.oldDocs=i,this.docChanges=n,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(t,e,i,n,r){const o=[];return e.forEach((t=>{o.push({type:0,doc:t})})),new Wu(t,e,Gu.emptySet(e),o,i,n,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Xa(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,i=t.docChanges;if(e.length!==i.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==i[t].type||!e[t].doc.isEqual(i[t].doc))return!1;return!0}}class qu{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some((t=>t.G_()))}}class Xu{constructor(){this.queries=new Qa((t=>$a(t)),Xa),this.onlineState="Unknown",this.z_=new Set}}function $u(t,e){const i=Yo(t);let n=!1;for(const t of e){const e=t.query,r=i.queries.get(e);if(r){for(const e of r.U_)e.H_(t)&&(n=!0);r.K_=t}}n&&Zu(i)}function Yu(t,e,i){const n=Yo(t),r=n.queries.get(e);if(r)for(const t of r.U_)t.onError(i);n.queries.delete(e)}function Zu(t){t.z_.forEach((t=>{t.next()}))}var Ku,Ju;(Ju=Ku||(Ku={})).J_="default",Ju.Cache="cache";class Qu{constructor(t,e,i){this.query=t,this.Y_=e,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=i||{}}H_(t){if(!this.options.includeMetadataChanges){const e=[];for(const i of t.docChanges)3!==i.type&&e.push(i);t=new Wu(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Z_?this.ea(t)&&(this.Y_.next(t),e=!0):this.ta(t,this.onlineState)&&(this.na(t),e=!0),this.X_=t,e}onError(t){this.Y_.error(t)}j_(t){this.onlineState=t;let e=!1;return this.X_&&!this.Z_&&this.ta(this.X_,t)&&(this.na(this.X_),e=!0),e}ta(t,e){if(!t.fromCache)return!0;if(!this.G_())return!0;const i="Offline"!==e;return(!this.options.ra||!i)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}ea(t){if(t.docChanges.length>0)return!0;const e=this.X_&&this.X_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}na(t){t=Wu.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Z_=!0,this.Y_.next(t)}G_(){return this.options.source!==Ku.Cache}}class th{constructor(t){this.key=t}}class eh{constructor(t){this.key=t}}class ih{constructor(t,e){this.query=t,this.la=e,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=cl(),this.mutatedKeys=cl(),this.Ia=Ka(t),this.Ta=new Gu(this.Ia)}get Ea(){return this.la}da(t,e){const i=e?e.Aa:new Hu,n=e?e.Ta:this.Ta;let r=e?e.mutatedKeys:this.mutatedKeys,o=n,s=!1;const a="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(t.inorderTraversal(((t,e)=>{const c=n.get(t),u=Za(this.query,e)?e:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let p=!1;c&&u?c.data.isEqual(u.data)?h!==d&&(i.track({type:3,doc:u}),p=!0):this.Ra(c,u)||(i.track({type:2,doc:u}),p=!0,(a&&this.Ia(u,a)>0||l&&this.Ia(u,l)<0)&&(s=!0)):!c&&u?(i.track({type:0,doc:u}),p=!0):c&&!u&&(i.track({type:1,doc:c}),p=!0,(a||l)&&(s=!0)),p&&(u?(o=o.add(u),r=d?r.add(t):r.delete(t)):(o=o.delete(t),r=r.delete(t)))})),null!==this.query.limit)for(;o.size>this.query.limit;){const t="F"===this.query.limitType?o.last():o.first();o=o.delete(t.key),r=r.delete(t.key),i.track({type:1,doc:t})}return{Ta:o,Aa:i,Zi:s,mutatedKeys:r}}Ra(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,i,n){const r=this.Ta;this.Ta=t.Ta,this.mutatedKeys=t.mutatedKeys;const o=t.Aa.Q_();o.sort(((t,e)=>function(t,e){const i=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xo()}};return i(t)-i(e)}(t.type,e.type)||this.Ia(t.doc,e.doc))),this.Va(i),n=null!=n&&n;const s=e&&!n?this.ma():[],a=0===this.Pa.size&&this.current&&!n?1:0,l=a!==this.ha;return this.ha=a,0!==o.length||l?{snapshot:new Wu(this.query,t.Ta,r,o,t.mutatedKeys,0===a,l,!1,!!i&&i.resumeToken.approximateByteSize()>0),fa:s}:{fa:s}}j_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Hu,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{fa:[]}}ga(t){return!this.la.has(t)&&!!this.Ta.has(t)&&!this.Ta.get(t).hasLocalMutations}Va(t){t&&(t.addedDocuments.forEach((t=>this.la=this.la.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.la=this.la.delete(t))),this.current=t.current)}ma(){if(!this.current)return[];const t=this.Pa;this.Pa=cl(),this.Ta.forEach((t=>{this.ga(t.key)&&(this.Pa=this.Pa.add(t.key))}));const e=[];return t.forEach((t=>{this.Pa.has(t)||e.push(new eh(t))})),this.Pa.forEach((i=>{t.has(i)||e.push(new th(i))})),e}pa(t){this.la=t.ls,this.Pa=cl();const e=this.da(t.documents);return this.applyChanges(e,!0)}ya(){return Wu.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class nh{constructor(t,e,i){this.query=t,this.targetId=e,this.view=i}}class rh{constructor(t){this.key=t,this.wa=!1}}class oh{constructor(t,e,i,n,r,o){this.localStore=t,this.remoteStore=e,this.eventManager=i,this.sharedClientState=n,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new Qa((t=>$a(t)),Xa),this.Da=new Map,this.Ca=new Set,this.va=new Rs(_s.comparator),this.Fa=new Map,this.Ma=new Gc,this.xa={},this.Oa=new Map,this.Na=Fc.Nn(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}async function sh(t,e,i=!0){const n=wh(t);let r;const o=n.ba.get(e);return o?(n.sharedClientState.addLocalQueryTarget(o.targetId),r=o.view.ya()):r=await lh(n,e,i,!0),r}async function ah(t,e){const i=wh(t);await lh(i,e,!0,!1)}async function lh(t,e,i,n){const r=await function(t,e){const i=Yo(t);return i.persistence.runTransaction("Allocate target","readwrite",(t=>{let n;return i.qr.getTargetData(t,e).next((r=>r?(n=r,Ss.resolve(n)):i.qr.allocateTargetId(t).next((r=>(n=new Pc(e,r,"TargetPurposeListen",t.currentSequenceNumber),i.qr.addTargetData(t,n).next((()=>n)))))))})).then((t=>{const n=i.ts.get(t.targetId);return(null===n||t.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(i.ts=i.ts.insert(t.targetId,t),i.ns.set(e,t.targetId)),t}))}(t.localStore,Ha(e)),o=r.targetId,s=i?t.sharedClientState.addLocalQueryTarget(o):"not-current";let a;return n&&(a=await async function(t,e,i,n,r){t.Ba=(e,i,n)=>async function(t,e,i,n){let r=e.view.da(i);r.Zi&&(r=await ou(t.localStore,e.query,!1).then((({documents:t})=>e.view.da(t,r))));const o=n&&n.targetChanges.get(e.targetId),s=n&&null!=n.targetMismatches.get(e.targetId),a=e.view.applyChanges(r,t.isPrimaryClient,o,s);return gh(t,e.targetId,a.fa),a.snapshot}(t,e,i,n);const o=await ou(t.localStore,e,!0),s=new ih(e,o.ls),a=s.da(o.documents),l=Zl.createSynthesizedTargetChangeForCurrentChange(i,n&&"Offline"!==t.onlineState,r),c=s.applyChanges(a,t.isPrimaryClient,l);gh(t,i,c.fa);const u=new nh(e,i,s);return t.ba.set(e,u),t.Da.has(i)?t.Da.get(i).push(e):t.Da.set(i,[e]),c.snapshot}(t,e,o,"current"===s,r.resumeToken)),t.isPrimaryClient&&i&&Mu(t.remoteStore,r),a}async function ch(t,e,i){const n=Yo(t),r=n.ba.get(e),o=n.Da.get(r.targetId);if(o.length>1)return n.Da.set(r.targetId,o.filter((t=>!Xa(t,e)))),void n.ba.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await ru(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),i&&Iu(n.remoteStore,r.targetId),fh(n,r.targetId)})).catch(Es)):(fh(n,r.targetId),await ru(n.localStore,r.targetId,!0))}async function uh(t,e){const i=Yo(t),n=i.ba.get(e),r=i.Da.get(n.targetId);i.isPrimaryClient&&1===r.length&&(i.sharedClientState.removeLocalQueryTarget(n.targetId),Iu(i.remoteStore,n.targetId))}async function hh(t,e){const i=Yo(t);try{const t=await function(t,e){const i=Yo(t),n=e.snapshotVersion;let r=i.ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const o=i.ss.newChangeBuffer({trackRemovals:!0});r=i.ts;const s=[];e.targetChanges.forEach(((o,a)=>{const l=r.get(a);if(!l)return;s.push(i.qr.removeMatchingKeys(t,o.removedDocuments,a).next((()=>i.qr.addMatchingKeys(t,o.addedDocuments,a))));let c=l.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?c=c.withResumeToken(Bs.EMPTY_BYTE_STRING,ds.min()).withLastLimboFreeSnapshotVersion(ds.min()):o.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(o.resumeToken,n)),r=r.insert(a,c),function(t,e,i){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size>0}(l,c,o)&&s.push(i.qr.updateTargetData(t,c))}));let a=el(),l=cl();if(e.documentUpdates.forEach((n=>{e.resolvedLimboDocuments.has(n)&&s.push(i.persistence.referenceDelegate.updateLimboDocument(t,n))})),s.push(function(t,e,i){let n=cl(),r=cl();return i.forEach((t=>n=n.add(t))),e.getEntries(t,n).next((t=>{let n=el();return i.forEach(((i,o)=>{const s=t.get(i);o.isFoundDocument()!==s.isFoundDocument()&&(r=r.add(i)),o.isNoDocument()&&o.version.isEqual(ds.min())?(e.removeEntry(i,o.readTime),n=n.insert(i,o)):!s.isValidDocument()||o.version.compareTo(s.version)>0||0===o.version.compareTo(s.version)&&s.hasPendingWrites?(e.addEntry(o),n=n.insert(i,o)):Go("LocalStore","Ignoring outdated watch update for ",i,". Current version:",s.version," Watch version:",o.version)})),{us:n,cs:r}}))}(t,o,e.documentUpdates).next((t=>{a=t.us,l=t.cs}))),!n.isEqual(ds.min())){const e=i.qr.getLastRemoteSnapshotVersion(t).next((e=>i.qr.setTargetsMetadata(t,t.currentSequenceNumber,n)));s.push(e)}return Ss.waitFor(s).next((()=>o.apply(t))).next((()=>i.localDocuments.getLocalViewOfDocuments(t,a,l))).next((()=>a))})).then((t=>(i.ts=r,t)))}(i.localStore,e);e.targetChanges.forEach(((t,e)=>{const n=i.Fa.get(e);n&&($o(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?n.wa=!0:t.modifiedDocuments.size>0?$o(n.wa):t.removedDocuments.size>0&&($o(n.wa),n.wa=!1))})),await vh(i,t,e)}catch(t){await Es(t)}}function dh(t,e,i){const n=Yo(t);if(n.isPrimaryClient&&0===i||!n.isPrimaryClient&&1===i){const t=[];n.ba.forEach(((i,n)=>{const r=n.view.j_(e);r.snapshot&&t.push(r.snapshot)})),function(t,e){const i=Yo(t);i.onlineState=e;let n=!1;i.queries.forEach(((t,i)=>{for(const t of i.U_)t.j_(e)&&(n=!0)})),n&&Zu(i)}(n.eventManager,e),t.length&&n.Sa.l_(t),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function ph(t,e,i){const n=Yo(t);n.sharedClientState.updateQueryState(e,"rejected",i);const r=n.Fa.get(e),o=r&&r.key;if(o){let t=new Rs(_s.comparator);t=t.insert(o,da.newNoDocument(o,ds.min()));const i=cl().add(o),r=new Yl(ds.min(),new Map,new Rs(cs),t,i);await hh(n,r),n.va=n.va.remove(o),n.Fa.delete(e),yh(n)}else await ru(n.localStore,e,!1).then((()=>fh(n,e,i))).catch(Es)}function fh(t,e,i=null){t.sharedClientState.removeLocalQueryTarget(e);for(const n of t.Da.get(e))t.ba.delete(n),i&&t.Sa.ka(n,i);t.Da.delete(e),t.isPrimaryClient&&t.Ma.Rr(e).forEach((e=>{t.Ma.containsKey(e)||mh(t,e)}))}function mh(t,e){t.Ca.delete(e.path.canonicalString());const i=t.va.get(e);null!==i&&(Iu(t.remoteStore,i),t.va=t.va.remove(e),t.Fa.delete(i),yh(t))}function gh(t,e,i){for(const n of i)n instanceof th?(t.Ma.addReference(n.key,e),_h(t,n)):n instanceof eh?(Go("SyncEngine","Document no longer in limbo: "+n.key),t.Ma.removeReference(n.key,e),t.Ma.containsKey(n.key)||mh(t,n.key)):Xo()}function _h(t,e){const i=e.key,n=i.path.canonicalString();t.va.get(i)||t.Ca.has(n)||(Go("SyncEngine","New document in limbo: "+i),t.Ca.add(n),yh(t))}function yh(t){for(;t.Ca.size>0&&t.va.size<t.maxConcurrentLimboResolutions;){const e=t.Ca.values().next().value;t.Ca.delete(e);const i=new _s(fs.fromString(e)),n=t.Na.next();t.Fa.set(n,new rh(i)),t.va=t.va.insert(i,n),Mu(t.remoteStore,new Pc(Ha(Ua(i.path)),n,"TargetPurposeLimboResolution",Ms.oe))}}async function vh(t,e,i){const n=Yo(t),r=[],o=[],s=[];n.ba.isEmpty()||(n.ba.forEach(((t,a)=>{s.push(n.Ba(a,e,i).then((t=>{if((t||i)&&n.isPrimaryClient&&n.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){r.push(t);const e=Jc.Qi(a.targetId,t);o.push(e)}})))})),await Promise.all(s),n.Sa.l_(r),await async function(t,e){const i=Yo(t);try{await i.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Ss.forEach(e,(e=>Ss.forEach(e.ki,(n=>i.persistence.referenceDelegate.addReference(t,e.targetId,n))).next((()=>Ss.forEach(e.qi,(n=>i.persistence.referenceDelegate.removeReference(t,e.targetId,n)))))))))}catch(t){if(!Ts(t))throw t;Go("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=i.ts.get(e),n=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(n);i.ts=i.ts.insert(e,r)}}}(n.localStore,o))}async function xh(t,e){const i=Yo(t);if(!i.currentUser.isEqual(e)){Go("SyncEngine","User change. New user:",e.toKey());const t=await iu(i.localStore,e);i.currentUser=e,function(t,e){t.Oa.forEach((t=>{t.forEach((t=>{t.reject(new Ko(Zo.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Oa.clear()}(i),i.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await vh(i,t._s)}}function bh(t,e){const i=Yo(t),n=i.Fa.get(e);if(n&&n.wa)return cl().add(n.key);{let t=cl();const n=i.Da.get(e);if(!n)return t;for(const e of n){const n=i.ba.get(e);t=t.unionWith(n.view.Ea)}return t}}function wh(t){const e=Yo(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=hh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=bh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ph.bind(null,e),e.Sa.l_=$u.bind(null,e.eventManager),e.Sa.ka=Yu.bind(null,e.eventManager),e}class Eh{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=_u(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,i,n){return new eu(t,e,i,n)}(this.persistence,new tu,t.initialUser,this.serializer)}createPersistence(t){return new Yc(Kc.jr,this.serializer)}createSharedClientState(t){return new au}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Sh{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>dh(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=xh.bind(null,this.syncEngine),await async function(t,e){const i=Yo(t);e?(i.M_.delete(2),await Su(i)):e||(i.M_.add(2),await Tu(i),i.N_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Xu}createDatastore(t){const e=_u(t.databaseInfo.databaseId),i=function(t){return new mu(t)}(t.databaseInfo);return function(t,e,i,n){return new bu(t,e,i,n)}(t.authCredentials,t.appCheckCredentials,i,e)}createRemoteStore(t){return function(t,e,i,n,r){return new Eu(t,e,i,n,r)}(this.localStore,this.datastore,t.asyncQueue,(t=>dh(this.syncEngine,t,0)),cu.D()?new cu:new lu)}createSyncEngine(t,e){return function(t,e,i,n,r,o,s){const a=new oh(t,e,i,n,r,o);return s&&(a.La=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=Yo(t);Go("RemoteStore","RemoteStore shutting down."),e.M_.add(5),await Tu(e),e.O_.shutdown(),e.N_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}class Th{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ka(this.observer.next,t)}error(t){this.observer.error?this.Ka(this.observer.error,t):Ho("Uncaught Error in snapshot listener:",t.toString())}$a(){this.muted=!0}Ka(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Mh{constructor(t,e,i,n){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=i,this.databaseInfo=n,this.user=Bo.UNAUTHENTICATED,this.clientId=ls.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,(async t=>{Go("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(i,(t=>(Go("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ko(Zo.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Jo;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const i=ju(e,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}async function Ih(t,e){t.asyncQueue.verifyOperationInProgress(),Go("FirestoreClient","Initializing OfflineComponentProvider");const i=t.configuration;await e.initialize(i);let n=i.initialUser;t.setCredentialChangeListener((async t=>{n.isEqual(t)||(await iu(e.localStore,t),n=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Ch(t,e){t.asyncQueue.verifyOperationInProgress();const i=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Go("FirestoreClient","Using user provided OfflineComponentProvider");try{await Ih(t,t._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!function(t){return"FirebaseError"===t.name?t.code===Zo.FAILED_PRECONDITION||t.code===Zo.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(i))throw i;Wo("Error using user provided cache. Falling back to memory cache: "+i),await Ih(t,new Eh)}}else Go("FirestoreClient","Using default OfflineComponentProvider"),await Ih(t,new Eh);return t._offlineComponents}(t);Go("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(i,t.configuration),t.setCredentialChangeListener((t=>Bu(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,i)=>Bu(e.remoteStore,i))),t._onlineComponents=e}async function Ah(t){const e=await async function(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Go("FirestoreClient","Using user provided OnlineComponentProvider"),await Ch(t,t._uninitializedComponentsProvider._online)):(Go("FirestoreClient","Using default OnlineComponentProvider"),await Ch(t,new Sh))),t._onlineComponents}(t),i=e.eventManager;return i.onListen=sh.bind(null,e.syncEngine),i.onUnlisten=ch.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=ah.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=uh.bind(null,e.syncEngine),i}function Ph(t,e,i={}){const n=new Jo;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,i,n,r){const o=new Th({next:i=>{e.enqueueAndForget((()=>async function(t,e){const i=Yo(t),n=e.query;let r=3;const o=i.queries.get(n);if(o){const t=o.U_.indexOf(e);t>=0&&(o.U_.splice(t,1),0===o.U_.length?r=e.G_()?0:1:!o.W_()&&e.G_()&&(r=2))}switch(r){case 0:return i.queries.delete(n),i.onUnlisten(n,!0);case 1:return i.queries.delete(n),i.onUnlisten(n,!1);case 2:return i.onLastRemoteStoreUnlisten(n);default:return}}(t,s))),i.fromCache&&"server"===n.source?r.reject(new Ko(Zo.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(i)},error:t=>r.reject(t)}),s=new Qu(i,o,{includeMetadataChanges:!0,ra:!0});return async function(t,e){const i=Yo(t);let n=3;const r=e.query;let o=i.queries.get(r);o?!o.W_()&&e.G_()&&(n=2):(o=new qu,n=e.G_()?0:1);try{switch(n){case 0:o.K_=await i.onListen(r,!0);break;case 1:o.K_=await i.onListen(r,!1);break;case 2:await i.onFirstRemoteStoreListen(r)}}catch(t){const i=ju(t,`Initialization of query '${Ya(e.query)}' failed`);return void e.onError(i)}i.queries.set(r,o),o.U_.push(e),e.j_(i.onlineState),o.K_&&e.H_(o.K_)&&Zu(i)}(t,s)}(await Ah(t),t.asyncQueue,e,i,n))),n.promise}function Lh(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Rh=new Map;function Dh(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Xo()}function kh(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ko(Zo.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=Dh(t);throw new Ko(Zo.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return t}class Nh{constructor(t){var e,i;if(void 0===t.host){if(void 0!==t.ssl)throw new Ko(Zo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Ko(Zo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,i,n){if(!0===e&&!0===n)throw new Ko(Zo.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Lh(null!==(i=t.experimentalLongPollingOptions)&&void 0!==i?i:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Ko(Zo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Ko(Zo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Ko(Zo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Oh{constructor(t,e,i,n){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=i,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Nh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Ko(Zo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Ko(Zo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Nh(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new ts;switch(t.type){case"firstParty":return new rs(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Ko(Zo.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Rh.get(t);e&&(Go("ComponentProvider","Removing Datastore"),Rh.delete(t),e.terminate())}(this),Promise.resolve()}}class Fh{constructor(t,e,i){this.converter=e,this._query=i,this.type="query",this.firestore=t}withConverter(t){return new Fh(this.firestore,t,this._query)}}class zh{constructor(t,e,i){this.converter=e,this._key=i,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Bh(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new zh(this.firestore,t,this._key)}}class Bh extends Fh{constructor(t,e,i){super(t,e,Ua(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new zh(this.firestore,null,new _s(t))}withConverter(t){return new Bh(this.firestore,t,this._path)}}class Uh{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new yu(this,"async_queue_retry"),this.hu=()=>{const t=gu();t&&Go("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Jo.Uo()};const t=gu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Pu(),this.Iu(t)}enterRestrictedMode(t){if(!this.ou){this.ou=!0,this.cu=t||!1;const e=gu();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.hu)}}enqueue(t){if(this.Pu(),this.ou)return new Promise((()=>{}));const e=new Jo;return this.Iu((()=>this.ou&&this.cu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.su.push(t),this.Tu())))}async Tu(){if(0!==this.su.length){try{await this.su[0](),this.su.shift(),this.Jo.reset()}catch(t){if(!Ts(t))throw t;Go("AsyncQueue","Operation failed with retryable error: "+t)}this.su.length>0&&this.Jo.Ko((()=>this.Tu()))}}Iu(t){const e=this.iu.then((()=>(this.uu=!0,t().catch((t=>{this.au=t,this.uu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Ho("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.uu=!1,t))))));return this.iu=e,e}enqueueAfterDelay(t,e,i){this.Pu(),this.lu.indexOf(t)>-1&&(e=0);const n=Vu.createAndSchedule(this,t,e,i,(t=>this.Eu(t)));return this._u.push(n),n}Pu(){this.au&&Xo()}verifyOperationInProgress(){}async du(){let t;do{t=this.iu,await t}while(t!==this.iu)}Au(t){for(const e of this._u)if(e.timerId===t)return!0;return!1}Ru(t){return this.du().then((()=>{this._u.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this._u)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.du()}))}Vu(t){this.lu.push(t)}Eu(t){const e=this._u.indexOf(t);this._u.splice(e,1)}}class Vh extends Oh{constructor(t,e,i,n){super(t,e,i,n),this.type="firestore",this._queue=new Uh,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||jh(this),this._firestoreClient.terminate()}}function jh(t){var e,i,n;const r=t._freezeSettings(),o=function(t,e,i,n){return new Xs(t,e,i,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,Lh(n.experimentalLongPollingOptions),n.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,r);t._firestoreClient=new Mh(t._authCredentials,t._appCheckCredentials,t._queue,o),(null===(i=r.localCache)||void 0===i?void 0:i._offlineComponentProvider)&&(null===(n=r.localCache)||void 0===n?void 0:n._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}class Gh{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Gh(Bs.fromBase64String(t))}catch(t){throw new Ko(Zo.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Gh(Bs.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Hh{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Ko(Zo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new gs(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Wh{constructor(t){this._methodName=t}}class qh{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Ko(Zo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ko(Zo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return cs(this._lat,t._lat)||cs(this._long,t._long)}}const Xh=/^__.*__$/;function $h(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Xo()}}class Yh{constructor(t,e,i,n,r,o){this.settings=t,this.databaseId=e,this.serializer=i,this.ignoreUndefinedProperties=n,void 0===r&&this.mu(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(t){return new Yh(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(t){var e;const i=null===(e=this.path)||void 0===e?void 0:e.child(t),n=this.gu({path:i,yu:!1});return n.wu(t),n}Su(t){var e;const i=null===(e=this.path)||void 0===e?void 0:e.child(t),n=this.gu({path:i,yu:!1});return n.mu(),n}bu(t){return this.gu({path:void 0,yu:!0})}Du(t){return td(t,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}mu(){if(this.path)for(let t=0;t<this.path.length;t++)this.wu(this.path.get(t))}wu(t){if(0===t.length)throw this.Du("Document fields must not be empty");if($h(this.fu)&&Xh.test(t))throw this.Du('Document fields cannot begin and end with "__"')}}class Zh{constructor(t,e,i){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=i||_u(t)}Fu(t,e,i,n=!1){return new Yh({fu:t,methodName:e,vu:i,path:gs.emptyPath(),yu:!1,Cu:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Kh(t,e){if(Jh(t=R(t)))return function(t,e,i){if(!Jh(i)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(i)){const n=Dh(i);throw"an object"===n?e.Du(t+" a custom object"):e.Du(t+" "+n)}}("Unsupported field value:",e,t),function(t,e){const i={};return Ls(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ps(t,((t,n)=>{const r=Kh(n,e.pu(t));null!=r&&(i[t]=r)})),{mapValue:{fields:i}}}(t,e);if(t instanceof Wh)return function(t,e){if(!$h(e.fu))throw e.Du(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Du(`${t._methodName}() is not currently supported inside arrays`);const i=t._toFieldTransform(e);i&&e.fieldTransforms.push(i)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.yu&&4!==e.fu)throw e.Du("Nested arrays are not supported");return function(t,e){const i=[];let n=0;for(const r of t){let t=Kh(r,e.bu(n));null==t&&(t={nullValue:"NULL_VALUE"}),i.push(t),n++}return{arrayValue:{values:i}}}(t,e)}return function(t,e){if(null===(t=R(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return pl(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const i=hs.fromDate(t);return{timestampValue:cc(e.serializer,i)}}if(t instanceof hs){const i=new hs(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:cc(e.serializer,i)}}if(t instanceof qh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Gh)return{bytesValue:uc(e.serializer,t._byteString)};if(t instanceof zh){const i=e.databaseId,n=t.firestore._databaseId;if(!n.isEqual(i))throw e.Du(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:dc(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Du(`Unsupported field value: ${Dh(t)}`)}(t,e)}function Jh(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof hs||t instanceof qh||t instanceof Gh||t instanceof zh||t instanceof Wh)}const Qh=new RegExp("[~\\*/\\[\\]]");function td(t,e,i,n,r){const o=n&&!n.isEmpty(),s=void 0!==r;let a=`Function ${e}() called with invalid data`;i&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(o||s)&&(l+=" (found",o&&(l+=` in field ${n}`),s&&(l+=` in document ${r}`),l+=")"),new Ko(Zo.INVALID_ARGUMENT,a+t+l)}class ed{constructor(t,e,i,n,r){this._firestore=t,this._userDataWriter=e,this._key=i,this._document=n,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new zh(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new id(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(nd("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class id extends ed{data(){return super.data()}}function nd(t,e){return"string"==typeof e?function(t,e,i){if(e.search(Qh)>=0)throw td(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,i);try{return new Hh(...e.split("."))._internalPath}catch(n){throw td(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,i)}}(t,e):e instanceof Hh?e._internalPath:e._delegate._internalPath}class rd{}class od extends rd{}class sd extends od{constructor(t,e,i){super(),this._field=t,this._op=e,this._value=i,this.type="where"}static _create(t,e,i){return new sd(t,e,i)}_apply(t){const e=this._parse(t);return dd(t._query,e),new Fh(t.firestore,t.converter,Wa(t._query,e))}_parse(t){const e=function(t){const e=t._freezeSettings(),i=_u(t._databaseId);return new Zh(t._databaseId,!!e.ignoreUndefinedProperties,i)}(t.firestore),i=function(t,e,i,n,r,o,s){let a;if(r.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Ko(Zo.INVALID_ARGUMENT,`Invalid Query. You can't perform '${o}' queries on documentId().`);if("in"===o||"not-in"===o){hd(s,o);const e=[];for(const i of s)e.push(ud(n,t,i));a={arrayValue:{values:e}}}else a=ud(n,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||hd(s,o),a=function(t,e,i,n=!1){return Kh(i,t.Fu(n?4:3,e))}(i,"where",s,"in"===o||"not-in"===o);return va.create(r,o,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return i}}function ad(t,e,i){const n=e,r=nd("where",t);return sd._create(r,n,i)}class ld extends rd{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new ld(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:xa.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let i=t;const n=e.getFlattenedFilters();for(const t of n)dd(i,t),i=Wa(i,t)}(t._query,e),new Fh(t.firestore,t.converter,Wa(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class cd extends od{constructor(t,e,i){super(),this.type=t,this._limit=e,this._limitType=i}static _create(t,e,i){return new cd(t,e,i)}_apply(t){return new Fh(t.firestore,t.converter,qa(t._query,this._limit,this._limitType))}}function ud(t,e,i){if("string"==typeof(i=R(i))){if(""===i)throw new Ko(Zo.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ja(e)&&-1!==i.indexOf("/"))throw new Ko(Zo.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const n=e.path.child(fs.fromString(i));if(!_s.isDocumentKey(n))throw new Ko(Zo.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return na(t,new _s(n))}if(i instanceof zh)return na(t,i._key);throw new Ko(Zo.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Dh(i)}.`)}function hd(t,e){if(!Array.isArray(t)||0===t.length)throw new Ko(Zo.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function dd(t,e){const i=function(t,e){for(const i of t)for(const t of i.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new Ko(Zo.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ko(Zo.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class pd{convertValue(t,e="none"){switch(Zs(t)){case 0:return null;case 1:return t.booleanValue;case 2:return js(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Gs(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Xo()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const i={};return Ps(t,((t,n)=>{i[t]=this.convertValue(n,e)})),i}convertGeoPoint(t){return new qh(js(t.latitude),js(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const i=Ws(t);return null==i?null:this.convertValue(i,e);case"estimate":return this.convertTimestamp(qs(t));default:return null}}convertTimestamp(t){const e=Vs(t);return new hs(e.seconds,e.nanos)}convertDocumentKey(t,e){const i=fs.fromString(t);$o(Ac(i));const n=new $s(i.get(1),i.get(3)),r=new _s(i.popFirst(5));return n.isEqual(e)||Ho(`Document ${r} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}class fd{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class md extends ed{constructor(t,e,i,n,r,o){super(t,e,i,n,o),this._firestore=t,this._firestoreImpl=t,this.metadata=r}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new gd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const i=this._document.data.field(nd("DocumentSnapshot.get",t));if(null!==i)return this._userDataWriter.convertValue(i,e.serverTimestamps)}}}class gd extends md{data(t={}){return super.data(t)}}class _d{constructor(t,e,i,n){this._firestore=t,this._userDataWriter=e,this._snapshot=n,this.metadata=new fd(n.hasPendingWrites,n.fromCache),this.query=i}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((i=>{t.call(e,new gd(this._firestore,this._userDataWriter,i.key,i,new fd(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Ko(Zo.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((i=>{const n=new gd(t._firestore,t._userDataWriter,i.doc.key,i.doc,new fd(t._snapshot.mutatedKeys.has(i.doc.key),t._snapshot.fromCache),t.query.converter);return i.doc,{type:"added",doc:n,oldIndex:-1,newIndex:e++}}))}{let i=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const n=new gd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new fd(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let r=-1,o=-1;return 0!==e.type&&(r=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),o=i.indexOf(e.doc.key)),{type:yd(e.type),doc:n,oldIndex:r,newIndex:o}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function yd(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xo()}}class vd extends pd{constructor(t){super(),this.firestore=t}convertBytes(t){return new Gh(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new zh(this.firestore,null,e)}}new WeakMap,function(t,e=!0){!function(t){Uo=t}(Kt),jt(new D("firestore",((t,{instanceIdentifier:i,options:n})=>{const r=t.getProvider("app").getImmediate(),o=new Vh(new is(t.getProvider("auth-internal")),new ss(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Ko(Zo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $s(t.options.projectId,e)}(r,i),r);return n=Object.assign({useFetchStreams:e},n),o._setSettings(n),o}),"PUBLIC").setMultipleInstances(!0)),ne(zo,"4.6.1",t),ne(zo,"4.6.1","esm2017")}();class xd{constructor(t,e){this._delegate=t,this.firebase=e,Ut(t,new D("app-compat",(()=>this),"PUBLIC")),this.container=t.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this._delegate.automaticDataCollectionEnabled=t}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((t=>{this._delegate.checkDestroyed(),t()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),ie(this._delegate))))}_getService(t,e=Nt){var i;this._delegate.checkDestroyed();const n=this._delegate.container.getProvider(t);return n.isInitialized()||"EXPLICIT"!==(null===(i=n.getComponent())||void 0===i?void 0:i.instantiationMode)||n.initialize(),n.getImmediate({identifier:e})}_removeServiceInstance(t,e=Nt){this._delegate.container.getProvider(t).clearInstance(e)}_addComponent(t){Ut(this._delegate,t)}_addOrOverwriteComponent(t){Vt(this._delegate,t)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const bd=new b("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),wd=function e(){const i=function(e){const i={},n={__esModule:!0,initializeApp:function(t,r={}){const o=Jt(t,r);if(E(i,o.name))return i[o.name];const s=new e(o,n);return i[o.name]=s,s},app:r,registerVersion:ne,setLogLevel:oe,onLog:re,apps:null,SDK_VERSION:Kt,INTERNAL:{registerComponent:function(t){const i=t.name,o=i.replace("-compat","");if(jt(t)&&"PUBLIC"===t.type){const s=(t=r())=>{if("function"!=typeof t[o])throw bd.create("invalid-app-argument",{appName:i});return t[o]()};void 0!==t.serviceProps&&c(s,t.serviceProps),n[o]=s,e.prototype[o]=function(...e){return this._getService.bind(this,i).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[o]:null},removeApp:function(t){delete i[t]},useAsService:function(t,e){return"serverAuth"===e?null:e},modularAPIs:t}};function r(t){if(!E(i,t=t||Nt))throw bd.create("no-app",{appName:t});return i[t]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(i).map((t=>i[t]))}}),r.App=e,n}(xd);return i.INTERNAL=Object.assign(Object.assign({},i.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(t){c(i,t)},createSubscribe:A,ErrorFactory:b,deepExtend:c}),i}(),Ed=new G("@firebase/app-compat");if(m()&&void 0!==self.firebase){Ed.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const t=self.firebase.SDK_VERSION;t&&t.indexOf("LITE")>=0&&Ed.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const Sd=wd;function Td(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(i[n[r]]=t[n[r]])}return i}ne("@firebase/app-compat","0.2.32",void 0),Sd.registerVersion("firebase","10.11.1","app-compat"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Md={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"};const Id=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},Cd=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Ad=new b("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Pd=new G("@firebase/auth");function Ld(t,...e){Pd.logLevel<=z.ERROR&&Pd.error(`Auth (${Kt}): ${t}`,...e)}function Rd(t,...e){throw Fd(t,...e)}function Dd(t,...e){return Fd(t,...e)}function kd(t,e,i){const n=Object.assign(Object.assign({},Cd()),{[e]:i});return new b("auth","Firebase",n).create(e,{appName:t.name})}function Nd(t){return kd(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Od(t,e,i){if(!(e instanceof i))throw i.name!==e.constructor.name&&Rd(t,"argument-error"),kd(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Fd(t,...e){if("string"!=typeof t){const i=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=t.name),t._errorFactory.create(i,...n)}return Ad.create(t,...e)}function zd(t,e,...i){if(!t)throw Fd(e,...i)}function Bd(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Ld(e),new Error(e)}function Ud(t,e){t||Bd(e)}function Vd(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.href)||""}function jd(){return"http:"===Gd()||"https:"===Gd()}function Gd(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.protocol)||null}class Hd{constructor(t,e){this.shortDelay=t,this.longDelay=e,Ud(e>t,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||_()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(jd()||g()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Wd(t,e){Ud(t.emulator,"Emulator should always be set here");const{url:i}=t.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}class qd{static initialize(t,e,i){this.fetchImpl=t,e&&(this.headersImpl=e),i&&(this.responseImpl=i)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Bd("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Bd("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Bd("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Xd={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},$d=new Hd(3e4,6e4);function Yd(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Zd(t,e,i,n,r={}){return Kd(t,r,(async()=>{let r={},o={};n&&("GET"===e?o=n:r={body:JSON.stringify(n)});const s=M(Object.assign({key:t.config.apiKey},o)).slice(1),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/json",t.languageCode&&(a["X-Firebase-Locale"]=t.languageCode),qd.fetch()(Qd(t,t.config.apiHost,i,s),Object.assign({method:e,headers:a,referrerPolicy:"no-referrer"},r))}))}async function Kd(t,e,i){t._canInitEmulator=!1;const n=Object.assign(Object.assign({},Xd),e);try{const e=new ep(t),r=await Promise.race([i(),e.promise]);e.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw ip(t,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const e=r.ok?o.errorMessage:o.error.message,[i,s]=e.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===i)throw ip(t,"credential-already-in-use",o);if("EMAIL_EXISTS"===i)throw ip(t,"email-already-in-use",o);if("USER_DISABLED"===i)throw ip(t,"user-disabled",o);const a=n[i]||i.toLowerCase().replace(/[_\s]+/g,"-");if(s)throw kd(t,a,s);Rd(t,a)}}catch(e){if(e instanceof x)throw e;Rd(t,"network-request-failed",{message:String(e)})}}async function Jd(t,e,i,n,r={}){const o=await Zd(t,e,i,n,r);return"mfaPendingCredential"in o&&Rd(t,"multi-factor-auth-required",{_serverResponse:o}),o}function Qd(t,e,i,n){const r=`${e}${i}?${n}`;return t.config.emulator?Wd(t.config,r):`${t.config.apiScheme}://${r}`}function tp(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class ep{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise(((t,e)=>{this.timer=setTimeout((()=>e(Dd(this.auth,"network-request-failed"))),$d.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function ip(t,e,i){const n={appName:t.name};i.email&&(n.email=i.email),i.phoneNumber&&(n.phoneNumber=i.phoneNumber);const r=Dd(t,e,n);return r.customData._tokenResponse=i,r}function np(t){return void 0!==t&&void 0!==t.getResponse}function rp(t){return void 0!==t&&void 0!==t.enterprise}class op{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===t.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const e of this.recaptchaEnforcementState)if(e.provider&&e.provider===t)return tp(e.enforcementState);return null}isProviderEnabled(t){return"ENFORCE"===this.getProviderEnforcementState(t)||"AUDIT"===this.getProviderEnforcementState(t)}}async function sp(t,e){return Zd(t,"POST","/v1/accounts:lookup",e)}function ap(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch(t){}}function lp(t){return 1e3*Number(t)}function cp(t){const[e,i,n]=t.split(".");if(void 0===e||void 0===i||void 0===n)return Ld("JWT malformed, contained fewer than 3 sections"),null;try{const t=l(i);return t?JSON.parse(t):(Ld("Failed to decode base64 JWT payload"),null)}catch(t){return Ld("Caught error parsing JWT payload as JSON",null==t?void 0:t.toString()),null}}function up(t){const e=cp(t);return zd(e,"internal-error"),zd(void 0!==e.exp,"internal-error"),zd(void 0!==e.iat,"internal-error"),Number(e.exp)-Number(e.iat)}async function hp(t,e,i=!1){if(i)return e;try{return await e}catch(e){throw e instanceof x&&function({code:t}){return"auth/user-disabled"===t||"auth/user-token-expired"===t}(e)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class dp{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}{this.errorBackoff=3e4;const t=(null!==(e=this.user.stsTokenManager.expirationTime)&&void 0!==e?e:0)-Date.now()-3e5;return Math.max(0,t)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout((async()=>{await this.iteration()}),e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===(null==t?void 0:t.code)&&this.schedule(!0))}this.schedule()}}class pp{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=ap(this.lastLoginAt),this.creationTime=ap(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function fp(t){var e;const i=t.auth,n=await t.getIdToken(),r=await hp(t,sp(i,{idToken:n}));zd(null==r?void 0:r.users.length,i,"internal-error");const o=r.users[0];t._notifyReloadListener(o);const s=(null===(e=o.providerUserInfo)||void 0===e?void 0:e.length)?mp(o.providerUserInfo):[],a=(l=t.providerData,c=s,[...l.filter((t=>!c.some((e=>e.providerId===t.providerId)))),...c]);var l,c;const u=t.isAnonymous,h=!(t.email&&o.passwordHash||(null==a?void 0:a.length)),d=!!u&&h,p={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:a,metadata:new pp(o.createdAt,o.lastLoginAt),isAnonymous:d};Object.assign(t,p)}function mp(t){return t.map((t=>{var{providerId:e}=t,i=Td(t,["providerId"]);return{providerId:e,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}}))}class gp{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){zd(t.idToken,"internal-error"),zd(void 0!==t.idToken,"internal-error"),zd(void 0!==t.refreshToken,"internal-error");const e="expiresIn"in t&&void 0!==t.expiresIn?Number(t.expiresIn):up(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){zd(0!==t.length,"internal-error");const e=up(t);this.updateTokensAndExpiration(t,null,e)}async getToken(t,e=!1){return e||!this.accessToken||this.isExpired?(zd(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:i,refreshToken:n,expiresIn:r}=await async function(t,e){const i=await Kd(t,{},(async()=>{const i=M({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:n,apiKey:r}=t.config,o=Qd(t,n,"/v1/token",`key=${r}`),s=await t._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",qd.fetch()(o,{method:"POST",headers:s,body:i})}));return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}(t,e);this.updateTokensAndExpiration(i,n,Number(r))}updateTokensAndExpiration(t,e,i){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+1e3*i}static fromJSON(t,e){const{refreshToken:i,accessToken:n,expirationTime:r}=e,o=new gp;return i&&(zd("string"==typeof i,"internal-error",{appName:t}),o.refreshToken=i),n&&(zd("string"==typeof n,"internal-error",{appName:t}),o.accessToken=n),r&&(zd("number"==typeof r,"internal-error",{appName:t}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new gp,this.toJSON())}_performRefresh(){return Bd("not implemented")}}function _p(t,e){zd("string"==typeof t||void 0===t,"internal-error",{appName:e})}class yp{constructor(t){var{uid:e,auth:i,stsTokenManager:n}=t,r=Td(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new dp(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=i,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new pp(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(t){const e=await hp(this,this.stsTokenManager.getToken(this.auth,t));return zd(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return async function(t,e=!1){const i=R(t),n=await i.getIdToken(e),r=cp(n);zd(r&&r.exp&&r.auth_time&&r.iat,i.auth,"internal-error");const o="object"==typeof r.firebase?r.firebase:void 0,s=null==o?void 0:o.sign_in_provider;return{claims:r,token:n,authTime:ap(lp(r.auth_time)),issuedAtTime:ap(lp(r.iat)),expirationTime:ap(lp(r.exp)),signInProvider:s||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}(this,t)}reload(){return async function(t){const e=R(t);await fp(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}(this)}_assign(t){this!==t&&(zd(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map((t=>Object.assign({},t))),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new yp(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return e.metadata._copy(this.metadata),e}_onReload(t){zd(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let i=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),i=!0),e&&await fp(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(qt(this.auth.app))return Promise.reject(Nd(this.auth));const t=await this.getIdToken();return await hp(this,async function(t,e){return Zd(t,"POST","/v1/accounts:delete",e)}(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((t=>Object.assign({},t))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var i,n,r,o,s,a,l,c;const u=null!==(i=e.displayName)&&void 0!==i?i:void 0,h=null!==(n=e.email)&&void 0!==n?n:void 0,d=null!==(r=e.phoneNumber)&&void 0!==r?r:void 0,p=null!==(o=e.photoURL)&&void 0!==o?o:void 0,f=null!==(s=e.tenantId)&&void 0!==s?s:void 0,m=null!==(a=e._redirectEventId)&&void 0!==a?a:void 0,g=null!==(l=e.createdAt)&&void 0!==l?l:void 0,_=null!==(c=e.lastLoginAt)&&void 0!==c?c:void 0,{uid:y,emailVerified:v,isAnonymous:x,providerData:b,stsTokenManager:w}=e;zd(y&&w,t,"internal-error");const E=gp.fromJSON(this.name,w);zd("string"==typeof y,t,"internal-error"),_p(u,t.name),_p(h,t.name),zd("boolean"==typeof v,t,"internal-error"),zd("boolean"==typeof x,t,"internal-error"),_p(d,t.name),_p(p,t.name),_p(f,t.name),_p(m,t.name),_p(g,t.name),_p(_,t.name);const S=new yp({uid:y,auth:t,email:h,emailVerified:v,displayName:u,isAnonymous:x,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:E,createdAt:g,lastLoginAt:_});return b&&Array.isArray(b)&&(S.providerData=b.map((t=>Object.assign({},t)))),m&&(S._redirectEventId=m),S}static async _fromIdTokenResponse(t,e,i=!1){const n=new gp;n.updateFromServerResponse(e);const r=new yp({uid:e.localId,auth:t,stsTokenManager:n,isAnonymous:i});return await fp(r),r}static async _fromGetAccountInfoResponse(t,e,i){const n=e.users[0];zd(void 0!==n.localId,"internal-error");const r=void 0!==n.providerUserInfo?mp(n.providerUserInfo):[],o=!(n.email&&n.passwordHash||(null==r?void 0:r.length)),s=new gp;s.updateFromIdToken(i);const a=new yp({uid:n.localId,auth:t,stsTokenManager:s,isAnonymous:o}),l={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:r,metadata:new pp(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash||(null==r?void 0:r.length))};return Object.assign(a,l),a}}const vp=new Map;function xp(t){Ud(t instanceof Function,"Expected a class definition");let e=vp.get(t);return e?(Ud(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,vp.set(t,e),e)}class bp{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return void 0===e?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}bp.type="NONE";const wp=bp;function Ep(t,e,i){return`firebase:${t}:${e}:${i}`}class Sp{constructor(t,e,i){this.persistence=t,this.auth=e,this.userKey=i;const{config:n,name:r}=this.auth;this.fullUserKey=Ep(this.userKey,n.apiKey,r),this.fullPersistenceKey=Ep("persistence",n.apiKey,r),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?yp._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=t,e?this.setCurrentUser(e):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,i="authUser"){if(!e.length)return new Sp(xp(wp),t,i);const n=(await Promise.all(e.map((async t=>{if(await t._isAvailable())return t})))).filter((t=>t));let r=n[0]||xp(wp);const o=Ep(i,t.config.apiKey,t.name);let s=null;for(const i of e)try{const e=await i._get(o);if(e){const n=yp._fromJSON(t,e);i!==r&&(s=n),r=i;break}}catch(t){}const a=n.filter((t=>t._shouldAllowMigration));return r._shouldAllowMigration&&a.length?(r=a[0],s&&await r._set(o,s.toJSON()),await Promise.all(e.map((async t=>{if(t!==r)try{await t._remove(o)}catch(t){}}))),new Sp(r,t,i)):new Sp(r,t,i)}}function Tp(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Ap(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Mp(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Lp(e))return"Blackberry";if(Rp(e))return"Webos";if(Ip(e))return"Safari";if((e.includes("chrome/")||Cp(e))&&!e.includes("edge/"))return"Chrome";if(Pp(e))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=t.match(e);if(2===(null==i?void 0:i.length))return i[1]}return"Other"}function Mp(t=p()){return/firefox\//i.test(t)}function Ip(t=p()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Cp(t=p()){return/crios\//i.test(t)}function Ap(t=p()){return/iemobile/i.test(t)}function Pp(t=p()){return/android/i.test(t)}function Lp(t=p()){return/blackberry/i.test(t)}function Rp(t=p()){return/webos/i.test(t)}function Dp(t=p()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function kp(t=p()){return Dp(t)||Pp(t)||Rp(t)||Lp(t)||/windows phone/i.test(t)||Ap(t)}function Np(t,e=[]){let i;switch(t){case"Browser":i=Tp(p());break;case"Worker":i=`${Tp(p())}-${t}`;break;default:i=t}const n=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${Kt}/${n}`}class Op{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const i=e=>new Promise(((i,n)=>{try{i(t(e))}catch(t){n(t)}}));i.onAbort=e,this.queue.push(i);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const i of this.queue)await i(t),i.onAbort&&e.push(i.onAbort)}catch(t){e.reverse();for(const t of e)try{t()}catch(t){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==t?void 0:t.message})}}}class Fp{constructor(t){var e,i,n,r;const o=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(e=o.minPasswordLength)&&void 0!==e?e:6,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),void 0!==o.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),void 0!==o.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),void 0!==o.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),void 0!==o.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(i=t.allowedNonAlphanumericCharacters)||void 0===i?void 0:i.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(r=t.forceUpgradeOnSignin)&&void 0!==r&&r,this.schemaVersion=t.schemaVersion}validatePassword(t){var e,i,n,r,o,s;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,a),this.validatePasswordCharacterOptions(t,a),a.isValid&&(a.isValid=null===(e=a.meetsMinPasswordLength)||void 0===e||e),a.isValid&&(a.isValid=null===(i=a.meetsMaxPasswordLength)||void 0===i||i),a.isValid&&(a.isValid=null===(n=a.containsLowercaseLetter)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsUppercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(o=a.containsNumericCharacter)||void 0===o||o),a.isValid&&(a.isValid=null===(s=a.containsNonAlphanumericCharacter)||void 0===s||s),a}validatePasswordLengthOptions(t,e){const i=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;i&&(e.meetsMinPasswordLength=t.length>=i),n&&(e.meetsMaxPasswordLength=t.length<=n)}validatePasswordCharacterOptions(t,e){let i;this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);for(let n=0;n<t.length;n++)i=t.charAt(n),this.updatePasswordCharacterOptionsStatuses(e,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(t,e,i,n,r){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=r))}}class zp{constructor(t,e,i,n){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=i,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Up(this),this.idTokenSubscription=new Up(this),this.beforeStateQueue=new Op(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Ad,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=xp(e)),this._initializationPromise=this.queue((async()=>{var i,n;if(!this._deleted&&(this.persistenceManager=await Sp.create(this,t),!this._deleted)){if(null===(i=this._popupRedirectResolver)||void 0===i?void 0:i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(t){}await this.initializeCurrentUser(e),this.lastNotifiedUid=(null===(n=this.currentUser)||void 0===n?void 0:n.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();return this.currentUser||t?this.currentUser&&t&&this.currentUser.uid===t.uid?(this._currentUser._assign(t),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(t,!0):void 0}async initializeCurrentUserFromIdToken(t){try{const e=await sp(this,{idToken:t}),i=await yp._fromGetAccountInfoResponse(this,e,t);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var e;if(qt(this.app)){const t=this.app.settings.authIdToken;return t?new Promise((e=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(t).then(e,e)))})):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let n=i,r=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=null===(e=this.redirectUser)||void 0===e?void 0:e._redirectEventId,o=null==n?void 0:n._redirectEventId,s=await this.tryRedirectSignIn(t);i&&i!==o||!(null==s?void 0:s.user)||(n=s.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(t){n=i,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(t)))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return zd(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch(t){await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await fp(t)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(qt(this.app))return Promise.reject(Nd(this));const e=t?R(t):null;return e&&zd(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&zd(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue((async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()}))}async signOut(){return qt(this.app)?Promise.reject(Nd(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return qt(this.app)?Promise.reject(Nd(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(xp(t))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await async function(t,e={}){return Zd(t,"GET","/v2/passwordPolicy",Yd(t,e))}(this),e=new Fp(t);null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new b("auth","Firebase",t())}onAuthStateChanged(t,e,i){return this.registerStateListener(this.authStateSubscription,t,e,i)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,i){return this.registerStateListener(this.idTokenSubscription,t,e,i)}authStateReady(){return new Promise(((t,e)=>{if(this.currentUser)t();else{const i=this.onAuthStateChanged((()=>{i(),t()}),e)}}))}async revokeAccessToken(t){if(this.currentUser){const e={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(e.tenantId=this.tenantId),await async function(t,e){return Zd(t,"POST","/v2/accounts:revokeToken",Yd(t,e))}(this,e)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(t=this._currentUser)||void 0===t?void 0:t.toJSON()}}async _setRedirectUser(t,e){const i=await this.getOrInitRedirectPersistenceManager(e);return null===t?i.removeCurrentUser():i.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&xp(t)||this._popupRedirectResolver;zd(e,this,"argument-error"),this.redirectPersistenceManager=await Sp.create(this,[xp(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,i;return this._isInitialized&&await this.queue((async()=>{})),(null===(e=this._currentUser)||void 0===e?void 0:e._redirectEventId)===t?this._currentUser:(null===(i=this.redirectUser)||void 0===i?void 0:i._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(t)))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,i,n){if(this._deleted)return()=>{};const r="function"==typeof e?e:e.next.bind(e);let o=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(zd(s,this,"internal-error"),s.then((()=>{o||r(this.currentUser)})),"function"==typeof e){const r=t.addObserver(e,i,n);return()=>{o=!0,r()}}{const i=t.addObserver(e);return()=>{o=!0,i()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return zd(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){t&&!this.frameworks.includes(t)&&(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Np(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const i=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());i&&(e["X-Firebase-Client"]=i);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){var t;const e=await(null===(t=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getToken());return(null==e?void 0:e.error)&&function(t,...e){Pd.logLevel<=z.WARN&&Pd.warn(`Auth (${Kt}): ${t}`,...e)}(`Error while retrieving App Check token: ${e.error}`),null==e?void 0:e.token}}function Bp(t){return R(t)}class Up{constructor(t){this.auth=t,this.observer=null,this.addObserver=A((t=>this.observer=t))}get next(){return zd(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Vp={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function jp(t){return Vp.loadJS(t)}function Gp(t){return`__${t}${Math.floor(1e6*Math.random())}`}class Hp{constructor(t){this.type="recaptcha-enterprise",this.auth=Bp(t)}async verify(t="verify",e=!1){function i(e,i,n){const r=window.grecaptcha;rp(r)?r.enterprise.ready((()=>{r.enterprise.execute(e,{action:t}).then((t=>{i(t)})).catch((()=>{i("NO_RECAPTCHA")}))})):n(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((t,n)=>{(async function(t){if(!e){if(null==t.tenantId&&null!=t._agentRecaptchaConfig)return t._agentRecaptchaConfig.siteKey;if(null!=t.tenantId&&void 0!==t._tenantRecaptchaConfigs[t.tenantId])return t._tenantRecaptchaConfigs[t.tenantId].siteKey}return new Promise((async(e,i)=>{(async function(t,e){return Zd(t,"GET","/v2/recaptchaConfig",Yd(t,e))})(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((n=>{if(void 0!==n.recaptchaKey){const i=new op(n);return null==t.tenantId?t._agentRecaptchaConfig=i:t._tenantRecaptchaConfigs[t.tenantId]=i,e(i.siteKey)}i(new Error("recaptcha Enterprise site key undefined"))})).catch((t=>{i(t)}))}))})(this.auth).then((r=>{if(!e&&rp(window.grecaptcha))i(r,t,n);else{if("undefined"==typeof window)return void n(new Error("RecaptchaVerifier is only supported in browser"));let e=Vp.recaptchaEnterpriseScript;0!==e.length&&(e+=r),jp(e).then((()=>{i(r,t,n)})).catch((t=>{n(t)}))}})).catch((t=>{n(t)}))}))}}async function Wp(t,e,i,n=!1){const r=new Hp(t);let o;try{o=await r.verify(i)}catch(t){o=await r.verify(i,!0)}const s=Object.assign({},e);return n?Object.assign(s,{captchaResp:o}):Object.assign(s,{captchaResponse:o}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function qp(t,e,i,n){var r;if(null===(r=t._getRecaptchaConfig())||void 0===r?void 0:r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await Wp(t,e,i,"getOobCode"===i);return n(t,r)}return n(t,e).catch((async r=>{if("auth/missing-recaptcha-token"===r.code){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const r=await Wp(t,e,i,"getOobCode"===i);return n(t,r)}return Promise.reject(r)}))}function Xp(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function $p(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}class Yp{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return Bd("not implemented")}_getIdTokenResponse(t){return Bd("not implemented")}_linkToIdToken(t,e){return Bd("not implemented")}_getReauthenticationResolver(t){return Bd("not implemented")}}async function Zp(t,e){return Zd(t,"POST","/v1/accounts:resetPassword",Yd(t,e))}async function Kp(t,e){return Zd(t,"POST","/v1/accounts:signUp",e)}async function Jp(t,e){return Jd(t,"POST","/v1/accounts:signInWithPassword",Yd(t,e))}async function Qp(t,e){return Zd(t,"POST","/v1/accounts:sendOobCode",Yd(t,e))}async function tf(t,e){return Qp(t,e)}async function ef(t,e){return Qp(t,e)}class nf extends Yp{constructor(t,e,i,n=null){super("password",i),this._email=t,this._password=e,this._tenantId=n}static _fromEmailAndPassword(t,e){return new nf(t,e,"password")}static _fromEmailAndCode(t,e,i=null){return new nf(t,e,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t;if((null==e?void 0:e.email)&&(null==e?void 0:e.password)){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":return qp(t,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Jp);case"emailLink":return async function(t,e){return Jd(t,"POST","/v1/accounts:signInWithEmailLink",Yd(t,e))}(t,{email:this._email,oobCode:this._password});default:Rd(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return qp(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Kp);case"emailLink":return async function(t,e){return Jd(t,"POST","/v1/accounts:signInWithEmailLink",Yd(t,e))}(t,{idToken:e,email:this._email,oobCode:this._password});default:Rd(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}async function rf(t,e){return Jd(t,"POST","/v1/accounts:signInWithIdp",Yd(t,e))}class of extends Yp{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new of(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):Rd("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t,{providerId:i,signInMethod:n}=e,r=Td(e,["providerId","signInMethod"]);if(!i||!n)return null;const o=new of(i,n);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(t){return rf(t,this.buildRequest())}_linkToIdToken(t,e){const i=this.buildRequest();return i.idToken=e,rf(t,i)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,rf(t,e)}buildRequest(){const t={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=M(e)}return t}}const sf={USER_NOT_FOUND:"user-not-found"};class af extends Yp{constructor(t){super("phone","phone"),this.params=t}static _fromVerification(t,e){return new af({verificationId:t,verificationCode:e})}static _fromTokenResponse(t,e){return new af({phoneNumber:t,temporaryProof:e})}_getIdTokenResponse(t){return async function(t,e){return Jd(t,"POST","/v1/accounts:signInWithPhoneNumber",Yd(t,e))}(t,this._makeVerificationRequest())}_linkToIdToken(t,e){return async function(t,e){const i=await Jd(t,"POST","/v1/accounts:signInWithPhoneNumber",Yd(t,e));if(i.temporaryProof)throw ip(t,"account-exists-with-different-credential",i);return i}(t,Object.assign({idToken:e},this._makeVerificationRequest()))}_getReauthenticationResolver(t){return async function(t,e){return Jd(t,"POST","/v1/accounts:signInWithPhoneNumber",Yd(t,Object.assign(Object.assign({},e),{operation:"REAUTH"})),sf)}(t,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:t,phoneNumber:e,verificationId:i,verificationCode:n}=this.params;return t&&e?{temporaryProof:t,phoneNumber:e}:{sessionInfo:i,code:n}}toJSON(){const t={providerId:this.providerId};return this.params.phoneNumber&&(t.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(t.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(t.verificationCode=this.params.verificationCode),this.params.verificationId&&(t.verificationId=this.params.verificationId),t}static fromJSON(t){"string"==typeof t&&(t=JSON.parse(t));const{verificationId:e,verificationCode:i,phoneNumber:n,temporaryProof:r}=t;return i||e||n||r?new af({verificationId:e,verificationCode:i,phoneNumber:n,temporaryProof:r}):null}}class lf{constructor(t){var e,i,n,r,o,s;const a=I(C(t)),l=null!==(e=a.apiKey)&&void 0!==e?e:null,c=null!==(i=a.oobCode)&&void 0!==i?i:null,u=function(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(n=a.mode)&&void 0!==n?n:null);zd(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!==(r=a.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(o=a.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(s=a.tenantId)&&void 0!==s?s:null}static parseLink(t){const e=function(t){const e=I(C(t)).link,i=e?I(C(e)).deep_link_id:null,n=I(C(t)).deep_link_id;return(n?I(C(n)).link:null)||n||i||e||t}(t);try{return new lf(e)}catch(t){return null}}}class cf{constructor(){this.providerId=cf.PROVIDER_ID}static credential(t,e){return nf._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const i=lf.parseLink(e);return zd(i,"argument-error"),nf._fromEmailAndCode(t,i.code,i.tenantId)}}cf.PROVIDER_ID="password",cf.EMAIL_PASSWORD_SIGN_IN_METHOD="password",cf.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class uf{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class hf extends uf{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class df extends hf{static credentialFromJSON(t){const e="string"==typeof t?JSON.parse(t):t;return zd("providerId"in e&&"signInMethod"in e,"argument-error"),of._fromParams(e)}credential(t){return this._credential(Object.assign(Object.assign({},t),{nonce:t.rawNonce}))}_credential(t){return zd(t.idToken||t.accessToken,"argument-error"),of._fromParams(Object.assign(Object.assign({},t),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(t){return df.oauthCredentialFromTaggedObject(t)}static credentialFromError(t){return df.oauthCredentialFromTaggedObject(t.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:i,oauthTokenSecret:n,pendingToken:r,nonce:o,providerId:s}=t;if(!(i||n||e||r))return null;if(!s)return null;try{return new df(s)._credential({idToken:e,accessToken:i,nonce:o,pendingToken:r})}catch(t){return null}}}class pf extends hf{constructor(){super("facebook.com")}static credential(t){return of._fromParams({providerId:pf.PROVIDER_ID,signInMethod:pf.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return pf.credentialFromTaggedObject(t)}static credentialFromError(t){return pf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return pf.credential(t.oauthAccessToken)}catch(t){return null}}}pf.FACEBOOK_SIGN_IN_METHOD="facebook.com",pf.PROVIDER_ID="facebook.com";class ff extends hf{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return of._fromParams({providerId:ff.PROVIDER_ID,signInMethod:ff.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return ff.credentialFromTaggedObject(t)}static credentialFromError(t){return ff.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:i}=t;if(!e&&!i)return null;try{return ff.credential(e,i)}catch(t){return null}}}ff.GOOGLE_SIGN_IN_METHOD="google.com",ff.PROVIDER_ID="google.com";class mf extends hf{constructor(){super("github.com")}static credential(t){return of._fromParams({providerId:mf.PROVIDER_ID,signInMethod:mf.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return mf.credentialFromTaggedObject(t)}static credentialFromError(t){return mf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return mf.credential(t.oauthAccessToken)}catch(t){return null}}}mf.GITHUB_SIGN_IN_METHOD="github.com",mf.PROVIDER_ID="github.com";class gf extends Yp{constructor(t,e){super(t,t),this.pendingToken=e}_getIdTokenResponse(t){return rf(t,this.buildRequest())}_linkToIdToken(t,e){const i=this.buildRequest();return i.idToken=e,rf(t,i)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,rf(t,e)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t,{providerId:i,signInMethod:n,pendingToken:r}=e;return i&&n&&r&&i===n?new gf(i,r):null}static _create(t,e){return new gf(t,e)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class _f extends uf{constructor(t){zd(t.startsWith("saml."),"argument-error"),super(t)}static credentialFromResult(t){return _f.samlCredentialFromTaggedObject(t)}static credentialFromError(t){return _f.samlCredentialFromTaggedObject(t.customData||{})}static credentialFromJSON(t){const e=gf.fromJSON(t);return zd(e,"argument-error"),e}static samlCredentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{pendingToken:e,providerId:i}=t;if(!e||!i)return null;try{return gf._create(i,e)}catch(t){return null}}}class yf extends hf{constructor(){super("twitter.com")}static credential(t,e){return of._fromParams({providerId:yf.PROVIDER_ID,signInMethod:yf.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return yf.credentialFromTaggedObject(t)}static credentialFromError(t){return yf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:i}=t;if(!e||!i)return null;try{return yf.credential(e,i)}catch(t){return null}}}async function vf(t,e){return Jd(t,"POST","/v1/accounts:signUp",Yd(t,e))}yf.TWITTER_SIGN_IN_METHOD="twitter.com",yf.PROVIDER_ID="twitter.com";class xf{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,i,n=!1){const r=await yp._fromIdTokenResponse(t,i,n),o=bf(i);return new xf({user:r,providerId:o,_tokenResponse:i,operationType:e})}static async _forOperation(t,e,i){await t._updateTokensIfNecessary(i,!0);const n=bf(i);return new xf({user:t,providerId:n,_tokenResponse:i,operationType:e})}}function bf(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class wf extends x{constructor(t,e,i,n){var r;super(e.code,e.message),this.operationType=i,this.user=n,Object.setPrototypeOf(this,wf.prototype),this.customData={appName:t.name,tenantId:null!==(r=t.tenantId)&&void 0!==r?r:void 0,_serverResponse:e.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(t,e,i,n){return new wf(t,e,i,n)}}function Ef(t,e,i,n){return("reauthenticate"===e?i._getReauthenticationResolver(t):i._getIdTokenResponse(t)).catch((i=>{if("auth/multi-factor-auth-required"===i.code)throw wf._fromErrorAndOperation(t,i,e,n);throw i}))}function Sf(t){return new Set(t.map((({providerId:t})=>t)).filter((t=>!!t)))}async function Tf(t,e,i=!1){const n=await hp(t,e._linkToIdToken(t.auth,await t.getIdToken()),i);return xf._forOperation(t,"link",n)}async function Mf(t,e,i){await fp(e);const n=!1===t?"provider-already-linked":"no-such-provider";zd(Sf(e.providerData).has(i)===t,e.auth,n)}async function If(t,e,i=!1){const{auth:n}=t;if(qt(n.app))return Promise.reject(Nd(n));const r="reauthenticate";try{const o=await hp(t,Ef(n,r,e,t),i);zd(o.idToken,n,"internal-error");const s=cp(o.idToken);zd(s,n,"internal-error");const{sub:a}=s;return zd(t.uid===a,n,"user-mismatch"),xf._forOperation(t,r,o)}catch(t){throw"auth/user-not-found"===(null==t?void 0:t.code)&&Rd(n,"user-mismatch"),t}}async function Cf(t,e,i=!1){if(qt(t.app))return Promise.reject(Nd(t));const n="signIn",r=await Ef(t,n,e),o=await xf._fromIdTokenResponse(t,n,r);return i||await t._updateCurrentUser(o.user),o}async function Af(t,e){return Cf(Bp(t),e)}async function Pf(t,e){const i=R(t);return await Mf(!1,i,e.providerId),Tf(i,e)}async function Lf(t,e){return If(R(t),e)}class Rf{constructor(t,e){this.factorId=t,this.uid=e.mfaEnrollmentId,this.enrollmentTime=new Date(e.enrolledAt).toUTCString(),this.displayName=e.displayName}static _fromServerResponse(t,e){return"phoneInfo"in e?Df._fromServerResponse(t,e):"totpInfo"in e?kf._fromServerResponse(t,e):Rd(t,"internal-error")}}class Df extends Rf{constructor(t){super("phone",t),this.phoneNumber=t.phoneInfo}static _fromServerResponse(t,e){return new Df(e)}}class kf extends Rf{constructor(t){super("totp",t)}static _fromServerResponse(t,e){return new kf(e)}}function Nf(t,e,i){var n;zd((null===(n=i.url)||void 0===n?void 0:n.length)>0,t,"invalid-continue-uri"),zd(void 0===i.dynamicLinkDomain||i.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain"),e.continueUrl=i.url,e.dynamicLinkDomain=i.dynamicLinkDomain,e.canHandleCodeInApp=i.handleCodeInApp,i.iOS&&(zd(i.iOS.bundleId.length>0,t,"missing-ios-bundle-id"),e.iOSBundleId=i.iOS.bundleId),i.android&&(zd(i.android.packageName.length>0,t,"missing-android-pkg-name"),e.androidInstallApp=i.android.installApp,e.androidMinimumVersionCode=i.android.minimumVersion,e.androidPackageName=i.android.packageName)}async function Of(t){const e=Bp(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Ff(t,e){const i=R(t),n=await Zp(i,{oobCode:e}),r=n.requestType;switch(zd(r,i,"internal-error"),r){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":zd(n.newEmail,i,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":zd(n.mfaInfo,i,"internal-error");default:zd(n.email,i,"internal-error")}let o=null;return n.mfaInfo&&(o=Rf._fromServerResponse(Bp(i),n.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===n.requestType?n.newEmail:n.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===n.requestType?n.email:n.newEmail)||null,multiFactorInfo:o},operation:r}}async function zf(t,e,i){const{auth:n}=t,r={idToken:await t.getIdToken(),returnSecureToken:!0};e&&(r.email=e),i&&(r.password=i);const o=await hp(t,async function(t,e){return Zd(t,"POST","/v1/accounts:update",e)}(n,r));await t._updateTokensIfNecessary(o,!0)}class Bf{constructor(t,e,i={}){this.isNewUser=t,this.providerId=e,this.profile=i}}class Uf extends Bf{constructor(t,e,i,n){super(t,e,i),this.username=n}}class Vf extends Bf{constructor(t,e){super(t,"facebook.com",e)}}class jf extends Uf{constructor(t,e){super(t,"github.com",e,"string"==typeof(null==e?void 0:e.login)?null==e?void 0:e.login:null)}}class Gf extends Bf{constructor(t,e){super(t,"google.com",e)}}class Hf extends Uf{constructor(t,e,i){super(t,"twitter.com",e,i)}}function Wf(t){const{user:e,_tokenResponse:i}=t;return e.isAnonymous&&!i?{providerId:null,isNewUser:!1,profile:null}:function(t){var e,i;if(!t)return null;const{providerId:n}=t,r=t.rawUserInfo?JSON.parse(t.rawUserInfo):{},o=t.isNewUser||"identitytoolkit#SignupNewUserResponse"===t.kind;if(!n&&(null==t?void 0:t.idToken)){const n=null===(i=null===(e=cp(t.idToken))||void 0===e?void 0:e.firebase)||void 0===i?void 0:i.sign_in_provider;if(n)return new Bf(o,"anonymous"!==n&&"custom"!==n?n:null)}if(!n)return null;switch(n){case"facebook.com":return new Vf(o,r);case"github.com":return new jf(o,r);case"google.com":return new Gf(o,r);case"twitter.com":return new Hf(o,r,t.screenName||null);case"custom":case"anonymous":return new Bf(o,null);default:return new Bf(o,n,r)}}(i)}class qf{constructor(t,e,i){this.type=t,this.credential=e,this.user=i}static _fromIdtoken(t,e){return new qf("enroll",t,e)}static _fromMfaPendingCredential(t){return new qf("signin",t)}toJSON(){const t="enroll"===this.type?"idToken":"pendingCredential";return{multiFactorSession:{[t]:this.credential}}}static fromJSON(t){var e,i;if(null==t?void 0:t.multiFactorSession){if(null===(e=t.multiFactorSession)||void 0===e?void 0:e.pendingCredential)return qf._fromMfaPendingCredential(t.multiFactorSession.pendingCredential);if(null===(i=t.multiFactorSession)||void 0===i?void 0:i.idToken)return qf._fromIdtoken(t.multiFactorSession.idToken)}return null}}class Xf{constructor(t,e,i){this.session=t,this.hints=e,this.signInResolver=i}static _fromError(t,e){const i=Bp(t),n=e.customData._serverResponse,r=(n.mfaInfo||[]).map((t=>Rf._fromServerResponse(i,t)));zd(n.mfaPendingCredential,i,"internal-error");const o=qf._fromMfaPendingCredential(n.mfaPendingCredential);return new Xf(o,r,(async t=>{const r=await t._process(i,o);delete n.mfaInfo,delete n.mfaPendingCredential;const s=Object.assign(Object.assign({},n),{idToken:r.idToken,refreshToken:r.refreshToken});switch(e.operationType){case"signIn":const t=await xf._fromIdTokenResponse(i,e.operationType,s);return await i._updateCurrentUser(t.user),t;case"reauthenticate":return zd(e.user,i,"internal-error"),xf._forOperation(e.user,e.operationType,s);default:Rd(i,"internal-error")}}))}async resolveSignIn(t){const e=t;return this.signInResolver(e)}}class $f{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload((e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map((e=>Rf._fromServerResponse(t.auth,e))))}))}static _fromUser(t){return new $f(t)}async getSession(){return qf._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(t,e){const i=t,n=await this.getSession(),r=await hp(this.user,i._process(this.user.auth,n,e));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(t){const e="string"==typeof t?t:t.uid,i=await this.user.getIdToken();try{const t=await hp(this.user,function(t,e){return Zd(t,"POST","/v2/accounts/mfaEnrollment:withdraw",Yd(t,e))}(this.user.auth,{idToken:i,mfaEnrollmentId:e}));this.enrolledFactors=this.enrolledFactors.filter((({uid:t})=>t!==e)),await this.user._updateTokensIfNecessary(t),await this.user.reload()}catch(t){throw t}}}const Yf=new WeakMap,Zf="__sak";class Kf{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(Zf,"1"),this.storage.removeItem(Zf),Promise.resolve(!0)):Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}class Jf extends Kf{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const t=p();return Ip(t)||Dp(t)}()&&function(){try{return!(!window||window===window.top)}catch(t){return!1}}(),this.fallbackToPolling=kp(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const i=this.storage.getItem(e),n=this.localCache[e];i!==n&&t(e,n,i)}}onStorageEvent(t,e=!1){if(!t.key)return void this.forAllChangedKeys(((t,e,i)=>{this.notifyListeners(t,i)}));const i=t.key;if(e?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const n=this.storage.getItem(i);if(t.newValue!==n)null!==t.newValue?this.storage.setItem(i,t.newValue):this.storage.removeItem(i);else if(this.localCache[i]===t.newValue&&!e)return}const n=()=>{const t=this.storage.getItem(i);(e||this.localCache[i]!==t)&&this.notifyListeners(i,t)},r=this.storage.getItem(i);y()&&10===document.documentMode&&r!==t.newValue&&t.newValue!==t.oldValue?setTimeout(n,10):n()}notifyListeners(t,e){this.localCache[t]=e;const i=this.listeners[t];if(i)for(const t of Array.from(i))t(e?JSON.parse(e):e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((t,e,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:i}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}Jf.type="LOCAL";const Qf=Jf;class tm extends Kf{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(t,e){}_removeListener(t,e){}}tm.type="SESSION";const em=tm;class im{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find((e=>e.isListeningto(t)));if(e)return e;const i=new im(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:i,eventType:n,data:r}=e.data,o=this.handlersMap[n];if(!(null==o?void 0:o.size))return;e.ports[0].postMessage({status:"ack",eventId:i,eventType:n});const s=Array.from(o).map((async t=>t(e.origin,r))),a=await function(t){return Promise.all(t.map((async t=>{try{return{fulfilled:!0,value:await t}}catch(t){return{fulfilled:!1,reason:t}}})))}(s);e.ports[0].postMessage({status:"done",eventId:i,eventType:n,response:a})}_subscribe(t,e){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),e&&0!==this.handlersMap[t].size||delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function nm(t="",e=10){let i="";for(let t=0;t<e;t++)i+=Math.floor(10*Math.random());return t+i}im.receivers=[];class rm{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,i=50){const n="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let r,o;return new Promise(((s,a)=>{const l=nm("",20);n.port1.start();const c=setTimeout((()=>{a(new Error("unsupported_event"))}),i);o={messageChannel:n,onMessage(t){const e=t;if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(c),r=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),s(e.data.response);break;default:clearTimeout(c),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(o),n.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:t,eventId:l,data:e},[n.port2])})).finally((()=>{o&&this.removeMessageHandler(o)}))}}function om(){return window}function sm(){return void 0!==om().WorkerGlobalScope&&"function"==typeof om().importScripts}const am="firebaseLocalStorageDb",lm="firebaseLocalStorage",cm="fbase_key";class um{constructor(t){this.request=t}toPromise(){return new Promise(((t,e)=>{this.request.addEventListener("success",(()=>{t(this.request.result)})),this.request.addEventListener("error",(()=>{e(this.request.error)}))}))}}function hm(t,e){return t.transaction([lm],e?"readwrite":"readonly").objectStore(lm)}function dm(){const t=indexedDB.open(am,1);return new Promise(((e,i)=>{t.addEventListener("error",(()=>{i(t.error)})),t.addEventListener("upgradeneeded",(()=>{const e=t.result;try{e.createObjectStore(lm,{keyPath:cm})}catch(t){i(t)}})),t.addEventListener("success",(async()=>{const i=t.result;i.objectStoreNames.contains(lm)?e(i):(i.close(),await function(){const t=indexedDB.deleteDatabase(am);return new um(t).toPromise()}(),e(await dm()))}))}))}async function pm(t,e,i){const n=hm(t,!0).put({[cm]:e,value:i});return new um(n).toPromise()}function fm(t,e){const i=hm(t,!0).delete(e);return new um(i).toPromise()}class mm{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await dm()),this.db}async _withRetries(t){let e=0;for(;;)try{const e=await this._openDb();return await t(e)}catch(t){if(e++>3)throw t;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return sm()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=im._getInstance(sm()?self:null),this.receiver._subscribe("keyChanged",(async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)}))),this.receiver._subscribe("ping",(async(t,e)=>["keyChanged"]))}async initializeSender(){var t,e;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new rm(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&(null===(t=i[0])||void 0===t?void 0:t.fulfilled)&&(null===(e=i[0])||void 0===e?void 0:e.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){var e;if(this.sender&&this.activeServiceWorker&&((null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await dm();return await pm(t,Zf,"1"),await fm(t,Zf),!0}catch(t){}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite((async()=>(await this._withRetries((i=>pm(i,t,e))),this.localCache[t]=e,this.notifyServiceWorker(t))))}async _get(t){const e=await this._withRetries((e=>async function(t,e){const i=hm(t,!1).get(e),n=await new um(i).toPromise();return void 0===n?null:n.value}(e,t)));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite((async()=>(await this._withRetries((e=>fm(e,t))),delete this.localCache[t],this.notifyServiceWorker(t))))}async _poll(){const t=await this._withRetries((t=>{const e=hm(t,!1).getAll();return new um(e).toPromise()}));if(!t)return[];if(0!==this.pendingWrites)return[];const e=[],i=new Set;if(0!==t.length)for(const{fbase_key:n,value:r}of t)i.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(r)&&(this.notifyListeners(n,r),e.push(n));for(const t of Object.keys(this.localCache))this.localCache[t]&&!i.has(t)&&(this.notifyListeners(t,null),e.push(t));return e}notifyListeners(t,e){this.localCache[t]=e;const i=this.listeners[t];if(i)for(const t of Array.from(i))t(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}mm.type="LOCAL";const gm=mm,_m=1e12;class ym{constructor(t){this.auth=t,this.counter=_m,this._widgets=new Map}render(t,e){const i=this.counter;return this._widgets.set(i,new vm(t,this.auth.name,e||{})),this.counter++,i}reset(t){var e;const i=t||_m;null===(e=this._widgets.get(i))||void 0===e||e.delete(),this._widgets.delete(i)}getResponse(t){var e;const i=t||_m;return(null===(e=this._widgets.get(i))||void 0===e?void 0:e.getResponse())||""}async execute(t){var e;const i=t||_m;return null===(e=this._widgets.get(i))||void 0===e||e.execute(),""}}class vm{constructor(t,e,i){this.params=i,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const n="string"==typeof t?document.getElementById(t):t;zd(n,"argument-error",{appName:e}),this.container=n,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(t){const e=[],i="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let t=0;t<50;t++)e.push(i.charAt(Math.floor(62*Math.random())));return e.join("")}();const{callback:t,"expired-callback":e}=this.params;if(t)try{t(this.responseToken)}catch(t){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,e)try{e()}catch(t){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const xm=Gp("rcb"),bm=new Hd(3e4,6e4);class wm{constructor(){var t;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(t=om().grecaptcha)||void 0===t?void 0:t.render)}load(t,e=""){return zd(function(t){return t.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(t)}(e),t,"argument-error"),this.shouldResolveImmediately(e)&&np(om().grecaptcha)?Promise.resolve(om().grecaptcha):new Promise(((i,n)=>{const r=om().setTimeout((()=>{n(Dd(t,"network-request-failed"))}),bm.get());om()[xm]=()=>{om().clearTimeout(r),delete om()[xm];const o=om().grecaptcha;if(!o||!np(o))return void n(Dd(t,"internal-error"));const s=o.render;o.render=(t,e)=>{const i=s(t,e);return this.counter++,i},this.hostLanguage=e,i(o)},jp(`${Vp.recaptchaV2Script}?${M({onload:xm,render:"explicit",hl:e})}`).catch((()=>{clearTimeout(r),n(Dd(t,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(t){var e;return!!(null===(e=om().grecaptcha)||void 0===e?void 0:e.render)&&(t===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Em{async load(t){return new ym(t)}clearedOneInstance(){}}const Sm="recaptcha",Tm={theme:"light",type:"image"};class Mm{constructor(t,e,i=Object.assign({},Tm)){this.parameters=i,this.type=Sm,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Bp(t),this.isInvisible="invisible"===this.parameters.size,zd("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const n="string"==typeof e?document.getElementById(e):e;zd(n,this.auth,"argument-error"),this.container=n,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Em:new wm,this.validateStartingState()}async verify(){this.assertNotDestroyed();const t=await this.render(),e=this.getAssertedRecaptcha();return e.getResponse(t)||new Promise((i=>{const n=t=>{t&&(this.tokenChangeListeners.delete(n),i(t))};this.tokenChangeListeners.add(n),this.isInvisible&&e.execute(t)}))}render(){try{this.assertNotDestroyed()}catch(t){return Promise.reject(t)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((t=>{throw this.renderPromise=null,t}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((t=>{this.container.removeChild(t)}))}validateStartingState(){zd(!this.parameters.sitekey,this.auth,"argument-error"),zd(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),zd("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(t){return e=>{if(this.tokenChangeListeners.forEach((t=>t(e))),"function"==typeof t)t(e);else if("string"==typeof t){const i=om()[t];"function"==typeof i&&i(e)}}}assertNotDestroyed(){zd(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let t=this.container;if(!this.isInvisible){const e=document.createElement("div");t.appendChild(e),t=e}this.widgetId=this.getAssertedRecaptcha().render(t,this.parameters)}return this.widgetId}async init(){zd(jd()&&!sm(),this.auth,"internal-error"),await function(){let t=null;return new Promise((e=>{"complete"!==document.readyState?(t=()=>e(),window.addEventListener("load",t)):e()})).catch((e=>{throw t&&window.removeEventListener("load",t),e}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const t=await async function(t){return(await Zd(t,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);zd(t,this.auth,"internal-error"),this.parameters.sitekey=t}getAssertedRecaptcha(){return zd(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Im{constructor(t,e){this.verificationId=t,this.onConfirmation=e}confirm(t){const e=af._fromVerification(this.verificationId,t);return this.onConfirmation(e)}}async function Cm(t,e,i){var n;const r=await i.verify();try{let o;if(zd("string"==typeof r,t,"argument-error"),zd(i.type===Sm,t,"argument-error"),o="string"==typeof e?{phoneNumber:e}:e,"session"in o){const e=o.session;if("phoneNumber"in o){zd("enroll"===e.type,t,"internal-error");const i=await function(t,e){return Zd(t,"POST","/v2/accounts/mfaEnrollment:start",Yd(t,e))}(t,{idToken:e.credential,phoneEnrollmentInfo:{phoneNumber:o.phoneNumber,recaptchaToken:r}});return i.phoneSessionInfo.sessionInfo}{zd("signin"===e.type,t,"internal-error");const i=(null===(n=o.multiFactorHint)||void 0===n?void 0:n.uid)||o.multiFactorUid;zd(i,t,"missing-multi-factor-info");const s=await function(t,e){return Zd(t,"POST","/v2/accounts/mfaSignIn:start",Yd(t,e))}(t,{mfaPendingCredential:e.credential,mfaEnrollmentId:i,phoneSignInInfo:{recaptchaToken:r}});return s.phoneResponseInfo.sessionInfo}}{const{sessionInfo:e}=await async function(t,e){return Zd(t,"POST","/v1/accounts:sendVerificationCode",Yd(t,e))}(t,{phoneNumber:o.phoneNumber,recaptchaToken:r});return e}}finally{i._reset()}}class Am{constructor(t){this.providerId=Am.PROVIDER_ID,this.auth=Bp(t)}verifyPhoneNumber(t,e){return Cm(this.auth,t,R(e))}static credential(t,e){return af._fromVerification(t,e)}static credentialFromResult(t){const e=t;return Am.credentialFromTaggedObject(e)}static credentialFromError(t){return Am.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{phoneNumber:e,temporaryProof:i}=t;return e&&i?af._fromTokenResponse(e,i):null}}function Pm(t,e){return e?xp(e):(zd(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}Am.PROVIDER_ID="phone",Am.PHONE_SIGN_IN_METHOD="phone";class Lm extends Yp{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return rf(t,this._buildIdpRequest())}_linkToIdToken(t,e){return rf(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return rf(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function Rm(t){return Cf(t.auth,new Lm(t),t.bypassAuthState)}function Dm(t){const{auth:e,user:i}=t;return zd(i,e,"internal-error"),If(i,new Lm(t),t.bypassAuthState)}async function km(t){const{auth:e,user:i}=t;return zd(i,e,"internal-error"),Tf(i,new Lm(t),t.bypassAuthState)}class Nm{constructor(t,e,i,n,r=!1){this.auth=t,this.resolver=i,this.user=n,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(t){this.reject(t)}}))}async onAuthEvent(t){const{urlResponse:e,sessionId:i,postBody:n,tenantId:r,error:o,type:s}=t;if(o)return void this.reject(o);const a={auth:this.auth,requestUri:e,sessionId:i,tenantId:r||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(a))}catch(t){this.reject(t)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Rm;case"linkViaPopup":case"linkViaRedirect":return km;case"reauthViaPopup":case"reauthViaRedirect":return Dm;default:Rd(this.auth,"internal-error")}}resolve(t){Ud(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Ud(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Om=new Hd(2e3,1e4);class Fm extends Nm{constructor(t,e,i,n,r){super(t,e,n,r),this.provider=i,this.authWindow=null,this.pollId=null,Fm.currentPopupAction&&Fm.currentPopupAction.cancel(),Fm.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return zd(t,this.auth,"internal-error"),t}async onExecution(){Ud(1===this.filter.length,"Popup operations only handle one event");const t=nm();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch((t=>{this.reject(t)})),this.resolver._isIframeWebStorageSupported(this.auth,(t=>{t||this.reject(Dd(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(Dd(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Fm.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,i;(null===(i=null===(e=this.authWindow)||void 0===e?void 0:e.window)||void 0===i?void 0:i.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Dd(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(t,Om.get())};t()}}Fm.currentPopupAction=null;const zm="pendingRedirect",Bm=new Map;class Um extends Nm{constructor(t,e,i=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,i),this.eventId=null}async execute(){let t=Bm.get(this.auth._key());if(!t){try{const e=await async function(t,e){const i=Hm(e),n=Gm(t);if(!await n._isAvailable())return!1;const r="true"===await n._get(i);return await n._remove(i),r}(this.resolver,this.auth),i=e?await super.execute():null;t=()=>Promise.resolve(i)}catch(e){t=()=>Promise.reject(e)}Bm.set(this.auth._key(),t)}return this.bypassAuthState||Bm.set(this.auth._key(),(()=>Promise.resolve(null))),t()}async onAuthEvent(t){if("signInViaRedirect"===t.type)return super.onAuthEvent(t);if("unknown"!==t.type){if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Vm(t,e){return Gm(t)._set(Hm(e),"true")}function jm(t,e){Bm.set(t._key(),e)}function Gm(t){return xp(t._redirectPersistence)}function Hm(t){return Ep(zm,t.config.apiKey,t.name)}async function Wm(t,e,i=!1){if(qt(t.app))return Promise.reject(Nd(t));const n=Bp(t),r=Pm(n,e),o=new Um(n,r,i),s=await o.execute();return s&&!i&&(delete s.user._redirectEventId,await n._persistUserIfCurrent(s.user),await n._setRedirectUser(null,e)),s}async function qm(t){const e=nm(`${t.uid}:::`);return t._redirectEventId=e,await t.auth._setRedirectUser(t),await t.auth._persistUserIfCurrent(t),e}class Xm{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach((i=>{this.isEventForConsumer(t,i)&&(e=!0,this.sendToConsumer(t,i),this.saveEventToCache(t))})),this.hasHandledPotentialRedirect||!function(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ym(t);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var i;if(t.error&&!Ym(t)){const n=(null===(i=t.error.code)||void 0===i?void 0:i.split("auth/")[1])||"internal-error";e.onError(Dd(this.auth,n))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const i=null===e.eventId||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&i}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has($m(t))}saveEventToCache(t){this.cachedEventUids.add($m(t)),this.lastProcessedEventTime=Date.now()}}function $m(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter((t=>t)).join("-")}function Ym({type:t,error:e}){return"unknown"===t&&"auth/no-auth-event"===(null==e?void 0:e.code)}async function Zm(t,e={}){return Zd(t,"GET","/v1/projects",e)}const Km=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Jm=/^https?/;function Qm(t){const e=Vd(),{protocol:i,hostname:n}=new URL(e);if(t.startsWith("chrome-extension://")){const r=new URL(t);return""===r.hostname&&""===n?"chrome-extension:"===i&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===i&&r.hostname===n}if(!Jm.test(i))return!1;if(Km.test(t))return n===t;const r=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(n)}const tg=new Hd(3e4,6e4);function eg(){const t=om().___jsl;if(null==t?void 0:t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}function ig(t){return new Promise(((e,i)=>{var n,r,o;function s(){eg(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{eg(),i(Dd(t,"network-request-failed"))},timeout:tg.get()})}if(null===(r=null===(n=om().gapi)||void 0===n?void 0:n.iframes)||void 0===r?void 0:r.Iframe)e(gapi.iframes.getContext());else{if(!(null===(o=om().gapi)||void 0===o?void 0:o.load)){const e=Gp("iframefcb");return om()[e]=()=>{gapi.load?s():i(Dd(t,"network-request-failed"))},jp(`${Vp.gapiScript}?onload=${e}`).catch((t=>i(t)))}s()}})).catch((t=>{throw ng=null,t}))}let ng=null;const rg=new Hd(5e3,15e3),og="__/auth/iframe",sg="emulator/auth/iframe",ag={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},lg=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function cg(t){const e=t.config;zd(e.authDomain,t,"auth-domain-config-required");const i=e.emulator?Wd(e,sg):`https://${t.config.authDomain}/${og}`,n={apiKey:e.apiKey,appName:t.name,v:Kt},r=lg.get(t.config.apiHost);r&&(n.eid=r);const o=t._getFrameworks();return o.length&&(n.fw=o.join(",")),`${i}?${M(n).slice(1)}`}const ug={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class hg{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}}const dg="__/auth/handler",pg="emulator/auth/handler",fg=encodeURIComponent("fac");async function mg(t,e,i,n,r,o){zd(t.config.authDomain,t,"auth-domain-config-required"),zd(t.config.apiKey,t,"invalid-api-key");const s={apiKey:t.config.apiKey,appName:t.name,authType:i,redirectUrl:n,v:Kt,eventId:r};if(e instanceof uf){e.setDefaultLanguage(t.languageCode),s.providerId=e.providerId||"",function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(e.getCustomParameters())||(s.customParameters=JSON.stringify(e.getCustomParameters()));for(const[t,e]of Object.entries(o||{}))s[t]=e}if(e instanceof hf){const t=e.getScopes().filter((t=>""!==t));t.length>0&&(s.scopes=t.join(","))}t.tenantId&&(s.tid=t.tenantId);const a=s;for(const t of Object.keys(a))void 0===a[t]&&delete a[t];const l=await t._getAppCheckToken(),c=l?`#${fg}=${encodeURIComponent(l)}`:"";return`${function({config:t}){return t.emulator?Wd(t,pg):`https://${t.authDomain}/${dg}`}(t)}?${M(a).slice(1)}${c}`}const gg="webStorageSupport",_g=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=em,this._completeRedirectFn=Wm,this._overrideRedirectResult=jm}async _openPopup(t,e,i,n){var r;return Ud(null===(r=this.eventManagers[t._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()"),function(t,e,i,n=500,r=600){const o=Math.max((window.screen.availHeight-r)/2,0).toString(),s=Math.max((window.screen.availWidth-n)/2,0).toString();let a="";const l=Object.assign(Object.assign({},ug),{width:n.toString(),height:r.toString(),top:o,left:s}),c=p().toLowerCase();i&&(a=Cp(c)?"_blank":i),Mp(c)&&(e=e||"http://localhost",l.scrollbars="yes");const u=Object.entries(l).reduce(((t,[e,i])=>`${t}${e}=${i},`),"");if(function(t=p()){var e;return Dp(t)&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(c)&&"_self"!==a)return function(t,e){const i=document.createElement("a");i.href=t,i.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(n)}(e||"",a),new hg(null);const h=window.open(e||"",a,u);zd(h,t,"popup-blocked");try{h.focus()}catch(t){}return new hg(h)}(t,await mg(t,e,i,Vd(),n),nm())}async _openRedirect(t,e,i,n){return await this._originValidation(t),r=await mg(t,e,i,Vd(),n),om().location.href=r,new Promise((()=>{}));var r}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:t,promise:i}=this.eventManagers[e];return t?Promise.resolve(t):(Ud(i,"If manager is not set, promise should be"),i)}const i=this.initAndGetManager(t);return this.eventManagers[e]={promise:i},i.catch((()=>{delete this.eventManagers[e]})),i}async initAndGetManager(t){const e=await async function(t){const e=await function(t){return ng=ng||ig(t),ng}(t),i=om().gapi;return zd(i,t,"internal-error"),e.open({where:document.body,url:cg(t),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ag,dontclear:!0},(e=>new Promise((async(i,n)=>{await e.restyle({setHideOnLeave:!1});const r=Dd(t,"network-request-failed"),o=om().setTimeout((()=>{n(r)}),rg.get());function s(){om().clearTimeout(o),i(e)}e.ping(s).then(s,(()=>{n(r)}))}))))}(t),i=new Xm(t);return e.register("authEvent",(e=>(zd(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:i.onEvent(e.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:i},this.iframes[t._key()]=e,i}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(gg,{type:gg},(i=>{var n;const r=null===(n=null==i?void 0:i[0])||void 0===n?void 0:n[gg];void 0!==r&&e(!!r),Rd(t,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=async function(t){if(t.config.emulator)return;const{authorizedDomains:e}=await Zm(t);for(const t of e)try{if(Qm(t))return}catch(t){}Rd(t,"unauthorized-domain")}(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return kp()||Ip()||Dp()}};class yg{constructor(t){this.factorId=t}_process(t,e,i){switch(e.type){case"enroll":return this._finalizeEnroll(t,e.credential,i);case"signin":return this._finalizeSignIn(t,e.credential);default:return Bd("unexpected MultiFactorSessionType")}}}class vg extends yg{constructor(t){super("phone"),this.credential=t}static _fromCredential(t){return new vg(t)}_finalizeEnroll(t,e,i){return function(t,e){return Zd(t,"POST","/v2/accounts/mfaEnrollment:finalize",Yd(t,e))}(t,{idToken:e,displayName:i,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(t,e){return function(t,e){return Zd(t,"POST","/v2/accounts/mfaSignIn:finalize",Yd(t,e))}(t,{mfaPendingCredential:e,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class xg{constructor(){}static assertion(t){return vg._fromCredential(t)}}xg.FACTOR_ID="phone";var bg,wg,Eg="@firebase/auth",Sg="1.7.2";class Tg{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),(null===(t=this.auth.currentUser)||void 0===t?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged((e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)}));this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){zd(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Mg(){return window}null===(bg=u())||void 0===bg||bg._authIdTokenMaxAge,function(t){Vp=t}({loadJS:t=>new Promise(((e,i)=>{const n=document.createElement("script");n.setAttribute("src",t),n.onload=e,n.onerror=t=>{const e=Dd("internal-error");e.customData=t,i(e)},n.type="text/javascript",n.charset="UTF-8",function(){var t,e;return null!==(e=null===(t=document.getElementsByTagName("head"))||void 0===t?void 0:t[0])&&void 0!==e?e:document}().appendChild(n)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),wg="Browser",jt(new D("auth",((t,{options:e})=>{const i=t.getProvider("app").getImmediate(),n=t.getProvider("heartbeat"),r=t.getProvider("app-check-internal"),{apiKey:o,authDomain:s}=i.options;zd(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});const a={apiKey:o,authDomain:s,clientPlatform:wg,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Np(wg)},l=new zp(i,n,r,a);return function(t,e){const i=(null==e?void 0:e.persistence)||[],n=(Array.isArray(i)?i:[i]).map(xp);(null==e?void 0:e.errorMap)&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(n,null==e?void 0:e.popupRedirectResolver)}(l,e),l}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((t,e,i)=>{t.getProvider("auth-internal").initialize()}))),jt(new D("auth-internal",(t=>(t=>new Tg(t))(Bp(t.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),ne(Eg,Sg,function(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(wg)),ne(Eg,Sg,"esm2017");class Ig extends Xm{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((t=>{this.resolveInialized=t}))}addPassiveListener(t){this.passiveListeners.add(t)}removePassiveListener(t){this.passiveListeners.delete(t)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInialized(),this.passiveListeners.forEach((e=>e(t))),super.onEvent(t)}async initialized(){await this.initPromise}}async function Cg(t){const e=await Pg()._get(Lg(t));return e&&await Pg()._remove(Lg(t)),e}function Ag(){const t=[];for(let e=0;e<20;e++){const e=Math.floor(62*Math.random());t.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(e))}return t.join("")}function Pg(){return xp(Qf)}function Lg(t){return Ep("authEvent",t.config.apiKey,t.name)}function Rg(t){if(!(null==t?void 0:t.includes("?")))return{};const[e,...i]=t.split("?");return I(i.join("?"))}const Dg=class{constructor(){this._redirectPersistence=em,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Wm,this._overrideRedirectResult=jm}async _initialize(t){const e=t._key();let i=this.eventManagers.get(e);return i||(i=new Ig(t),this.eventManagers.set(e,i),this.attachCallbackListeners(t,i)),i}_openPopup(t){Rd(t,"operation-not-supported-in-this-environment")}async _openRedirect(t,e,i,n){!function(t){var e,i,n,r,o,s,a,l,c,u;const h=Mg();zd("function"==typeof(null===(e=null==h?void 0:h.universalLinks)||void 0===e?void 0:e.subscribe),t,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),zd(void 0!==(null===(i=null==h?void 0:h.BuildInfo)||void 0===i?void 0:i.packageName),t,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),zd("function"==typeof(null===(o=null===(r=null===(n=null==h?void 0:h.cordova)||void 0===n?void 0:n.plugins)||void 0===r?void 0:r.browsertab)||void 0===o?void 0:o.openUrl),t,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),zd("function"==typeof(null===(l=null===(a=null===(s=null==h?void 0:h.cordova)||void 0===s?void 0:s.plugins)||void 0===a?void 0:a.browsertab)||void 0===l?void 0:l.isAvailable),t,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),zd("function"==typeof(null===(u=null===(c=null==h?void 0:h.cordova)||void 0===c?void 0:c.InAppBrowser)||void 0===u?void 0:u.open),t,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(t);const r=await this._initialize(t);await r.initialized(),r.resetRedirect(),Bm.clear(),await this._originValidation(t);const o=function(t,e,i=null){return{type:e,eventId:i,urlResponse:null,sessionId:Ag(),postBody:null,tenantId:t.tenantId,error:Dd(t,"no-auth-event")}}(t,i,n);await function(t,e){return Pg()._set(Lg(t),e)}(t,o);const s=await async function(t,e,i){var n;const{BuildInfo:r}=Mg();Ud(e.sessionId,"AuthEvent did not contain a session ID");const o=await async function(t){const e=function(t){if(Ud(/[0-9a-zA-Z]+/.test(t),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(t);const e=new ArrayBuffer(t.length),i=new Uint8Array(e);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);return i}(t),i=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(i)).map((t=>t.toString(16).padStart(2,"0"))).join("")}(e.sessionId),s={};return Dp()?s.ibi=r.packageName:Pp()?s.apn=r.packageName:Rd(t,"operation-not-supported-in-this-environment"),r.displayName&&(s.appDisplayName=r.displayName),s.sessionId=o,mg(t,i,e.type,void 0,null!==(n=e.eventId)&&void 0!==n?n:void 0,s)}(t,o,e);return async function(t,e,i){const{cordova:n}=Mg();let r=()=>{};try{await new Promise(((o,s)=>{let a=null;function l(){var t;o();const e=null===(t=n.plugins.browsertab)||void 0===t?void 0:t.close;"function"==typeof e&&e(),"function"==typeof(null==i?void 0:i.close)&&i.close()}function c(){a||(a=window.setTimeout((()=>{s(Dd(t,"redirect-cancelled-by-user"))}),2e3))}function u(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&c()}e.addPassiveListener(l),document.addEventListener("resume",c,!1),Pp()&&document.addEventListener("visibilitychange",u,!1),r=()=>{e.removePassiveListener(l),document.removeEventListener("resume",c,!1),document.removeEventListener("visibilitychange",u,!1),a&&window.clearTimeout(a)}}))}finally{r()}}(t,r,await function(t){const{cordova:e}=Mg();return new Promise((i=>{e.plugins.browsertab.isAvailable((n=>{let r=null;n?e.plugins.browsertab.openUrl(t):r=e.InAppBrowser.open(t,function(t=p()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(t)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(t)}()?"_blank":"_system","location=yes"),i(r)}))}))}(s))}_isIframeWebStorageSupported(t,e){throw new Error("Method not implemented.")}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=async function(t){const{BuildInfo:e}=Mg(),i={};Dp()?i.iosBundleId=e.packageName:Pp()?i.androidPackageName=e.packageName:Rd(t,"operation-not-supported-in-this-environment"),await Zm(t,i)}(t)),this.originValidationPromises[e]}attachCallbackListeners(t,e){const{universalLinks:i,handleOpenURL:n,BuildInfo:r}=Mg(),o=setTimeout((async()=>{await Cg(t),e.onEvent(kg())}),500),s=async i=>{clearTimeout(o);const n=await Cg(t);let r=null;n&&(null==i?void 0:i.url)&&(r=function(t,e){var i,n;const r=function(t){const e=Rg(t),i=e.link?decodeURIComponent(e.link):void 0,n=Rg(i).link,r=e.deep_link_id?decodeURIComponent(e.deep_link_id):void 0;return Rg(r).link||r||n||i||t}(e);if(r.includes("/__/auth/callback")){const e=Rg(r),o=e.firebaseError?function(t){try{return JSON.parse(t)}catch(t){return null}}(decodeURIComponent(e.firebaseError)):null,s=null===(n=null===(i=null==o?void 0:o.code)||void 0===i?void 0:i.split("auth/"))||void 0===n?void 0:n[1],a=s?Dd(s):null;return a?{type:t.type,eventId:t.eventId,tenantId:t.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:t.type,eventId:t.eventId,tenantId:t.tenantId,sessionId:t.sessionId,urlResponse:r,postBody:null}}return null}(n,i.url)),e.onEvent(r||kg())};void 0!==i&&"function"==typeof i.subscribe&&i.subscribe(null,s);const a=n,l=`${r.packageName.toLowerCase()}://`;Mg().handleOpenURL=async t=>{if(t.toLowerCase().startsWith(l)&&s({url:t}),"function"==typeof a)try{a(t)}catch(t){console.error(t)}}}};function kg(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Dd("no-auth-event")}}function Ng(){var t;return(null===(t=null===self||void 0===self?void 0:self.location)||void 0===t?void 0:t.protocol)||null}function Og(t=p()){return!("file:"!==Ng()&&"ionic:"!==Ng()&&"capacitor:"!==Ng()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function Fg(){try{const t=self.localStorage,e=nm();if(t)return t.setItem(e,"1"),t.removeItem(e),!function(t=p()){return y()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(t=p()){return/Edge\/\d+/.test(t)}(t)}()||v()}catch(t){return zg()&&v()}return!1}function zg(){return void 0!==i.g&&"WorkerGlobalScope"in i.g&&"importScripts"in i.g}function Bg(){return("http:"===Ng()||"https:"===Ng()||g()||Og())&&!(_()||f())&&Fg()&&!zg()}function Ug(){return Og()&&"undefined"!=typeof document}const Vg={LOCAL:"local",NONE:"none",SESSION:"session"},jg=zd,Gg="persistence";async function Hg(t){await t._initializationPromise;const e=Wg(),i=Ep(Gg,t.config.apiKey,t.name);e&&e.setItem(i,t._getPersistence())}function Wg(){var t;try{return(null===(t="undefined"!=typeof window?window:null)||void 0===t?void 0:t.sessionStorage)||null}catch(t){return null}}const qg=zd;class Xg{constructor(){this.browserResolver=xp(_g),this.cordovaResolver=xp(Dg),this.underlyingResolver=null,this._redirectPersistence=em,this._completeRedirectFn=Wm,this._overrideRedirectResult=jm}async _initialize(t){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(t)}async _openPopup(t,e,i,n){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(t,e,i,n)}async _openRedirect(t,e,i,n){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(t,e,i,n)}_isIframeWebStorageSupported(t,e){this.assertedUnderlyingResolver._isIframeWebStorageSupported(t,e)}_originValidation(t){return this.assertedUnderlyingResolver._originValidation(t)}get _shouldInitProactively(){return Ug()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return qg(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const t=await async function(){return!!Ug()&&new Promise((t=>{const e=setTimeout((()=>{t(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(e),t(!0)}))}))}();this.underlyingResolver=t?this.cordovaResolver:this.browserResolver}}function $g(t){return t.unwrap()}function Yg(t){const{_tokenResponse:e}=t instanceof x?t.customData:t;if(!e)return null;if(!(t instanceof x)&&"temporaryProof"in e&&"phoneNumber"in e)return Am.credentialFromResult(t);const i=e.providerId;if(!i||i===Md.PASSWORD)return null;let n;switch(i){case Md.GOOGLE:n=ff;break;case Md.FACEBOOK:n=pf;break;case Md.GITHUB:n=mf;break;case Md.TWITTER:n=yf;break;default:const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:o,pendingToken:s,nonce:a}=e;return r||o||t||s?s?i.startsWith("saml.")?gf._create(i,s):of._fromParams({providerId:i,signInMethod:i,pendingToken:s,idToken:t,accessToken:r}):new df(i).credential({idToken:t,accessToken:r,rawNonce:a}):null}return t instanceof x?n.credentialFromError(t):n.credentialFromResult(t)}function Zg(t,e){return e.catch((e=>{throw e instanceof x&&function(t,e){var i;const n=null===(i=e.customData)||void 0===i?void 0:i._tokenResponse;if("auth/multi-factor-auth-required"===(null==e?void 0:e.code))e.resolver=new Jg(t,function(t,e){var i;const n=R(t),r=e;return zd(e.customData.operationType,n,"argument-error"),zd(null===(i=r.customData._serverResponse)||void 0===i?void 0:i.mfaPendingCredential,n,"argument-error"),Xf._fromError(n,r)}(t,e));else if(n){const t=Yg(e),i=e;t&&(i.credential=t,i.tenantId=n.tenantId||void 0,i.email=n.email||void 0,i.phoneNumber=n.phoneNumber||void 0)}}(t,e),e})).then((t=>{const e=t.operationType,i=t.user;return{operationType:e,credential:(n=t,Yg(n)),additionalUserInfo:Wf(t),user:Qg.getOrCreate(i)};var n}))}async function Kg(t,e){const i=await e;return{verificationId:i.verificationId,confirm:e=>Zg(t,i.confirm(e))}}class Jg{constructor(t,e){this.resolver=e,this.auth=t.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(t){return Zg($g(this.auth),this.resolver.resolveSignIn(t))}}class Qg{constructor(t){this._delegate=t,this.multiFactor=function(t){const e=R(t);return Yf.has(e)||Yf.set(e,$f._fromUser(e)),Yf.get(e)}(t)}static getOrCreate(t){return Qg.USER_MAP.has(t)||Qg.USER_MAP.set(t,new Qg(t)),Qg.USER_MAP.get(t)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(t){return this._delegate.getIdTokenResult(t)}getIdToken(t){return this._delegate.getIdToken(t)}linkAndRetrieveDataWithCredential(t){return this.linkWithCredential(t)}async linkWithCredential(t){return Zg(this.auth,Pf(this._delegate,t))}async linkWithPhoneNumber(t,e){return Kg(this.auth,async function(t,e,i){const n=R(t);await Mf(!1,n,"phone");const r=await Cm(n.auth,e,R(i));return new Im(r,(t=>Pf(n,t)))}(this._delegate,t,e))}async linkWithPopup(t){return Zg(this.auth,async function(t,e,i){const n=R(t);Od(n.auth,e,uf);const r=Pm(n.auth,i);return new Fm(n.auth,"linkViaPopup",e,r,n).executeNotNull()}(this._delegate,t,Xg))}async linkWithRedirect(t){return await Hg(Bp(this.auth)),function(t,e,i){return async function(t,e,i){const n=R(t);Od(n.auth,e,uf),await n.auth._initializationPromise;const r=Pm(n.auth,i);await Mf(!1,n,e.providerId),await Vm(r,n.auth);const o=await qm(n);return r._openRedirect(n.auth,e,"linkViaRedirect",o)}(t,e,i)}(this._delegate,t,Xg)}reauthenticateAndRetrieveDataWithCredential(t){return this.reauthenticateWithCredential(t)}async reauthenticateWithCredential(t){return Zg(this.auth,Lf(this._delegate,t))}reauthenticateWithPhoneNumber(t,e){return Kg(this.auth,async function(t,e,i){const n=R(t);if(qt(n.auth.app))return Promise.reject(Nd(n.auth));const r=await Cm(n.auth,e,R(i));return new Im(r,(t=>Lf(n,t)))}(this._delegate,t,e))}reauthenticateWithPopup(t){return Zg(this.auth,async function(t,e,i){const n=R(t);if(qt(n.auth.app))return Promise.reject(Dd(n.auth,"operation-not-supported-in-this-environment"));Od(n.auth,e,uf);const r=Pm(n.auth,i);return new Fm(n.auth,"reauthViaPopup",e,r,n).executeNotNull()}(this._delegate,t,Xg))}async reauthenticateWithRedirect(t){return await Hg(Bp(this.auth)),function(t,e,i){return async function(t,e,i){const n=R(t);if(Od(n.auth,e,uf),qt(n.auth.app))return Promise.reject(Nd(n.auth));await n.auth._initializationPromise;const r=Pm(n.auth,i);await Vm(r,n.auth);const o=await qm(n);return r._openRedirect(n.auth,e,"reauthViaRedirect",o)}(t,e,i)}(this._delegate,t,Xg)}sendEmailVerification(t){return async function(t,e){const i=R(t),n={requestType:"VERIFY_EMAIL",idToken:await t.getIdToken()};e&&Nf(i.auth,n,e);const{email:r}=await async function(t,e){return Qp(t,e)}(i.auth,n);r!==t.email&&await t.reload()}(this._delegate,t)}async unlink(t){return await async function(t,e){const i=R(t);await Mf(!0,i,e);const{providerUserInfo:n}=await async function(t,e){return Zd(t,"POST","/v1/accounts:update",e)}(i.auth,{idToken:await i.getIdToken(),deleteProvider:[e]}),r=Sf(n||[]);return i.providerData=i.providerData.filter((t=>r.has(t.providerId))),r.has("phone")||(i.phoneNumber=null),await i.auth._persistUserIfCurrent(i),i}(this._delegate,t),this}updateEmail(t){return function(t,e){const i=R(t);return qt(i.auth.app)?Promise.reject(Nd(i.auth)):zf(i,e,null)}(this._delegate,t)}updatePassword(t){return function(t,e){return zf(R(t),null,e)}(this._delegate,t)}updatePhoneNumber(t){return async function(t,e){const i=R(t);if(qt(i.auth.app))return Promise.reject(Nd(i.auth));await Tf(i,e)}(this._delegate,t)}updateProfile(t){return async function(t,{displayName:e,photoURL:i}){if(void 0===e&&void 0===i)return;const n=R(t),r={idToken:await n.getIdToken(),displayName:e,photoUrl:i,returnSecureToken:!0},o=await hp(n,async function(t,e){return Zd(t,"POST","/v1/accounts:update",e)}(n.auth,r));n.displayName=o.displayName||null,n.photoURL=o.photoUrl||null;const s=n.providerData.find((({providerId:t})=>"password"===t));s&&(s.displayName=n.displayName,s.photoURL=n.photoURL),await n._updateTokensIfNecessary(o)}(this._delegate,t)}verifyBeforeUpdateEmail(t,e){return async function(t,e,i){const n=R(t),r={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await t.getIdToken(),newEmail:e};i&&Nf(n.auth,r,i);const{email:o}=await async function(t,e){return Qp(t,e)}(n.auth,r);o!==t.email&&await t.reload()}(this._delegate,t,e)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Qg.USER_MAP=new WeakMap;const t_=zd;class e_{constructor(t,e){if(this.app=t,e.isInitialized())return this._delegate=e.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:i}=t.options;t_(i,"invalid-api-key",{appName:t.name}),t_(i,"invalid-api-key",{appName:t.name});const n="undefined"!=typeof window?Xg:void 0;this._delegate=e.initialize({options:{persistence:n_(i,t.name),popupRedirectResolver:n}}),this._delegate._updateErrorMap(Id),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Qg.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(t){this._delegate.languageCode=t}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(t){this._delegate.tenantId=t}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(t,e){!function(t,e,i){const n=Bp(t);zd(n._canInitEmulator,n,"emulator-config-failed"),zd(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const r=!!(null==i?void 0:i.disableWarnings),o=Xp(e),{host:s,port:a}=function(t){const e=Xp(t),i=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!i)return{host:"",port:null};const n=i[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(n);if(r){const t=r[1];return{host:t,port:$p(n.substr(t.length+1))}}{const[t,e]=n.split(":");return{host:t,port:$p(e)}}}(e),l=null===a?"":`:${a}`;n.config.emulator={url:`${o}//${s}${l}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:s,port:a,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||function(){function t(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",t):t())}()}(this._delegate,t,e)}applyActionCode(t){return async function(t,e){await async function(t,e){return Zd(t,"POST","/v1/accounts:update",Yd(t,e))}(R(t),{oobCode:e})}(this._delegate,t)}checkActionCode(t){return Ff(this._delegate,t)}confirmPasswordReset(t,e){return async function(t,e,i){await Zp(R(t),{oobCode:e,newPassword:i}).catch((async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&Of(t),e}))}(this._delegate,t,e)}async createUserWithEmailAndPassword(t,e){return Zg(this._delegate,async function(t,e,i){if(qt(t.app))return Promise.reject(Nd(t));const n=Bp(t),r=qp(n,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",vf),o=await r.catch((e=>{throw"auth/password-does-not-meet-requirements"===e.code&&Of(t),e})),s=await xf._fromIdTokenResponse(n,"signIn",o);return await n._updateCurrentUser(s.user),s}(this._delegate,t,e))}fetchProvidersForEmail(t){return this.fetchSignInMethodsForEmail(t)}fetchSignInMethodsForEmail(t){return async function(t,e){const i={identifier:e,continueUri:jd()?Vd():"http://localhost"},{signinMethods:n}=await async function(t,e){return Zd(t,"POST","/v1/accounts:createAuthUri",Yd(t,e))}(R(t),i);return n||[]}(this._delegate,t)}isSignInWithEmailLink(t){return function(t,e){const i=lf.parseLink(e);return"EMAIL_SIGNIN"===(null==i?void 0:i.operation)}(this._delegate,t)}async getRedirectResult(){t_(Bg(),this._delegate,"operation-not-supported-in-this-environment");const t=await async function(t,e){return await Bp(t)._initializationPromise,Wm(t,e,!1)}(this._delegate,Xg);return t?Zg(this._delegate,Promise.resolve(t)):{credential:null,user:null}}addFrameworkForLogging(t){!function(t,e){Bp(t)._logFramework(e)}(this._delegate,t)}onAuthStateChanged(t,e,i){const{next:n,error:r,complete:o}=i_(t,e,i);return this._delegate.onAuthStateChanged(n,r,o)}onIdTokenChanged(t,e,i){const{next:n,error:r,complete:o}=i_(t,e,i);return this._delegate.onIdTokenChanged(n,r,o)}sendSignInLinkToEmail(t,e){return async function(t,e,i){const n=Bp(t),r={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};!function(t,e){zd(e.handleCodeInApp,n,"argument-error"),e&&Nf(n,t,e)}(r,i),await qp(n,r,"getOobCode",ef)}(this._delegate,t,e)}sendPasswordResetEmail(t,e){return async function(t,e,i){const n=Bp(t),r={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};i&&Nf(n,r,i),await qp(n,r,"getOobCode",tf)}(this._delegate,t,e||void 0)}async setPersistence(t){let e;switch(function(t,e){jg(Object.values(Vg).includes(e),t,"invalid-persistence-type"),_()?jg(e!==Vg.SESSION,t,"unsupported-persistence-type"):f()?jg(e===Vg.NONE,t,"unsupported-persistence-type"):zg()?jg(e===Vg.NONE||e===Vg.LOCAL&&v(),t,"unsupported-persistence-type"):jg(e===Vg.NONE||Fg(),t,"unsupported-persistence-type")}(this._delegate,t),t){case Vg.SESSION:e=em;break;case Vg.LOCAL:e=await xp(gm)._isAvailable()?gm:Qf;break;case Vg.NONE:e=wp;break;default:return Rd("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(e)}signInAndRetrieveDataWithCredential(t){return this.signInWithCredential(t)}signInAnonymously(){return Zg(this._delegate,async function(t){var e;if(qt(t.app))return Promise.reject(Nd(t));const i=Bp(t);if(await i._initializationPromise,null===(e=i.currentUser)||void 0===e?void 0:e.isAnonymous)return new xf({user:i.currentUser,providerId:null,operationType:"signIn"});const n=await vf(i,{returnSecureToken:!0}),r=await xf._fromIdTokenResponse(i,"signIn",n,!0);return await i._updateCurrentUser(r.user),r}(this._delegate))}signInWithCredential(t){return Zg(this._delegate,Af(this._delegate,t))}signInWithCustomToken(t){return Zg(this._delegate,async function(t,e){if(qt(t.app))return Promise.reject(Nd(t));const i=Bp(t),n=await async function(t,e){return Jd(t,"POST","/v1/accounts:signInWithCustomToken",Yd(t,e))}(i,{token:e,returnSecureToken:!0}),r=await xf._fromIdTokenResponse(i,"signIn",n);return await i._updateCurrentUser(r.user),r}(this._delegate,t))}signInWithEmailAndPassword(t,e){return Zg(this._delegate,function(t,e,i){return qt(t.app)?Promise.reject(Nd(t)):Af(R(t),cf.credential(e,i)).catch((async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&Of(t),e}))}(this._delegate,t,e))}signInWithEmailLink(t,e){return Zg(this._delegate,async function(t,e,i){if(qt(t.app))return Promise.reject(Nd(t));const n=R(t),r=cf.credentialWithLink(e,i||Vd());return zd(r._tenantId===(n.tenantId||null),n,"tenant-id-mismatch"),Af(n,r)}(this._delegate,t,e))}signInWithPhoneNumber(t,e){return Kg(this._delegate,async function(t,e,i){if(qt(t.app))return Promise.reject(Nd(t));const n=Bp(t),r=await Cm(n,e,R(i));return new Im(r,(t=>Af(n,t)))}(this._delegate,t,e))}async signInWithPopup(t){return t_(Bg(),this._delegate,"operation-not-supported-in-this-environment"),Zg(this._delegate,async function(t,e,i){if(qt(t.app))return Promise.reject(Dd(t,"operation-not-supported-in-this-environment"));const n=Bp(t);Od(t,e,uf);const r=Pm(n,i);return new Fm(n,"signInViaPopup",e,r).executeNotNull()}(this._delegate,t,Xg))}async signInWithRedirect(t){return t_(Bg(),this._delegate,"operation-not-supported-in-this-environment"),await Hg(this._delegate),function(t,e,i){return async function(t,e,i){if(qt(t.app))return Promise.reject(Nd(t));const n=Bp(t);Od(t,e,uf),await n._initializationPromise;const r=Pm(n,i);return await Vm(r,n),r._openRedirect(n,e,"signInViaRedirect")}(t,e,i)}(this._delegate,t,Xg)}updateCurrentUser(t){return this._delegate.updateCurrentUser(t)}verifyPasswordResetCode(t){return async function(t,e){const{data:i}=await Ff(R(t),e);return i.email}(this._delegate,t)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function i_(t,e,i){let n=t;"function"!=typeof t&&({next:n,error:e,complete:i}=t);const r=n;return{next:t=>r(t&&Qg.getOrCreate(t)),error:e,complete:i}}function n_(t,e){const i=function(t,e){const i=Wg();if(!i)return[];const n=Ep(Gg,t,e);switch(i.getItem(n)){case Vg.NONE:return[wp];case Vg.LOCAL:return[gm,em];case Vg.SESSION:return[em];default:return[]}}(t,e);if("undefined"==typeof self||i.includes(gm)||i.push(gm),"undefined"!=typeof window)for(const t of[Qf,em])i.includes(t)||i.push(t);return i.includes(wp)||i.push(wp),i}e_.Persistence=Vg;class r_{constructor(){this.providerId="phone",this._delegate=new Am($g(Sd.auth()))}static credential(t,e){return Am.credential(t,e)}verifyPhoneNumber(t,e){return this._delegate.verifyPhoneNumber(t,e)}unwrap(){return this._delegate}}r_.PHONE_SIGN_IN_METHOD=Am.PHONE_SIGN_IN_METHOD,r_.PROVIDER_ID=Am.PROVIDER_ID;const o_=zd;var s_;(s_=Sd).INTERNAL.registerComponent(new D("auth-compat",(t=>{const e=t.getProvider("app-compat").getImmediate(),i=t.getProvider("auth");return new e_(e,i)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:cf,FacebookAuthProvider:pf,GithubAuthProvider:mf,GoogleAuthProvider:ff,OAuthProvider:df,SAMLAuthProvider:_f,PhoneAuthProvider:r_,PhoneMultiFactorGenerator:xg,RecaptchaVerifier:class{constructor(t,e,i=Sd.app()){var n;o_(null===(n=i.options)||void 0===n?void 0:n.apiKey,"invalid-api-key",{appName:i.name}),this._delegate=new Mm(i.auth(),t,e),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:yf,Auth:e_,AuthCredential:Yp,Error:x}).setInstantiationMode("LAZY").setMultipleInstances(!1)),s_.registerVersion("@firebase/auth-compat","0.5.7");var a_=i(3999),l_=i.n(a_);i(2511),i(9544),i(9550),i(6822),i(7930),function(){(function(){var t,e,n="function"==typeof Object.create?Object.create:function(t){function e(){}return e.prototype=t,new e};if("function"==typeof Object.setPrototypeOf)e=Object.setPrototypeOf;else{var r;t:{var o={};try{o.__proto__={xb:!0},r=o.xb;break t}catch(t){}r=!1}e=r?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var s=e;function a(t,e){if(t.prototype=n(e.prototype),t.prototype.constructor=t,s)s(t,e);else for(var i in e)if("prototype"!=i)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(e,i);r&&Object.defineProperty(t,i,r)}else t[i]=e[i];t.K=e.prototype}var l="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,i){t!=Array.prototype&&t!=Object.prototype&&(t[e]=i.value)},c="undefined"!=typeof window&&window===this?this:void 0!==i.g&&null!=i.g?i.g:this;function u(t,e){if(e){var i=c;t=t.split(".");for(var n=0;n<t.length-1;n++){var r=t[n];r in i||(i[r]={}),i=i[r]}(e=e(n=i[t=t[t.length-1]]))!=n&&null!=e&&l(i,t,{configurable:!0,writable:!0,value:e})}}u("Object.is",(function(t){return t||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}})),u("Array.prototype.includes",(function(t){return t||function(t,e){var i=this;i instanceof String&&(i=String(i));var n=i.length;for(0>(e=e||0)&&(e=Math.max(e+n,0));e<n;e++){var r=i[e];if(r===t||Object.is(r,t))return!0}return!1}}));var h=this;function d(t){return void 0!==t}function p(t){return"string"==typeof t}var f=/^[\w+/_-]+[=]{0,2}$/,m=null;function g(){}function _(t){t.W=void 0,t.Xa=function(){return t.W?t.W:t.W=new t}}function y(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var i=Object.prototype.toString.call(t);if("[object Window]"==i)return"object";if("[object Array]"==i||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==i||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function v(t){return"array"==y(t)}function x(t){var e=y(t);return"array"==e||"object"==e&&"number"==typeof t.length}function b(t){return"function"==y(t)}function w(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var E="closure_uid_"+(1e9*Math.random()>>>0),S=0;function T(t,e,i){return t.call.apply(t.bind,arguments)}function M(t,e,i){if(!t)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,n),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function I(t,e,i){return(I=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?T:M).apply(null,arguments)}function C(t,e){var i=Array.prototype.slice.call(arguments,1);return function(){var e=i.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function A(t,e){for(var i in e)t[i]=e[i]}var P,L=Date.now||function(){return+new Date};function R(t,e){t=t.split(".");var i,n=h;t[0]in n||void 0===n.execScript||n.execScript("var "+t[0]);for(;t.length&&(i=t.shift());)!t.length&&d(e)?n[i]=e:n=n[i]&&n[i]!==Object.prototype[i]?n[i]:n[i]={}}function D(t,e){function i(){}i.prototype=e.prototype,t.K=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.vc=function(t,i,n){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return e.prototype[i].apply(t,r)}}function k(t){if(Error.captureStackTrace)Error.captureStackTrace(this,k);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function N(t,e){for(var i="",n=(t=t.split("%s")).length-1,r=0;r<n;r++)i+=t[r]+(r<e.length?e[r]:"%s");k.call(this,i+t[n])}function O(t,e){throw new N("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}D(k,Error),k.prototype.name="CustomError",D(N,k),N.prototype.name="AssertionError";var F=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(p(t))return p(e)&&1==e.length?t.indexOf(e,0):-1;for(var i=0;i<t.length;i++)if(i in t&&t[i]===e)return i;return-1},z=Array.prototype.forEach?function(t,e,i){Array.prototype.forEach.call(t,e,i)}:function(t,e,i){for(var n=t.length,r=p(t)?t.split(""):t,o=0;o<n;o++)o in r&&e.call(i,r[o],o,t)},B=Array.prototype.filter?function(t,e){return Array.prototype.filter.call(t,e,void 0)}:function(t,e){for(var i=t.length,n=[],r=0,o=p(t)?t.split(""):t,s=0;s<i;s++)if(s in o){var a=o[s];e.call(void 0,a,s,t)&&(n[r++]=a)}return n},U=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var i=t.length,n=Array(i),r=p(t)?t.split(""):t,o=0;o<i;o++)o in r&&(n[o]=e.call(void 0,r[o],o,t));return n},V=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var i=t.length,n=p(t)?t.split(""):t,r=0;r<i;r++)if(r in n&&e.call(void 0,n[r],r,t))return!0;return!1};function j(t,e){return 0<=F(t,e)}function G(t,e){var i;return(i=0<=(e=F(t,e)))&&H(t,e),i}function H(t,e){return 1==Array.prototype.splice.call(t,e,1).length}function W(t){return Array.prototype.concat.apply([],arguments)}function q(t){var e=t.length;if(0<e){for(var i=Array(e),n=0;n<e;n++)i[n]=t[n];return i}return[]}function X(t,e,i){return 2>=arguments.length?Array.prototype.slice.call(t,e):Array.prototype.slice.call(t,e,i)}var $=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},Y=/&/g,Z=/</g,K=/>/g,J=/"/g,Q=/'/g,tt=/\x00/g,et=/[\x00&<>"']/;function it(t,e){return t<e?-1:t>e?1:0}function nt(t){return et.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(Y,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(Z,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(K,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(J,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(Q,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(tt,"&#0;"))),t}function rt(t,e,i){for(var n in t)e.call(i,t[n],n,t)}function ot(t){var e,i={};for(e in t)i[e]=t[e];return i}var st="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function at(t,e){for(var i,n,r=1;r<arguments.length;r++){for(i in n=arguments[r])t[i]=n[i];for(var o=0;o<st.length;o++)i=st[o],Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}}var lt="StopIteration"in h?h.StopIteration:{message:"StopIteration",stack:""};function ct(){}function ut(t){if(t instanceof ct)return t;if("function"==typeof t.ha)return t.ha(!1);if(x(t)){var e=0,i=new ct;return i.next=function(){for(;;){if(e>=t.length)throw lt;if(e in t)return t[e++];e++}},i}throw Error("Not implemented")}function ht(t,e){this.g={},this.a=[],this.j=this.h=0;var i=arguments.length;if(1<i){if(i%2)throw Error("Uneven number of arguments");for(var n=0;n<i;n+=2)this.set(arguments[n],arguments[n+1])}else if(t)if(t instanceof ht)for(i=t.ja(),n=0;n<i.length;n++)this.set(i[n],t.get(i[n]));else for(n in t)this.set(n,t[n])}function dt(t){if(t.h!=t.a.length){for(var e=0,i=0;e<t.a.length;){var n=t.a[e];pt(t.g,n)&&(t.a[i++]=n),e++}t.a.length=i}if(t.h!=t.a.length){var r={};for(i=e=0;e<t.a.length;)pt(r,n=t.a[e])||(t.a[i++]=n,r[n]=1),e++;t.a.length=i}}function pt(t,e){return Object.prototype.hasOwnProperty.call(t,e)}ct.prototype.next=function(){throw lt},ct.prototype.ha=function(){return this},(t=ht.prototype).la=function(){dt(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.g[this.a[e]]);return t},t.ja=function(){return dt(this),this.a.concat()},t.clear=function(){this.g={},this.j=this.h=this.a.length=0},t.get=function(t,e){return pt(this.g,t)?this.g[t]:e},t.set=function(t,e){pt(this.g,t)||(this.h++,this.a.push(t),this.j++),this.g[t]=e},t.forEach=function(t,e){for(var i=this.ja(),n=0;n<i.length;n++){var r=i[n],o=this.get(r);t.call(e,o,r,this)}},t.ha=function(t){dt(this);var e=0,i=this.j,n=this,r=new ct;return r.next=function(){if(i!=n.j)throw Error("The map has changed since the iterator was created");if(e>=n.a.length)throw lt;var r=n.a[e++];return t?r:n.g[r]},r};var ft=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function mt(t,e,i,n){for(var r=i.length;0<=(e=t.indexOf(i,e))&&e<n;){var o=t.charCodeAt(e-1);if(!(38!=o&&63!=o||(o=t.charCodeAt(e+r))&&61!=o&&38!=o&&35!=o))return e;e+=r+1}return-1}var gt=/#|$/;function _t(t,e){var i=t.search(gt),n=mt(t,0,e,i);if(0>n)return null;var r=t.indexOf("&",n);return(0>r||r>i)&&(r=i),n+=e.length+1,decodeURIComponent(t.substr(n,r-n).replace(/\+/g," "))}var yt=/[?&]($|#)/;function vt(t,e){var i;this.h=this.A=this.j="",this.C=null,this.s=this.g="",this.i=!1,t instanceof vt?(this.i=d(e)?e:t.i,xt(this,t.j),this.A=t.A,this.h=t.h,bt(this,t.C),this.g=t.g,wt(this,Ot(t.a)),this.s=t.s):t&&(i=String(t).match(ft))?(this.i=!!e,xt(this,i[1]||"",!0),this.A=St(i[2]||""),this.h=St(i[3]||"",!0),bt(this,i[4]),this.g=St(i[5]||"",!0),wt(this,i[6]||"",!0),this.s=St(i[7]||"")):(this.i=!!e,this.a=new Rt(null,this.i))}function xt(t,e,i){t.j=i?St(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function bt(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.C=e}else t.C=null}function wt(t,e,i){e instanceof Rt?(t.a=e,function(t,e){e&&!t.j&&(Dt(t),t.h=null,t.a.forEach((function(t,e){var i=e.toLowerCase();e!=i&&(kt(this,e),kt(this,i),0<t.length&&(this.h=null,this.a.set(Ft(this,i),q(t)),this.g+=t.length))}),t)),t.j=e}(t.a,t.i)):(i||(e=Tt(e,Pt)),t.a=new Rt(e,t.i))}function Et(t){return t instanceof vt?new vt(t):new vt(t,void 0)}function St(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Tt(t,e,i){return p(t)?(t=encodeURI(t).replace(e,Mt),i&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Mt(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}vt.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Tt(e,It,!0),":");var i=this.h;return(i||"file"==e)&&(t.push("//"),(e=this.A)&&t.push(Tt(e,It,!0),"@"),t.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.C)&&t.push(":",String(i))),(i=this.g)&&(this.h&&"/"!=i.charAt(0)&&t.push("/"),t.push(Tt(i,"/"==i.charAt(0)?At:Ct,!0))),(i=this.a.toString())&&t.push("?",i),(i=this.s)&&t.push("#",Tt(i,Lt)),t.join("")};var It=/[#\/\?@]/g,Ct=/[#\?:]/g,At=/[#\?]/g,Pt=/[#\?@]/g,Lt=/#/g;function Rt(t,e){this.g=this.a=null,this.h=t||null,this.j=!!e}function Dt(t){t.a||(t.a=new ht,t.g=0,t.h&&function(t,e){if(t){t=t.split("&");for(var i=0;i<t.length;i++){var n=t[i].indexOf("="),r=null;if(0<=n){var o=t[i].substring(0,n);r=t[i].substring(n+1)}else o=t[i];e(o,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.h,(function(e,i){t.add(decodeURIComponent(e.replace(/\+/g," ")),i)})))}function kt(t,e){Dt(t),e=Ft(t,e),pt(t.a.g,e)&&(t.h=null,t.g-=t.a.get(e).length,pt((t=t.a).g,e)&&(delete t.g[e],t.h--,t.j++,t.a.length>2*t.h&&dt(t)))}function Nt(t,e){return Dt(t),e=Ft(t,e),pt(t.a.g,e)}function Ot(t){var e=new Rt;return e.h=t.h,t.a&&(e.a=new ht(t.a),e.g=t.g),e}function Ft(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function zt(t){this.a=Et(t)}function Bt(t){return t.a.a.get(jt.Pa)||null}function Ut(t,e){e?t.a.a.set(jt.PROVIDER_ID,e):kt(t.a.a,jt.PROVIDER_ID)}(t=Rt.prototype).add=function(t,e){Dt(this),this.h=null,t=Ft(this,t);var i=this.a.get(t);return i||this.a.set(t,i=[]),i.push(e),this.g+=1,this},t.clear=function(){this.a=this.h=null,this.g=0},t.forEach=function(t,e){Dt(this),this.a.forEach((function(i,n){z(i,(function(i){t.call(e,i,n,this)}),this)}),this)},t.ja=function(){Dt(this);for(var t=this.a.la(),e=this.a.ja(),i=[],n=0;n<e.length;n++)for(var r=t[n],o=0;o<r.length;o++)i.push(e[n]);return i},t.la=function(t){Dt(this);var e=[];if(p(t))Nt(this,t)&&(e=W(e,this.a.get(Ft(this,t))));else{t=this.a.la();for(var i=0;i<t.length;i++)e=W(e,t[i])}return e},t.set=function(t,e){return Dt(this),this.h=null,Nt(this,t=Ft(this,t))&&(this.g-=this.a.get(t).length),this.a.set(t,[e]),this.g+=1,this},t.get=function(t,e){return t&&0<(t=this.la(t)).length?String(t[0]):e},t.toString=function(){if(this.h)return this.h;if(!this.a)return"";for(var t=[],e=this.a.ja(),i=0;i<e.length;i++){var n=e[i],r=encodeURIComponent(String(n));n=this.la(n);for(var o=0;o<n.length;o++){var s=r;""!==n[o]&&(s+="="+encodeURIComponent(String(n[o]))),t.push(s)}}return this.h=t.join("&")},zt.prototype.toString=function(){return this.a.toString()};var Vt,jt={Pa:"ui_auid",lc:"apiKey",Qa:"ui_sd",ub:"mode",$a:"oobCode",PROVIDER_ID:"ui_pid",Sa:"ui_sid",vb:"tenantId"};t:{var Gt=h.navigator;if(Gt){var Ht=Gt.userAgent;if(Ht){Vt=Ht;break t}}Vt=""}function Wt(t){return-1!=Vt.indexOf(t)}function qt(){return(Wt("Chrome")||Wt("CriOS"))&&!Wt("Edge")}function Xt(t){return Xt[" "](t),t}Xt[" "]=g;var $t,Yt=Wt("Opera"),Zt=Wt("Trident")||Wt("MSIE"),Kt=Wt("Edge"),Jt=Kt||Zt,Qt=Wt("Gecko")&&!(-1!=Vt.toLowerCase().indexOf("webkit")&&!Wt("Edge"))&&!(Wt("Trident")||Wt("MSIE"))&&!Wt("Edge"),te=-1!=Vt.toLowerCase().indexOf("webkit")&&!Wt("Edge"),ee=te&&Wt("Mobile"),ie=Wt("Macintosh");function ne(){var t=h.document;return t?t.documentMode:void 0}t:{var re="",oe=function(){var t=Vt;return Qt?/rv:([^\);]+)(\)|;)/.exec(t):Kt?/Edge\/([\d\.]+)/.exec(t):Zt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t):te?/WebKit\/(\S+)/.exec(t):Yt?/(?:Version)[ \/]?(\S+)/.exec(t):void 0}();if(oe&&(re=oe?oe[1]:""),Zt){var se=ne();if(null!=se&&se>parseFloat(re)){$t=String(se);break t}}$t=re}var ae,le={};function ce(t){return function(t,e){var i=le;return Object.prototype.hasOwnProperty.call(i,t)?i[t]:i[t]=e()}(t,(function(){for(var e=0,i=$(String($t)).split("."),n=$(String(t)).split("."),r=Math.max(i.length,n.length),o=0;0==e&&o<r;o++){var s=i[o]||"",a=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=it(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||it(0==s[2].length,0==a[2].length)||it(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e}))}var ue=h.document;function he(t,e){this.a=t===pe&&e||"",this.g=de}ae=ue&&Zt?ne()||("CSS1Compat"==ue.compatMode?parseInt($t,10):5):void 0,he.prototype.ma=!0,he.prototype.ka=function(){return this.a},he.prototype.toString=function(){return"Const{"+this.a+"}"};var de={},pe={};function fe(){this.a="",this.h=ge}function me(t){return t instanceof fe&&t.constructor===fe&&t.h===ge?t.a:(O("expected object of type TrustedResourceUrl, got '"+t+"' of type "+y(t)),"type_error:TrustedResourceUrl")}fe.prototype.ma=!0,fe.prototype.ka=function(){return this.a.toString()},fe.prototype.g=function(){return 1},fe.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var ge={};function _e(){this.a="",this.h=we}function ye(t){return t instanceof _e&&t.constructor===_e&&t.h===we?t.a:(O("expected object of type SafeUrl, got '"+t+"' of type "+y(t)),"type_error:SafeUrl")}_e.prototype.ma=!0,_e.prototype.ka=function(){return this.a.toString()},_e.prototype.g=function(){return 1},_e.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var ve=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function xe(t){return t instanceof _e?t:(t="object"==typeof t&&t.ma?t.ka():String(t),ve.test(t)||(t="about:invalid#zClosurez"),Ee(t))}function be(t){return t instanceof _e?t:(t="object"==typeof t&&t.ma?t.ka():String(t),ve.test(t)||(t="about:invalid#zClosurez"),Ee(t))}var we={};function Ee(t){var e=new _e;return e.a=t,e}function Se(){this.a="",this.g=Te}Ee("about:blank"),Se.prototype.ma=!0;var Te={};function Me(){this.a="",this.j=Ce,this.h=null}function Ie(t){return t instanceof Me&&t.constructor===Me&&t.j===Ce?t.a:(O("expected object of type SafeHtml, got '"+t+"' of type "+y(t)),"type_error:SafeHtml")}Se.prototype.ka=function(){return this.a},Se.prototype.toString=function(){return"SafeStyle{"+this.a+"}"},Me.prototype.g=function(){return this.h},Me.prototype.ma=!0,Me.prototype.ka=function(){return this.a.toString()},Me.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Ce={};function Ae(t,e){var i=new Me;return i.a=t,i.h=e,i}Ae("<!DOCTYPE html>",0);var Pe=Ae("",0);Ae("<br>",0);var Le=function(t){var e,i=!1;return function(){return i||(e=function(){if("undefined"==typeof document)return!1;var t=document.createElement("div"),e=document.createElement("div");return e.appendChild(document.createElement("div")),t.appendChild(e),!!t.firstChild&&(e=t.firstChild.firstChild,t.innerHTML=Ie(Pe),!e.parentElement)}(),i=!0),e}}();function Re(t,e){e=e instanceof _e?e:be(e),t.assign(ye(e))}function De(t,e){this.a=d(t)?t:0,this.g=d(e)?e:0}function ke(t,e){this.width=t,this.height=e}function Ne(t){return t?new We(je(t)):P||(P=new We)}function Oe(t,e){var i=e||document;return i.querySelectorAll&&i.querySelector?i.querySelectorAll("."+t):ze(document,t,e)}function Fe(t,e){var i=e||document;if(i.getElementsByClassName)t=i.getElementsByClassName(t)[0];else{i=document;var n=e||i;t=n.querySelectorAll&&n.querySelector&&t?n.querySelector(t?"."+t:""):ze(i,t,e)[0]||null}return t||null}function ze(t,e,i){var n;if((t=i||t).querySelectorAll&&t.querySelector&&e)return t.querySelectorAll(e?"."+e:"");if(e&&t.getElementsByClassName){var r=t.getElementsByClassName(e);return r}if(r=t.getElementsByTagName("*"),e){var o={};for(i=n=0;t=r[i];i++){var s=t.className;"function"==typeof s.split&&j(s.split(/\s+/),e)&&(o[n++]=t)}return o.length=n,o}return r}De.prototype.toString=function(){return"("+this.a+", "+this.g+")"},De.prototype.ceil=function(){return this.a=Math.ceil(this.a),this.g=Math.ceil(this.g),this},De.prototype.floor=function(){return this.a=Math.floor(this.a),this.g=Math.floor(this.g),this},De.prototype.round=function(){return this.a=Math.round(this.a),this.g=Math.round(this.g),this},(t=ke.prototype).toString=function(){return"("+this.width+" x "+this.height+")"},t.aspectRatio=function(){return this.width/this.height},t.ceil=function(){return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},t.floor=function(){return this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},t.round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this};var Be={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Ue(t){return t.scrollingElement?t.scrollingElement:(te||"CSS1Compat"!=t.compatMode)&&t.body||t.documentElement}function Ve(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function je(t){return 9==t.nodeType?t:t.ownerDocument||t.document}function Ge(t,e){if("textContent"in t)t.textContent=e;else if(3==t.nodeType)t.data=String(e);else if(t.firstChild&&3==t.firstChild.nodeType){for(;t.lastChild!=t.firstChild;)t.removeChild(t.lastChild);t.firstChild.data=String(e)}else{for(var i;i=t.firstChild;)t.removeChild(i);t.appendChild(je(t).createTextNode(String(e)))}}function He(t,e){return e?function(t,e){for(;t;){if(e(t))return t;t=t.parentNode}return null}(t,(function(t){return!e||p(t.className)&&j(t.className.split(/\s+/),e)})):null}function We(t){this.a=t||h.document||document}We.prototype.N=function(){return p(void 0)?this.a.getElementById(void 0):void 0};var qe={Fc:!0},Xe={Hc:!0},$e={Ec:!0},Ye={Gc:!0};function Ze(){throw Error("Do not instantiate directly")}function Ke(t,e,i,n){if(t=t(e||Qe,void 0,i),n=(n||Ne()).a.createElement("DIV"),(t=function(t){if(!w(t))return nt(String(t));if(t instanceof Ze){if(t.fa===qe)return t.content;if(t.fa===Ye)return nt(t.content)}return O("Soy template output is unsafe for use as HTML: "+t),"zSoyz"}(t)).match(Je),t=Ae(t,null),Le())for(;n.lastChild;)n.removeChild(n.lastChild);return n.innerHTML=Ie(t),1==n.childNodes.length&&1==(t=n.firstChild).nodeType&&(n=t),n}Ze.prototype.va=null,Ze.prototype.toString=function(){return this.content};var Je=/^<(body|caption|col|colgroup|head|html|tr|td|th|tbody|thead|tfoot)>/i,Qe={};function ti(){Ze.call(this)}function ei(t){return null!=t&&t.fa===qe?t:t instanceof Me?oi(Ie(t).toString(),t.g()):oi(nt(String(String(t))),function(t){if(null!=t)switch(t.va){case 1:return 1;case-1:return-1;case 0:return 0}return null}(t))}function ii(){Ze.call(this)}function ni(t,e){this.content=String(t),this.va=null!=e?e:null}function ri(t){return new ni(t,void 0)}D(ti,Ze),ti.prototype.fa=qe,D(ii,Ze),ii.prototype.fa=Xe,ii.prototype.va=1,D(ni,Ze),ni.prototype.fa=Ye;var oi=function(t){function e(t){this.content=t}return e.prototype=t.prototype,function(t,i){return t=new e(String(t)),void 0!==i&&(t.va=i),t}}(ti),si=function(t){function e(t){this.content=t}return e.prototype=t.prototype,function(t){return new e(String(t))}}(ii);function ai(t){return(t=String(t))?new ni(t,void 0):""}var li=function(t){function e(t){this.content=t}return e.prototype=t.prototype,function(t,i){return(t=String(t))?(t=new e(t),void 0!==i&&(t.va=i),t):""}}(ti);function ci(t){return null!=t&&t.fa===qe?String(String(t.content).replace(xi,"").replace(bi,"&lt;")).replace(gi,pi):nt(String(t))}function ui(t){return null!=t&&t.fa===Xe?t=String(t).replace(_i,mi):t instanceof _e?t=String(ye(t).toString()).replace(_i,mi):(t=String(t),vi.test(t)?t=t.replace(_i,mi):(O("Bad value `%s` for |filterNormalizeUri",[t]),t="#zSoyz")),t}function hi(t){return null!=t&&t.fa===$e?t=t.content:null==t?t="":t instanceof Se?t instanceof Se&&t.constructor===Se&&t.g===Te?t=t.a:(O("expected object of type SafeStyle, got '"+t+"' of type "+y(t)),t="type_error:SafeStyle"):(t=String(t),yi.test(t)||(O("Bad value `%s` for |filterCssValue",[t]),t="zSoyz")),t}var di={"\0":"&#0;","\t":"&#9;","\n":"&#10;","\v":"&#11;","\f":"&#12;","\r":"&#13;"," ":"&#32;",'"':"&quot;","&":"&amp;","'":"&#39;","-":"&#45;","/":"&#47;","<":"&lt;","=":"&#61;",">":"&gt;","`":"&#96;","":"&#133;","":"&#160;","\u2028":"&#8232;","\u2029":"&#8233;"};function pi(t){return di[t]}var fi={"\0":"%00","":"%01","":"%02","":"%03","":"%04","":"%05","":"%06","":"%07","\b":"%08","\t":"%09","\n":"%0A","\v":"%0B","\f":"%0C","\r":"%0D","":"%0E","":"%0F","":"%10","":"%11","":"%12","":"%13","":"%14","":"%15","":"%16","":"%17","":"%18","":"%19","":"%1A","":"%1B","":"%1C","":"%1D","":"%1E","":"%1F"," ":"%20",'"':"%22","'":"%27","(":"%28",")":"%29","<":"%3C",">":"%3E","\\":"%5C","{":"%7B","}":"%7D","":"%7F","":"%C2%85","":"%C2%A0","\u2028":"%E2%80%A8","\u2029":"%E2%80%A9","":"%EF%BC%81","":"%EF%BC%83","":"%EF%BC%84","":"%EF%BC%86","":"%EF%BC%87","":"%EF%BC%88","":"%EF%BC%89","":"%EF%BC%8A","":"%EF%BC%8B","":"%EF%BC%8C","":"%EF%BC%8F","":"%EF%BC%9A","":"%EF%BC%9B","":"%EF%BC%9D","":"%EF%BC%9F","":"%EF%BC%A0","":"%EF%BC%BB","":"%EF%BC%BD"};function mi(t){return fi[t]}var gi=/[\x00\x22\x27\x3c\x3e]/g,_i=/[\x00- \x22\x27-\x29\x3c\x3e\\\x7b\x7d\x7f\x85\xa0\u2028\u2029\uff01\uff03\uff04\uff06-\uff0c\uff0f\uff1a\uff1b\uff1d\uff1f\uff20\uff3b\uff3d]/g,yi=/^(?!-*(?:expression|(?:moz-)?binding))(?:[.#]?-?(?:[_a-z0-9-]+)(?:-[_a-z0-9-]+)*-?|-?(?:[0-9]+(?:\.[0-9]*)?|\.[0-9]+)(?:[a-z]{1,2}|%)?|!important|)$/i,vi=/^(?![^#?]*\/(?:\.|%2E){2}(?:[\/?#]|$))(?:(?:https?|mailto):|[^&:\/?#]*(?:[\/?#]|$))/i,xi=/<(?:!|\/?([a-zA-Z][a-zA-Z0-9:\-]*))(?:[^>'"]|"[^"]*"|'[^']*')*>/g,bi=/</g;function wi(){return ri("Enter a valid phone number")}function Ei(){return ri("Unable to send password reset code to specified email")}function Si(){return ri("Something went wrong. Please try again.")}function Ti(){return ri("This email already exists without any means of sign-in. Please reset the password to recover.")}function Mi(t){var e="";switch((t=t||{}).code){case"invalid-argument":e+="Client specified an invalid argument.";break;case"invalid-configuration":e+="Client specified an invalid project configuration.";break;case"failed-precondition":e+="Request can not be executed in the current system state.";break;case"out-of-range":e+="Client specified an invalid range.";break;case"unauthenticated":e+="Request not authenticated due to missing, invalid, or expired OAuth token.";break;case"permission-denied":e+="Client does not have sufficient permission.";break;case"not-found":e+="Specified resource is not found.";break;case"aborted":e+="Concurrency conflict, such as read-modify-write conflict.";break;case"already-exists":e+="The resource that a client tried to create already exists.";break;case"resource-exhausted":e+="Either out of resource quota or reaching rate limiting.";break;case"cancelled":e+="Request cancelled by the client.";break;case"data-loss":e+="Unrecoverable data loss or data corruption.";break;case"unknown":e+="Unknown server error.";break;case"internal":e+="Internal server error.";break;case"not-implemented":e+="API method not implemented by the server.";break;case"unavailable":e+="Service unavailable.";break;case"deadline-exceeded":e+="Request deadline exceeded.";break;case"auth/user-disabled":e+="The user account has been disabled by an administrator.";break;case"auth/timeout":e+="The operation has timed out.";break;case"auth/too-many-requests":e+="We have blocked all requests from this device due to unusual activity. Try again later.";break;case"auth/quota-exceeded":e+="The quota for this operation has been exceeded. Try again later.";break;case"auth/network-request-failed":e+="A network error has occurred. Try again later.";break;case"restart-process":e+="An issue was encountered when authenticating your request. Please visit the URL that redirected you to this page again to restart the authentication process.";break;case"no-matching-tenant-for-email":e+="No sign-in provider is available for the given email, please try with a different email."}return ri(e)}function Ii(t,e,i){var n=Error.call(this);this.message=n.message,"stack"in n&&(this.stack=n.stack),this.code=Ci+t,(t=e)||(t="","firebaseui/merge-conflict"===this.code?t+="The current anonymous user failed to upgrade. The non-anonymous credential is already associated with a different user account.":t+=Si(),t=ri(t).toString()),this.message=t||"",this.credential=i||null}a(Ii,Error),Ii.prototype.toJSON=function(){return{code:this.code,message:this.message}};var Ci="firebaseui/";function Ai(){0!=Pi&&(Li[this[E]||(this[E]=++S)]=this),this.T=this.T,this.C=this.C}var Pi=0,Li={};function Ri(t,e){t.T?d(void 0)?e.call(void 0):e():(t.C||(t.C=[]),t.C.push(d(void 0)?I(e,void 0):e))}function Di(t){t&&"function"==typeof t.m&&t.m()}Ai.prototype.T=!1,Ai.prototype.m=function(){if(!this.T&&(this.T=!0,this.o(),0!=Pi)){var t=this[E]||(this[E]=++S);if(0!=Pi&&this.C&&0<this.C.length)throw Error(this+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete Li[t]}},Ai.prototype.o=function(){if(this.C)for(;this.C.length;)this.C.shift()()};var ki=Object.freeze||function(t){return t},Ni=!Zt||9<=Number(ae),Oi=Zt&&!ce("9"),Fi=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{h.addEventListener("test",g,e),h.removeEventListener("test",g,e)}catch(t){}return t}();function zi(t,e){this.type=t,this.g=this.target=e,this.h=!1,this.qb=!0}function Bi(t,e){if(zi.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.j=this.keyCode=0,this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var i=this.type=t.type,n=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Qt){t:{try{Xt(e.nodeName);var r=!0;break t}catch(t){}r=!1}r||(e=null)}}else"mouseover"==i?e=t.fromElement:"mouseout"==i&&(e=t.toElement);this.relatedTarget=e,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.keyCode=t.keyCode||0,this.key=t.key||"",this.j=t.charCode||("keypress"==i?t.keyCode:0),this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=p(t.pointerType)?t.pointerType:Ui[t.pointerType]||"",this.a=t,t.defaultPrevented&&this.preventDefault()}}zi.prototype.stopPropagation=function(){this.h=!0},zi.prototype.preventDefault=function(){this.qb=!1},D(Bi,zi);var Ui=ki({2:"touch",3:"pen",4:"mouse"});Bi.prototype.stopPropagation=function(){Bi.K.stopPropagation.call(this),this.a.stopPropagation?this.a.stopPropagation():this.a.cancelBubble=!0},Bi.prototype.preventDefault=function(){Bi.K.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Oi)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var Vi="closure_listenable_"+(1e6*Math.random()|0),ji=0;function Gi(t,e,i,n,r){this.listener=t,this.proxy=null,this.src=e,this.type=i,this.capture=!!n,this.La=r,this.key=++ji,this.sa=this.Ia=!1}function Hi(t){t.sa=!0,t.listener=null,t.proxy=null,t.src=null,t.La=null}function Wi(t){this.src=t,this.a={},this.g=0}function qi(t,e){var i=e.type;i in t.a&&G(t.a[i],e)&&(Hi(e),0==t.a[i].length&&(delete t.a[i],t.g--))}function Xi(t,e,i,n){for(var r=0;r<t.length;++r){var o=t[r];if(!o.sa&&o.listener==e&&o.capture==!!i&&o.La==n)return r}return-1}Wi.prototype.add=function(t,e,i,n,r){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.g++);var s=Xi(t,e,n,r);return-1<s?(e=t[s],i||(e.Ia=!1)):((e=new Gi(e,this.src,o,!!n,r)).Ia=i,t.push(e)),e};var $i="closure_lm_"+(1e6*Math.random()|0),Yi={};function Zi(t,e,i,n,r){if(n&&n.once)return Ji(t,e,i,n,r);if(v(e)){for(var o=0;o<e.length;o++)Zi(t,e[o],i,n,r);return null}return i=ln(i),t&&t[Vi]?t.J.add(String(e),i,!1,w(n)?!!n.capture:!!n,r):Ki(t,e,i,!1,n,r)}function Ki(t,e,i,n,r,o){if(!e)throw Error("Invalid event type");var s=w(r)?!!r.capture:!!r,a=sn(t);if(a||(t[$i]=a=new Wi(t)),(i=a.add(e,i,n,s,o)).proxy)return i;if(n=function(){var t=on,e=Ni?function(i){return t.call(e.src,e.listener,i)}:function(i){if(!(i=t.call(e.src,e.listener,i)))return i};return e}(),i.proxy=n,n.src=t,n.listener=i,t.addEventListener)Fi||(r=s),void 0===r&&(r=!1),t.addEventListener(e.toString(),n,r);else if(t.attachEvent)t.attachEvent(en(e.toString()),n);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(n)}return i}function Ji(t,e,i,n,r){if(v(e)){for(var o=0;o<e.length;o++)Ji(t,e[o],i,n,r);return null}return i=ln(i),t&&t[Vi]?t.J.add(String(e),i,!0,w(n)?!!n.capture:!!n,r):Ki(t,e,i,!0,n,r)}function Qi(t,e,i,n,r){if(v(e))for(var o=0;o<e.length;o++)Qi(t,e[o],i,n,r);else n=w(n)?!!n.capture:!!n,i=ln(i),t&&t[Vi]?(t=t.J,(e=String(e).toString())in t.a&&-1<(i=Xi(o=t.a[e],i,n,r))&&(Hi(o[i]),H(o,i),0==o.length&&(delete t.a[e],t.g--))):t&&(t=sn(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Xi(e,i,n,r)),(i=-1<t?e[t]:null)&&tn(i))}function tn(t){if("number"!=typeof t&&t&&!t.sa){var e=t.src;if(e&&e[Vi])qi(e.J,t);else{var i=t.type,n=t.proxy;e.removeEventListener?e.removeEventListener(i,n,t.capture):e.detachEvent?e.detachEvent(en(i),n):e.addListener&&e.removeListener&&e.removeListener(n),(i=sn(e))?(qi(i,t),0==i.g&&(i.src=null,e[$i]=null)):Hi(t)}}}function en(t){return t in Yi?Yi[t]:Yi[t]="on"+t}function nn(t,e,i,n){var r=!0;if((t=sn(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==i&&!o.sa&&(o=rn(o,n),r=r&&!1!==o)}return r}function rn(t,e){var i=t.listener,n=t.La||t.src;return t.Ia&&tn(t),i.call(n,e)}function on(t,e){if(t.sa)return!0;if(!Ni){if(!e)t:{e=["window","event"];for(var i=h,n=0;n<e.length;n++)if(null==(i=i[e[n]])){e=null;break t}e=i}if(e=new Bi(n=e,this),i=!0,!(0>n.keyCode||null!=n.returnValue)){t:{var r=!1;if(0==n.keyCode)try{n.keyCode=-1;break t}catch(t){r=!0}(r||null==n.returnValue)&&(n.returnValue=!0)}for(n=[],r=e.g;r;r=r.parentNode)n.push(r);for(t=t.type,r=n.length-1;!e.h&&0<=r;r--){e.g=n[r];var o=nn(n[r],t,!0,e);i=i&&o}for(r=0;!e.h&&r<n.length;r++)e.g=n[r],o=nn(n[r],t,!1,e),i=i&&o}return i}return rn(t,new Bi(e,this))}function sn(t){return(t=t[$i])instanceof Wi?t:null}var an="__closure_events_fn_"+(1e9*Math.random()>>>0);function ln(t){return b(t)?t:(t[an]||(t[an]=function(e){return t.handleEvent(e)}),t[an])}function cn(){Ai.call(this),this.J=new Wi(this),this.wb=this,this.Ha=null}function un(t,e){var i,n=t.Ha;if(n)for(i=[];n;n=n.Ha)i.push(n);if(t=t.wb,n=e.type||e,p(e))e=new zi(e,t);else if(e instanceof zi)e.target=e.target||t;else{var r=e;at(e=new zi(n,t),r)}if(r=!0,i)for(var o=i.length-1;!e.h&&0<=o;o--){var s=e.g=i[o];r=hn(s,n,!0,e)&&r}if(e.h||(r=hn(s=e.g=t,n,!0,e)&&r,e.h||(r=hn(s,n,!1,e)&&r)),i)for(o=0;!e.h&&o<i.length;o++)r=hn(s=e.g=i[o],n,!1,e)&&r;return r}function hn(t,e,i,n){if(!(e=t.J.a[String(e)]))return!0;e=e.concat();for(var r=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.sa&&s.capture==i){var a=s.listener,l=s.La||s.src;s.Ia&&qi(t.J,s),r=!1!==a.call(l,n)&&r}}return r&&0!=n.qb}D(cn,Ai),cn.prototype[Vi]=!0,cn.prototype.Za=function(t){this.Ha=t},cn.prototype.removeEventListener=function(t,e,i,n){Qi(this,t,e,i,n)},cn.prototype.o=function(){if(cn.K.o.call(this),this.J){var t,e=this.J;for(t in e.a){for(var i=e.a[t],n=0;n<i.length;n++)Hi(i[n]);delete e.a[t],e.g--}}this.Ha=null};var dn={},pn=0;function fn(t,e){if(!t)throw Error("Event target element must be provided!");if(t=mn(t),dn[t]&&dn[t].length)for(var i=0;i<dn[t].length;i++)un(dn[t][i],e)}function mn(t){return void 0===t.a&&(t.a=pn,pn++),t.a}function gn(t){if(!t)throw Error("Event target element must be provided!");cn.call(this),this.a=t}function _n(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function yn(t,e){this.h=t,this.j=e,this.g=0,this.a=null}function vn(t,e){t.j(e),100>t.g&&(t.g++,e.next=t.a,t.a=e)}function xn(){this.g=this.a=null}a(gn,cn),gn.prototype.N=function(){return this.a},gn.prototype.register=function(){var t=mn(this.N());dn[t]?j(dn[t],this)||dn[t].push(this):dn[t]=[this]},yn.prototype.get=function(){if(0<this.g){this.g--;var t=this.a;this.a=t.next,t.next=null}else t=this.h();return t};var bn,wn,En=new yn((function(){return new Tn}),(function(t){t.reset()}));function Sn(){var t=An,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.g=null),e.next=null),e}function Tn(){this.next=this.g=this.a=null}function Mn(t){h.setTimeout((function(){throw t}),0)}function In(t,e){wn||function(){if(h.Promise&&h.Promise.resolve){var t=h.Promise.resolve(void 0);wn=function(){t.then(Pn)}}else wn=function(){var t=Pn;!b(h.setImmediate)||h.Window&&h.Window.prototype&&!Wt("Edge")&&h.Window.prototype.setImmediate==h.setImmediate?(bn||(bn=function(){var t=h.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Wt("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",t.src="",document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(""),t.close();var i="callImmediate"+Math.random(),n="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=I((function(t){"*"!=n&&t.origin!=n||t.data!=i||this.port1.onmessage()}),this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(i,n)}}}),void 0!==t&&!Wt("Trident")&&!Wt("MSIE")){var e=new t,i={},n=i;return e.port1.onmessage=function(){if(d(i.next)){var t=(i=i.next).gb;i.gb=null,t()}},function(t){n.next={gb:t},n=n.next,e.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){h.setTimeout(t,0)}}()),bn(t)):h.setImmediate(t)}}(),Cn||(wn(),Cn=!0),An.add(t,e)}xn.prototype.add=function(t,e){var i=En.get();i.set(t,e),this.g?this.g.next=i:this.a=i,this.g=i},Tn.prototype.set=function(t,e){this.a=t,this.g=e,this.next=null},Tn.prototype.reset=function(){this.next=this.g=this.a=null};var Cn=!1,An=new xn;function Pn(){for(var t;t=Sn();){try{t.a.call(t.g)}catch(t){Mn(t)}vn(En,t)}Cn=!1}function Ln(t){if(this.a=Rn,this.A=void 0,this.j=this.g=this.h=null,this.s=this.i=!1,t!=g)try{var e=this;t.call(void 0,(function(t){Gn(e,Dn,t)}),(function(t){if(!(t instanceof Yn))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}Gn(e,kn,t)}))}catch(t){Gn(this,kn,t)}}var Rn=0,Dn=2,kn=3;function Nn(){this.next=this.j=this.g=this.s=this.a=null,this.h=!1}Nn.prototype.reset=function(){this.j=this.g=this.s=this.a=null,this.h=!1};var On=new yn((function(){return new Nn}),(function(t){t.reset()}));function Fn(t,e,i){var n=On.get();return n.s=t,n.g=e,n.j=i,n}function zn(t){if(t instanceof Ln)return t;var e=new Ln(g);return Gn(e,Dn,t),e}function Bn(t){return new Ln((function(e,i){i(t)}))}function Un(t,e){if(t.a==Rn)if(t.h){var i=t.h;if(i.g){for(var n=0,r=null,o=null,s=i.g;s&&(s.h||(n++,s.a==t&&(r=s),!(r&&1<n)));s=s.next)r||(o=s);r&&(i.a==Rn&&1==n?Un(i,e):(o?((n=o).next==i.j&&(i.j=n),n.next=n.next.next):Wn(i),qn(i,r,kn,e)))}t.h=null}else Gn(t,kn,e)}function Vn(t,e){t.g||t.a!=Dn&&t.a!=kn||Hn(t),t.j?t.j.next=e:t.g=e,t.j=e}function jn(t,e,i,n){var r=Fn(null,null,null);return r.a=new Ln((function(t,o){r.s=e?function(i){try{var r=e.call(n,i);t(r)}catch(t){o(t)}}:t,r.g=i?function(e){try{var r=i.call(n,e);!d(r)&&e instanceof Yn?o(e):t(r)}catch(t){o(t)}}:o})),r.a.h=t,Vn(t,r),r.a}function Gn(t,e,i){if(t.a==Rn){t===i&&(e=kn,i=new TypeError("Promise cannot resolve to itself")),t.a=1;t:{var n=i,r=t.hc,o=t.ic;if(n instanceof Ln){Vn(n,Fn(r||g,o||null,t));var s=!0}else if(_n(n))n.then(r,o,t),s=!0;else{if(w(n))try{var a=n.then;if(b(a)){!function(t,e,i,n,r){function o(t){s||(s=!0,n.call(r,t))}var s=!1;try{e.call(t,(function(t){s||(s=!0,i.call(r,t))}),o)}catch(t){o(t)}}(n,a,r,o,t),s=!0;break t}}catch(e){o.call(t,e),s=!0;break t}s=!1}}s||(t.A=i,t.a=e,t.h=null,Hn(t),e!=kn||i instanceof Yn||function(t,e){t.s=!0,In((function(){t.s&&$n.call(null,e)}))}(t,i))}}function Hn(t){t.i||(t.i=!0,In(t.Hb,t))}function Wn(t){var e=null;return t.g&&(e=t.g,t.g=e.next,e.next=null),t.g||(t.j=null),e}function qn(t,e,i,n){if(i==kn&&e.g&&!e.h)for(;t&&t.s;t=t.h)t.s=!1;if(e.a)e.a.h=null,Xn(e,i,n);else try{e.h?e.s.call(e.j):Xn(e,i,n)}catch(t){$n.call(null,t)}vn(On,e)}function Xn(t,e,i){e==Dn?t.s.call(t.j,i):t.g&&t.g.call(t.j,i)}Ln.prototype.then=function(t,e,i){return jn(this,b(t)?t:null,b(e)?e:null,i)},Ln.prototype.$goog_Thenable=!0,(t=Ln.prototype).fc=function(t,e){return(t=Fn(t,t,e)).h=!0,Vn(this,t),this},t.Ca=function(t,e){return jn(this,null,t,e)},t.cancel=function(t){this.a==Rn&&In((function(){Un(this,new Yn(t))}),this)},t.hc=function(t){this.a=Rn,Gn(this,Dn,t)},t.ic=function(t){this.a=Rn,Gn(this,kn,t)},t.Hb=function(){for(var t;t=Wn(this);)qn(this,t,this.a,this.A);this.i=!1};var $n=Mn;function Yn(t){k.call(this,t)}function Zn(t,e,i){e||(e={}),i=i||window;var n=t instanceof _e?t:xe(void 0!==t.href?t.href:String(t));t=e.target||t.target;var r=[];for(o in e)switch(o){case"width":case"height":case"top":case"left":r.push(o+"="+e[o]);break;case"target":case"noopener":case"noreferrer":break;default:r.push(o+"="+(e[o]?1:0))}var o=r.join(",");return(Wt("iPhone")&&!Wt("iPod")&&!Wt("iPad")||Wt("iPad")||Wt("iPod"))&&i.navigator&&i.navigator.standalone&&t&&"_self"!=t?(o=i.document.createElement("A"),n=n instanceof _e?n:be(n),o.href=ye(n),o.setAttribute("target",t),e.noreferrer&&o.setAttribute("rel","noreferrer"),(e=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,i,1),o.dispatchEvent(e),i={}):e.noreferrer?(i=i.open("",t,o),e=ye(n).toString(),i&&(Jt&&-1!=e.indexOf(";")&&(e="'"+e.replace(/'/g,"%27")+"'"),i.opener=null,e=Ae('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+nt(e)+'">',null),i.document.write(Ie(e)),i.document.close())):(i=i.open(ye(n).toString(),t,o))&&e.noopener&&(i.opener=null),i}function Kn(){try{return!(!window.opener||!window.opener.location||window.opener.location.hostname!==window.location.hostname||window.opener.location.protocol!==window.location.protocol)}catch(t){}return!1}function Jn(t){Zn(t,{target:window.cordova&&window.cordova.InAppBrowser?"_system":"_blank"},void 0)}function Qn(t,e){if(null==(t=w(t)&&1==t.nodeType?t:document.querySelector(String(t))))throw Error(e||"Cannot find element.");return t}function tr(){return window.location.href}function er(t){var e=hr;this.s=[],this.T=e,this.O=t||null,this.j=this.a=!1,this.h=void 0,this.J=this.l=this.A=!1,this.i=0,this.g=null,this.C=0}function ir(t,e,i){t.a=!0,t.h=i,t.j=!e,sr(t)}function nr(t){if(t.a){if(!t.J)throw new ar(t);t.J=!1}}function rr(t,e,i){t.s.push([e,i,void 0]),t.a&&sr(t)}function or(t){return V(t.s,(function(t){return b(t[1])}))}function sr(t){if(t.i&&t.a&&or(t)){var e=t.i,i=ur[e];i&&(h.clearTimeout(i.a),delete ur[e]),t.i=0}t.g&&(t.g.C--,delete t.g),e=t.h;for(var n=i=!1;t.s.length&&!t.A;){var r=t.s.shift(),o=r[0],s=r[1];if(r=r[2],o=t.j?s:o)try{var a=o.call(r||t.O,e);d(a)&&(t.j=t.j&&(a==e||a instanceof Error),t.h=e=a),(_n(e)||"function"==typeof h.Promise&&e instanceof h.Promise)&&(n=!0,t.A=!0)}catch(n){e=n,t.j=!0,or(t)||(i=!0)}}t.h=e,n&&(a=I(t.L,t,!0),n=I(t.L,t,!1),e instanceof er?(rr(e,a,n),e.l=!0):e.then(a,n)),i&&(e=new cr(e),ur[e.a]=e,t.i=e.a)}function ar(){k.call(this)}function lr(){k.call(this)}function cr(t){this.a=h.setTimeout(I(this.h,this),0),this.g=t}D(Yn,k),Yn.prototype.name="cancel",er.prototype.cancel=function(t){if(this.a)this.h instanceof er&&this.h.cancel();else{if(this.g){var e=this.g;delete this.g,t?e.cancel(t):(e.C--,0>=e.C&&e.cancel())}this.T?this.T.call(this.O,this):this.J=!0,this.a||(t=new lr(this),nr(this),ir(this,!1,t))}},er.prototype.L=function(t,e){this.A=!1,ir(this,t,e)},er.prototype.callback=function(t){nr(this),ir(this,!0,t)},er.prototype.then=function(t,e,i){var n,r,o=new Ln((function(t,e){n=t,r=e}));return rr(this,n,(function(t){t instanceof lr?o.cancel():r(t)})),o.then(t,e,i)},er.prototype.$goog_Thenable=!0,D(ar,k),ar.prototype.message="Deferred has already fired",ar.prototype.name="AlreadyCalledError",D(lr,k),lr.prototype.message="Deferred was canceled",lr.prototype.name="CanceledError",cr.prototype.h=function(){throw delete ur[this.a],this.g};var ur={};function hr(){if(this&&this.rb){var t=this.rb;t&&"SCRIPT"==t.tagName&&dr(t,!0,this.sb)}}function dr(t,e,i){null!=i&&h.clearTimeout(i),t.onload=g,t.onerror=g,t.onreadystatechange=g,e&&window.setTimeout((function(){Ve(t)}),0)}var pr=0,fr=1;function mr(t,e){var i="Jsloader error (code #"+t+")";e&&(i+=": "+e),k.call(this,i),this.code=t}function gr(){return h.google&&h.google.accounts&&h.google.accounts.id||null}function _r(t){this.a=t||gr(),this.h=!1,this.g=null}function yr(t,e,i){return t.a&&e?(t.h=!0,new Ln((function(n){t.g=n,t.a.initialize({client_id:e,callback:n,auto_select:!i}),t.a.prompt()}))):zn(e?xr.Xa().load().then((function(){return t.a=gr(),yr(t,e,i)})).Ca((function(){return null})):null)}D(mr,k),_r.prototype.cancel=function(){this.a&&this.h&&(this.g&&this.g(null),this.a.cancel())},_(_r);var vr=new he(pe,"https://accounts.google.com/gsi/client");function xr(){this.a=null}function br(t,e){this.a=t,this.g=e||function(t){throw t}}function wr(t,e,i){this.reset(t,e,i,void 0,void 0)}function Er(t){this.s=t,this.a=this.h=this.j=this.g=null}function Sr(t,e){this.name=t,this.value=e}xr.prototype.load=function(){var t=this;if(this.a)return this.a;var e=function(){var t=vr;t instanceof he&&t.constructor===he&&t.g===de?t=t.a:(O("expected object of type Const, got '"+t+"'"),t="type_error:Const");var e=new fe;return e.a=t,e}();return gr()?zn():this.a=function(){var t=null;return new Ln((function(e){"complete"==h.document.readyState?e():(t=function(){e()},Ji(window,"load",t))})).Ca((function(e){throw Qi(window,"load",t),e}))}().then((function(){if(!gr())return new Ln((function(i,n){var r=setTimeout((function(){t.a=null,n(Error("Network error!"))}),1e4);h.onGoogleLibraryLoad=function(){clearTimeout(r),i()},zn(function(t){var e={},i=e.document||document,n=me(t).toString(),r=document.createElement("SCRIPT"),o={rb:r,sb:void 0},s=new er(o),a=null,l=null!=e.timeout?e.timeout:5e3;return 0<l&&(a=window.setTimeout((function(){dr(r,!0);var t=new mr(fr,"Timeout reached for loading script "+n);nr(s),ir(s,!1,t)}),l),o.sb=a),r.onload=r.onreadystatechange=function(){r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(dr(r,e.xc||!1,a),s.callback(null))},r.onerror=function(){dr(r,!0,a);var t=new mr(pr,"Error while loading script "+n);nr(s),ir(s,!1,t)},at(o=e.attributes||{},{type:"text/javascript",charset:"UTF-8"}),function(t,e){rt(e,(function(e,i){e&&"object"==typeof e&&e.ma&&(e=e.ka()),"style"==i?t.style.cssText=e:"class"==i?t.className=e:"for"==i?t.htmlFor=e:Be.hasOwnProperty(i)?t.setAttribute(Be[i],e):0==i.lastIndexOf("aria-",0)||0==i.lastIndexOf("data-",0)?t.setAttribute(i,e):t[i]=e}))}(r,o),function(t,e){t.src=me(e),null===m&&(m=(e=(e=h.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&f.test(e)?e:""),(e=m)&&t.setAttribute("nonce",e)}(r,t),function(t){var e=(t||document).getElementsByTagName("HEAD");return e&&0!=e.length?e[0]:t.documentElement}(i).appendChild(r),s}(e)).then((function(){gr()&&i()})).Ca((function(e){clearTimeout(r),t.a=null,n(e)}))}))}))},_(xr),br.prototype.confirm=function(t){return zn(this.a.confirm(t)).Ca(this.g)},wr.prototype.a=null,wr.prototype.reset=function(t,e,i,n,r){this.h=n||L(),this.j=t,this.s=e,this.g=i,delete this.a},Sr.prototype.toString=function(){return this.name};var Tr=new Sr("SEVERE",1e3),Mr=new Sr("WARNING",900),Ir=new Sr("CONFIG",700);function Cr(t){return t.j?t.j:t.g?Cr(t.g):(O("Root logger has no level set."),null)}Er.prototype.log=function(t,e,i){if(t.value>=Cr(this).value)for(b(e)&&(e=e()),t=new wr(t,String(e),this.s),i&&(t.a=i),i=this;i;){var n=i,r=t;if(n.a)for(var o=0;e=n.a[o];o++)e(r);i=i.g}};var Ar={},Pr=null;function Lr(){Pr||(Pr=new Er(""),Ar[""]=Pr,Pr.j=Ir)}function Rr(){this.a=L()}var Dr=null;function kr(t){this.j=t||"",Dr||(Dr=new Rr),this.s=Dr}function Nr(t){return 10>t?"0"+t:String(t)}function Or(t){kr.call(this,t)}function Fr(){this.s=I(this.h,this),this.a=new Or,this.a.g=!1,this.a.h=!1,this.g=this.a.a=!1,this.j={}}Rr.prototype.set=function(t){this.a=t},Rr.prototype.reset=function(){this.set(L())},Rr.prototype.get=function(){return this.a},kr.prototype.a=!0,kr.prototype.g=!0,kr.prototype.h=!1,D(Or,kr),Fr.prototype.h=function(t){if(!this.j[t.g]){var e=function(t,e){var i=[];if(i.push(t.j," "),t.g){var n=new Date(e.h);i.push("[",Nr(n.getFullYear()-2e3)+Nr(n.getMonth()+1)+Nr(n.getDate())+" "+Nr(n.getHours())+":"+Nr(n.getMinutes())+":"+Nr(n.getSeconds())+"."+Nr(Math.floor(n.getMilliseconds()/10)),"] ")}return i.push("[",function(t,e){e=(t=(t.h-e)/1e3).toFixed(3);var i=0;if(1>t)i=2;else for(;100>t;)i++,t*=10;for(;0<i--;)e=" "+e;return e}(e,t.s.get()),"s] "),i.push("[",e.g,"] "),i.push(e.s),t.h&&(e=e.a)&&i.push("\n",e instanceof Error?e.message:e.toString()),t.a&&i.push("\n"),i.join("")}(this.a,t);Br&&function(t,e,i,n){t[e]?t[e](i,n||""):t.log(i,n||"")}(Br,function(t){if(t){if(t.value>=Tr.value)return"error";if(t.value>=Mr.value)return"warn";if(t.value>=Ir.value)return"log"}return"debug"}(t.j),e,t.a)}};var zr,Br=h.console;function Ur(t,e){zr&&zr.log(Tr,t,e)}zr=function t(e){var i;if(Lr(),!(i=Ar[e])){i=new Er(e);var n=e.lastIndexOf("."),r=e.substr(n+1);(n=t(e.substr(0,n))).h||(n.h={}),n.h[r]=i,i.g=n,Ar[e]=i}return i}("firebaseui");var Vr=new Fr;if(1!=Vr.g){var jr;Lr(),jr=Pr;var Gr=Vr.s;jr.a||(jr.a=[]),jr.a.push(Gr),Vr.g=!0}function Hr(t){zr&&zr.log(Mr,t,void 0)}function Wr(){this.a=("undefined"==typeof document?null:document)||{cookie:""}}function qr(t){t=(t.a.cookie||"").split(";");for(var e,i,n=[],r=[],o=0;o<t.length;o++)-1==(e=(i=$(t[o])).indexOf("="))?(n.push(""),r.push(i)):(n.push(i.substring(0,e)),r.push(i.substring(e+1)));return{keys:n,values:r}}(t=Wr.prototype).set=function(t,e,i,n,r,o){if(/[;=\s]/.test(t))throw Error('Invalid cookie name "'+t+'"');if(/[;\r\n]/.test(e))throw Error('Invalid cookie value "'+e+'"');d(i)||(i=-1),r=r?";domain="+r:"",n=n?";path="+n:"",o=o?";secure":"",i=0>i?"":0==i?";expires="+new Date(1970,1,1).toUTCString():";expires="+new Date(L()+1e3*i).toUTCString(),this.a.cookie=t+"="+e+r+n+i+o},t.get=function(t,e){for(var i,n=t+"=",r=(this.a.cookie||"").split(";"),o=0;o<r.length;o++){if(0==(i=$(r[o])).lastIndexOf(n,0))return i.substr(n.length);if(i==t)return""}return e},t.ja=function(){return qr(this).keys},t.la=function(){return qr(this).values},t.clear=function(){for(var t=qr(this).keys,e=t.length-1;0<=e;e--){var i=t[e];this.get(i),this.set(i,"",0,void 0,void 0)}};var Xr=new Wr;function $r(){}function Yr(t,e,i,n){this.h=null!=t?t:-1,this.g=e||null,this.a=i||null,this.j=!!n}function Zr(t,e){this.g=t,this.a=e||null}function Kr(t){return{email:t.g,credential:t.a&&t.a.toJSON()}}function Jr(t){if(t&&t.email){var e=t.credential&&Sd.auth.AuthCredential.fromJSON(t.credential);return new Zr(t.email,e)}return null}function Qr(t){this.a=t||null}function to(t){for(var e=[],i=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);255<r&&(e[i++]=255&r,r>>=8),e[i++]=r}return e}function eo(t){return U(t,(function(t){return 1<(t=t.toString(16)).length?t:"0"+t})).join("")}function io(t){for(this.i=t,this.g=this.i.length/4,this.j=this.g+6,this.h=[[],[],[],[]],this.s=[[],[],[],[]],this.a=Array(no*(this.j+1)),t=0;t<this.g;t++)this.a[t]=[this.i[4*t],this.i[4*t+1],this.i[4*t+2],this.i[4*t+3]];var e=Array(4);for(t=this.g;t<no*(this.j+1);t++){if(e[0]=this.a[t-1][0],e[1]=this.a[t-1][1],e[2]=this.a[t-1][2],e[3]=this.a[t-1][3],0==t%this.g){var i=e,n=i[0];i[0]=i[1],i[1]=i[2],i[2]=i[3],i[3]=n,uo(e),e[0]^=fo[t/this.g][0],e[1]^=fo[t/this.g][1],e[2]^=fo[t/this.g][2],e[3]^=fo[t/this.g][3]}else 6<this.g&&4==t%this.g&&uo(e);this.a[t]=Array(4),this.a[t][0]=this.a[t-this.g][0]^e[0],this.a[t][1]=this.a[t-this.g][1]^e[1],this.a[t][2]=this.a[t-this.g][2]^e[2],this.a[t][3]=this.a[t-this.g][3]^e[3]}}a(Yr,$r),Yr.prototype.set=function(t,e){Xr.set(t,e,this.h,this.g,this.a,this.j)},Yr.prototype.get=function(t){return Xr.get(t)||null},Yr.prototype.ra=function(t){var e=this.g,i=this.a;Xr.get(t),Xr.set(t,"",0,e,i)},io.prototype.A=16;var no=io.prototype.A/4;function ro(t,e){for(var i,n=0;n<no;n++)for(var r=0;4>r;r++)i=e[i=4*r+n],t.h[n][r]=i}function oo(t){for(var e=[],i=0;i<no;i++)for(var n=0;4>n;n++)e[4*n+i]=t.h[i][n];return e}function so(t,e){for(var i=0;4>i;i++)for(var n=0;4>n;n++)t.h[i][n]^=t.a[4*e+n][i]}function ao(t,e){for(var i=0;4>i;i++)for(var n=0;4>n;n++)t.h[i][n]=e[t.h[i][n]]}function lo(t){for(var e=1;4>e;e++)for(var i=0;4>i;i++)t.s[e][i]=t.h[e][i];for(e=1;4>e;e++)for(i=0;4>i;i++)t.h[e][i]=t.s[e][(i+e)%no]}function co(t){for(var e=1;4>e;e++)for(var i=0;4>i;i++)t.s[e][(i+e)%no]=t.h[e][i];for(e=1;4>e;e++)for(i=0;4>i;i++)t.h[e][i]=t.s[e][i]}function uo(t){t[0]=ho[t[0]],t[1]=ho[t[1]],t[2]=ho[t[2]],t[3]=ho[t[3]]}var ho=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],po=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],fo=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]],mo=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,254,27,25,31,29,19,17,23,21,11,9,15,13,3,1,7,5,59,57,63,61,51,49,55,53,43,41,47,45,35,33,39,37,91,89,95,93,83,81,87,85,75,73,79,77,67,65,71,69,123,121,127,125,115,113,119,117,107,105,111,109,99,97,103,101,155,153,159,157,147,145,151,149,139,137,143,141,131,129,135,133,187,185,191,189,179,177,183,181,171,169,175,173,163,161,167,165,219,217,223,221,211,209,215,213,203,201,207,205,195,193,199,197,251,249,255,253,243,241,247,245,235,233,239,237,227,225,231,229],go=[0,3,6,5,12,15,10,9,24,27,30,29,20,23,18,17,48,51,54,53,60,63,58,57,40,43,46,45,36,39,34,33,96,99,102,101,108,111,106,105,120,123,126,125,116,119,114,113,80,83,86,85,92,95,90,89,72,75,78,77,68,71,66,65,192,195,198,197,204,207,202,201,216,219,222,221,212,215,210,209,240,243,246,245,252,255,250,249,232,235,238,237,228,231,226,225,160,163,166,165,172,175,170,169,184,187,190,189,180,183,178,177,144,147,150,149,156,159,154,153,136,139,142,141,132,135,130,129,155,152,157,158,151,148,145,146,131,128,133,134,143,140,137,138,171,168,173,174,167,164,161,162,179,176,181,182,191,188,185,186,251,248,253,254,247,244,241,242,227,224,229,230,239,236,233,234,203,200,205,206,199,196,193,194,211,208,213,214,223,220,217,218,91,88,93,94,87,84,81,82,67,64,69,70,79,76,73,74,107,104,109,110,103,100,97,98,115,112,117,118,127,124,121,122,59,56,61,62,55,52,49,50,35,32,37,38,47,44,41,42,11,8,13,14,7,4,1,2,19,16,21,22,31,28,25,26],_o=[0,9,18,27,36,45,54,63,72,65,90,83,108,101,126,119,144,153,130,139,180,189,166,175,216,209,202,195,252,245,238,231,59,50,41,32,31,22,13,4,115,122,97,104,87,94,69,76,171,162,185,176,143,134,157,148,227,234,241,248,199,206,213,220,118,127,100,109,82,91,64,73,62,55,44,37,26,19,8,1,230,239,244,253,194,203,208,217,174,167,188,181,138,131,152,145,77,68,95,86,105,96,123,114,5,12,23,30,33,40,51,58,221,212,207,198,249,240,235,226,149,156,135,142,177,184,163,170,236,229,254,247,200,193,218,211,164,173,182,191,128,137,146,155,124,117,110,103,88,81,74,67,52,61,38,47,16,25,2,11,215,222,197,204,243,250,225,232,159,150,141,132,187,178,169,160,71,78,85,92,99,106,113,120,15,6,29,20,43,34,57,48,154,147,136,129,190,183,172,165,210,219,192,201,246,255,228,237,10,3,24,17,46,39,60,53,66,75,80,89,102,111,116,125,161,168,179,186,133,140,151,158,233,224,251,242,205,196,223,214,49,56,35,42,21,28,7,14,121,112,107,98,93,84,79,70],yo=[0,11,22,29,44,39,58,49,88,83,78,69,116,127,98,105,176,187,166,173,156,151,138,129,232,227,254,245,196,207,210,217,123,112,109,102,87,92,65,74,35,40,53,62,15,4,25,18,203,192,221,214,231,236,241,250,147,152,133,142,191,180,169,162,246,253,224,235,218,209,204,199,174,165,184,179,130,137,148,159,70,77,80,91,106,97,124,119,30,21,8,3,50,57,36,47,141,134,155,144,161,170,183,188,213,222,195,200,249,242,239,228,61,54,43,32,17,26,7,12,101,110,115,120,73,66,95,84,247,252,225,234,219,208,205,198,175,164,185,178,131,136,149,158,71,76,81,90,107,96,125,118,31,20,9,2,51,56,37,46,140,135,154,145,160,171,182,189,212,223,194,201,248,243,238,229,60,55,42,33,16,27,6,13,100,111,114,121,72,67,94,85,1,10,23,28,45,38,59,48,89,82,79,68,117,126,99,104,177,186,167,172,157,150,139,128,233,226,255,244,197,206,211,216,122,113,108,103,86,93,64,75,34,41,52,63,14,5,24,19,202,193,220,215,230,237,240,251,146,153,132,143,190,181,168,163],vo=[0,13,26,23,52,57,46,35,104,101,114,127,92,81,70,75,208,221,202,199,228,233,254,243,184,181,162,175,140,129,150,155,187,182,161,172,143,130,149,152,211,222,201,196,231,234,253,240,107,102,113,124,95,82,69,72,3,14,25,20,55,58,45,32,109,96,119,122,89,84,67,78,5,8,31,18,49,60,43,38,189,176,167,170,137,132,147,158,213,216,207,194,225,236,251,246,214,219,204,193,226,239,248,245,190,179,164,169,138,135,144,157,6,11,28,17,50,63,40,37,110,99,116,121,90,87,64,77,218,215,192,205,238,227,244,249,178,191,168,165,134,139,156,145,10,7,16,29,62,51,36,41,98,111,120,117,86,91,76,65,97,108,123,118,85,88,79,66,9,4,19,30,61,48,39,42,177,188,171,166,133,136,159,146,217,212,195,206,237,224,247,250,183,186,173,160,131,142,153,148,223,210,197,200,235,230,241,252,103,106,125,112,83,94,73,68,15,2,21,24,59,54,33,44,12,1,22,27,56,53,34,47,100,105,126,115,80,93,74,71,220,209,198,203,232,229,242,255,180,185,174,163,128,141,154,151],xo=[0,14,28,18,56,54,36,42,112,126,108,98,72,70,84,90,224,238,252,242,216,214,196,202,144,158,140,130,168,166,180,186,219,213,199,201,227,237,255,241,171,165,183,185,147,157,143,129,59,53,39,41,3,13,31,17,75,69,87,89,115,125,111,97,173,163,177,191,149,155,137,135,221,211,193,207,229,235,249,247,77,67,81,95,117,123,105,103,61,51,33,47,5,11,25,23,118,120,106,100,78,64,82,92,6,8,26,20,62,48,34,44,150,152,138,132,174,160,178,188,230,232,250,244,222,208,194,204,65,79,93,83,121,119,101,107,49,63,45,35,9,7,21,27,161,175,189,179,153,151,133,139,209,223,205,195,233,231,245,251,154,148,134,136,162,172,190,176,234,228,246,248,210,220,206,192,122,116,102,104,66,76,94,80,10,4,22,24,50,60,46,32,236,226,240,254,212,218,200,198,156,146,128,142,164,170,184,182,12,2,16,30,52,58,40,38,124,114,96,110,68,74,88,86,55,57,43,37,15,1,19,29,71,73,91,85,127,113,99,109,215,217,203,197,239,225,243,253,167,169,187,181,159,145,131,141];function bo(t,e){t=new io(Eo(t));for(var i,n=(e=to(e)).splice(0,16),r="";n.length;){i=16-n.length;for(var o=0;o<i;o++)n.push(0);for(ro(i=t,n),so(i,0),n=1;n<i.j;++n){ao(i,ho),lo(i),o=i.h;for(var s=i.s[0],a=0;4>a;a++)s[0]=o[0][a],s[1]=o[1][a],s[2]=o[2][a],s[3]=o[3][a],o[0][a]=mo[s[0]]^go[s[1]]^s[2]^s[3],o[1][a]=s[0]^mo[s[1]]^go[s[2]]^s[3],o[2][a]=s[0]^s[1]^mo[s[2]]^go[s[3]],o[3][a]=go[s[0]]^s[1]^s[2]^mo[s[3]];so(i,n)}ao(i,ho),lo(i),so(i,i.j),r+=eo(oo(i)),n=e.splice(0,16)}return r}function wo(t,e){t=new io(Eo(t));for(var i=[],n=0;n<e.length;n+=2)i.push(parseInt(e.substring(n,n+2),16));var r=i.splice(0,16);for(e="";r.length;){for(ro(n=t,r),so(n,n.j),r=1;r<n.j;++r){co(n),ao(n,po),so(n,n.j-r);for(var o=n.h,s=n.s[0],a=0;4>a;a++)s[0]=o[0][a],s[1]=o[1][a],s[2]=o[2][a],s[3]=o[3][a],o[0][a]=xo[s[0]]^yo[s[1]]^vo[s[2]]^_o[s[3]],o[1][a]=_o[s[0]]^xo[s[1]]^yo[s[2]]^vo[s[3]],o[2][a]=vo[s[0]]^_o[s[1]]^xo[s[2]]^yo[s[3]],o[3][a]=yo[s[0]]^vo[s[1]]^_o[s[2]]^xo[s[3]]}if(co(n),ao(n,po),so(n,0),8192>=(n=oo(n)).length)n=String.fromCharCode.apply(null,n);else{for(r="",o=0;o<n.length;o+=8192)r+=String.fromCharCode.apply(null,X(n,o,o+8192));n=r}e+=n,r=i.splice(0,16)}return e.replace(/(\x00)+$/,"")}function Eo(t){for(var e=32-(t=to(t.substring(0,32))).length,i=0;i<e;i++)t.push(0);return t}function So(t){var e=[];return Mo(new To,t,e),e.join("")}function To(){}function Mo(t,e,i){if(null==e)i.push("null");else{if("object"==typeof e){if(v(e)){var n=e;e=n.length,i.push("[");for(var r="",o=0;o<e;o++)i.push(r),Mo(t,n[o],i),r=",";return void i.push("]")}if(!(e instanceof String||e instanceof Number||e instanceof Boolean)){for(n in i.push("{"),r="",e)Object.prototype.hasOwnProperty.call(e,n)&&"function"!=typeof(o=e[n])&&(i.push(r),Ao(n,i),i.push(":"),Mo(t,o,i),r=",");return void i.push("}")}e=e.valueOf()}switch(typeof e){case"string":Ao(e,i);break;case"number":i.push(isFinite(e)&&!isNaN(e)?String(e):"null");break;case"boolean":i.push(String(e));break;case"function":i.push("null");break;default:throw Error("Unknown type: "+typeof e)}}}var Io={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Co=/\uffff/.test("")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Ao(t,e){e.push('"',t.replace(Co,(function(t){var e=Io[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Io[t]=e),e})),'"')}function Po(t){this.a=t}function Lo(){}function Ro(t){this.a=t}function Do(t){if(!t.a)return!1;try{return t.a.setItem("__sak","1"),t.a.removeItem("__sak"),!0}catch(t){return!1}}function ko(){var t=null;try{t=window.localStorage||null}catch(t){}this.a=t}function No(){var t=null;try{t=window.sessionStorage||null}catch(t){}this.a=t}function Oo(t,e){this.g=t,this.a=e+"::"}Po.prototype.set=function(t,e){d(e)?this.a.set(t,So(e)):this.a.ra(t)},Po.prototype.get=function(t){try{var e=this.a.get(t)}catch(t){return}if(null!==e)try{return JSON.parse(e)}catch(t){throw"Storage: Invalid value was encountered"}},D(Lo,$r),Lo.prototype.clear=function(){var t=function(t){if(x(t))return q(t);t=ut(t);var e=[];return function(t,e){if(x(t))try{z(t,e,void 0)}catch(t){if(t!==lt)throw t}else{t=ut(t);try{for(;;)e.call(void 0,t.next(),void 0,t)}catch(t){if(t!==lt)throw t}}}(t,(function(t){e.push(t)})),e}(this.ha(!0)),e=this;z(t,(function(t){e.ra(t)}))},D(Ro,Lo),(t=Ro.prototype).set=function(t,e){try{this.a.setItem(t,e)}catch(t){if(0==this.a.length)throw"Storage mechanism: Storage disabled";throw"Storage mechanism: Quota exceeded"}},t.get=function(t){if(!p(t=this.a.getItem(t))&&null!==t)throw"Storage mechanism: Invalid value was encountered";return t},t.ra=function(t){this.a.removeItem(t)},t.ha=function(t){var e=0,i=this.a,n=new ct;return n.next=function(){if(e>=i.length)throw lt;var n=i.key(e++);if(t)return n;if(!p(n=i.getItem(n)))throw"Storage mechanism: Invalid value was encountered";return n},n},t.clear=function(){this.a.clear()},t.key=function(t){return this.a.key(t)},D(ko,Ro),D(No,Ro),D(Oo,Lo),Oo.prototype.set=function(t,e){this.g.set(this.a+t,e)},Oo.prototype.get=function(t){return this.g.get(this.a+t)},Oo.prototype.ra=function(t){this.g.ra(this.a+t)},Oo.prototype.ha=function(t){var e=this.g.ha(!0),i=this,n=new ct;return n.next=function(){for(var n=e.next();n.substr(0,i.a.length)!=i.a;)n=e.next();return t?n.substr(i.a.length):i.g.get(n)},n},Do(new ko);var Fo=new No,zo=new Po(Do(Fo)?new Oo(Fo,"firebaseui"):null),Bo={name:"pendingEmailCredential",storage:zo},Uo={name:"redirectStatus",storage:zo},Vo={name:"redirectUrl",storage:zo},jo={name:"emailForSignIn",storage:new Po(new Yr(3600,"/"))},Go={name:"pendingEncryptedCredential",storage:new Po(new Yr(3600,"/"))};function Ho(t,e){return t.storage.get(e?t.name+":"+e:t.name)}function Wo(t,e){t.storage.a.ra(e?t.name+":"+e:t.name)}function qo(t,e,i){t.storage.set(i?t.name+":"+i:t.name,e)}function Xo(t){return Ho(Vo,t)||null}function $o(t){return Jr(t=Ho(Bo,t)||null)}function Yo(t){Wo(Bo,t)}function Zo(t,e){qo(Bo,Kr(t),e)}function Ko(t){return(t=Ho(Uo,t)||null)&&void 0!==t.tenantId?new Qr(t.tenantId):null}function Jo(){this.W={}}function Qo(t,e,i){if(e.toLowerCase()in t.W)throw Error("Configuration "+e+" has already been defined.");t.W[e.toLowerCase()]=i}function ts(t,e,i){if(!(e.toLowerCase()in t.W))throw Error("Configuration "+e+" is not defined.");t.W[e.toLowerCase()]=i}function es(t,e){if(!(t=t.get(e)))throw Error("Configuration "+e+" is required.");return t}function is(){this.g=void 0,this.a={}}function ns(t,e,i,n){for(var r=0;r<e.length;r++){var o=e.charAt(r);t.a[o]||(t.a[o]=new is),t=t.a[o]}if(n&&void 0!==t.g)throw Error('The collection already contains the key "'+e+'"');t.g=i}function rs(t,e){for(var i in void 0!==t.g&&e.push(t.g),t.a)rs(t.a[i],e)}function os(t,e,i){for(var n in void 0!==t.g&&i.push(e),t.a)os(t.a[n],e+n,i)}function ss(t){for(this.a=t,this.g=new is,t=0;t<this.a.length;t++){var e=this.g.get("+"+this.a[t].b);e?e.push(this.a[t]):this.g.add("+"+this.a[t].b,[this.a[t]])}}function as(t,e){var i={},n=0;for(void 0!==(t=t.g).g&&(i[n]=t.g);n<e.length;n++){var r=e.charAt(n);if(!(r in t.a))break;void 0!==(t=t.a[r]).g&&(i[n]=t.g)}for(var o in i)if(i.hasOwnProperty(o))return i[o];return[]}function ls(t){for(var e=0;e<ds.length;e++)if(ds[e].c===t)return ds[e];return null}function cs(t){t=t.toUpperCase();for(var e=[],i=0;i<ds.length;i++)ds[i].f===t&&e.push(ds[i]);return e}function us(t){if(0<t.length&&"+"==t.charAt(0)){t=t.substring(1);for(var e=[],i=0;i<ds.length;i++)ds[i].b==t&&e.push(ds[i]);t=e}else t=cs(t);return t}function hs(t){t.sort((function(t,e){return t.name.localeCompare(e.name,"en")}))}Jo.prototype.get=function(t){if(!(t.toLowerCase()in this.W))throw Error("Configuration "+t+" is not defined.");return this.W[t.toLowerCase()]},(t=is.prototype).set=function(t,e){ns(this,t,e,!1)},t.add=function(t,e){ns(this,t,e,!0)},t.get=function(t){t:{for(var e=this,i=0;i<t.length;i++)if(!(e=e.a[t.charAt(i)])){t=void 0;break t}t=e}return t?t.g:void 0},t.la=function(){var t=[];return rs(this,t),t},t.ja=function(){var t=[];return os(this,"",t),t},t.clear=function(){this.a={},this.g=void 0};var ds=[{name:"Afghanistan",c:"93-AF-0",b:"93",f:"AF"},{name:"land Islands",c:"358-AX-0",b:"358",f:"AX"},{name:"Albania",c:"355-AL-0",b:"355",f:"AL"},{name:"Algeria",c:"213-DZ-0",b:"213",f:"DZ"},{name:"American Samoa",c:"1-AS-0",b:"1",f:"AS"},{name:"Andorra",c:"376-AD-0",b:"376",f:"AD"},{name:"Angola",c:"244-AO-0",b:"244",f:"AO"},{name:"Anguilla",c:"1-AI-0",b:"1",f:"AI"},{name:"Antigua and Barbuda",c:"1-AG-0",b:"1",f:"AG"},{name:"Argentina",c:"54-AR-0",b:"54",f:"AR"},{name:"Armenia",c:"374-AM-0",b:"374",f:"AM"},{name:"Aruba",c:"297-AW-0",b:"297",f:"AW"},{name:"Ascension Island",c:"247-AC-0",b:"247",f:"AC"},{name:"Australia",c:"61-AU-0",b:"61",f:"AU"},{name:"Austria",c:"43-AT-0",b:"43",f:"AT"},{name:"Azerbaijan",c:"994-AZ-0",b:"994",f:"AZ"},{name:"Bahamas",c:"1-BS-0",b:"1",f:"BS"},{name:"Bahrain",c:"973-BH-0",b:"973",f:"BH"},{name:"Bangladesh",c:"880-BD-0",b:"880",f:"BD"},{name:"Barbados",c:"1-BB-0",b:"1",f:"BB"},{name:"Belarus",c:"375-BY-0",b:"375",f:"BY"},{name:"Belgium",c:"32-BE-0",b:"32",f:"BE"},{name:"Belize",c:"501-BZ-0",b:"501",f:"BZ"},{name:"Benin",c:"229-BJ-0",b:"229",f:"BJ"},{name:"Bermuda",c:"1-BM-0",b:"1",f:"BM"},{name:"Bhutan",c:"975-BT-0",b:"975",f:"BT"},{name:"Bolivia",c:"591-BO-0",b:"591",f:"BO"},{name:"Bosnia and Herzegovina",c:"387-BA-0",b:"387",f:"BA"},{name:"Botswana",c:"267-BW-0",b:"267",f:"BW"},{name:"Brazil",c:"55-BR-0",b:"55",f:"BR"},{name:"British Indian Ocean Territory",c:"246-IO-0",b:"246",f:"IO"},{name:"British Virgin Islands",c:"1-VG-0",b:"1",f:"VG"},{name:"Brunei",c:"673-BN-0",b:"673",f:"BN"},{name:"Bulgaria",c:"359-BG-0",b:"359",f:"BG"},{name:"Burkina Faso",c:"226-BF-0",b:"226",f:"BF"},{name:"Burundi",c:"257-BI-0",b:"257",f:"BI"},{name:"Cambodia",c:"855-KH-0",b:"855",f:"KH"},{name:"Cameroon",c:"237-CM-0",b:"237",f:"CM"},{name:"Canada",c:"1-CA-0",b:"1",f:"CA"},{name:"Cape Verde",c:"238-CV-0",b:"238",f:"CV"},{name:"Caribbean Netherlands",c:"599-BQ-0",b:"599",f:"BQ"},{name:"Cayman Islands",c:"1-KY-0",b:"1",f:"KY"},{name:"Central African Republic",c:"236-CF-0",b:"236",f:"CF"},{name:"Chad",c:"235-TD-0",b:"235",f:"TD"},{name:"Chile",c:"56-CL-0",b:"56",f:"CL"},{name:"China",c:"86-CN-0",b:"86",f:"CN"},{name:"Christmas Island",c:"61-CX-0",b:"61",f:"CX"},{name:"Cocos [Keeling] Islands",c:"61-CC-0",b:"61",f:"CC"},{name:"Colombia",c:"57-CO-0",b:"57",f:"CO"},{name:"Comoros",c:"269-KM-0",b:"269",f:"KM"},{name:"Democratic Republic Congo",c:"243-CD-0",b:"243",f:"CD"},{name:"Republic of Congo",c:"242-CG-0",b:"242",f:"CG"},{name:"Cook Islands",c:"682-CK-0",b:"682",f:"CK"},{name:"Costa Rica",c:"506-CR-0",b:"506",f:"CR"},{name:"Cte d'Ivoire",c:"225-CI-0",b:"225",f:"CI"},{name:"Croatia",c:"385-HR-0",b:"385",f:"HR"},{name:"Cuba",c:"53-CU-0",b:"53",f:"CU"},{name:"Curaao",c:"599-CW-0",b:"599",f:"CW"},{name:"Cyprus",c:"357-CY-0",b:"357",f:"CY"},{name:"Czech Republic",c:"420-CZ-0",b:"420",f:"CZ"},{name:"Denmark",c:"45-DK-0",b:"45",f:"DK"},{name:"Djibouti",c:"253-DJ-0",b:"253",f:"DJ"},{name:"Dominica",c:"1-DM-0",b:"1",f:"DM"},{name:"Dominican Republic",c:"1-DO-0",b:"1",f:"DO"},{name:"East Timor",c:"670-TL-0",b:"670",f:"TL"},{name:"Ecuador",c:"593-EC-0",b:"593",f:"EC"},{name:"Egypt",c:"20-EG-0",b:"20",f:"EG"},{name:"El Salvador",c:"503-SV-0",b:"503",f:"SV"},{name:"Equatorial Guinea",c:"240-GQ-0",b:"240",f:"GQ"},{name:"Eritrea",c:"291-ER-0",b:"291",f:"ER"},{name:"Estonia",c:"372-EE-0",b:"372",f:"EE"},{name:"Ethiopia",c:"251-ET-0",b:"251",f:"ET"},{name:"Falkland Islands [Islas Malvinas]",c:"500-FK-0",b:"500",f:"FK"},{name:"Faroe Islands",c:"298-FO-0",b:"298",f:"FO"},{name:"Fiji",c:"679-FJ-0",b:"679",f:"FJ"},{name:"Finland",c:"358-FI-0",b:"358",f:"FI"},{name:"France",c:"33-FR-0",b:"33",f:"FR"},{name:"French Guiana",c:"594-GF-0",b:"594",f:"GF"},{name:"French Polynesia",c:"689-PF-0",b:"689",f:"PF"},{name:"Gabon",c:"241-GA-0",b:"241",f:"GA"},{name:"Gambia",c:"220-GM-0",b:"220",f:"GM"},{name:"Georgia",c:"995-GE-0",b:"995",f:"GE"},{name:"Germany",c:"49-DE-0",b:"49",f:"DE"},{name:"Ghana",c:"233-GH-0",b:"233",f:"GH"},{name:"Gibraltar",c:"350-GI-0",b:"350",f:"GI"},{name:"Greece",c:"30-GR-0",b:"30",f:"GR"},{name:"Greenland",c:"299-GL-0",b:"299",f:"GL"},{name:"Grenada",c:"1-GD-0",b:"1",f:"GD"},{name:"Guadeloupe",c:"590-GP-0",b:"590",f:"GP"},{name:"Guam",c:"1-GU-0",b:"1",f:"GU"},{name:"Guatemala",c:"502-GT-0",b:"502",f:"GT"},{name:"Guernsey",c:"44-GG-0",b:"44",f:"GG"},{name:"Guinea Conakry",c:"224-GN-0",b:"224",f:"GN"},{name:"Guinea-Bissau",c:"245-GW-0",b:"245",f:"GW"},{name:"Guyana",c:"592-GY-0",b:"592",f:"GY"},{name:"Haiti",c:"509-HT-0",b:"509",f:"HT"},{name:"Heard Island and McDonald Islands",c:"672-HM-0",b:"672",f:"HM"},{name:"Honduras",c:"504-HN-0",b:"504",f:"HN"},{name:"Hong Kong",c:"852-HK-0",b:"852",f:"HK"},{name:"Hungary",c:"36-HU-0",b:"36",f:"HU"},{name:"Iceland",c:"354-IS-0",b:"354",f:"IS"},{name:"India",c:"91-IN-0",b:"91",f:"IN"},{name:"Indonesia",c:"62-ID-0",b:"62",f:"ID"},{name:"Iran",c:"98-IR-0",b:"98",f:"IR"},{name:"Iraq",c:"964-IQ-0",b:"964",f:"IQ"},{name:"Ireland",c:"353-IE-0",b:"353",f:"IE"},{name:"Isle of Man",c:"44-IM-0",b:"44",f:"IM"},{name:"Israel",c:"972-IL-0",b:"972",f:"IL"},{name:"Italy",c:"39-IT-0",b:"39",f:"IT"},{name:"Jamaica",c:"1-JM-0",b:"1",f:"JM"},{name:"Japan",c:"81-JP-0",b:"81",f:"JP"},{name:"Jersey",c:"44-JE-0",b:"44",f:"JE"},{name:"Jordan",c:"962-JO-0",b:"962",f:"JO"},{name:"Kazakhstan",c:"7-KZ-0",b:"7",f:"KZ"},{name:"Kenya",c:"254-KE-0",b:"254",f:"KE"},{name:"Kiribati",c:"686-KI-0",b:"686",f:"KI"},{name:"Kosovo",c:"377-XK-0",b:"377",f:"XK"},{name:"Kosovo",c:"381-XK-0",b:"381",f:"XK"},{name:"Kosovo",c:"386-XK-0",b:"386",f:"XK"},{name:"Kuwait",c:"965-KW-0",b:"965",f:"KW"},{name:"Kyrgyzstan",c:"996-KG-0",b:"996",f:"KG"},{name:"Laos",c:"856-LA-0",b:"856",f:"LA"},{name:"Latvia",c:"371-LV-0",b:"371",f:"LV"},{name:"Lebanon",c:"961-LB-0",b:"961",f:"LB"},{name:"Lesotho",c:"266-LS-0",b:"266",f:"LS"},{name:"Liberia",c:"231-LR-0",b:"231",f:"LR"},{name:"Libya",c:"218-LY-0",b:"218",f:"LY"},{name:"Liechtenstein",c:"423-LI-0",b:"423",f:"LI"},{name:"Lithuania",c:"370-LT-0",b:"370",f:"LT"},{name:"Luxembourg",c:"352-LU-0",b:"352",f:"LU"},{name:"Macau",c:"853-MO-0",b:"853",f:"MO"},{name:"Macedonia",c:"389-MK-0",b:"389",f:"MK"},{name:"Madagascar",c:"261-MG-0",b:"261",f:"MG"},{name:"Malawi",c:"265-MW-0",b:"265",f:"MW"},{name:"Malaysia",c:"60-MY-0",b:"60",f:"MY"},{name:"Maldives",c:"960-MV-0",b:"960",f:"MV"},{name:"Mali",c:"223-ML-0",b:"223",f:"ML"},{name:"Malta",c:"356-MT-0",b:"356",f:"MT"},{name:"Marshall Islands",c:"692-MH-0",b:"692",f:"MH"},{name:"Martinique",c:"596-MQ-0",b:"596",f:"MQ"},{name:"Mauritania",c:"222-MR-0",b:"222",f:"MR"},{name:"Mauritius",c:"230-MU-0",b:"230",f:"MU"},{name:"Mayotte",c:"262-YT-0",b:"262",f:"YT"},{name:"Mexico",c:"52-MX-0",b:"52",f:"MX"},{name:"Micronesia",c:"691-FM-0",b:"691",f:"FM"},{name:"Moldova",c:"373-MD-0",b:"373",f:"MD"},{name:"Monaco",c:"377-MC-0",b:"377",f:"MC"},{name:"Mongolia",c:"976-MN-0",b:"976",f:"MN"},{name:"Montenegro",c:"382-ME-0",b:"382",f:"ME"},{name:"Montserrat",c:"1-MS-0",b:"1",f:"MS"},{name:"Morocco",c:"212-MA-0",b:"212",f:"MA"},{name:"Mozambique",c:"258-MZ-0",b:"258",f:"MZ"},{name:"Myanmar [Burma]",c:"95-MM-0",b:"95",f:"MM"},{name:"Namibia",c:"264-NA-0",b:"264",f:"NA"},{name:"Nauru",c:"674-NR-0",b:"674",f:"NR"},{name:"Nepal",c:"977-NP-0",b:"977",f:"NP"},{name:"Netherlands",c:"31-NL-0",b:"31",f:"NL"},{name:"New Caledonia",c:"687-NC-0",b:"687",f:"NC"},{name:"New Zealand",c:"64-NZ-0",b:"64",f:"NZ"},{name:"Nicaragua",c:"505-NI-0",b:"505",f:"NI"},{name:"Niger",c:"227-NE-0",b:"227",f:"NE"},{name:"Nigeria",c:"234-NG-0",b:"234",f:"NG"},{name:"Niue",c:"683-NU-0",b:"683",f:"NU"},{name:"Norfolk Island",c:"672-NF-0",b:"672",f:"NF"},{name:"North Korea",c:"850-KP-0",b:"850",f:"KP"},{name:"Northern Mariana Islands",c:"1-MP-0",b:"1",f:"MP"},{name:"Norway",c:"47-NO-0",b:"47",f:"NO"},{name:"Oman",c:"968-OM-0",b:"968",f:"OM"},{name:"Pakistan",c:"92-PK-0",b:"92",f:"PK"},{name:"Palau",c:"680-PW-0",b:"680",f:"PW"},{name:"Palestinian Territories",c:"970-PS-0",b:"970",f:"PS"},{name:"Panama",c:"507-PA-0",b:"507",f:"PA"},{name:"Papua New Guinea",c:"675-PG-0",b:"675",f:"PG"},{name:"Paraguay",c:"595-PY-0",b:"595",f:"PY"},{name:"Peru",c:"51-PE-0",b:"51",f:"PE"},{name:"Philippines",c:"63-PH-0",b:"63",f:"PH"},{name:"Poland",c:"48-PL-0",b:"48",f:"PL"},{name:"Portugal",c:"351-PT-0",b:"351",f:"PT"},{name:"Puerto Rico",c:"1-PR-0",b:"1",f:"PR"},{name:"Qatar",c:"974-QA-0",b:"974",f:"QA"},{name:"Runion",c:"262-RE-0",b:"262",f:"RE"},{name:"Romania",c:"40-RO-0",b:"40",f:"RO"},{name:"Russia",c:"7-RU-0",b:"7",f:"RU"},{name:"Rwanda",c:"250-RW-0",b:"250",f:"RW"},{name:"Saint Barthlemy",c:"590-BL-0",b:"590",f:"BL"},{name:"Saint Helena",c:"290-SH-0",b:"290",f:"SH"},{name:"St. Kitts",c:"1-KN-0",b:"1",f:"KN"},{name:"St. Lucia",c:"1-LC-0",b:"1",f:"LC"},{name:"Saint Martin",c:"590-MF-0",b:"590",f:"MF"},{name:"Saint Pierre and Miquelon",c:"508-PM-0",b:"508",f:"PM"},{name:"St. Vincent",c:"1-VC-0",b:"1",f:"VC"},{name:"Samoa",c:"685-WS-0",b:"685",f:"WS"},{name:"San Marino",c:"378-SM-0",b:"378",f:"SM"},{name:"So Tom and Prncipe",c:"239-ST-0",b:"239",f:"ST"},{name:"Saudi Arabia",c:"966-SA-0",b:"966",f:"SA"},{name:"Senegal",c:"221-SN-0",b:"221",f:"SN"},{name:"Serbia",c:"381-RS-0",b:"381",f:"RS"},{name:"Seychelles",c:"248-SC-0",b:"248",f:"SC"},{name:"Sierra Leone",c:"232-SL-0",b:"232",f:"SL"},{name:"Singapore",c:"65-SG-0",b:"65",f:"SG"},{name:"Sint Maarten",c:"1-SX-0",b:"1",f:"SX"},{name:"Slovakia",c:"421-SK-0",b:"421",f:"SK"},{name:"Slovenia",c:"386-SI-0",b:"386",f:"SI"},{name:"Solomon Islands",c:"677-SB-0",b:"677",f:"SB"},{name:"Somalia",c:"252-SO-0",b:"252",f:"SO"},{name:"South Africa",c:"27-ZA-0",b:"27",f:"ZA"},{name:"South Georgia and the South Sandwich Islands",c:"500-GS-0",b:"500",f:"GS"},{name:"South Korea",c:"82-KR-0",b:"82",f:"KR"},{name:"South Sudan",c:"211-SS-0",b:"211",f:"SS"},{name:"Spain",c:"34-ES-0",b:"34",f:"ES"},{name:"Sri Lanka",c:"94-LK-0",b:"94",f:"LK"},{name:"Sudan",c:"249-SD-0",b:"249",f:"SD"},{name:"Suriname",c:"597-SR-0",b:"597",f:"SR"},{name:"Svalbard and Jan Mayen",c:"47-SJ-0",b:"47",f:"SJ"},{name:"Swaziland",c:"268-SZ-0",b:"268",f:"SZ"},{name:"Sweden",c:"46-SE-0",b:"46",f:"SE"},{name:"Switzerland",c:"41-CH-0",b:"41",f:"CH"},{name:"Syria",c:"963-SY-0",b:"963",f:"SY"},{name:"Taiwan",c:"886-TW-0",b:"886",f:"TW"},{name:"Tajikistan",c:"992-TJ-0",b:"992",f:"TJ"},{name:"Tanzania",c:"255-TZ-0",b:"255",f:"TZ"},{name:"Thailand",c:"66-TH-0",b:"66",f:"TH"},{name:"Togo",c:"228-TG-0",b:"228",f:"TG"},{name:"Tokelau",c:"690-TK-0",b:"690",f:"TK"},{name:"Tonga",c:"676-TO-0",b:"676",f:"TO"},{name:"Trinidad/Tobago",c:"1-TT-0",b:"1",f:"TT"},{name:"Tunisia",c:"216-TN-0",b:"216",f:"TN"},{name:"Turkey",c:"90-TR-0",b:"90",f:"TR"},{name:"Turkmenistan",c:"993-TM-0",b:"993",f:"TM"},{name:"Turks and Caicos Islands",c:"1-TC-0",b:"1",f:"TC"},{name:"Tuvalu",c:"688-TV-0",b:"688",f:"TV"},{name:"U.S. Virgin Islands",c:"1-VI-0",b:"1",f:"VI"},{name:"Uganda",c:"256-UG-0",b:"256",f:"UG"},{name:"Ukraine",c:"380-UA-0",b:"380",f:"UA"},{name:"United Arab Emirates",c:"971-AE-0",b:"971",f:"AE"},{name:"United Kingdom",c:"44-GB-0",b:"44",f:"GB"},{name:"United States",c:"1-US-0",b:"1",f:"US"},{name:"Uruguay",c:"598-UY-0",b:"598",f:"UY"},{name:"Uzbekistan",c:"998-UZ-0",b:"998",f:"UZ"},{name:"Vanuatu",c:"678-VU-0",b:"678",f:"VU"},{name:"Vatican City",c:"379-VA-0",b:"379",f:"VA"},{name:"Venezuela",c:"58-VE-0",b:"58",f:"VE"},{name:"Vietnam",c:"84-VN-0",b:"84",f:"VN"},{name:"Wallis and Futuna",c:"681-WF-0",b:"681",f:"WF"},{name:"Western Sahara",c:"212-EH-0",b:"212",f:"EH"},{name:"Yemen",c:"967-YE-0",b:"967",f:"YE"},{name:"Zambia",c:"260-ZM-0",b:"260",f:"ZM"},{name:"Zimbabwe",c:"263-ZW-0",b:"263",f:"ZW"}];hs(ds);var ps=new ss(ds);function fs(t,e){this.a=t,this.Aa=e}function ms(t){t=$(t);var e=as(ps,t);return 0<e.length?new fs("1"==e[0].b?"1-US-0":e[0].c,$(t.substr(e[0].b.length+1))):null}function gs(t){var e=ls(t.a);if(!e)throw Error("Country ID "+t.a+" not found.");return"+"+e.b+t.Aa}function _s(t,e){for(var i=0;i<t.length;i++)if(!j(ys,t[i])&&(null!==vs&&t[i]in vs||j(e,t[i])))return t[i];return null}var ys=["emailLink","password","phone"],vs={"facebook.com":"FacebookAuthProvider","github.com":"GithubAuthProvider","google.com":"GoogleAuthProvider",password:"EmailAuthProvider","twitter.com":"TwitterAuthProvider",phone:"PhoneAuthProvider"};function xs(){this.a=new Jo,Qo(this.a,"autoUpgradeAnonymousUsers"),Qo(this.a,"callbacks"),Qo(this.a,"credentialHelper",Ys),Qo(this.a,"immediateFederatedRedirect",!1),Qo(this.a,"popupMode",!1),Qo(this.a,"privacyPolicyUrl"),Qo(this.a,"queryParameterForSignInSuccessUrl","signInSuccessUrl"),Qo(this.a,"queryParameterForWidgetMode","mode"),Qo(this.a,"signInFlow"),Qo(this.a,"signInOptions"),Qo(this.a,"signInSuccessUrl"),Qo(this.a,"siteName"),Qo(this.a,"tosUrl"),Qo(this.a,"widgetUrl"),Qo(this.a,"adminRestrictedOperation")}function bs(t){var e=!!t.a.get("autoUpgradeAnonymousUsers");return e&&!js(t)&&Ur('Missing "signInFailure" callback: "signInFailure" callback needs to be provided when "autoUpgradeAnonymousUsers" is set to true.',void 0),e}function ws(t){t=t.a.get("signInOptions")||[];for(var e=[],i=0;i<t.length;i++){var n=t[i];(n=w(n)?n:{provider:n}).provider&&e.push(n)}return e}function Es(t,e){t=ws(t);for(var i=0;i<t.length;i++)if(t[i].provider===e)return t[i];return null}function Ss(t){return ws(t).map((function(t){return t.provider}))}function Ts(t,e){t=Ms(t);for(var i=0;i<t.length;i++)if(t[i].providerId===e)return t[i];return null}function Ms(t){return ws(t).map((function(t){if(vs[t.provider]||j(ta,t.provider)){for(var e in t={providerId:t.provider,S:t.providerName||null,V:t.fullLabel||null,ta:t.buttonColor||null,za:t.iconUrl?ye(xe(t.iconUrl)).toString():null})null===t[e]&&delete t[e];return t}return{providerId:t.provider,S:t.providerName||null,V:t.fullLabel||null,ta:t.buttonColor||null,za:t.iconUrl?ye(xe(t.iconUrl)).toString():null,Ob:t.loginHintKey||null}}))}function Is(t){var e,i=Es(t,Sd.auth.GoogleAuthProvider.PROVIDER_ID);if(e=i&&i.clientId){t:{if("http:"===(window.location&&window.location.protocol)||"https:"===(window.location&&window.location.protocol))for(n in t=t.a.get("credentialHelper"),Zs)if(Zs[n]===t){var n=Zs[n];break t}n=Ys}e=n===$s}return e&&i.clientId||null}function Cs(t){return!!((t=Es(t,Sd.auth.EmailAuthProvider.PROVIDER_ID))&&t.disableSignUp&&t.disableSignUp.status)}function As(t){return!(!(t=t.a.get("adminRestrictedOperation")||null)||!t.status)}function Ps(t,e){return t=(t=Es(t,e))&&t.scopes,Array.isArray(t)?t:[]}function Ls(t,e){return w(t=(t=Es(t,e))&&t.customParameters)?(t=ot(t),e===Sd.auth.GoogleAuthProvider.PROVIDER_ID&&delete t.login_hint,e===Sd.auth.GithubAuthProvider.PROVIDER_ID&&delete t.login,t):null}function Rs(t){if(!(t=Es(t,Sd.auth.PhoneAuthProvider.PROVIDER_ID)))return null;var e=t.whitelistedCountries,i=t.blacklistedCountries;if(void 0!==e&&(!Array.isArray(e)||0==e.length))throw Error("WhitelistedCountries must be a non-empty array.");if(void 0!==i&&!Array.isArray(i))throw Error("BlacklistedCountries must be an array.");if(e&&i)throw Error("Both whitelistedCountries and blacklistedCountries are provided.");if(!e&&!i)return ds;if(t=[],e){i={};for(var n=0;n<e.length;n++)for(var r=us(e[n]),o=0;o<r.length;o++)i[r[o].c]=r[o];for(var s in i)i.hasOwnProperty(s)&&t.push(i[s])}else{for(s={},e=0;e<i.length;e++)for(r=us(i[e]),n=0;n<r.length;n++)s[r[n].c]=r[n];for(r=0;r<ds.length;r++)null!==s&&ds[r].c in s||t.push(ds[r])}return t}function Ds(t){return es(t.a,"queryParameterForWidgetMode")}function ks(t){var e=t.a.get("tosUrl")||null;if(t=t.a.get("privacyPolicyUrl")||null,e&&!t&&Hr("Privacy Policy URL is missing, the link will not be displayed."),e&&t){if("function"==typeof e)return e;if("string"==typeof e)return function(){Jn(e)}}return null}function Ns(t){var e=t.a.get("tosUrl")||null,i=t.a.get("privacyPolicyUrl")||null;if(i&&!e&&Hr("Term of Service URL is missing, the link will not be displayed."),e&&i){if("function"==typeof i)return i;if("string"==typeof i)return function(){Jn(i)}}return null}function Os(t){return!(t=Es(t,Sd.auth.EmailAuthProvider.PROVIDER_ID))||void 0===t.requireDisplayName||!!t.requireDisplayName}function Fs(t){return!(!(t=Es(t,Sd.auth.EmailAuthProvider.PROVIDER_ID))||t.signInMethod!==Sd.auth.EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD)}function zs(t){var e=!!t.a.get("immediateFederatedRedirect"),i=Ss(t);return t=Bs(t),e&&1==i.length&&!j(ys,i[0])&&t==Ks}function Bs(t){for(var e in t=t.a.get("signInFlow"),Js)if(Js[e]==t)return Js[e];return Ks}function Us(t){return Gs(t).signInSuccess||null}function Vs(t){return Gs(t).signInSuccessWithAuthResult||null}function js(t){return Gs(t).signInFailure||null}function Gs(t){return t.a.get("callbacks")||{}}var Hs,Ws,qs,Xs,$s="googleyolo",Ys="none",Zs={nc:$s,NONE:Ys},Ks="redirect",Js={qc:"popup",rc:Ks},Qs={mc:"callback",RECOVER_EMAIL:"recoverEmail",sc:"resetPassword",REVERT_SECOND_FACTOR_ADDITION:"revertSecondFactorAddition",tc:"select",uc:"signIn",VERIFY_AND_CHANGE_EMAIL:"verifyAndChangeEmail",VERIFY_EMAIL:"verifyEmail"},ta=["anonymous"],ea=["sitekey","tabindex","callback","expired-callback"],ia={};function na(t,e,i,n){ia[t].apply(null,Array.prototype.slice.call(arguments,1))}function ra(t){return t.classList?t.classList:p(t=t.className)&&t.match(/\S+/g)||[]}function oa(t,e){return t.classList?t.classList.contains(e):j(ra(t),e)}function sa(t,e){t.classList?t.classList.add(e):oa(t,e)||(t.className+=0<t.className.length?" "+e:e)}function aa(t,e){t.classList?t.classList.remove(e):oa(t,e)&&(t.className=B(ra(t),(function(t){return t!=e})).join(" "))}function la(t){var e=t.type;switch(p(e)&&e.toLowerCase()){case"checkbox":case"radio":return t.checked?t.value:null;case"select-one":return 0<=(e=t.selectedIndex)?t.options[e].value:null;case"select-multiple":e=[];for(var i,n=0;i=t.options[n];n++)i.selected&&e.push(i.value);return e.length?e:null;default:return null!=t.value?t.value:null}}function ca(t,e){var i=t.type;switch(p(i)&&i.toLowerCase()){case"checkbox":case"radio":t.checked=e;break;case"select-one":if(t.selectedIndex=-1,p(e))for(var n=0;i=t.options[n];n++)if(i.value==e){i.selected=!0;break}break;case"select-multiple":for(p(e)&&(e=[e]),n=0;i=t.options[n];n++)if(i.selected=!1,e)for(var r,o=0;r=e[o];o++)i.value==r&&(i.selected=!0);break;default:t.value=null!=e?e:""}}function ua(t,e,i,n,r,o){if(te&&!ce("525"))return!0;if(ie&&r)return ha(t);if(r&&!n)return!1;if(!Qt&&("number"==typeof e&&(e=da(e)),(!i||ie)&&(17==e||18==e||ie&&91==e)||ie&&16==e&&(n||o)))return!1;if((te||Kt)&&n&&i)switch(t){case 220:case 219:case 221:case 192:case 186:case 189:case 187:case 188:case 190:case 191:case 192:case 222:return!1}if(Zt&&n&&e==t)return!1;switch(t){case 13:return!(Qt&&(o||r||i&&n));case 27:return!(te||Kt||Qt)}return(!Qt||!(n||r||o))&&ha(t)}function ha(t){if(48<=t&&57>=t||96<=t&&106>=t||65<=t&&90>=t||(te||Kt)&&0==t)return!0;switch(t){case 32:case 43:case 63:case 64:case 107:case 109:case 110:case 111:case 186:case 59:case 189:case 187:case 61:case 188:case 190:case 191:case 192:case 222:case 219:case 220:case 221:case 163:return!0;case 173:return Qt;default:return!1}}function da(t){return Qt?t=function(t){switch(t){case 61:return 187;case 59:return 186;case 173:return 189;case 224:return 91;case 0:return 224;default:return t}}(t):ie&&te&&93===t&&(t=91),t}function pa(t){cn.call(this),this.a=t,Zi(t,"keydown",this.g,!1,this),Zi(t,"click",this.h,!1,this)}function fa(t,e){var i=new ga(e);if(un(t,i)){i=new ma(e);try{un(t,i)}finally{e.stopPropagation()}}}function ma(t){Bi.call(this,t.a),this.type="action"}function ga(t){Bi.call(this,t.a),this.type="beforeaction"}function _a(t){cn.call(this),this.a=t,t=Zt?"focusout":"blur",this.g=Zi(this.a,Zt?"focusin":"focus",this,!Zt),this.h=Zi(this.a,t,this,!Zt)}function ya(t,e){cn.call(this),this.g=t||1,this.a=e||h,this.h=I(this.gc,this),this.j=L()}function va(t){t.Ka=!1,t.aa&&(t.a.clearTimeout(t.aa),t.aa=null)}function xa(t){Ai.call(this),this.g=t,this.a={}}D(pa,cn),pa.prototype.g=function(t){(13==t.keyCode||te&&3==t.keyCode)&&fa(this,t)},pa.prototype.h=function(t){fa(this,t)},pa.prototype.o=function(){pa.K.o.call(this),Qi(this.a,"keydown",this.g,!1,this),Qi(this.a,"click",this.h,!1,this),delete this.a},D(ma,Bi),D(ga,Bi),D(_a,cn),_a.prototype.handleEvent=function(t){var e=new Bi(t.a);e.type="focusin"==t.type||"focus"==t.type?"focusin":"focusout",un(this,e)},_a.prototype.o=function(){_a.K.o.call(this),tn(this.g),tn(this.h),delete this.a},D(ya,cn),(t=ya.prototype).Ka=!1,t.aa=null,t.gc=function(){if(this.Ka){var t=L()-this.j;0<t&&t<.8*this.g?this.aa=this.a.setTimeout(this.h,this.g-t):(this.aa&&(this.a.clearTimeout(this.aa),this.aa=null),un(this,"tick"),this.Ka&&(va(this),this.start()))}},t.start=function(){this.Ka=!0,this.aa||(this.aa=this.a.setTimeout(this.h,this.g),this.j=L())},t.o=function(){ya.K.o.call(this),va(this),delete this.a},D(xa,Ai);var ba=[];function wa(t,e,i,n){v(i)||(i&&(ba[0]=i.toString()),i=ba);for(var r=0;r<i.length;r++){var o=Zi(e,i[r],n||t.handleEvent,!1,t.g||t);if(!o)break;t.a[o.key]=o}}function Ea(t){rt(t.a,(function(t,e){this.a.hasOwnProperty(e)&&tn(t)}),t),t.a={}}function Sa(t){cn.call(this),this.a=null,this.g=t,t=Zt||Kt||te&&!ce("531")&&"TEXTAREA"==t.tagName,this.h=new xa(this),wa(this.h,this.g,t?["keydown","paste","cut","drop","input"]:"input",this)}function Ta(t){null!=t.a&&(h.clearTimeout(t.a),t.a=null)}function Ma(t){return(t=new Bi(t.a)).type="input",t}function Ia(t,e){cn.call(this),t&&(this.Oa&&Ra(this),this.qa=t,this.Na=Zi(this.qa,"keypress",this,e),this.Ya=Zi(this.qa,"keydown",this.Jb,e,this),this.Oa=Zi(this.qa,"keyup",this.Kb,e,this))}xa.prototype.o=function(){xa.K.o.call(this),Ea(this)},xa.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},D(Sa,cn),Sa.prototype.handleEvent=function(t){if("input"==t.type)Zt&&ce(10)&&0==t.keyCode&&0==t.j||(Ta(this),un(this,Ma(t)));else if("keydown"!=t.type||function(t){if(t.altKey&&!t.ctrlKey||t.metaKey||112<=t.keyCode&&123>=t.keyCode)return!1;if(ha(t.keyCode))return!0;switch(t.keyCode){case 18:case 20:case 93:case 17:case 40:case 35:case 27:case 36:case 45:case 37:case 224:case 91:case 144:case 12:case 34:case 33:case 19:case 255:case 44:case 39:case 145:case 16:case 38:case 252:case 224:case 92:return!1;case 0:return!Qt;default:return 166>t.keyCode||183<t.keyCode}}(t)){var e="keydown"==t.type?this.g.value:null;Zt&&229==t.keyCode&&(e=null);var i=Ma(t);Ta(this),this.a=function(t,e){if(b(t))e&&(t=I(t,e));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=I(t.handleEvent,t)}return 2147483647<Number(0)?-1:h.setTimeout(t,0)}((function(){this.a=null,this.g.value!=e&&un(this,i)}),this)}},Sa.prototype.o=function(){Sa.K.o.call(this),this.h.m(),Ta(this),delete this.g},D(Ia,cn),(t=Ia.prototype).qa=null,t.Na=null,t.Ya=null,t.Oa=null,t.R=-1,t.X=-1,t.Ua=!1;var Ca={3:13,12:144,63232:38,63233:40,63234:37,63235:39,63236:112,63237:113,63238:114,63239:115,63240:116,63241:117,63242:118,63243:119,63244:120,63245:121,63246:122,63247:123,63248:44,63272:46,63273:36,63275:35,63276:33,63277:34,63289:144,63302:45},Aa={Up:38,Down:40,Left:37,Right:39,Enter:13,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"U+007F":46,Home:36,End:35,PageUp:33,PageDown:34,Insert:45},Pa=!te||ce("525"),La=ie&&Qt;function Ra(t){t.Na&&(tn(t.Na),tn(t.Ya),tn(t.Oa),t.Na=null,t.Ya=null,t.Oa=null),t.qa=null,t.R=-1,t.X=-1}function Da(t,e,i,n){Bi.call(this,n),this.type="key",this.keyCode=t,this.j=e,this.repeat=i}function ka(t,e,i,n){this.top=t,this.right=e,this.bottom=i,this.left=n}function Na(t,e){var i=je(t);return i.defaultView&&i.defaultView.getComputedStyle&&(t=i.defaultView.getComputedStyle(t,null))&&(t[e]||t.getPropertyValue(e))||""}function Oa(t){try{var e=t.getBoundingClientRect()}catch(t){return{left:0,top:0,right:0,bottom:0}}return Zt&&t.ownerDocument.body&&(t=t.ownerDocument,e.left-=t.documentElement.clientLeft+t.body.clientLeft,e.top-=t.documentElement.clientTop+t.body.clientTop),e}function Fa(t){var e=je(t),i=new De(0,0),n=e?je(e):document;return t==(n=!Zt||9<=Number(ae)||"CSS1Compat"==Ne(n).a.compatMode?n.documentElement:n.body)||(t=Oa(t),e=Ue(n=Ne(e).a),n=n.parentWindow||n.defaultView,e=Zt&&ce("10")&&n.pageYOffset!=e.scrollTop?new De(e.scrollLeft,e.scrollTop):new De(n.pageXOffset||e.scrollLeft,n.pageYOffset||e.scrollTop),i.a=t.left+e.a,i.g=t.top+e.g),i}(t=Ia.prototype).Jb=function(t){(te||Kt)&&(17==this.R&&!t.ctrlKey||18==this.R&&!t.altKey||ie&&91==this.R&&!t.metaKey)&&(this.X=this.R=-1),-1==this.R&&(t.ctrlKey&&17!=t.keyCode?this.R=17:t.altKey&&18!=t.keyCode?this.R=18:t.metaKey&&91!=t.keyCode&&(this.R=91)),Pa&&!ua(t.keyCode,this.R,t.shiftKey,t.ctrlKey,t.altKey,t.metaKey)?this.handleEvent(t):(this.X=da(t.keyCode),La&&(this.Ua=t.altKey))},t.Kb=function(t){this.X=this.R=-1,this.Ua=t.altKey},t.handleEvent=function(t){var e=t.a,i=e.altKey;if(Zt&&"keypress"==t.type)var n=this.X,r=13!=n&&27!=n?e.keyCode:0;else(te||Kt)&&"keypress"==t.type?(n=this.X,r=0<=e.charCode&&63232>e.charCode&&ha(n)?e.charCode:0):Yt&&!te?r=ha(n=this.X)?e.keyCode:0:("keypress"==t.type?(La&&(i=this.Ua),e.keyCode==e.charCode?32>e.keyCode?(n=e.keyCode,r=0):(n=this.X,r=e.charCode):(n=e.keyCode||this.X,r=e.charCode||0)):(n=e.keyCode||this.X,r=e.charCode||0),ie&&63==r&&224==n&&(n=191));var o=n=da(n);n?63232<=n&&n in Ca?o=Ca[n]:25==n&&t.shiftKey&&(o=9):e.keyIdentifier&&e.keyIdentifier in Aa&&(o=Aa[e.keyIdentifier]),Qt&&Pa&&"keypress"==t.type&&!ua(o,this.R,t.shiftKey,t.ctrlKey,i,t.metaKey)||(t=o==this.R,this.R=o,(e=new Da(o,r,t,e)).altKey=i,un(this,e))},t.N=function(){return this.qa},t.o=function(){Ia.K.o.call(this),Ra(this)},D(Da,Bi),ka.prototype.toString=function(){return"("+this.top+"t, "+this.right+"r, "+this.bottom+"b, "+this.left+"l)"},ka.prototype.ceil=function(){return this.top=Math.ceil(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom),this.left=Math.ceil(this.left),this},ka.prototype.floor=function(){return this.top=Math.floor(this.top),this.right=Math.floor(this.right),this.bottom=Math.floor(this.bottom),this.left=Math.floor(this.left),this},ka.prototype.round=function(){return this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom),this.left=Math.round(this.left),this};var za={thin:2,medium:4,thick:6};function Ba(t,e){if("none"==(t.currentStyle?t.currentStyle[e+"Style"]:null))return 0;var i=t.currentStyle?t.currentStyle[e+"Width"]:null;if(i in za)t=za[i];else if(/^\d+px?$/.test(i))t=parseInt(i,10);else{e=t.style.left;var n=t.runtimeStyle.left;t.runtimeStyle.left=t.currentStyle.left,t.style.left=i,i=t.style.pixelLeft,t.style.left=e,t.runtimeStyle.left=n,t=+i}return t}function Ua(){}function Va(t){cn.call(this),this.s=t||Ne(),this.cb=null,this.na=!1,this.g=null,this.L=void 0,this.oa=this.Ea=this.Y=null}function ja(t,e){return t.g?Fe(e,t.g||t.s.a):null}function Ga(t){return t.L||(t.L=new xa(t)),t.L}function Ha(t,e){t.Ea&&z(t.Ea,e,void 0)}function Wa(t,e){var i=He(t,"firebaseui-textfield");e?(aa(t,"firebaseui-input-invalid"),sa(t,"firebaseui-input"),i&&aa(i,"firebaseui-textfield-invalid")):(aa(t,"firebaseui-input"),sa(t,"firebaseui-input-invalid"),i&&sa(i,"firebaseui-textfield-invalid"))}function qa(t,e,i){Ri(t,C(Di,e=new Sa(e))),wa(Ga(t),e,"input",i)}function Xa(t,e,i){Ri(t,C(Di,e=new Ia(e))),wa(Ga(t),e,"key",(function(t){13==t.keyCode&&(t.stopPropagation(),t.preventDefault(),i(t))}))}function $a(t,e,i){Ri(t,C(Di,e=new pa(e))),wa(Ga(t),e,"action",(function(t){t.stopPropagation(),t.preventDefault(),i(t)}))}function Ya(t){sa(t,"firebaseui-hidden")}function Za(t,e){e&&Ge(t,e),aa(t,"firebaseui-hidden")}function Ka(t){return!oa(t,"firebaseui-hidden")&&"none"!=t.style.display}function Ja(t){var e=(t=t||{}).email,i=t.disabled,n='<div class="firebaseui-textfield mdl-textfield mdl-js-textfield mdl-textfield--floating-label"><label class="mdl-textfield__label firebaseui-label" for="ui-sign-in-email-input">';return n=t.wc?n+"Enter new email address":n+"Email",n+='</label><input type="email" name="email" id="ui-sign-in-email-input" autocomplete="username" class="mdl-textfield__input firebaseui-input firebaseui-id-email" value="'+ci(null!=e?e:"")+'"'+(i?"disabled":"")+'></div><div class="firebaseui-error-wrapper"><p class="firebaseui-error firebaseui-text-input-error firebaseui-hidden firebaseui-id-email-error"></p></div>',oi(n)}function Qa(t){var e='<button type="submit" class="firebaseui-id-submit firebaseui-button mdl-button mdl-js-button mdl-button--raised mdl-button--colored">';return e=(t=(t=t||{}).label)?e+ei(t):e+"Next",oi(e+"</button>")}function tl(){var t=""+Qa({label:ai("Sign In")});return oi(t)}function el(){var t=""+Qa({label:ai("Save")});return oi(t)}function il(){var t=""+Qa({label:ai("Continue")});return oi(t)}function nl(t){var e='<div class="firebaseui-new-password-component"><div class="firebaseui-textfield mdl-textfield mdl-js-textfield mdl-textfield--floating-label"><label class="mdl-textfield__label firebaseui-label" for="ui-sign-in-new-password-input">';return e=(t=(t=t||{}).label)?e+ei(t):e+"Choose password",oi(e+'</label><input type="password" name="newPassword" id="ui-sign-in-new-password-input" autocomplete="new-password" class="mdl-textfield__input firebaseui-input firebaseui-id-new-password"></div><a href="javascript:void(0)" class="firebaseui-input-floating-button firebaseui-id-password-toggle firebaseui-input-toggle-on firebaseui-input-toggle-blur"></a><div class="firebaseui-error-wrapper"><p class="firebaseui-error firebaseui-text-input-error firebaseui-hidden firebaseui-id-new-password-error"></p></div></div>')}function rl(){var t='<div class="firebaseui-textfield mdl-textfield mdl-js-textfield mdl-textfield--floating-label"><label class="mdl-textfield__label firebaseui-label" for="ui-sign-in-password-input">';return oi((t={}.current?t+"Current password":t+"Password")+'</label><input type="password" name="password" id="ui-sign-in-password-input" autocomplete="current-password" class="mdl-textfield__input firebaseui-input firebaseui-id-password"></div><div class="firebaseui-error-wrapper"><p class="firebaseui-error firebaseui-text-input-error firebaseui-hidden firebaseui-id-password-error"></p></div>')}function ol(){return oi('<a class="firebaseui-link firebaseui-id-secondary-link" href="javascript:void(0)">Trouble signing in?</a>')}function sl(t){var e='<button class="firebaseui-id-secondary-link firebaseui-button mdl-button mdl-js-button mdl-button--primary">';return e=(t=(t=t||{}).label)?e+ei(t):e+"Cancel",oi(e+"</button>")}function al(t){var e="";return t.F&&t.D&&(e+='<ul class="firebaseui-tos-list firebaseui-tos"><li class="firebaseui-inline-list-item"><a href="javascript:void(0)" class="firebaseui-link firebaseui-tos-link" target="_blank">Terms of Service</a></li><li class="firebaseui-inline-list-item"><a href="javascript:void(0)" class="firebaseui-link firebaseui-pp-link" target="_blank">Privacy Policy</a></li></ul>'),oi(e)}function ll(t){var e="";return t.F&&t.D&&(e+='<p class="firebaseui-tos firebaseui-tospp-full-message">By continuing, you are indicating that you accept our <a href="javascript:void(0)" class="firebaseui-link firebaseui-tos-link" target="_blank">Terms of Service</a> and <a href="javascript:void(0)" class="firebaseui-link firebaseui-pp-link" target="_blank">Privacy Policy</a>.</p>'),oi(e)}function cl(t){return t='<div class="firebaseui-info-bar firebaseui-id-info-bar"><p class="firebaseui-info-bar-message">'+ei(t.message)+'&nbsp;&nbsp;<a href="javascript:void(0)" class="firebaseui-link firebaseui-id-dismiss-info-bar">Dismiss</a></p></div>',oi(t)}function ul(t){var e=t.content;return t=t.Ab,oi('<dialog class="mdl-dialog firebaseui-dialog firebaseui-id-dialog'+(t?" "+ci(t):"")+'">'+ei(e)+"</dialog>")}function hl(t){var e=t.message;return oi(ul({content:li('<div class="firebaseui-dialog-icon-wrapper"><div class="'+ci(t.Ma)+' firebaseui-dialog-icon"></div></div><div class="firebaseui-progress-dialog-message">'+ei(e)+"</div>")}))}function dl(t){for(var e='<div class="firebaseui-list-box-actions">',i=(t=t.items).length,n=0;n<i;n++){var r=t[n];e+='<button type="button" data-listboxid="'+ci(r.id)+'" class="mdl-button firebaseui-id-list-box-dialog-button firebaseui-list-box-dialog-button">'+(r.Ma?'<div class="firebaseui-list-box-icon-wrapper"><div class="firebaseui-list-box-icon '+ci(r.Ma)+'"></div></div>':"")+'<div class="firebaseui-list-box-label-wrapper">'+ei(r.label)+"</div></button>"}return e=""+ul({Ab:ai("firebaseui-list-box-dialog"),content:li(e+"</div>")}),oi(e)}function pl(t){return oi((t=t||{}).tb?'<div class="mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active firebaseui-busy-indicator firebaseui-id-busy-indicator"></div>':'<div class="mdl-progress mdl-js-progress mdl-progress__indeterminate firebaseui-busy-indicator firebaseui-id-busy-indicator"></div>')}function fl(t,e){return ri((t=(t=t||{}).ga).S?t.S:e.hb[t.providerId]?""+e.hb[t.providerId]:t.providerId&&0==t.providerId.indexOf("saml.")||t.providerId&&0==t.providerId.indexOf("oidc.")?t.providerId.substring(5):""+t.providerId)}function ml(t){yl(t,"upgradeElement")}function gl(t){yl(t,"downgradeElements")}_(Ua),Ua.prototype.a=0,D(Va,cn),(t=Va.prototype).Lb=Ua.Xa(),t.N=function(){return this.g},t.Za=function(t){if(this.Y&&this.Y!=t)throw Error("Method not supported");Va.K.Za.call(this,t)},t.kb=function(){this.g=this.s.a.createElement("DIV")},t.render=function(t){if(this.na)throw Error("Component already rendered");this.g||this.kb(),t?t.insertBefore(this.g,null):this.s.a.body.appendChild(this.g),this.Y&&!this.Y.na||this.v()},t.v=function(){this.na=!0,Ha(this,(function(t){!t.na&&t.N()&&t.v()}))},t.ya=function(){Ha(this,(function(t){t.na&&t.ya()})),this.L&&Ea(this.L),this.na=!1},t.o=function(){this.na&&this.ya(),this.L&&(this.L.m(),delete this.L),Ha(this,(function(t){t.m()})),this.g&&Ve(this.g),this.Y=this.g=this.oa=this.Ea=null,Va.K.o.call(this)},t.removeChild=function(t,e){if(t){var i=p(t)?t:t.cb||(t.cb=":"+(t.Lb.a++).toString(36));if(t=this.oa&&i&&(null!==(t=this.oa)&&i in t?t[i]:void 0)||null,i&&t){var n=this.oa;if(i in n&&delete n[i],G(this.Ea,t),e&&(t.ya(),t.g&&Ve(t.g)),null==(e=t))throw Error("Unable to set parent component");e.Y=null,Va.K.Za.call(e,null)}}if(!t)throw Error("Child is not in parent component");return t},cl.a="firebaseui.auth.soy2.element.infoBar",hl.a="firebaseui.auth.soy2.element.progressDialog",dl.a="firebaseui.auth.soy2.element.listBoxDialog",pl.a="firebaseui.auth.soy2.element.busyIndicator";var _l=["mdl-js-textfield","mdl-js-progress","mdl-js-spinner","mdl-js-button"];function yl(t,e){t&&window.componentHandler&&window.componentHandler[e]&&_l.forEach((function(i){oa(t,i)&&window.componentHandler[e](t),z(Oe(i,t),(function(t){window.componentHandler[e](t)}))}))}function vl(t,e,i){if(xl.call(this),document.body.appendChild(t),t.showModal||window.dialogPolyfill.registerDialog(t),t.showModal(),ml(t),e&&$a(this,t,(function(e){var i=t.getBoundingClientRect();(e.clientX<i.left||i.left+i.width<e.clientX||e.clientY<i.top||i.top+i.height<e.clientY)&&xl.call(this)})),!i){var n=this.N().parentElement||this.N().parentNode;if(n){var r=this;this.da=function(){if(t.open){var e=t.getBoundingClientRect().height,i=n.getBoundingClientRect().height,o=n.getBoundingClientRect().top-document.body.getBoundingClientRect().top,s=n.getBoundingClientRect().left-document.body.getBoundingClientRect().left,a=t.getBoundingClientRect().width,l=n.getBoundingClientRect().width;t.style.top=(o+(i-e)/2).toString()+"px",e=s+(l-a)/2,t.style.left=e.toString()+"px",t.style.right=(document.body.getBoundingClientRect().width-e-a).toString()+"px"}else window.removeEventListener("resize",r.da)},this.da(),window.addEventListener("resize",this.da,!1)}}}function xl(){var t=bl.call(this);t&&(gl(t),t.open&&t.close(),Ve(t),this.da&&window.removeEventListener("resize",this.da))}function bl(){return Fe("firebaseui-id-dialog")}function wl(){Ve(El.call(this))}function El(){return ja(this,"firebaseui-id-info-bar")}function Sl(){return ja(this,"firebaseui-id-dismiss-info-bar")}var Tl={xa:{"google.com":"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg","github.com":"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/github.svg","facebook.com":"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/facebook.svg","twitter.com":"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/twitter.svg",password:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/mail.svg",phone:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/phone.svg",anonymous:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/anonymous.png","microsoft.com":"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/microsoft.svg","yahoo.com":"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/yahoo.svg","apple.com":"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/apple.png",saml:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/saml.svg",oidc:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/oidc.svg"},wa:{"google.com":"#ffffff","github.com":"#333333","facebook.com":"#3b5998","twitter.com":"#55acee",password:"#db4437",phone:"#02bd7e",anonymous:"#f4b400","microsoft.com":"#2F2F2F","yahoo.com":"#720E9E","apple.com":"#000000",saml:"#007bff",oidc:"#007bff"},hb:{"google.com":"Google","github.com":"GitHub","facebook.com":"Facebook","twitter.com":"Twitter",password:"Password",phone:"Phone",anonymous:"Guest","microsoft.com":"Microsoft","yahoo.com":"Yahoo","apple.com":"Apple"}};function Ml(t,e,i){for(var n in zi.call(this,t,e),i)this[n]=i[n]}function Il(t,e,i,n,r){Va.call(this,i),this.fb=t,this.eb=e,this.Fa=!1,this.Ga=n||null,this.A=this.ca=null,this.Z=ot(Tl),at(this.Z,r||{})}function Cl(t){return t.N().parentElement||t.N().parentNode}function Al(t,e,i){Xa(t,e,(function(){i.focus()}))}function Pl(t,e,i){Xa(t,e,(function(){i()}))}function Ll(t,e,i){e=(t=t||{}).Va;var n=t.ia;return t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-sign-in"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in with email</h1></div><div class="firebaseui-card-content"><div class="firebaseui-relative-wrapper">'+Ja(t)+'</div></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+(e?sl(null):"")+Qa(null)+'</div></div><div class="firebaseui-card-footer">'+(n?ll(i):al(i))+"</div></form></div>",oi(t)}function Rl(t,e,i){return e=(t=t||{}).ia,t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-sign-in"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content">'+Ja(t)+rl()+'</div><div class="firebaseui-card-actions"><div class="firebaseui-form-links">'+ol()+'</div><div class="firebaseui-form-actions">'+tl()+'</div></div><div class="firebaseui-card-footer">'+(e?ll(i):al(i))+"</div></form></div>",oi(t)}function Dl(t,e,i){var n=(t=t||{}).Tb;e=t.Ta;var r=t.ia,o='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-sign-up"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Create account</h1></div><div class="firebaseui-card-content">'+Ja(t);return n?(t='<div class="firebaseui-textfield mdl-textfield mdl-js-textfield mdl-textfield--floating-label"><label class="mdl-textfield__label firebaseui-label" for="ui-sign-in-name-input">First &amp; last name</label><input type="text" name="name" id="ui-sign-in-name-input" autocomplete="name" class="mdl-textfield__input firebaseui-input firebaseui-id-name" value="'+ci(null!=(t=(t=t||{}).name)?t:"")+'"></div><div class="firebaseui-error-wrapper"><p class="firebaseui-error firebaseui-text-input-error firebaseui-hidden firebaseui-id-name-error"></p></div>',t=oi(t)):t="",i=o+t+nl(null)+'</div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+(e?sl(null):"")+el()+'</div></div><div class="firebaseui-card-footer">'+(r?ll(i):al(i))+"</div></form></div>",oi(i)}function kl(t,e,i){return e=(t=t||{}).Ta,t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-recovery"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Recover password</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Get instructions sent to this email that explain how to reset your password</p>'+Ja(t)+'</div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+(e?sl(null):"")+Qa({label:ai("Send")})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",oi(t)}function Nl(t,e,i){e=t.G;var n="";return n+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-recovery-email-sent"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Check your email</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">'+(t="Follow the instructions sent to <strong>"+ei(t.email)+"</strong> to recover your password")+'</p></div><div class="firebaseui-card-actions">',e&&(n+='<div class="firebaseui-form-actions">'+Qa({label:ai("Done")})+"</div>"),n+='</div><div class="firebaseui-card-footer">'+al(i)+"</div></div>",oi(n)}function Ol(t,e,i){return oi('<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-callback"><div class="firebaseui-callback-indicator-container">'+pl(null)+"</div></div>")}function Fl(t,e,i){return oi('<div class="firebaseui-container firebaseui-id-page-spinner">'+pl({tb:!0})+"</div>")}function zl(){return oi('<div class="firebaseui-container firebaseui-id-page-blank firebaseui-use-spinner"></div>')}function Bl(t,e,i){return e="",e+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-link-sign-in-sent"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign-in email sent</h1></div><div class="firebaseui-card-content"><div class="firebaseui-email-sent"></div><p class="firebaseui-text">'+(t="A sign-in email with additional instructions was sent to <strong>"+ei(t.email)+"</strong>. Check your email to complete sign-in.")+'</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-links">'+oi('<a class="firebaseui-link firebaseui-id-trouble-getting-email-link" href="javascript:void(0)">Trouble getting email?</a>')+'</div><div class="firebaseui-form-actions">'+sl({label:ai("Back")})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",oi(e)}function Ul(t,e,i){return t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-not-received"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Trouble getting email?</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Try these common fixes:<ul><li>Check if the email was marked as spam or filtered.</li><li>Check your internet connection.</li><li>Check that you did not misspell your email.</li><li>Check that your inbox space is not running out or other inbox settings related issues.</li></ul></p><p class="firebaseui-text">If the steps above didn\'t work, you can resend the email. Note that this will deactivate the link in the older email.</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-links">'+oi('<a class="firebaseui-link firebaseui-id-resend-email-link" href="javascript:void(0)">Resend</a>')+'</div><div class="firebaseui-form-actions">'+sl({label:ai("Back")})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",oi(t)}function Vl(t,e,i){return t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-link-sign-in-confirmation"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Confirm email</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Confirm your email to complete sign in</p><div class="firebaseui-relative-wrapper">'+Ja(t)+'</div></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+sl(null)+Qa(null)+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",oi(t)}function jl(){var t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-different-device-error"><div class="firebaseui-card-header"><h1 class="firebaseui-title">New device or browser detected</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Try opening the link using the same device or browser where you started the sign-in process.</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+sl({label:ai("Dismiss")})+"</div></div></div>";return oi(t)}function Gl(){var t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-anonymous-user-mismatch"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Session ended</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">The session associated with this sign-in request has either expired or was cleared.</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+sl({label:ai("Dismiss")})+"</div></div></div>";return oi(t)}function Hl(t,e,i){return e="",e+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-linking"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content"><h2 class="firebaseui-subtitle">You already have an account</h2><p class="firebaseui-text">'+(t="Youve already used <strong>"+ei(t.email)+"</strong> to sign in. Enter your password for that account.")+"</p>"+rl()+'</div><div class="firebaseui-card-actions"><div class="firebaseui-form-links">'+ol()+'</div><div class="firebaseui-form-actions">'+tl()+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",oi(e)}function Wl(t,e,i){var n=t.email;return e="",t=ai(t=""+fl(t,i)),e+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-link-sign-in-linking"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content"><h2 class="firebaseui-subtitle">You already have an account</h2><p class="firebaseui-text firebaseui-text-justify">'+(n="Youve already used <strong>"+ei(n)+"</strong>. You can connect your <strong>"+ei(t)+"</strong> account with <strong>"+ei(n)+"</strong> by signing in with email link below.")+'<p class="firebaseui-text firebaseui-text-justify">'+(t="For this flow to successfully connect your "+ei(t)+" account with this email, you have to open the link on the same device or browser.")+'</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+tl()+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",oi(e)}function ql(t,e,i){e="";var n=""+fl(t,i);return e+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-link-sign-in-linking-different-device"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text firebaseui-text-justify">'+(t="You originally intended to connect <strong>"+ei(n=ai(n))+"</strong> to your email account but have opened the link on a different device where you are not signed in.")+'</p><p class="firebaseui-text firebaseui-text-justify">'+(n="If you still want to connect your <strong>"+ei(n)+"</strong> account, open the link on the same device where you started sign-in. Otherwise, tap Continue to sign-in on this device.")+'</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+il()+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",oi(e)}function Xl(t,e,i){var n=t.email;return e="",t=ai(t=""+fl(t,i)),e+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-federated-linking"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content"><h2 class="firebaseui-subtitle">You already have an account</h2><p class="firebaseui-text">'+(n="Youve already used <strong>"+ei(n)+"</strong>. Sign in with "+ei(t)+" to continue.")+'</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+Qa({label:ai("Sign in with "+t)})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",oi(e)}function $l(t,e,i){var n=(t=t||{}).kc;e=t.yb,t=t.Eb;var r='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-unauthorized-user"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Not Authorized</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">';return r+=n?n="<strong>"+ei(n)+"</strong> is not authorized to view the requested page.":"User is not authorized to view the requested page.",r+="</p>",e&&(r+='<p class="firebaseui-text firebaseui-id-unauthorized-user-admin-email">'+(e="Please contact <strong>"+ei(e)+"</strong> for authorization.")+"</p>"),r+='</div><div class="firebaseui-card-actions"><div class="firebaseui-form-links">',t&&(r+='<a class="firebaseui-link firebaseui-id-unauthorized-user-help-link" href="javascript:void(0)" target="_blank">Learn More</a>'),r+='</div><div class="firebaseui-form-actions">'+sl({label:ai("Back")})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",oi(r)}function Yl(t,e,i){return e="",e+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-unsupported-provider"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">'+(t="To continue sign in with <strong>"+ei(t.email)+"</strong> on this device, you have to recover the password.")+'</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+sl(null)+Qa({label:ai("Recover password")})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",oi(e)}function Zl(t){var e="";return e+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-reset"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Reset your password</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">for <strong>'+ei(t.email)+"</strong></p>"+nl(function(t){function e(){}var i={label:ai("New password")};for(var n in e.prototype=t,t=new e,i)t[n]=i[n];return t}(t))+'</div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+el()+"</div></div></form></div>",oi(e)}function Kl(t){return t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-reset-success"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Password changed</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">You can now sign in with your new password</p></div><div class="firebaseui-card-actions">'+((t=t||{}).G?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",oi(t)}function Jl(t){return t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-reset-failure"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Try resetting your password again</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Your request to reset your password has expired or the link has already been used</p></div><div class="firebaseui-card-actions">'+((t=t||{}).G?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",oi(t)}function Ql(t){var e=t.G,i="";return i+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-change-revoke-success"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Updated email address</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">'+(t="Your sign-in email address has been changed back to <strong>"+ei(t.email)+"</strong>.")+'</p><p class="firebaseui-text">If you didnt ask to change your sign-in email, its possible someone is trying to access your account and you should <a class="firebaseui-link firebaseui-id-reset-password-link" href="javascript:void(0)">change your password right away</a>.</p></div><div class="firebaseui-card-actions">'+(e?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></form></div>",oi(i)}function tc(t){return t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-change-revoke-failure"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Unable to update your email address</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">There was a problem changing your sign-in email back.</p><p class="firebaseui-text">If you try again and still cant reset your email, try asking your administrator for help.</p></div><div class="firebaseui-card-actions">'+((t=t||{}).G?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",oi(t)}function ec(t){return t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-verification-success"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Your email has been verified</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">You can now sign in with your new account</p></div><div class="firebaseui-card-actions">'+((t=t||{}).G?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",oi(t)}function ic(t){return t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-verification-failure"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Try verifying your email again</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Your request to verify your email has expired or the link has already been used</p></div><div class="firebaseui-card-actions">'+((t=t||{}).G?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",oi(t)}function nc(t){var e=t.G,i="";return i+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-verify-and-change-email-success"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Your email has been verified and changed</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">'+(t="You can now sign in with your new email <strong>"+ei(t.email)+"</strong>.")+'</p></div><div class="firebaseui-card-actions">'+(e?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",oi(i)}function rc(t){return t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-verify-and-change-email-failure"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Try updating your email again</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Your request to verify and update your email has expired or the link has already been used.</p></div><div class="firebaseui-card-actions">'+((t=t||{}).G?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",oi(t)}function oc(t){var e=t.factorId,i=t.phoneNumber;t=t.G;var n='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-revert-second-factor-addition-success"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Removed second factor</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">';return n+="phone"===e?e="The <strong>"+ei(e)+" "+ei(i)+"</strong> was removed as a second authentication step.":"The device or app was removed as a second authentication step.",n+='</p><p class="firebaseui-text">If you don\'t recognize this device, someone might be trying to access your account. Consider <a class="firebaseui-link firebaseui-id-reset-password-link" href="javascript:void(0)">changing your password right away</a>.</p></div><div class="firebaseui-card-actions">'+(t?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></form></div>",oi(n)}function sc(t){return t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-revert-second-factor-addition-failure"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Couldn\'t remove your second factor</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Something went wrong removing your second factor.</p><p class="firebaseui-text">Try removing it again. If that doesn\'t work, contact support for assistance.</p></div><div class="firebaseui-card-actions">'+((t=t||{}).G?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",oi(t)}function ac(t){var e=t.zb;return t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-recoverable-error"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Error encountered</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">'+ei(t.errorMessage)+'</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">',e&&(t+=Qa({label:ai("Retry")})),oi(t+"</div></div></div>")}function lc(t){return t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-unrecoverable-error"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Error encountered</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">'+ei(t.errorMessage)+"</p></div></div>",oi(t)}function cc(t,e,i){var n=t.Qb;return e="",e+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-mismatch"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content"><h2 class="firebaseui-subtitle">'+(t="Continue with "+ei(t.jc)+"?")+'</h2><p class="firebaseui-text">'+(n="You originally wanted to sign in with "+ei(n))+'</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+sl(null)+Qa({label:ai("Continue")})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",oi(e)}function uc(t,e,i){var n='<div class="firebaseui-container firebaseui-page-provider-sign-in firebaseui-id-page-provider-sign-in firebaseui-use-spinner"><div class="firebaseui-card-content"><form onsubmit="return false;"><ul class="firebaseui-idp-list">';e=(t=t.Sb).length;for(var r=0;r<e;r++){var o={ga:t[r]},s=i,a=(o=o||{}).ga,l=o,c="";switch((l=l||{}).ga.providerId){case"google.com":c+="firebaseui-idp-google";break;case"github.com":c+="firebaseui-idp-github";break;case"facebook.com":c+="firebaseui-idp-facebook";break;case"twitter.com":c+="firebaseui-idp-twitter";break;case"phone":c+="firebaseui-idp-phone";break;case"anonymous":c+="firebaseui-idp-anonymous";break;case"password":c+="firebaseui-idp-password";break;default:c+="firebaseui-idp-generic"}l=(l='<button class="firebaseui-idp-button mdl-button mdl-js-button mdl-button--raised '+ci(ri(c))+' firebaseui-id-idp-button" data-provider-id="'+ci(a.providerId)+'" style="background-color:')+ci(hi(ri((c=(c=(c=o)||{}).ga).ta?c.ta:s.wa[c.providerId]?""+s.wa[c.providerId]:0==c.providerId.indexOf("saml.")?""+s.wa.saml:0==c.providerId.indexOf("oidc.")?""+s.wa.oidc:""+s.wa.password)))+'"><span class="firebaseui-idp-icon-wrapper"><img class="firebaseui-idp-icon" alt="" src="';var u=o;c=s,u=(u=u||{}).ga,c=si(u.za?ui(u.za):c.xa[u.providerId]?ui(c.xa[u.providerId]):0==u.providerId.indexOf("saml.")?ui(c.xa.saml):0==u.providerId.indexOf("oidc.")?ui(c.xa.oidc):ui(c.xa.password)),l=l+ci(ui(c))+'"></span>',"password"==a.providerId?(l+='<span class="firebaseui-idp-text firebaseui-idp-text-long">',a.V?l+=ei(a.V):a.S?l+=o="Sign in with "+ei(fl(o,s)):l+="Sign in with email",l+='</span><span class="firebaseui-idp-text firebaseui-idp-text-short">',l=a.S?l+ei(a.S):l+"Email",l+="</span>"):"phone"==a.providerId?(l+='<span class="firebaseui-idp-text firebaseui-idp-text-long">',a.V?l+=ei(a.V):a.S?l+=o="Sign in with "+ei(fl(o,s)):l+="Sign in with phone",l+='</span><span class="firebaseui-idp-text firebaseui-idp-text-short">',l=a.S?l+ei(a.S):l+"Phone",l+="</span>"):"anonymous"==a.providerId?(l+='<span class="firebaseui-idp-text firebaseui-idp-text-long">',a.V?l+=ei(a.V):a.S?l+=o="Sign in with "+ei(fl(o,s)):l+="Continue as guest",l+='</span><span class="firebaseui-idp-text firebaseui-idp-text-short">',l=a.S?l+ei(a.S):l+"Guest",l+="</span>"):(l+='<span class="firebaseui-idp-text firebaseui-idp-text-long">',a.V?l+=ei(a.V):l+=c="Sign in with "+ei(fl(o,s)),l+='</span><span class="firebaseui-idp-text firebaseui-idp-text-short">'+(a.S?ei(a.S):ei(fl(o,s)))+"</span>"),n+='<li class="firebaseui-list-item">'+(a=oi(l+"</button>"))+"</li>"}return n+='</ul></form></div><div class="firebaseui-card-footer firebaseui-provider-sign-in-footer">'+ll(i)+"</div></div>",oi(n)}function hc(t,e,i){var n,r=(t=t||{}).Gb,o=t.Va;return e=t.ia,t='<div class="firebaseui-phone-number"><button class="firebaseui-id-country-selector firebaseui-country-selector mdl-button mdl-js-button"><span class="firebaseui-flag firebaseui-country-selector-flag firebaseui-id-country-selector-flag"></span><span class="firebaseui-id-country-selector-code"></span></button><div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label firebaseui-textfield firebaseui-phone-input-wrapper"><label class="mdl-textfield__label firebaseui-label" for="ui-sign-in-phone-number-input">Phone number</label><input type="tel" name="phoneNumber" id="ui-sign-in-phone-number-input" class="mdl-textfield__input firebaseui-input firebaseui-id-phone-number" value="'+ci(null!=(t=(t=t||{}).Aa)?t:"")+'"></div></div><div class="firebaseui-error-wrapper"><p class="firebaseui-error firebaseui-text-input-error firebaseui-hidden firebaseui-phone-number-error firebaseui-id-phone-number-error"></p></div>',n=(t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-phone-sign-in-start"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Enter your phone number</h1></div><div class="firebaseui-card-content"><div class="firebaseui-relative-wrapper">'+oi(t))+(n=r?oi('<div class="firebaseui-recaptcha-wrapper"><div class="firebaseui-recaptcha-container"></div><div class="firebaseui-error-wrapper firebaseui-recaptcha-error-wrapper"><p class="firebaseui-error firebaseui-hidden firebaseui-id-recaptcha-error"></p></div></div>'):"")+'</div></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+(o?sl(null):"")+Qa({label:ai("Verify")})+'</div></div><div class="firebaseui-card-footer">',e?(e='<p class="firebaseui-tos firebaseui-phone-tos">',e=i.F&&i.D?e+'By tapping Verify, you are indicating that you accept our <a href="javascript:void(0)" class="firebaseui-link firebaseui-tos-link" target="_blank">Terms of Service</a> and <a href="javascript:void(0)" class="firebaseui-link firebaseui-pp-link" target="_blank">Privacy Policy</a>. An SMS may be sent. Message &amp; data rates may apply.':e+"By tapping Verify, an SMS may be sent. Message &amp; data rates may apply.",i=oi(e+"</p>")):i=oi('<p class="firebaseui-tos firebaseui-phone-sms-notice">By tapping Verify, an SMS may be sent. Message &amp; data rates may apply.</p>')+al(i),oi(n+i+"</div></form></div>")}function dc(t,e,i){var n="";return t='Enter the 6-digit code we sent to <a class="firebaseui-link firebaseui-change-phone-number-link firebaseui-id-change-phone-number-link" href="javascript:void(0)">&lrm;'+ei(e=(t=t||{}).phoneNumber)+"</a>",ei(e),e=n,i='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-phone-sign-in-finish"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Verify your phone number</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">'+t+"</p>"+(n=oi('<div class="firebaseui-textfield mdl-textfield mdl-js-textfield mdl-textfield--floating-label"><label class="mdl-textfield__label firebaseui-label" for="ui-sign-in-phone-confirmation-code-input">6-digit code</label><input type="number" name="phoneConfirmationCode" id="ui-sign-in-phone-confirmation-code-input" class="mdl-textfield__input firebaseui-input firebaseui-id-phone-confirmation-code"></div><div class="firebaseui-error-wrapper"><p class="firebaseui-error firebaseui-text-input-error firebaseui-hidden firebaseui-id-phone-confirmation-code-error"></p></div>'))+'</div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+sl(null)+Qa({label:ai("Continue")})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form>",t=oi('<div class="firebaseui-resend-container"><span class="firebaseui-id-resend-countdown"></span><a href="javascript:void(0)" class="firebaseui-id-resend-link firebaseui-hidden firebaseui-link">Resend</a></div>'),oi(e+(i+t+"</div>"))}function pc(){return oi('<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-sign-out"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign Out</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">You are now successfully signed out.</p></div></div>')}function fc(t,e,i){var n='<div class="firebaseui-container firebaseui-page-select-tenant firebaseui-id-page-select-tenant"><div class="firebaseui-card-content"><form onsubmit="return false;"><ul class="firebaseui-tenant-list">';e=(t=t.ec).length;for(var r=0;r<e;r++){var o=t[r],s="",a=ei(o.displayName),l=o.tenantId?o.tenantId:"top-level-project";s+='<button class="firebaseui-tenant-button mdl-button mdl-js-button mdl-button--raised firebaseui-tenant-selection-'+ci(l=ai(l))+' firebaseui-id-tenant-selection-button"'+(o.tenantId?'data-tenant-id="'+ci(o.tenantId)+'"':"")+'style="background-color:'+ci(hi(o.ta))+'"><span class="firebaseui-idp-icon-wrapper"><img class="firebaseui-idp-icon" alt="" src="'+ci(ui(o.za))+'"></span><span class="firebaseui-idp-text firebaseui-idp-text-long">',o.V?s+=ei(o.V):s+=o="Sign in to "+ei(o.displayName),n+='<li class="firebaseui-list-item">'+(s=oi(s+'</span><span class="firebaseui-idp-text firebaseui-idp-text-short">'+a+"</span></button>"))+"</li>"}return n+='</ul></form></div><div class="firebaseui-card-footer firebaseui-provider-sign-in-footer">'+ll(i)+"</div></div>",oi(n)}function mc(t,e,i){return t='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-provider-match-by-email"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content"><div class="firebaseui-relative-wrapper">'+Ja(null)+'</div></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+Qa(null)+'</div></div><div class="firebaseui-card-footer">'+ll(i)+"</div></form></div>",oi(t)}function gc(){return ja(this,"firebaseui-id-submit")}function _c(){return ja(this,"firebaseui-id-secondary-link")}function yc(t,e){$a(this,gc.call(this),(function(e){t(e)}));var i=_c.call(this);i&&e&&$a(this,i,(function(t){e(t)}))}function vc(){return ja(this,"firebaseui-id-password")}function xc(){return ja(this,"firebaseui-id-password-error")}function bc(){var t=vc.call(this),e=xc.call(this);qa(this,t,(function(){Ka(e)&&(Wa(t,!0),Ya(e))}))}function wc(){var t=vc.call(this),e=xc.call(this);return la(t)?(Wa(t,!0),Ya(e),e=!0):(Wa(t,!1),Za(e,ri("Enter your password").toString()),e=!1),e?la(t):null}function Ec(t,e,i,n,r,o){Il.call(this,Hl,{email:t},o,"passwordLinking",{F:n,D:r}),this.w=e,this.H=i}D(Ml,zi),D(Il,Va),(t=Il.prototype).kb=function(){var t=Ke(this.fb,this.eb,this.Z,this.s);ml(t),this.g=t},t.v=function(){if(Il.K.v.call(this),fn(Cl(this),new Ml("pageEnter",Cl(this),{pageId:this.Ga})),this.bb()&&this.Z.F){var t=this.Z.F;$a(this,this.bb(),(function(){t()}))}if(this.ab()&&this.Z.D){var e=this.Z.D;$a(this,this.ab(),(function(){e()}))}},t.ya=function(){fn(Cl(this),new Ml("pageExit",Cl(this),{pageId:this.Ga})),Il.K.ya.call(this)},t.o=function(){window.clearTimeout(this.ca),this.eb=this.fb=this.ca=null,this.Fa=!1,this.A=null,gl(this.N()),Il.K.o.call(this)},t.I=function(t,e,i,n){function r(){if(o.T)return null;o.Fa=!1,window.clearTimeout(o.ca),o.ca=null,o.A&&(gl(o.A),Ve(o.A),o.A=null)}var o=this;return o.Fa?null:(function(t){t.Fa=!0;var e=oa(t.N(),"firebaseui-use-spinner");t.ca=window.setTimeout((function(){t.N()&&null===t.A&&(t.A=Ke(pl,{tb:e},null,t.s),t.N().appendChild(t.A),ml(t.A))}),500)}(o),t.apply(null,e).then(i,n).then(r,r))},A(Il.prototype,{a:function(t){wl.call(this);var e=Ke(cl,{message:t},null,this.s);this.N().appendChild(e),$a(this,Sl.call(this),(function(){Ve(e)}))},yc:wl,Ac:El,zc:Sl,$:function(t,e){t=Ke(hl,{Ma:t,message:e},null,this.s),vl.call(this,t)},h:xl,Cb:bl,Cc:function(){return ja(this,"firebaseui-tos")},bb:function(){return ja(this,"firebaseui-tos-link")},ab:function(){return ja(this,"firebaseui-pp-link")},Dc:function(){return ja(this,"firebaseui-tos-list")}}),Ll.a="firebaseui.auth.soy2.page.signIn",Rl.a="firebaseui.auth.soy2.page.passwordSignIn",Dl.a="firebaseui.auth.soy2.page.passwordSignUp",kl.a="firebaseui.auth.soy2.page.passwordRecovery",Nl.a="firebaseui.auth.soy2.page.passwordRecoveryEmailSent",Ol.a="firebaseui.auth.soy2.page.callback",Fl.a="firebaseui.auth.soy2.page.spinner",zl.a="firebaseui.auth.soy2.page.blank",Bl.a="firebaseui.auth.soy2.page.emailLinkSignInSent",Ul.a="firebaseui.auth.soy2.page.emailNotReceived",Vl.a="firebaseui.auth.soy2.page.emailLinkSignInConfirmation",jl.a="firebaseui.auth.soy2.page.differentDeviceError",Gl.a="firebaseui.auth.soy2.page.anonymousUserMismatch",Hl.a="firebaseui.auth.soy2.page.passwordLinking",Wl.a="firebaseui.auth.soy2.page.emailLinkSignInLinking",ql.a="firebaseui.auth.soy2.page.emailLinkSignInLinkingDifferentDevice",Xl.a="firebaseui.auth.soy2.page.federatedLinking",$l.a="firebaseui.auth.soy2.page.unauthorizedUser",Yl.a="firebaseui.auth.soy2.page.unsupportedProvider",Zl.a="firebaseui.auth.soy2.page.passwordReset",Kl.a="firebaseui.auth.soy2.page.passwordResetSuccess",Jl.a="firebaseui.auth.soy2.page.passwordResetFailure",Ql.a="firebaseui.auth.soy2.page.emailChangeRevokeSuccess",tc.a="firebaseui.auth.soy2.page.emailChangeRevokeFailure",ec.a="firebaseui.auth.soy2.page.emailVerificationSuccess",ic.a="firebaseui.auth.soy2.page.emailVerificationFailure",nc.a="firebaseui.auth.soy2.page.verifyAndChangeEmailSuccess",rc.a="firebaseui.auth.soy2.page.verifyAndChangeEmailFailure",oc.a="firebaseui.auth.soy2.page.revertSecondFactorAdditionSuccess",sc.a="firebaseui.auth.soy2.page.revertSecondFactorAdditionFailure",ac.a="firebaseui.auth.soy2.page.recoverableError",lc.a="firebaseui.auth.soy2.page.unrecoverableError",cc.a="firebaseui.auth.soy2.page.emailMismatch",uc.a="firebaseui.auth.soy2.page.providerSignIn",hc.a="firebaseui.auth.soy2.page.phoneSignInStart",dc.a="firebaseui.auth.soy2.page.phoneSignInFinish",pc.a="firebaseui.auth.soy2.page.signOut",fc.a="firebaseui.auth.soy2.page.selectTenant",mc.a="firebaseui.auth.soy2.page.providerMatchByEmail",a(Ec,Il),Ec.prototype.v=function(){this.P(),this.M(this.w,this.H),Pl(this,this.i(),this.w),this.i().focus(),Il.prototype.v.call(this)},Ec.prototype.o=function(){this.w=null,Il.prototype.o.call(this)},Ec.prototype.j=function(){return la(ja(this,"firebaseui-id-email"))},A(Ec.prototype,{i:vc,B:xc,P:bc,u:wc,ea:gc,ba:_c,M:yc});var Sc=/^[+a-zA-Z0-9_.!#$%&'*\/=?^`{|}~-]+@([a-zA-Z0-9-]+\.)+[a-zA-Z0-9]{2,63}$/;function Tc(){return ja(this,"firebaseui-id-email")}function Mc(){return ja(this,"firebaseui-id-email-error")}function Ic(t){var e=Tc.call(this),i=Mc.call(this);qa(this,e,(function(){Ka(i)&&(Wa(e,!0),Ya(i))})),t&&Xa(this,e,(function(){t()}))}function Cc(){return $(la(Tc.call(this))||"")}function Ac(){var t=Tc.call(this),e=Mc.call(this),i=la(t)||"";return i?Sc.test(i)?(Wa(t,!0),Ya(e),e=!0):(Wa(t,!1),Za(e,ri("That email address isn't correct").toString()),e=!1):(Wa(t,!1),Za(e,ri("Enter your email address to continue").toString()),e=!1),e?$(la(t)):null}function Pc(t,e,i,n,r,o,s){Il.call(this,Rl,{email:i,ia:!!o},s,"passwordSignIn",{F:n,D:r}),this.w=t,this.H=e}function Lc(t,e,i,n,r,o){Il.call(this,t,e,n,r||"notice",o),this.i=i||null}function Rc(t,e,i,n,r){Lc.call(this,Nl,{email:t,G:!!e},e,r,"passwordRecoveryEmailSent",{F:i,D:n})}function Dc(t,e){Lc.call(this,ec,{G:!!t},t,e,"emailVerificationSuccess")}function kc(t,e){Lc.call(this,ic,{G:!!t},t,e,"emailVerificationFailure")}function Nc(t,e,i){Lc.call(this,nc,{email:t,G:!!e},e,i,"verifyAndChangeEmailSuccess")}function Oc(t,e){Lc.call(this,rc,{G:!!t},t,e,"verifyAndChangeEmailFailure")}function Fc(t,e){Lc.call(this,sc,{G:!!t},t,e,"revertSecondFactorAdditionFailure")}function zc(t){Lc.call(this,pc,void 0,void 0,t,"signOut")}function Bc(t,e){Lc.call(this,Kl,{G:!!t},t,e,"passwordResetSuccess")}function Uc(t,e){Lc.call(this,Jl,{G:!!t},t,e,"passwordResetFailure")}function Vc(t,e){Lc.call(this,tc,{G:!!t},t,e,"emailChangeRevokeFailure")}function jc(t,e,i){Lc.call(this,ac,{errorMessage:t,zb:!!e},e,i,"recoverableError")}function Gc(t,e){Lc.call(this,lc,{errorMessage:t},void 0,e,"unrecoverableError")}function Hc(t){if("auth/invalid-credential"===t.code&&t.message&&-1!==t.message.indexOf("error=consent_required"))return{code:"auth/user-cancelled"};if(t.message&&-1!==t.message.indexOf("HTTP Cloud Function returned an error:")){var e=JSON.parse(t.message.substring(t.message.indexOf("{"),t.message.lastIndexOf("}")+1));return{code:t.code,message:e&&e.error&&e.error.message||t.message}}return t}function Wc(t,e,i,n){function r(i){if(!i.name||"cancel"!=i.name){t:{var n=i.message;try{var r=((JSON.parse(n).error||{}).message||"").toLowerCase().match(/invalid.+(access|id)_token/);if(r&&r.length){var o=!0;break t}}catch(t){}o=!1}if(o)i=Cl(e),e.m(),Jc(t,i,void 0,ri("Your sign-in session has expired. Please try again.").toString());else{if(o=i&&i.message||"",i.code){if("auth/email-already-in-use"==i.code||"auth/credential-already-in-use"==i.code)return;o=$c(i)}e.a(o)}}}if(wh(t),n)return qc(t,i),zn();if(!i.credential)throw Error("No credential found!");if(!dh(t).currentUser&&!i.user)throw Error("User not logged in.");try{var o=function(t,e){return Th(t),vh(t,(function(i){if(t.j&&!t.j.isAnonymous&&bs(Sh(t))&&!dh(t).currentUser)return Ih(t).then((function(){return"password"==e.credential.providerId&&(e.credential=null),e}));if(i)return Ih(t).then((function(){return i.linkWithCredential(e.credential)})).then((function(t){return e.user=t.user,e.credential=t.credential,e.operationType=t.operationType,e.additionalUserInfo=t.additionalUserInfo,e}),(function(i){if(i&&"auth/email-already-in-use"==i.code&&i.email&&i.credential)throw i;return Ch(t,i,e.credential)}));if(!e.user)throw Error('Internal error: An incompatible or outdated version of "firebase.js" may be used.');return Ih(t).then((function(){return ph(t).updateCurrentUser(e.user)})).then((function(){return e.user=ph(t).currentUser,e.operationType="signIn",e.credential&&e.credential.providerId&&"password"==e.credential.providerId&&(e.credential=null),e}))}))}(t,i)}catch(t){return Ur(t.code||t.message,t),e.a(t.code||t.message),zn()}return i=o.then((function(e){qc(t,e)}),r).then(void 0,r),bh(t,o),zn(i)}function qc(t,e){if(!e.user)throw Error("No user found");var i=Vs(Sh(t));if(Us(Sh(t))&&i&&Hr("Both signInSuccess and signInSuccessWithAuthResult callbacks are provided. Only signInSuccessWithAuthResult callback will be invoked."),i){i=Vs(Sh(t));var n=Xo(fh(t))||void 0;Wo(Vo,fh(t));var r=!1;Kn()?(i&&!i(e,n)||(r=!0,Re(window.opener.location,Xc(t,n))),i||window.close()):i&&!i(e,n)||(r=!0,Re(window.location,Xc(t,n))),r||t.reset()}else{i=e.user,e=e.credential,n=Us(Sh(t)),r=Xo(fh(t))||void 0,Wo(Vo,fh(t));var o=!1;Kn()?(n&&!n(i,e,r)||(o=!0,Re(window.opener.location,Xc(t,r))),n||window.close()):n&&!n(i,e,r)||(o=!0,Re(window.location,Xc(t,r))),o||t.reset()}}function Xc(t,e){if(!(t=e||Sh(t).a.get("signInSuccessUrl")))throw Error("No redirect URL has been found. You must either specify a signInSuccessUrl in the configuration, pass in a redirect URL to the widget URL, or return false from the callback.");return t}function $c(t){var e={code:t.code},i="";switch((e=e||{}).code){case"auth/email-already-in-use":i+="The email address is already used by another account";break;case"auth/requires-recent-login":case"auth/user-token-expired":i+=ri("Please login again to perform this operation");break;case"auth/too-many-requests":i+="You have entered an incorrect password too many times. Please try again in a few minutes.";break;case"auth/user-cancelled":i+="Please authorize the required permissions to sign in to the application";break;case"auth/user-not-found":i+="That email address doesn't match an existing account";break;case"auth/weak-password":i+="Strong passwords have at least 6 characters and a mix of letters and numbers";break;case"auth/wrong-password":i+="The email and password you entered don't match";break;case"auth/network-request-failed":i+="A network error has occurred";break;case"auth/invalid-phone-number":i+=wi();break;case"auth/invalid-verification-code":i+=ri("Wrong code. Try again.");break;case"auth/code-expired":i+="This code is no longer valid";break;case"auth/expired-action-code":i+="This code has expired.";break;case"auth/invalid-action-code":i+="The action code is invalid. This can happen if the code is malformed, expired, or has already been used."}if(e=ri(i).toString())return e;try{return JSON.parse(t.message),Ur("Internal error: "+t.message,void 0),Si().toString()}catch(e){return t.message}}function Yc(t,e,i,n){function r(){!function(t,e){qo(Uo,{tenantId:t.a},e)}(new Qr(t.h.tenantId||null),fh(t)),bh(t,e.I(I(t.dc,t),[l],(function(){if("file:"===(window.location&&window.location.protocol))return bh(t,ch(t).then((function(i){e.m(),Wo(Uo,fh(t)),na("callback",t,a,zn(i))}),o))}),s))}function o(n){if(Wo(Uo,fh(t)),!n.name||"cancel"!=n.name)switch(n=Hc(n),n.code){case"auth/popup-blocked":r();break;case"auth/popup-closed-by-user":case"auth/cancelled-popup-request":case"auth/credential-already-in-use":break;case"auth/network-request-failed":case"auth/too-many-requests":case"auth/user-cancelled":e.a($c(n));break;case"auth/admin-restricted-operation":e.m(),As(Sh(t))?na("handleUnauthorizedUser",t,a,null,i):na("callback",t,a,Bn(n));break;default:e.m(),na("callback",t,a,Bn(n))}}function s(i){Wo(Uo,fh(t)),i.name&&"cancel"==i.name||(Ur("signInWithRedirect: "+i.code,void 0),i=$c(i),"blank"==e.Ga&&zs(Sh(t))?(e.m(),na("providerSignIn",t,a,i)):e.a(i))}var a=Cl(e),l=function(t,e,i){var n=vs[e]&&Sd.auth[vs[e]]?new Sd.auth[vs[e]]:0==e.indexOf("saml.")?new Sd.auth.SAMLAuthProvider(e):new Sd.auth.OAuthProvider(e);if(!n)throw Error("Invalid Firebase Auth provider!");var r=Ps(Sh(t),e);if(n.addScope)for(var o=0;o<r.length;o++)n.addScope(r[o]);return r=Ls(Sh(t),e)||{},i&&(t=e==Sd.auth.GoogleAuthProvider.PROVIDER_ID?"login_hint":e==Sd.auth.GithubAuthProvider.PROVIDER_ID?"login":(t=Ts(Sh(t),e))&&t.Ob)&&(r[t]=i),n.setCustomParameters&&n.setCustomParameters(r),n}(t,i,n);Bs(Sh(t))==Ks?r():bh(t,function(t,e){return Th(t),vh(t,(function(i){return i&&!$o(fh(t))?i.linkWithPopup(e).then((function(t){return t}),(function(e){if(e&&"auth/email-already-in-use"==e.code&&e.email&&e.credential)throw e;return Ch(t,e)})):dh(t).signInWithPopup(e)}))}(t,l).then((function(i){e.m(),na("callback",t,a,zn(i))}),o))}function Zc(t){return 1==(t=Ss(Sh(t))).length&&t[0]==Sd.auth.EmailAuthProvider.PROVIDER_ID}function Kc(t){return 1==(t=Ss(Sh(t))).length&&t[0]==Sd.auth.PhoneAuthProvider.PROVIDER_ID}function Jc(t,e,i,n){Zc(t)?n?na("signIn",t,e,i,n):iu(t,e,i):t&&Kc(t)&&!n?na("phoneSignInStart",t,e):t&&zs(Sh(t))&&!n?na("federatedRedirect",t,e,i):na("providerSignIn",t,e,n,i)}function Qc(t,e,i,n){var r=Cl(e);bh(t,e.I(I(dh(t).fetchSignInMethodsForEmail,dh(t)),[i],(function(o){e.m(),tu(t,r,o,i,n)}),(function(t){t=$c(t),e.a(t)})))}function tu(t,e,i,n,r,o){i.length||Fs(Sh(t))&&!Fs(Sh(t))?j(i,Sd.auth.EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD)?na("passwordSignIn",t,e,n,o):1==i.length&&i[0]===Sd.auth.EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD?Fs(Sh(t))?na("sendEmailLinkForSignIn",t,e,n,(function(){na("signIn",t,e)})):na("unsupportedProvider",t,e,n):(i=_s(i,Ss(Sh(t))))?(Zo(new Zr(n),fh(t)),na("federatedSignIn",t,e,n,i,r)):na("unsupportedProvider",t,e,n):Cs(Sh(t))?na("handleUnauthorizedUser",t,e,n,Sd.auth.EmailAuthProvider.PROVIDER_ID):Fs(Sh(t))?na("sendEmailLinkForSignIn",t,e,n,(function(){na("signIn",t,e)})):na("passwordSignUp",t,e,n,void 0,void 0,o)}function eu(t,e,i,n,r,o){var s=Cl(e);bh(t,e.I(I(t.Ib,t),[i,o],(function(){e.m(),na("emailLinkSignInSent",t,s,i,n,o)}),r))}function iu(t,e,i){i?na("prefilledEmailSignIn",t,e,i):na("signIn",t,e)}function nu(){return _t(tr(),"oobCode")}function ru(){var t=_t(tr(),"continueUrl");return t?function(){Re(window.location,t)}:null}function ou(t,e){Il.call(this,Gl,void 0,e,"anonymousUserMismatch"),this.i=t}function su(t){Il.call(this,Ol,void 0,t,"callback")}function au(t,e,i){if(i.user){var n={user:i.user,credential:i.credential,operationType:i.operationType,additionalUserInfo:i.additionalUserInfo},r=$o(fh(t)),o=r&&r.g;if(o&&!function(t,e){if(e==t.email)return!0;if(t.providerData)for(var i=0;i<t.providerData.length;i++)if(e==t.providerData[i].email)return!0;return!1}(i.user,o))!function(t,e,i){var n=Cl(e);bh(t,Ih(t).then((function(){e.m(),na("emailMismatch",t,n,i)}),(function(t){t.name&&"cancel"==t.name||(t=$c(t.code),e.a(t))})))}(t,e,n);else{var s=r&&r.a;s?bh(t,i.user.linkWithCredential(s).then((function(i){n={user:i.user,credential:s,operationType:i.operationType,additionalUserInfo:i.additionalUserInfo},lu(t,e,n)}),(function(i){cu(t,e,i)}))):lu(t,e,n)}}else i=Cl(e),e.m(),Yo(fh(t)),Jc(t,i)}function lu(t,e,i){Yo(fh(t)),Wc(t,e,i)}function cu(t,e,i){var n=Cl(e);Yo(fh(t)),i=$c(i),e.m(),Jc(t,n,void 0,i)}function uu(t,e,i,n){var r=Cl(e);bh(t,dh(t).fetchSignInMethodsForEmail(i).then((function(o){e.m(),o.length?j(o,Sd.auth.EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD)?na("passwordLinking",t,r,i):1==o.length&&o[0]===Sd.auth.EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD?na("emailLinkSignInLinking",t,r,i):(o=_s(o,Ss(Sh(t))))?na("federatedLinking",t,r,i,o,n):(Yo(fh(t)),na("unsupportedProvider",t,r,i)):(Yo(fh(t)),na("passwordRecovery",t,r,i,!1,Ti().toString()))}),(function(i){cu(t,e,i)})))}function hu(t,e){Il.call(this,jl,void 0,e,"differentDeviceError"),this.i=t}function du(t,e,i,n){Il.call(this,Ql,{email:t,G:!!i},n,"emailChangeRevoke"),this.l=e,this.i=i||null}function pu(){return ja(this,"firebaseui-id-new-password")}function fu(){return ja(this,"firebaseui-id-password-toggle")}function mu(){this.Ra=!this.Ra;var t=fu.call(this),e=pu.call(this);this.Ra?(e.type="text",sa(t,"firebaseui-input-toggle-off"),aa(t,"firebaseui-input-toggle-on")):(e.type="password",sa(t,"firebaseui-input-toggle-on"),aa(t,"firebaseui-input-toggle-off")),e.focus()}function gu(){return ja(this,"firebaseui-id-new-password-error")}function _u(){this.Ra=!1;var t=pu.call(this);t.type="password";var e=gu.call(this);qa(this,t,(function(){Ka(e)&&(Wa(t,!0),Ya(e))}));var i=fu.call(this);sa(i,"firebaseui-input-toggle-on"),aa(i,"firebaseui-input-toggle-off"),function(t,e,i){Ri(t,C(Di,e=new _a(e))),wa(Ga(t),e,"focusin",i)}(this,t,(function(){sa(i,"firebaseui-input-toggle-focus"),aa(i,"firebaseui-input-toggle-blur")})),function(t,e,i){Ri(t,C(Di,e=new _a(e))),wa(Ga(t),e,"focusout",i)}(this,t,(function(){sa(i,"firebaseui-input-toggle-blur"),aa(i,"firebaseui-input-toggle-focus")})),$a(this,i,I(mu,this))}function yu(){var t=pu.call(this),e=gu.call(this);return la(t)?(Wa(t,!0),Ya(e),e=!0):(Wa(t,!1),Za(e,ri("Enter your password").toString()),e=!1),e?la(t):null}function vu(t,e,i){Il.call(this,Zl,{email:t},i,"passwordReset"),this.l=e}function xu(t,e,i,n,r){Il.call(this,oc,{factorId:t,phoneNumber:i||null,G:!!n},r,"revertSecondFactorAdditionSuccess"),this.l=e,this.i=n||null}function bu(t,e,i,n){"auth/weak-password"==(n&&n.code)?(t=$c(n),Wa(i.i(),!1),Za(i.w(),t),i.i().focus()):(i&&i.m(),(i=new Uc).render(e),uh(t,i))}function wu(t,e){try{var i="number"==typeof t.selectionStart}catch(t){i=!1}i?(t.selectionStart=e,t.selectionEnd=e):Zt&&!ce("9")&&("textarea"==t.type&&(e=t.value.substring(0,e).replace(/(\r\n|\r|\n)/g,"\n").length),(t=t.createTextRange()).collapse(!0),t.move("character",e),t.select())}function Eu(t,e,i,n,r,o){Il.call(this,Vl,{email:i},o,"emailLinkSignInConfirmation",{F:n,D:r}),this.l=t,this.u=e}function Su(t,e,i,n,r){Il.call(this,ql,{ga:t},r,"emailLinkSignInLinkingDifferentDevice",{F:i,D:n}),this.i=e}function Tu(t){Il.call(this,zl,void 0,t,"blank")}function Mu(t,e,i,n,r){var o=new Tu,s=new zt(i),a=s.a.a.get(jt.$a)||"",l=s.a.a.get(jt.Sa)||"",c="1"===s.a.a.get(jt.Qa),u=Bt(s),h=s.a.a.get(jt.PROVIDER_ID)||null;s=s.a.a.get(jt.vb)||null,Eh(t,s);var d=!Ho(jo,fh(t)),p=n||function(t,e){var i=null;if(e=Ho(jo,e))try{var n=wo(t,e),r=JSON.parse(n);i=r&&r.email||null}catch(t){}return i}(l,fh(t)),f=(n=function(t,e){var i=null;if(e=Ho(Go,e))try{var n=wo(t,e);i=JSON.parse(n)}catch(t){}return Jr(i||null)}(l,fh(t)))&&n.a;h&&f&&f.providerId!==h&&(f=null),o.render(e),uh(t,o),bh(t,o.I((function(){var e=zn(null);e=u&&d||d&&c?Bn(Error("anonymous-user-not-found")):function(t,e){var i=Bt(new zt(e));return i?(e=new Ln((function(e,n){var r=ph(t).onAuthStateChanged((function(t){r(),t&&t.isAnonymous&&t.uid===i?e(t):t&&t.isAnonymous&&t.uid!==i?n(Error("anonymous-user-mismatch")):n(Error("anonymous-user-not-found"))}));bh(t,r)})),bh(t,e),e):zn(null)}(t,i).then((function(t){if(h&&!f)throw Error("pending-credential-not-found");return t}));var n=null;return e.then((function(e){return n=e,r?null:dh(t).checkActionCode(a)})).then((function(){return n}))}),[],(function(n){p?function(t,e,i,n,r,o){var s=Cl(e);e.$("mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active firebaseui-progress-dialog-loading-icon",ri("Signing in...").toString());var a=null;r=(o?function(t,e,i,n,r){Th(t);var o=r||null,s=Sd.auth.EmailAuthProvider.credentialWithLink(i,n);return i=o?dh(t).signInWithEmailLink(i,n).then((function(t){return t.user.linkWithCredential(o)})).then((function(){return Ih(t)})).then((function(){return Ch(t,{code:"auth/email-already-in-use"},o)})):dh(t).fetchSignInMethodsForEmail(i).then((function(i){return i.length?Ch(t,{code:"auth/email-already-in-use"},s):e.linkWithCredential(s)})),bh(t,i),i}(t,o,i,n,r):function(t,e,i,n){Th(t);var r,o=n||null;return e=dh(t).signInWithEmailLink(e,i).then((function(t){if(r={user:t.user,credential:null,operationType:t.operationType,additionalUserInfo:t.additionalUserInfo},o)return t.user.linkWithCredential(o).then((function(t){r={user:t.user,credential:o,operationType:r.operationType,additionalUserInfo:t.additionalUserInfo}}))})).then((function(){Ih(t)})).then((function(){return ph(t).updateCurrentUser(r.user)})).then((function(){return r.user=ph(t).currentUser,r})),bh(t,e),e}(t,i,n,r)).then((function(i){Wo(Go,fh(t)),Wo(jo,fh(t)),e.h(),e.$("firebaseui-icon-done",ri("Signed in!").toString()),a=setTimeout((function(){e.h(),Wc(t,e,i,!0)}),1e3),bh(t,(function(){e&&(e.h(),e.m()),clearTimeout(a)}))}),(function(r){if(e.h(),e.m(),!r.name||"cancel"!=r.name){var o=$c(r=Hc(r));"auth/email-already-in-use"==r.code||"auth/credential-already-in-use"==r.code?(Wo(Go,fh(t)),Wo(jo,fh(t))):"auth/invalid-email"==r.code?(o=ri("The email provided does not match the current sign-in session.").toString(),na("emailLinkConfirmation",t,s,n,Iu,null,o)):Jc(t,s,i,o)}})),bh(t,r)}(t,o,p,i,f,n):c?(o.m(),na("differentDeviceError",t,e)):(o.m(),na("emailLinkConfirmation",t,e,i,Iu))}),(function(n){var r=void 0;if(!n||!n.name||"cancel"!=n.name)switch(o.m(),n&&n.message){case"anonymous-user-not-found":na("differentDeviceError",t,e);break;case"anonymous-user-mismatch":na("anonymousUserMismatch",t,e);break;case"pending-credential-not-found":na("emailLinkNewDeviceLinking",t,e,i,Cu);break;default:n&&(r=$c(n)),Jc(t,e,void 0,r)}})))}function Iu(t,e,i,n){Mu(t,e,n,i,!0)}function Cu(t,e,i){Mu(t,e,i)}function Au(t,e,i,n,r,o){Il.call(this,Wl,{email:t,ga:e},o,"emailLinkSignInLinking",{F:n,D:r}),this.i=i}function Pu(t,e,i,n,r,o){Il.call(this,Bl,{email:t},o,"emailLinkSignInSent",{F:n,D:r}),this.u=e,this.i=i}function Lu(t,e,i,n,r,o,s){Il.call(this,cc,{jc:t,Qb:e},s,"emailMismatch",{F:r,D:o}),this.l=i,this.i=n}function Ru(t,e,i,n,r){Il.call(this,Ul,void 0,r,"emailNotReceived",{F:i,D:n}),this.l=t,this.i=e}function Du(t,e,i,n,r,o){Il.call(this,Xl,{email:t,ga:e},o,"federatedLinking",{F:n,D:r}),this.i=i}function ku(t,e,i,n,r,o){Il.call(this,kl,{email:i,Ta:!!e},o,"passwordRecovery",{F:n,D:r}),this.l=t,this.u=e}function Nu(){return ja(this,"firebaseui-id-name")}function Ou(){return ja(this,"firebaseui-id-name-error")}function Fu(t,e,i,n,r,o,s,a,l){Il.call(this,Dl,{email:n,Tb:t,name:r,Ta:!!i,ia:!!a},l,"passwordSignUp",{F:o,D:s}),this.w=e,this.H=i,this.B=t}function zu(){return ja(this,"firebaseui-id-phone-confirmation-code")}function Bu(){return ja(this,"firebaseui-id-phone-confirmation-code-error")}function Uu(){return ja(this,"firebaseui-id-resend-countdown")}function Vu(t,e,i,n,r,o,s,a,l){Il.call(this,dc,{phoneNumber:r},l,"phoneSignInFinish",{F:s,D:a}),this.jb=o,this.i=new ya(1e3),this.B=o,this.P=t,this.l=e,this.H=i,this.M=n}a(Pc,Il),Pc.prototype.v=function(){this.P(),this.ea(),this.ba(this.w,this.H),Al(this,this.l(),this.i()),Pl(this,this.i(),this.w),la(this.l())?this.i().focus():this.l().focus(),Il.prototype.v.call(this)},Pc.prototype.o=function(){this.H=this.w=null,Il.prototype.o.call(this)},A(Pc.prototype,{l:Tc,U:Mc,P:Ic,M:Cc,j:Ac,i:vc,B:xc,ea:bc,u:wc,ua:gc,pa:_c,ba:yc}),D(Lc,Il),Lc.prototype.v=function(){this.i&&(this.u(this.i),this.l().focus()),Lc.K.v.call(this)},Lc.prototype.o=function(){this.i=null,Lc.K.o.call(this)},A(Lc.prototype,{l:gc,w:_c,u:yc}),D(Rc,Lc),D(Dc,Lc),D(kc,Lc),D(Nc,Lc),D(Oc,Lc),D(Fc,Lc),D(zc,Lc),D(Bc,Lc),D(Uc,Lc),D(Vc,Lc),D(jc,Lc),D(Gc,Lc),a(ou,Il),ou.prototype.v=function(){var t=this;$a(this,this.l(),(function(){t.i()})),this.l().focus(),Il.prototype.v.call(this)},ou.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},A(ou.prototype,{l:_c}),ia.anonymousUserMismatch=function(t,e){var i=new ou((function(){i.m(),Jc(t,e)}));i.render(e),uh(t,i)},a(su,Il),su.prototype.I=function(t,e,i,n){return t.apply(null,e).then(i,n)},ia.callback=function(t,e,i){var n=new su;n.render(e),uh(t,n),i=i||ch(t),bh(t,i.then((function(e){au(t,n,e)}),(function(i){if((i=Hc(i))&&("auth/account-exists-with-different-credential"==i.code||"auth/email-already-in-use"==i.code)&&i.email&&i.credential)Zo(new Zr(i.email,i.credential),fh(t)),uu(t,n,i.email);else if(i&&"auth/user-cancelled"==i.code){var r=$o(fh(t)),o=$c(i);r&&r.a?uu(t,n,r.g,o):r?Qc(t,n,r.g,o):cu(t,n,i)}else i&&"auth/credential-already-in-use"==i.code||(i&&"auth/operation-not-supported-in-this-environment"==i.code&&Zc(t)?au(t,n,{user:null,credential:null}):i&&"auth/admin-restricted-operation"==i.code&&As(Sh(t))?(n.m(),Yo(fh(t)),na("handleUnauthorizedUser",t,e,null,null)):cu(t,n,i))})))},a(hu,Il),hu.prototype.v=function(){var t=this;$a(this,this.l(),(function(){t.i()})),this.l().focus(),Il.prototype.v.call(this)},hu.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},A(hu.prototype,{l:_c}),ia.differentDeviceError=function(t,e){var i=new hu((function(){i.m(),Jc(t,e)}));i.render(e),uh(t,i)},a(du,Il),du.prototype.v=function(){var t=this;$a(this,ja(this,"firebaseui-id-reset-password-link"),(function(){t.l()})),this.i&&(this.w(this.i),this.u().focus()),Il.prototype.v.call(this)},du.prototype.o=function(){this.l=this.i=null,Il.prototype.o.call(this)},A(du.prototype,{u:gc,B:_c,w:yc}),a(vu,Il),vu.prototype.v=function(){this.H(),this.B(this.l),Pl(this,this.i(),this.l),this.i().focus(),Il.prototype.v.call(this)},vu.prototype.o=function(){this.l=null,Il.prototype.o.call(this)},A(vu.prototype,{i:pu,w:gu,M:fu,H:_u,u:yu,U:gc,P:_c,B:yc}),a(xu,Il),xu.prototype.v=function(){var t=this;$a(this,ja(this,"firebaseui-id-reset-password-link"),(function(){t.l()})),this.i&&(this.w(this.i),this.u().focus()),Il.prototype.v.call(this)},xu.prototype.o=function(){this.l=this.i=null,Il.prototype.o.call(this)},A(xu.prototype,{u:gc,B:_c,w:yc}),ia.passwordReset=function(t,e,i,n){bh(t,dh(t).verifyPasswordResetCode(i).then((function(r){var o=new vu(r,(function(){!function(t,e,i,n,r){var o=i.u();o&&bh(t,i.I(I(dh(t).confirmPasswordReset,dh(t)),[n,o],(function(){i.m();var n=new Bc(r);n.render(e),uh(t,n)}),(function(n){bu(t,e,i,n)})))}(t,e,o,i,n)}));o.render(e),uh(t,o)}),(function(){bu(t,e)})))},ia.emailChangeRevocation=function(t,e,i){var n=null;bh(t,dh(t).checkActionCode(i).then((function(e){return n=e.data.email,dh(t).applyActionCode(i)})).then((function(){!function(t,e,i){var n=new du(i,(function(){bh(t,n.I(I(dh(t).sendPasswordResetEmail,dh(t)),[i],(function(){n.m(),(n=new Rc(i,void 0,ks(Sh(t)),Ns(Sh(t)))).render(e),uh(t,n)}),(function(){n.a(Ei().toString())})))}));n.render(e),uh(t,n)}(t,e,n)}),(function(){var i=new Vc;i.render(e),uh(t,i)})))},ia.emailVerification=function(t,e,i,n){bh(t,dh(t).applyActionCode(i).then((function(){var i=new Dc(n);i.render(e),uh(t,i)}),(function(){var i=new kc;i.render(e),uh(t,i)})))},ia.revertSecondFactorAddition=function(t,e,i){var n=null,r=null;bh(t,dh(t).checkActionCode(i).then((function(e){return n=e.data.email,r=e.data.multiFactorInfo,dh(t).applyActionCode(i)})).then((function(){!function(t,e,i,n){var r=new xu(n.factorId,(function(){r.I(I(dh(t).sendPasswordResetEmail,dh(t)),[i],(function(){r.m(),(r=new Rc(i,void 0,ks(Sh(t)),Ns(Sh(t)))).render(e),uh(t,r)}),(function(){r.a(Ei().toString())}))}),n.phoneNumber);r.render(e),uh(t,r)}(t,e,n,r)}),(function(){var i=new Fc;i.render(e),uh(t,i)})))},ia.verifyAndChangeEmail=function(t,e,i,n){var r=null;bh(t,dh(t).checkActionCode(i).then((function(e){return r=e.data.email,dh(t).applyActionCode(i)})).then((function(){var i=new Nc(r,n);i.render(e),uh(t,i)}),(function(){var i=new Oc;i.render(e),uh(t,i)})))},a(Eu,Il),Eu.prototype.v=function(){this.w(this.l),this.B(this.l,this.u),this.i().focus(),wu(this.i(),(this.i().value||"").length),Il.prototype.v.call(this)},Eu.prototype.o=function(){this.u=this.l=null,Il.prototype.o.call(this)},A(Eu.prototype,{i:Tc,M:Mc,w:Ic,H:Cc,j:Ac,U:gc,P:_c,B:yc}),ia.emailLinkConfirmation=function(t,e,i,n,r,o){var s=new Eu((function(){var r=s.j();r?(s.m(),n(t,e,r,i)):s.i().focus()}),(function(){s.m(),Jc(t,e,r||void 0)}),r||void 0,ks(Sh(t)),Ns(Sh(t)));s.render(e),uh(t,s),o&&s.a(o)},a(Su,Il),Su.prototype.v=function(){this.u(this.i),this.l().focus(),Il.prototype.v.call(this)},Su.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},A(Su.prototype,{l:gc,u:yc}),ia.emailLinkNewDeviceLinking=function(t,e,i,n){var r=new zt(i);if(i=r.a.a.get(jt.PROVIDER_ID)||null,Ut(r,null),i){var o=new Su(Ts(Sh(t),i),(function(){o.m(),n(t,e,r.toString())}),ks(Sh(t)),Ns(Sh(t)));o.render(e),uh(t,o)}else Jc(t,e)},a(Tu,Il),ia.emailLinkSignInCallback=Mu,a(Au,Il),Au.prototype.v=function(){this.u(this.i),this.l().focus(),Il.prototype.v.call(this)},Au.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},A(Au.prototype,{l:gc,u:yc}),ia.emailLinkSignInLinking=function(t,e,i){var n=$o(fh(t));if(Yo(fh(t)),n){var r=n.a.providerId,o=new Au(i,Ts(Sh(t),r),(function(){!function(t,e,i,n){var r=Cl(e);eu(t,e,i,(function(){Jc(t,r,i)}),(function(n){if(!n.name||"cancel"!=n.name){var o=$c(n);n&&"auth/network-request-failed"==n.code?e.a(o):(e.m(),Jc(t,r,i,o))}}),n)}(t,o,i,n)}),ks(Sh(t)),Ns(Sh(t)));o.render(e),uh(t,o)}else Jc(t,e)},a(Pu,Il),Pu.prototype.v=function(){var t=this;$a(this,this.l(),(function(){t.i()})),$a(this,ja(this,"firebaseui-id-trouble-getting-email-link"),(function(){t.u()})),this.l().focus(),Il.prototype.v.call(this)},Pu.prototype.o=function(){this.i=this.u=null,Il.prototype.o.call(this)},A(Pu.prototype,{l:_c}),ia.emailLinkSignInSent=function(t,e,i,n,r){var o=new Pu(i,(function(){o.m(),na("emailNotReceived",t,e,i,n,r)}),(function(){o.m(),n()}),ks(Sh(t)),Ns(Sh(t)));o.render(e),uh(t,o)},a(Lu,Il),Lu.prototype.v=function(){this.w(this.l,this.i),this.u().focus(),Il.prototype.v.call(this)},Lu.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},A(Lu.prototype,{u:gc,B:_c,w:yc}),ia.emailMismatch=function(t,e,i){var n=$o(fh(t));if(n){var r=new Lu(i.user.email,n.g,(function(){var e=r;Yo(fh(t)),Wc(t,e,i)}),(function(){var e=i.credential.providerId,o=Cl(r);r.m(),n.a?na("federatedLinking",t,o,n.g,e):na("federatedSignIn",t,o,n.g,e)}),ks(Sh(t)),Ns(Sh(t)));r.render(e),uh(t,r)}else Jc(t,e)},a(Ru,Il),Ru.prototype.v=function(){var t=this;$a(this,this.u(),(function(){t.i()})),$a(this,this.Da(),(function(){t.l()})),this.u().focus(),Il.prototype.v.call(this)},Ru.prototype.Da=function(){return ja(this,"firebaseui-id-resend-email-link")},Ru.prototype.o=function(){this.i=this.l=null,Il.prototype.o.call(this)},A(Ru.prototype,{u:_c}),ia.emailNotReceived=function(t,e,i,n,r){var o=new Ru((function(){eu(t,o,i,n,(function(t){t=$c(t),o.a(t)}),r)}),(function(){o.m(),Jc(t,e,i)}),ks(Sh(t)),Ns(Sh(t)));o.render(e),uh(t,o)},a(Du,Il),Du.prototype.v=function(){this.u(this.i),this.l().focus(),Il.prototype.v.call(this)},Du.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},A(Du.prototype,{l:gc,u:yc}),ia.federatedLinking=function(t,e,i,n,r){var o=$o(fh(t));if(o&&o.a){var s=new Du(i,Ts(Sh(t),n),(function(){Yc(t,s,n,i)}),ks(Sh(t)),Ns(Sh(t)));s.render(e),uh(t,s),r&&s.a(r)}else Jc(t,e)},ia.federatedRedirect=function(t,e,i){var n=new Tu;n.render(e),uh(t,n),Yc(t,n,e=Ss(Sh(t))[0],i)},ia.federatedSignIn=function(t,e,i,n,r){var o=new Du(i,Ts(Sh(t),n),(function(){Yc(t,o,n,i)}),ks(Sh(t)),Ns(Sh(t)));o.render(e),uh(t,o),r&&o.a(r)},ia.passwordLinking=function(t,e,i){var n=$o(fh(t));Yo(fh(t));var r=n&&n.a;if(r){var o=new Ec(i,(function(){!function(t,e,i,n){var r=e.u();r?bh(t,e.I(I(t.Xb,t),[i,r],(function(i){return i=i.user.linkWithCredential(n).then((function(i){return Wc(t,e,{user:i.user,credential:n,operationType:i.operationType,additionalUserInfo:i.additionalUserInfo})})),bh(t,i),i}),(function(t){if(!t.name||"cancel"!=t.name)switch(t.code){case"auth/wrong-password":Wa(e.i(),!1),Za(e.B(),$c(t));break;case"auth/too-many-requests":e.a($c(t));break;default:Ur("signInWithEmailAndPassword: "+t.message,void 0),e.a($c(t))}}))):e.i().focus()}(t,o,i,r)}),(function(){o.m(),na("passwordRecovery",t,e,i)}),ks(Sh(t)),Ns(Sh(t)));o.render(e),uh(t,o)}else Jc(t,e)},a(ku,Il),ku.prototype.v=function(){this.B(),this.H(this.l,this.u),la(this.i())||this.i().focus(),Pl(this,this.i(),this.l),Il.prototype.v.call(this)},ku.prototype.o=function(){this.u=this.l=null,Il.prototype.o.call(this)},A(ku.prototype,{i:Tc,w:Mc,B:Ic,M:Cc,j:Ac,U:gc,P:_c,H:yc}),ia.passwordRecovery=function(t,e,i,n,r){var o=new ku((function(){!function(t,e){var i=e.j();if(i){var n=Cl(e);bh(t,e.I(I(dh(t).sendPasswordResetEmail,dh(t)),[i],(function(){e.m();var r=new Rc(i,(function(){r.m(),Jc(t,n)}),ks(Sh(t)),Ns(Sh(t)));r.render(n),uh(t,r)}),(function(t){Wa(e.i(),!1),Za(e.w(),$c(t))})))}else e.i().focus()}(t,o)}),n?void 0:function(){o.m(),Jc(t,e)},i,ks(Sh(t)),Ns(Sh(t)));o.render(e),uh(t,o),r&&o.a(r)},ia.passwordSignIn=function(t,e,i,n){var r=new Pc((function(){!function(t,e){var i=e.j(),n=e.u();if(i)if(n){var r=Sd.auth.EmailAuthProvider.credential(i,n);bh(t,e.I(I(t.bc,t),[i,n],(function(i){return Wc(t,e,{user:i.user,credential:r,operationType:i.operationType,additionalUserInfo:i.additionalUserInfo})}),(function(t){if(!t.name||"cancel"!=t.name)switch(t.code){case"auth/email-already-in-use":break;case"auth/email-exists":Wa(e.l(),!1),Za(e.U(),$c(t));break;case"auth/too-many-requests":case"auth/wrong-password":Wa(e.i(),!1),Za(e.B(),$c(t));break;default:Ur("verifyPassword: "+t.message,void 0),e.a($c(t))}})))}else e.i().focus();else e.l().focus()}(t,r)}),(function(){var i=r.M();r.m(),na("passwordRecovery",t,e,i)}),i,ks(Sh(t)),Ns(Sh(t)),n);r.render(e),uh(t,r)},a(Fu,Il),Fu.prototype.v=function(){this.ea(),this.B&&this.Ja(),this.ua(),this.pa(this.w,this.H),this.B?(Al(this,this.i(),this.u()),Al(this,this.u(),this.l())):Al(this,this.i(),this.l()),this.w&&Pl(this,this.l(),this.w),la(this.i())?this.B&&!la(this.u())?this.u().focus():this.l().focus():this.i().focus(),Il.prototype.v.call(this)},Fu.prototype.o=function(){this.H=this.w=null,Il.prototype.o.call(this)},A(Fu.prototype,{i:Tc,U:Mc,ea:Ic,jb:Cc,j:Ac,u:Nu,Bc:Ou,Ja:function(){var t=Nu.call(this),e=Ou.call(this);qa(this,t,(function(){Ka(e)&&(Wa(t,!0),Ya(e))}))},M:function(){var t=Nu.call(this),e=Ou.call(this),i=la(t);return Wa(t,i=!/^[\s\xa0]*$/.test(null==i?"":String(i))),i?(Ya(e),e=!0):(Za(e,ri("Enter your account name").toString()),e=!1),e?$(la(t)):null},l:pu,ba:gu,lb:fu,ua:_u,P:yu,Nb:gc,Mb:_c,pa:yc}),ia.passwordSignUp=function(t,e,i,n,r,o){var s=new Fu(Os(Sh(t)),(function(){!function(t,e){var i=Os(Sh(t)),n=e.j(),r=null;i&&(r=e.M());var o=e.P();if(n){if(i){if(!r)return void e.u().focus();r=nt(r)}if(o){var s=Sd.auth.EmailAuthProvider.credential(n,o);bh(t,e.I(I(t.Yb,t),[n,o],(function(n){var o={user:n.user,credential:s,operationType:n.operationType,additionalUserInfo:n.additionalUserInfo};return i?(n=n.user.updateProfile({displayName:r}).then((function(){return Wc(t,e,o)})),bh(t,n),n):Wc(t,e,o)}),(function(i){if(!i.name||"cancel"!=i.name){var r=Hc(i);switch(i=$c(r),r.code){case"auth/email-already-in-use":return function(t,e,i,n){function r(){var t=$c(n);Wa(e.i(),!1),Za(e.U(),t),e.i().focus()}var o=dh(t).fetchSignInMethodsForEmail(i).then((function(n){n.length?r():(n=Cl(e),e.m(),na("passwordRecovery",t,n,i,!1,Ti().toString()))}),(function(){r()}));return bh(t,o),o}(t,e,n,r);case"auth/too-many-requests":i=ri("Too many account requests are coming from your IP address. Try again in a few minutes.").toString();case"auth/operation-not-allowed":case"auth/weak-password":Wa(e.l(),!1),Za(e.ba(),i);break;case"auth/admin-restricted-operation":As(Sh(t))?(i=Cl(e),e.m(),na("handleUnauthorizedUser",t,i,n,Sd.auth.EmailAuthProvider.PROVIDER_ID)):e.a(i);break;default:Ur(r="setAccountInfo: "+So(r),void 0),e.a(i)}}})))}else e.l().focus()}else e.i().focus()}(t,s)}),r?void 0:function(){s.m(),Jc(t,e)},i,n,ks(Sh(t)),Ns(Sh(t)),o);s.render(e),uh(t,s)},a(Vu,Il),Vu.prototype.v=function(){var t=this;this.U(this.jb),Zi(this.i,"tick",this.w,!1,this),this.i.start(),$a(this,ja(this,"firebaseui-id-change-phone-number-link"),(function(){t.P()})),$a(this,this.Da(),(function(){t.M()})),this.Ja(this.l),this.ea(this.l,this.H),this.u().focus(),Il.prototype.v.call(this)},Vu.prototype.o=function(){this.M=this.H=this.l=this.P=null,va(this.i),Qi(this.i,"tick",this.w),this.i=null,Il.prototype.o.call(this)},Vu.prototype.w=function(){--this.B,0<this.B?this.U(this.B):(va(this.i),Qi(this.i,"tick",this.w),this.ua(),this.lb())},A(Vu.prototype,{u:zu,pa:Bu,Ja:function(t){var e=zu.call(this),i=Bu.call(this);qa(this,e,(function(){Ka(i)&&(Wa(e,!0),Ya(i))})),t&&Xa(this,e,(function(){t()}))},ba:function(){var t=$(la(zu.call(this))||"");return/^\d{6}$/.test(t)?t:null},Fb:Uu,U:function(t){Ge(Uu.call(this),ri("Resend code in "+(9<t?"0:":"0:0")+t).toString())},ua:function(){Ya(this.Fb())},Da:function(){return ja(this,"firebaseui-id-resend-link")},lb:function(){Za(this.Da())},Nb:gc,Mb:_c,ea:yc}),ia.phoneSignInFinish=function(t,e,i,n,r,o){var s=new Vu((function(){s.m(),na("phoneSignInStart",t,e,i)}),(function(){!function(t,e,i,n){function r(t){e.u().focus(),Wa(e.u(),!1),Za(e.pa(),t)}var o=e.ba();o?(e.$("mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active firebaseui-progress-dialog-loading-icon",ri("Verifying...").toString()),bh(t,e.I(I(n.confirm,n),[o],(function(i){e.h(),e.$("firebaseui-icon-done",ri("Verified!").toString());var n=setTimeout((function(){e.h(),e.m();var n={user:ph(t).currentUser,credential:null,operationType:i.operationType,additionalUserInfo:i.additionalUserInfo};Wc(t,e,n,!0)}),1e3);bh(t,(function(){e&&e.h(),clearTimeout(n)}))}),(function(n){if(n.name&&"cancel"==n.name)e.h();else{var o=Hc(n);switch(n=$c(o),o.code){case"auth/credential-already-in-use":e.h();break;case"auth/code-expired":o=Cl(e),e.h(),e.m(),na("phoneSignInStart",t,o,i,n);break;case"auth/missing-verification-code":case"auth/invalid-verification-code":e.h(),r(n);break;default:e.h(),e.a(n)}}})))):r(ri("Wrong code. Try again.").toString())}(t,s,i,r)}),(function(){s.m(),Jc(t,e)}),(function(){s.m(),na("phoneSignInStart",t,e,i)}),gs(i),n,ks(Sh(t)),Ns(Sh(t)));s.render(e),uh(t,s),o&&s.a(o)};var ju=!(Zt||Wt("Safari")&&!(qt()||Wt("Coast")||Wt("Opera")||Wt("Edge")||Wt("Firefox")||Wt("FxiOS")||Wt("Silk")||Wt("Android")));function Gu(t,e){return/-[a-z]/.test(e)?null:ju&&t.dataset?!Wt("Android")||qt()||Wt("Firefox")||Wt("FxiOS")||Wt("Opera")||Wt("Silk")||e in t.dataset?void 0===(t=t.dataset[e])?null:t:null:t.getAttribute("data-"+String(e).replace(/([A-Z])/g,"-$1").toLowerCase())}function Hu(t,e,i){var n=this;t=Ke(dl,{items:t},null,this.s),vl.call(this,t,!0,!0),i&&(i=function(t,e){t=(t||document).getElementsByTagName("BUTTON");for(var i=0;i<t.length;i++)if(Gu(t[i],"listboxid")===e)return t[i];return null}(t,i))&&(i.focus(),function(t,e){var i=(e=e||Ue(document))||Ue(document),n=Fa(t),r=Fa(i);if(!Zt||9<=Number(ae)){s=Na(i,"borderLeftWidth");var o=Na(i,"borderRightWidth");a=Na(i,"borderTopWidth"),l=Na(i,"borderBottomWidth"),o=new ka(parseFloat(a),parseFloat(o),parseFloat(l),parseFloat(s))}else{var s=Ba(i,"borderLeft");o=Ba(i,"borderRight");var a=Ba(i,"borderTop"),l=Ba(i,"borderBottom");o=new ka(a,o,l,s)}i==Ue(document)?(s=n.a-i.scrollLeft,n=n.g-i.scrollTop,!Zt||10<=Number(ae)||(s+=o.left,n+=o.top)):(s=n.a-r.a-o.left,n=n.g-r.g-o.top),r=t.offsetWidth,o=t.offsetHeight,a=te&&!r&&!o,t=d(r)&&!a||!t.getBoundingClientRect?new ke(r,o):new ke((t=Oa(t)).right-t.left,t.bottom-t.top),r=i.clientHeight-t.height,o=i.scrollLeft,a=i.scrollTop,i=new De(o+=Math.min(s,Math.max(s-(i.clientWidth-t.width),0)),a+=Math.min(n,Math.max(n-r,0))),e.scrollLeft=i.a,e.scrollTop=i.g}(i,t)),$a(this,t,(function(t){(t=(t=He(t.target,"firebaseui-id-list-box-dialog-button"))&&Gu(t,"listboxid"))&&(xl.call(n),e(t))}))}function Wu(){return ja(this,"firebaseui-id-phone-number")}function qu(){return ja(this,"firebaseui-id-country-selector")}function Xu(){return ja(this,"firebaseui-id-phone-number-error")}function $u(t,e){var i,n=t.a,r=Yu("1-US-0",n);if(!(i=e&&Yu(e,n)?e:r?"1-US-0":0<n.length?n[0].c:null))throw Error("No available default country");Ju.call(this,i,t)}function Yu(t,e){return!(!(t=ls(t))||!j(e,t))}function Zu(t){return"firebaseui-flag-"+t.f}function Ku(t){var e=this;Hu.call(this,function(t){return t.map((function(t){return{id:t.c,Ma:"firebaseui-flag "+Zu(t),label:t.name+" +"+t.b}}))}(t.a),(function(i){Ju.call(e,i,t,!0),e.O().focus()}),this.Ba)}function Ju(t,e,i){var n=ls(t);n&&(i&&(e=as(e,i=$(la(Wu.call(this))||""))).length&&e[0].b!=n.b&&(i="+"+n.b+i.substr(e[0].b.length+1),ca(Wu.call(this),i)),e=ls(this.Ba),this.Ba=t,t=ja(this,"firebaseui-id-country-selector-flag"),e&&aa(t,Zu(e)),sa(t,Zu(n)),Ge(ja(this,"firebaseui-id-country-selector-code"),"+"+n.b))}function Qu(t,e,i,n,r,o,s,a,l,c){Il.call(this,hc,{Gb:e,Aa:l||null,Va:!!i,ia:!!o},c,"phoneSignInStart",{F:n,D:r}),this.H=a||null,this.M=e,this.l=t,this.w=i||null,this.pa=s||null}function th(t,e,i,n){try{var r=e.U(qs)}catch(t){return}r?Hs?(e.$("mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active firebaseui-progress-dialog-loading-icon",ri("Verifying...").toString()),bh(t,e.I(I(t.cc,t),[gs(r),i],(function(i){var n=Cl(e);e.$("firebaseui-icon-done",ri("Code sent!").toString());var o=setTimeout((function(){e.h(),e.m(),na("phoneSignInFinish",t,n,r,15,i)}),1e3);bh(t,(function(){e&&e.h(),clearTimeout(o)}))}),(function(i){if(e.h(),!i.name||"cancel"!=i.name){grecaptcha.reset(Xs),Hs=null;var n=i&&i.message||"";if(i.code)switch(i.code){case"auth/too-many-requests":n=ri("This phone number has been used too many times").toString();break;case"auth/invalid-phone-number":case"auth/missing-phone-number":return e.O().focus(),void Za(e.B(),wi().toString());case"auth/admin-restricted-operation":if(As(Sh(t)))return i=Cl(e),e.m(),void na("handleUnauthorizedUser",t,i,gs(r),Sd.auth.PhoneAuthProvider.PROVIDER_ID);n=$c(i);break;default:n=$c(i)}e.a(n)}})))):Ws?Za(e.u(),ri("Solve the reCAPTCHA").toString()):!Ws&&n&&e.i().click():(e.O().focus(),Za(e.B(),wi().toString()))}function eh(t,e,i,n,r){Il.call(this,uc,{Sb:e},r,"providerSignIn",{F:i,D:n}),this.i=t}function ih(t,e,i,n,r,o,s){Il.call(this,Ll,{email:i,Va:!!e,ia:!!o},s,"signIn",{F:n,D:r}),this.i=t,this.u=e}function nh(t,e,i,n,r,o,s){Il.call(this,$l,{kc:t,yb:i,Eb:!!n},s,"unauthorizedUser",{F:r,D:o}),this.l=e,this.i=n}function rh(t,e,i,n,r,o){Il.call(this,Yl,{email:t},o,"unsupportedProvider",{F:n,D:r}),this.l=e,this.i=i}function oh(t,e){this.$=!1;var i=lh(e);if(ah[i])throw Error('An AuthUI instance already exists for the key "'+i+'"');ah[i]=this,this.a=t,this.u=null,this.Y=!1,sh(this.a),this.h=Sd.initializeApp({apiKey:t.app.options.apiKey,authDomain:t.app.options.authDomain},t.app.name+"-firebaseui-temp").auth(),(t=t.emulatorConfig)&&(i=t.port,this.h.useEmulator(t.protocol+"://"+t.host+(null===i?"":":"+i),t.options)),sh(this.h),this.h.setPersistence&&this.h.setPersistence(Sd.auth.Auth.Persistence.SESSION),this.oa=e,this.ca=new xs,this.g=this.T=this.i=this.J=this.O=null,this.s=[],this.Z=!1,this.l=_r.Xa(),this.j=this.C=null,this.da=this.A=!1}function sh(t){t&&t.INTERNAL&&t.INTERNAL.logFramework&&t.INTERNAL.logFramework("FirebaseUI-web")}a(Qu,Il),Qu.prototype.v=function(){this.ea(this.pa,this.H),this.P(this.l,this.w||void 0),this.M||Al(this,this.O(),this.i()),Pl(this,this.i(),this.l),this.O().focus(),wu(this.O(),(this.O().value||"").length),Il.prototype.v.call(this)},Qu.prototype.o=function(){this.w=this.l=null,Il.prototype.o.call(this)},A(Qu.prototype,{Cb:bl,O:Wu,B:Xu,ea:function(t,e,i){var n=this,r=Wu.call(this),o=qu.call(this),s=Xu.call(this),a=t||ps,l=a.a;if(0==l.length)throw Error("No available countries provided.");$u.call(n,a,e),$a(this,o,(function(){Ku.call(n,a)})),qa(this,r,(function(){Ka(s)&&(Wa(r,!0),Ya(s));var t=$(la(r)||""),e=ls(this.Ba),i=as(a,t);t=Yu("1-US-0",l),i.length&&i[0].b!=e.b&&(e=i[0],Ju.call(n,"1"==e.b&&t?"1-US-0":e.c,a))})),i&&Xa(this,r,(function(){i()}))},U:function(t){var e=$(la(Wu.call(this))||""),i=(t=t||ps).a,n=as(ps,e);if(n.length&&!j(i,n[0]))throw ca(Wu.call(this)),Wu.call(this).focus(),Za(Xu.call(this),ri("The country code provided is not supported.").toString()),Error("The country code provided is not supported.");return i=ls(this.Ba),n.length&&n[0].b!=i.b&&Ju.call(this,n[0].c,t),n.length&&(e=e.substr(n[0].b.length+1)),e?new fs(this.Ba,e):null},Ja:qu,ba:function(){return ja(this,"firebaseui-recaptcha-container")},u:function(){return ja(this,"firebaseui-id-recaptcha-error")},i:gc,ua:_c,P:yc}),ia.phoneSignInStart=function(t,e,i,n){var r=function(t){var e=null;if(ws(t).forEach((function(t){t.provider==Sd.auth.PhoneAuthProvider.PROVIDER_ID&&w(t.recaptchaParameters)&&!Array.isArray(t.recaptchaParameters)&&(e=ot(t.recaptchaParameters))})),e){var i=[];ea.forEach((function(t){void 0!==e[t]&&(i.push(t),delete e[t])})),i.length&&Hr('The following provided "recaptchaParameters" keys are not allowed: '+i.join(", "))}return e}(Sh(t))||{};Hs=null,Ws=!(r&&"invisible"===r.size);var o=Kc(t),s=function(t){var e=(t=Es(t,Sd.auth.PhoneAuthProvider.PROVIDER_ID))&&t.defaultCountry||null;e=e&&cs(e);var i=null;return t&&"string"==typeof t.loginHint&&(i=ms(t.loginHint)),e&&e[0]||i&&ls(i.a)||null}(Sh(t)),a=o?function(t){var e=null;return(t=Es(t,Sd.auth.PhoneAuthProvider.PROVIDER_ID))&&"string"==typeof t.loginHint&&(e=ms(t.loginHint)),t&&t.defaultNationalNumber||e&&e.Aa||null}(Sh(t)):null;s=i&&i.a||s&&s.c||null,i=i&&i.Aa||a,(a=Rs(Sh(t)))&&hs(a),qs=a?new ss(Rs(Sh(t))):ps;var l=new Qu((function(e){th(t,l,c,!(!e||!e.keyCode))}),Ws,o?null:function(){c.clear(),l.m(),Jc(t,e)},ks(Sh(t)),Ns(Sh(t)),o,qs,s,i);l.render(e),uh(t,l),n&&l.a(n),r.callback=function(e){l.u()&&Ya(l.u()),Hs=e,Ws||th(t,l,c)},r["expired-callback"]=function(){Hs=null};var c=new Sd.auth.RecaptchaVerifier(Ws?l.ba():l.i(),r,ph(t).app);bh(t,l.I(I(c.render,c),[],(function(t){Xs=t}),(function(i){i.name&&"cancel"==i.name||(i=$c(i),l.m(),Jc(t,e,void 0,i))})))},ia.prefilledEmailSignIn=function(t,e,i){var n=new Tu;n.render(e),uh(t,n),bh(t,n.I(I(dh(t).fetchSignInMethodsForEmail,dh(t)),[i],(function(r){n.m();var o=!(!Zc(t)||!mh(t));tu(t,e,r,i,void 0,o)}),(function(r){r=$c(r),n.m(),na("signIn",t,e,i,r)})))},a(eh,Il),eh.prototype.v=function(){this.l(this.i),Il.prototype.v.call(this)},eh.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},A(eh.prototype,{l:function(t){function e(e){t(e)}for(var i=this.g?Oe("firebaseui-id-idp-button",this.g||this.s.a):[],n=0;n<i.length;n++){var r=i[n];$a(this,r,C(e,Gu(r,"providerId")))}}}),ia.providerSignIn=function(t,e,i,n){var r=new eh((function(i){i==Sd.auth.EmailAuthProvider.PROVIDER_ID?(r.m(),iu(t,e,n)):i==Sd.auth.PhoneAuthProvider.PROVIDER_ID?(r.m(),na("phoneSignInStart",t,e)):"anonymous"==i?function(t,e){bh(t,e.I(I(t.$b,t),[],(function(i){return e.m(),Wc(t,e,i,!0)}),(function(t){t.name&&"cancel"==t.name||(Ur("ContinueAsGuest: "+t.code,void 0),t=$c(t),e.a(t))})))}(t,r):Yc(t,r,i,n),Th(t),t.l.cancel()}),Ms(Sh(t)),ks(Sh(t)),Ns(Sh(t)));r.render(e),uh(t,r),i&&r.a(i),function(t){Th(t);try{yr(t.l,Is(Sh(t)),function(t){var e;return Th(t),(e=t.Z)||(e=!(!(t=Ls(t=Sh(t),Sd.auth.GoogleAuthProvider.PROVIDER_ID))||"select_account"!==t.prompt)),e}(t)).then((function(e){return!!t.g&&function(t,e,i){if(i&&i.credential&&i.clientId===Is(Sh(t))){if(Ps(Sh(t),Sd.auth.GoogleAuthProvider.PROVIDER_ID).length){try{var n=JSON.parse(atob(i.credential.split(".")[1])).email}catch(r){}return Yc(t,e,Sd.auth.GoogleAuthProvider.PROVIDER_ID,n),zn(!0)}return r=Sd.auth.GoogleAuthProvider.credential(i.credential),o=!1,r=e.I(I(t.ac,t),[r],(function(i){var n=Cl(e);e.m(),na("callback",t,n,zn(i)),o=!0}),(function(i){if(!(i.name&&"cancel"==i.name||i&&"auth/credential-already-in-use"==i.code))if(i&&"auth/email-already-in-use"==i.code&&i.email&&i.credential){var n=Cl(e);e.m(),na("callback",t,n,Bn(i))}else i&&"auth/admin-restricted-operation"==i.code&&As(Sh(t))?(i=Cl(e),e.m(),na("handleUnauthorizedUser",t,i,null,Sd.auth.GoogleAuthProvider.PROVIDER_ID)):(i=$c(i),e.a(i))})),bh(t,r),r.then((function(){return o}),(function(){return!1}))}var r,o;return i&&e.a(ri("The selected credential for the authentication provider is not supported!").toString()),zn(!1)}(t,t.g,e)}))}catch(t){}}(t)},ia.sendEmailLinkForSignIn=function(t,e,i,n){var r=new su;r.render(e),uh(t,r),eu(t,r,i,n,(function(n){r.m(),n&&"auth/admin-restricted-operation"==n.code&&As(Sh(t))?na("handleUnauthorizedUser",t,e,i,Sd.auth.EmailAuthProvider.PROVIDER_ID):(n=$c(n),na("signIn",t,e,i,n))}))},a(ih,Il),ih.prototype.v=function(){this.w(this.i),this.B(this.i,this.u||void 0),this.l().focus(),wu(this.l(),(this.l().value||"").length),Il.prototype.v.call(this)},ih.prototype.o=function(){this.u=this.i=null,Il.prototype.o.call(this)},A(ih.prototype,{l:Tc,M:Mc,w:Ic,H:Cc,j:Ac,U:gc,P:_c,B:yc}),ia.signIn=function(t,e,i,n){var r=Zc(t),o=new ih((function(){var e=o,i=e.j()||"";i&&Qc(t,e,i)}),r?null:function(){o.m(),Jc(t,e,i)},i,ks(Sh(t)),Ns(Sh(t)),r);o.render(e),uh(t,o),n&&o.a(n)},a(nh,Il),nh.prototype.v=function(){var t=this,e=ja(this,"firebaseui-id-unauthorized-user-help-link");this.i&&e&&$a(this,e,(function(){t.i()})),$a(this,this.u(),(function(){t.l()})),this.u().focus(),Il.prototype.v.call(this)},nh.prototype.o=function(){this.i=this.l=null,Il.prototype.o.call(this)},A(nh.prototype,{u:_c}),ia.handleUnauthorizedUser=function(t,e,i,n){function r(){Jc(t,e)}n===Sd.auth.EmailAuthProvider.PROVIDER_ID?r=function(){iu(t,e)}:n===Sd.auth.PhoneAuthProvider.PROVIDER_ID&&(r=function(){na("phoneSignInStart",t,e)});var o=null,s=null;n===Sd.auth.EmailAuthProvider.PROVIDER_ID&&Cs(Sh(t))?(o=function(t){return(t=Es(t,Sd.auth.EmailAuthProvider.PROVIDER_ID))&&t.disableSignUp&&t.disableSignUp.adminEmail||null}(Sh(t)),s=function(t){if((t=Es(t,Sd.auth.EmailAuthProvider.PROVIDER_ID))&&t.disableSignUp){var e=t.disableSignUp.helpLink||null;if(e&&"string"==typeof e)return function(){Jn(e)}}return null}(Sh(t))):As(Sh(t))&&(o=function(t){return(t=t.a.get("adminRestrictedOperation"))&&t.adminEmail?t.adminEmail:null}(Sh(t)),s=function(t){if(t=t.a.get("adminRestrictedOperation")||null){var e=t.helpLink||null;if(e&&"string"==typeof e)return function(){Jn(e)}}return null}(Sh(t)));var a=new nh(i,(function(){a.m(),r()}),o,s,ks(Sh(t)),Ns(Sh(t)));a.render(e),uh(t,a)},a(rh,Il),rh.prototype.v=function(){this.w(this.l,this.i),this.u().focus(),Il.prototype.v.call(this)},rh.prototype.o=function(){this.i=this.l=null,Il.prototype.o.call(this)},A(rh.prototype,{u:gc,B:_c,w:yc}),ia.unsupportedProvider=function(t,e,i){var n=new rh(i,(function(){n.m(),na("passwordRecovery",t,e,i)}),(function(){n.m(),Jc(t,e,i)}),ks(Sh(t)),Ns(Sh(t)));n.render(e),uh(t,n)};var ah={};function lh(t){return t||"[DEFAULT]"}function ch(t){return Th(t),t.i||(t.i=vh(t,(function(e){return e&&!$o(fh(t))?zn(ph(t).getRedirectResult().then((function(t){return t}),(function(e){if(e&&"auth/email-already-in-use"==e.code&&e.email&&e.credential)throw e;return Ch(t,e)}))):zn(dh(t).getRedirectResult().then((function(e){return bs(Sh(t))&&!e.user&&t.j&&!t.j.isAnonymous?ph(t).getRedirectResult():e})))}))),t.i}function uh(t,e){Th(t),t.g=e}var hh=null;function dh(t){return Th(t),t.h}function ph(t){return Th(t),t.a}function fh(t){return Th(t),t.oa}function mh(t){return Th(t),t.O?t.O.emailHint:void 0}function gh(t){return"signIn"===((t=new zt(t)).a.a.get(jt.ub)||null)&&!!t.a.a.get(jt.$a)}function _h(t,e,i,n){Th(t),void 0!==t.a.languageCode&&(t.u=t.a.languageCode);var r="en".replace(/_/g,"-");t.a.languageCode=r,t.h.languageCode=r,t.Y=!0,void 0!==t.a.tenantId&&(t.h.tenantId=t.a.tenantId),t.ib(i),t.O=n||null;var o=h.document;t.C?t.C.then((function(){"complete"==o.readyState?yh(t,e):Ji(window,"load",(function(){yh(t,e)}))})):"complete"==o.readyState?yh(t,e):Ji(window,"load",(function(){yh(t,e)}))}function yh(t,e){var i=Qn(e,"Could not find the FirebaseUI widget element on the page.");if(i.setAttribute("lang","en".replace(/_/g,"-")),hh){var n=hh;Th(n),$o(fh(n))&&Hr("UI Widget is already rendered on the page and is pending some user interaction. Only one widget instance can be rendered per page. The previous instance has been automatically reset."),hh.reset()}if(hh=t,t.T=i,function(t,e){t.L=null,t.J=new gn(e),t.J.register(),Zi(t.J,"pageEnter",(function(e){if(e=e&&e.pageId,t.L!=e){var i=Sh(t);(i=Gs(i).uiChanged||null)&&i(t.L,e),t.L=e}}))}(t,i),Do(new ko)&&Do(new No)){e=Qn(e,"Could not find the FirebaseUI widget element on the page."),i=(i=_t(i=tr(),n=es(Sh(t).a,"queryParameterForSignInSuccessUrl")))?ye(xe(i)).toString():null;t:{n=tr();var r=Ds(Sh(t));for(o in n=_t(n,r)||"",Qs)if(Qs[o].toLowerCase()==n.toLowerCase()){var o=Qs[o];break t}o="callback"}switch(o){case"callback":i&&(o=fh(t),qo(Vo,i,o)),t.nb()?na("callback",t,e):Jc(t,e,mh(t));break;case"resetPassword":na("passwordReset",t,e,nu(),ru());break;case"recoverEmail":na("emailChangeRevocation",t,e,nu());break;case"revertSecondFactorAddition":na("revertSecondFactorAddition",t,e,nu());break;case"verifyEmail":na("emailVerification",t,e,nu(),ru());break;case"verifyAndChangeEmail":na("verifyAndChangeEmail",t,e,nu(),ru());break;case"signIn":na("emailLinkSignInCallback",t,e,tr()),Mh();break;case"select":i&&(o=fh(t),qo(Vo,i,o)),Jc(t,e);break;default:throw Error("Unhandled widget operation.")}(e=Gs(e=Sh(t)).uiShown||null)&&e()}else e=Qn(e,"Could not find the FirebaseUI widget element on the page."),(o=new Gc(ri("The browser you are using does not support Web Storage. Please try again in a different browser.").toString())).render(e),uh(t,o);e=t.g&&"blank"==t.g.Ga&&zs(Sh(t)),Ko(fh(t))&&!e&&(Eh(t,(e=Ko(fh(t))).a),Wo(Uo,fh(t)))}function vh(t,e){if(t.A)return e(xh(t));if(bh(t,(function(){t.A=!1})),bs(Sh(t))){var i=new Ln((function(i){bh(t,t.a.onAuthStateChanged((function(n){t.j=n,t.A||(t.A=!0,i(e(xh(t))))})))}));return bh(t,i),i}return t.A=!0,e(null)}function xh(t){return Th(t),bs(Sh(t))&&t.j&&t.j.isAnonymous?t.j:null}function bh(t,e){if(Th(t),e){t.s.push(e);var i=function(){!function(t,e){!function(t,e){for(var i=p(t)?t.split(""):t,n=t.length-1;0<=n;--n)n in i&&e.call(void 0,i[n],n,t)}(t,(function(i,n){e.call(void 0,i,n,t)&&H(t,n)}))}(t.s,(function(t){return t==e}))};"function"!=typeof e&&e.then(i,i)}}function wh(t){void 0!==t.a.languageCode&&t.Y&&(t.Y=!1,t.a.languageCode=t.u)}function Eh(t,e){t.a.tenantId=e,t.h.tenantId=e}function Sh(t){return Th(t),t.ca}function Th(t){if(t.$)throw Error("AuthUI instance is deleted!")}function Mh(){var t=tr();if(gh(t)){for(var e in t=new zt(t),jt)jt.hasOwnProperty(e)&&kt(t.a.a,jt[e]);e={state:"signIn",mode:"emailLink",operation:"clear"};var i=h.document.title;h.history&&h.history.replaceState&&h.history.replaceState(e,i,t.toString())}}function Ih(t){return Th(t),dh(t).signOut()}function Ch(t,e,i){if(Th(t),e&&e.code&&("auth/email-already-in-use"==e.code||"auth/credential-already-in-use"==e.code)){var n=js(Sh(t));return zn().then((function(){return n(new Ii("anonymous-upgrade-merge-conflict",null,i||e.credential))})).then((function(){throw t.g&&(t.g.m(),t.g=null),e}))}return Bn(e)}function Ah(t,e,i,n){Il.call(this,mc,void 0,n,"providerMatchByEmail",{F:e,D:i}),this.i=t}function Ph(t,e,i,n,r){Il.call(this,fc,{ec:e},r,"selectTenant",{F:i,D:n}),this.i=t}function Lh(t){Il.call(this,Fl,void 0,t,"spinner")}function Rh(t){for(var e in this.a=new Jo,Qo(this.a,"authDomain"),Qo(this.a,"displayMode",Bh),Qo(this.a,"tenants"),Qo(this.a,"callbacks"),Qo(this.a,"tosUrl"),Qo(this.a,"privacyPolicyUrl"),t)if(t.hasOwnProperty(e))try{ts(this.a,e,t[e])}catch(t){Ur('Invalid config: "'+e+'"',void 0)}}function Dh(t){return t.a.get("callbacks")||{}}function kh(t){var e=t.a.get("tosUrl")||null;if(t=t.a.get("privacyPolicyUrl")||null,e&&!t&&Hr("Privacy Policy URL is missing, the link will not be displayed."),e&&t){if("function"==typeof e)return e;if("string"==typeof e)return function(){Jn(e)}}return null}function Nh(t){var e=t.a.get("tosUrl")||null,i=t.a.get("privacyPolicyUrl")||null;if(i&&!e&&Hr("Terms of Service URL is missing, the link will not be displayed."),e&&i){if("function"==typeof i)return i;if("string"==typeof i)return function(){Jn(i)}}return null}function Oh(t,e){if(!(t=t.a.get("tenants"))||!t.hasOwnProperty(e)&&!t.hasOwnProperty(Vh))throw Error("Invalid tenant configuration!")}function Fh(t,e,i){if(!(t=t.a.get("tenants")))throw Error("Invalid tenant configuration!");var n=[];if(!(t=t[e]||t[Vh]))return Ur("Invalid tenant configuration: "+e+" is not configured!",void 0),n;if(!(e=t.signInOptions))throw Error("Invalid tenant configuration: signInOptions are invalid!");return e.forEach((function(t){if("string"==typeof t)n.push(t);else if("string"==typeof t.provider){var e=t.hd;e&&i?(e instanceof RegExp?e:new RegExp("@"+e.replace(".","\\.")+"$")).test(i)&&n.push(t.provider):n.push(t.provider)}else Ur(t="Invalid tenant configuration: signInOption "+JSON.stringify(t)+" is invalid!",void 0)})),n}(t=oh.prototype).nb=function(){return Th(this),!!Ko(fh(this))||gh(tr())},t.start=function(t,e){_h(this,t,e)},t.Db=function(){Th(this),this.Z=!0},t.reset=function(){Th(this);var t=this;this.T&&this.T.removeAttribute("lang"),this.J&&function(t){var e=mn(t.N());dn[e]&&dn[e].length&&(function(t,e){t:{for(var i=t.length,n=p(t)?t.split(""):t,r=0;r<i;r++)if(r in n&&e.call(void 0,n[r],r,t)){e=r;break t}e=-1}0<=e&&H(t,e)}(dn[e],(function(e){return e==t})),dn[e].length||delete dn[e])}(this.J),wh(this),this.O=null,Mh(),Wo(Uo,fh(this)),Th(this),this.l.cancel(),this.i=zn({user:null,credential:null}),hh==this&&(hh=null),this.T=null;for(var e=0;e<this.s.length;e++)"function"==typeof this.s[e]?this.s[e]():this.s[e].cancel&&this.s[e].cancel();this.s=[],Yo(fh(this)),this.g&&(this.g.m(),this.g=null),this.L=null,this.h&&(this.C=Ih(this).then((function(){t.C=null}),(function(){t.C=null})))},t.ib=function(t){Th(this);var e,i=this.ca;for(e in t)try{ts(i.a,e,t[e])}catch(t){Ur('Invalid config: "'+e+'"',void 0)}ee&&ts(i.a,"popupMode",!1),Rs(i),!this.da&&Us(Sh(this))&&(Hr("signInSuccess callback is deprecated. Please use signInSuccessWithAuthResult callback instead."),this.da=!0)},t.Wb=function(){Th(this);var t=Sh(this),e=es(t.a,"widgetUrl");t=Ds(t);for(var i,n=e.search(gt),r=0,o=[];0<=(i=mt(e,r,t,n));)o.push(e.substring(r,i)),r=Math.min(e.indexOf("&",i)+1||n,n);o.push(e.substr(r)),e=o.join("").replace(yt,"$1"),(t+=n="="+encodeURIComponent("select"))?(0>(n=e.indexOf("#"))&&(n=e.length),0>(r=e.indexOf("?"))||r>n?(r=n,i=""):i=e.substring(r+1,n),n=(e=[e.substr(0,r),i,e.substr(n)])[1],e[1]=t?n?n+"&"+t:t:n,n=e[0]+(e[1]?"?"+e[1]:"")+e[2]):n=e,Sh(this).a.get("popupMode")?(n=n||"about:blank",(t={width:500,height:600,top:0<(t=(window.screen.availHeight-600)/2)?t:0,left:0<(e=(window.screen.availWidth-500)/2)?e:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1}).target=t.target||n.target||"google_popup",t.width=t.width||690,t.height=t.height||500,(t=Zn(n,t))&&t.focus()):Re(window.location,n)},t.Wa=function(){var t=this;return Th(this),this.h.app.delete().then((function(){var e=lh(fh(t));delete ah[e],t.reset(),t.$=!0}))},t.Ib=function(t,e){Th(this);var i=this,n=function(){for(var t=32,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();if(!Fs(Sh(this)))return Bn(Error("Email link sign-in should be enabled to trigger email sending."));var r=function(t){if(Fs(t)){var e={url:tr(),handleCodeInApp:!0};(t=Es(t,Sd.auth.EmailAuthProvider.PROVIDER_ID))&&"function"==typeof t.emailLinkSignIn&&at(e,t.emailLinkSignIn()),t=e.url;var i=tr();i instanceof vt||(i=Et(i)),t instanceof vt||(t=Et(t));var n=i;i=new vt(n);var r=!!t.j;r?xt(i,t.j):r=!!t.A,r?i.A=t.A:r=!!t.h,r?i.h=t.h:r=null!=t.C;var o=t.g;if(r)bt(i,t.C);else if(r=!!t.g)if("/"!=o.charAt(0)&&(n.h&&!n.g?o="/"+o:-1!=(n=i.g.lastIndexOf("/"))&&(o=i.g.substr(0,n+1)+o)),".."==o||"."==o)o="";else if(-1!=o.indexOf("./")||-1!=o.indexOf("/.")){n=0==o.lastIndexOf("/",0),o=o.split("/");for(var s=[],a=0;a<o.length;){var l=o[a++];"."==l?n&&a==o.length&&s.push(""):".."==l?((1<s.length||1==s.length&&""!=s[0])&&s.pop(),n&&a==o.length&&s.push("")):(s.push(l),n=!0)}o=s.join("/")}return r?i.g=o:r=""!==t.a.toString(),r?wt(i,Ot(t.a)):r=!!t.s,r&&(i.s=t.s),e.url=i.toString(),e}return null}(Sh(this)),o=new zt(r.url);return function(t,e){e?t.a.a.set(jt.Sa,e):kt(t.a.a,jt.Sa)}(o,n),e&&e.a&&(function(t,e,i){qo(Go,bo(t,JSON.stringify(Kr(e))),i)}(n,e,fh(this)),Ut(o,e.a.providerId)),function(t,e){null!==e?t.a.a.set(jt.Qa,e?"1":"0"):kt(t.a.a,jt.Qa)}(o,function(t){return!(!(t=Es(t,Sd.auth.EmailAuthProvider.PROVIDER_ID))||!t.forceSameDevice)}(Sh(this))),vh(this,(function(e){return e&&((e=e.uid)?o.a.a.set(jt.Pa,e):kt(o.a.a,jt.Pa)),r.url=o.toString(),dh(i).sendSignInLinkToEmail(t,r)})).then((function(){var e=fh(i),r={};r.email=t,qo(jo,bo(n,JSON.stringify(r)),e)}),(function(t){throw Wo(Go,fh(i)),Wo(jo,fh(i)),t}))},t.bc=function(t,e){Th(this);var i=this;return dh(this).signInWithEmailAndPassword(t,e).then((function(n){return vh(i,(function(r){return r?Ih(i).then((function(){return Ch(i,{code:"auth/email-already-in-use"},Sd.auth.EmailAuthProvider.credential(t,e))})):n}))}))},t.Yb=function(t,e){Th(this);var i=this;return vh(this,(function(n){if(n){var r=Sd.auth.EmailAuthProvider.credential(t,e);return n.linkWithCredential(r)}return dh(i).createUserWithEmailAndPassword(t,e)}))},t.ac=function(t){Th(this);var e=this;return vh(this,(function(i){return i?i.linkWithCredential(t).then((function(t){return t}),(function(i){if(i&&"auth/email-already-in-use"==i.code&&i.email&&i.credential)throw i;return Ch(e,i,t)})):dh(e).signInWithCredential(t)}))},t.dc=function(t){Th(this);var e=this,i=this.i;return this.i=null,vh(this,(function(i){return i&&!$o(fh(e))?i.linkWithRedirect(t):dh(e).signInWithRedirect(t)})).then((function(){}),(function(t){throw e.i=i,t}))},t.cc=function(t,e){Th(this);var i=this;return vh(this,(function(n){return n?n.linkWithPhoneNumber(t,e).then((function(t){return new br(t,(function(t){if("auth/credential-already-in-use"==t.code)return Ch(i,t);throw t}))})):ph(i).signInWithPhoneNumber(t,e).then((function(t){return new br(t)}))}))},t.$b=function(){return Th(this),ph(this).signInAnonymously()},t.Xb=function(t,e){return Th(this),dh(this).signInWithEmailAndPassword(t,e)},a(Ah,Il),Ah.prototype.v=function(){this.u(this.i),this.w(this.i),this.l().focus(),wu(this.l(),(this.l().value||"").length),Il.prototype.v.call(this)},Ah.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},A(Ah.prototype,{l:Tc,H:Mc,u:Ic,B:Cc,j:Ac,M:gc,w:yc}),a(Ph,Il),Ph.prototype.v=function(){!function(t,e){function i(t){e(t)}for(var n=t.g?Oe("firebaseui-id-tenant-selection-button",t.g||t.s.a):[],r=0;r<n.length;r++){var o=n[r];$a(t,o,C(i,Gu(o,"tenantId")))}}(this,this.i),Il.prototype.v.call(this)},Ph.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},a(Lh,Il);var zh=["immediateFederatedRedirect","privacyPolicyUrl","signInFlow","signInOptions","tosUrl"],Bh="optionFirst",Uh={pc:Bh,oc:"identifierFirst"},Vh="*";function jh(t,e){var i=this;this.s=Qn(t),this.a={},Object.keys(e).forEach((function(t){i.a[t]=new Rh(e[t])})),this.ob=this.g=this.A=this.h=this.i=this.j=null,Object.defineProperty(this,"languageCode",{get:function(){return this.ob},set:function(t){this.ob=t||null},enumerable:!1})}function Gh(t){t.j&&t.j.reset(),t.mb(),t.g&&t.g.m()}(t=jh.prototype).Ub=function(t,e){var i=this;Gh(this);var n=t.apiKey;return new Ln((function(t,r){if(i.a.hasOwnProperty(n)){var o=Dh(i.a[n]).selectTenantUiHidden||null;if(function(t){for(var e in t=t.a.get("displayMode"),Uh)if(Uh[e]===t)return Uh[e];return Bh}(i.a[n])===Bh){var s=[];e.forEach((function(t){t=t||"_";var e=i.a[n].a.get("tenants");if(!e)throw Error("Invalid tenant configuration!");(e=e[t]||e[Vh])?t={tenantId:"_"!==t?t:null,V:e.fullLabel||null,displayName:e.displayName,za:e.iconUrl,ta:e.buttonColor}:(Ur("Invalid tenant configuration: "+t+" is not configured!",void 0),t=null),t&&s.push(t)}));var a=function(e){e={tenantId:e,providerIds:Fh(i.a[n],e||"_")},t(e)};if(1===s.length)return void a(s[0].tenantId);i.g=new Ph((function(t){Gh(i),o&&o(),a(t)}),s,kh(i.a[n]),Nh(i.a[n]))}else i.g=new Ah((function(){var r=i.g.j();if(r){for(var s=0;s<e.length;s++){var a=Fh(i.a[n],e[s]||"_",r);if(0!==a.length)return r={tenantId:e[s],providerIds:a,email:r},Gh(i),o&&o(),void t(r)}i.g.a(Mi({code:"no-matching-tenant-for-email"}).toString())}}),kh(i.a[n]),Nh(i.a[n]));i.g.render(i.s),(r=Dh(i.a[n]).selectTenantUiShown||null)&&r()}else{var l=Error("Invalid project configuration: API key is invalid!");l.code="invalid-configuration",i.pb(l),r(l)}}))},t.Pb=function(t,e){if(!this.a.hasOwnProperty(t))throw Error("Invalid project configuration: API key is invalid!");var i=e||void 0;Oh(this.a[t],e||"_");try{this.i=Sd.app(i).auth()}catch(r){var n=this.a[t].a.get("authDomain");if(!n)throw Error("Invalid project configuration: authDomain is required!");(t=Sd.initializeApp({apiKey:t,authDomain:n},i)).auth().tenantId=e,this.i=t.auth()}return this.i},t.Zb=function(t,e){var i=this;return new Ln((function(n,r){function o(e,n){i.j=new oh(t),_h(i.j,i.s,e,n)}var s=t.app.options.apiKey;i.a.hasOwnProperty(s)||r(Error("Invalid project configuration: API key is invalid!"));var a=function(t,e,i){return t=function(t,e){var i=zh,n=void 0===n?{}:n;return Oh(t,e),function(t,e,i){return i=void 0===i?{}:i,Object.keys(t).filter((function(t){return e.includes(t)})).reduce((function(e,i){return e[i]=t[i],e}),i)}((t=t.a.get("tenants"))[e]||t[Vh],i,n)}(t,e),(e=t.signInOptions)&&i&&(e=e.filter((function(t){return"string"==typeof t?i.includes(t):i.includes(t.provider)})),t.signInOptions=e),t}(i.a[s],t.tenantId||"_",e&&e.providerIds);Gh(i),r={signInSuccessWithAuthResult:function(t){return n(t),!1}};var l,c=Dh(i.a[s]).signInUiShown||null,u=!1;r.uiChanged=function(e,n){null===e&&"callback"===n?((e=Fe("firebaseui-id-page-callback",i.s))&&Ya(e),i.h=new Lh,i.h.render(i.s)):u||null===e&&"spinner"===n||"blank"===n||(i.h&&(i.h.m(),i.h=null),u=!0,c&&c(t.tenantId))},a.callbacks=r,a.credentialHelper="none",e&&e.email&&(l={emailHint:e.email}),i.j?i.j.Wa().then((function(){o(a,l)})):o(a,l)}))},t.reset=function(){var t=this;return zn().then((function(){t.j&&t.j.Wa()})).then((function(){t.j=null,Gh(t)}))},t.Vb=function(){var t=this;this.h||this.A||(this.A=window.setTimeout((function(){Gh(t),t.h=new Lh,t.g=t.h,t.h.render(t.s),t.A=null}),500))},t.mb=function(){window.clearTimeout(this.A),this.A=null,this.h&&(this.h.m(),this.h=null)},t.Bb=function(){return Gh(this),this.g=new zc,this.g.render(this.s),zn()},t.pb=function(t){var e,i=this,n=Mi({code:t.code}).toString()||t.message;Gh(this),t.retry&&"function"==typeof t.retry&&(e=function(){i.reset(),t.retry()}),this.g=new jc(n,e),this.g.render(this.s)},t.Rb=function(t){var e=this;return zn().then((function(){var i=e.i&&e.i.app.options.apiKey;if(!e.a.hasOwnProperty(i))throw Error("Invalid project configuration: API key is invalid!");if(Oh(e.a[i],t.tenantId||"_"),!e.i.currentUser||e.i.currentUser.uid!==t.uid)throw Error("The user being processed does not match the signed in user!");return(i=Dh(e.a[i]).beforeSignInSuccess||null)?i(t):t})).then((function(e){if(e.uid!==t.uid)throw Error("User with mismatching UID returned.");return e}))},R("firebaseui.auth.FirebaseUiHandler",jh),R("firebaseui.auth.FirebaseUiHandler.prototype.selectTenant",jh.prototype.Ub),R("firebaseui.auth.FirebaseUiHandler.prototype.getAuth",jh.prototype.Pb),R("firebaseui.auth.FirebaseUiHandler.prototype.startSignIn",jh.prototype.Zb),R("firebaseui.auth.FirebaseUiHandler.prototype.reset",jh.prototype.reset),R("firebaseui.auth.FirebaseUiHandler.prototype.showProgressBar",jh.prototype.Vb),R("firebaseui.auth.FirebaseUiHandler.prototype.hideProgressBar",jh.prototype.mb),R("firebaseui.auth.FirebaseUiHandler.prototype.completeSignOut",jh.prototype.Bb),R("firebaseui.auth.FirebaseUiHandler.prototype.handleError",jh.prototype.pb),R("firebaseui.auth.FirebaseUiHandler.prototype.processUser",jh.prototype.Rb),R("firebaseui.auth.AuthUI",oh),R("firebaseui.auth.AuthUI.getInstance",(function(t){return t=lh(t),ah[t]?ah[t]:null})),R("firebaseui.auth.AuthUI.prototype.disableAutoSignIn",oh.prototype.Db),R("firebaseui.auth.AuthUI.prototype.start",oh.prototype.start),R("firebaseui.auth.AuthUI.prototype.setConfig",oh.prototype.ib),R("firebaseui.auth.AuthUI.prototype.signIn",oh.prototype.Wb),R("firebaseui.auth.AuthUI.prototype.reset",oh.prototype.reset),R("firebaseui.auth.AuthUI.prototype.delete",oh.prototype.Wa),R("firebaseui.auth.AuthUI.prototype.isPendingRedirect",oh.prototype.nb),R("firebaseui.auth.AuthUIError",Ii),R("firebaseui.auth.AuthUIError.prototype.toJSON",Ii.prototype.toJSON),R("firebaseui.auth.CredentialHelper.GOOGLE_YOLO",$s),R("firebaseui.auth.CredentialHelper.NONE",Ys),R("firebaseui.auth.AnonymousAuthProvider.PROVIDER_ID","anonymous"),Ln.prototype.catch=Ln.prototype.Ca,Ln.prototype.finally=Ln.prototype.fc}).apply(void 0!==i.g?i.g:"undefined"!=typeof self?self:window)}.apply(void 0!==i.g?i.g:"undefined"!=typeof self?self:window),"undefined"!=typeof window&&(window.dialogPolyfill=l_());var c_=firebaseui.auth,u_=i(5072),h_=i.n(u_),d_=i(7825),p_=i.n(d_),f_=i(7659),m_=i.n(f_),g_=i(5056),__=i.n(g_),y_=i(540),v_=i.n(y_),x_=i(1113),b_=i.n(x_),w_=i(2591),E_={};E_.styleTagTransform=b_(),E_.setAttributes=__(),E_.insert=m_().bind(null,"head"),E_.domAPI=p_(),E_.insertStyleElement=v_(),h_()(w_.A,E_),w_.A&&w_.A.locals&&w_.A.locals,Sd.initializeApp({apiKey:"AIzaSyC7GBQB3LVoKhtmvMqRn5UjgWWFh4JH-yc",authDomain:"demorsi-a1501.firebaseapp.com",databaseURL:"https://demorsi-a1501-default-rtdb.firebaseio.com",projectId:"demorsi-a1501",storageBucket:"demorsi-a1501.appspot.com",messagingSenderId:"817015833630",appId:"1:817015833630:web:8527005d0d234165b21a0f"});const S_=function(t,e){const i=Gt(te(),"firestore").getImmediate({identifier:"(default)"});if(!i._initialized){const t=(t=>{const e=(t=>{var e,i;return null===(i=null===(e=u())||void 0===e?void 0:e.emulatorHosts)||void 0===i?void 0:i[t]})(t);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(i+1),10);return"["===e[0]?[e.substring(1,i-1),n]:[e.substring(0,i),n]})("firestore");t&&function(t,e,i,n={}){var r;const o=(t=kh(t,Oh))._getSettings(),s=`${e}:${i}`;if("firestore.googleapis.com"!==o.host&&o.host!==s&&Wo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:s,ssl:!1})),n.mockUserToken){let e,i;if("string"==typeof n.mockUserToken)e=n.mockUserToken,i=Bo.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i=e||"demo-project",n=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:n,exp:n+3600,auth_time:n,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(o)),""].join(".")}(n.mockUserToken,null===(r=t._app)||void 0===r?void 0:r.options.projectId);const o=n.mockUserToken.sub||n.mockUserToken.user_id;if(!o)throw new Ko(Zo.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");i=new Bo(o)}t._authCredentials=new es(new Qo(e,i))}}(i,...t)}return i}();var T_={callbacks:{signInSuccessWithAuthResult:function(t){return console.log("yes"),document.querySelector(".grey-out").style.display="none",console.log(t.user.uid),!1},uiShown:function(){document.getElementById("loader").style.display="none"}},signInOptions:[{provider:Sd.auth.EmailAuthProvider.PROVIDER_ID,requireDisplayName:!1}]},M_=new c_.AuthUI(Sd.auth());async function I_(t,e){const i=function(t,e){if(t=kh(t,Oh),function(t,e,i){if(!i)throw new Ko(Zo.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Ko(Zo.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Fh(t,null,function(t){return new Ba(fs.emptyPath(),t)}(e))}(S_,"Images"),n=await function(t,e,...i){let n=[];e instanceof rd&&n.push(e),n=n.concat(i),function(t){const e=t.filter((t=>t instanceof ld)).length,i=t.filter((t=>t instanceof sd)).length;if(e>1||e>0&&i>0)throw new Ko(Zo.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const e of n)t=e._apply(t);return t}(i,(1e3,function(t,e){if(e<=0)throw new Ko(Zo.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}("limit",1e3),cd._create("limit",1e3,"F")),ad("Date",">=",t),ad("Date","<=",e));const r=await function(t){t=kh(t,Fh);const e=kh(t.firestore,Vh),i=function(t){return t._firestoreClient||jh(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}(e),n=new vd(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Ko(Zo.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),Ph(i,t._query).then((i=>new _d(e,n,t,i)))}(n),o=[];return r.forEach((t=>{o.push({id:t.id,data:t.data()})})),console.log("Size of query: "+o.length),o}M_.start("#firebaseui-auth-container",T_),M_.isPendingRedirect()&&M_.start("#firebaseui-auth-container",T_);var C_=6371008.8,A_={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:C_,metres:C_,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:3440.069546436285,radians:1,yards:6967335.223679999};function P_(t,e,i){void 0===i&&(i={});var n={type:"Feature"};return(0===i.id||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=e||{},n.geometry=t,n}function L_(t,e,i){if(void 0===i&&(i={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!F_(t[0])||!F_(t[1]))throw new Error("coordinates must contain numbers");return P_({type:"Point",coordinates:t},e,i)}function R_(t,e,i){void 0===i&&(i={});for(var n=0,r=t;n<r.length;n++){var o=r[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<o[o.length-1].length;s++)if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}return P_({type:"Polygon",coordinates:t},e,i)}function D_(t,e,i){if(void 0===i&&(i={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return P_({type:"LineString",coordinates:t},e,i)}function k_(t,e){void 0===e&&(e="kilometers");var i=A_[e];if(!i)throw new Error(e+" units is invalid");return t*i}function N_(t){return t%360*Math.PI/180}function O_(t,e,i){if(void 0===e&&(e="kilometers"),void 0===i&&(i="kilometers"),!(t>=0))throw new Error("length must be a positive number");return k_(function(t,e){void 0===e&&(e="kilometers");var i=A_[e];if(!i)throw new Error(e+" units is invalid");return t/i}(t,e),i)}function F_(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function z_(t,e,i){if(null!==t)for(var n,r,o,s,a,l,c,u,h=0,d=0,p=t.type,f="FeatureCollection"===p,m="Feature"===p,g=f?t.features.length:1,_=0;_<g;_++){a=(u=!!(c=f?t.features[_].geometry:m?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var y=0;y<a;y++){var v=0,x=0;if(null!==(s=u?c.geometries[y]:c)){l=s.coordinates;var b=s.type;switch(h=!i||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===e(l,d,_,v,x))return!1;d++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(!1===e(l[n],d,_,v,x))return!1;d++,"MultiPoint"===b&&v++}"LineString"===b&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(r=0;r<l[n].length-h;r++){if(!1===e(l[n][r],d,_,v,x))return!1;d++}"MultiLineString"===b&&v++,"Polygon"===b&&x++}"Polygon"===b&&v++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(x=0,r=0;r<l[n].length;r++){for(o=0;o<l[n][r].length-h;o++){if(!1===e(l[n][r][o],d,_,v,x))return!1;d++}x++}v++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(!1===z_(s.geometries[n],e,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function B_(t,e){var i,n,r,o,s,a,l,c,u,h,d=0,p="FeatureCollection"===t.type,f="Feature"===t.type,m=p?t.features.length:1;for(i=0;i<m;i++){for(a=p?t.features[i].geometry:f?t.geometry:t,c=p?t.features[i].properties:f?t.properties:{},u=p?t.features[i].bbox:f?t.bbox:void 0,h=p?t.features[i].id:f?t.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,r=0;r<s;r++)if(null!==(o=l?a.geometries[r]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,d,c,u,h))return!1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===e(o.geometries[n],d,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,d,c,u,h))return!1;d++}}function U_(t,e){B_(t,(function(t,i,n,r,o){var s,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==e(P_(t,n,{bbox:r,id:o}),i,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<t.coordinates.length;l++){var c=t.coordinates[l];if(!1===e(P_({type:s,coordinates:c},n),i,l))return!1}}))}function V_(t){var e=[1/0,1/0,-1/0,-1/0];return z_(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}V_.default=V_;const j_=V_;function G_(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function H_(t,e,i){if(!t)throw new Error("No feature passed");if(!i)throw new Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+i+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+i+": must be a "+e+", given "+t.geometry.type)}var W_=i(1664);function q_(t,e,i){if(void 0===i&&(i={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n=G_(t),r=function(t){return"Feature"===t.type?t.geometry:t}(e),o=r.type,s=e.bbox,a=r.coordinates;if(s&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(n,s))return!1;"Polygon"===o&&(a=[a]);for(var l=!1,c=0;c<a.length&&!l;c++)if(X_(n,a[c][0],i.ignoreBoundary)){for(var u=!1,h=1;h<a[c].length&&!u;)X_(n,a[c][h],!i.ignoreBoundary)&&(u=!0),h++;u||(l=!0)}return l}function X_(t,e,i){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var r=0,o=e.length-1;r<e.length;o=r++){var s=e[r][0],a=e[r][1],l=e[o][0],c=e[o][1];if(t[1]*(s-l)+a*(l-t[0])+c*(t[0]-s)==0&&(s-t[0])*(l-t[0])<=0&&(a-t[1])*(c-t[1])<=0)return!i;a>t[1]!=c>t[1]&&t[0]<(l-s)*(t[1]-a)/(c-a)+s&&(n=!n)}return n}i(5114);Object.prototype.hasOwnProperty;var $_=new ArrayBuffer(16);new Float64Array($_),new Uint32Array($_),i(5011),function(){function t(t){this.points=t.points||[],this.duration=t.duration||1e4,this.sharpness=t.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=t.stepLength||60,this.length=this.points.length,this.delay=0;for(var e=0;e<this.length;e++)this.points[e].z=this.points[e].z||0;for(e=0;e<this.length-1;e++){var i=this.points[e],n=this.points[e+1];this.centers.push({x:(i.x+n.x)/2,y:(i.y+n.y)/2,z:(i.z+n.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),e=0;e<this.centers.length-1;e++){var r=this.points[e+1].x-(this.centers[e].x+this.centers[e+1].x)/2,o=this.points[e+1].y-(this.centers[e].y+this.centers[e+1].y)/2,s=this.points[e+1].z-(this.centers[e].y+this.centers[e+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e].x+r),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e].z+s)},{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e+1].x+r),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e+1].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e+1].z+s)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}t.prototype.cacheSteps=function(t){var e=[],i=this.pos(0);e.push(0);for(var n=0;n<this.duration;n+=10){var r=this.pos(n);Math.sqrt((r.x-i.x)*(r.x-i.x)+(r.y-i.y)*(r.y-i.y)+(r.z-i.z)*(r.z-i.z))>t&&(e.push(n),i=r)}return e},t.prototype.vector=function(t){var e=this.pos(t+10),i=this.pos(t-10);return{angle:180*Math.atan2(e.y-i.y,e.x-i.x)/3.14,speed:Math.sqrt((i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)+(i.z-e.z)*(i.z-e.z))}},t.prototype.pos=function(t){var e=t-this.delay;e<0&&(e=0),e>this.duration&&(e=this.duration-1);var i=e/this.duration;if(i>=1)return this.points[this.length-1];var n=Math.floor((this.points.length-1)*i);return function(t,e,i,n,r){var o=function(t){var e=t*t;return[e*t,3*e*(1-t),3*t*(1-t)*(1-t),(1-t)*(1-t)*(1-t)]}(t);return{x:r.x*o[0]+n.x*o[1]+i.x*o[2]+e.x*o[3],y:r.y*o[0]+n.y*o[1]+i.y*o[2]+e.y*o[3],z:r.z*o[0]+n.z*o[1]+i.z*o[2]+e.z*o[3]}}((this.length-1)*i-n,this.points[n],this.controls[n][1],this.controls[n+1][0],this.points[n+1])}}();i(5230),i(9565);function Y_(t,e){return t[0]*e[0]+t[1]*e[1]}function Z_(t,e,i){return"planar"===i.method?function(t,e,i){void 0===i&&(i={});var n=G_(t),r=G_(e);r[0]+=r[0]-n[0]>180?-360:n[0]-r[0]>180?360:0;var o=function(t,e,i){var n=i=void 0===i?C_:Number(i),r=t[1]*Math.PI/180,o=e[1]*Math.PI/180,s=o-r,a=Math.abs(e[0]-t[0])*Math.PI/180;a>Math.PI&&(a-=2*Math.PI);var l=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(r/2+Math.PI/4)),c=Math.abs(l)>1e-11?s/l:Math.cos(r);return Math.sqrt(s*s+c*c*a*a)*n}(n,r);return O_(o,"meters",i.units)}(t,e,i):function(t,e,i){void 0===i&&(i={});var n=G_(t),r=G_(e),o=N_(r[1]-n[1]),s=N_(r[0]-n[0]),a=N_(n[1]),l=N_(r[1]),c=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return k_(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),i.units)}(t,e,i)}const K_=function(t,e,i){if(void 0===i&&(i={}),i.method||(i.method="geodesic"),i.units||(i.units="kilometers"),!t)throw new Error("pt is required");if(Array.isArray(t)?t=L_(t):"Point"===t.type?t=P_(t):H_(t,"Point","point"),!e)throw new Error("line is required");Array.isArray(e)?e=D_(e):"LineString"===e.type?e=P_(e):H_(e,"LineString","line");var n=1/0,r=t.geometry.coordinates;return function(t,e){U_(t,(function(t,i,n){var r=0;if(t.geometry){var o=t.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var s,a=0,l=0,c=0;return!1!==z_(t,(function(o,u,h,d,p){if(void 0===s||i>a||d>l||p>c)return s=o,a=i,l=d,c=p,void(r=0);var f=D_([s,o],t.properties);if(!1===e(f,i,n,p,r))return!1;r++,s=o}))&&void 0}}}))}(e,(function(t){var e=t.geometry.coordinates[0],o=t.geometry.coordinates[1],s=function(t,e,i,n){var r=[i[0]-e[0],i[1]-e[1]],o=Y_([t[0]-e[0],t[1]-e[1]],r);if(o<=0)return Z_(t,e,{method:n.method,units:"degrees"});var s=Y_(r,r);if(s<=o)return Z_(t,i,{method:n.method,units:"degrees"});var a=o/s;return Z_(t,[e[0]+a*r[0],e[1]+a*r[1]],{method:n.method,units:"degrees"})}(r,e,o,i);s<n&&(n=s)})),O_(n,"degrees",i.units)};var J_=Math.PI/180,Q_=180/Math.PI,ty=function(t,e){this.lon=t,this.lat=e,this.x=J_*t,this.y=J_*e};ty.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},ty.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:-1*(180-this.lon);return new ty(e,t)};var ey=function(){this.coords=[],this.length=0};ey.prototype.move_to=function(t){this.length++,this.coords.push(t)};var iy=function(t){this.properties=t||{},this.geometries=[]};iy.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},iy.prototype.wkt=function(){for(var t="",e="LINESTRING(",i=function(t){e+=t[0]+" "+t[1]+","},n=0;n<this.geometries.length;n++){if(0===this.geometries[n].coords.length)return"LINESTRING(empty)";this.geometries[n].coords.forEach(i),t+=e.substring(0,e.length-1)+")"}return t};var ny=function(t,e,i){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new ty(t.x,t.y),this.end=new ty(e.x,e.y),this.properties=i||{};var n=this.start.x-this.end.x,r=this.start.y-this.end.y,o=Math.pow(Math.sin(r/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(n/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g===Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};ny.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),i=Math.sin(t*this.g)/Math.sin(this.g),n=e*Math.cos(this.start.y)*Math.cos(this.start.x)+i*Math.cos(this.end.y)*Math.cos(this.end.x),r=e*Math.cos(this.start.y)*Math.sin(this.start.x)+i*Math.cos(this.end.y)*Math.sin(this.end.x),o=e*Math.sin(this.start.y)+i*Math.sin(this.end.y),s=Q_*Math.atan2(o,Math.sqrt(Math.pow(n,2)+Math.pow(r,2)));return[Q_*Math.atan2(r,n),s]},ny.prototype.Arc=function(t,e){var i=[];if(!t||t<=2)i.push([this.start.lon,this.start.lat]),i.push([this.end.lon,this.end.lat]);else for(var n=1/(t-1),r=0;r<t;++r){var o=n*r,s=this.interpolate(o);i.push(s)}for(var a=!1,l=0,c=e&&e.offset?e.offset:10,u=180-c,h=-180+c,d=360-c,p=1;p<i.length;++p){var f=i[p-1][0],m=i[p][0],g=Math.abs(m-f);g>d&&(m>u&&f<h||f>u&&m<h)?a=!0:g>l&&(l=g)}var _=[];if(a&&l<c){var y=[];_.push(y);for(var v=0;v<i.length;++v){var x=parseFloat(i[v][0]);if(v>0&&Math.abs(x-i[v-1][0])>d){var b=parseFloat(i[v-1][0]),w=parseFloat(i[v-1][1]),E=parseFloat(i[v][0]),S=parseFloat(i[v][1]);if(b>-180&&b<h&&180===E&&v+1<i.length&&i[v-1][0]>-180&&i[v-1][0]<h){y.push([-180,i[v][1]]),v++,y.push([i[v][0],i[v][1]]);continue}if(b>u&&b<180&&-180===E&&v+1<i.length&&i[v-1][0]>u&&i[v-1][0]<180){y.push([180,i[v][1]]),v++,y.push([i[v][0],i[v][1]]);continue}if(b<h&&E>u){var T=b;b=E,E=T;var M=w;w=S,S=M}if(b>u&&E<h&&(E+=360),b<=180&&E>=180&&b<E){var I=(180-b)/(E-b),C=I*S+(1-I)*w;y.push([i[v-1][0]>u?180:-180,C]),(y=[]).push([i[v-1][0]>u?-180:180,C]),_.push(y)}else y=[],_.push(y);y.push([x,i[v][1]])}else y.push([i[v][0],i[v][1]])}}else{var A=[];_.push(A);for(var P=0;P<i.length;++P)A.push([i[P][0],i[P][1]])}for(var L=new iy(this.properties),R=0;R<_.length;++R){var D=new ey;L.geometries.push(D);for(var k=_[R],N=0;N<k.length;++N)D.move_to(k[N])}return L},i(3498);var ry=[],oy=[],sy=[],ay=[],ly=[],cy=[],uy=[],hy=[],dy=[],py=[],fy=[],my=[],gy=[],_y=[],yy=[],vy=[],xy=[],by=[],wy=[],Ey=[],Sy=[],Ty=[],My=[],Iy=[];uy[85]=py[85]=-1,hy[85]=fy[85]=0,dy[85]=my[85]=1,wy[85]=Ty[85]=1,Ey[85]=My[85]=0,Sy[85]=Iy[85]=1,ry[85]=ay[85]=0,oy[85]=ly[85]=-1,sy[85]=yy[85]=0,vy[85]=gy[85]=0,xy[85]=_y[85]=1,cy[85]=by[85]=1,Ty[1]=Ty[169]=0,My[1]=My[169]=-1,Iy[1]=Iy[169]=0,gy[1]=gy[169]=-1,_y[1]=_y[169]=0,yy[1]=yy[169]=0,py[4]=py[166]=0,fy[4]=fy[166]=-1,my[4]=my[166]=1,vy[4]=vy[166]=1,xy[4]=xy[166]=0,by[4]=by[166]=0,uy[16]=uy[154]=0,hy[16]=hy[154]=1,dy[16]=dy[154]=1,ay[16]=ay[154]=1,ly[16]=ly[154]=0,cy[16]=cy[154]=1,wy[64]=wy[106]=0,Ey[64]=Ey[106]=1,Sy[64]=Sy[106]=0,ry[64]=ry[106]=-1,oy[64]=oy[106]=0,sy[64]=sy[106]=1,wy[2]=wy[168]=0,Ey[2]=Ey[168]=-1,Sy[2]=Sy[168]=1,Ty[2]=Ty[168]=0,My[2]=My[168]=-1,Iy[2]=Iy[168]=0,gy[2]=gy[168]=-1,_y[2]=_y[168]=0,yy[2]=yy[168]=0,vy[2]=vy[168]=-1,xy[2]=xy[168]=0,by[2]=by[168]=1,uy[8]=uy[162]=0,hy[8]=hy[162]=-1,dy[8]=dy[162]=0,py[8]=py[162]=0,fy[8]=fy[162]=-1,my[8]=my[162]=1,gy[8]=gy[162]=1,_y[8]=_y[162]=0,yy[8]=yy[162]=1,vy[8]=vy[162]=1,xy[8]=xy[162]=0,by[8]=by[162]=0,uy[32]=uy[138]=0,hy[32]=hy[138]=1,dy[32]=dy[138]=1,py[32]=py[138]=0,fy[32]=fy[138]=1,my[32]=my[138]=0,ry[32]=ry[138]=1,oy[32]=oy[138]=0,sy[32]=sy[138]=0,ay[32]=ay[138]=1,ly[32]=ly[138]=0,cy[32]=cy[138]=1,Ty[128]=Ty[42]=0,My[128]=My[42]=1,Iy[128]=Iy[42]=1,wy[128]=wy[42]=0,Ey[128]=Ey[42]=1,Sy[128]=Sy[42]=0,ry[128]=ry[42]=-1,oy[128]=oy[42]=0,sy[128]=sy[42]=1,ay[128]=ay[42]=-1,ly[128]=ly[42]=0,cy[128]=cy[42]=0,py[5]=py[165]=-1,fy[5]=fy[165]=0,my[5]=my[165]=0,Ty[5]=Ty[165]=1,My[5]=My[165]=0,Iy[5]=Iy[165]=0,vy[20]=vy[150]=0,xy[20]=xy[150]=1,by[20]=by[150]=1,ay[20]=ay[150]=0,ly[20]=ly[150]=-1,cy[20]=cy[150]=1,uy[80]=uy[90]=-1,hy[80]=hy[90]=0,dy[80]=dy[90]=1,wy[80]=wy[90]=1,Ey[80]=Ey[90]=0,Sy[80]=Sy[90]=1,gy[65]=gy[105]=0,_y[65]=_y[105]=1,yy[65]=yy[105]=0,ry[65]=ry[105]=0,oy[65]=oy[105]=-1,sy[65]=sy[105]=0,uy[160]=uy[10]=-1,hy[160]=hy[10]=0,dy[160]=dy[10]=1,py[160]=py[10]=-1,fy[160]=fy[10]=0,my[160]=my[10]=0,Ty[160]=Ty[10]=1,My[160]=My[10]=0,Iy[160]=Iy[10]=0,wy[160]=wy[10]=1,Ey[160]=Ey[10]=0,Sy[160]=Sy[10]=1,vy[130]=vy[40]=0,xy[130]=xy[40]=1,by[130]=by[40]=1,gy[130]=gy[40]=0,_y[130]=_y[40]=1,yy[130]=yy[40]=0,ry[130]=ry[40]=0,oy[130]=oy[40]=-1,sy[130]=sy[40]=0,ay[130]=ay[40]=0,ly[130]=ly[40]=-1,cy[130]=cy[40]=1,py[37]=py[133]=0,fy[37]=fy[133]=1,my[37]=my[133]=1,Ty[37]=Ty[133]=0,My[37]=My[133]=1,Iy[37]=Iy[133]=0,ry[37]=ry[133]=-1,oy[37]=oy[133]=0,sy[37]=sy[133]=0,ay[37]=ay[133]=1,ly[37]=ly[133]=0,cy[37]=cy[133]=0,vy[148]=vy[22]=-1,xy[148]=xy[22]=0,by[148]=by[22]=0,Ty[148]=Ty[22]=0,My[148]=My[22]=-1,Iy[148]=Iy[22]=1,wy[148]=wy[22]=0,Ey[148]=Ey[22]=1,Sy[148]=Sy[22]=1,ay[148]=ay[22]=-1,ly[148]=ly[22]=0,cy[148]=cy[22]=1,uy[82]=uy[88]=0,hy[82]=hy[88]=-1,dy[82]=dy[88]=1,vy[82]=vy[88]=1,xy[82]=xy[88]=0,by[82]=by[88]=1,gy[82]=gy[88]=-1,_y[82]=_y[88]=0,yy[82]=yy[88]=1,wy[82]=wy[88]=0,Ey[82]=Ey[88]=-1,Sy[82]=Sy[88]=0,uy[73]=uy[97]=0,hy[73]=hy[97]=1,dy[73]=dy[97]=0,py[73]=py[97]=0,fy[73]=fy[97]=-1,my[73]=my[97]=0,gy[73]=gy[97]=1,_y[73]=_y[97]=0,yy[73]=yy[97]=0,ry[73]=ry[97]=1,oy[73]=oy[97]=0,sy[73]=sy[97]=1,uy[145]=uy[25]=0,hy[145]=hy[25]=-1,dy[145]=dy[25]=0,gy[145]=gy[25]=1,_y[145]=_y[25]=0,yy[145]=yy[25]=1,Ty[145]=Ty[25]=0,My[145]=My[25]=1,Iy[145]=Iy[25]=1,ay[145]=ay[25]=-1,ly[145]=ly[25]=0,cy[145]=cy[25]=0,py[70]=py[100]=0,fy[70]=fy[100]=1,my[70]=my[100]=0,vy[70]=vy[100]=-1,xy[70]=xy[100]=0,by[70]=by[100]=1,wy[70]=wy[100]=0,Ey[70]=Ey[100]=-1,Sy[70]=Sy[100]=1,ry[70]=ry[100]=1,oy[70]=oy[100]=0,sy[70]=sy[100]=0,py[101]=py[69]=0,fy[101]=fy[69]=1,my[101]=my[69]=0,ry[101]=ry[69]=1,oy[101]=oy[69]=0,sy[101]=sy[69]=0,Ty[149]=Ty[21]=0,My[149]=My[21]=1,Iy[149]=Iy[21]=1,ay[149]=ay[21]=-1,ly[149]=ly[21]=0,cy[149]=cy[21]=0,vy[86]=vy[84]=-1,xy[86]=xy[84]=0,by[86]=by[84]=1,wy[86]=wy[84]=0,Ey[86]=Ey[84]=-1,Sy[86]=Sy[84]=1,uy[89]=uy[81]=0,hy[89]=hy[81]=-1,dy[89]=dy[81]=0,gy[89]=gy[81]=1,_y[89]=_y[81]=0,yy[89]=yy[81]=1,uy[96]=uy[74]=0,hy[96]=hy[74]=1,dy[96]=dy[74]=0,py[96]=py[74]=-1,fy[96]=fy[74]=0,my[96]=my[74]=1,wy[96]=wy[74]=1,Ey[96]=Ey[74]=0,Sy[96]=Sy[74]=0,ry[96]=ry[74]=1,oy[96]=oy[74]=0,sy[96]=sy[74]=1,uy[24]=uy[146]=0,hy[24]=hy[146]=-1,dy[24]=dy[146]=1,vy[24]=vy[146]=1,xy[24]=xy[146]=0,by[24]=by[146]=1,gy[24]=gy[146]=0,_y[24]=_y[146]=1,yy[24]=yy[146]=1,ay[24]=ay[146]=0,ly[24]=ly[146]=-1,cy[24]=cy[146]=0,py[6]=py[164]=-1,fy[6]=fy[164]=0,my[6]=my[164]=1,vy[6]=vy[164]=-1,xy[6]=xy[164]=0,by[6]=by[164]=0,Ty[6]=Ty[164]=0,My[6]=My[164]=-1,Iy[6]=Iy[164]=1,wy[6]=wy[164]=1,Ey[6]=Ey[164]=0,Sy[6]=Sy[164]=0,gy[129]=gy[41]=0,_y[129]=_y[41]=1,yy[129]=yy[41]=1,Ty[129]=Ty[41]=0,My[129]=My[41]=1,Iy[129]=Iy[41]=0,ry[129]=ry[41]=-1,oy[129]=oy[41]=0,sy[129]=sy[41]=0,ay[129]=ay[41]=0,ly[129]=ly[41]=-1,cy[129]=cy[41]=0,vy[66]=vy[104]=0,xy[66]=xy[104]=1,by[66]=by[104]=0,gy[66]=gy[104]=-1,_y[66]=_y[104]=0,yy[66]=yy[104]=1,wy[66]=wy[104]=0,Ey[66]=Ey[104]=-1,Sy[66]=Sy[104]=0,ry[66]=ry[104]=0,oy[66]=oy[104]=-1,sy[66]=sy[104]=1,uy[144]=uy[26]=-1,hy[144]=hy[26]=0,dy[144]=dy[26]=0,Ty[144]=Ty[26]=1,My[144]=My[26]=0,Iy[144]=Iy[26]=1,wy[144]=wy[26]=0,Ey[144]=Ey[26]=1,Sy[144]=Sy[26]=1,ay[144]=ay[26]=-1,ly[144]=ly[26]=0,cy[144]=cy[26]=1,py[36]=py[134]=0,fy[36]=fy[134]=1,my[36]=my[134]=1,vy[36]=vy[134]=0,xy[36]=xy[134]=1,by[36]=by[134]=0,ry[36]=ry[134]=0,oy[36]=oy[134]=-1,sy[36]=sy[134]=1,ay[36]=ay[134]=1,ly[36]=ly[134]=0,cy[36]=cy[134]=0,uy[9]=uy[161]=-1,hy[9]=hy[161]=0,dy[9]=dy[161]=0,py[9]=py[161]=0,fy[9]=fy[161]=-1,my[9]=my[161]=0,gy[9]=gy[161]=1,_y[9]=_y[161]=0,yy[9]=yy[161]=0,Ty[9]=Ty[161]=1,My[9]=My[161]=0,Iy[9]=Iy[161]=1,uy[136]=0,hy[136]=1,dy[136]=1,py[136]=0,fy[136]=1,my[136]=0,vy[136]=-1,xy[136]=0,by[136]=1,gy[136]=-1,_y[136]=0,yy[136]=0,Ty[136]=0,My[136]=-1,Iy[136]=0,wy[136]=0,Ey[136]=-1,Sy[136]=1,ry[136]=1,oy[136]=0,sy[136]=0,ay[136]=1,ly[136]=0,cy[136]=1,uy[34]=0,hy[34]=-1,dy[34]=0,py[34]=0,fy[34]=-1,my[34]=1,vy[34]=1,xy[34]=0,by[34]=0,gy[34]=1,_y[34]=0,yy[34]=1,Ty[34]=0,My[34]=1,Iy[34]=1,wy[34]=0,Ey[34]=1,Sy[34]=0,ry[34]=-1,oy[34]=0,sy[34]=1,ay[34]=-1,ly[34]=0,cy[34]=0,uy[35]=0,hy[35]=1,dy[35]=1,py[35]=0,fy[35]=-1,my[35]=1,vy[35]=1,xy[35]=0,by[35]=0,gy[35]=-1,_y[35]=0,yy[35]=0,Ty[35]=0,My[35]=-1,Iy[35]=0,wy[35]=0,Ey[35]=1,Sy[35]=0,ry[35]=-1,oy[35]=0,sy[35]=1,ay[35]=1,ly[35]=0,cy[35]=1,uy[153]=0,hy[153]=1,dy[153]=1,gy[153]=-1,_y[153]=0,yy[153]=0,Ty[153]=0,My[153]=-1,Iy[153]=0,ay[153]=1,ly[153]=0,cy[153]=1,py[102]=0,fy[102]=-1,my[102]=1,vy[102]=1,xy[102]=0,by[102]=0,wy[102]=0,Ey[102]=1,Sy[102]=0,ry[102]=-1,oy[102]=0,sy[102]=1,uy[155]=0,hy[155]=-1,dy[155]=0,gy[155]=1,_y[155]=0,yy[155]=1,Ty[155]=0,My[155]=1,Iy[155]=1,ay[155]=-1,ly[155]=0,cy[155]=0,py[103]=0,fy[103]=1,my[103]=0,vy[103]=-1,xy[103]=0,by[103]=1,wy[103]=0,Ey[103]=-1,Sy[103]=1,ry[103]=1,oy[103]=0,sy[103]=0,uy[152]=0,hy[152]=1,dy[152]=1,vy[152]=-1,xy[152]=0,by[152]=1,gy[152]=-1,_y[152]=0,yy[152]=0,Ty[152]=0,My[152]=-1,Iy[152]=0,wy[152]=0,Ey[152]=-1,Sy[152]=1,ay[152]=1,ly[152]=0,cy[152]=1,uy[156]=0,hy[156]=-1,dy[156]=1,vy[156]=1,xy[156]=0,by[156]=1,gy[156]=-1,_y[156]=0,yy[156]=0,Ty[156]=0,My[156]=-1,Iy[156]=0,wy[156]=0,Ey[156]=1,Sy[156]=1,ay[156]=-1,ly[156]=0,cy[156]=1,uy[137]=0,hy[137]=1,dy[137]=1,py[137]=0,fy[137]=1,my[137]=0,gy[137]=-1,_y[137]=0,yy[137]=0,Ty[137]=0,My[137]=-1,Iy[137]=0,ry[137]=1,oy[137]=0,sy[137]=0,ay[137]=1,ly[137]=0,cy[137]=1,uy[139]=0,hy[139]=1,dy[139]=1,py[139]=0,fy[139]=-1,my[139]=0,gy[139]=1,_y[139]=0,yy[139]=0,Ty[139]=0,My[139]=1,Iy[139]=0,ry[139]=-1,oy[139]=0,sy[139]=0,ay[139]=1,ly[139]=0,cy[139]=1,uy[98]=0,hy[98]=-1,dy[98]=0,py[98]=0,fy[98]=-1,my[98]=1,vy[98]=1,xy[98]=0,by[98]=0,gy[98]=1,_y[98]=0,yy[98]=1,wy[98]=0,Ey[98]=1,Sy[98]=0,ry[98]=-1,oy[98]=0,sy[98]=1,uy[99]=0,hy[99]=1,dy[99]=0,py[99]=0,fy[99]=-1,my[99]=1,vy[99]=1,xy[99]=0,by[99]=0,gy[99]=-1,_y[99]=0,yy[99]=1,wy[99]=0,Ey[99]=-1,Sy[99]=0,ry[99]=1,oy[99]=0,sy[99]=1,py[38]=0,fy[38]=-1,my[38]=1,vy[38]=1,xy[38]=0,by[38]=0,Ty[38]=0,My[38]=1,Iy[38]=1,wy[38]=0,Ey[38]=1,Sy[38]=0,ry[38]=-1,oy[38]=0,sy[38]=1,ay[38]=-1,ly[38]=0,cy[38]=0,py[39]=0,fy[39]=1,my[39]=1,vy[39]=-1,xy[39]=0,by[39]=0,Ty[39]=0,My[39]=-1,Iy[39]=1,wy[39]=0,Ey[39]=1,Sy[39]=0,ry[39]=-1,oy[39]=0,sy[39]=1,ay[39]=1,ly[39]=0,cy[39]=0;var Cy=function(t){return[[t.bottomleft,0],[0,0],[0,t.leftbottom]]},Ay=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0]]},Py=function(t){return[[t.topright,1],[1,1],[1,t.righttop]]},Ly=function(t){return[[0,t.lefttop],[0,1],[t.topleft,1]]},Ry=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop]]},Dy=function(t){return[[t.bottomright,0],[t.bottomleft,0],[1,t.righttop],[1,t.rightbottom]]},ky=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.topleft,1],[t.topright,1]]},Ny=function(t){return[[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Oy=[],Fy=[],zy=[],By=[],Uy=[],Vy=[],jy=[],Gy=[];By[1]=Uy[1]=18,By[169]=Uy[169]=18,zy[4]=Fy[4]=12,zy[166]=Fy[166]=12,Oy[16]=Gy[16]=4,Oy[154]=Gy[154]=4,Vy[64]=jy[64]=22,Vy[106]=jy[106]=22,zy[2]=Vy[2]=17,By[2]=Uy[2]=18,zy[168]=Vy[168]=17,By[168]=Uy[168]=18,Oy[8]=By[8]=9,Fy[8]=zy[8]=12,Oy[162]=By[162]=9,Fy[162]=zy[162]=12,Oy[32]=Gy[32]=4,Fy[32]=jy[32]=1,Oy[138]=Gy[138]=4,Fy[138]=jy[138]=1,Uy[128]=Gy[128]=21,Vy[128]=jy[128]=22,Uy[42]=Gy[42]=21,Vy[42]=jy[42]=22,Fy[5]=Uy[5]=14,Fy[165]=Uy[165]=14,zy[20]=Gy[20]=6,zy[150]=Gy[150]=6,Oy[80]=Vy[80]=11,Oy[90]=Vy[90]=11,By[65]=jy[65]=3,By[105]=jy[105]=3,Oy[160]=Vy[160]=11,Fy[160]=Uy[160]=14,Oy[10]=Vy[10]=11,Fy[10]=Uy[10]=14,zy[130]=Gy[130]=6,By[130]=jy[130]=3,zy[40]=Gy[40]=6,By[40]=jy[40]=3,Fy[101]=jy[101]=1,Fy[69]=jy[69]=1,Uy[149]=Gy[149]=21,Uy[21]=Gy[21]=21,zy[86]=Vy[86]=17,zy[84]=Vy[84]=17,Oy[89]=By[89]=9,Oy[81]=By[81]=9,Oy[96]=jy[96]=0,Fy[96]=Vy[96]=15,Oy[74]=jy[74]=0,Fy[74]=Vy[74]=15,Oy[24]=zy[24]=8,By[24]=Gy[24]=7,Oy[146]=zy[146]=8,By[146]=Gy[146]=7,Fy[6]=Vy[6]=15,zy[6]=Uy[6]=16,Fy[164]=Vy[164]=15,zy[164]=Uy[164]=16,By[129]=Gy[129]=7,Uy[129]=jy[129]=20,By[41]=Gy[41]=7,Uy[41]=jy[41]=20,zy[66]=jy[66]=2,By[66]=Vy[66]=19,zy[104]=jy[104]=2,By[104]=Vy[104]=19,Oy[144]=Uy[144]=10,Vy[144]=Gy[144]=23,Oy[26]=Uy[26]=10,Vy[26]=Gy[26]=23,Fy[36]=Gy[36]=5,zy[36]=jy[36]=2,Fy[134]=Gy[134]=5,zy[134]=jy[134]=2,Oy[9]=Uy[9]=10,Fy[9]=By[9]=13,Oy[161]=Uy[161]=10,Fy[161]=By[161]=13,Fy[37]=Gy[37]=5,Uy[37]=jy[37]=20,Fy[133]=Gy[133]=5,Uy[133]=jy[133]=20,zy[148]=Uy[148]=16,Vy[148]=Gy[148]=23,zy[22]=Uy[22]=16,Vy[22]=Gy[22]=23,Oy[82]=zy[82]=8,By[82]=Vy[82]=19,Oy[88]=zy[88]=8,By[88]=Vy[88]=19,Oy[73]=jy[73]=0,Fy[73]=By[73]=13,Oy[97]=jy[97]=0,Fy[97]=By[97]=13,Oy[145]=By[145]=9,Uy[145]=Gy[145]=21,Oy[25]=By[25]=9,Uy[25]=Gy[25]=21,Fy[70]=jy[70]=1,zy[70]=Vy[70]=17,Fy[100]=jy[100]=1,zy[100]=Vy[100]=17,Oy[34]=By[34]=9,Fy[34]=zy[34]=12,Uy[34]=Gy[34]=21,Vy[34]=jy[34]=22,Oy[136]=Gy[136]=4,Fy[136]=jy[136]=1,zy[136]=Vy[136]=17,By[136]=Uy[136]=18,Oy[35]=Gy[35]=4,Fy[35]=zy[35]=12,By[35]=Uy[35]=18,Vy[35]=jy[35]=22,Oy[153]=Gy[153]=4,By[153]=Uy[153]=18,Fy[102]=zy[102]=12,Vy[102]=jy[102]=22,Oy[155]=By[155]=9,Uy[155]=Gy[155]=23,Fy[103]=jy[103]=1,zy[103]=Vy[103]=17,Oy[152]=Gy[152]=4,zy[152]=Vy[152]=17,By[152]=Uy[152]=18,Oy[156]=zy[156]=8,By[156]=Uy[156]=18,Vy[156]=Gy[156]=23,Oy[137]=Gy[137]=4,Fy[137]=jy[137]=1,By[137]=Uy[137]=18,Oy[139]=Gy[139]=4,Fy[139]=By[139]=13,Uy[139]=jy[139]=20,Oy[98]=By[98]=9,Fy[98]=zy[98]=12,Vy[98]=jy[98]=22,Oy[99]=jy[99]=0,Fy[99]=zy[99]=12,By[99]=Vy[99]=19,Fy[38]=zy[38]=12,Uy[38]=Gy[38]=21,Vy[38]=jy[38]=22,Fy[39]=Gy[39]=5,zy[39]=Uy[39]=16,Vy[39]=jy[39]=22;var Hy=[];function Wy(t,e,i){var n=e[0]-t[0],r=e[1]-t[1],o=i[0]-e[0];return function(t){return(t>0)-(t<0)||+t}(n*(i[1]-e[1])-o*r)}function qy(t,e){return e.geometry.coordinates[0].every((function(e){return q_(L_(e),t)}))}Hy[1]=Hy[169]=Cy,Hy[4]=Hy[166]=Ay,Hy[16]=Hy[154]=Py,Hy[64]=Hy[106]=Ly,Hy[168]=Hy[2]=Ry,Hy[162]=Hy[8]=Dy,Hy[138]=Hy[32]=ky,Hy[42]=Hy[128]=Ny,Hy[5]=Hy[165]=function(t){return[[0,0],[0,t.leftbottom],[1,t.rightbottom],[1,0]]},Hy[20]=Hy[150]=function(t){return[[1,0],[t.bottomright,0],[t.topright,1],[1,1]]},Hy[80]=Hy[90]=function(t){return[[1,1],[1,t.righttop],[0,t.lefttop],[0,1]]},Hy[65]=Hy[105]=function(t){return[[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},Hy[160]=Hy[10]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.leftbottom],[0,t.lefttop]]},Hy[130]=Hy[40]=function(t){return[[t.topleft,1],[t.topright,1],[t.bottomright,0],[t.bottomleft,0]]},Hy[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},Hy[101]=Hy[69]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,1],[t.topleft,1]]},Hy[149]=Hy[21]=function(t){return[[t.topright,1],[1,1],[1,0],[0,0],[0,t.leftbottom]]},Hy[86]=Hy[84]=function(t){return[[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[1,1]]},Hy[89]=Hy[81]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,1]]},Hy[96]=Hy[74]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.lefttop],[0,1],[t.topleft,1]]},Hy[24]=Hy[146]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[t.topright,1]]},Hy[6]=Hy[164]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop]]},Hy[129]=Hy[41]=function(t){return[[t.topright,1],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1]]},Hy[66]=Hy[104]=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Hy[144]=Hy[26]=function(t){return[[1,1],[1,t.righttop],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Hy[36]=Hy[134]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[t.topleft,1],[t.topright,1]]},Hy[9]=Hy[161]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom]]},Hy[37]=Hy[133]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},Hy[148]=Hy[22]=function(t){return[[1,1],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Hy[82]=Hy[88]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1]]},Hy[73]=Hy[97]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},Hy[145]=Hy[25]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},Hy[70]=Hy[100]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Hy[34]=function(t){return[Ny(t),Dy(t)]},Hy[35]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Hy[136]=function(t){return[ky(t),Ry(t)]},Hy[153]=function(t){return[Py(t),Cy(t)]},Hy[102]=function(t){return[Ay(t),Ly(t)]},Hy[155]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},Hy[103]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Hy[152]=function(t){return[Py(t),Ry(t)]},Hy[156]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Hy[137]=function(t){return[ky(t),Cy(t)]},Hy[139]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},Hy[98]=function(t){return[Dy(t),Ly(t)]},Hy[99]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Hy[38]=function(t){return[Ay(t),Ny(t)]},Hy[39]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]};var Xy=function(){function t(e){this.id=t.buildId(e),this.coordinates=e,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return t.buildId=function(t){return t.join(",")},t.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter((function(e){return e.from.id!==t.from.id}))},t.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter((function(e){return e.to.id!==t.to.id}))},t.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1},t.prototype.sortOuterEdges=function(){var t=this;this.outerEdgesSorted||(this.outerEdges.sort((function(e,i){var n=e.to,r=i.to;if(n.coordinates[0]-t.coordinates[0]>=0&&r.coordinates[0]-t.coordinates[0]<0)return 1;if(n.coordinates[0]-t.coordinates[0]<0&&r.coordinates[0]-t.coordinates[0]>=0)return-1;if(n.coordinates[0]-t.coordinates[0]==0&&r.coordinates[0]-t.coordinates[0]==0)return n.coordinates[1]-t.coordinates[1]>=0||r.coordinates[1]-t.coordinates[1]>=0?n.coordinates[1]-r.coordinates[1]:r.coordinates[1]-n.coordinates[1];var o=Wy(t.coordinates,n.coordinates,r.coordinates);return o<0?1:o>0?-1:Math.pow(n.coordinates[0]-t.coordinates[0],2)+Math.pow(n.coordinates[1]-t.coordinates[1],2)-(Math.pow(r.coordinates[0]-t.coordinates[0],2)+Math.pow(r.coordinates[1]-t.coordinates[1],2))})),this.outerEdgesSorted=!0)},t.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},t.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]},t.prototype.addInnerEdge=function(t){this.innerEdges.push(t)},t}();const $y=Xy;var Yy=function(){function t(t,e){this.from=t,this.to=e,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return t.prototype.getSymetric=function(){return this.symetric||(this.symetric=new t(this.to,this.from),this.symetric.symetric=this),this.symetric},t.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},t.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id},t.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},t.prototype.toLineString=function(){return D_([this.from.coordinates,this.to.coordinates])},t.prototype.compareTo=function(t){return Wy(t.from.coordinates,t.to.coordinates,this.to.coordinates)},t}();const Zy=Yy;var Ky=function(){function t(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return t.prototype.push=function(t){this.edges.push(t),this.polygon=this.envelope=void 0},t.prototype.get=function(t){return this.edges[t]},Object.defineProperty(t.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.edges.forEach(t)},t.prototype.map=function(t){return this.edges.map(t)},t.prototype.some=function(t){return this.edges.some(t)},t.prototype.isValid=function(){return!0},t.prototype.isHole=function(){var t=this,e=this.edges.reduce((function(e,i,n){return i.from.coordinates[1]>t.edges[e].from.coordinates[1]&&(e=n),e}),0),i=(0===e?this.length:e)-1,n=(e+1)%this.length,r=Wy(this.edges[i].from.coordinates,this.edges[e].from.coordinates,this.edges[n].from.coordinates);return 0===r?this.edges[i].from.coordinates[0]>this.edges[n].from.coordinates[0]:r>0},t.prototype.toMultiPoint=function(){return function(t,e,i){return void 0===i&&(i={}),P_({type:"MultiPoint",coordinates:t},e,i)}(this.edges.map((function(t){return t.from.coordinates})))},t.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map((function(t){return t.from.coordinates}));return t.push(this.edges[0].from.coordinates),this.polygon=R_([t])},t.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=function(t){return function(t,e){void 0===e&&(e={});var i=Number(t[0]),n=Number(t[1]),r=Number(t[2]),o=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[i,n];return R_([[s,[r,n],[r,o],[i,o],s]],e.properties,{bbox:t,id:e.id})}(j_(t))}(this.toPolygon())},t.findEdgeRingContaining=function(t,e){var i,n,r=t.getEnvelope();return e.forEach((function(e){var o,s,a,l,c,u,h=e.getEnvelope();if(n&&(i=n.getEnvelope()),s=r,a=(o=h).geometry.coordinates[0].map((function(t){return t[0]})),l=o.geometry.coordinates[0].map((function(t){return t[1]})),c=s.geometry.coordinates[0].map((function(t){return t[0]})),u=s.geometry.coordinates[0].map((function(t){return t[1]})),(Math.max.apply(null,a)!==Math.max.apply(null,c)||Math.max.apply(null,l)!==Math.max.apply(null,u)||Math.min.apply(null,a)!==Math.min.apply(null,c)||Math.min.apply(null,l)!==Math.min.apply(null,u))&&qy(h,r)){for(var d=t.map((function(t){return t.from.coordinates})),p=void 0,f=function(t){e.some((function(e){return i=t,n=e.from.coordinates,i[0]===n[0]&&i[1]===n[1];var i,n}))||(p=t)},m=0,g=d;m<g.length;m++)f(g[m]);p&&e.inside(L_(p))&&(n&&!qy(i,h)||(n=e))}})),n},t.prototype.inside=function(t){return q_(t,this.toPolygon())},t}();const Jy=Ky;function Qy(t){for(var e=t,i=[];e.parent;)i.unshift(e),e=e.parent;return i}!function(){function t(){this.edges=[],this.nodes={}}t.fromGeoJson=function(e){!function(t){if(!t)throw new Error("No geojson passed");if("FeatureCollection"!==t.type&&"GeometryCollection"!==t.type&&"MultiLineString"!==t.type&&"LineString"!==t.type&&"Feature"!==t.type)throw new Error("Invalid input type '"+t.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(e);var i=new t;return U_(e,(function(t){H_(t,"LineString","Graph::fromGeoJson"),function(t,e,n,r){var o=n;z_(t,(function(t,e,n,r,s){o=0===e?t:function(t,e){if(t){var n=i.getNode(t),r=i.getNode(e);i.addEdge(n,r)}return e}(o,t)}),void 0)}(t)})),i},t.prototype.getNode=function(t){var e=$y.buildId(t),i=this.nodes[e];return i||(i=this.nodes[e]=new $y(t)),i},t.prototype.addEdge=function(t,e){var i=new Zy(t,e),n=i.getSymetric();this.edges.push(i),this.edges.push(n)},t.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map((function(e){return t.nodes[e]})).forEach((function(e){return t._removeIfDangle(e)}))},t.prototype._removeIfDangle=function(t){var e=this;if(t.innerEdges.length<=1){var i=t.getOuterEdges().map((function(t){return t.to}));this.removeNode(t),i.forEach((function(t){return e._removeIfDangle(t)}))}},t.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach((function(e){e.label===e.symetric.label&&(t.removeEdge(e.symetric),t.removeEdge(e))}))},t.prototype._computeNextCWEdges=function(t){var e=this;void 0===t?Object.keys(this.nodes).forEach((function(t){return e._computeNextCWEdges(e.nodes[t])})):t.getOuterEdges().forEach((function(e,i){t.getOuterEdge((0===i?t.getOuterEdges().length:i)-1).symetric.next=e}))},t.prototype._computeNextCCWEdges=function(t,e){for(var i,n,r=t.getOuterEdges(),o=r.length-1;o>=0;--o){var s=r[o],a=s.symetric,l=void 0,c=void 0;s.label===e&&(l=s),a.label===e&&(c=a),l&&c&&(c&&(n=c),l&&(n&&(n.next=l,n=void 0),i||(i=l)))}n&&(n.next=i)},t.prototype._findLabeledEdgeRings=function(){var t=[],e=0;return this.edges.forEach((function(i){if(!(i.label>=0)){t.push(i);var n=i;do{n.label=e,n=n.next}while(!i.isEqual(n));e++}})),t},t.prototype.getEdgeRings=function(){var t=this;this._computeNextCWEdges(),this.edges.forEach((function(t){t.label=void 0})),this._findLabeledEdgeRings().forEach((function(e){t._findIntersectionNodes(e).forEach((function(i){t._computeNextCCWEdges(i,e.label)}))}));var e=[];return this.edges.forEach((function(i){i.ring||e.push(t._findEdgeRing(i))})),e},t.prototype._findIntersectionNodes=function(t){var e=[],i=t,n=function(){var n=0;i.from.getOuterEdges().forEach((function(e){e.label===t.label&&++n})),n>1&&e.push(i.from),i=i.next};do{n()}while(!t.isEqual(i));return e},t.prototype._findEdgeRing=function(t){var e=t,i=new Jy;do{i.push(e),e.ring=i,e=e.next}while(!t.isEqual(e));return i},t.prototype.removeNode=function(t){var e=this;t.getOuterEdges().forEach((function(t){return e.removeEdge(t)})),t.innerEdges.forEach((function(t){return e.removeEdge(t)})),delete this.nodes[t.id]},t.prototype.removeEdge=function(t){this.edges=this.edges.filter((function(e){return!e.isEqual(t)})),t.deleteEdge()}}(),i(7639),i(8932),i(2024);var tv={search:function(t,e,i,n){t.cleanDirty();var r=(n=n||{}).heuristic||tv.heuristics.manhattan,o=n.closest||!1,s=new nv((function(t){return t.f})),a=e;for(e.h=r(e,i),s.push(e);s.size()>0;){var l=s.pop();if(l===i)return Qy(l);l.closed=!0;for(var c=t.neighbors(l),u=0,h=c.length;u<h;++u){var d=c[u];if(!d.closed&&!d.isWall()){var p=l.g+d.getCost(l),f=d.visited;(!f||p<d.g)&&(d.visited=!0,d.parent=l,d.h=d.h||r(d,i),d.g=p,d.f=d.g+d.h,t.markDirty(d),o&&(d.h<a.h||d.h===a.h&&d.g<a.g)&&(a=d),f?s.rescoreElement(d):s.push(d))}}}return o?Qy(a):[]},heuristics:{manhattan:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},diagonal:function(t,e){var i=Math.sqrt(2),n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);return 1*(n+r)+(i-2)*Math.min(n,r)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};function ev(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var i=0;i<t.length;i++){this.grid[i]=[];for(var n=0,r=t[i];n<r.length;n++){var o=new iv(i,n,r[n]);this.grid[i][n]=o,this.nodes.push(o)}}this.init()}function iv(t,e,i){this.x=t,this.y=e,this.weight=i}function nv(t){this.content=[],this.scoreFunction=t}function rv(){this._=null}function ov(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function sv(t,e){var i=e,n=e.R,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.R=n.L,i.R&&(i.R.U=i),n.L=i}function av(t,e){var i=e,n=e.L,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.L=n.R,i.L&&(i.L.U=i),n.R=i}function lv(t){for(;t.L;)t=t.L;return t}ev.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)tv.cleanNode(this.nodes[t])},ev.prototype.cleanDirty=function(){for(var t=0;t<this.dirtyNodes.length;t++)tv.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]},ev.prototype.markDirty=function(t){this.dirtyNodes.push(t)},ev.prototype.neighbors=function(t){var e=[],i=t.x,n=t.y,r=this.grid;return r[i-1]&&r[i-1][n]&&e.push(r[i-1][n]),r[i+1]&&r[i+1][n]&&e.push(r[i+1][n]),r[i]&&r[i][n-1]&&e.push(r[i][n-1]),r[i]&&r[i][n+1]&&e.push(r[i][n+1]),this.diagonal&&(r[i-1]&&r[i-1][n-1]&&e.push(r[i-1][n-1]),r[i+1]&&r[i+1][n-1]&&e.push(r[i+1][n-1]),r[i-1]&&r[i-1][n+1]&&e.push(r[i-1][n+1]),r[i+1]&&r[i+1][n+1]&&e.push(r[i+1][n+1])),e},ev.prototype.toString=function(){for(var t,e,i,n,r=[],o=this.grid,s=0,a=o.length;s<a;s++){for(t=[],i=0,n=(e=o[s]).length;i<n;i++)t.push(e[i].weight);r.push(t.join(" "))}return r.join("\n")},iv.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},iv.prototype.getCost=function(t){return t&&t.x!==this.x&&t.y!==this.y?1.41421*this.weight:this.weight},iv.prototype.isWall=function(){return 0===this.weight},nv.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),i=this.content.pop();e!==this.content.length-1&&(this.content[e]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var i=(t+1>>1)-1,n=this.content[i];if(!(this.scoreFunction(e)<this.scoreFunction(n)))break;this.content[i]=e,this.content[t]=n,t=i}},bubbleUp:function(t){for(var e=this.content.length,i=this.content[t],n=this.scoreFunction(i);;){var r,o=t+1<<1,s=o-1,a=null;if(s<e){var l=this.content[s];(r=this.scoreFunction(l))<n&&(a=s)}if(o<e){var c=this.content[o];this.scoreFunction(c)<(null===a?n:r)&&(a=o)}if(null===a)break;this.content[t]=this.content[a],this.content[a]=i,t=a}}},rv.prototype={constructor:rv,insert:function(t,e){var i,n,r;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;i=t}else this._?(t=lv(this._),e.P=null,e.N=t,t.P=t.L=e,i=t):(e.P=e.N=null,this._=e,i=null);for(e.L=e.R=null,e.U=i,e.C=!0,t=e;i&&i.C;)i===(n=i.U).L?(r=n.R)&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.R&&(sv(this,i),i=(t=i).U),i.C=!1,n.C=!0,av(this,n)):(r=n.L)&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.L&&(av(this,i),i=(t=i).U),i.C=!1,n.C=!0,sv(this,n)),i=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,i,n,r=t.U,o=t.L,s=t.R;if(i=o?s?lv(s):o:s,r?r.L===t?r.L=i:r.R=i:this._=i,o&&s?(n=i.C,i.C=t.C,i.L=o,o.U=i,i!==s?(r=i.U,i.U=t.U,t=i.R,r.L=t,i.R=s,s.U=i):(i.U=r,r=i,t=i.R)):(n=t.C,t=i),t&&(t.U=r),!n)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===r.L){if((e=r.R).C&&(e.C=!1,r.C=!0,sv(this,r),e=r.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,av(this,e),e=r.R),e.C=r.C,r.C=e.R.C=!1,sv(this,r),t=this._;break}}else if((e=r.L).C&&(e.C=!1,r.C=!0,av(this,r),e=r.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,sv(this,e),e=r.L),e.C=r.C,r.C=e.L.C=!1,av(this,r),t=this._;break}e.C=!0,t=r,r=r.U}while(!t.C);t&&(t.C=!1)}}};const cv=rv;function uv(t,e,i,n){var r=[null,null],o=kv.push(r)-1;return r.left=t,r.right=e,i&&dv(r,t,e,i),n&&dv(r,e,t,n),Rv[t.index].halfedges.push(o),Rv[e.index].halfedges.push(o),r}function hv(t,e,i){var n=[e,i];return n.left=t,n}function dv(t,e,i,n){t[0]||t[1]?t.left===i?t[1]=n:t[0]=n:(t[0]=n,t.left=e,t.right=i)}function pv(t,e,i,n,r){var o,s=t[0],a=t[1],l=s[0],c=s[1],u=0,h=1,d=a[0]-l,p=a[1]-c;if(o=e-l,d||!(o>0)){if(o/=d,d<0){if(o<u)return;o<h&&(h=o)}else if(d>0){if(o>h)return;o>u&&(u=o)}if(o=n-l,d||!(o<0)){if(o/=d,d<0){if(o>h)return;o>u&&(u=o)}else if(d>0){if(o<u)return;o<h&&(h=o)}if(o=i-c,p||!(o>0)){if(o/=p,p<0){if(o<u)return;o<h&&(h=o)}else if(p>0){if(o>h)return;o>u&&(u=o)}if(o=r-c,p||!(o<0)){if(o/=p,p<0){if(o>h)return;o>u&&(u=o)}else if(p>0){if(o<u)return;o<h&&(h=o)}return!(u>0||h<1)||(u>0&&(t[0]=[l+u*d,c+u*p]),h<1&&(t[1]=[l+h*d,c+h*p]),!0)}}}}}function fv(t,e,i,n,r){var o=t[1];if(o)return!0;var s,a,l=t[0],c=t.left,u=t.right,h=c[0],d=c[1],p=u[0],f=u[1],m=(h+p)/2,g=(d+f)/2;if(f===d){if(m<e||m>=n)return;if(h>p){if(l){if(l[1]>=r)return}else l=[m,i];o=[m,r]}else{if(l){if(l[1]<i)return}else l=[m,r];o=[m,i]}}else if(a=g-(s=(h-p)/(f-d))*m,s<-1||s>1)if(h>p){if(l){if(l[1]>=r)return}else l=[(i-a)/s,i];o=[(r-a)/s,r]}else{if(l){if(l[1]<i)return}else l=[(r-a)/s,r];o=[(i-a)/s,i]}else if(d<f){if(l){if(l[0]>=n)return}else l=[e,s*e+a];o=[n,s*n+a]}else{if(l){if(l[0]<e)return}else l=[n,s*n+a];o=[e,s*e+a]}return t[0]=l,t[1]=o,!0}function mv(t,e){var i=t.site,n=e.left,r=e.right;return i===r&&(r=n,n=i),r?Math.atan2(r[1]-n[1],r[0]-n[0]):(i===n?(n=e[1],r=e[0]):(n=e[0],r=e[1]),Math.atan2(n[0]-r[0],r[1]-n[1]))}function gv(t,e){return e[+(e.left!==t.site)]}function _v(t,e){return e[+(e.left===t.site)]}var yv,vv=[];function xv(){ov(this),this.x=this.y=this.arc=this.site=this.cy=null}function bv(t){var e=t.P,i=t.N;if(e&&i){var n=e.site,r=t.site,o=i.site;if(n!==o){var s=r[0],a=r[1],l=n[0]-s,c=n[1]-a,u=o[0]-s,h=o[1]-a,d=2*(l*h-c*u);if(!(d>=-Ov)){var p=l*l+c*c,f=u*u+h*h,m=(h*p-c*f)/d,g=(l*f-u*p)/d,_=vv.pop()||new xv;_.arc=t,_.site=r,_.x=m+s,_.y=(_.cy=g+a)+Math.sqrt(m*m+g*g),t.circle=_;for(var y=null,v=Dv._;v;)if(_.y<v.y||_.y===v.y&&_.x<=v.x){if(!v.L){y=v.P;break}v=v.L}else{if(!v.R){y=v;break}v=v.R}Dv.insert(y,_),y||(yv=_)}}}}function wv(t){var e=t.circle;e&&(e.P||(yv=e.N),Dv.remove(e),vv.push(e),ov(e),t.circle=null)}var Ev=[];function Sv(){ov(this),this.edge=this.site=this.circle=null}function Tv(t){var e=Ev.pop()||new Sv;return e.site=t,e}function Mv(t){wv(t),Lv.remove(t),Ev.push(t),ov(t)}function Iv(t){var e=t.circle,i=e.x,n=e.cy,r=[i,n],o=t.P,s=t.N,a=[t];Mv(t);for(var l=o;l.circle&&Math.abs(i-l.circle.x)<Nv&&Math.abs(n-l.circle.cy)<Nv;)o=l.P,a.unshift(l),Mv(l),l=o;a.unshift(l),wv(l);for(var c=s;c.circle&&Math.abs(i-c.circle.x)<Nv&&Math.abs(n-c.circle.cy)<Nv;)s=c.N,a.push(c),Mv(c),c=s;a.push(c),wv(c);var u,h=a.length;for(u=1;u<h;++u)c=a[u],l=a[u-1],dv(c.edge,l.site,c.site,r);l=a[0],(c=a[h-1]).edge=uv(l.site,c.site,null,r),bv(l),bv(c)}function Cv(t){for(var e,i,n,r,o=t[0],s=t[1],a=Lv._;a;)if((n=Av(a,s)-o)>Nv)a=a.L;else{if(!((r=o-Pv(a,s))>Nv)){n>-Nv?(e=a.P,i=a):r>-Nv?(e=a,i=a.N):e=i=a;break}if(!a.R){e=a;break}a=a.R}!function(t){Rv[t.index]={site:t,halfedges:[]}}(t);var l=Tv(t);if(Lv.insert(e,l),e||i){if(e===i)return wv(e),i=Tv(e.site),Lv.insert(l,i),l.edge=i.edge=uv(e.site,l.site),bv(e),void bv(i);if(i){wv(e),wv(i);var c=e.site,u=c[0],h=c[1],d=t[0]-u,p=t[1]-h,f=i.site,m=f[0]-u,g=f[1]-h,_=2*(d*g-p*m),y=d*d+p*p,v=m*m+g*g,x=[(g*y-p*v)/_+u,(d*v-m*y)/_+h];dv(i.edge,c,f,x),l.edge=uv(c,t,null,x),i.edge=uv(t,f,null,x),bv(e),bv(i)}else l.edge=uv(e.site,l.site)}}function Av(t,e){var i=t.site,n=i[0],r=i[1],o=r-e;if(!o)return n;var s=t.P;if(!s)return-1/0;var a=(i=s.site)[0],l=i[1],c=l-e;if(!c)return a;var u=a-n,h=1/o-1/c,d=u/c;return h?(-d+Math.sqrt(d*d-2*h*(u*u/(-2*c)-l+c/2+r-o/2)))/h+n:(n+a)/2}function Pv(t,e){var i=t.N;if(i)return Av(i,e);var n=t.site;return n[1]===e?n[0]:1/0}var Lv,Rv,Dv,kv,Nv=1e-6,Ov=1e-12;function Fv(t,e,i){return(t[0]-i[0])*(e[1]-t[1])-(t[0]-e[0])*(i[1]-t[1])}function zv(t,e){return e[1]-t[1]||e[0]-t[0]}function Bv(t,e){var i,n,r,o=t.sort(zv).pop();for(kv=[],Rv=new Array(t.length),Lv=new cv,Dv=new cv;;)if(r=yv,o&&(!r||o[1]<r.y||o[1]===r.y&&o[0]<r.x))o[0]===i&&o[1]===n||(Cv(o),i=o[0],n=o[1]),o=t.pop();else{if(!r)break;Iv(r.arc)}if(function(){for(var t,e,i,n,r=0,o=Rv.length;r<o;++r)if((t=Rv[r])&&(n=(e=t.halfedges).length)){var s=new Array(n),a=new Array(n);for(i=0;i<n;++i)s[i]=i,a[i]=mv(t,kv[e[i]]);for(s.sort((function(t,e){return a[e]-a[t]})),i=0;i<n;++i)a[i]=e[s[i]];for(i=0;i<n;++i)e[i]=a[i]}}(),e){var s=+e[0][0],a=+e[0][1],l=+e[1][0],c=+e[1][1];!function(t,e,i,n){for(var r,o=kv.length;o--;)fv(r=kv[o],t,e,i,n)&&pv(r,t,e,i,n)&&(Math.abs(r[0][0]-r[1][0])>Nv||Math.abs(r[0][1]-r[1][1])>Nv)||delete kv[o]}(s,a,l,c),function(t,e,i,n){var r,o,s,a,l,c,u,h,d,p,f,m,g=Rv.length,_=!0;for(r=0;r<g;++r)if(o=Rv[r]){for(s=o.site,a=(l=o.halfedges).length;a--;)kv[l[a]]||l.splice(a,1);for(a=0,c=l.length;a<c;)f=(p=_v(o,kv[l[a]]))[0],m=p[1],h=(u=gv(o,kv[l[++a%c]]))[0],d=u[1],(Math.abs(f-h)>Nv||Math.abs(m-d)>Nv)&&(l.splice(a,0,kv.push(hv(s,p,Math.abs(f-t)<Nv&&n-m>Nv?[t,Math.abs(h-t)<Nv?d:n]:Math.abs(m-n)<Nv&&i-f>Nv?[Math.abs(d-n)<Nv?h:i,n]:Math.abs(f-i)<Nv&&m-e>Nv?[i,Math.abs(h-i)<Nv?d:e]:Math.abs(m-e)<Nv&&f-t>Nv?[Math.abs(d-e)<Nv?h:t,e]:null))-1),++c);c&&(_=!1)}if(_){var y,v,x,b=1/0;for(r=0,_=null;r<g;++r)(o=Rv[r])&&(x=(y=(s=o.site)[0]-t)*y+(v=s[1]-e)*v)<b&&(b=x,_=o);if(_){var w=[t,e],E=[t,n],S=[i,n],T=[i,e];_.halfedges.push(kv.push(hv(s=_.site,w,E))-1,kv.push(hv(s,E,S))-1,kv.push(hv(s,S,T))-1,kv.push(hv(s,T,w))-1)}}for(r=0;r<g;++r)(o=Rv[r])&&(o.halfedges.length||delete Rv[r])}(s,a,l,c)}this.edges=kv,this.cells=Rv,Lv=Dv=kv=Rv=null}function Uv(){return new Vv}function Vv(){this.reset()}Bv.prototype={constructor:Bv,polygons:function(){var t=this.edges;return this.cells.map((function(e){var i=e.halfedges.map((function(i){return gv(e,t[i])}));return i.data=e.site.data,i}))},triangles:function(){var t=[],e=this.edges;return this.cells.forEach((function(i,n){if(o=(r=i.halfedges).length)for(var r,o,s,a=i.site,l=-1,c=e[r[o-1]],u=c.left===a?c.right:c.left;++l<o;)s=u,u=(c=e[r[l]]).left===a?c.right:c.left,s&&u&&n<s.index&&n<u.index&&Fv(a,s,u)<0&&t.push([a.data,s.data,u.data])})),t},links:function(){return this.edges.filter((function(t){return t.right})).map((function(t){return{source:t.left.data,target:t.right.data}}))},find:function(t,e,i){for(var n,r,o=this,s=o._found||0,a=o.cells.length;!(r=o.cells[s]);)if(++s>=a)return null;var l=t-r.site[0],c=e-r.site[1],u=l*l+c*c;do{r=o.cells[n=s],s=null,r.halfedges.forEach((function(i){var n=o.edges[i],a=n.left;if(a!==r.site&&a||(a=n.right)){var l=t-a[0],c=e-a[1],h=l*l+c*c;h<u&&(u=h,s=a.index)}}))}while(null!==s);return o._found=n,null==i||u<=i*i?r.site:null}},i(1640),i(7155),Vv.prototype={constructor:Vv,reset:function(){this.s=this.t=0},add:function(t){Gv(jv,t,this.t),Gv(this,jv.s,this.s),this.s?this.t+=jv.t:this.s=jv.t},valueOf:function(){return this.s}};var jv=new Vv;function Gv(t,e,i){var n=t.s=e+i,r=n-e,o=n-r;t.t=e-o+(i-r)}var Hv,Wv,qv=Math.PI,Xv=qv/2,$v=2*qv,Yv=qv/180,Zv=(Math.abs,Math.atan),Kv=Math.atan2,Jv=Math.cos,Qv=(Math.ceil,Math.exp,Math.floor,Math.log,Math.pow,Math.sin),tx=(Math.sign,Math.sqrt);Math.tan;function ex(t){return t>1?Xv:t<-1?-Xv:Math.asin(t)}function ix(t,e){return[t>qv?t-$v:t<-qv?t+$v:t,e]}function nx(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}Uv(),Uv(),Uv(),ix.invert=ix,1===(Hv=nx).length&&(Wv=Hv,Hv=function(t,e){return nx(Wv(t),e)});var rx=Array.prototype;rx.slice,rx.map,Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);Uv();function ox(){}function sx(t){return function(e,i){var n=Jv(e),r=Jv(i),o=t(n*r);return[o*r*Qv(e),o*Qv(i)]}}function ax(t){return function(e,i){var n=tx(e*e+i*i),r=t(n),o=Qv(r),s=Jv(r);return[Kv(e*o,n*s),ex(n&&i*o/n)]}}Uv(),Uv(),Uv(),Uv(),ox.prototype={constructor:ox,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Jv(30*Yv),sx((function(t){return tx(2/(1+t))})).invert=ax((function(t){return 2*ex(t/2)}));var lx=sx((function(t){return(t=function(t){return t>1?0:t<-1?qv:Math.acos(t)}(t))&&t/Qv(t)}));function cx(t,e){return[t,e]}async function ux(t){if(console.log("Interpolating..."),!t)return;let e=await async function(t){try{const t=await fetch("./assets/Iowa_Hwy_80_35_500ft.geojson");return await t.json()}catch(t){return console.error("Error loading GeoJSON:",t),null}}();return await Promise.all(e.features.map((async e=>{const i=function(t,e,i){void 0===i&&(i={});var n=i.units,r=i.properties||{},o=function(t){var e=[];switch(t.geometry?t.geometry.type:t.type){case"GeometryCollection":return B_(t,(function(t){"Point"===t.type&&e.push({type:"Feature",properties:{},geometry:t})})),{type:"FeatureCollection",features:e};case"FeatureCollection":return t.features=t.features.filter((function(t){return"Point"===t.geometry.type})),t;default:throw new Error("points must be a Point Collection")}}(t);if(!o.features.length)throw new Error("points must contain features");if(!e)throw new Error("line is required");if("LineString"!==function(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}(e))throw new Error("line must be a LineString");var s=1/0,a=null;return function(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var i=0;i<t.features.length&&!1!==e(t.features[i],i);i++);}(o,(function(t){var i=K_(t,e,{units:n});i<s&&(s=i,a=t)})),a&&(a.properties=W_({dist:s},a.properties,r)),a}(t,e);if(i){const t=i.properties.classification;e.properties.classification=t}}))),console.log("Interpolation complete."),function(){const t=document.getElementById("loadingScreen");t.classList.remove("fadeInAnimation"),t.classList.add("fadeOutAnimation"),t.classList.remove("fadeOutAnimation"),document.querySelectorAll(".loadup").forEach((t=>{t.style.opacity=1}))}(),e}lx.invert=ax((function(t){return t})),cx.invert=cx,ax(Zv),ax(ex),ax((function(t){return 2*Zv(t)}));var hx=i(3735);const dx=document.querySelector("#realtime-toggle"),px=document.querySelectorAll(".archived-query");let fx=!1;dx.addEventListener("change",(t=>{t.target.checked?(fx=!0,px.forEach((t=>{t.style.display="none"}))):(fx=!1,px.forEach((t=>{t.style.display="flex"}))),console.log(`Realtime: ${fx}`)})),document.getElementById("shift-button").addEventListener("click",(function(){document.getElementById("console").classList.toggle("shifted"),document.getElementById("shift-button").classList.toggle("shifted");const t=document.getElementById("arrow-img").classList.toggle("flipped"),e={};let i=document.getElementById("console").clientWidth;e.right=t?0:i,Yz.easeTo({padding:e,duration:1e3})}));const mx=document.getElementById("time-range"),gx=document.getElementById("slider-value");let _x=0;function yx(){let t=document.querySelector(".console.resizable");t.scrollTop=t.scrollHeight}mx.addEventListener("input",(function(){gx.textContent=this.value,_x=this.value,console.log(_x)})),document.getElementById("query-form").addEventListener("submit",(async function(t){if(t.preventDefault(),yx(),!fx){const t=new FormData(this),e=t.get("calendar"),i=t.get("window"),n=document.getElementById("submit-query");n.disabled=!0,n.style.cursor="not-allowed",setTimeout((()=>{n.disabled=!1,n.style.cursor="pointer",console.log("Button Available")}),160*i);const[r,o]=function(t,e){let i=1*e;const n=new Date(t),r=new Date(n.getTime()-6e4*i),o=new Date(n.getTime()+6e4*i);return console.log("start: "+r+"\n\n end:"+o),[r,o]}(e,i),s=function(t){let e=[];for(const a of t){const t=a.data,l=a.id.replace(/_.*/,""),c=t.Position.latitude,u=t.Position.longitude,h={Undefined:t.Undefined,Bare:t.Bare,Full:t.Full,Partly:t.Partly},d=(i=t.Undefined,n=t.Bare,r=t.Full,o=t.Partly,s=void 0,(s=Math.max(i,n,r,o))===i?"Undefined":s===n?"Bare":s===r?"Full":s===o?"Partly":void 0),p=t.IMAGE_URL,f=t.Date.seconds;e.push({id:l,lat:c,lng:u,class:h,classification:d,url:p,timestamp:f})}var i,n,r,o,s;return hx.parse(e,{Point:["lat","lng"]})}(await I_(r,o));Jz(s),xx&&(vx=await ux(Zz),Qz(vx))}}));let vx,xx=!1;function bx(t){return t+.5|0}document.getElementById("interpolation").addEventListener("click",(async t=>{t.preventDefault(),vx=await ux(Zz),Qz(vx),xx=!0})),setInterval((function(){if(fx){let t=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});console.log("Window:",_x),console.log(`Latest map update: ${t}`)}else console.log("Not in realtime state, not updating map")}),6e4);const wx=(t,e,i)=>Math.max(Math.min(t,i),e);function Ex(t){return wx(bx(2.55*t),0,255)}function Sx(t){return wx(bx(255*t),0,255)}function Tx(t){return wx(bx(t/2.55)/100,0,1)}function Mx(t){return wx(bx(100*t),0,100)}const Ix={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Cx=[..."0123456789ABCDEF"],Ax=t=>Cx[15&t],Px=t=>Cx[(240&t)>>4]+Cx[15&t],Lx=t=>(240&t)>>4==(15&t);const Rx=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Dx(t,e,i){const n=e*Math.min(i,1-i),r=(e,r=(e+t/30)%12)=>i-n*Math.max(Math.min(r-3,9-r,1),-1);return[r(0),r(8),r(4)]}function kx(t,e,i){const n=(n,r=(n+t/60)%6)=>i-i*e*Math.max(Math.min(r,4-r,1),0);return[n(5),n(3),n(1)]}function Nx(t,e,i){const n=Dx(t,1,.5);let r;for(e+i>1&&(r=1/(e+i),e*=r,i*=r),r=0;r<3;r++)n[r]*=1-e-i,n[r]+=e;return n}function Ox(t){const e=t.r/255,i=t.g/255,n=t.b/255,r=Math.max(e,i,n),o=Math.min(e,i,n),s=(r+o)/2;let a,l,c;return r!==o&&(c=r-o,l=s>.5?c/(2-r-o):c/(r+o),a=function(t,e,i,n,r){return t===r?(e-i)/n+(e<i?6:0):e===r?(i-t)/n+2:(t-e)/n+4}(e,i,n,c,r),a=60*a+.5),[0|a,l||0,s]}function Fx(t,e,i,n){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,i,n)).map(Sx)}function zx(t,e,i){return Fx(Dx,t,e,i)}function Bx(t){return(t%360+360)%360}const Ux={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Vx={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let jx;const Gx=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,Hx=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,Wx=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function qx(t,e,i){if(t){let n=Ox(t);n[e]=Math.max(0,Math.min(n[e]+n[e]*i,0===e?360:1)),n=zx(n),t.r=n[0],t.g=n[1],t.b=n[2]}}function Xx(t,e){return t?Object.assign(e||{},t):t}function $x(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=Sx(t[3]))):(e=Xx(t,{r:0,g:0,b:0,a:1})).a=Sx(e.a),e}function Yx(t){return"r"===t.charAt(0)?function(t){const e=Gx.exec(t);let i,n,r,o=255;if(e){if(e[7]!==i){const t=+e[7];o=e[8]?Ex(t):wx(255*t,0,255)}return i=+e[1],n=+e[3],r=+e[5],i=255&(e[2]?Ex(i):wx(i,0,255)),n=255&(e[4]?Ex(n):wx(n,0,255)),r=255&(e[6]?Ex(r):wx(r,0,255)),{r:i,g:n,b:r,a:o}}}(t):function(t){const e=Rx.exec(t);let i,n=255;if(!e)return;e[5]!==i&&(n=e[6]?Ex(+e[5]):Sx(+e[5]));const r=Bx(+e[2]),o=+e[3]/100,s=+e[4]/100;return i="hwb"===e[1]?function(t,e,i){return Fx(Nx,t,e,i)}(r,o,s):"hsv"===e[1]?function(t,e,i){return Fx(kx,t,e,i)}(r,o,s):zx(r,o,s),{r:i[0],g:i[1],b:i[2],a:n}}(t)}class Zx{constructor(t){if(t instanceof Zx)return t;const e=typeof t;let i;var n,r,o;"object"===e?i=$x(t):"string"===e&&(o=(n=t).length,"#"===n[0]&&(4===o||5===o?r={r:255&17*Ix[n[1]],g:255&17*Ix[n[2]],b:255&17*Ix[n[3]],a:5===o?17*Ix[n[4]]:255}:7!==o&&9!==o||(r={r:Ix[n[1]]<<4|Ix[n[2]],g:Ix[n[3]]<<4|Ix[n[4]],b:Ix[n[5]]<<4|Ix[n[6]],a:9===o?Ix[n[7]]<<4|Ix[n[8]]:255})),i=r||function(t){jx||(jx=function(){const t={},e=Object.keys(Vx),i=Object.keys(Ux);let n,r,o,s,a;for(n=0;n<e.length;n++){for(s=a=e[n],r=0;r<i.length;r++)o=i[r],a=a.replace(o,Ux[o]);o=parseInt(Vx[s],16),t[a]=[o>>16&255,o>>8&255,255&o]}return t}(),jx.transparent=[0,0,0,0]);const e=jx[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}(t)||Yx(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=Xx(this._rgb);return t&&(t.a=Tx(t.a)),t}set rgb(t){this._rgb=$x(t)}rgbString(){return this._valid?function(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${Tx(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}(this._rgb):void 0}hexString(){return this._valid?function(t){var e=(t=>Lx(t.r)&&Lx(t.g)&&Lx(t.b)&&Lx(t.a))(t)?Ax:Px;return t?"#"+e(t.r)+e(t.g)+e(t.b)+((t,e)=>t<255?e(t):"")(t.a,e):void 0}(this._rgb):void 0}hslString(){return this._valid?function(t){if(!t)return;const e=Ox(t),i=e[0],n=Mx(e[1]),r=Mx(e[2]);return t.a<255?`hsla(${i}, ${n}%, ${r}%, ${Tx(t.a)})`:`hsl(${i}, ${n}%, ${r}%)`}(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,n=t.rgb;let r;const o=e===r?.5:e,s=2*o-1,a=i.a-n.a,l=((s*a==-1?s:(s+a)/(1+s*a))+1)/2;r=1-l,i.r=255&l*i.r+r*n.r+.5,i.g=255&l*i.g+r*n.g+.5,i.b=255&l*i.b+r*n.b+.5,i.a=o*i.a+(1-o)*n.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=function(t,e,i){const n=Wx(Tx(t.r)),r=Wx(Tx(t.g)),o=Wx(Tx(t.b));return{r:Sx(Hx(n+i*(Wx(Tx(e.r))-n))),g:Sx(Hx(r+i*(Wx(Tx(e.g))-r))),b:Sx(Hx(o+i*(Wx(Tx(e.b))-o))),a:t.a+i*(e.a-t.a)}}(this._rgb,t._rgb,e)),this}clone(){return new Zx(this.rgb)}alpha(t){return this._rgb.a=Sx(t),this}clearer(t){return this._rgb.a*=1-t,this}greyscale(){const t=this._rgb,e=bx(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=e,this}opaquer(t){return this._rgb.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return qx(this._rgb,2,t),this}darken(t){return qx(this._rgb,2,-t),this}saturate(t){return qx(this._rgb,1,t),this}desaturate(t){return qx(this._rgb,1,-t),this}rotate(t){return function(t,e){var i=Ox(t);i[0]=Bx(i[0]+e),i=zx(i),t.r=i[0],t.g=i[1],t.b=i[2]}(this._rgb,t),this}}function Kx(){}const Jx=(()=>{let t=0;return()=>t++})();function Qx(t){return null==t}function tb(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return"[object"===e.slice(0,7)&&"Array]"===e.slice(-6)}function eb(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}function ib(t){return("number"==typeof t||t instanceof Number)&&isFinite(+t)}function nb(t,e){return ib(t)?t:e}function rb(t,e){return void 0===t?e:t}const ob=(t,e)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100*e:+t;function sb(t,e,i){if(t&&"function"==typeof t.call)return t.apply(i,e)}function ab(t,e,i,n){let r,o,s;if(tb(t))if(o=t.length,n)for(r=o-1;r>=0;r--)e.call(i,t[r],r);else for(r=0;r<o;r++)e.call(i,t[r],r);else if(eb(t))for(s=Object.keys(t),o=s.length,r=0;r<o;r++)e.call(i,t[s[r]],s[r])}function lb(t,e){let i,n,r,o;if(!t||!e||t.length!==e.length)return!1;for(i=0,n=t.length;i<n;++i)if(r=t[i],o=e[i],r.datasetIndex!==o.datasetIndex||r.index!==o.index)return!1;return!0}function cb(t){if(tb(t))return t.map(cb);if(eb(t)){const e=Object.create(null),i=Object.keys(t),n=i.length;let r=0;for(;r<n;++r)e[i[r]]=cb(t[i[r]]);return e}return t}function ub(t){return-1===["__proto__","prototype","constructor"].indexOf(t)}function hb(t,e,i,n){if(!ub(t))return;const r=e[t],o=i[t];eb(r)&&eb(o)?db(r,o,n):e[t]=cb(o)}function db(t,e,i){const n=tb(e)?e:[e],r=n.length;if(!eb(t))return t;const o=(i=i||{}).merger||hb;let s;for(let e=0;e<r;++e){if(s=n[e],!eb(s))continue;const r=Object.keys(s);for(let e=0,n=r.length;e<n;++e)o(r[e],t,s,i)}return t}function pb(t,e){return db(t,e,{merger:fb})}function fb(t,e,i){if(!ub(t))return;const n=e[t],r=i[t];eb(n)&&eb(r)?pb(n,r):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=cb(r))}const mb={"":t=>t,x:t=>t.x,y:t=>t.y};function gb(t,e){const i=mb[e]||(mb[e]=function(t){const e=function(t){const e=t.split("."),i=[];let n="";for(const t of e)n+=t,n.endsWith("\\")?n=n.slice(0,-1)+".":(i.push(n),n="");return i}(t);return t=>{for(const i of e){if(""===i)break;t=t&&t[i]}return t}}(e));return i(t)}function _b(t){return t.charAt(0).toUpperCase()+t.slice(1)}const yb=t=>void 0!==t,vb=t=>"function"==typeof t,xb=(t,e)=>{if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0},bb=Math.PI,wb=2*bb,Eb=wb+bb,Sb=Number.POSITIVE_INFINITY,Tb=bb/180,Mb=bb/2,Ib=bb/4,Cb=2*bb/3,Ab=Math.log10,Pb=Math.sign;function Lb(t,e,i){return Math.abs(t-e)<i}function Rb(t){const e=Math.round(t);t=Lb(t,e,t/1e3)?e:t;const i=Math.pow(10,Math.floor(Ab(t))),n=t/i;return(n<=1?1:n<=2?2:n<=5?5:10)*i}function Db(t){return!isNaN(parseFloat(t))&&isFinite(t)}function kb(t,e,i){let n,r,o;for(n=0,r=t.length;n<r;n++)o=t[n][i],isNaN(o)||(e.min=Math.min(e.min,o),e.max=Math.max(e.max,o))}function Nb(t){return t*(bb/180)}function Ob(t){return t*(180/bb)}function Fb(t){if(!ib(t))return;let e=1,i=0;for(;Math.round(t*e)/e!==t;)e*=10,i++;return i}function zb(t,e){const i=e.x-t.x,n=e.y-t.y,r=Math.sqrt(i*i+n*n);let o=Math.atan2(n,i);return o<-.5*bb&&(o+=wb),{angle:o,distance:r}}function Bb(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Ub(t,e){return(t-e+Eb)%wb-bb}function Vb(t){return(t%wb+wb)%wb}function jb(t,e,i,n){const r=Vb(t),o=Vb(e),s=Vb(i),a=Vb(o-r),l=Vb(s-r),c=Vb(r-o),u=Vb(r-s);return r===o||r===s||n&&o===s||a>l&&c<u}function Gb(t,e,i){return Math.max(e,Math.min(i,t))}function Hb(t,e,i,n=1e-6){return t>=Math.min(e,i)-n&&t<=Math.max(e,i)+n}function Wb(t,e,i){i=i||(i=>t[i]<e);let n,r=t.length-1,o=0;for(;r-o>1;)n=o+r>>1,i(n)?o=n:r=n;return{lo:o,hi:r}}const qb=(t,e,i,n)=>Wb(t,i,n?n=>{const r=t[n][e];return r<i||r===i&&t[n+1][e]===i}:n=>t[n][e]<i),Xb=(t,e,i)=>Wb(t,i,(n=>t[n][e]>=i)),$b=["push","pop","shift","splice","unshift"];function Yb(t,e){const i=t._chartjs;if(!i)return;const n=i.listeners,r=n.indexOf(e);-1!==r&&n.splice(r,1),n.length>0||($b.forEach((e=>{delete t[e]})),delete t._chartjs)}function Zb(t){const e=new Set(t);return e.size===t.length?t:Array.from(e)}const Kb="undefined"==typeof window?function(t){return t()}:window.requestAnimationFrame;function Jb(t,e){let i=[],n=!1;return function(...r){i=r,n||(n=!0,Kb.call(window,(()=>{n=!1,t.apply(e,i)})))}}const Qb=t=>"start"===t?"left":"end"===t?"right":"center",tw=(t,e,i)=>"start"===t?e:"end"===t?i:(e+i)/2;function ew(t,e,i){const n=e.length;let r=0,o=n;if(t._sorted){const{iScale:s,_parsed:a}=t,l=s.axis,{min:c,max:u,minDefined:h,maxDefined:d}=s.getUserBounds();h&&(r=Gb(Math.min(qb(a,l,c).lo,i?n:qb(e,l,s.getPixelForValue(c)).lo),0,n-1)),o=d?Gb(Math.max(qb(a,s.axis,u,!0).hi+1,i?0:qb(e,l,s.getPixelForValue(u),!0).hi+1),r,n)-r:n-r}return{start:r,count:o}}function iw(t){const{xScale:e,yScale:i,_scaleRanges:n}=t,r={xmin:e.min,xmax:e.max,ymin:i.min,ymax:i.max};if(!n)return t._scaleRanges=r,!0;const o=n.xmin!==e.min||n.xmax!==e.max||n.ymin!==i.min||n.ymax!==i.max;return Object.assign(n,r),o}const nw=t=>0===t||1===t,rw=(t,e,i)=>-Math.pow(2,10*(t-=1))*Math.sin((t-e)*wb/i),ow=(t,e,i)=>Math.pow(2,-10*t)*Math.sin((t-e)*wb/i)+1,sw={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>1-Math.cos(t*Mb),easeOutSine:t=>Math.sin(t*Mb),easeInOutSine:t=>-.5*(Math.cos(bb*t)-1),easeInExpo:t=>0===t?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>nw(t)?t:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,-10*(2*t-1))),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>nw(t)?t:rw(t,.075,.3),easeOutElastic:t=>nw(t)?t:ow(t,.075,.3),easeInOutElastic(t){const e=.1125;return nw(t)?t:t<.5?.5*rw(2*t,e,.45):.5+.5*ow(2*t-1,e,.45)},easeInBack(t){const e=1.70158;return t*t*((e+1)*t-e)},easeOutBack(t){const e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},easeInBounce:t=>1-sw.easeOutBounce(1-t),easeOutBounce(t){const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375},easeInOutBounce:t=>t<.5?.5*sw.easeInBounce(2*t):.5*sw.easeOutBounce(2*t-1)+.5};function aw(t){if(t&&"object"==typeof t){const e=t.toString();return"[object CanvasPattern]"===e||"[object CanvasGradient]"===e}return!1}function lw(t){return aw(t)?t:new Zx(t)}function cw(t){return aw(t)?t:new Zx(t).saturate(.5).darken(.1).hexString()}const uw=["x","y","borderWidth","radius","tension"],hw=["color","borderColor","backgroundColor"],dw=new Map;function pw(t,e,i){return function(t,e){e=e||{};const i=t+JSON.stringify(e);let n=dw.get(i);return n||(n=new Intl.NumberFormat(t,e),dw.set(i,n)),n}(e,i).format(t)}const fw={values:t=>tb(t)?t:""+t,numeric(t,e,i){if(0===t)return"0";const n=this.chart.options.locale;let r,o=t;if(i.length>1){const e=Math.max(Math.abs(i[0].value),Math.abs(i[i.length-1].value));(e<1e-4||e>1e15)&&(r="scientific"),o=function(t,e){let i=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(i)>=1&&t!==Math.floor(t)&&(i=t-Math.floor(t)),i}(t,i)}const s=Ab(Math.abs(o)),a=isNaN(s)?1:Math.max(Math.min(-1*Math.floor(s),20),0),l={notation:r,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),pw(t,n,l)},logarithmic(t,e,i){if(0===t)return"0";const n=i[e].significand||t/Math.pow(10,Math.floor(Ab(t)));return[1,2,3,5,10,15].includes(n)||e>.8*i.length?fw.numeric.call(this,t,e,i):""}};var mw={formatters:fw};const gw=Object.create(null),_w=Object.create(null);function yw(t,e){if(!e)return t;const i=e.split(".");for(let e=0,n=i.length;e<n;++e){const n=i[e];t=t[n]||(t[n]=Object.create(null))}return t}function vw(t,e,i){return"string"==typeof e?db(yw(t,e),i):db(yw(t,""),e)}class xw{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,e)=>cw(e.backgroundColor),this.hoverBorderColor=(t,e)=>cw(e.borderColor),this.hoverColor=(t,e)=>cw(e.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return vw(this,t,e)}get(t){return yw(this,t)}describe(t,e){return vw(_w,t,e)}override(t,e){return vw(gw,t,e)}route(t,e,i,n){const r=yw(this,t),o=yw(this,i),s="_"+e;Object.defineProperties(r,{[s]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const t=this[s],e=o[n];return eb(t)?Object.assign({},e,t):rb(t,e)},set(t){this[s]=t}}})}apply(t){t.forEach((t=>t(this)))}}var bw=new xw({_scriptable:t=>!t.startsWith("on"),_indexable:t=>"events"!==t,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>"onProgress"!==t&&"onComplete"!==t&&"fn"!==t}),t.set("animations",{colors:{type:"color",properties:hw},numbers:{type:"number",properties:uw}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>0|t}}}})},function(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:mw.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&"callback"!==t&&"parser"!==t,_indexable:t=>"borderDash"!==t&&"tickBorderDash"!==t&&"dash"!==t}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:t=>"backdropPadding"!==t&&"callback"!==t,_indexable:t=>"backdropPadding"!==t})}]);function ww(t,e,i,n,r){let o=e[r];return o||(o=e[r]=t.measureText(r).width,i.push(r)),o>n&&(n=o),n}function Ew(t,e,i,n){let r=(n=n||{}).data=n.data||{},o=n.garbageCollect=n.garbageCollect||[];n.font!==e&&(r=n.data={},o=n.garbageCollect=[],n.font=e),t.save(),t.font=e;let s=0;const a=i.length;let l,c,u,h,d;for(l=0;l<a;l++)if(h=i[l],null==h||tb(h)){if(tb(h))for(c=0,u=h.length;c<u;c++)d=h[c],null==d||tb(d)||(s=ww(t,r,o,s,d))}else s=ww(t,r,o,s,h);t.restore();const p=o.length/2;if(p>i.length){for(l=0;l<p;l++)delete r[o[l]];o.splice(0,p)}return s}function Sw(t,e,i){const n=t.currentDevicePixelRatio,r=0!==i?Math.max(i/2,.5):0;return Math.round((e-r)*n)/n+r}function Tw(t,e){(e=e||t.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore()}function Mw(t,e,i,n){Iw(t,e,i,n,null)}function Iw(t,e,i,n,r){let o,s,a,l,c,u,h,d;const p=e.pointStyle,f=e.rotation,m=e.radius;let g=(f||0)*Tb;if(p&&"object"==typeof p&&(o=p.toString(),"[object HTMLImageElement]"===o||"[object HTMLCanvasElement]"===o))return t.save(),t.translate(i,n),t.rotate(g),t.drawImage(p,-p.width/2,-p.height/2,p.width,p.height),void t.restore();if(!(isNaN(m)||m<=0)){switch(t.beginPath(),p){default:r?t.ellipse(i,n,r/2,m,0,0,wb):t.arc(i,n,m,0,wb),t.closePath();break;case"triangle":u=r?r/2:m,t.moveTo(i+Math.sin(g)*u,n-Math.cos(g)*m),g+=Cb,t.lineTo(i+Math.sin(g)*u,n-Math.cos(g)*m),g+=Cb,t.lineTo(i+Math.sin(g)*u,n-Math.cos(g)*m),t.closePath();break;case"rectRounded":c=.516*m,l=m-c,s=Math.cos(g+Ib)*l,h=Math.cos(g+Ib)*(r?r/2-c:l),a=Math.sin(g+Ib)*l,d=Math.sin(g+Ib)*(r?r/2-c:l),t.arc(i-h,n-a,c,g-bb,g-Mb),t.arc(i+d,n-s,c,g-Mb,g),t.arc(i+h,n+a,c,g,g+Mb),t.arc(i-d,n+s,c,g+Mb,g+bb),t.closePath();break;case"rect":if(!f){l=Math.SQRT1_2*m,u=r?r/2:l,t.rect(i-u,n-l,2*u,2*l);break}g+=Ib;case"rectRot":h=Math.cos(g)*(r?r/2:m),s=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),t.moveTo(i-h,n-a),t.lineTo(i+d,n-s),t.lineTo(i+h,n+a),t.lineTo(i-d,n+s),t.closePath();break;case"crossRot":g+=Ib;case"cross":h=Math.cos(g)*(r?r/2:m),s=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),t.moveTo(i-h,n-a),t.lineTo(i+h,n+a),t.moveTo(i+d,n-s),t.lineTo(i-d,n+s);break;case"star":h=Math.cos(g)*(r?r/2:m),s=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),t.moveTo(i-h,n-a),t.lineTo(i+h,n+a),t.moveTo(i+d,n-s),t.lineTo(i-d,n+s),g+=Ib,h=Math.cos(g)*(r?r/2:m),s=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),t.moveTo(i-h,n-a),t.lineTo(i+h,n+a),t.moveTo(i+d,n-s),t.lineTo(i-d,n+s);break;case"line":s=r?r/2:Math.cos(g)*m,a=Math.sin(g)*m,t.moveTo(i-s,n-a),t.lineTo(i+s,n+a);break;case"dash":t.moveTo(i,n),t.lineTo(i+Math.cos(g)*(r?r/2:m),n+Math.sin(g)*m);break;case!1:t.closePath()}t.fill(),e.borderWidth>0&&t.stroke()}}function Cw(t,e,i){return i=i||.5,!e||t&&t.x>e.left-i&&t.x<e.right+i&&t.y>e.top-i&&t.y<e.bottom+i}function Aw(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function Pw(t){t.restore()}function Lw(t,e,i,n,r){if(!e)return t.lineTo(i.x,i.y);if("middle"===r){const n=(e.x+i.x)/2;t.lineTo(n,e.y),t.lineTo(n,i.y)}else"after"===r!=!!n?t.lineTo(e.x,i.y):t.lineTo(i.x,e.y);t.lineTo(i.x,i.y)}function Rw(t,e,i,n){if(!e)return t.lineTo(i.x,i.y);t.bezierCurveTo(n?e.cp1x:e.cp2x,n?e.cp1y:e.cp2y,n?i.cp2x:i.cp1x,n?i.cp2y:i.cp1y,i.x,i.y)}function Dw(t,e,i,n,r){if(r.strikethrough||r.underline){const o=t.measureText(n),s=e-o.actualBoundingBoxLeft,a=e+o.actualBoundingBoxRight,l=i-o.actualBoundingBoxAscent,c=i+o.actualBoundingBoxDescent,u=r.strikethrough?(l+c)/2:c;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=r.decorationWidth||2,t.moveTo(s,u),t.lineTo(a,u),t.stroke()}}function kw(t,e){const i=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=i}function Nw(t,e,i,n,r,o={}){const s=tb(e)?e:[e],a=o.strokeWidth>0&&""!==o.strokeColor;let l,c;for(t.save(),t.font=r.string,function(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),Qx(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}(t,o),l=0;l<s.length;++l)c=s[l],o.backdrop&&kw(t,o.backdrop),a&&(o.strokeColor&&(t.strokeStyle=o.strokeColor),Qx(o.strokeWidth)||(t.lineWidth=o.strokeWidth),t.strokeText(c,i,n,o.maxWidth)),t.fillText(c,i,n,o.maxWidth),Dw(t,i,n,c,o),n+=Number(r.lineHeight);t.restore()}function Ow(t,e){const{x:i,y:n,w:r,h:o,radius:s}=e;t.arc(i+s.topLeft,n+s.topLeft,s.topLeft,1.5*bb,bb,!0),t.lineTo(i,n+o-s.bottomLeft),t.arc(i+s.bottomLeft,n+o-s.bottomLeft,s.bottomLeft,bb,Mb,!0),t.lineTo(i+r-s.bottomRight,n+o),t.arc(i+r-s.bottomRight,n+o-s.bottomRight,s.bottomRight,Mb,0,!0),t.lineTo(i+r,n+s.topRight),t.arc(i+r-s.topRight,n+s.topRight,s.topRight,0,-Mb,!0),t.lineTo(i+s.topLeft,n)}const Fw=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,zw=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Bw(t,e){const i=(""+t).match(Fw);if(!i||"normal"===i[1])return 1.2*e;switch(t=+i[2],i[3]){case"px":return t;case"%":t/=100}return e*t}const Uw=t=>+t||0;function Vw(t,e){const i={},n=eb(e),r=n?Object.keys(e):e,o=eb(t)?n?i=>rb(t[i],t[e[i]]):e=>t[e]:()=>t;for(const t of r)i[t]=Uw(o(t));return i}function jw(t){return Vw(t,{top:"y",right:"x",bottom:"y",left:"x"})}function Gw(t){return Vw(t,["topLeft","topRight","bottomLeft","bottomRight"])}function Hw(t){const e=jw(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Ww(t,e){t=t||{},e=e||bw.font;let i=rb(t.size,e.size);"string"==typeof i&&(i=parseInt(i,10));let n=rb(t.style,e.style);n&&!(""+n).match(zw)&&(console.warn('Invalid font style specified: "'+n+'"'),n=void 0);const r={family:rb(t.family,e.family),lineHeight:Bw(rb(t.lineHeight,e.lineHeight),i),size:i,style:n,weight:rb(t.weight,e.weight),string:""};return r.string=function(t){return!t||Qx(t.size)||Qx(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}(r),r}function qw(t,e,i,n){let r,o,s,a=!0;for(r=0,o=t.length;r<o;++r)if(s=t[r],void 0!==s&&(void 0!==e&&"function"==typeof s&&(s=s(e),a=!1),void 0!==i&&tb(s)&&(s=s[i%s.length],a=!1),void 0!==s))return n&&!a&&(n.cacheable=!1),s}function Xw(t,e){return Object.assign(Object.create(t),e)}function $w(t,e=[""],i,n,r=(()=>t[0])){const o=i||t;void 0===n&&(n=oE("_fallback",t));const s={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:o,_fallback:n,_getTarget:r,override:i=>$w([i,...t],e,o,n)};return new Proxy(s,{deleteProperty:(e,i)=>(delete e[i],delete e._keys,delete t[0][i],!0),get:(i,n)=>Qw(i,n,(()=>function(t,e,i,n){let r;for(const o of e)if(r=oE(Kw(o,t),i),void 0!==r)return Jw(t,r)?nE(i,n,t,r):r}(n,e,t,i))),getOwnPropertyDescriptor:(t,e)=>Reflect.getOwnPropertyDescriptor(t._scopes[0],e),getPrototypeOf:()=>Reflect.getPrototypeOf(t[0]),has:(t,e)=>sE(t).includes(e),ownKeys:t=>sE(t),set(t,e,i){const n=t._storage||(t._storage=r());return t[e]=n[e]=i,delete t._keys,!0}})}function Yw(t,e,i,n){const r={_cacheable:!1,_proxy:t,_context:e,_subProxy:i,_stack:new Set,_descriptors:Zw(t,n),setContext:e=>Yw(t,e,i,n),override:r=>Yw(t.override(r),e,i,n)};return new Proxy(r,{deleteProperty:(e,i)=>(delete e[i],delete t[i],!0),get:(t,e,i)=>Qw(t,e,(()=>function(t,e,i){const{_proxy:n,_context:r,_subProxy:o,_descriptors:s}=t;let a=n[e];return vb(a)&&s.isScriptable(e)&&(a=function(t,e,i,n){const{_proxy:r,_context:o,_subProxy:s,_stack:a}=i;if(a.has(t))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+t);a.add(t);let l=e(o,s||n);return a.delete(t),Jw(t,l)&&(l=nE(r._scopes,r,t,l)),l}(e,a,t,i)),tb(a)&&a.length&&(a=function(t,e,i,n){const{_proxy:r,_context:o,_subProxy:s,_descriptors:a}=i;if(void 0!==o.index&&n(t))return e[o.index%e.length];if(eb(e[0])){const i=e,n=r._scopes.filter((t=>t!==i));e=[];for(const l of i){const i=nE(n,r,t,l);e.push(Yw(i,o,s&&s[t],a))}}return e}(e,a,t,s.isIndexable)),Jw(e,a)&&(a=Yw(a,r,o&&o[e],s)),a}(t,e,i))),getOwnPropertyDescriptor:(e,i)=>e._descriptors.allKeys?Reflect.has(t,i)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,i),getPrototypeOf:()=>Reflect.getPrototypeOf(t),has:(e,i)=>Reflect.has(t,i),ownKeys:()=>Reflect.ownKeys(t),set:(e,i,n)=>(t[i]=n,delete e[i],!0)})}function Zw(t,e={scriptable:!0,indexable:!0}){const{_scriptable:i=e.scriptable,_indexable:n=e.indexable,_allKeys:r=e.allKeys}=t;return{allKeys:r,scriptable:i,indexable:n,isScriptable:vb(i)?i:()=>i,isIndexable:vb(n)?n:()=>n}}const Kw=(t,e)=>t?t+_b(e):e,Jw=(t,e)=>eb(e)&&"adapters"!==t&&(null===Object.getPrototypeOf(e)||e.constructor===Object);function Qw(t,e,i){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];const n=i();return t[e]=n,n}function tE(t,e,i){return vb(t)?t(e,i):t}const eE=(t,e)=>!0===t?e:"string"==typeof t?gb(e,t):void 0;function iE(t,e,i,n,r){for(const o of e){const e=eE(i,o);if(e){t.add(e);const o=tE(e._fallback,i,r);if(void 0!==o&&o!==i&&o!==n)return o}else if(!1===e&&void 0!==n&&i!==n)return null}return!1}function nE(t,e,i,n){const r=e._rootScopes,o=tE(e._fallback,i,n),s=[...t,...r],a=new Set;a.add(n);let l=rE(a,s,i,o||i,n);return null!==l&&(void 0===o||o===i||(l=rE(a,s,o,l,n),null!==l))&&$w(Array.from(a),[""],r,o,(()=>function(t,e,i){const n=t._getTarget();e in n||(n[e]={});const r=n[e];return tb(r)&&eb(i)?i:r||{}}(e,i,n)))}function rE(t,e,i,n,r){for(;i;)i=iE(t,e,i,n,r);return i}function oE(t,e){for(const i of e){if(!i)continue;const e=i[t];if(void 0!==e)return e}}function sE(t){let e=t._keys;return e||(e=t._keys=function(t){const e=new Set;for(const i of t)for(const t of Object.keys(i).filter((t=>!t.startsWith("_"))))e.add(t);return Array.from(e)}(t._scopes)),e}function aE(t,e,i,n){const{iScale:r}=t,{key:o="r"}=this._parsing,s=new Array(n);let a,l,c,u;for(a=0,l=n;a<l;++a)c=a+i,u=e[c],s[a]={r:r.parse(gb(u,o),c)};return s}const lE=Number.EPSILON||1e-14,cE=(t,e)=>e<t.length&&!t[e].skip&&t[e],uE=t=>"x"===t?"y":"x";function hE(t,e,i,n){const r=t.skip?e:t,o=e,s=i.skip?e:i,a=Bb(o,r),l=Bb(s,o);let c=a/(a+l),u=l/(a+l);c=isNaN(c)?0:c,u=isNaN(u)?0:u;const h=n*c,d=n*u;return{previous:{x:o.x-h*(s.x-r.x),y:o.y-h*(s.y-r.y)},next:{x:o.x+d*(s.x-r.x),y:o.y+d*(s.y-r.y)}}}function dE(t,e,i){return Math.max(Math.min(t,i),e)}function pE(t,e,i,n,r){let o,s,a,l;if(e.spanGaps&&(t=t.filter((t=>!t.skip))),"monotone"===e.cubicInterpolationMode)!function(t,e="x"){const i=uE(e),n=t.length,r=Array(n).fill(0),o=Array(n);let s,a,l,c=cE(t,0);for(s=0;s<n;++s)if(a=l,l=c,c=cE(t,s+1),l){if(c){const t=c[e]-l[e];r[s]=0!==t?(c[i]-l[i])/t:0}o[s]=a?c?Pb(r[s-1])!==Pb(r[s])?0:(r[s-1]+r[s])/2:r[s-1]:r[s]}!function(t,e,i){const n=t.length;let r,o,s,a,l,c=cE(t,0);for(let u=0;u<n-1;++u)l=c,c=cE(t,u+1),l&&c&&(Lb(e[u],0,lE)?i[u]=i[u+1]=0:(r=i[u]/e[u],o=i[u+1]/e[u],a=Math.pow(r,2)+Math.pow(o,2),a<=9||(s=3/Math.sqrt(a),i[u]=r*s*e[u],i[u+1]=o*s*e[u])))}(t,r,o),function(t,e,i="x"){const n=uE(i),r=t.length;let o,s,a,l=cE(t,0);for(let c=0;c<r;++c){if(s=a,a=l,l=cE(t,c+1),!a)continue;const r=a[i],u=a[n];s&&(o=(r-s[i])/3,a[`cp1${i}`]=r-o,a[`cp1${n}`]=u-o*e[c]),l&&(o=(l[i]-r)/3,a[`cp2${i}`]=r+o,a[`cp2${n}`]=u+o*e[c])}}(t,o,e)}(t,r);else{let i=n?t[t.length-1]:t[0];for(o=0,s=t.length;o<s;++o)a=t[o],l=hE(i,a,t[Math.min(o+1,s-(n?0:1))%s],e.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,i=a}e.capBezierPoints&&function(t,e){let i,n,r,o,s,a=Cw(t[0],e);for(i=0,n=t.length;i<n;++i)s=o,o=a,a=i<n-1&&Cw(t[i+1],e),o&&(r=t[i],s&&(r.cp1x=dE(r.cp1x,e.left,e.right),r.cp1y=dE(r.cp1y,e.top,e.bottom)),a&&(r.cp2x=dE(r.cp2x,e.left,e.right),r.cp2y=dE(r.cp2y,e.top,e.bottom)))}(t,i)}function fE(){return"undefined"!=typeof window&&"undefined"!=typeof document}function mE(t){let e=t.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function gE(t,e,i){let n;return"string"==typeof t?(n=parseInt(t,10),-1!==t.indexOf("%")&&(n=n/100*e.parentNode[i])):n=t,n}const _E=t=>t.ownerDocument.defaultView.getComputedStyle(t,null),yE=["top","right","bottom","left"];function vE(t,e,i){const n={};i=i?"-"+i:"";for(let r=0;r<4;r++){const o=yE[r];n[o]=parseFloat(t[e+"-"+o+i])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}const xE=(t,e,i)=>(t>0||e>0)&&(!i||!i.shadowRoot);function bE(t,e){if("native"in t)return t;const{canvas:i,currentDevicePixelRatio:n}=e,r=_E(i),o="border-box"===r.boxSizing,s=vE(r,"padding"),a=vE(r,"border","width"),{x:l,y:c,box:u}=function(t,e){const i=t.touches,n=i&&i.length?i[0]:t,{offsetX:r,offsetY:o}=n;let s,a,l=!1;if(xE(r,o,t.target))s=r,a=o;else{const t=e.getBoundingClientRect();s=n.clientX-t.left,a=n.clientY-t.top,l=!0}return{x:s,y:a,box:l}}(t,i),h=s.left+(u&&a.left),d=s.top+(u&&a.top);let{width:p,height:f}=e;return o&&(p-=s.width+a.width,f-=s.height+a.height),{x:Math.round((l-h)/p*i.width/n),y:Math.round((c-d)/f*i.height/n)}}const wE=t=>Math.round(10*t)/10;function EE(t,e,i){const n=e||1,r=Math.floor(t.height*n),o=Math.floor(t.width*n);t.height=Math.floor(t.height),t.width=Math.floor(t.width);const s=t.canvas;return s.style&&(i||!s.style.height&&!s.style.width)&&(s.style.height=`${t.height}px`,s.style.width=`${t.width}px`),(t.currentDevicePixelRatio!==n||s.height!==r||s.width!==o)&&(t.currentDevicePixelRatio=n,s.height=r,s.width=o,t.ctx.setTransform(n,0,0,n,0,0),!0)}const SE=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};fE()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch(t){}return t}();function TE(t,e){const i=function(t,e){return _E(t).getPropertyValue(e)}(t,e),n=i&&i.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}function ME(t,e,i,n){return{x:t.x+i*(e.x-t.x),y:t.y+i*(e.y-t.y)}}function IE(t,e,i,n){return{x:t.x+i*(e.x-t.x),y:"middle"===n?i<.5?t.y:e.y:"after"===n?i<1?t.y:e.y:i>0?e.y:t.y}}function CE(t,e,i,n){const r={x:t.cp2x,y:t.cp2y},o={x:e.cp1x,y:e.cp1y},s=ME(t,r,i),a=ME(r,o,i),l=ME(o,e,i),c=ME(s,a,i),u=ME(a,l,i);return ME(c,u,i)}function AE(t,e,i){return t?function(t,e){return{x:i=>t+t+e-i,setWidth(t){e=t},textAlign:t=>"center"===t?t:"right"===t?"left":"right",xPlus:(t,e)=>t-e,leftForLtr:(t,e)=>t-e}}(e,i):{x:t=>t,setWidth(t){},textAlign:t=>t,xPlus:(t,e)=>t+e,leftForLtr:(t,e)=>t}}function PE(t,e){let i,n;"ltr"!==e&&"rtl"!==e||(i=t.canvas.style,n=[i.getPropertyValue("direction"),i.getPropertyPriority("direction")],i.setProperty("direction",e,"important"),t.prevTextDirection=n)}function LE(t,e){void 0!==e&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function RE(t){return"angle"===t?{between:jb,compare:Ub,normalize:Vb}:{between:Hb,compare:(t,e)=>t-e,normalize:t=>t}}function DE({start:t,end:e,count:i,loop:n,style:r}){return{start:t%i,end:e%i,loop:n&&(e-t+1)%i==0,style:r}}function kE(t,e,i){if(!i)return[t];const{property:n,start:r,end:o}=i,s=e.length,{compare:a,between:l,normalize:c}=RE(n),{start:u,end:h,loop:d,style:p}=function(t,e,i){const{property:n,start:r,end:o}=i,{between:s,normalize:a}=RE(n),l=e.length;let c,u,{start:h,end:d,loop:p}=t;if(p){for(h+=l,d+=l,c=0,u=l;c<u&&s(a(e[h%l][n]),r,o);++c)h--,d--;h%=l,d%=l}return d<h&&(d+=l),{start:h,end:d,loop:p,style:t.style}}(t,e,i),f=[];let m,g,_,y=!1,v=null;for(let t=u,i=u;t<=h;++t)g=e[t%s],g.skip||(m=c(g[n]),m!==_&&(y=l(m,r,o),null===v&&(y||l(r,_,m)&&0!==a(r,_))&&(v=0===a(m,r)?t:i),null!==v&&(!y||0===a(o,m)||l(o,_,m))&&(f.push(DE({start:v,end:t,loop:d,count:s,style:p})),v=null),i=t,_=m));return null!==v&&f.push(DE({start:v,end:h,loop:d,count:s,style:p})),f}function NE(t,e){const i=[],n=t.segments;for(let r=0;r<n.length;r++){const o=kE(n[r],t.points,e);o.length&&i.push(...o)}return i}function OE(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function FE(t,e){if(!e)return!1;const i=[],n=function(t,e){return aw(e)?(i.includes(e)||i.push(e),i.indexOf(e)):e};return JSON.stringify(t,n)!==JSON.stringify(e,n)}class zE{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,n){const r=e.listeners[n],o=e.duration;r.forEach((n=>n({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(i-e.start,o)})))}_refresh(){this._request||(this._running=!0,this._request=Kb.call(window,(()=>{this._update(),this._request=null,this._running&&this._refresh()})))}_update(t=Date.now()){let e=0;this._charts.forEach(((i,n)=>{if(!i.running||!i.items.length)return;const r=i.items;let o,s=r.length-1,a=!1;for(;s>=0;--s)o=r[s],o._active?(o._total>i.duration&&(i.duration=o._total),o.tick(t),a=!0):(r[s]=r[r.length-1],r.pop());a&&(n.draw(),this._notify(n,i,t,"progress")),r.length||(i.running=!1,this._notify(n,i,t,"complete"),i.initial=!1),e+=r.length})),this._lastDate=t,0===e&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){e&&e.length&&this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce(((t,e)=>Math.max(t,e._duration)),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!!(e&&e.running&&e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let n=i.length-1;for(;n>=0;--n)i[n].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var BE=new zE;const UE="transparent",VE={boolean:(t,e,i)=>i>.5?e:t,color(t,e,i){const n=lw(t||UE),r=n.valid&&lw(e||UE);return r&&r.valid?r.mix(n,i).hexString():e},number:(t,e,i)=>t+(e-t)*i};class jE{constructor(t,e,i,n){const r=e[i];n=qw([t.to,n,r,t.from]);const o=qw([t.from,r,n]);this._active=!0,this._fn=t.fn||VE[t.type||typeof o],this._easing=sw[t.easing]||sw.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=o,this._to=n,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const n=this._target[this._prop],r=i-this._start,o=this._duration-r;this._start=i,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=qw([t.to,e,n,t.from]),this._from=qw([t.from,n,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,n=this._prop,r=this._from,o=this._loop,s=this._to;let a;if(this._active=r!==s&&(o||e<i),!this._active)return this._target[n]=s,void this._notify(!0);e<0?this._target[n]=r:(a=e/i%2,a=o&&a>1?2-a:a,a=this._easing(Math.min(1,Math.max(0,a))),this._target[n]=this._fn(r,s,a))}wait(){const t=this._promises||(this._promises=[]);return new Promise(((e,i)=>{t.push({res:e,rej:i})}))}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let t=0;t<i.length;t++)i[t][e]()}}class GE{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!eb(t))return;const e=Object.keys(bw.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach((n=>{const r=t[n];if(!eb(r))return;const o={};for(const t of e)o[t]=r[t];(tb(r.properties)&&r.properties||[n]).forEach((t=>{t!==n&&i.has(t)||i.set(t,o)}))}))}_animateOptions(t,e){const i=e.options,n=function(t,e){if(!e)return;let i=t.options;if(i)return i.$shared&&(t.options=i=Object.assign({},i,{$shared:!1,$animations:{}})),i;t.options=e}(t,i);if(!n)return[];const r=this._createAnimations(n,i);return i.$shared&&function(t,e){const i=[],n=Object.keys(e);for(let e=0;e<n.length;e++){const r=t[n[e]];r&&r.active()&&i.push(r.wait())}return Promise.all(i)}(t.options.$animations,i).then((()=>{t.options=i}),(()=>{})),r}_createAnimations(t,e){const i=this._properties,n=[],r=t.$animations||(t.$animations={}),o=Object.keys(e),s=Date.now();let a;for(a=o.length-1;a>=0;--a){const l=o[a];if("$"===l.charAt(0))continue;if("options"===l){n.push(...this._animateOptions(t,e));continue}const c=e[l];let u=r[l];const h=i.get(l);if(u){if(h&&u.active()){u.update(h,c,s);continue}u.cancel()}h&&h.duration?(r[l]=u=new jE(h,t,l,c),n.push(u)):t[l]=c}return n}update(t,e){if(0===this._properties.size)return void Object.assign(t,e);const i=this._createAnimations(t,e);return i.length?(BE.add(this._chart,i),!0):void 0}}function HE(t,e){const i=t&&t.options||{},n=i.reverse,r=void 0===i.min?e:0,o=void 0===i.max?e:0;return{start:n?o:r,end:n?r:o}}function WE(t,e){const i=[],n=t._getSortedDatasetMetas(e);let r,o;for(r=0,o=n.length;r<o;++r)i.push(n[r].index);return i}function qE(t,e,i,n={}){const r=t.keys,o="single"===n.mode;let s,a,l,c;if(null!==e){for(s=0,a=r.length;s<a;++s){if(l=+r[s],l===i){if(n.all)continue;break}c=t.values[l],ib(c)&&(o||0===e||Pb(e)===Pb(c))&&(e+=c)}return e}}function XE(t,e){const i=t&&t.options.stacked;return i||void 0===i&&void 0!==e.stack}function $E(t,e,i){const n=t[e]||(t[e]={});return n[i]||(n[i]={})}function YE(t,e,i,n){for(const r of e.getMatchingVisibleMetas(n).reverse()){const e=t[r.index];if(i&&e>0||!i&&e<0)return r.index}return null}function ZE(t,e){const{chart:i,_cachedMeta:n}=t,r=i._stacks||(i._stacks={}),{iScale:o,vScale:s,index:a}=n,l=o.axis,c=s.axis,u=function(t,e,i){return`${t.id}.${e.id}.${i.stack||i.type}`}(o,s,n),h=e.length;let d;for(let t=0;t<h;++t){const i=e[t],{[l]:o,[c]:h}=i;d=(i._stacks||(i._stacks={}))[c]=$E(r,u,o),d[a]=h,d._top=YE(d,s,!0,n.type),d._bottom=YE(d,s,!1,n.type),(d._visualValues||(d._visualValues={}))[a]=h}}function KE(t,e){const i=t.scales;return Object.keys(i).filter((t=>i[t].axis===e)).shift()}function JE(t,e){const i=t.controller.index,n=t.vScale&&t.vScale.axis;if(n){e=e||t._parsed;for(const t of e){const e=t._stacks;if(!e||void 0===e[n]||void 0===e[n][i])return;delete e[n][i],void 0!==e[n]._visualValues&&void 0!==e[n]._visualValues[i]&&delete e[n]._visualValues[i]}}}const QE=t=>"reset"===t||"none"===t,tS=(t,e)=>e?t:Object.assign({},t);class eS{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=XE(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&JE(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),n=(t,e,i,n)=>"x"===t?e:"r"===t?n:i,r=e.xAxisID=rb(i.xAxisID,KE(t,"x")),o=e.yAxisID=rb(i.yAxisID,KE(t,"y")),s=e.rAxisID=rb(i.rAxisID,KE(t,"r")),a=e.indexAxis,l=e.iAxisID=n(a,r,o,s),c=e.vAxisID=n(a,o,r,s);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(s),e.iScale=this.getScaleForId(l),e.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Yb(this._data,this),t._stacked&&JE(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(eb(e))this._data=function(t){const e=Object.keys(t),i=new Array(e.length);let n,r,o;for(n=0,r=e.length;n<r;++n)o=e[n],i[n]={x:o,y:t[o]};return i}(e);else if(i!==e){if(i){Yb(i,this);const t=this._cachedMeta;JE(t),t._parsed=[]}e&&Object.isExtensible(e)&&function(t,e){t._chartjs?t._chartjs.listeners.push(e):(Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),$b.forEach((e=>{const i="_onData"+_b(e),n=t[e];Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value(...e){const r=n.apply(this,e);return t._chartjs.listeners.forEach((t=>{"function"==typeof t[i]&&t[i](...e)})),r}})})))}(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let n=!1;this._dataCheck();const r=e._stacked;e._stacked=XE(e.vScale,e),e.stack!==i.stack&&(n=!0,JE(e),e.stack=i.stack),this._resyncElements(t),(n||r!==e._stacked)&&ZE(this,e._parsed)}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:n}=this,{iScale:r,_stacked:o}=i,s=r.axis;let a,l,c,u=0===t&&e===n.length||i._sorted,h=t>0&&i._parsed[t-1];if(!1===this._parsing)i._parsed=n,i._sorted=!0,c=n;else{c=tb(n[t])?this.parseArrayData(i,n,t,e):eb(n[t])?this.parseObjectData(i,n,t,e):this.parsePrimitiveData(i,n,t,e);const r=()=>null===l[s]||h&&l[s]<h[s];for(a=0;a<e;++a)i._parsed[a+t]=l=c[a],u&&(r()&&(u=!1),h=l);i._sorted=u}o&&ZE(this,c)}parsePrimitiveData(t,e,i,n){const{iScale:r,vScale:o}=t,s=r.axis,a=o.axis,l=r.getLabels(),c=r===o,u=new Array(n);let h,d,p;for(h=0,d=n;h<d;++h)p=h+i,u[h]={[s]:c||r.parse(l[p],p),[a]:o.parse(e[p],p)};return u}parseArrayData(t,e,i,n){const{xScale:r,yScale:o}=t,s=new Array(n);let a,l,c,u;for(a=0,l=n;a<l;++a)c=a+i,u=e[c],s[a]={x:r.parse(u[0],c),y:o.parse(u[1],c)};return s}parseObjectData(t,e,i,n){const{xScale:r,yScale:o}=t,{xAxisKey:s="x",yAxisKey:a="y"}=this._parsing,l=new Array(n);let c,u,h,d;for(c=0,u=n;c<u;++c)h=c+i,d=e[h],l[c]={x:r.parse(gb(d,s),h),y:o.parse(gb(d,a),h)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const n=this.chart,r=this._cachedMeta,o=e[t.axis];return qE({keys:WE(n,!0),values:e._stacks[t.axis]._visualValues},o,r.index,{mode:i})}updateRangeFromParsed(t,e,i,n){const r=i[e.axis];let o=null===r?NaN:r;const s=n&&i._stacks[e.axis];n&&s&&(n.values=s,o=qE(n,r,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const i=this._cachedMeta,n=i._parsed,r=i._sorted&&t===i.iScale,o=n.length,s=this._getOtherScale(t),a=((t,e,i)=>t&&!e.hidden&&e._stacked&&{keys:WE(i,!0),values:null})(e,i,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:u}=function(t){const{min:e,max:i,minDefined:n,maxDefined:r}=t.getUserBounds();return{min:n?e:Number.NEGATIVE_INFINITY,max:r?i:Number.POSITIVE_INFINITY}}(s);let h,d;function p(){d=n[h];const e=d[s.axis];return!ib(d[t.axis])||c>e||u<e}for(h=0;h<o&&(p()||(this.updateRangeFromParsed(l,t,d,a),!r));++h);if(r)for(h=o-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(l,t,d,a);break}return l}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let n,r,o;for(n=0,r=e.length;n<r;++n)o=e[n][t.axis],ib(o)&&i.push(o);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,n=e.vScale,r=this.getParsed(t);return{label:i?""+i.getLabelForValue(r[i.axis]):"",value:n?""+n.getLabelForValue(r[n.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=function(t){let e,i,n,r;return eb(t)?(e=t.top,i=t.right,n=t.bottom,r=t.left):e=i=n=r=t,{top:e,right:i,bottom:n,left:r,disabled:!1===t}}(rb(this.options.clip,function(t,e,i){if(!1===i)return!1;const n=HE(t,i),r=HE(e,i);return{top:r.end,right:n.end,bottom:r.start,left:n.start}}(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,n=i.data||[],r=e.chartArea,o=[],s=this._drawStart||0,a=this._drawCount||n.length-s,l=this.options.drawActiveElementsOnTop;let c;for(i.dataset&&i.dataset.draw(t,r,s,a),c=s;c<s+a;++c){const e=n[c];e.hidden||(e.active&&l?o.push(e):e.draw(t,r))}for(c=0;c<o.length;++c)o[c].draw(t,r)}getStyle(t,e){const i=e?"active":"default";return void 0===t&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const n=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const e=this._cachedMeta.data[t];r=e.$context||(e.$context=function(t,e,i){return Xw(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:i,index:e,mode:"default",type:"data"})}(this.getContext(),t,e)),r.parsed=this.getParsed(t),r.raw=n.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=function(t,e){return Xw(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),r.dataset=n,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=i,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const n="active"===e,r=this._cachedDataOpts,o=t+"-"+e,s=r[o],a=this.enableOptionSharing&&yb(i);if(s)return tS(s,a);const l=this.chart.config,c=l.datasetElementScopeKeys(this._type,t),u=n?[`${t}Hover`,"hover",t,""]:[t,""],h=l.getOptionScopes(this.getDataset(),c),d=Object.keys(bw.elements[t]),p=l.resolveNamedOptions(h,d,(()=>this.getContext(i,n,e)),u);return p.$shared&&(p.$shared=a,r[o]=Object.freeze(tS(p,a))),p}_resolveAnimations(t,e,i){const n=this.chart,r=this._cachedDataOpts,o=`animation-${e}`,s=r[o];if(s)return s;let a;if(!1!==n.options.animation){const n=this.chart.config,r=n.datasetAnimationScopeKeys(this._type,e),o=n.getOptionScopes(this.getDataset(),r);a=n.createResolver(o,this.getContext(t,i,e))}const l=new GE(n,a&&a.animations);return a&&a._cacheable&&(r[o]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||QE(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),n=this._sharedOptions,r=this.getSharedOptions(i),o=this.includeOptions(e,r)||r!==n;return this.updateSharedOptions(r,e,i),{sharedOptions:r,includeOptions:o}}updateElement(t,e,i,n){QE(n)?Object.assign(t,i):this._resolveAnimations(e,n).update(t,i)}updateSharedOptions(t,e,i){t&&!QE(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,n){t.active=n;const r=this.getStyle(e,n);this._resolveAnimations(e,i,n).update(t,{options:!n&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[t,e,i]of this._syncList)this[t](e,i);this._syncList=[];const n=i.length,r=e.length,o=Math.min(r,n);o&&this.parse(0,o),r>n?this._insertElements(n,r-n,t):r<n&&this._removeElements(r,n-r)}_insertElements(t,e,i=!0){const n=this._cachedMeta,r=n.data,o=t+e;let s;const a=t=>{for(t.length+=e,s=t.length-1;s>=o;s--)t[s]=t[s-e]};for(a(r),s=t;s<o;++s)r[s]=new this.dataElementType;this._parsing&&a(n._parsed),this.parse(t,e),i&&this.updateElements(r,t,e,"reset")}updateElements(t,e,i,n){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const n=i._parsed.splice(t,e);i._stacked&&JE(i,n)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,n]=t;this[e](i,n)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function iS(t){const e=t.iScale,i=function(t,e){if(!t._cache.$bar){const i=t.getMatchingVisibleMetas(e);let n=[];for(let e=0,r=i.length;e<r;e++)n=n.concat(i[e].controller.getAllParsedValues(t));t._cache.$bar=Zb(n.sort(((t,e)=>t-e)))}return t._cache.$bar}(e,t.type);let n,r,o,s,a=e._length;const l=()=>{32767!==o&&-32768!==o&&(yb(s)&&(a=Math.min(a,Math.abs(o-s)||a)),s=o)};for(n=0,r=i.length;n<r;++n)o=e.getPixelForValue(i[n]),l();for(s=void 0,n=0,r=e.ticks.length;n<r;++n)o=e.getPixelForTick(n),l();return a}function nS(t,e,i,n){return tb(t)?function(t,e,i,n){const r=i.parse(t[0],n),o=i.parse(t[1],n),s=Math.min(r,o),a=Math.max(r,o);let l=s,c=a;Math.abs(s)>Math.abs(a)&&(l=a,c=s),e[i.axis]=c,e._custom={barStart:l,barEnd:c,start:r,end:o,min:s,max:a}}(t,e,i,n):e[i.axis]=i.parse(t,n),e}function rS(t,e,i,n){const r=t.iScale,o=t.vScale,s=r.getLabels(),a=r===o,l=[];let c,u,h,d;for(c=i,u=i+n;c<u;++c)d=e[c],h={},h[r.axis]=a||r.parse(s[c],c),l.push(nS(d,h,o,c));return l}function oS(t){return t&&void 0!==t.barStart&&void 0!==t.barEnd}function sS(t,e,i,n){let r=e.borderSkipped;const o={};if(!r)return void(t.borderSkipped=o);if(!0===r)return void(t.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:s,end:a,reverse:l,top:c,bottom:u}=function(t){let e,i,n,r,o;return t.horizontal?(e=t.base>t.x,i="left",n="right"):(e=t.base<t.y,i="bottom",n="top"),e?(r="end",o="start"):(r="start",o="end"),{start:i,end:n,reverse:e,top:r,bottom:o}}(t);"middle"===r&&i&&(t.enableBorderRadius=!0,(i._top||0)===n?r=c:(i._bottom||0)===n?r=u:(o[aS(u,s,a,l)]=!0,r=c)),o[aS(r,s,a,l)]=!0,t.borderSkipped=o}function aS(t,e,i,n){var r,o,s;return n?(s=i,t=lS(t=(r=t)===(o=e)?s:r===s?o:r,i,e)):t=lS(t,e,i),t}function lS(t,e,i){return"start"===t?e:"end"===t?i:t}function cS(t,{inflateAmount:e},i){t.inflateAmount="auto"===e?1===i?.33:0:e}class uS extends eS{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:t=>"spacing"!==t,_indexable:t=>"spacing"!==t&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:n}}=t.legend.options;return e.labels.map(((e,r)=>{const o=t.getDatasetMeta(0).controller.getStyle(r);return{text:e,fillStyle:o.backgroundColor,strokeStyle:o.borderColor,fontColor:n,lineWidth:o.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(r),index:r}}))}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}}};constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,n=this._cachedMeta;if(!1===this._parsing)n._parsed=i;else{let r,o,s=t=>+i[t];if(eb(i[t])){const{key:t="value"}=this._parsing;s=e=>+gb(i[e],t)}for(r=t,o=t+e;r<o;++r)n._parsed[r]=s(r)}}_getRotation(){return Nb(this.options.rotation-90)}_getCircumference(){return Nb(this.options.circumference)}_getRotationExtents(){let t=wb,e=-wb;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const n=this.chart.getDatasetMeta(i).controller,r=n._getRotation(),o=n._getCircumference();t=Math.min(t,r),e=Math.max(e,r+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,n=this._cachedMeta,r=n.data,o=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,s=Math.max((Math.min(i.width,i.height)-o)/2,0),a=Math.min((c=s,"string"==typeof(l=this.options.cutout)&&l.endsWith("%")?parseFloat(l)/100:+l/c),1);var l,c;const u=this._getRingWeight(this.index),{circumference:h,rotation:d}=this._getRotationExtents(),{ratioX:p,ratioY:f,offsetX:m,offsetY:g}=function(t,e,i){let n=1,r=1,o=0,s=0;if(e<wb){const a=t,l=a+e,c=Math.cos(a),u=Math.sin(a),h=Math.cos(l),d=Math.sin(l),p=(t,e,n)=>jb(t,a,l,!0)?1:Math.max(e,e*i,n,n*i),f=(t,e,n)=>jb(t,a,l,!0)?-1:Math.min(e,e*i,n,n*i),m=p(0,c,h),g=p(Mb,u,d),_=f(bb,c,h),y=f(bb+Mb,u,d);n=(m-_)/2,r=(g-y)/2,o=-(m+_)/2,s=-(g+y)/2}return{ratioX:n,ratioY:r,offsetX:o,offsetY:s}}(d,h,a),_=(i.width-o)/p,y=(i.height-o)/f,v=Math.max(Math.min(_,y)/2,0),x=ob(this.options.radius,v),b=(x-Math.max(x*a,0))/this._getVisibleDatasetWeightTotal();this.offsetX=m*x,this.offsetY=g*x,n.total=this.calculateTotal(),this.outerRadius=x-b*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-b*u,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const i=this.options,n=this._cachedMeta,r=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||null===n._parsed[t]||n.data[t].hidden?0:this.calculateCircumference(n._parsed[t]*r/wb)}updateElements(t,e,i,n){const r="reset"===n,o=this.chart,s=o.chartArea,a=o.options.animation,l=(s.left+s.right)/2,c=(s.top+s.bottom)/2,u=r&&a.animateScale,h=u?0:this.innerRadius,d=u?0:this.outerRadius,{sharedOptions:p,includeOptions:f}=this._getSharedOptions(e,n);let m,g=this._getRotation();for(m=0;m<e;++m)g+=this._circumference(m,r);for(m=e;m<e+i;++m){const e=this._circumference(m,r),i=t[m],o={x:l+this.offsetX,y:c+this.offsetY,startAngle:g,endAngle:g+e,circumference:e,outerRadius:d,innerRadius:h};f&&(o.options=p||this.resolveDataElementOptions(m,i.active?"active":n)),g+=e,this.updateElement(i,m,o,n)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let i,n=0;for(i=0;i<e.length;i++){const r=t._parsed[i];null===r||isNaN(r)||!this.chart.getDataVisibility(i)||e[i].hidden||(n+=Math.abs(r))}return n}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?wb*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,n=i.data.labels||[],r=pw(e._parsed[t],i.options.locale);return{label:n[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const i=this.chart;let n,r,o,s,a;if(!t)for(n=0,r=i.data.datasets.length;n<r;++n)if(i.isDatasetVisible(n)){o=i.getDatasetMeta(n),t=o.data,s=o.controller;break}if(!t)return 0;for(n=0,r=t.length;n<r;++n)a=s.resolveDataElementOptions(n),"inner"!==a.borderAlign&&(e=Math.max(e,a.borderWidth||0,a.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,n=t.length;i<n;++i){const t=this.resolveDataElementOptions(i);e=Math.max(e,t.offset||0,t.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(rb(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class hS extends eS{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:n}}=t.legend.options;return e.labels.map(((e,r)=>{const o=t.getDatasetMeta(0).controller.getStyle(r);return{text:e,fillStyle:o.backgroundColor,strokeStyle:o.borderColor,fontColor:n,lineWidth:o.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(r),index:r}}))}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,n=i.data.labels||[],r=pw(e._parsed[t].r,i.options.locale);return{label:n[t]||"",value:r}}parseObjectData(t,e,i,n){return aE.bind(this)(t,e,i,n)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach(((t,i)=>{const n=this.getParsed(i).r;!isNaN(n)&&this.chart.getDataVisibility(i)&&(n<e.min&&(e.min=n),n>e.max&&(e.max=n))})),e}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,n=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(n/2,0),o=(r-Math.max(i.cutoutPercentage?r/100*i.cutoutPercentage:1,0))/t.getVisibleDatasetCount();this.outerRadius=r-o*this.index,this.innerRadius=this.outerRadius-o}updateElements(t,e,i,n){const r="reset"===n,o=this.chart,s=o.options.animation,a=this._cachedMeta.rScale,l=a.xCenter,c=a.yCenter,u=a.getIndexAngle(0)-.5*bb;let h,d=u;const p=360/this.countVisibleElements();for(h=0;h<e;++h)d+=this._computeAngle(h,n,p);for(h=e;h<e+i;h++){const e=t[h];let i=d,f=d+this._computeAngle(h,n,p),m=o.getDataVisibility(h)?a.getDistanceFromCenterForValue(this.getParsed(h).r):0;d=f,r&&(s.animateScale&&(m=0),s.animateRotate&&(i=f=u));const g={x:l,y:c,innerRadius:0,outerRadius:m,startAngle:i,endAngle:f,options:this.resolveDataElementOptions(h,e.active?"active":n)};this.updateElement(e,h,g,n)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach(((t,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&e++})),e}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?Nb(this.resolveDataElementOptions(t,e).angle||i):0}}var dS=Object.freeze({__proto__:null,BarController:class extends eS{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(t,e,i,n){return rS(t,e,i,n)}parseArrayData(t,e,i,n){return rS(t,e,i,n)}parseObjectData(t,e,i,n){const{iScale:r,vScale:o}=t,{xAxisKey:s="x",yAxisKey:a="y"}=this._parsing,l="x"===r.axis?s:a,c="x"===o.axis?s:a,u=[];let h,d,p,f;for(h=i,d=i+n;h<d;++h)f=e[h],p={},p[r.axis]=r.parse(gb(f,l),h),u.push(nS(gb(f,c),p,o,h));return u}updateRangeFromParsed(t,e,i,n){super.updateRangeFromParsed(t,e,i,n);const r=i._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:n}=e,r=this.getParsed(t),o=r._custom,s=oS(o)?"["+o.start+", "+o.end+"]":""+n.getLabelForValue(r[n.axis]);return{label:""+i.getLabelForValue(r[i.axis]),value:s}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,i,n){const r="reset"===n,{index:o,_cachedMeta:{vScale:s}}=this,a=s.getBasePixel(),l=s.isHorizontal(),c=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(e,n);for(let d=e;d<e+i;d++){const e=this.getParsed(d),i=r||Qx(e[s.axis])?{base:a,head:a}:this._calculateBarValuePixels(d),p=this._calculateBarIndexPixels(d,c),f=(e._stacks||{})[s.axis],m={horizontal:l,base:i.base,enableBorderRadius:!f||oS(e._custom)||o===f._top||o===f._bottom,x:l?i.head:p.center,y:l?p.center:i.head,height:l?p.size:Math.abs(i.size),width:l?Math.abs(i.size):p.size};h&&(m.options=u||this.resolveDataElementOptions(d,t[d].active?"active":n));const g=m.options||t[d].options;sS(m,g,f,o),cS(m,g,c.ratio),this.updateElement(t[d],d,m,n)}}_getStacks(t,e){const{iScale:i}=this._cachedMeta,n=i.getMatchingVisibleMetas(this._type).filter((t=>t.controller.options.grouped)),r=i.options.stacked,o=[],s=t=>{const i=t.controller.getParsed(e),n=i&&i[t.vScale.axis];if(Qx(n)||isNaN(n))return!0};for(const i of n)if((void 0===e||!s(i))&&((!1===r||-1===o.indexOf(i.stack)||void 0===r&&void 0===i.stack)&&o.push(i.stack),i.index===t))break;return o.length||o.push(void 0),o}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,e,i){const n=this._getStacks(t,i),r=void 0!==e?n.indexOf(e):-1;return-1===r?n.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,n=[];let r,o;for(r=0,o=e.data.length;r<o;++r)n.push(i.getPixelForValue(this.getParsed(r)[i.axis],r));const s=t.barThickness;return{min:s||iS(e),pixels:n,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:s?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:i,index:n},options:{base:r,minBarLength:o}}=this,s=r||0,a=this.getParsed(t),l=a._custom,c=oS(l);let u,h,d=a[e.axis],p=0,f=i?this.applyStack(e,a,i):d;f!==d&&(p=f-d,f=d),c&&(d=l.barStart,f=l.barEnd-l.barStart,0!==d&&Pb(d)!==Pb(l.barEnd)&&(p=0),p+=d);const m=Qx(r)||c?p:r;let g=e.getPixelForValue(m);if(u=this.chart.getDataVisibility(t)?e.getPixelForValue(p+f):g,h=u-g,Math.abs(h)<o){h=function(t,e,i){return 0!==t?Pb(t):(e.isHorizontal()?1:-1)*(e.min>=i?1:-1)}(h,e,s)*o,d===s&&(g-=h/2);const t=e.getPixelForDecimal(0),r=e.getPixelForDecimal(1),l=Math.min(t,r),p=Math.max(t,r);g=Math.max(Math.min(g,p),l),u=g+h,i&&!c&&(a._stacks[e.axis]._visualValues[n]=e.getValueForPixel(u)-e.getValueForPixel(g))}if(g===e.getPixelForValue(s)){const t=Pb(h)*e.getLineWidthForValue(s)/2;g+=t,h-=t}return{size:h,base:g,head:u,center:u+h/2}}_calculateBarIndexPixels(t,e){const i=e.scale,n=this.options,r=n.skipNull,o=rb(n.maxBarThickness,1/0);let s,a;if(e.grouped){const i=r?this._getStackCount(t):e.stackCount,l="flex"===n.barThickness?function(t,e,i,n){const r=e.pixels,o=r[t];let s=t>0?r[t-1]:null,a=t<r.length-1?r[t+1]:null;const l=i.categoryPercentage;null===s&&(s=o-(null===a?e.end-e.start:a-o)),null===a&&(a=o+o-s);const c=o-(o-Math.min(s,a))/2*l;return{chunk:Math.abs(a-s)/2*l/n,ratio:i.barPercentage,start:c}}(t,e,n,i):function(t,e,i,n){const r=i.barThickness;let o,s;return Qx(r)?(o=e.min*i.categoryPercentage,s=i.barPercentage):(o=r*n,s=1),{chunk:o/n,ratio:s,start:e.pixels[t]-o/2}}(t,e,n,i),c=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0);s=l.start+l.chunk*c+l.chunk/2,a=Math.min(o,l.chunk*l.ratio)}else s=i.getPixelForValue(this.getParsed(t)[i.axis],t),a=Math.min(o,e.min*e.ratio);return{base:s-a/2,head:s+a/2,center:s,size:a}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,n=i.length;let r=0;for(;r<n;++r)null!==this.getParsed(r)[e.axis]&&i[r].draw(this._ctx)}},BubbleController:class extends eS{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,n){const r=super.parsePrimitiveData(t,e,i,n);for(let t=0;t<r.length;t++)r[t]._custom=this.resolveDataElementOptions(t+i).radius;return r}parseArrayData(t,e,i,n){const r=super.parseArrayData(t,e,i,n);for(let t=0;t<r.length;t++){const n=e[i+t];r[t]._custom=rb(n[2],this.resolveDataElementOptions(t+i).radius)}return r}parseObjectData(t,e,i,n){const r=super.parseObjectData(t,e,i,n);for(let t=0;t<r.length;t++){const n=e[i+t];r[t]._custom=rb(n&&n.r&&+n.r,this.resolveDataElementOptions(t+i).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:r}=e,o=this.getParsed(t),s=n.getLabelForValue(o.x),a=r.getLabelForValue(o.y),l=o._custom;return{label:i[t]||"",value:"("+s+", "+a+(l?", "+l:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,n){const r="reset"===n,{iScale:o,vScale:s}=this._cachedMeta,{sharedOptions:a,includeOptions:l}=this._getSharedOptions(e,n),c=o.axis,u=s.axis;for(let h=e;h<e+i;h++){const e=t[h],i=!r&&this.getParsed(h),d={},p=d[c]=r?o.getPixelForDecimal(.5):o.getPixelForValue(i[c]),f=d[u]=r?s.getBasePixel():s.getPixelForValue(i[u]);d.skip=isNaN(p)||isNaN(f),l&&(d.options=a||this.resolveDataElementOptions(h,e.active?"active":n),r&&(d.options.radius=0)),this.updateElement(e,h,d,n)}}resolveDataElementOptions(t,e){const i=this.getParsed(t);let n=super.resolveDataElementOptions(t,e);n.$shared&&(n=Object.assign({},n,{$shared:!1}));const r=n.radius;return"active"!==e&&(n.radius=0),n.radius+=rb(i&&i._custom,r),n}},DoughnutController:uS,LineController:class extends eS{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:n=[],_dataset:r}=e,o=this.chart._animationsDisabled;let{start:s,count:a}=ew(e,n,o);this._drawStart=s,this._drawCount=a,iw(e)&&(s=0,a=n.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!r._decimated,i.points=n;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(i,void 0,{animated:!o,options:l},t),this.updateElements(n,s,a,t)}updateElements(t,e,i,n){const r="reset"===n,{iScale:o,vScale:s,_stacked:a,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:u}=this._getSharedOptions(e,n),h=o.axis,d=s.axis,{spanGaps:p,segment:f}=this.options,m=Db(p)?p:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||r||"none"===n,_=e+i,y=t.length;let v=e>0&&this.getParsed(e-1);for(let i=0;i<y;++i){const p=t[i],y=g?p:{};if(i<e||i>=_){y.skip=!0;continue}const x=this.getParsed(i),b=Qx(x[d]),w=y[h]=o.getPixelForValue(x[h],i),E=y[d]=r||b?s.getBasePixel():s.getPixelForValue(a?this.applyStack(s,x,a):x[d],i);y.skip=isNaN(w)||isNaN(E)||b,y.stop=i>0&&Math.abs(x[h]-v[h])>m,f&&(y.parsed=x,y.raw=l.data[i]),u&&(y.options=c||this.resolveDataElementOptions(i,p.active?"active":n)),g||this.updateElement(p,i,y,n),v=x}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,n=t.data||[];if(!n.length)return i;const r=n[0].size(this.resolveDataElementOptions(0)),o=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(i,r,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}},PieController:class extends uS{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}},PolarAreaController:hS,RadarController:class extends eS{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}parseObjectData(t,e,i,n){return aE.bind(this)(t,e,i,n)}update(t){const e=this._cachedMeta,i=e.dataset,n=e.data||[],r=e.iScale.getLabels();if(i.points=n,"resize"!==t){const e=this.resolveDatasetElementOptions(t);this.options.showLine||(e.borderWidth=0);const o={_loop:!0,_fullLoop:r.length===n.length,options:e};this.updateElement(i,void 0,o,t)}this.updateElements(n,0,n.length,t)}updateElements(t,e,i,n){const r=this._cachedMeta.rScale,o="reset"===n;for(let s=e;s<e+i;s++){const e=t[s],i=this.resolveDataElementOptions(s,e.active?"active":n),a=r.getPointPositionForValue(s,this.getParsed(s).r),l=o?r.xCenter:a.x,c=o?r.yCenter:a.y,u={x:l,y:c,angle:a.angle,skip:isNaN(l)||isNaN(c),options:i};this.updateElement(e,s,u,n)}}},ScatterController:class extends eS{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:r}=e,o=this.getParsed(t),s=n.getLabelForValue(o.x),a=r.getLabelForValue(o.y);return{label:i[t]||"",value:"("+s+", "+a+")"}}update(t){const e=this._cachedMeta,{data:i=[]}=e,n=this.chart._animationsDisabled;let{start:r,count:o}=ew(e,i,n);if(this._drawStart=r,this._drawCount=o,iw(e)&&(r=0,o=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:r,_dataset:o}=e;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!o._decimated,r.points=i;const s=this.resolveDatasetElementOptions(t);s.segment=this.options.segment,this.updateElement(r,void 0,{animated:!n,options:s},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(i,r,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,i,n){const r="reset"===n,{iScale:o,vScale:s,_stacked:a,_dataset:l}=this._cachedMeta,c=this.resolveDataElementOptions(e,n),u=this.getSharedOptions(c),h=this.includeOptions(n,u),d=o.axis,p=s.axis,{spanGaps:f,segment:m}=this.options,g=Db(f)?f:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||r||"none"===n;let y=e>0&&this.getParsed(e-1);for(let c=e;c<e+i;++c){const e=t[c],i=this.getParsed(c),f=_?e:{},v=Qx(i[p]),x=f[d]=o.getPixelForValue(i[d],c),b=f[p]=r||v?s.getBasePixel():s.getPixelForValue(a?this.applyStack(s,i,a):i[p],c);f.skip=isNaN(x)||isNaN(b)||v,f.stop=c>0&&Math.abs(i[d]-y[d])>g,m&&(f.parsed=i,f.raw=l.data[c]),h&&(f.options=u||this.resolveDataElementOptions(c,e.active?"active":n)),_||this.updateElement(e,c,f,n),y=i}this.updateSharedOptions(u,n,c)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let t=0;for(let i=e.length-1;i>=0;--i)t=Math.max(t,e[i].size(this.resolveDataElementOptions(i))/2);return t>0&&t}const i=t.dataset,n=i.options&&i.options.borderWidth||0;if(!e.length)return n;const r=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(n,r,o)/2}}});function pS(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class fS{static override(t){Object.assign(fS.prototype,t)}options;constructor(t){this.options=t||{}}init(){}formats(){return pS()}parse(){return pS()}format(){return pS()}add(){return pS()}diff(){return pS()}startOf(){return pS()}endOf(){return pS()}}var mS=fS;function gS(t,e,i,n){const{controller:r,data:o,_sorted:s}=t,a=r._cachedMeta.iScale;if(a&&e===a.axis&&"r"!==e&&s&&o.length){const t=a._reversePixels?Xb:qb;if(!n)return t(o,e,i);if(r._sharedOptions){const n=o[0],r="function"==typeof n.getRange&&n.getRange(e);if(r){const n=t(o,e,i-r),s=t(o,e,i+r);return{lo:n.lo,hi:s.hi}}}}return{lo:0,hi:o.length-1}}function _S(t,e,i,n,r){const o=t.getSortedVisibleDatasetMetas(),s=i[e];for(let t=0,i=o.length;t<i;++t){const{index:i,data:a}=o[t],{lo:l,hi:c}=gS(o[t],e,s,r);for(let t=l;t<=c;++t){const e=a[t];e.skip||n(e,i,t)}}}function yS(t,e,i,n,r){const o=[];return r||t.isPointInArea(e)?(_S(t,i,e,(function(i,s,a){(r||Cw(i,t.chartArea,0))&&i.inRange(e.x,e.y,n)&&o.push({element:i,datasetIndex:s,index:a})}),!0),o):o}function vS(t,e,i,n,r,o){return o||t.isPointInArea(e)?"r"!==i||n?function(t,e,i,n,r,o){let s=[];const a=function(t){const e=-1!==t.indexOf("x"),i=-1!==t.indexOf("y");return function(t,n){const r=e?Math.abs(t.x-n.x):0,o=i?Math.abs(t.y-n.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}}(i);let l=Number.POSITIVE_INFINITY;return _S(t,i,e,(function(i,c,u){const h=i.inRange(e.x,e.y,r);if(n&&!h)return;const d=i.getCenterPoint(r);if(!o&&!t.isPointInArea(d)&&!h)return;const p=a(e,d);p<l?(s=[{element:i,datasetIndex:c,index:u}],l=p):p===l&&s.push({element:i,datasetIndex:c,index:u})})),s}(t,e,i,n,r,o):function(t,e,i,n){let r=[];return _S(t,i,e,(function(t,i,o){const{startAngle:s,endAngle:a}=t.getProps(["startAngle","endAngle"],n),{angle:l}=zb(t,{x:e.x,y:e.y});jb(l,s,a)&&r.push({element:t,datasetIndex:i,index:o})})),r}(t,e,i,r):[]}function xS(t,e,i,n,r){const o=[],s="x"===i?"inXRange":"inYRange";let a=!1;return _S(t,i,e,((t,n,l)=>{t[s](e[i],r)&&(o.push({element:t,datasetIndex:n,index:l}),a=a||t.inRange(e.x,e.y,r))})),n&&!a?[]:o}var bS={evaluateInteractionItems:_S,modes:{index(t,e,i,n){const r=bE(e,t),o=i.axis||"x",s=i.includeInvisible||!1,a=i.intersect?yS(t,r,o,n,s):vS(t,r,o,!1,n,s),l=[];return a.length?(t.getSortedVisibleDatasetMetas().forEach((t=>{const e=a[0].index,i=t.data[e];i&&!i.skip&&l.push({element:i,datasetIndex:t.index,index:e})})),l):[]},dataset(t,e,i,n){const r=bE(e,t),o=i.axis||"xy",s=i.includeInvisible||!1;let a=i.intersect?yS(t,r,o,n,s):vS(t,r,o,!1,n,s);if(a.length>0){const e=a[0].datasetIndex,i=t.getDatasetMeta(e).data;a=[];for(let t=0;t<i.length;++t)a.push({element:i[t],datasetIndex:e,index:t})}return a},point:(t,e,i,n)=>yS(t,bE(e,t),i.axis||"xy",n,i.includeInvisible||!1),nearest(t,e,i,n){const r=bE(e,t),o=i.axis||"xy",s=i.includeInvisible||!1;return vS(t,r,o,i.intersect,n,s)},x:(t,e,i,n)=>xS(t,bE(e,t),"x",i.intersect,n),y:(t,e,i,n)=>xS(t,bE(e,t),"y",i.intersect,n)}};const wS=["left","top","right","bottom"];function ES(t,e){return t.filter((t=>t.pos===e))}function SS(t,e){return t.filter((t=>-1===wS.indexOf(t.pos)&&t.box.axis===e))}function TS(t,e){return t.sort(((t,i)=>{const n=e?i:t,r=e?t:i;return n.weight===r.weight?n.index-r.index:n.weight-r.weight}))}function MS(t,e,i,n){return Math.max(t[i],e[i])+Math.max(t[n],e[n])}function IS(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function CS(t,e,i,n){const{pos:r,box:o}=i,s=t.maxPadding;if(!eb(r)){i.size&&(t[r]-=i.size);const e=n[i.stack]||{size:0,count:1};e.size=Math.max(e.size,i.horizontal?o.height:o.width),i.size=e.size/e.count,t[r]+=i.size}o.getPadding&&IS(s,o.getPadding());const a=Math.max(0,e.outerWidth-MS(s,t,"left","right")),l=Math.max(0,e.outerHeight-MS(s,t,"top","bottom")),c=a!==t.w,u=l!==t.h;return t.w=a,t.h=l,i.horizontal?{same:c,other:u}:{same:u,other:c}}function AS(t,e){const i=e.maxPadding;return function(t){const n={left:0,top:0,right:0,bottom:0};return t.forEach((t=>{n[t]=Math.max(e[t],i[t])})),n}(t?["left","right"]:["top","bottom"])}function PS(t,e,i,n){const r=[];let o,s,a,l,c,u;for(o=0,s=t.length,c=0;o<s;++o){a=t[o],l=a.box,l.update(a.width||e.w,a.height||e.h,AS(a.horizontal,e));const{same:s,other:h}=CS(e,i,a,n);c|=s&&r.length,u=u||h,l.fullSize||r.push(a)}return c&&PS(r,e,i,n)||u}function LS(t,e,i,n,r){t.top=i,t.left=e,t.right=e+n,t.bottom=i+r,t.width=n,t.height=r}function RS(t,e,i,n){const r=i.padding;let{x:o,y:s}=e;for(const a of t){const t=a.box,l=n[a.stack]||{count:1,placed:0,weight:1},c=a.stackWeight/l.weight||1;if(a.horizontal){const n=e.w*c,o=l.size||t.height;yb(l.start)&&(s=l.start),t.fullSize?LS(t,r.left,s,i.outerWidth-r.right-r.left,o):LS(t,e.left+l.placed,s,n,o),l.start=s,l.placed+=n,s=t.bottom}else{const n=e.h*c,s=l.size||t.width;yb(l.start)&&(o=l.start),t.fullSize?LS(t,o,r.top,s,i.outerHeight-r.bottom-r.top):LS(t,o,e.top+l.placed,s,n),l.start=o,l.placed+=n,o=t.right}}e.x=o,e.y=s}var DS={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},t.boxes.push(e)},removeBox(t,e){const i=t.boxes?t.boxes.indexOf(e):-1;-1!==i&&t.boxes.splice(i,1)},configure(t,e,i){e.fullSize=i.fullSize,e.position=i.position,e.weight=i.weight},update(t,e,i,n){if(!t)return;const r=Hw(t.options.layout.padding),o=Math.max(e-r.width,0),s=Math.max(i-r.height,0),a=function(t){const e=function(t){const e=[];let i,n,r,o,s,a;for(i=0,n=(t||[]).length;i<n;++i)r=t[i],({position:o,options:{stack:s,stackWeight:a=1}}=r),e.push({index:i,box:r,pos:o,horizontal:r.isHorizontal(),weight:r.weight,stack:s&&o+s,stackWeight:a});return e}(t),i=TS(e.filter((t=>t.box.fullSize)),!0),n=TS(ES(e,"left"),!0),r=TS(ES(e,"right")),o=TS(ES(e,"top"),!0),s=TS(ES(e,"bottom")),a=SS(e,"x"),l=SS(e,"y");return{fullSize:i,leftAndTop:n.concat(o),rightAndBottom:r.concat(l).concat(s).concat(a),chartArea:ES(e,"chartArea"),vertical:n.concat(r).concat(l),horizontal:o.concat(s).concat(a)}}(t.boxes),l=a.vertical,c=a.horizontal;ab(t.boxes,(t=>{"function"==typeof t.beforeLayout&&t.beforeLayout()}));const u=l.reduce(((t,e)=>e.box.options&&!1===e.box.options.display?t:t+1),0)||1,h=Object.freeze({outerWidth:e,outerHeight:i,padding:r,availableWidth:o,availableHeight:s,vBoxMaxWidth:o/2/u,hBoxMaxHeight:s/2}),d=Object.assign({},r);IS(d,Hw(n));const p=Object.assign({maxPadding:d,w:o,h:s,x:r.left,y:r.top},r),f=function(t,e){const i=function(t){const e={};for(const i of t){const{stack:t,pos:n,stackWeight:r}=i;if(!t||!wS.includes(n))continue;const o=e[t]||(e[t]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=r}return e}(t),{vBoxMaxWidth:n,hBoxMaxHeight:r}=e;let o,s,a;for(o=0,s=t.length;o<s;++o){a=t[o];const{fullSize:s}=a.box,l=i[a.stack],c=l&&a.stackWeight/l.weight;a.horizontal?(a.width=c?c*n:s&&e.availableWidth,a.height=r):(a.width=n,a.height=c?c*r:s&&e.availableHeight)}return i}(l.concat(c),h);PS(a.fullSize,p,h,f),PS(l,p,h,f),PS(c,p,h,f)&&PS(l,p,h,f),function(t){const e=t.maxPadding;function i(i){const n=Math.max(e[i]-t[i],0);return t[i]+=n,n}t.y+=i("top"),t.x+=i("left"),i("right"),i("bottom")}(p),RS(a.leftAndTop,p,h,f),p.x+=p.w,p.y+=p.h,RS(a.rightAndBottom,p,h,f),t.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},ab(a.chartArea,(e=>{const i=e.box;Object.assign(i,t.chartArea),i.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})}))}};class kS{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,n){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,n?Math.floor(e/n):i)}}isAttached(t){return!0}updateConfig(t){}}class NS extends kS{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const OS="$chartjs",FS={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},zS=t=>null===t||""===t,BS=!!SE&&{passive:!0};function US(t,e,i){t&&t.canvas&&t.canvas.removeEventListener(e,i,BS)}function VS(t,e){for(const i of t)if(i===e||i.contains(e))return!0}function jS(t,e,i){const n=t.canvas,r=new MutationObserver((t=>{let e=!1;for(const i of t)e=e||VS(i.addedNodes,n),e=e&&!VS(i.removedNodes,n);e&&i()}));return r.observe(document,{childList:!0,subtree:!0}),r}function GS(t,e,i){const n=t.canvas,r=new MutationObserver((t=>{let e=!1;for(const i of t)e=e||VS(i.removedNodes,n),e=e&&!VS(i.addedNodes,n);e&&i()}));return r.observe(document,{childList:!0,subtree:!0}),r}const HS=new Map;let WS=0;function qS(){const t=window.devicePixelRatio;t!==WS&&(WS=t,HS.forEach(((e,i)=>{i.currentDevicePixelRatio!==t&&e()})))}function XS(t,e,i){const n=t.canvas,r=n&&mE(n);if(!r)return;const o=Jb(((t,e)=>{const n=r.clientWidth;i(t,e),n<r.clientWidth&&i()}),window),s=new ResizeObserver((t=>{const e=t[0],i=e.contentRect.width,n=e.contentRect.height;0===i&&0===n||o(i,n)}));return s.observe(r),function(t,e){HS.size||window.addEventListener("resize",qS),HS.set(t,e)}(t,o),s}function $S(t,e,i){i&&i.disconnect(),"resize"===e&&function(t){HS.delete(t),HS.size||window.removeEventListener("resize",qS)}(t)}function YS(t,e,i){const n=t.canvas,r=Jb((e=>{null!==t.ctx&&i(function(t,e){const i=FS[t.type]||t.type,{x:n,y:r}=bE(t,e);return{type:i,chart:e,native:t,x:void 0!==n?n:null,y:void 0!==r?r:null}}(e,t))}),t);return function(t,e,i){t&&t.addEventListener(e,i,BS)}(n,e,r),r}class ZS extends kS{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(function(t,e){const i=t.style,n=t.getAttribute("height"),r=t.getAttribute("width");if(t[OS]={initial:{height:n,width:r,style:{display:i.display,height:i.height,width:i.width}}},i.display=i.display||"block",i.boxSizing=i.boxSizing||"border-box",zS(r)){const e=TE(t,"width");void 0!==e&&(t.width=e)}if(zS(n))if(""===t.style.height)t.height=t.width/(e||2);else{const e=TE(t,"height");void 0!==e&&(t.height=e)}}(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e[OS])return!1;const i=e[OS].initial;["height","width"].forEach((t=>{const n=i[t];Qx(n)?e.removeAttribute(t):e.setAttribute(t,n)}));const n=i.style||{};return Object.keys(n).forEach((t=>{e.style[t]=n[t]})),e.width=e.width,delete e[OS],!0}addEventListener(t,e,i){this.removeEventListener(t,e);const n=t.$proxies||(t.$proxies={}),r={attach:jS,detach:GS,resize:XS}[e]||YS;n[e]=r(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),n=i[e];n&&(({attach:$S,detach:$S,resize:$S}[e]||US)(t,e,n),i[e]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,n){return function(t,e,i,n){const r=_E(t),o=vE(r,"margin"),s=gE(r.maxWidth,t,"clientWidth")||Sb,a=gE(r.maxHeight,t,"clientHeight")||Sb,l=function(t,e,i){let n,r;if(void 0===e||void 0===i){const o=mE(t);if(o){const t=o.getBoundingClientRect(),s=_E(o),a=vE(s,"border","width"),l=vE(s,"padding");e=t.width-l.width-a.width,i=t.height-l.height-a.height,n=gE(s.maxWidth,o,"clientWidth"),r=gE(s.maxHeight,o,"clientHeight")}else e=t.clientWidth,i=t.clientHeight}return{width:e,height:i,maxWidth:n||Sb,maxHeight:r||Sb}}(t,e,i);let{width:c,height:u}=l;if("content-box"===r.boxSizing){const t=vE(r,"border","width"),e=vE(r,"padding");c-=e.width+t.width,u-=e.height+t.height}return c=Math.max(0,c-o.width),u=Math.max(0,n?c/n:u-o.height),c=wE(Math.min(c,s,l.maxWidth)),u=wE(Math.min(u,a,l.maxHeight)),c&&!u&&(u=wE(c/2)),(void 0!==e||void 0!==i)&&n&&l.height&&u>l.height&&(u=l.height,c=wE(Math.floor(u*n))),{width:c,height:u}}(t,e,i,n)}isAttached(t){const e=mE(t);return!(!e||!e.isConnected)}}class KS{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return Db(this.x)&&Db(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const n={};return t.forEach((t=>{n[t]=i[t]&&i[t].active()?i[t]._to:this[t]})),n}}function JS(t,e,i,n,r){const o=rb(n,0),s=Math.min(rb(r,t.length),t.length);let a,l,c,u=0;for(i=Math.ceil(i),r&&(a=r-n,i=a/Math.floor(a/i)),c=o;c<0;)u++,c=Math.round(o+u*i);for(l=Math.max(o,0);l<s;l++)l===c&&(e.push(t[l]),u++,c=Math.round(o+u*i))}const QS=(t,e,i)=>"top"===e||"left"===e?t[e]+i:t[e]-i,tT=(t,e)=>Math.min(e||t,t);function eT(t,e){const i=[],n=t.length/e,r=t.length;let o=0;for(;o<r;o+=n)i.push(t[Math.floor(o)]);return i}function iT(t,e,i){const n=t.ticks.length,r=Math.min(e,n-1),o=t._startPixel,s=t._endPixel,a=1e-6;let l,c=t.getPixelForTick(r);if(!(i&&(l=1===n?Math.max(c-o,s-c):0===e?(t.getPixelForTick(1)-c)/2:(c-t.getPixelForTick(r-1))/2,c+=r<e?l:-l,c<o-a||c>s+a)))return c}function nT(t){return t.drawTicks?t.tickLength:0}function rT(t,e){if(!t.display)return 0;const i=Ww(t.font,e),n=Hw(t.padding);return(tb(t.text)?t.text.length:1)*i.lineHeight+n.height}function oT(t,e,i){let n=Qb(t);return(i&&"right"!==e||!i&&"right"===e)&&(n=(t=>"left"===t?"right":"right"===t?"left":t)(n)),n}class sT extends KS{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:n}=this;return t=nb(t,Number.POSITIVE_INFINITY),e=nb(e,Number.NEGATIVE_INFINITY),i=nb(i,Number.POSITIVE_INFINITY),n=nb(n,Number.NEGATIVE_INFINITY),{min:nb(t,i),max:nb(e,n),minDefined:ib(t),maxDefined:ib(e)}}getMinMax(t){let e,{min:i,max:n,minDefined:r,maxDefined:o}=this.getUserBounds();if(r&&o)return{min:i,max:n};const s=this.getMatchingVisibleMetas();for(let a=0,l=s.length;a<l;++a)e=s[a].controller.getMinMax(this,t),r||(i=Math.min(i,e.min)),o||(n=Math.max(n,e.max));return i=o&&i>n?n:i,n=r&&i>n?i:n,{min:nb(i,nb(n,i)),max:nb(n,nb(i,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){sb(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:n,grace:r,ticks:o}=this.options,s=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(t,e,i){const{min:n,max:r}=t,o=ob(e,(r-n)/2),s=(t,e)=>i&&0===t?0:t+e;return{min:s(n,-Math.abs(o)),max:s(r,o)}}(this,r,n),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const a=s<this.ticks.length;this._convertTicksToLabels(a?eT(this.ticks,s):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||"auto"===o.source)&&(this.ticks=function(t,e){const i=t.options.ticks,n=function(t){const e=t.options.offset,i=t._tickSize(),n=t._length/i+(e?0:1),r=t._maxLength/i;return Math.floor(Math.min(n,r))}(t),r=Math.min(i.maxTicksLimit||n,n),o=i.major.enabled?function(t){const e=[];let i,n;for(i=0,n=t.length;i<n;i++)t[i].major&&e.push(i);return e}(e):[],s=o.length,a=o[0],l=o[s-1],c=[];if(s>r)return function(t,e,i,n){let r,o=0,s=i[0];for(n=Math.ceil(n),r=0;r<t.length;r++)r===s&&(e.push(t[r]),o++,s=i[o*n])}(e,c,o,s/r),c;const u=function(t,e,i){const n=function(t){const e=t.length;let i,n;if(e<2)return!1;for(n=t[0],i=1;i<e;++i)if(t[i]-t[i-1]!==n)return!1;return n}(t),r=e.length/i;if(!n)return Math.max(r,1);const o=function(t){const e=[],i=Math.sqrt(t);let n;for(n=1;n<i;n++)t%n==0&&(e.push(n),e.push(t/n));return i===(0|i)&&e.push(i),e.sort(((t,e)=>t-e)).pop(),e}(n);for(let t=0,e=o.length-1;t<e;t++){const e=o[t];if(e>r)return e}return Math.max(r,1)}(o,e,r);if(s>0){let t,i;const n=s>1?Math.round((l-a)/(s-1)):null;for(JS(e,c,u,Qx(n)?0:a-n,a),t=0,i=s-1;t<i;t++)JS(e,c,u,o[t],o[t+1]);return JS(e,c,u,l,Qx(n)?e.length:l+n),c}return JS(e,c,u),c}(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),a&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t,e,i=this.options.reverse;this.isHorizontal()?(t=this.left,e=this.right):(t=this.top,e=this.bottom,i=!i),this._startPixel=t,this._endPixel=e,this._reversePixels=i,this._length=e-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){sb(this.options.afterUpdate,[this])}beforeSetDimensions(){sb(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){sb(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),sb(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){sb(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,n,r;for(i=0,n=t.length;i<n;i++)r=t[i],r.label=sb(e.callback,[r.value,i,t],this)}afterTickToLabelConversion(){sb(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){sb(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=tT(this.ticks.length,t.ticks.maxTicksLimit),n=e.minRotation||0,r=e.maxRotation;let o,s,a,l=n;if(!this._isVisible()||!e.display||n>=r||i<=1||!this.isHorizontal())return void(this.labelRotation=n);const c=this._getLabelSizes(),u=c.widest.width,h=c.highest.height,d=Gb(this.chart.width-u,0,this.maxWidth);o=t.offset?this.maxWidth/i:d/(i-1),u+6>o&&(o=d/(i-(t.offset?.5:1)),s=this.maxHeight-nT(t.grid)-e.padding-rT(t.title,this.chart.options.font),a=Math.sqrt(u*u+h*h),l=Ob(Math.min(Math.asin(Gb((c.highest.height+6)/o,-1,1)),Math.asin(Gb(s/a,-1,1))-Math.asin(Gb(h/a,-1,1)))),l=Math.max(n,Math.min(r,l))),this.labelRotation=l}afterCalculateLabelRotation(){sb(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){sb(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:n,grid:r}}=this,o=this._isVisible(),s=this.isHorizontal();if(o){const o=rT(n,e.options.font);if(s?(t.width=this.maxWidth,t.height=nT(r)+o):(t.height=this.maxHeight,t.width=nT(r)+o),i.display&&this.ticks.length){const{first:e,last:n,widest:r,highest:o}=this._getLabelSizes(),a=2*i.padding,l=Nb(this.labelRotation),c=Math.cos(l),u=Math.sin(l);if(s){const e=i.mirror?0:u*r.width+c*o.height;t.height=Math.min(this.maxHeight,t.height+e+a)}else{const e=i.mirror?0:c*r.width+u*o.height;t.width=Math.min(this.maxWidth,t.width+e+a)}this._calculatePadding(e,n,u,c)}}this._handleMargins(),s?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,n){const{ticks:{align:r,padding:o},position:s}=this.options,a=0!==this.labelRotation,l="top"!==s&&"x"===this.axis;if(this.isHorizontal()){const s=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,h=0;a?l?(u=n*t.width,h=i*e.height):(u=i*t.height,h=n*e.width):"start"===r?h=e.width:"end"===r?u=t.width:"inner"!==r&&(u=t.width/2,h=e.width/2),this.paddingLeft=Math.max((u-s+o)*this.width/(this.width-s),0),this.paddingRight=Math.max((h-c+o)*this.width/(this.width-c),0)}else{let i=e.height/2,n=t.height/2;"start"===r?(i=0,n=t.height):"end"===r&&(i=e.height,n=0),this.paddingTop=i+o,this.paddingBottom=n+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){sb(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return"top"===e||"bottom"===e||"x"===t}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){let e,i;for(this.beforeTickToLabelConversion(),this.generateTickLabels(t),e=0,i=t.length;e<i;e++)Qx(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=eT(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,i){const{ctx:n,_longestTextCache:r}=this,o=[],s=[],a=Math.floor(e/tT(e,i));let l,c,u,h,d,p,f,m,g,_,y,v=0,x=0;for(l=0;l<e;l+=a){if(h=t[l].label,d=this._resolveTickFontOptions(l),n.font=p=d.string,f=r[p]=r[p]||{data:{},gc:[]},m=d.lineHeight,g=_=0,Qx(h)||tb(h)){if(tb(h))for(c=0,u=h.length;c<u;++c)y=h[c],Qx(y)||tb(y)||(g=ww(n,f.data,f.gc,g,y),_+=m)}else g=ww(n,f.data,f.gc,g,h),_=m;o.push(g),s.push(_),v=Math.max(g,v),x=Math.max(_,x)}!function(t,e){ab(t,(t=>{const i=t.gc,n=i.length/2;let r;if(n>e){for(r=0;r<n;++r)delete t.data[i[r]];i.splice(0,n)}}))}(r,e);const b=o.indexOf(v),w=s.indexOf(x),E=t=>({width:o[t]||0,height:s[t]||0});return{first:E(0),last:E(e-1),widest:E(b),highest:E(w),widths:o,heights:s}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Gb(this._alignToPixels?Sw(this.chart,e,0):e,-32768,32767)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=function(t,e,i){return Xw(t,{tick:i,index:e,type:"tick"})}(this.getContext(),t,i))}return this.$context||(this.$context=function(t,e){return Xw(t,{scale:e,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=Nb(this.labelRotation),i=Math.abs(Math.cos(e)),n=Math.abs(Math.sin(e)),r=this._getLabelSizes(),o=t.autoSkipPadding||0,s=r?r.widest.width+o:0,a=r?r.highest.height+o:0;return this.isHorizontal()?a*i>s*n?s/i:a/n:a*n<s*i?a/i:s/n}_isVisible(){const t=this.options.display;return"auto"!==t?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,n=this.options,{grid:r,position:o,border:s}=n,a=r.offset,l=this.isHorizontal(),c=this.ticks.length+(a?1:0),u=nT(r),h=[],d=s.setContext(this.getContext()),p=d.display?d.width:0,f=p/2,m=function(t){return Sw(i,t,p)};let g,_,y,v,x,b,w,E,S,T,M,I;if("top"===o)g=m(this.bottom),b=this.bottom-u,E=g-f,T=m(t.top)+f,I=t.bottom;else if("bottom"===o)g=m(this.top),T=t.top,I=m(t.bottom)-f,b=g+f,E=this.top+u;else if("left"===o)g=m(this.right),x=this.right-u,w=g-f,S=m(t.left)+f,M=t.right;else if("right"===o)g=m(this.left),S=t.left,M=m(t.right)-f,x=g+f,w=this.left+u;else if("x"===e){if("center"===o)g=m((t.top+t.bottom)/2+.5);else if(eb(o)){const t=Object.keys(o)[0],e=o[t];g=m(this.chart.scales[t].getPixelForValue(e))}T=t.top,I=t.bottom,b=g+f,E=b+u}else if("y"===e){if("center"===o)g=m((t.left+t.right)/2);else if(eb(o)){const t=Object.keys(o)[0],e=o[t];g=m(this.chart.scales[t].getPixelForValue(e))}x=g-f,w=x-u,S=t.left,M=t.right}const C=rb(n.ticks.maxTicksLimit,c),A=Math.max(1,Math.ceil(c/C));for(_=0;_<c;_+=A){const t=this.getContext(_),e=r.setContext(t),n=s.setContext(t),o=e.lineWidth,c=e.color,u=n.dash||[],d=n.dashOffset,p=e.tickWidth,f=e.tickColor,m=e.tickBorderDash||[],g=e.tickBorderDashOffset;y=iT(this,_,a),void 0!==y&&(v=Sw(i,y,o),l?x=w=S=M=v:b=E=T=I=v,h.push({tx1:x,ty1:b,tx2:w,ty2:E,x1:S,y1:T,x2:M,y2:I,width:o,color:c,borderDash:u,borderDashOffset:d,tickWidth:p,tickColor:f,tickBorderDash:m,tickBorderDashOffset:g}))}return this._ticksLength=c,this._borderValue=g,h}_computeLabelItems(t){const e=this.axis,i=this.options,{position:n,ticks:r}=i,o=this.isHorizontal(),s=this.ticks,{align:a,crossAlign:l,padding:c,mirror:u}=r,h=nT(i.grid),d=h+c,p=u?-c:d,f=-Nb(this.labelRotation),m=[];let g,_,y,v,x,b,w,E,S,T,M,I,C="middle";if("top"===n)b=this.bottom-p,w=this._getXAxisLabelAlignment();else if("bottom"===n)b=this.top+p,w=this._getXAxisLabelAlignment();else if("left"===n){const t=this._getYAxisLabelAlignment(h);w=t.textAlign,x=t.x}else if("right"===n){const t=this._getYAxisLabelAlignment(h);w=t.textAlign,x=t.x}else if("x"===e){if("center"===n)b=(t.top+t.bottom)/2+d;else if(eb(n)){const t=Object.keys(n)[0],e=n[t];b=this.chart.scales[t].getPixelForValue(e)+d}w=this._getXAxisLabelAlignment()}else if("y"===e){if("center"===n)x=(t.left+t.right)/2-d;else if(eb(n)){const t=Object.keys(n)[0],e=n[t];x=this.chart.scales[t].getPixelForValue(e)}w=this._getYAxisLabelAlignment(h).textAlign}"y"===e&&("start"===a?C="top":"end"===a&&(C="bottom"));const A=this._getLabelSizes();for(g=0,_=s.length;g<_;++g){y=s[g],v=y.label;const t=r.setContext(this.getContext(g));E=this.getPixelForTick(g)+r.labelOffset,S=this._resolveTickFontOptions(g),T=S.lineHeight,M=tb(v)?v.length:1;const e=M/2,i=t.color,a=t.textStrokeColor,c=t.textStrokeWidth;let h,d=w;if(o?(x=E,"inner"===w&&(d=g===_-1?this.options.reverse?"left":"right":0===g?this.options.reverse?"right":"left":"center"),I="top"===n?"near"===l||0!==f?-M*T+T/2:"center"===l?-A.highest.height/2-e*T+T:-A.highest.height+T/2:"near"===l||0!==f?T/2:"center"===l?A.highest.height/2-e*T:A.highest.height-M*T,u&&(I*=-1),0===f||t.showLabelBackdrop||(x+=T/2*Math.sin(f))):(b=E,I=(1-M)*T/2),t.showLabelBackdrop){const e=Hw(t.backdropPadding),i=A.heights[g],n=A.widths[g];let r=I-e.top,o=0-e.left;switch(C){case"middle":r-=i/2;break;case"bottom":r-=i}switch(w){case"center":o-=n/2;break;case"right":o-=n;break;case"inner":g===_-1?o-=n:g>0&&(o-=n/2)}h={left:o,top:r,width:n+e.width,height:i+e.height,color:t.backdropColor}}m.push({label:v,font:S,textOffset:I,options:{rotation:f,color:i,strokeColor:a,strokeWidth:c,textAlign:d,textBaseline:C,translation:[x,b],backdrop:h}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-Nb(this.labelRotation))return"top"===t?"left":"right";let i="center";return"start"===e.align?i="left":"end"===e.align?i="right":"inner"===e.align&&(i="inner"),i}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:n,padding:r}}=this.options,o=t+r,s=this._getLabelSizes().widest.width;let a,l;return"left"===e?n?(l=this.right+r,"near"===i?a="left":"center"===i?(a="center",l+=s/2):(a="right",l+=s)):(l=this.right-o,"near"===i?a="right":"center"===i?(a="center",l-=s/2):(a="left",l=this.left)):"right"===e?n?(l=this.left+r,"near"===i?a="right":"center"===i?(a="center",l-=s/2):(a="left",l-=s)):(l=this.left+o,"near"===i?a="left":"center"===i?(a="center",l+=s/2):(a="right",l=this.right)):a="right",{textAlign:a,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;return"left"===e||"right"===e?{top:0,left:this.left,bottom:t.height,right:this.right}:"top"===e||"bottom"===e?{top:this.top,left:0,bottom:this.bottom,right:t.width}:void 0}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:n,width:r,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,n,r,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const i=this.ticks.findIndex((e=>e.value===t));return i>=0?e.setContext(this.getContext(i)).lineWidth:0}drawGrid(t){const e=this.options.grid,i=this.ctx,n=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,o;const s=(t,e,n)=>{n.width&&n.color&&(i.save(),i.lineWidth=n.width,i.strokeStyle=n.color,i.setLineDash(n.borderDash||[]),i.lineDashOffset=n.borderDashOffset,i.beginPath(),i.moveTo(t.x,t.y),i.lineTo(e.x,e.y),i.stroke(),i.restore())};if(e.display)for(r=0,o=n.length;r<o;++r){const t=n[r];e.drawOnChartArea&&s({x:t.x1,y:t.y1},{x:t.x2,y:t.y2},t),e.drawTicks&&s({x:t.tx1,y:t.ty1},{x:t.tx2,y:t.ty2},{color:t.tickColor,width:t.tickWidth,borderDash:t.tickBorderDash,borderDashOffset:t.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:i,grid:n}}=this,r=i.setContext(this.getContext()),o=i.display?r.width:0;if(!o)return;const s=n.setContext(this.getContext(0)).lineWidth,a=this._borderValue;let l,c,u,h;this.isHorizontal()?(l=Sw(t,this.left,o)-o/2,c=Sw(t,this.right,s)+s/2,u=h=a):(u=Sw(t,this.top,o)-o/2,h=Sw(t,this.bottom,s)+s/2,l=c=a),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(l,u),e.lineTo(c,h),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const e=this.ctx,i=this._computeLabelArea();i&&Aw(e,i);const n=this.getLabelItems(t);for(const t of n){const i=t.options,n=t.font;Nw(e,t.label,0,t.textOffset,n,i)}i&&Pw(e)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:n}}=this;if(!i.display)return;const r=Ww(i.font),o=Hw(i.padding),s=i.align;let a=r.lineHeight/2;"bottom"===e||"center"===e||eb(e)?(a+=o.bottom,tb(i.text)&&(a+=r.lineHeight*(i.text.length-1))):a+=o.top;const{titleX:l,titleY:c,maxWidth:u,rotation:h}=function(t,e,i,n){const{top:r,left:o,bottom:s,right:a,chart:l}=t,{chartArea:c,scales:u}=l;let h,d,p,f=0;const m=s-r,g=a-o;if(t.isHorizontal()){if(d=tw(n,o,a),eb(i)){const t=Object.keys(i)[0],n=i[t];p=u[t].getPixelForValue(n)+m-e}else p="center"===i?(c.bottom+c.top)/2+m-e:QS(t,i,e);h=a-o}else{if(eb(i)){const t=Object.keys(i)[0],n=i[t];d=u[t].getPixelForValue(n)-g+e}else d="center"===i?(c.left+c.right)/2-g+e:QS(t,i,e);p=tw(n,s,r),f="left"===i?-Mb:Mb}return{titleX:d,titleY:p,maxWidth:h,rotation:f}}(this,a,e,s);Nw(t,i.text,0,0,r,{color:i.color,maxWidth:u,rotation:h,textAlign:oT(s,e,n),textBaseline:"middle",translation:[l,c]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=rb(t.grid&&t.grid.z,-1),n=rb(t.border&&t.border.z,0);return this._isVisible()&&this.draw===sT.prototype.draw?[{z:i,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:n,draw:()=>{this.drawBorder()}},{z:e,draw:t=>{this.drawLabels(t)}}]:[{z:e,draw:t=>{this.draw(t)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",n=[];let r,o;for(r=0,o=e.length;r<o;++r){const o=e[r];o[i]!==this.id||t&&o.type!==t||n.push(o)}return n}_resolveTickFontOptions(t){return Ww(this.options.ticks.setContext(this.getContext(t)).font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class aT{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;(function(t){return"id"in t&&"defaults"in t})(e)&&(i=this.register(e));const n=this.items,r=t.id,o=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in n||(n[r]=t,function(t,e,i){const n=db(Object.create(null),[i?bw.get(i):{},bw.get(e),t.defaults]);bw.set(e,n),t.defaultRoutes&&function(t,e){Object.keys(e).forEach((i=>{const n=i.split("."),r=n.pop(),o=[t].concat(n).join("."),s=e[i].split("."),a=s.pop(),l=s.join(".");bw.route(o,r,l,a)}))}(e,t.defaultRoutes),t.descriptors&&bw.describe(e,t.descriptors)}(t,o,i),this.override&&bw.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,n=this.scope;i in e&&delete e[i],n&&i in bw[n]&&(delete bw[n][i],this.override&&delete gw[i])}}class lT{constructor(){this.controllers=new aT(eS,"datasets",!0),this.elements=new aT(KS,"elements"),this.plugins=new aT(Object,"plugins"),this.scales=new aT(sT,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach((e=>{const n=i||this._getRegistryForType(e);i||n.isForType(e)||n===this.plugins&&e.id?this._exec(t,n,e):ab(e,(e=>{const n=i||this._getRegistryForType(e);this._exec(t,n,e)}))}))}_exec(t,e,i){const n=_b(t);sb(i["before"+n],[],i),e[t](i),sb(i["after"+n],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const n=e.get(t);if(void 0===n)throw new Error('"'+t+'" is not a registered '+i+".");return n}}var cT=new lT;class uT{constructor(){this._init=[]}notify(t,e,i,n){"beforeInit"===e&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const r=n?this._descriptors(t).filter(n):this._descriptors(t),o=this._notify(r,t,e,i);return"afterDestroy"===e&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall")),o}_notify(t,e,i,n){n=n||{};for(const r of t){const t=r.plugin;if(!1===sb(t[i],[e,n,r.options],t)&&n.cancelable)return!1}return!0}invalidate(){Qx(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,n=rb(i.options&&i.options.plugins,{}),r=function(t){const e={},i=[],n=Object.keys(cT.plugins.items);for(let t=0;t<n.length;t++)i.push(cT.getPlugin(n[t]));const r=t.plugins||[];for(let t=0;t<r.length;t++){const n=r[t];-1===i.indexOf(n)&&(i.push(n),e[n.id]=!0)}return{plugins:i,localIds:e}}(i);return!1!==n||e?function(t,{plugins:e,localIds:i},n,r){const o=[],s=t.getContext();for(const a of e){const e=a.id,l=hT(n[e],r);null!==l&&o.push({plugin:a,options:dT(t.config,{plugin:a,local:i[e]},l,s)})}return o}(t,r,n,e):[]}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,n=(t,e)=>t.filter((t=>!e.some((e=>t.plugin.id===e.plugin.id))));this._notify(n(e,i),t,"stop"),this._notify(n(i,e),t,"start")}}function hT(t,e){return e||!1!==t?!0===t?{}:t:null}function dT(t,{plugin:e,local:i},n,r){const o=t.pluginScopeKeys(e),s=t.getOptionScopes(n,o);return i&&e.defaults&&s.push(e.defaults),t.createResolver(s,r,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function pT(t,e){const i=bw.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||i.indexAxis||"x"}function fT(t){if("x"===t||"y"===t||"r"===t)return t}function mT(t,...e){if(fT(t))return t;for(const n of e){const e=n.axis||("top"===(i=n.position)||"bottom"===i?"x":"left"===i||"right"===i?"y":void 0)||t.length>1&&fT(t[0].toLowerCase());if(e)return e}var i;throw new Error(`Cannot determine type of '${t}' axis. Please provide 'axis' or 'position' option.`)}function gT(t,e,i){if(i[e+"AxisID"]===t)return{axis:e}}function _T(t){const e=t.options||(t.options={});e.plugins=rb(e.plugins,{}),e.scales=function(t,e){const i=gw[t.type]||{scales:{}},n=e.scales||{},r=pT(t.type,e),o=Object.create(null);return Object.keys(n).forEach((e=>{const s=n[e];if(!eb(s))return console.error(`Invalid scale configuration for scale: ${e}`);if(s._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${e}`);const a=mT(e,s,function(t,e){if(e.data&&e.data.datasets){const i=e.data.datasets.filter((e=>e.xAxisID===t||e.yAxisID===t));if(i.length)return gT(t,"x",i[0])||gT(t,"y",i[0])}return{}}(e,t),bw.scales[s.type]),l=function(t,e){return t===e?"_index_":"_value_"}(a,r),c=i.scales||{};o[e]=pb(Object.create(null),[{axis:a},s,c[a],c[l]])})),t.data.datasets.forEach((i=>{const r=i.type||t.type,s=i.indexAxis||pT(r,e),a=(gw[r]||{}).scales||{};Object.keys(a).forEach((t=>{const e=function(t,e){let i=t;return"_index_"===t?i=e:"_value_"===t&&(i="x"===e?"y":"x"),i}(t,s),r=i[e+"AxisID"]||e;o[r]=o[r]||Object.create(null),pb(o[r],[{axis:e},n[r],a[t]])}))})),Object.keys(o).forEach((t=>{const e=o[t];pb(e,[bw.scales[e.type],bw.scale])})),o}(t,e)}function yT(t){return(t=t||{}).datasets=t.datasets||[],t.labels=t.labels||[],t}const vT=new Map,xT=new Set;function bT(t,e){let i=vT.get(t);return i||(i=e(),vT.set(t,i),xT.add(i)),i}const wT=(t,e,i)=>{const n=gb(e,i);void 0!==n&&t.add(n)};class ET{constructor(t){this._config=function(t){return(t=t||{}).data=yT(t.data),_T(t),t}(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=yT(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),_T(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return bT(t,(()=>[[`datasets.${t}`,""]]))}datasetAnimationScopeKeys(t,e){return bT(`${t}.transition.${e}`,(()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]]))}datasetElementScopeKeys(t,e){return bT(`${t}-${e}`,(()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]]))}pluginScopeKeys(t){const e=t.id;return bT(`${this.type}-plugin-${e}`,(()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]]))}_cachedScopes(t,e){const i=this._scopeCache;let n=i.get(t);return n&&!e||(n=new Map,i.set(t,n)),n}getOptionScopes(t,e,i){const{options:n,type:r}=this,o=this._cachedScopes(t,i),s=o.get(e);if(s)return s;const a=new Set;e.forEach((e=>{t&&(a.add(t),e.forEach((e=>wT(a,t,e)))),e.forEach((t=>wT(a,n,t))),e.forEach((t=>wT(a,gw[r]||{},t))),e.forEach((t=>wT(a,bw,t))),e.forEach((t=>wT(a,_w,t)))}));const l=Array.from(a);return 0===l.length&&l.push(Object.create(null)),xT.has(e)&&o.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,gw[e]||{},bw.datasets[e]||{},{type:e},bw,_w]}resolveNamedOptions(t,e,i,n=[""]){const r={$shared:!0},{resolver:o,subPrefixes:s}=ST(this._resolverCache,t,n);let a=o;(function(t,e){const{isScriptable:i,isIndexable:n}=Zw(t);for(const r of e){const e=i(r),o=n(r),s=(o||e)&&t[r];if(e&&(vb(s)||TT(s))||o&&tb(s))return!0}return!1})(o,e)&&(r.$shared=!1,a=Yw(o,i=vb(i)?i():i,this.createResolver(t,i,s)));for(const t of e)r[t]=a[t];return r}createResolver(t,e,i=[""],n){const{resolver:r}=ST(this._resolverCache,t,i);return eb(e)?Yw(r,e,void 0,n):r}}function ST(t,e,i){let n=t.get(e);n||(n=new Map,t.set(e,n));const r=i.join();let o=n.get(r);return o||(o={resolver:$w(e,i),subPrefixes:i.filter((t=>!t.toLowerCase().includes("hover")))},n.set(r,o)),o}const TT=t=>eb(t)&&Object.getOwnPropertyNames(t).some((e=>vb(t[e]))),MT=["top","bottom","left","right","chartArea"];function IT(t,e){return"top"===t||"bottom"===t||-1===MT.indexOf(t)&&"x"===e}function CT(t,e){return function(i,n){return i[t]===n[t]?i[e]-n[e]:i[t]-n[t]}}function AT(t){const e=t.chart,i=e.options.animation;e.notifyPlugins("afterRender"),sb(i&&i.onComplete,[t],e)}function PT(t){const e=t.chart,i=e.options.animation;sb(i&&i.onProgress,[t],e)}function LT(t){return fE()&&"string"==typeof t?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const RT={},DT=t=>{const e=LT(t);return Object.values(RT).filter((t=>t.canvas===e)).pop()};function kT(t,e,i){const n=Object.keys(t);for(const r of n){const n=+r;if(n>=e){const o=t[r];delete t[r],(i>0||n>e)&&(t[n+i]=o)}}}function NT(t,e,i){return t.options.clip?t[i]:e[i]}class OT{static defaults=bw;static instances=RT;static overrides=gw;static registry=cT;static version="4.4.2";static getChart=DT;static register(...t){cT.add(...t),FT()}static unregister(...t){cT.remove(...t),FT()}constructor(t,e){const i=this.config=new ET(e),n=LT(t),r=DT(n);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const o=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||function(t){return!fE()||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas?NS:ZS}(n)),this.platform.updateConfig(i);const s=this.platform.acquireContext(n,o.aspectRatio),a=s&&s.canvas,l=a&&a.height,c=a&&a.width;this.id=Jx(),this.ctx=s,this.canvas=a,this.width=c,this.height=l,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new uT,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(t,e){let i;return function(...n){return e?(clearTimeout(i),i=setTimeout(t,e,n)):t.apply(this,n),e}}((t=>this.update(t)),o.resizeDelay||0),this._dataChanges=[],RT[this.id]=this,s&&a?(BE.listen(this,"complete",AT),BE.listen(this,"progress",PT),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:n,_aspectRatio:r}=this;return Qx(t)?e&&r?r:n?i/n:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return cT}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():EE(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Tw(this.canvas,this.ctx),this}stop(){return BE.stop(this),this}resize(t,e){BE.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,n=this.canvas,r=i.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(n,t,e,r),s=i.devicePixelRatio||this.platform.getDevicePixelRatio(),a=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,EE(this,s,!0)&&(this.notifyPlugins("resize",{size:o}),sb(i.onResize,[this,o],this),this.attached&&this._doResize(a)&&this.render())}ensureScalesHaveIDs(){ab(this.options.scales||{},((t,e)=>{t.id=e}))}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,n=Object.keys(i).reduce(((t,e)=>(t[e]=!1,t)),{});let r=[];e&&(r=r.concat(Object.keys(e).map((t=>{const i=e[t],n=mT(t,i),r="r"===n,o="x"===n;return{options:i,dposition:r?"chartArea":o?"bottom":"left",dtype:r?"radialLinear":o?"category":"linear"}})))),ab(r,(e=>{const r=e.options,o=r.id,s=mT(o,r),a=rb(r.type,e.dtype);void 0!==r.position&&IT(r.position,s)===IT(e.dposition)||(r.position=e.dposition),n[o]=!0;let l=null;o in i&&i[o].type===a?l=i[o]:(l=new(cT.getScale(a))({id:o,type:a,ctx:this.ctx,chart:this}),i[l.id]=l),l.init(r,t)})),ab(n,((t,e)=>{t||delete i[e]})),ab(i,(t=>{DS.configure(this,t,t.options),DS.addBox(this,t)}))}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort(((t,e)=>t.index-e.index)),i>e){for(let t=e;t<i;++t)this._destroyDatasetMeta(t);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(CT("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach(((t,i)=>{0===e.filter((e=>e===t._dataset)).length&&this._destroyDatasetMeta(i)}))}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,n;for(this._removeUnreferencedMetasets(),i=0,n=e.length;i<n;i++){const n=e[i];let r=this.getDatasetMeta(i);const o=n.type||this.config.type;if(r.type&&r.type!==o&&(this._destroyDatasetMeta(i),r=this.getDatasetMeta(i)),r.type=o,r.indexAxis=n.indexAxis||pT(o,this.options),r.order=n.order||0,r.index=i,r.label=""+n.label,r.visible=this.isDatasetVisible(i),r.controller)r.controller.updateIndex(i),r.controller.linkScales();else{const e=cT.getController(o),{datasetElementType:n,dataElementType:s}=bw.datasets[o];Object.assign(e,{dataElementType:cT.getElement(s),datasetElementType:n&&cT.getElement(n)}),r.controller=new e(this,i),t.push(r.controller)}}return this._updateMetasets(),t}_resetElements(){ab(this.data.datasets,((t,e)=>{this.getDatasetMeta(e).controller.reset()}),this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),n=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0}))return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let t=0,e=this.data.datasets.length;t<e;t++){const{controller:e}=this.getDatasetMeta(t),i=!n&&-1===r.indexOf(e);e.buildOrUpdateElements(i),o=Math.max(+e.getMaxOverflow(),o)}o=this._minPadding=i.layout.autoPadding?o:0,this._updateLayout(o),n||ab(r,(t=>{t.reset()})),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(CT("z","_idx"));const{_active:s,_lastEvent:a}=this;a?this._eventHandler(a,!0):s.length&&this._updateHoverStyles(s,s,!0),this.render()}_updateScales(){ab(this.scales,(t=>{DS.removeBox(this,t)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);xb(e,i)&&!!this._responsiveListeners===t.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:n,count:r}of e)kT(t,n,"_removeElements"===i?-r:r)}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=e=>new Set(t.filter((t=>t[0]===e)).map(((t,e)=>e+","+t.splice(1).join(",")))),n=i(0);for(let t=1;t<e;t++)if(!xb(n,i(t)))return;return Array.from(n).map((t=>t.split(","))).map((t=>({method:t[1],start:+t[2],count:+t[3]})))}_updateLayout(t){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;DS.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],ab(this.boxes,(t=>{i&&"chartArea"===t.position||(t.configure&&t.configure(),this._layers.push(...t._layers()))}),this),this._layers.forEach(((t,e)=>{t._idx=e})),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})){for(let t=0,e=this.data.datasets.length;t<e;++t)this.getDatasetMeta(t).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,vb(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),n={meta:i,index:t,mode:e,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",n)&&(i.controller._update(e),n.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",n))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(BE.has(this)?this.attached&&!BE.running(this)&&BE.start(this):(this.draw(),AT({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:t,height:e}=this._resizeBeforeDraw;this._resize(t,e),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let n,r;for(n=0,r=e.length;n<r;++n){const r=e[n];t&&!r.visible||i.push(r)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i=t._clip,n=!i.disabled,r=function(t,e){const{xScale:i,yScale:n}=t;return i&&n?{left:NT(i,e,"left"),right:NT(i,e,"right"),top:NT(n,e,"top"),bottom:NT(n,e,"bottom")}:e}(t,this.chartArea),o={meta:t,index:t.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",o)&&(n&&Aw(e,{left:!1===i.left?0:r.left-i.left,right:!1===i.right?this.width:r.right+i.right,top:!1===i.top?0:r.top-i.top,bottom:!1===i.bottom?this.height:r.bottom+i.bottom}),t.controller.draw(),n&&Pw(e),o.cancelable=!1,this.notifyPlugins("afterDatasetDraw",o))}isPointInArea(t){return Cw(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,n){const r=bS.modes[e];return"function"==typeof r?r(this,t,i,n):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let n=i.filter((t=>t&&t._dataset===e)).pop();return n||(n={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(n)),n}getContext(){return this.$context||(this.$context=Xw(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return"boolean"==typeof i.hidden?!i.hidden:!e.hidden}setDatasetVisibility(t,e){this.getDatasetMeta(t).hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const n=i?"show":"hide",r=this.getDatasetMeta(t),o=r.controller._resolveAnimations(void 0,n);yb(e)?(r.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),o.update(r,{visible:i}),this.update((e=>e.datasetIndex===t?n:void 0)))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),BE.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Tw(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete RT[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(i,n)=>{e.addEventListener(this,i,n),t[i]=n},n=(t,e,i)=>{t.offsetX=e,t.offsetY=i,this._eventHandler(t)};ab(this.options.events,(t=>i(t,n)))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(i,n)=>{e.addEventListener(this,i,n),t[i]=n},n=(i,n)=>{t[i]&&(e.removeEventListener(this,i,n),delete t[i])},r=(t,e)=>{this.canvas&&this.resize(t,e)};let o;const s=()=>{n("attach",s),this.attached=!0,this.resize(),i("resize",r),i("detach",o)};o=()=>{this.attached=!1,n("resize",r),this._stop(),this._resize(0,0),i("attach",s)},e.isAttached(this.canvas)?s():o()}unbindEvents(){ab(this._listeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._listeners={},ab(this._responsiveListeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const n=i?"set":"remove";let r,o,s,a;for("dataset"===e&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+n+"DatasetHoverStyle"]()),s=0,a=t.length;s<a;++s){o=t[s];const e=o&&this.getDatasetMeta(o.datasetIndex).controller;e&&e[n+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map((({datasetIndex:t,index:e})=>{const i=this.getDatasetMeta(t);if(!i)throw new Error("No dataset found at index "+t);return{datasetIndex:t,element:i.data[e],index:e}}));!lb(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}isPluginEnabled(t){return 1===this._plugins._cache.filter((e=>e.plugin.id===t)).length}_updateHoverStyles(t,e,i){const n=this.options.hover,r=(t,e)=>t.filter((t=>!e.some((e=>t.datasetIndex===e.datasetIndex&&t.index===e.index)))),o=r(e,t),s=i?t:r(t,e);o.length&&this.updateHoverStyle(o,n.mode,!1),s.length&&n.mode&&this.updateHoverStyle(s,n.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},n=e=>(e.options.events||this.options.events).includes(t.native.type);if(!1===this.notifyPlugins("beforeEvent",i,n))return;const r=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,n),(r||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:n=[],options:r}=this,o=e,s=this._getActiveElements(t,n,i,o),a=function(t){return"mouseup"===t.type||"click"===t.type||"contextmenu"===t.type}(t),l=function(t,e,i,n){return i&&"mouseout"!==t.type?n?e:t:null}(t,this._lastEvent,i,a);i&&(this._lastEvent=null,sb(r.onHover,[t,s,this],this),a&&sb(r.onClick,[t,s,this],this));const c=!lb(s,n);return(c||e)&&(this._active=s,this._updateHoverStyles(s,n,e)),this._lastEvent=l,c}_getActiveElements(t,e,i,n){if("mouseout"===t.type)return[];if(!i)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,n)}}function FT(){return ab(OT.instances,(t=>t._plugins.invalidate()))}function zT(t,e,i,n){return{x:i+t*Math.cos(e),y:n+t*Math.sin(e)}}function BT(t,e,i,n,r,o){const{x:s,y:a,startAngle:l,pixelMargin:c,innerRadius:u}=e,h=Math.max(e.outerRadius+n+i-c,0),d=u>0?u+n+i+c:0;let p=0;const f=r-l;if(n){const t=((u>0?u-n:0)+(h>0?h-n:0))/2;p=(f-(0!==t?f*t/(t+n):f))/2}const m=(f-Math.max(.001,f*h-i/bb)/h)/2,g=l+m+p,_=r-m-p,{outerStart:y,outerEnd:v,innerStart:x,innerEnd:b}=function(t,e,i,n){const r=Vw(t.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]),o=(i-e)/2,s=Math.min(o,n*e/2),a=t=>{const e=(i-Math.min(o,t))*n/2;return Gb(t,0,Math.min(o,e))};return{outerStart:a(r.outerStart),outerEnd:a(r.outerEnd),innerStart:Gb(r.innerStart,0,s),innerEnd:Gb(r.innerEnd,0,s)}}(e,d,h,_-g),w=h-y,E=h-v,S=g+y/w,T=_-v/E,M=d+x,I=d+b,C=g+x/M,A=_-b/I;if(t.beginPath(),o){const e=(S+T)/2;if(t.arc(s,a,h,S,e),t.arc(s,a,h,e,T),v>0){const e=zT(E,T,s,a);t.arc(e.x,e.y,v,T,_+Mb)}const i=zT(I,_,s,a);if(t.lineTo(i.x,i.y),b>0){const e=zT(I,A,s,a);t.arc(e.x,e.y,b,_+Mb,A+Math.PI)}const n=(_-b/d+(g+x/d))/2;if(t.arc(s,a,d,_-b/d,n,!0),t.arc(s,a,d,n,g+x/d,!0),x>0){const e=zT(M,C,s,a);t.arc(e.x,e.y,x,C+Math.PI,g-Mb)}const r=zT(w,g,s,a);if(t.lineTo(r.x,r.y),y>0){const e=zT(w,S,s,a);t.arc(e.x,e.y,y,g-Mb,S)}}else{t.moveTo(s,a);const e=Math.cos(S)*h+s,i=Math.sin(S)*h+a;t.lineTo(e,i);const n=Math.cos(T)*h+s,r=Math.sin(T)*h+a;t.lineTo(n,r)}t.closePath()}function UT(t,e,i=e){t.lineCap=rb(i.borderCapStyle,e.borderCapStyle),t.setLineDash(rb(i.borderDash,e.borderDash)),t.lineDashOffset=rb(i.borderDashOffset,e.borderDashOffset),t.lineJoin=rb(i.borderJoinStyle,e.borderJoinStyle),t.lineWidth=rb(i.borderWidth,e.borderWidth),t.strokeStyle=rb(i.borderColor,e.borderColor)}function VT(t,e,i){t.lineTo(i.x,i.y)}function jT(t,e,i={}){const n=t.length,{start:r=0,end:o=n-1}=i,{start:s,end:a}=e,l=Math.max(r,s),c=Math.min(o,a),u=r<s&&o<s||r>a&&o>a;return{count:n,start:l,loop:e.loop,ilen:c<l&&!u?n+c-l:c-l}}function GT(t,e,i,n){const{points:r,options:o}=e,{count:s,start:a,loop:l,ilen:c}=jT(r,i,n),u=function(t){return t.stepped?Lw:t.tension||"monotone"===t.cubicInterpolationMode?Rw:VT}(o);let h,d,p,{move:f=!0,reverse:m}=n||{};for(h=0;h<=c;++h)d=r[(a+(m?c-h:h))%s],d.skip||(f?(t.moveTo(d.x,d.y),f=!1):u(t,p,d,m,o.stepped),p=d);return l&&(d=r[(a+(m?c:0))%s],u(t,p,d,m,o.stepped)),!!l}function HT(t,e,i,n){const r=e.points,{count:o,start:s,ilen:a}=jT(r,i,n),{move:l=!0,reverse:c}=n||{};let u,h,d,p,f,m,g=0,_=0;const y=t=>(s+(c?a-t:t))%o,v=()=>{p!==f&&(t.lineTo(g,f),t.lineTo(g,p),t.lineTo(g,m))};for(l&&(h=r[y(0)],t.moveTo(h.x,h.y)),u=0;u<=a;++u){if(h=r[y(u)],h.skip)continue;const e=h.x,i=h.y,n=0|e;n===d?(i<p?p=i:i>f&&(f=i),g=(_*g+e)/++_):(v(),t.lineTo(e,i),d=n,_=0,p=f=i),m=i}v()}function WT(t){const e=t.options,i=e.borderDash&&e.borderDash.length;return t._decimated||t._loop||e.tension||"monotone"===e.cubicInterpolationMode||e.stepped||i?GT:HT}const qT="function"==typeof Path2D;class XT extends KS{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:t=>"borderDash"!==t&&"fill"!==t};constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||"monotone"===i.cubicInterpolationMode)&&!i.stepped&&!this._pointsUpdated){const n=i.spanGaps?this._loop:this._fullLoop;pE(this._points,i,t,n,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(t,e){const i=t.points,n=t.options.spanGaps,r=i.length;if(!r)return[];const o=!!t._loop,{start:s,end:a}=function(t,e,i,n){let r=0,o=e-1;if(i&&!n)for(;r<e&&!t[r].skip;)r++;for(;r<e&&t[r].skip;)r++;for(r%=e,i&&(o+=r);o>r&&t[o%e].skip;)o--;return o%=e,{start:r,end:o}}(i,r,o,n);return function(t,e,i,n){return n&&n.setContext&&i?function(t,e,i,n){const r=t._chart.getContext(),o=OE(t.options),{_datasetIndex:s,options:{spanGaps:a}}=t,l=i.length,c=[];let u=o,h=e[0].start,d=h;function p(t,e,n,r){const o=a?-1:1;if(t!==e){for(t+=l;i[t%l].skip;)t-=o;for(;i[e%l].skip;)e+=o;t%l!=e%l&&(c.push({start:t%l,end:e%l,loop:n,style:r}),u=r,h=e%l)}}for(const t of e){h=a?h:t.start;let e,o=i[h%l];for(d=h+1;d<=t.end;d++){const a=i[d%l];e=OE(n.setContext(Xw(r,{type:"segment",p0:o,p1:a,p0DataIndex:(d-1)%l,p1DataIndex:d%l,datasetIndex:s}))),FE(e,u)&&p(h,d-1,t.loop,u),o=a,u=e}h<d-1&&p(h,d-1,t.loop,u)}return c}(t,e,i,n):e}(t,!0===n?[{start:s,end:a,loop:o}]:function(t,e,i,n){const r=t.length,o=[];let s,a=e,l=t[e];for(s=e+1;s<=i;++s){const i=t[s%r];i.skip||i.stop?l.skip||(n=!1,o.push({start:e%r,end:(s-1)%r,loop:n}),e=a=i.stop?s:null):(a=s,l.skip&&(e=s)),l=i}return null!==a&&o.push({start:e%r,end:a%r,loop:n}),o}(i,s,a<s?a+r:a,!!t._fullLoop&&0===s&&a===r-1),i,e)}(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,n=t[e],r=this.points,o=NE(this,{property:e,start:n,end:n});if(!o.length)return;const s=[],a=function(t){return t.stepped?IE:t.tension||"monotone"===t.cubicInterpolationMode?CE:ME}(i);let l,c;for(l=0,c=o.length;l<c;++l){const{start:c,end:u}=o[l],h=r[c],d=r[u];if(h===d){s.push(h);continue}const p=a(h,d,Math.abs((n-h[e])/(d[e]-h[e])),i.stepped);p[e]=t[e],s.push(p)}return 1===s.length?s[0]:s}pathSegment(t,e,i){return WT(this)(t,this,e,i)}path(t,e,i){const n=this.segments,r=WT(this);let o=this._loop;e=e||0,i=i||this.points.length-e;for(const s of n)o&=r(t,this,s,{start:e,end:e+i-1});return!!o}draw(t,e,i,n){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),function(t,e,i,n){qT&&!e.options.segment?function(t,e,i,n){let r=e._path;r||(r=e._path=new Path2D,e.path(r,i,n)&&r.closePath()),UT(t,e.options),t.stroke(r)}(t,e,i,n):function(t,e,i,n){const{segments:r,options:o}=e,s=WT(e);for(const a of r)UT(t,o,a.style),t.beginPath(),s(t,e,a,{start:i,end:i+n-1})&&t.closePath(),t.stroke()}(t,e,i,n)}(t,this,i,n),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function $T(t,e,i,n){const r=t.options,{[i]:o}=t.getProps([i],n);return Math.abs(e-o)<r.radius+r.hitRadius}function YT(t,e){const{x:i,y:n,base:r,width:o,height:s}=t.getProps(["x","y","base","width","height"],e);let a,l,c,u,h;return t.horizontal?(h=s/2,a=Math.min(i,r),l=Math.max(i,r),c=n-h,u=n+h):(h=o/2,a=i-h,l=i+h,c=Math.min(n,r),u=Math.max(n,r)),{left:a,top:c,right:l,bottom:u}}function ZT(t,e,i,n){return t?0:Gb(e,i,n)}function KT(t,e,i,n){const r=null===e,o=null===i,s=t&&!(r&&o)&&YT(t,n);return s&&(r||Hb(e,s.left,s.right))&&(o||Hb(i,s.top,s.bottom))}function JT(t,e){t.rect(e.x,e.y,e.w,e.h)}function QT(t,e,i={}){const n=t.x!==i.x?-e:0,r=t.y!==i.y?-e:0,o=(t.x+t.w!==i.x+i.w?e:0)-n,s=(t.y+t.h!==i.y+i.h?e:0)-r;return{x:t.x+n,y:t.y+r,w:t.w+o,h:t.h+s,radius:t.radius}}var tM=Object.freeze({__proto__:null,ArcElement:class extends KS{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:t=>"borderDash"!==t};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,i){const n=this.getProps(["x","y"],i),{angle:r,distance:o}=zb(n,{x:t,y:e}),{startAngle:s,endAngle:a,innerRadius:l,outerRadius:c,circumference:u}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),h=(this.options.spacing+this.options.borderWidth)/2,d=rb(u,a-s)>=wb||jb(r,s,a),p=Hb(o,l+h,c+h);return d&&p}getCenterPoint(t){const{x:e,y:i,startAngle:n,endAngle:r,innerRadius:o,outerRadius:s}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:a,spacing:l}=this.options,c=(n+r)/2,u=(o+s+l+a)/2;return{x:e+Math.cos(c)*u,y:i+Math.sin(c)*u}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:i}=this,n=(e.offset||0)/4,r=(e.spacing||0)/2,o=e.circular;if(this.pixelMargin="inner"===e.borderAlign?.33:0,this.fullCircles=i>wb?Math.floor(i/wb):0,0===i||this.innerRadius<0||this.outerRadius<0)return;t.save();const s=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(s)*n,Math.sin(s)*n);const a=n*(1-Math.sin(Math.min(bb,i||0)));t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor,function(t,e,i,n,r){const{fullCircles:o,startAngle:s,circumference:a}=e;let l=e.endAngle;if(o){BT(t,e,i,n,l,r);for(let e=0;e<o;++e)t.fill();isNaN(a)||(l=s+(a%wb||wb))}BT(t,e,i,n,l,r),t.fill()}(t,this,a,r,o),function(t,e,i,n,r){const{fullCircles:o,startAngle:s,circumference:a,options:l}=e,{borderWidth:c,borderJoinStyle:u,borderDash:h,borderDashOffset:d}=l,p="inner"===l.borderAlign;if(!c)return;t.setLineDash(h||[]),t.lineDashOffset=d,p?(t.lineWidth=2*c,t.lineJoin=u||"round"):(t.lineWidth=c,t.lineJoin=u||"bevel");let f=e.endAngle;if(o){BT(t,e,i,n,f,r);for(let e=0;e<o;++e)t.stroke();isNaN(a)||(f=s+(a%wb||wb))}p&&function(t,e,i){const{startAngle:n,pixelMargin:r,x:o,y:s,outerRadius:a,innerRadius:l}=e;let c=r/a;t.beginPath(),t.arc(o,s,a,n-c,i+c),l>r?(c=r/l,t.arc(o,s,l,i+c,n-c,!0)):t.arc(o,s,r,i+Mb,n-Mb),t.closePath(),t.clip()}(t,e,f),o||(BT(t,e,i,n,f,r),t.stroke())}(t,this,a,r,o),t.restore()}},BarElement:class extends KS{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:n}}=this,{inner:r,outer:o}=function(t){const e=YT(t),i=e.right-e.left,n=e.bottom-e.top,r=function(t,e,i){const n=t.options.borderWidth,r=t.borderSkipped,o=jw(n);return{t:ZT(r.top,o.top,0,i),r:ZT(r.right,o.right,0,e),b:ZT(r.bottom,o.bottom,0,i),l:ZT(r.left,o.left,0,e)}}(t,i/2,n/2),o=function(t,e,i){const{enableBorderRadius:n}=t.getProps(["enableBorderRadius"]),r=t.options.borderRadius,o=Gw(r),s=Math.min(e,i),a=t.borderSkipped,l=n||eb(r);return{topLeft:ZT(!l||a.top||a.left,o.topLeft,0,s),topRight:ZT(!l||a.top||a.right,o.topRight,0,s),bottomLeft:ZT(!l||a.bottom||a.left,o.bottomLeft,0,s),bottomRight:ZT(!l||a.bottom||a.right,o.bottomRight,0,s)}}(t,i/2,n/2);return{outer:{x:e.left,y:e.top,w:i,h:n,radius:o},inner:{x:e.left+r.l,y:e.top+r.t,w:i-r.l-r.r,h:n-r.t-r.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(r.t,r.l)),topRight:Math.max(0,o.topRight-Math.max(r.t,r.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(r.b,r.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(r.b,r.r))}}}}(this),s=(a=o.radius).topLeft||a.topRight||a.bottomLeft||a.bottomRight?Ow:JT;var a;t.save(),o.w===r.w&&o.h===r.h||(t.beginPath(),s(t,QT(o,e,r)),t.clip(),s(t,QT(r,-e,o)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),s(t,QT(r,e)),t.fillStyle=n,t.fill(),t.restore()}inRange(t,e,i){return KT(this,t,e,i)}inXRange(t,e){return KT(this,t,null,e)}inYRange(t,e){return KT(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:n,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+n)/2:e,y:r?i:(i+n)/2}}getRange(t){return"x"===t?this.width/2:this.height/2}},LineElement:XT,PointElement:class extends KS{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,i){const n=this.options,{x:r,y:o}=this.getProps(["x","y"],i);return Math.pow(t-r,2)+Math.pow(e-o,2)<Math.pow(n.hitRadius+n.radius,2)}inXRange(t,e){return $T(this,t,"x",e)}inYRange(t,e){return $T(this,t,"y",e)}getCenterPoint(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}size(t){let e=(t=t||this.options||{}).radius||0;return e=Math.max(e,e&&t.hoverRadius||0),2*(e+(e&&t.borderWidth||0))}draw(t,e){const i=this.options;this.skip||i.radius<.1||!Cw(this,e,this.size(i)/2)||(t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.fillStyle=i.backgroundColor,Mw(t,i,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}});const eM=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],iM=eM.map((t=>t.replace("rgb(","rgba(").replace(")",", 0.5)")));function nM(t){return eM[t%eM.length]}function rM(t){return iM[t%iM.length]}function oM(t){let e;for(e in t)if(t[e].borderColor||t[e].backgroundColor)return!0;return!1}var sM={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(t,e,i){if(!i.enabled)return;const{data:{datasets:n},options:r}=t.config,{elements:o}=r;if(!i.forceOverride&&(oM(n)||(s=r)&&(s.borderColor||s.backgroundColor)||o&&oM(o)))return;var s;const a=function(t){let e=0;return(i,n)=>{const r=t.getDatasetMeta(n).controller;r instanceof uS?e=function(t,e){return t.backgroundColor=t.data.map((()=>nM(e++))),e}(i,e):r instanceof hS?e=function(t,e){return t.backgroundColor=t.data.map((()=>rM(e++))),e}(i,e):r&&(e=function(t,e){return t.borderColor=nM(e),t.backgroundColor=rM(e),++e}(i,e))}}(t);n.forEach(a)}};function aM(t){if(t._decimated){const e=t._data;delete t._decimated,delete t._data,Object.defineProperty(t,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function lM(t){t.data.datasets.forEach((t=>{aM(t)}))}var cM={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(t,e,i)=>{if(!i.enabled)return void lM(t);const n=t.width;t.data.datasets.forEach(((e,r)=>{const{_data:o,indexAxis:s}=e,a=t.getDatasetMeta(r),l=o||e.data;if("y"===qw([s,t.options.indexAxis]))return;if(!a.controller.supportsDecimation)return;const c=t.scales[a.xAxisID];if("linear"!==c.type&&"time"!==c.type)return;if(t.options.parsing)return;let u,{start:h,count:d}=function(t,e){const i=e.length;let n,r=0;const{iScale:o}=t,{min:s,max:a,minDefined:l,maxDefined:c}=o.getUserBounds();return l&&(r=Gb(qb(e,o.axis,s).lo,0,i-1)),n=c?Gb(qb(e,o.axis,a).hi+1,r,i)-r:i-r,{start:r,count:n}}(a,l);if(d<=(i.threshold||4*n))aM(e);else{switch(Qx(o)&&(e._data=l,delete e.data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(t){this._data=t}})),i.algorithm){case"lttb":u=function(t,e,i,n,r){const o=r.samples||n;if(o>=i)return t.slice(e,e+i);const s=[],a=(i-2)/(o-2);let l=0;const c=e+i-1;let u,h,d,p,f,m=e;for(s[l++]=t[m],u=0;u<o-2;u++){let n,r=0,o=0;const c=Math.floor((u+1)*a)+1+e,g=Math.min(Math.floor((u+2)*a)+1,i)+e,_=g-c;for(n=c;n<g;n++)r+=t[n].x,o+=t[n].y;r/=_,o/=_;const y=Math.floor(u*a)+1+e,v=Math.min(Math.floor((u+1)*a)+1,i)+e,{x,y:b}=t[m];for(d=p=-1,n=y;n<v;n++)p=.5*Math.abs((x-r)*(t[n].y-b)-(x-t[n].x)*(o-b)),p>d&&(d=p,h=t[n],f=n);s[l++]=h,m=f}return s[l++]=t[c],s}(l,h,d,n,i);break;case"min-max":u=function(t,e,i,n){let r,o,s,a,l,c,u,h,d,p,f=0,m=0;const g=[],_=e+i-1,y=t[e].x,v=t[_].x-y;for(r=e;r<e+i;++r){o=t[r],s=(o.x-y)/v*n,a=o.y;const e=0|s;if(e===l)a<d?(d=a,c=r):a>p&&(p=a,u=r),f=(m*f+o.x)/++m;else{const i=r-1;if(!Qx(c)&&!Qx(u)){const e=Math.min(c,u),n=Math.max(c,u);e!==h&&e!==i&&g.push({...t[e],x:f}),n!==h&&n!==i&&g.push({...t[n],x:f})}r>0&&i!==h&&g.push(t[i]),g.push(o),l=e,m=0,d=p=a,c=u=h=r}}return g}(l,h,d,n);break;default:throw new Error(`Unsupported decimation algorithm '${i.algorithm}'`)}e._decimated=u}}))},destroy(t){lM(t)}};function uM(t,e,i,n){if(n)return;let r=e[t],o=i[t];return"angle"===t&&(r=Vb(r),o=Vb(o)),{property:t,start:r,end:o}}function hM(t,e,i){for(;e>t;e--){const t=i[e];if(!isNaN(t.x)&&!isNaN(t.y))break}return e}function dM(t,e,i,n){return t&&e?n(t[i],e[i]):t?t[i]:e?e[i]:0}function pM(t,e){let i=[],n=!1;return tb(t)?(n=!0,i=t):i=function(t,e){const{x:i=null,y:n=null}=t||{},r=e.points,o=[];return e.segments.forEach((({start:t,end:e})=>{e=hM(t,e,r);const s=r[t],a=r[e];null!==n?(o.push({x:s.x,y:n}),o.push({x:a.x,y:n})):null!==i&&(o.push({x:i,y:s.y}),o.push({x:i,y:a.y}))})),o}(t,e),i.length?new XT({points:i,options:{tension:0},_loop:n,_fullLoop:n}):null}function fM(t){return t&&!1!==t.fill}function mM(t,e,i){let n=t[e].fill;const r=[e];let o;if(!i)return n;for(;!1!==n&&-1===r.indexOf(n);){if(!ib(n))return n;if(o=t[n],!o)return!1;if(o.visible)return n;r.push(n),n=o.fill}return!1}function gM(t,e,i){const n=function(t){const e=t.options,i=e.fill;let n=rb(i&&i.target,i);return void 0===n&&(n=!!e.backgroundColor),!1!==n&&null!==n&&(!0===n?"origin":n)}(t);if(eb(n))return!isNaN(n.value)&&n;let r=parseFloat(n);return ib(r)&&Math.floor(r)===r?function(t,e,i,n){return"-"!==t&&"+"!==t||(i=e+i),!(i===e||i<0||i>=n)&&i}(n[0],e,r,i):["origin","start","end","stack","shape"].indexOf(n)>=0&&n}function _M(t,e,i){const n=[];for(let r=0;r<i.length;r++){const o=i[r],{first:s,last:a,point:l}=yM(o,e,"x");if(!(!l||s&&a))if(s)n.unshift(l);else if(t.push(l),!a)break}t.push(...n)}function yM(t,e,i){const n=t.interpolate(e,i);if(!n)return{};const r=n[i],o=t.segments,s=t.points;let a=!1,l=!1;for(let t=0;t<o.length;t++){const e=o[t],n=s[e.start][i],c=s[e.end][i];if(Hb(r,n,c)){a=r===n,l=r===c;break}}return{first:a,last:l,point:n}}class vM{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:n,y:r,radius:o}=this;return e=e||{start:0,end:wb},t.arc(n,r,o,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:n}=this,r=t.angle;return{x:e+Math.cos(r)*n,y:i+Math.sin(r)*n,angle:r}}}function xM(t,e,i){const n=function(t){const{chart:e,fill:i,line:n}=t;if(ib(i))return function(t,e){const i=t.getDatasetMeta(e);return i&&t.isDatasetVisible(e)?i.dataset:null}(e,i);if("stack"===i)return function(t){const{scale:e,index:i,line:n}=t,r=[],o=n.segments,s=n.points,a=function(t,e){const i=[],n=t.getMatchingVisibleMetas("line");for(let t=0;t<n.length;t++){const r=n[t];if(r.index===e)break;r.hidden||i.unshift(r.dataset)}return i}(e,i);a.push(pM({x:null,y:e.bottom},n));for(let t=0;t<o.length;t++){const e=o[t];for(let t=e.start;t<=e.end;t++)_M(r,s[t],a)}return new XT({points:r,options:{}})}(t);if("shape"===i)return!0;const r=function(t){return(t.scale||{}).getPointPositionForValue?function(t){const{scale:e,fill:i}=t,n=e.options,r=e.getLabels().length,o=n.reverse?e.max:e.min,s=function(t,e,i){let n;return n="start"===t?i:"end"===t?e.options.reverse?e.min:e.max:eb(t)?t.value:e.getBaseValue(),n}(i,e,o),a=[];if(n.grid.circular){const t=e.getPointPositionForValue(0,o);return new vM({x:t.x,y:t.y,radius:e.getDistanceFromCenterForValue(s)})}for(let t=0;t<r;++t)a.push(e.getPointPositionForValue(t,s));return a}(t):function(t){const{scale:e={},fill:i}=t,n=function(t,e){let i=null;return"start"===t?i=e.bottom:"end"===t?i=e.top:eb(t)?i=e.getPixelForValue(t.value):e.getBasePixel&&(i=e.getBasePixel()),i}(i,e);if(ib(n)){const t=e.isHorizontal();return{x:t?n:null,y:t?null:n}}return null}(t)}(t);return r instanceof vM?r:pM(r,n)}(e),{line:r,scale:o,axis:s}=e,a=r.options,l=a.fill,c=a.backgroundColor,{above:u=c,below:h=c}=l||{};n&&r.points.length&&(Aw(t,i),function(t,e){const{line:i,target:n,above:r,below:o,area:s,scale:a}=e,l=i._loop?"angle":e.axis;t.save(),"x"===l&&o!==r&&(bM(t,n,s.top),wM(t,{line:i,target:n,color:r,scale:a,property:l}),t.restore(),t.save(),bM(t,n,s.bottom)),wM(t,{line:i,target:n,color:o,scale:a,property:l}),t.restore()}(t,{line:r,target:n,above:u,below:h,area:i,scale:o,axis:s}),Pw(t))}function bM(t,e,i){const{segments:n,points:r}=e;let o=!0,s=!1;t.beginPath();for(const a of n){const{start:n,end:l}=a,c=r[n],u=r[hM(n,l,r)];o?(t.moveTo(c.x,c.y),o=!1):(t.lineTo(c.x,i),t.lineTo(c.x,c.y)),s=!!e.pathSegment(t,a,{move:s}),s?t.closePath():t.lineTo(u.x,i)}t.lineTo(e.first().x,i),t.closePath(),t.clip()}function wM(t,e){const{line:i,target:n,property:r,color:o,scale:s}=e,a=function(t,e,i){const n=t.segments,r=t.points,o=e.points,s=[];for(const t of n){let{start:n,end:a}=t;a=hM(n,a,r);const l=uM(i,r[n],r[a],t.loop);if(!e.segments){s.push({source:t,target:l,start:r[n],end:r[a]});continue}const c=NE(e,l);for(const e of c){const n=uM(i,o[e.start],o[e.end],e.loop),a=kE(t,r,n);for(const t of a)s.push({source:t,target:e,start:{[i]:dM(l,n,"start",Math.max)},end:{[i]:dM(l,n,"end",Math.min)}})}}return s}(i,n,r);for(const{source:e,target:l,start:c,end:u}of a){const{style:{backgroundColor:a=o}={}}=e,h=!0!==n;t.save(),t.fillStyle=a,EM(t,s,h&&uM(r,c,u)),t.beginPath();const d=!!i.pathSegment(t,e);let p;if(h){d?t.closePath():SM(t,n,u,r);const e=!!n.pathSegment(t,l,{move:d,reverse:!0});p=d&&e,p||SM(t,n,c,r)}t.closePath(),t.fill(p?"evenodd":"nonzero"),t.restore()}}function EM(t,e,i){const{top:n,bottom:r}=e.chart.chartArea,{property:o,start:s,end:a}=i||{};"x"===o&&(t.beginPath(),t.rect(s,n,a-s,r-n),t.clip())}function SM(t,e,i,n){const r=e.interpolate(i,n);r&&t.lineTo(r.x,r.y)}var TM={id:"filler",afterDatasetsUpdate(t,e,i){const n=(t.data.datasets||[]).length,r=[];let o,s,a,l;for(s=0;s<n;++s)o=t.getDatasetMeta(s),a=o.dataset,l=null,a&&a.options&&a instanceof XT&&(l={visible:t.isDatasetVisible(s),index:s,fill:gM(a,s,n),chart:t,axis:o.controller.options.indexAxis,scale:o.vScale,line:a}),o.$filler=l,r.push(l);for(s=0;s<n;++s)l=r[s],l&&!1!==l.fill&&(l.fill=mM(r,s,i.propagate))},beforeDraw(t,e,i){const n="beforeDraw"===i.drawTime,r=t.getSortedVisibleDatasetMetas(),o=t.chartArea;for(let e=r.length-1;e>=0;--e){const i=r[e].$filler;i&&(i.line.updateControlPoints(o,i.axis),n&&i.fill&&xM(t.ctx,i,o))}},beforeDatasetsDraw(t,e,i){if("beforeDatasetsDraw"!==i.drawTime)return;const n=t.getSortedVisibleDatasetMetas();for(let e=n.length-1;e>=0;--e){const i=n[e].$filler;fM(i)&&xM(t.ctx,i,t.chartArea)}},beforeDatasetDraw(t,e,i){const n=e.meta.$filler;fM(n)&&"beforeDatasetDraw"===i.drawTime&&xM(t.ctx,n,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const MM=(t,e)=>{let{boxHeight:i=e,boxWidth:n=e}=t;return t.usePointStyle&&(i=Math.min(i,e),n=t.pointStyleWidth||Math.min(n,e)),{boxWidth:n,boxHeight:i,itemHeight:Math.max(e,i)}};class IM extends KS{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=sb(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter((e=>t.filter(e,this.chart.data)))),t.sort&&(e=e.sort(((e,i)=>t.sort(e,i,this.chart.data)))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display)return void(this.width=this.height=0);const i=t.labels,n=Ww(i.font),r=n.size,o=this._computeTitleHeight(),{boxWidth:s,itemHeight:a}=MM(i,r);let l,c;e.font=n.string,this.isHorizontal()?(l=this.maxWidth,c=this._fitRows(o,r,s,a)+10):(c=this.maxHeight,l=this._fitCols(o,n,s,a)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(c,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,n){const{ctx:r,maxWidth:o,options:{labels:{padding:s}}}=this,a=this.legendHitBoxes=[],l=this.lineWidths=[0],c=n+s;let u=t;r.textAlign="left",r.textBaseline="middle";let h=-1,d=-c;return this.legendItems.forEach(((t,p)=>{const f=i+e/2+r.measureText(t.text).width;(0===p||l[l.length-1]+f+2*s>o)&&(u+=c,l[l.length-(p>0?0:1)]=0,d+=c,h++),a[p]={left:0,top:d,row:h,width:f,height:n},l[l.length-1]+=f+s})),u}_fitCols(t,e,i,n){const{ctx:r,maxHeight:o,options:{labels:{padding:s}}}=this,a=this.legendHitBoxes=[],l=this.columnSizes=[],c=o-t;let u=s,h=0,d=0,p=0,f=0;return this.legendItems.forEach(((t,o)=>{const{itemWidth:m,itemHeight:g}=function(t,e,i,n,r){const o=function(t,e,i,n){let r=t.text;return r&&"string"!=typeof r&&(r=r.reduce(((t,e)=>t.length>e.length?t:e))),e+i.size/2+n.measureText(r).width}(n,t,e,i),s=function(t,e,i){let n=t;return"string"!=typeof e.text&&(n=CM(e,i)),n}(r,n,e.lineHeight);return{itemWidth:o,itemHeight:s}}(i,e,r,t,n);o>0&&d+g+2*s>c&&(u+=h+s,l.push({width:h,height:d}),p+=h+s,f++,h=d=0),a[o]={left:p,top:d,col:f,width:m,height:g},h=Math.max(h,m),d+=g+s})),u+=h,l.push({width:h,height:d}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:n},rtl:r}}=this,o=AE(r,this.left,this.width);if(this.isHorizontal()){let r=0,s=tw(i,this.left+n,this.right-this.lineWidths[r]);for(const a of e)r!==a.row&&(r=a.row,s=tw(i,this.left+n,this.right-this.lineWidths[r])),a.top+=this.top+t+n,a.left=o.leftForLtr(o.x(s),a.width),s+=a.width+n}else{let r=0,s=tw(i,this.top+t+n,this.bottom-this.columnSizes[r].height);for(const a of e)a.col!==r&&(r=a.col,s=tw(i,this.top+t+n,this.bottom-this.columnSizes[r].height)),a.top=s,a.left+=this.left+n,a.left=o.leftForLtr(o.x(a.left),a.width),s+=a.height+n}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const t=this.ctx;Aw(t,this),this._draw(),Pw(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:n}=this,{align:r,labels:o}=t,s=bw.color,a=AE(t.rtl,this.left,this.width),l=Ww(o.font),{padding:c}=o,u=l.size,h=u/2;let d;this.drawTitle(),n.textAlign=a.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=l.string;const{boxWidth:p,boxHeight:f,itemHeight:m}=MM(o,u),g=this.isHorizontal(),_=this._computeTitleHeight();d=g?{x:tw(r,this.left+c,this.right-i[0]),y:this.top+c+_,line:0}:{x:this.left+c,y:tw(r,this.top+_+c,this.bottom-e[0].height),line:0},PE(this.ctx,t.textDirection);const y=m+c;this.legendItems.forEach(((v,x)=>{n.strokeStyle=v.fontColor,n.fillStyle=v.fontColor;const b=n.measureText(v.text).width,w=a.textAlign(v.textAlign||(v.textAlign=o.textAlign)),E=p+h+b;let S=d.x,T=d.y;if(a.setWidth(this.width),g?x>0&&S+E+c>this.right&&(T=d.y+=y,d.line++,S=d.x=tw(r,this.left+c,this.right-i[d.line])):x>0&&T+y>this.bottom&&(S=d.x=S+e[d.line].width+c,d.line++,T=d.y=tw(r,this.top+_+c,this.bottom-e[d.line].height)),function(t,e,i){if(isNaN(p)||p<=0||isNaN(f)||f<0)return;n.save();const r=rb(i.lineWidth,1);if(n.fillStyle=rb(i.fillStyle,s),n.lineCap=rb(i.lineCap,"butt"),n.lineDashOffset=rb(i.lineDashOffset,0),n.lineJoin=rb(i.lineJoin,"miter"),n.lineWidth=r,n.strokeStyle=rb(i.strokeStyle,s),n.setLineDash(rb(i.lineDash,[])),o.usePointStyle){const s={radius:f*Math.SQRT2/2,pointStyle:i.pointStyle,rotation:i.rotation,borderWidth:r},l=a.xPlus(t,p/2);Iw(n,s,l,e+h,o.pointStyleWidth&&p)}else{const o=e+Math.max((u-f)/2,0),s=a.leftForLtr(t,p),l=Gw(i.borderRadius);n.beginPath(),Object.values(l).some((t=>0!==t))?Ow(n,{x:s,y:o,w:p,h:f,radius:l}):n.rect(s,o,p,f),n.fill(),0!==r&&n.stroke()}n.restore()}(a.x(S),T,v),S=((t,e,i,n)=>t===(n?"left":"right")?i:"center"===t?(e+i)/2:e)(w,S+p+h,g?S+E:this.right,t.rtl),function(t,e,i){Nw(n,i.text,t,e+m/2,l,{strikethrough:i.hidden,textAlign:a.textAlign(i.textAlign)})}(a.x(S),T,v),g)d.x+=E+c;else if("string"!=typeof v.text){const t=l.lineHeight;d.y+=CM(v,t)+c}else d.y+=y})),LE(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=Ww(e.font),n=Hw(e.padding);if(!e.display)return;const r=AE(t.rtl,this.left,this.width),o=this.ctx,s=e.position,a=i.size/2,l=n.top+a;let c,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),c=this.top+l,u=tw(t.align,u,this.right-h);else{const e=this.columnSizes.reduce(((t,e)=>Math.max(t,e.height)),0);c=l+tw(t.align,this.top,this.bottom-e-t.labels.padding-this._computeTitleHeight())}const d=tw(s,u,u+h);o.textAlign=r.textAlign(Qb(s)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=i.string,Nw(o,e.text,d,c,i)}_computeTitleHeight(){const t=this.options.title,e=Ww(t.font),i=Hw(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,n,r;if(Hb(t,this.left,this.right)&&Hb(e,this.top,this.bottom))for(r=this.legendHitBoxes,i=0;i<r.length;++i)if(n=r[i],Hb(t,n.left,n.left+n.width)&&Hb(e,n.top,n.top+n.height))return this.legendItems[i];return null}handleEvent(t){const e=this.options;if(!function(t,e){return!("mousemove"!==t&&"mouseout"!==t||!e.onHover&&!e.onLeave)||!(!e.onClick||"click"!==t&&"mouseup"!==t)}(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if("mousemove"===t.type||"mouseout"===t.type){const n=this._hoveredItem,r=((t,e)=>null!==t&&null!==e&&t.datasetIndex===e.datasetIndex&&t.index===e.index)(n,i);n&&!r&&sb(e.onLeave,[t,n,this],this),this._hoveredItem=i,i&&!r&&sb(e.onHover,[t,i,this],this)}else i&&sb(e.onClick,[t,i,this],this)}}function CM(t,e){return e*(t.text?t.text.length:0)}var AM={id:"legend",_element:IM,start(t,e,i){const n=t.legend=new IM({ctx:t.ctx,options:i,chart:t});DS.configure(t,n,i),DS.addBox(t,n)},stop(t){DS.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,i){const n=t.legend;DS.configure(t,n,i),n.options=i},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,i){const n=e.datasetIndex,r=i.chart;r.isDatasetVisible(n)?(r.hide(n),e.hidden=!0):(r.show(n),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:i,pointStyle:n,textAlign:r,color:o,useBorderRadius:s,borderRadius:a}}=t.legend.options;return t._getSortedDatasetMetas().map((t=>{const l=t.controller.getStyle(i?0:void 0),c=Hw(l.borderWidth);return{text:e[t.index].label,fillStyle:l.backgroundColor,fontColor:o,hidden:!t.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(c.width+c.height)/4,strokeStyle:l.borderColor,pointStyle:n||l.pointStyle,rotation:l.rotation,textAlign:r||l.textAlign,borderRadius:s&&(a||l.borderRadius),datasetIndex:t.index}}),this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class PM extends KS{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=t,this.height=this.bottom=e;const n=tb(i.text)?i.text.length:1;this._padding=Hw(i.padding);const r=n*Ww(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return"top"===t||"bottom"===t}_drawArgs(t){const{top:e,left:i,bottom:n,right:r,options:o}=this,s=o.align;let a,l,c,u=0;return this.isHorizontal()?(l=tw(s,i,r),c=e+t,a=r-i):("left"===o.position?(l=i+t,c=tw(s,n,e),u=-.5*bb):(l=r-t,c=tw(s,e,n),u=.5*bb),a=n-e),{titleX:l,titleY:c,maxWidth:a,rotation:u}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=Ww(e.font),n=i.lineHeight/2+this._padding.top,{titleX:r,titleY:o,maxWidth:s,rotation:a}=this._drawArgs(n);Nw(t,e.text,0,0,i,{color:e.color,maxWidth:s,rotation:a,textAlign:Qb(e.align),textBaseline:"middle",translation:[r,o]})}}var LM={id:"title",_element:PM,start(t,e,i){!function(t,e){const i=new PM({ctx:t.ctx,options:e,chart:t});DS.configure(t,i,e),DS.addBox(t,i),t.titleBlock=i}(t,i)},stop(t){const e=t.titleBlock;DS.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,i){const n=t.titleBlock;DS.configure(t,n,i),n.options=i},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const RM=new WeakMap;var DM={id:"subtitle",start(t,e,i){const n=new PM({ctx:t.ctx,options:i,chart:t});DS.configure(t,n,i),DS.addBox(t,n),RM.set(t,n)},stop(t){DS.removeBox(t,RM.get(t)),RM.delete(t)},beforeUpdate(t,e,i){const n=RM.get(t);DS.configure(t,n,i),n.options=i},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const kM={average(t){if(!t.length)return!1;let e,i,n=new Set,r=0,o=0;for(e=0,i=t.length;e<i;++e){const i=t[e].element;if(i&&i.hasValue()){const t=i.tooltipPosition();n.add(t.x),r+=t.y,++o}}const s=[...n].reduce(((t,e)=>t+e))/n.size;return{x:s,y:r/o}},nearest(t,e){if(!t.length)return!1;let i,n,r,o=e.x,s=e.y,a=Number.POSITIVE_INFINITY;for(i=0,n=t.length;i<n;++i){const n=t[i].element;if(n&&n.hasValue()){const t=Bb(e,n.getCenterPoint());t<a&&(a=t,r=n)}}if(r){const t=r.tooltipPosition();o=t.x,s=t.y}return{x:o,y:s}}};function NM(t,e){return e&&(tb(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function OM(t){return("string"==typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function FM(t,e){const{element:i,datasetIndex:n,index:r}=e,o=t.getDatasetMeta(n).controller,{label:s,value:a}=o.getLabelAndValue(r);return{chart:t,label:s,parsed:o.getParsed(r),raw:t.data.datasets[n].data[r],formattedValue:a,dataset:o.getDataset(),dataIndex:r,datasetIndex:n,element:i}}function zM(t,e){const i=t.chart.ctx,{body:n,footer:r,title:o}=t,{boxWidth:s,boxHeight:a}=e,l=Ww(e.bodyFont),c=Ww(e.titleFont),u=Ww(e.footerFont),h=o.length,d=r.length,p=n.length,f=Hw(e.padding);let m=f.height,g=0,_=n.reduce(((t,e)=>t+e.before.length+e.lines.length+e.after.length),0);_+=t.beforeBody.length+t.afterBody.length,h&&(m+=h*c.lineHeight+(h-1)*e.titleSpacing+e.titleMarginBottom),_&&(m+=p*(e.displayColors?Math.max(a,l.lineHeight):l.lineHeight)+(_-p)*l.lineHeight+(_-1)*e.bodySpacing),d&&(m+=e.footerMarginTop+d*u.lineHeight+(d-1)*e.footerSpacing);let y=0;const v=function(t){g=Math.max(g,i.measureText(t).width+y)};return i.save(),i.font=c.string,ab(t.title,v),i.font=l.string,ab(t.beforeBody.concat(t.afterBody),v),y=e.displayColors?s+2+e.boxPadding:0,ab(n,(t=>{ab(t.before,v),ab(t.lines,v),ab(t.after,v)})),y=0,i.font=u.string,ab(t.footer,v),i.restore(),g+=f.width,{width:g,height:m}}function BM(t,e,i,n){const{x:r,width:o}=i,{width:s,chartArea:{left:a,right:l}}=t;let c="center";return"center"===n?c=r<=(a+l)/2?"left":"right":r<=o/2?c="left":r>=s-o/2&&(c="right"),function(t,e,i,n){const{x:r,width:o}=n,s=i.caretSize+i.caretPadding;return"left"===t&&r+o+s>e.width||"right"===t&&r-o-s<0||void 0}(c,t,e,i)&&(c="center"),c}function UM(t,e,i){const n=i.yAlign||e.yAlign||function(t,e){const{y:i,height:n}=e;return i<n/2?"top":i>t.height-n/2?"bottom":"center"}(t,i);return{xAlign:i.xAlign||e.xAlign||BM(t,e,i,n),yAlign:n}}function VM(t,e,i,n){const{caretSize:r,caretPadding:o,cornerRadius:s}=t,{xAlign:a,yAlign:l}=i,c=r+o,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=Gw(s);let f=function(t,e){let{x:i,width:n}=t;return"right"===e?i-=n:"center"===e&&(i-=n/2),i}(e,a);const m=function(t,e,i){let{y:n,height:r}=t;return"top"===e?n+=i:n-="bottom"===e?r+i:r/2,n}(e,l,c);return"center"===l?"left"===a?f+=c:"right"===a&&(f-=c):"left"===a?f-=Math.max(u,d)+r:"right"===a&&(f+=Math.max(h,p)+r),{x:Gb(f,0,n.width-e.width),y:Gb(m,0,n.height-e.height)}}function jM(t,e,i){const n=Hw(i.padding);return"center"===e?t.x+t.width/2:"right"===e?t.x+t.width-n.right:t.x+n.left}function GM(t){return NM([],OM(t))}function HM(t,e){const i=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return i?t.override(i):t}const WM={beforeTitle:Kx,title(t){if(t.length>0){const e=t[0],i=e.chart.data.labels,n=i?i.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(n>0&&e.dataIndex<n)return i[e.dataIndex]}return""},afterTitle:Kx,beforeBody:Kx,beforeLabel:Kx,label(t){if(this&&this.options&&"dataset"===this.options.mode)return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const i=t.formattedValue;return Qx(i)||(e+=i),e},labelColor(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Kx,afterBody:Kx,beforeFooter:Kx,footer:Kx,afterFooter:Kx};function qM(t,e,i,n){const r=t[e].call(i,n);return void 0===r?WM[e].call(i,n):r}class XM extends KS{static positioners=kM;constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),n=i.enabled&&e.options.animation&&i.animations,r=new GE(this.chart,n);return n._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=function(t,e,i){return Xw(t,{tooltip:e,tooltipItems:i,type:"tooltip"})}(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:i}=e,n=qM(i,"beforeTitle",this,t),r=qM(i,"title",this,t),o=qM(i,"afterTitle",this,t);let s=[];return s=NM(s,OM(n)),s=NM(s,OM(r)),s=NM(s,OM(o)),s}getBeforeBody(t,e){return GM(qM(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:i}=e,n=[];return ab(t,(t=>{const e={before:[],lines:[],after:[]},r=HM(i,t);NM(e.before,OM(qM(r,"beforeLabel",this,t))),NM(e.lines,qM(r,"label",this,t)),NM(e.after,OM(qM(r,"afterLabel",this,t))),n.push(e)})),n}getAfterBody(t,e){return GM(qM(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:i}=e,n=qM(i,"beforeFooter",this,t),r=qM(i,"footer",this,t),o=qM(i,"afterFooter",this,t);let s=[];return s=NM(s,OM(n)),s=NM(s,OM(r)),s=NM(s,OM(o)),s}_createItems(t){const e=this._active,i=this.chart.data,n=[],r=[],o=[];let s,a,l=[];for(s=0,a=e.length;s<a;++s)l.push(FM(this.chart,e[s]));return t.filter&&(l=l.filter(((e,n,r)=>t.filter(e,n,r,i)))),t.itemSort&&(l=l.sort(((e,n)=>t.itemSort(e,n,i)))),ab(l,(e=>{const i=HM(t.callbacks,e);n.push(qM(i,"labelColor",this,e)),r.push(qM(i,"labelPointStyle",this,e)),o.push(qM(i,"labelTextColor",this,e))})),this.labelColors=n,this.labelPointStyles=r,this.labelTextColors=o,this.dataPoints=l,l}update(t,e){const i=this.options.setContext(this.getContext()),n=this._active;let r,o=[];if(n.length){const t=kM[i.position].call(this,n,this._eventPosition);o=this._createItems(i),this.title=this.getTitle(o,i),this.beforeBody=this.getBeforeBody(o,i),this.body=this.getBody(o,i),this.afterBody=this.getAfterBody(o,i),this.footer=this.getFooter(o,i);const e=this._size=zM(this,i),s=Object.assign({},t,e),a=UM(this.chart,i,s),l=VM(i,s,a,this.chart);this.xAlign=a.xAlign,this.yAlign=a.yAlign,r={opacity:1,x:l.x,y:l.y,width:e.width,height:e.height,caretX:t.x,caretY:t.y}}else 0!==this.opacity&&(r={opacity:0});this._tooltipItems=o,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,n){const r=this.getCaretPosition(t,i,n);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,i){const{xAlign:n,yAlign:r}=this,{caretSize:o,cornerRadius:s}=i,{topLeft:a,topRight:l,bottomLeft:c,bottomRight:u}=Gw(s),{x:h,y:d}=t,{width:p,height:f}=e;let m,g,_,y,v,x;return"center"===r?(v=d+f/2,"left"===n?(m=h,g=m-o,y=v+o,x=v-o):(m=h+p,g=m+o,y=v-o,x=v+o),_=m):(g="left"===n?h+Math.max(a,c)+o:"right"===n?h+p-Math.max(l,u)-o:this.caretX,"top"===r?(y=d,v=y-o,m=g-o,_=g+o):(y=d+f,v=y+o,m=g+o,_=g-o),x=y),{x1:m,x2:g,x3:_,y1:y,y2:v,y3:x}}drawTitle(t,e,i){const n=this.title,r=n.length;let o,s,a;if(r){const l=AE(i.rtl,this.x,this.width);for(t.x=jM(this,i.titleAlign,i),e.textAlign=l.textAlign(i.titleAlign),e.textBaseline="middle",o=Ww(i.titleFont),s=i.titleSpacing,e.fillStyle=i.titleColor,e.font=o.string,a=0;a<r;++a)e.fillText(n[a],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+s,a+1===r&&(t.y+=i.titleMarginBottom-s)}}_drawColorBox(t,e,i,n,r){const o=this.labelColors[i],s=this.labelPointStyles[i],{boxHeight:a,boxWidth:l}=r,c=Ww(r.bodyFont),u=jM(this,"left",r),h=n.x(u),d=a<c.lineHeight?(c.lineHeight-a)/2:0,p=e.y+d;if(r.usePointStyle){const e={radius:Math.min(l,a)/2,pointStyle:s.pointStyle,rotation:s.rotation,borderWidth:1},i=n.leftForLtr(h,l)+l/2,c=p+a/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,Mw(t,e,i,c),t.strokeStyle=o.borderColor,t.fillStyle=o.backgroundColor,Mw(t,e,i,c)}else{t.lineWidth=eb(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,t.strokeStyle=o.borderColor,t.setLineDash(o.borderDash||[]),t.lineDashOffset=o.borderDashOffset||0;const e=n.leftForLtr(h,l),i=n.leftForLtr(n.xPlus(h,1),l-2),s=Gw(o.borderRadius);Object.values(s).some((t=>0!==t))?(t.beginPath(),t.fillStyle=r.multiKeyBackground,Ow(t,{x:e,y:p,w:l,h:a,radius:s}),t.fill(),t.stroke(),t.fillStyle=o.backgroundColor,t.beginPath(),Ow(t,{x:i,y:p+1,w:l-2,h:a-2,radius:s}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(e,p,l,a),t.strokeRect(e,p,l,a),t.fillStyle=o.backgroundColor,t.fillRect(i,p+1,l-2,a-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:n}=this,{bodySpacing:r,bodyAlign:o,displayColors:s,boxHeight:a,boxWidth:l,boxPadding:c}=i,u=Ww(i.bodyFont);let h=u.lineHeight,d=0;const p=AE(i.rtl,this.x,this.width),f=function(i){e.fillText(i,p.x(t.x+d),t.y+h/2),t.y+=h+r},m=p.textAlign(o);let g,_,y,v,x,b,w;for(e.textAlign=o,e.textBaseline="middle",e.font=u.string,t.x=jM(this,m,i),e.fillStyle=i.bodyColor,ab(this.beforeBody,f),d=s&&"right"!==m?"center"===o?l/2+c:l+2+c:0,v=0,b=n.length;v<b;++v){for(g=n[v],_=this.labelTextColors[v],e.fillStyle=_,ab(g.before,f),y=g.lines,s&&y.length&&(this._drawColorBox(e,t,v,p,i),h=Math.max(u.lineHeight,a)),x=0,w=y.length;x<w;++x)f(y[x]),h=u.lineHeight;ab(g.after,f)}d=0,h=u.lineHeight,ab(this.afterBody,f),t.y-=r}drawFooter(t,e,i){const n=this.footer,r=n.length;let o,s;if(r){const a=AE(i.rtl,this.x,this.width);for(t.x=jM(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=a.textAlign(i.footerAlign),e.textBaseline="middle",o=Ww(i.footerFont),e.fillStyle=i.footerColor,e.font=o.string,s=0;s<r;++s)e.fillText(n[s],a.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+i.footerSpacing}}drawBackground(t,e,i,n){const{xAlign:r,yAlign:o}=this,{x:s,y:a}=t,{width:l,height:c}=i,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=Gw(n.cornerRadius);e.fillStyle=n.backgroundColor,e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.beginPath(),e.moveTo(s+u,a),"top"===o&&this.drawCaret(t,e,i,n),e.lineTo(s+l-h,a),e.quadraticCurveTo(s+l,a,s+l,a+h),"center"===o&&"right"===r&&this.drawCaret(t,e,i,n),e.lineTo(s+l,a+c-p),e.quadraticCurveTo(s+l,a+c,s+l-p,a+c),"bottom"===o&&this.drawCaret(t,e,i,n),e.lineTo(s+d,a+c),e.quadraticCurveTo(s,a+c,s,a+c-d),"center"===o&&"left"===r&&this.drawCaret(t,e,i,n),e.lineTo(s,a+u),e.quadraticCurveTo(s,a,s+u,a),e.closePath(),e.fill(),n.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,n=i&&i.x,r=i&&i.y;if(n||r){const i=kM[t.position].call(this,this._active,this._eventPosition);if(!i)return;const o=this._size=zM(this,t),s=Object.assign({},i,this._size),a=UM(e,t,s),l=VM(t,s,a,e);n._to===l.x&&r._to===l.y||(this.xAlign=a.xAlign,this.yAlign=a.yAlign,this.width=o.width,this.height=o.height,this.caretX=i.x,this.caretY=i.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const n={width:this.width,height:this.height},r={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const o=Hw(e.padding),s=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&s&&(t.save(),t.globalAlpha=i,this.drawBackground(r,t,n,e),PE(t,e.textDirection),r.y+=o.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),LE(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,n=t.map((({datasetIndex:t,index:e})=>{const i=this.chart.getDatasetMeta(t);if(!i)throw new Error("Cannot find a dataset at index "+t);return{datasetIndex:t,element:i.data[e],index:e}})),r=!lb(i,n),o=this._positionChanged(n,e);(r||o)&&(this._active=n,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const n=this.options,r=this._active||[],o=this._getActiveElements(t,r,e,i),s=this._positionChanged(o,t),a=e||!lb(o,r)||s;return a&&(this._active=o,(n.enabled||n.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),a}_getActiveElements(t,e,i,n){const r=this.options;if("mouseout"===t.type)return[];if(!n)return e.filter((t=>this.chart.data.datasets[t.datasetIndex]&&void 0!==this.chart.getDatasetMeta(t.datasetIndex).controller.getParsed(t.index)));const o=this.chart.getElementsAtEventForMode(t,r.mode,r,i);return r.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:i,caretY:n,options:r}=this,o=kM[r.position].call(this,t,e);return!1!==o&&(i!==o.x||n!==o.y)}}var $M={id:"tooltip",_element:XM,positioners:kM,afterInit(t,e,i){i&&(t.tooltip=new XM({chart:t,options:i}))},beforeUpdate(t,e,i){t.tooltip&&t.tooltip.initialize(i)},reset(t,e,i){t.tooltip&&t.tooltip.initialize(i)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const i={tooltip:e};if(!1===t.notifyPlugins("beforeTooltipDraw",{...i,cancelable:!0}))return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",i)}},afterEvent(t,e){if(t.tooltip){const i=e.replay;t.tooltip.handleEvent(e.event,i,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:WM},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>"filter"!==t&&"itemSort"!==t&&"external"!==t,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},YM=Object.freeze({__proto__:null,Colors:sM,Decimation:cM,Filler:TM,Legend:AM,SubTitle:DM,Title:LM,Tooltip:$M});function ZM(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}function KM(t,e,{horizontal:i,minRotation:n}){const r=Nb(n),o=(i?Math.sin(r):Math.cos(r))||.001,s=.75*e*(""+t).length;return Math.min(e/o,s)}class JM extends sT{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return Qx(t)||("number"==typeof t||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:n,max:r}=this;const o=t=>n=e?n:t,s=t=>r=i?r:t;if(t){const t=Pb(n),e=Pb(r);t<0&&e<0?s(0):t>0&&e>0&&o(0)}if(n===r){let e=0===r?1:Math.abs(.05*r);s(r+e),t||o(n-e)}this.min=n,this.max=r}getTickLimit(){const t=this.options.ticks;let e,{maxTicksLimit:i,stepSize:n}=t;return n?(e=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,e>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${e} ticks. Limiting to 1000.`),e=1e3)):(e=this.computeTickLimit(),i=i||11),i&&(e=Math.min(i,e)),e}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const n=function(t,e){const i=[],{bounds:n,step:r,min:o,max:s,precision:a,count:l,maxTicks:c,maxDigits:u,includeBounds:h}=t,d=r||1,p=c-1,{min:f,max:m}=e,g=!Qx(o),_=!Qx(s),y=!Qx(l),v=(m-f)/(u+1);let x,b,w,E,S=Rb((m-f)/p/d)*d;if(S<1e-14&&!g&&!_)return[{value:f},{value:m}];E=Math.ceil(m/S)-Math.floor(f/S),E>p&&(S=Rb(E*S/p/d)*d),Qx(a)||(x=Math.pow(10,a),S=Math.ceil(S*x)/x),"ticks"===n?(b=Math.floor(f/S)*S,w=Math.ceil(m/S)*S):(b=f,w=m),g&&_&&r&&function(t,e){const i=Math.round(t);return i-e<=t&&i+e>=t}((s-o)/r,S/1e3)?(E=Math.round(Math.min((s-o)/S,c)),S=(s-o)/E,b=o,w=s):y?(b=g?o:b,w=_?s:w,E=l-1,S=(w-b)/E):(E=(w-b)/S,E=Lb(E,Math.round(E),S/1e3)?Math.round(E):Math.ceil(E));const T=Math.max(Fb(S),Fb(b));x=Math.pow(10,Qx(a)?T:a),b=Math.round(b*x)/x,w=Math.round(w*x)/x;let M=0;for(g&&(h&&b!==o?(i.push({value:o}),b<o&&M++,Lb(Math.round((b+M*S)*x)/x,o,KM(o,v,t))&&M++):b<o&&M++);M<E;++M){const t=Math.round((b+M*S)*x)/x;if(_&&t>s)break;i.push({value:t})}return _&&h&&w!==s?i.length&&Lb(i[i.length-1].value,s,KM(s,v,t))?i[i.length-1].value=s:i.push({value:s}):_&&w!==s||i.push({value:w}),i}({maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:!1!==e.includeBounds},this._range||this);return"ticks"===t.bounds&&kb(n,this,"value"),t.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const n=(i-e)/Math.max(t.length-1,1)/2;e-=n,i+=n}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return pw(t,this.chart.options.locale,this.options.ticks.format)}}class QM extends JM{static id="linear";static defaults={ticks:{callback:mw.formatters.numeric}};determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=ib(t)?t:0,this.max=ib(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=Nb(this.options.ticks.minRotation),n=(t?Math.sin(i):Math.cos(i))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/n))}getPixelForValue(t){return null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}const tI=t=>Math.floor(Ab(t)),eI=(t,e)=>Math.pow(10,tI(t)+e);function iI(t){return 1==t/Math.pow(10,tI(t))}function nI(t,e,i){const n=Math.pow(10,i),r=Math.floor(t/n);return Math.ceil(e/n)-r}class rI extends sT{static id="logarithmic";static defaults={ticks:{callback:mw.formatters.logarithmic,major:{enabled:!0}}};constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=JM.prototype.parse.apply(this,[t,e]);if(0!==i)return ib(i)&&i>0?i:null;this._zero=!0}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=ib(t)?Math.max(0,t):null,this.max=ib(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!ib(this._userMin)&&(this.min=t===eI(this.min,0)?eI(this.min,-1):eI(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,n=this.max;const r=e=>i=t?i:e,o=t=>n=e?n:t;i===n&&(i<=0?(r(1),o(10)):(r(eI(i,-1)),o(eI(n,1)))),i<=0&&r(eI(n,-1)),n<=0&&o(eI(i,1)),this.min=i,this.max=n}buildTicks(){const t=this.options,e=function(t,{min:e,max:i}){e=nb(t.min,e);const n=[],r=tI(e);let o=function(t,e){let i=tI(e-t);for(;nI(t,e,i)>10;)i++;for(;nI(t,e,i)<10;)i--;return Math.min(i,tI(t))}(e,i),s=o<0?Math.pow(10,Math.abs(o)):1;const a=Math.pow(10,o),l=r>o?Math.pow(10,r):0,c=Math.round((e-l)*s)/s,u=Math.floor((e-l)/a/10)*a*10;let h=Math.floor((c-u)/Math.pow(10,o)),d=nb(t.min,Math.round((l+u+h*Math.pow(10,o))*s)/s);for(;d<i;)n.push({value:d,major:iI(d),significand:h}),h>=10?h=h<15?15:20:h++,h>=20&&(o++,h=2,s=o>=0?1:s),d=Math.round((l+u+h*Math.pow(10,o))*s)/s;const p=nb(t.max,d);return n.push({value:p,major:iI(p),significand:h}),n}({min:this._userMin,max:this._userMax},this);return"ticks"===t.bounds&&kb(e,this,"value"),t.reverse?(e.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),e}getLabelForValue(t){return void 0===t?"0":pw(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=Ab(t),this._valueRange=Ab(this.max)-Ab(t)}getPixelForValue(t){return void 0!==t&&0!==t||(t=this.min),null===t||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(Ab(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function oI(t){const e=t.ticks;if(e.display&&t.display){const t=Hw(e.backdropPadding);return rb(e.font&&e.font.size,bw.font.size)+t.height}return 0}function sI(t,e,i,n,r){return t===n||t===r?{start:e-i/2,end:e+i/2}:t<n||t>r?{start:e-i,end:e}:{start:e,end:e+i}}function aI(t,e,i,n,r){const o=Math.abs(Math.sin(i)),s=Math.abs(Math.cos(i));let a=0,l=0;n.start<e.l?(a=(e.l-n.start)/o,t.l=Math.min(t.l,e.l-a)):n.end>e.r&&(a=(n.end-e.r)/o,t.r=Math.max(t.r,e.r+a)),r.start<e.t?(l=(e.t-r.start)/s,t.t=Math.min(t.t,e.t-l)):r.end>e.b&&(l=(r.end-e.b)/s,t.b=Math.max(t.b,e.b+l))}function lI(t,e,i){const n=t.drawingArea,{extra:r,additionalAngle:o,padding:s,size:a}=i,l=t.getPointPosition(e,n+r+s,o),c=Math.round(Ob(Vb(l.angle+Mb))),u=function(t,e,i){return 90===i||270===i?t-=e/2:(i>270||i<90)&&(t-=e),t}(l.y,a.h,c),h=function(t){return 0===t||180===t?"center":t<180?"left":"right"}(c),d=function(t,e,i){return"right"===i?t-=e:"center"===i&&(t-=e/2),t}(l.x,a.w,h);return{visible:!0,x:l.x,y:u,textAlign:h,left:d,top:u,right:d+a.w,bottom:u+a.h}}function cI(t,e){if(!e)return!0;const{left:i,top:n,right:r,bottom:o}=t;return!(Cw({x:i,y:n},e)||Cw({x:i,y:o},e)||Cw({x:r,y:n},e)||Cw({x:r,y:o},e))}function uI(t,e,i){const{left:n,top:r,right:o,bottom:s}=i,{backdropColor:a}=e;if(!Qx(a)){const i=Gw(e.borderRadius),l=Hw(e.backdropPadding);t.fillStyle=a;const c=n-l.left,u=r-l.top,h=o-n+l.width,d=s-r+l.height;Object.values(i).some((t=>0!==t))?(t.beginPath(),Ow(t,{x:c,y:u,w:h,h:d,radius:i}),t.fill()):t.fillRect(c,u,h,d)}}function hI(t,e,i,n){const{ctx:r}=t;if(i)r.arc(t.xCenter,t.yCenter,e,0,wb);else{let i=t.getPointPosition(0,e);r.moveTo(i.x,i.y);for(let o=1;o<n;o++)i=t.getPointPosition(o,e),r.lineTo(i.x,i.y)}}class dI extends JM{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:mw.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:t=>t,padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=Hw(oI(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=ib(t)&&!isNaN(t)?t:0,this.max=ib(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/oI(this.options))}generateTickLabels(t){JM.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map(((t,e)=>{const i=sb(this.options.pointLabels.callback,[t,e],this);return i||0===i?i:""})).filter(((t,e)=>this.chart.getDataVisibility(e)))}fit(){const t=this.options;t.display&&t.pointLabels.display?function(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},i=Object.assign({},e),n=[],r=[],o=t._pointLabels.length,s=t.options.pointLabels,a=s.centerPointLabels?bb/o:0;for(let h=0;h<o;h++){const o=s.setContext(t.getPointLabelContext(h));r[h]=o.padding;const d=t.getPointPosition(h,t.drawingArea+r[h],a),p=Ww(o.font),f=(l=t.ctx,c=p,u=tb(u=t._pointLabels[h])?u:[u],{w:Ew(l,c.string,u),h:u.length*c.lineHeight});n[h]=f;const m=Vb(t.getIndexAngle(h)+a),g=Math.round(Ob(m));aI(i,e,m,sI(g,d.x,f.w,0,180),sI(g,d.y,f.h,90,270))}var l,c,u;t.setCenterPoint(e.l-i.l,i.r-e.r,e.t-i.t,i.b-e.b),t._pointLabelItems=function(t,e,i){const n=[],r=t._pointLabels.length,o=t.options,{centerPointLabels:s,display:a}=o.pointLabels,l={extra:oI(o)/2,additionalAngle:s?bb/r:0};let c;for(let o=0;o<r;o++){l.padding=i[o],l.size=e[o];const r=lI(t,o,l);n.push(r),"auto"===a&&(r.visible=cI(r,c),r.visible&&(c=r))}return n}(t,n,r)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,n){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-n)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,n))}getIndexAngle(t){return Vb(t*(wb/(this._pointLabels.length||1))+Nb(this.options.startAngle||0))}getDistanceFromCenterForValue(t){if(Qx(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(Qx(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return function(t,e,i){return Xw(t,{label:i,index:e,type:"pointLabel"})}(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const n=this.getIndexAngle(t)-Mb+i;return{x:Math.cos(n)*e+this.xCenter,y:Math.sin(n)*e+this.yCenter,angle:n}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:n,bottom:r}=this._pointLabelItems[t];return{left:e,top:i,right:n,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),hI(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:i,grid:n,border:r}=e,o=this._pointLabels.length;let s,a,l;if(e.pointLabels.display&&function(t,e){const{ctx:i,options:{pointLabels:n}}=t;for(let r=e-1;r>=0;r--){const e=t._pointLabelItems[r];if(!e.visible)continue;const o=n.setContext(t.getPointLabelContext(r));uI(i,o,e);const s=Ww(o.font),{x:a,y:l,textAlign:c}=e;Nw(i,t._pointLabels[r],a,l+s.lineHeight/2,s,{color:o.color,textAlign:c,textBaseline:"middle"})}}(this,o),n.display&&this.ticks.forEach(((t,e)=>{if(0!==e||0===e&&this.min<0){a=this.getDistanceFromCenterForValue(t.value);const i=this.getContext(e),s=n.setContext(i),l=r.setContext(i);!function(t,e,i,n,r){const o=t.ctx,s=e.circular,{color:a,lineWidth:l}=e;!s&&!n||!a||!l||i<0||(o.save(),o.strokeStyle=a,o.lineWidth=l,o.setLineDash(r.dash),o.lineDashOffset=r.dashOffset,o.beginPath(),hI(t,i,s,n),o.closePath(),o.stroke(),o.restore())}(this,s,a,o,l)}})),i.display){for(t.save(),s=o-1;s>=0;s--){const n=i.setContext(this.getPointLabelContext(s)),{color:r,lineWidth:o}=n;o&&r&&(t.lineWidth=o,t.strokeStyle=r,t.setLineDash(n.borderDash),t.lineDashOffset=n.borderDashOffset,a=this.getDistanceFromCenterForValue(e.ticks.reverse?this.min:this.max),l=this.getPointPosition(s,a),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(l.x,l.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const n=this.getIndexAngle(0);let r,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(n),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach(((n,s)=>{if(0===s&&this.min>=0&&!e.reverse)return;const a=i.setContext(this.getContext(s)),l=Ww(a.font);if(r=this.getDistanceFromCenterForValue(this.ticks[s].value),a.showLabelBackdrop){t.font=l.string,o=t.measureText(n.label).width,t.fillStyle=a.backdropColor;const e=Hw(a.backdropPadding);t.fillRect(-o/2-e.left,-r-l.size/2-e.top,o+e.width,l.size+e.height)}Nw(t,n.label,0,-r,l,{color:a.color,strokeColor:a.textStrokeColor,strokeWidth:a.textStrokeWidth})})),t.restore()}drawTitle(){}}const pI={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},fI=Object.keys(pI);function mI(t,e){return t-e}function gI(t,e){if(Qx(e))return null;const i=t._adapter,{parser:n,round:r,isoWeekday:o}=t._parseOpts;let s=e;return"function"==typeof n&&(s=n(s)),ib(s)||(s="string"==typeof n?i.parse(s,n):i.parse(s)),null===s?null:(r&&(s="week"!==r||!Db(o)&&!0!==o?i.startOf(s,r):i.startOf(s,"isoWeek",o)),+s)}function _I(t,e,i,n){const r=fI.length;for(let o=fI.indexOf(t);o<r-1;++o){const t=pI[fI[o]],r=t.steps?t.steps:Number.MAX_SAFE_INTEGER;if(t.common&&Math.ceil((i-e)/(r*t.size))<=n)return fI[o]}return fI[r-1]}function yI(t,e,i){if(i){if(i.length){const{lo:n,hi:r}=Wb(i,e);t[i[n]>=e?i[n]:i[r]]=!0}}else t[e]=!0}function vI(t,e,i){const n=[],r={},o=e.length;let s,a;for(s=0;s<o;++s)a=e[s],r[a]=s,n.push({value:a,major:!1});return 0!==o&&i?function(t,e,i,n){const r=t._adapter,o=+r.startOf(e[0].value,n),s=e[e.length-1].value;let a,l;for(a=o;a<=s;a=+r.add(a,1,n))l=i[a],l>=0&&(e[l].major=!0);return e}(t,n,r,i):n}class xI extends sT{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const i=t.time||(t.time={}),n=this._adapter=new mS(t.adapters.date);n.init(e),pb(i.displayFormats,n.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return void 0===t?null:gI(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:n,max:r,minDefined:o,maxDefined:s}=this.getUserBounds();function a(t){o||isNaN(t.min)||(n=Math.min(n,t.min)),s||isNaN(t.max)||(r=Math.max(r,t.max))}o&&s||(a(this._getLabelBounds()),"ticks"===t.bounds&&"labels"===t.ticks.source||a(this.getMinMax(!1))),n=ib(n)&&!isNaN(n)?n:+e.startOf(Date.now(),i),r=ib(r)&&!isNaN(r)?r:+e.endOf(Date.now(),i)+1,this.min=Math.min(n,r-1),this.max=Math.max(n+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,n="labels"===i.source?this.getLabelTimestamps():this._generate();"ticks"===t.bounds&&n.length&&(this.min=this._userMin||n[0],this.max=this._userMax||n[n.length-1]);const r=this.min,o=function(t,e,i){let n=0,r=t.length;for(;n<r&&t[n]<e;)n++;for(;r>n&&t[r-1]>i;)r--;return n>0||r<t.length?t.slice(n,r):t}(n,r,this.max);return this._unit=e.unit||(i.autoSkip?_I(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):function(t,e,i,n,r){for(let o=fI.length-1;o>=fI.indexOf(i);o--){const i=fI[o];if(pI[i].common&&t._adapter.diff(r,n,i)>=e-1)return i}return fI[i?fI.indexOf(i):0]}(this,o.length,e.minUnit,this.min,this.max)),this._majorUnit=i.major.enabled&&"year"!==this._unit?function(t){for(let e=fI.indexOf(t)+1,i=fI.length;e<i;++e)if(pI[fI[e]].common)return fI[e]}(this._unit):void 0,this.initOffsets(n),t.reverse&&o.reverse(),vI(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map((t=>+t.value)))}initOffsets(t=[]){let e,i,n=0,r=0;this.options.offset&&t.length&&(e=this.getDecimalForValue(t[0]),n=1===t.length?1-e:(this.getDecimalForValue(t[1])-e)/2,i=this.getDecimalForValue(t[t.length-1]),r=1===t.length?i:(i-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;n=Gb(n,0,o),r=Gb(r,0,o),this._offsets={start:n,end:r,factor:1/(n+1+r)}}_generate(){const t=this._adapter,e=this.min,i=this.max,n=this.options,r=n.time,o=r.unit||_I(r.minUnit,e,i,this._getLabelCapacity(e)),s=rb(n.ticks.stepSize,1),a="week"===o&&r.isoWeekday,l=Db(a)||!0===a,c={};let u,h,d=e;if(l&&(d=+t.startOf(d,"isoWeek",a)),d=+t.startOf(d,l?"day":o),t.diff(i,e,o)>1e5*s)throw new Error(e+" and "+i+" are too far apart with stepSize of "+s+" "+o);const p="data"===n.ticks.source&&this.getDataTimestamps();for(u=d,h=0;u<i;u=+t.add(u,s,o),h++)yI(c,u,p);return u!==i&&"ticks"!==n.bounds&&1!==h||yI(c,u,p),Object.keys(c).sort(mI).map((t=>+t))}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}format(t,e){const i=this.options.time.displayFormats,n=this._unit,r=e||i[n];return this._adapter.format(t,r)}_tickFormatFunction(t,e,i,n){const r=this.options,o=r.ticks.callback;if(o)return sb(o,[t,e,i],this);const s=r.time.displayFormats,a=this._unit,l=this._majorUnit,c=a&&s[a],u=l&&s[l],h=i[e],d=l&&u&&h&&h.major;return this._adapter.format(t,n||(d?u:c))}generateTickLabels(t){let e,i,n;for(e=0,i=t.length;e<i;++e)n=t[e],n.label=this._tickFormatFunction(n.value,e,t)}getDecimalForValue(t){return null===t?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,n=Nb(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(n),o=Math.sin(n),s=this._resolveTickFontOptions(0).size;return{w:i*r+s*o,h:i*o+s*r}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,n=i[e.unit]||i.millisecond,r=this._tickFormatFunction(t,0,vI(this,[t],this._majorUnit),n),o=this._getLabelSize(r),s=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return s>0?s:1}getDataTimestamps(){let t,e,i=this._cache.data||[];if(i.length)return i;const n=this.getMatchingVisibleMetas();if(this._normalized&&n.length)return this._cache.data=n[0].controller.getAllParsedValues(this);for(t=0,e=n.length;t<e;++t)i=i.concat(n[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(i)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const n=this.getLabels();for(e=0,i=n.length;e<i;++e)t.push(gI(this,n[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Zb(t.sort(mI))}}function bI(t,e,i){let n,r,o,s,a=0,l=t.length-1;i?(e>=t[a].pos&&e<=t[l].pos&&({lo:a,hi:l}=qb(t,"pos",e)),({pos:n,time:o}=t[a]),({pos:r,time:s}=t[l])):(e>=t[a].time&&e<=t[l].time&&({lo:a,hi:l}=qb(t,"time",e)),({time:n,pos:o}=t[a]),({time:r,pos:s}=t[l]));const c=r-n;return c?o+(s-o)*(e-n)/c:o}var wI=Object.freeze({__proto__:null,CategoryScale:class extends sT{static id="category";static defaults={ticks:{callback:ZM}};constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const t=this.getLabels();for(const{index:i,label:n}of e)t[i]===n&&t.splice(i,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(Qx(t))return null;const i=this.getLabels();return((t,e)=>null===t?null:Gb(Math.round(t),0,e))(e=isFinite(e)&&i[e]===t?e:function(t,e,i,n){const r=t.indexOf(e);return-1===r?((t,e,i,n)=>("string"==typeof e?(i=t.push(e)-1,n.unshift({index:i,label:e})):isNaN(e)&&(i=null),i))(t,e,i,n):r!==t.lastIndexOf(e)?i:r}(i,t,rb(e,t),this._addedLabels),i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:n}=this.getMinMax(!0);"ticks"===this.options.bounds&&(t||(i=0),e||(n=this.getLabels().length-1)),this.min=i,this.max=n}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,n=[];let r=this.getLabels();r=0===t&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let i=t;i<=e;i++)n.push({value:i});return n}getLabelForValue(t){return ZM.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return"number"!=typeof t&&(t=this.parse(t)),null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}},LinearScale:QM,LogarithmicScale:rI,RadialLinearScale:dI,TimeScale:xI,TimeSeriesScale:class extends xI{static id="timeseries";static defaults=xI.defaults;constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=bI(e,this.min),this._tableRange=bI(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,n=[],r=[];let o,s,a,l,c;for(o=0,s=t.length;o<s;++o)l=t[o],l>=e&&l<=i&&n.push(l);if(n.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(o=0,s=n.length;o<s;++o)c=n[o+1],a=n[o-1],l=n[o],Math.round((c+a)/2)!==l&&r.push({time:l,pos:o/(s-1)});return r}_generate(){const t=this.min,e=this.max;let i=super.getDataTimestamps();return i.includes(t)&&i.length||i.splice(0,0,t),i.includes(e)&&1!==i.length||i.push(e),i.sort(((t,e)=>t-e))}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return t=e.length&&i.length?this.normalize(e.concat(i)):e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(bI(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return bI(this._table,i*this._tableRange+this._minPos,!0)}}});const EI=[dS,tM,YM,wI];OT.register(...EI);const SI=OT,TI={type:"doughnut",data:{labels:["Undefined","Full","Partly","Bare"],datasets:[{label:" Deep Learning Prediction",data:[.3,.5,.15,.05],backgroundColor:["#FFAA00","#FFFFFF","#909090","#000000"],hoverOffset:4}]},options:{elements:{point:{borderColor:"rgba(255, 255, 255, 0)",borderWidth:8}},plugins:{legend:{position:"right",labels:{padding:30,boxHeight:20,boxWidth:20,textAlign:"right",usePointStyle:!0,font:{size:14},color:"white"},onClick:function(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update(),function(t){const e=II.indexOf(t);-1!==e?II.splice(e,1):II.push(t),console.log(II),Yz.setFilter("latestLayer",["in","classification"].concat(II)),Yz.setFilter("latestInterpolationLayer",["in","classification"].concat(II))}(e.text)}},maintainAspectRatio:!1,responsive:!0,animation:{animateRotate:!0,animateScale:!0},layout:{padding:20},hoverOffset:20}}};let MI,II=["Full","Bare","Partly","Undefined"];function CI(){document.getElementById("inner-console").clientWidth<420?(TI.options.plugins.legend.position="top",TI.options.plugins.legend.labels.padding=15):(TI.options.plugins.legend.position="right",TI.options.plugins.legend.labels.padding=30,TI.options.plugins.legend.padding=5)}function AI(t){t.data.datasets[0].data=[],t.update(),t.canvas.parentNode.style.display="none"}function PI(t,e){const i=JSON.parse(e),n=[i.Undefined,i.Full,i.Partly,i.Bare],r=(8,n.map((function(t){return parseFloat(t.toFixed(8))})));t.data.datasets[0].data=r,t.update(),t.canvas.parentNode.style.display="flex"}let LI=!1;window.addEventListener("mousedown",(t=>{"console"===t.target.id&&(LI=!0)})),window.addEventListener("mousemove",(()=>{LI&&(CI(),MI.update())})),window.addEventListener("mouseup",(()=>{LI=!1})),CI();const RI="137",DI=0,kI=1,NI=2,OI=1,FI=2,zI=3,BI=0,UI=1,VI=2,jI=0,GI=1,HI=2,WI=3,qI=4,XI=5,$I=100,YI=101,ZI=102,KI=103,JI=104,QI=200,tC=201,eC=202,iC=203,nC=204,rC=205,oC=206,sC=207,aC=208,lC=209,cC=210,uC=0,hC=1,dC=2,pC=3,fC=4,mC=5,gC=6,_C=7,yC=0,vC=1,xC=2,bC=0,wC=1,EC=2,SC=3,TC=4,MC=5,IC=301,CC=302,AC=303,PC=304,LC=306,RC=307,DC=1e3,kC=1001,NC=1002,OC=1003,FC=1004,zC=1005,BC=1006,UC=1007,VC=1008,jC=1009,GC=1010,HC=1011,WC=1012,qC=1013,XC=1014,$C=1015,YC=1016,ZC=1017,KC=1018,JC=1020,QC=1021,tA=1022,eA=1023,iA=1024,nA=1025,rA=1026,oA=1027,sA=1028,aA=1029,lA=1030,cA=1031,uA=1033,hA=33776,dA=33777,pA=33778,fA=33779,mA=35840,gA=35841,_A=35842,yA=35843,vA=36196,xA=37492,bA=37496,wA=37808,EA=37809,SA=37810,TA=37811,MA=37812,IA=37813,CA=37814,AA=37815,PA=37816,LA=37817,RA=37818,DA=37819,kA=37820,NA=37821,OA=36492,FA=2300,zA=2301,BA=2302,UA=2400,VA=2401,jA=2402,GA=3e3,HA=3001,WA=3201,qA=0,XA=1,$A=7680,YA=35044,ZA=35048,KA="300 es",JA=1035;class QA{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}const tP=[];for(let t=0;t<256;t++)tP[t]=(t<16?"0":"")+t.toString(16);const eP=Math.PI/180,iP=180/Math.PI;function nP(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(tP[255&t]+tP[t>>8&255]+tP[t>>16&255]+tP[t>>24&255]+"-"+tP[255&e]+tP[e>>8&255]+"-"+tP[e>>16&15|64]+tP[e>>24&255]+"-"+tP[63&i|128]+tP[i>>8&255]+"-"+tP[i>>16&255]+tP[i>>24&255]+tP[255&n]+tP[n>>8&255]+tP[n>>16&255]+tP[n>>24&255]).toUpperCase()}function rP(t,e,i){return Math.max(e,Math.min(i,t))}function oP(t,e,i){return(1-i)*t+i*e}function sP(t){return!(t&t-1)&&0!==t}function aP(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}class lP{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*i-o*n+t.x,this.y=r*n+o*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}lP.prototype.isVector2=!0;class cP{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,o,s,a,l){const c=this.elements;return c[0]=t,c[1]=n,c[2]=s,c[3]=e,c[4]=r,c[5]=a,c[6]=i,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,o=i[0],s=i[3],a=i[6],l=i[1],c=i[4],u=i[7],h=i[2],d=i[5],p=i[8],f=n[0],m=n[3],g=n[6],_=n[1],y=n[4],v=n[7],x=n[2],b=n[5],w=n[8];return r[0]=o*f+s*_+a*x,r[3]=o*m+s*y+a*b,r[6]=o*g+s*v+a*w,r[1]=l*f+c*_+u*x,r[4]=l*m+c*y+u*b,r[7]=l*g+c*v+u*w,r[2]=h*f+d*_+p*x,r[5]=h*m+d*y+p*b,r[8]=h*g+d*v+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=t[6],l=t[7],c=t[8];return e*o*c-e*s*l-i*r*c+i*s*a+n*r*l-n*o*a}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=c*o-s*l,h=s*a-c*r,d=l*r-o*a,p=e*u+i*h+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=u*f,t[1]=(n*l-c*i)*f,t[2]=(s*i-n*o)*f,t[3]=h*f,t[4]=(c*e-n*a)*f,t[5]=(n*r-s*e)*f,t[6]=d*f,t[7]=(i*a-l*e)*f,t[8]=(o*e-i*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,o,s){const a=Math.cos(r),l=Math.sin(r);return this.set(i*a,i*l,-i*(a*o+l*s)+o+t,-n*l,n*a,-n*(-l*o+a*s)+s+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],o=n[3],s=n[6],a=n[1],l=n[4],c=n[7];return n[0]=e*r+i*a,n[3]=e*o+i*l,n[6]=e*s+i*c,n[1]=-i*r+e*a,n[4]=-i*o+e*l,n[7]=-i*s+e*c,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function uP(t){for(let e=t.length-1;e>=0;--e)if(t[e]>65535)return!0;return!1}function hP(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}cP.prototype.isMatrix3=!0;const dP={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},pP={h:0,s:0,l:0},fP={h:0,s:0,l:0};function mP(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function gP(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function _P(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class yP{constructor(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}setHSL(t,e,i){if(t=(t%1+1)%1,e=rP(e,0,1),i=rP(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=mP(r,n,t+1/3),this.g=mP(r,n,t),this.b=mP(r,n,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const n=i[1],r=i[2];switch(n){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const i=parseFloat(t[1])/360,n=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(i,n,r)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=i[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=dP[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=gP(t.r),this.g=gP(t.g),this.b=gP(t.b),this}copyLinearToSRGB(t){return this.r=_P(t.r),this.g=_P(t.g),this.b=_P(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,i=this.g,n=this.b,r=Math.max(e,i,n),o=Math.min(e,i,n);let s,a;const l=(o+r)/2;if(o===r)s=0,a=0;else{const t=r-o;switch(a=l<=.5?t/(r+o):t/(2-r-o),r){case e:s=(i-n)/t+(i<n?6:0);break;case i:s=(n-e)/t+2;break;case n:s=(e-i)/t+4}s/=6}return t.h=s,t.s=a,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,i){return this.getHSL(pP),pP.h+=t,pP.s+=e,pP.l+=i,this.setHSL(pP.h,pP.s,pP.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(pP),t.getHSL(fP);const i=oP(pP.h,fP.h,e),n=oP(pP.s,fP.s,e),r=oP(pP.l,fP.l,e);return this.setHSL(i,n,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}let vP;yP.NAMES=dP,yP.prototype.isColor=!0,yP.prototype.r=1,yP.prototype.g=1,yP.prototype.b=1;class xP{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===vP&&(vP=hP("canvas")),vP.width=t.width,vP.height=t.height;const i=vP.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=vP}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=hP("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),r=n.data;for(let t=0;t<r.length;t++)r[t]=255*gP(r[t]/255);return i.putImageData(n,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*gP(e[t]/255)):e[t]=gP(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let bP=0;class wP extends QA{constructor(t=wP.DEFAULT_IMAGE,e=wP.DEFAULT_MAPPING,i=kC,n=kC,r=BC,o=VC,s=eA,a=jC,l=1,c=GA){super(),Object.defineProperty(this,"id",{value:bP++}),this.uuid=nP(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=a,this.offset=new lP(0,0),this.repeat=new lP(1,1),this.center=new lP(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new cP,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=nP()),!e&&void 0===t.images[n.uuid]){let e;if(Array.isArray(n)){e=[];for(let t=0,i=n.length;t<i;t++)n[t].isDataTexture?e.push(EP(n[t].image)):e.push(EP(n[t]))}else e=EP(n);t.images[n.uuid]={uuid:n.uuid,url:e}}i.image=n.uuid}return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case DC:t.x=t.x-Math.floor(t.x);break;case kC:t.x=t.x<0?0:1;break;case NC:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case DC:t.y=t.y-Math.floor(t.y);break;case kC:t.y=t.y<0?0:1;break;case NC:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&this.version++}}function EP(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?xP.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}wP.DEFAULT_IMAGE=void 0,wP.DEFAULT_MAPPING=300,wP.prototype.isTexture=!0;class SP{constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=this.w,o=t.elements;return this.x=o[0]*e+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*e+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*e+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*e+o[7]*i+o[11]*n+o[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;const o=.01,s=.1,a=t.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<o&&Math.abs(u-f)<o&&Math.abs(p-m)<o){if(Math.abs(c+h)<s&&Math.abs(u+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,_=(g+1)/2,y=(c+h)/4,v=(u+f)/4,x=(p+m)/4;return t>a&&t>_?t<o?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(t),n=y/i,r=v/i):a>_?a<o?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(a),i=y/n,r=x/n):_<o?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(_),i=v/r,n=x/r),this.set(i,n,r,e),this}let _=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(_)<.001&&(_=1),this.x=(m-p)/_,this.y=(u-f)/_,this.z=(h-c)/_,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}SP.prototype.isVector4=!0;class TP extends QA{constructor(t,e,i={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new SP(0,0,t,e),this.scissorTest=!1,this.viewport=new SP(0,0,t,e),this.texture=new wP(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:t,height:e,depth:1},this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:BC,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image=Object.assign({},t.texture.image),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}TP.prototype.isWebGLRenderTarget=!0,class extends TP{constructor(t,e,i){super(t,e);const n=this.texture;this.texture=[];for(let t=0;t<i;t++)this.texture[t]=n.clone()}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone();return this}}.prototype.isWebGLMultipleRenderTargets=!0;class MP extends TP{constructor(t,e,i={}){super(t,e,i),this.samples=4,this.ignoreDepthForMultisampleCopy=void 0===i.ignoreDepth||i.ignoreDepth,this.useRenderToTexture=void 0!==i.useRenderToTexture&&i.useRenderToTexture,this.useRenderbuffer=!1===this.useRenderToTexture}copy(t){return super.copy.call(this,t),this.samples=t.samples,this.useRenderToTexture=t.useRenderToTexture,this.useRenderbuffer=t.useRenderbuffer,this}}MP.prototype.isWebGLMultisampleRenderTarget=!0;class IP{constructor(t=0,e=0,i=0,n=1){this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,n)}static slerpFlat(t,e,i,n,r,o,s){let a=i[n+0],l=i[n+1],c=i[n+2],u=i[n+3];const h=r[o+0],d=r[o+1],p=r[o+2],f=r[o+3];if(0===s)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=u);if(1===s)return t[e+0]=h,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(u!==f||a!==h||l!==d||c!==p){let t=1-s;const e=a*h+l*d+c*p+u*f,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),o=Math.atan2(r,e*i);t=Math.sin(t*o)/r,s=Math.sin(s*o)/r}const r=s*i;if(a=a*t+h*r,l=l*t+d*r,c=c*t+p*r,u=u*t+f*r,t===1-s){const t=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=t,l*=t,c*=t,u*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,i,n,r,o){const s=i[n],a=i[n+1],l=i[n+2],c=i[n+3],u=r[o],h=r[o+1],d=r[o+2],p=r[o+3];return t[e]=s*p+c*u+a*d-l*h,t[e+1]=a*p+c*h+l*u-s*d,t[e+2]=l*p+c*d+s*h-a*u,t[e+3]=c*p-s*u-a*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,r=t._z,o=t._order,s=Math.cos,a=Math.sin,l=s(i/2),c=s(n/2),u=s(r/2),h=a(i/2),d=a(n/2),p=a(r/2);switch(o){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],o=e[1],s=e[5],a=e[9],l=e[2],c=e[6],u=e[10],h=i+s+u;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-a)*t,this._y=(r-l)*t,this._z=(o-n)*t}else if(i>s&&i>u){const t=2*Math.sqrt(1+i-s-u);this._w=(c-a)/t,this._x=.25*t,this._y=(n+o)/t,this._z=(r+l)/t}else if(s>u){const t=2*Math.sqrt(1+s-i-u);this._w=(r-l)/t,this._x=(n+o)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+u-i-s);this._w=(o-n)/t,this._x=(r+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(rP(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,o=t._w,s=e._x,a=e._y,l=e._z,c=e._w;return this._x=i*c+o*s+n*l-r*a,this._y=n*c+o*a+r*s-i*l,this._z=r*c+o*l+i*a-n*s,this._w=o*c-i*s-n*a-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,o=this._w;let s=o*t._w+i*t._x+n*t._y+r*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),s>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;const a=1-s*s;if(a<=Number.EPSILON){const t=1-e;return this._w=t*o+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,s),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=o*u+this._w*h,this._x=i*u+this._x*h,this._y=n*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(r),i*Math.cos(r),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}IP.prototype.isQuaternion=!0;class CP{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(PP.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(PP.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,o=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*o,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,o=t.y,s=t.z,a=t.w,l=a*e+o*n-s*i,c=a*i+s*e-r*n,u=a*n+r*i-o*e,h=-r*e-o*i-s*n;return this.x=l*a+h*-r+c*-s-u*-o,this.y=c*a+h*-o+u*-r-l*-s,this.z=u*a+h*-s+l*-o-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,o=e.x,s=e.y,a=e.z;return this.x=n*a-r*s,this.y=r*o-i*a,this.z=i*s-n*o,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return AP.copy(this).projectOnVector(t),this.sub(AP)}reflect(t){return this.sub(AP.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(rP(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}CP.prototype.isVector3=!0;const AP=new CP,PP=new IP;class LP{constructor(t=new CP(1/0,1/0,1/0),e=new CP(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,l=t.length;a<l;a+=3){const l=t[a],c=t[a+1],u=t[a+2];l<e&&(e=l),c<i&&(i=c),u<n&&(n=u),l>r&&(r=l),c>o&&(o=c),u>s&&(s=u)}return this.min.set(e,i,n),this.max.set(r,o,s),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,l=t.count;a<l;a++){const l=t.getX(a),c=t.getY(a),u=t.getZ(a);l<e&&(e=l),c<i&&(i=c),u<n&&(n=u),l>r&&(r=l),c>o&&(o=c),u>s&&(s=u)}return this.min.set(e,i,n),this.max.set(r,o,s),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=DP.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i)if(e&&null!=i.attributes&&void 0!==i.attributes.position){const e=i.attributes.position;for(let i=0,n=e.count;i<n;i++)DP.fromBufferAttribute(e,i).applyMatrix4(t.matrixWorld),this.expandByPoint(DP)}else null===i.boundingBox&&i.computeBoundingBox(),kP.copy(i.boundingBox),kP.applyMatrix4(t.matrixWorld),this.union(kP);const n=t.children;for(let t=0,i=n.length;t<i;t++)this.expandByObject(n[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,DP),DP.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(VP),jP.subVectors(this.max,VP),NP.subVectors(t.a,VP),OP.subVectors(t.b,VP),FP.subVectors(t.c,VP),zP.subVectors(OP,NP),BP.subVectors(FP,OP),UP.subVectors(NP,FP);let e=[0,-zP.z,zP.y,0,-BP.z,BP.y,0,-UP.z,UP.y,zP.z,0,-zP.x,BP.z,0,-BP.x,UP.z,0,-UP.x,-zP.y,zP.x,0,-BP.y,BP.x,0,-UP.y,UP.x,0];return!!WP(e,NP,OP,FP,jP)&&(e=[1,0,0,0,1,0,0,0,1],!!WP(e,NP,OP,FP,jP)&&(GP.crossVectors(zP,BP),e=[GP.x,GP.y,GP.z],WP(e,NP,OP,FP,jP)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return DP.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(DP).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(RP[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),RP[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),RP[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),RP[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),RP[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),RP[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),RP[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),RP[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(RP)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}LP.prototype.isBox3=!0;const RP=[new CP,new CP,new CP,new CP,new CP,new CP,new CP,new CP],DP=new CP,kP=new LP,NP=new CP,OP=new CP,FP=new CP,zP=new CP,BP=new CP,UP=new CP,VP=new CP,jP=new CP,GP=new CP,HP=new CP;function WP(t,e,i,n,r){for(let o=0,s=t.length-3;o<=s;o+=3){HP.fromArray(t,o);const s=r.x*Math.abs(HP.x)+r.y*Math.abs(HP.y)+r.z*Math.abs(HP.z),a=e.dot(HP),l=i.dot(HP),c=n.dot(HP);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>s)return!1}return!0}const qP=new LP,XP=new CP,$P=new CP,YP=new CP;class ZP{constructor(t=new CP,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):qP.setFromPoints(t).getCenter(i);let n=0;for(let e=0,r=t.length;e<r;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){YP.subVectors(t,this.center);const e=YP.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.add(YP.multiplyScalar(i/t)),this.radius+=i}return this}union(t){return!0===this.center.equals(t.center)?$P.set(0,0,1).multiplyScalar(t.radius):$P.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(XP.copy(t.center).add($P)),this.expandByPoint(XP.copy(t.center).sub($P)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const KP=new CP,JP=new CP,QP=new CP,tL=new CP,eL=new CP,iL=new CP,nL=new CP;class rL{constructor(t=new CP,e=new CP(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,KP)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=KP.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(KP.copy(this.direction).multiplyScalar(e).add(this.origin),KP.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){JP.copy(t).add(e).multiplyScalar(.5),QP.copy(e).sub(t).normalize(),tL.copy(this.origin).sub(JP);const r=.5*t.distanceTo(e),o=-this.direction.dot(QP),s=tL.dot(this.direction),a=-tL.dot(QP),l=tL.lengthSq(),c=Math.abs(1-o*o);let u,h,d,p;if(c>0)if(u=o*a-s,h=o*s-a,p=r*c,u>=0)if(h>=-p)if(h<=p){const t=1/c;u*=t,h*=t,d=u*(u+o*h+2*s)+h*(o*u+h+2*a)+l}else h=r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h=-r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-o*r+s)),h=u>0?-r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-a),r),d=h*(h+2*a)+l):(u=Math.max(0,-(o*r+s)),h=u>0?r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l);else h=o>0?-r:r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),n&&n.copy(QP).multiplyScalar(h).add(JP),d}intersectSphere(t,e){KP.subVectors(t.center,this.origin);const i=KP.dot(this.direction),n=KP.dot(KP)-i*i,r=t.radius*t.radius;if(n>r)return null;const o=Math.sqrt(r-n),s=i-o,a=i+o;return s<0&&a<0?null:s<0?this.at(a,e):this.at(s,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,o,s,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(t.min.x-h.x)*l,n=(t.max.x-h.x)*l):(i=(t.max.x-h.x)*l,n=(t.min.x-h.x)*l),c>=0?(r=(t.min.y-h.y)*c,o=(t.max.y-h.y)*c):(r=(t.max.y-h.y)*c,o=(t.min.y-h.y)*c),i>o||r>n?null:((r>i||i!=i)&&(i=r),(o<n||n!=n)&&(n=o),u>=0?(s=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(s=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),i>a||s>n?null:((s>i||i!=i)&&(i=s),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,KP)}intersectTriangle(t,e,i,n,r){eL.subVectors(e,t),iL.subVectors(i,t),nL.crossVectors(eL,iL);let o,s=this.direction.dot(nL);if(s>0){if(n)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}tL.subVectors(this.origin,t);const a=o*this.direction.dot(iL.crossVectors(tL,iL));if(a<0)return null;const l=o*this.direction.dot(eL.cross(tL));if(l<0)return null;if(a+l>s)return null;const c=-o*tL.dot(nL);return c<0?null:this.at(c/s,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class oL{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new oL).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/sL.setFromMatrixColumn(t,0).length(),r=1/sL.setFromMatrixColumn(t,1).length(),o=1/sL.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,r=t.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(r),u=Math.sin(r);if("XYZ"===t.order){const t=o*c,i=o*u,n=s*c,r=s*u;e[0]=a*c,e[4]=-a*u,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-s*a,e[2]=r-t*l,e[6]=n+i*l,e[10]=o*a}else if("YXZ"===t.order){const t=a*c,i=a*u,n=l*c,r=l*u;e[0]=t+r*s,e[4]=n*s-i,e[8]=o*l,e[1]=o*u,e[5]=o*c,e[9]=-s,e[2]=i*s-n,e[6]=r+t*s,e[10]=o*a}else if("ZXY"===t.order){const t=a*c,i=a*u,n=l*c,r=l*u;e[0]=t-r*s,e[4]=-o*u,e[8]=n+i*s,e[1]=i+n*s,e[5]=o*c,e[9]=r-t*s,e[2]=-o*l,e[6]=s,e[10]=o*a}else if("ZYX"===t.order){const t=o*c,i=o*u,n=s*c,r=s*u;e[0]=a*c,e[4]=n*l-i,e[8]=t*l+r,e[1]=a*u,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=s*a,e[10]=o*a}else if("YZX"===t.order){const t=o*a,i=o*l,n=s*a,r=s*l;e[0]=a*c,e[4]=r-t*u,e[8]=n*u+i,e[1]=u,e[5]=o*c,e[9]=-s*c,e[2]=-l*c,e[6]=i*u+n,e[10]=t-r*u}else if("XZY"===t.order){const t=o*a,i=o*l,n=s*a,r=s*l;e[0]=a*c,e[4]=-u,e[8]=l*c,e[1]=t*u+r,e[5]=o*c,e[9]=i*u-n,e[2]=n*u-i,e[6]=s*c,e[10]=r*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(lL,t,cL)}lookAt(t,e,i){const n=this.elements;return dL.subVectors(t,e),0===dL.lengthSq()&&(dL.z=1),dL.normalize(),uL.crossVectors(i,dL),0===uL.lengthSq()&&(1===Math.abs(i.z)?dL.x+=1e-4:dL.z+=1e-4,dL.normalize(),uL.crossVectors(i,dL)),uL.normalize(),hL.crossVectors(dL,uL),n[0]=uL.x,n[4]=hL.x,n[8]=dL.x,n[1]=uL.y,n[5]=hL.y,n[9]=dL.y,n[2]=uL.z,n[6]=hL.z,n[10]=dL.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],c=i[1],u=i[5],h=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],_=i[3],y=i[7],v=i[11],x=i[15],b=n[0],w=n[4],E=n[8],S=n[12],T=n[1],M=n[5],I=n[9],C=n[13],A=n[2],P=n[6],L=n[10],R=n[14],D=n[3],k=n[7],N=n[11],O=n[15];return r[0]=o*b+s*T+a*A+l*D,r[4]=o*w+s*M+a*P+l*k,r[8]=o*E+s*I+a*L+l*N,r[12]=o*S+s*C+a*R+l*O,r[1]=c*b+u*T+h*A+d*D,r[5]=c*w+u*M+h*P+d*k,r[9]=c*E+u*I+h*L+d*N,r[13]=c*S+u*C+h*R+d*O,r[2]=p*b+f*T+m*A+g*D,r[6]=p*w+f*M+m*P+g*k,r[10]=p*E+f*I+m*L+g*N,r[14]=p*S+f*C+m*R+g*O,r[3]=_*b+y*T+v*A+x*D,r[7]=_*w+y*M+v*P+x*k,r[11]=_*E+y*I+v*L+x*N,r[15]=_*S+y*C+v*R+x*O,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],o=t[1],s=t[5],a=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+r*a*u-n*l*u-r*s*h+i*l*h+n*s*d-i*a*d)+t[7]*(+e*a*d-e*l*h+r*o*h-n*o*d+n*l*c-r*a*c)+t[11]*(+e*l*u-e*s*d-r*o*u+i*o*d+r*s*c-i*l*c)+t[15]*(-n*s*c-e*a*u+e*s*h+n*o*u-i*o*h+i*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],_=u*m*l-f*h*l+f*a*d-s*m*d-u*a*g+s*h*g,y=p*h*l-c*m*l-p*a*d+o*m*d+c*a*g-o*h*g,v=c*f*l-p*u*l+p*s*d-o*f*d-c*s*g+o*u*g,x=p*u*a-c*f*a-p*s*h+o*f*h+c*s*m-o*u*m,b=e*_+i*y+n*v+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=_*w,t[1]=(f*h*r-u*m*r-f*n*d+i*m*d+u*n*g-i*h*g)*w,t[2]=(s*m*r-f*a*r+f*n*l-i*m*l-s*n*g+i*a*g)*w,t[3]=(u*a*r-s*h*r-u*n*l+i*h*l+s*n*d-i*a*d)*w,t[4]=y*w,t[5]=(c*m*r-p*h*r+p*n*d-e*m*d-c*n*g+e*h*g)*w,t[6]=(p*a*r-o*m*r-p*n*l+e*m*l+o*n*g-e*a*g)*w,t[7]=(o*h*r-c*a*r+c*n*l-e*h*l-o*n*d+e*a*d)*w,t[8]=v*w,t[9]=(p*u*r-c*f*r-p*i*d+e*f*d+c*i*g-e*u*g)*w,t[10]=(o*f*r-p*s*r+p*i*l-e*f*l-o*i*g+e*s*g)*w,t[11]=(c*s*r-o*u*r-c*i*l+e*u*l+o*i*d-e*s*d)*w,t[12]=x*w,t[13]=(c*f*n-p*u*n+p*i*h-e*f*h-c*i*m+e*u*m)*w,t[14]=(p*s*n-o*f*n-p*i*a+e*f*a+o*i*m-e*s*m)*w,t[15]=(o*u*n-c*s*n+c*i*a-e*u*a-o*i*h+e*s*h)*w,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,o=t.x,s=t.y,a=t.z,l=r*o,c=r*s;return this.set(l*o+i,l*s-n*a,l*a+n*s,0,l*s+n*a,c*s+i,c*a-n*o,0,l*a-n*s,c*a+n*o,r*a*a+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,o){return this.set(1,i,r,0,t,1,o,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,o=e._y,s=e._z,a=e._w,l=r+r,c=o+o,u=s+s,h=r*l,d=r*c,p=r*u,f=o*c,m=o*u,g=s*u,_=a*l,y=a*c,v=a*u,x=i.x,b=i.y,w=i.z;return n[0]=(1-(f+g))*x,n[1]=(d+v)*x,n[2]=(p-y)*x,n[3]=0,n[4]=(d-v)*b,n[5]=(1-(h+g))*b,n[6]=(m+_)*b,n[7]=0,n[8]=(p+y)*w,n[9]=(m-_)*w,n[10]=(1-(h+f))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=sL.set(n[0],n[1],n[2]).length();const o=sL.set(n[4],n[5],n[6]).length(),s=sL.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],aL.copy(this);const a=1/r,l=1/o,c=1/s;return aL.elements[0]*=a,aL.elements[1]*=a,aL.elements[2]*=a,aL.elements[4]*=l,aL.elements[5]*=l,aL.elements[6]*=l,aL.elements[8]*=c,aL.elements[9]*=c,aL.elements[10]*=c,e.setFromRotationMatrix(aL),i.x=r,i.y=o,i.z=s,this}makePerspective(t,e,i,n,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,a=2*r/(e-t),l=2*r/(i-n),c=(e+t)/(e-t),u=(i+n)/(i-n),h=-(o+r)/(o-r),d=-2*o*r/(o-r);return s[0]=a,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=l,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(t,e,i,n,r,o){const s=this.elements,a=1/(e-t),l=1/(i-n),c=1/(o-r),u=(e+t)*a,h=(i+n)*l,d=(o+r)*c;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*c,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}oL.prototype.isMatrix4=!0;const sL=new CP,aL=new oL,lL=new CP(0,0,0),cL=new CP(1,1,1),uL=new CP,hL=new CP,dL=new CP,pL=new oL,fL=new IP;class mL{constructor(t=0,e=0,i=0,n=mL.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,r=n[0],o=n[4],s=n[8],a=n[1],l=n[5],c=n[9],u=n[2],h=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(rP(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-rP(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(rP(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-rP(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(rP(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-rP(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return pL.makeRotationFromQuaternion(t),this.setFromRotationMatrix(pL,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return fL.setFromEuler(this),this.setFromQuaternion(fL,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new CP(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}mL.prototype.isEuler=!0,mL.DefaultOrder="XYZ",mL.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class gL{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let _L=0;const yL=new CP,vL=new IP,xL=new oL,bL=new CP,wL=new CP,EL=new CP,SL=new IP,TL=new CP(1,0,0),ML=new CP(0,1,0),IL=new CP(0,0,1),CL={type:"added"},AL={type:"removed"};class PL extends QA{constructor(){super(),Object.defineProperty(this,"id",{value:_L++}),this.uuid=nP(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=PL.DefaultUp.clone();const t=new CP,e=new mL,i=new IP,n=new CP(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new oL},normalMatrix:{value:new cP}}),this.matrix=new oL,this.matrixWorld=new oL,this.matrixAutoUpdate=PL.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new gL,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return vL.setFromAxisAngle(t,e),this.quaternion.multiply(vL),this}rotateOnWorldAxis(t,e){return vL.setFromAxisAngle(t,e),this.quaternion.premultiply(vL),this}rotateX(t){return this.rotateOnAxis(TL,t)}rotateY(t){return this.rotateOnAxis(ML,t)}rotateZ(t){return this.rotateOnAxis(IL,t)}translateOnAxis(t,e){return yL.copy(t).applyQuaternion(this.quaternion),this.position.add(yL.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(TL,t)}translateY(t){return this.translateOnAxis(ML,t)}translateZ(t){return this.translateOnAxis(IL,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(xL.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?bL.copy(t):bL.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),wL.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?xL.lookAt(wL,bL,this.up):xL.lookAt(bL,wL,this.up),this.quaternion.setFromRotationMatrix(xL),n&&(xL.extractRotation(n.matrixWorld),vL.setFromRotationMatrix(xL),this.quaternion.premultiply(vL.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(CL)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(AL)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(AL)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),xL.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),xL.multiply(t.parent.matrixWorld)),t.applyMatrix4(xL),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(wL,t,EL),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(wL,SL,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];r(t.shapes,n)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(r(t.materials,this.material[i]));n.material=e}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(r(t.animations,i))}}if(e){const e=o(t.geometries),n=o(t.materials),r=o(t.textures),s=o(t.images),a=o(t.shapes),l=o(t.skeletons),c=o(t.animations);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),s.length>0&&(i.images=s),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c)}return i.object=n,i;function o(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}PL.DefaultUp=new CP(0,1,0),PL.DefaultMatrixAutoUpdate=!0,PL.prototype.isObject3D=!0;const LL=new CP,RL=new CP,DL=new CP,kL=new CP,NL=new CP,OL=new CP,FL=new CP,zL=new CP,BL=new CP,UL=new CP;class VL{constructor(t=new CP,e=new CP,i=new CP){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),LL.subVectors(t,e),n.cross(LL);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){LL.subVectors(n,e),RL.subVectors(i,e),DL.subVectors(t,e);const o=LL.dot(LL),s=LL.dot(RL),a=LL.dot(DL),l=RL.dot(RL),c=RL.dot(DL),u=o*l-s*s;if(0===u)return r.set(-2,-1,-1);const h=1/u,d=(l*a-s*c)*h,p=(o*c-s*a)*h;return r.set(1-d-p,p,d)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,kL),kL.x>=0&&kL.y>=0&&kL.x+kL.y<=1}static getUV(t,e,i,n,r,o,s,a){return this.getBarycoord(t,e,i,n,kL),a.set(0,0),a.addScaledVector(r,kL.x),a.addScaledVector(o,kL.y),a.addScaledVector(s,kL.z),a}static isFrontFacing(t,e,i,n){return LL.subVectors(i,e),RL.subVectors(t,e),LL.cross(RL).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return LL.subVectors(this.c,this.b),RL.subVectors(this.a,this.b),.5*LL.cross(RL).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return VL.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return VL.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,r){return VL.getUV(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return VL.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return VL.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,r=this.c;let o,s;NL.subVectors(n,i),OL.subVectors(r,i),zL.subVectors(t,i);const a=NL.dot(zL),l=OL.dot(zL);if(a<=0&&l<=0)return e.copy(i);BL.subVectors(t,n);const c=NL.dot(BL),u=OL.dot(BL);if(c>=0&&u<=c)return e.copy(n);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return o=a/(a-c),e.copy(i).addScaledVector(NL,o);UL.subVectors(t,r);const d=NL.dot(UL),p=OL.dot(UL);if(p>=0&&d<=p)return e.copy(r);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),e.copy(i).addScaledVector(OL,s);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return FL.subVectors(r,n),s=(u-c)/(u-c+(d-p)),e.copy(n).addScaledVector(FL,s);const g=1/(m+f+h);return o=f*g,s=h*g,e.copy(i).addScaledVector(NL,o).addScaledVector(OL,s)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let jL=0;class GL extends QA{constructor(){super(),Object.defineProperty(this,"id",{value:jL++}),this.uuid=nP(),this.name="",this.type="Material",this.fog=!0,this.blending=GI,this.side=BI,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=nC,this.blendDst=rC,this.blendEquation=$I,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=pC,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=$A,this.stencilZFail=$A,this.stencilZPass=$A,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==GI&&(i.blending=this.blending),this.side!==BI&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){const e=n(t.textures),r=n(t.images);e.length>0&&(i.textures=e),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}GL.prototype.isMaterial=!0;class HL extends GL{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new yP(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=yC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}HL.prototype.isMeshBasicMaterial=!0;const WL=new CP,qL=new lP;class XL{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=YA,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new yP),e[i++]=r.r,e[i++]=r.g,e[i++]=r.b}return this}copyVector2sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new lP),e[i++]=r.x,e[i++]=r.y}return this}copyVector3sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new CP),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z}return this}copyVector4sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new SP),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z,e[i++]=r.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)qL.fromBufferAttribute(this,e),qL.applyMatrix3(t),this.setXY(e,qL.x,qL.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)WL.fromBufferAttribute(this,e),WL.applyMatrix3(t),this.setXYZ(e,WL.x,WL.y,WL.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)WL.x=this.getX(e),WL.y=this.getY(e),WL.z=this.getZ(e),WL.applyMatrix4(t),this.setXYZ(e,WL.x,WL.y,WL.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)WL.x=this.getX(e),WL.y=this.getY(e),WL.z=this.getZ(e),WL.applyNormalMatrix(t),this.setXYZ(e,WL.x,WL.y,WL.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)WL.x=this.getX(e),WL.y=this.getY(e),WL.z=this.getZ(e),WL.transformDirection(t),this.setXYZ(e,WL.x,WL.y,WL.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==YA&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}XL.prototype.isBufferAttribute=!0;class $L extends XL{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class YL extends XL{constructor(t,e,i){super(new Uint32Array(t),e,i)}}(class extends XL{constructor(t,e,i){super(new Uint16Array(t),e,i)}}).prototype.isFloat16BufferAttribute=!0;class ZL extends XL{constructor(t,e,i){super(new Float32Array(t),e,i)}}let KL=0;const JL=new oL,QL=new PL,tR=new CP,eR=new LP,iR=new LP,nR=new CP;class rR extends QA{constructor(){super(),Object.defineProperty(this,"id",{value:KL++}),this.uuid=nP(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(uP(t)?YL:$L)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new cP).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return JL.makeRotationFromQuaternion(t),this.applyMatrix4(JL),this}rotateX(t){return JL.makeRotationX(t),this.applyMatrix4(JL),this}rotateY(t){return JL.makeRotationY(t),this.applyMatrix4(JL),this}rotateZ(t){return JL.makeRotationZ(t),this.applyMatrix4(JL),this}translate(t,e,i){return JL.makeTranslation(t,e,i),this.applyMatrix4(JL),this}scale(t,e,i){return JL.makeScale(t,e,i),this.applyMatrix4(JL),this}lookAt(t){return QL.lookAt(t),QL.updateMatrix(),this.applyMatrix4(QL.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(tR).negate(),this.translate(tR.x,tR.y,tR.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new ZL(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new LP);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new CP(-1/0,-1/0,-1/0),new CP(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];eR.setFromBufferAttribute(i),this.morphTargetsRelative?(nR.addVectors(this.boundingBox.min,eR.min),this.boundingBox.expandByPoint(nR),nR.addVectors(this.boundingBox.max,eR.max),this.boundingBox.expandByPoint(nR)):(this.boundingBox.expandByPoint(eR.min),this.boundingBox.expandByPoint(eR.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ZP);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new CP,1/0);if(t){const i=this.boundingSphere.center;if(eR.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];iR.setFromBufferAttribute(i),this.morphTargetsRelative?(nR.addVectors(eR.min,iR.min),eR.expandByPoint(nR),nR.addVectors(eR.max,iR.max),eR.expandByPoint(nR)):(eR.expandByPoint(iR.min),eR.expandByPoint(iR.max))}eR.getCenter(i);let n=0;for(let e=0,r=t.count;e<r;e++)nR.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(nR));if(e)for(let r=0,o=e.length;r<o;r++){const o=e[r],s=this.morphTargetsRelative;for(let e=0,r=o.count;e<r;e++)nR.fromBufferAttribute(o,e),s&&(tR.fromBufferAttribute(t,e),nR.add(tR)),n=Math.max(n,i.distanceToSquared(nR))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,n=e.position.array,r=e.normal.array,o=e.uv.array,s=n.length/3;void 0===e.tangent&&this.setAttribute("tangent",new XL(new Float32Array(4*s),4));const a=e.tangent.array,l=[],c=[];for(let t=0;t<s;t++)l[t]=new CP,c[t]=new CP;const u=new CP,h=new CP,d=new CP,p=new lP,f=new lP,m=new lP,g=new CP,_=new CP;function y(t,e,i){u.fromArray(n,3*t),h.fromArray(n,3*e),d.fromArray(n,3*i),p.fromArray(o,2*t),f.fromArray(o,2*e),m.fromArray(o,2*i),h.sub(u),d.sub(u),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),_.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[i].add(g),c[t].add(_),c[e].add(_),c[i].add(_))}let v=this.groups;0===v.length&&(v=[{start:0,count:i.length}]);for(let t=0,e=v.length;t<e;++t){const e=v[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)y(i[t+0],i[t+1],i[t+2])}const x=new CP,b=new CP,w=new CP,E=new CP;function S(t){w.fromArray(r,3*t),E.copy(w);const e=l[t];x.copy(e),x.sub(w.multiplyScalar(w.dot(e))).normalize(),b.crossVectors(E,e);const i=b.dot(c[t])<0?-1:1;a[4*t]=x.x,a[4*t+1]=x.y,a[4*t+2]=x.z,a[4*t+3]=i}for(let t=0,e=v.length;t<e;++t){const e=v[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)S(i[t+0]),S(i[t+1]),S(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new XL(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new CP,r=new CP,o=new CP,s=new CP,a=new CP,l=new CP,c=new CP,u=new CP;if(t)for(let h=0,d=t.count;h<d;h+=3){const d=t.getX(h+0),p=t.getX(h+1),f=t.getX(h+2);n.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),o.fromBufferAttribute(e,f),c.subVectors(o,r),u.subVectors(n,r),c.cross(u),s.fromBufferAttribute(i,d),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),s.add(c),a.add(c),l.add(c),i.setXYZ(d,s.x,s.y,s.z),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,s=e.count;t<s;t+=3)n.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),o.fromBufferAttribute(e,t+2),c.subVectors(o,r),u.subVectors(n,r),c.cross(u),i.setXYZ(t+0,c.x,c.y,c.z),i.setXYZ(t+1,c.x,c.y,c.z),i.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===t.attributes[n])continue;const r=i[n].array,o=t.attributes[n],s=o.array,a=o.itemSize*e,l=Math.min(s.length,r.length-a);for(let t=0,e=a;t<l;t++,e++)r[e]=s[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)nR.fromBufferAttribute(t,e),nR.normalize(),t.setXYZ(e,nR.x,nR.y,nR.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,r=t.normalized,o=new i.constructor(e.length*n);let s=0,a=0;for(let r=0,l=e.length;r<l;r++){s=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*n;for(let t=0;t<n;t++)o[a++]=i[s++]}return new XL(o,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new rR,i=this.index.array,n=this.attributes;for(const r in n){const o=t(n[r],i);e.setAttribute(r,o)}const r=this.morphAttributes;for(const n in r){const o=[],s=r[n];for(let e=0,n=s.length;e<n;e++){const n=t(s[e],i);o.push(n)}e.morphAttributes[n]=o}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let t=0,i=o.length;t<i;t++){const i=o[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let r=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],o=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];o.push(n.toJSON(t.data))}o.length>0&&(n[e]=o,r=!0)}r&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(t.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const r=t.morphAttributes;for(const t in r){const i=[],n=r[t];for(let t=0,r=n.length;t<r;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let t=0,e=o.length;t<e;t++){const e=o[t];this.addGroup(e.start,e.count,e.materialIndex)}const s=t.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}rR.prototype.isBufferGeometry=!0;const oR=new oL,sR=new rL,aR=new ZP,lR=new CP,cR=new CP,uR=new CP,hR=new CP,dR=new CP,pR=new CP,fR=new CP,mR=new CP,gR=new CP,_R=new lP,yR=new lP,vR=new lP,xR=new CP,bR=new CP;class wR extends PL{constructor(t=new rR,e=new HL){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),aR.copy(i.boundingSphere),aR.applyMatrix4(r),!1===t.ray.intersectsSphere(aR))return;if(oR.copy(r).invert(),sR.copy(t.ray).applyMatrix4(oR),null!==i.boundingBox&&!1===sR.intersectsBox(i.boundingBox))return;let o;if(i.isBufferGeometry){const r=i.index,s=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,u=i.attributes.uv2,h=i.groups,d=i.drawRange;if(null!==r)if(Array.isArray(n))for(let i=0,p=h.length;i<p;i++){const p=h[i],f=n[p.materialIndex];for(let i=Math.max(p.start,d.start),n=Math.min(r.count,Math.min(p.start+p.count,d.start+d.count));i<n;i+=3){const n=r.getX(i),h=r.getX(i+1),d=r.getX(i+2);o=ER(this,f,t,sR,s,a,l,c,u,n,h,d),o&&(o.faceIndex=Math.floor(i/3),o.face.materialIndex=p.materialIndex,e.push(o))}}else for(let i=Math.max(0,d.start),h=Math.min(r.count,d.start+d.count);i<h;i+=3){const h=r.getX(i),d=r.getX(i+1),p=r.getX(i+2);o=ER(this,n,t,sR,s,a,l,c,u,h,d,p),o&&(o.faceIndex=Math.floor(i/3),e.push(o))}else if(void 0!==s)if(Array.isArray(n))for(let i=0,r=h.length;i<r;i++){const r=h[i],p=n[r.materialIndex];for(let i=Math.max(r.start,d.start),n=Math.min(s.count,Math.min(r.start+r.count,d.start+d.count));i<n;i+=3)o=ER(this,p,t,sR,s,a,l,c,u,i,i+1,i+2),o&&(o.faceIndex=Math.floor(i/3),o.face.materialIndex=r.materialIndex,e.push(o))}else for(let i=Math.max(0,d.start),r=Math.min(s.count,d.start+d.count);i<r;i+=3)o=ER(this,n,t,sR,s,a,l,c,u,i,i+1,i+2),o&&(o.faceIndex=Math.floor(i/3),e.push(o))}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function ER(t,e,i,n,r,o,s,a,l,c,u,h){lR.fromBufferAttribute(r,c),cR.fromBufferAttribute(r,u),uR.fromBufferAttribute(r,h);const d=t.morphTargetInfluences;if(o&&d){fR.set(0,0,0),mR.set(0,0,0),gR.set(0,0,0);for(let t=0,e=o.length;t<e;t++){const e=d[t],i=o[t];0!==e&&(hR.fromBufferAttribute(i,c),dR.fromBufferAttribute(i,u),pR.fromBufferAttribute(i,h),s?(fR.addScaledVector(hR,e),mR.addScaledVector(dR,e),gR.addScaledVector(pR,e)):(fR.addScaledVector(hR.sub(lR),e),mR.addScaledVector(dR.sub(cR),e),gR.addScaledVector(pR.sub(uR),e)))}lR.add(fR),cR.add(mR),uR.add(gR)}t.isSkinnedMesh&&(t.boneTransform(c,lR),t.boneTransform(u,cR),t.boneTransform(h,uR));const p=function(t,e,i,n,r,o,s,a){let l;if(l=e.side===UI?n.intersectTriangle(s,o,r,!0,a):n.intersectTriangle(r,o,s,e.side!==VI,a),null===l)return null;bR.copy(a),bR.applyMatrix4(t.matrixWorld);const c=i.ray.origin.distanceTo(bR);return c<i.near||c>i.far?null:{distance:c,point:bR.clone(),object:t}}(t,e,i,n,lR,cR,uR,xR);if(p){a&&(_R.fromBufferAttribute(a,c),yR.fromBufferAttribute(a,u),vR.fromBufferAttribute(a,h),p.uv=VL.getUV(xR,lR,cR,uR,_R,yR,vR,new lP)),l&&(_R.fromBufferAttribute(l,c),yR.fromBufferAttribute(l,u),vR.fromBufferAttribute(l,h),p.uv2=VL.getUV(xR,lR,cR,uR,_R,yR,vR,new lP));const t={a:c,b:u,c:h,normal:new CP,materialIndex:0};VL.getNormal(lR,cR,uR,t.normal),p.face=t}return p}wR.prototype.isMesh=!0;class SR extends rR{constructor(t=1,e=1,i=1,n=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:o};const s=this;n=Math.floor(n),r=Math.floor(r),o=Math.floor(o);const a=[],l=[],c=[],u=[];let h=0,d=0;function p(t,e,i,n,r,o,p,f,m,g,_){const y=o/m,v=p/g,x=o/2,b=p/2,w=f/2,E=m+1,S=g+1;let T=0,M=0;const I=new CP;for(let o=0;o<S;o++){const s=o*v-b;for(let a=0;a<E;a++){const h=a*y-x;I[t]=h*n,I[e]=s*r,I[i]=w,l.push(I.x,I.y,I.z),I[t]=0,I[e]=0,I[i]=f>0?1:-1,c.push(I.x,I.y,I.z),u.push(a/m),u.push(1-o/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const i=h+e+E*t,n=h+e+E*(t+1),r=h+(e+1)+E*(t+1),o=h+(e+1)+E*t;a.push(i,n,o),a.push(n,r,o),M+=6}s.addGroup(d,M,_),d+=M,h+=T}p("z","y","x",-1,-1,i,e,t,o,r,0),p("z","y","x",1,-1,i,e,-t,o,r,1),p("x","z","y",1,1,t,i,e,n,o,2),p("x","z","y",1,-1,t,i,-e,n,o,3),p("x","y","z",1,-1,t,e,i,n,r,4),p("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(a),this.setAttribute("position",new ZL(l,3)),this.setAttribute("normal",new ZL(c,3)),this.setAttribute("uv",new ZL(u,2))}static fromJSON(t){return new SR(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function TR(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function MR(t){const e={};for(let i=0;i<t.length;i++){const n=TR(t[i]);for(const t in n)e[t]=n[t]}return e}const IR={clone:TR,merge:MR};class CR extends GL{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=TR(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}CR.prototype.isShaderMaterial=!0;class AR extends PL{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new oL,this.projectionMatrix=new oL,this.projectionMatrixInverse=new oL}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}AR.prototype.isCamera=!0;class PR extends AR{constructor(t=50,e=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*iP*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*eP*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*iP*Math.atan(Math.tan(.5*eP*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,r,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*eP*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;const o=this.view;if(null!==this.view&&this.view.enabled){const t=o.fullWidth,s=o.fullHeight;r+=o.offsetX*n/t,e-=o.offsetY*i/s,n*=o.width/t,i*=o.height/s}const s=this.filmOffset;0!==s&&(r+=t*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}PR.prototype.isPerspectiveCamera=!0;const LR=90;class RR extends PL{constructor(t,e,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new PR(LR,1,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new CP(1,0,0)),this.add(n);const r=new PR(LR,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new CP(-1,0,0)),this.add(r);const o=new PR(LR,1,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new CP(0,1,0)),this.add(o);const s=new PR(LR,1,t,e);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new CP(0,-1,0)),this.add(s);const a=new PR(LR,1,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new CP(0,0,1)),this.add(a);const l=new PR(LR,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new CP(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,o,s,a,l]=this.children,c=t.xr.enabled,u=t.getRenderTarget();t.xr.enabled=!1;const h=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,o),t.setRenderTarget(i,3),t.render(e,s),t.setRenderTarget(i,4),t.render(e,a),i.texture.generateMipmaps=h,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(u),t.xr.enabled=c,i.texture.needsPMREMUpdate=!0}}class DR extends wP{constructor(t,e,i,n,r,o,s,a,l,c){super(t=void 0!==t?t:[],e=void 0!==e?e:IC,i,n,r,o,s,a,l,c),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}DR.prototype.isCubeTexture=!0;class kR extends TP{constructor(t,e,i){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=i),super(t,t,e),e=e||{},this.texture=new DR(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:BC}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=eA,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={tEquirect:{value:null}},n="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",o=new SR(5,5,5),s=new CR({name:"CubemapFromEquirect",uniforms:TR(i),vertexShader:n,fragmentShader:r,side:UI,blending:jI});s.uniforms.tEquirect.value=e;const a=new wR(o,s),l=e.minFilter;return e.minFilter===VC&&(e.minFilter=BC),new RR(1,10,this).update(t,a),e.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(t,e,i,n){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,i,n);t.setRenderTarget(r)}}kR.prototype.isWebGLCubeRenderTarget=!0;const NR=new CP,OR=new CP,FR=new cP;class zR{constructor(t=new CP(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=NR.subVectors(i,e).cross(OR.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(NR),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||FR.getNormalMatrix(t),n=this.coplanarPoint(NR).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}zR.prototype.isPlane=!0;const BR=new ZP,UR=new CP;class VR{constructor(t=new zR,e=new zR,i=new zR,n=new zR,r=new zR,o=new zR){this.planes=[t,e,i,n,r,o]}set(t,e,i,n,r,o){const s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(o),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],r=i[1],o=i[2],s=i[3],a=i[4],l=i[5],c=i[6],u=i[7],h=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],_=i[14],y=i[15];return e[0].setComponents(s-n,u-a,f-h,y-m).normalize(),e[1].setComponents(s+n,u+a,f+h,y+m).normalize(),e[2].setComponents(s+r,u+l,f+d,y+g).normalize(),e[3].setComponents(s-r,u-l,f-d,y-g).normalize(),e[4].setComponents(s-o,u-c,f-p,y-_).normalize(),e[5].setComponents(s+o,u+c,f+p,y+_).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),BR.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(BR)}intersectsSprite(t){return BR.center.set(0,0,0),BR.radius=.7071067811865476,BR.applyMatrix4(t.matrixWorld),this.intersectsSphere(BR)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(i)<n)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(UR.x=n.normal.x>0?t.max.x:t.min.x,UR.y=n.normal.y>0?t.max.y:t.min.y,UR.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(UR)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function jR(){let t=null,e=!1,i=null,n=null;function r(e,o){i(e,o),n=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function GR(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const o=n.get(e);void 0===o?n.set(e,function(e,n){const r=e.array,o=e.usage,s=t.createBuffer();t.bindBuffer(n,s),t.bufferData(n,r,o),e.onUploadCallback();let a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?e.isFloat16BufferAttribute?i?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(a=5121),{buffer:s,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):o.version<e.version&&(function(e,n,r){const o=n.array,s=n.updateRange;t.bindBuffer(r,e),-1===s.count?t.bufferSubData(r,0,o):(i?t.bufferSubData(r,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):t.bufferSubData(r,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}(o.buffer,e,r),o.version=e.version)}}}class HR extends rR{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const r=t/2,o=e/2,s=Math.floor(i),a=Math.floor(n),l=s+1,c=a+1,u=t/s,h=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<c;t++){const e=t*h-o;for(let i=0;i<l;i++){const n=i*u-r;p.push(n,-e,0),f.push(0,0,1),m.push(i/s),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<s;e++){const i=e+l*t,n=e+l*(t+1),r=e+1+l*(t+1),o=e+1+l*t;d.push(i,n,o),d.push(n,r,o)}this.setIndex(d),this.setAttribute("position",new ZL(p,3)),this.setAttribute("normal",new ZL(f,3)),this.setAttribute("uv",new ZL(m,2))}static fromJSON(t){return new HR(t.width,t.height,t.widthSegments,t.heightSegments)}}const WR={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\treturn texture2D( envMap, uv ).rgb;\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},qR={common:{diffuse:{value:new yP(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new cP},uv2Transform:{value:new cP},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new lP(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new yP(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new yP(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new cP}},sprite:{diffuse:{value:new yP(16777215)},opacity:{value:1},center:{value:new lP(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new cP}}},XR={basic:{uniforms:MR([qR.common,qR.specularmap,qR.envmap,qR.aomap,qR.lightmap,qR.fog]),vertexShader:WR.meshbasic_vert,fragmentShader:WR.meshbasic_frag},lambert:{uniforms:MR([qR.common,qR.specularmap,qR.envmap,qR.aomap,qR.lightmap,qR.emissivemap,qR.fog,qR.lights,{emissive:{value:new yP(0)}}]),vertexShader:WR.meshlambert_vert,fragmentShader:WR.meshlambert_frag},phong:{uniforms:MR([qR.common,qR.specularmap,qR.envmap,qR.aomap,qR.lightmap,qR.emissivemap,qR.bumpmap,qR.normalmap,qR.displacementmap,qR.fog,qR.lights,{emissive:{value:new yP(0)},specular:{value:new yP(1118481)},shininess:{value:30}}]),vertexShader:WR.meshphong_vert,fragmentShader:WR.meshphong_frag},standard:{uniforms:MR([qR.common,qR.envmap,qR.aomap,qR.lightmap,qR.emissivemap,qR.bumpmap,qR.normalmap,qR.displacementmap,qR.roughnessmap,qR.metalnessmap,qR.fog,qR.lights,{emissive:{value:new yP(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:WR.meshphysical_vert,fragmentShader:WR.meshphysical_frag},toon:{uniforms:MR([qR.common,qR.aomap,qR.lightmap,qR.emissivemap,qR.bumpmap,qR.normalmap,qR.displacementmap,qR.gradientmap,qR.fog,qR.lights,{emissive:{value:new yP(0)}}]),vertexShader:WR.meshtoon_vert,fragmentShader:WR.meshtoon_frag},matcap:{uniforms:MR([qR.common,qR.bumpmap,qR.normalmap,qR.displacementmap,qR.fog,{matcap:{value:null}}]),vertexShader:WR.meshmatcap_vert,fragmentShader:WR.meshmatcap_frag},points:{uniforms:MR([qR.points,qR.fog]),vertexShader:WR.points_vert,fragmentShader:WR.points_frag},dashed:{uniforms:MR([qR.common,qR.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:WR.linedashed_vert,fragmentShader:WR.linedashed_frag},depth:{uniforms:MR([qR.common,qR.displacementmap]),vertexShader:WR.depth_vert,fragmentShader:WR.depth_frag},normal:{uniforms:MR([qR.common,qR.bumpmap,qR.normalmap,qR.displacementmap,{opacity:{value:1}}]),vertexShader:WR.meshnormal_vert,fragmentShader:WR.meshnormal_frag},sprite:{uniforms:MR([qR.sprite,qR.fog]),vertexShader:WR.sprite_vert,fragmentShader:WR.sprite_frag},background:{uniforms:{uvTransform:{value:new cP},t2D:{value:null}},vertexShader:WR.background_vert,fragmentShader:WR.background_frag},cube:{uniforms:MR([qR.envmap,{opacity:{value:1}}]),vertexShader:WR.cube_vert,fragmentShader:WR.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:WR.equirect_vert,fragmentShader:WR.equirect_frag},distanceRGBA:{uniforms:MR([qR.common,qR.displacementmap,{referencePosition:{value:new CP},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:WR.distanceRGBA_vert,fragmentShader:WR.distanceRGBA_frag},shadow:{uniforms:MR([qR.lights,qR.fog,{color:{value:new yP(0)},opacity:{value:1}}]),vertexShader:WR.shadow_vert,fragmentShader:WR.shadow_frag}};function $R(t,e,i,n,r,o){const s=new yP(0);let a,l,c=!0===r?0:1,u=null,h=0,d=null;function p(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,o)}return{getClearColor:function(){return s},setClearColor:function(t,e=1){s.set(t),c=e,p(s,c)},getClearAlpha:function(){return c},setClearAlpha:function(t){c=t,p(s,c)},render:function(i,r){let o=!1,f=!0===r.isScene?r.background:null;f&&f.isTexture&&(f=e.get(f));const m=t.xr,g=m.getSession&&m.getSession();g&&"additive"===g.environmentBlendMode&&(f=null),null===f?p(s,c):f&&f.isColor&&(p(f,1),o=!0),(t.autoClear||o)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),f&&(f.isCubeTexture||f.mapping===LC)?(void 0===l&&(l=new wR(new SR(1,1,1),new CR({name:"BackgroundCubeMaterial",uniforms:TR(XR.cube.uniforms),vertexShader:XR.cube.vertexShader,fragmentShader:XR.cube.fragmentShader,side:UI,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=f,l.material.uniforms.flipEnvMap.value=f.isCubeTexture&&!1===f.isRenderTargetTexture?-1:1,u===f&&h===f.version&&d===t.toneMapping||(l.material.needsUpdate=!0,u=f,h=f.version,d=t.toneMapping),i.unshift(l,l.geometry,l.material,0,0,null)):f&&f.isTexture&&(void 0===a&&(a=new wR(new HR(2,2),new CR({name:"BackgroundMaterial",uniforms:TR(XR.background.uniforms),vertexShader:XR.background.vertexShader,fragmentShader:XR.background.fragmentShader,side:BI,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(a)),a.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),a.material.uniforms.uvTransform.value.copy(f.matrix),u===f&&h===f.version&&d===t.toneMapping||(a.material.needsUpdate=!0,u=f,h=f.version,d=t.toneMapping),i.unshift(a,a.geometry,a.material,0,0,null))}}}function YR(t,e,i,n){const r=t.getParameter(34921),o=n.isWebGL2?null:e.get("OES_vertex_array_object"),s=n.isWebGL2||null!==o,a={},l=d(null);let c=l;function u(e){return n.isWebGL2?t.bindVertexArray(e):o.bindVertexArrayOES(e)}function h(e){return n.isWebGL2?t.deleteVertexArray(e):o.deleteVertexArrayOES(e)}function d(t){const e=[],i=[],n=[];for(let t=0;t<r;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function p(){const t=c.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function f(t){m(t,0)}function m(i,r){const o=c.newAttributes,s=c.enabledAttributes,a=c.attributeDivisors;o[i]=1,0===s[i]&&(t.enableVertexAttribArray(i),s[i]=1),a[i]!==r&&((n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),a[i]=r)}function g(){const e=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function _(e,i,r,o,s,a){!0!==n.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,i,r,o,s,a):t.vertexAttribIPointer(e,i,r,s,a)}function y(){v(),c!==l&&(c=l,u(c.object))}function v(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,h,y,v){let x=!1;if(s){const e=function(e,i,r){const s=!0===r.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let u=c[s];return void 0===u&&(u=d(n.isWebGL2?t.createVertexArray():o.createVertexArrayOES()),c[s]=u),u}(y,h,l);c!==e&&(c=e,u(c.object)),x=function(t,e){const i=c.attributes,n=t.attributes;let r=0;for(const t in n){const e=i[t],o=n[t];if(void 0===e)return!0;if(e.attribute!==o)return!0;if(e.data!==o.data)return!0;r++}return c.attributesNum!==r||c.index!==e}(y,v),x&&function(t,e){const i={},n=t.attributes;let r=0;for(const t in n){const e=n[t],o={};o.attribute=e,e.data&&(o.data=e.data),i[t]=o,r++}c.attributes=i,c.attributesNum=r,c.index=e}(y,v)}else{const t=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===t||(c.geometry=y.id,c.program=h.id,c.wireframe=t,x=!0)}!0===r.isInstancedMesh&&(x=!0),null!==v&&i.update(v,34963),x&&(function(r,o,s,a){if(!1===n.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,c=s.getAttributes(),u=o.defaultAttributeValues;for(const e in c){const n=c[e];if(n.location>=0){let o=l[e];if(void 0===o&&("instanceMatrix"===e&&r.instanceMatrix&&(o=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(o=r.instanceColor)),void 0!==o){const e=o.normalized,s=o.itemSize,l=i.get(o);if(void 0===l)continue;const c=l.buffer,u=l.type,h=l.bytesPerElement;if(o.isInterleavedBufferAttribute){const i=o.data,l=i.stride,d=o.offset;if(i&&i.isInstancedInterleavedBuffer){for(let t=0;t<n.locationSize;t++)m(n.location+t,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<n.locationSize;t++)f(n.location+t);t.bindBuffer(34962,c);for(let t=0;t<n.locationSize;t++)_(n.location+t,s/n.locationSize,u,e,l*h,(d+s/n.locationSize*t)*h)}else{if(o.isInstancedBufferAttribute){for(let t=0;t<n.locationSize;t++)m(n.location+t,o.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let t=0;t<n.locationSize;t++)f(n.location+t);t.bindBuffer(34962,c);for(let t=0;t<n.locationSize;t++)_(n.location+t,s/n.locationSize,u,e,s*h,s/n.locationSize*t*h)}}else if(void 0!==u){const i=u[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(n.location,i);break;case 3:t.vertexAttrib3fv(n.location,i);break;case 4:t.vertexAttrib4fv(n.location,i);break;default:t.vertexAttrib1fv(n.location,i)}}}}g()}(r,l,h,y),null!==v&&t.bindBuffer(34963,i.get(v).buffer))},reset:y,resetDefaultState:v,dispose:function(){y();for(const t in a){const e=a[t];for(const t in e){const i=e[t];for(const t in i)h(i[t].object),delete i[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const i=e[t];for(const t in i)h(i[t].object),delete i[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const i=a[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)h(n[t].object),delete n[t];delete i[t.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function ZR(t,e,i,n){const r=n.isWebGL2;let o;this.setMode=function(t){o=t},this.render=function(e,n){t.drawArrays(o,e,n),i.update(n,o,1)},this.renderInstances=function(n,s,a){if(0===a)return;let l,c;if(r)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](o,n,s,a),i.update(s,o,a)}}function KR(t,e,i){let n;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let s=void 0!==i.precision?i.precision:"highp";const a=r(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const l=o||e.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,u=t.getParameter(34930),h=t.getParameter(35660),d=t.getParameter(3379),p=t.getParameter(34076),f=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),_=t.getParameter(36349),y=h>0,v=o||e.has("OES_texture_float");return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:s,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:y,floatFragmentTextures:v,floatVertexTextures:y&&v,maxSamples:o?t.getParameter(36183):0}}function JR(t){const e=this;let i=null,n=0,r=!1,o=!1;const s=new zR,a=new cP,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(t,i,n,r){const o=null!==t?t.length:0;let c=null;if(0!==o){if(c=l.value,!0!==r||null===c){const e=n+4*o,r=i.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,i=n;e!==o;++e,i+=4)s.copy(t[e]).applyMatrix4(r,a),s.normal.toArray(c,i),c[i+3]=s.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=o,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,o){const s=0!==t.length||e||0!==n||r;return r=e,i=u(t,o,0),n=t.length,s},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,c()},this.setState=function(e,s,a){const h=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!r||null===h||0===h.length||o&&!p)o?u(null):c();else{const t=o?0:n,e=4*t;let r=f.clippingState||null;l.value=r,r=u(h,s,e,a);for(let t=0;t!==e;++t)r[t]=i[t];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function QR(t){let e=new WeakMap;function i(t,e){return e===AC?t.mapping=IC:e===PC&&(t.mapping=CC),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const o=r.mapping;if(o===AC||o===PC){if(e.has(r))return i(e.get(r).texture,r.mapping);{const o=r.image;if(o&&o.height>0){const s=new kR(o.height/2);return s.fromEquirectangularTexture(t,r),e.set(r,s),r.addEventListener("dispose",n),i(s.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}XR.physical={uniforms:MR([XR.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new lP(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new yP(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new lP},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new yP(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new yP(1,1,1)},specularColorMap:{value:null}}]),vertexShader:WR.meshphysical_vert,fragmentShader:WR.meshphysical_frag};class tD extends AR{constructor(t=-1,e=1,i=1,n=-1,r=.1,o=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-t,o=i+t,s=n+e,a=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,o=r+t*this.view.width,s-=e*this.view.offsetY,a=s-e*this.view.height}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}tD.prototype.isOrthographicCamera=!0;class eD extends CR{constructor(t){super(t),this.type="RawShaderMaterial"}}eD.prototype.isRawShaderMaterial=!0;const iD=Math.pow(2,8),nD=[.125,.215,.35,.446,.526,.582],rD=5+nD.length,oD=new tD,{_lodPlanes:sD,_sizeLods:aD,_sigmas:lD}=mD(),cD=new yP;let uD=null;const hD=(1+Math.sqrt(5))/2,dD=1/hD,pD=[new CP(1,1,1),new CP(-1,1,1),new CP(1,1,-1),new CP(-1,1,-1),new CP(0,hD,dD),new CP(0,hD,-dD),new CP(dD,0,hD),new CP(-dD,0,hD),new CP(hD,dD,0),new CP(-hD,dD,0)];class fD{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(t){const e=new Float32Array(20),i=new CP(0,1,0);return new eD({name:"SphericalGaussianBlur",defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:jI,depthTest:!1,depthWrite:!1})}(),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){uD=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(t,i,n,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=vD(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=yD(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<sD.length;t++)sD[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(uD),t.scissorTest=!1,_D(t,0,0,t.width,t.height)}_fromTexture(t,e){uD=this._renderer.getRenderTarget();const i=e||this._allocateTargets(t);return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(t){const e={magFilter:BC,minFilter:BC,generateMipmaps:!1,type:YC,format:eA,encoding:GA,depthBuffer:!1},i=gD(e);return i.depthBuffer=!t,null===this._pingPongRenderTarget&&(this._pingPongRenderTarget=gD(e)),i}_compileMaterial(t){const e=new wR(sD[0],t);this._renderer.compile(e,oD)}_sceneToCubeUV(t,e,i,n){const r=new PR(90,1,e,i),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(cD),a.toneMapping=bC,a.autoClear=!1;const u=new HL({name:"PMREM.Background",side:UI,depthWrite:!1,depthTest:!1}),h=new wR(new SR,u);let d=!1;const p=t.background;p?p.isColor&&(u.color.copy(p),t.background=null,d=!0):(u.color.copy(cD),d=!0);for(let e=0;e<6;e++){const i=e%3;0===i?(r.up.set(0,o[e],0),r.lookAt(s[e],0,0)):1===i?(r.up.set(0,0,o[e]),r.lookAt(0,s[e],0)):(r.up.set(0,o[e],0),r.lookAt(0,0,s[e])),_D(n,i*iD,e>2?iD:0,iD,iD),a.setRenderTarget(n),d&&a.render(h,r),a.render(t,r)}h.geometry.dispose(),h.material.dispose(),a.toneMapping=c,a.autoClear=l,t.background=p}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===IC||t.mapping===CC;n?(null===this._cubemapShader&&(this._cubemapShader=vD()),this._cubemapShader.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectShader&&(this._equirectShader=yD());const r=n?this._cubemapShader:this._equirectShader,o=new wR(sD[0],r),s=r.uniforms;s.envMap.value=t,n||s.texelSize.value.set(1/t.image.width,1/t.image.height),_D(e,0,0,3*iD,2*iD),i.setRenderTarget(e),i.render(o,oD)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<rD;e++){const i=Math.sqrt(lD[e]*lD[e]-lD[e-1]*lD[e-1]),n=pD[(e-1)%pD.length];this._blur(t,e-1,e,i,n)}e.autoClear=i}_blur(t,e,i,n,r){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,i,n,"latitudinal",r),this._halfBlur(o,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,o,s){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new wR(sD[n],l),u=l.uniforms,h=aD[i]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<20;++t){const e=t/p,i=Math.exp(-e*e/2);m.push(i),0===t?g+=i:t<f&&(g+=2*i)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===o,s&&(u.poleAxis.value=s),u.dTheta.value=d,u.mipInt.value=8-i;const _=aD[n];_D(e,3*Math.max(0,iD-2*_),(0===n?0:2*iD)+2*_*(n>4?n-8+4:0),3*_,2*_),a.setRenderTarget(e),a.render(c,oD)}}function mD(){const t=[],e=[],i=[];let n=8;for(let r=0;r<rD;r++){const o=Math.pow(2,n);e.push(o);let s=1/o;r>4?s=nD[r-8+4-1]:0===r&&(s=0),i.push(s);const a=1/(o-1),l=-a/2,c=1+a/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*h),_=new Float32Array(f*d*h),y=new Float32Array(m*d*h);for(let t=0;t<h;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];g.set(n,p*d*t),_.set(u,f*d*t);const r=[t,t,t,t,t,t];y.set(r,m*d*t)}const v=new rR;v.setAttribute("position",new XL(g,p)),v.setAttribute("uv",new XL(_,f)),v.setAttribute("faceIndex",new XL(y,m)),t.push(v),n>4&&n--}return{_lodPlanes:t,_sizeLods:e,_sigmas:i}}function gD(t){const e=new TP(3*iD,3*iD,t);return e.texture.mapping=LC,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function _D(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function yD(){const t=new lP(1,1);return new eD({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:t}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = texture2D ( envMap, uv ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t}\n\t\t",blending:jI,depthTest:!1,depthWrite:!1})}function vD(){return new eD({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:jI,depthTest:!1,depthWrite:!1})}function xD(t){let e=new WeakMap,i=null;function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const o=r.mapping,s=o===AC||o===PC,a=o===IC||o===CC;if(s||a){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let n=e.get(r);return null===i&&(i=new fD(t)),n=s?i.fromEquirectangular(r,n):i.fromCubemap(r,n),e.set(r,n),n.texture}if(e.has(r))return e.get(r).texture;{const o=r.image;if(s&&o&&o.height>0||a&&o&&function(t){let e=0;for(let i=0;i<6;i++)void 0!==t[i]&&e++;return 6===e}(o)){null===i&&(i=new fD(t));const o=s?i.fromEquirectangular(r):i.fromCubemap(r);return e.set(r,o),r.addEventListener("dispose",n),o.texture}return null}}}return r},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function bD(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(t){const e=i(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function wD(t,e,i,n){const r={},o=new WeakMap;function s(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);a.removeEventListener("dispose",s),delete r[a.id];const l=o.get(a);l&&(e.remove(l),o.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(t){const i=[],n=t.index,r=t.attributes.position;let s=0;if(null!==n){const t=n.array;s=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],o=t[e+2];i.push(n,r,r,o,o,n)}}else{const t=r.array;s=r.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,r=e+2;i.push(t,n,n,r,r,t)}}const a=new(uP(i)?YL:$L)(i,1);a.version=s;const l=o.get(t);l&&e.remove(l),o.set(t,a)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",s),r[e.id]=!0,i.memory.geometries++),e},update:function(t){const i=t.attributes;for(const t in i)e.update(i[t],34962);const n=t.morphAttributes;for(const t in n){const i=n[t];for(let t=0,n=i.length;t<n;t++)e.update(i[t],34962)}},getWireframeAttribute:function(t){const e=o.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&a(t)}else a(t);return o.get(t)}}}function ED(t,e,i,n){const r=n.isWebGL2;let o,s,a;this.setMode=function(t){o=t},this.setIndex=function(t){s=t.type,a=t.bytesPerElement},this.render=function(e,n){t.drawElements(o,n,s,e*a),i.update(n,o,1)},this.renderInstances=function(n,l,c){if(0===c)return;let u,h;if(r)u=t,h="drawElementsInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](o,l,s,n*a,c),i.update(l,o,c)}}function SD(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,i,n){switch(e.calls++,i){case 4:e.triangles+=n*(t/3);break;case 1:e.lines+=n*(t/2);break;case 3:e.lines+=n*(t-1);break;case 2:e.lines+=n*t;break;case 0:e.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}class TD extends wP{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=OC,this.minFilter=OC,this.wrapR=kC,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}function MD(t,e){return t[0]-e[0]}function ID(t,e){return Math.abs(e[1])-Math.abs(t[1])}function CD(t,e){let i=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?i=127:n instanceof Int16Array?i=32767:n instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),t.divideScalar(i)}function AD(t,e,i){const n={},r=new Float32Array(8),o=new WeakMap,s=new CP,a=[];for(let t=0;t<8;t++)a[t]=[t,0];return{update:function(l,c,u,h){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const p=c.morphAttributes.position.length;let f=o.get(c);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();const _=void 0!==c.morphAttributes.normal,y=c.morphAttributes.position,v=c.morphAttributes.normal||[],x=!0===_?2:1;let b=c.attributes.position.count*x,w=1;b>e.maxTextureSize&&(w=Math.ceil(b/e.maxTextureSize),b=e.maxTextureSize);const E=new Float32Array(b*w*4*p),S=new TD(E,b,w,p);S.format=eA,S.type=$C,S.needsUpdate=!0;const T=4*x;for(let I=0;I<p;I++){const C=y[I],A=v[I],P=b*w*4*I;for(let L=0;L<C.count;L++){s.fromBufferAttribute(C,L),!0===C.normalized&&CD(s,C);const R=L*T;E[P+R+0]=s.x,E[P+R+1]=s.y,E[P+R+2]=s.z,E[P+R+3]=0,!0===_&&(s.fromBufferAttribute(A,L),!0===A.normalized&&CD(s,A),E[P+R+4]=s.x,E[P+R+5]=s.y,E[P+R+6]=s.z,E[P+R+7]=0)}}function M(){S.dispose(),o.delete(c),c.removeEventListener("dispose",M)}f={count:p,texture:S,size:new lP(b,w)},o.set(c,f),c.addEventListener("dispose",M)}let m=0;for(let D=0;D<d.length;D++)m+=d[D];const g=c.morphTargetsRelative?1:1-m;h.getUniforms().setValue(t,"morphTargetBaseInfluence",g),h.getUniforms().setValue(t,"morphTargetInfluences",d),h.getUniforms().setValue(t,"morphTargetsTexture",f.texture,i),h.getUniforms().setValue(t,"morphTargetsTextureSize",f.size)}else{const k=void 0===d?0:d.length;let N=n[c.id];if(void 0===N||N.length!==k){N=[];for(let U=0;U<k;U++)N[U]=[U,0];n[c.id]=N}for(let V=0;V<k;V++){const j=N[V];j[0]=V,j[1]=d[V]}N.sort(ID);for(let G=0;G<8;G++)G<k&&N[G][1]?(a[G][0]=N[G][0],a[G][1]=N[G][1]):(a[G][0]=Number.MAX_SAFE_INTEGER,a[G][1]=0);a.sort(MD);const O=c.morphAttributes.position,F=c.morphAttributes.normal;let z=0;for(let H=0;H<8;H++){const W=a[H],q=W[0],X=W[1];q!==Number.MAX_SAFE_INTEGER&&X?(O&&c.getAttribute("morphTarget"+H)!==O[q]&&c.setAttribute("morphTarget"+H,O[q]),F&&c.getAttribute("morphNormal"+H)!==F[q]&&c.setAttribute("morphNormal"+H,F[q]),r[H]=X,z+=X):(O&&!0===c.hasAttribute("morphTarget"+H)&&c.deleteAttribute("morphTarget"+H),F&&!0===c.hasAttribute("morphNormal"+H)&&c.deleteAttribute("morphNormal"+H),r[H]=0)}const B=c.morphTargetsRelative?1:1-z;h.getUniforms().setValue(t,"morphTargetBaseInfluence",B),h.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function PD(t,e,i,n){let r=new WeakMap;function o(t){const e=t.target;e.removeEventListener("dispose",o),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(t){const s=n.render.frame,a=t.geometry,l=e.get(t,a);return r.get(l)!==s&&(e.update(l),r.set(l,s)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",o)&&t.addEventListener("dispose",o),i.update(t.instanceMatrix,34962),null!==t.instanceColor&&i.update(t.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}TD.prototype.isDataTexture2DArray=!0;class LD extends wP{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=OC,this.minFilter=OC,this.wrapR=kC,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}LD.prototype.isDataTexture3D=!0;const RD=new wP,DD=new TD,kD=new LD,ND=new DR,OD=[],FD=[],zD=new Float32Array(16),BD=new Float32Array(9),UD=new Float32Array(4);function VD(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let o=OD[r];if(void 0===o&&(o=new Float32Array(r),OD[r]=o),0!==e){n.toArray(o,0);for(let n=1,r=0;n!==e;++n)r+=i,t[n].toArray(o,r)}return o}function jD(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function GD(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function HD(t,e){let i=FD[e];void 0===i&&(i=new Int32Array(e),FD[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function WD(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function qD(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(jD(i,e))return;t.uniform2fv(this.addr,e),GD(i,e)}}function XD(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(jD(i,e))return;t.uniform3fv(this.addr,e),GD(i,e)}}function $D(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(jD(i,e))return;t.uniform4fv(this.addr,e),GD(i,e)}}function YD(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(jD(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),GD(i,e)}else{if(jD(i,n))return;UD.set(n),t.uniformMatrix2fv(this.addr,!1,UD),GD(i,n)}}function ZD(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(jD(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),GD(i,e)}else{if(jD(i,n))return;BD.set(n),t.uniformMatrix3fv(this.addr,!1,BD),GD(i,n)}}function KD(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(jD(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),GD(i,e)}else{if(jD(i,n))return;zD.set(n),t.uniformMatrix4fv(this.addr,!1,zD),GD(i,n)}}function JD(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function QD(t,e){const i=this.cache;jD(i,e)||(t.uniform2iv(this.addr,e),GD(i,e))}function tk(t,e){const i=this.cache;jD(i,e)||(t.uniform3iv(this.addr,e),GD(i,e))}function ek(t,e){const i=this.cache;jD(i,e)||(t.uniform4iv(this.addr,e),GD(i,e))}function ik(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function nk(t,e){const i=this.cache;jD(i,e)||(t.uniform2uiv(this.addr,e),GD(i,e))}function rk(t,e){const i=this.cache;jD(i,e)||(t.uniform3uiv(this.addr,e),GD(i,e))}function ok(t,e){const i=this.cache;jD(i,e)||(t.uniform4uiv(this.addr,e),GD(i,e))}function sk(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.safeSetTexture2D(e||RD,r)}function ak(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||kD,r)}function lk(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.safeSetTextureCube(e||ND,r)}function ck(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||DD,r)}function uk(t,e){t.uniform1fv(this.addr,e)}function hk(t,e){const i=VD(e,this.size,2);t.uniform2fv(this.addr,i)}function dk(t,e){const i=VD(e,this.size,3);t.uniform3fv(this.addr,i)}function pk(t,e){const i=VD(e,this.size,4);t.uniform4fv(this.addr,i)}function fk(t,e){const i=VD(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function mk(t,e){const i=VD(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function gk(t,e){const i=VD(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function _k(t,e){t.uniform1iv(this.addr,e)}function yk(t,e){t.uniform2iv(this.addr,e)}function vk(t,e){t.uniform3iv(this.addr,e)}function xk(t,e){t.uniform4iv(this.addr,e)}function bk(t,e){t.uniform1uiv(this.addr,e)}function wk(t,e){t.uniform2uiv(this.addr,e)}function Ek(t,e){t.uniform3uiv(this.addr,e)}function Sk(t,e){t.uniform4uiv(this.addr,e)}function Tk(t,e,i){const n=e.length,r=HD(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.safeSetTexture2D(e[t]||RD,r[t])}function Mk(t,e,i){const n=e.length,r=HD(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture3D(e[t]||kD,r[t])}function Ik(t,e,i){const n=e.length,r=HD(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.safeSetTextureCube(e[t]||ND,r[t])}function Ck(t,e,i){const n=e.length,r=HD(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2DArray(e[t]||DD,r[t])}function Ak(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return WD;case 35664:return qD;case 35665:return XD;case 35666:return $D;case 35674:return YD;case 35675:return ZD;case 35676:return KD;case 5124:case 35670:return JD;case 35667:case 35671:return QD;case 35668:case 35672:return tk;case 35669:case 35673:return ek;case 5125:return ik;case 36294:return nk;case 36295:return rk;case 36296:return ok;case 35678:case 36198:case 36298:case 36306:case 35682:return sk;case 35679:case 36299:case 36307:return ak;case 35680:case 36300:case 36308:case 36293:return lk;case 36289:case 36303:case 36311:case 36292:return ck}}(e.type)}function Pk(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return uk;case 35664:return hk;case 35665:return dk;case 35666:return pk;case 35674:return fk;case 35675:return mk;case 35676:return gk;case 5124:case 35670:return _k;case 35667:case 35671:return yk;case 35668:case 35672:return vk;case 35669:case 35673:return xk;case 5125:return bk;case 36294:return wk;case 36295:return Ek;case 36296:return Sk;case 35678:case 36198:case 36298:case 36306:case 35682:return Tk;case 35679:case 36299:case 36307:return Mk;case 35680:case 36300:case 36308:case 36293:return Ik;case 36289:case 36303:case 36311:case 36292:return Ck}}(e.type)}function Lk(t){this.id=t,this.seq=[],this.map={}}Pk.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),GD(e,t)},Lk.prototype.setValue=function(t,e,i){const n=this.seq;for(let r=0,o=n.length;r!==o;++r){const o=n[r];o.setValue(t,e[o.id],i)}};const Rk=/(\w+)(\])?(\[|\.)?/g;function Dk(t,e){t.seq.push(e),t.map[e.id]=e}function kk(t,e,i){const n=t.name,r=n.length;for(Rk.lastIndex=0;;){const o=Rk.exec(n),s=Rk.lastIndex;let a=o[1];const l="]"===o[2],c=o[3];if(l&&(a|=0),void 0===c||"["===c&&s+2===r){Dk(i,void 0===c?new Ak(a,t,e):new Pk(a,t,e));break}{let t=i.map[a];void 0===t&&(t=new Lk(a),Dk(i,t)),i=t}}}function Nk(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,35718);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);kk(i,t.getUniformLocation(e,i.name),this)}}function Ok(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}Nk.prototype.setValue=function(t,e,i,n){const r=this.map[e];void 0!==r&&r.setValue(t,i,n)},Nk.prototype.setOptional=function(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)},Nk.upload=function(t,e,i,n){for(let r=0,o=e.length;r!==o;++r){const o=e[r],s=i[o.id];!1!==s.needsUpdate&&o.setValue(t,s.value,n)}},Nk.seqWithValue=function(t,e){const i=[];for(let n=0,r=t.length;n!==r;++n){const r=t[n];r.id in e&&i.push(r)}return i};let Fk=0;function zk(t,e,i){const n=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return n&&""===r?"":i.toUpperCase()+"\n\n"+r+"\n\n"+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function Bk(t,e){const i=function(t){switch(t){case GA:return["Linear","( value )"];case HA:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Uk(t,e){let i;switch(e){case wC:i="Linear";break;case EC:i="Reinhard";break;case SC:i="OptimizedCineon";break;case TC:i="ACESFilmic";break;case MC:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Vk(t){return""!==t}function jk(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Gk(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Hk=/^[ \t]*#include +<([\w\d./]+)>/gm;function Wk(t){return t.replace(Hk,qk)}function qk(t,e){const i=WR[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return Wk(i)}const Xk=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,$k=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Yk(t){return t.replace($k,Kk).replace(Xk,Zk)}function Zk(t,e,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Kk(0,e,i,n)}function Kk(t,e,i,n){let r="";for(let t=parseInt(e);t<parseInt(i);t++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function Jk(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Qk(t,e,i,n){const r=t.getContext(),o=i.defines;let s=i.vertexShader,a=i.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===OI?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===FI?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===zI&&(e="SHADOWMAP_TYPE_VSM"),e}(i),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case IC:case CC:e="ENVMAP_TYPE_CUBE";break;case LC:case RC:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),u=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case CC:case RC:e="ENVMAP_MODE_REFRACTION"}return e}(i),h=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case yC:e="ENVMAP_BLENDING_MULTIPLY";break;case vC:e="ENVMAP_BLENDING_MIX";break;case xC:e="ENVMAP_BLENDING_ADD"}return e}(i),d=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Vk).join("\n")}(i),p=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(o),f=r.createProgram();let m,g,_=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(m=[p].filter(Vk).join("\n"),m.length>0&&(m+="\n"),g=[d,p].filter(Vk).join("\n"),g.length>0&&(g+="\n")):(m=[Jk(i),"#define SHADER_NAME "+i.shaderName,p,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Vk).join("\n"),g=[d,Jk(i),"#define SHADER_NAME "+i.shaderName,p,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==bC?"#define TONE_MAPPING":"",i.toneMapping!==bC?WR.tonemapping_pars_fragment:"",i.toneMapping!==bC?Uk("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.transparent?"":"#define OPAQUE",WR.encodings_pars_fragment,Bk("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Vk).join("\n")),s=Wk(s),s=jk(s,i),s=Gk(s,i),a=Wk(a),a=jk(a,i),a=Gk(a,i),s=Yk(s),a=Yk(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(_="#version 300 es\n",m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,g=["#define varying in",i.glslVersion===KA?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===KA?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g);const y=_+g+a,v=Ok(r,35633,_+m+s),x=Ok(r,35632,y);if(r.attachShader(f,v),r.attachShader(f,x),void 0!==i.index0AttributeName?r.bindAttribLocation(f,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(f,0,"position"),r.linkProgram(f),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(f).trim(),e=r.getShaderInfoLog(v).trim(),i=r.getShaderInfoLog(x).trim();let n=!0,o=!0;if(!1===r.getProgramParameter(f,35714)){n=!1;const e=zk(r,v,"vertex"),i=zk(r,x,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(f,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+i)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==i||(o=!1);o&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:m},fragmentShader:{log:i,prefix:g}})}let b,w;return r.deleteShader(v),r.deleteShader(x),this.getUniforms=function(){return void 0===b&&(b=new Nk(r,f)),b},this.getAttributes=function(){return void 0===w&&(w=function(t,e){const i={},n=t.getProgramParameter(e,35721);for(let r=0;r<n;r++){const n=t.getActiveAttrib(e,r),o=n.name;let s=1;35674===n.type&&(s=2),35675===n.type&&(s=3),35676===n.type&&(s=4),i[o]={type:n.type,location:t.getAttribLocation(e,o),locationSize:s}}return i}(r,f)),w},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(f),this.program=void 0},this.name=i.shaderName,this.id=Fk++,this.cacheKey=e,this.usedTimes=1,this.program=f,this.vertexShader=v,this.fragmentShader=x,this}let tN=0;class eN{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),r=this._getShaderStage(i),o=this._getShaderCacheForMaterial(t);return!1===o.has(n)&&(o.add(n),n.usedTimes++),!1===o.has(r)&&(o.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return!1===e.has(t)&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;if(!1===e.has(t)){const i=new iN;e.set(t,i)}return e.get(t)}}class iN{constructor(){this.id=tN++,this.usedTimes=0}}function nN(t,e,i,n,r,o,s){const a=new gL,l=new eN,c=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,d=r.floatVertexTextures,p=r.maxVertexUniforms,f=r.vertexTextures;let m=r.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(o,a,c,_,y){const v=_.fog,x=o.isMeshStandardMaterial?_.environment:null,b=(o.isMeshStandardMaterial?i:e).get(o.envMap||x),w=g[o.type],E=y.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(d)return 1024;{const t=p,i=Math.floor((t-20)/4),n=Math.min(i,e.length);return n<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+n+"."),0):n}}(y):0;let S,T,M,I;if(null!==o.precision&&(m=r.getMaxPrecision(o.precision),m!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",m,"instead.")),w){const t=XR[w];S=t.vertexShader,T=t.fragmentShader}else S=o.vertexShader,T=o.fragmentShader,l.update(o),M=l.getVertexShaderID(o),I=l.getFragmentShaderID(o);const C=t.getRenderTarget(),A=o.alphaTest>0,P=o.clearcoat>0;return{isWebGL2:u,shaderID:w,shaderName:o.type,vertexShader:S,fragmentShader:T,defines:o.defines,customVertexShaderID:M,customFragmentShaderID:I,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:m,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:f,outputEncoding:null===C?t.outputEncoding:!0===C.isXRRenderTarget?C.texture.encoding:GA,map:!!o.map,matcap:!!o.matcap,envMap:!!b,envMapMode:b&&b.mapping,envMapCubeUV:!!b&&(b.mapping===LC||b.mapping===RC),lightMap:!!o.lightMap,aoMap:!!o.aoMap,emissiveMap:!!o.emissiveMap,bumpMap:!!o.bumpMap,normalMap:!!o.normalMap,objectSpaceNormalMap:o.normalMapType===XA,tangentSpaceNormalMap:o.normalMapType===qA,decodeVideoTexture:!!o.map&&!0===o.map.isVideoTexture&&o.map.encoding===HA,clearcoat:P,clearcoatMap:P&&!!o.clearcoatMap,clearcoatRoughnessMap:P&&!!o.clearcoatRoughnessMap,clearcoatNormalMap:P&&!!o.clearcoatNormalMap,displacementMap:!!o.displacementMap,roughnessMap:!!o.roughnessMap,metalnessMap:!!o.metalnessMap,specularMap:!!o.specularMap,specularIntensityMap:!!o.specularIntensityMap,specularColorMap:!!o.specularColorMap,transparent:o.transparent,alphaMap:!!o.alphaMap,alphaTest:A,gradientMap:!!o.gradientMap,sheen:o.sheen>0,sheenColorMap:!!o.sheenColorMap,sheenRoughnessMap:!!o.sheenRoughnessMap,transmission:o.transmission>0,transmissionMap:!!o.transmissionMap,thicknessMap:!!o.thicknessMap,combine:o.combine,vertexTangents:!!o.normalMap&&!!y.geometry&&!!y.geometry.attributes.tangent,vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!y.geometry&&!!y.geometry.attributes.color&&4===y.geometry.attributes.color.itemSize,vertexUvs:!!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatMap||o.clearcoatRoughnessMap||o.clearcoatNormalMap||o.displacementMap||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheenColorMap||o.sheenRoughnessMap),uvsVertexOnly:!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatNormalMap||o.transmission>0||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheen>0||o.sheenColorMap||o.sheenRoughnessMap||!o.displacementMap),fog:!!v,useFog:o.fog,fogExp2:v&&v.isFogExp2,flatShading:!!o.flatShading,sizeAttenuation:o.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===y.isSkinnedMesh&&E>0,maxBones:E,useVertexTexture:d,morphTargets:!!y.geometry&&!!y.geometry.morphAttributes.position,morphNormals:!!y.geometry&&!!y.geometry.morphAttributes.normal,morphTargetsCount:y.geometry&&y.geometry.morphAttributes.position?y.geometry.morphAttributes.position.length:0,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:o.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.length>0,shadowMapType:t.shadowMap.type,toneMapping:o.toneMapped?t.toneMapping:bC,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:o.premultipliedAlpha,doubleSided:o.side===VI,flipSided:o.side===UI,depthPacking:void 0!==o.depthPacking&&o.depthPacking,index0AttributeName:o.index0AttributeName,extensionDerivatives:o.extensions&&o.extensions.derivatives,extensionFragDepth:o.extensions&&o.extensions.fragDepth,extensionDrawBuffers:o.extensions&&o.extensions.drawBuffers,extensionShaderTextureLOD:o.extensions&&o.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(function(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.maxBones),t.push(e.morphTargetsCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection)}(i,e),function(t,e){a.disableAll(),e.isWebGL2&&a.enable(0),e.supportsVertexTextures&&a.enable(1),e.instancing&&a.enable(2),e.instancingColor&&a.enable(3),e.map&&a.enable(4),e.matcap&&a.enable(5),e.envMap&&a.enable(6),e.envMapCubeUV&&a.enable(7),e.lightMap&&a.enable(8),e.aoMap&&a.enable(9),e.emissiveMap&&a.enable(10),e.bumpMap&&a.enable(11),e.normalMap&&a.enable(12),e.objectSpaceNormalMap&&a.enable(13),e.tangentSpaceNormalMap&&a.enable(14),e.clearcoat&&a.enable(15),e.clearcoatMap&&a.enable(16),e.clearcoatRoughnessMap&&a.enable(17),e.clearcoatNormalMap&&a.enable(18),e.displacementMap&&a.enable(19),e.specularMap&&a.enable(20),e.roughnessMap&&a.enable(21),e.metalnessMap&&a.enable(22),e.gradientMap&&a.enable(23),e.alphaMap&&a.enable(24),e.alphaTest&&a.enable(25),e.vertexColors&&a.enable(26),e.vertexAlphas&&a.enable(27),e.vertexUvs&&a.enable(28),e.vertexTangents&&a.enable(29),e.uvsVertexOnly&&a.enable(30),e.fog&&a.enable(31),t.push(a.mask),a.disableAll(),e.useFog&&a.enable(0),e.flatShading&&a.enable(1),e.logarithmicDepthBuffer&&a.enable(2),e.skinning&&a.enable(3),e.useVertexTexture&&a.enable(4),e.morphTargets&&a.enable(5),e.morphNormals&&a.enable(6),e.premultipliedAlpha&&a.enable(7),e.shadowMapEnabled&&a.enable(8),e.physicallyCorrectLights&&a.enable(9),e.doubleSided&&a.enable(10),e.flipSided&&a.enable(11),e.depthPacking&&a.enable(12),e.dithering&&a.enable(13),e.specularIntensityMap&&a.enable(14),e.specularColorMap&&a.enable(15),e.transmission&&a.enable(16),e.transmissionMap&&a.enable(17),e.thicknessMap&&a.enable(18),e.sheen&&a.enable(19),e.sheenColorMap&&a.enable(20),e.sheenRoughnessMap&&a.enable(21),e.decodeVideoTexture&&a.enable(22),e.transparent&&a.enable(23),t.push(a.mask)}(i,e),i.push(t.outputEncoding)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=g[t.type];let i;if(e){const t=XR[e];i=IR.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=c.length;t<e;t++){const e=c[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new Qk(t,i,e,o),c.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=c.indexOf(t);c[e]=c[c.length-1],c.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:c,dispose:function(){l.dispose()}}}function rN(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function oN(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function sN(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function aN(){const t=[];let e=0;const i=[],n=[],r=[];function o(i,n,r,o,s,a){let l=t[e];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:o,renderOrder:i.renderOrder,z:s,group:a},t[e]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=o,l.renderOrder=i.renderOrder,l.z=s,l.group=a),e++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){e=0,i.length=0,n.length=0,r.length=0},push:function(t,e,s,a,l,c){const u=o(t,e,s,a,l,c);s.transmission>0?n.push(u):!0===s.transparent?r.push(u):i.push(u)},unshift:function(t,e,s,a,l,c){const u=o(t,e,s,a,l,c);s.transmission>0?n.unshift(u):!0===s.transparent?r.unshift(u):i.unshift(u)},finish:function(){for(let i=e,n=t.length;i<n;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||oN),n.length>1&&n.sort(e||sN),r.length>1&&r.sort(e||sN)}}}function lN(){let t=new WeakMap;return{get:function(e,i){let n;return!1===t.has(e)?(n=new aN,t.set(e,[n])):i>=t.get(e).length?(n=new aN,t.get(e).push(n)):n=t.get(e)[i],n},dispose:function(){t=new WeakMap}}}function cN(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new CP,color:new yP};break;case"SpotLight":i={position:new CP,direction:new CP,color:new yP,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new CP,color:new yP,distance:0,decay:0};break;case"HemisphereLight":i={direction:new CP,skyColor:new yP,groundColor:new yP};break;case"RectAreaLight":i={color:new yP,position:new CP,halfWidth:new CP,halfHeight:new CP}}return t[e.id]=i,i}}}let uN=0;function hN(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function dN(t,e){const i=new cN,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new lP};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new lP,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new CP);const o=new CP,s=new oL,a=new oL;return{setup:function(o,s){let a=0,l=0,c=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let u=0,h=0,d=0,p=0,f=0,m=0,g=0,_=0;o.sort(hN);const y=!0!==s?Math.PI:1;for(let t=0,e=o.length;t<e;t++){const e=o[t],s=e.color,v=e.intensity,x=e.distance,b=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=s.r*v*y,l+=s.g*v*y,c+=s.b*v*y;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],v);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.directionalShadow[u]=i,r.directionalShadowMap[u]=b,r.directionalShadowMatrix[u]=e.shadow.matrix,m++}r.directional[u]=t,u++}else if(e.isSpotLight){const t=i.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(s).multiplyScalar(v*y),t.distance=x,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.spotShadow[d]=i,r.spotShadowMap[d]=b,r.spotShadowMatrix[d]=e.shadow.matrix,_++}r.spot[d]=t,d++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(s).multiplyScalar(v),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,r.pointShadow[h]=i,r.pointShadowMap[h]=b,r.pointShadowMatrix[h]=e.shadow.matrix,g++}r.point[h]=t,h++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(v*y),t.groundColor.copy(e.groundColor).multiplyScalar(v*y),r.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=qR.LTC_FLOAT_1,r.rectAreaLTC2=qR.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=qR.LTC_HALF_1,r.rectAreaLTC2=qR.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=c;const v=r.hash;v.directionalLength===u&&v.pointLength===h&&v.spotLength===d&&v.rectAreaLength===p&&v.hemiLength===f&&v.numDirectionalShadows===m&&v.numPointShadows===g&&v.numSpotShadows===_||(r.directional.length=u,r.spot.length=d,r.rectArea.length=p,r.point.length=h,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotShadowMatrix.length=_,v.directionalLength=u,v.pointLength=h,v.spotLength=d,v.rectAreaLength=p,v.hemiLength=f,v.numDirectionalShadows=m,v.numPointShadows=g,v.numSpotShadows=_,r.version=uN++)},setupView:function(t,e){let i=0,n=0,l=0,c=0,u=0;const h=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[i];t.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(o),t.direction.transformDirection(h),i++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(o),t.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),a.identity(),s.copy(d.matrixWorld),s.premultiply(h),a.extractRotation(s),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const t=r.point[n];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),n++}else if(d.isHemisphereLight){const t=r.hemi[u];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(h),t.direction.normalize(),u++}}},state:r}}function pN(t,e){const i=new dN(t,e),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(t){i.setup(n,t)},setupLightsView:function(t){i.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function fN(t,e){let i=new WeakMap;return{get:function(n,r=0){let o;return!1===i.has(n)?(o=new pN(t,e),i.set(n,[o])):r>=i.get(n).length?(o=new pN(t,e),i.get(n).push(o)):o=i.get(n)[r],o},dispose:function(){i=new WeakMap}}}class mN extends GL{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}mN.prototype.isMeshDepthMaterial=!0;class gN extends GL{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new CP,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}gN.prototype.isMeshDistanceMaterial=!0;const _N="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",yN="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function vN(t,e,i){let n=new VR;const r=new lP,o=new lP,s=new SP,a=new mN({depthPacking:WA}),l=new gN,c={},u=i.maxTextureSize,h={0:UI,1:BI,2:VI},d=new CR({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new lP},radius:{value:4}},vertexShader:_N,fragmentShader:yN}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new rR;f.setAttribute("position",new XL(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new wR(f,d),g=this;function _(i,n){const r=e.update(m);d.defines.VSM_SAMPLES!==i.blurSamples&&(d.defines.VSM_SAMPLES=i.blurSamples,p.defines.VSM_SAMPLES=i.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),d.uniforms.shadow_pass.value=i.map.texture,d.uniforms.resolution.value=i.mapSize,d.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,r,d,m,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,r,p,m,null)}function y(e,i,n,r,o,s,u){let d=null;const p=!0===r.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(d=void 0!==p?p:!0===r.isPointLight?l:a,t.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const t=d.uuid,e=n.uuid;let i=c[t];void 0===i&&(i={},c[t]=i);let r=i[e];void 0===r&&(r=d.clone(),i[e]=r),d=r}return d.visible=n.visible,d.wireframe=n.wireframe,d.side=u===zI?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],d.alphaMap=n.alphaMap,d.alphaTest=n.alphaTest,d.clipShadows=n.clipShadows,d.clippingPlanes=n.clippingPlanes,d.clipIntersection=n.clipIntersection,d.displacementMap=n.displacementMap,d.displacementScale=n.displacementScale,d.displacementBias=n.displacementBias,d.wireframeLinewidth=n.wireframeLinewidth,d.linewidth=n.linewidth,!0===r.isPointLight&&!0===d.isMeshDistanceMaterial&&(d.referencePosition.setFromMatrixPosition(r.matrixWorld),d.nearDistance=o,d.farDistance=s),d}function v(i,r,o,s,a){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&a===zI)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,i.matrixWorld);const n=e.update(i),r=i.material;if(Array.isArray(r)){const e=n.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],u=r[c.materialIndex];if(u&&u.visible){const e=y(i,0,u,s,o.near,o.far,a);t.renderBufferDirect(o,null,n,e,i,c)}}}else if(r.visible){const e=y(i,0,r,s,o.near,o.far,a);t.renderBufferDirect(o,null,n,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)v(l[t],r,o,s,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=OI,this.render=function(e,i,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),d=t.state;d.setBlending(jI),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,c=e.length;l<c;l++){const c=e[l],h=c.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;r.copy(h.mapSize);const p=h.getFrameExtents();if(r.multiply(p),o.copy(h.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(o.x=Math.floor(u/p.x),r.x=o.x*p.x,h.mapSize.x=o.x),r.y>u&&(o.y=Math.floor(u/p.y),r.y=o.y*p.y,h.mapSize.y=o.y)),null===h.map&&!h.isPointLightShadow&&this.type===zI){const t={minFilter:BC,magFilter:BC,format:eA};h.map=new TP(r.x,r.y,t),h.map.texture.name=c.name+".shadowMap",h.mapPass=new TP(r.x,r.y,t),h.camera.updateProjectionMatrix()}if(null===h.map){const t={minFilter:OC,magFilter:OC,format:eA};h.map=new TP(r.x,r.y,t),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();const f=h.getViewportCount();for(let t=0;t<f;t++){const e=h.getViewport(t);s.set(o.x*e.x,o.y*e.y,o.x*e.z,o.y*e.w),d.viewport(s),h.updateMatrices(c,t),n=h.getFrustum(),v(i,a,h.camera,c,this.type)}h.isPointLightShadow||this.type!==zI||_(h,a),h.needsUpdate=!1}g.needsUpdate=!1,t.setRenderTarget(l,c,h)}}function xN(t,e,i){const n=i.isWebGL2,r=new function(){let e=!1;const i=new SP;let n=null;const r=new SP(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,o,s,a){!0===a&&(e*=s,n*=s,o*=s),i.set(e,n,o,s),!1===r.equals(i)&&(t.clearColor(e,n,o,s),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},o=new function(){let e=!1,i=null,n=null,r=null;return{setTest:function(t){t?z(2929):B(2929)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case uC:t.depthFunc(512);break;case hC:t.depthFunc(519);break;case dC:t.depthFunc(513);break;case pC:t.depthFunc(515);break;case fC:t.depthFunc(514);break;case mC:t.depthFunc(518);break;case gC:t.depthFunc(516);break;case _C:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},s=new function(){let e=!1,i=null,n=null,r=null,o=null,s=null,a=null,l=null,c=null;return{setTest:function(t){e||(t?z(2960):B(2960))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,s){n===e&&r===i&&o===s||(t.stencilFunc(e,i,s),n=e,r=i,o=s)},setOp:function(e,i,n){s===e&&a===i&&l===n||(t.stencilOp(e,i,n),s=e,a=i,l=n)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,i=null,n=null,r=null,o=null,s=null,a=null,l=null,c=null}}};let a={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,_=null,y=null,v=null,x=!1,b=null,w=null,E=null,S=null,T=null;const M=t.getParameter(35661);let I=!1,C=0;const A=t.getParameter(7938);-1!==A.indexOf("WebGL")?(C=parseFloat(/^WebGL (\d)/.exec(A)[1]),I=C>=1):-1!==A.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL ES (\d)/.exec(A)[1]),I=C>=2);let P=null,L={};const R=t.getParameter(3088),D=t.getParameter(2978),k=(new SP).fromArray(R),N=(new SP).fromArray(D);function O(e,i,n){const r=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<n;e++)t.texImage2D(i+e,0,6408,1,1,0,6408,5121,r);return o}const F={};function z(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function B(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}F[3553]=O(3553,3553,1),F[34067]=O(34067,34069,6),r.setClear(0,0,0,1),o.setClear(1),s.setClear(0),z(2929),o.setFunc(pC),G(!1),H(kI),z(2884),j(jI);const U={[$I]:32774,[YI]:32778,[ZI]:32779};if(n)U[KI]=32775,U[JI]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(U[KI]=t.MIN_EXT,U[JI]=t.MAX_EXT)}const V={[QI]:0,[tC]:1,[eC]:768,[nC]:770,[cC]:776,[aC]:774,[oC]:772,[iC]:769,[rC]:771,[lC]:775,[sC]:773};function j(e,i,n,r,o,s,a,l){if(e!==jI){if(!1===d&&(z(3042),d=!0),e===XI)o=o||i,s=s||n,a=a||r,i===f&&o===_||(t.blendEquationSeparate(U[i],U[o]),f=i,_=o),n===m&&r===g&&s===y&&a===v||(t.blendFuncSeparate(V[n],V[r],V[s],V[a]),m=n,g=r,y=s,v=a),p=e,x=null;else if(e!==p||l!==x){if(f===$I&&_===$I||(t.blendEquation(32774),f=$I,_=$I),l)switch(e){case GI:t.blendFuncSeparate(1,771,1,771);break;case HI:t.blendFunc(1,1);break;case WI:t.blendFuncSeparate(0,769,0,1);break;case qI:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case GI:t.blendFuncSeparate(770,771,1,771);break;case HI:t.blendFunc(770,1);break;case WI:t.blendFuncSeparate(0,769,0,1);break;case qI:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}m=null,g=null,y=null,v=null,p=e,x=l}}else!0===d&&(B(3042),d=!1)}function G(e){b!==e&&(e?t.frontFace(2304):t.frontFace(2305),b=e)}function H(e){e!==DI?(z(2884),e!==w&&(e===kI?t.cullFace(1029):e===NI?t.cullFace(1028):t.cullFace(1032))):B(2884),w=e}function W(e,i,n){e?(z(32823),S===i&&T===n||(t.polygonOffset(i,n),S=i,T=n)):B(32823)}function q(e){void 0===e&&(e=33984+M-1),P!==e&&(t.activeTexture(e),P=e)}return{buffers:{color:r,depth:o,stencil:s},enable:z,disable:B,bindFramebuffer:function(e,i){return l[e]!==i&&(t.bindFramebuffer(e,i),l[e]=i,n&&(36009===e&&(l[36160]=i),36160===e&&(l[36009]=i)),!0)},drawBuffers:function(n,r){let o=u,s=!1;if(n)if(o=c.get(r),void 0===o&&(o=[],c.set(r,o)),n.isWebGLMultipleRenderTargets){const t=n.texture;if(o.length!==t.length||36064!==o[0]){for(let e=0,i=t.length;e<i;e++)o[e]=36064+e;o.length=t.length,s=!0}}else 36064!==o[0]&&(o[0]=36064,s=!0);else 1029!==o[0]&&(o[0]=1029,s=!0);s&&(i.isWebGL2?t.drawBuffers(o):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(o))},useProgram:function(e){return h!==e&&(t.useProgram(e),h=e,!0)},setBlending:j,setMaterial:function(t,e){t.side===VI?B(2884):z(2884);let i=t.side===UI;e&&(i=!i),G(i),t.blending===GI&&!1===t.transparent?j(jI):j(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),r.setMask(t.colorWrite);const n=t.stencilWrite;s.setTest(n),n&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),W(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?z(32926):B(32926)},setFlipSided:G,setCullFace:H,setLineWidth:function(e){e!==E&&(I&&t.lineWidth(e),E=e)},setPolygonOffset:W,setScissorTest:function(t){t?z(3089):B(3089)},activeTexture:q,bindTexture:function(e,i){null===P&&q();let n=L[P];void 0===n&&(n={type:void 0,texture:void 0},L[P]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||F[e]),n.type=e,n.texture=i)},unbindTexture:function(){const e=L[P];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===k.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),k.copy(e))},viewport:function(e){!1===N.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),N.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===n&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),a={},P=null,L={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,_=null,y=null,v=null,x=!1,b=null,w=null,E=null,S=null,T=null,k.set(0,0,t.canvas.width,t.canvas.height),N.set(0,0,t.canvas.width,t.canvas.height),r.reset(),o.reset(),s.reset()}}}function bN(t,e,i,n,r,o,s){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):void 0,p=new WeakMap;let f,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function g(t,e){return m?new OffscreenCanvas(t,e):hP("canvas")}function _(t,e,i,n){let r=1;if((t.width>n||t.height>n)&&(r=n/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?aP:Math.floor,o=n(r*t.width),s=n(r*t.height);void 0===f&&(f=g(o,s));const a=i?g(o,s):f;return a.width=o,a.height=s,a.getContext("2d").drawImage(t,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+o+"x"+s+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function y(t){return sP(t.width)&&sP(t.height)}function v(t,e){return t.generateMipmaps&&e&&t.minFilter!==OC&&t.minFilter!==BC}function x(e){t.generateMipmap(e)}function b(i,n,r,o,s=!1){if(!1===a)return n;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let l=n;return 6403===n&&(5126===r&&(l=33326),5131===r&&(l=33325),5121===r&&(l=33321)),33319===n&&(5126===r&&(l=33328),5131===r&&(l=33327),5121===r&&(l=33323)),6408===n&&(5126===r&&(l=34836),5131===r&&(l=34842),5121===r&&(l=o===HA&&!1===s?35907:32856),32819===r&&(l=32854),32820===r&&(l=32855)),33325!==l&&33326!==l&&33327!==l&&33328!==l&&34842!==l&&34836!==l||e.get("EXT_color_buffer_float"),l}function w(t,e,i){return!0===v(t,i)||t.isFramebufferTexture&&t.minFilter!==OC&&t.minFilter!==BC?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function E(t){return t===OC||t===FC||t===zC?9728:9729}function S(e){const i=e.target;i.removeEventListener("dispose",S),function(e){const i=n.get(e);void 0!==i.__webglInit&&(t.deleteTexture(i.__webglTexture),n.remove(e))}(i),i.isVideoTexture&&p.delete(i),s.memory.textures--}function T(e){const i=e.target;i.removeEventListener("dispose",T),function(e){const i=e.texture,r=n.get(e),o=n.get(i);if(e){if(void 0!==o.__webglTexture&&(t.deleteTexture(o.__webglTexture),s.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&t.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),s.memory.textures--),n.remove(i[e])}n.remove(i),n.remove(e)}}(i)}let M=0;function I(t,e){const r=n.get(t);if(t.isVideoTexture&&function(t){const e=s.render.frame;p.get(t)!==e&&(p.set(t,e),t.update())}(t),t.version>0&&r.__version!==t.version){const i=t.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void D(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+e),i.bindTexture(3553,r.__webglTexture)}function C(e,r){const s=n.get(e);e.version>0&&s.__version!==e.version?function(e,n,r){if(6!==n.image.length)return;R(e,n),i.activeTexture(33984+r),i.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const s=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),l=n.image[0]&&n.image[0].isDataTexture,u=[];for(let t=0;t<6;t++)u[t]=s||l?l?n.image[t].image:n.image[t]:_(n.image[t],!1,!0,c),u[t]=z(n,u[t]);const h=u[0],d=y(h)||a,p=o.convert(n.format,n.encoding),f=o.convert(n.type),m=b(n.internalFormat,p,f,n.encoding),g=a&&!0!==n.isVideoTexture,E=void 0===e.__version;let S,T=w(n,h,d);if(L(34067,n,d),s){g&&E&&i.texStorage2D(34067,T,m,h.width,h.height);for(let t=0;t<6;t++){S=u[t].mipmaps;for(let e=0;e<S.length;e++){const r=S[e];n.format!==eA?null!==p?g?i.compressedTexSubImage2D(34069+t,e,0,0,r.width,r.height,p,r.data):i.compressedTexImage2D(34069+t,e,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g?i.texSubImage2D(34069+t,e,0,0,r.width,r.height,p,f,r.data):i.texImage2D(34069+t,e,m,r.width,r.height,0,p,f,r.data)}}}else{S=n.mipmaps,g&&E&&(S.length>0&&T++,i.texStorage2D(34067,T,m,u[0].width,u[0].height));for(let t=0;t<6;t++)if(l){g?i.texSubImage2D(34069+t,0,0,0,u[t].width,u[t].height,p,f,u[t].data):i.texImage2D(34069+t,0,m,u[t].width,u[t].height,0,p,f,u[t].data);for(let e=0;e<S.length;e++){const n=S[e].image[t].image;g?i.texSubImage2D(34069+t,e+1,0,0,n.width,n.height,p,f,n.data):i.texImage2D(34069+t,e+1,m,n.width,n.height,0,p,f,n.data)}}else{g?i.texSubImage2D(34069+t,0,0,0,p,f,u[t]):i.texImage2D(34069+t,0,m,p,f,u[t]);for(let e=0;e<S.length;e++){const n=S[e];g?i.texSubImage2D(34069+t,e+1,0,0,p,f,n.image[t]):i.texImage2D(34069+t,e+1,m,p,f,n.image[t])}}}v(n,d)&&x(34067),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}(s,e,r):(i.activeTexture(33984+r),i.bindTexture(34067,s.__webglTexture))}const A={[DC]:10497,[kC]:33071,[NC]:33648},P={[OC]:9728,[FC]:9984,[zC]:9986,[BC]:9729,[UC]:9985,[VC]:9987};function L(i,o,s){if(s?(t.texParameteri(i,10242,A[o.wrapS]),t.texParameteri(i,10243,A[o.wrapT]),32879!==i&&35866!==i||t.texParameteri(i,32882,A[o.wrapR]),t.texParameteri(i,10240,P[o.magFilter]),t.texParameteri(i,10241,P[o.minFilter])):(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071),32879!==i&&35866!==i||t.texParameteri(i,32882,33071),o.wrapS===kC&&o.wrapT===kC||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,10240,E(o.magFilter)),t.texParameteri(i,10241,E(o.minFilter)),o.minFilter!==OC&&o.minFilter!==BC&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const s=e.get("EXT_texture_filter_anisotropic");if(o.type===$C&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&o.type===YC&&!1===e.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||n.get(o).__currentAnisotropy)&&(t.texParameterf(i,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),n.get(o).__currentAnisotropy=o.anisotropy)}}function R(e,i){void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",S),e.__webglTexture=t.createTexture(),s.memory.textures++)}function D(e,n,r){let s=3553;n.isDataTexture2DArray&&(s=35866),n.isDataTexture3D&&(s=32879),R(e,n),i.activeTexture(33984+r),i.bindTexture(s,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const l=function(t){return!a&&(t.wrapS!==kC||t.wrapT!==kC||t.minFilter!==OC&&t.minFilter!==BC)}(n)&&!1===y(n.image);let c=_(n.image,l,!1,u);c=z(n,c);const h=y(c)||a,d=o.convert(n.format,n.encoding);let p,f=o.convert(n.type),m=b(n.internalFormat,d,f,n.encoding,n.isVideoTexture);L(s,n,h);const g=n.mipmaps,E=a&&!0!==n.isVideoTexture,S=void 0===e.__version,T=w(n,c,h);if(n.isDepthTexture)m=6402,a?m=n.type===$C?36012:n.type===XC?33190:n.type===JC?35056:33189:n.type===$C&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===rA&&6402===m&&n.type!==WC&&n.type!==XC&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=WC,f=o.convert(n.type)),n.format===oA&&6402===m&&(m=34041,n.type!==JC&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=JC,f=o.convert(n.type))),E&&S?i.texStorage2D(3553,1,m,c.width,c.height):i.texImage2D(3553,0,m,c.width,c.height,0,d,f,null);else if(n.isDataTexture)if(g.length>0&&h){E&&S&&i.texStorage2D(3553,T,m,g[0].width,g[0].height);for(let t=0,e=g.length;t<e;t++)p=g[t],E?i.texSubImage2D(3553,0,0,0,p.width,p.height,d,f,p.data):i.texImage2D(3553,t,m,p.width,p.height,0,d,f,p.data);n.generateMipmaps=!1}else E?(S&&i.texStorage2D(3553,T,m,c.width,c.height),i.texSubImage2D(3553,0,0,0,c.width,c.height,d,f,c.data)):i.texImage2D(3553,0,m,c.width,c.height,0,d,f,c.data);else if(n.isCompressedTexture){E&&S&&i.texStorage2D(3553,T,m,g[0].width,g[0].height);for(let t=0,e=g.length;t<e;t++)p=g[t],n.format!==eA?null!==d?E?i.compressedTexSubImage2D(3553,t,0,0,p.width,p.height,d,p.data):i.compressedTexImage2D(3553,t,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?i.texSubImage2D(3553,t,0,0,p.width,p.height,d,f,p.data):i.texImage2D(3553,t,m,p.width,p.height,0,d,f,p.data)}else if(n.isDataTexture2DArray)E?(S&&i.texStorage3D(35866,T,m,c.width,c.height,c.depth),i.texSubImage3D(35866,0,0,0,0,c.width,c.height,c.depth,d,f,c.data)):i.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,f,c.data);else if(n.isDataTexture3D)E?(S&&i.texStorage3D(32879,T,m,c.width,c.height,c.depth),i.texSubImage3D(32879,0,0,0,0,c.width,c.height,c.depth,d,f,c.data)):i.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,f,c.data);else if(n.isFramebufferTexture)E&&S?i.texStorage2D(3553,T,m,c.width,c.height):i.texImage2D(3553,0,m,c.width,c.height,0,d,f,null);else if(g.length>0&&h){E&&S&&i.texStorage2D(3553,T,m,g[0].width,g[0].height);for(let t=0,e=g.length;t<e;t++)p=g[t],E?i.texSubImage2D(3553,t,0,0,d,f,p):i.texImage2D(3553,t,m,d,f,p);n.generateMipmaps=!1}else E?(S&&i.texStorage2D(3553,T,m,c.width,c.height),i.texSubImage2D(3553,0,0,0,d,f,c)):i.texImage2D(3553,0,m,d,f,c);v(n,h)&&x(s),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}function k(e,r,s,a,l){const c=o.convert(s.format,s.encoding),u=o.convert(s.type),h=b(s.internalFormat,c,u,s.encoding);n.get(r).__hasExternalTextures||(32879===l||35866===l?i.texImage3D(l,0,h,r.width,r.height,r.depth,0,c,u,null):i.texImage2D(l,0,h,r.width,r.height,0,c,u,null)),i.bindFramebuffer(36160,e),r.useRenderToTexture?d.framebufferTexture2DMultisampleEXT(36160,a,l,n.get(s).__webglTexture,0,F(r)):t.framebufferTexture2D(36160,a,l,n.get(s).__webglTexture,0),i.bindFramebuffer(36160,null)}function N(e,i,n){if(t.bindRenderbuffer(36161,e),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n||i.useRenderToTexture){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===$C?r=36012:e.type===XC&&(r=33190));const n=F(i);i.useRenderToTexture?d.renderbufferStorageMultisampleEXT(36161,n,r,i.width,i.height):t.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else t.renderbufferStorage(36161,r,i.width,i.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(i.depthBuffer&&i.stencilBuffer){const r=F(i);n&&i.useRenderbuffer?t.renderbufferStorageMultisample(36161,r,35056,i.width,i.height):i.useRenderToTexture?d.renderbufferStorageMultisampleEXT(36161,r,35056,i.width,i.height):t.renderbufferStorage(36161,34041,i.width,i.height),t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,r=o.convert(e.format,e.encoding),s=o.convert(e.type),a=b(e.internalFormat,r,s,e.encoding),l=F(i);n&&i.useRenderbuffer?t.renderbufferStorageMultisample(36161,l,a,i.width,i.height):i.useRenderToTexture?d.renderbufferStorageMultisampleEXT(36161,l,a,i.width,i.height):t.renderbufferStorage(36161,a,i.width,i.height)}t.bindRenderbuffer(36161,null)}function O(e){const r=n.get(e),o=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),I(r.depthTexture,0);const o=n.get(r.depthTexture).__webglTexture,s=F(r);if(r.depthTexture.format===rA)r.useRenderToTexture?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,o,0,s):t.framebufferTexture2D(36160,36096,3553,o,0);else{if(r.depthTexture.format!==oA)throw new Error("Unknown depthTexture format");r.useRenderToTexture?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,o,0,s):t.framebufferTexture2D(36160,33306,3553,o,0)}}(r.__webglFramebuffer,e)}else if(o){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=t.createRenderbuffer(),N(r.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),N(r.__webglDepthbuffer,e,!1);i.bindFramebuffer(36160,null)}function F(t){return a&&(t.useRenderbuffer||t.useRenderToTexture)?Math.min(h,t.samples):0}function z(t,i){const n=t.encoding,r=t.format,o=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===JA||n!==GA&&(n===HA?!1===a?!0===e.has("EXT_sRGB")&&r===eA?(t.format=JA,t.minFilter=BC,t.generateMipmaps=!1):i=xP.sRGBToLinear(i):r===eA&&o===jC||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",n)),i}let B=!1,U=!1;this.allocateTextureUnit=function(){const t=M;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),M+=1,t},this.resetTextureUnits=function(){M=0},this.setTexture2D=I,this.setTexture2DArray=function(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?D(r,t,e):(i.activeTexture(33984+e),i.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?D(r,t,e):(i.activeTexture(33984+e),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=C,this.rebindTextures=function(t,e,i){const r=n.get(t);void 0!==e&&k(r.__webglFramebuffer,t,t.texture,36064,3553),void 0!==i&&O(t)},this.setupRenderTarget=function(e){const l=e.texture,c=n.get(e),u=n.get(l);e.addEventListener("dispose",T),!0!==e.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=t.createTexture()),u.__version=l.version,s.memory.textures++);const h=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=l.isDataTexture3D||l.isDataTexture2DArray,f=y(e)||a;if(h){c.__webglFramebuffer=[];for(let e=0;e<6;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else if(c.__webglFramebuffer=t.createFramebuffer(),d)if(r.drawBuffers){const i=e.texture;for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(e.useRenderbuffer)if(a){c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const n=o.convert(l.format,l.encoding),r=o.convert(l.type),s=b(l.internalFormat,n,r,l.encoding),a=F(e);t.renderbufferStorageMultisample(36161,a,s,e.width,e.height),i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),N(c.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){i.bindTexture(34067,u.__webglTexture),L(34067,l,f);for(let t=0;t<6;t++)k(c.__webglFramebuffer[t],e,l,36064,34069+t);v(l,f)&&x(34067),i.unbindTexture()}else if(d){const t=e.texture;for(let r=0,o=t.length;r<o;r++){const o=t[r],s=n.get(o);i.bindTexture(3553,s.__webglTexture),L(3553,o,f),k(c.__webglFramebuffer,e,o,36064+r,3553),v(o,f)&&x(3553)}i.unbindTexture()}else{let t=3553;p&&(a?t=l.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),i.bindTexture(t,u.__webglTexture),L(t,l,f),k(c.__webglFramebuffer,e,l,36064,t),v(l,f)&&x(t),i.unbindTexture()}e.depthBuffer&&O(e)},this.updateRenderTargetMipmap=function(t){const e=y(t)||a,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let o=0,s=r.length;o<s;o++){const s=r[o];if(v(s,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,r=n.get(s).__webglTexture;i.bindTexture(e,r),x(e),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.useRenderbuffer)if(a){const r=e.width,o=e.height;let s=16384;const a=[36064],l=e.stencilBuffer?33306:36096;e.depthBuffer&&a.push(l),e.ignoreDepthForMultisampleCopy||(e.depthBuffer&&(s|=256),e.stencilBuffer&&(s|=1024));const c=n.get(e);i.bindFramebuffer(36008,c.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,c.__webglFramebuffer),e.ignoreDepthForMultisampleCopy&&(t.invalidateFramebuffer(36008,[l]),t.invalidateFramebuffer(36009,[l])),t.blitFramebuffer(0,0,r,o,0,0,r,o,s,9728),t.invalidateFramebuffer(36008,a),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,c.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.setupDepthRenderbuffer=O,this.setupFrameBufferTexture=k,this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),B=!0),t=t.texture),I(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),U=!0),t=t.texture),C(t,e)}}function wN(t,e,i){const n=i.isWebGL2;return{convert:function(t,i=null){let r;if(t===jC)return 5121;if(t===ZC)return 32819;if(t===KC)return 32820;if(t===GC)return 5120;if(t===HC)return 5122;if(t===WC)return 5123;if(t===qC)return 5124;if(t===XC)return 5125;if(t===$C)return 5126;if(t===YC)return n?5131:(r=e.get("OES_texture_half_float"),null!==r?r.HALF_FLOAT_OES:null);if(t===QC)return 6406;if(t===eA)return 6408;if(t===iA)return 6409;if(t===nA)return 6410;if(t===rA)return 6402;if(t===oA)return 34041;if(t===sA)return 6403;if(t===tA)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(t===JA)return r=e.get("EXT_sRGB"),null!==r?r.SRGB_ALPHA_EXT:null;if(t===aA)return 36244;if(t===lA)return 33319;if(t===cA)return 33320;if(t===uA)return 36249;if(t===hA||t===dA||t===pA||t===fA)if(i===HA){if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(t===hA)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===dA)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===pA)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===fA)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=e.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(t===hA)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===dA)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===pA)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===fA)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===mA||t===gA||t===_A||t===yA){if(r=e.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(t===mA)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===gA)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===_A)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===yA)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===vA)return r=e.get("WEBGL_compressed_texture_etc1"),null!==r?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(t===xA||t===bA){if(r=e.get("WEBGL_compressed_texture_etc"),null===r)return null;if(t===xA)return i===HA?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(t===bA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(t===wA||t===EA||t===SA||t===TA||t===MA||t===IA||t===CA||t===AA||t===PA||t===LA||t===RA||t===DA||t===kA||t===NA){if(r=e.get("WEBGL_compressed_texture_astc"),null===r)return null;if(t===wA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(t===EA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(t===SA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(t===TA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(t===MA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(t===IA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(t===CA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(t===AA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(t===PA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(t===LA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(t===RA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(t===DA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(t===kA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(t===NA)return i===HA?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(t===OA){if(r=e.get("EXT_texture_compression_bptc"),null===r)return null;if(t===OA)return i===HA?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}return t===JC?n?34042:(r=e.get("WEBGL_depth_texture"),null!==r?r.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class EN extends PR{constructor(t=[]){super(),this.cameras=t}}EN.prototype.isArrayCamera=!0;class SN extends PL{constructor(){super(),this.type="Group"}}SN.prototype.isGroup=!0;const TN={type:"move"};class MN{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new SN,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new SN,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new CP,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new CP),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new SN,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new CP,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new CP),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,r=null,o=null;const s=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==s&&(n=e.getPose(t.targetRaySpace,i),null!==n&&(s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),n.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(n.linearVelocity)):s.hasLinearVelocity=!1,n.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(n.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(TN))),l&&t.hand){o=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const t=new SN;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[n.jointName]=t,l.add(t)}const r=l.joints[n.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],s=n.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&s>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&s<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));return null!==s&&(s.visible=null!==n),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==o),this}}class IN extends wP{constructor(t,e,i,n,r,o,s,a,l,c){if((c=void 0!==c?c:rA)!==rA&&c!==oA)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===rA&&(i=WC),void 0===i&&c===oA&&(i=JC),super(null,n,r,o,s,a,c,i,l),this.image={width:t,height:e},this.magFilter=void 0!==s?s:OC,this.minFilter=void 0!==a?a:OC,this.flipY=!1,this.generateMipmaps=!1}}IN.prototype.isDepthTexture=!0;class CN extends QA{constructor(t,e){super();const i=this;let n=null,r=1,o=null,s="local-floor";const a=t.extensions.has("WEBGL_multisampled_render_to_texture");let l=null,c=null,u=null,h=null,d=!1,p=null;const f=e.getContextAttributes();let m=null,g=null;const _=[],y=new Map,v=new PR;v.layers.enable(1),v.viewport=new SP;const x=new PR;x.layers.enable(2),x.viewport=new SP;const b=[v,x],w=new EN;w.layers.enable(1),w.layers.enable(2);let E=null,S=null;function T(t){const e=y.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function M(){y.forEach((function(t,e){t.disconnect(e)})),y.clear(),E=null,S=null,t.setRenderTarget(m),h=null,u=null,c=null,n=null,g=null,R.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function I(t){const e=n.inputSources;for(let t=0;t<_.length;t++)y.set(e[t],_[t]);for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=y.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),y.delete(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e],n=y.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=_[t];return void 0===e&&(e=new MN,_[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=_[t];return void 0===e&&(e=new MN,_[t]=e),e.getGripSpace()},this.getHand=function(t){let e=_[t];return void 0===e&&(e=new MN,_[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){s=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return null!==u?u:h},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=async function(l){if(n=l,null!==n){if(m=t.getRenderTarget(),n.addEventListener("select",T),n.addEventListener("selectstart",T),n.addEventListener("selectend",T),n.addEventListener("squeeze",T),n.addEventListener("squeezestart",T),n.addEventListener("squeezeend",T),n.addEventListener("end",M),n.addEventListener("inputsourceschange",I),!0!==f.xrCompatible&&await e.makeXRCompatible(),void 0===n.renderState.layers||!1===t.capabilities.isWebGL2){const i={antialias:void 0!==n.renderState.layers||f.antialias,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(n,e,i),n.updateRenderState({baseLayer:h}),g=new TP(h.framebufferWidth,h.framebufferHeight,{format:eA,type:jC,encoding:t.outputEncoding})}else{d=f.antialias;let i=null,o=null,s=null;f.depth&&(s=f.stencil?35056:33190,i=f.stencil?oA:rA,o=f.stencil?JC:WC);const l={colorFormat:t.outputEncoding===HA?35907:32856,depthFormat:s,scaleFactor:r};c=new XRWebGLBinding(n,e),u=c.createProjectionLayer(l),n.updateRenderState({layers:[u]}),g=d?new MP(u.textureWidth,u.textureHeight,{format:eA,type:jC,depthTexture:new IN(u.textureWidth,u.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:f.stencil,ignoreDepth:u.ignoreDepthValues,useRenderToTexture:a,encoding:t.outputEncoding}):new TP(u.textureWidth,u.textureHeight,{format:eA,type:jC,depthTexture:new IN(u.textureWidth,u.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:f.stencil,ignoreDepth:u.ignoreDepthValues,encoding:t.outputEncoding})}g.isXRRenderTarget=!0,this.setFoveation(1),o=await n.requestReferenceSpace(s),R.setContext(n),R.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const C=new CP,A=new CP;function P(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===n)return;w.near=x.near=v.near=t.near,w.far=x.far=v.far=t.far,E===w.near&&S===w.far||(n.updateRenderState({depthNear:w.near,depthFar:w.far}),E=w.near,S=w.far);const e=t.parent,i=w.cameras;P(w,e);for(let t=0;t<i.length;t++)P(i[t],e);w.matrixWorld.decompose(w.position,w.quaternion,w.scale),t.position.copy(w.position),t.quaternion.copy(w.quaternion),t.scale.copy(w.scale),t.matrix.copy(w.matrix),t.matrixWorld.copy(w.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);2===i.length?function(t,e,i){C.setFromMatrixPosition(e.matrixWorld),A.setFromMatrixPosition(i.matrixWorld);const n=C.distanceTo(A),r=e.projectionMatrix.elements,o=i.projectionMatrix.elements,s=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(o[8]+1)/o[0],d=s*u,p=s*h,f=n/(-u+h),m=f*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=s+f,_=a+f,y=d-m,v=p+(n-m),x=l*a/_*g,b=c*a/_*g;t.projectionMatrix.makePerspective(y,v,x,b,g,_)}(w,v,x):w.projectionMatrix.copy(v.projectionMatrix)},this.getCamera=function(){return w},this.getFoveation=function(){return null!==u?u.fixedFoveation:null!==h?h.fixedFoveation:void 0},this.setFoveation=function(t){null!==u&&(u.fixedFoveation=t),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=t)};let L=null;const R=new jR;R.setAnimationLoop((function(e,i){if(l=i.getViewerPose(o),p=i,null!==l){const e=l.views;null!==h&&(t.setRenderTargetFramebuffer(g,h.framebuffer),t.setRenderTarget(g));let i=!1;e.length!==w.cameras.length&&(w.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const r=e[n];let o=null;if(null!==h)o=h.getViewport(r);else{const e=c.getViewSubImage(u,r);o=e.viewport,0===n&&(t.setRenderTargetTextures(g,e.colorTexture,u.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(g))}const s=b[n];s.matrix.fromArray(r.transform.matrix),s.projectionMatrix.fromArray(r.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===n&&w.matrix.copy(s.matrix),!0===i&&w.cameras.push(s)}}const r=n.inputSources;for(let t=0;t<_.length;t++){const e=_[t],n=r[t];e.update(n,i,o)}L&&L(e,i),p=null})),this.setAnimationLoop=function(t){L=t},this.dispose=function(){}}}function AN(t){function e(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map),i.alphaMap&&(e.alphaMap.value=i.alphaMap),i.specularMap&&(e.specularMap.value=i.specularMap),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);const n=t.get(i).envMap;let r,o;n&&(e.envMap.value=n,e.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio),i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap?r=i.clearcoatRoughnessMap:i.specularIntensityMap?r=i.specularIntensityMap:i.specularColorMap?r=i.specularColorMap:i.transmissionMap?r=i.transmissionMap:i.thicknessMap?r=i.thicknessMap:i.sheenColorMap?r=i.sheenColorMap:i.sheenRoughnessMap&&(r=i.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),i.aoMap?o=i.aoMap:i.lightMap&&(o=i.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uv2Transform.value.copy(o.matrix))}function i(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap),i.bumpMap&&(e.bumpMap.value=i.bumpMap,e.bumpScale.value=i.bumpScale,i.side===UI&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,e.normalScale.value.copy(i.normalScale),i.side===UI&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias),t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,n,r,o,s){n.isMeshBasicMaterial?e(t,n):n.isMeshLambertMaterial?(e(t,n),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,n)):n.isMeshToonMaterial?(e(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===UI&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===UI&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshPhongMaterial?(e(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===UI&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===UI&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshStandardMaterial?(e(t,n),n.isMeshPhysicalMaterial?function(t,e,n){i(t,e),t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap)),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===UI&&t.clearcoatNormalScale.value.negate())),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,n,s):i(t,n)):n.isMeshMatcapMaterial?(e(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===UI&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===UI&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDepthMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDistanceMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?(e(t,n),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===UI&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===UI&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,i,n){let r;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?r=e.map:e.alphaMap&&(r=e.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,n,r,o):n.isSpriteMaterial?function(t,e){let i;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?i=e.map:e.alphaMap&&(i=e.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function PN(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=hP("canvas");return t.style.display="block",t}(),i=void 0!==t.context?t.context:null,n=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",u=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let h=null,d=null;const p=[],f=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=GA,this.physicallyCorrectLights=!1,this.toneMapping=bC,this.toneMappingExposure=1;const m=this;let g=!1,_=0,y=0,v=null,x=-1,b=null;const w=new SP,E=new SP;let S=null,T=e.width,M=e.height,I=1,C=null,A=null;const P=new SP(0,0,T,M),L=new SP(0,0,T,M);let R=!1;const D=new VR;let k=!1,N=!1,O=null;const F=new oL,z=new CP,B={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function U(){return null===v?I:1}let V,j,G,H,W,q,X,$,Y,Z,K,J,Q,tt,et,it,nt,rt,ot,st,at,lt,ct,ut=i;function ht(t,i){for(let n=0;n<t.length;n++){const r=t[n],o=e.getContext(r,i);if(null!==o)return o}return null}try{const t={alpha:!0,depth:r,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${RI}`),e.addEventListener("webglcontextlost",ft,!1),e.addEventListener("webglcontextrestored",mt,!1),null===ut){const e=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&e.shift(),ut=ht(e,t),null===ut)throw ht(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ut.getShaderPrecisionFormat&&(ut.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function dt(){V=new bD(ut),j=new KR(ut,V,t),V.init(j),lt=new wN(ut,V,j),G=new xN(ut,V,j),H=new SD(ut),W=new rN,q=new bN(ut,V,G,W,j,lt,H),X=new QR(m),$=new xD(m),Y=new GR(ut,j),ct=new YR(ut,V,Y,j),Z=new wD(ut,Y,H,ct),K=new PD(ut,Z,Y,H),ot=new AD(ut,j,q),it=new JR(W),J=new nN(m,X,$,V,j,ct,it),Q=new AN(W),tt=new lN,et=new fN(V,j),rt=new $R(m,X,G,K,n,a),nt=new vN(m,K,j),st=new ZR(ut,V,H,j),at=new ED(ut,V,H,j),H.programs=J.programs,m.capabilities=j,m.extensions=V,m.properties=W,m.renderLists=tt,m.shadowMap=nt,m.state=G,m.info=H}dt();const pt=new CN(m,ut);function ft(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function mt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const t=H.autoReset,e=nt.enabled,i=nt.autoUpdate,n=nt.needsUpdate,r=nt.type;dt(),H.autoReset=t,nt.enabled=e,nt.autoUpdate=i,nt.needsUpdate=n,nt.type=r}function gt(t){const e=t.target;e.removeEventListener("dispose",gt),function(t){(function(t){const e=W.get(t).programs;void 0!==e&&(e.forEach((function(t){J.releaseProgram(t)})),t.isShaderMaterial&&J.releaseShaderCache(t))})(t),W.remove(t)}(e)}this.xr=pt,this.getContext=function(){return ut},this.getContextAttributes=function(){return ut.getContextAttributes()},this.forceContextLoss=function(){const t=V.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=V.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(t){void 0!==t&&(I=t,this.setSize(T,M,!1))},this.getSize=function(t){return t.set(T,M)},this.setSize=function(t,i,n){pt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=t,M=i,e.width=Math.floor(t*I),e.height=Math.floor(i*I),!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(T*I,M*I).floor()},this.setDrawingBufferSize=function(t,i,n){T=t,M=i,I=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(w)},this.getViewport=function(t){return t.copy(P)},this.setViewport=function(t,e,i,n){t.isVector4?P.set(t.x,t.y,t.z,t.w):P.set(t,e,i,n),G.viewport(w.copy(P).multiplyScalar(I).floor())},this.getScissor=function(t){return t.copy(L)},this.setScissor=function(t,e,i,n){t.isVector4?L.set(t.x,t.y,t.z,t.w):L.set(t,e,i,n),G.scissor(E.copy(L).multiplyScalar(I).floor())},this.getScissorTest=function(){return R},this.setScissorTest=function(t){G.setScissorTest(R=t)},this.setOpaqueSort=function(t){C=t},this.setTransparentSort=function(t){A=t},this.getClearColor=function(t){return t.copy(rt.getClearColor())},this.setClearColor=function(){rt.setClearColor.apply(rt,arguments)},this.getClearAlpha=function(){return rt.getClearAlpha()},this.setClearAlpha=function(){rt.setClearAlpha.apply(rt,arguments)},this.clear=function(t,e,i){let n=0;(void 0===t||t)&&(n|=16384),(void 0===e||e)&&(n|=256),(void 0===i||i)&&(n|=1024),ut.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ft,!1),e.removeEventListener("webglcontextrestored",mt,!1),tt.dispose(),et.dispose(),W.dispose(),X.dispose(),$.dispose(),K.dispose(),ct.dispose(),J.dispose(),pt.dispose(),pt.removeEventListener("sessionstart",yt),pt.removeEventListener("sessionend",vt),O&&(O.dispose(),O=null),xt.stop()},this.renderBufferDirect=function(t,e,i,n,r,o){null===e&&(e=B);const s=r.isMesh&&r.matrixWorld.determinant()<0,a=function(t,e,i,n,r){!0!==e.isScene&&(e=B),q.resetTextureUnits();const o=e.fog,s=n.isMeshStandardMaterial?e.environment:null,a=null===v?m.outputEncoding:!0===v.isXRRenderTarget?v.texture.encoding:GA,l=(n.isMeshStandardMaterial?$:X).get(n.envMap||s),c=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,u=!!n.normalMap&&!!i.attributes.tangent,h=!!i.morphAttributes.position,p=!!i.morphAttributes.normal,f=i.morphAttributes.position?i.morphAttributes.position.length:0,g=n.toneMapped?m.toneMapping:bC,_=W.get(n),y=d.state.lights;if(!0===k&&(!0===N||t!==b)){const e=t===b&&n.id===x;it.setState(n,t,e)}let w=!1;n.version===_.__version?_.needsLights&&_.lightsStateVersion!==y.state.version||_.outputEncoding!==a||r.isInstancedMesh&&!1===_.instancing?w=!0:r.isInstancedMesh||!0!==_.instancing?r.isSkinnedMesh&&!1===_.skinning?w=!0:r.isSkinnedMesh||!0!==_.skinning?_.envMap!==l||n.fog&&_.fog!==o?w=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===it.numPlanes&&_.numIntersection===it.numIntersection?(_.vertexAlphas!==c||_.vertexTangents!==u||_.morphTargets!==h||_.morphNormals!==p||_.toneMapping!==g||!0===j.isWebGL2&&_.morphTargetsCount!==f)&&(w=!0):w=!0:w=!0:w=!0:(w=!0,_.__version=n.version);let E=_.currentProgram;!0===w&&(E=Tt(n,e,r));let S=!1,T=!1,C=!1;const A=E.getUniforms(),P=_.uniforms;if(G.useProgram(E.program)&&(S=!0,T=!0,C=!0),n.id!==x&&(x=n.id,T=!0),S||b!==t){if(A.setValue(ut,"projectionMatrix",t.projectionMatrix),j.logarithmicDepthBuffer&&A.setValue(ut,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),b!==t&&(b=t,T=!0,C=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=A.map.cameraPosition;void 0!==e&&e.setValue(ut,z.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&A.setValue(ut,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&A.setValue(ut,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){A.setOptional(ut,r,"bindMatrix"),A.setOptional(ut,r,"bindMatrixInverse");const t=r.skeleton;t&&(j.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),A.setValue(ut,"boneTexture",t.boneTexture,q),A.setValue(ut,"boneTextureSize",t.boneTextureSize)):A.setOptional(ut,t,"boneMatrices"))}var L,R;return!i||void 0===i.morphAttributes.position&&void 0===i.morphAttributes.normal||ot.update(r,i,n,E),(T||_.receiveShadow!==r.receiveShadow)&&(_.receiveShadow=r.receiveShadow,A.setValue(ut,"receiveShadow",r.receiveShadow)),T&&(A.setValue(ut,"toneMappingExposure",m.toneMappingExposure),_.needsLights&&(R=C,(L=P).ambientLightColor.needsUpdate=R,L.lightProbe.needsUpdate=R,L.directionalLights.needsUpdate=R,L.directionalLightShadows.needsUpdate=R,L.pointLights.needsUpdate=R,L.pointLightShadows.needsUpdate=R,L.spotLights.needsUpdate=R,L.spotLightShadows.needsUpdate=R,L.rectAreaLights.needsUpdate=R,L.hemisphereLights.needsUpdate=R),o&&n.fog&&Q.refreshFogUniforms(P,o),Q.refreshMaterialUniforms(P,n,I,M,O),Nk.upload(ut,_.uniformsList,P,q)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Nk.upload(ut,_.uniformsList,P,q),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&A.setValue(ut,"center",r.center),A.setValue(ut,"modelViewMatrix",r.modelViewMatrix),A.setValue(ut,"normalMatrix",r.normalMatrix),A.setValue(ut,"modelMatrix",r.matrixWorld),E}(t,e,i,n,r);G.setMaterial(n,s);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===n.wireframe&&(l=Z.getWireframeAttribute(i),h=2),ct.setup(r,n,a,i,l);let p=st;null!==l&&(u=Y.get(l),p=at,p.setIndex(u));const f=null!==l?l.count:c.count,g=i.drawRange.start*h,_=i.drawRange.count*h,y=null!==o?o.start*h:0,w=null!==o?o.count*h:1/0,E=Math.max(g,y),S=Math.min(f,g+_,y+w)-1,T=Math.max(0,S-E+1);if(0!==T){if(r.isMesh)!0===n.wireframe?(G.setLineWidth(n.wireframeLinewidth*U()),p.setMode(1)):p.setMode(4);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),G.setLineWidth(t*U()),r.isLineSegments?p.setMode(1):r.isLineLoop?p.setMode(2):p.setMode(3)}else r.isPoints?p.setMode(0):r.isSprite&&p.setMode(4);if(r.isInstancedMesh)p.renderInstances(E,T,r.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);p.renderInstances(E,T,t)}else p.render(E,T)}},this.compile=function(t,e){d=et.get(t),d.init(),f.push(d),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights(m.physicallyCorrectLights),t.traverse((function(e){const i=e.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++)Tt(i[n],t,e);else Tt(i,t,e)})),f.pop(),d=null};let _t=null;function yt(){xt.stop()}function vt(){xt.start()}const xt=new jR;function bt(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||D.intersectsSprite(t)){n&&z.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F);const e=K.update(t),r=t.material;r.visible&&h.push(t,e,r,i,z.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==H.render.frame&&(t.skeleton.update(),t.skeleton.frame=H.render.frame),!t.frustumCulled||D.intersectsObject(t))){n&&z.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F);const e=K.update(t),r=t.material;if(Array.isArray(r)){const n=e.groups;for(let o=0,s=n.length;o<s;o++){const s=n[o],a=r[s.materialIndex];a&&a.visible&&h.push(t,e,a,i,z.z,s)}}else r.visible&&h.push(t,e,r,i,z.z,null)}const r=t.children;for(let t=0,o=r.length;t<o;t++)bt(r[t],e,i,n)}function wt(t,e,i,n){const r=t.opaque,o=t.transmissive,a=t.transparent;d.setupLightsView(i),o.length>0&&function(t,e,i){if(null===O){const t=!0===s&&!0===j.isWebGL2;O=new(t?MP:TP)(1024,1024,{generateMipmaps:!0,type:null!==lt.convert(YC)?YC:jC,minFilter:VC,magFilter:OC,wrapS:kC,wrapT:kC,useRenderToTexture:V.has("WEBGL_multisampled_render_to_texture")})}const n=m.getRenderTarget();m.setRenderTarget(O),m.clear();const r=m.toneMapping;m.toneMapping=bC,Et(t,e,i),m.toneMapping=r,q.updateMultisampleRenderTarget(O),q.updateRenderTargetMipmap(O),m.setRenderTarget(n)}(r,e,i),n&&G.viewport(w.copy(n)),r.length>0&&Et(r,e,i),o.length>0&&Et(o,e,i),a.length>0&&Et(a,e,i)}function Et(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let r=0,o=t.length;r<o;r++){const o=t[r],s=o.object,a=o.geometry,l=null===n?o.material:n,c=o.group;s.layers.test(i.layers)&&St(s,e,i,a,l,c)}}function St(t,e,i,n,r,o){t.onBeforeRender(m,e,i,n,r,o),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(m,e,i,n,t,o),!0===r.transparent&&r.side===VI?(r.side=UI,r.needsUpdate=!0,m.renderBufferDirect(i,e,n,r,t,o),r.side=BI,r.needsUpdate=!0,m.renderBufferDirect(i,e,n,r,t,o),r.side=VI):m.renderBufferDirect(i,e,n,r,t,o),t.onAfterRender(m,e,i,n,r,o)}function Tt(t,e,i){!0!==e.isScene&&(e=B);const n=W.get(t),r=d.state.lights,o=d.state.shadowsArray,s=r.state.version,a=J.getParameters(t,r.state,o,e,i),l=J.getProgramCacheKey(a);let c=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?$:X).get(t.envMap||n.environment),void 0===c&&(t.addEventListener("dispose",gt),c=new Map,n.programs=c);let u=c.get(l);if(void 0!==u){if(n.currentProgram===u&&n.lightsStateVersion===s)return Mt(t,a),u}else a.uniforms=J.getUniforms(t),t.onBuild(i,a,m),t.onBeforeCompile(a,m),u=J.acquireProgram(a,l),c.set(l,u),n.uniforms=a.uniforms;const h=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(h.clippingPlanes=it.uniform),Mt(t,a),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=s,n.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotShadowMatrix.value=r.state.spotShadowMatrix,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=u.getUniforms(),f=Nk.seqWithValue(p.seq,h);return n.currentProgram=u,n.uniformsList=f,u}function Mt(t,e){const i=W.get(t);i.outputEncoding=e.outputEncoding,i.instancing=e.instancing,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}xt.setAnimationLoop((function(t){_t&&_t(t)})),"undefined"!=typeof window&&xt.setContext(window),this.setAnimationLoop=function(t){_t=t,pt.setAnimationLoop(t),null===t?xt.stop():xt.start()},pt.addEventListener("sessionstart",yt),pt.addEventListener("sessionend",vt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===pt.enabled&&!0===pt.isPresenting&&(!0===pt.cameraAutoUpdate&&pt.updateCamera(e),e=pt.getCamera()),!0===t.isScene&&t.onBeforeRender(m,t,e,v),d=et.get(t,f.length),d.init(),f.push(d),F.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),D.setFromProjectionMatrix(F),N=this.localClippingEnabled,k=it.init(this.clippingPlanes,N,e),h=tt.get(t,p.length),h.init(),p.push(h),bt(t,e,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(C,A),!0===k&&it.beginShadows();const i=d.state.shadowsArray;if(nt.render(i,t,e),!0===k&&it.endShadows(),!0===this.info.autoReset&&this.info.reset(),rt.render(h,t),d.setupLights(m.physicallyCorrectLights),e.isArrayCamera){const i=e.cameras;for(let e=0,n=i.length;e<n;e++){const n=i[e];wt(h,t,n,n.viewport)}}else wt(h,t,e);null!==v&&(q.updateMultisampleRenderTarget(v),q.updateRenderTargetMipmap(v)),!0===t.isScene&&t.onAfterRender(m,t,e),G.buffers.depth.setTest(!0),G.buffers.depth.setMask(!0),G.buffers.color.setMask(!0),G.setPolygonOffset(!1),ct.resetDefaultState(),x=-1,b=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),h=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return v},this.setRenderTargetTextures=function(t,e,i){W.get(t.texture).__webglTexture=e,W.get(t.depthTexture).__webglTexture=i;const n=W.get(t);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||t.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),t.useRenderToTexture=!1,t.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(t,e){const i=W.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,i=0){v=t,_=e,y=i;let n=!0;if(t){const e=W.get(t);void 0!==e.__useDefaultFramebuffer?(G.bindFramebuffer(36160,null),n=!1):void 0===e.__webglFramebuffer?q.setupRenderTarget(t):e.__hasExternalTextures&&q.rebindTextures(t,W.get(t.texture).__webglTexture,W.get(t.depthTexture).__webglTexture)}let r=null,o=!1,s=!1;if(t){const i=t.texture;(i.isDataTexture3D||i.isDataTexture2DArray)&&(s=!0);const n=W.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=n[e],o=!0):r=t.useRenderbuffer?W.get(t).__webglMultisampledFramebuffer:n,w.copy(t.viewport),E.copy(t.scissor),S=t.scissorTest}else w.copy(P).multiplyScalar(I).floor(),E.copy(L).multiplyScalar(I).floor(),S=R;if(G.bindFramebuffer(36160,r)&&j.drawBuffers&&n&&G.drawBuffers(t,r),G.viewport(w),G.scissor(E),G.setScissorTest(S),o){const n=W.get(t.texture);ut.framebufferTexture2D(36160,36064,34069+e,n.__webglTexture,i)}else if(s){const n=W.get(t.texture),r=e||0;ut.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,r)}x=-1},this.readRenderTargetPixels=function(t,e,i,n,r,o,s){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=W.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){G.bindFramebuffer(36160,a);try{const s=t.texture,a=s.format,l=s.type;if(a!==eA&&lt.convert(a)!==ut.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===YC&&(V.has("EXT_color_buffer_half_float")||j.isWebGL2&&V.has("EXT_color_buffer_float"));if(!(l===jC||lt.convert(l)===ut.getParameter(35738)||l===$C&&(j.isWebGL2||V.has("OES_texture_float")||V.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ut.checkFramebufferStatus(36160)?e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&ut.readPixels(e,i,n,r,lt.convert(a),lt.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==v?W.get(v).__webglFramebuffer:null;G.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){if(!0!==e.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const n=Math.pow(2,-i),r=Math.floor(e.image.width*n),o=Math.floor(e.image.height*n);q.setTexture2D(e,0),ut.copyTexSubImage2D(3553,i,0,0,t.x,t.y,r,o),G.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const r=e.image.width,o=e.image.height,s=lt.convert(i.format),a=lt.convert(i.type);q.setTexture2D(i,0),ut.pixelStorei(37440,i.flipY),ut.pixelStorei(37441,i.premultiplyAlpha),ut.pixelStorei(3317,i.unpackAlignment),e.isDataTexture?ut.texSubImage2D(3553,n,t.x,t.y,r,o,s,a,e.image.data):e.isCompressedTexture?ut.compressedTexSubImage2D(3553,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,s,e.mipmaps[0].data):ut.texSubImage2D(3553,n,t.x,t.y,s,a,e.image),0===n&&i.generateMipmaps&&ut.generateMipmap(3553),G.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,r=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const o=t.max.x-t.min.x+1,s=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,l=lt.convert(n.format),c=lt.convert(n.type);let u;if(n.isDataTexture3D)q.setTexture3D(n,0),u=32879;else{if(!n.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");q.setTexture2DArray(n,0),u=35866}ut.pixelStorei(37440,n.flipY),ut.pixelStorei(37441,n.premultiplyAlpha),ut.pixelStorei(3317,n.unpackAlignment);const h=ut.getParameter(3314),d=ut.getParameter(32878),p=ut.getParameter(3316),f=ut.getParameter(3315),g=ut.getParameter(32877),_=i.isCompressedTexture?i.mipmaps[0]:i.image;ut.pixelStorei(3314,_.width),ut.pixelStorei(32878,_.height),ut.pixelStorei(3316,t.min.x),ut.pixelStorei(3315,t.min.y),ut.pixelStorei(32877,t.min.z),i.isDataTexture||i.isDataTexture3D?ut.texSubImage3D(u,r,e.x,e.y,e.z,o,s,a,l,c,_.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ut.compressedTexSubImage3D(u,r,e.x,e.y,e.z,o,s,a,l,_.data)):ut.texSubImage3D(u,r,e.x,e.y,e.z,o,s,a,l,c,_),ut.pixelStorei(3314,h),ut.pixelStorei(32878,d),ut.pixelStorei(3316,p),ut.pixelStorei(3315,f),ut.pixelStorei(32877,g),0===r&&n.generateMipmaps&&ut.generateMipmap(u),G.unbindTexture()},this.initTexture=function(t){q.setTexture2D(t,0),G.unbindTexture()},this.resetState=function(){_=0,y=0,v=null,G.reset(),ct.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}PN.prototype.isWebGLRenderer=!0,class extends PN{}.prototype.isWebGL1Renderer=!0;class LN extends PL{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}LN.prototype.isScene=!0;class RN{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=YA,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=nP()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=nP()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=nP()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}RN.prototype.isInterleavedBuffer=!0;const DN=new CP;class kN{constructor(t,e,i,n=!1){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)DN.x=this.getX(e),DN.y=this.getY(e),DN.z=this.getZ(e),DN.applyMatrix4(t),this.setXYZ(e,DN.x,DN.y,DN.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)DN.x=this.getX(e),DN.y=this.getY(e),DN.z=this.getZ(e),DN.applyNormalMatrix(t),this.setXYZ(e,DN.x,DN.y,DN.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)DN.x=this.getX(e),DN.y=this.getY(e),DN.z=this.getZ(e),DN.transformDirection(t),this.setXYZ(e,DN.x,DN.y,DN.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new XL(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new kN(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}kN.prototype.isInterleavedBufferAttribute=!0;class NN extends GL{constructor(t){super(),this.type="SpriteMaterial",this.color=new yP(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let ON;NN.prototype.isSpriteMaterial=!0;const FN=new CP,zN=new CP,BN=new CP,UN=new lP,VN=new lP,jN=new oL,GN=new CP,HN=new CP,WN=new CP,qN=new lP,XN=new lP,$N=new lP;function YN(t,e,i,n,r,o){UN.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r?(VN.x=o*UN.x-r*UN.y,VN.y=r*UN.x+o*UN.y):VN.copy(UN),t.copy(e),t.x+=VN.x,t.y+=VN.y,t.applyMatrix4(jN)}(class extends PL{constructor(t){if(super(),this.type="Sprite",void 0===ON){ON=new rR;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new RN(t,5);ON.setIndex([0,1,2,0,2,3]),ON.setAttribute("position",new kN(e,3,0,!1)),ON.setAttribute("uv",new kN(e,2,3,!1))}this.geometry=ON,this.material=void 0!==t?t:new NN,this.center=new lP(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),zN.setFromMatrixScale(this.matrixWorld),jN.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),BN.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&zN.multiplyScalar(-BN.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const o=this.center;YN(GN.set(-.5,-.5,0),BN,o,zN,n,r),YN(HN.set(.5,-.5,0),BN,o,zN,n,r),YN(WN.set(.5,.5,0),BN,o,zN,n,r),qN.set(0,0),XN.set(1,0),$N.set(1,1);let s=t.ray.intersectTriangle(GN,HN,WN,!1,FN);if(null===s&&(YN(HN.set(-.5,.5,0),BN,o,zN,n,r),XN.set(0,1),s=t.ray.intersectTriangle(GN,WN,HN,!1,FN),null===s))return;const a=t.ray.origin.distanceTo(FN);a<t.near||a>t.far||e.push({distance:a,point:FN.clone(),uv:VL.getUV(FN,GN,HN,WN,qN,XN,$N,new lP),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}).prototype.isSprite=!0;const ZN=new CP,KN=new SP,JN=new SP,QN=new CP,tO=new oL;class eO extends wR{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new oL,this.bindMatrixInverse=new oL}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new SP,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.w=e.getW(i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const i=this.skeleton,n=this.geometry;KN.fromBufferAttribute(n.attributes.skinIndex,t),JN.fromBufferAttribute(n.attributes.skinWeight,t),ZN.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=JN.getComponent(t);if(0!==n){const r=KN.getComponent(t);tO.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),e.addScaledVector(QN.copy(ZN).applyMatrix4(tO),n)}}return e.applyMatrix4(this.bindMatrixInverse)}}eO.prototype.isSkinnedMesh=!0,class extends PL{constructor(){super(),this.type="Bone"}}.prototype.isBone=!0,class extends wP{constructor(t=null,e=1,i=1,n,r,o,s,a,l=OC,c=OC,u,h){super(null,o,s,a,l,c,n,r,u,h),this.image={data:t,width:e,height:i},this.magFilter=l,this.minFilter=c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}.prototype.isDataTexture=!0;class iO extends XL{constructor(t,e,i,n=1){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,i),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}iO.prototype.isInstancedBufferAttribute=!0;const nO=new oL,rO=new oL,oO=[],sO=new wR;class aO extends wR{constructor(t,e,i){super(t,e),this.instanceMatrix=new iO(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(sO.geometry=this.geometry,sO.material=this.material,void 0!==sO.material)for(let r=0;r<n;r++){this.getMatrixAt(r,nO),rO.multiplyMatrices(i,nO),sO.matrixWorld=rO,sO.raycast(t,oO);for(let t=0,i=oO.length;t<i;t++){const i=oO[t];i.instanceId=r,i.object=this,e.push(i)}oO.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new iO(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}aO.prototype.isInstancedMesh=!0;class lO extends GL{constructor(t){super(),this.type="LineBasicMaterial",this.color=new yP(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}lO.prototype.isLineBasicMaterial=!0;const cO=new CP,uO=new CP,hO=new oL,dO=new rL,pO=new ZP;class fO extends PL{constructor(t=new rR,e=new lO){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)cO.fromBufferAttribute(e,t-1),uO.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=cO.distanceTo(uO);t.setAttribute("lineDistance",new ZL(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Line.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),pO.copy(i.boundingSphere),pO.applyMatrix4(n),pO.radius+=r,!1===t.ray.intersectsSphere(pO))return;hO.copy(n).invert(),dO.copy(t.ray).applyMatrix4(hO);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=new CP,c=new CP,u=new CP,h=new CP,d=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position;if(null!==n)for(let i=Math.max(0,o.start),s=Math.min(n.count,o.start+o.count)-1;i<s;i+=d){const o=n.getX(i),s=n.getX(i+1);if(l.fromBufferAttribute(r,o),c.fromBufferAttribute(r,s),dO.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(h);d<t.near||d>t.far||e.push({distance:d,point:u.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}else for(let i=Math.max(0,o.start),n=Math.min(r.count,o.start+o.count)-1;i<n;i+=d){if(l.fromBufferAttribute(r,i),c.fromBufferAttribute(r,i+1),dO.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(h);n<t.near||n>t.far||e.push({distance:n,point:u.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}fO.prototype.isLine=!0;const mO=new CP,gO=new CP;class _O extends fO{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)mO.fromBufferAttribute(e,t),gO.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+mO.distanceTo(gO);t.setAttribute("lineDistance",new ZL(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}_O.prototype.isLineSegments=!0,class extends fO{constructor(t,e){super(t,e),this.type="LineLoop"}}.prototype.isLineLoop=!0;class yO extends GL{constructor(t){super(),this.type="PointsMaterial",this.color=new yP(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}yO.prototype.isPointsMaterial=!0;const vO=new oL,xO=new rL,bO=new ZP,wO=new CP;function EO(t,e,i,n,r,o,s){const a=xO.distanceSqToPoint(t);if(a<i){const i=new CP;xO.closestPointToPoint(t,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;o.push({distance:l,distanceToRay:Math.sqrt(a),point:i,index:e,face:null,object:s})}}(class extends PL{constructor(t=new rR,e=new yO){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Points.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),bO.copy(i.boundingSphere),bO.applyMatrix4(n),bO.radius+=r,!1===t.ray.intersectsSphere(bO))return;vO.copy(n).invert(),xO.copy(t.ray).applyMatrix4(vO);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s;if(i.isBufferGeometry){const r=i.index,s=i.attributes.position;if(null!==r)for(let i=Math.max(0,o.start),l=Math.min(r.count,o.start+o.count);i<l;i++){const o=r.getX(i);wO.fromBufferAttribute(s,o),EO(wO,o,a,n,t,e,this)}else for(let i=Math.max(0,o.start),r=Math.min(s.count,o.start+o.count);i<r;i++)wO.fromBufferAttribute(s,i),EO(wO,i,a,n,t,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}).prototype.isPoints=!0,class extends wP{constructor(t,e,i,n,r,o,s,a,l){super(t,e,i,n,r,o,s,a,l),this.minFilter=void 0!==o?o:BC,this.magFilter=void 0!==r?r:BC,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}.prototype.isVideoTexture=!0,class extends wP{constructor(t,e,i){super({width:t,height:e}),this.format=i,this.magFilter=OC,this.minFilter=OC,this.generateMipmaps=!1,this.needsUpdate=!0}}.prototype.isFramebufferTexture=!0,class extends wP{constructor(t,e,i,n,r,o,s,a,l,c,u,h){super(null,o,s,a,l,c,n,r,u,h),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}.prototype.isCompressedTexture=!0,class extends wP{constructor(t,e,i,n,r,o,s,a,l){super(t,e,i,n,r,o,s,a,l),this.needsUpdate=!0}}.prototype.isCanvasTexture=!0,new CP,new CP,new CP,new VL;class SO{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),r=0;e.push(0);for(let o=1;o<=t;o++)i=this.getPoint(o/t),r+=i.distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const r=i.length;let o;o=e||t*i[r-1];let s,a=0,l=r-1;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),s=i[n]-o,s<0)a=n+1;else{if(!(s>0)){l=n;break}l=n-1}if(n=l,i[n]===o)return n/(r-1);const c=i[n];return(n+(o-c)/(i[n+1]-c))/(r-1)}getTangent(t,e){const i=1e-4;let n=t-i,r=t+i;n<0&&(n=0),r>1&&(r=1);const o=this.getPoint(n),s=this.getPoint(r),a=e||(o.isVector2?new lP:new CP);return a.copy(s).sub(o).normalize(),a}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new CP,n=[],r=[],o=[],s=new CP,a=new oL;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new CP)}r[0]=new CP,o[0]=new CP;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),u=Math.abs(n[0].y),h=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),u<=l&&(l=u,i.set(0,1,0)),h<=l&&i.set(0,0,1),s.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],s),o[0].crossVectors(n[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),o[e]=o[e-1].clone(),s.crossVectors(n[e-1],n[e]),s.length()>Number.EPSILON){s.normalize();const t=Math.acos(rP(n[e-1].dot(n[e]),-1,1));r[e].applyMatrix4(a.makeRotationAxis(s,t))}o[e].crossVectors(n[e],r[e])}if(!0===e){let e=Math.acos(rP(r[0].dot(r[t]),-1,1));e/=t,n[0].dot(s.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(a.makeRotationAxis(n[i],e*i)),o[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class TO extends SO{constructor(t=0,e=0,i=1,n=1,r=0,o=2*Math.PI,s=!1,a=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a}getPoint(t,e){const i=e||new lP,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=o?0:n),!0!==this.aClockwise||o||(r===n?r=-n:r-=n);const s=this.aStartAngle+t*r;let a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=a-this.aX,n=l-this.aY;a=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}TO.prototype.isEllipseCurve=!0;class MO extends TO{constructor(t,e,i,n,r,o){super(t,e,i,i,n,r,o),this.type="ArcCurve"}}function IO(){let t=0,e=0,i=0,n=0;function r(r,o,s,a){t=r,e=s,i=-3*r+3*o-2*s-a,n=2*r-2*o+s+a}return{initCatmullRom:function(t,e,i,n,o){r(e,i,o*(i-t),o*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,o,s,a){let l=(e-t)/o-(i-t)/(o+s)+(i-e)/s,c=(i-e)/s-(n-e)/(s+a)+(n-i)/a;l*=s,c*=s,r(e,i,l,c)},calc:function(r){const o=r*r;return t+e*r+i*o+n*(o*r)}}}MO.prototype.isArcCurve=!0;const CO=new CP,AO=new IO,PO=new IO,LO=new IO;class RO extends SO{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new CP){const i=e,n=this.points,r=n.length,o=(r-(this.closed?0:1))*t;let s,a,l=Math.floor(o),c=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?s=n[(l-1)%r]:(CO.subVectors(n[0],n[1]).add(n[0]),s=CO);const u=n[l%r],h=n[(l+1)%r];if(this.closed||l+2<r?a=n[(l+2)%r]:(CO.subVectors(n[r-1],n[r-2]).add(n[r-1]),a=CO),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(s.distanceToSquared(u),t),i=Math.pow(u.distanceToSquared(h),t),n=Math.pow(h.distanceToSquared(a),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),AO.initNonuniformCatmullRom(s.x,u.x,h.x,a.x,e,i,n),PO.initNonuniformCatmullRom(s.y,u.y,h.y,a.y,e,i,n),LO.initNonuniformCatmullRom(s.z,u.z,h.z,a.z,e,i,n)}else"catmullrom"===this.curveType&&(AO.initCatmullRom(s.x,u.x,h.x,a.x,this.tension),PO.initCatmullRom(s.y,u.y,h.y,a.y,this.tension),LO.initCatmullRom(s.z,u.z,h.z,a.z,this.tension));return i.set(AO.calc(c),PO.calc(c),LO.calc(c)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new CP).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function DO(t,e,i,n,r){const o=.5*(n-e),s=.5*(r-i),a=t*t;return(2*i-2*n+o+s)*(t*a)+(-3*i+3*n-2*o-s)*a+o*t+i}function kO(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function NO(t,e,i,n,r){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}RO.prototype.isCatmullRomCurve3=!0;class OO extends SO{constructor(t=new lP,e=new lP,i=new lP,n=new lP){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new lP){const i=e,n=this.v0,r=this.v1,o=this.v2,s=this.v3;return i.set(NO(t,n.x,r.x,o.x,s.x),NO(t,n.y,r.y,o.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}OO.prototype.isCubicBezierCurve=!0;class FO extends SO{constructor(t=new CP,e=new CP,i=new CP,n=new CP){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new CP){const i=e,n=this.v0,r=this.v1,o=this.v2,s=this.v3;return i.set(NO(t,n.x,r.x,o.x,s.x),NO(t,n.y,r.y,o.y,s.y),NO(t,n.z,r.z,o.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}FO.prototype.isCubicBezierCurve3=!0;class zO extends SO{constructor(t=new lP,e=new lP){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new lP){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new lP;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}zO.prototype.isLineCurve=!0;class BO extends SO{constructor(t=new lP,e=new lP,i=new lP){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new lP){const i=e,n=this.v0,r=this.v1,o=this.v2;return i.set(kO(t,n.x,r.x,o.x),kO(t,n.y,r.y,o.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}BO.prototype.isQuadraticBezierCurve=!0;class UO extends SO{constructor(t=new CP,e=new CP,i=new CP){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new CP){const i=e,n=this.v0,r=this.v1,o=this.v2;return i.set(kO(t,n.x,r.x,o.x),kO(t,n.y,r.y,o.y),kO(t,n.z,r.z,o.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}UO.prototype.isQuadraticBezierCurve3=!0;class VO extends SO{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new lP){const i=e,n=this.points,r=(n.length-1)*t,o=Math.floor(r),s=r-o,a=n[0===o?o:o-1],l=n[o],c=n[o>n.length-2?n.length-1:o+1],u=n[o>n.length-3?n.length-1:o+2];return i.set(DO(s,a.x,l.x,c.x,u.x),DO(s,a.y,l.y,c.y,u.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new lP).fromArray(i))}return this}}VO.prototype.isSplineCurve=!0;var jO=Object.freeze({__proto__:null,ArcCurve:MO,CatmullRomCurve3:RO,CubicBezierCurve:OO,CubicBezierCurve3:FO,EllipseCurve:TO,LineCurve:zO,LineCurve3:class extends SO{constructor(t=new CP,e=new CP){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new CP){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:BO,QuadraticBezierCurve3:UO,SplineCurve:VO});class GO extends SO{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new zO(e,t))}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const t=n[r]-i,o=this.curves[r],s=o.getLength(),a=0===s?0:1-t/s;return o.getPointAt(a,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const o=r[n],s=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,a=o.getPoints(s);for(let t=0;t<a.length;t++){const n=a[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new jO[i.type]).fromJSON(i))}return this}}class HO extends GO{constructor(t){super(),this.type="Path",this.currentPoint=new lP,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new zO(this.currentPoint.clone(),new lP(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const r=new BO(this.currentPoint.clone(),new lP(t,e),new lP(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,r,o){const s=new OO(this.currentPoint.clone(),new lP(t,e),new lP(i,n),new lP(r,o));return this.curves.push(s),this.currentPoint.set(r,o),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new VO(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,r,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+s,e+a,i,n,r,o),this}absarc(t,e,i,n,r,o){return this.absellipse(t,e,i,i,n,r,o),this}ellipse(t,e,i,n,r,o,s,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,i,n,r,o,s,a),this}absellipse(t,e,i,n,r,o,s,a){const l=new TO(t,e,i,n,r,o,s,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class WO extends HO{constructor(t){super(t),this.uuid=nP(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new HO).fromJSON(i))}return this}}function qO(t,e,i,n,r){let o,s;if(r===function(t,e,i,n){let r=0;for(let o=e,s=i-n;o<i;o+=n)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}(t,e,i,n)>0)for(o=e;o<i;o+=n)s=pF(o,t[o],t[o+1],s);else for(o=i-n;o>=e;o-=n)s=pF(o,t[o],t[o+1],s);return s&&aF(s,s.next)&&(fF(s),s=s.next),s}function XO(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!aF(n,n.next)&&0!==sF(n.prev,n,n.next))n=n.next;else{if(fF(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function $O(t,e,i,n,r,o,s){if(!t)return;!s&&o&&function(t,e,i,n){let r=t;do{null===r.z&&(r.z=iF(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,i,n,r,o,s,a,l,c=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,n=i,a=0,e=0;e<c&&(a++,n=n.nextZ,n);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;i=n}o.nextZ=null,c*=2}while(s>1)}(r)}(t,n,r,o);let a,l,c=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,o?ZO(t,n,r,o):YO(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),fF(t),t=l.next,c=l.next;else if((t=l)===c){s?1===s?$O(t=KO(XO(t),e,i),e,i,n,r,o,2):2===s&&JO(t,e,i,n,r,o):$O(XO(t),e,i,n,r,o,1);break}}function YO(t){const e=t.prev,i=t,n=t.next;if(sF(e,i,n)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(rF(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&sF(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function ZO(t,e,i,n){const r=t.prev,o=t,s=t.next;if(sF(r,o,s)>=0)return!1;const a=r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,l=r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,c=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,u=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,h=iF(a,l,e,i,n),d=iF(c,u,e,i,n);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&rF(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&sF(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&rF(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&sF(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&rF(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&sF(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&rF(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&sF(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function KO(t,e,i){let n=t;do{const r=n.prev,o=n.next.next;!aF(r,o)&&lF(r,n,n.next,o)&&hF(r,o)&&hF(o,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(o.i/i),fF(n),fF(n.next),n=t=o),n=n.next}while(n!==t);return XO(n)}function JO(t,e,i,n,r,o){let s=t;do{let t=s.next.next;for(;t!==s.prev;){if(s.i!==t.i&&oF(s,t)){let a=dF(s,t);return s=XO(s,s.next),a=XO(a,a.next),$O(s,e,i,n,r,o),void $O(a,e,i,n,r,o)}t=t.next}s=s.next}while(s!==t)}function QO(t,e){return t.x-e.x}function tF(t,e){if(e=function(t,e){let i=e;const n=t.x,r=t.y;let o,s=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>s){if(s=t,t===n){if(r===i.y)return i;if(r===i.next.y)return i.next}o=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!o)return null;if(n===s)return o;const a=o,l=o.x,c=o.y;let u,h=1/0;i=o;do{n>=i.x&&i.x>=l&&n!==i.x&&rF(r<c?n:s,r,l,c,r<c?s:n,r,i.x,i.y)&&(u=Math.abs(r-i.y)/(n-i.x),hF(i,t)&&(u<h||u===h&&(i.x>o.x||i.x===o.x&&eF(o,i)))&&(o=i,h=u)),i=i.next}while(i!==a);return o}(t,e),e){const i=dF(e,t);XO(e,e.next),XO(i,i.next)}}function eF(t,e){return sF(t.prev,t,e.prev)<0&&sF(e.next,t,t.next)<0}function iF(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function nF(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function rF(t,e,i,n,r,o,s,a){return(r-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(n-a)-(i-s)*(e-a)>=0&&(i-s)*(o-a)-(r-s)*(n-a)>=0}function oF(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&lF(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(hF(t,e)&&hF(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(sF(t.prev,t,e.prev)||sF(t,e.prev,e))||aF(t,e)&&sF(t.prev,t,t.next)>0&&sF(e.prev,e,e.next)>0)}function sF(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function aF(t,e){return t.x===e.x&&t.y===e.y}function lF(t,e,i,n){const r=uF(sF(t,e,i)),o=uF(sF(t,e,n)),s=uF(sF(i,n,t)),a=uF(sF(i,n,e));return r!==o&&s!==a||!(0!==r||!cF(t,i,e))||!(0!==o||!cF(t,n,e))||!(0!==s||!cF(i,t,n))||!(0!==a||!cF(i,e,n))}function cF(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function uF(t){return t>0?1:t<0?-1:0}function hF(t,e){return sF(t.prev,t,t.next)<0?sF(t,e,t.next)>=0&&sF(t,t.prev,e)>=0:sF(t,e,t.prev)<0||sF(t,t.next,e)<0}function dF(t,e){const i=new mF(t.i,t.x,t.y),n=new mF(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function pF(t,e,i,n){const r=new mF(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function fF(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function mF(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class gF{static area(t){const e=t.length;let i=0;for(let n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i}static isClockWise(t){return gF.area(t)<0}static triangulateShape(t,e){const i=[],n=[],r=[];_F(t),yF(i,t);let o=t.length;e.forEach(_F);for(let t=0;t<e.length;t++)n.push(o),o+=e[t].length,yF(i,e[t]);const s=function(t,e,i=2){const n=e&&e.length,r=n?e[0]*i:t.length;let o=qO(t,0,r,i,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c,u,h,d,p;if(n&&(o=function(t,e,i,n){const r=[];let o,s,a,l,c;for(o=0,s=e.length;o<s;o++)a=e[o]*n,l=o<s-1?e[o+1]*n:t.length,c=qO(t,a,l,n,!1),c===c.next&&(c.steiner=!0),r.push(nF(c));for(r.sort(QO),o=0;o<r.length;o++)tF(r[o],i),i=XO(i,i.next);return i}(t,e,o,i)),t.length>80*i){a=c=t[0],l=u=t[1];for(let e=i;e<r;e+=i)h=t[e],d=t[e+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-a,u-l),p=0!==p?1/p:0}return $O(o,s,i,a,l,p),s}(i,n);for(let t=0;t<s.length;t+=3)r.push(s.slice(t,t+3));return r}}function _F(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function yF(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class vF extends rR{constructor(t=new WO([new lP(.5,.5),new lP(-.5,.5),new lP(-.5,-.5),new lP(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],r=[];for(let e=0,i=t.length;e<i;e++)o(t[e]);function o(t){const o=[],s=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:1,c=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:.2,h=void 0!==e.bevelSize?e.bevelSize:u-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:xF;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let g,_,y,v,x,b=!1;f&&(g=f.getSpacedPoints(a),b=!0,c=!1,_=f.computeFrenetFrames(a,!1),y=new CP,v=new CP,x=new CP),c||(p=0,u=0,h=0,d=0);const w=t.extractPoints(s);let E=w.shape;const S=w.holes;if(!gF.isClockWise(E)){E=E.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];gF.isClockWise(e)&&(S[t]=e.reverse())}}const T=gF.triangulateShape(E,S),M=E;for(let t=0,e=S.length;t<e;t++){const e=S[t];E=E.concat(e)}function I(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}const C=E.length,A=T.length;function P(t,e,i){let n,r,o;const s=t.x-e.x,a=t.y-e.y,l=i.x-t.x,c=i.y-t.y,u=s*s+a*a,h=s*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=e.x-a/h,f=e.y+s/h,m=((i.x-c/d-p)*c-(i.y+l/d-f)*l)/(s*c-a*l);n=p+s*m-t.x,r=f+a*m-t.y;const g=n*n+r*r;if(g<=2)return new lP(n,r);o=Math.sqrt(g/2)}else{let t=!1;s>Number.EPSILON?l>Number.EPSILON&&(t=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(c)&&(t=!0),t?(n=-a,r=s,o=Math.sqrt(u)):(n=s,r=a,o=Math.sqrt(u/2))}return new lP(n/o,r/o)}const L=[];for(let t=0,e=M.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),L[t]=P(M[t],M[i],M[n]);const R=[];let D,k=L.concat();for(let t=0,e=S.length;t<e;t++){const e=S[t];D=[];for(let t=0,i=e.length,n=i-1,r=t+1;t<i;t++,n++,r++)n===i&&(n=0),r===i&&(r=0),D[t]=P(e[t],e[n],e[r]);R.push(D),k=k.concat(D)}for(let t=0;t<p;t++){const e=t/p,i=u*Math.cos(e*Math.PI/2),n=h*Math.sin(e*Math.PI/2)+d;for(let t=0,e=M.length;t<e;t++){const e=I(M[t],L[t],n);F(e.x,e.y,-i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];D=R[t];for(let t=0,r=e.length;t<r;t++){const r=I(e[t],D[t],n);F(r.x,r.y,-i)}}}const N=h+d;for(let t=0;t<C;t++){const e=c?I(E[t],k[t],N):E[t];b?(v.copy(_.normals[0]).multiplyScalar(e.x),y.copy(_.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(v).add(y),F(x.x,x.y,x.z)):F(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<C;e++){const i=c?I(E[e],k[e],N):E[e];b?(v.copy(_.normals[t]).multiplyScalar(i.x),y.copy(_.binormals[t]).multiplyScalar(i.y),x.copy(g[t]).add(v).add(y),F(x.x,x.y,x.z)):F(i.x,i.y,l/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,i=u*Math.cos(e*Math.PI/2),n=h*Math.sin(e*Math.PI/2)+d;for(let t=0,e=M.length;t<e;t++){const e=I(M[t],L[t],n);F(e.x,e.y,l+i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];D=R[t];for(let t=0,r=e.length;t<r;t++){const r=I(e[t],D[t],n);b?F(r.x,r.y+g[a-1].y,g[a-1].x+i):F(r.x,r.y,l+i)}}}function O(t,e){let i=t.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=t.length-1);for(let t=0,i=a+2*p;t<i;t++){const i=C*t,o=C*(t+1);B(e+n+i,e+r+i,e+r+o,e+n+o)}}}function F(t,e,i){o.push(t),o.push(e),o.push(i)}function z(t,e,r){U(t),U(e),U(r);const o=n.length/3,s=m.generateTopUV(i,n,o-3,o-2,o-1);V(s[0]),V(s[1]),V(s[2])}function B(t,e,r,o){U(t),U(e),U(o),U(e),U(r),U(o);const s=n.length/3,a=m.generateSideWallUV(i,n,s-6,s-3,s-2,s-1);V(a[0]),V(a[1]),V(a[3]),V(a[1]),V(a[2]),V(a[3])}function U(t){n.push(o[3*t+0]),n.push(o[3*t+1]),n.push(o[3*t+2])}function V(t){r.push(t.x),r.push(t.y)}!function(){const t=n.length/3;if(c){let t=0,e=C*t;for(let t=0;t<A;t++){const i=T[t];z(i[2]+e,i[1]+e,i[0]+e)}t=a+2*p,e=C*t;for(let t=0;t<A;t++){const i=T[t];z(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<A;t++){const e=T[t];z(e[2],e[1],e[0])}for(let t=0;t<A;t++){const e=T[t];z(e[0]+C*a,e[1]+C*a,e[2]+C*a)}}i.addGroup(t,n.length/3-t,0)}(),function(){const t=n.length/3;let e=0;O(M,e),e+=M.length;for(let t=0,i=S.length;t<i;t++){const i=S[t];O(i,e),e+=i.length}i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new ZL(n,3)),this.setAttribute("uv",new ZL(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];i.shapes.push(n.uuid)}else i.shapes.push(t.uuid);return void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}const n=t.options.extrudePath;return void 0!==n&&(t.options.extrudePath=(new jO[n.type]).fromJSON(n)),new vF(i,t.options)}}const xF={generateTopUV:function(t,e,i,n,r){const o=e[3*i],s=e[3*i+1],a=e[3*n],l=e[3*n+1],c=e[3*r],u=e[3*r+1];return[new lP(o,s),new lP(a,l),new lP(c,u)]},generateSideWallUV:function(t,e,i,n,r,o){const s=e[3*i],a=e[3*i+1],l=e[3*i+2],c=e[3*n],u=e[3*n+1],h=e[3*n+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*o],g=e[3*o+1],_=e[3*o+2];return Math.abs(a-u)<Math.abs(s-c)?[new lP(s,1-l),new lP(c,1-h),new lP(d,1-f),new lP(m,1-_)]:[new lP(a,1-l),new lP(u,1-h),new lP(p,1-f),new lP(g,1-_)]}};class bF extends rR{constructor(t=new WO([new lP(0,.5),new lP(-.5,-.5),new lP(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],r=[],o=[];let s=0,a=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(s,a,e),s+=a,a=0;function l(t){const s=n.length/3,l=t.extractPoints(e);let c=l.shape;const u=l.holes;!1===gF.isClockWise(c)&&(c=c.reverse());for(let t=0,e=u.length;t<e;t++){const e=u[t];!0===gF.isClockWise(e)&&(u[t]=e.reverse())}const h=gF.triangulateShape(c,u);for(let t=0,e=u.length;t<e;t++){const e=u[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];n.push(e.x,e.y,0),r.push(0,0,1),o.push(e.x,e.y)}for(let t=0,e=h.length;t<e;t++){const e=h[t],n=e[0]+s,r=e[1]+s,o=e[2]+s;i.push(n,r,o),a+=3}}this.setIndex(i),this.setAttribute("position",new ZL(n,3)),this.setAttribute("normal",new ZL(r,3)),this.setAttribute("uv",new ZL(o,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}return new bF(i,t.curveSegments)}}(class extends GL{constructor(t){super(),this.type="ShadowMaterial",this.color=new yP(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}).prototype.isShadowMaterial=!0;class wF extends GL{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new yP(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yP(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qA,this.normalScale=new lP(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}wF.prototype.isMeshStandardMaterial=!0,class extends wF{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new lP(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return rP(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new yP(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new yP(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new yP(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}.prototype.isMeshPhysicalMaterial=!0,class extends GL{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new yP(16777215),this.specular=new yP(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yP(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qA,this.normalScale=new lP(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=yC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}.prototype.isMeshPhongMaterial=!0,class extends GL{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new yP(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yP(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qA,this.normalScale=new lP(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}.prototype.isMeshToonMaterial=!0,class extends GL{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qA,this.normalScale=new lP(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}.prototype.isMeshNormalMaterial=!0;class EF extends GL{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new yP(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yP(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=yC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}EF.prototype.isMeshLambertMaterial=!0,class extends GL{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new yP(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qA,this.normalScale=new lP(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}.prototype.isMeshMatcapMaterial=!0,class extends lO{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}.prototype.isLineDashedMaterial=!0;const SF={arraySlice:function(t,e,i){return SF.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i},sortedArray:function(t,e,i){const n=t.length,r=new t.constructor(n);for(let o=0,s=0;s!==n;++o){const n=i[o]*e;for(let i=0;i!==e;++i)r[s++]=t[n+i]}return r},flattenJSON:function(t,e,i,n){let r=1,o=t[0];for(;void 0!==o&&void 0===o[n];)o=t[r++];if(void 0===o)return;let s=o[n];if(void 0!==s)if(Array.isArray(s))do{s=o[n],void 0!==s&&(e.push(o.time),i.push.apply(i,s)),o=t[r++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[n],void 0!==s&&(e.push(o.time),s.toArray(i,i.length)),o=t[r++]}while(void 0!==o);else do{s=o[n],void 0!==s&&(e.push(o.time),i.push(s)),o=t[r++]}while(void 0!==o)},subclip:function(t,e,i,n,r=30){const o=t.clone();o.name=e;const s=[];for(let t=0;t<o.tracks.length;++t){const e=o.tracks[t],a=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const o=e.times[t]*r;if(!(o<i||o>=n)){l.push(e.times[t]);for(let i=0;i<a;++i)c.push(e.values[t*a+i])}}0!==l.length&&(e.times=SF.convertArray(l,e.times.constructor),e.values=SF.convertArray(c,e.values.constructor),s.push(e))}o.tracks=s;let a=1/0;for(let t=0;t<o.tracks.length;++t)a>o.tracks[t].times[0]&&(a=o.tracks[t].times[0]);for(let t=0;t<o.tracks.length;++t)o.tracks[t].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(t,e=0,i=t,n=30){n<=0&&(n=30);const r=i.tracks.length,o=e/n;for(let e=0;e<r;++e){const n=i.tracks[e],r=n.ValueTypeName;if("bool"===r||"string"===r)continue;const s=t.tracks.find((function(t){return t.name===n.name&&t.ValueTypeName===r}));if(void 0===s)continue;let a=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const u=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=n.times.length-1;let d;if(o<=n.times[0]){const t=a,e=l-a;d=SF.arraySlice(n.values,t,e)}else if(o>=n.times[h]){const t=h*l+a,e=t+l-a;d=SF.arraySlice(n.values,t,e)}else{const t=n.createInterpolant(),e=a,i=l-a;t.evaluate(o),d=SF.arraySlice(t.resultBuffer,e,i)}"quaternion"===r&&(new IP).fromArray(d).normalize().conjugate().toArray(d);const p=s.times.length;for(let t=0;t<p;++t){const e=t*u+c;if("quaternion"===r)IP.multiplyQuaternionsFlat(s.values,e,d,0,s.values,e);else{const t=u-2*c;for(let i=0;i<t;++i)s.values[e+i]-=d[i]}}}return t.blendMode=2501,t}};class TF{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{let o;i:{n:if(!(t<n)){for(let o=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===o)break;if(r=n,n=e[++i],t<n)break e}o=e.length;break i}if(t>=r)break t;{const s=e[1];t<s&&(i=2,r=s);for(let o=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===o)break;if(n=r,r=e[--i-1],t>=r)break e}o=i,i=0}}for(;i<o;){const n=i+o>>>1;t<e[n]?o=n:i=n+1}if(n=e[i],r=e[i-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n;for(let t=0;t!==n;++t)e[t]=i[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}TF.prototype.beforeStart_=TF.prototype.copySampleValue_,TF.prototype.afterEnd_=TF.prototype.copySampleValue_;class MF extends TF{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:UA,endingEnd:UA}}intervalChanged_(t,e,i){const n=this.parameterPositions;let r=t-2,o=t+1,s=n[r],a=n[o];if(void 0===s)switch(this.getSettings_().endingStart){case VA:r=t,s=2*e-i;break;case jA:r=n.length-2,s=e+n[r]-n[r+1];break;default:r=t,s=i}if(void 0===a)switch(this.getSettings_().endingEnd){case VA:o=t,a=2*i-e;break;case jA:o=1,a=i+n[1]-n[0];break;default:o=t-1,a=e}const l=.5*(i-e),c=this.valueSize;this._weightPrev=l/(e-s),this._weightNext=l/(a-i),this._offsetPrev=r*c,this._offsetNext=o*c}interpolate_(t,e,i,n){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,l=a-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,_=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,v=d*m-d*f;for(let t=0;t!==s;++t)r[t]=g*o[c+t]+_*o[l+t]+y*o[a+t]+v*o[u+t];return r}}class IF extends TF{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,l=a-s,c=(i-e)/(n-e),u=1-c;for(let t=0;t!==s;++t)r[t]=o[l+t]*u+o[a+t]*c;return r}}class CF extends TF{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class AF{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=SF.convertArray(e,this.TimeBufferType),this.values=SF.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:SF.convertArray(t.times,Array),values:SF.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new CF(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new IF(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new MF(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case FA:e=this.InterpolantFactoryMethodDiscrete;break;case zA:e=this.InterpolantFactoryMethodLinear;break;case BA:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return FA;case this.InterpolantFactoryMethodLinear:return zA;case this.InterpolantFactoryMethodSmooth:return BA}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let r=0,o=n-1;for(;r!==n&&i[r]<t;)++r;for(;-1!==o&&i[o]>e;)--o;if(++o,0!==r||o!==n){r>=o&&(o=Math.max(o,1),r=o-1);const t=this.getValueSize();this.times=SF.arraySlice(i,r,o),this.values=SF.arraySlice(this.values,r*t,o*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let e=0;e!==r;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==o&&o>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,o),t=!1;break}o=n}if(void 0!==n&&SF.isTypedArray(n))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t}optimize(){const t=SF.arraySlice(this.times),e=SF.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===BA,r=t.length-1;let o=1;for(let s=1;s<r;++s){let r=!1;const a=t[s];if(a!==t[s+1]&&(1!==s||a!==t[0]))if(n)r=!0;else{const t=s*i,n=t-i,o=t+i;for(let s=0;s!==i;++s){const i=e[t+s];if(i!==e[n+s]||i!==e[o+s]){r=!0;break}}}if(r){if(s!==o){t[o]=t[s];const n=s*i,r=o*i;for(let t=0;t!==i;++t)e[r+t]=e[n+t]}++o}}if(r>0){t[o]=t[r];for(let t=r*i,n=o*i,s=0;s!==i;++s)e[n+s]=e[t+s];++o}return o!==t.length?(this.times=SF.arraySlice(t,0,o),this.values=SF.arraySlice(e,0,o*i)):(this.times=t,this.values=e),this}clone(){const t=SF.arraySlice(this.times,0),e=SF.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}AF.prototype.TimeBufferType=Float32Array,AF.prototype.ValueBufferType=Float32Array,AF.prototype.DefaultInterpolation=zA;class PF extends AF{}PF.prototype.ValueTypeName="bool",PF.prototype.ValueBufferType=Array,PF.prototype.DefaultInterpolation=FA,PF.prototype.InterpolantFactoryMethodLinear=void 0,PF.prototype.InterpolantFactoryMethodSmooth=void 0;class LF extends AF{}LF.prototype.ValueTypeName="color";class RF extends AF{}RF.prototype.ValueTypeName="number";class DF extends TF{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(i-e)/(n-e);let l=t*s;for(let t=l+s;l!==t;l+=4)IP.slerpFlat(r,0,o,l-s,o,l,a);return r}}class kF extends AF{InterpolantFactoryMethodLinear(t){return new DF(this.times,this.values,this.getValueSize(),t)}}kF.prototype.ValueTypeName="quaternion",kF.prototype.DefaultInterpolation=zA,kF.prototype.InterpolantFactoryMethodSmooth=void 0;class NF extends AF{}NF.prototype.ValueTypeName="string",NF.prototype.ValueBufferType=Array,NF.prototype.DefaultInterpolation=FA,NF.prototype.InterpolantFactoryMethodLinear=void 0,NF.prototype.InterpolantFactoryMethodSmooth=void 0;class OF extends AF{}OF.prototype.ValueTypeName="vector";class FF{constructor(t,e=-1,i,n=2500){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=nP(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,r=i.length;t!==r;++t)e.push(zF(i[t]).scale(n));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push(AF.toJSON(i[t]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const r=e.length,o=[];for(let t=0;t<r;t++){let s=[],a=[];s.push((t+r-1)%r,t,(t+1)%r),a.push(0,1,0);const l=SF.getKeyframeOrder(s);s=SF.sortedArray(s,1,l),a=SF.sortedArray(a,1,l),n||0!==s[0]||(s.push(r),a.push(a[0])),o.push(new RF(".morphTargetInfluences["+e[t].name+"]",s,a).scale(1/i))}return new this(t,-1,o)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],o=i.name.match(r);if(o&&o.length>1){const t=o[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const o=[];for(const t in n)o.push(this.CreateFromMorphTargetSequence(t,n[t],e,i));return o}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,r){if(0!==i.length){const o=[],s=[];SF.flattenJSON(i,o,s,n),0!==o.length&&r.push(new t(e,o,s))}},n=[],r=t.name||"default",o=t.fps||30,s=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let i=0;i<r[e].morphTargets.length;i++)t[r[e].morphTargets[i]]=-1;for(const i in t){const t=[],o=[];for(let n=0;n!==r[e].morphTargets.length;++n){const n=r[e];t.push(n.time),o.push(n.morphTarget===i?1:0)}n.push(new RF(".morphTargetInfluence["+i+"]",t,o))}a=t.length*(o||1)}else{const o=".bones["+e[t].name+"]";i(OF,o+".position",r,"pos",n),i(kF,o+".quaternion",r,"rot",n),i(OF,o+".scale",r,"scl",n)}}return 0===n.length?null:new this(r,a,n,s)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function zF(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return RF;case"vector":case"vector2":case"vector3":case"vector4":return OF;case"color":return LF;case"quaternion":return kF;case"bool":case"boolean":return PF;case"string":return NF}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];SF.flattenJSON(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const BF={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},UF=new class{constructor(t,e,i){const n=this;let r,o=!1,s=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){a++,!1===o&&void 0!==n.onStart&&n.onStart(t,s,a),o=!0},this.itemEnd=function(t){s++,void 0!==n.onProgress&&n.onProgress(t,s,a),s===a&&(o=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}};class VF{constructor(t){this.manager=void 0!==t?t:UF,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,r){i.load(t,n,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const jF={};class GF extends VF{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=BF.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==jF[t])return void jF[t].push({onLoad:e,onProgress:i,onError:n});jF[t]=[],jF[t].push({onLoad:e,onProgress:i,onError:n});const o=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,a=this.responseType;fetch(o).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body.getReader)return e;const i=jF[t],n=e.body.getReader(),r=e.headers.get("Content-Length"),o=r?parseInt(r):0,s=0!==o;let a=0;const l=new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:r})=>{if(n)t.close();else{a+=r.byteLength;const n=new ProgressEvent("progress",{lengthComputable:s,loaded:a,total:o});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(r),e()}}))}()}});return new Response(l)}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,s)));case"json":return t.json();default:if(void 0===s)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(s),i=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(i);return t.arrayBuffer().then((t=>n.decode(t)))}}})).then((e=>{BF.add(t,e);const i=jF[t];delete jF[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onLoad&&n.onLoad(e)}})).catch((e=>{const i=jF[t];if(void 0===i)throw this.manager.itemError(t),e;delete jF[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class HF extends VF{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=BF.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout((function(){e&&e(o),r.manager.itemEnd(t)}),0),o;const s=hP("img");function a(){c(),BF.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){c(),n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){s.removeEventListener("load",a,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",a,!1),s.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(t),s.src=t,s}}class WF extends VF{constructor(t){super(t)}load(t,e,i,n){const r=new DR,o=new HF(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(i){o.load(t[i],(function(t){r.images[i]=t,s++,6===s&&(r.needsUpdate=!0,e&&e(r))}),void 0,n)}for(let e=0;e<t.length;++e)a(e);return r}}class qF extends VF{constructor(t){super(t)}load(t,e,i,n){const r=new wP,o=new HF(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),i,n),r}}class XF extends PL{constructor(t,e=1){super(),this.type="Light",this.color=new yP(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}XF.prototype.isLight=!0,class extends XF{constructor(t,e,i){super(t,i),this.type="HemisphereLight",this.position.copy(PL.DefaultUp),this.updateMatrix(),this.groundColor=new yP(e)}copy(t){return XF.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}.prototype.isHemisphereLight=!0;const $F=new oL,YF=new CP,ZF=new CP;class KF{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new lP(512,512),this.map=null,this.mapPass=null,this.matrix=new oL,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new VR,this._frameExtents=new lP(1,1),this._viewportCount=1,this._viewports=[new SP(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;YF.setFromMatrixPosition(t.matrixWorld),e.position.copy(YF),ZF.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(ZF),e.updateMatrixWorld(),$F.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix($F),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class JF extends KF{constructor(){super(new PR(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,i=2*iP*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}JF.prototype.isSpotLightShadow=!0,class extends XF{constructor(t,e,i=0,n=Math.PI/3,r=0,o=1){super(t,e),this.type="SpotLight",this.position.copy(PL.DefaultUp),this.updateMatrix(),this.target=new PL,this.distance=i,this.angle=n,this.penumbra=r,this.decay=o,this.shadow=new JF}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}.prototype.isSpotLight=!0;const QF=new oL,tz=new CP,ez=new CP;class iz extends KF{constructor(){super(new PR(90,1,.5,500)),this._frameExtents=new lP(4,2),this._viewportCount=6,this._viewports=[new SP(2,1,1,1),new SP(0,1,1,1),new SP(3,1,1,1),new SP(1,1,1,1),new SP(3,0,1,1),new SP(1,0,1,1)],this._cubeDirections=[new CP(1,0,0),new CP(-1,0,0),new CP(0,0,1),new CP(0,0,-1),new CP(0,1,0),new CP(0,-1,0)],this._cubeUps=[new CP(0,1,0),new CP(0,1,0),new CP(0,1,0),new CP(0,1,0),new CP(0,0,1),new CP(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),tz.setFromMatrixPosition(t.matrixWorld),i.position.copy(tz),ez.copy(i.position),ez.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(ez),i.updateMatrixWorld(),n.makeTranslation(-tz.x,-tz.y,-tz.z),QF.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(QF)}}iz.prototype.isPointLightShadow=!0,class extends XF{constructor(t,e,i=0,n=1){super(t,e),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new iz}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}.prototype.isPointLight=!0;class nz extends KF{constructor(){super(new tD(-5,5,5,-5,.5,500))}}nz.prototype.isDirectionalLightShadow=!0;class rz extends XF{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(PL.DefaultUp),this.updateMatrix(),this.target=new PL,this.shadow=new nz}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}rz.prototype.isDirectionalLight=!0;class oz extends XF{constructor(t,e){super(t,e),this.type="AmbientLight"}}oz.prototype.isAmbientLight=!0,class extends XF{constructor(t,e,i=10,n=10){super(t,e),this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}.prototype.isRectAreaLight=!0;class sz{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new CP)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,r=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*n),e.addScaledVector(o[2],.488603*r),e.addScaledVector(o[3],.488603*i),e.addScaledVector(o[4],i*n*1.092548),e.addScaledVector(o[5],n*r*1.092548),e.addScaledVector(o[6],.315392*(3*r*r-1)),e.addScaledVector(o[7],i*r*1.092548),e.addScaledVector(o[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,r=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],1.023328*n),e.addScaledVector(o[2],1.023328*r),e.addScaledVector(o[3],1.023328*i),e.addScaledVector(o[4],.858086*i*n),e.addScaledVector(o[5],.858086*n*r),e.addScaledVector(o[6],.743125*r*r-.247708),e.addScaledVector(o[7],.858086*i*r),e.addScaledVector(o[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}}sz.prototype.isSphericalHarmonics3=!0;class az extends XF{constructor(t=new sz,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}az.prototype.isLightProbe=!0;class lz{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class cz extends rR{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}let uz;cz.prototype.isInstancedBufferGeometry=!0,class extends VF{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=BF.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout((function(){e&&e(o),r.manager.itemEnd(t)}),0),o;const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader,fetch(t,s).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){BF.add(t,i),e&&e(i),r.manager.itemEnd(t)})).catch((function(e){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}.prototype.isImageBitmapLoader=!0;class hz extends VF{constructor(t){super(t)}load(t,e,i,n){const r=this,o=new GF(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(i){try{const t=i.slice(0);(void 0===uz&&(uz=new(window.AudioContext||window.webkitAudioContext)),uz).decodeAudioData(t,(function(t){e(t)}))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}}(class extends az{constructor(t,e,i=1){super(void 0,i);const n=(new yP).set(t),r=(new yP).set(e),o=new CP(n.r,n.g,n.b),s=new CP(r.r,r.g,r.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(s).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(s).multiplyScalar(l)}}).prototype.isHemisphereLightProbe=!0,class extends az{constructor(t,e=1){super(void 0,e);const i=(new yP).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}.prototype.isAmbientLightProbe=!0;class dz{constructor(t,e,i){let n,r,o;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,r=t*n+n;let o=this.cumulativeWeight;if(0===o){for(let t=0;t!==n;++t)i[r+t]=i[t];o=e}else{o+=e;const t=e/o;this._mixBufferRegion(i,r,0,t,n)}this.cumulativeWeight=o}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-r,e)}o>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(i[t]!==i[t+e]){s.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,r=n;t!==r;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)t[e+n]=t[i+n]}_slerp(t,e,i,n){IP.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,r){const o=this._workIndex*r;IP.multiplyQuaternionsFlat(t,o,t,e,t,i),IP.slerpFlat(t,e,t,e,t,o,n)}_lerp(t,e,i,n,r){const o=1-n;for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]*o+t[i+s]*n}}_lerpAdditive(t,e,i,n,r){for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]+t[i+o]*n}}}const pz="\\[\\]\\.:\\/",fz=new RegExp("["+pz+"]","g"),mz="[^"+pz+"]",gz="[^"+pz.replace("\\.","")+"]",_z=/((?:WC+[\/:])*)/.source.replace("WC",mz),yz=/(WCOD+)?/.source.replace("WCOD",gz),vz=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",mz),xz=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",mz),bz=new RegExp("^"+_z+yz+vz+xz+"$"),wz=["material","materials","bones"];class Ez{constructor(t,e,i){this.path=e,this.parsedPath=i||Ez.parseTrackName(e),this.node=Ez.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new Ez.Composite(t,e,i):new Ez(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(fz,"")}static parseTrackName(t){const e=bz.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==wz.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const r=t[n];if(r.name===e||r.uuid===e)return r;const o=i(r.children);if(o)return o}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let r=e.propertyIndex;if(t||(t=Ez.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const o=t[n];if(void 0===o){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let s=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ez.Composite=class{constructor(t,e,i){const n=i||Ez.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},Ez.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ez.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ez.prototype.GetterByBindingType=[Ez.prototype._getValue_direct,Ez.prototype._getValue_array,Ez.prototype._getValue_arrayElement,Ez.prototype._getValue_toArray],Ez.prototype.SetterByBindingTypeAndVersioning=[[Ez.prototype._setValue_direct,Ez.prototype._setValue_direct_setNeedsUpdate,Ez.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ez.prototype._setValue_array,Ez.prototype._setValue_array_setNeedsUpdate,Ez.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ez.prototype._setValue_arrayElement,Ez.prototype._setValue_arrayElement_setNeedsUpdate,Ez.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ez.prototype._setValue_fromArray,Ez.prototype._setValue_fromArray_setNeedsUpdate,Ez.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Sz{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const r=e.tracks,o=r.length,s=new Array(o),a={endingStart:UA,endingEnd:UA};for(let t=0;t!==o;++t){const e=r[t].createInterpolant(null);s[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,r=n/i,o=i/n;t.warp(1,r,e),this.warp(o,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,r=n.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=n._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,l=s.sampleValues;return a[0]=r,a[1]=r+i,l[0]=t/o,l[1]=e/o,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const n=(t-r)*i;if(n<0||0===i)return;this._startTime=null,e=i*n}e*=this._updateTimeScale(t);const o=this._updateTime(e),s=this._updateWeight(t);if(s>0){const t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(o),e[i].accumulateAdditive(s);else for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(o),e[i].accumulate(n,s)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,r=this._loopCount;const o=2202===i;if(0===t)return-1===r||!o||1&~r?n:e-n;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,r+=Math.abs(i);const s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){const e=t<0;this._setEndings(e,!e,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(o&&!(1&~r))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=VA,n.endingEnd=VA):(n.endingStart=t?this.zeroSlopeAtStart?VA:UA:jA,n.endingEnd=e?this.zeroSlopeAtEnd?VA:UA:jA)}_scheduleFading(t,e,i){const n=this._mixer,r=n.time;let o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=r,a[0]=e,s[1]=r+t,a[1]=i,this}}(class extends QA{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,o=t._propertyBindings,s=t._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let t=0;t!==r;++t){const r=n[t],l=r.name;let u=c[l];if(void 0!==u)++u.referenceCount,o[t]=u;else{if(u=o[t],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,l));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;u=new dz(Ez.create(i,l,n),r.ValueTypeName,r.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,l),o[t]=u}s[t].resultBuffer=u.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,r=this._actionsByClip;let o=r[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=o;else{const e=o.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),o.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,o=this._actionsByClip,s=o[r],a=s.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null,delete s.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete o[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,r=this._bindings;let o=n[e];void 0===o&&(o={},n[e]=o),o[i]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,s=o[n],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete s[r],0===Object.keys(s).length&&delete o[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new IF(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r}clipAction(t,e,i){const n=e||this._root,r=n.uuid;let o="string"==typeof t?FF.findByName(n,t):t;const s=null!==o?o.uuid:t,a=this._actionsByClip[s];let l=null;if(void 0===i&&(i=null!==o?o.blendMode:2500),void 0!==a){const t=a.actionByRoot[r];if(void 0!==t&&t.blendMode===i)return t;l=a.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const c=new Sz(this,o,e,i);return this._bindAction(c,l),this._addInactiveAction(c,s,r),c}existingAction(t,e){const i=e||this._root,n=i.uuid,r="string"==typeof t?FF.findByName(i,t):t,o=r?r.uuid:t,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),o=this._accuIndex^=1;for(let s=0;s!==i;++s)e[s]._update(n,t,r,o);const s=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)s[t].apply(o);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const t=r.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const r=n._cacheIndex,o=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,o._cacheIndex=r,e[r]=o,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1),class extends RN{constructor(t,e,i=1){super(t,e),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}.prototype.isInstancedInterleavedBuffer=!0;const Tz=new CP,Mz=new oL,Iz=new oL;function Cz(t){const e=[];t&&t.isBone&&e.push(t);for(let i=0;i<t.children.length;i++)e.push.apply(e,Cz(t.children[i]));return e}const Az=new Float32Array(1);new Int32Array(Az.buffer),SO.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(SO.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},HO.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},class extends _O{constructor(t=10,e=10,i=4473924,n=8947848){i=new yP(i),n=new yP(n);const r=e/2,o=t/e,s=t/2,a=[],l=[];for(let t=0,c=0,u=-s;t<=e;t++,u+=o){a.push(-s,0,u,s,0,u),a.push(u,0,-s,u,0,s);const e=t===r?i:n;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new rR;c.setAttribute("position",new ZL(a,3)),c.setAttribute("color",new ZL(l,3)),super(c,new lO({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends _O{constructor(t){const e=Cz(t),i=new rR,n=[],r=[],o=new yP(0,0,1),s=new yP(0,1,0);for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(o.r,o.g,o.b),r.push(s.r,s.g,s.b))}i.setAttribute("position",new ZL(n,3)),i.setAttribute("color",new ZL(r,3)),super(i,new lO({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");Iz.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(Mz.multiplyMatrices(Iz,r.matrixWorld),Tz.setFromMatrixPosition(Mz),n.setXYZ(i,Tz.x,Tz.y,Tz.z),Mz.multiplyMatrices(Iz,r.parent.matrixWorld),Tz.setFromMatrixPosition(Mz),n.setXYZ(i+1,Tz.x,Tz.y,Tz.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},VF.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),lz.extractUrlBase(t)},VF.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},LP.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},LP.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},LP.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},LP.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},LP.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},ZP.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},VR.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},cP.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},cP.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},cP.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},cP.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},cP.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},cP.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},oL.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},oL.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},oL.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new CP).setFromMatrixColumn(this,3)},oL.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},oL.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},oL.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},oL.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},oL.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},oL.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},oL.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},oL.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},oL.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},oL.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},oL.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},oL.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},oL.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},oL.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},oL.prototype.makeFrustum=function(t,e,i,n,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,i,r,o)},oL.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},zR.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},IP.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},IP.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},rL.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},rL.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},rL.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},VL.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},VL.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},VL.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},VL.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},VL.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},VL.barycoordFromPoint=function(t,e,i,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),VL.getBarycoord(t,e,i,n,r)},VL.normal=function(t,e,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),VL.getNormal(t,e,i,n)},WO.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},WO.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new vF(this,t)},WO.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new bF(this,t)},lP.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},lP.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lP.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},CP.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},CP.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},CP.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},CP.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},CP.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},CP.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},CP.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},CP.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},CP.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},SP.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},SP.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},PL.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},PL.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},PL.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},PL.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},PL.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(PL.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),wR.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(wR.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),eO.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},PR.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(XF.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(XL.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===ZA},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(ZA)}}}),XL.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?ZA:YA),this},XL.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},XL.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},rR.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},rR.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new XL(arguments[1],arguments[2])))},rR.prototype.addDrawCall=function(t,e,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},rR.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},rR.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},rR.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},rR.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(rR.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),RN.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?ZA:YA),this},RN.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},vF.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},vF.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},vF.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},LN.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Object.defineProperties(GL.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new yP}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(CR.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),PN.prototype.clearTarget=function(t,e,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,i,n)},PN.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},PN.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},PN.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},PN.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},PN.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},PN.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},PN.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},PN.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},PN.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},PN.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},PN.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},PN.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},PN.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},PN.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},PN.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},PN.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},PN.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},PN.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},PN.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},PN.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},PN.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},PN.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},PN.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},PN.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(PN.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?HA:GA}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(vN.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(TP.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),class extends PL{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new hz).load(t,(function(t){e.setBuffer(t)})),this},RR.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},RR.prototype.clear=function(t,e,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,i,n)},xP.crossOrigin=void 0,xP.loadTexture=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new qF;r.setCrossOrigin(this.crossOrigin);const o=r.load(t,i,void 0,n);return e&&(o.mapping=e),o},xP.loadTextureCube=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new WF;r.setCrossOrigin(this.crossOrigin);const o=r.load(t,i,void 0,n);return e&&(o.mapping=e),o},xP.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},xP.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:RI}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=RI);var Pz={noaa:{scale:[{value:0,color:"#000000"},{value:5,color:"#69E5E4"},{value:10,color:"#4599E9"},{value:15,color:"#0F02E7"},{value:20,color:"#72F44A"},{value:25,color:"#59C239"},{value:30,color:"#3E8B27"},{value:35,color:"#F8F551"},{value:40,color:"#DDBC3F"},{value:45,color:"#EA9736"},{value:50,color:"#E33323"},{value:55,color:"#BF281C"},{value:60,color:"#A72318"},{value:65,color:"#E131F0"},{value:70,color:"#8D54BF"},{value:75,color:"#FEFEFE"}],align:"center"}},Lz={jma:{type:"raster",tiles:["https://www.jma.go.jp/bosai/jmatile/data/nowc/${[0].basetime}/none/${[0].validtime}/surf/hrpns/{z}/{x}/{y}.png"],tileSize:256,minzoom:0,maxzoom:10,attribution:'<a href="https://www.jma.go.jp"> Japan Meteorological Agency</a>',catalog:"https://www.jma.go.jp/bosai/jmatile/data/nowc/targetTimes_N1.json",interval:3e5,colors:["#000000","#F2F2FF","#A0D2FF","#218CFF","#0041FF","#FAF500","#FF9900","#FF2800","#B40068"],timestamp:"${[0].basetime}"},rainviewer:{type:"raster",tiles:["${host}${radar.past[-1].path}/256/{z}/{x}/{y}/0/0_1.png"],tileSize:256,minzoom:1,maxzoom:20,attribution:'<a href="https://www.rainviewer.com"> RainViewer</a>',catalog:"https://api.rainviewer.com/public/weather-maps.json",interval:6e5,timestamp:"${radar.past[-1].time}"}};const Rz=64,Dz=64,kz=new SR(1,-1,1);kz.translate(.5,.5,.5);const Nz=new Float32Array([-.002,.002,.01,.002,.002,.01,-.002,.002,-.01,.002,.002,-.01,-.002,-.002,.01,-.002,.002,.01,-.002,-.002,-.01,-.002,.002,-.01,-.002,.002,.01,.002,.002,.01,-.002,-.002,.01,.002,-.002,.01]),Oz=new Uint16Array([0,1,2,2,1,3,4,5,6,6,5,7,8,9,10,10,9,11]),Fz=new Float32Array([-.004,.004,.001,.004,.004,.001,-.004,.004,-.001,.004,.004,-.001,-.004,-.004,.001,-.004,.004,.001,-.004,-.004,-.001,-.004,.004,-.001,-.004,.004,.001,.004,.004,.001,-.004,-.004,.001,.004,-.004,.001]),zz=new Uint16Array([0,1,2,2,1,3,4,5,6,6,5,7,8,9,10,10,9,11]),Bz="\n    precision highp float;\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n    uniform float time;\n    uniform float scale;\n    attribute vec3 position;\n    attribute vec3 offset;\n\n    void main(void) {\n        vec3 translate = vec3(position.x * scale + offset.x, position.y * scale + offset.y, position.z + mod(offset.z - time + 1.0, 1.0));\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(translate, 1.0);\n    }\n",Uz="\n    precision highp float;\n    uniform vec4 color;\n\n    void main(void) {\n        gl_FragColor = color;\n    }\n";function Vz(t,e){return void 0===t?e:t}function jz(t,e){let i=e.split(/\.|(?=\[)/)[0];const n=e.slice(i.length).replace(/^\./,"");return Array.isArray(t)&&i.match(/^\[-?\d+\]$/)&&(i=+i.slice(1,-1),i<0&&(i+=t.length)),i in t&&n?jz(t[i],n):t[i]}function Gz(t,e){const i=t.match(/\$\{[^}]+\}/g);if(i)for(const n of i)t=t.replace(n,jz(e,n.slice(2,-1)));return t}function Hz(t,e,i,n,r,o){const s=1/Math.pow(2,(t-1)/3),a=Math.floor(Rz*s),l=Math.floor(Dz*s),c=n[0][0],u=[];for(let e=0;e<l;e++)for(let n=0;n<a;n++){const r=i[256*Math.floor((e+.5)/l*256)+Math.floor((n+.5)/a*256)];if(!o==!(128&r)&&(127&r)>=c)for(let i=0;i<Math.pow(2,((127&r)-c)/10)*Math.max(1,t-14);i++)u.push({x:n,y:e})}if(0===u.length)return;const h=new cz,d=new XL(o?Fz:Nz,3);h.setAttribute("position",d),h.setIndex(new XL(o?zz:Oz,1));const p=new Float32Array(3*u.length),f=new iO(p,3);for(let t=0;t<u.length;t++){const{x:e,y:i}=u[t];f.setXYZ(t,(e+Math.random())/a,(i+Math.random())/l,Math.random())}h.setAttribute("offset",f);const m=new wR(h,r);return m.position.x=e.x,m.position.y=e.y,m.scale.x=e.dx,m.scale.y=e.dy,m.scale.z=2e-4*Math.pow(2,t<10?10-t:t<14?0:.8*(14-t)),m.updateMatrix(),m.matrixAutoUpdate=!1,m.frustumCulled=!1,m}function Wz(t){t.geometry instanceof cz&&t.geometry.dispose(),t instanceof aO&&t.dispose()}function qz(t,i){this.constructor.prototype.loadTile.call(this,t,(n=>{const{x:r,y:o,z:s}=t.tileID.canonical,a=`${s}/${r}/${o}`,l=t.texture,c=this._parentLayer,u=this._tileDict;if(l&&c&&!u[a]){const i=this.map.painter.context.gl,n=i.createFramebuffer(),[r,o]=l.size,h=new Uint8Array(r*o*4),d=t._dbz=new Uint8Array(r*o),p=t._mercatorBounds=function(t){const{x:i,y:n,z:r}=t,o=Math.pow(2,r),s=i/o*360-180,a=180*Math.atan(Math.sinh(Math.PI*(1-2*n/o)))/Math.PI,l=(i+1)/o*360-180,c=180*Math.atan(Math.sinh(Math.PI*(1-2*(n+1)/o)))/Math.PI,u=e.MercatorCoordinate.fromLngLat([s,a]),h=e.MercatorCoordinate.fromLngLat([l,c]);return{x:u.x,y:u.y,dx:h.x-u.x,dy:h.y-u.y}}(t.tileID.canonical);if(i.bindFramebuffer(i.FRAMEBUFFER,n),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,l.texture,0),i.readPixels(0,0,r,o,i.RGBA,i.UNSIGNED_BYTE,h),i.bindFramebuffer(i.FRAMEBUFFER,null),i.deleteFramebuffer(n),c._colors){const t=c._colors.map((t=>parseInt(t.replace("#","0x"),16)));for(let e=0;e<d.length;e++){const i=256*(256*h[4*e]+h[4*e+1])+h[4*e+2];for(let n=0;n<t.length;n++)if(i===i[n]){d[e]=n;break}}}else for(let t=0;t<d.length;t++)d[t]=h[4*t];const f=c._zoomGroups[s-1],m=function(t,e,i,n,r){const o=1/Math.pow(2,(t-1)/3),s=Math.floor(Rz*o),a=Math.floor(Dz*o),l=n[0][0],c=[];for(let t=0;t<a;t++)for(let e=0;e<s;e++){const r=127&i[256*Math.floor((t+.5)/a*256)+Math.floor((e+.5)/s*256)];if(r>=l)for(let i=1;i<n.length;i++)if(r<n[i][0]){c.push({x:e,y:t,p:i});break}}if(0===c.length)return;const u=new aO(kz,r,c.length);for(let t=0;t<c.length;t++){const{x:e,y:i,p:r}=c[t],o=(new oL).makeScale(1/s,1/a,1).setPosition(e/s,i/a,0);u.setMatrixAt(t,o),u.setColorAt(t,n[r][1])}return u.position.x=e.x,u.position.y=e.y,u.scale.x=e.dx,u.scale.y=e.dy,u.scale.z=2e-4*Math.pow(2,t<10?10-t:t<14?0:.8*(14-t)),u.updateMatrix(),u.matrixAutoUpdate=!1,u.renderOrder=1,u}(s,p,d,c._scaleColors,c._meshMaterial);m&&(t._boxMesh=m,f.add(m));const g=Hz(s,p,d,c._scaleColors,c._rainMaterial);g&&(t._rainMesh=g,f.add(g));const _=Hz(s,p,d,c._scaleColors,c._snowMaterial,!0);_&&(t._snowMesh=_,f.add(_)),u[a]=t}i(n)}))}function Xz(t,e){this.constructor.prototype.unloadTile.call(this,t,(i=>{const{x:n,y:r,z:o}=t.tileID.canonical,s=`${o}/${n}/${r}`,a=t._boxMesh,l=t._rainMesh,c=t._snowMesh;a&&(a.parent.remove(a),Wz(a),delete t._boxMesh),l&&(l.parent.remove(l),Wz(l),delete t._rainMesh),c&&(c.parent.remove(c),Wz(c),delete t._snowMesh),delete this._tileDict[s],e(i)}))}class $z extends e.Evented{constructor(t){super(),this.id=t.id,this.type="custom",this.renderingMode="3d",this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this.source=t.source||"rainviewer",this.scale=t.scale||"noaa",this.rainColor=t.rainColor||"#ccf",this.snowColor=t.snowColor||"#fff",this.meshOpacity=Vz(t.meshOpacity,.1),this.repaint=Vz(t.repaint,!0),this._interval=Lz[this.source].interval,this._colors=Lz[this.source].colors,this._onZoom=this._onZoom.bind(this)}onAdd(t,e){this._parseColor=t.painter.context.clearColor.default.constructor.parse,this._scene=new LN,this._camera=new AR,this._directionalLight=new rz(16777215),this._directionalLight.position.set(0,-70,100).normalize(),this._scene.add(this._directionalLight),this._ambientLight=new oz(16777215,.4),this._scene.add(this._ambientLight),this._meshMaterial=new EF({opacity:this.meshOpacity,transparent:this.meshOpacity<1});let i=this._parseColor(this.rainColor);this._rainMaterial=new eD({uniforms:{time:{type:"f",value:0},scale:{type:"f",value:1},color:{type:"v4",value:new SP(i.r,i.g,i.b,i.a)}},vertexShader:Bz,fragmentShader:Uz,transparent:i.a<1,side:VI}),i=this._parseColor(this.snowColor),this._snowMaterial=new eD({uniforms:{time:{type:"f",value:0},scale:{type:"f",value:1},color:{type:"v4",value:new SP(i.r,i.g,i.b,i.a)}},vertexShader:Bz,fragmentShader:Uz,transparent:i.a<1,side:VI}),this._baseZoom=Math.round(t.getZoom()),this._zoomGroups=[];for(let t=0;t<=24;t++)this._zoomGroups[t]=new SN,this._zoomGroups[t].visible=t===this._baseZoom,this._scene.add(this._zoomGroups[t]);const{scale:n,align:r}=Pz[this.scale];this._scaleColors=n.map((({value:t,color:e},i,n)=>("center"===r&&(t=(t+(i<n.length-1?n[i+1].value:1/0))/2),[t+32,new yP(e)]))),this._map=t,this._map.setLayerZoomRange(this.id,this.minzoom,this.maxzoom),this._map.on("zoom",this._onZoom),this._renderer=new PN({canvas:t.getCanvas(),context:e,antialias:!0}),this._renderer.autoClear=!1,this._refreshSource(),this._timer=setInterval(this._refreshSource.bind(this),this._interval)}onRemove(){delete this._parseColor,this._scene.remove(this._directionalLight),this._directionalLight.dispose(),delete this._directionalLight,this._scene.remove(this._ambientLight),this._ambientLight.dispose(),delete this._ambientLight,this._meshMaterial.dispose(),delete this._meshMaterial,this._rainMaterial.dispose(),delete this._rainMaterial,delete this._baseZoom;for(let t=0;t<=24;t++)this._scene.remove(this._zoomGroups[t]);delete this._zoomGroups,delete this._scaleColors,delete this._camera,delete this._scene,this._renderer.dispose(),delete this._renderer,this._map.off("zoom",this._onZoom),this._removeSource(),delete this._map,clearInterval(this._timer),delete this._timer}render(t,e){const i=this._map.getZoom();this._rainMaterial.uniforms.time.value=6e-4*performance.now(),this._rainMaterial.uniforms.scale.value=Math.pow(2,this._baseZoom-i-(i>=10.5?1:0)),this._snowMaterial.uniforms.time.value=15e-5*performance.now(),this._snowMaterial.uniforms.scale.value=Math.pow(2,this._baseZoom-i-(i>=10.5?1:0)),this._camera.projectionMatrix=(new oL).fromArray(e),this._renderer.resetState(),this._renderer.render(this._scene,this._camera),this.repaint&&this._map.triggerRepaint()}_onZoom(){this._baseZoom=Math.round(this._map.getZoom());for(let t=0;t<=24;t++)this._zoomGroups[t].visible=t===this._baseZoom}_refreshSource(){const t=this.source,{tiles:e,tileSize:i,minzoom:n,maxzoom:r,attribution:o,catalog:s,timestamp:a}=Lz[t];fetch(s).then((t=>t.json())).then((s=>{const l=this._map;this._removeSource(),l.addSource(t,{type:"raster",tiles:e.map((t=>Gz(t,s))),tileSize:i,minzoom:n,maxzoom:r,attribution:o});const c=l.getSource(t);c._parentLayer=this,c._tileDict={},c.loadTile=qz,c.unloadTile=Xz,l.addLayer({id:t,type:"raster",source:t,paint:{"raster-opacity":0}},this.id),this.fire({type:"refresh",timestamp:+Gz(a,s)})}))}_removeSource(){const t=this.source,e=this._map,i=e.getSource(t);i&&(e.removeLayer(t),e.removeSource(t),delete i._parentLayer)}setRainColor(t){if(this.rainColor=t||"#ccf",this._parseColor&&this._rainMaterial){const{r:t,g:e,b:i,a:n}=this._parseColor(this.rainColor);this._rainMaterial.uniforms.color.value=new SP(t,e,i,n),this._rainMaterial.transparent=n<1}return this}setSnowColor(t){if(this.snowColor=t||"#fff",this._parseColor&&this._snowMaterial){const{r:t,g:e,b:i,a:n}=this._parseColor(this.snowColor);this._snowMaterial.uniforms.color.value=new SP(t,e,i,n),this._snowMaterial.transparent=n<1}return this}setMeshOpacity(t){return this.meshOpacity=Vz(t,.1),this._meshMaterial&&(this._meshMaterial.opacity=t,this._meshMaterial.transparent=t<1),this}getLegendHTML(){return['<div style="font-size: 10px; line-height: 14px;"><div>dBZ</div>',...Pz[this.scale].scale.slice(1).reverse().map((t=>`\n                <div>\n                    <div style="display: inline-block; vertical-align: top; width: 14px; height: 14px; background-color: ${t.color}; border: solid 0.5px #aaa;"></div>\n                    <div style="display: inline-block; vertical-align: top;">${t.value}</div>\n                </div>\n            `)),"</div>"].join("")}}n().accessToken="pk.eyJ1IjoidXJiaXp0b24iLCJhIjoiY2xsZTZvaXd0MGc4MjNzbmdseWNjM213eiJ9.z1YeFXYSbaMe93SMT6muVg";const Yz=new(n().Map)({container:"map",style:"mapbox://styles/urbizton/clve9aeu900c501rd7qcn14q6",center:[-94.53,41.99],zoom:6.4,maxZoom:18});let Zz,Kz;function Jz(t){var e,i;Yz.getLayer("latestLayer")&&Yz.removeLayer("latestLayer"),Yz.getSource("latestSource")&&Yz.removeSource("latestSource"),console.log(t),e=t,Yz.addSource("latestSource",{type:"geojson",data:e,generateId:!0}),Yz.addLayer({id:"latestLayer",type:"circle",source:"latestSource",layout:{visibility:"visible"},paint:{"circle-color":["match",["get","classification"],"Undefined","#FFAA00","Bare","#000000","Partly","#909090","Full","#FFFFFF","#FFFFFF"],"circle-radius":["case",["boolean",["feature-state","hover"],!1],9,5],"circle-stroke-width":["case",["boolean",["feature-state","hover"],!1],2,.5],"circle-stroke-color":"white"}}),Zz=t,function(t){let e=0,i=0;for(let n=0;n<t.length;n++)e+=t[n][0],i+=t[n][1];const n=e/t.length,r=i/t.length,o=!document.getElementById("arrow-img").classList.contains("flipped"),s={};let a=document.getElementById("console").clientWidth-200;s.left=o?0:a,console.log(a),Yz.easeTo({padding:s,center:[n,r],zoom:6.5})}("FeatureCollection"===(i=Zz).type?i.features.map((t=>t.geometry.coordinates)):"Feature"===i.type?[i.geometry.coordinates]:[])}function Qz(t){Yz.getLayer("latestInterpolationLayer")&&Yz.removeLayer("latestInterpolationLayer"),Yz.getSource("latestInterpolation")&&Yz.removeSource("latestInterpolation"),function(t){Yz.addSource("latestInterpolation",{type:"geojson",data:t,generateId:!0,tolerance:0}),Yz.addLayer({id:"latestInterpolationLayer",type:"line",source:"latestInterpolation",layout:{visibility:"visible"},paint:{"line-color":["match",["get","classification"],"Undefined","#FFAA00","Bare","#000000","Partly","#909090","Full","#FFFFFF","#FFFFFF"],"line-width":["case",["boolean",["feature-state","hover"],!1],6,3]}},"latestLayer")}(t),Kz=t}Yz.addControl(new(n().NavigationControl)({visualizePitch:!0}),"bottom-right"),Yz.addControl(new(n().ScaleControl)({maxWidth:300,unit:"imperial"})),Yz.addControl(new(n().FullscreenControl)({container:document.querySelector("body")}),"bottom-right"),document.getElementById("center-iowa").addEventListener("click",(function(t){t.preventDefault(),Yz.flyTo({center:[-94.53,41.99],zoom:6.7,pitch:0,bearing:0})})),Yz.on("style.load",(()=>{Yz.resize(),console.log("Map resized"),Jz(Zz),Qz(Kz)})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll('.map-styles input[type="radio"]').forEach((t=>{t.addEventListener("click",(function(){if(this.checked){t=this.value,Yz.setStyle("mapbox://styles/urbizton/"+t),console.log("Map style set to:",t)}var t}))}))}));const tB=document.getElementById("pointID"),eB=document.getElementById("pointTimestamp"),iB=document.getElementById("pointImage"),nB=(MI=new SI(document.getElementById("donutchart"),TI),MI);let rB,oB=null,sB=!1,aB={};function lB(t){var e=new Date(1e3*t),i=["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()],n=("0"+e.getDate()).slice(-2),r=e.getFullYear(),o=e.getHours(),s=o>=12?"PM":"AM";return i+" "+n+", "+r+" - "+(o=(o%=12)||12)+":"+("0"+e.getMinutes()).slice(-2)+" "+s}Yz.on("mouseleave","latestLayer",(()=>{Yz.getCanvas().style.cursor="default",oB&&Yz.setFeatureState({source:"latestSource",id:oB},{hover:!1}),sB?sB&&(tB.textContent=aB.avlID,eB.textContent=aB.timestamp,iB.src=aB.image,iB.parentNode.style.display="block",AI(nB),PI(nB,aB.classes),Yz.setFeatureState({source:"latestSource",id:aB.specificID},{hover:!0})):(tB.textContent="",eB.textContent="",iB.src="",iB.parentNode.style.display="none",AI(nB))})),Yz.on("click","latestLayer",(t=>{let e=Yz.queryRenderedFeatures(t.point,{layers:["latestLayer"]})[0].geometry.coordinates;yx(),sB&&Yz.setFeatureState({source:"latestSource",id:aB.specificID},{hover:!1});const i=!document.getElementById("arrow-img").classList.contains("flipped"),n={};let r=document.getElementById("console").clientWidth-200;n.left=i?0:r,console.log(n),Yz.easeTo({center:e,padding:n,duration:600}),sB=!0;let o=t.features[0].properties;aB={specificID:t.features[0].id,avlID:o.id,timestamp:lB(o.timestamp),classification:o.classification,classes:o.class,image:o.url},tB.textContent=aB.avlID,eB.textContent=aB.timestamp,iB.src=aB.image,iB.parentNode.style.display="block",AI(nB),PI(nB,aB.classes)})),Yz.on("mousemove","latestLayer",(t=>{Yz.getCanvas().style.cursor="pointer";const e=Yz.queryRenderedFeatures(t.point,{layers:["latestLayer"]});if(e.length>0){const t=e[0],i=t.id;i!==oB&&(oB&&Yz.setFeatureState({source:"latestSource",id:oB},{hover:!1}),Yz.setFeatureState({source:"latestSource",id:i},{hover:!0}),oB=i,tB.textContent=t.properties.id,eB.textContent=lB(t.properties.timestamp),iB.src=t.properties.url,iB.parentNode.style.display="block",AI(nB),PI(nB,t.properties.class))}else Yz.getCanvas().style.cursor="default",tB.textContent="",eB.textContent="",iB.src="",iB.parentNode.style.display="none",AI(nB),null!==oB&&(Yz.setFeatureState({source:"latestSource",id:oB},{hover:!1}),oB=null)})),setTimeout((()=>{rB=document.getElementById("console").offsetWidth}),1e3);let cB=!1;window.addEventListener("mousedown",(t=>{"console"===t.target.id&&(cB=!0)})),window.addEventListener("mousemove",(()=>{cB&&function(){const t=Yz.getCenter();let e=Yz.getZoom();const i=document.getElementById("console").offsetWidth;if(i!==rB){const n=i-rB;e*=(rB/i)**.1;const r=Yz.project(t),o=r.x-.7*n,s=r.y,a=Yz.unproject([o,s]);Yz.setCenter(a),Yz.setZoom(e),rB=i}}()})),window.addEventListener("mouseup",(()=>{cB=!1})),document.querySelector("#realtime-toggle").addEventListener("change",(t=>{if(t.target.checked){const t=new $z({id:"rain",source:"rainviewer",meshOpacity:0,rainColor:"hsla(213, 76%, 73%, 0.86)",snowColor:"hsla(0, 0%, 100%, 1)",scale:"noaa"});Yz.addLayer(t),t.on("refresh",(t=>{var e;console.log(`Last Weather Update: ${e=t.timestamp,new Date(1e3*e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`)})),Yz.removeLayer("latestLayer"),Yz.removeSource("latestSource")}else Yz.removeLayer("rain")})),Yz.on("idle",(()=>{if(!Yz.getLayer("latestLayer")||!Yz.getLayer("latestInterpolationLayer"))return void(document.getElementById("menu").style.display="none");document.getElementById("menu").style.display="flex";const t=["latestLayer","latestInterpolationLayer"];for(const e of t){if(document.getElementById(e))continue;const t=document.createElement("a");let i;t.id=e,t.href="#",i="latestLayer"==e?"Actual":"Interpolated",t.textContent=i,t.className="active",t.onclick=function(t){const i=e;t.preventDefault(),t.stopPropagation(),"visible"===Yz.getLayoutProperty(i,"visibility")?(Yz.setLayoutProperty(i,"visibility","none"),this.className=""):(this.className="active",Yz.setLayoutProperty(i,"visibility","visible"))},document.getElementById("menu").appendChild(t)}}));var uB=i(365),hB={};hB.styleTagTransform=b_(),hB.setAttributes=__(),hB.insert=m_().bind(null,"head"),hB.domAPI=p_(),hB.insertStyleElement=v_(),h_()(uB.A,hB),uB.A&&uB.A.locals&&uB.A.locals})()})();