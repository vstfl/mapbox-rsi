/*! For license information please see main.js.LICENSE.txt */
(()=>{var e={591:(e,t,i)=>{"use strict";i.d(t,{A:()=>d});var n=i(601),r=i.n(n),s=i(314),o=i.n(s),a=i(417),l=i.n(a),c=new URL(i(48),i.b),u=o()(r());u.push([e.id,"@import url(https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap);"]);var h=l()(c);u.push([e.id,`.mdl-button{background:0 0;border:none;border-radius:2px;color:#000;position:relative;height:36px;margin:0;min-width:64px;padding:0 16px;display:inline-block;font-family:Roboto,Helvetica,Arial,sans-serif;font-size:14px;font-weight:500;text-transform:uppercase;line-height:1;letter-spacing:0;overflow:hidden;will-change:box-shadow;transition:box-shadow .2s cubic-bezier(.4,0,1,1),background-color .2s cubic-bezier(.4,0,.2,1),color .2s cubic-bezier(.4,0,.2,1);outline:0;cursor:pointer;text-decoration:none;text-align:center;line-height:36px;vertical-align:middle}.mdl-button::-moz-focus-inner{border:0}.mdl-button:hover{background-color:rgba(158,158,158,.2)}.mdl-button:focus:not(:active){background-color:rgba(0,0,0,.12)}.mdl-button:active{background-color:rgba(158,158,158,.4)}.mdl-button.mdl-button--colored{color:#3f51b5}.mdl-button.mdl-button--colored:focus:not(:active){background-color:rgba(0,0,0,.12)}input.mdl-button[type=submit]{-webkit-appearance:none}.mdl-button--raised{background:rgba(158,158,158,.2);box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12)}.mdl-button--raised:active{box-shadow:0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12),0 2px 4px -1px rgba(0,0,0,.2);background-color:rgba(158,158,158,.4)}.mdl-button--raised:focus:not(:active){box-shadow:0 0 8px rgba(0,0,0,.18),0 8px 16px rgba(0,0,0,.36);background-color:rgba(158,158,158,.4)}.mdl-button--raised.mdl-button--colored{background:#3f51b5;color:#fff}.mdl-button--raised.mdl-button--colored:hover{background-color:#3f51b5}.mdl-button--raised.mdl-button--colored:active{background-color:#3f51b5}.mdl-button--raised.mdl-button--colored:focus:not(:active){background-color:#3f51b5}.mdl-button--raised.mdl-button--colored .mdl-ripple{background:#fff}.mdl-button--fab{border-radius:50%;font-size:24px;height:56px;margin:auto;min-width:56px;width:56px;padding:0;overflow:hidden;background:rgba(158,158,158,.2);box-shadow:0 1px 1.5px 0 rgba(0,0,0,.12),0 1px 1px 0 rgba(0,0,0,.24);position:relative;line-height:normal}.mdl-button--fab .material-icons{position:absolute;top:50%;left:50%;transform:translate(-12px,-12px);line-height:24px;width:24px}.mdl-button--fab.mdl-button--mini-fab{height:40px;min-width:40px;width:40px}.mdl-button--fab .mdl-button__ripple-container{border-radius:50%;-webkit-mask-image:-webkit-radial-gradient(circle,#fff,#000)}.mdl-button--fab:active{box-shadow:0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12),0 2px 4px -1px rgba(0,0,0,.2);background-color:rgba(158,158,158,.4)}.mdl-button--fab:focus:not(:active){box-shadow:0 0 8px rgba(0,0,0,.18),0 8px 16px rgba(0,0,0,.36);background-color:rgba(158,158,158,.4)}.mdl-button--fab.mdl-button--colored{background:#ff4081;color:#fff}.mdl-button--fab.mdl-button--colored:hover{background-color:#ff4081}.mdl-button--fab.mdl-button--colored:focus:not(:active){background-color:#ff4081}.mdl-button--fab.mdl-button--colored:active{background-color:#ff4081}.mdl-button--fab.mdl-button--colored .mdl-ripple{background:#fff}.mdl-button--icon{border-radius:50%;font-size:24px;height:32px;margin-left:0;margin-right:0;min-width:32px;width:32px;padding:0;overflow:hidden;color:inherit;line-height:normal}.mdl-button--icon .material-icons{position:absolute;top:50%;left:50%;transform:translate(-12px,-12px);line-height:24px;width:24px}.mdl-button--icon.mdl-button--mini-icon{height:24px;min-width:24px;width:24px}.mdl-button--icon.mdl-button--mini-icon .material-icons{top:0;left:0}.mdl-button--icon .mdl-button__ripple-container{border-radius:50%;-webkit-mask-image:-webkit-radial-gradient(circle,#fff,#000)}.mdl-button__ripple-container{display:block;height:100%;left:0;position:absolute;top:0;width:100%;z-index:0;overflow:hidden}.mdl-button.mdl-button--disabled .mdl-button__ripple-container .mdl-ripple,.mdl-button[disabled] .mdl-button__ripple-container .mdl-ripple{background-color:transparent}.mdl-button--primary.mdl-button--primary{color:#3f51b5}.mdl-button--primary.mdl-button--primary .mdl-ripple{background:#fff}.mdl-button--primary.mdl-button--primary.mdl-button--fab,.mdl-button--primary.mdl-button--primary.mdl-button--raised{color:#fff;background-color:#3f51b5}.mdl-button--accent.mdl-button--accent{color:#ff4081}.mdl-button--accent.mdl-button--accent .mdl-ripple{background:#fff}.mdl-button--accent.mdl-button--accent.mdl-button--fab,.mdl-button--accent.mdl-button--accent.mdl-button--raised{color:#fff;background-color:#ff4081}.mdl-button.mdl-button--disabled.mdl-button--disabled,.mdl-button[disabled][disabled]{color:rgba(0,0,0,.26);cursor:default;background-color:transparent}.mdl-button--fab.mdl-button--disabled.mdl-button--disabled,.mdl-button--fab[disabled][disabled]{background-color:rgba(0,0,0,.12);color:rgba(0,0,0,.26)}.mdl-button--raised.mdl-button--disabled.mdl-button--disabled,.mdl-button--raised[disabled][disabled]{background-color:rgba(0,0,0,.12);color:rgba(0,0,0,.26);box-shadow:none}.mdl-button--colored.mdl-button--disabled.mdl-button--disabled,.mdl-button--colored[disabled][disabled]{color:rgba(0,0,0,.26)}.mdl-button .material-icons{vertical-align:middle}.mdl-card{display:flex;flex-direction:column;font-size:16px;font-weight:400;min-height:200px;overflow:hidden;width:330px;z-index:1;position:relative;background:#fff;border-radius:2px;box-sizing:border-box}.mdl-card__media{background-color:#ff4081;background-repeat:repeat;background-position:50% 50%;background-size:cover;background-origin:padding-box;background-attachment:scroll;box-sizing:border-box}.mdl-card__title{align-items:center;color:#000;display:block;display:flex;justify-content:stretch;line-height:normal;padding:16px 16px;perspective-origin:165px 56px;transform-origin:165px 56px;box-sizing:border-box}.mdl-card__title.mdl-card--border{border-bottom:1px solid rgba(0,0,0,.1)}.mdl-card__title-text{align-self:flex-end;color:inherit;display:block;display:flex;font-size:24px;font-weight:300;line-height:normal;overflow:hidden;transform-origin:149px 48px;margin:0}.mdl-card__subtitle-text{font-size:14px;color:rgba(0,0,0,.54);margin:0}.mdl-card__supporting-text{color:rgba(0,0,0,.54);font-size:1rem;line-height:18px;overflow:hidden;padding:16px 16px;width:90%}.mdl-card__supporting-text.mdl-card--border{border-bottom:1px solid rgba(0,0,0,.1)}.mdl-card__actions{font-size:16px;line-height:normal;width:100%;background-color:rgba(0,0,0,0);padding:8px;box-sizing:border-box}.mdl-card__actions.mdl-card--border{border-top:1px solid rgba(0,0,0,.1)}.mdl-card--expand{flex-grow:1}.mdl-card__menu{position:absolute;right:16px;top:16px}.mdl-dialog{border:none;box-shadow:0 9px 46px 8px rgba(0,0,0,.14),0 11px 15px -7px rgba(0,0,0,.12),0 24px 38px 3px rgba(0,0,0,.2);width:280px}.mdl-dialog__title{padding:24px 24px 0;margin:0;font-size:2.5rem}.mdl-dialog__actions{padding:8px 8px 8px 24px;display:flex;flex-direction:row-reverse;flex-wrap:wrap}.mdl-dialog__actions>*{margin-right:8px;height:36px}.mdl-dialog__actions>:first-child{margin-right:0}.mdl-dialog__actions--full-width{padding:0 0 8px 0}.mdl-dialog__actions--full-width>*{height:48px;flex:0 0 100%;padding-right:16px;margin-right:0;text-align:right}.mdl-dialog__content{padding:20px 24px 24px 24px;color:rgba(0,0,0,.54)}.mdl-progress{display:block;position:relative;height:4px;width:500px;max-width:100%}.mdl-progress>.bar{display:block;position:absolute;top:0;bottom:0;width:0%;transition:width .2s cubic-bezier(.4,0,.2,1)}.mdl-progress>.progressbar{background-color:#3f51b5;z-index:1;left:0}.mdl-progress>.bufferbar{background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#3f51b5,#3f51b5);z-index:0;left:0}.mdl-progress>.auxbar{right:0}@supports (-webkit-appearance:none){.mdl-progress:not(.mdl-progress--indeterminate):not(.mdl-progress--indeterminate)>.auxbar,.mdl-progress:not(.mdl-progress__indeterminate):not(.mdl-progress__indeterminate)>.auxbar{background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#3f51b5,#3f51b5);mask:url(${h})}}.mdl-progress:not(.mdl-progress--indeterminate)>.auxbar,.mdl-progress:not(.mdl-progress__indeterminate)>.auxbar{background-image:linear-gradient(to right,rgba(255,255,255,.9),rgba(255,255,255,.9)),linear-gradient(to right,#3f51b5,#3f51b5)}.mdl-progress.mdl-progress--indeterminate>.bar1,.mdl-progress.mdl-progress__indeterminate>.bar1{background-color:#3f51b5;animation-name:indeterminate1;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}.mdl-progress.mdl-progress--indeterminate>.bar3,.mdl-progress.mdl-progress__indeterminate>.bar3{background-image:none;background-color:#3f51b5;animation-name:indeterminate2;animation-duration:2s;animation-iteration-count:infinite;animation-timing-function:linear}@keyframes indeterminate1{0%{left:0;width:0%}50%{left:25%;width:75%}75%{left:100%;width:0%}}@keyframes indeterminate2{0%{left:0;width:0%}50%{left:0;width:0%}75%{left:0;width:25%}100%{left:100%;width:0%}}.mdl-shadow--2dp{box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12)}.mdl-shadow--3dp{box-shadow:0 3px 4px 0 rgba(0,0,0,.14),0 3px 3px -2px rgba(0,0,0,.2),0 1px 8px 0 rgba(0,0,0,.12)}.mdl-shadow--4dp{box-shadow:0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12),0 2px 4px -1px rgba(0,0,0,.2)}.mdl-shadow--6dp{box-shadow:0 6px 10px 0 rgba(0,0,0,.14),0 1px 18px 0 rgba(0,0,0,.12),0 3px 5px -1px rgba(0,0,0,.2)}.mdl-shadow--8dp{box-shadow:0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12),0 5px 5px -3px rgba(0,0,0,.2)}.mdl-shadow--16dp{box-shadow:0 16px 24px 2px rgba(0,0,0,.14),0 6px 30px 5px rgba(0,0,0,.12),0 8px 10px -5px rgba(0,0,0,.2)}.mdl-shadow--24dp{box-shadow:0 9px 46px 8px rgba(0,0,0,.14),0 11px 15px -7px rgba(0,0,0,.12),0 24px 38px 3px rgba(0,0,0,.2)}.mdl-spinner{display:inline-block;position:relative;width:28px;height:28px}.mdl-spinner:not(.is-upgraded).is-active:after{content:"Loading..."}.mdl-spinner.is-upgraded.is-active{animation:mdl-spinner__container-rotate 1.568s linear infinite}@keyframes mdl-spinner__container-rotate{to{transform:rotate(360deg)}}.mdl-spinner__layer{position:absolute;width:100%;height:100%;opacity:0}.mdl-spinner__layer-1{border-color:#42a5f5}.mdl-spinner--single-color .mdl-spinner__layer-1{border-color:#3f51b5}.mdl-spinner.is-active .mdl-spinner__layer-1{animation:mdl-spinner__fill-unfill-rotate 5332ms cubic-bezier(.4,0,.2,1) infinite both,mdl-spinner__layer-1-fade-in-out 5332ms cubic-bezier(.4,0,.2,1) infinite both}.mdl-spinner__layer-2{border-color:#f44336}.mdl-spinner--single-color .mdl-spinner__layer-2{border-color:#3f51b5}.mdl-spinner.is-active .mdl-spinner__layer-2{animation:mdl-spinner__fill-unfill-rotate 5332ms cubic-bezier(.4,0,.2,1) infinite both,mdl-spinner__layer-2-fade-in-out 5332ms cubic-bezier(.4,0,.2,1) infinite both}.mdl-spinner__layer-3{border-color:#fdd835}.mdl-spinner--single-color .mdl-spinner__layer-3{border-color:#3f51b5}.mdl-spinner.is-active .mdl-spinner__layer-3{animation:mdl-spinner__fill-unfill-rotate 5332ms cubic-bezier(.4,0,.2,1) infinite both,mdl-spinner__layer-3-fade-in-out 5332ms cubic-bezier(.4,0,.2,1) infinite both}.mdl-spinner__layer-4{border-color:#4caf50}.mdl-spinner--single-color .mdl-spinner__layer-4{border-color:#3f51b5}.mdl-spinner.is-active .mdl-spinner__layer-4{animation:mdl-spinner__fill-unfill-rotate 5332ms cubic-bezier(.4,0,.2,1) infinite both,mdl-spinner__layer-4-fade-in-out 5332ms cubic-bezier(.4,0,.2,1) infinite both}@keyframes mdl-spinner__fill-unfill-rotate{12.5%{transform:rotate(135deg)}25%{transform:rotate(270deg)}37.5%{transform:rotate(405deg)}50%{transform:rotate(540deg)}62.5%{transform:rotate(675deg)}75%{transform:rotate(810deg)}87.5%{transform:rotate(945deg)}to{transform:rotate(1080deg)}}@keyframes mdl-spinner__layer-1-fade-in-out{from{opacity:.99}25%{opacity:.99}26%{opacity:0}89%{opacity:0}90%{opacity:.99}100%{opacity:.99}}@keyframes mdl-spinner__layer-2-fade-in-out{from{opacity:0}15%{opacity:0}25%{opacity:.99}50%{opacity:.99}51%{opacity:0}}@keyframes mdl-spinner__layer-3-fade-in-out{from{opacity:0}40%{opacity:0}50%{opacity:.99}75%{opacity:.99}76%{opacity:0}}@keyframes mdl-spinner__layer-4-fade-in-out{from{opacity:0}65%{opacity:0}75%{opacity:.99}90%{opacity:.99}100%{opacity:0}}.mdl-spinner__gap-patch{position:absolute;box-sizing:border-box;top:0;left:45%;width:10%;height:100%;overflow:hidden;border-color:inherit}.mdl-spinner__gap-patch .mdl-spinner__circle{width:1000%;left:-450%}.mdl-spinner__circle-clipper{display:inline-block;position:relative;width:50%;height:100%;overflow:hidden;border-color:inherit}.mdl-spinner__circle-clipper.mdl-spinner__left{float:left}.mdl-spinner__circle-clipper.mdl-spinner__right{float:right}.mdl-spinner__circle-clipper .mdl-spinner__circle{width:200%}.mdl-spinner__circle{box-sizing:border-box;height:100%;border-width:3px;border-style:solid;border-color:inherit;border-bottom-color:transparent!important;border-radius:50%;animation:none;position:absolute;top:0;right:0;bottom:0;left:0}.mdl-spinner__left .mdl-spinner__circle{border-right-color:transparent!important;transform:rotate(129deg)}.mdl-spinner.is-active .mdl-spinner__left .mdl-spinner__circle{animation:mdl-spinner__left-spin 1333ms cubic-bezier(.4,0,.2,1) infinite both}.mdl-spinner__right .mdl-spinner__circle{left:-100%;border-left-color:transparent!important;transform:rotate(-129deg)}.mdl-spinner.is-active .mdl-spinner__right .mdl-spinner__circle{animation:mdl-spinner__right-spin 1333ms cubic-bezier(.4,0,.2,1) infinite both}@keyframes mdl-spinner__left-spin{from{transform:rotate(130deg)}50%{transform:rotate(-5deg)}to{transform:rotate(130deg)}}@keyframes mdl-spinner__right-spin{from{transform:rotate(-130deg)}50%{transform:rotate(5deg)}to{transform:rotate(-130deg)}}.mdl-textfield{position:relative;font-size:16px;display:inline-block;box-sizing:border-box;width:300px;max-width:100%;margin:0;padding:20px 0}.mdl-textfield .mdl-button{position:absolute;bottom:20px}.mdl-textfield--align-right{text-align:right}.mdl-textfield--full-width{width:100%}.mdl-textfield--expandable{min-width:32px;width:auto;min-height:32px}.mdl-textfield--expandable .mdl-button--icon{top:16px}.mdl-textfield__input{border:none;border-bottom:1px solid rgba(0,0,0,.12);display:block;font-size:16px;font-family:Helvetica,Arial,sans-serif;margin:0;padding:4px 0;width:100%;background:0 0;text-align:left;color:inherit}.mdl-textfield__input[type=number]{-moz-appearance:textfield}.mdl-textfield__input[type=number]::-webkit-inner-spin-button,.mdl-textfield__input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.mdl-textfield.is-focused .mdl-textfield__input{outline:0}.mdl-textfield.is-invalid .mdl-textfield__input{border-color:#d50000;box-shadow:none}.mdl-textfield.is-disabled .mdl-textfield__input,fieldset[disabled] .mdl-textfield .mdl-textfield__input{background-color:transparent;border-bottom:1px dotted rgba(0,0,0,.12);color:rgba(0,0,0,.26)}.mdl-textfield textarea.mdl-textfield__input{display:block}.mdl-textfield__label{bottom:0;color:rgba(0,0,0,.26);font-size:16px;left:0;right:0;pointer-events:none;position:absolute;display:block;top:24px;width:100%;overflow:hidden;white-space:nowrap;text-align:left}.mdl-textfield.has-placeholder .mdl-textfield__label,.mdl-textfield.is-dirty .mdl-textfield__label{visibility:hidden}.mdl-textfield--floating-label .mdl-textfield__label{transition-duration:.2s;transition-timing-function:cubic-bezier(.4,0,.2,1)}.mdl-textfield--floating-label.has-placeholder .mdl-textfield__label{transition:none}.mdl-textfield.is-disabled.is-disabled .mdl-textfield__label,fieldset[disabled] .mdl-textfield .mdl-textfield__label{color:rgba(0,0,0,.26)}.mdl-textfield--floating-label.has-placeholder .mdl-textfield__label,.mdl-textfield--floating-label.is-dirty .mdl-textfield__label,.mdl-textfield--floating-label.is-focused .mdl-textfield__label{color:#3f51b5;font-size:12px;top:4px;visibility:visible}.mdl-textfield--floating-label.has-placeholder .mdl-textfield__expandable-holder .mdl-textfield__label,.mdl-textfield--floating-label.is-dirty .mdl-textfield__expandable-holder .mdl-textfield__label,.mdl-textfield--floating-label.is-focused .mdl-textfield__expandable-holder .mdl-textfield__label{top:-16px}.mdl-textfield--floating-label.is-invalid .mdl-textfield__label{color:#d50000;font-size:12px}.mdl-textfield__label:after{background-color:#3f51b5;bottom:20px;content:"";height:2px;left:45%;position:absolute;transition-duration:.2s;transition-timing-function:cubic-bezier(.4,0,.2,1);visibility:hidden;width:10px}.mdl-textfield.is-focused .mdl-textfield__label:after{left:0;visibility:visible;width:100%}.mdl-textfield.is-invalid .mdl-textfield__label:after{background-color:#d50000}.mdl-textfield__error{color:#d50000;position:absolute;font-size:12px;margin-top:3px;visibility:hidden;display:block}.mdl-textfield.is-invalid .mdl-textfield__error{visibility:visible}.mdl-textfield__expandable-holder{display:inline-block;position:relative;margin-left:32px;transition-duration:.2s;transition-timing-function:cubic-bezier(.4,0,.2,1);display:inline-block;max-width:.1px}.mdl-textfield.is-dirty .mdl-textfield__expandable-holder,.mdl-textfield.is-focused .mdl-textfield__expandable-holder{max-width:600px}.mdl-textfield__expandable-holder .mdl-textfield__label:after{bottom:0}dialog{position:absolute;left:0;right:0;width:-moz-fit-content;width:-webkit-fit-content;width:fit-content;height:-moz-fit-content;height:-webkit-fit-content;height:fit-content;margin:auto;border:solid;padding:1em;background:#fff;color:#000;display:block}dialog:not([open]){display:none}dialog+.backdrop{position:fixed;top:0;right:0;bottom:0;left:0;background:rgba(0,0,0,.1)}._dialog_overlay{position:fixed;top:0;right:0;bottom:0;left:0}dialog.fixed{position:fixed;top:50%;transform:translate(0,-50%)}.firebaseui-container{background-color:#fff;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;color:rgba(0,0,0,.87);direction:ltr;font:16px Roboto,arial,sans-serif;margin:0 auto;max-width:360px;overflow:visible;position:relative;text-align:left;width:100%}.firebaseui-container.mdl-card{overflow:visible}.firebaseui-card-header{padding:24px 24px 0 24px}.firebaseui-card-content{padding:0 24px}.firebaseui-card-footer{padding:0 24px}.firebaseui-card-actions{box-sizing:border-box;display:table;font-size:14px;padding:8px 24px 24px 24px;text-align:left;width:100%}.firebaseui-form-links{display:table-cell;vertical-align:middle;width:100%}.firebaseui-form-actions{display:table-cell;text-align:right;white-space:nowrap;width:100%}.firebaseui-subtitle,.firebaseui-title{color:rgba(0,0,0,.87);direction:ltr;font-size:20px;font-weight:500;line-height:24px;margin:0;padding:0;text-align:left}.firebaseui-title{padding-bottom:16px}.firebaseui-subtitle{margin:16px 0}.firebaseui-text{color:rgba(0,0,0,.87);direction:ltr;font-size:16px;line-height:24px;text-align:left}.firebaseui-id-page-password-recovery-email-sent p.firebaseui-text{margin:16px 0}.firebaseui-text-emphasis{font-weight:700}.firebaseui-error{color:#dd2c00;direction:ltr;font-size:12px;line-height:16px;margin:0;text-align:left}.firebaseui-text-input-error{margin:-16px 0 16px}.firebaseui-error-wrapper{min-height:16px}.firebaseui-list-item{direction:ltr;margin:0;padding:0;text-align:left}.firebaseui-hidden{display:none}.firebaseui-relative-wrapper{position:relative}.firebaseui-label{color:rgba(0,0,0,.54);direction:ltr;font-size:16px;text-align:left}.mdl-textfield--floating-label.is-dirty .mdl-textfield__label,.mdl-textfield--floating-label.is-focused .mdl-textfield__label{color:#757575}.firebaseui-input,.firebaseui-input-invalid{border-radius:0;color:rgba(0,0,0,.87);direction:ltr;font-size:16px;width:100%}input.firebaseui-input,input.firebaseui-input-invalid{direction:ltr;text-align:left}.firebaseui-input-invalid{border-color:#dd2c00}.firebaseui-textfield{width:100%}.firebaseui-textfield.mdl-textfield .firebaseui-input{border-color:rgba(0,0,0,.12)}.firebaseui-textfield.mdl-textfield .firebaseui-label::after{background-color:#3f51b5}.firebaseui-textfield-invalid.mdl-textfield .firebaseui-input{border-color:#dd2c00}.firebaseui-textfield-invalid.mdl-textfield .firebaseui-label::after{background-color:#dd2c00}.firebaseui-button{display:inline-block;height:36px;margin-left:8px;min-width:88px}.firebaseui-link{color:#4285f4;font-variant:normal;font-weight:400;text-decoration:none}.firebaseui-link:hover{text-decoration:underline}.firebaseui-indent{margin-left:1em}.firebaseui-tos{color:#757575;direction:ltr;font-size:12px;line-height:16px;margin-bottom:24px;margin-top:0;text-align:left}.firebaseui-provider-sign-in-footer>.firebaseui-tos{text-align:center}.firebaseui-tos-list{list-style:none;text-align:right}.firebaseui-inline-list-item{display:inline-block;margin-left:5px;margin-right:5px}.firebaseui-page-provider-sign-in,.firebaseui-page-select-tenant{background:inherit}.firebaseui-idp-list,.firebaseui-tenant-list{list-style:none;margin:1em 0;padding:0}.firebaseui-idp-button,.firebaseui-tenant-button{direction:ltr;font-weight:500;height:auto;line-height:normal;max-width:220px;min-height:40px;padding:8px 16px;text-align:left;width:100%}.firebaseui-idp-list>.firebaseui-list-item,.firebaseui-tenant-list>.firebaseui-list-item{margin-bottom:15px;text-align:center}.firebaseui-idp-icon-wrapper{display:table-cell;vertical-align:middle}.firebaseui-idp-icon{border:none;display:inline-block;height:18px;vertical-align:middle;width:18px}.firebaseui-idp-favicon{border:none;display:inline-block;height:14px;margin-right:5px;vertical-align:middle;width:14px}.firebaseui-idp-text{color:#fff;display:table-cell;font-size:14px;padding-left:16px;text-transform:none;vertical-align:middle}.firebaseui-idp-text.firebaseui-idp-text-long{display:table-cell}.firebaseui-idp-text.firebaseui-idp-text-short{display:none}@media (max-width:268px){.firebaseui-idp-text.firebaseui-idp-text-long{display:none}.firebaseui-idp-text.firebaseui-idp-text-short{display:table-cell}}@media (max-width:320px){.firebaseui-recaptcha-container>div>div{transform:scale(.9);-webkit-transform:scale(.9);transform-origin:0 0;-webkit-transform-origin:0 0}}.firebaseui-idp-google>.firebaseui-idp-text{color:#757575}[data-provider-id="yahoo.com"]>.firebaseui-idp-icon-wrapper>.firebaseui-idp-icon{height:22px;width:22px}.firebaseui-info-bar{background-color:#f9edbe;border:1px solid #f0c36d;box-shadow:0 2px 4px rgba(0,0,0,.2);-webkit-box-shadow:0 2px 4px rgba(0,0,0,.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,.2);left:10%;padding:8px 16px;position:absolute;right:10%;text-align:center;top:0}.firebaseui-info-bar-message{font-size:12px;margin:0}.firebaseui-dialog{box-sizing:border-box;color:rgba(0,0,0,.87);font:16px Roboto,arial,sans-serif;height:auto;max-height:fit-content;padding:24px;text-align:left}.firebaseui-dialog-icon-wrapper{display:table-cell;vertical-align:middle}.firebaseui-dialog-icon{float:left;height:40px;margin-right:24px;width:40px}.firebaseui-progress-dialog-message{display:table-cell;font-size:16px;font-weight:400;min-height:40px;vertical-align:middle}.firebaseui-progress-dialog-loading-icon{height:28px;margin:6px 30px 6px 6px;width:28px}.firebaseui-icon-done{background-image:url(https://www.gstatic.com/images/icons/material/system/2x/done_googgreen_36dp.png);background-position:center;background-repeat:no-repeat;background-size:36px 36px}.firebaseui-phone-number{display:flex}.firebaseui-country-selector{background-image:url(https://www.gstatic.com/images/icons/material/system/1x/arrow_drop_down_grey600_18dp.png);background-position:right center;background-repeat:no-repeat;background-size:18px auto;border-radius:0;border-bottom:1px solid rgba(0,0,0,.12);color:rgba(0,0,0,.87);flex-shrink:0;font-size:16px;font-weight:400;height:initial;line-height:normal;margin:20px 24px 20px 0;padding:4px 20px 4px 0;width:90px}.firebaseui-country-selector-flag{display:inline-block;margin-right:1ex}.firebaseui-flag{background-image:url(https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/flags_sprite_2x.png);background-size:100% auto;filter:drop-shadow(1px 1px 1px rgba(0, 0, 0, .54));height:14px;width:24px}.firebaseui-list-box-dialog{max-height:90%;overflow:auto;padding:8px 0 0 0}.firebaseui-list-box-actions{padding-bottom:8px}.firebaseui-list-box-icon-wrapper{display:table-cell;padding-right:24px;vertical-align:top}.firebaseui-list-box-label-wrapper{display:table-cell;vertical-align:top}.firebaseui-list-box-dialog-button{color:rgba(0,0,0,.87);direction:ltr;font-size:16px;font-weight:400;height:initial;line-height:normal;min-height:48px;padding:14px 24px;text-align:left;text-transform:none;width:100%}.firebaseui-phone-number-error{margin-left:114px}.mdl-progress.firebaseui-busy-indicator{height:2px;left:0;position:absolute;top:55px;width:100%}.mdl-spinner.firebaseui-busy-indicator{direction:initial;height:56px;left:0;margin:auto;position:absolute;right:0;top:30%;width:56px}.firebaseui-callback-indicator-container .firebaseui-busy-indicator{top:0}.firebaseui-callback-indicator-container{height:120px}.firebaseui-new-password-component{display:inline-block;position:relative;width:100%}.firebaseui-input-floating-button{background-position:center;background-repeat:no-repeat;display:block;height:24px;position:absolute;right:0;top:20px;width:24px}.firebaseui-input-toggle-on{background-image:url(https://www.gstatic.com/images/icons/material/system/1x/visibility_black_24dp.png)}.firebaseui-input-toggle-off{background-image:url(https://www.gstatic.com/images/icons/material/system/1x/visibility_off_black_24dp.png)}.firebaseui-input-toggle-focus{opacity:.87}.firebaseui-input-toggle-blur{opacity:.38}.firebaseui-recaptcha-wrapper{display:table;margin:0 auto;padding-bottom:8px}.firebaseui-recaptcha-container{display:table-cell}.firebaseui-recaptcha-error-wrapper{caption-side:bottom;display:table-caption}.firebaseui-change-phone-number-link{display:block}.firebaseui-resend-container{direction:ltr;margin:20px 0;text-align:center}.firebaseui-id-resend-countdown{color:rgba(0,0,0,.38)}.firebaseui-id-page-phone-sign-in-start .firebaseui-form-actions div{float:left}@media (max-width:480px){.firebaseui-container{box-shadow:none;max-width:none;width:100%}.firebaseui-card-header{border-bottom:1px solid #e0e0e0;margin-bottom:16px;padding:16px 24px 0 24px}.firebaseui-title{padding-bottom:16px}.firebaseui-card-actions{padding-right:24px}.firebaseui-busy-indicator{top:0}}.mdl-textfield__label{font-weight:400;margin-bottom:0}.firebaseui-id-page-blank{background:inherit;height:64px}.firebaseui-id-page-spinner{background:inherit;height:64px}.firebaseui-email-sent{background-image:url(https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/success_status.png);background-position:center;background-repeat:no-repeat;background-size:64px 64px;height:64px;margin-top:16px;text-align:center}.firebaseui-text-justify{text-align:justify}.firebaseui-flag-KY{background-position:0 0}.firebaseui-flag-AC{background-position:0 -14px}.firebaseui-flag-AE{background-position:0 -28px}.firebaseui-flag-AF{background-position:0 -42px}.firebaseui-flag-AG{background-position:0 -56px}.firebaseui-flag-AI{background-position:0 -70px}.firebaseui-flag-AL{background-position:0 -84px}.firebaseui-flag-AM{background-position:0 -98px}.firebaseui-flag-AO{background-position:0 -112px}.firebaseui-flag-AQ{background-position:0 -126px}.firebaseui-flag-AR{background-position:0 -140px}.firebaseui-flag-AS{background-position:0 -154px}.firebaseui-flag-AT{background-position:0 -168px}.firebaseui-flag-AU{background-position:0 -182px}.firebaseui-flag-AW{background-position:0 -196px}.firebaseui-flag-AX{background-position:0 -210px}.firebaseui-flag-AZ{background-position:0 -224px}.firebaseui-flag-BA{background-position:0 -238px}.firebaseui-flag-BB{background-position:0 -252px}.firebaseui-flag-BD{background-position:0 -266px}.firebaseui-flag-BE{background-position:0 -280px}.firebaseui-flag-BF{background-position:0 -294px}.firebaseui-flag-BG{background-position:0 -308px}.firebaseui-flag-BH{background-position:0 -322px}.firebaseui-flag-BI{background-position:0 -336px}.firebaseui-flag-BJ{background-position:0 -350px}.firebaseui-flag-BL{background-position:0 -364px}.firebaseui-flag-BM{background-position:0 -378px}.firebaseui-flag-BN{background-position:0 -392px}.firebaseui-flag-BO{background-position:0 -406px}.firebaseui-flag-BQ{background-position:0 -420px}.firebaseui-flag-BR{background-position:0 -434px}.firebaseui-flag-BS{background-position:0 -448px}.firebaseui-flag-BT{background-position:0 -462px}.firebaseui-flag-BV{background-position:0 -476px}.firebaseui-flag-BW{background-position:0 -490px}.firebaseui-flag-BY{background-position:0 -504px}.firebaseui-flag-BZ{background-position:0 -518px}.firebaseui-flag-CA{background-position:0 -532px}.firebaseui-flag-CC{background-position:0 -546px}.firebaseui-flag-CD{background-position:0 -560px}.firebaseui-flag-CF{background-position:0 -574px}.firebaseui-flag-CG{background-position:0 -588px}.firebaseui-flag-CH{background-position:0 -602px}.firebaseui-flag-CI{background-position:0 -616px}.firebaseui-flag-CK{background-position:0 -630px}.firebaseui-flag-CL{background-position:0 -644px}.firebaseui-flag-CM{background-position:0 -658px}.firebaseui-flag-CN{background-position:0 -672px}.firebaseui-flag-CO{background-position:0 -686px}.firebaseui-flag-CP{background-position:0 -700px}.firebaseui-flag-CR{background-position:0 -714px}.firebaseui-flag-CU{background-position:0 -728px}.firebaseui-flag-CV{background-position:0 -742px}.firebaseui-flag-CW{background-position:0 -756px}.firebaseui-flag-CX{background-position:0 -770px}.firebaseui-flag-CY{background-position:0 -784px}.firebaseui-flag-CZ{background-position:0 -798px}.firebaseui-flag-DE{background-position:0 -812px}.firebaseui-flag-DG{background-position:0 -826px}.firebaseui-flag-DJ{background-position:0 -840px}.firebaseui-flag-DK{background-position:0 -854px}.firebaseui-flag-DM{background-position:0 -868px}.firebaseui-flag-DO{background-position:0 -882px}.firebaseui-flag-DZ{background-position:0 -896px}.firebaseui-flag-EA{background-position:0 -910px}.firebaseui-flag-EC{background-position:0 -924px}.firebaseui-flag-EE{background-position:0 -938px}.firebaseui-flag-EG{background-position:0 -952px}.firebaseui-flag-EH{background-position:0 -966px}.firebaseui-flag-ER{background-position:0 -980px}.firebaseui-flag-ES{background-position:0 -994px}.firebaseui-flag-ET{background-position:0 -1008px}.firebaseui-flag-EU{background-position:0 -1022px}.firebaseui-flag-FI{background-position:0 -1036px}.firebaseui-flag-FJ{background-position:0 -1050px}.firebaseui-flag-FK{background-position:0 -1064px}.firebaseui-flag-FM{background-position:0 -1078px}.firebaseui-flag-FO{background-position:0 -1092px}.firebaseui-flag-FR{background-position:0 -1106px}.firebaseui-flag-GA{background-position:0 -1120px}.firebaseui-flag-GB{background-position:0 -1134px}.firebaseui-flag-GD{background-position:0 -1148px}.firebaseui-flag-GE{background-position:0 -1162px}.firebaseui-flag-GF{background-position:0 -1176px}.firebaseui-flag-GG{background-position:0 -1190px}.firebaseui-flag-GH{background-position:0 -1204px}.firebaseui-flag-GI{background-position:0 -1218px}.firebaseui-flag-GL{background-position:0 -1232px}.firebaseui-flag-GM{background-position:0 -1246px}.firebaseui-flag-GN{background-position:0 -1260px}.firebaseui-flag-GP{background-position:0 -1274px}.firebaseui-flag-GQ{background-position:0 -1288px}.firebaseui-flag-GR{background-position:0 -1302px}.firebaseui-flag-GS{background-position:0 -1316px}.firebaseui-flag-GT{background-position:0 -1330px}.firebaseui-flag-GU{background-position:0 -1344px}.firebaseui-flag-GW{background-position:0 -1358px}.firebaseui-flag-GY{background-position:0 -1372px}.firebaseui-flag-HK{background-position:0 -1386px}.firebaseui-flag-HM{background-position:0 -1400px}.firebaseui-flag-HN{background-position:0 -1414px}.firebaseui-flag-HR{background-position:0 -1428px}.firebaseui-flag-HT{background-position:0 -1442px}.firebaseui-flag-HU{background-position:0 -1456px}.firebaseui-flag-IC{background-position:0 -1470px}.firebaseui-flag-ID{background-position:0 -1484px}.firebaseui-flag-IE{background-position:0 -1498px}.firebaseui-flag-IL{background-position:0 -1512px}.firebaseui-flag-IM{background-position:0 -1526px}.firebaseui-flag-IN{background-position:0 -1540px}.firebaseui-flag-IO{background-position:0 -1554px}.firebaseui-flag-IQ{background-position:0 -1568px}.firebaseui-flag-IR{background-position:0 -1582px}.firebaseui-flag-IS{background-position:0 -1596px}.firebaseui-flag-IT{background-position:0 -1610px}.firebaseui-flag-JE{background-position:0 -1624px}.firebaseui-flag-JM{background-position:0 -1638px}.firebaseui-flag-JO{background-position:0 -1652px}.firebaseui-flag-JP{background-position:0 -1666px}.firebaseui-flag-KE{background-position:0 -1680px}.firebaseui-flag-KG{background-position:0 -1694px}.firebaseui-flag-KH{background-position:0 -1708px}.firebaseui-flag-KI{background-position:0 -1722px}.firebaseui-flag-KM{background-position:0 -1736px}.firebaseui-flag-KN{background-position:0 -1750px}.firebaseui-flag-KP{background-position:0 -1764px}.firebaseui-flag-KR{background-position:0 -1778px}.firebaseui-flag-KW{background-position:0 -1792px}.firebaseui-flag-AD{background-position:0 -1806px}.firebaseui-flag-KZ{background-position:0 -1820px}.firebaseui-flag-LA{background-position:0 -1834px}.firebaseui-flag-LB{background-position:0 -1848px}.firebaseui-flag-LC{background-position:0 -1862px}.firebaseui-flag-LI{background-position:0 -1876px}.firebaseui-flag-LK{background-position:0 -1890px}.firebaseui-flag-LR{background-position:0 -1904px}.firebaseui-flag-LS{background-position:0 -1918px}.firebaseui-flag-LT{background-position:0 -1932px}.firebaseui-flag-LU{background-position:0 -1946px}.firebaseui-flag-LV{background-position:0 -1960px}.firebaseui-flag-LY{background-position:0 -1974px}.firebaseui-flag-MA{background-position:0 -1988px}.firebaseui-flag-MC{background-position:0 -2002px}.firebaseui-flag-MD{background-position:0 -2016px}.firebaseui-flag-ME{background-position:0 -2030px}.firebaseui-flag-MF{background-position:0 -2044px}.firebaseui-flag-MG{background-position:0 -2058px}.firebaseui-flag-MH{background-position:0 -2072px}.firebaseui-flag-MK{background-position:0 -2086px}.firebaseui-flag-ML{background-position:0 -2100px}.firebaseui-flag-MM{background-position:0 -2114px}.firebaseui-flag-MN{background-position:0 -2128px}.firebaseui-flag-MO{background-position:0 -2142px}.firebaseui-flag-MP{background-position:0 -2156px}.firebaseui-flag-MQ{background-position:0 -2170px}.firebaseui-flag-MR{background-position:0 -2184px}.firebaseui-flag-MS{background-position:0 -2198px}.firebaseui-flag-MT{background-position:0 -2212px}.firebaseui-flag-MU{background-position:0 -2226px}.firebaseui-flag-MV{background-position:0 -2240px}.firebaseui-flag-MW{background-position:0 -2254px}.firebaseui-flag-MX{background-position:0 -2268px}.firebaseui-flag-MY{background-position:0 -2282px}.firebaseui-flag-MZ{background-position:0 -2296px}.firebaseui-flag-NA{background-position:0 -2310px}.firebaseui-flag-NC{background-position:0 -2324px}.firebaseui-flag-NE{background-position:0 -2338px}.firebaseui-flag-NF{background-position:0 -2352px}.firebaseui-flag-NG{background-position:0 -2366px}.firebaseui-flag-NI{background-position:0 -2380px}.firebaseui-flag-NL{background-position:0 -2394px}.firebaseui-flag-NO{background-position:0 -2408px}.firebaseui-flag-NP{background-position:0 -2422px}.firebaseui-flag-NR{background-position:0 -2436px}.firebaseui-flag-NU{background-position:0 -2450px}.firebaseui-flag-NZ{background-position:0 -2464px}.firebaseui-flag-OM{background-position:0 -2478px}.firebaseui-flag-PA{background-position:0 -2492px}.firebaseui-flag-PE{background-position:0 -2506px}.firebaseui-flag-PF{background-position:0 -2520px}.firebaseui-flag-PG{background-position:0 -2534px}.firebaseui-flag-PH{background-position:0 -2548px}.firebaseui-flag-PK{background-position:0 -2562px}.firebaseui-flag-PL{background-position:0 -2576px}.firebaseui-flag-PM{background-position:0 -2590px}.firebaseui-flag-PN{background-position:0 -2604px}.firebaseui-flag-PR{background-position:0 -2618px}.firebaseui-flag-PS{background-position:0 -2632px}.firebaseui-flag-PT{background-position:0 -2646px}.firebaseui-flag-PW{background-position:0 -2660px}.firebaseui-flag-PY{background-position:0 -2674px}.firebaseui-flag-QA{background-position:0 -2688px}.firebaseui-flag-RE{background-position:0 -2702px}.firebaseui-flag-RO{background-position:0 -2716px}.firebaseui-flag-RS{background-position:0 -2730px}.firebaseui-flag-RU{background-position:0 -2744px}.firebaseui-flag-RW{background-position:0 -2758px}.firebaseui-flag-SA{background-position:0 -2772px}.firebaseui-flag-SB{background-position:0 -2786px}.firebaseui-flag-SC{background-position:0 -2800px}.firebaseui-flag-SD{background-position:0 -2814px}.firebaseui-flag-SE{background-position:0 -2828px}.firebaseui-flag-SG{background-position:0 -2842px}.firebaseui-flag-SH{background-position:0 -2856px}.firebaseui-flag-SI{background-position:0 -2870px}.firebaseui-flag-SJ{background-position:0 -2884px}.firebaseui-flag-SK{background-position:0 -2898px}.firebaseui-flag-SL{background-position:0 -2912px}.firebaseui-flag-SM{background-position:0 -2926px}.firebaseui-flag-SN{background-position:0 -2940px}.firebaseui-flag-SO{background-position:0 -2954px}.firebaseui-flag-SR{background-position:0 -2968px}.firebaseui-flag-SS{background-position:0 -2982px}.firebaseui-flag-ST{background-position:0 -2996px}.firebaseui-flag-SV{background-position:0 -3010px}.firebaseui-flag-SX{background-position:0 -3024px}.firebaseui-flag-SY{background-position:0 -3038px}.firebaseui-flag-SZ{background-position:0 -3052px}.firebaseui-flag-TA{background-position:0 -3066px}.firebaseui-flag-TC{background-position:0 -3080px}.firebaseui-flag-TD{background-position:0 -3094px}.firebaseui-flag-TF{background-position:0 -3108px}.firebaseui-flag-TG{background-position:0 -3122px}.firebaseui-flag-TH{background-position:0 -3136px}.firebaseui-flag-TJ{background-position:0 -3150px}.firebaseui-flag-TK{background-position:0 -3164px}.firebaseui-flag-TL{background-position:0 -3178px}.firebaseui-flag-TM{background-position:0 -3192px}.firebaseui-flag-TN{background-position:0 -3206px}.firebaseui-flag-TO{background-position:0 -3220px}.firebaseui-flag-TR{background-position:0 -3234px}.firebaseui-flag-TT{background-position:0 -3248px}.firebaseui-flag-TV{background-position:0 -3262px}.firebaseui-flag-TW{background-position:0 -3276px}.firebaseui-flag-TZ{background-position:0 -3290px}.firebaseui-flag-UA{background-position:0 -3304px}.firebaseui-flag-UG{background-position:0 -3318px}.firebaseui-flag-UM{background-position:0 -3332px}.firebaseui-flag-UN{background-position:0 -3346px}.firebaseui-flag-US{background-position:0 -3360px}.firebaseui-flag-UY{background-position:0 -3374px}.firebaseui-flag-UZ{background-position:0 -3388px}.firebaseui-flag-VA{background-position:0 -3402px}.firebaseui-flag-VC{background-position:0 -3416px}.firebaseui-flag-VE{background-position:0 -3430px}.firebaseui-flag-VG{background-position:0 -3444px}.firebaseui-flag-VI{background-position:0 -3458px}.firebaseui-flag-VN{background-position:0 -3472px}.firebaseui-flag-VU{background-position:0 -3486px}.firebaseui-flag-WF{background-position:0 -3500px}.firebaseui-flag-WS{background-position:0 -3514px}.firebaseui-flag-XK{background-position:0 -3528px}.firebaseui-flag-YE{background-position:0 -3542px}.firebaseui-flag-YT{background-position:0 -3556px}.firebaseui-flag-ZA{background-position:0 -3570px}.firebaseui-flag-ZM{background-position:0 -3584px}.firebaseui-flag-ZW{background-position:0 -3598px}`,""]);const d=u},365:(e,t,i)=>{"use strict";i.d(t,{A:()=>a});var n=i(601),r=i.n(n),s=i(314),o=i.n(s)()(r());o.push([e.id,'body {\n  margin: 0;\n  padding: 0;\n  background-color: rgb(0, 0, 0);\n  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;\n}\n\n.loading-screen {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.096);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.loader {\n  border: 8px solid #f3f3f3;\n  border-top: 8px solid #3498db;\n  border-radius: 50%;\n  width: 50px;\n  height: 50px;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n/* Fading in animation */\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n.fadeInAnimation {\n  animation-name: fadeIn;\n  animation-duration: 0.5s; /* Adjust duration as needed */\n  animation-fill-mode: forwards;\n}\n\n/* Fading out animation */\n@keyframes fadeOut {\n  from {\n    opacity: 1;\n  }\n  to {\n    opacity: 0;\n  }\n}\n\n.fadeOutAnimation {\n  animation-name: fadeOut;\n  animation-duration: 0.5s; /* Adjust duration as needed */\n  animation-fill-mode: forwards; /* Keep opacity at 0 after animation */\n}\n\n#menu {\n  background: grey;\n  position: relative;\n  justify-content: center;\n  z-index: 2000;\n  border-radius: 7px;\n  border: none;\n  width: 100%;\n  height: 1.7rem;\n  margin: 10px 0;\n}\n\n#menu a {\n  border-radius: 7px 0 0 7px;\n  color: #404040;\n  margin: 0;\n  padding: 0 10px;\n  text-decoration: none;\n  border-right: 1px solid rgba(0, 0, 0, 0.25);\n  text-align: center;\n  flex: 1 0 auto;\n  font-size: 1rem;\n}\n\n#menu a:last-child {\n  border: none;\n  border-radius: 0px 7px 7px 0;\n}\n\n#menu a:hover {\n  background-color: rgb(172, 172, 172);\n  color: #ffffff;\n}\n\n#menu a.active {\n  background-color: #d6611e;\n  color: #ffffff;\n}\n\n#menu a.active:hover {\n  background: #c2581b;\n}\n\n.sign-in-container {\n  position: absolute;\n  left: 0;\n  right: 0;\n  margin-left: auto;\n  margin-right: auto;\n  width: 40vw;\n  top: 30vh;\n}\n\n#firebaseui-auth-container,\n#loader {\n  position: relative;\n  z-index: 200;\n}\n\n.grey-out {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(86, 86, 86, 0.196);\n  backdrop-filter: blur(12px);\n  z-index: 100;\n}\n\n#header {\n  display: flex;\n  justify-content: space-between;\n  position: relative;\n  height: 5vh;\n  padding: 20px 30px;\n  margin: 10px 10px;\n  z-index: 50;\n}\n\n#header .left-side img {\n  -webkit-filter: drop-shadow(1px 1px 0 black) drop-shadow(-1px -1px 0 black);\n  filter: drop-shadow(1px 1px 0 black) drop-shadow(-1px -1px 0 black);\n}\n\n#header .right-side {\n  display: flex;\n  align-items: center;\n  background-color: #37373762;\n  box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.596);\n  backdrop-filter: blur(8px) saturate(80%);\n  border-radius: 20px;\n  padding: 0px 10px;\n}\n\n#header .right-side .nav-text:hover {\n  font-weight: bolder;\n}\n\na.nav,\ndiv.nav {\n  color: rgb(252, 252, 252);\n  text-decoration: none;\n  padding-right: 1vw;\n  padding-left: 2vw;\n  font-weight: 400;\n  width: 4vw;\n}\n\n.dropdown {\n  display: inline-block;\n}\n\n.dropdown-content {\n  display: none;\n  position: absolute;\n  background-color: #c9c9c9f3;\n  top: 5vh;\n  border-bottom-left-radius: 10px;\n  border-bottom-right-radius: 10px;\n  color: rgb(252, 252, 252);\n  font-weight: 400;\n  box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);\n  overflow: hidden;\n  width: 18vw;\n}\n\n.dropdown-content a {\n  color: black;\n  padding: 12px 16px;\n  display: block;\n  text-align: left;\n  text-decoration: none;\n}\n\n.dropdown-content a:hover {\n  background-color: #ffffff;\n}\n\n.dropdown:hover .dropdown-content {\n  display: block;\n}\n\n.map-container {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100vh;\n}\n\n#map {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n\n#shift-button {\n  position: absolute;\n  padding: 0;\n  right: 7px;\n  z-index: 2;\n  background-color: #ff0b0b00;\n  border: none;\n  cursor: pointer;\n}\n\n#shift-button:hover,\n#img-button-right:hover,\n#img-button-left:hover {\n  filter: brightness(300%);\n}\n\n.console-container.shifted {\n  transform: translateX(-77%);\n  transition:\n    transform 0.5s ease,\n    width 0.5s ease;\n  width: 200px !important;\n}\n\n#img-buttons {\n  position: relative;\n  top: -20px;\n  height: 50px;\n  display: none;\n  justify-content: space-between;\n  align-items: flex-end;\n  background-color: rgba(20, 20, 20, 0.534);\n  border-radius: 10px;\n}\n\n#img-button-right,\n#img-button-left {\n  z-index: 2;\n  background-color: #c5c5c500;\n  border: none;\n  cursor: pointer;\n}\n\n#img-button-right {\n  right: 7px;\n}\n\n#img-button-left {\n  transform: scaleX(-1);\n  left: 7px;\n}\n\n.flipped {\n  transform: scaleX(-1);\n  transition: transform 0.5s ease;\n}\n\n.console-container.shifted .console {\n  opacity: 0;\n  transition: opacity 0.1s ease-in;\n}\n\n.console-container {\n  position: absolute;\n  top: 7vh;\n  margin: 3vh 0 3vh -2vw;\n  width: 25vw;\n  height: 80vh;\n  background-color: #37373721;\n  padding: 10px 30px;\n  border-radius: 20px;\n  box-shadow: 0px 0px 50px rgba(0, 0, 0, 0.596);\n  backdrop-filter: blur(10px) saturate(80%);\n  z-index: 1;\n  resize: horizontal;\n  overflow: hidden;\n  max-width: 40vw;\n  min-width: 250px;\n  transition:\n    transform 0.5s ease,\n    opacity 0.5s ease-in;\n}\n\n.console.resizable {\n  display: flex;\n  height: 95%;\n  overflow: scroll;\n  /* overflow-y:auto; */\n  overflow-x: hidden;\n}\n\n.console.resizable::before {\n  content: "";\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 100px; /* Adjust height as needed for fade effect */\n  pointer-events: none; /* Ensure pseudo-element does not interfere with mouse events */\n  background: linear-gradient(to top, rgba(255, 255, 255, 0), #22222291);\n  z-index: -1;\n}\n.console.resizable::after {\n  content: "";\n  position: fixed;\n  bottom: 0px;\n  left: 0;\n  right: 0;\n  height: 60px; /* Adjust height as needed for fade effect */\n  pointer-events: none; /* Ensure pseudo-element does not interfere with mouse events */\n  background: linear-gradient(to bottom, rgba(255, 255, 255, 0), #22222294);\n  z-index: 5;\n}\n\n::-webkit-scrollbar {\n  width: 2.3em;\n}\n\n::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0.157);\n  border-radius: 100px;\n  border: 15px solid transparent;\n  background-clip: content-box;\n  margin-top: 40px;\n}\n\n::-webkit-scrollbar-thumb {\n  background: rgba(95, 95, 95, 0.568);\n  border-radius: 100px;\n  border: 15px solid transparent;\n  background-clip: content-box;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: rgba(202, 202, 202, 0.568);\n  border-radius: 100px;\n  border: 15px solid transparent;\n  background-clip: content-box;\n}\n\n.console {\n  position: fixed;\n  margin-left: 1.5vw;\n  color: white;\n  text-align: left;\n  display: flex;\n  flex-direction: column;\n  width: calc(100% - 2.5vw - 10px);\n}\n\n.realtime-div {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  flex-wrap: wrap;\n  margin-top: 1.5em;\n}\n\n.studyarea-div {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  flex-wrap: wrap;\n  margin-top: 0.5em;\n  margin-bottom: 0.5em;\n}\n\n#query-date {\n  color: rgb(100, 100, 100);\n  border: none;\n  border-radius: 10px;\n  padding: 3px 15px;\n  margin: 2px;\n  box-sizing: border-box;\n  flex: 0 5 205px;\n  height: 2em;\n}\n\nform .datetime-div {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  flex-wrap: wrap;\n}\n\n.nik-add {\n  display: none;\n  width: 100%;\n  margin-top: 5px;\n  margin-bottom: 5px;\n  justify-content: space-between;\n}\n\n#nik-options {\n  width: 60%;\n  border-radius: 7px;\n  font-size: 1em;\n}\n\n.range-div {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  height: 1.5em;\n  flex-wrap: wrap;\n  margin-top: 5px;\n}\n\n.form-resize {\n  display: flex;\n  flex-wrap: wrap;\n}\n\ninput[type="range"] {\n  accent-color: rgb(255, 255, 255);\n  flex: 1 1 100px;\n}\n\n.range-div {\n  margin-bottom: 0.5em;\n}\n\ninput[type="range"]:hover {\n  cursor: pointer;\n}\n\n.submit {\n  justify-content: right;\n  margin-top: 5px;\n  display: flex;\n  width: 100%;\n}\n\n#submit-query:disabled {\n  background-color: grey !important;\n  cursor: not-allowed !important;\n  font-weight: normal !important;\n  color: lightgrey;\n}\n\n#submit-query:hover {\n  font-weight: bolder;\n  cursor: pointer;\n  background-color: #1e85da;\n}\n\n#submit-query {\n  color: white;\n  background: #2196f3;\n  width: 100%;\n  border: none;\n  border-radius: 7px;\n  margin-top: 10px;\n  height: 2em;\n}\n\n/* The switch - the box around the slider */\n.switch {\n  position: relative;\n  display: inline-block;\n  width: 40px;\n  height: 22px;\n}\n\n/* Hide default HTML checkbox */\n.switch input {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n\n/* The slider */\n.slider {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #ccc;\n  -webkit-transition: 0.4s;\n  transition: 0.4s;\n}\n\n.slider:before {\n  position: absolute;\n  content: "";\n  height: 14px;\n  width: 14px;\n  left: 4px;\n  bottom: 4px;\n  background-color: white;\n  -webkit-transition: 0.4s;\n  transition: 0.4s;\n}\n\ninput:checked + .slider {\n  background-color: #2196f3;\n}\n\ninput:focus + .slider {\n  box-shadow: 0 0 1px #2196f3;\n}\n\ninput:checked + .slider:before {\n  -webkit-transform: translateX(16px);\n  -ms-transform: translateX(16px);\n  transform: translateX(18px);\n}\n\n/* Rounded sliders */\n.slider.round {\n  border-radius: 34px;\n}\n\n.slider.round:before {\n  border-radius: 50%;\n}\n\n.map-styles {\n  position: absolute;\n  display: flex;\n  flex-wrap: wrap;\n  border-radius: 0.5rem;\n  background-color: #444444;\n  box-sizing: border-box;\n  box-shadow: 0 0 0px 1px rgba(0, 0, 0, 0.06);\n  padding: 0.25rem;\n  width: 12vw;\n  max-width: 215px;\n  min-width: 100px;\n  font-size: 11px;\n  z-index: 2;\n  right: 50px;\n  bottom: 30px;\n  gap: 8px;\n}\n\n.map-styles .radio {\n  flex: 1 1 auto;\n  text-align: center;\n}\n\n.map-styles .radio input {\n  display: none;\n}\n\n.map-styles .radio .name {\n  display: flex;\n  cursor: pointer;\n  align-items: center;\n  justify-content: center;\n  border-radius: 0.3rem;\n  border: none;\n  padding: 0.3rem 0;\n  color: rgb(255, 255, 255);\n  transition: all 0.15s ease-in-out;\n}\n\n.map-styles .radio input:checked + .name {\n  background-color: #575757;\n  font-weight: 600;\n}\n\n#console-content {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  justify-content: flex-start;\n}\n\n#pointImage {\n  height: auto;\n  width: 100%;\n  max-width: 100%;\n  border-top-left-radius: 10px;\n  border-top-right-radius: 10px;\n}\n\n.class-data {\n  display: flex;\n  align-items: flex-start;\n  justify-content: center;\n  position: relative;\n  height: auto;\n  min-height: 45vh;\n  width: 100%;\n}\n\n.mapboxgl-ctrl-scale {\n  position: absolute;\n  bottom: 0;\n  left: 50vw;\n  transform: translateX(-50%);\n  z-index: 1000;\n  background-color: rgba(126, 126, 126, 0.7);\n  border: 1px solid #1d1d1d;\n  font-size: 8px;\n  color: black;\n}\n\n#point-info {\n  display: flex;\n  flex-wrap: wrap;\n  margin-bottom: 0.7em;\n}\n\n#point-info div {\n  display: inline-block;\n  flex-basis: 50%;\n  box-sizing: border-box;\n}\n',""]);const a=o},314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",n=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),n&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),n&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,n,r,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(n)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);n&&o[u[0]]||(void 0!==s&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=s),i&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=i):u[2]=i),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),t.push(u))}},t}},417:e=>{"use strict";e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},601:e=>{"use strict";e.exports=function(e){return e[1]}},999:(e,t,i)=>{var n;!function(){var r=window.CustomEvent;function s(e){for(;e;){if("dialog"===e.localName)return e;e=e.parentElement}return null}function o(e){e&&e.blur&&e!==document.body&&e.blur()}function a(e,t){for(var i=0;i<e.length;++i)if(e[i]===t)return!0;return!1}function l(e){return!(!e||!e.hasAttribute("method"))&&"dialog"===e.getAttribute("method").toLowerCase()}function c(e){if(this.dialog_=e,this.replacedStyleTop_=!1,this.openAsModal_=!1,e.hasAttribute("role")||e.setAttribute("role","dialog"),e.show=this.show.bind(this),e.showModal=this.showModal.bind(this),e.close=this.close.bind(this),"returnValue"in e||(e.returnValue=""),"MutationObserver"in window)new MutationObserver(this.maybeHideModal.bind(this)).observe(e,{attributes:!0,attributeFilter:["open"]});else{var t,i=!1,n=function(){i?this.downgradeModal():this.maybeHideModal(),i=!1}.bind(this),r=function(r){if(r.target===e){i|="DOMNodeRemoved"===r.type.substr(0,14),window.clearTimeout(t),t=window.setTimeout(n,0)}};["DOMAttrModified","DOMNodeRemoved","DOMNodeRemovedFromDocument"].forEach((function(t){e.addEventListener(t,r)}))}Object.defineProperty(e,"open",{set:this.setOpen.bind(this),get:e.hasAttribute.bind(e,"open")}),this.backdrop_=document.createElement("div"),this.backdrop_.className="backdrop",this.backdrop_.addEventListener("click",this.backdropClick_.bind(this))}r&&"object"!=typeof r||((r=function(e,t){t=t||{};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail||null),i}).prototype=window.Event.prototype),c.prototype={get dialog(){return this.dialog_},maybeHideModal:function(){this.dialog_.hasAttribute("open")&&document.body.contains(this.dialog_)||this.downgradeModal()},downgradeModal:function(){this.openAsModal_&&(this.openAsModal_=!1,this.dialog_.style.zIndex="",this.replacedStyleTop_&&(this.dialog_.style.top="",this.replacedStyleTop_=!1),this.backdrop_.parentNode&&this.backdrop_.parentNode.removeChild(this.backdrop_),u.dm.removeDialog(this))},setOpen:function(e){e?this.dialog_.hasAttribute("open")||this.dialog_.setAttribute("open",""):(this.dialog_.removeAttribute("open"),this.maybeHideModal())},backdropClick_:function(e){if(this.dialog_.hasAttribute("tabindex"))this.dialog_.focus();else{var t=document.createElement("div");this.dialog_.insertBefore(t,this.dialog_.firstChild),t.tabIndex=-1,t.focus(),this.dialog_.removeChild(t)}var i=document.createEvent("MouseEvents");i.initMouseEvent(e.type,e.bubbles,e.cancelable,window,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),this.dialog_.dispatchEvent(i),e.stopPropagation()},focus_:function(){var e=this.dialog_.querySelector("[autofocus]:not([disabled])");if(!e&&this.dialog_.tabIndex>=0&&(e=this.dialog_),!e){var t=["button","input","keygen","select","textarea"].map((function(e){return e+":not([disabled])"}));t.push('[tabindex]:not([disabled]):not([tabindex=""])'),e=this.dialog_.querySelector(t.join(", "))}o(document.activeElement),e&&e.focus()},updateZIndex:function(e,t){if(e<t)throw new Error("dialogZ should never be < backdropZ");this.dialog_.style.zIndex=e,this.backdrop_.style.zIndex=t},show:function(){this.dialog_.open||(this.setOpen(!0),this.focus_())},showModal:function(){if(this.dialog_.hasAttribute("open"))throw new Error("Failed to execute 'showModal' on dialog: The element is already open, and therefore cannot be opened modally.");if(!document.body.contains(this.dialog_))throw new Error("Failed to execute 'showModal' on dialog: The element is not in a Document.");if(!u.dm.pushDialog(this))throw new Error("Failed to execute 'showModal' on dialog: There are too many open modal dialogs.");(function(e){for(;e&&e!==document.body;){var t=window.getComputedStyle(e),i=function(e,i){return!(void 0===t[e]||t[e]===i)};if(t.opacity<1||i("zIndex","auto")||i("transform","none")||i("mixBlendMode","normal")||i("filter","none")||i("perspective","none")||"isolate"===t.isolation||"fixed"===t.position||"touch"===t.webkitOverflowScrolling)return!0;e=e.parentElement}return!1})(this.dialog_.parentElement)&&console.warn("A dialog is being shown inside a stacking context. This may cause it to be unusable. For more information, see this link: https://github.com/GoogleChrome/dialog-polyfill/#stacking-context"),this.setOpen(!0),this.openAsModal_=!0,u.needsCentering(this.dialog_)?(u.reposition(this.dialog_),this.replacedStyleTop_=!0):this.replacedStyleTop_=!1,this.dialog_.parentNode.insertBefore(this.backdrop_,this.dialog_.nextSibling),this.focus_()},close:function(e){if(!this.dialog_.hasAttribute("open"))throw new Error("Failed to execute 'close' on dialog: The element does not have an 'open' attribute, and therefore cannot be closed.");this.setOpen(!1),void 0!==e&&(this.dialog_.returnValue=e);var t=new r("close",{bubbles:!1,cancelable:!1});this.dialog_.dispatchEvent(t)}};var u={reposition:function(e){var t=document.body.scrollTop||document.documentElement.scrollTop,i=t+(window.innerHeight-e.offsetHeight)/2;e.style.top=Math.max(t,i)+"px"},isInlinePositionSetByStylesheet:function(e){for(var t=0;t<document.styleSheets.length;++t){var i=document.styleSheets[t],n=null;try{n=i.cssRules}catch(e){}if(n)for(var r=0;r<n.length;++r){var s=n[r],o=null;try{o=document.querySelectorAll(s.selectorText)}catch(e){}if(o&&a(o,e)){var l=s.style.getPropertyValue("top"),c=s.style.getPropertyValue("bottom");if(l&&"auto"!==l||c&&"auto"!==c)return!0}}}return!1},needsCentering:function(e){return!("absolute"!==window.getComputedStyle(e).position||"auto"!==e.style.top&&""!==e.style.top||"auto"!==e.style.bottom&&""!==e.style.bottom||u.isInlinePositionSetByStylesheet(e))},forceRegisterDialog:function(e){if((window.HTMLDialogElement||e.showModal)&&console.warn("This browser already supports <dialog>, the polyfill may not work correctly",e),"dialog"!==e.localName)throw new Error("Failed to register dialog: The element is not a dialog.");new c(e)},registerDialog:function(e){e.showModal||u.forceRegisterDialog(e)},DialogManager:function(){this.pendingDialogStack=[];var e=this.checkDOM_.bind(this);this.overlay=document.createElement("div"),this.overlay.className="_dialog_overlay",this.overlay.addEventListener("click",function(t){this.forwardTab_=void 0,t.stopPropagation(),e([])}.bind(this)),this.handleKey_=this.handleKey_.bind(this),this.handleFocus_=this.handleFocus_.bind(this),this.zIndexLow_=1e5,this.zIndexHigh_=100150,this.forwardTab_=void 0,"MutationObserver"in window&&(this.mo_=new MutationObserver((function(t){var i=[];t.forEach((function(e){for(var t,n=0;t=e.removedNodes[n];++n)t instanceof Element&&("dialog"===t.localName&&i.push(t),i=i.concat(t.querySelectorAll("dialog")))})),i.length&&e(i)})))}};if(u.DialogManager.prototype.blockDocument=function(){document.documentElement.addEventListener("focus",this.handleFocus_,!0),document.addEventListener("keydown",this.handleKey_),this.mo_&&this.mo_.observe(document,{childList:!0,subtree:!0})},u.DialogManager.prototype.unblockDocument=function(){document.documentElement.removeEventListener("focus",this.handleFocus_,!0),document.removeEventListener("keydown",this.handleKey_),this.mo_&&this.mo_.disconnect()},u.DialogManager.prototype.updateStacking=function(){for(var e,t=this.zIndexHigh_,i=0;e=this.pendingDialogStack[i];++i)e.updateZIndex(--t,--t),0===i&&(this.overlay.style.zIndex=--t);var n=this.pendingDialogStack[0];n?(n.dialog.parentNode||document.body).appendChild(this.overlay):this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay)},u.DialogManager.prototype.containedByTopDialog_=function(e){for(;e=s(e);){for(var t,i=0;t=this.pendingDialogStack[i];++i)if(t.dialog===e)return 0===i;e=e.parentElement}return!1},u.DialogManager.prototype.handleFocus_=function(e){if(!this.containedByTopDialog_(e.target)&&(e.preventDefault(),e.stopPropagation(),o(e.target),void 0!==this.forwardTab_)){var t=this.pendingDialogStack[0];return t.dialog.compareDocumentPosition(e.target)&Node.DOCUMENT_POSITION_PRECEDING&&(this.forwardTab_?t.focus_():document.documentElement.focus()),!1}},u.DialogManager.prototype.handleKey_=function(e){if(this.forwardTab_=void 0,27===e.keyCode){e.preventDefault(),e.stopPropagation();var t=new r("cancel",{bubbles:!1,cancelable:!0}),i=this.pendingDialogStack[0];i&&i.dialog.dispatchEvent(t)&&i.dialog.close()}else 9===e.keyCode&&(this.forwardTab_=!e.shiftKey)},u.DialogManager.prototype.checkDOM_=function(e){this.pendingDialogStack.slice().forEach((function(t){-1!==e.indexOf(t.dialog)?t.downgradeModal():t.maybeHideModal()}))},u.DialogManager.prototype.pushDialog=function(e){var t=(this.zIndexHigh_-this.zIndexLow_)/2-1;return!(this.pendingDialogStack.length>=t||(1===this.pendingDialogStack.unshift(e)&&this.blockDocument(),this.updateStacking(),0))},u.DialogManager.prototype.removeDialog=function(e){var t=this.pendingDialogStack.indexOf(e);-1!==t&&(this.pendingDialogStack.splice(t,1),0===this.pendingDialogStack.length&&this.unblockDocument(),this.updateStacking())},u.dm=new u.DialogManager,u.formSubmitter=null,u.useValue=null,void 0===window.HTMLDialogElement){var h=document.createElement("form");if(h.setAttribute("method","dialog"),"dialog"!==h.method){var d=Object.getOwnPropertyDescriptor(HTMLFormElement.prototype,"method");if(d){var p=d.get;d.get=function(){return l(this)?"dialog":p.call(this)};var f=d.set;d.set=function(e){return"string"==typeof e&&"dialog"===e.toLowerCase()?this.setAttribute("method",e):f.call(this,e)},Object.defineProperty(HTMLFormElement.prototype,"method",d)}}document.addEventListener("click",(function(e){if(u.formSubmitter=null,u.useValue=null,!e.defaultPrevented){var t=e.target;if(t&&l(t.form)){if(!("submit"===t.type&&["button","input"].indexOf(t.localName)>-1)){if("input"!==t.localName||"image"!==t.type)return;u.useValue=e.offsetX+","+e.offsetY}s(t)&&(u.formSubmitter=t)}}}),!1);var m=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=function(){if(!l(this))return m.call(this);var e=s(this);e&&e.close()},document.addEventListener("submit",(function(e){var t=e.target;if(l(t)){e.preventDefault();var i=s(t);if(i){var n=u.formSubmitter;n&&n.form===t?i.close(u.useValue||n.value):i.close(),u.formSubmitter=null}}}),!0)}u.forceRegisterDialog=u.forceRegisterDialog,u.registerDialog=u.registerDialog,"amd"in i.amdD?void 0===(n=function(){return u}.call(t,i,t,e))||(e.exports=n):"object"==typeof e.exports?e.exports=u:window.dialogPolyfill=u}()},735:e=>{!function(e){function t(){var e=1<=arguments.length?[].slice.call(arguments,0):[],t=e.shift(),i=e.shift();Error.apply(this,e),this.message=this.message||"Invalid Geometry: item: "+JSON.stringify(t)+", params: "+JSON.stringify(i)}e.version="0.5.0",e.defaults={doThrows:{invalidGeometry:!1}},t.prototype=Error,e.errors={InvalidGeometryError:t},e.isGeometryValid=function(e){return!(!e||!Object.keys(e).length)&&!!e.type&&!!e.coordinates&&Array.isArray(e.coordinates)&&!!e.coordinates.length},e.parse=function(e,t,o){var a,l,c=function(e,t){var i=e||{};for(var n in t)t.hasOwnProperty(n)&&!i[n]&&(i[n]=t[n]);return i}(t,this.defaults);if(n.length=0,function(e){for(var t in e.geom={},e)e.hasOwnProperty(t)&&-1!==i.indexOf(t)&&(e.geom[t]=e[t],delete e[t]);!function(e){for(var t in e)e.hasOwnProperty(t)&&("string"==typeof e[t]?n.push(e[t]):"object"==typeof e[t]&&(n.push(e[t][0]),n.push(e[t][1])));if(0===n.length)throw new Error("No geometry attributes specified")}(e.geom)}(c),l=function(e){var t;return e.exclude||e.include?e.include?t=function(t){e.include.forEach((function(e){t[e]=this[e]}),this)}:e.exclude&&(t=function(t){for(var i in this)this.hasOwnProperty(i)&&-1===n.indexOf(i)&&-1===e.exclude.indexOf(i)&&(t[i]=this[i])}):t=function(e){for(var t in this)this.hasOwnProperty(t)&&-1===n.indexOf(t)&&(e[t]=this[t])},function(){var i={};return t.call(this,i),e.extra&&function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}(i,e.extra),i}}(c),Array.isArray(e)?(a={type:"FeatureCollection",features:[]},e.forEach((function(e){a.features.push(s({item:e,params:c,propFunc:l}))})),r(a,c)):r(a=s({item:e,params:c,propFunc:l}),c),!o||"function"!=typeof o)return a;o(a)};var i=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","GeoJSON"],n=[];function r(e,t){if(t.crs&&function(e){if("name"===e.type){if(e.properties&&e.properties.name)return!0;throw new Error('Invalid CRS. Properties must contain "name" key')}if("link"===e.type){if(e.properties&&e.properties.href&&e.properties.type)return!0;throw new Error('Invalid CRS. Properties must contain "href" and "type" key')}throw new Error('Invald CRS. Type attribute must be "name" or "link"')}(t.crs)&&(t.isPostgres?e.geometry.crs=t.crs:e.crs=t.crs),t.bbox&&(e.bbox=t.bbox),t.extraGlobal)for(var i in e.properties={},t.extraGlobal)e.properties[i]=t.extraGlobal[i]}function s(e){var t=e.item,i=e.params,n=e.propFunc,r={type:"Feature"};return r.geometry=a(t,i),r.properties=n.call(t),r}function o(e){return/^.+\..+$/.test(e)}function a(i,n){var r={};for(var s in n.geom){var l=n.geom[s];if("string"==typeof l&&i.hasOwnProperty(l))"GeoJSON"===s?r=i[l]:(r.type=s,r.coordinates=i[l]);else if("object"!=typeof l||Array.isArray(l)){if(Array.isArray(l)&&i.hasOwnProperty(l[0])&&i.hasOwnProperty(l[1]))r.type=s,r.coordinates=[Number(i[l[1]]),Number(i[l[0]])];else if(Array.isArray(l)&&o(l[0])&&o(l[1])){for(var c=[],u=0;u<l.length;u++){for(var h=l[u].split("."),d=i,p=0;p<h.length;p++){if(!d.hasOwnProperty(h[p]))return!1;d=d[h[p]]}c[u]=d}r.type=s,r.coordinates=[Number(c[1]),Number(c[0])]}}else{var f=Object.keys(l).map((function(e){var t=l[e];return a(i[e],{geom:{Point:t}})}));r.type=s,r.coordinates=[].concat(f.map((function(e){return e.coordinates})))}}if(n.doThrows&&n.doThrows.invalidGeometry&&!e.isGeometryValid(r))throw new t(i,n);return r}}(e.exports)},842:function(e){e.exports=function(){"use strict";var e,t,i;function n(n,r){if(e)if(t){var s="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",o={};e(o),i=r(o),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([s],{type:"text/javascript"})))}else t=r;else e=r}return n(0,(function(e){var t="3.3.0";let i;const n={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==i){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{i=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch(t){i=e}}return i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!n.API_URL)return null;try{const e=new URL(n.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function r(e){return n.API_URL_REGEX.test(e)}function s(e){return 0===e.indexOf("mapbox:")}function o(e){return n.API_CDN_URL_REGEX.test(e)}function a(e){return n.API_SPRITE_REGEX.test(e)}function l(e){return n.API_STYLE_REGEX.test(e)&&!a(e)}const c={create:"create",load:"load",fullLoad:"fullLoad"};function u(e){const t=e.name.split("?")[0];return o(t)&&t.includes("mapbox-gl.js")?"javascript":o(t)&&t.includes("mapbox-gl.css")?"css":function(e){return n.API_FONTS_REGEX.test(e)}(t)?"fontRange":a(t)?"sprite":l(t)?"style":function(e){return n.API_TILEJSON_REGEX.test(e)}(t)?"tilejson":"other"}function h(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=p;function p(e,t,i,n){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=n}p.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,n=0;n<8;n++){var r=this.sampleCurveX(i)-e;if(Math.abs(r)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=r/s}var o=0,a=1;for(i=e,n=0;n<20&&(r=this.sampleCurveX(i),!(Math.abs(r-e)<t));n++)e>r?o=i:a=i,i=.5*(a-o)+o;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var f=h(d),m=g;function g(e,t){this.x=e,this.y=t}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),n=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=n,this},_rotateAround:function(e,t){var i=Math.cos(e),n=Math.sin(e),r=t.y+n*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-n*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(e){return e instanceof g?e:Array.isArray(e)?new g(e[0],e[1]):e};var _=h(m);const y=Math.PI/180,v=180/Math.PI;function x(e){return e*y}function b(e){return e*v}const w=[[0,0],[1,0],[1,1],[0,1]];function S(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function T(e,t,i,n){const r=new f(e,t,i,n);return function(e){return r.solve(e)}}const E=T(.25,.1,.25,1);function M(e,t,i){return Math.min(i,Math.max(t,e))}function I(e,t,i){return(i=M((i-e)/(t-e),0,1))*i*(3-2*i)}function A(e,t,i){const n=i-t,r=((e-t)%n+n)%n+t;return r===t?i:r}function C(e,t,i){if(!e.length)return i(null,[]);let n=e.length;const r=new Array(e.length);let s=null;e.forEach(((e,o)=>{t(e,((e,t)=>{e&&(s=e),r[o]=t,0==--n&&i(s,r)}))}))}function P(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}let k=1;function R(){return k++}function L(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function D(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function O(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function N(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function z(e,t){return-1!==e.indexOf(t,e.length-t.length)}function F(e,t,i){const n={};for(const r in e)n[r]=t.call(i||this,e[r],r,e);return n}function B(e,t,i){const n={};for(const r in e)t.call(i||this,e[r],r,e)&&(n[r]=e[r]);return n}function U(e){return Array.isArray(e)?e.map(U):"object"==typeof e&&e?F(e,U):e}const V={};function j(e){V[e]||("undefined"!=typeof console&&console.warn(e),V[e]=!0)}function G(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function H(e){let t=0;for(let i,n,r=0,s=e.length,o=s-1;r<s;o=r++)i=e[r],n=e[o],t+=(n.x-i.x)*(i.y+n.y);return t}function W([e,t,i]){const n=x(t+90),r=x(i);return{x:e*Math.cos(n)*Math.sin(r),y:e*Math.sin(n)*Math.sin(r),z:e*Math.cos(r),azimuthal:t,polar:i}}function q(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function $(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,i,n,r)=>{const s=n||r;return t[i]=!s||s.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let Z,X,Y,K,J,Q,ee=null;function te(e){try{const t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function ie(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function ne(e,t,i,n){for(;t<i;){const r=t+i>>1;e[r]<n?t=r+1:i=r}return t}function re(e,t,i,n){for(;t<i;){const r=t+i>>1;e[r]<=n?t=r+1:i=r}return t}function se(){return null==Z&&(Z=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),Z}const oe={now:()=>void 0!==K?K:performance.now(),setNow(e){K=e},restoreNow(){K=void 0},frame(e){const t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:i,height:n}=e;J||(J=document.createElement("canvas"));const r=J.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return(i>J.width||n>J.height)&&(J.width=i,J.height=n),r.clearRect(-t,-t,i+2*t,n+2*t),r.drawImage(e,0,0,i,n),r.getImageData(-t,-t,i+2*t,n+2*t)},resolveURL:e=>(X||(X=document.createElement("a")),X.href=e,X.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==Y&&(Y=window.matchMedia("(prefers-reduced-motion: reduce)")),Y.matches)},hasCanvasFingerprintNoise(){if(void 0!==Q)return Q;if(!se())return Q=!1,!1;const e=new OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let i=0;for(let n=0;n<e.width;++n)t.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,t.fillRect(n,0,1,1);const n=t.getImageData(0,0,e.width,e.height);i=0;for(let e=0;e<n.data.length;++e)if(e%4!=3&&i++!==n.data[e])return Q=!0,!0;return Q=!1,!1}},ae="mapbox-tiles";let le,ce,ue=500,he=50;function de(){try{return caches}catch(e){}}function pe(){const e=de();e&&!le&&(le=e.open(ae))}function fe(e){const t=e.indexOf("?");if(t<0)return e;const i=["language","worldview"],n=new URLSearchParams,r=new URLSearchParams(e.slice(t));for(const e of i){const t=r.get(e);t&&n.set(e,t)}return`${e.slice(0,t)}?${n.toString()}`}function me(e,t){const i=e.indexOf("?");if(i<0)return`${e}?${new URLSearchParams(t).toString()}`;const n=new URLSearchParams(e.slice(i));for(const e in t)n.set(e,t[e]);return`${e.slice(0,i)}?${n.toString()}`}let ge=1/0;const _e={supported:!1,testSupport:function(e){!xe&&ve&&(be?Se(e):ye=e)}};let ye,ve,xe=!1,be=!1;const we="undefined"!=typeof self?self:{};function Se(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,ve),e.isContextLost())return;_e.supported=!0}catch(e){}e.deleteTexture(t),xe=!0}we.document&&(ve=we.document.createElement("img"),ve.onload=function(){ye&&Se(ye),ye=null,be=!0},ve.onerror=function(){xe=!0,ye=null},ve.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Te={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Te);class Ee extends Error{constructor(e,t,i){401===t&&r(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Me=q()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Ie=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(Me())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(e,t){const i=new AbortController,n=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Me(),referrerPolicy:e.referrerPolicy,signal:i.signal});let s=!1,o=!1;const a=(l=n.url).indexOf("sku=")>0&&r(l);var l;"json"===e.type&&n.headers.set("Accept","application/json");const c=(i,r,s)=>{if(o)return;if(i&&"SecurityError"!==i.message&&j(i.toString()),r&&s)return u(r);const l=Date.now();fetch(n).then((i=>{if(i.ok){const e=a?i.clone():null;return u(i,e,l)}return t(new Ee(i.statusText,i.status,e.url))})).catch((i=>{"AbortError"!==i.name&&t(new Error(`${i.message} ${e.url}`))}))},u=(i,r,a)=>{("arrayBuffer"===e.type?i.arrayBuffer():"json"===e.type?i.json():i.text()).then((e=>{o||(r&&a&&function(e,t,i){if(pe(),!le)return;const n=$(t.headers.get("Cache-Control")||"");if(n["no-store"])return;const r={status:t.status,statusText:t.statusText,headers:new Headers};t.headers.forEach(((e,t)=>r.headers.set(t,e))),n["max-age"]&&r.headers.set("Expires",new Date(i+1e3*n["max-age"]).toUTCString());const s=r.headers.get("Expires");if(!s)return;if(new Date(s).getTime()-i<42e4)return;let o=fe(e.url);if(206===t.status){const t=e.headers.get("Range");if(!t)return;r.status=200,o=me(o,{range:t})}!function(e,t){if(void 0===ce)try{new Response(new ReadableStream),ce=!0}catch(e){ce=!1}ce?t(e.body):e.blob().then(t)}(t,(e=>{const t=new Response(e,r);pe(),le&&le.then((e=>e.put(o,t))).catch((e=>j(e.message)))}))}(n,r,a),s=!0,t(null,e,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((e=>{o||t(new Error(e.message))}))};return a?function(e,t){if(pe(),!le)return t(null);le.then((i=>{let n=fe(e.url);const r=e.headers.get("Range");r&&(n=me(n,{range:r})),i.match(n).then((e=>{const r=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),i=$(e.headers.get("Cache-Control")||"");return t>Date.now()&&!i["no-cache"]}(e);i.delete(n),r&&i.put(n,e.clone()),t(null,e,r)})).catch(t)})).catch(t)}(n,c):c(null,null),{cancel:()=>{o=!0,s||i.abort()}}}(e,t);if(q()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(e,t){const i=new XMLHttpRequest;i.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(i.responseType="arraybuffer");for(const t in e.headers)i.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===e.credentials,i.onerror=()=>{t(new Error(i.statusText))},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let n=i.response;if("json"===e.type)try{n=JSON.parse(i.response)}catch(e){return t(e)}t(null,n,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else t(new Ee(i.statusText,i.status,e.url))},i.send(e.body),{cancel:()=>i.abort()}}(e,t)},Ae=function(e,t){return Ie(P(e,{type:"arrayBuffer"}),t)};function Ce(e){const t=document.createElement("a");return t.href=e,t.protocol===location.protocol&&t.host===location.host}const Pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ke,Re;ke=[],Re=0;const Le=function(e,t){if(_e.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Re>=n.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return ke.push(i),i}Re++;let i=!1;const r=()=>{if(!i)for(i=!0,Re--;ke.length&&Re<n.MAX_PARALLEL_IMAGE_REQUESTS;){const e=ke.shift(),{requestParameters:t,callback:i,cancelled:n}=e;n||(e.cancel=Le(t,i).cancel)}},s=Ae(e,((e,i,n,s)=>{r(),e?t(e):i&&(self.createImageBitmap?function(e,t){const i=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(i).then((e=>{t(null,e)})).catch((e=>{t(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(i,((e,i)=>t(e,i,n,s))):function(e,t){const i=new Image;i.onload=()=>{t(null,i),URL.revokeObjectURL(i.src),i.onload=null,requestAnimationFrame((()=>{i.src=Pe}))},i.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(e)],{type:"image/png"});i.src=e.byteLength?URL.createObjectURL(n):Pe}(i,((e,i)=>t(e,i,n,s))))}));return{cancel:()=>{s.cancel(),r()}}},De="01",Oe="NO_ACCESS_TOKEN",Ne=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ze(e){const t=e.match(Ne);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Fe(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const Be="mapbox.eventData";function Ue(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(atob(t[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class Ve{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=Ue(n.ACCESS_TOKEN);let i="";return i=t&&t.u?btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):n.ACCESS_TOKEN||"",e?`${Be}.${e}:${i}`:`${Be}:${i}`}fetchEventData(){const e=te("localStorage"),t=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{const e=localStorage.getItem(t);e&&(this.eventData=JSON.parse(e));const n=localStorage.getItem(i);n&&(this.anonId=n)}catch(e){j("Unable to read from LocalStorage")}}saveEventData(){const e=te("localStorage"),t=this.getStorageKey(),i=this.getStorageKey("uuid"),n=this.anonId;if(e&&n)try{localStorage.setItem(i,n),Object.keys(this.eventData).length>=1&&localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){j("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,i,r){if(!n.EVENTS_URL)return;const s=ze(n.EVENTS_URL);s.params.push(`access_token=${r||n.ACCESS_TOKEN||""}`);const o={event:this.type,created:new Date(e).toISOString()},a=t?P(o,t):o,l={url:Fe(s),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=function(e,t){return Ie(P(e,{method:"POST"}),t)}(l,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(r)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const je=new class extends Ve{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){n.EVENTS_URL&&n.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>s(e)||r(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Ue(n.ACCESS_TOKEN),r=i?i.u:n.ACCESS_TOKEN;let s=r!==this.eventData.tokenU;O(this.anonId)||(this.anonId=L(),s=!0);const o=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(o),i=(o-this.eventData.lastSuccess)/864e5;s=s||i>=1||i<-1||e.getDate()!==t.getDate()}else s=!0;s?this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:De,"enabled.telemetry":!1,userId:this.anonId},(e=>{e||(this.eventData.lastSuccess=o,this.eventData.tokenU=r)}),e):this.processRequests()}},Ge=je.postTurnstileEvent.bind(je),He=new class extends Ve{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,r){this.skuToken=t,this.errorCb=r,n.EVENTS_URL&&(i||n.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(Oe)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:n}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),O(this.anonId)||(this.anonId=L()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:De,skuToken:this.skuToken,userId:this.anonId},(e=>{e?this.errorCb(e):i&&(this.success[i]=!0)}),e))}remove(){this.errorCb=null}},We=He.postMapLoadEvent.bind(He),qe=new class extends Ve{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){n.EVENTS_URL&&(e||n.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:n}=this.queue.shift(),r=function(e){const i=performance.getEntriesByType("resource"),n=performance.getEntriesByType("mark"),r=function(e){const t={};if(e)for(const i in e)if("other"!==i)for(const n of e[i]){const e=`${i}ResolveRangeMin`,r=`${i}ResolveRangeMax`,s=`${i}RequestCount`,o=`${i}RequestCachedCount`;t[e]=Math.min(t[e]||1/0,n.startTime),t[r]=Math.max(t[r]||-1/0,n.responseEnd);const a=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==n.transferSize&&0===n.transferSize&&a(o),a(s)}return t}(function(e,t){const i={};if(e)for(const n of e){const e=t(n);void 0===i[e]&&(i[e]=[]),i[e].push(n)}return i}(i,u)),s=window.devicePixelRatio,o=navigator.connection||navigator.mozConnection||navigator.webkitConnection,a=o?o.effectiveType:void 0,h={counters:[],metadata:[],attributes:[]},d=(e,t,i)=>{null!=i&&e.push({name:t,value:i.toString()})};for(const e in r)d(h.counters,e,r[e]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(d(h.counters,"interactionRangeMin",e.interactionRange[0]),d(h.counters,"interactionRangeMax",e.interactionRange[1])),n)for(const e of Object.keys(c)){const t=c[e],i=n.find((e=>e.name===t));i&&d(h.counters,t,i.startTime)}return d(h.counters,"visibilityHidden",e.visibilityHidden),d(h.attributes,"style",function(e){if(e)for(const t of e){const e=t.name.split("?")[0];if(l(e)){const t=e.split("/").slice(-2);if(2===t.length)return`mapbox://styles/${t[0]}/${t[1]}`}}}(i)),d(h.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),d(h.attributes,"fogEnabled",e.fogEnabled?"true":"false"),d(h.attributes,"projection",e.projection),d(h.attributes,"zoom",e.zoom),d(h.metadata,"devicePixelRatio",s),d(h.metadata,"connectionEffectiveType",a),d(h.metadata,"navigatorUserAgent",navigator.userAgent),d(h.metadata,"screenWidth",window.screen.width),d(h.metadata,"screenHeight",window.screen.height),d(h.metadata,"windowWidth",window.innerWidth),d(h.metadata,"windowHeight",window.innerHeight),d(h.metadata,"mapWidth",e.width/s),d(h.metadata,"mapHeight",e.height/s),d(h.metadata,"webglRenderer",e.renderer),d(h.metadata,"webglVendor",e.vendor),d(h.metadata,"sdkVersion",t),d(h.metadata,"sdkIdentifier","mapbox-gl-js"),h}(n);for(const e of r.metadata);for(const e of r.counters);for(const e of r.attributes);this.postEvent(i,r,(()=>{}),e)}},$e=qe.postPerformanceEvent.bind(qe),Ze=new class extends Ve{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,r){if(!n.API_URL||!n.SESSION_PATH)return;const s=ze(n.API_URL+n.SESSION_PATH);s.params.push(`sku=${t||""}`),s.params.push(`access_token=${r||n.ACCESS_TOKEN||""}`);const o={url:Fe(s),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(e,t){return Ie(P(e,{method:"GET"}),t)}(o,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(r)}))}getSessionAPI(e,t,i,r){this.skuToken=t,this.errorCb=r,n.SESSION_PATH&&n.API_URL&&(i||n.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(Oe)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}remove(){this.errorCb=null}},Xe=Ze.getSessionAPI.bind(Ze),Ye=new Set;function Ke(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t))}function Je(e,t,i){if(i&&i[e]){const n=i[e].indexOf(t);-1!==n&&i[e].splice(n,1)}}class Qe{constructor(e,t={}){P(this,t),this.type=e}}class et extends Qe{constructor(e,t={}){super("error",P({error:e},t))}}class tt{on(e,t){return this._listeners=this._listeners||{},Ke(e,t,this._listeners),this}off(e,t){return Je(e,t,this._listeners),Je(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Ke(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new Qe(e,t||{}));const i=e.type;if(this.listens(i)){e.target=this;const t=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of t)i.call(this,e);const n=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const t of n)Je(i,t,this._oneTimeListeners),t.call(this,e);const r=this._eventedParent;r&&(P(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(e))}else e instanceof et&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}e.y=void 0;var it={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function nt(e){return(e=Math.round(e))<0?0:e>255?255:e}function rt(e){return nt("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function st(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function ot(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{e.y={}.parseCSSColor=function(e){var t,i=e.replace(/ /g,"").toLowerCase();if(i in it)return it[i].slice();if("#"===i[0])return 4===i.length?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===i.length&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var n=i.indexOf("("),r=i.indexOf(")");if(-1!==n&&r+1===i.length){var s=i.substr(0,n),o=i.substr(n+1,r-(n+1)).split(","),a=1;switch(s){case"rgba":if(4!==o.length)return null;a=st(o.pop());case"rgb":return 3!==o.length?null:[rt(o[0]),rt(o[1]),rt(o[2]),a];case"hsla":if(4!==o.length)return null;a=st(o.pop());case"hsl":if(3!==o.length)return null;var l=(parseFloat(o[0])%360+360)%360/360,c=st(o[1]),u=st(o[2]),h=u<=.5?u*(c+1):u+c-u*c,d=2*u-h;return[nt(255*ot(d,h,l+1/3)),nt(255*ot(d,h,l)),nt(255*ot(d,h,l-1/3)),a];default:return null}}return null}}catch(e){}class at{constructor(e,t,i,n=1){this.r=e,this.g=t,this.b=i,this.a=n}static parse(t){if(!t)return;if(t instanceof at)return t;if("string"!=typeof t)return;const i=e.y(t);return i?new at(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,t,i,n]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${n})`}toArray(){const{r:e,g:t,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*t/n,255*i/n,n]}toArray01(){const{r:e,g:t,b:i,a:n}=this;return 0===n?[0,0,0,0]:[e/n,t/n,i/n,n]}toArray01Scaled(e){const{r:t,g:i,b:n,a:r}=this;return 0===r?[0,0,0]:[t/r*e,i/r*e,n/r*e]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:i,a:n}=this;return[e,t,i,n]}toArray01Linear(){const{r:e,g:t,b:i,a:n}=this;return 0===n?[0,0,0,0]:[Math.pow(e/n,2.2),Math.pow(t/n,2.2),Math.pow(i/n,2.2),n]}}at.black=new at(0,0,0,1),at.white=new at(1,1,1,1),at.transparent=new at(0,0,0,0),at.red=new at(1,0,0,1),at.blue=new at(0,0,1,1);var lt=at;function ct(e,t,i){return e*(1-i)+t*i}function ut(e,t,i){return e.map(((e,n)=>ct(e,t[n],i)))}var ht=Object.freeze({__proto__:null,array:ut,color:function(e,t,i){return new lt(ct(e.r,t.r,i),ct(e.g,t.g,i),ct(e.b,t.b,i),ct(e.a,t.a,i))},number:ct});function dt(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}class pt extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var ft=pt;class mt{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new mt(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var gt=mt;const _t={kind:"null"},yt={kind:"number"},vt={kind:"string"},xt={kind:"boolean"},bt={kind:"color"},wt={kind:"object"},St={kind:"value"},Tt={kind:"collator"},Et={kind:"formatted"},Mt={kind:"resolvedImage"};function It(e,t){return{kind:"array",itemType:e,N:t}}function At(e){if("array"===e.kind){const t=At(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Ct=[_t,yt,vt,xt,bt,Et,wt,It(St),Mt];function Pt(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Pt(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Ct)if(!Pt(e,t))return null}return`Expected ${At(e)} but found ${At(t)} instead.`}function kt(e,t){return t.some((t=>t.kind===e.kind))}function Rt(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}class Lt{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Dt{constructor(e,t,i,n,r){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=n,this.textColor=r}}class Ot{constructor(e){this.sections=e}static fromString(e){return new Ot([new Dt(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length))}static factory(e){return e instanceof Ot?e:Ot.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.namePrimary]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(i)}return e}}class Nt{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,t){return e?new Nt({namePrimary:e,nameSecondary:t,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function zt(e,t,i,n){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,t,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[e,t,i,n]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ft(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof lt)return!0;if(e instanceof Lt)return!0;if(e instanceof Ot)return!0;if(e instanceof Nt)return!0;if(Array.isArray(e)){for(const t of e)if(!Ft(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Ft(e[t]))return!1;return!0}return!1}function Bt(e){if(null===e)return _t;if("string"==typeof e)return vt;if("boolean"==typeof e)return xt;if("number"==typeof e)return yt;if(e instanceof lt)return bt;if(e instanceof Lt)return Tt;if(e instanceof Ot)return Et;if(e instanceof Nt)return Mt;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=Bt(t);if(i){if(i===e)continue;i=St;break}i=e}return It(i||St,t)}return wt}function Ut(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof lt||e instanceof Ot||e instanceof Nt?e.toString():JSON.stringify(e)}class Vt{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ft(e[1]))return t.error("invalid value");const i=e[1];let n=Bt(i);const r=t.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new Vt(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof lt?["rgba"].concat(this.value.toArray()):this.value instanceof Ot?this.value.serialize():this.value}}var jt=Vt,Gt=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const Ht={string:vt,number:yt,boolean:xt,object:wt};class Wt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,n=1;const r=e[0];if("array"===r){let r,s;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in Ht)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);r=Ht[i],n++}else r=St;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);s=e[2],n++}i=It(r,s)}else i=Ht[r];const s=[];for(;n<e.length;n++){const i=t.parse(e[n],n,St);if(!i)return null;s.push(i)}return new Wt(i,s)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!Pt(this.type,Bt(i)))return i;if(t===this.args.length-1)throw new Gt(`Expected value to be of type ${At(this.type)}, but found ${At(Bt(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){t.push(i.kind);const n=e.N;("number"==typeof n||this.args.length>1)&&t.push(n)}}return t.concat(this.args.map((e=>e.serialize())))}}var qt=Wt;class $t{constructor(e){this.type=Et,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const n=[];let r=!1;for(let i=1;i<=e.length-1;++i){const s=e[i];if(r&&"object"==typeof s&&!Array.isArray(s)){r=!1;let e=null;if(s["font-scale"]&&(e=t.parse(s["font-scale"],1,yt),!e))return null;let i=null;if(s["text-font"]&&(i=t.parse(s["text-font"],1,It(vt)),!i))return null;let o=null;if(s["text-color"]&&(o=t.parse(s["text-color"],1,bt),!o))return null;const a=n[n.length-1];a.scale=e,a.font=i,a.textColor=o}else{const s=t.parse(e[i],1,St);if(!s)return null;const o=s.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:s,scale:null,font:null,textColor:null})}}return new $t(n)}evaluate(e){return new Ot(this.sections.map((t=>{const i=t.content.evaluate(e);return Bt(i)===Mt?new Dt("",i,null,null,null):new Dt(Ut(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class Zt{constructor(e,t){this.type=Mt,this.inputPrimary=e,this.inputSecondary=t}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");const i=t.parse(e[1],1,vt);if(!i)return t.error("No image name provided.");if(2===e.length)return new Zt(i);const n=t.parse(e[2],1,vt);return n?new Zt(i,n):t.error("Secondary image variant is not a string.")}evaluate(e){const t=Nt.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return t&&e.availableImages&&(t.available=e.availableImages.indexOf(t.namePrimary)>-1,t.nameSecondary&&t.available&&e.availableImages&&(t.available=e.availableImages.indexOf(t.nameSecondary)>-1)),t}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Xt(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const Yt={"to-boolean":xt,"to-color":bt,"to-number":yt,"to-string":vt};class Kt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0],n=[];let r=_t;if("to-array"===i){if(!Array.isArray(e[1]))return null;const i=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error(`Expected ${t.expectedType.kind} but found array.`);r=It(t.expectedType.itemType,i)}else{if(!(i>0&&Ft(e[1][0])))return null;r=It(Bt(e[1][0]),i)}for(let s=0;s<i;s++){const i=e[1][s];let o;if("array"===Xt(i))o=t.parse(i,void 0,r.itemType);else{const e=Xt(i);if(e!==r.itemType.kind)return t.error(`Expected ${r.itemType.kind} but found ${e}.`);o=t.registry.literal.parse(["literal",void 0===i?null:i],t)}if(!o)return null;n.push(o)}}else{if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");r=Yt[i];for(let i=1;i<e.length;i++){const r=t.parse(e[i],i,St);if(!r)return null;n.push(r)}}return new Kt(r,n)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,i;for(const n of this.args){if(t=n.evaluate(e),i=null,t instanceof lt)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:zt(t[0],t[1],t[2],t[3]),!i))return new lt(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Gt(i||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const n=Number(t);if(!isNaN(n))return n}throw new Gt(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?Ot.fromString(Ut(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Nt.fromString(Ut(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map((t=>t.evaluate(e))):Ut(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new $t([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Zt(this.args[0]).serialize();const e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Jt=Kt;const Qt=["Unknown","Point","LineString","Polygon"];var ei=class{constructor(e,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Qt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(n*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=lt.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class ti{constructor(e,t,i,n,r){this.name=e,this.type=t,this._evaluate=i,this.args=n,this._overloadIndex=r}evaluate(e){if(!this._evaluate){const e=ti.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],n=ti.definitions[i];if(!n)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,s=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,o=[];let a=null,l=-1;for(const[n,c]of s){if(Array.isArray(n)&&n.length!==e.length-1)continue;o.push(n),l++,a=new bn(t.registry,t.path,null,t.scope,void 0,t._scope,t.options);const s=[];let u=!1;for(let t=1;t<e.length;t++){const i=e[t],r=Array.isArray(n)?n[t-1]:n.type,o=a.parse(i,1+s.length,r);if(!o){u=!0;break}s.push(o)}if(!u)if(Array.isArray(n)&&n.length!==s.length)a.error(`Expected ${n.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){const t=Array.isArray(n)?n[e]:n.type,i=s[e];a.concat(e+1).checkSubtype(t,i.type)}if(0===a.errors.length)return new ti(i,r,c,s,l)}}if(1===o.length)t.errors.push(...a.errors);else{const i=(o.length?o:s.map((([e])=>e))).map(ii).join(" | "),n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],1+n.length);if(!r)return null;n.push(At(r.type))}t.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(e,t){ti.definitions=t;for(const i in t)e[i]=ti}}function ii(e){return Array.isArray(e)?`(${e.map(At).join(", ")})`:`(${At(e.type)}...)`}var ni=ti;class ri{constructor(e,t,i){this.type=Tt,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const n=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,xt);if(!n)return null;const r=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,xt);if(!r)return null;let s=null;return i.locale&&(s=t.parse(i.locale,1,vt),!s)?null:new ri(n,r,s)}evaluate(e){return new Lt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var si={exports:{}};si.exports=function(){function e(i,n,r,s,o){for(;s>r;){if(s-r>600){var a=s-r+1,l=n-r+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);e(i,n,Math.max(r,Math.floor(n-l*u/a+h)),Math.min(s,Math.floor(n+(a-l)*u/a+h)),o)}var d=i[n],p=r,f=s;for(t(i,r,n),o(i[s],d)>0&&t(i,r,s);p<f;){for(t(i,p,f),p++,f--;o(i[p],d)<0;)p++;for(;o(i[f],d)>0;)f--}0===o(i[r],d)?t(i,r,f):t(i,++f,s),f<=n&&(r=f+1),n<=f&&(s=f-1)}}function t(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function i(e,t){return e<t?-1:e>t?1:0}return function(t,n,r,s,o){e(t,n,r||0,s||t.length-1,o||i)}}();var oi=h(si.exports);function ai(e){let t=0;for(let i,n,r=0,s=e.length,o=s-1;r<s;o=r++)i=e[r],n=e[o],t+=(n.x-i.x)*(i.y+n.y);return t}function li(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function ci(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function ui(e,t,i){const n=e[0]-t[0],r=e[1]-t[1],s=e[0]-i[0],o=e[1]-i[1];return n*o-s*r==0&&n*s<=0&&r*o<=0}function hi(e,t,i=!1){let n=!1;for(let a=0,l=t.length;a<l;a++){const l=t[a];for(let t=0,a=l.length,c=a-1;t<a;c=t++){const a=l[c],u=l[t];if(ui(e,a,u))return i;(s=a)[1]>(r=e)[1]!=(o=u)[1]>r[1]&&r[0]<(o[0]-s[0])*(r[1]-s[1])/(o[1]-s[1])+s[0]&&(n=!n)}}var r,s,o;return n}function di(e,t,i,n){const r=n[0]-i[0],s=n[1]-i[1],o=(e[0]-i[0])*s-r*(e[1]-i[1]),a=(t[0]-i[0])*s-r*(t[1]-i[1]);return o>0&&a<0||o<0&&a>0}function pi(e,t,i,n){return 0!=(r=[n[0]-i[0],n[1]-i[1]])[0]*(s=[t[0]-e[0],t[1]-e[1]])[1]-r[1]*s[0]&&!(!di(e,t,i,n)||!di(i,n,e,t));var r,s}const fi=8192;function mi(e,t){const i=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(i*r*fi),Math.round(n*r*fi)]}function gi(e,t){for(let i=0;i<t.length;i++)if(hi(e,t[i]))return!0;return!1}function _i(e,t,i){for(const n of i)for(let i=0,r=n.length,s=r-1;i<r;s=i++)if(pi(e,t,n[s],n[i]))return!0;return!1}function yi(e,t){for(let i=0;i<e.length;++i)if(!hi(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(_i(e[i],e[i+1],t))return!1;return!0}function vi(e,t){for(let i=0;i<t.length;i++)if(yi(e,t[i]))return!0;return!1}function xi(e,t,i){const n=[];for(let r=0;r<e.length;r++){const s=[];for(let n=0;n<e[r].length;n++){const o=mi(e[r][n],i);li(t,o),s.push(o)}n.push(s)}return n}function bi(e,t,i){const n=[];for(let r=0;r<e.length;r++){const s=xi(e[r],t,i);n.push(s)}return n}function wi(e,t,i,n){if(e[0]<i[0]||e[0]>i[2]){const t=.5*n;let r=e[0]-i[0]>t?-n:i[0]-e[0]>t?n:0;0===r&&(r=e[0]-i[2]>t?-n:i[2]-e[0]>t?n:0),e[0]+=r}li(t,e)}function Si(e,t,i,n){const r=Math.pow(2,n.z)*fi,s=[n.x*fi,n.y*fi],o=[];if(!e)return o;for(const n of e)for(const e of n){const n=[e.x+s[0],e.y+s[1]];wi(n,t,i,r),o.push(n)}return o}function Ti(e,t,i,n){const r=Math.pow(2,n.z)*fi,s=[n.x*fi,n.y*fi],o=[];if(!e)return o;for(const i of e){const e=[];for(const n of i){const i=[n.x+s[0],n.y+s[1]];li(t,i),e.push(i)}o.push(e)}if(t[2]-t[0]<=r/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of o)for(const n of e)wi(n,t,i,r)}var a;return o}class Ei{constructor(e,t){this.type=xt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ft(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Ei(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Ei(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Ei(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const s=xi(t.coordinates,n,r),o=Si(e.geometry(),i,n,r);if(!ci(i,n))return!1;for(const e of o)if(!hi(e,s))return!1}if("MultiPolygon"===t.type){const s=bi(t.coordinates,n,r),o=Si(e.geometry(),i,n,r);if(!ci(i,n))return!1;for(const e of o)if(!gi(e,s))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const s=xi(t.coordinates,n,r),o=Ti(e.geometry(),i,n,r);if(!ci(i,n))return!1;for(const e of o)if(!yi(e,s))return!1}if("MultiPolygon"===t.type){const s=bi(t.coordinates,n,r),o=Ti(e.geometry(),i,n,r);if(!ci(i,n))return!1;for(const e of o)if(!vi(e,s))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Mi=Ei,Ii={exports:{}};Ii.exports=function(){var e={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},t=1/298.257223563,i=t*(2-t),n=Math.PI/180,r=function(t,r){if(void 0===t)throw new Error("No latitude given.");if(r&&!e[r])throw new Error("Unknown unit "+r+". Use one of: "+Object.keys(e).join(", "));var s=6378.137*n*(r?e[r]:1),o=Math.cos(t*n),a=1/(1-i*(1-o*o)),l=Math.sqrt(a);this.kx=s*l*o,this.ky=s*l*a*(1-i)},s={units:{configurable:!0}};function o(e,t){return e[0]===t[0]&&e[1]===t[1]}function a(e,t,i){var n=l(t[0]-e[0]);return[e[0]+n*i,e[1]+(t[1]-e[1])*i]}function l(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}return r.fromTile=function(e,t,i){var s=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),o=Math.atan(.5*(Math.exp(s)-Math.exp(-s)))/n;return new r(o,i)},s.units.get=function(){return e},r.prototype.distance=function(e,t){var i=l(e[0]-t[0])*this.kx,n=(e[1]-t[1])*this.ky;return Math.sqrt(i*i+n*n)},r.prototype.bearing=function(e,t){var i=l(t[0]-e[0])*this.kx;return Math.atan2(i,(t[1]-e[1])*this.ky)/n},r.prototype.destination=function(e,t,i){var r=i*n;return this.offset(e,Math.sin(r)*t,Math.cos(r)*t)},r.prototype.offset=function(e,t,i){return[e[0]+t/this.kx,e[1]+i/this.ky]},r.prototype.lineDistance=function(e){for(var t=0,i=0;i<e.length-1;i++)t+=this.distance(e[i],e[i+1]);return t},r.prototype.area=function(e){for(var t=0,i=0;i<e.length;i++)for(var n=e[i],r=0,s=n.length,o=s-1;r<s;o=r++)t+=l(n[r][0]-n[o][0])*(n[r][1]+n[o][1])*(i?-1:1);return Math.abs(t)/2*this.kx*this.ky},r.prototype.along=function(e,t){var i=0;if(t<=0)return e[0];for(var n=0;n<e.length-1;n++){var r=e[n],s=e[n+1],o=this.distance(r,s);if((i+=o)>t)return a(r,s,(t-(i-o))/o)}return e[e.length-1]},r.prototype.pointToSegmentDistance=function(e,t,i){var n=t[0],r=t[1],s=l(i[0]-n)*this.kx,o=(i[1]-r)*this.ky,a=0;return 0===s&&0===o||((a=(l(e[0]-n)*this.kx*s+(e[1]-r)*this.ky*o)/(s*s+o*o))>1?(n=i[0],r=i[1]):a>0&&(n+=s/this.kx*a,r+=o/this.ky*a)),s=l(e[0]-n)*this.kx,o=(e[1]-r)*this.ky,Math.sqrt(s*s+o*o)},r.prototype.pointOnLine=function(e,t){for(var i,n,r,s,o=1/0,a=0;a<e.length-1;a++){var c=e[a][0],u=e[a][1],h=l(e[a+1][0]-c)*this.kx,d=(e[a+1][1]-u)*this.ky,p=0;0===h&&0===d||((p=(l(t[0]-c)*this.kx*h+(t[1]-u)*this.ky*d)/(h*h+d*d))>1?(c=e[a+1][0],u=e[a+1][1]):p>0&&(c+=h/this.kx*p,u+=d/this.ky*p));var f=(h=l(t[0]-c)*this.kx)*h+(d=(t[1]-u)*this.ky)*d;f<o&&(o=f,i=c,n=u,r=a,s=p)}return{point:[i,n],index:r,t:Math.max(0,Math.min(1,s))}},r.prototype.lineSlice=function(e,t,i){var n=this.pointOnLine(i,e),r=this.pointOnLine(i,t);if(n.index>r.index||n.index===r.index&&n.t>r.t){var s=n;n=r,r=s}var a=[n.point],l=n.index+1,c=r.index;!o(i[l],a[0])&&l<=c&&a.push(i[l]);for(var u=l+1;u<=c;u++)a.push(i[u]);return o(i[c],r.point)||a.push(r.point),a},r.prototype.lineSliceAlong=function(e,t,i){for(var n=0,r=[],s=0;s<i.length-1;s++){var o=i[s],l=i[s+1],c=this.distance(o,l);if((n+=c)>e&&0===r.length&&r.push(a(o,l,(e-(n-c))/c)),n>=t)return r.push(a(o,l,(t-(n-c))/c)),r;n>e&&r.push(l)}return r},r.prototype.bufferPoint=function(e,t){var i=t/this.ky,n=t/this.kx;return[e[0]-n,e[1]-i,e[0]+n,e[1]+i]},r.prototype.bufferBBox=function(e,t){var i=t/this.ky,n=t/this.kx;return[e[0]-n,e[1]-i,e[2]+n,e[3]+i]},r.prototype.insideBBox=function(e,t){return l(e[0]-t[0])>=0&&l(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]},Object.defineProperties(r,s),r}();var Ai=h(Ii.exports),Ci={exports:{}};Ci.exports=function(){var e=function(e,i){if(void 0===e&&(e=[]),void 0===i&&(i=t),this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function t(e,t){return e<t?-1:e>t?1:0}return e.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(e){for(var t=this.data,i=this.compare,n=t[e];e>0;){var r=e-1>>1,s=t[r];if(i(n,s)>=0)break;t[e]=s,e=r}t[e]=n},e.prototype._down=function(e){for(var t=this.data,i=this.compare,n=this.length>>1,r=t[e];e<n;){var s=1+(e<<1),o=t[s],a=s+1;if(a<this.length&&i(t[a],o)<0&&(s=a,o=t[a]),i(o,r)>=0)break;t[e]=o,e=s}t[e]=r},e}();var Pi=h(Ci.exports),ki=8192;function Ri(e,t){return t.dist-e.dist}const Li=100,Di=50;function Oi(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function Ni(e){return e[1]-e[0]+1}function zi(e,t){const i=e[1]>=e[0]&&e[1]<t;return i||console.warn("Distance Expression: Index is out of range"),i}function Fi(e,t){if(e[0]>e[1])return[null,null];const i=Ni(e);if(t){if(2===i)return[e,null];const t=Math.floor(i/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===i)return[e,null];const t=Math.floor(i/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function Bi(e,t){const i=[1/0,1/0,-1/0,-1/0];if(!zi(t,e.length))return i;for(let n=t[0];n<=t[1];++n)li(i,e[n]);return i}function Ui(e){const t=[1/0,1/0,-1/0,-1/0];for(let i=0;i<e.length;++i)for(let n=0;n<e[i].length;++n)li(t,e[i][n]);return t}function Vi(e,t,i){if(Oi(e)||Oi(t))return NaN;let n=0,r=0;return e[2]<t[0]&&(n=t[0]-e[2]),e[0]>t[2]&&(n=e[0]-t[2]),e[1]>t[3]&&(r=e[1]-t[3]),e[3]<t[1]&&(r=t[1]-e[3]),i.distance([0,0],[n,r])}function ji(e){return 360*e-180}function Gi(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Hi(e,t){const i=Math.pow(2,t.z),n=(e.y/ki+t.y)/i;return[ji((e.x/ki+t.x)/i),Gi(n)]}function Wi(e,t){const i=[];for(let n=0;n<e.length;++n)i.push(Hi(e[n],t));return i}function qi(e,t,i){const n=i.pointOnLine(t,e).point;return i.distance(e,n)}function $i(e,t,i,n,r){const s=i.slice(n[0],n[1]+1);let o=1/0;for(let i=t[0];i<=t[1];++i)if(0===(o=Math.min(o,qi(e[i],s,r))))return 0;return o}function Zi(e,t,i,n,r){const s=Math.min(r.pointToSegmentDistance(e,i,n),r.pointToSegmentDistance(t,i,n)),o=Math.min(r.pointToSegmentDistance(i,e,t),r.pointToSegmentDistance(n,e,t));return Math.min(s,o)}function Xi(e,t,i,n,r){if(!zi(t,e.length)||!zi(n,i.length))return NaN;let s=1/0;for(let o=t[0];o<t[1];++o)for(let t=n[0];t<n[1];++t){if(pi(e[o],e[o+1],i[t],i[t+1]))return 0;s=Math.min(s,Zi(e[o],e[o+1],i[t],i[t+1],r))}return s}function Yi(e,t,i,n,r){if(!zi(t,e.length)||!zi(n,i.length))return NaN;let s=1/0;for(let o=t[0];o<=t[1];++o)for(let t=n[0];t<=n[1];++t)if(0===(s=Math.min(s,r.distance(e[o],i[t]))))return s;return s}function Ki(e,t,i){if(hi(e,t,!0))return 0;let n=1/0;for(const r of t){const t=r.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(r[0]!==r[t-1]&&0===(n=Math.min(n,i.pointToSegmentDistance(e,r[t-1],r[0]))))return n;if(0===(n=Math.min(n,qi(e,r,i))))return n}return n}function Ji(e,t,i,n){if(!zi(t,e.length))return NaN;for(let n=t[0];n<=t[1];++n)if(hi(e[n],i,!0))return 0;let r=1/0;for(let s=t[0];s<t[1];++s)for(const t of i)for(let i=0,o=t.length,a=o-1;i<o;a=i++){if(pi(e[s],e[s+1],t[a],t[i]))return 0;r=Math.min(r,Zi(e[s],e[s+1],t[a],t[i],n))}return r}function Qi(e,t){for(const i of e)for(let e=0;e<=i.length-1;++e)if(hi(i[e],t,!0))return!0;return!1}function en(e,t,i,n=1/0){const r=Ui(e),s=Ui(t);if(n!==1/0&&Vi(r,s,i)>=n)return n;if(ci(r,s)){if(Qi(e,t))return 0}else if(Qi(t,e))return 0;let o=n;for(const n of e)for(let e=0,r=n.length,s=r-1;e<r;s=e++)for(const r of t)for(let t=0,a=r.length,l=a-1;t<a;l=t++){if(pi(n[s],n[e],r[l],r[t]))return 0;o=Math.min(o,Zi(n[s],n[e],r[l],r[t],i))}return o}function tn(e,t,i,n,r,s,o){if(null===s||null===o)return;const a=Vi(Bi(n,s),Bi(r,o),i);a<t&&e.push({dist:a,range1:s,range2:o})}function nn(e,t,i,n,r=1/0){let s=Math.min(n.distance(e[0],i[0][0]),r);if(0===s)return s;const o=new Pi([{dist:0,range1:[0,e.length-1],range2:[0,0]}],Ri),a=t?Di:Li,l=Ui(i);for(;o.length;){const r=o.pop();if(r.dist>=s)continue;const c=r.range1;if(Ni(c)<=a){if(!zi(c,e.length))return NaN;if(t){const t=Ji(e,c,i,n);if(0===(s=Math.min(s,t)))return s}else for(let t=c[0];t<=c[1];++t){const r=Ki(e[t],i,n);if(0===(s=Math.min(s,r)))return s}}else{const i=Fi(c,t);if(null!==i[0]){const t=Vi(Bi(e,i[0]),l,n);t<s&&o.push({dist:t,range1:i[0],range2:[0,0]})}if(null!==i[1]){const t=Vi(Bi(e,i[1]),l,n);t<s&&o.push({dist:t,range1:i[1],range2:[0,0]})}}}return s}function rn(e,t,i,n,r,s=1/0){let o=Math.min(s,r.distance(e[0],i[0]));if(0===o)return o;const a=new Pi([{dist:0,range1:[0,e.length-1],range2:[0,i.length-1]}],Ri),l=t?Di:Li,c=n?Di:Li;for(;a.length;){const s=a.pop();if(s.dist>=o)continue;const u=s.range1,h=s.range2;if(Ni(u)<=l&&Ni(h)<=c){if(!zi(u,e.length)||!zi(h,i.length))return NaN;if(t&&n?o=Math.min(o,Xi(e,u,i,h,r)):t||n?t&&!n?o=Math.min(o,$i(i,h,e,u,r)):!t&&n&&(o=Math.min(o,$i(e,u,i,h,r))):o=Math.min(o,Yi(e,u,i,h,r)),0===o)return o}else{const s=Fi(u,t),l=Fi(h,n);tn(a,o,r,e,i,s[0],l[0]),tn(a,o,r,e,i,s[0],l[1]),tn(a,o,r,e,i,s[1],l[0]),tn(a,o,r,e,i,s[1],l[1])}}return o}function sn(e,t,i,n,r=1/0){let s=r;const o=Bi(e,[0,e.length-1]);for(const r of i)if(!(s!==1/0&&Vi(o,Bi(r,[0,r.length-1]),n)>=s)&&(s=Math.min(s,rn(e,t,r,!0,n,s)),0===s))return s;return s}function on(e,t,i,n,r=1/0){let s=r;const o=Bi(e,[0,e.length-1]);for(const r of i){if(s!==1/0&&Vi(o,Ui(r),n)>=s)continue;const i=nn(e,t,r,n,s);if(isNaN(i))return i;if(0===(s=Math.min(s,i)))return s}return s}function an(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class ln{constructor(e,t){this.type=yt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ft(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(an(t.features[e].geometry.type))return new ln(t,t.features[e].geometry)}else if("Feature"===t.type){if(an(t.geometry.type))return new ln(t,t.geometry)}else if(an(t.type))return new ln(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),i=e.canonicalID();if(null!=t&&null!=i){if("Point"===e.geometryType())return function(e,t,i){const n=[];for(const i of e)for(const e of i)n.push(Hi(e,t));const r=new Ai(n[0][1],"meters");return"Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type?rn(n,!1,"Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,r):"MultiLineString"===i.type?sn(n,!1,i.coordinates,r):"Polygon"===i.type||"MultiPolygon"===i.type?on(n,!1,"Polygon"===i.type?[i.coordinates]:i.coordinates,r):null}(t,i,this.geometries);if("LineString"===e.geometryType())return function(e,t,i){const n=[];for(const i of e){const e=[];for(const n of i)e.push(Hi(n,t));n.push(e)}const r=new Ai(n[0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return sn("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,n,r);if("MultiLineString"===i.type){let e=1/0;for(let t=0;t<i.coordinates.length;t++){const s=sn(i.coordinates[t],!0,n,r,e);if(isNaN(s))return s;if(0===(e=Math.min(e,s)))return e}return e}if("Polygon"===i.type||"MultiPolygon"===i.type){let e=1/0;for(let t=0;t<n.length;t++){const s=on(n[t],!0,"Polygon"===i.type?[i.coordinates]:i.coordinates,r,e);if(isNaN(s))return s;if(0===(e=Math.min(e,s)))return e}return e}return null}(t,i,this.geometries);if("Polygon"===e.geometryType())return function(e,t,i){const n=[];for(const i of function(e,t){const i=e.length;if(i<=1)return[e];const n=[];let r,s;for(let t=0;t<i;t++){const i=ai(e[t]);0!==i&&(e[t].area=Math.abs(i),void 0===s&&(s=i<0),s===i<0?(r&&n.push(r),r=[e[t]]):r.push(e[t]))}return r&&n.push(r),n}(e)){const e=[];for(let n=0;n<i.length;++n)e.push(Wi(i[n],t));n.push(e)}const r=new Ai(n[0][0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return on("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,n,r);if("MultiLineString"===i.type){let e=1/0;for(let t=0;t<i.coordinates.length;t++){const s=on(i.coordinates[t],!0,n,r,e);if(isNaN(s))return s;if(0===(e=Math.min(e,s)))return e}return e}return"Polygon"===i.type||"MultiPolygon"===i.type?function(e,t,i){let n=1/0;for(const r of e)for(const e of t){const t=en(r,e,i,n);if(isNaN(t))return t;if(0===(n=Math.min(n,t)))return n}return n}("Polygon"===i.type?[i.coordinates]:i.coordinates,n,r):null}(t,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var cn=ln;function un(e,t){switch(e){case"string":return Ut(t);case"number":return+t;case"boolean":return!!t;case"color":return lt.parse(t);case"formatted":return Ot.fromString(Ut(t));case"resolvedImage":return Nt.fromString(Ut(t))}return t}function hn(e,t,i,n){return void 0!==n&&(e=n*Math.round(e/n)),void 0!==t&&e<t&&(e=t),void 0!==i&&e>i&&(e=i),e}class dn{constructor(e,t,i){this.type=e,this.key=t,this.scope=i}static parse(e,t){let i=t.expectedType;if(null==i&&(i=St),e.length<2||e.length>3)return t.error("Invalid number of arguments for 'config' expression.");const n=t.parse(e[1],1);if(!(n instanceof jt))return t.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const r=t.parse(e[2],2);return r instanceof jt?new dn(i,Ut(n.value),Ut(r.value)):t.error("Scope of 'config' expression must be a string literal.")}return new dn(i,Ut(n.value))}evaluate(e){const t=[this.key,this.scope,e.scope].filter(Boolean).join(""),i=e.getConfig(t);if(!i)return null;const{type:n,value:r,values:s,minValue:o,maxValue:a,stepValue:l}=i,c=i.default.evaluate(e);let u=c;if(r){const t=e.scope;e.scope=(t||"").split("").slice(1).join(""),u=r.evaluate(e),e.scope=t}return n&&(u=un(n,u)),void 0===u||void 0===o&&void 0===a&&void 0===l||("number"==typeof u?u=hn(u,o,a,l):Array.isArray(u)&&(u=u.map((e=>"number"==typeof e?hn(e,o,a,l):e)))),void 0!==r&&void 0!==u&&s&&!s.includes(u)&&(u=c,n&&(u=un(n,u))),(n&&n!==this.type||void 0!==u&&Bt(u)!==this.type)&&(u=un(this.type.kind,u)),u}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}var pn=dn;function fn(e){if(e instanceof ni){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Mi)return!1;if(e instanceof cn)return!1;let t=!0;return e.eachChild((e=>{t&&!fn(e)&&(t=!1)})),t}function mn(e){if(e instanceof ni&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!mn(e)&&(t=!1)})),t}function gn(e){if(e instanceof pn)return!1;let t=!0;return e.eachChild((e=>{t&&!gn(e)&&(t=!1)})),t}function _n(e,t){if(e instanceof ni&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!_n(e,t)&&(i=!1)})),i}class yn{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new yn(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var vn=yn;class xn{constructor(e,t=[],i,n=new gt,r=[],s,o){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=r,this.expectedType=i,this._scope=s,this.options=o}parse(e,t,i,n,r={}){return t||i?this.concat(t,i,n)._parse(e,r):this._parse(e,r)}_parse(e,t){function i(e,t,i){return"assert"===i?new qt(t,[e]):"coerce"===i?new Jt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n="string"==typeof e[0]?this.registry[e[0]]:void 0;if(n){let r=n.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,n=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(e,n))return null}else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"assert")}if(!(r instanceof jt)&&"resolvedImage"!==r.type.kind&&wn(r)){const t=new ei(this._scope,this.options);try{r=new jt(r.type,r.evaluate(t))}catch(e){return this.error(e.message),null}}return r}return Jt.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const n="number"==typeof e?this.path.concat(e):this.path,r=i?this.scope.concat(i):this.scope;return new xn(this.registry,n,t||null,r,this.errors,this._scope,this.options)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new ft(i,e))}checkSubtype(e,t){const i=Pt(e,t);return i&&this.error(i),i}}var bn=xn;function wn(e){if(e instanceof vn)return wn(e.boundExpression);if(e instanceof ni&&"error"===e.name)return!1;if(e instanceof ri)return!1;if(e instanceof Mi)return!1;if(e instanceof cn)return!1;if(e instanceof pn)return!1;const t=e instanceof Jt||e instanceof qt;let i=!0;return e.eachChild((e=>{i=t?i&&wn(e):i&&e instanceof jt})),!!i&&fn(e)&&_n(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Sn(e,t){const i=e.length-1;let n,r,s=0,o=i,a=0;for(;s<=o;)if(a=Math.floor((s+o)/2),n=e[a],r=e[a+1],n<=t){if(a===i||t<r)return a;s=a+1}else{if(!(n>t))throw new Gt("Input is not a number.");o=a-1}return 0}class Tn{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,yt);if(!i)return null;const n=[];let r=null;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(let i=1;i<e.length;i+=2){const s=1===i?-1/0:e[i],o=e[i+1],a=i,l=i+1;if("number"!=typeof s)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=s)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(o,l,r);if(!c)return null;r=r||c.type,n.push([s,c])}return new Tn(r,i,n)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return i[0].evaluate(e);const r=t.length;return n>=t[r-1]?i[r-1].evaluate(e):i[Sn(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var En=Tn;const Mn=.95047,In=1.08883,An=4/29,Cn=6/29,Pn=3*Cn*Cn,kn=Cn*Cn*Cn,Rn=Math.PI/180,Ln=180/Math.PI;function Dn(e){return e>kn?Math.pow(e,1/3):e/Pn+An}function On(e){return e>Cn?e*e*e:Pn*(e-An)}function Nn(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function zn(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Fn(e){const t=zn(e.r),i=zn(e.g),n=zn(e.b),r=Dn((.4124564*t+.3575761*i+.1804375*n)/Mn),s=Dn((.2126729*t+.7151522*i+.072175*n)/1);return{l:116*s-16,a:500*(r-s),b:200*(s-Dn((.0193339*t+.119192*i+.9503041*n)/In)),alpha:e.a}}function Bn(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*On(t),i=Mn*On(i),n=In*On(n),new lt(Nn(3.2404542*i-1.5371385*t-.4985314*n),Nn(-.969266*i+1.8760108*t+.041556*n),Nn(.0556434*i-.2040259*t+1.0572252*n),e.alpha)}function Un(e,t,i){const n=t-e;return e+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const Vn={forward:Fn,reverse:Bn,interpolate:function(e,t,i){return{l:ct(e.l,t.l,i),a:ct(e.a,t.a,i),b:ct(e.b,t.b,i),alpha:ct(e.alpha,t.alpha,i)}}},jn={forward:function(e){const{l:t,a:i,b:n}=Fn(e),r=Math.atan2(n,i)*Ln;return{h:r<0?r+360:r,c:Math.sqrt(i*i+n*n),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Rn,i=e.c;return Bn({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:Un(e.h,t.h,i),c:ct(e.c,t.c,i),l:ct(e.l,t.l,i),alpha:ct(e.alpha,t.alpha,i)}}};var Gn=Object.freeze({__proto__:null,hcl:jn,lab:Vn});class Hn{constructor(e,t,i,n,r){this.type=e,this.operator=t,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,i,n){let r=0;if("exponential"===e.name)r=Wn(t,e.base,i,n);else if("linear"===e.name)r=Wn(t,1,i,n);else if("cubic-bezier"===e.name){const s=e.controlPoints;r=new f(s[0],s[1],s[2],s[3]).solve(Wn(t,1,i,n))}return r}static parse(e,t){let[i,n,r,...s]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const e=n.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,yt),!r)return null;const o=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=bt:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<s.length;e+=2){const i=s[e],n=s[e+1],r=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(o.length&&o[o.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=t.parse(n,l,a);if(!c)return null;a=a||c.type,o.push([i,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Hn(a,i,n,r,o):t.error(`Type ${At(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return i[0].evaluate(e);const r=t.length;if(n>=t[r-1])return i[r-1].evaluate(e);const s=Sn(t,n),o=Hn.interpolationFactor(this.interpolation,n,t[s],t[s+1]),a=i[s].evaluate(e),l=i[s+1].evaluate(e);return"interpolate"===this.operator?ht[this.type.kind.toLowerCase()](a,l,o):"interpolate-hcl"===this.operator?jn.reverse(jn.interpolate(jn.forward(a),jn.forward(l),o)):Vn.reverse(Vn.interpolate(Vn.forward(a),Vn.forward(l),o))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function Wn(e,t,i,n){const r=n-i,s=e-i;return 0===r?0:1===t?s/r:(Math.pow(t,s)-1)/(Math.pow(t,r)-1)}var qn=Hn;class $n{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const n=t.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const n of e.slice(1)){const e=t.parse(n,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,r.push(e)}const s=n&&r.some((e=>Pt(n,e.type)));return new $n(s?St:i,r)}evaluate(e){let t,i=null,n=0;for(const r of this.args){if(n++,i=r.evaluate(e),i&&i instanceof Nt&&!i.available&&(t||(t=i),i=null,n===this.args.length))return t;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Zn=$n;class Xn{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let n=1;n<e.length-1;n+=2){const r=e[n];if("string"!=typeof r)return t.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const s=t.parse(e[n+1],n+1);if(!s)return null;i.push([r,s])}const n=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return n?new Xn(i,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}var Yn=Xn;class Kn{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,yt),n=t.parse(e[2],2,It(t.expectedType||St));return i&&n?new Kn(n.type.itemType,i,n):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new Gt(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new Gt(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new Gt(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Jn=Kn;class Qn{constructor(e,t){this.type=xt,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,St),n=t.parse(e[2],2,St);return i&&n?kt(i.type,[xt,vt,yt,_t,St])?new Qn(i,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${At(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!Rt(t,["boolean","string","number","null"]))throw new Gt(`Expected first argument to be of type boolean, string, number or null, but found ${At(Bt(t))} instead.`);if(!Rt(i,["string","array"]))throw new Gt(`Expected second argument to be of type array or string, but found ${At(Bt(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var er=Qn;class tr{constructor(e,t,i){this.type=yt,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,St),n=t.parse(e[2],2,St);if(!i||!n)return null;if(!kt(i.type,[xt,vt,yt,_t,St]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${At(i.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,yt);return r?new tr(i,n,r):null}return new tr(i,n)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!Rt(t,["boolean","string","number","null"]))throw new Gt(`Expected first argument to be of type boolean, string, number or null, but found ${At(Bt(t))} instead.`);if(!Rt(i,["string","array"]))throw new Gt(`Expected second argument to be of type array or string, but found ${At(Bt(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(e);return i.indexOf(t,n)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ir=tr;class nr{constructor(e,t,i,n,r,s){this.inputType=e,this.type=t,this.input=i,this.cases=n,this.outputs=r,this.otherwise=s}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const r={},s=[];for(let o=2;o<e.length-1;o+=2){let a=e[o];const l=e[o+1];Array.isArray(a)||(a=[a]);const c=t.concat(o);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,Bt(e)))return null}else i=Bt(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=s.length}const u=t.parse(l,o,n);if(!u)return null;n=n||u.type,s.push(u)}const o=t.parse(e[1],1,St);if(!o)return null;const a=t.parse(e[e.length-1],e.length-1,n);return a?"value"!==o.type.kind&&t.concat(1).checkSubtype(i,o.type)?null:new nr(i,n,o,r,s,a):null}evaluate(e){const t=this.input.evaluate(e);return(Bt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],n={};for(const e of t){const t=n[this.cases[e]];void 0===t?(n[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[t][1].push(e)}const r=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,n]of i)e.push(1===n.length?r(n[0]):n.map(r)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}var rr=nr;class sr{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const n=[];for(let r=1;r<e.length-1;r+=2){const s=t.parse(e[r],r,xt);if(!s)return null;const o=t.parse(e[r+1],r+1,i);if(!o)return null;n.push([s,o]),i=i||o.type}const r=t.parse(e[e.length-1],e.length-1,i);return r?new sr(i,n,r):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var or=sr;class ar{constructor(e,t,i,n){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,St),n=t.parse(e[2],2,yt);if(!i||!n)return null;if(!kt(i.type,[It(St),vt,St]))return t.error(`Expected first argument to be of type array or string, but found ${At(i.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,yt);return r?new ar(i.type,i,n,r):null}return new ar(i.type,i,n)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!Rt(t,["string","array"]))throw new Gt(`Expected first argument to be of type array or string, but found ${At(Bt(t))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(e);return t.slice(i,n)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var lr=ar;function cr(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function ur(e,t,i,n){return 0===n.compare(t,i)}function hr(e,t,i){const n="=="!==e&&"!="!==e;return class r{constructor(e,t,i){this.type=xt,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let s=t.parse(e[1],1,St);if(!s)return null;if(!cr(i,s.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${At(s.type)}'.`);let o=t.parse(e[2],2,St);if(!o)return null;if(!cr(i,o.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${At(o.type)}'.`);if(s.type.kind!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return t.error(`Cannot compare types '${At(s.type)}' and '${At(o.type)}'.`);n&&("value"===s.type.kind&&"value"!==o.type.kind?s=new qt(o.type,[s]):"value"!==s.type.kind&&"value"===o.type.kind&&(o=new qt(s.type,[o])));let a=null;if(4===e.length){if("string"!==s.type.kind&&"string"!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,Tt),!a)return null}return new r(s,o,a)}evaluate(r){const s=this.lhs.evaluate(r),o=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const t=Bt(s),i=Bt(o);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new Gt(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const e=Bt(s),i=Bt(o);if("string"!==e.kind||"string"!==i.kind)return t(r,s,o)}return this.collator?i(r,s,o,this.collator.evaluate(r)):t(r,s,o)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const dr=hr("==",(function(e,t,i){return t===i}),ur),pr=hr("!=",(function(e,t,i){return t!==i}),(function(e,t,i,n){return!ur(0,t,i,n)})),fr=hr("<",(function(e,t,i){return t<i}),(function(e,t,i,n){return n.compare(t,i)<0})),mr=hr(">",(function(e,t,i){return t>i}),(function(e,t,i,n){return n.compare(t,i)>0})),gr=hr("<=",(function(e,t,i){return t<=i}),(function(e,t,i,n){return n.compare(t,i)<=0})),_r=hr(">=",(function(e,t,i){return t>=i}),(function(e,t,i,n){return n.compare(t,i)>=0}));class yr{constructor(e,t,i,n,r,s){this.type=vt,this.number=e,this.locale=t,this.currency=i,this.unit=n,this.minFractionDigits=r,this.maxFractionDigits=s}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,yt);if(!i)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=t.parse(n.locale,1,vt),!r))return null;let s=null;if(n.currency&&(s=t.parse(n.currency,1,vt),!s))return null;let o=null;if(n.unit&&(o=t.parse(n.unit,1,vt),!o))return null;let a=null;if(n["min-fraction-digits"]&&(a=t.parse(n["min-fraction-digits"],1,yt),!a))return null;let l=null;return n["max-fraction-digits"]&&(l=t.parse(n["max-fraction-digits"],1,yt),!l)?null:new yr(i,r,s,o,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class vr{constructor(e){this.type=yt,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${At(i.type)} instead.`):new vr(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Gt(`Expected value to be of type string or array, but found ${At(Bt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}function xr(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const br={"==":dr,"!=":pr,">":mr,"<":fr,">=":_r,"<=":gr,array:qt,at:Jn,boolean:qt,case:or,coalesce:Zn,collator:ri,format:$t,image:Zt,in:er,"index-of":ir,interpolate:qn,"interpolate-hcl":qn,"interpolate-lab":qn,length:vr,let:Yn,literal:jt,match:rr,number:qt,"number-format":yr,object:qt,slice:lr,step:En,string:qt,"to-boolean":Jt,"to-color":Jt,"to-number":Jt,"to-string":Jt,var:vn,within:Mi,distance:cn,config:pn};function wr(e,[t,i,n,r]){t=t.evaluate(e),i=i.evaluate(e),n=n.evaluate(e);const s=r?r.evaluate(e):1,o=zt(t,i,n,s);if(o)throw new Gt(o);return new lt(t/255*s,i/255*s,n/255*s,s)}function Sr(e,[t,i,n,r]){t=t.evaluate(e),i=i.evaluate(e),n=n.evaluate(e);const s=r?r.evaluate(e):1,o=function(e,t,i,n){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof i&&i>=0&&i<=100?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid hsla value [${[e,t,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof n?[e,t,i,n]:[e,t,i]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof n?[e,t,i,n]:[e,t,i]).join(", ")}]: 'h' must be between 0 and 360.`}(t,i,n,s);if(o)throw new Gt(o);const a=`hsla(${t}, ${i}%, ${n}%, ${s})`,l=lt.parse(a);if(!l)throw new Gt(`Failed to parse HSLA color: ${a}`);return l}function Tr(e,t){return e in t}function Er(e,t){const i=t[e];return void 0===i?null:i}function Mr(e){return{type:e}}ni.register(br,{error:[{kind:"error"},[vt],(e,[t])=>{throw new Gt(t.evaluate(e))}],typeof:[vt,[St],(e,[t])=>At(Bt(t.evaluate(e)))],"to-rgba":[It(yt,4),[bt],(e,[t])=>t.evaluate(e).toArray()],rgb:[bt,[yt,yt,yt],wr],rgba:[bt,[yt,yt,yt,yt],wr],hsl:[bt,[yt,yt,yt],Sr],hsla:[bt,[yt,yt,yt,yt],Sr],has:{type:xt,overloads:[[[vt],(e,[t])=>Tr(t.evaluate(e),e.properties())],[[vt,wt],(e,[t,i])=>Tr(t.evaluate(e),i.evaluate(e))]]},get:{type:St,overloads:[[[vt],(e,[t])=>Er(t.evaluate(e),e.properties())],[[vt,wt],(e,[t,i])=>Er(t.evaluate(e),i.evaluate(e))]]},"feature-state":[St,[vt],(e,[t])=>Er(t.evaluate(e),e.featureState||{})],properties:[wt,[],e=>e.properties()],"geometry-type":[vt,[],e=>e.geometryType()],id:[St,[],e=>e.id()],zoom:[yt,[],e=>e.globals.zoom],pitch:[yt,[],e=>e.globals.pitch||0],"distance-from-center":[yt,[],e=>e.distanceFromCenter()],"measure-light":[yt,[vt],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[yt,[],e=>e.globals.heatmapDensity||0],"line-progress":[yt,[],e=>e.globals.lineProgress||0],"raster-value":[yt,[],e=>e.globals.rasterValue||0],"raster-particle-speed":[yt,[],e=>e.globals.rasterParticleSpeed||0],"sky-radial-progress":[yt,[],e=>e.globals.skyRadialProgress||0],accumulated:[St,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[yt,Mr(yt),(e,t)=>{let i=0;for(const n of t)i+=n.evaluate(e);return i}],"*":[yt,Mr(yt),(e,t)=>{let i=1;for(const n of t)i*=n.evaluate(e);return i}],"-":{type:yt,overloads:[[[yt,yt],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[yt],(e,[t])=>-t.evaluate(e)]]},"/":[yt,[yt,yt],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[yt,[yt,yt],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[yt,[],()=>Math.LN2],pi:[yt,[],()=>Math.PI],e:[yt,[],()=>Math.E],"^":[yt,[yt,yt],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[yt,[yt],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[yt,[yt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[yt,[yt],(e,[t])=>Math.log(t.evaluate(e))],log2:[yt,[yt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[yt,[yt],(e,[t])=>Math.sin(t.evaluate(e))],cos:[yt,[yt],(e,[t])=>Math.cos(t.evaluate(e))],tan:[yt,[yt],(e,[t])=>Math.tan(t.evaluate(e))],asin:[yt,[yt],(e,[t])=>Math.asin(t.evaluate(e))],acos:[yt,[yt],(e,[t])=>Math.acos(t.evaluate(e))],atan:[yt,[yt],(e,[t])=>Math.atan(t.evaluate(e))],min:[yt,Mr(yt),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[yt,Mr(yt),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[yt,[yt],(e,[t])=>Math.abs(t.evaluate(e))],round:[yt,[yt],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[yt,[yt],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[yt,[yt],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[xt,[vt,St],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[xt,[St],(e,[t])=>e.id()===t.value],"filter-type-==":[xt,[vt],(e,[t])=>e.geometryType()===t.value],"filter-<":[xt,[vt,St],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[xt,[St],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i<n}],"filter->":[xt,[vt,St],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[xt,[St],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i>n}],"filter-<=":[xt,[vt,St],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[xt,[St],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i<=n}],"filter->=":[xt,[vt,St],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[xt,[St],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i>=n}],"filter-has":[xt,[St],(e,[t])=>t.value in e.properties()],"filter-has-id":[xt,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[xt,[It(vt)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[xt,[It(St)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[xt,[vt,It(St)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[xt,[vt,It(St)],(e,[t,i])=>function(e,t,i,n){for(;i<=n;){const r=i+n>>1;if(t[r]===e)return!0;t[r]>e?n=r-1:i=r+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:xt,overloads:[[[xt,xt],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[Mr(xt),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:xt,overloads:[[[xt,xt],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[Mr(xt),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[xt,[xt],(e,[t])=>!t.evaluate(e)],"is-supported-script":[xt,[vt],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[vt,[vt],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[vt,[vt],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[vt,Mr(St),(e,t)=>t.map((t=>Ut(t.evaluate(e)))).join("")],"resolved-locale":[vt,[Tt],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[yt,[yt,yt,St],(e,t)=>{const[i,n,r]=t.map((t=>t.evaluate(e)));if(i>n)return i;if(i===n)return i;let s;if("string"==typeof r)s=function(e){let t=0;if(0===e.length)return t;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}(r);else{if("number"!=typeof r)throw new Gt(`Invalid seed input: ${r}`);s=r}return i+xr(s)()*(n-i)}]});var Ir=br;function Ar(e){return{result:"success",value:e}}function Cr(e){return{result:"error",value:e}}function Pr(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function kr(e){return"data-driven"===e["property-type"]}function Rr(e){return Pr(e.expression,"measure-light")}function Lr(e){return Pr(e.expression,"zoom")}function Dr(e){return!!e.expression&&e.expression.interpolated}function Or(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Nr(e){return e}function zr(e,t){const i="color"===t.type,n=e.stops&&"object"==typeof e.stops[0][0],r=n||!(n||void 0!==e.property),s=e.type||(Dr(t)?"exponential":"interval");if(i&&((e=dt({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],lt.parse(e[1])]))),e.default=lt.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Gn[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let o,a,l;if("exponential"===s)o=Vr;else if("interval"===s)o=Ur;else if("categorical"===s){o=Br,a=Object.create(null);for(const t of e.stops)a[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==s)throw new Error(`Unknown function type "${s}"`);o=jr}if(n){const i={},n=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],s=r[0].zoom;void 0===i[s]&&(i[s]={zoom:s,type:e.type,property:e.property,default:e.default,stops:[]},n.push(s)),i[s].stops.push([r[0].value,r[1]])}const r=[];for(const e of n)r.push([i[e].zoom,zr(i[e],t)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:qn.interpolationFactor.bind(void 0,s),zoomStops:r.map((e=>e[0])),evaluate:({zoom:i},n)=>Vr({stops:r,base:e.base},t,i).evaluate(i,n)}}if(r){const i="exponential"===s?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:qn.interpolationFactor.bind(void 0,i),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:i})=>o(e,t,i,a,l)}}return{kind:"source",evaluate(i,n){const r=n&&n.properties?n.properties[e.property]:void 0;return void 0===r?Fr(e.default,t.default):o(e,t,r,a,l)}}}function Fr(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function Br(e,t,i,n,r){return Fr(typeof i===r?n[i]:void 0,e.default,t.default)}function Ur(e,t,i){if("number"!==Xt(i))return Fr(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const r=Sn(e.stops.map((e=>e[0])),i);return e.stops[r][1]}function Vr(e,t,i){const n=void 0!==e.base?e.base:1;if("number"!==Xt(i))return Fr(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const s=Sn(e.stops.map((e=>e[0])),i),o=function(e,t,i,n){const r=n-i,s=e-i;return 0===r?0:1===t?s/r:(Math.pow(t,s)-1)/(Math.pow(t,r)-1)}(i,n,e.stops[s][0],e.stops[s+1][0]),a=e.stops[s][1],l=e.stops[s+1][1];let c=ht[t.type]||Nr;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Gn[e.colorSpace];c=(e,i)=>t.reverse(t.interpolate(t.forward(e),t.forward(i),o))}return"function"==typeof a.evaluate?{evaluate(...e){const t=a.evaluate.apply(void 0,e),i=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==i)return c(t,i,o)}}:c(a,l,o)}function jr(e,t,i){return"color"===t.type?i=lt.parse(i):"formatted"===t.type?i=Ot.fromString(i.toString()):"resolvedImage"===t.type?i=Nt.fromString(i.toString()):Xt(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),Fr(i,e.default,t.default)}class Gr{constructor(e,t,i,n){this.expression=e,this._warningHistory={},this._evaluator=new ei(i,n),this._defaultValue=t?function(e){return"color"===e.type&&(Or(e.default)||Array.isArray(e.default))?new lt(0,0,0,0):"color"===e.type?lt.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,n,r,s,o,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=s,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,n,r,s,o,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=s||null,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Gt(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Hr(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Ir}function Wr(e,t,i,n){const r=new bn(Ir,[],t?function(e){const t={color:bt,string:vt,number:yt,enum:vt,boolean:xt,formatted:Et,resolvedImage:Mt};return"array"===e.type?It(t[e.value]||St,e.length):t[e.type]}(t):void 0,void 0,void 0,i,n),s=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return s?Ar(new Gr(s,t,i,n)):Cr(r.errors)}class qr{constructor(e,t,i){this.kind=e,this._styleExpression=t,this.isLightConstant=i,this.isStateDependent="constant"!==e&&!mn(t.expression),this.isConfigDependent=!gn(t.expression)}evaluateWithoutErrorHandling(e,t,i,n,r,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,n,r,s)}evaluate(e,t,i,n,r,s){return this._styleExpression.evaluate(e,t,i,n,r,s)}}class $r{constructor(e,t,i,n,r){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!mn(t.expression),this.isLightConstant=r,this.isConfigDependent=!gn(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,i,n,r,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,n,r,s)}evaluate(e,t,i,n,r,s){return this._styleExpression.evaluate(e,t,i,n,r,s)}interpolationFactor(e,t,i){return this.interpolationType?qn.interpolationFactor(this.interpolationType,e,t,i):0}}function Zr(e,t,i,n){if("error"===(e=Wr(e,t,i,n)).result)return e;const r=e.value.expression,s=fn(r);if(!s&&!kr(t))return Cr([new ft("","data expressions not supported")]);const o=_n(r,["zoom","pitch","distance-from-center"]);if(!o&&!Lr(t))return Cr([new ft("","zoom expressions not supported")]);const a=_n(r,["measure-light"]);if(!a&&!Rr(t))return Cr([new ft("","measure-light expression not supported")]);const l=t.expression&&t.expression.relaxZoomRestriction,c=Yr(r);return c||o||l?c instanceof ft?Cr([c]):c instanceof qn&&!Dr(t)?Cr([new ft("",'"interpolate" expressions cannot be used with this property')]):Ar(c?new $r(s?"camera":"composite",e.value,c.labels,c instanceof qn?c.interpolation:void 0,a):new qr(s?"constant":"source",e.value,a)):Cr([new ft("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Xr{constructor(e,t){this._parameters=e,this._specification=t,dt(this,zr(this._parameters,this._specification))}static deserialize(e){return new Xr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Yr(e){let t=null;if(e instanceof Yn)t=Yr(e.result);else if(e instanceof Zn){for(const i of e.args)if(t=Yr(i),t)break}else(e instanceof En||e instanceof qn)&&e.input instanceof ni&&"zoom"===e.input.name&&(t=e);return t instanceof ft||e.eachChild((e=>{const i=Yr(e);i instanceof ft?t=i:t&&i&&t!==i&&(t=new ft("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}var Kr=Qr,Jr=3;function Qr(e,t,i){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(i=r[2]);for(var s=0;s<this.d*this.d;s++){var o=r[Jr+s],a=r[Jr+s+1];n.push(o===a?null:r.subarray(o,a))}var l=r[Jr+n.length+1];this.keys=r.subarray(r[Jr+n.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var c=0;c<this.d*this.d;c++)n.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var u=i/t*e;this.min=-u,this.max=e+u}Qr.prototype.insert=function(e,t,i,n,r){this._forEachCell(t,i,n,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},Qr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Qr.prototype._insertCell=function(e,t,i,n,r,s){this.cells[r].push(s)},Qr.prototype.query=function(e,t,i,n,r){var s=this.min,o=this.max;if(e<=s&&t<=s&&o<=i&&o<=n&&!r)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,i,n,this._queryCell,a,{},r),a},Qr.prototype._queryCell=function(e,t,i,n,r,s,o,a){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===o[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&i>=u[p+0]&&n>=u[p+1])?(o[d]=!0,s.push(c[d])):o[d]=!1}}},Qr.prototype._forEachCell=function(e,t,i,n,r,s,o,a){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(i),h=this._convertToCellCoord(n),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&r.call(this,e,t,i,n,f,s,o,a))return}},Qr.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Qr.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Qr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=Jr+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var r=new Int32Array(t+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var s=t,o=0;o<e.length;o++){var a=e[o];r[Jr+o]=s,r.set(a,s),s+=a.length}return r[Jr+e.length]=s,r.set(this.keys,s),r[Jr+e.length+1]=s+=this.keys.length,r.set(this.bboxes,s),s+=this.bboxes.length,r.buffer};var es=h(Kr);const ts={};function is(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),ts[t]={klass:e,omit:i.omit||[]}}is(Object,"Object"),es.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.add(i),{buffer:i}},es.deserialize=function(e){return new es(e.buffer)},Object.defineProperty(es,"name",{value:"Grid"}),is(es,"Grid"),is(lt,"Color"),is(Error,"Error"),is(Ot,"Formatted"),is(Dt,"FormattedSection"),is(Ee,"AJAXError"),is(Nt,"ResolvedImage"),is(Xr,"StylePropertyFunction"),is(Gr,"StyleExpression",{omit:["_evaluator"]}),is($r,"ZoomDependentExpression"),is(qr,"ZoomConstantExpression"),is(ni,"CompoundExpression",{omit:["_evaluate"]});for(const e in Ir)ts[Ir[e]._classRegistryKey]||is(Ir[e],`Expression${e}`);function ns(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function rs(e){return self.ImageBitmap&&e instanceof ImageBitmap}function ss(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(ns(e)||rs(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){const i=e;return t&&t.add(i.buffer),i}if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const i=[];for(const n of e)i.push(ss(n,t));return i}if(e instanceof Map){const t={$name:"Map"};for(const[i,n]of e.entries())t[i]=ss(n);return t}if("object"==typeof e){const i=e.constructor,n=i._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const r=i.serialize?i.serialize(e,t):{};if(!i.serialize){for(const i in e)e.hasOwnProperty(i)&&(ts[n].omit.indexOf(i)>=0||(r[i]=ss(e[i],t)));e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(r.$name=n),r}throw new Error("can't serialize object of type "+typeof e)}function os(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||ns(e)||rs(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(os);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=new Map;for(const i of Object.keys(e))"$name"!==i&&t.set(i,os(e[i]));return t}const{klass:i}=ts[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);const n=Object.create(i.prototype);for(const t of Object.keys(e))"$name"!==t&&(n[t]=os(e[t]));return n}throw new Error("can't deserialize object of type "+typeof e)}const as={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function ls(e){for(const t of e)if(hs(t.charCodeAt(0)))return!0;return!1}function cs(e){for(const t of e)if(!us(t.charCodeAt(0)))return!1;return!0}function us(e){return!(as.Arabic(e)||as["Arabic Supplement"](e)||as["Arabic Extended-A"](e)||as["Arabic Presentation Forms-A"](e)||as["Arabic Presentation Forms-B"](e))}function hs(e){return!(746!==e&&747!==e&&(e<4352||!(as["Bopomofo Extended"](e)||as.Bopomofo(e)||as["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||as["CJK Compatibility Ideographs"](e)||as["CJK Compatibility"](e)||as["CJK Radicals Supplement"](e)||as["CJK Strokes"](e)||!(!as["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||as["CJK Unified Ideographs Extension A"](e)||as["CJK Unified Ideographs"](e)||as["Enclosed CJK Letters and Months"](e)||as["Hangul Compatibility Jamo"](e)||as["Hangul Jamo Extended-A"](e)||as["Hangul Jamo Extended-B"](e)||as["Hangul Jamo"](e)||as["Hangul Syllables"](e)||as.Hiragana(e)||as["Ideographic Description Characters"](e)||as.Kanbun(e)||as["Kangxi Radicals"](e)||as["Katakana Phonetic Extensions"](e)||as.Katakana(e)&&12540!==e||!(!as["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!as["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||as["Unified Canadian Aboriginal Syllabics"](e)||as["Unified Canadian Aboriginal Syllabics Extended"](e)||as["Vertical Forms"](e)||as["Yijing Hexagram Symbols"](e)||as["Yi Syllables"](e)||as["Yi Radicals"](e))))}function ds(e){return!(hs(e)||function(e){return!!(as["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||as["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||as["Letterlike Symbols"](e)||as["Number Forms"](e)||as["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||as["Control Pictures"](e)&&9251!==e||as["Optical Character Recognition"](e)||as["Enclosed Alphanumerics"](e)||as["Geometric Shapes"](e)||as["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||as["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||as["CJK Symbols and Punctuation"](e)||as.Katakana(e)||as["Private Use Area"](e)||as["CJK Compatibility Forms"](e)||as["Small Form Variants"](e)||as["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function ps(e){return e>=1424&&e<=2303||as["Arabic Presentation Forms-A"](e)||as["Arabic Presentation Forms-B"](e)}function fs(e,t){return!(!t&&ps(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||as.Khmer(e))}function ms(e){for(const t of e)if(ps(t.charCodeAt(0)))return!0;return!1}const gs="deferred",_s="loading",ys="loaded";let vs=null,xs="unavailable",bs=null;const ws=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(xs="error"),vs&&vs(e)};function Ss(){Ts.fire(new Qe("pluginStateChange",{pluginStatus:xs,pluginURL:bs}))}const Ts=new tt,Es=function(){return xs},Ms=function(){if(xs!==gs||!bs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");xs=_s,Ss(),bs&&Ae({url:bs},(e=>{e?ws(e):(xs=ys,Ss())}))},Is={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>xs===ys||null!=Is.applyArabicShaping,isLoading:()=>xs===_s,setState(e){xs=e.pluginStatus,bs=e.pluginURL},isParsed:()=>null!=Is.applyArabicShaping&&null!=Is.processBidirectionalText&&null!=Is.processStyledBidirectionalText,getPluginURL:()=>bs};class As{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const i of e)if(!fs(i.charCodeAt(0),t))return!1;return!0}(e,Is.isLoaded())}}class Cs{constructor(e,t,i,n){this.property=e,this.value=t,this.expression=function(e,t,i,n){if(Or(e))return new Xr(e,t);if(Hr(e)||Array.isArray(e)&&e.length>0){const r=Zr(e,t,i,n);if("error"===r.result)throw new Error(r.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return r.value}{let i=e;return"string"==typeof e&&"color"===t.type&&(i=lt.parse(e)),{kind:"constant",isConfigDependent:!1,evaluate:()=>i}}}(void 0===t?e.specification.default:t,e.specification,i,n)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)}}class Ps{constructor(e,t,i){this.property=e,this.value=new Cs(e,void 0,t,i)}transitioned(e,t){return new Rs(this.property,this.value,t,P({},e.transition,this.transition),e.now)}untransitioned(){return new Rs(this.property,this.value,null,{},0)}}class ks{constructor(e,t,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=t,this._options=i,this.isConfigDependent=!1}getValue(e){return U(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Ps(this._values[e].property,this._scope,this._options)),this._values[e].value=new Cs(this._values[e].property,null===t?void 0:U(t),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,t){t&&(this._options=t);const i=this._properties.properties;if(e)for(const t in e){const n=e[t];if(z(t,"-transition")){const e=t.slice(0,-11);i[e]&&this.setTransition(e,n)}else i[t]&&this.setValue(t,n)}}getTransition(e){return U(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Ps(this._values[e].property)),this._values[e].transition=U(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);const n=this.getTransition(t);void 0!==n&&(e[`${t}-transition`]=n)}return e}transitioned(e,t){const i=new Ls(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].transitioned(e,t._values[n]);return i}untransitioned(){const e=new Ls(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Rs{constructor(e,t,i,n,r){const s=n.delay||0,o=n.duration||0;r=r||0,this.property=e,this.value=t,this.begin=r+s,this.end=this.begin+o,e.specification.transition&&(n.delay||n.duration)&&(this.prior=i)}possiblyEvaluate(e,t,i){const n=e.now||0,r=this.value.possiblyEvaluate(e,t,i),s=this.prior;if(s){if(n>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(n<this.begin)return s.possiblyEvaluate(e,t,i);{const o=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(s.possiblyEvaluate(e,t,i),r,S(o))}}return r}}class Ls{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,i){const n=new Ns(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(e,t,i);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ds{constructor(e,t,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=t,this._options=i,this.isConfigDependent=!1}getValue(e){return U(this._values[e].value)}setValue(e,t){this._values[e]=new Cs(this._values[e].property,null===t?void 0:U(t),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i)}return e}possiblyEvaluate(e,t,i){const n=new Ns(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(e,t,i);return n}}class Os{constructor(e,t,i){this.property=e,this.value=t,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,i,n){return this.property.evaluate(this.value,this.parameters,e,t,i,n)}}class Ns{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class zs{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,i){const n=ht[this.specification.type];return n?n(e,t,i):e}}class Fs{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,i,n){return new Os(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,n)}:e.expression,t)}interpolate(e,t,i){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Os(this,{kind:"constant",value:void 0},e.parameters);const n=ht[this.specification.type];return n?new Os(this,{kind:"constant",value:n(e.value.value,t.value.value,i)},e.parameters):e}evaluate(e,t,i,n,r,s){return"constant"===e.kind?e.value:e.evaluate(t,i,n,r,s)}}class Bs{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,n){return!!e.expression.evaluate(t,null,{},i,n)}interpolate(){return!1}}class Us{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new As(0,{});for(const i in e){const n=e[i];n.specification.overridable&&this.overridableProperties.push(i);const r=this.defaultPropertyValues[i]=new Cs(n,void 0),s=this.defaultTransitionablePropertyValues[i]=new Ps(n);this.defaultTransitioningPropertyValues[i]=s.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=r.possiblyEvaluate(t)}}}function Vs(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function js(e){if(Array.isArray(e))return e.map(js);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=js(e[i]);return t}return Vs(e)}is(Fs,"DataDrivenProperty"),is(zs,"DataConstantProperty"),is(Bs,"ColorRampProperty");var Gs=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Hs(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Hs(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Ws(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Hs(e)||(e=Js(e));const i=e;let n=!0;try{n=function(e){if(!Zs(e))return e;let t=js(e);return $s(t),t=qs(t),t}(i)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const r=Gs[`filter_${t}`],s=Wr(n,r);let o=null;if("error"===s.result)throw new Error(s.value.map((e=>`${e.key}: ${e.message}`)).join(", "));o=(e,t,i)=>s.value.evaluate(e,t,{},i);let a=null,l=null;if(n!==i){const e=Wr(i,r);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(t,i,n,r,s)=>e.value.evaluate(t,i,{},n,void 0,void 0,r,s),l=!fn(e.value.expression)}return{filter:o,dynamicFilter:a||void 0,needGeometry:Ks(n),needFeature:!!l}}function qs(e){if(!Array.isArray(e))return e;const t=function(e){if(Xs.has(e[0]))for(let t=1;t<e.length;t++)if(Zs(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>qs(e)))}function $s(e){let t=!1;const i=[];if("case"===e[0]){for(let n=1;n<e.length-1;n+=2)t=t||Zs(e[n]),i.push(e[n+1]);i.push(e[e.length-1])}else if("match"===e[0]){t=t||Zs(e[1]);for(let t=2;t<e.length-1;t+=2)i.push(e[t+1]);i.push(e[e.length-1])}else if("step"===e[0]){t=t||Zs(e[1]);for(let t=1;t<e.length-1;t+=2)i.push(e[t+1])}t&&(e.length=0,e.push("any",...i));for(let t=1;t<e.length;t++)$s(e[t])}function Zs(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let t=1;t<e.length;t++)if(Zs(e[t]))return!0;return!1}const Xs=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ys(e,t){return e<t?-1:e>t?1:0}function Ks(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(Ks(e[t]))return!0;return!1}function Js(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Qs(e[1],e[2],"=="):"!="===t?io(Qs(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Qs(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(Js))):"all"===t?["all"].concat(e.slice(1).map(Js)):"none"===t?["all"].concat(e.slice(1).map(Js).map(io)):"in"===t?eo(e[1],e.slice(2)):"!in"===t?io(eo(e[1],e.slice(2))):"has"===t?to(e[1]):"!has"!==t||io(to(e[1]));var i}function Qs(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function eo(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(Ys)]]:["filter-in-small",e,["literal",t]]}}function to(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function io(e){return["!",e]}const no="";function ro(e,t){return t?`${e}${no}${t}`:e}const so="-transition";class oo extends tt{constructor(e,t,i,n){if(super(),this.id=e.id,this.fqid=ro(this.id,i),this.type=e.type,this.scope=i,this.options=n,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new Ds(t.layout,this.scope,n),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),t.paint)){this._transitionablePaint=new ks(t.paint,this.scope,n);for(const t in e.paint)this.setPaintProperty(t,e.paint[t]);for(const t in e.layout)this.setLayoutProperty(t,e.layout[t]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ns(t.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const i=this._unevaluatedLayout;i._properties.properties[e]&&(i.setValue(e,t),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return z(e,so)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t){const i=this._transitionablePaint,n=i._properties.properties;if(z(e,so)){const r=e.slice(0,-11);return n[r]&&i.setTransition(r,t||void 0),!1}if(!n[e])return!1;const r=i._values[e],s=r.value.isDataDriven(),o=r.value;i.setValue(e,t),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const a=i._values[e].value,l=a.isDataDriven(),c=z(e,"pattern")||"line-dasharray"===e;return l||s||c||this._handleOverridablePaintPropertyUpdate(e,o,a)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t){return null}_handleOverridablePaintPropertyUpdate(e,t,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return B({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Os&&kr(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ws(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}const ao={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class lo{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class co{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function uo(e,t=1){let i=0,n=0;return{members:e.map((e=>{const r=ao[e.type].BYTES_PER_ELEMENT,s=i=ho(i,Math.max(t,r)),o=e.components||1;return n=Math.max(n,r),i+=r*o,{name:e.name,type:e.type,components:o,offset:s}})),size:ho(i,Math.max(n,t)),alignment:t}}function ho(e,t){return Math.ceil(e/t)*t}class po extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const n=2*e;return this.int16[n+0]=t,this.int16[n+1]=i,e}}po.prototype.bytesPerElement=4,is(po,"StructArrayLayout2i4");class fo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i)}emplace(e,t,i,n){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=i,this.int16[r+2]=n,e}}fo.prototype.bytesPerElement=6,is(fo,"StructArrayLayout3i6");class mo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const s=4*e;return this.int16[s+0]=t,this.int16[s+1]=i,this.int16[s+2]=n,this.int16[s+3]=r,e}}mo.prototype.bytesPerElement=8,is(mo,"StructArrayLayout4i8");class go extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,n,r)}emplace(e,t,i,n,r,s){const o=5*e;return this.int16[o+0]=t,this.int16[o+1]=i,this.int16[o+2]=n,this.int16[o+3]=r,this.int16[o+4]=s,e}}go.prototype.bytesPerElement=10,is(go,"StructArrayLayout5i10");class _o extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,n,r,s,o)}emplace(e,t,i,n,r,s,o,a){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.uint8[c+4]=n,this.uint8[c+5]=r,this.uint8[c+6]=s,this.uint8[c+7]=o,this.float32[u+2]=a,e}}_o.prototype.bytesPerElement=12,is(_o,"StructArrayLayout2i4ub1f12");class yo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const s=4*e;return this.float32[s+0]=t,this.float32[s+1]=i,this.float32[s+2]=n,this.float32[s+3]=r,e}}yo.prototype.bytesPerElement=16,is(yo,"StructArrayLayout4f16");class vo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,n,r)}emplace(e,t,i,n,r,s){const o=6*e,a=3*e;return this.uint16[o+0]=t,this.uint16[o+1]=i,this.uint16[o+2]=n,this.uint16[o+3]=r,this.float32[a+2]=s,e}}vo.prototype.bytesPerElement=12,is(vo,"StructArrayLayout4ui1f12");class xo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const s=4*e;return this.uint16[s+0]=t,this.uint16[s+1]=i,this.uint16[s+2]=n,this.uint16[s+3]=r,e}}xo.prototype.bytesPerElement=8,is(xo,"StructArrayLayout4ui8");class bo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,n,r,s)}emplace(e,t,i,n,r,s,o){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=n,this.int16[a+3]=r,this.int16[a+4]=s,this.int16[a+5]=o,e}}bo.prototype.bytesPerElement=12,is(bo,"StructArrayLayout6i12");class wo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,s,o,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,i,n,r,s,o,a,l,c,u,h)}emplace(e,t,i,n,r,s,o,a,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=i,this.int16[p+2]=n,this.int16[p+3]=r,this.uint16[p+4]=s,this.uint16[p+5]=o,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}wo.prototype.bytesPerElement=24,is(wo,"StructArrayLayout4i4ui4i24");class So extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,n,r,s)}emplace(e,t,i,n,r,s,o){const a=10*e,l=5*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=n,this.float32[l+2]=r,this.float32[l+3]=s,this.float32[l+4]=o,e}}So.prototype.bytesPerElement=20,is(So,"StructArrayLayout3i3f20");class To extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}To.prototype.bytesPerElement=4,is(To,"StructArrayLayout1ul4");class Eo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const n=2*e;return this.uint16[n+0]=t,this.uint16[n+1]=i,e}}Eo.prototype.bytesPerElement=4,is(Eo,"StructArrayLayout2ui4");class Mo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,s,o,a,l,c,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,i,n,r,s,o,a,l,c,u,h,d)}emplace(e,t,i,n,r,s,o,a,l,c,u,h,d,p){const f=20*e,m=10*e;return this.int16[f+0]=t,this.int16[f+1]=i,this.int16[f+2]=n,this.int16[f+3]=r,this.int16[f+4]=s,this.float32[m+3]=o,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,e}}Mo.prototype.bytesPerElement=40,is(Mo,"StructArrayLayout5i4f1i1ul2ui40");class Io extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,n,r,s,o)}emplace(e,t,i,n,r,s,o,a){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.int16[l+2]=n,this.int16[l+4]=r,this.int16[l+5]=s,this.int16[l+6]=o,this.int16[l+7]=a,e}}Io.prototype.bytesPerElement=16,is(Io,"StructArrayLayout3i2i2i16");class Ao extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,n,r)}emplace(e,t,i,n,r,s){const o=4*e,a=8*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=n,this.int16[a+6]=r,this.int16[a+7]=s,e}}Ao.prototype.bytesPerElement=16,is(Ao,"StructArrayLayout2f1f2i16");class Co extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const s=12*e,o=3*e;return this.uint8[s+0]=t,this.uint8[s+1]=i,this.float32[o+1]=n,this.float32[o+2]=r,e}}Co.prototype.bytesPerElement=12,is(Co,"StructArrayLayout2ub2f12");class Po extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i)}emplace(e,t,i,n){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=i,this.uint16[r+2]=n,e}}Po.prototype.bytesPerElement=6,is(Po,"StructArrayLayout3ui6");class ko extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,v,x)}emplace(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b){const w=30*e,S=15*e,T=60*e;return this.int16[w+0]=t,this.int16[w+1]=i,this.int16[w+2]=n,this.float32[S+2]=r,this.float32[S+3]=s,this.uint16[w+8]=o,this.uint16[w+9]=a,this.uint32[S+5]=l,this.uint32[S+6]=c,this.uint32[S+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[S+10]=f,this.float32[S+11]=m,this.uint8[T+48]=g,this.uint8[T+49]=_,this.uint8[T+50]=y,this.uint32[S+13]=v,this.int16[w+28]=x,this.uint8[T+58]=b,e}}ko.prototype.bytesPerElement=60,is(ko,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ro extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,S,T,E,M,I,A,C,P,k){const R=this.length;return this.resize(R+1),this.emplace(R,e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,S,T,E,M,I,A,C,P,k)}emplace(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,S,T,E,M,I,A,C,P,k,R){const L=20*e,D=40*e,O=80*e;return this.float32[L+0]=t,this.float32[L+1]=i,this.int16[D+4]=n,this.int16[D+5]=r,this.int16[D+6]=s,this.int16[D+7]=o,this.int16[D+8]=a,this.int16[D+9]=l,this.int16[D+10]=c,this.int16[D+11]=u,this.int16[D+12]=h,this.uint16[D+13]=d,this.uint16[D+14]=p,this.uint16[D+15]=f,this.uint16[D+16]=m,this.uint16[D+17]=g,this.uint16[D+18]=_,this.uint16[D+19]=y,this.uint16[D+20]=v,this.uint16[D+21]=x,this.uint16[D+22]=b,this.uint16[D+23]=w,this.uint16[D+24]=S,this.uint16[D+25]=T,this.uint16[D+26]=E,this.uint16[D+27]=M,this.uint32[L+14]=I,this.float32[L+15]=A,this.float32[L+16]=C,this.float32[L+17]=P,this.float32[L+18]=k,this.uint8[O+76]=R,e}}Ro.prototype.bytesPerElement=80,is(Ro,"StructArrayLayout2f9i15ui1ul4f1ub80");class Lo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Lo.prototype.bytesPerElement=4,is(Lo,"StructArrayLayout1f4");class Do extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,n,r)}emplace(e,t,i,n,r,s){const o=5*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=n,this.float32[o+3]=r,this.float32[o+4]=s,e}}Do.prototype.bytesPerElement=20,is(Do,"StructArrayLayout5f20");class Oo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,n,r,s,o)}emplace(e,t,i,n,r,s,o,a){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=i,this.float32[l+2]=n,this.float32[l+3]=r,this.float32[l+4]=s,this.float32[l+5]=o,this.float32[l+6]=a,e}}Oo.prototype.bytesPerElement=28,is(Oo,"StructArrayLayout7f28");class No extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const s=6*e;return this.uint32[3*e+0]=t,this.uint16[s+2]=i,this.uint16[s+3]=n,this.uint16[s+4]=r,e}}No.prototype.bytesPerElement=12,is(No,"StructArrayLayout1ul3ui12");class zo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}zo.prototype.bytesPerElement=2,is(zo,"StructArrayLayout1ui2");class Fo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i)}emplace(e,t,i,n){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=i,this.float32[r+2]=n,e}}Fo.prototype.bytesPerElement=12,is(Fo,"StructArrayLayout3f12");class Bo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const n=2*e;return this.float32[n+0]=t,this.float32[n+1]=i,e}}Bo.prototype.bytesPerElement=8,is(Bo,"StructArrayLayout2f8");class Uo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m)}emplace(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g){const _=16*e;return this.float32[_+0]=t,this.float32[_+1]=i,this.float32[_+2]=n,this.float32[_+3]=r,this.float32[_+4]=s,this.float32[_+5]=o,this.float32[_+6]=a,this.float32[_+7]=l,this.float32[_+8]=c,this.float32[_+9]=u,this.float32[_+10]=h,this.float32[_+11]=d,this.float32[_+12]=p,this.float32[_+13]=f,this.float32[_+14]=m,this.float32[_+15]=g,e}}Uo.prototype.bytesPerElement=64,is(Uo,"StructArrayLayout16f64");class Vo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,n,r,s,o)}emplace(e,t,i,n,r,s,o,a){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=i,this.uint16[l+2]=n,this.uint16[l+3]=r,this.float32[c+2]=s,this.float32[c+3]=o,this.float32[c+4]=a,e}}Vo.prototype.bytesPerElement=20,is(Vo,"StructArrayLayout4ui3f20");class jo extends co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}jo.prototype.bytesPerElement=1,is(jo,"StructArrayLayout1ub1");class Go extends lo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Go.prototype.size=40;class Ho extends Mo{get(e){return new Go(this,e)}}is(Ho,"CollisionBoxArray");class Wo extends lo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Wo.prototype.size=60;class qo extends ko{get(e){return new Wo(this,e)}}is(qo,"PlacedSymbolArray");class $o extends lo{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}$o.prototype.size=80;class Zo extends Ro{get(e){return new $o(this,e)}}is(Zo,"SymbolInstanceArray");class Xo extends Lo{getoffsetX(e){return this.float32[1*e+0]}}is(Xo,"GlyphOffsetArray");class Yo extends po{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}is(Yo,"SymbolLineVertexArray");class Ko extends lo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ko.prototype.size=12;class Jo extends No{get(e){return new Ko(this,e)}}is(Jo,"FeatureIndexArray");class Qo extends Eo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}is(Qo,"FillExtrusionCentroidArray");const ea=uo([{name:"a_pos",components:2,type:"Int16"}],4),ta=uo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ia{constructor(e=[]){this.segments=e}_prepareSegment(e,t,i,n){let r=this.segments[this.segments.length-1];return e>ia.MAX_VERTEX_ARRAY_LENGTH&&j(`Max vertices per segment is ${ia.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!r||r.vertexLength+e>ia.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==n)&&(r={vertexOffset:t,primitiveOffset:i,vertexLength:0,primitiveLength:0},void 0!==n&&(r.sortKey=n),this.segments.push(r)),r}prepareSegment(e,t,i,n){return this._prepareSegment(e,t.length,i.length,n)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,i,n){return new ia([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:n,vaos:{},sortKey:0}])}}function na(e,t){return 256*(e=M(Math.floor(e),0,255))+M(Math.floor(t),0,255)}ia.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,is(ia,"SegmentVector");const ra=uo([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),sa=uo([{name:"a_dash",components:4,type:"Uint16"}]);var oa={exports:{}},aa={exports:{}};!function(e){e.exports=function(e,t){var i,n,r,s,o,a,l,c;for(n=e.length-(i=3&e.length),r=t,o=3432918353,a=461845907,c=0;c<n;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=27492+(65535&(s=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}}(aa);var la=aa.exports,ca={exports:{}};!function(e){e.exports=function(e,t){for(var i,n=e.length,r=t^n,s=0;n>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(s)|(255&e.charCodeAt(++s))<<8|(255&e.charCodeAt(++s))<<16|(255&e.charCodeAt(++s))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++s;switch(n){case 3:r^=(255&e.charCodeAt(s+2))<<16;case 2:r^=(255&e.charCodeAt(s+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(s)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}}(ca);var ua=la,ha=ca.exports;oa.exports=ua,oa.exports.murmur3=ua,oa.exports.murmur2=ha;var da=h(oa.exports);class pa{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,i,n){this.ids.push(fa(e)),this.positions.push(t,i,n)}eachPosition(e,t){const i=fa(e);let n=0,r=this.ids.length-1;for(;n<r;){const e=n+r>>1;this.ids[e]>=i?r=e:n=e+1}for(;this.ids[n]===i;)t(this.positions[3*n],this.positions[3*n+1],this.positions[3*n+2]),n++}static serialize(e,t){const i=new Float64Array(e.ids),n=new Uint32Array(e.positions);return ma(i,n,0,i.length-1),t&&(t.add(i.buffer),t.add(n.buffer)),{ids:i,positions:n}}static deserialize(e){const t=new pa;let i;t.ids=e.ids,t.positions=e.positions;for(const e of t.ids)e!==i&&t.uniqueIds.push(e),i=e;return t.indexed=!0,t}}function fa(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:da(String(e))}function ma(e,t,i,n){for(;i<n;){const r=e[i+n>>1];let s=i-1,o=n+1;for(;;){do{s++}while(e[s]<r);do{o--}while(e[o]>r);if(s>=o)break;ga(e,s,o),ga(t,3*s,3*o),ga(t,3*s+1,3*o+1),ga(t,3*s+2,3*o+2)}o-i<n-o?(ma(e,t,i,o),i=o+1):(ma(e,t,o+1,n),n=o)}}function ga(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}is(pa,"FeaturePositionMap");class _a{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class ya extends _a{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class va extends _a{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class xa extends _a{constructor(e){super(e),this.current=[0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class ba extends _a{constructor(e){super(e),this.current=[0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class wa extends _a{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class Sa extends _a{constructor(e){super(e),this.current=lt.transparent}set(e,t,i){this.fetchUniformLocation(e,t)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const Ta=new Float32Array(16);class Ea extends _a{constructor(e){super(e),this.current=Ta}set(e,t,i){if(this.fetchUniformLocation(e,t)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}const Ma=new Float32Array(9),Ia=new Float32Array(4);class Aa extends _a{constructor(e){super(e),this.current=Ia}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}function Ca(e){return[na(255*e.r,255*e.g),na(255*e.b,255*e.a)]}class Pa{constructor(e,t,i){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=i}setUniform(e,t,i,n,r){t.set(e,r,n.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new Sa(e):new va(e)}}class ka{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,i,n,r){const s="u_pattern"===r||"u_dash"===r?this.pattern:"u_pixel_ratio"===r?this.pixelRatio:null;s&&t.set(e,r,s)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new wa(e):new va(e)}}class Ra{constructor(e,t,i,n){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new n}populatePaintArray(e,t,i,n,r,s,o){const a=this.paintVertexArray.length,l=this.expression.evaluate(new As(0,{brightness:s}),t,{},r,n,o);this.paintVertexArray.resize(e),this._setPaintValue(a,e,l)}updatePaintArray(e,t,i,n,r,s,o){const a=this.expression.evaluate({zoom:0,brightness:o},i,n,void 0,r);this._setPaintValue(e,t,a)}_setPaintValue(e,t,i){if("color"===this.type){const n=Ca(i);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class La{constructor(e,t,i,n,r,s){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=i,this.useIntegerZoom=n,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new s}populatePaintArray(e,t,i,n,r,s,o){const a=this.expression.evaluate(new As(this.zoom,{brightness:s}),t,{},r,n,o),l=this.expression.evaluate(new As(this.zoom+1,{brightness:s}),t,{},r,n,o),c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(c,e,a,l)}updatePaintArray(e,t,i,n,r,s,o){const a=this.expression.evaluate({zoom:this.zoom,brightness:o},i,n,void 0,r),l=this.expression.evaluate({zoom:this.zoom+1,brightness:o},i,n,void 0,r);this._setPaintValue(e,t,a,l)}_setPaintValue(e,t,i,n){if("color"===this.type){const r=Ca(i),s=Ca(n);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1],s[0],s[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,i,n,r){const s=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,o=M(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(e,r,o)}getBinding(e,t){return new va(e)}}class Da{constructor(e,t,i,n,r){this.expression=e,this.layerId=r,this.paintVertexAttributes=("array"===i?sa:ra).members;for(let e=0;e<t.length;++e);this.paintVertexArray=new n}populatePaintArray(e,t,i){const n=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],i)}updatePaintArray(e,t,i,n,r,s,o){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],s)}_setPaintValues(e,t,i,n){if(!n||!i)return;const r=n[i];if(!r)return;const{tl:s,br:o,pixelRatio:a}=r;for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,s[0],s[1],o[0],o[1],a)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Oa{constructor(e,t,i=(()=>!0)){this.binders={},this._buffers=[];const n=[];for(const r in e.paint._values){const s=e.paint.get(r);if(!i(r))continue;if(!(s instanceof Os&&kr(s.property.specification)))continue;const o=Fa(r,e.type),a=s.value,l=s.property.specification.type,c=!!s.property.useIntegerZoom,u="line-dasharray"===r||r.endsWith("pattern"),h="line-dasharray"===r&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==a.kind||h)if("source"===a.kind||h||u){const t=Va(r,l,"source");this.binders[r]=u?new Da(a,o,l,t,e.id):new Ra(a,o,l,t),n.push(`/a_${r}`)}else{const e=Va(r,l,"composite");this.binders[r]=new La(a,o,l,c,t,e),n.push(`/z_${r}`)}else this.binders[r]=u?new ka(a.value,o):new Pa(a.value,o,l),n.push(`/u_${r}`)}this.cacheKey=n.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Ra||t instanceof La?t.maxValue:0}populatePaintArrays(e,t,i,n,r,s,o){for(const a in this.binders){const l=this.binders[a];(l instanceof Ra||l instanceof La||l instanceof Da)&&l.populatePaintArray(e,t,i,n,r,s,o)}}setConstantPatternPositions(e){for(const t in this.binders){const i=this.binders[t];i instanceof ka&&i.setConstantPatternPositions(e)}}updatePaintArrays(e,t,i,n,r,s,o,a){let l=!1;const c=Object.keys(e),u=0!==c.length,h=u?c:t.uniqueIds;for(const c in this.binders){const d=this.binders[c];if((d instanceof Ra||d instanceof La||d instanceof Da)&&(!0===d.expression.isStateDependent||!1===d.expression.isLightConstant)){const p=r.paint.get(c);d.expression=p.value;for(const i of h){const r=e[i.toString()];t.eachPosition(i,((e,t,i)=>{const l=n.feature(e);d.updatePaintArray(t,i,l,r,s,o,a)}))}if(!u)for(const t of i.uniqueIds){const r=e[t.toString()];i.eachPosition(t,((e,t,i)=>{const l=n.feature(e);d.updatePaintArray(t,i,l,r,s,o,a)}))}l=!0}}return l}defines(){const e=[];for(const t in this.binders){const i=this.binders[t];(i instanceof Pa||i instanceof ka)&&e.push(...i.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof Ra||i instanceof La||i instanceof Da)for(let t=0;t<i.paintVertexAttributes.length;t++)e.push(i.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof Pa||i instanceof ka||i instanceof La)for(const t of i.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const i in this.binders){const n=this.binders[i];if(n instanceof Pa||n instanceof ka||n instanceof La)for(const r of n.uniformNames)t.push({name:r,property:i,binding:n.getBinding(e,r)})}return t}setUniforms(e,t,i,n,r){for(const{name:t,property:s,binding:o}of i)this.binders[s].setUniform(e,o,r,n.get(s),t)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Ra||t instanceof La||t instanceof Da)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const i=this.binders[t];(i instanceof Ra||i instanceof La||i instanceof Da)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Ra||t instanceof La||t instanceof Da)&&t.destroy()}}}class Na{constructor(e,t,i=(()=>!0)){this.programConfigurations={};for(const n of e)this.programConfigurations[n.id]=new Oa(n,t,i);this.needsUpload=!1,this._featureMap=new pa,this._featureMapWithoutIds=new pa,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,i,n,r,s,o,a){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,t,n,r,s,o,a);void 0!==t.id?this._featureMap.add(t.id,i,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,i,n,r,s){for(const o of i)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,o,n,r,s||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const za={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Fa(e,t){return za[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const Ba={"line-pattern":{source:vo,composite:vo},"fill-pattern":{source:vo,composite:vo},"fill-extrusion-pattern":{source:vo,composite:vo},"line-dasharray":{source:xo,composite:xo}},Ua={color:{source:Bo,composite:yo},number:{source:Lo,composite:Bo}};function Va(e,t,i){const n=Ba[e];return n&&n[i]||Ua[t][i]}is(Pa,"ConstantBinder"),is(ka,"PatternConstantBinder"),is(Ra,"SourceExpressionBinder"),is(Da,"PatternCompositeBinder"),is(La,"CompositeExpressionBinder"),is(Oa,"ProgramConfiguration",{omit:["_buffers"]}),is(Na,"ProgramConfigurationSet");const ja=ki/Math.PI/2,Ga=5,Ha=6,Wa=16383,qa=64,$a=[qa,32,16],Za=-ja,Xa=ja;function Ya(e,t,i,n=ja){return i=x(i),[e*Math.sin(i)*n,-t*n,e*Math.cos(i)*n]}function Ka(e,t,i){return Ya(Math.cos(x(e)),Math.sin(x(e)),t,i)}const Ja=6371008.8,Qa=2*Math.PI*Ja;class el{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new el(A(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,i=this.lat*t,n=e.lat*t,r=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return Ja*Math.acos(Math.min(r,1))}toBounds(e=0){const t=360*e/40075017,i=t/Math.cos(Math.PI/180*this.lat);return new tl({lng:this.lng-i,lat:this.lat-t},{lng:this.lng+i,lat:this.lat+t})}toEcef(e){return Ka(this.lat,this.lng,ja+e*ja/Ja)}static convert(e){if(e instanceof el)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new el(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new el(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class tl{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof el?new el(e.lng,e.lat):el.convert(e),this}setSouthWest(e){return this._sw=e instanceof el?new el(e.lng,e.lat):el.convert(e),this}extend(e){const t=this._sw,i=this._ne;let n,r;if(e instanceof el)n=e,r=e;else{if(!(e instanceof tl))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(tl.convert(e)):this.extend(el.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(el.convert(e)):this;if(n=e._sw,r=e._ne,!n||!r)return this}return t||i?(t.lng=Math.min(n.lng,t.lng),t.lat=Math.min(n.lat,t.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new el(n.lng,n.lat),this._ne=new el(r.lng,r.lat)),this}getCenter(){return new el((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new el(this.getWest(),this.getNorth())}getSouthEast(){return new el(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:i}=el.convert(e);let n=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&n}static convert(e){return!e||e instanceof tl?e:new tl(e)}}var il={};!function(e,t){!function(e){function t(e,t,n){var r=i(256*e,256*(t=Math.pow(2,n)-t-1),n),s=i(256*(e+1),256*(t+1),n);return r[0]+","+r[1]+","+s[0]+","+s[1]}function i(e,t,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[e*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}e.getURL=function(e,i,n,r,s,o){return o=o||{},e+"?"+["bbox="+t(n,r,s),"format="+(o.format||"image/png"),"service="+(o.service||"WMS"),"version="+(o.version||"1.1.1"),"request="+(o.request||"GetMap"),"srs="+(o.srs||"EPSG:3857"),"width="+(o.width||256),"height="+(o.height||256),"layers="+i].join("&")},e.getTileBBox=t,e.getMercCoords=i,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,il);var nl=il;class rl{constructor(e,t,i){this.z=e,this.x=t,this.y=i,this.key=al(0,e,e,t,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const i=nl.getTileBBox(this.x,this.y,this.z),n=function(e,t,i){let n,r="";for(let s=e;s>0;s--)n=1<<s-1,r+=(t&n?1:0)+(i&n?2:0);return r}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class sl{constructor(e,t){this.wrap=e,this.canonical=t,this.key=al(e,t.z,t.z,t.x,t.y)}}class ol{constructor(e,t,i,n,r){this.overscaledZ=e,this.wrap=t,this.canonical=new rl(i,+n,+r),this.key=0===t&&e===i?this.canonical.key:al(t,e,i,n,r)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new ol(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ol(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return al(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-e;return al(this.wrap*+t,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new ol(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return[new ol(t,this.wrap,t,i,n),new ol(t,this.wrap,t,i+1,n),new ol(t,this.wrap,t,i,n+1),new ol(t,this.wrap,t,i+1,n+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ol(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ol(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sl(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function al(e,t,i,n,r){const s=1<<Math.min(i,22);let o=s*(r%s)+n%s;return e&&i<22&&(o+=s*s*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*o+i)+(t-i)}const ll=[e=>{let t=e.canonical.x-1,i=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,i--),new ol(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,i=e.wrap;return t===1<<e.canonical.z&&(t=0,i++),new ol(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>new ol(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new ol(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];is(rl,"CanonicalTileID"),is(ol,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const cl=0,ul=25.5;function hl(e){return Qa*Math.cos(e*Math.PI/180)}function dl(e){return(180+e)/360}function pl(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function fl(e,t){return e/hl(t)}function ml(e){return 360*e-180}function gl(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function _l(e,t){return e*hl(gl(t))}const yl=85.051129;function vl(e){return Math.cos(x(M(e,-yl,yl)))}function xl(e,t){const i=M(t,cl,ul),n=Math.pow(2,i);return vl(e)*Qa/(512*n)}function bl(e){return 1/Math.cos(e*Math.PI/180)}function wl(e,t=0){const i=Math.exp(Math.PI*(1-(e.y+t/ki)/(1<<e.z)*2));return 80150034*i/(i*i+1)/ki/(1<<e.z)}class Sl{constructor(e,t,i=0){this.x=+e,this.y=+t,this.z=+i}static fromLngLat(e,t=0){const i=el.convert(e);return new Sl(dl(i.lng),pl(i.lat),fl(t,i.lat))}toLngLat(){return new el(ml(this.x),gl(this.y))}toAltitude(){return _l(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Qa*bl(gl(this.y))}}function Tl(e,t,i,n,r,s,o,a,l){const c=(t+n)/2,u=(i+r)/2,h=new _(c,u);a(h),function(e,t,i,n,r,s){const o=i-r,a=n-s;return Math.abs((n-t)*o-(i-e)*a)/Math.hypot(o,a)}(h.x,h.y,s.x,s.y,o.x,o.y)>=l?(Tl(e,t,i,c,u,s,h,a,l),Tl(e,c,u,n,r,h,o,a,l)):e.push(o)}function El(e,t,i){let n=e[0],r=n.x,s=n.y;t(n);const o=[n];for(let a=1;a<e.length;a++){const l=e[a],{x:c,y:u}=l;t(l),Tl(o,r,s,c,u,n,l,t,i),r=c,s=u,n=l}return o}function Ml(e,t,i,n){if(n(t,i)){const r=t.add(i)._mult(.5);Ml(e,t,r,n),Ml(e,r,i,n)}else e.push(i)}function Il(e,t){let i=e[0];const n=[i];for(let r=1;r<e.length;r++){const s=e[r];Ml(n,i,s,t),i=s}return n}const Al=Math.pow(2,14)-1,Cl=-Al-1;function Pl(e,t){const i=Math.round(e.x*t),n=Math.round(e.y*t);return e.x=M(i,Cl,Al),e.y=M(n,Cl,Al),(i<e.x||i>e.x+1||n<e.y||n>e.y+1)&&j("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function kl(e,t,i){const n=e.loadGeometry(),r=e.extent,s=ki/r;if(t&&i&&i.projection.isReprojectedInTileSpace){const s=1<<t.z,{scale:o,x:a,y:l,projection:c}=i,u=e=>{const i=ml((t.x+e.x/r)/s),n=gl((t.y+e.y/r)/s),u=c.project(i,n);e.x=(u.x*o-a)*r,e.y=(u.y*o-l)*r};for(let t=0;t<n.length;t++)if(1!==e.type)n[t]=El(n[t],u,1);else{const e=[];for(const i of n[t])i.x<0||i.x>=r||i.y<0||i.y>=r||(u(i),e.push(i));n[t]=e}}for(const e of n)for(const t of e)Pl(t,s);return n}function Rl(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?kl(e):[]}}function Ll(e,t,i,n,r){e.emplaceBack(2*t+(n+1)/2,2*i+(r+1)/2)}function Dl(e,t,i){const n=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*n,i[1]*n,i[2]*n)}class Ol{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new po,this.indexArray=new Po,this.segments=new ia,this.programConfigurations=new Na(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i,n){const r=this.layers[0],s=[];let o=null;"circle"===r.type&&(o=r.layout.get("circle-sort-key"));for(const{feature:t,id:r,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Rl(t,e);if(!this.layers[0]._featureFilter.filter(new As(this.zoom),c,i))continue;const u=o?o.evaluate(c,{},i):void 0,h={id:r,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:kl(t,i,n),patterns:{},sortKey:u};s.push(h)}o&&s.sort(((e,t)=>e.sortKey-t.sortKey));let a=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new bo,a=n.projection);for(const n of s){const{geometry:r,index:s,sourceLayerIndex:o}=n,l=e[s].feature;this.addFeature(n,r,s,t.availableImages,i,a,t.brightness),t.featureIndex.insert(l,r,s,o,this.index)}}update(e,t,i,n,r){const s=0!==Object.keys(e).length;s&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,s?this.stateDependentLayers:this.layers,i,n,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ea.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ta.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,i,n,r,s,o){for(const i of t)for(const t of i){const i=t.x,n=t.y;if(i<0||i>=ki||n<0||n>=ki)continue;if(s){const e=s.projectTilePoint(i,n,r),t=s.upVector(r,i,n),o=this.globeExtVertexArray;Dl(o,e,t),Dl(o,e,t),Dl(o,e,t),Dl(o,e,t)}const o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=o.vertexLength;Ll(this.layoutVertexArray,i,n,-1,-1),Ll(this.layoutVertexArray,i,n,1,-1),Ll(this.layoutVertexArray,i,n,1,1),Ll(this.layoutVertexArray,i,n,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),o.vertexLength+=4,o.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},n,r,o)}}function Nl(e,t){for(let i=0;i<e.length;i++)if(Wl(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Wl(e,t[i]))return!0;return!!Ul(e,t)}function zl(e,t,i){return!!Wl(e,t)||!!jl(t,e,i)}function Fl(e,t){if(1===e.length)return Hl(t,e[0]);for(let i=0;i<t.length;i++){const n=t[i];for(let t=0;t<n.length;t++)if(Wl(e,n[t]))return!0}for(let i=0;i<e.length;i++)if(Hl(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Ul(e,t[i]))return!0;return!1}function Bl(e,t,i){if(e.length>1){if(Ul(e,t))return!0;for(let n=0;n<t.length;n++)if(jl(t[n],e,i))return!0}for(let n=0;n<e.length;n++)if(jl(e[n],t,i))return!0;return!1}function Ul(e,t){if(0===e.length||0===t.length)return!1;for(let i=0;i<e.length-1;i++){const n=e[i],r=e[i+1];for(let e=0;e<t.length-1;e++)if(Vl(n,r,t[e],t[e+1]))return!0}return!1}function Vl(e,t,i,n){return G(e,i,n)!==G(t,i,n)&&G(e,t,i)!==G(e,t,n)}function jl(e,t,i){const n=i*i;if(1===t.length)return e.distSqr(t[0])<n;for(let i=1;i<t.length;i++)if(Gl(e,t[i-1],t[i])<n)return!0;return!1}function Gl(e,t,i){const n=t.distSqr(i);if(0===n)return e.distSqr(t);const r=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/n;return e.distSqr(r<0?t:r>1?i:i.sub(t)._mult(r)._add(t))}function Hl(e,t){let i,n,r,s=!1;for(let o=0;o<e.length;o++){i=e[o];for(let e=0,o=i.length-1;e<i.length;o=e++)n=i[e],r=i[o],n.y>t.y!=r.y>t.y&&t.x<(r.x-n.x)*(t.y-n.y)/(r.y-n.y)+n.x&&(s=!s)}return s}function Wl(e,t){let i=!1;for(let n=0,r=e.length-1;n<e.length;r=n++){const s=e[n],o=e[r];s.y>t.y!=o.y>t.y&&t.x<(o.x-s.x)*(t.y-s.y)/(o.y-s.y)+s.x&&(i=!i)}return i}function ql(e,t,i,n,r){for(const s of e)if(t<=s.x&&i<=s.y&&n>=s.x&&r>=s.y)return!0;const s=[new _(t,i),new _(t,r),new _(n,r),new _(n,i)];if(e.length>2)for(const t of s)if(Wl(e,t))return!0;for(let t=0;t<e.length-1;t++)if($l(e[t],e[t+1],s))return!0;return!1}function $l(e,t,i){const n=i[0],r=i[2];if(e.x<n.x&&t.x<n.x||e.x>r.x&&t.x>r.x||e.y<n.y&&t.y<n.y||e.y>r.y&&t.y>r.y)return!1;const s=G(e,t,i[0]);return s!==G(e,t,i[1])||s!==G(e,t,i[2])||s!==G(e,t,i[3])}function Zl(e,t,i,n,r,s){let o=t.y-e.y,a=e.x-t.x;if(s=s||0){const e=o*o+a*a;if(0===e)return!0;const t=Math.sqrt(e);o/=t,a/=t}return!((i.x-e.x)*o+(i.y-e.y)*a-s<0||(n.x-e.x)*o+(n.y-e.y)*a-s<0||(r.x-e.x)*o+(r.y-e.y)*a-s<0)}function Xl(e,t,i,n,r,s,o){return!(Zl(e,t,n,r,s,o)||Zl(t,i,n,r,s,o)||Zl(i,e,n,r,s,o)||Zl(n,r,e,t,i,o)||Zl(r,s,e,t,i,o)||Zl(s,n,e,t,i,o))}function Yl(e,t,i){const n=t.paint.get(e).value;return"constant"===n.kind?n.value:i.programConfigurations.get(t.id).getMaxValue(e)}function Kl(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Jl(e,t,i,n,r){if(!t[0]&&!t[1])return e;const s=_.convert(t)._mult(r);"viewport"===i&&s._rotate(-n);const o=[];for(let t=0;t<e.length;t++)o.push(e[t].sub(s));return o}function Ql(e,t,i,n){const r=_.convert(e)._mult(n);return"viewport"===t&&r._rotate(-i),r}is(Ol,"CircleBucket",{omit:["layers"]});const ec=new Us({"circle-sort-key":new Fs(Gs.layout_circle["circle-sort-key"]),visibility:new zs(Gs.layout_circle.visibility)});var tc={paint:new Us({"circle-radius":new Fs(Gs.paint_circle["circle-radius"]),"circle-color":new Fs(Gs.paint_circle["circle-color"]),"circle-blur":new Fs(Gs.paint_circle["circle-blur"]),"circle-opacity":new Fs(Gs.paint_circle["circle-opacity"]),"circle-translate":new zs(Gs.paint_circle["circle-translate"]),"circle-translate-anchor":new zs(Gs.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zs(Gs.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zs(Gs.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fs(Gs.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fs(Gs.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fs(Gs.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new zs(Gs.paint_circle["circle-emissive-strength"])}),layout:ec},ic={},nc={};Object.defineProperty(nc,"__esModule",{value:!0}),nc.setMatrixArrayType=function(e){nc.ARRAY_TYPE=sc=e},nc.toRadian=function(e){return e*ac},nc.equals=function(e,t){return Math.abs(e-t)<=rc*Math.max(1,Math.abs(e),Math.abs(t))},nc.RANDOM=nc.ARRAY_TYPE=nc.EPSILON=void 0;var rc=1e-6;nc.EPSILON=rc;var sc="undefined"!=typeof Float32Array?Float32Array:Array;nc.ARRAY_TYPE=sc;var oc=Math.random;nc.RANDOM=oc;var ac=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var lc={};function cc(e){return cc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cc(e)}Object.defineProperty(lc,"__esModule",{value:!0}),lc.create=function(){var e=new uc.ARRAY_TYPE(4);return uc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},lc.clone=function(e){var t=new uc.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},lc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},lc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},lc.fromValues=function(e,t,i,n){var r=new uc.ARRAY_TYPE(4);return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r},lc.set=function(e,t,i,n,r){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e},lc.transpose=function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},lc.invert=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=i*s-r*n;return o?(e[0]=s*(o=1/o),e[1]=-n*o,e[2]=-r*o,e[3]=i*o,e):null},lc.adjoint=function(e,t){var i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},lc.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},lc.multiply=dc,lc.rotate=function(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=n*l+s*a,e[1]=r*l+o*a,e[2]=n*-a+s*l,e[3]=r*-a+o*l,e},lc.scale=function(e,t,i){var n=t[1],r=t[2],s=t[3],o=i[0],a=i[1];return e[0]=t[0]*o,e[1]=n*o,e[2]=r*a,e[3]=s*a,e},lc.fromRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=-i,e[3]=n,e},lc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},lc.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},lc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},lc.LDU=function(e,t,i,n){return e[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-e[2]*i[1],[e,t,i]},lc.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},lc.subtract=pc,lc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},lc.equals=function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=uc.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=uc.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-l)<=uc.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-c)<=uc.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},lc.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},lc.multiplyScalarAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e},lc.sub=lc.mul=void 0;var uc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==cc(e)&&"function"!=typeof e)return{default:e};var i=hc(void 0);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(nc);function hc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(hc=function(e){return e?i:t})(e)}function dc(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=i[0],l=i[1],c=i[2],u=i[3];return e[0]=n*a+s*l,e[1]=r*a+o*l,e[2]=n*c+s*u,e[3]=r*c+o*u,e}function pc(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}lc.mul=dc,lc.sub=pc;var fc={};function mc(e){return mc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mc(e)}Object.defineProperty(fc,"__esModule",{value:!0}),fc.create=function(){var e=new gc.ARRAY_TYPE(6);return gc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},fc.clone=function(e){var t=new gc.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},fc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},fc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},fc.fromValues=function(e,t,i,n,r,s){var o=new gc.ARRAY_TYPE(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=n,o[4]=r,o[5]=s,o},fc.set=function(e,t,i,n,r,s,o){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e[4]=s,e[5]=o,e},fc.invert=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=i*s-n*r;return l?(e[0]=s*(l=1/l),e[1]=-n*l,e[2]=-r*l,e[3]=i*l,e[4]=(r*a-s*o)*l,e[5]=(n*o-i*a)*l,e):null},fc.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},fc.multiply=yc,fc.rotate=function(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(i),u=Math.cos(i);return e[0]=n*u+s*c,e[1]=r*u+o*c,e[2]=n*-c+s*u,e[3]=r*-c+o*u,e[4]=a,e[5]=l,e},fc.scale=function(e,t,i){var n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=i[0],c=i[1];return e[0]=t[0]*l,e[1]=n*l,e[2]=r*c,e[3]=s*c,e[4]=o,e[5]=a,e},fc.translate=function(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=i[0],u=i[1];return e[0]=n,e[1]=r,e[2]=s,e[3]=o,e[4]=n*c+s*u+a,e[5]=r*c+o*u+l,e},fc.fromRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=-i,e[3]=n,e[4]=0,e[5]=0,e},fc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},fc.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},fc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},fc.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},fc.subtract=vc,fc.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},fc.multiplyScalarAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e[4]=t[4]+i[4]*n,e[5]=t[5]+i[5]*n,e},fc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},fc.equals=function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=t[0],c=t[1],u=t[2],h=t[3],d=t[4],p=t[5];return Math.abs(i-l)<=gc.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-c)<=gc.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-u)<=gc.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-h)<=gc.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-d)<=gc.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-p)<=gc.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))},fc.sub=fc.mul=void 0;var gc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==mc(e)&&"function"!=typeof e)return{default:e};var i=_c(void 0);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(nc);function _c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(_c=function(e){return e?i:t})(e)}function yc(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=i[0],u=i[1],h=i[2],d=i[3],p=i[4],f=i[5];return e[0]=n*c+s*u,e[1]=r*c+o*u,e[2]=n*h+s*d,e[3]=r*h+o*d,e[4]=n*p+s*f+a,e[5]=r*p+o*f+l,e}function vc(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}fc.mul=yc,fc.sub=vc;var xc={};function bc(e){return bc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bc(e)}Object.defineProperty(xc,"__esModule",{value:!0}),xc.create=function(){var e=new wc.ARRAY_TYPE(9);return wc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},xc.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},xc.clone=function(e){var t=new wc.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},xc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},xc.fromValues=function(e,t,i,n,r,s,o,a,l){var c=new wc.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=n,c[4]=r,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c},xc.set=function(e,t,i,n,r,s,o,a,l,c){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e},xc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},xc.transpose=function(e,t){if(e===t){var i=t[1],n=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=n,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},xc.invert=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*o-a*c,d=-u*s+a*l,p=c*s-o*l,f=i*h+n*d+r*p;return f?(e[0]=h*(f=1/f),e[1]=(-u*n+r*c)*f,e[2]=(a*n-r*o)*f,e[3]=d*f,e[4]=(u*i-r*l)*f,e[5]=(-a*i+r*s)*f,e[6]=p*f,e[7]=(-c*i+n*l)*f,e[8]=(o*i-n*s)*f,e):null},xc.adjoint=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=o*u-a*c,e[1]=r*c-n*u,e[2]=n*a-r*o,e[3]=a*l-s*u,e[4]=i*u-r*l,e[5]=r*s-i*a,e[6]=s*c-o*l,e[7]=n*l-i*c,e[8]=i*o-n*s,e},xc.determinant=function(e){var t=e[3],i=e[4],n=e[5],r=e[6],s=e[7],o=e[8];return e[0]*(o*i-n*s)+e[1]*(-o*t+n*r)+e[2]*(s*t-i*r)},xc.multiply=Tc,xc.translate=function(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],p=i[1];return e[0]=n,e[1]=r,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=d*n+p*o+c,e[7]=d*r+p*a+u,e[8]=d*s+p*l+h,e},xc.rotate=function(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(i),p=Math.cos(i);return e[0]=p*n+d*o,e[1]=p*r+d*a,e[2]=p*s+d*l,e[3]=p*o-d*n,e[4]=p*a-d*r,e[5]=p*l-d*s,e[6]=c,e[7]=u,e[8]=h,e},xc.scale=function(e,t,i){var n=i[0],r=i[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},xc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},xc.fromRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=0,e[3]=-i,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},xc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},xc.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},xc.fromQuat=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=i+i,a=n+n,l=r+r,c=i*o,u=n*o,h=n*a,d=r*o,p=r*a,f=r*l,m=s*o,g=s*a,_=s*l;return e[0]=1-h-f,e[3]=u-_,e[6]=d+g,e[1]=u+_,e[4]=1-c-f,e[7]=p-m,e[2]=d-g,e[5]=p+m,e[8]=1-c-h,e},xc.normalFromMat4=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=i*a-n*o,v=i*l-r*o,x=i*c-s*o,b=n*l-r*a,w=n*c-s*a,S=r*c-s*l,T=u*m-h*f,E=u*g-d*f,M=u*_-p*f,I=h*g-d*m,A=h*_-p*m,C=d*_-p*g,P=y*C-v*A+x*I+b*M-w*E+S*T;return P?(e[0]=(a*C-l*A+c*I)*(P=1/P),e[1]=(l*M-o*C-c*E)*P,e[2]=(o*A-a*M+c*T)*P,e[3]=(r*A-n*C-s*I)*P,e[4]=(i*C-r*M+s*E)*P,e[5]=(n*M-i*A-s*T)*P,e[6]=(m*S-g*w+_*b)*P,e[7]=(g*x-f*S-_*v)*P,e[8]=(f*w-m*x+_*y)*P,e):null},xc.projection=function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},xc.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},xc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},xc.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},xc.subtract=Ec,xc.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},xc.multiplyScalarAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e[4]=t[4]+i[4]*n,e[5]=t[5]+i[5]*n,e[6]=t[6]+i[6]*n,e[7]=t[7]+i[7]*n,e[8]=t[8]+i[8]*n,e},xc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},xc.equals=function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=t[0],d=t[1],p=t[2],f=t[3],m=t[4],g=t[5],_=t[6],y=t[7],v=t[8];return Math.abs(i-h)<=wc.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-d)<=wc.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(r-p)<=wc.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(s-f)<=wc.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-m)<=wc.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-g)<=wc.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-_)<=wc.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-y)<=wc.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-v)<=wc.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))},xc.sub=xc.mul=void 0;var wc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==bc(e)&&"function"!=typeof e)return{default:e};var i=Sc(void 0);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(nc);function Sc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(Sc=function(e){return e?i:t})(e)}function Tc(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],p=i[1],f=i[2],m=i[3],g=i[4],_=i[5],y=i[6],v=i[7],x=i[8];return e[0]=d*n+p*o+f*c,e[1]=d*r+p*a+f*u,e[2]=d*s+p*l+f*h,e[3]=m*n+g*o+_*c,e[4]=m*r+g*a+_*u,e[5]=m*s+g*l+_*h,e[6]=y*n+v*o+x*c,e[7]=y*r+v*a+x*u,e[8]=y*s+v*l+x*h,e}function Ec(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}xc.mul=Tc,xc.sub=Ec;var Mc={};function Ic(e){return Ic="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ic(e)}Object.defineProperty(Mc,"__esModule",{value:!0}),Mc.create=function(){var e=new Ac.ARRAY_TYPE(16);return Ac.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},Mc.clone=function(e){var t=new Ac.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Mc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Mc.fromValues=function(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m){var g=new Ac.ARRAY_TYPE(16);return g[0]=e,g[1]=t,g[2]=i,g[3]=n,g[4]=r,g[5]=s,g[6]=o,g[7]=a,g[8]=l,g[9]=c,g[10]=u,g[11]=h,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g},Mc.set=function(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e},Mc.identity=Pc,Mc.transpose=function(e,t){if(e===t){var i=t[1],n=t[2],r=t[3],s=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=s,e[11]=t[14],e[12]=r,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},Mc.invert=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=i*a-n*o,v=i*l-r*o,x=i*c-s*o,b=n*l-r*a,w=n*c-s*a,S=r*c-s*l,T=u*m-h*f,E=u*g-d*f,M=u*_-p*f,I=h*g-d*m,A=h*_-p*m,C=d*_-p*g,P=y*C-v*A+x*I+b*M-w*E+S*T;return P?(e[0]=(a*C-l*A+c*I)*(P=1/P),e[1]=(r*A-n*C-s*I)*P,e[2]=(m*S-g*w+_*b)*P,e[3]=(d*w-h*S-p*b)*P,e[4]=(l*M-o*C-c*E)*P,e[5]=(i*C-r*M+s*E)*P,e[6]=(g*x-f*S-_*v)*P,e[7]=(u*S-d*x+p*v)*P,e[8]=(o*A-a*M+c*T)*P,e[9]=(n*M-i*A-s*T)*P,e[10]=(f*w-m*x+_*y)*P,e[11]=(h*x-u*w-p*y)*P,e[12]=(a*E-o*I-l*T)*P,e[13]=(i*I-n*E+r*T)*P,e[14]=(m*v-f*b-g*y)*P,e[15]=(u*b-h*v+d*y)*P,e):null},Mc.adjoint=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15];return e[0]=a*(d*_-p*g)-h*(l*_-c*g)+m*(l*p-c*d),e[1]=-(n*(d*_-p*g)-h*(r*_-s*g)+m*(r*p-s*d)),e[2]=n*(l*_-c*g)-a*(r*_-s*g)+m*(r*c-s*l),e[3]=-(n*(l*p-c*d)-a*(r*p-s*d)+h*(r*c-s*l)),e[4]=-(o*(d*_-p*g)-u*(l*_-c*g)+f*(l*p-c*d)),e[5]=i*(d*_-p*g)-u*(r*_-s*g)+f*(r*p-s*d),e[6]=-(i*(l*_-c*g)-o*(r*_-s*g)+f*(r*c-s*l)),e[7]=i*(l*p-c*d)-o*(r*p-s*d)+u*(r*c-s*l),e[8]=o*(h*_-p*m)-u*(a*_-c*m)+f*(a*p-c*h),e[9]=-(i*(h*_-p*m)-u*(n*_-s*m)+f*(n*p-s*h)),e[10]=i*(a*_-c*m)-o*(n*_-s*m)+f*(n*c-s*a),e[11]=-(i*(a*p-c*h)-o*(n*p-s*h)+u*(n*c-s*a)),e[12]=-(o*(h*g-d*m)-u*(a*g-l*m)+f*(a*d-l*h)),e[13]=i*(h*g-d*m)-u*(n*g-r*m)+f*(n*d-r*h),e[14]=-(i*(a*g-l*m)-o*(n*g-r*m)+f*(n*l-r*a)),e[15]=i*(a*d-l*h)-o*(n*d-r*h)+u*(n*l-r*a),e},Mc.determinant=function(e){var t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*o-i*s)*(h*g-d*m)-(t*a-n*s)*(u*g-d*f)+(t*l-r*s)*(u*m-h*f)+(i*a-n*o)*(c*g-d*p)-(i*l-r*o)*(c*m-h*p)+(n*l-r*a)*(c*f-u*p)},Mc.multiply=kc,Mc.translate=function(e,t,i){var n,r,s,o,a,l,c,u,h,d,p,f,m=i[0],g=i[1],_=i[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=n=t[0],e[1]=r,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=n*m+a*g+h*_+t[12],e[13]=r*m+l*g+d*_+t[13],e[14]=s*m+c*g+p*_+t[14],e[15]=o*m+u*g+f*_+t[15]),e},Mc.scale=function(e,t,i){var n=i[0],r=i[1],s=i[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Mc.rotate=function(e,t,i,n){var r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,S,T,E,M,I,A=n[0],C=n[1],P=n[2],k=Math.hypot(A,C,P);return k<Ac.EPSILON?null:(A*=k=1/k,C*=k,P*=k,r=Math.sin(i),s=Math.cos(i),l=t[1],c=t[2],u=t[3],d=t[5],p=t[6],f=t[7],g=t[9],_=t[10],y=t[11],v=A*A*(o=1-s)+s,w=A*C*o-P*r,S=C*C*o+s,T=P*C*o+A*r,E=A*P*o+C*r,M=C*P*o-A*r,I=P*P*o+s,e[0]=(a=t[0])*v+(h=t[4])*(x=C*A*o+P*r)+(m=t[8])*(b=P*A*o-C*r),e[1]=l*v+d*x+g*b,e[2]=c*v+p*x+_*b,e[3]=u*v+f*x+y*b,e[4]=a*w+h*S+m*T,e[5]=l*w+d*S+g*T,e[6]=c*w+p*S+_*T,e[7]=u*w+f*S+y*T,e[8]=a*E+h*M+m*I,e[9]=l*E+d*M+g*I,e[10]=c*E+p*M+_*I,e[11]=u*E+f*M+y*I,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},Mc.rotateX=function(e,t,i){var n=Math.sin(i),r=Math.cos(i),s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*r+c*n,e[5]=o*r+u*n,e[6]=a*r+h*n,e[7]=l*r+d*n,e[8]=c*r-s*n,e[9]=u*r-o*n,e[10]=h*r-a*n,e[11]=d*r-l*n,e},Mc.rotateY=function(e,t,i){var n=Math.sin(i),r=Math.cos(i),s=t[0],o=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r-c*n,e[1]=o*r-u*n,e[2]=a*r-h*n,e[3]=l*r-d*n,e[8]=s*n+c*r,e[9]=o*n+u*r,e[10]=a*n+h*r,e[11]=l*n+d*r,e},Mc.rotateZ=function(e,t,i){var n=Math.sin(i),r=Math.cos(i),s=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r+c*n,e[1]=o*r+u*n,e[2]=a*r+h*n,e[3]=l*r+d*n,e[4]=c*r-s*n,e[5]=u*r-o*n,e[6]=h*r-a*n,e[7]=d*r-l*n,e},Mc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},Mc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.fromRotation=function(e,t,i){var n,r,s,o=i[0],a=i[1],l=i[2],c=Math.hypot(o,a,l);return c<Ac.EPSILON?null:(o*=c=1/c,a*=c,l*=c,n=Math.sin(t),r=Math.cos(t),e[0]=o*o*(s=1-r)+r,e[1]=a*o*s+l*n,e[2]=l*o*s-a*n,e[3]=0,e[4]=o*a*s-l*n,e[5]=a*a*s+r,e[6]=l*a*s+o*n,e[7]=0,e[8]=o*l*s+a*n,e[9]=a*l*s-o*n,e[10]=l*l*s+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},Mc.fromXRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.fromYRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.fromZRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.fromRotationTranslation=Rc,Mc.fromQuat2=function(e,t){var i=new Ac.ARRAY_TYPE(3),n=-t[0],r=-t[1],s=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=n*n+r*r+s*s+o*o;return h>0?(i[0]=2*(a*o+u*n+l*s-c*r)/h,i[1]=2*(l*o+u*r+c*n-a*s)/h,i[2]=2*(c*o+u*s+a*r-l*n)/h):(i[0]=2*(a*o+u*n+l*s-c*r),i[1]=2*(l*o+u*r+c*n-a*s),i[2]=2*(c*o+u*s+a*r-l*n)),Rc(e,t,i),e},Mc.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},Mc.getScaling=Lc,Mc.getRotation=function(e,t){var i=new Ac.ARRAY_TYPE(3);Lc(i,t);var n=1/i[0],r=1/i[1],s=1/i[2],o=t[0]*n,a=t[1]*r,l=t[2]*s,c=t[4]*n,u=t[5]*r,h=t[6]*s,d=t[8]*n,p=t[9]*r,f=t[10]*s,m=o+u+f,g=0;return m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(h-p)/g,e[1]=(d-l)/g,e[2]=(a-c)/g):o>u&&o>f?(g=2*Math.sqrt(1+o-u-f),e[3]=(h-p)/g,e[0]=.25*g,e[1]=(a+c)/g,e[2]=(d+l)/g):u>f?(g=2*Math.sqrt(1+u-o-f),e[3]=(d-l)/g,e[0]=(a+c)/g,e[1]=.25*g,e[2]=(h+p)/g):(g=2*Math.sqrt(1+f-o-u),e[3]=(a-c)/g,e[0]=(d+l)/g,e[1]=(h+p)/g,e[2]=.25*g),e},Mc.fromRotationTranslationScale=function(e,t,i,n){var r=t[0],s=t[1],o=t[2],a=t[3],l=r+r,c=s+s,u=o+o,h=r*l,d=r*c,p=r*u,f=s*c,m=s*u,g=o*u,_=a*l,y=a*c,v=a*u,x=n[0],b=n[1],w=n[2];return e[0]=(1-(f+g))*x,e[1]=(d+v)*x,e[2]=(p-y)*x,e[3]=0,e[4]=(d-v)*b,e[5]=(1-(h+g))*b,e[6]=(m+_)*b,e[7]=0,e[8]=(p+y)*w,e[9]=(m-_)*w,e[10]=(1-(h+f))*w,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},Mc.fromRotationTranslationScaleOrigin=function(e,t,i,n,r){var s=t[0],o=t[1],a=t[2],l=t[3],c=s+s,u=o+o,h=a+a,d=s*c,p=s*u,f=s*h,m=o*u,g=o*h,_=a*h,y=l*c,v=l*u,x=l*h,b=n[0],w=n[1],S=n[2],T=r[0],E=r[1],M=r[2],I=(1-(m+_))*b,A=(p+x)*b,C=(f-v)*b,P=(p-x)*w,k=(1-(d+_))*w,R=(g+y)*w,L=(f+v)*S,D=(g-y)*S,O=(1-(d+m))*S;return e[0]=I,e[1]=A,e[2]=C,e[3]=0,e[4]=P,e[5]=k,e[6]=R,e[7]=0,e[8]=L,e[9]=D,e[10]=O,e[11]=0,e[12]=i[0]+T-(I*T+P*E+L*M),e[13]=i[1]+E-(A*T+k*E+D*M),e[14]=i[2]+M-(C*T+R*E+O*M),e[15]=1,e},Mc.fromQuat=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=i+i,a=n+n,l=r+r,c=i*o,u=n*o,h=n*a,d=r*o,p=r*a,f=r*l,m=s*o,g=s*a,_=s*l;return e[0]=1-h-f,e[1]=u+_,e[2]=d-g,e[3]=0,e[4]=u-_,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.frustum=function(e,t,i,n,r,s,o){var a=1/(i-t),l=1/(r-n),c=1/(s-o);return e[0]=2*s*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(r+n)*l,e[10]=(o+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*c,e[15]=0,e},Mc.perspectiveNO=Dc,Mc.perspectiveZO=function(e,t,i,n,r){var s,o=1/Math.tan(t/2);return e[0]=o/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=r*(s=1/(n-r)),e[14]=r*n*s):(e[10]=-1,e[14]=-n),e},Mc.perspectiveFromFieldOfView=function(e,t,i,n){var r=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(r+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(r-s)*c*.5,e[10]=n/(i-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*i/(i-n),e[15]=0,e},Mc.orthoNO=Oc,Mc.orthoZO=function(e,t,i,n,r,s,o){var a=1/(t-i),l=1/(n-r),c=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+i)*a,e[13]=(r+n)*l,e[14]=s*c,e[15]=1,e},Mc.lookAt=function(e,t,i,n){var r,s,o,a,l,c,u,h,d,p,f=t[0],m=t[1],g=t[2],_=n[0],y=n[1],v=n[2],x=i[0],b=i[1],w=i[2];return Math.abs(f-x)<Ac.EPSILON&&Math.abs(m-b)<Ac.EPSILON&&Math.abs(g-w)<Ac.EPSILON?Pc(e):(u=f-x,h=m-b,d=g-w,r=y*(d*=p=1/Math.hypot(u,h,d))-v*(h*=p),s=v*(u*=p)-_*d,o=_*h-y*u,(p=Math.hypot(r,s,o))?(r*=p=1/p,s*=p,o*=p):(r=0,s=0,o=0),a=h*o-d*s,l=d*r-u*o,c=u*s-h*r,(p=Math.hypot(a,l,c))?(a*=p=1/p,l*=p,c*=p):(a=0,l=0,c=0),e[0]=r,e[1]=a,e[2]=u,e[3]=0,e[4]=s,e[5]=l,e[6]=h,e[7]=0,e[8]=o,e[9]=c,e[10]=d,e[11]=0,e[12]=-(r*f+s*m+o*g),e[13]=-(a*f+l*m+c*g),e[14]=-(u*f+h*m+d*g),e[15]=1,e)},Mc.targetTo=function(e,t,i,n){var r=t[0],s=t[1],o=t[2],a=n[0],l=n[1],c=n[2],u=r-i[0],h=s-i[1],d=o-i[2],p=u*u+h*h+d*d;p>0&&(u*=p=1/Math.sqrt(p),h*=p,d*=p);var f=l*d-c*h,m=c*u-a*d,g=a*h-l*u;return(p=f*f+m*m+g*g)>0&&(f*=p=1/Math.sqrt(p),m*=p,g*=p),e[0]=f,e[1]=m,e[2]=g,e[3]=0,e[4]=h*g-d*m,e[5]=d*f-u*g,e[6]=u*m-h*f,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=r,e[13]=s,e[14]=o,e[15]=1,e},Mc.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},Mc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},Mc.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e},Mc.subtract=Nc,Mc.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e},Mc.multiplyScalarAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e[4]=t[4]+i[4]*n,e[5]=t[5]+i[5]*n,e[6]=t[6]+i[6]*n,e[7]=t[7]+i[7]*n,e[8]=t[8]+i[8]*n,e[9]=t[9]+i[9]*n,e[10]=t[10]+i[10]*n,e[11]=t[11]+i[11]*n,e[12]=t[12]+i[12]*n,e[13]=t[13]+i[13]*n,e[14]=t[14]+i[14]*n,e[15]=t[15]+i[15]*n,e},Mc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},Mc.equals=function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=t[0],v=t[1],x=t[2],b=t[3],w=t[4],S=t[5],T=t[6],E=t[7],M=t[8],I=t[9],A=t[10],C=t[11],P=t[12],k=t[13],R=t[14],L=t[15];return Math.abs(i-y)<=Ac.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(n-v)<=Ac.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-x)<=Ac.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-b)<=Ac.EPSILON*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(o-w)<=Ac.EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(a-S)<=Ac.EPSILON*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(l-T)<=Ac.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-E)<=Ac.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(u-M)<=Ac.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(h-I)<=Ac.EPSILON*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(d-A)<=Ac.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(p-C)<=Ac.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(f-P)<=Ac.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-k)<=Ac.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(g-R)<=Ac.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(_-L)<=Ac.EPSILON*Math.max(1,Math.abs(_),Math.abs(L))},Mc.sub=Mc.mul=Mc.ortho=Mc.perspective=void 0;var Ac=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Ic(e)&&"function"!=typeof e)return{default:e};var i=Cc(void 0);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(nc);function Cc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(Cc=function(e){return e?i:t})(e)}function Pc(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function kc(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],y=t[15],v=i[0],x=i[1],b=i[2],w=i[3];return e[0]=v*n+x*a+b*h+w*m,e[1]=v*r+x*l+b*d+w*g,e[2]=v*s+x*c+b*p+w*_,e[3]=v*o+x*u+b*f+w*y,e[4]=(v=i[4])*n+(x=i[5])*a+(b=i[6])*h+(w=i[7])*m,e[5]=v*r+x*l+b*d+w*g,e[6]=v*s+x*c+b*p+w*_,e[7]=v*o+x*u+b*f+w*y,e[8]=(v=i[8])*n+(x=i[9])*a+(b=i[10])*h+(w=i[11])*m,e[9]=v*r+x*l+b*d+w*g,e[10]=v*s+x*c+b*p+w*_,e[11]=v*o+x*u+b*f+w*y,e[12]=(v=i[12])*n+(x=i[13])*a+(b=i[14])*h+(w=i[15])*m,e[13]=v*r+x*l+b*d+w*g,e[14]=v*s+x*c+b*p+w*_,e[15]=v*o+x*u+b*f+w*y,e}function Rc(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=n+n,l=r+r,c=s+s,u=n*a,h=n*l,d=n*c,p=r*l,f=r*c,m=s*c,g=o*a,_=o*l,y=o*c;return e[0]=1-(p+m),e[1]=h+y,e[2]=d-_,e[3]=0,e[4]=h-y,e[5]=1-(u+m),e[6]=f+g,e[7]=0,e[8]=d+_,e[9]=f-g,e[10]=1-(u+p),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Lc(e,t){var i=t[4],n=t[5],r=t[6],s=t[8],o=t[9],a=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(i,n,r),e[2]=Math.hypot(s,o,a),e}function Dc(e,t,i,n,r){var s,o=1/Math.tan(t/2);return e[0]=o/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+n)*(s=1/(n-r)),e[14]=2*r*n*s):(e[10]=-1,e[14]=-2*n),e}function Oc(e,t,i,n,r,s,o){var a=1/(t-i),l=1/(n-r),c=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(r+n)*l,e[14]=(o+s)*c,e[15]=1,e}function Nc(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}Mc.perspective=Dc,Mc.ortho=Oc,Mc.mul=kc,Mc.sub=Nc;var zc={},Fc={};function Bc(e){return Bc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bc(e)}Object.defineProperty(Fc,"__esModule",{value:!0}),Fc.create=jc,Fc.clone=function(e){var t=new Uc.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Fc.length=Gc,Fc.fromValues=function(e,t,i){var n=new Uc.ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=i,n},Fc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Fc.set=function(e,t,i,n){return e[0]=t,e[1]=i,e[2]=n,e},Fc.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},Fc.subtract=Hc,Fc.multiply=Wc,Fc.divide=qc,Fc.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},Fc.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},Fc.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},Fc.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},Fc.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},Fc.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},Fc.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e},Fc.distance=$c,Fc.squaredDistance=Zc,Fc.squaredLength=Xc,Fc.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},Fc.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},Fc.normalize=function(e,t){var i=t[0],n=t[1],r=t[2],s=i*i+n*n+r*r;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e},Fc.dot=Yc,Fc.cross=function(e,t,i){var n=t[0],r=t[1],s=t[2],o=i[0],a=i[1],l=i[2];return e[0]=r*l-s*a,e[1]=s*o-n*l,e[2]=n*a-r*o,e},Fc.lerp=function(e,t,i,n){var r=t[0],s=t[1],o=t[2];return e[0]=r+n*(i[0]-r),e[1]=s+n*(i[1]-s),e[2]=o+n*(i[2]-o),e},Fc.hermite=function(e,t,i,n,r,s){var o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),u=o*(3-2*s);return e[0]=t[0]*a+i[0]*l+n[0]*c+r[0]*u,e[1]=t[1]*a+i[1]*l+n[1]*c+r[1]*u,e[2]=t[2]*a+i[2]*l+n[2]*c+r[2]*u,e},Fc.bezier=function(e,t,i,n,r,s){var o=1-s,a=o*o,l=s*s,c=a*o,u=3*s*a,h=3*l*o,d=l*s;return e[0]=t[0]*c+i[0]*u+n[0]*h+r[0]*d,e[1]=t[1]*c+i[1]*u+n[1]*h+r[1]*d,e[2]=t[2]*c+i[2]*u+n[2]*h+r[2]*d,e},Fc.random=function(e,t){t=t||1;var i=2*Uc.RANDOM()*Math.PI,n=2*Uc.RANDOM()-1,r=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(i)*r,e[1]=Math.sin(i)*r,e[2]=n*t,e},Fc.transformMat4=function(e,t,i){var n=t[0],r=t[1],s=t[2],o=i[3]*n+i[7]*r+i[11]*s+i[15];return e[0]=(i[0]*n+i[4]*r+i[8]*s+i[12])/(o=o||1),e[1]=(i[1]*n+i[5]*r+i[9]*s+i[13])/o,e[2]=(i[2]*n+i[6]*r+i[10]*s+i[14])/o,e},Fc.transformMat3=function(e,t,i){var n=t[0],r=t[1],s=t[2];return e[0]=n*i[0]+r*i[3]+s*i[6],e[1]=n*i[1]+r*i[4]+s*i[7],e[2]=n*i[2]+r*i[5]+s*i[8],e},Fc.transformQuat=function(e,t,i){var n=i[0],r=i[1],s=i[2],o=t[0],a=t[1],l=t[2],c=r*l-s*a,u=s*o-n*l,h=n*a-r*o,d=r*h-s*u,p=s*c-n*h,f=n*u-r*c,m=2*i[3];return u*=m,h*=m,p*=2,f*=2,e[0]=o+(c*=m)+(d*=2),e[1]=a+u+p,e[2]=l+h+f,e},Fc.rotateX=function(e,t,i,n){var r=[],s=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],s[0]=r[0],s[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),s[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e},Fc.rotateY=function(e,t,i,n){var r=[],s=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],s[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),s[1]=r[1],s[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e},Fc.rotateZ=function(e,t,i,n){var r=[],s=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],s[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),s[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),s[2]=r[2],e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e},Fc.angle=function(e,t){var i=e[0],n=e[1],r=e[2],s=t[0],o=t[1],a=t[2],l=Math.sqrt(i*i+n*n+r*r)*Math.sqrt(s*s+o*o+a*a),c=l&&Yc(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))},Fc.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},Fc.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},Fc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},Fc.equals=function(e,t){var i=e[0],n=e[1],r=e[2],s=t[0],o=t[1],a=t[2];return Math.abs(i-s)<=Uc.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-o)<=Uc.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=Uc.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))},Fc.forEach=Fc.sqrLen=Fc.len=Fc.sqrDist=Fc.dist=Fc.div=Fc.mul=Fc.sub=void 0;var Uc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Bc(e)&&"function"!=typeof e)return{default:e};var i=Vc(void 0);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(nc);function Vc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(Vc=function(e){return e?i:t})(e)}function jc(){var e=new Uc.ARRAY_TYPE(3);return Uc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Gc(e){return Math.hypot(e[0],e[1],e[2])}function Hc(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function Wc(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function qc(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function $c(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function Zc(e,t){var i=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2];return i*i+n*n+r*r}function Xc(e){var t=e[0],i=e[1],n=e[2];return t*t+i*i+n*n}function Yc(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Fc.sub=Hc,Fc.mul=Wc,Fc.div=qc,Fc.dist=$c,Fc.sqrDist=Zc,Fc.len=Gc,Fc.sqrLen=Xc;var Kc,Jc=(Kc=jc(),function(e,t,i,n,r,s){var o,a;for(t||(t=3),i||(i=0),a=n?Math.min(n*t+i,e.length):e.length,o=i;o<a;o+=t)Kc[0]=e[o],Kc[1]=e[o+1],Kc[2]=e[o+2],r(Kc,Kc,s),e[o]=Kc[0],e[o+1]=Kc[1],e[o+2]=Kc[2];return e});Fc.forEach=Jc;var Qc={};function eu(e){return eu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},eu(e)}Object.defineProperty(Qc,"__esModule",{value:!0}),Qc.create=nu,Qc.clone=function(e){var t=new tu.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Qc.fromValues=function(e,t,i,n){var r=new tu.ARRAY_TYPE(4);return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r},Qc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Qc.set=function(e,t,i,n,r){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e},Qc.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},Qc.subtract=ru,Qc.multiply=su,Qc.divide=ou,Qc.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},Qc.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},Qc.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},Qc.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},Qc.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},Qc.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},Qc.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e},Qc.distance=au,Qc.squaredDistance=lu,Qc.length=cu,Qc.squaredLength=uu,Qc.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},Qc.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},Qc.normalize=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=i*i+n*n+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=i*o,e[1]=n*o,e[2]=r*o,e[3]=s*o,e},Qc.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Qc.cross=function(e,t,i,n){var r=i[0]*n[1]-i[1]*n[0],s=i[0]*n[2]-i[2]*n[0],o=i[0]*n[3]-i[3]*n[0],a=i[1]*n[2]-i[2]*n[1],l=i[1]*n[3]-i[3]*n[1],c=i[2]*n[3]-i[3]*n[2],u=t[0],h=t[1],d=t[2],p=t[3];return e[0]=h*c-d*l+p*a,e[1]=-u*c+d*o-p*s,e[2]=u*l-h*o+p*r,e[3]=-u*a+h*s-d*r,e},Qc.lerp=function(e,t,i,n){var r=t[0],s=t[1],o=t[2],a=t[3];return e[0]=r+n*(i[0]-r),e[1]=s+n*(i[1]-s),e[2]=o+n*(i[2]-o),e[3]=a+n*(i[3]-a),e},Qc.random=function(e,t){var i,n,r,s,o,a;t=t||1;do{o=(i=2*tu.RANDOM()-1)*i+(n=2*tu.RANDOM()-1)*n}while(o>=1);do{a=(r=2*tu.RANDOM()-1)*r+(s=2*tu.RANDOM()-1)*s}while(a>=1);var l=Math.sqrt((1-o)/a);return e[0]=t*i,e[1]=t*n,e[2]=t*r*l,e[3]=t*s*l,e},Qc.transformMat4=function(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3];return e[0]=i[0]*n+i[4]*r+i[8]*s+i[12]*o,e[1]=i[1]*n+i[5]*r+i[9]*s+i[13]*o,e[2]=i[2]*n+i[6]*r+i[10]*s+i[14]*o,e[3]=i[3]*n+i[7]*r+i[11]*s+i[15]*o,e},Qc.transformQuat=function(e,t,i){var n=t[0],r=t[1],s=t[2],o=i[0],a=i[1],l=i[2],c=i[3],u=c*n+a*s-l*r,h=c*r+l*n-o*s,d=c*s+o*r-a*n,p=-o*n-a*r-l*s;return e[0]=u*c+p*-o+h*-l-d*-a,e[1]=h*c+p*-a+d*-o-u*-l,e[2]=d*c+p*-l+u*-a-h*-o,e[3]=t[3],e},Qc.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},Qc.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Qc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Qc.equals=function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=tu.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=tu.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-l)<=tu.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-c)<=tu.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},Qc.forEach=Qc.sqrLen=Qc.len=Qc.sqrDist=Qc.dist=Qc.div=Qc.mul=Qc.sub=void 0;var tu=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==eu(e)&&"function"!=typeof e)return{default:e};var i=iu(void 0);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(nc);function iu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(iu=function(e){return e?i:t})(e)}function nu(){var e=new tu.ARRAY_TYPE(4);return tu.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function ru(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function su(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function ou(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function au(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function lu(e,t){var i=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2],s=t[3]-e[3];return i*i+n*n+r*r+s*s}function cu(e){return Math.hypot(e[0],e[1],e[2],e[3])}function uu(e){var t=e[0],i=e[1],n=e[2],r=e[3];return t*t+i*i+n*n+r*r}Qc.sub=ru,Qc.mul=su,Qc.div=ou,Qc.dist=au,Qc.sqrDist=lu,Qc.len=cu,Qc.sqrLen=uu;var hu=function(){var e=nu();return function(t,i,n,r,s,o){var a,l;for(i||(i=4),n||(n=0),l=r?Math.min(r*i+n,t.length):t.length,a=n;a<l;a+=i)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],s(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();function du(e){return du="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},du(e)}Qc.forEach=hu,Object.defineProperty(zc,"__esModule",{value:!0}),zc.create=vu,zc.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},zc.setAxisAngle=xu,zc.getAxisAngle=function(e,t){var i=2*Math.acos(t[3]),n=Math.sin(i/2);return n>pu.EPSILON?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),i},zc.getAngle=function(e,t){var i=Iu(e,t);return Math.acos(2*i*i-1)},zc.multiply=bu,zc.rotateX=function(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=n*l+o*a,e[1]=r*l+s*a,e[2]=s*l-r*a,e[3]=o*l-n*a,e},zc.rotateY=function(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=n*l-s*a,e[1]=r*l+o*a,e[2]=s*l+n*a,e[3]=o*l-r*a,e},zc.rotateZ=function(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=n*l+r*a,e[1]=r*l-n*a,e[2]=s*l+o*a,e[3]=o*l-s*a,e},zc.calculateW=function(e,t){var i=t[0],n=t[1],r=t[2];return e[0]=i,e[1]=n,e[2]=r,e[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r)),e},zc.exp=wu,zc.ln=Su,zc.pow=function(e,t,i){return Su(e,t),Mu(e,e,i),wu(e,e),e},zc.slerp=Tu,zc.random=function(e){var t=pu.RANDOM(),i=pu.RANDOM(),n=pu.RANDOM(),r=Math.sqrt(1-t),s=Math.sqrt(t);return e[0]=r*Math.sin(2*Math.PI*i),e[1]=r*Math.cos(2*Math.PI*i),e[2]=s*Math.sin(2*Math.PI*n),e[3]=s*Math.cos(2*Math.PI*n),e},zc.invert=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=i*i+n*n+r*r+s*s,a=o?1/o:0;return e[0]=-i*a,e[1]=-n*a,e[2]=-r*a,e[3]=s*a,e},zc.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},zc.fromMat3=Eu,zc.fromEuler=function(e,t,i,n){var r=.5*Math.PI/180;t*=r,i*=r,n*=r;var s=Math.sin(t),o=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(n),u=Math.cos(n);return e[0]=s*l*u-o*a*c,e[1]=o*a*u+s*l*c,e[2]=o*l*c-s*a*u,e[3]=o*l*u+s*a*c,e},zc.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},zc.setAxes=zc.sqlerp=zc.rotationTo=zc.equals=zc.exactEquals=zc.normalize=zc.sqrLen=zc.squaredLength=zc.len=zc.length=zc.lerp=zc.dot=zc.scale=zc.mul=zc.add=zc.set=zc.copy=zc.fromValues=zc.clone=void 0;var pu=yu(nc),fu=yu(xc),mu=yu(Fc),gu=yu(Qc);function _u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(_u=function(e){return e?i:t})(e)}function yu(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==du(e)&&"function"!=typeof e)return{default:e};var i=_u(t);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}function vu(){var e=new pu.ARRAY_TYPE(4);return pu.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function xu(e,t,i){i*=.5;var n=Math.sin(i);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(i),e}function bu(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=i[0],l=i[1],c=i[2],u=i[3];return e[0]=n*u+o*a+r*c-s*l,e[1]=r*u+o*l+s*a-n*c,e[2]=s*u+o*c+n*l-r*a,e[3]=o*u-n*a-r*l-s*c,e}function wu(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=Math.sqrt(i*i+n*n+r*r),a=Math.exp(s),l=o>0?a*Math.sin(o)/o:0;return e[0]=i*l,e[1]=n*l,e[2]=r*l,e[3]=a*Math.cos(o),e}function Su(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=Math.sqrt(i*i+n*n+r*r),a=o>0?Math.atan2(o,s)/o:0;return e[0]=i*a,e[1]=n*a,e[2]=r*a,e[3]=.5*Math.log(i*i+n*n+r*r+s*s),e}function Tu(e,t,i,n){var r,s,o,a,l,c=t[0],u=t[1],h=t[2],d=t[3],p=i[0],f=i[1],m=i[2],g=i[3];return(s=c*p+u*f+h*m+d*g)<0&&(s=-s,p=-p,f=-f,m=-m,g=-g),1-s>pu.EPSILON?(r=Math.acos(s),o=Math.sin(r),a=Math.sin((1-n)*r)/o,l=Math.sin(n*r)/o):(a=1-n,l=n),e[0]=a*c+l*p,e[1]=a*u+l*f,e[2]=a*h+l*m,e[3]=a*d+l*g,e}function Eu(e,t){var i,n=t[0]+t[4]+t[8];if(n>0)i=Math.sqrt(n+1),e[3]=.5*i,e[0]=(t[5]-t[7])*(i=.5/i),e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var s=(r+1)%3,o=(r+2)%3;i=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*o+o]+1),e[r]=.5*i,e[3]=(t[3*s+o]-t[3*o+s])*(i=.5/i),e[s]=(t[3*s+r]+t[3*r+s])*i,e[o]=(t[3*o+r]+t[3*r+o])*i}return e}zc.clone=gu.clone,zc.fromValues=gu.fromValues,zc.copy=gu.copy,zc.set=gu.set,zc.add=gu.add,zc.mul=bu;var Mu=gu.scale;zc.scale=Mu;var Iu=gu.dot;zc.dot=Iu,zc.lerp=gu.lerp;var Au=gu.length;zc.length=Au,zc.len=Au;var Cu=gu.squaredLength;zc.squaredLength=Cu,zc.sqrLen=Cu;var Pu=gu.normalize;zc.normalize=Pu,zc.exactEquals=gu.exactEquals,zc.equals=gu.equals;var ku,Ru,Lu,Du=(ku=mu.create(),Ru=mu.fromValues(1,0,0),Lu=mu.fromValues(0,1,0),function(e,t,i){var n=mu.dot(t,i);return n<-.999999?(mu.cross(ku,Ru,t),mu.len(ku)<1e-6&&mu.cross(ku,Lu,t),mu.normalize(ku,ku),xu(e,ku,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(mu.cross(ku,t,i),e[0]=ku[0],e[1]=ku[1],e[2]=ku[2],e[3]=1+n,Pu(e,e))});zc.rotationTo=Du;var Ou,Nu,zu=(Ou=vu(),Nu=vu(),function(e,t,i,n,r,s){return Tu(Ou,t,r,s),Tu(Nu,i,n,s),Tu(e,Ou,Nu,2*s*(1-s)),e});zc.sqlerp=zu;var Fu,Bu=(Fu=fu.create(),function(e,t,i,n){return Fu[0]=i[0],Fu[3]=i[1],Fu[6]=i[2],Fu[1]=n[0],Fu[4]=n[1],Fu[7]=n[2],Fu[2]=-t[0],Fu[5]=-t[1],Fu[8]=-t[2],Pu(e,Eu(e,Fu))});zc.setAxes=Bu;var Uu={};function Vu(e){return Vu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vu(e)}Object.defineProperty(Uu,"__esModule",{value:!0}),Uu.create=function(){var e=new ju.ARRAY_TYPE(8);return ju.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},Uu.clone=function(e){var t=new ju.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},Uu.fromValues=function(e,t,i,n,r,s,o,a){var l=new ju.ARRAY_TYPE(8);return l[0]=e,l[1]=t,l[2]=i,l[3]=n,l[4]=r,l[5]=s,l[6]=o,l[7]=a,l},Uu.fromRotationTranslationValues=function(e,t,i,n,r,s,o){var a=new ju.ARRAY_TYPE(8);a[0]=e,a[1]=t,a[2]=i,a[3]=n;var l=.5*r,c=.5*s,u=.5*o;return a[4]=l*n+c*i-u*t,a[5]=c*n+u*e-l*i,a[6]=u*n+l*t-c*e,a[7]=-l*e-c*t-u*i,a},Uu.fromRotationTranslation=$u,Uu.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},Uu.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Uu.fromMat4=function(e,t){var i=Gu.create();Hu.getRotation(i,t);var n=new ju.ARRAY_TYPE(3);return Hu.getTranslation(n,t),$u(e,i,n),e},Uu.copy=Zu,Uu.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Uu.set=function(e,t,i,n,r,s,o,a,l){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e},Uu.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},Uu.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},Uu.getTranslation=function(e,t){var i=t[4],n=t[5],r=t[6],s=t[7],o=-t[0],a=-t[1],l=-t[2],c=t[3];return e[0]=2*(i*c+s*o+n*l-r*a),e[1]=2*(n*c+s*a+r*o-i*l),e[2]=2*(r*c+s*l+i*a-n*o),e},Uu.translate=function(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=.5*i[0],l=.5*i[1],c=.5*i[2],u=t[4],h=t[5],d=t[6],p=t[7];return e[0]=n,e[1]=r,e[2]=s,e[3]=o,e[4]=o*a+r*c-s*l+u,e[5]=o*l+s*a-n*c+h,e[6]=o*c+n*l-r*a+d,e[7]=-n*a-r*l-s*c+p,e},Uu.rotateX=function(e,t,i){var n=-t[0],r=-t[1],s=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*o+u*n+l*s-c*r,d=l*o+u*r+c*n-a*s,p=c*o+u*s+a*r-l*n,f=u*o-a*n-l*r-c*s;return Gu.rotateX(e,t,i),e[4]=h*(o=e[3])+f*(n=e[0])+d*(s=e[2])-p*(r=e[1]),e[5]=d*o+f*r+p*n-h*s,e[6]=p*o+f*s+h*r-d*n,e[7]=f*o-h*n-d*r-p*s,e},Uu.rotateY=function(e,t,i){var n=-t[0],r=-t[1],s=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*o+u*n+l*s-c*r,d=l*o+u*r+c*n-a*s,p=c*o+u*s+a*r-l*n,f=u*o-a*n-l*r-c*s;return Gu.rotateY(e,t,i),e[4]=h*(o=e[3])+f*(n=e[0])+d*(s=e[2])-p*(r=e[1]),e[5]=d*o+f*r+p*n-h*s,e[6]=p*o+f*s+h*r-d*n,e[7]=f*o-h*n-d*r-p*s,e},Uu.rotateZ=function(e,t,i){var n=-t[0],r=-t[1],s=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*o+u*n+l*s-c*r,d=l*o+u*r+c*n-a*s,p=c*o+u*s+a*r-l*n,f=u*o-a*n-l*r-c*s;return Gu.rotateZ(e,t,i),e[4]=h*(o=e[3])+f*(n=e[0])+d*(s=e[2])-p*(r=e[1]),e[5]=d*o+f*r+p*n-h*s,e[6]=p*o+f*s+h*r-d*n,e[7]=f*o-h*n-d*r-p*s,e},Uu.rotateByQuatAppend=function(e,t,i){var n=i[0],r=i[1],s=i[2],o=i[3],a=t[0],l=t[1],c=t[2],u=t[3];return e[0]=a*o+u*n+l*s-c*r,e[1]=l*o+u*r+c*n-a*s,e[2]=c*o+u*s+a*r-l*n,e[3]=u*o-a*n-l*r-c*s,e[4]=(a=t[4])*o+(u=t[7])*n+(l=t[5])*s-(c=t[6])*r,e[5]=l*o+u*r+c*n-a*s,e[6]=c*o+u*s+a*r-l*n,e[7]=u*o-a*n-l*r-c*s,e},Uu.rotateByQuatPrepend=function(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=i[0],l=i[1],c=i[2],u=i[3];return e[0]=n*u+o*a+r*c-s*l,e[1]=r*u+o*l+s*a-n*c,e[2]=s*u+o*c+n*l-r*a,e[3]=o*u-n*a-r*l-s*c,e[4]=n*(u=i[7])+o*(a=i[4])+r*(c=i[6])-s*(l=i[5]),e[5]=r*u+o*l+s*a-n*c,e[6]=s*u+o*c+n*l-r*a,e[7]=o*u-n*a-r*l-s*c,e},Uu.rotateAroundAxis=function(e,t,i,n){if(Math.abs(n)<ju.EPSILON)return Zu(e,t);var r=Math.hypot(i[0],i[1],i[2]);n*=.5;var s=Math.sin(n),o=s*i[0]/r,a=s*i[1]/r,l=s*i[2]/r,c=Math.cos(n),u=t[0],h=t[1],d=t[2],p=t[3];e[0]=u*c+p*o+h*l-d*a,e[1]=h*c+p*a+d*o-u*l,e[2]=d*c+p*l+u*a-h*o,e[3]=p*c-u*o-h*a-d*l;var f=t[4],m=t[5],g=t[6],_=t[7];return e[4]=f*c+_*o+m*l-g*a,e[5]=m*c+_*a+g*o-f*l,e[6]=g*c+_*l+f*a-m*o,e[7]=_*c-f*o-m*a-g*l,e},Uu.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e},Uu.multiply=Xu,Uu.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e},Uu.lerp=function(e,t,i,n){var r=1-n;return Yu(t,i)<0&&(n=-n),e[0]=t[0]*r+i[0]*n,e[1]=t[1]*r+i[1]*n,e[2]=t[2]*r+i[2]*n,e[3]=t[3]*r+i[3]*n,e[4]=t[4]*r+i[4]*n,e[5]=t[5]*r+i[5]*n,e[6]=t[6]*r+i[6]*n,e[7]=t[7]*r+i[7]*n,e},Uu.invert=function(e,t){var i=Ju(t);return e[0]=-t[0]/i,e[1]=-t[1]/i,e[2]=-t[2]/i,e[3]=t[3]/i,e[4]=-t[4]/i,e[5]=-t[5]/i,e[6]=-t[6]/i,e[7]=t[7]/i,e},Uu.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},Uu.normalize=function(e,t){var i=Ju(t);if(i>0){i=Math.sqrt(i);var n=t[0]/i,r=t[1]/i,s=t[2]/i,o=t[3]/i,a=t[4],l=t[5],c=t[6],u=t[7],h=n*a+r*l+s*c+o*u;e[0]=n,e[1]=r,e[2]=s,e[3]=o,e[4]=(a-n*h)/i,e[5]=(l-r*h)/i,e[6]=(c-s*h)/i,e[7]=(u-o*h)/i}return e},Uu.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},Uu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},Uu.equals=function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=t[0],h=t[1],d=t[2],p=t[3],f=t[4],m=t[5],g=t[6],_=t[7];return Math.abs(i-u)<=ju.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-h)<=ju.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-d)<=ju.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(s-p)<=ju.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(o-f)<=ju.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=ju.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-g)<=ju.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-_)<=ju.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))},Uu.sqrLen=Uu.squaredLength=Uu.len=Uu.length=Uu.dot=Uu.mul=Uu.setReal=Uu.getReal=void 0;var ju=qu(nc),Gu=qu(zc),Hu=qu(Mc);function Wu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(Wu=function(e){return e?i:t})(e)}function qu(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==Vu(e)&&"function"!=typeof e)return{default:e};var i=Wu(t);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}function $u(e,t,i){var n=.5*i[0],r=.5*i[1],s=.5*i[2],o=t[0],a=t[1],l=t[2],c=t[3];return e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=n*c+r*l-s*a,e[5]=r*c+s*o-n*l,e[6]=s*c+n*a-r*o,e[7]=-n*o-r*a-s*l,e}function Zu(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Xu(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=i[4],l=i[5],c=i[6],u=i[7],h=t[4],d=t[5],p=t[6],f=t[7],m=i[0],g=i[1],_=i[2],y=i[3];return e[0]=n*y+o*m+r*_-s*g,e[1]=r*y+o*g+s*m-n*_,e[2]=s*y+o*_+n*g-r*m,e[3]=o*y-n*m-r*g-s*_,e[4]=n*u+o*a+r*c-s*l+h*y+f*m+d*_-p*g,e[5]=r*u+o*l+s*a-n*c+d*y+f*g+p*m-h*_,e[6]=s*u+o*c+n*l-r*a+p*y+f*_+h*g-d*m,e[7]=o*u-n*a-r*l-s*c+f*y-h*m-d*g-p*_,e}Uu.getReal=Gu.copy,Uu.setReal=Gu.copy,Uu.mul=Xu;var Yu=Gu.dot;Uu.dot=Yu;var Ku=Gu.length;Uu.length=Ku,Uu.len=Ku;var Ju=Gu.squaredLength;Uu.squaredLength=Ju,Uu.sqrLen=Ju;var Qu={};function eh(e){return eh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},eh(e)}Object.defineProperty(Qu,"__esModule",{value:!0}),Qu.create=nh,Qu.clone=function(e){var t=new th.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},Qu.fromValues=function(e,t){var i=new th.ARRAY_TYPE(2);return i[0]=e,i[1]=t,i},Qu.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},Qu.set=function(e,t,i){return e[0]=t,e[1]=i,e},Qu.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},Qu.subtract=rh,Qu.multiply=sh,Qu.divide=oh,Qu.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},Qu.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},Qu.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},Qu.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},Qu.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},Qu.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},Qu.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e},Qu.distance=ah,Qu.squaredDistance=lh,Qu.length=ch,Qu.squaredLength=uh,Qu.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},Qu.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},Qu.normalize=function(e,t){var i=t[0],n=t[1],r=i*i+n*n;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e},Qu.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},Qu.cross=function(e,t,i){var n=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=n,e},Qu.lerp=function(e,t,i,n){var r=t[0],s=t[1];return e[0]=r+n*(i[0]-r),e[1]=s+n*(i[1]-s),e},Qu.random=function(e,t){t=t||1;var i=2*th.RANDOM()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},Qu.transformMat2=function(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e},Qu.transformMat2d=function(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r+i[4],e[1]=i[1]*n+i[3]*r+i[5],e},Qu.transformMat3=function(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[3]*r+i[6],e[1]=i[1]*n+i[4]*r+i[7],e},Qu.transformMat4=function(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[4]*r+i[12],e[1]=i[1]*n+i[5]*r+i[13],e},Qu.rotate=function(e,t,i,n){var r=t[0]-i[0],s=t[1]-i[1],o=Math.sin(n),a=Math.cos(n);return e[0]=r*a-s*o+i[0],e[1]=r*o+s*a+i[1],e},Qu.angle=function(e,t){var i=e[0],n=e[1],r=t[0],s=t[1],o=Math.sqrt(i*i+n*n)*Math.sqrt(r*r+s*s);return Math.acos(Math.min(Math.max(o&&(i*r+n*s)/o,-1),1))},Qu.zero=function(e){return e[0]=0,e[1]=0,e},Qu.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},Qu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Qu.equals=function(e,t){var i=e[0],n=e[1],r=t[0],s=t[1];return Math.abs(i-r)<=th.EPSILON*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(n-s)<=th.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},Qu.forEach=Qu.sqrLen=Qu.sqrDist=Qu.dist=Qu.div=Qu.mul=Qu.sub=Qu.len=void 0;var th=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==eh(e)&&"function"!=typeof e)return{default:e};var i=ih(void 0);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(nc);function ih(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(ih=function(e){return e?i:t})(e)}function nh(){var e=new th.ARRAY_TYPE(2);return th.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function rh(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function sh(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function oh(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function ah(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function lh(e,t){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function ch(e){return Math.hypot(e[0],e[1])}function uh(e){var t=e[0],i=e[1];return t*t+i*i}Qu.len=ch,Qu.sub=rh,Qu.mul=sh,Qu.div=oh,Qu.dist=ah,Qu.sqrDist=lh,Qu.sqrLen=uh;var hh=function(){var e=nh();return function(t,i,n,r,s,o){var a,l;for(i||(i=2),n||(n=0),l=r?Math.min(r*i+n,t.length):t.length,a=n;a<l;a+=i)e[0]=t[a],e[1]=t[a+1],s(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}}();function dh(e){return dh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dh(e)}Qu.forEach=hh,Object.defineProperty(ic,"__esModule",{value:!0}),e.a7=ic.vec4=e.N=ic.vec3=ic.vec2=ic.quat2=e.bi=ic.quat=e.a6=ic.mat4=e.co=ic.mat3=ic.mat2d=e.b4=ic.mat2=ic.glMatrix=void 0;var ph=Th(nc);ic.glMatrix=ph;var fh=Th(lc);e.b4=ic.mat2=fh;var mh=Th(fc);ic.mat2d=mh;var gh=Th(xc);e.co=ic.mat3=gh;var _h=Th(Mc);e.a6=ic.mat4=_h;var yh=Th(zc);e.bi=ic.quat=yh;var vh=Th(Uu);ic.quat2=vh;var xh=Th(Qu);ic.vec2=xh;var bh=Th(Fc);e.N=ic.vec3=bh;var wh=Th(Qc);function Sh(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(Sh=function(e){return e?i:t})(e)}function Th(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==dh(e)&&"function"!=typeof e)return{default:e};var i=Sh(t);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}e.a7=ic.vec4=wh;class Eh{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(t,i,n){const r=e.N.dot(i,this.dir);if(Math.abs(r)<1e-6)return!1;const s=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/r;return n[0]=this.pos[0]+this.dir[0]*s,n[1]=this.pos[1]+this.dir[1]*s,n[2]=this.pos[2]+this.dir[2]*s,!0}closestPointOnSphere(t,i,n){if(e.N.equals(this.pos,t)||0===i)return n[0]=n[1]=n[2]=0,!1;const[r,s,o]=this.dir,a=this.pos[0]-t[0],l=this.pos[1]-t[1],c=this.pos[2]-t[2],u=r*r+s*s+o*o,h=2*(a*r+l*s+c*o),d=h*h-4*u*(a*a+l*l+c*c-i*i);if(d<0){const e=Math.max(-h/2,0),t=a+r*e,u=l+s*e,d=c+o*e,p=Math.hypot(t,u,d);return n[0]=t*i/p,n[1]=u*i/p,n[2]=d*i/p,!1}{const e=(-h-Math.sqrt(d))/(2*u);if(e<0){const e=Math.hypot(a,l,c);return n[0]=a*i/e,n[1]=l*i/e,n[2]=c*i/e,!1}return n[0]=a+r*e,n[1]=l+s*e,n[2]=c+o*e,!0}}}class Mh{constructor(e,t,i,n,r){this.TL=e,this.TR=t,this.BR=i,this.BL=n,this.horizon=r}static fromInvProjectionMatrix(t,i,n){const r=[-1,1,1],s=[1,1,1],o=[1,-1,1],a=[-1,-1,1],l=e.N.transformMat4(r,r,t),c=e.N.transformMat4(s,s,t),u=e.N.transformMat4(o,o,t),h=e.N.transformMat4(a,a,t);return new Mh(l,c,u,h,i/n)}}function Ih(t,i,n){let r=1/0,s=-1/0;const o=[];for(const a of t){e.N.sub(o,a,i);const t=e.N.dot(o,n);r=Math.min(r,t),s=Math.max(s,t)}return[r,s]}function Ah(t,i){let n=!0;for(let r=0;r<t.planes.length;r++){const s=t.planes[r];let o=0;for(let t=0;t<i.length;t++)o+=e.N.dot(s,i[t])+s[3]>=0;if(0===o)return 0;o!==i.length&&(n=!1)}return n?2:1}function Ch(e,t){for(const i of e.projections){const n=Ih(t,e.points[0],i.axis);if(i.projection[1]<n[0]||i.projection[0]>n[1])return 0}return 1}function Ph(t,i){let n=0;const r=[0,0,0,0];for(let s=0;s<t.length;s++)r[0]=t[s][0],r[1]=t[s][1],r[2]=t[s][2],r[3]=1,e.a7.dot(r,i)>=0&&n++;return n}class kh{constructor(t,i){this.points=t||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Rh.fromPoints(this.points),this.projections=[],this.frustumEdges=[e.N.sub([],this.points[2],this.points[3]),e.N.sub([],this.points[0],this.points[3]),e.N.sub([],this.points[4],this.points[0]),e.N.sub([],this.points[5],this.points[1]),e.N.sub([],this.points[6],this.points[2]),e.N.sub([],this.points[7],this.points[3])];for(const e of this.frustumEdges){const t=[0,-e[2],e[1]],i=[e[2],0,-e[0]];this.projections.push({axis:t,projection:Ih(this.points,this.points[0],t)}),this.projections.push({axis:i,projection:Ih(this.points,this.points[0],i)})}}static fromInvProjectionMatrix(t,i,n,r){const s=Math.pow(2,n),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((n=>{const o=e.a7.transformMat4([],n,t),a=1/o[3]/i*s;return e.a7.mul(o,o,[a,a,r?1/o[3]:a,a])})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const i=e.N.sub([],o[t[0]],o[t[1]]),n=e.N.sub([],o[t[2]],o[t[1]]),r=e.N.normalize([],e.N.cross([],i,n)),s=-e.N.dot(r,o[t[1]]);return r.concat(s)})),l=[];for(let e=0;e<o.length;e++)l.push([o[e][0],o[e][1],o[e][2]]);return new kh(l,a)}intersectsPrecise(t,i,n){for(let e=0;e<i.length;e++)if(!Ph(t,i[e]))return 0;for(let e=0;e<this.planes.length;e++)if(!Ph(t,this.planes[e]))return 0;for(const i of n)for(const n of this.frustumEdges){const r=e.N.cross([],i,n),s=e.N.length(r);if(0===s)continue;e.N.scale(r,r,1/s);const o=Ih(this.points,this.points[0],r),a=Ih(t,this.points[0],r);if(o[0]>a[1]||a[0]>o[1])return 0}return 1}}class Rh{static fromPoints(t){const i=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const r of t)e.N.min(i,i,r),e.N.max(n,n,r);return new Rh(i,n)}static fromTileIdAndHeight(e,t,i){const n=1<<e.canonical.z,r=e.canonical.x,s=e.canonical.y;return new Rh([r/n,s/n,t],[(r+1)/n,(s+1)/n,i])}static applyTransform(t,i){const n=t.getCorners();for(let t=0;t<n.length;++t)e.N.transformMat4(n[t],n[t],i);return Rh.fromPoints(n)}static projectAabbCorners(t,i){const n=t.getCorners();for(let t=0;t<n.length;++t)e.N.transformMat4(n[t],n[t],i);return n}constructor(t,i){this.min=t,this.max=i,this.center=e.N.scale([],e.N.add([],this.min,this.max),.5)}quadrant(t){const i=[t%2==0,t<2],n=e.N.clone(this.min),r=e.N.clone(this.max);for(let e=0;e<i.length;e++)n[e]=i[e]?this.min[e]:this.center[e],r[e]=i[e]?this.center[e]:this.max[e];return r[2]=this.max[2],new Rh(n,r)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Ah(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Ah(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?Ch(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?Ch(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}is(Rh,"Aabb");const Lh=uo([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Dh}=Lh,Oh=uo([{name:"a_pos_3",components:3,type:"Int16"}]);var Nh=uo([{name:"a_pos",type:"Int16",components:2}]);function zh(e){return e*ja/Ja}const Fh=[new Rh([Za,Za,Za],[Xa,Xa,Xa]),new Rh([Za,Za,Za],[0,0,Xa]),new Rh([0,Za,Za],[Xa,0,Xa]),new Rh([Za,0,Za],[0,Xa,Xa]),new Rh([0,0,Za],[Xa,Xa,Xa])];function Bh(t,i,n,r=!0){const s=e.N.scale([],t._camera.position,t.worldSize),o=[i,n,1,1];e.a7.transformMat4(o,o,t.pixelMatrixInverse),e.a7.scale(o,o,1/o[3]);const a=e.N.sub([],o,s),l=e.N.normalize([],a),c=t.globeMatrix,u=[c[12],c[13],c[14]],h=e.N.sub([],u,s),d=e.N.length(h),p=e.N.normalize([],h),f=t.worldSize/(2*Math.PI),m=e.N.dot(p,l),g=Math.asin(f/d);if(g<Math.acos(m)){if(!r)return null;const t=[],i=[];e.N.scale(t,l,d/m),e.N.normalize(i,e.N.sub(i,t,h)),e.N.normalize(l,e.N.add(l,h,e.N.scale(l,i,Math.tan(g)*d)))}const _=[];new Eh(s,l).closestPointOnSphere(u,f,_);const y=e.N.normalize([],ie(c,0)),v=e.N.normalize([],ie(c,1)),x=e.N.normalize([],ie(c,2)),w=e.N.dot(y,_),S=e.N.dot(v,_),T=e.N.dot(x,_),E=b(Math.asin(-S/f));let I=b(Math.atan2(w,T));I=t.center.lng+function(e,t){const i=(t-e+180)%360-180;return i<-180?i+360:i}(t.center.lng,I);const A=dl(I),C=M(pl(E),0,1);return new Sl(A,C)}class Uh{constructor(t,i,n){this.a=e.N.sub([],t,n),this.b=e.N.sub([],i,n),this.center=n;const r=e.N.normalize([],this.a),s=e.N.normalize([],this.b);this.angle=Math.acos(e.N.dot(r,s))}}function Vh(e,t){if(0===e.angle)return null;let i;return i=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(e,t,i,n){const r=Math.sin(i);return e*(Math.sin((1-n)*i)/r)+t*(Math.sin(n*i)/r)}(e.a[t],e.b[t],e.angle,M(i,0,1))+e.center[t]}function jh(e){if(e.z<=1)return Fh[e.z+2*e.y+e.x];const t=$h(qh(e));return Rh.fromPoints(t)}function Gh(t,i,n){return e.N.scale(t,t,1-n),e.N.scaleAndAdd(t,t,i,n)}function Hh(t,i,n){for(const r of t)e.N.transformMat4(r,r,i),e.N.scale(r,r,n)}function Wh(t,i,n,r){const s=i/t.worldSize,o=t.globeMatrix;if(n.z<=1){const e=jh(n).getCorners();return Hh(e,o,s),Rh.fromPoints(e)}const a=qh(n,r),l=$h(a,ja+zh(t._tileCoverLift));Hh(l,o,s);const c=Number.MAX_VALUE,u=[-c,-c,-c],h=[c,c,c];if(a.contains(t.center)){for(const t of l)e.N.min(h,h,t),e.N.max(u,u,t);u[2]=0;const i=t.point,n=[i.x*s,i.y*s,0];return e.N.min(h,h,n),e.N.max(u,u,n),new Rh(h,u)}if(t._tileCoverLift>0){for(const t of l)e.N.min(h,h,t),e.N.max(u,u,t);return new Rh(h,u)}const d=[o[12]*s,o[13]*s,o[14]*s],p=a.getCenter(),f=M(t.center.lat,-yl,yl),m=M(p.lat,-yl,yl),g=dl(t.center.lng),_=pl(f);let y=g-dl(p.lng);const v=_-pl(m);y>.5?y-=1:y<-.5&&(y+=1);let b=0;if(Math.abs(y)>Math.abs(v))b=y>=0?1:3;else{b=v>=0?0:2;const t=[o[4]*s,o[5]*s,o[6]*s],i=-Math.sin(x(v>=0?a.getSouth():a.getNorth()))*ja;e.N.scaleAndAdd(d,d,t,i)}const w=l[b],S=l[(b+1)%4],T=new Uh(w,S,d),E=[Vh(T,0)||w[0],Vh(T,1)||w[1],Vh(T,2)||w[2]],I=id(t.zoom);if(I>0){const r=function({x:e,y:t,z:i},n,r,s,o){const a=1/(1<<i);let l=e*a,c=l+a,u=t*a,h=u+a,d=0;const p=(l+c)/2-s;return p>.5?d=-1:p<-.5&&(d=1),l=((l+d)*n-(s*=n))*r+s,c=((c+d)*n-s)*r+s,u=(u*n-(o*=n))*r+o,h=(h*n-o)*r+o,[[l,h,0],[c,h,0],[c,u,0],[l,u,0]]}(n,i,t._pixelsPerMercatorPixel,g,_);for(let e=0;e<l.length;e++)Gh(l[e],r[e],I);const s=e.N.add([],r[b],r[(b+1)%4]);e.N.scale(s,s,.5),Gh(E,s,I)}for(const t of l)e.N.min(h,h,t),e.N.max(u,u,t);return h[2]=Math.min(w[2],S[2]),e.N.min(h,h,E),e.N.max(u,u,E),new Rh(h,u)}function qh({x:e,y:t,z:i},n=!1){const r=1/(1<<i),s=new el(ml(e*r),t===(1<<i)-1&&n?-90:gl((t+1)*r)),o=new el(ml((e+1)*r),0===t&&n?90:gl(t*r));return new tl(s,o)}function $h(e,t=ja){const i=x(e.getNorth()),n=x(e.getSouth()),r=Math.cos(i),s=Math.cos(n),o=Math.sin(i),a=Math.sin(n),l=e.getWest(),c=e.getEast();return[Ya(s,a,l,t),Ya(s,a,c,t),Ya(r,o,c,t),Ya(r,o,l,t)]}function Zh(e,t,i,n){const r=1<<i.z,s=(e/ki+i.x)/r;return Ka(gl((t/ki+i.y)/r),ml(s),n)}function Xh({min:e,max:t}){return Wa/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const Yh=new Float64Array(16);function Kh(t){const i=Xh(t),n=e.a6.fromScaling(Yh,[i,i,i]);return e.a6.translate(n,n,e.N.negate([],t.min))}function Jh(t){const i=e.a6.fromTranslation(Yh,t.min),n=1/Xh(t);return e.a6.scale(i,i,[n,n,n])}function Qh(e){const t=ki/(2*Math.PI);return e/(2*Math.PI)/t}function ed(e,t){return ki/(512*Math.pow(2,e))*Xh(jh(t))}function td(t,i,n,r,s){const o=Qh(n),a=[t,i,-n/(2*Math.PI)],l=e.a6.identity(new Float64Array(16));return e.a6.translate(l,l,a),e.a6.scale(l,l,[o,o,o]),e.a6.rotateX(l,l,x(-s)),e.a6.rotateY(l,l,x(-r)),l}function id(e){return I(Ga,Ha,e)}function nd(t,i){const n=Ka(i.lat,i.lng),r=function(t){const i=Ka(t._center.lat,t._center.lng),n=e.N.fromValues(0,1,0);let r=e.N.cross([],n,i);const s=e.a6.fromRotation([],-t.angle,i);r=e.N.transformMat4(r,r,s),e.a6.fromRotation(s,-t._pitch,r);const o=e.N.normalize([],i);return e.N.scale(o,o,zh(t.cameraToCenterDistance/t.pixelsPerMeter)),e.N.transformMat4(o,o,s),e.N.add([],i,o)}(t),s=e.N.subtract([],r,n);return e.N.angle(s,n)}function rd(e,t){return nd(e,t)>Math.PI/2*1.01}const sd=x(85),od=Math.cos(sd),ad=Math.sin(sd),ld=e.a6.create(),cd=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function ud(t,i,n,r,s,o,a,l,c){if(o&&t.queryGeometry.isAboveHorizon)return!1;o&&(c*=t.pixelToTileUnitsFactor);const u=t.tileID.canonical,h=n.projection.upVectorScale(u,n.center.lat,n.worldSize).metersToTile;for(const d of i)for(const i of d){const d=i.add(l),p=s&&n.elevation?n.elevation.exaggeration()*s.getElevationAt(d.x,d.y,!0):0,f=n.projection.projectTilePoint(d.x,d.y,u);if(p>0){const e=n.projection.upVector(u,d.x,d.y);f.x+=e[0]*h*p,f.y+=e[1]*h*p,f.z+=e[2]*h*p}const m=o?d:hd(f.x,f.y,f.z,r),g=o?t.tilespaceRays.map((e=>fd(e,p))):t.queryGeometry.screenGeometry,_=e.a7.transformMat4([],[f.x,f.y,f.z,1],r);if(!a&&o?c*=_[3]/n.cameraToCenterDistance:a&&!o&&(c*=n.cameraToCenterDistance/_[3]),o){const e=gl((i.y/ki+u.y)/(1<<u.z));c/=n.projection.pixelsPerMeter(e,1)/fl(1,e)}if(zl(g,m,c))return!0}return!1}function hd(t,i,n,r){const s=e.a7.transformMat4([],[t,i,n,1],r);return new _(s[0]/s[3],s[1]/s[3])}const dd=e.N.fromValues(0,0,0),pd=e.N.fromValues(0,0,1);function fd(t,i){const n=e.N.create();return dd[2]=i,t.intersectsPlane(dd,pd,n),new _(n[0],n[1])}class md extends Ol{}function gd(e,{width:t,height:i},n,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==t*i*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(t*i*n);return e.width=t,e.height=i,e.data=r,e}function _d(e,t,i){const{width:n,height:r}=t;n===e.width&&r===e.height||(yd(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,r)},i),e.width=n,e.height=r,e.data=t.data)}function yd(e,t,i,n,r,s,o){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const a=e.data,l=t.data,c=4===s&&o;for(let o=0;o<r.height;o++){const u=((i.y+o)*e.width+i.x)*s,h=((n.y+o)*t.width+n.x)*s;if(c)for(let e=0;e<r.width;e++){const t=u+e*s+3,i=h+e*s;l[i+0]=255,l[i+1]=255,l[i+2]=255,l[i+3]=a[t]}else for(let e=0;e<r.width*s;e++)l[h+e]=a[u+e]}return t}is(md,"HeatmapBucket",{omit:["layers"]});class vd{constructor(e,t){gd(this,e,1,t)}resize(e){_d(this,new vd(e),1)}clone(){return new vd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,n,r){yd(e,t,i,n,r,1)}}class xd{constructor(e,t){gd(this,e,4,t)}resize(e){_d(this,new xd(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new xd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,n,r,s){yd(e,t,i,n,r,4,s)}}class bd{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}is(vd,"AlphaImage"),is(xd,"RGBAImage");const wd=new Us({visibility:new zs(Gs.layout_heatmap.visibility)});var Sd={paint:new Us({"heatmap-radius":new Fs(Gs.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fs(Gs.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zs(Gs.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bs(Gs.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zs(Gs.paint_heatmap["heatmap-opacity"])}),layout:wd};function Td(e){const t={},i=e.resolution||256,n=e.clips?e.clips.length:1,r=e.image||new xd({width:i,height:n}),s=(i,n,s)=>{t[e.evaluationKey]=s;const o=e.expression.evaluate(t);o&&(r.data[i+n+0]=Math.floor(255*o.r/o.a),r.data[i+n+1]=Math.floor(255*o.g/o.a),r.data[i+n+2]=Math.floor(255*o.b/o.a),r.data[i+n+3]=Math.floor(255*o.a))};if(e.clips)for(let t=0,r=0;t<n;++t,r+=4*i)for(let n=0,o=0;n<i;n++,o+=4){const a=n/(i-1),{start:l,end:c}=e.clips[t];s(r,o,l*(1-a)+c*a)}else for(let e=0,t=0;e<i;e++,t+=4)s(0,t,e/(i-1));return r}const Ed=new Us({visibility:new zs(Gs.layout_hillshade.visibility)});var Md={paint:new Us({"hillshade-illumination-direction":new zs(Gs.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new zs(Gs.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zs(Gs.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zs(Gs.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zs(Gs.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zs(Gs.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new zs(Gs.paint_hillshade["hillshade-emissive-strength"])}),layout:Ed};const Id=uo([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ad}=Id;var Cd={exports:{}};function Pd(e,t,i){i=i||2;var n,r,s,o,a,l,c,u=t&&t.length,h=u?t[0]*i:e.length,d=kd(e,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,i,n){var r,s,o,a=[];for(r=0,s=t.length;r<s;r++)(o=kd(e,t[r]*n,r<s-1?t[r+1]*n:e.length,n,!1))===o.next&&(o.steiner=!0),a.push(jd(o));for(a.sort(Fd),r=0;r<a.length;r++)i=Bd(a[r],i);return i}(e,t,d,i)),e.length>80*i){n=s=e[0],r=o=e[1];for(var f=i;f<h;f+=i)(a=e[f])<n&&(n=a),(l=e[f+1])<r&&(r=l),a>s&&(s=a),l>o&&(o=l);c=0!==(c=Math.max(s-n,o-r))?32767/c:0}return Ld(d,p,i,n,r,c,0),p}function kd(e,t,i,n,r){var s,o;if(r===tp(e,t,i,n)>0)for(s=t;s<i;s+=n)o=Jd(s,e[s],e[s+1],o);else for(s=i-n;s>=t;s-=n)o=Jd(s,e[s],e[s+1],o);return o&&qd(o,o.next)&&(Qd(o),o=o.next),o}function Rd(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!qd(n,n.next)&&0!==Wd(n.prev,n,n.next))n=n.next;else{if(Qd(n),(n=t=n.prev)===n.next)break;i=!0}}while(i||n!==t);return t}function Ld(e,t,i,n,r,s,o){if(e){!o&&s&&function(e,t,i,n){var r=e;do{0===r.z&&(r.z=Vd(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,i,n,r,s,o,a,l,c=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(o>1)}(r)}(e,n,r,s);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,s?Od(e,n,r,s):Dd(e))t.push(a.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),Qd(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?Ld(e=Nd(Rd(e),t,i),t,i,n,r,s,2):2===o&&zd(e,t,i,n,r,s):Ld(Rd(e),t,i,n,r,s,1);break}}}function Dd(e){var t=e.prev,i=e,n=e.next;if(Wd(t,i,n)>=0)return!1;for(var r=t.x,s=i.x,o=n.x,a=t.y,l=i.y,c=n.y,u=r<s?r<o?r:o:s<o?s:o,h=a<l?a<c?a:c:l<c?l:c,d=r>s?r>o?r:o:s>o?s:o,p=a>l?a>c?a:c:l>c?l:c,f=n.next;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Gd(r,a,s,l,o,c,f.x,f.y)&&Wd(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Od(e,t,i,n){var r=e.prev,s=e,o=e.next;if(Wd(r,s,o)>=0)return!1;for(var a=r.x,l=s.x,c=o.x,u=r.y,h=s.y,d=o.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,_=Vd(p,f,t,i,n),y=Vd(m,g,t,i,n),v=e.prevZ,x=e.nextZ;v&&v.z>=_&&x&&x.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==o&&Gd(a,u,l,h,c,d,v.x,v.y)&&Wd(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==o&&Gd(a,u,l,h,c,d,x.x,x.y)&&Wd(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=_;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==o&&Gd(a,u,l,h,c,d,v.x,v.y)&&Wd(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==o&&Gd(a,u,l,h,c,d,x.x,x.y)&&Wd(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Nd(e,t,i){var n=e;do{var r=n.prev,s=n.next.next;!qd(r,s)&&$d(r,n,n.next,s)&&Yd(r,s)&&Yd(s,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(s.i/i|0),Qd(n),Qd(n.next),n=e=s),n=n.next}while(n!==e);return Rd(n)}function zd(e,t,i,n,r,s){var o=e;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&Hd(o,a)){var l=Kd(o,a);return o=Rd(o,o.next),l=Rd(l,l.next),Ld(o,t,i,n,r,s,0),void Ld(l,t,i,n,r,s,0)}a=a.next}o=o.next}while(o!==e)}function Fd(e,t){return e.x-t.x}function Bd(e,t){var i=function(e,t){var i,n=t,r=e.x,s=e.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o&&(o=a,i=n.x<n.next.x?n:n.next,a===r))return i}n=n.next}while(n!==t);if(!i)return null;var l,c=i,u=i.x,h=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&Gd(s<h?r:o,s,u,h,s<h?o:r,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(r-n.x),Yd(n,e)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&Ud(i,n)))&&(i=n,d=l)),n=n.next}while(n!==c);return i}(e,t);if(!i)return t;var n=Kd(i,e);return Rd(n,n.next),Rd(i,i.next)}function Ud(e,t){return Wd(e.prev,e,t.prev)<0&&Wd(t.next,e,e.next)<0}function Vd(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function jd(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Gd(e,t,i,n,r,s,o,a){return(r-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(n-a)>=(i-o)*(t-a)&&(i-o)*(s-a)>=(r-o)*(n-a)}function Hd(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&$d(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(Yd(e,t)&&Yd(t,e)&&function(e,t){var i=e,n=!1,r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(Wd(e.prev,e,t.prev)||Wd(e,t.prev,t))||qd(e,t)&&Wd(e.prev,e,e.next)>0&&Wd(t.prev,t,t.next)>0)}function Wd(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function qd(e,t){return e.x===t.x&&e.y===t.y}function $d(e,t,i,n){var r=Xd(Wd(e,t,i)),s=Xd(Wd(e,t,n)),o=Xd(Wd(i,n,e)),a=Xd(Wd(i,n,t));return r!==s&&o!==a||!(0!==r||!Zd(e,i,t))||!(0!==s||!Zd(e,n,t))||!(0!==o||!Zd(i,e,n))||!(0!==a||!Zd(i,t,n))}function Zd(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Xd(e){return e>0?1:e<0?-1:0}function Yd(e,t){return Wd(e.prev,e,e.next)<0?Wd(e,t,e.next)>=0&&Wd(e,e.prev,t)>=0:Wd(e,t,e.prev)<0||Wd(e,e.next,t)<0}function Kd(e,t){var i=new ep(e.i,e.x,e.y),n=new ep(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function Jd(e,t,i,n){var r=new ep(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Qd(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ep(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function tp(e,t,i,n){for(var r=0,s=t,o=i-n;s<i;s+=n)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}Cd.exports=Pd,Cd.exports.default=Pd,Pd.deviation=function(e,t,i,n){var r=t&&t.length,s=Math.abs(tp(e,0,r?t[0]*i:e.length,i));if(r)for(var o=0,a=t.length;o<a;o++)s-=Math.abs(tp(e,t[o]*i,o<a-1?t[o+1]*i:e.length,i));var l=0;for(o=0;o<n.length;o+=3){var c=n[o]*i,u=n[o+1]*i,h=n[o+2]*i;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]))}return 0===s&&0===l?0:Math.abs((l-s)/s)},Pd.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var s=0;s<e[r].length;s++)for(var o=0;o<t;o++)i.vertices.push(e[r][s][o]);r>0&&i.holes.push(n+=e[r-1].length)}return i};var ip=h(Cd.exports);function np(e,t){const i=e.length;if(i<=1)return[e];const n=[];let r,s;for(let t=0;t<i;t++){const i=H(e[t]);0!==i&&(e[t].area=Math.abs(i),void 0===s&&(s=i<0),s===i<0?(r&&n.push(r),r=[e[t]]):r.push(e[t]))}if(r&&n.push(r),t>1)for(let e=0;e<n.length;e++)n[e].length<=t||(oi(n[e],t,1,n[e].length-1,rp),n[e]=n[e].slice(0,t));return n}function rp(e,t){return t.area-e.area}function sp(e,t,i){const n=i.patternDependencies;let r=!1;for(const i of t){const t=i.paint.get(`${e}-pattern`);t.isConstant()||(r=!0);const s=t.constantOr(null);s&&(r=!0,n[s]=!0)}return r}function op(e,t,i,n,r){const s=r.patternDependencies;for(const o of t){const t=o.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:n},i,{},r.availableImages);e=e&&e.name?e.name:e,s[e]=!0,i.patterns[o.id]=e}}return i}class ap{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new po,this.indexArray=new Po,this.indexArray2=new Eo,this.programConfigurations=new Na(e.layers,e.zoom),this.segments=new ia,this.segments2=new ia,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,i,n){this.hasPattern=sp("fill",this.layers,t);const r=this.layers[0].layout.get("fill-sort-key"),s=[];for(const{feature:o,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Rl(o,e);if(!this.layers[0]._featureFilter.filter(new As(this.zoom),u,i))continue;const h=r?r.evaluate(u,{},i,t.availableImages):void 0,d={id:a,properties:o.properties,type:o.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:kl(o,i,n),patterns:{},sortKey:h};s.push(d)}r&&s.sort(((e,t)=>e.sortKey-t.sortKey));for(const n of s){const{geometry:r,index:s,sourceLayerIndex:o}=n;if(this.hasPattern){const e=op("fill",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,r,s,i,{},t.availableImages,t.brightness);t.featureIndex.insert(e[s].feature,r,s,o,this.index)}}update(e,t,i,n,r){const s=0!==Object.keys(e).length;s&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,s?this.stateDependentLayers:this.layers,i,n,r)}addFeatures(e,t,i,n,r,s){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i,n,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ad),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,i,n,r,s=[],o){for(const e of np(t,500)){let t=0;for(const i of e)t+=i.length;const i=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),n=i.vertexLength,r=[],s=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&s.push(r.length/2);const i=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),n=i.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(n+t.length-1,n),r.push(t[0].x),r.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(n+e-1,n+e),r.push(t[e].x),r.push(t[e].y);i.vertexLength+=t.length,i.primitiveLength+=t.length}const o=ip(r,s);for(let e=0;e<o.length;e+=3)this.indexArray.emplaceBack(n+o[e],n+o[e+1],n+o[e+2]);i.vertexLength+=t,i.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,s,n,o)}}is(ap,"FillBucket",{omit:["layers","patternFeatures"]});const lp=new Us({"fill-sort-key":new Fs(Gs.layout_fill["fill-sort-key"]),visibility:new zs(Gs.layout_fill.visibility)});var cp={paint:new Us({"fill-antialias":new zs(Gs.paint_fill["fill-antialias"]),"fill-opacity":new Fs(Gs.paint_fill["fill-opacity"]),"fill-color":new Fs(Gs.paint_fill["fill-color"]),"fill-outline-color":new Fs(Gs.paint_fill["fill-outline-color"]),"fill-translate":new zs(Gs.paint_fill["fill-translate"]),"fill-translate-anchor":new zs(Gs.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fs(Gs.paint_fill["fill-pattern"]),"fill-emissive-strength":new zs(Gs.paint_fill["fill-emissive-strength"])}),layout:lp};const up=uo([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),hp=uo([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),dp=uo([{name:"a_centroid_pos",components:2,type:"Uint16"}]),pp=uo([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),fp=uo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:mp}=up;var gp={},_p=m,yp=vp;function vp(e,t,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=r,e.readFields(xp,this,t)}function xp(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){for(var i=e.readVarint()+e.pos;e.pos<i;){var n=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[n]=r}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function bp(e){for(var t,i,n=0,r=0,s=e.length,o=s-1;r<s;o=r++)n+=((i=e[o]).x-(t=e[r]).x)*(t.y+i.y);return n}vp.types=["Unknown","Point","LineString","Polygon"],vp.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,n=1,r=0,s=0,o=0,a=[];e.pos<i;){if(r<=0){var l=e.readVarint();n=7&l,r=l>>3}if(r--,1===n||2===n)s+=e.readSVarint(),o+=e.readSVarint(),1===n&&(t&&a.push(t),t=[]),t.push(new _p(s,o));else{if(7!==n)throw new Error("unknown command "+n);t&&t.push(t[0].clone())}}return t&&a.push(t),a},vp.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,n=0,r=0,s=0,o=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(n<=0){var u=e.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)(r+=e.readSVarint())<o&&(o=r),r>a&&(a=r),(s+=e.readSVarint())<l&&(l=s),s>c&&(c=s);else if(7!==i)throw new Error("unknown command "+i)}return[o,l,a,c]},vp.prototype.toGeoJSON=function(e,t,i){var n,r,s=this.extent*Math.pow(2,i),o=this.extent*e,a=this.extent*t,l=this.loadGeometry(),c=vp.types[this.type];function u(e){for(var t=0;t<e.length;t++){var i=e[t];e[t]=[360*(i.x+o)/s-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/s)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];u(l=h);break;case 2:for(n=0;n<l.length;n++)u(l[n]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var i,n,r=[],s=0;s<t;s++){var o=bp(e[s]);0!==o&&(void 0===n&&(n=o<0),n===o<0?(i&&r.push(i),i=[e[s]]):i.push(e[s]))}return i&&r.push(i),r}(l),n=0;n<l.length;n++)for(r=0;r<l[n].length;r++)u(l[n][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var wp=yp,Sp=Tp;function Tp(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Ep,this,t),this.length=this._features.length}function Ep(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;){var n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}return t}(i))}Tp.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new wp(this._pbf,t,this.extent,this._keys,this._values)};var Mp=Sp;function Ip(e,t,i){if(3===e){var n=new Mp(i,i.readVarint()+i.pos);n.length&&(t[n.name]=n)}}var Ap=gp.VectorTile=function(e,t){this.layers=e.readFields(Ip,{},t)},Cp=gp.VectorTileFeature=yp;function Pp(e,t,i,n){const r=[],s=0===n?(e,t,i,n,r,s)=>{e.push(new _(s,i+(s-t)/(n-t)*(r-i)))}:(e,t,i,n,r,s)=>{e.push(new _(t+(s-i)/(r-i)*(n-t),s))};for(const o of e){const e=[];for(const r of o){if(r.length<=2)continue;const o=[];for(let e=0;e<r.length-1;e++){const a=r[e].x,l=r[e].y,c=r[e+1].x,u=r[e+1].y,h=0===n?a:l,d=0===n?c:u;h<t?d>t&&s(o,a,l,c,u,t):h>i?d<i&&s(o,a,l,c,u,i):o.push(r[e]),d<t&&h>=t&&s(o,a,l,c,u,t),d>i&&h<=i&&s(o,a,l,c,u,i)}let a=r[r.length-1];const l=0===n?a.x:a.y;l>=t&&l<=i&&o.push(a),o.length&&(a=o[o.length-1],o[0].x===a.x&&o[0].y===a.y||o.push(o[0]),e.push(o))}e.length&&r.push(e)}return r}function kp(e,t){return e.x-t.x||e.y-t.y}function Rp(e,t){return 0===kp(e.min,t.min)&&0===kp(e.max,t.max)}function Lp(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function Dp(e,t,i){const n=1/ki,r=1/(1<<i.canonical.z),s=(t.x*n+i.canonical.x)*r+i.wrap,o=(t.y*n+i.canonical.y)*r;return{min:new _((e.x*n+i.canonical.x)*r+i.wrap,(e.y*n+i.canonical.y)*r),max:new _(s,o)}}function Op(e,t,i){const n=1<<i.canonical.z,r=((t.x-i.wrap)*n-i.canonical.x)*ki,s=(t.y*n-i.canonical.y)*ki;return{min:new _(((e.x-i.wrap)*n-i.canonical.x)*ki,(e.y*n-i.canonical.y)*ki),max:new _(r,s)}}function Np(e,t,i,n,r,s,o){const a=e.indices,l=e.vertices,c=[];for(let u=n;u<n+r;u+=3){const n=t[i[u+0]+s],r=t[i[u+1]+s],h=t[i[u+2]+s],d=Math.min(n.x,r.x,h.x),p=Math.max(n.x,r.x,h.x),f=Math.min(n.y,r.y,h.y),m=Math.max(n.y,r.y,h.y);c.length=0,e.grid.query(new _(d,f),new _(p,m),c);for(let e=0;e<c.length;e++){const t=c[e];if(Xl(l[a[3*t+0]],l[a[3*t+1]],l[a[3*t+2]],n,r,h,o))return!0}}return!1}function zp(e,t,i,n){if(!e||!i)return!1;let r=e.vertices;if(!t.canonical.equals(n.canonical)||t.wrap!==n.wrap){if(i.vertices.length<e.vertices.length)return zp(i,n,e,t);const s=t.canonical,o=n.canonical,a=Math.pow(2,o.z-s.z);r=e.vertices.map((e=>new _(e.x*s.x*ki*a-o.x*ki,e.y*s.y*ki*a-o.y*ki)))}return Np(i,r,e.indices,0,e.indices.length,0,0)}gp.VectorTileLayer=Sp;class Fp{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const i=this.toIdx(e,t);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Bp(e,t,i,n){let r=0,s=Number.MAX_VALUE;for(let o=0;o<3;o++)if(Math.abs(n[o])<1e-15){if(i[o]<e[o]||i[o]>t[o])return null}else{const a=1/n[o];let l=(e[o]-i[o])*a,c=(t[o]-i[o])*a;if(l>c){const e=l;l=c,c=e}if(l>r&&(r=l),c<s&&(s=c),r>s)return null}return r}function Up(e,t,i,n,r,s,o,a,l,c,u){const h=n-e,d=r-t,p=s-i,f=o-e,m=a-t,g=l-i,_=u[1]*g-u[2]*m,y=u[2]*f-u[0]*g,v=u[0]*m-u[1]*f,x=h*_+d*y+p*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-e,S=c[1]-t,T=c[2]-i,E=(w*_+S*y+T*v)*b;if(E<0||E>1)return null;const M=S*p-T*d,I=T*h-w*p,A=w*d-S*h,C=(u[0]*M+u[1]*I+u[2]*A)*b;return C<0||E+C>1?null:(f*M+m*I+g*A)*b}function Vp(e,t,i){return(e-t)/(i-t)}function jp(e,t,i,n,r,s,o,a,l){const c=1<<i,u=s-n,h=o-r,d=(e+1)/c*u+n,p=(t+0)/c*h+r,f=(t+1)/c*h+r;a[0]=(e+0)/c*u+n,a[1]=p,l[0]=d,l[1]=f}class Gp{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),i=[];let n=Math.ceil(Math.pow(2,t));const r=1/n,s=(e,t,i,n,r)=>{const s=n?1:0,o=(e+1)*i-s,a=t*i,l=(t+1)*i-s;r[0]=e*i,r[1]=a,r[2]=o,r[3]=l};let o=new Fp(n);const a=[];for(let t=0;t<n*n;t++){s(t%n,Math.floor(t/n),r,!1,a);const i=Wp(a[0],a[1],e),l=Wp(a[2],a[1],e),c=Wp(a[2],a[3],e),u=Wp(a[0],a[3],e);o.minimums.push(Math.min(i,l,c,u)),o.maximums.push(Math.max(i,l,c,u)),o.leaves.push(1)}for(i.push(o),n/=2;n>=1;n/=2){const e=i[i.length-1];o=new Fp(n);for(let t=0;t<n*n;t++){s(t%n,Math.floor(t/n),2,!0,a);const i=e.getElevation(a[0],a[1]),r=e.getElevation(a[2],a[1]),l=e.getElevation(a[2],a[3]),c=e.getElevation(a[0],a[3]),u=e.isLeaf(a[0],a[1]),h=e.isLeaf(a[2],a[1]),d=e.isLeaf(a[2],a[3]),p=e.isLeaf(a[0],a[3]),f=Math.min(i.min,r.min,l.min,c.min),m=Math.max(i.max,r.max,l.max,c.max),g=u&&h&&d&&p;o.maximums.push(m),o.minimums.push(f),o.leaves.push(m-f<=5&&g?1:0)}i.push(o)}return i}(this.dem),i=t.length-1,n=t[i];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(t,0,0,i,0)}raycastRoot(e,t,i,n,r,s,o=1){return Bp([e,t,-100],[i,n,this.maximums[0]*o],r,s)}raycast(t,i,n,r,s,o,a=1){if(!this.nodeCount)return null;const l=this.raycastRoot(t,i,n,r,s,o,a);if(null==l)return null;const c=[],u=[],h=[],d=[],p=[{idx:0,t:l,nodex:0,nodey:0,depth:0}];for(;p.length>0;){const{idx:l,t:f,nodex:m,nodey:g,depth:_}=p.pop();if(this.leaves[l]){jp(m,g,_,t,i,n,r,h,d);const l=1<<_,c=(m+0)/l,u=(m+1)/l,p=(g+0)/l,y=(g+1)/l,v=Wp(c,p,this.dem)*a,x=Wp(u,p,this.dem)*a,b=Wp(u,y,this.dem)*a,w=Wp(c,y,this.dem)*a,S=Up(h[0],h[1],v,d[0],h[1],x,d[0],d[1],b,s,o),T=Up(d[0],d[1],b,h[0],d[1],w,h[0],h[1],v,s,o),E=Math.min(null!==S?S:Number.MAX_VALUE,null!==T?T:Number.MAX_VALUE);if(E!==Number.MAX_VALUE)return E;{const t=e.N.scaleAndAdd([],s,o,f);if(Hp(v,x,w,b,Vp(t[0],h[0],d[0]),Vp(t[1],h[1],d[1]))>=t[2])return f}continue}let y=0;for(let e=0;e<this._siblingOffset.length;e++){jp((m<<1)+this._siblingOffset[e][0],(g<<1)+this._siblingOffset[e][1],_+1,t,i,n,r,h,d),h[2]=-100,d[2]=this.maximums[this.childOffsets[l]+e]*a;const p=Bp(h,d,s,o);if(null!=p){const t=p;c[e]=t;let i=!1;for(let n=0;n<y&&!i;n++)t>=c[u[n]]&&(u.splice(n,0,e),i=!0);i||(u[y]=e),y++}}for(let e=0;e<y;e++){const t=u[e];p.push({idx:this.childOffsets[l]+t,t:c[t],nodex:(m<<1)+this._siblingOffset[t][0],nodey:(g<<1)+this._siblingOffset[t][1],depth:_+1})}}return null}_addNode(e,t,i){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,i,n,r){if(1===e[n].isLeaf(t,i))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const s=n-1,o=e[s];let a=0,l=0;for(let e=0;e<this._siblingOffset.length;e++){const n=2*t+this._siblingOffset[e][0],r=2*i+this._siblingOffset[e][1],s=o.getElevation(n,r),c=o.isLeaf(n,r),u=this._addNode(s.min,s.max,c);c&&(a|=1<<e),l||(l=u)}for(let n=0;n<this._siblingOffset.length;n++)a&1<<n||this._construct(e,2*t+this._siblingOffset[n][0],2*i+this._siblingOffset[n][1],s,l+n)}}function Hp(e,t,i,n,r,s){return ct(ct(e,i,s),ct(t,n,s),r)}function Wp(e,t,i){const n=i.dim,r=M(e*n-.5,0,n-1),s=M(t*n-.5,0,n-1),o=Math.floor(r),a=Math.floor(s),l=Math.min(o+1,n-1),c=Math.min(a+1,n-1);return Hp(i.get(o,a),i.get(l,a),i.get(o,c),i.get(l,c),r-o,s-a)}const qp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function $p(e,t,i){return(256*e*256+256*t+i)/10-1e4}function Zp(e,t,i){return 256*e+t+i/256-32768}class Xp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,i,n=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return j(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const r=this.dim=t.height-2,s=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.floatView=new Float32Array(t.data.buffer),this.borderReady=n,this._modifiedForSources={},!n){for(let e=0;e<r;e++)s[this._idx(-1,e)]=s[this._idx(0,e)],s[this._idx(r,e)]=s[this._idx(r-1,e)],s[this._idx(e,-1)]=s[this._idx(e,0)],s[this._idx(e,r)]=s[this._idx(e,r-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(r,-1)]=s[this._idx(r-1,0)],s[this._idx(-1,r)]=s[this._idx(0,r-1)],s[this._idx(r,r)]=s[this._idx(r-1,r-1)]}const o="terrarium"===i?Zp:$p;for(let e=0;e<s.length;++e){const t=4*e;this.floatView[e]=o(this.pixels[t],this.pixels[t+1],this.pixels[t+2])}this._timestamp=oe.now()}_buildQuadTree(){this._tree=new Gp(this)}get(e,t,i=!1){i&&(e=M(e,-1,this.dim),t=M(t,-1,this.dim));const n=this._idx(e,t);return this.floatView[n]}set(e,t,i){const n=this._idx(e,t),r=this.floatView[n];return this.floatView[n]=i,i-r}static getUnpackVector(e){return qp[e]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const i=[0,0,0,0],n=Xp.getUnpackVector(t);let r=Math.floor((e+n[3])/n[2]);return i[2]=r%256,r=Math.floor(r/256),i[1]=r%256,r=Math.floor(r/256),i[0]=r,i}getPixels(){return new bd({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let n=t*this.dim,r=t*this.dim+this.dim,s=i*this.dim,o=i*this.dim+this.dim;switch(t){case-1:n=r-1;break;case 1:r=n+1}switch(i){case-1:s=o-1;break;case 1:o=s+1}const a=-t*this.dim,l=-i*this.dim;for(let t=s;t<o;t++)for(let i=n;i<r;i++){const n=4*this._idx(i,t),r=4*this._idx(i+a,t+l);this.pixels[n+0]=e.pixels[r+0],this.pixels[n+1]=e.pixels[r+1],this.pixels[n+2]=e.pixels[r+2],this.pixels[n+3]=e.pixels[r+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}is(Xp,"DEMData"),is(Gp,"DemMinMaxQuadTree",{omit:["dem"]});class Yp{constructor(e,t,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=i}static create(e,t,i){const n=i||e.findDEMTileFor(t);if(!n||!n.dem)return;const r=n.dem,s=n.tileID,o=1<<t.canonical.z-s.canonical.z;return new Yp(n,r.dim/ki/o,[(t.canonical.x/o-s.canonical.x)*r.dim,(t.canonical.y/o-s.canonical.y)*r.dim])}tileCoordToPixel(e,t){const i=t*this._scale+this._offset[1],n=Math.floor(e*this._scale+this._offset[0]),r=Math.floor(i);return new _(n,r)}getElevationAt(e,t,i,n){const r=e*this._scale+this._offset[0],s=t*this._scale+this._offset[1],o=Math.floor(r),a=Math.floor(s),l=this._dem;return n=!!n,i?ct(ct(l.get(o,a,n),l.get(o,a+1,n),s-a),ct(l.get(o+1,a,n),l.get(o+1,a+1,n),s-a),r-o):l.get(o,a,n)}getElevationAtPixel(e,t,i){return this._dem.get(e,t,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*fl(1,e)*this._dem.stride}}const Kp=Cp.types,Jp=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Qp=["fill-extrusion-flood-light-ground-radius"],ef=Math.pow(2,13),tf=Math.pow(2,15)-1,nf=new _(0,1),rf=2147483648;function sf(e,t,i,n,r,s,o,a){e.emplaceBack((t<<1)+o,(i<<1)+s,(Math.floor(n*ef)<<1)+r,Math.round(a))}function of(e,t,i,n,r,s){e.emplaceBack(t.x,t.y,(i.x<<1)+n,(i.y<<1)+r,s)}function af(e,t,i){const n=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*n,i[1]*n,i[2]*n)}class lf{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class cf{constructor(){this.centroidXY=new _(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new _(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new _(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new _(this.max.x-this.min.x,this.max.y-this.min.y)}}class uf{constructor(){this.acc=new _(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,i){this.accCount++,this.acc._add(t);let n=!!this.borders;t.x<e.min.x?(e.min.x=t.x,n=!0):t.x>e.max.x&&(e.max.x=t.x,n=!0),t.y<e.min.y?(e.min.y=t.y,n=!0):t.y>e.max.y&&(e.max.y=t.y,n=!0),((0===t.x||t.x===ki)&&t.x===i.x)!=((0===t.y||t.y===ki)&&t.y===i.y)&&this.processBorderOverlap(t,i),n&&this.checkBorderIntersection(t,i)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,ct(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>ki!=e.x>ki&&this.addBorderIntersection(1,ct(t.y,e.y,(ki-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,ct(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>ki!=e.y>ki&&this.addBorderIntersection(3,ct(t.x,e.x,(ki-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[e];t<i[0]&&(i[0]=t),t>i[1]&&(i[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const i=0===e.x?0:1;this.addBorderIntersection(i,t.y),this.addBorderIntersection(i,e.y)}else{const i=0===e.y?2:3;this.addBorderIntersection(i,t.x),this.addBorderIntersection(i,e.x)}}centroid(){return 0===this.accCount?new _(0,0):new _(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0):0}}function hf(e,t){const i=e.add(t)._unit(),n=M(e.x*i.x+e.y*i.y,-1,1);var r,s,o;return r=Math.acos(n),Math.min(4,Math.max(-4,Math.tan(r)))/4*tf*((s=e).x*(o=t).y-s.y*o.x<0?-1:1)}const df=[e=>e.x<0,e=>e.x>ki,e=>e.y<0,e=>e.y>ki];function pf(e,t,i,n){const r=[4];if(0===n)return r;i._mult(n);const s=e.sub(i),o=t.sub(i),a=[e,t,s,o];for(let e=0;e<4;e++)for(const t of a)if(df[e](t)){r.push(e);break}return r}class ff{constructor(e){this.vertexArray=new go,this.indexArray=new Po,this.programConfigurations=new Na(e.layers,e.zoom,(e=>Qp.includes(e))),this._segments=new ia,this.hiddenByLandmarkVertexArray=new jo,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ia}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,i,n=!1){const r=e.length;if(r>2){let s=Math.max(0,this._segments.get().length-1);const o=this._segments._prepareSegment(4*r,this.vertexArray.length,2*this._segmentToGroundQuads[s].length);let a;s!==this._segments.get().length-1&&(s++,this._segmentToGroundQuads[s]=[],this._segmentToRegionTriCounts[s]=[0,0,0,0,0]);{const t=e[0],i=e[1];a=hf(t.sub(e[r-1])._perp()._unit(),i.sub(t)._perp()._unit())}for(let l=0;l<r;l++){const c=l===r-1?0:l+1,u=e[l],h=e[c],d=e[c===r-1?0:c+1],p=h.sub(u)._perp()._unit(),f=hf(p,d.sub(h)._perp()._unit()),m=a,g=f;if(vf(u,h,t)||n&&xf(u,t)&&xf(h,t)){a=f;continue}const _=o.vertexLength;of(this.vertexArray,u,h,1,1,m),of(this.vertexArray,u,h,1,0,m),of(this.vertexArray,u,h,0,1,g),of(this.vertexArray,u,h,0,0,g),o.vertexLength+=4;const y=pf(u,h,p,i);for(const e of y)this._segmentToGroundQuads[s].push({id:_,region:e}),this._segmentToRegionTriCounts[s][e]+=2,o.primitiveLength+=2;a=f}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let e=0;e<t;e++)this._segmentToGroundQuads[e].sort(((e,t)=>e.region-t.region));for(let i=0;i<t;i++){const t=this._segmentToGroundQuads[i],n=e[i],r=this._segmentToRegionTriCounts[i];r.reduce(((e,t)=>e+t),0);let s=0;for(let e=0;e<=4;e++){const t=r[e];if(0!==t){let i=this.regionSegments[e];i||(i=this.regionSegments[e]=new ia);const r={vertexOffset:n.vertexOffset,primitiveOffset:n.primitiveOffset+s,vertexLength:n.vertexLength,primitiveLength:t};i.get().push(r)}s+=t}for(let e=0;e<t.length;e++){const i=t[e].id;this.indexArray.emplaceBack(i,i+1,i+3),this.indexArray.emplaceBack(i,i+3,i+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,i,n,r,s){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,i,n,r,s)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,hp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,i,n,r,s){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,i,n,r,s)}updateHiddenByLandmark(e){if(!this.hasData())return;const t=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const i=e.flags&rf?1:0;for(let n=e.groundVertexArrayOffset;n<t;++n)this.hiddenByLandmarkVertexArray.emplace(n,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,pp.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class mf{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Po,this.footprintVertices=new po,this.footprintSegments=[],this.layoutVertexArray=new mo,this.centroidVertexArray=new Qo,this.indexArray=new Po,this.programConfigurations=new Na(e.layers,e.zoom,(e=>Jp.includes(e))),this.segments=new ia,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.groundEffect=new ff(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,t,i,n){this.features=[],this.hasPattern=sp("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=wl(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:r,id:s,index:o,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Rl(r,e);if(!this.layers[0]._featureFilter.filter(new As(this.zoom),l,i))continue;const c={id:s,sourceLayerIndex:a,index:o,geometry:e?l.geometry:kl(r,i,n),properties:r.properties,type:r.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(op("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,o,i,{},t.availableImages,n,t.brightness),t.featureIndex.insert(r,c.geometry,o,a,this.index,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,t,i,n,r,s){for(const e of this.features){const{geometry:o}=e;this.addFeature(e,o,e.index,t,i,n,r,s)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,t,i,n,r){const s=0!==Object.keys(e).length;if(s&&!this.stateDependentLayers.length)return;const o=s?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,t,o,i,n,r),this.groundEffect.update(e,t,o,i,n,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mp),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,fp.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,dp.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,i,n,r,s,o,a){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,c=[new _(0,0),new _(ki,ki)],u=o.projection,h="globe"===u.name,d="Polygon"===Kp[e.type],p=new uf;p.centroidDataIndex=this.centroidData.length;const f=new cf,m=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},n)<=0,g=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},n);f.height=g,f.vertexArrayOffset=this.layoutVertexArray.length,f.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new bo);const y=np(t,500);for(let e=y.length-1;e>=0;e--){const t=y[e];(0===t.length||(v=t[0]).every((e=>e.x<=0))||v.every((e=>e.x>=ki))||v.every((e=>e.y<=0))||v.every((e=>e.y>=ki)))&&y.splice(e,1)}var v;let x;if(h)x=Tf(y,c,n);else{x=[];for(const e of y)x.push({polygon:e,bounds:c})}const b=d?this.edgeRadius:0,w=b>0&&this.zoom<17,S=(e,t)=>{if(0===e.length)return!1;const i=e[e.length-1];return t.x===i.x&&t.y===i.y};for(const{polygon:e,bounds:t}of x){let i=0,r=0;for(const t of e)d&&!t[0].equals(t[t.length-1])&&t.push(t[0]),r+=d?t.length-1:t.length;const s=this.segments.prepareSegment((d?5:4)*r,this.layoutVertexArray,this.indexArray);f.footprintSegIdx<0&&(f.footprintSegIdx=this.footprintSegments.length),f.polygonSegIdx<0&&(f.polygonSegIdx=this.polygonSegments.length);const o={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},a=new lf;if(a.vertexOffset=this.footprintVertices.length,a.indexOffset=3*this.footprintIndices.length,a.ringIndices=[],d){const r=[],o=[];i=s.vertexLength;for(let i=0;i<e.length;i++){const c=e[i];c.length&&0!==i&&o.push(r.length/2);const d=[];let p,f;p=c[1].sub(c[0])._perp()._unit(),a.ringIndices.push(c.length-1);for(let e=1;e<c.length;e++){const t=c[e],i=c[e===c.length-1?1:e+1],o=t.clone();if(b){f=i.sub(t)._perp()._unit();const e=p.add(f)._unit(),n=b*Math.min(4,1/(p.x*e.x+p.y*e.y));o.x+=n*e.x,o.y+=n*e.y,o.x=Math.round(o.x),o.y=Math.round(o.y),p=f}!m||0!==b&&!w||S(d,o)||d.push(o),sf(this.layoutVertexArray,o.x,o.y,0,0,1,1,0),s.vertexLength++,this.footprintVertices.emplaceBack(t.x,t.y),r.push(t.x,t.y),h&&af(this.layoutVertexExtArray,u.projectTilePoint(o.x,o.y,n),u.upVector(n,o.x,o.y))}m&&(0===b||w)&&(0!==d.length&&S(d,d[0])&&d.pop(),this.groundEffect.addData(d,t,l))}const c=ip(r,o);for(let e=0;e<c.length;e+=3)this.footprintIndices.emplaceBack(a.vertexOffset+c[e+0],a.vertexOffset+c[e+1],a.vertexOffset+c[e+2]),this.indexArray.emplaceBack(i+c[e],i+c[e+2],i+c[e+1]),s.primitiveLength++;a.indexCount+=c.length,a.vertexCount+=this.footprintVertices.length-a.vertexOffset}for(let r=0;r<e.length;r++){const o=e[r];p.startRing(f,o[0]);let a=o.length>4&&bf(o[o.length-2],o[0],o[1]),c=b?_f(o[o.length-2],o[0],o[1],b):0;const g=[];let _,y,v;y=o[1].sub(o[0])._perp()._unit();let x=!0;for(let e=1,r=0;e<o.length;e++){let l=o[e-1],d=o[e];const w=o[e===o.length-1?1:e+1];if(p.appendEdge(f,d,l),vf(d,l,t)){b&&(y=w.sub(d)._perp()._unit(),x=!x);continue}const T=d.sub(l)._perp(),E=T.x/(Math.abs(T.x)+Math.abs(T.y)),M=T.y>0?1:0,I=l.dist(d);if(r+I>32768&&(r=0),b){v=w.sub(d)._perp()._unit();let e=yf(l,d,w,gf(y,v),b);isNaN(e)&&(e=0);const t=d.sub(l)._unit();l=l.add(t.mult(c))._round(),d=d.add(t.mult(-e))._round(),c=e,y=v,m&&this.zoom>=17&&(S(g,l)||g.push(l),S(g,d)||g.push(d))}const A=s.vertexLength,C=o.length>4&&bf(l,d,w);let P=wf(r,a,x);if(sf(this.layoutVertexArray,l.x,l.y,E,M,0,0,P),sf(this.layoutVertexArray,l.x,l.y,E,M,0,1,P),r+=I,P=wf(r,C,!x),a=C,sf(this.layoutVertexArray,d.x,d.y,E,M,0,0,P),sf(this.layoutVertexArray,d.x,d.y,E,M,0,1,P),s.vertexLength+=4,this.indexArray.emplaceBack(A+0,A+1,A+2),this.indexArray.emplaceBack(A+1,A+3,A+2),s.primitiveLength+=2,b){const n=i+(1===e?o.length-2:e-2),r=1===e?i:n+1;if(this.indexArray.emplaceBack(A+1,n,A+3),this.indexArray.emplaceBack(n,r,A+3),s.primitiveLength+=2,void 0===_&&(_=A),!vf(w,o[e],t)){const t=e===o.length-1?_:s.vertexLength;this.indexArray.emplaceBack(A+2,A+3,t),this.indexArray.emplaceBack(A+3,t+1,t),this.indexArray.emplaceBack(A+3,r,t+1),s.primitiveLength+=3}x=!x}if(h){const e=this.layoutVertexExtArray,t=u.projectTilePoint(l.x,l.y,n),i=u.projectTilePoint(d.x,d.y,n),r=u.upVector(n,l.x,l.y),s=u.upVector(n,d.x,d.y);af(e,t,r),af(e,t,r),af(e,i,s),af(e,i,s)}}d&&(i+=o.length-1),m&&b&&this.zoom>=17&&(0!==g.length&&S(g,g[0])&&g.pop(),this.groundEffect.addData(g,t,l,b>0))}this.footprintSegments.push(a),o.triangleCount=this.indexArray.length-o.triangleArrayOffset,this.polygonSegments.push(o),++f.footprintSegLen,++f.polygonSegLen}if(f.vertexCount=this.layoutVertexArray.length-f.vertexArrayOffset,f.groundVertexCount=this.groundEffect.vertexArray.length-f.groundVertexArrayOffset,0!==f.vertexCount){if(f.centroidXY=p.borders?nf:this.encodeCentroid(p,f),this.centroidData.push(f),p.borders){this.featuresOnBorder.push(p);const e=this.featuresOnBorder.length-1;for(let t=0;t<p.borders.length;t++)p.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,s,n,a),this.groundEffect.addPaintPropertiesData(e,i,r,s,n,a),this.maxHeight=Math.max(this.maxHeight,g)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((t,i)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[i].borders[e][0]))}splitToSubtiles(){const e=[];for(let t=0;t<this.centroidData.length;t++){const i=this.centroidData[t],n=+(i.min.y+i.max.y>ki),r=2*n+(+(i.min.x+i.max.x>ki)^n);for(let n=0;n<i.polygonSegLen;n++){const s=i.polygonSegIdx+n;e.push({centroidIdx:t,subtile:r,polygonSegmentIdx:s,triangleSegmentIdx:this.polygonSegments[s].triangleSegIdx})}}const t=new Po;e.sort(((e,t)=>e.triangleSegmentIdx===t.triangleSegmentIdx?e.subtile-t.subtile:e.triangleSegmentIdx-t.triangleSegmentIdx));let i=0,n=0,r=0;for(const t of e){if(t.triangleSegmentIdx!==i)break;r++}const s=e.length;for(;n!==e.length;){i=e[n].triangleSegmentIdx;let o=0,a=n,l=n;for(let t=a;t<r&&e[t].subtile===o;t++)l++;for(;a!==r;){const n=e[a];o=n.subtile;const s=this.centroidData[n.centroidIdx].min.clone(),c=this.centroidData[n.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[i].vertexOffset,primitiveOffset:t.length,vertexLength:this.segments.segments[i].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let i=a;i<l;i++){const n=e[i],r=this.polygonSegments[n.polygonSegmentIdx],o=this.centroidData[n.centroidIdx].min,a=this.centroidData[n.centroidIdx].max,l=this.indexArray.uint16;for(let e=r.triangleArrayOffset;e<r.triangleArrayOffset+r.triangleCount;e++)t.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);u.primitiveLength+=r.triangleCount,s.x=Math.min(s.x,o.x),s.y=Math.min(s.y,o.y),c.x=Math.max(c.x,a.x),c.y=Math.max(c.y,a.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:s,max:c}),a=l;for(let t=a;t<r&&e[t].subtile===e[a].subtile;t++)l++}n=r;for(let t=n;t<s&&e[t].triangleSegmentIdx===e[n].triangleSegmentIdx;t++)r++}t._trim(),this.indexArray=t}getVisibleSegments(e,t,i){let n=0,r=0;const s=1<<e.canonical.z;if(t){const i=t.getMinMaxForTile(e);i&&(n=i.min,r=i.max)}r+=this.maxHeight;const o=e.toUnwrapped();let a;const l=[o.canonical.x/s+o.wrap,o.canonical.y/s],c=[(o.canonical.x+1)/s+o.wrap,(o.canonical.y+1)/s],u=new ia,h=(e,t,i)=>[e[0]*(1-i[0])+t[0]*i[0],e[1]*(1-i[1])+t[1]*i[1]],d=[],p=[];for(const e of this.triangleSubSegments){d[0]=e.min.x/ki,d[1]=e.min.y/ki,p[0]=e.max.x/ki,p[1]=e.max.y/ki;const t=h(l,c,d),s=h(l,c,p);if(0===new Rh([t[0],t[1],n],[s[0],s[1],r]).intersectsPrecise(i)){a&&(u.segments.push(a),a=void 0);continue}const o=e.segment;a&&a.vertexOffset!==o.vertexOffset&&(u.segments.push(a),a=void 0),a?(a.vertexLength+=o.vertexLength,a.primitiveLength+=o.primitiveLength):a={vertexOffset:o.vertexOffset,primitiveLength:o.primitiveLength,vertexLength:o.vertexLength,primitiveOffset:o.primitiveOffset,sortKey:void 0,vaos:{}}}return a&&u.segments.push(a),u}encodeCentroid(e,t){const i=e.centroid(),n=t.span(),r=Math.min(7,Math.round(n.x*this.tileToMeter/10)),s=Math.min(7,Math.round(n.y*this.tileToMeter/10));return new _(M(i.x,1,ki-1)<<3|r,M(i.y,1,ki-1)<<3|s)}encodeBorderCentroid(e){if(!e.borders)return new _(0,0);const t=e.borders,i=Number.MAX_VALUE;if(t[0][0]!==i||t[1][0]!==i){const e=t[0][0]!==i?0:1;return new _(6|(t[0][0]!==i?0:65528),(t[e][0]+t[e][1])/2<<3|6)}{const e=t[2][0]!==i?2:3;return new _((t[e][0]+t[e][1])/2<<3|6,6|(t[2][0]!==i?0:65528))}}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=rf,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,i=e.vertexCount+e.vertexArrayOffset,n=e.flags&rf?nf:e.centroidXY,r=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==n.y||r!==n.x){for(let e=t;e<i;++e)this.centroidVertexArray.emplace(e,n.x,n.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped());if(function(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i].sourceId!==t[i].sourceId||!Rp(e[i],t[i]))return!1;return!0}(this.activeReplacements,i))return;if(this.activeReplacements=i,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const e of this.centroidData)e.flags&=2147483647;const n=[];for(const t of this.activeReplacements){const i=Math.pow(2,t.footprintTileId.canonical.z-e.canonical.z);for(const r of this.centroidData)if(!(r.flags&rf||t.min.x>r.max.x||r.min.x>t.max.x||t.min.y>r.max.y||r.min.y>t.max.y))for(let s=0;s<r.footprintSegLen;s++){const o=this.footprintSegments[r.footprintSegIdx+s];if(n.length=0,Ef(this.footprintVertices,o.vertexOffset,o.vertexCount,t.footprintTileId.canonical,e.canonical,n),Np(t.footprint,n,this.footprintIndices.uint16,o.indexOffset,o.indexCount,-o.vertexOffset,-i)){r.flags|=rf;break}}}for(const e of this.centroidData)this.writeCentroidToBuffer(e);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,i){let n=!1;for(let r=0;r<i.footprintSegLen;r++){const s=this.footprintSegments[i.footprintSegIdx+r];let o=0;for(const i of s.ringIndices){for(let r=o,a=i+o-1;r<i+o;a=r++){const i=this.footprintVertices.int16[2*(r+s.vertexOffset)+0],o=this.footprintVertices.int16[2*(r+s.vertexOffset)+1],l=this.footprintVertices.int16[2*(a+s.vertexOffset)+1];o>t!=l>t&&e<(this.footprintVertices.int16[2*(a+s.vertexOffset)+0]-i)*(t-o)/(l-o)+i&&(n=!n)}o=i}}return n}getHeightAtTileCoord(e,t){let i=Number.NEGATIVE_INFINITY,n=!0;const r=4*(e+ki)*ki+(t+ki);if(this.partLookup.hasOwnProperty(r)){const e=this.partLookup[r];return e?{height:e.height,hidden:!!(e.flags&rf)}:void 0}for(const s of this.centroidData)e>s.max.x||s.min.x>e||t>s.max.y||s.min.y>t||this.footprintContainsPoint(e,t,s)&&s&&s.height>i&&(i=s.height,this.partLookup[r]=s,n=!!(s.flags&rf));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:n};this.partLookup[r]=void 0}}function gf(e,t){const i=e.add(t)._unit();return e.x*i.x+e.y*i.y}function _f(e,t,i,n){const r=t.sub(e)._perp()._unit(),s=i.sub(t)._perp()._unit();return yf(e,t,i,gf(r,s),n)}function yf(e,t,i,n,r){const s=Math.sqrt(1-n*n);return Math.min(e.dist(t)/3,t.dist(i)/3,r*s/n)}function vf(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function xf(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function bf(e,t,i){if(e.x<0||e.x>=ki||t.x<0||t.x>=ki||i.x<0||i.x>=ki)return!1;const n=i.sub(t),r=n.perp(),s=e.sub(t);return(n.x*s.x+n.y*s.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(s.x*s.x+s.y*s.y))>-.866&&r.x*s.x+r.y*s.y<0}function wf(e,t,i){const n=t?2|e:-3&e;return i?1|n:-2&n}function Sf(){const e=Math.PI/32,t=Math.tan(e),i=Ja;return i*Math.sqrt(1+2*t*t)-i}function Tf(e,t,i){const n=1<<i.z,r=ml(i.x/n),s=ml((i.x+1)/n),o=gl(i.y/n),a=gl((i.y+1)/n);return function(e,t,i,n,r=0,s){const o=[];if(!e.length||!i||!n)return o;const a=(e,t)=>{for(const i of e)o.push({polygon:i,bounds:t})},l=Math.ceil(Math.log2(i)),c=Math.ceil(Math.log2(n)),u=l-c,h=[];for(let e=0;e<Math.abs(u);e++)h.push(u>0?0:1);for(let e=0;e<Math.min(l,c);e++)h.push(0),h.push(1);let d=e;if(d=Pp(d,t[0].y-r,t[1].y+r,1),d=Pp(d,t[0].x-r,t[1].x+r,0),!d.length)return o;const p=[];for(h.length?p.push({polygons:d,bounds:t,depth:0}):a(d,t);p.length;){const e=p.pop(),t=e.depth,i=h[t],n=e.bounds[0],o=e.bounds[1],l=0===i?n.x:n.y,c=0===i?o.x:o.y,u=s?s(i,l,c):.5*(l+c),d=Pp(e.polygons,l-r,u+r,i),f=Pp(e.polygons,u-r,c+r,i);if(d.length){const e=[n,new _(0===i?u:o.x,1===i?u:o.y)];h.length>t+1?p.push({polygons:d,bounds:e,depth:t+1}):a(d,e)}if(f.length){const e=[new _(0===i?u:n.x,1===i?u:n.y),o];h.length>t+1?p.push({polygons:f,bounds:e,depth:t+1}):a(f,e)}}return o}(e,t,Math.ceil((s-r)/11.25),Math.ceil((o-a)/11.25),1,((e,t,r)=>{if(0===e)return.5*(t+r);{const e=gl((i.y+t/ki)/n);return(pl(.5*(gl((i.y+r/ki)/n)+e))*n-i.y)*ki}}))}function Ef(e,t,i,n,r,s){const o=Math.pow(2,n.z-r.z);for(let a=0;a<i;a++){let i=e.int16[2*(a+t)+0],l=e.int16[2*(a+t)+1];i=(i+r.x*ki)*o-n.x*ki,l=(l+r.y*ki)*o-n.y*ki,s.push(new _(i,l))}}is(mf,"FillExtrusionBucket",{omit:["layers","features"]}),is(cf,"PartData"),is(lf,"FootprintSegment"),is(uf,"BorderCentroidData"),is(ff,"GroundEffect");const Mf=new Us({visibility:new zs(Gs["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new zs(Gs["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var If={paint:new Us({"fill-extrusion-opacity":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fs(Gs["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fs(Gs["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fs(Gs["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fs(Gs["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Fs(Gs["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Fs(Gs["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new zs(Gs["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:Mf};class Af extends _{constructor(e,t,i){super(e,t),this.z=i}}function Cf(e,t){return e.x*t.x+e.y*t.y}function Pf(e,t){if(1===e.length){let i=0;const n=t[i++];let r;for(;!r||n.equals(r);)if(r=t[i++],!r)return 1/0;for(;i<t.length;i++){const s=t[i],o=e[0],a=r.sub(n),l=s.sub(n),c=o.sub(n),u=Cf(a,a),h=Cf(a,l),d=Cf(l,l),p=Cf(c,a),f=Cf(c,l),m=u*d-h*h,g=(d*p-h*f)/m,_=(u*f-h*p)/m,y=n.z*(1-g-_)+r.z*g+s.z*_;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const i of t)e=Math.min(e,i.z);return e}}function kf(e,t,i,n,r,s,o,a){const l=o*r.getElevationAt(e,t,!0,!0),c=0!==s[0],u=c?0===s[1]?o*(s[0]/7-450):o*function(e,t,i){const n=Math.floor(t[0]/8),r=Math.floor(t[1]/8),s=10*(t[0]-8*n),o=10*(t[1]-8*r),a=e.getElevationAt(n,r,!0,!0),l=e.getMeterToDEM(i),c=Math.floor(.5*(s*l-1)),u=Math.floor(.5*(o*l-1)),h=e.tileCoordToPixel(n,r),d=2*c+1,p=2*u+1,f=function(e,t,i,n,r){return[e.getElevationAtPixel(t,i,!0),e.getElevationAtPixel(t+r,i,!0),e.getElevationAtPixel(t,i+r,!0),e.getElevationAtPixel(t+n,i+r,!0)]}(e,h.x-c,h.y-u,d,p),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),_=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*l*(m+g)/d),v=Math.min(.25,.5*l*_/p);return a+Math.max(y*s,v*o)}(r,s,a):l;return{base:l+(0===i)?-1:i,top:c?Math.max(u+n,l+i+2):l+n}}const Rf=uo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Lf}=Rf,Df=uo([{name:"a_packed",components:4,type:"Float32"}]),{members:Of}=Df;class Nf{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new vd({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const i=this.getKey(e,t);return this.positions[i]}trim(){const e=this.width,t=this.height=D(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,i){const n=[];let r=e.length%2==1?-e[e.length-1]*i:0,s=e[0]*i,o=!0;n.push({left:r,right:s,isDash:o,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){o=!o;const l=e[t];r=a*i,a+=l,s=a*i,n.push({left:r,right:s,isDash:o,zeroLength:0===l})}return n}addRoundDash(e,t,i){const n=t/2;for(let t=-i;t<=i;t++){const r=this.width*(this.nextRow+i+t);let s=0,o=e[s];for(let a=0;a<this.width;a++){a/o.right>1&&(o=e[++s]);const l=Math.abs(a-o.left),c=Math.abs(a-o.right),u=Math.min(l,c);let h;const d=t/i*(n+1);if(o.isDash){const e=n-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=n-Math.sqrt(u*u+d*d);this.image.data[r+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let t=e.length-1;t>=0;--t){const i=e[t],n=e[t+1];i.zeroLength?e.splice(t,1):n&&n.isDash===i.isDash&&(n.left=i.left,e.splice(t,1))}const i=e[0],n=e[e.length-1];i.isDash===n.isDash&&(i.left=n.left-this.width,n.right=i.right+this.width);const r=this.width*this.nextRow;let s=0,o=e[s];for(let i=0;i<this.width;i++){i/o.right>1&&(o=e[++s]);const n=Math.abs(i-o.left),a=Math.abs(i-o.right),l=Math.min(n,a);this.image.data[r+i]=Math.max(0,Math.min(255,(o.isDash?l:-l)+t+128))}}addDash(e,t){const i=this.getKey(e,t);if(this.positions[i])return this.positions[i];const n="round"===t,r=n?7:0,s=2*r+1;if(this.nextRow+s>this.height)return j("LineAtlas out of space"),null;0===e.length&&e.push(1);let o=0;for(let t=0;t<e.length;t++)e[t]<0&&(j("Negative value is found in line dasharray, replacing values with 0"),e[t]=0),o+=e[t];if(0!==o){const i=this.width/o,s=this.getDashRanges(e,this.width,i);n?this.addRoundDash(s,i,r):this.addRegularDash(s,"square"===t?.5*i:0)}const a=this.nextRow+r;this.nextRow+=s;const l={tl:[a,r],br:[o,0]};return this.positions[i]=l,l}}is(Nf,"LineAtlas");const zf=Cp.types,Ff=Math.cos(Math.PI/180*37.5);class Bf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new _o,this.layoutVertexArray2=new yo,this.indexArray=new Po,this.programConfigurations=new Na(e.layers,e.zoom),this.segments=new ia,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i,n){this.hasPattern=sp("line",this.layers,t);const r=this.layers[0].layout.get("line-sort-key"),s=[];for(const{feature:t,id:o,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Rl(t,e);if(!this.layers[0]._featureFilter.filter(new As(this.zoom),c,i))continue;const u=r?r.evaluate(c,{},i):void 0,h={id:o,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:kl(t,i,n),patterns:{},sortKey:u};s.push(h)}r&&s.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:o,featureIndex:a}=t,l=this.addConstantDashes(o);for(const n of s){const{geometry:r,index:s,sourceLayerIndex:c}=n;if(l&&this.addFeatureDashes(n,o),this.hasPattern){const e=op("line",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,r,s,i,o.positions,t.availableImages,t.brightness);a.insert(e[s].feature,r,s,c,this.index)}}addConstantDashes(e){let t=!1;for(const i of this.layers){const n=i.paint.get("line-dasharray").value,r=i.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==r.kind)t=!0;else{const t=r.value,i=n.value;if(!i)continue;e.addDash(i,t)}}return t}addFeatureDashes(e,t){const i=this.zoom;for(const n of this.layers){const r=n.paint.get("line-dasharray").value,s=n.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===s.kind)continue;let o,a;if("constant"===r.kind){if(o=r.value,!o)continue}else o=r.evaluate({zoom:i},e);a="constant"===s.kind?s.value:s.evaluate({zoom:i},e),t.addDash(o,a),e.patterns[n.id]=t.getKey(o,a)}}update(e,t,i,n,r){const s=0!==Object.keys(e).length;s&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,s?this.stateDependentLayers:this.layers,i,n,r)}addFeatures(e,t,i,n,r,s){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i,n,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Of)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,i,n,r,s,o){const a=this.layers[0].layout,l=a.get("line-join").evaluate(e,{}),c=a.get("line-cap").evaluate(e,{}),u=a.get("line-miter-limit"),h=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const i of t)this.addLine(i,e,l,c,u,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,s,n,o)}addLine(e,t,i,n,r,s){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const o="Polygon"===zf[t.type];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;let l=0;for(;l<a-1&&e[l].equals(e[l+1]);)l++;if(a<(o?3:2))return;"bevel"===i&&(r=1.05);const c=this.overscaling<=16?15*ki/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,o&&(h=e[a-2],m=e[l].sub(h)._unit()._perp());for(let t=l;t<a;t++){if(p=t===a-1?o?e[l+1]:void 0:e[t+1],p&&e[t].equals(p))continue;m&&(f=m),h&&(d=h),h=e[t],m=p?p.sub(h)._unit()._perp():f,f=f||m;let g=f.add(m);0===g.x&&0===g.y||g._unit();const _=f.x*m.x+f.y*m.y,y=g.x*m.x+g.y*m.y,v=0!==y?1/y:1/0,x=2*Math.sqrt(2-2*y),b=y<Ff&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&t>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,u),d=t}}const S=d&&p;let T=S?i:o?"butt":n;if(S&&"round"===T&&(v<s?T="miter":v<=2&&(T="fakeround")),"miter"===T&&v>r&&(T="bevel"),"bevel"===T&&(v>2&&(T="flipbevel"),v<r&&(T="miter")),d&&this.updateDistance(d,h),"miter"===T)g._mult(v),this.addCurrentVertex(h,g,0,0,u);else if("flipbevel"===T){if(v>100)g=m.mult(-1);else{const e=v*f.add(m).mag()/f.sub(m).mag();g._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(h,g,0,0,u),this.addCurrentVertex(h,g.mult(-1),0,0,u)}else if("bevel"===T||"fakeround"===T){const e=-Math.sqrt(v*v-1),t=w?e:0,i=w?0:e;if(d&&this.addCurrentVertex(h,f,t,i,u),"fakeround"===T){const e=Math.round(180*x/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*e*e+(.848013+_*(.215638*_-1.06021)))}const n=m.sub(f)._mult(i)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,n.x,n.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-t,-i,u)}else if("butt"===T)this.addCurrentVertex(h,g,0,0,u);else if("square"===T){const e=d?1:-1;d||this.addCurrentVertex(h,g,e,e,u),this.addCurrentVertex(h,g,0,0,u),d&&this.addCurrentVertex(h,g,e,e,u)}else"round"===T&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&t<a-1){const e=h.dist(p);if(e>2*c){const t=h.add(p.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,u),h=t}}}}addCurrentVertex(e,t,i,n,r,s=!1){const o=t.y*n-t.x,a=-t.y-t.x*n;this.addHalfVertex(e,t.x+t.y*i,t.y-t.x*i,s,!1,i,r),this.addHalfVertex(e,o,a,s,!0,-n,r)}addHalfVertex({x:e,y:t},i,n,r,s,o,a){this.layoutVertexArray.emplaceBack((e<<1)+(r?1:0),(t<<1)+(s?1:0),Math.round(63*i)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),s?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}is(Bf,"LineBucket",{omit:["layers","patternFeatures"]});const Uf=new Us({"line-cap":new Fs(Gs.layout_line["line-cap"]),"line-join":new Fs(Gs.layout_line["line-join"]),"line-miter-limit":new zs(Gs.layout_line["line-miter-limit"]),"line-round-limit":new zs(Gs.layout_line["line-round-limit"]),"line-sort-key":new Fs(Gs.layout_line["line-sort-key"]),visibility:new zs(Gs.layout_line.visibility)});var Vf={paint:new Us({"line-opacity":new Fs(Gs.paint_line["line-opacity"]),"line-color":new Fs(Gs.paint_line["line-color"]),"line-translate":new zs(Gs.paint_line["line-translate"]),"line-translate-anchor":new zs(Gs.paint_line["line-translate-anchor"]),"line-width":new Fs(Gs.paint_line["line-width"]),"line-gap-width":new Fs(Gs.paint_line["line-gap-width"]),"line-offset":new Fs(Gs.paint_line["line-offset"]),"line-blur":new Fs(Gs.paint_line["line-blur"]),"line-dasharray":new Fs(Gs.paint_line["line-dasharray"]),"line-pattern":new Fs(Gs.paint_line["line-pattern"]),"line-gradient":new Bs(Gs.paint_line["line-gradient"]),"line-trim-offset":new zs(Gs.paint_line["line-trim-offset"]),"line-emissive-strength":new zs(Gs.paint_line["line-emissive-strength"]),"line-border-width":new Fs(Gs.paint_line["line-border-width"]),"line-border-color":new Fs(Gs.paint_line["line-border-color"])}),layout:Uf};function jf(e,t,i){return t*(ki/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}function Gf(e,t){return 1/jf(e,1,t.tileZoom)}function Hf(e,t,i,n){return e.translatePosMatrix(n||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Wf=e=>{const t=[];qf(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const i=e.paint.get("line-trim-offset");return 0===i[0]&&0===i[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER"),t};function qf(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const $f=new class extends Fs{possiblyEvaluate(e,t){return t=new As(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,n){return t=P({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,n)}}(Vf.paint.properties["line-width"].specification);function Zf(e,t){return t>0?t+2*e:e}$f.useIntegerZoom=!0;const Xf=uo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Yf=uo([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Kf=uo([{name:"a_projected_pos",components:4,type:"Float32"}],4);uo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jf=uo([{name:"a_z_offset",components:1,type:"Float32"}],4),Qf=uo([{name:"a_texb",components:2,type:"Uint16"}]),em=uo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),tm=uo([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);uo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const im=uo([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nm=uo([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);uo([{name:"triangle",components:3,type:"Uint16"}]),uo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),uo([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),uo([{type:"Float32",name:"offsetX"}]),uo([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var rm=24;const sm=128;function om(e,t){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new As(e+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:n}=i;let r=0;for(;r<t.length&&t[r]<=e;)r++;r=Math.max(0,r-1);let s=r;for(;s<t.length&&t[s]<e+1;)s++;s=Math.min(t.length-1,s);const o=t[r],a=t[s];return"composite"===i.kind?{kind:"composite",minZoom:o,maxZoom:a,interpolationType:n}:{kind:"camera",minZoom:o,maxZoom:a,minSize:i.evaluate(new As(o)),maxSize:i.evaluate(new As(a)),interpolationType:n}}}function am(e,{uSize:t,uSizeT:i},{lowerSize:n,upperSize:r}){return"source"===e.kind?n/sm:"composite"===e.kind?ct(n/sm,r/sm,i):t}function lm(e,t){let i=0,n=0;if("constant"===e.kind)n=e.layoutSize;else if("source"!==e.kind){const{interpolationType:r,minZoom:s,maxZoom:o}=e,a=r?M(qn.interpolationFactor(r,t,s,o),0,1):0;"camera"===e.kind?n=ct(e.minSize,e.maxSize,a):i=a}return{uSizeT:i,uSize:n}}var cm=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:sm,evaluateSizeForFeature:am,evaluateSizeForZoom:lm,getSizeData:om});function um(e,t,i){return e.sections.forEach((e=>{e.text=function(e,t,i){const n=t.layout.get("text-transform").evaluate(i,{});return"uppercase"===n?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),Is.applyArabicShaping&&(e=Is.applyArabicShaping(e)),e}(e.text,t,i)})),e}const hm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function dm(e){return""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e}function pm(e){return""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e}var fm={read:function(e,t,i,n,r){var s,o,a=8*r-n-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?r-1:0,d=i?-1:1,p=e[t+h];for(h+=d,s=p&(1<<-u)-1,p>>=-u,u+=a;u>0;s=256*s+e[t+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=256*o+e[t+h],h+=d,u-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),s-=c}return(p?-1:1)*o*Math.pow(2,s-n)},write:function(e,t,i,n,r,s){var o,a,l,c=8*s-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:s-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(t*l-1)*Math.pow(2,r),o+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;e[i+p]=255&a,p+=f,a/=256,r-=8);for(o=o<<r|a,c+=r;c>0;e[i+p]=255&o,p+=f,o/=256,c-=8);e[i+p-f]|=128*m}},mm=_m,gm=fm;function _m(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}_m.Varint=0,_m.Fixed64=1,_m.Bytes=2,_m.Fixed32=5;var ym=4294967296,vm=1/ym,xm="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function bm(e){return e.type===_m.Bytes?e.readVarint()+e.pos:e.pos+1}function wm(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Sm(e,t,i){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=e;r--)i.buf[r+n]=i.buf[r]}function Tm(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function Em(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function Mm(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function Im(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function Am(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function Cm(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function Pm(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function km(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function Rm(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Lm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Dm(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function Om(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}_m.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,s=this.pos;this.type=7&n,e(r,t,this),this.pos===s&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Lm(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Om(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Lm(this.buf,this.pos)+Lm(this.buf,this.pos+4)*ym;return this.pos+=8,e},readSFixed64:function(){var e=Lm(this.buf,this.pos)+Om(this.buf,this.pos+4)*ym;return this.pos+=8,e},readFloat:function(){var e=gm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=gm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,n=this.buf;return t=127&(i=n[this.pos++]),i<128?t:(t|=(127&(i=n[this.pos++]))<<7,i<128?t:(t|=(127&(i=n[this.pos++]))<<14,i<128?t:(t|=(127&(i=n[this.pos++]))<<21,i<128?t:function(e,t,i){var n,r,s=i.buf;if(n=(112&(r=s[i.pos++]))>>4,r<128)return wm(e,n,t);if(n|=(127&(r=s[i.pos++]))<<3,r<128)return wm(e,n,t);if(n|=(127&(r=s[i.pos++]))<<10,r<128)return wm(e,n,t);if(n|=(127&(r=s[i.pos++]))<<17,r<128)return wm(e,n,t);if(n|=(127&(r=s[i.pos++]))<<24,r<128)return wm(e,n,t);if(n|=(1&(r=s[i.pos++]))<<31,r<128)return wm(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&xm?function(e,t,i){return xm.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var n="",r=t;r<i;){var s,o,a,l=e[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(s=e[r+1]))&&(c=(31&l)<<6|63&s)<=127&&(c=null):3===u?(o=e[r+2],128==(192&(s=e[r+1]))&&128==(192&o)&&((c=(15&l)<<12|(63&s)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(o=e[r+2],a=e[r+3],128==(192&(s=e[r+1]))&&128==(192&o)&&128==(192&a)&&((c=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=u}return n}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==_m.Bytes)return e.push(this.readVarint(t));var i=bm(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==_m.Bytes)return e.push(this.readSVarint());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==_m.Bytes)return e.push(this.readBoolean());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==_m.Bytes)return e.push(this.readFloat());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==_m.Bytes)return e.push(this.readDouble());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==_m.Bytes)return e.push(this.readFixed32());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==_m.Bytes)return e.push(this.readSFixed32());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==_m.Bytes)return e.push(this.readFixed64());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==_m.Bytes)return e.push(this.readSFixed64());var t=bm(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===_m.Varint)for(;this.buf[this.pos++]>127;);else if(t===_m.Bytes)this.pos=this.readVarint()+this.pos;else if(t===_m.Fixed32)this.pos+=4;else{if(t!==_m.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Dm(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Dm(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Dm(this.buf,-1&e,this.pos),Dm(this.buf,Math.floor(e*vm),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Dm(this.buf,-1&e,this.pos),Dm(this.buf,Math.floor(e*vm),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,n;if(e>=0?(i=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,n=n+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,i.buf[i.pos]=127&(e>>>=7)}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var n,r,s=0;s<t.length;s++){if((n=t.charCodeAt(s))>55295&&n<57344){if(!r){n>56319||s+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):r=n;continue}if(n<56320){e[i++]=239,e[i++]=191,e[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(e[i++]=239,e[i++]=191,e[i++]=189,r=null);n<128?e[i++]=n:(n<2048?e[i++]=n>>6|192:(n<65536?e[i++]=n>>12|224:(e[i++]=n>>18|240,e[i++]=n>>12&63|128),e[i++]=n>>6&63|128),e[i++]=63&n|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&Sm(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),gm.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),gm.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var n=this.pos-i;n>=128&&Sm(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,i){this.writeTag(e,_m.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Tm,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Em,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Am,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Mm,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Im,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Cm,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Pm,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,km,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Rm,t)},writeBytesField:function(e,t){this.writeTag(e,_m.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,_m.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,_m.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,_m.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,_m.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,_m.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,_m.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,_m.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,_m.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,_m.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Nm=h(mm);const zm=3;function Fm(e,t,i){t.glyphs=[],1===e&&i.readMessage(Bm,t)}function Bm(e,t,i){if(3===e){const{id:e,bitmap:n,width:r,height:s,left:o,top:a,advance:l}=i.readMessage(Um,{});t.glyphs.push({id:e,bitmap:new vd({width:r+2*zm,height:s+2*zm},n),metrics:{width:r,height:s,left:o,top:a,advance:l}})}else 4===e?t.ascender=i.readSVarint():5===e&&(t.descender=i.readSVarint())}function Um(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint())}const Vm=zm,jm={horizontal:1,vertical:2,horizontalOnly:3};class Gm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const i=new Gm;return i.scale=e||1,i.fontStack=t,i}static forImage(e){const t=new Gm;return t.imageName=e,t}}class Hm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const i=new Hm;for(let n=0;n<e.sections.length;n++){const r=e.sections[n];r.image?i.addImageSection(r):i.addTextSection(r,t)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let i="";for(let n=0;n<e.length;n++){const r=e.charCodeAt(n+1)||null,s=e.charCodeAt(n-1)||null;i+=!t&&(r&&ds(r)&&!hm[e[n+1]]||s&&ds(s)&&!hm[e[n-1]])||!hm[e[n]]?e[n]:hm[e[n]]}return i}(this.text,e)}trim(){let e=0;for(let t=0;t<this.text.length&&qm[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&qm[this.text.charCodeAt(i)];i--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const i=new Hm;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Gm.forText(e.scale,e.fontStack||t));const i=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(i)}addImageSection(e){const t=e.image?e.image.namePrimary:"";if(0===t.length)return void j("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(Gm.forImage(t)),this.sectionIndex.push(this.sections.length-1)):j("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wm(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f){const m=Hm.fromFeature(e,r);h===jm.vertical&&m.verticalizePunctuation(d);let g=[];const _=function(e,t,i,n,r,s){if(!e)return[];const o=[],a=function(e,t,i,n,r,s){let o=0;for(let i=0;i<e.length();i++){const a=e.getSection(i);o+=Zm(e.getCodePoint(i),a,n,r,t,s)}return o/Math.max(1,Math.ceil(o/i))}(e,t,i,n,r,s),l=e.text.indexOf("")>=0;let c=0;for(let i=0;i<e.length();i++){const h=e.getSection(i),d=e.getCodePoint(i);if(qm[d]||(c+=Zm(d,h,n,r,t,s)),i<e.length()-1){const t=!((u=d)<11904||!(as["Bopomofo Extended"](u)||as.Bopomofo(u)||as["CJK Compatibility Forms"](u)||as["CJK Compatibility Ideographs"](u)||as["CJK Compatibility"](u)||as["CJK Radicals Supplement"](u)||as["CJK Strokes"](u)||as["CJK Symbols and Punctuation"](u)||as["CJK Unified Ideographs Extension A"](u)||as["CJK Unified Ideographs"](u)||as["Enclosed CJK Letters and Months"](u)||as["Halfwidth and Fullwidth Forms"](u)||as.Hiragana(u)||as["Ideographic Description Characters"](u)||as["Kangxi Radicals"](u)||as["Katakana Phonetic Extensions"](u)||as.Katakana(u)||as["Vertical Forms"](u)||as["Yi Radicals"](u)||as["Yi Syllables"](u)));($m[d]||t||h.imageName)&&o.push(Km(i+1,c,a,o,Ym(d,e.getCodePoint(i+1),t&&l),!1))}}var u;return Jm(Km(e.length(),c,a,o,0,!0))}(m,c,s,t,n,p),{processBidirectionalText:y,processStyledBidirectionalText:v}=Is;if(y&&1===m.sections.length){const e=y(m.toString(),_);for(const t of e){const e=new Hm;e.text=t,e.sections=m.sections;for(let i=0;i<t.length;i++)e.sectionIndex.push(0);g.push(e)}}else if(v){const e=v(m.text,m.sectionIndex,_);for(const t of e){const e=new Hm;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,g.push(e)}}else g=function(e,t){const i=[],n=e.text;let r=0;for(const n of t)i.push(e.substring(r,n)),r=n;return r<n.length&&i.push(e.substring(r,n.length)),i}(m,_);const x=[],b={positionedLines:x,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,i,n,r,s,o,a,l,c,u,h){let d=0,p=0,f=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const e of r){const i=e.getSections();for(const e of i){if(e.imageName)continue;const i=t[e.fontStack];if(i&&(g=void 0!==i.ascender&&void 0!==i.descender,!g))break}if(!g)break}let _=0;for(const o of r){o.trim();const r=o.getMaxScale(),a=(r-1)*rm,v={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=v;const x=v.positionedGlyphs;let b=0;if(!o.length()){p+=s,++_;continue}let w=0,S=0;for(let s=0;s<o.length();s++){const a=o.getSection(s),f=o.getSectionIndex(s),m=o.getCodePoint(s);let _=a.scale,v=null,T=null,E=null,M=rm,I=0;const A=!(l===jm.horizontal||!u&&!hs(m)||u&&(qm[m]||(y=m,as.Arabic(y)||as["Arabic Supplement"](y)||as["Arabic Extended-A"](y)||as["Arabic Presentation Forms-A"](y)||as["Arabic Presentation Forms-B"](y))));if(a.imageName){const t=n[a.imageName];if(!t)continue;E=a.imageName,e.iconsInText=e.iconsInText||!0,T=t.paddedRect;const i=t.displaySize;_=_*rm/h,v={width:i[0],height:i[1],left:0,top:-Vm,advance:A?i[1]:i[0],localGlyph:!1},I=g?-v.height*_:r*rm-17-i[1]*_,M=v.advance;const s=(A?i[0]:i[1])*_-rm*r;s>0&&s>b&&(b=s)}else{const e=i[a.fontStack];if(!e)continue;e[m]&&(T=e[m]);const n=t[a.fontStack];if(!n)continue;const s=n.glyphs[m];if(!s)continue;if(v=s.metrics,M=8203!==m?rm:0,g){const e=void 0!==n.ascender?Math.abs(n.ascender):0,t=void 0!==n.descender?Math.abs(n.descender):0,i=(e+t)*_;w<i&&(w=i,S=(e-t)/2*_),I=-e*_}else I=(r-_)*rm-17}A?(e.verticalizable=!0,x.push({glyph:m,imageName:E,x:d,y:p+I,vertical:A,scale:_,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:T}),d+=M*_+c):(x.push({glyph:m,imageName:E,x:d,y:p+I,vertical:A,scale:_,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:T}),d+=v.advance*_+c)}0!==x.length&&(f=Math.max(d-c,f),g?eg(x,m,b,S,s*r/2):eg(x,m,b,0,s/2)),d=0;const T=s*r+b;v.lineOffset=Math.max(b,a),p+=T,++_}var y;const v=p,{horizontalAlign:x,verticalAlign:b}=Qm(o);(function(e,t,i,n,r,s){const o=(t-i)*r,a=-s*n;for(const t of e)for(const e of t.positionedGlyphs)e.x+=o,e.y+=a})(e.positionedLines,m,x,b,f,v),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*f,e.right=e.left+f,e.hasBaseline=g}(b,t,i,n,g,o,a,l,h,c,d,f),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x)&&b}const qm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},$m={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Zm(e,t,i,n,r,s){if(t.imageName){const e=n[t.imageName];return e?e.displaySize[0]*t.scale*rm/s+r:0}{const n=i[t.fontStack],s=n&&n.glyphs[e];return s?s.metrics.advance*t.scale+r:0}}function Xm(e,t,i,n){const r=Math.pow(e-t,2);return n?e<t?r/2:2*r:r+Math.abs(i)*i}function Ym(e,t,i){let n=0;return 10===e&&(n-=1e4),i&&(n+=150),40!==e&&65288!==e||(n+=50),41!==t&&65289!==t||(n+=50),n}function Km(e,t,i,n,r,s){let o=null,a=Xm(t,i,r,s);for(const e of n){const n=Xm(t-e.x,i,r,s)+e.badness;n<=a&&(o=e,a=n)}return{index:e,x:t,priorBreak:o,badness:a}}function Jm(e){return e?Jm(e.priorBreak).concat(e.index):[]}function Qm(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function eg(e,t,i,n,r){if(!(t||i||n||r))return;const s=e.length-1,o=e[s],a=(o.x+o.metrics.advance*o.scale)*t;for(let t=0;t<=s;t++)e[t].x-=a,e[t].y+=i+n+r}function tg(e,t,i,n){const{horizontalAlign:r,verticalAlign:s}=Qm(n),o=i[0]-e.displaySize[0]*r,a=i[1]-e.displaySize[1]*s;return{imagePrimary:e,imageSecondary:t,top:a,bottom:a+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function ig(e,t,i,n,r,s){const o=e.imagePrimary;let a;if(o.content){const e=o.content,t=o.pixelRatio||1;a=[e[0]/t,e[1]/t,o.displaySize[0]-e[2]/t,o.displaySize[1]-e[3]/t]}const l=t.left*s,c=t.right*s;let u,h,d,p;"width"===i||"both"===i?(p=r[0]+l-n[3],h=r[0]+c+n[1]):(p=r[0]+(l+c-o.displaySize[0])/2,h=p+o.displaySize[0]);const f=t.top*s,m=t.bottom*s;return"height"===i||"both"===i?(u=r[1]+f-n[0],d=r[1]+m+n[2]):(u=r[1]+(f+m-o.displaySize[1])/2,d=u+o.displaySize[1]),{imagePrimary:o,imageSecondary:void 0,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class ng extends _{constructor(e,t,i,n,r){super(e,t),this.angle=n,this.z=i,void 0!==r&&(this.segment=r)}clone(){return new ng(this.x,this.y,this.z,this.angle,this.segment)}}function rg(e,t,i,n,r){if(void 0===t.segment)return!0;let s=t,o=t.segment+1,a=0;for(;a>-i/2;){if(o--,o<0)return!1;a-=e[o].dist(s),s=e[o]}a+=e[o].dist(e[o+1]),o++;const l=[];let c=0;for(;a<i/2;){const t=e[o],i=e[o+1];if(!i)return!1;let s=e[o-1].angleTo(t)-t.angleTo(i);for(s=Math.abs((s+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:s}),c+=s;a-l[0].distance>n;)c-=l.shift().angleDelta;if(c>r)return!1;o++,a+=t.dist(i)}return!0}function sg(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function og(e,t,i){return e?.6*t*i:0}function ag(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function lg(e,t,i,n,r,s){const o=og(i,r,s),a=ag(i,n)*s;let l=0;const c=sg(e)/2;for(let i=0;i<e.length-1;i++){const n=e[i],r=e[i+1],s=n.dist(r);if(l+s>c){const u=(c-l)/s,h=ct(n.x,r.x,u),d=ct(n.y,r.y,u),p=new ng(h,d,0,r.angleTo(n),i);return!o||rg(e,p,a,o,t)?p:void 0}l+=s}}function cg(e,t,i,n,r,s,o,a,l){const c=og(n,s,o),u=ag(n,r),h=u*o,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),ug(e,d?t/2*a%t:(u/2+2*s)*o*a%t,t,c,i,h,d,!1,l)}function ug(e,t,i,n,r,s,o,a,l){const c=s/2,u=sg(e);let h=0,d=t-i,p=[];for(let t=0;t<e.length-1;t++){const o=e[t],a=e[t+1],f=o.dist(a),m=a.angleTo(o);for(;d+i<h+f;){d+=i;const g=(d-h)/f,_=ct(o.x,a.x,g),y=ct(o.y,a.y,g);if(_>=0&&_<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const i=new ng(_,y,0,m,t);n&&!rg(e,i,s,n,r)||p.push(i)}}h+=f}return a||p.length||o||(p=ug(e,h/2,i,n,r,s,o,!0,l)),p}function hg(e,t,i,n,r){const s=[];for(let o=0;o<e.length;o++){const a=e[o];let l;for(let e=0;e<a.length-1;e++){let o=a[e],c=a[e+1];o.x<t&&c.x<t||(o.x<t?o=new _(t,o.y+(t-o.x)/(c.x-o.x)*(c.y-o.y))._round():c.x<t&&(c=new _(t,o.y+(t-o.x)/(c.x-o.x)*(c.y-o.y))._round()),o.y<i&&c.y<i||(o.y<i?o=new _(o.x+(i-o.y)/(c.y-o.y)*(c.x-o.x),i)._round():c.y<i&&(c=new _(o.x+(i-o.y)/(c.y-o.y)*(c.x-o.x),i)._round()),o.x>=n&&c.x>=n||(o.x>=n?o=new _(n,o.y+(n-o.x)/(c.x-o.x)*(c.y-o.y))._round():c.x>=n&&(c=new _(n,o.y+(n-o.x)/(c.x-o.x)*(c.y-o.y))._round()),o.y>=r&&c.y>=r||(o.y>=r?o=new _(o.x+(r-o.y)/(c.y-o.y)*(c.x-o.x),r)._round():c.y>=r&&(c=new _(o.x+(r-o.y)/(c.y-o.y)*(c.x-o.x),r)._round()),l&&o.equals(l[l.length-1])||(l=[o],s.push(l)),l.push(c)))))}}return s}function dg(e){let t=0,i=0;for(const n of e)t+=n.w*n.h,i=Math.max(i,n.w);e.sort(((e,t)=>t.h-e.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let r=0,s=0;for(const t of e)for(let e=n.length-1;e>=0;e--){const i=n[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,s=Math.max(s,t.y+t.h),r=Math.max(r,t.x+t.w),t.w===i.w&&t.h===i.h){const t=n.pop();e<n.length&&(n[e]=t)}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(n.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return{w:r,h:s,fill:t/(r*s)||0}}is(ng,"Anchor");const pg=1;class fg{constructor(e,{pixelRatio:t,version:i,stretchX:n,stretchY:r,content:s}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=n,this.stretchY=r,this.content=s,this.version=i}get tl(){return[this.paddedRect.x+pg,this.paddedRect.y+pg]}get br(){return[this.paddedRect.x+this.paddedRect.w-pg,this.paddedRect.y+this.paddedRect.h-pg]}get displaySize(){return[(this.paddedRect.w-2*pg)/this.pixelRatio,(this.paddedRect.h-2*pg)/this.pixelRatio]}}class mg{constructor(e,t){const i={},n={};this.haveRenderCallbacks=[];const r=[];this.addImages(e,i,r),this.addImages(t,n,r);const{w:s,h:o}=dg(r),a=new xd({width:s||1,height:o||1});for(const t in e){const n=e[t],r=i[t].paddedRect;xd.copy(n.data,a,{x:0,y:0},{x:r.x+pg,y:r.y+pg},n.data,n.sdf)}for(const e in t){const i=t[e],r=n[e].paddedRect,s=r.x+pg,o=r.y+pg,l=i.data.width,c=i.data.height;xd.copy(i.data,a,{x:0,y:0},{x:s,y:o},i.data),xd.copy(i.data,a,{x:0,y:c-1},{x:s,y:o-1},{width:l,height:1}),xd.copy(i.data,a,{x:0,y:0},{x:s,y:o+c},{width:l,height:1}),xd.copy(i.data,a,{x:l-1,y:0},{x:s-1,y:o},{width:1,height:c}),xd.copy(i.data,a,{x:0,y:0},{x:s+l,y:o},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=n}addImages(e,t,i){for(const n in e){const r=e[n],s={x:0,y:0,w:r.data.width+2*pg,h:r.data.height+2*pg};i.push(s),t[n]=new fg(s,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(e,t,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t,i))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const n in e.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[n],e.getImage(n,i),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n,i),t)}patchUpdatedImage(e,t,i){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[n,r]=e.tl,s=!!Object.keys(this.patternPositions).length;i.update(t.data,{useMipmap:s},{x:n,y:r})}}is(fg,"ImagePosition"),is(mg,"ImageAtlas");const gg=1e20;function _g(e,t,i,n,r,s,o,a,l){for(let c=t;c<t+n;c++)yg(e,i*s+c,s,r,o,a,l);for(let c=i;c<i+r;c++)yg(e,c*s+t,1,n,o,a,l)}function yg(e,t,i,n,r,s,o){s[0]=0,o[0]=-gg,o[1]=gg,r[0]=e[t];for(let a=1,l=0,c=0;a<n;a++){r[a]=e[t+a*i];const n=a*a;do{const e=s[l];c=(r[a]-r[e]+n-e*e)/(a-e)/2}while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=gg}for(let a=0,l=0;a<n;a++){for(;o[l+1]<a;)l++;const n=s[l],c=a-n;e[t+a*i]=r[n]+c*c}}const vg=2,xg={none:0,ideographs:1,all:2};class bg{constructor(e,t,i){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,t){this.urls[t]=e}getGlyphs(e,t,i){const r=[],s=this.urls[t]||n.GLYPHS_URL;for(const t in e)for(const i of e[t])r.push({stack:t,id:i});C(r,(({stack:e,id:t},i)=>{let n=this.entries[e];n||(n=this.entries[e]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let r=n.glyphs[t];if(void 0!==r)return void i(null,{stack:e,id:t,glyph:r});if(r=this._tinySDF(n,e,t),r)return n.glyphs[t]=r,void i(null,{stack:e,id:t,glyph:r});const o=Math.floor(t/256);if(256*o>65535)return void i(new Error("glyphs > 65535 not supported"));if(n.ranges[o])return void i(null,{stack:e,id:t,glyph:r});let a=n.requests[o];a||(a=n.requests[o]=[],bg.loadGlyphRange(e,o,s,this.requestManager,((e,t)=>{if(t){n.ascender=t.ascender,n.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(n.glyphs[+e]=t.glyphs[+e]);n.ranges[o]=!0}for(const i of a)i(e,t);delete n.requests[o]}))),a.push(((n,r)=>{n?i(n):r&&i(null,{stack:e,id:t,glyph:r.glyphs[t]||null})}))}),((e,t)=>{if(e)i(e);else if(t){const e={};for(const{stack:i,id:n,glyph:r}of t)void 0===e[i]&&(e[i]={}),void 0===e[i].glyphs&&(e[i].glyphs={}),e[i].glyphs[n]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics},e[i].ascender=this.entries[i].ascender,e[i].descender=this.entries[i].descender;i(null,e)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==xg.none&&(this.localGlyphMode===xg.all?!!this.localFontFamily:!!this.localFontFamily&&(as["CJK Unified Ideographs"](e)||as["Hangul Syllables"](e)||as.Hiragana(e)||as.Katakana(e)||as["CJK Symbols and Punctuation"](e)||as["CJK Unified Ideographs Extension A"](e)||as["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,t,i){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(i))return;let r=e.tinySDF;if(!r){let i="400";/bold/i.test(t)?i="900":/medium/i.test(t)?i="500":/light/i.test(t)&&(i="200"),r=e.tinySDF=new bg.TinySDF({fontFamily:n,fontWeight:i,fontSize:24*vg,buffer:3*vg,radius:8*vg}),r.fontWeight=i}if(this.localGlyphs[r.fontWeight][i])return this.localGlyphs[r.fontWeight][i];const s=String.fromCodePoint(i),{data:o,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=r.draw(s);return this.localGlyphs[r.fontWeight][i]={id:i,bitmap:new vd({width:a,height:l},o),metrics:{width:c/vg,height:u/vg,left:h/vg,top:d/vg-27,advance:p/vg,localGlyph:!0}}}}bg.loadGlyphRange=function(e,t,i,n,r){const s=256*t,o=s+255,a=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",`${s}-${o}`),Te.Glyphs);Ae(a,((e,t)=>{if(e)r(e);else if(t){const e={},i=function(e){return new Nm(e).readFields(Fm,{})}(t);for(const t of i.glyphs)e[t.id]=t;r(null,{glyphs:e,ascender:i.ascender,descender:i.descender})}}))},bg.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:n=.25,fontFamily:r="sans-serif",fontWeight:s="normal",fontStyle:o="normal"}={}){this.buffer=t,this.cutoff=n,this.radius=i;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${o} ${s} ${e}px ${r}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:r,actualBoundingBoxRight:s}=this.ctx.measureText(e),o=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-r))),l=Math.min(this.size-this.buffer,o+Math.ceil(n)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this;f.clearRect(m,m,a,l),f.fillText(e,m,m+o);const y=f.getImageData(m,m,a,l);_.fill(gg,0,h),g.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const i=y.data[4*(e*a+t)+3]/255;if(0===i)continue;const n=(e+m)*c+t+m;if(1===i)_[n]=0,g[n]=gg;else{const e=.5-i;_[n]=e>0?e*e:0,g[n]=e<0?e*e:0}}_g(_,0,0,c,u,c,this.f,this.v,this.z),_g(g,m,m,a,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(_[e])-Math.sqrt(g[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};const wg=pg;function Sg(e,t,i,n){const r=[],s=e.imagePrimary,o=s.pixelRatio,a=s.paddedRect.w-2*wg,l=s.paddedRect.h-2*wg,c=e.right-e.left,u=e.bottom-e.top,h=s.stretchX||[[0,a]],d=s.stretchY||[[0,l]],p=(e,t)=>e+t[1]-t[0],f=h.reduce(p,0),m=d.reduce(p,0),g=a-f,y=l-m;let v=0,x=f,b=0,w=m,S=0,T=g,E=0,M=y;if(s.content&&n){const e=s.content;v=Tg(h,0,e[0]),b=Tg(d,0,e[1]),x=Tg(h,e[0],e[2]),w=Tg(d,e[1],e[3]),S=e[0]-v,E=e[1]-b,T=e[2]-e[0]-x,M=e[3]-e[1]-w}const I=(n,r,a,l)=>{const h=Mg(n.stretch-v,x,c,e.left),d=Ig(n.fixed-S,T,n.stretch,f),p=Mg(r.stretch-b,w,u,e.top),g=Ig(r.fixed-E,M,r.stretch,m),y=Mg(a.stretch-v,x,c,e.left),I=Ig(a.fixed-S,T,a.stretch,f),A=Mg(l.stretch-b,w,u,e.top),C=Ig(l.fixed-E,M,l.stretch,m),P=new _(h,p),k=new _(y,p),R=new _(y,A),L=new _(h,A),D=new _(d/o,g/o),O=new _(I/o,C/o),N=t*Math.PI/180;if(N){const e=Math.sin(N),t=Math.cos(N),i=[t,-e,e,t];P._matMult(i),k._matMult(i),L._matMult(i),R._matMult(i)}const z=n.stretch+n.fixed,F=a.stretch+a.fixed,B=r.stretch+r.fixed,U=l.stretch+l.fixed,V=e.imageSecondary;return{tl:P,tr:k,bl:L,br:R,texPrimary:{x:s.paddedRect.x+wg+z,y:s.paddedRect.y+wg+B,w:F-z,h:U-B},texSecondary:V?{x:V.paddedRect.x+wg+z,y:V.paddedRect.y+wg+B,w:F-z,h:U-B}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:O,minFontScaleX:T/o/c,minFontScaleY:M/o/u,isSDF:i}};if(n&&(s.stretchX||s.stretchY)){const e=Eg(h,g,f),t=Eg(d,y,m);for(let i=0;i<e.length-1;i++){const n=e[i],s=e[i+1];for(let e=0;e<t.length-1;e++)r.push(I(n,t[e],s,t[e+1]))}}else r.push(I({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:l+1}));return r}function Tg(e,t,i){let n=0;for(const r of e)n+=Math.max(t,Math.min(i,r[1]))-Math.max(t,Math.min(i,r[0]));return n}function Eg(e,t,i){const n=[{fixed:-wg,stretch:0}];for(const[t,i]of e){const e=n[n.length-1];n.push({fixed:t-e.stretch,stretch:e.stretch}),n.push({fixed:t-e.stretch,stretch:e.stretch+(i-t)})}return n.push({fixed:t+wg,stretch:i}),n}function Mg(e,t,i,n){return e/t*i+n}function Ig(e,t,i,n){return e-t*i/n}function Ag(e,t,i,n){const r=t+e.positionedLines[n].lineOffset;return 0===n?i+r/2:i+(r+(t+e.positionedLines[n-1].lineOffset))/2}function Cg(e,t=1,i=!1){let n=1/0,r=1/0,s=-1/0,o=-1/0;const a=e[0];for(let e=0;e<a.length;e++){const t=a[e];(!e||t.x<n)&&(n=t.x),(!e||t.y<r)&&(r=t.y),(!e||t.x>s)&&(s=t.x),(!e||t.y>o)&&(o=t.y)}const l=Math.min(s-n,o-r);let c=l/2;const u=new Pi([],Pg);if(0===l)return new _(n,r);for(let t=n;t<s;t+=l)for(let i=r;i<o;i+=l)u.push(new kg(t+c,i+c,c,e));let h=function(e){let t=0,i=0,n=0;const r=e[0];for(let e=0,s=r.length,o=s-1;e<s;o=e++){const s=r[e],a=r[o],l=s.x*a.y-a.x*s.y;i+=(s.x+a.x)*l,n+=(s.y+a.y)*l,t+=3*l}return new kg(i/t,n/t,0,e)}(e),d=u.length;for(;u.length;){const n=u.pop();(n.d>h.d||!h.d)&&(h=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,d)),n.max-h.d<=t||(c=n.h/2,u.push(new kg(n.p.x-c,n.p.y-c,c,e)),u.push(new kg(n.p.x+c,n.p.y-c,c,e)),u.push(new kg(n.p.x-c,n.p.y+c,c,e)),u.push(new kg(n.p.x+c,n.p.y+c,c,e)),d+=4)}return i&&(console.log(`num probes: ${d}`),console.log(`best distance: ${h.d}`)),h.p}function Pg(e,t){return t.max-e.max}class kg{constructor(e,t,i,n){this.p=new _(e,t),this.h=i,this.d=function(e,t){let i=!1,n=1/0;for(let r=0;r<t.length;r++){const s=t[r];for(let t=0,r=s.length,o=r-1;t<r;o=t++){const r=s[t],a=s[o];r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(i=!i),n=Math.min(n,Gl(e,r,a))}}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}}const Rg=Number.POSITIVE_INFINITY,Lg=Math.sqrt(2);function Dg(e,[t,i]){let n=0,r=0;if(i===Rg){t<0&&(t=0);const i=t/Lg;switch(e){case"top-right":case"top-left":r=i-7;break;case"bottom-right":case"bottom-left":r=7-i;break;case"bottom":r=7-t;break;case"top":r=t-7}switch(e){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=t;break;case"right":n=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":r=i-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-i}switch(e){case"top-right":case"bottom-right":case"right":n=-t;break;case"top-left":case"bottom-left":case"left":n=t}}return[n,r]}function Og(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ng(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f){let m=s.textMaxSize.evaluate(t,{},h);void 0===m&&(m=o);const g=e.layers[0].layout,_=g.get("icon-offset").evaluate(t,{},h),y=Ug(i.horizontal)||i.vertical,v="globe"===d.name,b=rm,w=o/b,S=e.tilePixelRatio*m/b,T=(R=e.overscaling,e.zoom>18&&R>2&&(R>>=1),Math.max(ki/(512*R),1)*g.get("symbol-spacing")),E=g.get("text-padding")*e.tilePixelRatio,M=g.get("icon-padding")*e.tilePixelRatio,I=x(g.get("text-max-angle")),A="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement"),C="map"===g.get("icon-rotation-alignment")&&"point"!==g.get("symbol-placement"),P=g.get("symbol-placement"),k=T/2;var R;const L=g.get("icon-text-fit").evaluate(t,{},h),D=g.get("icon-text-fit-padding").evaluate(t,{},h),O="none"!==L;let N;!1===e.hasAnyIconTextFit&&O&&(e.hasAnyIconTextFit=!0),n&&O&&(e.allowVerticalPlacement&&i.vertical&&(N=ig(n,i.vertical,L,D,_,w)),y&&(n=ig(n,y,L,D,_,w)));const z=(o,a,m)=>{if(a.x<0||a.x>=ki||a.y<0||a.y>=ki)return;let g=null;if(v){const{x:e,y:t,z:i}=d.projectTilePoint(a.x,a.y,m);g={anchor:new ng(e,t,i,0,void 0),up:d.upVector(m,a.x,a.y)}}!function(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b,w,S,T,E,M){const I=e.addToLineVertexArray(t,n);let A,C,P,k,R,L,D,O=0,N=0,z=0,F=0,B=-1,U=-1;const V={};let G=da("");const H=i?i.anchor:t,W="none"!==l.layout.get("icon-text-fit").evaluate(x,{},T);let q=0,$=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[q,$]=l.layout.get("text-offset").evaluate(x,{},T).map((e=>e*rm)):(q=l.layout.get("text-radial-offset").evaluate(x,{},T)*rm,$=Rg),e.allowVerticalPlacement&&r.vertical){const e=r.vertical;if(f)L=jg(e),a&&(D=jg(a));else{const i=l.layout.get("text-rotate").evaluate(x,{},T)+90;P=Vg(c,H,t,u,h,d,e,p,i,m),a&&(k=Vg(c,H,t,u,h,d,a,_,i))}}if(s){const n=l.layout.get("icon-rotate").evaluate(x,{},T),r=Sg(s,n,w,W),o=a?Sg(a,n,w,W):void 0;C=Vg(c,H,t,u,h,d,s,_,n),O=4*r.length;const p=e.iconSizeData;let f=null;"source"===p.kind?(f=[sm*l.layout.get("icon-size").evaluate(x,{},T)],f[0]>Fg&&j(`${e.layerIds[0]}: Value for "icon-size" is >= ${zg}. Reduce your "icon-size".`)):"composite"===p.kind&&(f=[sm*b.compositeIconSizes[0].evaluate(x,{},T),sm*b.compositeIconSizes[1].evaluate(x,{},T)],(f[0]>Fg||f[1]>Fg)&&j(`${e.layerIds[0]}: Value for "icon-size" is >= ${zg}. Reduce your "icon-size".`)),e.addSymbols(e.icon,r,f,v,y,x,!1,i,t,I.lineStartIndex,I.lineLength,-1,S,T,E,M),B=e.icon.placedSymbolArray.length-1,o&&(N=4*o.length,e.addSymbols(e.icon,o,f,v,y,x,jm.vertical,i,t,I.lineStartIndex,I.lineLength,-1,S,T,E,M),U=e.icon.placedSymbolArray.length-1)}for(const n in r.horizontal){const s=r.horizontal[n];A||(G=da(s.text),f?R=jg(s):A=Vg(c,H,t,u,h,d,s,p,l.layout.get("text-rotate").evaluate(x,{},T),m));const a=1===s.positionedLines.length;if(z+=Bg(e,i,t,s,o,l,f,x,m,I,r.vertical?jm.horizontal:jm.horizontalOnly,a?Object.keys(r.horizontal):[n],V,B,b,S,T,E),a)break}r.vertical&&(F+=Bg(e,i,t,r.vertical,o,l,f,x,m,I,jm.vertical,["vertical"],V,U,b,S,T,E));let Z=-1;const X=(e,t)=>e?Math.max(e,t):t;Z=X(R,Z),Z=X(L,Z),Z=X(D,Z);const Y=Z>-1?1:0;e.glyphOffsetArray.length>=65535&&j("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,H.x,H.y,H.z,V.right>=0?V.right:-1,V.center>=0?V.center:-1,V.left>=0?V.left:-1,V.vertical>=0?V.vertical:-1,B,U,G,void 0!==A?A:e.collisionBoxArray.length,void 0!==A?A+1:e.collisionBoxArray.length,void 0!==P?P:e.collisionBoxArray.length,void 0!==P?P+1:e.collisionBoxArray.length,void 0!==C?C:e.collisionBoxArray.length,void 0!==C?C+1:e.collisionBoxArray.length,k||e.collisionBoxArray.length,k?k+1:e.collisionBoxArray.length,u,z,F,O,N,Y,0,q,$,Z,0,W?1:0)}(e,a,g,o,i,n,r,N,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,E,A,l,0,M,C,_,t,s,c,u,h,p,f)};if("line"===P)for(const r of hg(t.geometry,0,0,ki,ki)){const t=cg(r,T,I,i.vertical||y,n,b,S,e.overscaling,ki);for(const i of t)y&&Gg(e,y.text,k,i)||z(r,i,h)}else if("line-center"===P){for(const e of t.geometry)if(e.length>1){const t=lg(e,I,i.vertical||y,n,b,S);t&&z(e,t,h)}}else if("Polygon"===t.type)for(const e of np(t.geometry,0)){const t=Cg(e,16);z(e[0],new ng(t.x,t.y,0,0,void 0),h)}else if("LineString"===t.type)for(const e of t.geometry)z(e,new ng(e[0].x,e[0].y,0,0,void 0),h);else if("Point"===t.type)for(const e of t.geometry)for(const t of e)z([t],new ng(t.x,t.y,0,0,void 0),h)}const zg=255,Fg=zg*sm;function Bg(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,y){const v=function(e,t,i,n,r,s,o,a){const l=[];if(0===t.positionedLines.length)return l;const c=n.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,u=function(e){const t=e[0],i=e[1],n=t*i;return n>0?[t,-i]:n<0?[-t,i]:0===t?[i,t]:[i,-t]}(i);let h=Math.abs(t.top-t.bottom);for(const e of t.positionedLines)h-=e.lineOffset;const d=t.positionedLines.length,p=h/d;let f=t.top-i[1];for(let e=0;e<d;++e){const n=t.positionedLines[e];f=Ag(t,p,f,e);for(const e of n.positionedGlyphs){if(!e.rect)continue;const n=e.rect||{};let s=Vm+1,h=!0,d=1,p=0;if(e.imageName){const t=o[e.imageName];if(!t)continue;if(t.sdf){j("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=t.pixelRatio,s=pg/d}const m=(r||a)&&e.vertical,g=e.metrics.advance*e.scale/2,y=e.metrics,v=e.rect;if(null===v)continue;a&&t.verticalizable&&(p=e.imageName?g-e.metrics.width*e.scale/2:0);const x=r?[e.x+g,e.y]:[0,0];let b=[0,0],w=[0,0],S=!1;r||(m?(w=[e.x+g+u[0],e.y+u[1]-p],S=!0):b=[e.x+g+i[0],e.y+i[1]-p]);const T=v.w*e.scale/(d*(e.localGlyph?vg:1)),E=v.h*e.scale/(d*(e.localGlyph?vg:1));let M,I,A,C;if(m){const t=e.y-f,i=new _(-g,g-t),n=-Math.PI/2,r=new _(...w);M=new _(-g+b[0],b[1]),M._rotateAround(n,i)._add(r),M.x+=-t+g,M.y-=(y.left-s)*e.scale;const o=e.imageName?y.advance*e.scale:rm*e.scale,a=String.fromCodePoint(e.glyph);dm(a)?M.x+=(1-s)*e.scale:pm(a)?M.x+=o-y.height*e.scale+(-s-1)*e.scale:M.x+=e.imageName||y.width+2*s===v.w&&y.height+2*s===v.h?(o-E)/2:(o-(y.height+2*s)*e.scale)/2,I=new _(M.x,M.y-T),A=new _(M.x+E,M.y),C=new _(M.x+E,M.y-T)}else{const t=(y.left-s)*e.scale-g+b[0],i=(-y.top-s)*e.scale+b[1],n=t+T,r=i+E;M=new _(t,i),I=new _(n,i),A=new _(t,r),C=new _(n,r)}if(c){let e;e=r?new _(0,0):S?new _(u[0],u[1]):new _(i[0],i[1]),M._rotateAround(c,e),I._rotateAround(c,e),A._rotateAround(c,e),C._rotateAround(c,e)}const P=new _(0,0),k=new _(0,0);l.push({tl:M,tr:I,bl:A,br:C,texPrimary:n,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:x,sectionIndex:e.sectionIndex,isSDF:h,pixelOffsetTL:P,pixelOffsetBR:k,minFontScaleX:0,minFontScaleY:0})}}return l}(0,n,l,s,o,a,r,e.allowVerticalPlacement),x=e.textSizeData;let b=null;"source"===x.kind?(b=[sm*s.layout.get("text-size").evaluate(a,{},g)],b[0]>Fg&&j(`${e.layerIds[0]}: Value for "text-size" is >= ${zg}. Reduce your "text-size".`)):"composite"===x.kind&&(b=[sm*f.compositeTextSizes[0].evaluate(a,{},g),sm*f.compositeTextSizes[1].evaluate(a,{},g)],(b[0]>Fg||b[1]>Fg)&&j(`${e.layerIds[0]}: Value for "text-size" is >= ${zg}. Reduce your "text-size".`)),e.addSymbols(e.text,v,b,l,o,a,u,t,i,c.lineStartIndex,c.lineLength,p,m,g,y,!1);for(const t of h)d[t]=e.text.placedSymbolArray.length-1;return 4*v.length}function Ug(e){for(const t in e)return e[t];return null}function Vg(e,t,i,n,r,s,o,a,l,c){let u=o.top,h=o.bottom,d=o.left,p=o.right;const f=o.collisionPadding;if(f&&(d-=f[0],u-=f[1],p+=f[2],h+=f[3]),l){const e=new _(d,u),t=new _(p,u),i=new _(d,h),n=new _(p,h),r=x(l);let s=new _(0,0);c&&(s=new _(c[0],c[1])),e._rotateAround(r,s),t._rotateAround(r,s),i._rotateAround(r,s),n._rotateAround(r,s),d=Math.min(e.x,t.x,i.x,n.x),p=Math.max(e.x,t.x,i.x,n.x),u=Math.min(e.y,t.y,i.y,n.y),h=Math.max(e.y,t.y,i.y,n.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,d,u,p,h,a,n,r,s),e.length-1}function jg(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function Gg(e,t,i,n){const r=e.compareText;if(t in r){const e=r[t];for(let t=e.length-1;t>=0;t--)if(n.dist(e[t])<i)return!0}else r[t]=[];return r[t].push(n),!1}function Hg(e,t){const i=e.fovAboveCenter,n=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,r=(e._camera.position[2]*e.worldSize-n)/Math.cos(e._pitch),s=Math.sin(i)*r/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),o=Math.sin(e._pitch)*s+r;return Math.min(1.01*o,r*(1/e._horizonShift))}function Wg(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const i=Math.pow(2,-e.z),n=e.x*i,r=(e.x+1)*i,s=e.y*i,o=(e.y+1)*i,a=ml(n),l=ml(r),c=gl(s),u=gl(o),h=t.project(a,c),d=t.project(l,c),p=t.project(l,u),f=t.project(a,u);let m=Math.min(h.x,d.x,p.x,f.x),g=Math.min(h.y,d.y,p.y,f.y),_=Math.max(h.x,d.x,p.x,f.x),y=Math.max(h.y,d.y,p.y,f.y);const v=i/16;function x(e,i,n,r,s,o){const a=(n+s)/2,l=(r+o)/2,c=t.project(ml(a),gl(l)),u=Math.max(0,m-c.x,g-c.y,c.x-_,c.y-y);m=Math.min(m,c.x),_=Math.max(_,c.x),g=Math.min(g,c.y),y=Math.max(y,c.y),u>v&&(x(e,c,n,r,a,l),x(c,i,a,l,s,o))}x(h,d,n,s,r,s),x(d,p,r,s,r,o),x(p,f,r,o,n,o),x(f,h,n,o,n,s),m-=v,g-=v,_+=v,y+=v;const b=1/Math.max(_-m,y-g);return{scale:b,x:m*b,y:g*b,x2:_*b,y2:y*b,projection:t}}function qg(e,{x:t,y:i},n=0){return new _(((t-n)*e.scale-e.x)*ki,(i*e.scale-e.y)*ki)}const $g=e.a6.identity(new Float32Array(16));class Zg{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new el(0,0)}projectTilePoint(e,t,i){return{x:e,y:t,z:0}}locationPoint(e,t,i=!0){return e._coordinatePoint(e.locationCoordinate(t),i)}pixelsPerMeter(e,t){return fl(1,e)*t}pixelSpaceConversion(e,t,i){return 1}farthestPixelDistance(e){return Hg(e,e.pixelsPerMeter)}pointCoordinate(e,t,i,n){const r=e.horizonLineFromTop(!1),s=new _(t,Math.max(r,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(s,n))}pointCoordinate3D(e,t,i){const n=new _(t,i);if(e.elevation)return e.elevation.pointCoordinate(n);{const t=this.pointCoordinate(e,n.x,n.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const i=e.horizonLineFromTop();return t.y<i}createInversionMatrix(e,t){return $g}createTileMatrix(t,i,n){let r,s,o;const a=n.canonical,l=e.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const c=Wg(a,this);r=1,s=c.x+n.wrap*c.scale,o=c.y,e.a6.scale(l,l,[r/c.scale,r/c.scale,t.pixelsPerMeter/i])}else r=i/t.zoomScale(a.z),s=(a.x+Math.pow(2,a.z)*n.wrap)*r,o=a.y*r;return e.a6.translate(l,l,[s,o,0]),e.a6.scale(l,l,[r/ki,r/ki,1]),l}upVector(e,t,i){return[0,0,1]}upVectorScale(e,t,i){return{metersToTile:1}}}class Xg extends Zg{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,i]=this.parallels=e.parallels||[29.5,45.5],n=Math.sin(x(t));this.n=(n+Math.sin(x(i)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:i,c:n,r0:r}=this,s=x(e-this.center[0]),o=x(t),a=Math.sqrt(n-2*i*Math.sin(o))/i;return{x:a*Math.sin(s*i),y:a*Math.cos(s*i)-r,z:0}}unproject(e,t){const{n:i,c:n,r0:r}=this,s=r+t;let o=Math.atan2(e,Math.abs(s))*Math.sign(s);s*i<0&&(o-=Math.PI*Math.sign(e)*Math.sign(s));const a=x(this.center[0])*i;o=A(o,-Math.PI-a,Math.PI-a);const l=M(b(o/i)+this.center[0],-180,180),c=Math.asin(M((n-(e*e+s*s)*i*i)/(2*i),-1,1)),u=M(b(c),-yl,yl);return new el(l,u)}}const Yg=1.340264,Kg=-.081106,Jg=893e-6,Qg=.003796,e_=Math.sqrt(3)/2;class t_ extends Zg{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const i=Math.asin(e_*Math.sin(t)),n=i*i,r=n*n*n;return{x:.5*(e*Math.cos(i)/(e_*(Yg+3*Kg*n+r*(7*Jg+9*Qg*n)))/Math.PI+.5),y:1-.5*(i*(Yg+Kg*n+r*(Jg+Qg*n))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,n=i*i,r=n*n*n;for(let e,s,o,a=0;a<12&&(s=i*(Yg+Kg*n+r*(Jg+Qg*n))-t,o=Yg+3*Kg*n+r*(7*Jg+9*Qg*n),e=s/o,i=M(i-e,-Math.PI/3,Math.PI/3),n=i*i,r=n*n*n,!(Math.abs(e)<1e-12));++a);const s=e_*e*(Yg+3*Kg*n+r*(7*Jg+9*Qg*n))/Math.cos(i),o=Math.asin(Math.sin(i)/e_),a=M(180*s/Math.PI,-180,180),l=M(180*o/Math.PI,-yl,yl);return new el(a,l)}}class i_ extends Zg{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const i=360*(e-.5),n=M(360*(.5-t),-yl,yl);return new el(i,n)}}const n_=Math.PI/2;function r_(e){return Math.tan((n_+e)/2)}class s_ extends Zg{constructor(e){super(e),this.center=e.center||[0,30];const[t,i]=this.parallels=e.parallels||[30,30];let n=x(t),r=x(i);this.southernCenter=n+r<0,this.southernCenter&&(n=-n,r=-r);const s=Math.cos(n),o=r_(n);this.n=n===r?Math.sin(n):Math.log(s/Math.cos(r))/Math.log(r_(r)/o),this.f=s*Math.pow(r_(n),this.n)/this.n}project(e,t){t=x(t),this.southernCenter&&(t=-t),e=x(e-this.center[0]);const i=1e-6,{n,f:r}=this;r>0?t<-n_+i&&(t=-n_+i):t>n_-i&&(t=n_-i);const s=r/Math.pow(r_(t),n);let o=s*Math.sin(n*e),a=r-s*Math.cos(n*e);return o=.5*(o/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:o,y:this.southernCenter?a:1-a,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:i,f:n}=this,r=n-t,s=Math.sign(r),o=Math.sign(i)*Math.sqrt(e*e+r*r);let a=Math.atan2(e,Math.abs(r))*s;r*i<0&&(a-=Math.PI*Math.sign(e)*s);const l=M(b(a/i)+this.center[0],-180,180),c=M(b(2*Math.atan(Math.pow(n/o,1/i))-n_),-yl,yl);return new el(l,this.southernCenter?-c:c)}}class o_ extends Zg{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:dl(e),y:pl(t),z:0}}unproject(e,t){const i=ml(e),n=gl(t);return new el(i,n)}}const a_=x(yl);class l_ extends Zg{project(e,t){const i=(t=x(t))*t,n=i*i;return{x:.5*((e=x(e))*(.8707-.131979*i+n*(n*(.003971*i-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+i*(.015085+n*(.028874*i-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,n=25,r=0,s=i*i;do{s=i*i;const e=s*s;r=(i*(1.007226+s*(.015085+e*(.028874*s-.044475-.005916*e)))-t)/(1.007226+s*(.045255+e*(.259866*s-.311325-.005916*11*e))),i=M(i-r,-a_,a_)}while(Math.abs(r)>1e-6&&--n>0);s=i*i;const o=M(b(e/(.8707+s*(s*(s*s*s*(.003971-.001529*s)-.013791)-.131979))),-180,180),a=b(i);return new el(o,a)}}const c_=x(yl);class u_ extends Zg{project(e,t){t=x(t),e=x(e);const i=Math.cos(t),n=2/Math.PI,r=Math.acos(i*Math.cos(e/2)),s=Math.sin(r)/r,o=.5*(e*n+2*i*Math.sin(e/2)/s)||0,a=.5*(t+Math.sin(t)/s)||0;return{x:.5*(o/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(e,t){let i=e=(2*e-.5)*Math.PI,n=t=(2*(1-t)-1)*Math.PI,r=25;const s=1e-6;let o=0,a=0;do{const r=Math.cos(n),s=Math.sin(n),l=2*s*r,c=s*s,u=r*r,h=Math.cos(i/2),d=Math.sin(i/2),p=2*h*d,f=d*d,m=1-u*h*h,g=m?1/m:0,_=m?Math.acos(r*h)*Math.sqrt(1/m):0,y=.5*(2*_*r*d+2*i/Math.PI)-e,v=.5*(_*s+n)-t,x=.5*g*(u*f+_*r*h*c)+1/Math.PI,b=g*(p*l/4-_*s*d),w=.125*g*(l*d-_*s*u*p),S=.5*g*(c*h+_*f*r)+.5,T=b*w-S*x;o=(v*b-y*S)/T,a=(y*w-v*x)/T,i=M(i-o,-Math.PI,Math.PI),n=M(n-a,-c_,c_)}while((Math.abs(o)>s||Math.abs(a)>s)&&--r>0);return new el(b(i),b(n))}}class h_ extends Zg{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(x(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:i,cosPhi:n}=this;return{x:x(e)*n*i+.5,y:-Math.sin(x(t))/n*i+.5,z:0}}unproject(e,t){const{scale:i,cosPhi:n}=this,r=-(t-.5)/i,s=M(b((e-.5)/i)/n,-180,180),o=Math.asin(M(r*n,-1,1)),a=M(b(o),-yl,yl);return new el(s,a)}}class d_ extends o_{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,n){const r=Zh(t,i,n),s=Kh(jh(n));return e.N.transformMat4(r,r,s),{x:r[0],y:r[1],z:r[2]}}locationPoint(t,i){const n=Ka(i.lat,i.lng),r=e.N.normalize([],n),s=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude,o=fl(1,0)*ki*s;e.N.scaleAndAdd(n,n,r,o);const a=e.a6.identity(new Float64Array(16));return e.a6.multiply(a,t.pixelMatrix,t.globeMatrix),e.N.transformMat4(n,n,a),new _(n[0],n[1])}pixelsPerMeter(e,t){return fl(1,0)*t}pixelSpaceConversion(e,t,i){const n=fl(1,e)*t,r=ct(fl(1,45)*t,n,i);return this.pixelsPerMeter(e,t)/r}createTileMatrix(t,i,n){const r=Jh(jh(n.canonical));return e.a6.multiply(new Float64Array(16),t.globeMatrix,r)}createInversionMatrix(t,i){const{center:n}=t,r=Kh(jh(i));return e.a6.rotateY(r,r,x(n.lng)),e.a6.rotateX(r,r,x(n.lat)),e.a6.scale(r,r,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(r)}pointCoordinate(e,t,i,n){return Bh(e,t,i,!0)||new Sl(0,0)}pointCoordinate3D(e,t,i){const n=this.pointCoordinate(e,t,i,0);return[n.x,n.y,n.z]}isPointAboveHorizon(e,t){return!Bh(e,t.x,t.y,!1)}farthestPixelDistance(t){const i=function(t,i){const n=t.cameraToCenterDistance,r=t._centerAltitude*i,s=t._camera,o=t._camera.forward(),a=e.N.add([],e.N.scale([],o,-n),[0,0,r]),l=t.worldSize/(2*Math.PI),c=[0,0,-l],u=t.width/t.height,h=Math.tan(t.fovAboveCenter),d=e.N.scale([],s.up(),h),p=e.N.scale([],s.right(),h*u),f=e.N.normalize([],e.N.add([],e.N.add([],o,d),p)),m=[];let g;if(new Eh(a,f).closestPointOnSphere(c,l,m)){const i=e.N.add([],m,c),n=e.N.sub([],i,a);g=Math.cos(t.fovAboveCenter)*e.N.length(n)}else{const t=e.N.sub([],a,c),i=e.N.sub([],c,a);e.N.normalize(i,i);const n=e.N.length(t)-l;g=Math.sqrt(n*(n+2*l));const r=Math.acos(g/(l+n))-Math.acos(e.N.dot(o,i));g*=Math.cos(r)}return 1.01*g}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),n=id(t.zoom);if(n>0){const e=Hg(t,fl(1,t.center.lat)*t.worldSize),r=t.worldSize/(2*Math.PI),s=Math.max(t.width,t.height)/t.worldSize*Math.PI;return ct(i,e+r*(1-Math.cos(s)),Math.pow(n,10))}return i}upVector(e,t,i){return Zh(t,i,e,1)}upVectorScale(e){return{metersToTile:zh(Xh(jh(e)))}}}function p_(e){const t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new o_(e);case"equirectangular":return new i_(e);case"naturalEarth":return new l_(e);case"equalEarth":return new t_(e);case"winkelTripel":return new u_(e);case"albers":return i?new h_(e):new Xg(e);case"lambertConformalConic":return i?new h_(e):new s_(e);case"globe":return new d_(e)}throw new Error(`Invalid projection name: ${e.name}`)}const f_=Cp.types,m_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function g_(e,t,i,n,r,s,o,a,l,c,u,h,d){const p=a?Math.min(Fg,Math.round(a[0])):0,f=a?Math.min(Fg,Math.round(a[1])):0;e.emplaceBack(t,i,Math.round(32*n),Math.round(32*r),s,o,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function __(e,t,i){e.emplaceBack(t,i)}function y_(e,t,i,n,r,s,o){e.emplaceBack(t,i,n,r,s,o)}function v_(e,t,i,n,r){e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r)}function x_(e){for(const t of e.sections)if(ms(t.text))return!0;return!1}class b_{constructor(e){this.layoutVertexArray=new wo,this.indexArray=new Po,this.programConfigurations=e,this.segments=new ia,this.dynamicLayoutVertexArray=new yo,this.opacityVertexArray=new To,this.placedSymbolArray=new qo,this.iconTransitioningVertexArray=new Eo,this.globeExtVertexArray=new So,this.zOffsetVertexArray=new Lo}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,i,n,r){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Kf.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,m_,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Qf.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Yf.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||r)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Jf.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}is(b_,"SymbolBuffers");class w_{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new ia,this.collisionVertexArray=new Co,this.collisionVertexArrayExt=new yo}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,em.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,tm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}is(w_,"CollisionBuffers");class S_{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=e.a6.identity([]),this.placementViewportMatrix=e.a6.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=om(this.zoom,i["text-size"]),this.iconSizeData=om(this.zoom,i["icon-size"]);const n=this.layers[0].layout,r=n.get("symbol-sort-key"),s=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==s&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===s||"auto"===s&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map((e=>jm[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=n.get("symbol-z-elevate")}createArrays(){this.text=new b_(new Na(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new b_(new Na(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Xo,this.lineVertexArray=new Yo,this.symbolInstances=new Zo}calculateGlyphDependencies(e,t,i,n,r){for(let i=0;i<e.length;i++){const s=e.codePointAt(i);if(void 0===s)break;if(t[s]=!0,n&&r&&s<=65535){const n=hm[e.charAt(i)];n&&(t[n.charCodeAt(0)]=!0)}}}populate(t,i,n,r){const s=this.layers[0],o=s.layout,a="globe"===this.projection.name,l=o.get("text-font"),c=o.get("text-field"),u=o.get("icon-image"),h=("constant"!==c.value.kind||c.value.value instanceof Ot&&!c.value.value.isEmpty()||c.value.value.toString().length>0)&&("constant"!==l.value.kind||l.value.value.length>0),d="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,p=o.get("symbol-sort-key");if(this.features=[],!h&&!d)return;const f=i.iconDependencies,m=i.glyphDependencies,g=i.availableImages,_=new As(this.zoom);for(const{feature:i,id:c,index:u,sourceLayerIndex:y}of t){const t=s._featureFilter.needGeometry,v=Rl(i,t);if(!s._featureFilter.filter(_,v,n))continue;if(t||(v.geometry=kl(i,n,r)),a&&1!==i.type&&n.z<=5){const t=v.geometry,i=.98078528056,r=(t,r)=>{const s=Zh(t.x,t.y,n,1),o=Zh(r.x,r.y,n,1);return e.N.dot(s,o)<i};for(let e=0;e<t.length;e++)t[e]=Il(t[e],r)}let x,b;if(h){const e=s.getValueAndResolveTokens("text-field",v,n,g),t=Ot.factory(e);x_(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Es()||this.hasRTLText&&Is.isParsed())&&(x=um(t,s,v))}if(d){const e=s.getValueAndResolveTokens("icon-image",v,n,g);b=e instanceof Nt?e:Nt.fromString(e)}if(!x&&!b)continue;const w=this.sortFeaturesByKey?p.evaluate(v,{},n):void 0;if(this.features.push({id:c,text:x,icon:b,index:u,sourceLayerIndex:y,geometry:v.geometry,properties:i.properties,type:f_[i.type],sortKey:w}),b&&(f[b.namePrimary]=!0,b.nameSecondary&&(f[b.nameSecondary]=!0)),x){const e=l.evaluate(v,{},n).join(","),t="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(jm.vertical)>=0;for(const i of x.sections)if(i.image)f[i.image.namePrimary]=!0;else{const n=ls(x.toString()),r=i.fontStack||e,s=m[r]=m[r]||{};this.calculateGlyphDependencies(i.text,s,t,this.allowVerticalPlacement,n)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},i={},n=[];let r=0;function s(t){n.push(e[t]),r++}function o(e,t,r){const s=i[e];return delete i[e],i[t]=s,n[s].geometry[0].pop(),n[s].geometry[0]=n[s].geometry[0].concat(r[0]),s}function a(e,i,r){const s=t[i];return delete t[i],t[e]=s,n[s].geometry[0].shift(),n[s].geometry[0]=r[0].concat(n[s].geometry[0]),s}function l(e,t,i){const n=i?t[0][t[0].length-1]:t[0][0];return`${e}:${n.x}:${n.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){s(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in t&&i[p]!==t[f]){const e=a(p,f,h),r=o(p,f,n[e].geometry);delete t[p],delete i[f],i[l(d,n[r].geometry,!0)]=r,n[e].geometry=null}else p in i?o(p,f,h):f in t?a(p,f,h):(s(c),t[p]=r-1,i[f]=r-1)}return n.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,i,n,r){const s=0!==Object.keys(e).length;if(s&&!this.stateDependentLayers.length)return;const o=s?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,t,o,i,n,r),this.icon.programConfigurations.updatePaintArrays(e,t,o,i,n,r)}updateZOffset(){const e=(e,t,n)=>{i+=t,i>e.length&&e.resize(i);for(let r=-t;r<0;r++)e.emplace(r+i,n)},t=(e,t,i)=>{n+=t,n>e.length&&e.resize(n);for(let r=-t;r<0;r++)e.emplace(r+n,i)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,n=0;for(let i=0;i<this.symbolInstances.length;i++){const n=this.symbolInstances.get(i),{numHorizontalGlyphVertices:r,numVerticalGlyphVertices:s,numIconVertices:o}=n,a=n.zOffset,l=o>0;if((r>0||s>0)&&(e(this.text.zOffsetVertexArray,r,a),e(this.text.zOffsetVertexArray,s,a)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:i}=n;e>=0&&t(this.icon.zOffsetVertexArray,o,a),i>=0&&t(this.icon.zOffsetVertexArray,n.numVerticalIconVertices,a)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=p_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const i=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:e,y:i}of t)this.lineVertexArray.emplaceBack(e,i);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m){const g=e.indexArray,_=e.layoutVertexArray,y=e.globeExtVertexArray,v=e.segments.prepareSegment(4*t.length,_,g,this.canOverlap?s.sortKey:void 0),x=this.glyphOffsetArray.length,b=v.vertexLength,w=this.allowVerticalPlacement&&o===jm.vertical?Math.PI/2:0,S=s.text&&s.text.sections;for(let n=0;n<t.length;n++){const{tl:r,tr:o,bl:c,br:u,texPrimary:h,texSecondary:x,pixelOffsetTL:b,pixelOffsetBR:T,minFontScaleX:E,minFontScaleY:M,glyphOffset:I,isSDF:A,sectionIndex:C}=t[n],P=v.vertexLength,k=I[1];if(g_(_,l.x,l.y,r.x,k+r.y,h.x,h.y,i,A,b.x,b.y,E,M),g_(_,l.x,l.y,o.x,k+o.y,h.x+h.w,h.y,i,A,T.x,b.y,E,M),g_(_,l.x,l.y,c.x,k+c.y,h.x,h.y+h.h,i,A,b.x,T.y,E,M),g_(_,l.x,l.y,u.x,k+u.y,h.x+h.w,h.y+h.h,i,A,T.x,T.y,E,M),a){const{x:t,y:i,z:n}=a.anchor,[r,s,o]=a.up;y_(y,t,i,n,r,s,o),y_(y,t,i,n,r,s,o),y_(y,t,i,n,r,s,o),y_(y,t,i,n,r,s,o),v_(e.dynamicLayoutVertexArray,t,i,n,w)}else v_(e.dynamicLayoutVertexArray,l.x,l.y,l.z,w);if(m){const t=x||h;__(e.iconTransitioningVertexArray,t.x,t.y),__(e.iconTransitioningVertexArray,t.x+t.w,t.y),__(e.iconTransitioningVertexArray,t.x,t.y+t.h),__(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}g.emplaceBack(P,P+1,P+2),g.emplaceBack(P+1,P+2,P+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(I[0]),n!==t.length-1&&C===t[n+1].sectionIndex||e.programConfigurations.populatePaintArrays(_.length,s,s.index,{},d,p,f,S&&S[C])}const T=a?a.anchor:l;e.placedSymbolArray.emplaceBack(T.x,T.y,T.z,l.x,l.y,x,this.glyphOffsetArray.length-x,b,c,u,l.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],o,0,!1,0,h,0)}_commitLayoutVertex(e,t,i,n,r,s,o){e.emplaceBack(t,i,n,r,s,Math.round(o.x),Math.round(o.y))}_addCollisionDebugVertices(e,t,i,n,r,s,o){const a=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=a.vertexLength,c=o.tileAnchorX,u=o.tileAnchorY;for(let e=0;e<4;e++)i.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(i.collisionVertexArrayExt,t,e.padding,o.zOffset),this._commitLayoutVertex(i.layoutVertexArray,n,r,s,c,u,new _(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,r,s,c,u,new _(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,r,s,c,u,new _(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,n,r,s,c,u,new _(e.x1,e.y2)),a.vertexLength+=4;const h=i.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,i,n,r,s){for(let o=n;o<r;o++){const n=i.get(o),r=this.getSymbolInstanceTextSize(e,s,t,o);this._addCollisionDebugVertices(n,r,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,s)}}_addIconDebugCollisionBoxes(e,t,i,n,r,s){for(let o=n;o<r;o++){const n=i.get(o),r=this.getSymbolInstanceIconSize(e,t,s.placedIconSymbolIndex);this._addCollisionDebugVertices(n,r,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,s)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new w_(Io,im.members,Eo),this.iconCollisionBox=new w_(Io,im.members,Eo);const i=lm(this.iconSizeData,e),n=lm(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(n,e,t,s.textBoxStartIndex,s.textBoxEndIndex,s),this._addTextDebugCollisionBoxes(n,e,t,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s),this._addIconDebugCollisionBoxes(i,e,t,s.iconBoxStartIndex,s.iconBoxEndIndex,s),this._addIconDebugCollisionBoxes(i,e,t,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s)}}getSymbolInstanceTextSize(e,t,i,n){const r=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:n),s=am(this.textSizeData,e,r)/rm;return this.tilePixelRatio*s}getSymbolInstanceIconSize(e,t,i){const n=this.icon.placedSymbolArray.get(i),r=am(this.iconSizeData,e,n);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(e,t,i,n){e.emplaceBack(t,-i,-i,n),e.emplaceBack(t,i,-i,n),e.emplaceBack(t,i,i,n),e.emplaceBack(t,-i,i,n)}_updateTextDebugCollisionBoxes(e,t,i,n,r,s){for(let o=n;o<r;o++){const n=i.get(o),r=this.getSymbolInstanceTextSize(e,s,t,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,n.padding,s.zOffset)}}_updateIconDebugCollisionBoxes(e,t,i,n,r,s){for(let o=n;o<r;o++){const n=i.get(o),r=this.getSymbolInstanceIconSize(e,t,s.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,n.padding,s.zOffset)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=lm(this.iconSizeData,e),n=lm(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this._updateTextDebugCollisionBoxes(n,e,t,s.textBoxStartIndex,s.textBoxEndIndex,s),this._updateTextDebugCollisionBoxes(n,e,t,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s),this._updateIconDebugCollisionBoxes(i,e,t,s.iconBoxStartIndex,s.iconBoxEndIndex,s),this._updateIconDebugCollisionBoxes(i,e,t,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,i,n,r,s,o,a,l){const c={};if(t<i){const{x1:i,y1:n,x2:r,y2:s,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(t);c.textBox={x1:i,y1:n,x2:r,y2:s,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.textFeatureIndex=p}if(n<r){const{x1:t,y1:i,x2:r,y2:s,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(n);c.verticalTextBox={x1:t,y1:i,x2:r,y2:s,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalTextFeatureIndex=p}if(s<o){const{x1:t,y1:i,x2:n,y2:r,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(s);c.iconBox={x1:t,y1:i,x2:n,y2:r,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.iconFeatureIndex=p}if(a<l){const{x1:t,y1:i,x2:n,y2:r,padding:s,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(a);c.verticalIconBox={x1:t,y1:i,x2:n,y2:r,padding:s,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const i=e.placedSymbolArray.get(t),n=i.vertexStartIndex+4*i.numGlyphs;for(let t=i.vertexStartIndex;t<n;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),i=Math.cos(e),n=[],r=[],s=[];for(let e=0;e<this.symbolInstances.length;++e){s.push(e);const o=this.symbolInstances.get(e);n.push(0|Math.round(t*o.tileAnchorX+i*o.tileAnchorY)),r.push(o.featureIndex)}return s.sort(((e,t)=>n[e]-n[t]||r[t]-r[e])),s}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,t){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===t?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:n,leftJustifiedTextSymbolIndex:r,verticalPlacedTextSymbolIndex:s,placedIconSymbolIndex:o,verticalPlacedIconSymbolIndex:a}=t;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),n>=0&&n!==i&&this.addIndicesForPlacedSymbol(this.text,n),r>=0&&r!==n&&r!==i&&this.addIndicesForPlacedSymbol(this.text,r),s>=0&&this.addIndicesForPlacedSymbol(this.text,s),o>=0&&this.addIndicesForPlacedSymbol(this.icon,o),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}is(S_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),S_.addDynamicAttributes=v_;const T_=new Us({"symbol-placement":new zs(Gs.layout_symbol["symbol-placement"]),"symbol-spacing":new zs(Gs.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zs(Gs.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fs(Gs.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zs(Gs.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new zs(Gs.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new zs(Gs.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new zs(Gs.layout_symbol["icon-ignore-placement"]),"icon-optional":new zs(Gs.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zs(Gs.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fs(Gs.layout_symbol["icon-size"]),"icon-text-fit":new Fs(Gs.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Fs(Gs.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fs(Gs.layout_symbol["icon-image"]),"icon-rotate":new Fs(Gs.layout_symbol["icon-rotate"]),"icon-padding":new zs(Gs.layout_symbol["icon-padding"]),"icon-keep-upright":new zs(Gs.layout_symbol["icon-keep-upright"]),"icon-offset":new Fs(Gs.layout_symbol["icon-offset"]),"icon-anchor":new Fs(Gs.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zs(Gs.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zs(Gs.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zs(Gs.layout_symbol["text-rotation-alignment"]),"text-field":new Fs(Gs.layout_symbol["text-field"]),"text-font":new Fs(Gs.layout_symbol["text-font"]),"text-size":new Fs(Gs.layout_symbol["text-size"]),"text-max-width":new Fs(Gs.layout_symbol["text-max-width"]),"text-line-height":new Fs(Gs.layout_symbol["text-line-height"]),"text-letter-spacing":new Fs(Gs.layout_symbol["text-letter-spacing"]),"text-justify":new Fs(Gs.layout_symbol["text-justify"]),"text-radial-offset":new Fs(Gs.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zs(Gs.layout_symbol["text-variable-anchor"]),"text-anchor":new Fs(Gs.layout_symbol["text-anchor"]),"text-max-angle":new zs(Gs.layout_symbol["text-max-angle"]),"text-writing-mode":new zs(Gs.layout_symbol["text-writing-mode"]),"text-rotate":new Fs(Gs.layout_symbol["text-rotate"]),"text-padding":new zs(Gs.layout_symbol["text-padding"]),"text-keep-upright":new zs(Gs.layout_symbol["text-keep-upright"]),"text-transform":new Fs(Gs.layout_symbol["text-transform"]),"text-offset":new Fs(Gs.layout_symbol["text-offset"]),"text-allow-overlap":new zs(Gs.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new zs(Gs.layout_symbol["text-ignore-placement"]),"text-optional":new zs(Gs.layout_symbol["text-optional"]),visibility:new zs(Gs.layout_symbol.visibility)});var E_={paint:new Us({"icon-opacity":new Fs(Gs.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Fs(Gs.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Fs(Gs.paint_symbol["text-emissive-strength"]),"icon-color":new Fs(Gs.paint_symbol["icon-color"]),"icon-halo-color":new Fs(Gs.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fs(Gs.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fs(Gs.paint_symbol["icon-halo-blur"]),"icon-translate":new zs(Gs.paint_symbol["icon-translate"]),"icon-translate-anchor":new zs(Gs.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Fs(Gs.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Fs(Gs.paint_symbol["text-opacity"]),"text-color":new Fs(Gs.paint_symbol["text-color"],{runtimeType:bt,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Fs(Gs.paint_symbol["text-halo-color"]),"text-halo-width":new Fs(Gs.paint_symbol["text-halo-width"]),"text-halo-blur":new Fs(Gs.paint_symbol["text-halo-blur"]),"text-translate":new zs(Gs.paint_symbol["text-translate"]),"text-translate-anchor":new zs(Gs.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new zs(Gs.paint_symbol["icon-color-saturation"])}),layout:T_};class M_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:_t,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}is(M_,"FormatSectionOverride",{omit:["defaultValue"]});class I_ extends oo{constructor(e,t,i){super(e,E_,t,i)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const e=[];for(const t of i)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,i,n){const r=this.layout.get(e).evaluate(t,{},i,n),s=this._unevaluatedLayout._values[e];return s.isDataDriven()||Hr(s.value)||!r?r:function(e,t){return t.replace(/{([^{}]+)}/g,((t,i)=>i in e?String(e[i]):""))}(t.properties,r)}createBucket(e){return new S_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of E_.paint.overridableProperties){if(!I_.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),i=new M_(t),n=new Gr(i,t.property.specification,this.scope,this.options);let r=null;r="constant"===t.value.kind||"source"===t.value.kind?new qr("source",n):new $r("composite",n,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new Os(t.property,r,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven())&&I_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const i=e.get("text-field"),n=E_.paint.properties[t];let r=!1;const s=e=>{for(const t of e)if(n.overrides&&n.overrides.hasOverride(t))return void(r=!0)};if("constant"===i.value.kind&&i.value.value instanceof Ot)s(i.value.value.sections);else if("source"===i.value.kind){const e=t=>{r||(t instanceof jt&&Bt(t.value)===Et?s(t.value.sections):t instanceof $t?s(t.sections):t.eachChild(e))},t=i.value;t._styleExpression&&e(t._styleExpression.expression)}return r}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),t=0!==this.paint.get("text-opacity").constantOr(1),i=[];return e&&i.push("symbolIcon"),t&&i.push("symbolSDF"),i}getDefaultProgramParams(e,t){return{config:new Oa(this,t),overrideFog:!1}}}const A_=new Us({visibility:new zs(Gs.layout_background.visibility)});var C_={paint:new Us({"background-color":new zs(Gs.paint_background["background-color"]),"background-pattern":new zs(Gs.paint_background["background-pattern"]),"background-opacity":new zs(Gs.paint_background["background-opacity"]),"background-emissive-strength":new zs(Gs.paint_background["background-emissive-strength"])}),layout:A_};const P_=new Us({visibility:new zs(Gs.layout_raster.visibility)});var k_={paint:new Us({"raster-opacity":new zs(Gs.paint_raster["raster-opacity"]),"raster-color":new Bs(Gs.paint_raster["raster-color"]),"raster-color-mix":new zs(Gs.paint_raster["raster-color-mix"]),"raster-color-range":new zs(Gs.paint_raster["raster-color-range"]),"raster-hue-rotate":new zs(Gs.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zs(Gs.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zs(Gs.paint_raster["raster-brightness-max"]),"raster-saturation":new zs(Gs.paint_raster["raster-saturation"]),"raster-contrast":new zs(Gs.paint_raster["raster-contrast"]),"raster-resampling":new zs(Gs.paint_raster["raster-resampling"]),"raster-fade-duration":new zs(Gs.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new zs(Gs.paint_raster["raster-emissive-strength"]),"raster-array-band":new zs(Gs.paint_raster["raster-array-band"]),"raster-elevation":new zs(Gs.paint_raster["raster-elevation"])}),layout:P_},R_=uo([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class L_{constructor(e,t,i,n){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(t,n)}update(e,t,i){const{width:n,height:r}=e,{context:s}=this,{gl:o}=s;if(o.bindTexture(o.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA&&(!t||!1!==t.premultiply)),i||this.size&&this.size[0]===n&&this.size[1]===r){const{x:t,y:s}=i||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)o.texSubImage2D(o.TEXTURE_2D,0,t,s,o.RGBA,o.UNSIGNED_BYTE,e);else{let i=this.format,a=o.UNSIGNED_BYTE;this.format===o.R32F&&(i=o.RED,a=o.FLOAT),o.texSubImage2D(o.TEXTURE_2D,0,t,s,n,r,i,a,e.data)}}else if(this.size=[n,r],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let t=this.format;this.format===o.R8&&(t=o.RED),o.texImage2D(o.TEXTURE_2D,0,this.format,t,o.UNSIGNED_BYTE,e)}else{let t=this.format,i=this.format,s=o.UNSIGNED_BYTE;this.format===o.DEPTH_COMPONENT&&(t=o.DEPTH_COMPONENT16,s=o.UNSIGNED_SHORT),this.format===o.R8&&(i=o.RED),this.format===o.R32F&&(s=o.FLOAT,i=o.RED),o.texImage2D(o.TEXTURE_2D,0,t,n,r,0,i,s,e.data)}this.useMipmap=Boolean(t&&t.useMipmap),this.useMipmap&&o.generateMipmap(o.TEXTURE_2D)}bind(e,t,i=!1){const{context:n}=this,{gl:r}=n;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap&&!i?e===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),t!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,i,n){const{context:r}=this,{gl:s}=r;s.bindTexture(s.TEXTURE_2D,this.texture),t!==this.magFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this.useMipmap?e===s.NEAREST?s.NEAREST_MIPMAP_NEAREST:s.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,i),this.wrapS=i),n!==this.wrapT&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,n),this.wrapT=n)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class D_{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:i}=this,{gl:n}=i;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrapS=t)}}function O_(t,i,n,r,s,o,a,l){const c=[t,i,1,n,r,1,s,o,1],u=[a,l,1],h=e.co.adjoint([],c),[d,p,f]=e.N.transformMat3(u,u,h);return e.co.multiply(c,c,[d,0,0,0,p,0,0,0,f])}function N_(t,i,n,r,s,o,a,l){const c=function(t,i,n,r,s,o,a,l){const c=O_(0,0,1,0,1,1,0,1),u=O_(t,i,n,r,s,o,a,l),h=e.co.adjoint([],c);return e.co.multiply(u,u,h)}(t,i,n,r,s,o,a,l);return[c[2]/c[8]/ki,c[5]/c[8]/ki]}function z_(e){return[e[0],Math.min(Math.max(e[1],-yl),yl)]}class F_ extends tt{constructor(e,t,i,n){super(),this.id=e,this.dispatcher=i,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(n),this.options=t,this._dirty=!1}load(e,t){if(this._loaded=t||!1,this.fire(new Qe("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Le(this.map._requestManager.transformRequest(this.url,Te.Image),((t,i)=>{this._imageRequest=null,this._loaded=!0,t?this.fire(new et(t)):i&&(this.image=i instanceof HTMLImageElement?oe.getImageData(i):i,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new D_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Qe("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof D_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],i=e[0][1];for(const n of e)n[1]>i&&(i=n[1]),n[1]<t&&(t=n[1]);const n=(i+t)/2;if(n>yl?this.onNorthPole=!0:n<-yl&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(Sl.fromLngLat);this.tileID=function(e){let t=1/0,i=1/0,n=-1/0,r=-1/0;for(const s of e)t=Math.min(t,s.x),i=Math.min(i,s.y),n=Math.max(n,s.x),r=Math.max(r,s.y);const s=Math.max(n-t,r-i),o=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),a=Math.pow(2,o);let l=Math.floor((t+n)/2*a);return l>1&&(l-=1),new rl(o,l,Math.floor((i+r)/2*a))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Qe("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Wg(new rl(0,0,0),this.map.transform.projection),n=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(e){const t=e[1].x-e[0].x,i=e[1].y-e[0].y,n=e[2].x-e[1].x,r=e[2].y-e[1].y,s=e[3].x-e[2].x,o=e[3].y-e[2].y,a=e[0].x-e[3].x,l=e[0].y-e[3].y,c=t*r-n*i,u=n*o-s*r,h=s*l-a*o,d=a*i-t*l;return c>0&&u>0&&h>0&&d>0||c<0&&u<0&&h<0&&d<0}(n))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const r=Wg(this.tileID,this.map.transform.projection),[s,o,a,l]=this.coordinates.map((e=>{const t=r.projection.project(e[0],e[1]);return qg(r,t)._round()}));this.perspectiveTransform=N_(s.x,s.y,o.x,o.y,a.x,a.y,l.x,l.y);const c=this._boundsArray=new mo;c.emplaceBack(s.x,s.y,0,0),c.emplaceBack(o.x,o.y,ki,0),c.emplaceBack(l.x,l.y,0,ki),c.emplaceBack(a.x,a.y,ki,ki),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(c,R_.members),this.boundsSegments=ia.simpleSegment(0,0,4,2);const u=[],h=[z_((d=this.coordinates)[0]),z_(d[1]),z_(d[2]),z_(d[3])];var d;const[p,f,m,g]=function(e){let t=e[0][0],i=t,n=e[0][1],r=n;for(let s=1;s<e.length;s++)e[s][0]<t?t=e[s][0]:e[s][0]>i&&(i=e[s][0]),e[s][1]<n?n=e[s][1]:e[s][1]>r&&(r=e[s][1]);return[t,n,i-t,r-n]}(h);{const r=new mo,[s,o,a,l]=function(e){let t=e[0].x,i=t,n=e[0].y,r=n;for(let s=1;s<e.length;s++)e[s].x<t?t=e[s].x:e[s].x>i&&(i=e[s].x),e[s].y<n?n=e[s].y:e[s].y>r&&(r=e[s].y);return[t,n,i-t,r-n]}(n),c=e=>[(e.x-s)/a,(e.y-o)/l],[h,d,_,y]=n.map(c),v=function(t,i,n,r,s,o,a,l){const c=O_(0,0,1,0,1,1,0,1),u=O_(t,i,n,r,s,o,a,l),h=e.co.adjoint([],u);return e.co.multiply(c,c,h)}(h[0],h[1],d[0],d[1],_[0],_[1],y[0],y[1]);this.elevatedGlobePerspectiveTransform=N_(h[0],h[1],d[0],d[1],_[0],_[1],y[0],y[1]);const x=(t,i)=>{u.push(t.lng);const n=Math.round((t.lng-p)/m*ki),s=Math.round((t.lat-f)/g*ki),o=c(i),a=e.N.transformMat3([],[o[0],o[1],1],v),l=Math.round(a[0]/a[2]*ki),h=Math.round(a[1]/a[2]*ki);r.emplaceBack(n,s,l,h)},b=n[3].x-n[0].x,w=n[3].y-n[0].y,S=n[2].x-n[1].x,T=n[2].y-n[1].y;for(let e=0;e<65;e++){const t=e/64,r=[n[0].x+t*b,n[0].y+t*w],s=[n[1].x+t*S,n[1].y+t*T],o=s[0]-r[0],a=s[1]-r[1];for(let e=0;e<65;e++){const t=e/64,n={x:r[0]+o*t,y:r[1]+a*t,z:0};x(i.projection.unproject(n.x,n.y),n)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(r,R_.members)}{this.maxLongitudeTriangleSize=0;let e=[],i=new Po;const n=(t,n,r)=>{i.emplaceBack(t,n,r);const s=u[t],o=u[n],a=u[r],l=Math.min(Math.min(s,o),a),c=Math.max(Math.max(s,o),a)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),e.push(l+c/2)};for(let e=0;e<64;e++)for(let t=0;t<64;t++){const i=65*e+t,r=i+1,s=i+65,o=s+1;n(i,s,r),n(r,s,o)}[e,i]=function(e,t){const i=Array.from({length:e.length},((e,t)=>t));i.sort(((t,i)=>e[t]-e[i]));const n=[],r=new Po;for(let s=0;s<i.length;s++){const o=i[s];n.push(e[o]);const a=3*o,l=a+1;r.emplaceBack(t.uint16[a],t.uint16[l],t.uint16[l+1])}return[n,r]}(e,i),this.elevatedGlobeTrianglesCenterLongitudes=e,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(i)}this.elevatedGlobeSegments=ia.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,m/ki,0,g/ki,0,0,f,p,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,i=t.gl;!this._dirty||this.texture instanceof D_||(this.texture?this.texture.update(this.image):(this.texture=new L_(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const t=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!t)return null;const i=this.elevatedGlobeTrianglesCenterLongitudes;let n=((e,t)=>e+360*Math.round((t-e)/360))(e+180,i[0]);const r=new ia,s=(e,i)=>{r.segments.push({vertexOffset:0,primitiveOffset:e,vertexLength:t.segments[0].vertexLength,primitiveLength:i,sortKey:void 0,vaos:{}})},o=.51*this.maxLongitudeTriangleSize;if(Math.abs(i[0]-n)<=o){const e=re(i,0,i.length,n+o);return e===i.length||s(e,ne(i,e+1,i.length,n+360-o)-e),r}n<i[0]&&(n+=360);const a=ne(i,0,i.length,n-o);if(a===i.length)return s(0,i.length),r;s(0,a-0);const l=re(i,a+1,i.length,n+o);return l!==i.length&&s(l,i.length-l),r}}const B_=(Math.pow(256,2)-1)/16907520;class U_ extends oo{constructor(e,t,i){super(e,k_,t,i),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(e){return!(e&&e._source instanceof F_&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap())return;if(!this._curRampRange)return;const t=this._transitionablePaint._values["raster-color"].value.expression,[i,n]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(i)&&isNaN(n)||i===this._curRampRange[0]&&n===this._curRampRange[1]||(this.colorRamp=Td({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:i,end:n}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[i,n])}}const V_=new Us({visibility:new zs(Gs["layout_raster-particle"].visibility)});var j_={paint:new Us({"raster-particle-array-band":new zs(Gs["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new zs(Gs["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Bs(Gs["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new zs(Gs["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new zs(Gs["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new zs(Gs["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new zs(Gs["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:V_};class G_ extends oo{constructor(e,t,i){super(e,j_,t,i),this._updateColorRamp(),this.onRemove=e=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&e.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=oe.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isLayerDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,t=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Td({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:t}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=oe.now()}}class H_ extends oo{constructor(e,t){super(e,{},t),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const W_=new Us({visibility:new zs(Gs.layout_sky.visibility)});var q_={paint:new Us({"sky-type":new zs(Gs.paint_sky["sky-type"]),"sky-atmosphere-sun":new zs(Gs.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new zs(Gs.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new zs(Gs.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new zs(Gs.paint_sky["sky-gradient-radius"]),"sky-gradient":new Bs(Gs.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new zs(Gs.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new zs(Gs.paint_sky["sky-atmosphere-color"]),"sky-opacity":new zs(Gs.paint_sky["sky-opacity"])}),layout:W_};function $_(t,i,n){const r=[0,0,1],s=e.bi.identity([]);return e.bi.rotateY(s,s,n?-x(t)+Math.PI:x(t)),e.bi.rotateX(s,s,-x(i)),e.N.transformQuat(r,r,s),e.N.normalize(r,r)}var Z_={paint:new Us({})};function X_(t,i){const n=K_(t.projection,t.zoom,t.width,t.height),r=function(t,i,n,r,s){const o=new el(n.lng-180*J_,n.lat),a=new el(n.lng+180*J_,n.lat),l=t.project(o.lng,o.lat),c=t.project(a.lng,a.lat),u=-Math.atan2(c.y-l.y,c.x-l.x),h=Sl.fromLngLat(n);h.y=M(h.y,-1+J_,1-J_);const d=h.toLngLat(),p=t.project(d.lng,d.lat),f=Sl.fromLngLat(d);f.x+=J_;const m=f.toLngLat(),g=t.project(m.lng,m.lat),_=ey(g.x-p.x,g.y-p.y,u),y=Sl.fromLngLat(d);y.y+=J_;const v=y.toLngLat(),x=t.project(v.lng,v.lat),b=ey(x.x-p.x,x.y-p.y,u),w=Math.abs(_.x)/Math.abs(b.y),S=e.a6.identity([]);e.a6.rotateZ(S,S,-u*(1-(s?0:r)));const T=e.a6.identity([]);return e.a6.scale(T,T,[1,1-(1-w)*r,1]),T[4]=-b.x/b.y*r,e.a6.rotateZ(T,T,u),e.a6.multiply(T,S,T),T}(t.projection,0,t.center,n,i),s=Y_(t);return e.a6.scale(r,r,[s,s,1]),r}function Y_(e){const t=e.projection,i=K_(e.projection,e.zoom,e.width,e.height),n=Q_(t,e.center),r=Q_(t,el.convert(t.center));return Math.pow(2,n*i+(1-i)*r)}function K_(e,t,i,n,r=1/0){const s=e.range;if(!s)return 0;const o=Math.min(r,Math.max(i,n)),a=Math.log(o/1024)/Math.LN2;return I(s[0]+a,s[1]+a,t)}const J_=1/4e4;function Q_(e,t){const i=M(t.lat,-yl,yl),n=new el(t.lng-180*J_,i),r=new el(t.lng+180*J_,i),s=e.project(n.lng,i),o=e.project(r.lng,i),a=Sl.fromLngLat(n),l=Sl.fromLngLat(r),c=o.x-s.x,u=o.y-s.y,h=l.x-a.x,d=l.y-a.y,p=Math.sqrt((h*h+d*d)/(c*c+u*u));return Math.log(p)/Math.LN2}function ey(e,t,i){const n=Math.cos(i),r=Math.sin(i);return{x:e*n-t*r,y:e*r+t*n}}function ty(t,i,n){e.a6.identity(t),e.a6.rotateZ(t,t,x(i[2])),e.a6.rotateX(t,t,x(i[0])),e.a6.rotateY(t,t,x(i[1])),e.a6.scale(t,t,n),e.a6.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function iy(t,i,n,r,s,o,a,l){const c=[n[0]-i[0],n[1]-i[1],0],u=[r[0]-i[0],r[1]-i[1],0];if(e.N.length(c)<1e-12||e.N.length(u)<1e-12)return e.bi.identity(t);const h=e.N.cross([],c,u);e.N.normalize(h,h),e.N.subtract(u,r,i),c[2]=(o-s)*l,u[2]=(a-s)*l;const d=c;return e.N.cross(d,c,u),e.N.normalize(d,d),e.bi.rotationTo(t,h,d)}function ny(t,i,n=!1){const r=id(i.zoom),s=function(t,i,n){const r=i.worldSize,s=[t[12],t[13],t[14]],o=gl(s[1]/r),a=ml(s[0]/r),l=e.a6.identity([]),c=fl(1,o)*r,u=fl(1,0)*r*xl(o,i.zoom),h=1/Qh(r);let d=u*h;if(n){const e=K_(i.projection,i.zoom,i.width,i.height,1024);d=h*i.projection.pixelSpaceConversion(i.center.lat,r,e)}const p=Ka(o,a);e.N.add(p,p,e.N.scale([],e.N.normalize([],p),c*d*s[2]));const f=function(t){const i=[t[0],t[1],t[2]];let n=[0,1,0];const r=e.N.cross([],n,i);return e.N.cross(n,i,r),0===e.N.squaredLength(n)&&(n=[0,1,0],e.N.cross(r,i,n)),e.N.normalize(r,r),e.N.normalize(n,n),e.N.normalize(i,i),[r[0],r[1],r[2],0,n[0],n[1],n[2],0,i[0],i[1],i[2],0,t[0],t[1],t[2],1]}(p);e.a6.scale(l,l,[d,d,d*c]),e.a6.translate(l,l,[-s[0],-s[1],-s[2]]);const m=e.a6.multiply([],i.globeMatrix,f);return e.a6.multiply(m,m,l),e.a6.multiply(m,m,t),m}(t,i,n);if(r>0){const n=function(t,i){const n=i.worldSize,r=fl(1,0)*n*xl(i.center.lat,i.zoom)/Qh(n),s=fl(1,i.center.lat)*n,o=e.a6.identity([]);return e.a6.rotateY(o,o,x(i.center.lng)),e.a6.rotateX(o,o,x(i.center.lat)),e.a6.translate(o,o,[0,0,ja]),e.a6.scale(o,o,[r,r,r*s]),e.a6.translate(o,o,[i.point.x-.5*n,i.point.y-.5*n,0]),e.a6.multiply(o,o,t),e.a6.multiply(o,i.globeMatrix,o)}(t,i);return function(t,i,n){const r=(t,i,n)=>{const r=e.N.length(t),s=e.N.length(i),o=Gh(t,i,n);return e.N.scale(o,o,1/e.N.length(o)*ct(r,s,n))},s=r([t[0],t[1],t[2]],[i[0],i[1],i[2]],n),o=r([t[4],t[5],t[6]],[i[4],i[5],i[6]],n),a=r([t[8],t[9],t[10]],[i[8],i[9],i[10]],n),l=Gh([t[12],t[13],t[14]],[i[12],i[13],i[14]],n);return[s[0],s[1],s[2],0,o[0],o[1],o[2],0,a[0],a[1],a[2],0,l[0],l[1],l[2],1]}(s,n,r)}return s}function ry(e,t,i,n){const r=Rh.projectAabbCorners(n,i);let s=Number.MAX_VALUE,o=-1;for(let e=0;e<r.length;++e){const i=r[e];i[0]=(.5*i[0]+.5)*t.width,i[1]=(.5-.5*i[1])*t.height,i[2]<s&&(o=e,s=i[2])}const a=e=>new _(r[e][0],r[e][1]);let l;switch(o){case 0:case 6:l=[a(1),a(5),a(4),a(7),a(3),a(2),a(1)];break;case 1:case 7:l=[a(0),a(4),a(5),a(6),a(2),a(3),a(0)];break;case 3:case 5:l=[a(1),a(0),a(4),a(7),a(6),a(2),a(1)];break;default:l=[a(1),a(5),a(6),a(7),a(3),a(0),a(1)]}if(Nl(e,l))return s}const sy=uo([{name:"a_pos_3f",components:3,type:"Float32"}]),oy=uo([{name:"a_color_3f",components:3,type:"Float32"}]),ay=uo([{name:"a_color_4f",components:4,type:"Float32"}]),ly=uo([{name:"a_uv_2f",components:2,type:"Float32"}]),cy=uo([{name:"a_normal_3f",components:3,type:"Float32"}]),uy=uo([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),hy=uo([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class dy{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class py{constructor(){this.instancedDataArray=new Uo,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class fy{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,t,i,n){this.tileToMeter=wl(i);const r=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:s,id:o,index:a,sourceLayerIndex:l}of e){const e=Rl(s,r);if(!this.layers[0]._featureFilter.filter(new As(this.zoom),e,i))continue;const c={id:o,sourceLayerIndex:l,index:a,geometry:r?e.geometry:kl(s,i,n),properties:s.properties,type:s.type,patterns:{}},u=this.addFeature(c,c.geometry,e);u&&t.featureIndex.insert(s,c.geometry,a,l,this.index,this.instancesPerModel[u].instancedDataArray.length,ki/32)}this.lookup=null}update(e,t,i,n){for(const t in this.instancesPerModel){const i=this.instancesPerModel[t];for(const t in e)i.idToFeaturesIndex.hasOwnProperty(t)&&this.evaluate(i.features[i.idToFeaturesIndex[t]],e[t],i,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const i in this.instancesPerModel){const n=this.instancesPerModel[i];for(const i of n.features){const r=this.layers[0],s=i.feature,o=this.canonical,a=r.paint.get("model-rotation").evaluate(s,{},o),l=r.paint.get("model-scale").evaluate(s,{},o),c=r.paint.get("model-translation").evaluate(s,{},o);e.N.exactEquals(i.rotation,a)&&e.N.exactEquals(i.scale,l)&&e.N.exactEquals(i.translation,c)||(this.evaluate(i,i.featureStates,n,!0),t=!0)}}return t}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const i=this.instancesPerModel[t];i.instancedDataArray.length<0||0===i.instancedDataArray.length||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=e.createVertexBuffer(i.instancedDataArray,uy.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const t=this.instancesPerModel[e];0!==t.instancedDataArray.length&&t.instancedDataBuffer&&t.instancedDataBuffer.destroy()}}addFeature(e,t,i){const n=this.layers[0],r=n.layout.get("model-id").evaluate(i,{},this.canonical);if(!r)return j(`modelId is not evaluated for layer ${n.id} and it is not going to get rendered.`),r;this.instancesPerModel[r]||(this.instancesPerModel[r]=new py);const s=this.instancesPerModel[r],o=s.instancedDataArray,a=new dy(i,o.length);for(const e of t)for(const t of e){if(t.x<0||t.x>=ki||t.y<0||t.y>=ki)continue;const e=(this.lookupDim-1)/ki,i=this.lookupDim*(t.y*e|0)+t.x*e|0;if(this.lookup){if(0!==this.lookup[i])continue;this.lookup[i]=1}this.instanceCount++;const n=o.length;o.resize(n+1),s.instancesEvaluatedElevation.push(0),o.float32[16*n]=t.x,o.float32[16*n+1]=t.y}return a.instancedDataCount=s.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(e.id&&(s.idToFeaturesIndex[e.id]=s.features.length),s.features.push(a),this.evaluate(a,{},s,!1)),r}evaluate(e,t,i,n){const r=this.layers[0],s=e.feature,o=this.canonical,a=e.rotation=r.paint.get("model-rotation").evaluate(s,t,o),l=e.scale=r.paint.get("model-scale").evaluate(s,t,o),c=e.translation=r.paint.get("model-translation").evaluate(s,t,o),u=r.paint.get("model-color").evaluate(s,t,o);u.a=r.paint.get("model-color-mix-intensity").evaluate(s,t,o);const h=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),ty(h,a,l);const d=Math.round(100*u.a)+u.b/1.05;for(let t=0;t<e.instancedDataCount;++t){const r=e.instancedDataOffset+t,s=16*r,a=i.instancedDataArray.float32;let l=0;n&&(l=a[s+6]-i.instancesEvaluatedElevation[r]);const p=0|a[s+1];a[s]=(0|a[s])+u.r/1.05,a[s+1]=p+u.g/1.05,a[s+2]=d,a[s+3]=1/(o.z>10?this.tileToMeter:wl(o,p)),a[s+4]=c[0],a[s+5]=c[1],a[s+6]=c[2]+l,a[s+7]=h[0],a[s+8]=h[1],a[s+9]=h[2],a[s+10]=h[4],a[s+11]=h[5],a[s+12]=h[6],a[s+13]=h[8],a[s+14]=h[9],a[s+15]=h[10],i.instancesEvaluatedElevation[r]=c[2]}}}is(fy,"ModelBucket",{omit:["layers"]}),is(py,"PerModelAttributes"),is(dy,"ModelFeature");const my=new Us({visibility:new zs(Gs.layout_model.visibility),"model-id":new Fs(Gs.layout_model["model-id"])});var gy={paint:new Us({"model-opacity":new zs(Gs.paint_model["model-opacity"]),"model-rotation":new Fs(Gs.paint_model["model-rotation"]),"model-scale":new Fs(Gs.paint_model["model-scale"]),"model-translation":new Fs(Gs.paint_model["model-translation"]),"model-color":new Fs(Gs.paint_model["model-color"]),"model-color-mix-intensity":new Fs(Gs.paint_model["model-color-mix-intensity"]),"model-type":new zs(Gs.paint_model["model-type"]),"model-cast-shadows":new zs(Gs.paint_model["model-cast-shadows"]),"model-receive-shadows":new zs(Gs.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new zs(Gs.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Fs(Gs.paint_model["model-emissive-strength"]),"model-roughness":new Fs(Gs.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Fs(Gs.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new zs(Gs.paint_model["model-cutoff-fade-range"])}),layout:my};const _y=64,yy={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function vy(t,i,n,r,s,o,a,l,c,u=!1){const h=n.zoom,d=n.project(r),p=xl(r.lat,h),f=1/p;e.a6.identity(t),e.a6.translate(t,t,[d.x+a[0]*f,d.y+a[1]*f,a[2]]);let m=1,g=1;const _=n.worldSize;if(u){if("mercator"===n.projection.name){let t=0;n.elevation&&(t=n.elevation.getAtPointOrZero(new Sl(d.x/_,d.y/_),0));const i=e.a7.transformMat4([],[d.x,d.y,t,1],n.projMatrix)[3]/n.cameraToCenterDistance;m=i,g=i*xl(n.center.lat,h)}else if("globe"===n.projection.name){const i=ny(t,n),s=e.a6.multiply([],n.projMatrix,i),o=[0,0,0,1];e.a7.transformMat4(o,o,s);const a=o[3]/n.cameraToCenterDistance,l=id(h),c=n.projection.pixelsPerMeter(r.lat,_)*xl(r.lat,h),u=n.projection.pixelsPerMeter(n.center.lat,_)*xl(n.center.lat,h);m=a/ct(c,vl(n.center.lat),l),g=a*p/c,m*=u,g*=u}}else m=f;e.a6.scale(t,t,[m,m,g]);const y=[...t],v=i.orientation,x=[];if(ty(x,[v[0]+s[0],v[1]+s[1],v[2]+s[2]],o),e.a6.multiply(t,y,x),l&&n.elevation){let s=0;const o=[];if(c&&n.elevation){s=function(t,i,n,r,s){const o=i.elevation;if(!o)return 0;const a=Rh.projectAabbCorners(n,r),l=fl(1,s.lat)*i.worldSize,c=function(t,i){const n=[0,0,1],r=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const s of r){const r=t[s.corners[0]],o=t[s.corners[1]],a=t[s.corners[2]],l=[o[0]-r[0],o[1]-r[1],i*(o[2]-r[2])],c=e.N.cross(l,l,[a[0]-r[0],a[1]-r[1],i*(a[2]-r[2])]);e.N.normalize(c,c),s.dotProductWithUp=e.N.dot(c,n)}return r.sort(((e,t)=>e.dotProductWithUp-t.dotProductWithUp)),r[0].corners}(a,l),u=a[c[0]],h=a[c[1]],d=a[c[2]],p=a[c[3]],f=o.getAtPointOrZero(new Sl(u[0]/i.worldSize,u[1]/i.worldSize),0),m=o.getAtPointOrZero(new Sl(h[0]/i.worldSize,h[1]/i.worldSize),0),g=o.getAtPointOrZero(new Sl(d[0]/i.worldSize,d[1]/i.worldSize),0),_=o.getAtPointOrZero(new Sl(p[0]/i.worldSize,p[1]/i.worldSize),0),y=(f+_)/2,v=(m+g)/2;return y>v?m<g?iy(t,h,p,u,m,_,f,l):iy(t,d,u,p,g,f,_,l):f<_?iy(t,u,h,d,f,m,g,l):iy(t,p,d,h,_,g,m,l),Math.max(y,v)}(o,n,i.aabb,t,r);const a=e.a6.fromQuat([],o),l=e.a6.multiply([],a,x);e.a6.multiply(t,y,l)}else s=n.elevation.getAtPointOrZero(new Sl(d.x/_,d.y/_),0);0!==s&&(t[14]+=s)}}function xy(e,t,i=!1){e.uploaded||(e.gfxTexture=new L_(t,e.image,i?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function by(e,t,i){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,sy.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,cy.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,ly.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?oy:ay).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,hy.members,!0)),e.segments=ia.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const n=e.material;n.pbrMetallicRoughness.baseColorTexture&&xy(n.pbrMetallicRoughness.baseColorTexture,t),n.pbrMetallicRoughness.metallicRoughnessTexture&&xy(n.pbrMetallicRoughness.metallicRoughnessTexture,t),n.normalTexture&&xy(n.normalTexture,t),n.occlusionTexture&&xy(n.occlusionTexture,t,i),n.emissionTexture&&xy(n.emissionTexture,t)}function wy(e,t,i){if(e.meshes)for(const n of e.meshes)by(n,t,i);if(e.children)for(const n of e.children)wy(n,t,i)}function Sy(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)Sy(t)}function Ty(e){if(e.meshes)for(const i of e.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((t=i.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const t of e.children)Ty(t)}class Ey{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class My{constructor(){this.tasks={},this.taskQueue=[],N(["process"],this),this.invoker=new Ey(this.process),this.nextId=0}add(e,t){const i=this.nextId++,n=function({type:e,isSymbolTile:t,zoom:i}){return i=i||0,"message"===e?0:"maybePrepare"!==e||t?"parseTile"!==e||t?"parseTile"===e&&t?300-i:"maybePrepare"===e&&t?400-i:500:200-i:100-i}(t);if(0===n){q();try{e()}finally{}return null}return this.tasks[i]={fn:e,metadata:t,priority:n,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){q();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const n=this.tasks[this.taskQueue[i]];n.priority<t&&(t=n.priority,e=i)}if(null===e)return null;const i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class Iy{constructor(e,t,i){this.target=e,this.parent=t,this.mapId=i,this.callbacks={},this.cancelCallbacks={},N(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new My}send(e,t,i,n,r=!1,s){const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=s,this.callbacks[o]=i);const a=new Set;return this.target.postMessage({id:o,type:e,hasCallback:!!i,targetMapId:n,mustQueue:r,sourceMapId:this.mapId,data:ss(t,a)},a),{cancel:()=>{i&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(e){const t=e.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[i];delete this.cancelCallbacks[i],e&&e.cancel()}else if(t.mustQueue||q()){const e=this.callbacks[i],n=this.scheduler.add((()=>this.processTask(i,t)),e&&e.metadata||{type:"message"});n&&(this.cancelCallbacks[i]=n)}else this.processTask(i,t)}processTask(e,t){if(delete this.cancelCallbacks[e],"<response>"===t.type){const i=this.callbacks[e];delete this.callbacks[e],i&&(t.error?i(os(t.error)):i(null,os(t.data)))}else{const i=new Set,n=t.hasCallback?(t,n)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?ss(t):null,data:ss(n,i)},i)}:e=>{},r=os(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,r,n);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],r.source,r.scope)[e[1]](r,n)}else n(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Ay{constructor(e,t){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=R();const i=this.workerPool.acquire(this.id);for(let e=0;e<i.length;e++){const n=new Ay.Actor(i[e],t,this.id);n.name=`Worker ${e}`,this.actors.push(n)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,t,i){C(this.actors,((i,n)=>{i.send(e,t,n)}),i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}Ay.Actor=Iy;var Cy={workerUrl:"",workerClass:null,workerParams:void 0};function Py(){return null!=Cy.workerClass?new Cy.workerClass:new self.Worker(Cy.workerUrl,Cy.workerParams)}const ky="mapboxgl_preloaded_worker_pool";class Ry{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Ry.workerCount;)this.workers.push(new Py);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[ky]}numActive(){return Object.keys(this.active).length}}let Ly;function Dy(){return Ly||(Ly=new Ry),Ly}Ry.workerCount=2;let Oy,Ny,zy,Fy,By,Uy=null;function Vy(){return q()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Ny||n.DRACO_URL}function jy(){if(q()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Fy)return Fy;const e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Fy=WebAssembly.validate(e)?n.MESHOPT_SIMD_URL:n.MESHOPT_URL,Fy}const Gy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Hy={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Wy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function qy(e,t,i){const n=i.json.bufferViews.length,r=i.buffers.length;t.bufferView=n,i.json.bufferViews[n]={buffer:r,byteLength:e.byteLength},i.buffers[r]=e}const $y="KHR_draco_mesh_compression";function Zy(e,t){const i=e.extensions&&e.extensions[$y];if(!i)return;const n=new zy.Decoder,r=tv(t,i.bufferView),s=new zy.Mesh;if(!n.DecodeArrayToMesh(r,r.byteLength,s))throw new Error("Failed to decode Draco mesh");const o=t.json.accessors[e.indices],a=Gy[o.componentType],l=o.count*a.BYTES_PER_ELEMENT,c=zy._malloc(l);a===Uint16Array?n.GetTrianglesUInt16Array(s,l,c):n.GetTrianglesUInt32Array(s,l,c),qy(zy.memory.buffer.slice(c,c+l),o,t),zy._free(c);for(const r of Object.keys(i.attributes)){const o=n.GetAttributeByUniqueId(s,i.attributes[r]),a=t.json.accessors[e.attributes[r]],l=Hy[a.componentType],c=a.count*Wy[a.type]*Gy[a.componentType].BYTES_PER_ELEMENT,u=zy._malloc(c);n.GetAttributeDataArrayForAllPoints(s,o,zy[l],c,u),qy(zy.memory.buffer.slice(u,u+c),a,t),zy._free(u)}n.destroy(),s.destroy(),delete e.extensions[$y]}const Xy="EXT_meshopt_compression";function Yy(e,t){if(!e.extensions||!e.extensions[Xy])return;const i=e.extensions[Xy],n=new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),r=new Uint8Array(i.count*i.byteStride);By.decodeGltfBuffer(r,i.count,i.byteStride,n,i.mode,i.filter),e.buffer=t.buffers.length,e.byteOffset=0,t.buffers[e.buffer]=r.buffer,delete e.extensions[Xy]}const Ky=1179937895,Jy=new TextDecoder("utf8");function Qy(e,t){return new URL(e,t).href}function ev(e,t,i,n){return fetch(Qy(e.uri,n)).then((e=>e.arrayBuffer())).then((e=>{t.buffers[i]=e}))}function tv(e,t){const i=e.json.bufferViews[t];return new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function iv(e,t,i,n){if(e.uri){const r=Qy(e.uri,n);return fetch(r).then((e=>e.blob())).then((e=>createImageBitmap(e))).then((e=>{t.images[i]=e}))}if(void 0!==e.bufferView){const n=tv(t,e.bufferView),r=new Blob([n],{type:e.mimeType});return createImageBitmap(r).then((e=>{t.images[i]=e}))}}function nv(e,t=0,i){const n={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===Ky){const i=new Uint32Array(e,t);let r=2;const s=(i[r++]>>2)-3,o=i[r++]>>2;if(r++,n.json=JSON.parse(Jy.decode(i.subarray(r,r+o))),r+=o,r<s){const s=i[r++];r++;const o=t+(r<<2);n.buffers[0]=e.slice(o,o+s)}}else n.json=JSON.parse(Jy.decode(new Uint8Array(e,t)));const{buffers:r,images:s,meshes:o,extensionsUsed:a,bufferViews:l}=n.json;let c=Promise.resolve();if(r){const e=[];for(let t=0;t<r.length;t++){const s=r[t];s.uri?e.push(ev(s,n,t,i)):n.buffers[t]||(n.buffers[t]=null)}c=Promise.all(e)}return c.then((()=>{const e=[],t=a&&a.includes($y),r=a&&a.includes(Xy);if(t&&e.push(function(){if(!zy)return Oy||(Oy=function(e){let t,i=null;function n(){t=new Uint8Array(i.buffer)}function r(){throw new Error("Unexpected Draco error.")}const s={a:{a:r,d:function(e,i,n){return t.copyWithin(e,i,i+n)},c:function(e){const r=t.length,s=Math.max(e>>>0,Math.ceil(1.2*r)),o=Math.ceil((s-r)/65536);try{return i.grow(o),n(),!0}catch(e){return!1}},b:r}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,s):e.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,s)))).then((e=>{const{Rb:r,Qb:s,P:o,T:a,X:l,Ja:c,La:u,Qa:h,Va:d,Wa:p,eb:f,jb:m,f:g,e:_,yb:y,zb:v,Ab:x,Bb:b,Db:w,Gb:S}=e.instance.exports;i=_;const T=(()=>{let e=0,i=0,n=0,o=0;return a=>{n&&(r(o),r(e),i+=n,n=e=0),e||(i+=128,e=s(i));const l=a.length+7&-8;let c=e;l>=i&&(n=l,c=o=s(l));for(let e=0;e<a.length;e++)t[c+e]=a[e];return c}})();return n(),g(),{memory:_,_free:r,_malloc:s,Mesh:class{constructor(){this.ptr=o()}destroy(){a(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){m(this.ptr)}DecodeArrayToMesh(e,t,i){const n=T(e),r=u(this.ptr,n,t,i.ptr);return!!l(r)}GetAttributeByUniqueId(e,t){return{ptr:h(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,i){d(this.ptr,e.ptr,t,i)}GetTrianglesUInt32Array(e,t,i){p(this.ptr,e.ptr,t,i)}GetAttributeDataArrayForAllPoints(e,t,i,n,r){f(this.ptr,e.ptr,t.ptr,i,n,r)}},DT_INT8:y(),DT_UINT8:v(),DT_INT16:x(),DT_UINT16:b(),DT_UINT32:w(),DT_FLOAT32:S()}}))}(fetch(Vy())),Oy.then((e=>{zy=e,Oy=void 0})))}()),r&&e.push(function(){if(By)return;const e=function(e){let t;const i=WebAssembly.instantiateStreaming(e,{}).then((e=>{t=e.instance,t.exports.__wasm_call_ctors()})),n={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},r={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:i,supported:!0,decodeGltfBuffer(e,i,s,o,a,l){!function(e,t,i,n,r,s,o){const a=e.exports.sbrk,l=n+3&-4,c=a(l*r),u=a(s.length),h=new Uint8Array(e.exports.memory.buffer);h.set(s,u);const d=t(c,n,r,u,s.length);if(0===d&&o&&o(c,l,r),i.set(h.subarray(c,c+n*r)),a(c-a(0)),0!==d)throw new Error(`Malformed buffer data: ${d}`)}(t,t.exports[r[a]],e,i,s,o,t.exports[n[l]])}}}(fetch(jy()));return e.ready.then((()=>{By=e}))}()),s)for(let t=0;t<s.length;t++)e.push(iv(s[t],n,t,i));return(e.length?Promise.all(e):Promise.resolve()).then((()=>{if(t&&o)for(const{primitives:e}of o)for(const t of e)Zy(t,n);if(r&&o&&l)for(const e of l)Yy(e,n);return n}))}))}class rv{constructor(e,t,i){if(this.triangleCount=t.length/3,this.min=new _(0,0),this.max=new _(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length||0===i)return;const n=e.map((e=>e.x)),r=e.map((e=>e.y));this.min=new _(Math.min(...n),Math.min(...r)),this.max=new _(Math.max(...n),Math.max(...r));const s=this.max.sub(this.min);s.x=Math.max(s.x,1),s.y=Math.max(s.y,1);const o=Math.max(s.x,s.y)/i;this.cellsX=Math.max(1,Math.ceil(s.x/o)),this.cellsY=Math.max(1,Math.ceil(s.y/o)),this.xScale=1/o,this.yScale=1/o;const a=[];for(let i=0;i<this.triangleCount;i++){const n=e[t[3*i+0]].sub(this.min),r=e[t[3*i+1]].sub(this.min),s=e[t[3*i+2]].sub(this.min),l=sv(Math.floor(Math.min(n.x,r.x,s.x)),this.xScale,this.cellsX),c=sv(Math.floor(Math.max(n.x,r.x,s.x)),this.xScale,this.cellsX),u=sv(Math.floor(Math.min(n.y,r.y,s.y)),this.yScale,this.cellsY),h=sv(Math.floor(Math.max(n.y,r.y,s.y)),this.yScale,this.cellsY),d=new _(0,0),p=new _(0,0),f=new _(0,0),m=new _(0,0);for(let e=u;e<=h;++e){d.y=p.y=e*o,f.y=m.y=(e+1)*o;for(let t=l;t<=c;++t)d.x=f.x=t*o,p.x=m.x=(t+1)*o,(Xl(n,r,s,d,p,m)||Xl(n,r,s,d,m,f))&&a.push({cellIdx:e*this.cellsX+t,triIdx:i})}}if(0===a.length)return;a.sort(((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx));let l=0;for(;l<a.length;){const e=a[l].cellIdx,t={start:this.payload.length,len:0};for(;l<a.length&&a[l].cellIdx===e;)++t.len,this.payload.push(a[l++].triIdx);this.cells[e]=t}}query(e,t,i){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let e=0;e<this.lookup.length;e++)this.lookup[e]=0;const n=sv(e.x-this.min.x,this.xScale,this.cellsX),r=sv(t.x-this.min.x,this.xScale,this.cellsX),s=sv(e.y-this.min.y,this.yScale,this.cellsY),o=sv(t.y-this.min.y,this.yScale,this.cellsY);for(let e=s;e<=o;e++)for(let t=n;t<=r;t++){const n=this.cells[e*this.cellsX+t];if(n)for(let e=0;e<n.len;e++){const t=this.payload[n.start+e],r=Math.floor(t/8),s=1<<t%8;if(!(this.lookup[r]&s)&&(this.lookup[r]|=s,i.push(t),i.length===this.triangleCount))return}}}}function sv(e,t,i){return Math.max(0,Math.min(i-1,Math.floor(e*t)))}function ov(e,t){const i=e.json.bufferViews[t.bufferView],n=Gy[t.componentType];return new n(e.buffers[i.buffer],(t.byteOffset||0)+(i.byteOffset||0),t.count*(i.byteStride&&i.byteStride!==Wy[t.type]*n.BYTES_PER_ELEMENT?i.byteStride/n.BYTES_PER_ELEMENT:Wy[t.type]))}function av(e,t,i,n){const r=Gy[t.componentType],s=function(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(r),o=e.json.bufferViews[t.bufferView],a=o.byteStride?o.byteStride/r.BYTES_PER_ELEMENT:Wy[t.type],l=i.float32,c=l.length/i.capacity;for(let e=0,i=0;e<t.count*a;e+=a,i+=c)for(let t=0;t<c;t++)l[i+t]=n[e+t]*s;i._trim()}function lv(e,t,i){const n=e.indices,r=e.attributes,s={};s.indexArray=new Po;const o=t.json.accessors[n],a=o.count/3;s.indexArray.reserve(a);const l=ov(t,o);for(let e=0;e<a;e++)s.indexArray.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);s.indexArray._trim(),s.vertexArray=new Fo;const c=t.json.accessors[r.POSITION];s.vertexArray.reserve(c.count);const u=ov(t,c);for(let e=0;e<c.count;e++)s.vertexArray.emplaceBack(u[3*e],u[3*e+1],u[3*e+2]);if(s.vertexArray._trim(),s.aabb=new Rh(c.min,c.max),s.centroid=function(e,t){const i=[0,0,0],n=e.length;if(n>0){for(let r=0;r<n;r++){const n=3*e[r];i[0]+=t[n],i[1]+=t[n+1],i[2]+=t[n+2]}i[0]/=n,i[1]/=n,i[2]/=n}return i}(l,u),void 0!==r.COLOR_0){const e=t.json.accessors[r.COLOR_0],i=Wy[e.type],n=ov(t,e);s.colorArray=3===i?new Fo:new yo,s.colorArray.resize(e.count),av(t,e,s.colorArray,n)}if(void 0!==r.NORMAL){s.normalArray=new Fo;const e=t.json.accessors[r.NORMAL];s.normalArray.resize(e.count);const i=ov(t,e);av(t,e,s.normalArray,i)}if(void 0!==r.TEXCOORD_0&&i.length>0){s.texcoordArray=new Bo;const e=t.json.accessors[r.TEXCOORD_0];s.texcoordArray.resize(e.count);const i=ov(t,e);av(t,e,s.texcoordArray,i)}if(void 0!==r._FEATURE_ID_RGBA4444){const e=t.json.accessors[r._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(s.featureData=ov(t,e))}void 0!==r._FEATURE_RGBA4444&&(s.featureData=new Uint32Array(ov(t,t.json.accessors[r._FEATURE_RGBA4444]).buffer));const h=e.material;return s.material=function(e,t){const{emissiveFactor:i=[0,0,0],alphaMode:n="OPAQUE",alphaCutoff:r=.5,normalTexture:s,occlusionTexture:o,emissiveTexture:a,doubleSided:l}=e,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:h=1,baseColorTexture:d,metallicRoughnessTexture:p}=e.pbrMetallicRoughness||{},f=o?t[o.index]:void 0;if(o&&o.extensions&&o.extensions.KHR_texture_transform&&f){const e=o.extensions.KHR_texture_transform;f.offsetScale=[e.offset[0],e.offset[1],e.scale[0],e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new lt(...c),metallicFactor:u,roughnessFactor:h,baseColorTexture:d?t[d.index]:void 0,metallicRoughnessTexture:p?t[p.index]:void 0},doubleSided:l,emissiveFactor:i,alphaMode:n,alphaCutoff:r,normalTexture:s?t[s.index]:void 0,occlusionTexture:f,emissionTexture:a?t[a.index]:void 0,defined:void 0===e.defined}}(void 0!==h?t.json.materials[h]:{defined:!1},i),s}function cv(t,i,n){const{matrix:r,rotation:s,translation:o,scale:a,mesh:l,extras:c,children:u}=t,h={};if(h.matrix=r||e.a6.fromRotationTranslationScale([],s||[0,0,0,1],o||[0,0,0],a||[1,1,1]),void 0!==l){h.meshes=n[l];const e=h.anchor=[0,0];for(const t of h.meshes){const{min:i,max:n}=t.aabb;e[0]+=i[0]+n[0],e[1]+=i[1]+n[1]}e[0]=Math.floor(e[0]/h.meshes.length/2),e[1]=Math.floor(e[1]/h.meshes.length/2)}if(c&&(c.id&&(h.id=c.id),c.lights&&(h.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),i=new Uint8Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.codePointAt(e);return i}(e),i=[],n=t.length/24,r=new Uint16Array(t.buffer),s=new Float32Array(t.buffer);for(let e=0;e<n;e++){const t=r[2*e*6]/30,n=r[2*e*6+1]/30,o=r[2*e*6+10]/100,a=s[6*e+1],l=s[6*e+2],c=s[6*e+3],u=s[6*e+4],h=c-a,d=u-l,p=Math.hypot(h,d);i.push({pos:[a+.5*h,l+.5*d,n],normal:[d/p,-h/p,0],width:p,height:t,depth:o,points:[a,l,c,u]})}return i}(c.lights))),u){const e=[];for(const t of u)e.push(cv(i.json.nodes[t],i,n));h.children=e}return h}function uv(e){if(0===e.vertices.length||0===e.indices.length)return null;const[t,i]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let n=1;n<e.vertices.length;++n){const r=e.vertices[n];t.x=Math.min(t.x,r.x),t.y=Math.min(t.y,r.y),i.x=Math.max(i.x,r.x),i.y=Math.max(i.y,r.y)}const n=Math.ceil(Math.max(i.x-t.x,i.y-t.y)/256),r=Math.max(8,n),s=new rv(e.vertices,e.indices,r);return{vertices:e.vertices,indices:e.indices,grid:s,min:t,max:i}}function hv(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const i=t[0];if(!i||!Array.isArray(i)||0===i.length)return null;const n=[];for(const e of i){if(!Array.isArray(e)||2!==e.length)continue;const t=e[0],i=e[1];"number"==typeof t&&"number"==typeof i&&n.push(new _(t,i))}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let r=0;for(let e=0;e<n.length;e++){const t=n[e],i=n[(e+1)%n.length],s=n[(e+2)%n.length];r+=(t.x-i.x)*(s.y-i.y)-(s.x-i.x)*(t.y-i.y)}r>0&&n.reverse();const s=ip(n.flatMap((e=>[e.x,e.y])),[]);return 0===s.length?null:{vertices:n,indices:s}}function dv(e){const t=[],i=[];let n=0;for(const r of e){n=t.length;const e=r.vertexArray.float32,s=r.indexArray.uint16;for(let i=0;i<r.vertexArray.length;i++)t.push(new _(e[3*i+0],e[3*i+1]));for(let e=0;e<3*r.indexArray.length;e++)i.push(s[e]+n)}if(i.length%3!=0)return null;for(let e=0;e<i.length;e+=3){const n=t[i[e+0]],r=t[i[e+1]],s=t[i[e+2]];(n.x-r.x)*(s.y-r.y)-(s.x-r.x)*(n.y-r.y)>0&&([i[e+1],i[e+2]]=[i[e+2],i[e+1]])}return{vertices:t,indices:i}}function pv(e){const t=function(e,t){const i=[],n=WebGL2RenderingContext;if(e.json.textures)for(const r of e.json.textures){const s={magFilter:n.LINEAR,minFilter:n.NEAREST,wrapS:n.REPEAT,wrapT:n.REPEAT};void 0!==r.sampler&&Object.assign(s,e.json.samplers[r.sampler]),i.push({image:t[r.source],sampler:s,uploaded:!1})}return i}(e,e.images),i=function(e,t){const i=[];for(const n of e.json.meshes){const r=[];for(const i of n.primitives)r.push(lv(i,e,t));i.push(r)}return i}(e,t),{scenes:n,scene:r,nodes:s}=e.json,o=n?n[r||0].nodes:s,a=[];for(const t of o)a.push(cv(s[t],e,i));return function(e,t,i){const n={},r=new Set;for(let s=0;s<e.length;s++){const e=i[t[s]];if(!e.extras)continue;const o=e.extras["mapbox:footprint:version"],a=e.extras["mapbox:footprint:id"];(o||a)&&r.add(s),"1.0.0"===o&&a&&(n[a]=s)}for(let s=0;s<e.length;s++){if(r.has(s))continue;const o=e[s],a=i[t[s]];if(!a.extras)continue;let l=null;o.id in n&&(l=dv(e[n[o.id]].meshes)),l||(l=hv(a)),l&&(o.footprint=uv(l))}if(r.size>0){const t=Array.from(r.values()).sort(((e,t)=>e-t));for(let i=t.length-1;i>=0;i--)e.splice(t[i],1)}}(a,o,e.json.nodes),a}function fv(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,i=e.aabb.min[0]-1,n=e.aabb.min[1]-1,r=_y/(e.aabb.max[0]-i+2),s=_y/(e.aabb.max[1]-n+2);for(let o=0;o<t.length;o+=3){const a=t[o+2],l=(t[o+0]-i)*r|0,c=(t[o+1]-n)*s|0;a>e.heightmap[c*_y+l]&&(e.heightmap[c*_y+l]=a)}}function mv(t,i){const n={};n.indexArray=new Po,n.indexArray.reserve(4*t.length),n.vertexArray=new Fo,n.vertexArray.reserve(10*t.length),n.colorArray=new yo,n.vertexArray.reserve(10*t.length);let r=0;for(const s of t){const t=Math.min(10,Math.max(4,1.3*s.height))*i,o=[-s.normal[1],s.normal[0],0],a=Math.min(.29,.1*s.width/s.depth),l=s.width-2*s.depth*i*(a+.01),c=e.N.scaleAndAdd([],s.pos,o,l/2),u=e.N.scaleAndAdd([],s.pos,o,-l/2),h=[c[0],c[1],c[2]+s.height],d=[u[0],u[1],u[2]+s.height],p=e.N.scaleAndAdd([],s.normal,o,a);e.N.scale(p,p,t);const f=e.N.scaleAndAdd([],s.normal,o,-a);e.N.scale(f,f,t),e.N.add(p,c,p),e.N.add(f,u,f),c[2]+=.1,u[2]+=.1,n.vertexArray.emplaceBack(p[0],p[1],p[2]),n.vertexArray.emplaceBack(f[0],f[1],f[2]),n.vertexArray.emplaceBack(c[0],c[1],c[2]),n.vertexArray.emplaceBack(u[0],u[1],u[2]),n.vertexArray.emplaceBack(h[0],h[1],h[2]),n.vertexArray.emplaceBack(d[0],d[1],d[2]),n.vertexArray.emplaceBack(c[0],c[1],c[2]),n.vertexArray.emplaceBack(u[0],u[1],u[2]),n.vertexArray.emplaceBack(p[0],p[1],p[2]),n.vertexArray.emplaceBack(f[0],f[1],f[2]);const m=l/t/2;n.colorArray.emplaceBack(-m-a,-1,m,.8),n.colorArray.emplaceBack(m+a,-1,m,.8),n.colorArray.emplaceBack(-m,0,m,1.3),n.colorArray.emplaceBack(m,0,m,1.3),n.colorArray.emplaceBack(m+a,-.8,m,.7),n.colorArray.emplaceBack(m+a,-.8,m,.7),n.colorArray.emplaceBack(0,0,m,1.3),n.colorArray.emplaceBack(0,0,m,1.3),n.colorArray.emplaceBack(m+a,-1.2,m,.8),n.colorArray.emplaceBack(m+a,-1.2,m,.8),n.indexArray.emplaceBack(6+r,4+r,8+r),n.indexArray.emplaceBack(7+r,9+r,5+r),n.indexArray.emplaceBack(0+r,1+r,2+r),n.indexArray.emplaceBack(1+r,3+r,2+r),r+=10}const s={defined:!0,emissiveFactor:[0,0,0]},o={};return o.baseColorFactor=lt.white,s.pbrMetallicRoughness=o,n.material=s,n.aabb=new Rh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}is(rv,"TriangleGridIndex");class gv{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const _v=["tile","layer","source","sourceLayer","state"];class yv{constructor(e,t,i,n,r){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=i,this._y=n,this.properties=e.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of _v)void 0!==this[t]&&(e[t]=this[t]);return e}}class vv{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new es(ki,16,0),this.featureIndexArray=new Jo,this.promoteId=t,this.is3DTile=!1}insert(e,t,i,n,r,s=0,o=0){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,r,s);const l=this.grid;for(let e=0;e<t.length;e++){const i=t[e],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<i.length;e++){const t=i[e];n[0]=Math.min(n[0],t.x),n[1]=Math.min(n[1],t.y),n[2]=Math.max(n[2],t.x),n[3]=Math.max(n[3],t.y)}0!==o&&(n[0]-=o,n[1]-=o,n[2]+=o,n[3]+=o),n[0]<ki&&n[1]<ki&&n[2]>=0&&n[3]>=0&&l.insert(a,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ap(new Nm(this.rawTileData)).layers,this.sourceLayerCoder=new gv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,i,n){this.loadVTLayers();const r=e.params||{},s=Ws(r.filter),o=e.tileResult,a=e.transform,l=o.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((e,t,i,n)=>ql(o.bufferedTilespaceGeometry,e,t,i,n)));c.sort(bv);let u=null;a.elevation&&c.length>0&&(u=Yp.create(a.elevation,this.tileID));const h={};let d;for(let l=0;l<c.length;l++){const p=c[l];if(p===d)continue;d=p;const f=this.featureIndexArray.get(p);let m=null;if(this.is3DTile){const e=this.bucketLayerIDs[0][0],i=t[e];if("model"!==i.type)continue;const{queryFeature:n,intersectionZ:r}=i.queryIntersectsMatchingFeature(o,f.featureIndex,s,a);n&&this.appendToResult(h,e,f.featureIndex,n,r)}else this.loadMatchingFeature(h,f,s,r.layers,r.availableImages,t,i,n,((t,i,n,r=0)=>(m||(m=kl(t,this.tileID.canonical,e.tileTransform)),i.queryIntersectsFeature(o,t,n,m,this.z,e.transform,e.pixelPosMatrix,u,r))))}return h}loadMatchingFeature(e,t,i,n,r,s,o,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=t,p=this.bucketLayerIDs[u];if(n&&!function(e,t){for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>=0)return!0;return!1}(n,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(i.needGeometry){const e=Rl(m,!0);if(!i.filter(new As(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!i.filter(new As(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let t=0;t<p.length;t++){const i=p[t];if(n&&n.indexOf(i)<0)continue;const u=s[i];if(!u)continue;let h={};void 0!==g&&a&&(h=a.getState(u.sourceLayer||"_geojsonTileLayer",g));const f=!l||l(m,u,h,d);if(!f)continue;const _=new yv(m,this.z,this.x,this.y,g),y=P({},o[i]);y.paint=xv(y.paint,u.paint,m,h,r),y.layout=xv(y.layout,u.layout,m,h,r),_.layer=y,this.appendToResult(e,i,c,_,f)}}appendToResult(e,t,i,n,r){let s=e[t];void 0===s&&(s=e[t]=[]),s.push({featureIndex:i,feature:n,intersectionZ:r})}lookupSymbolFeatures(e,t,i,n,r,s,o,a){const l={};this.loadVTLayers();const c=Ws(r);for(const r of e)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:n,featureIndex:r,layoutVertexArrayOffset:0},c,s,o,a,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:i}=e;this.loadVTLayers();const n=this.sourceLayerCoder.decode(i),r=this.vtFeatures[n];if(r[t])return r[t];const s=this.vtLayers[n].feature(t);return r[t]=s,s}hasLayer(e){for(const t of this.bucketLayerIDs)for(const i of t)if(e===i)return!0;return!1}getId(e,t){let i=e.id;if(this.promoteId){const n="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=n&&(i=e.properties[n]),"boolean"==typeof i&&(i=Number(i))}return i}}function xv(e,t,i,n,r){return F(e,((e,s)=>{const o=t instanceof Ns?t.get(s):null;return o&&o.evaluate?o.evaluate(i,n,r):o}))}function bv(e,t){return t-e}is(vv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const wv=new Float32Array(262144),Sv=new Uint8Array(262144);function Tv(e){let t=0;if(e.meshes)for(const i of e.meshes)t=Math.max(t,i.aabb.max[2]);if(e.children)for(const i of e.children)t=Math.max(t,Tv(i));return t}function Ev(e,t,i){if(e.meshes)for(const n of e.meshes)n.aabb.min[0]!==1/0&&i.insert(t,n.aabb.min[0],n.aabb.min[1],n.aabb.max[0],n.aabb.max[1]);if(e.children)for(const n of e.children)Ev(n,t,i)}const Mv=["","wall","door","roof","window","lamp","logo"];class Iv{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Tv(e)}}}getLocalBounds(){if(!this.node.meshes)return new Rh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const t=new Rh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.node.meshes)this.node.lightMeshIndex!==e&&t.encapsulate(i.aabb),e++;this.aabb=t}return this.aabb}}class Av{constructor(e,t,i,n,r,s){this.id=t,this.modelTraits|=yy.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=yy.HasMapboxMeshFeatures),n&&(this.modelTraits|=yy.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=r,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const t of e)this.nodesInfo.push(new Iv(t)),Ev(t,s.featureIndexArray.length,s.grid),s.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,s.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const i of t){const t=i.node;this.uploaded?this.updatePbrBuffer(t):wy(t,e,!0)}for(const e of t)Sy(e.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const i of e.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),t=!0);return t}needsReEvaluation(e,t,i){const n=e.transform.projectionOptions,r=e.style.getBrightness(),s=this.brightness!==r;return!!(!this.uploaded||this.dirty||n.name!==this.projection.name||Cv(i.paint.get("model-color").value,s)||Cv(i.paint.get("model-color-mix-intensity").value,s)||Cv(i.paint.get("model-roughness").value,s)||Cv(i.paint.get("model-emissive-strength").value,s)||Cv(i.paint.get("model-height-based-emissive-strength-multiplier").value,s))&&(this.projection=n,this.brightness=r,!0)}evaluateScale(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const i=this.getNodesInfo(),n=this.id.canonical;for(const e of i){const i=e.feature;e.evaluatedScale=t.paint.get("model-scale").evaluate(i,{},n)}}evaluate(e){const t=this.getNodesInfo();for(const i of t){if(!i.node.meshes)continue;const t=i.feature,n=i.node.meshes&&i.node.meshes[0].featureData,r=i.evaluatedColor[2],s=i.evaluatedRMEA[2],o=this.id.canonical;if(i.hasTranslucentParts=!1,n){for(let n=0;n<Mv.length;n++){const r=Mv[n];r.length&&(t.properties.part=r);const s=e.paint.get("model-color").evaluate(t,{},o),a=e.paint.get("model-color-mix-intensity").evaluate(t,{},o);i.evaluatedColor[n]=[s.r,s.g,s.b,a],i.evaluatedRMEA[n][0]=e.paint.get("model-roughness").evaluate(t,{},o),i.evaluatedRMEA[n][2]=e.paint.get("model-emissive-strength").evaluate(t,{},o),i.evaluatedRMEA[n][3]=s.a,i.emissionHeightBasedParams[n]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(t,{},o),!i.hasTranslucentParts&&s.a<1&&(i.hasTranslucentParts=!0)}delete t.properties.part,kv(i,r!==i.evaluatedColor[2]||s!==i.evaluatedRMEA[2],this.modelTraits)}else i.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(t,{},o);i.evaluatedScale=e.paint.get("model-scale").evaluate(t,{},o),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,i,n){const r=e.findDEMTileFor(i);if(r&&(r.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(r.dem&&r.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=r.tileID.overscaledZ;const t=Yp.create(e,i,r);if(!t)return;this.modelTraits&yy.HasMapboxMeshFeatures&&this.updateDEM(e,t,i,n);for(const e of this.getNodesInfo()){const i=e.node;if(!i.footprint||!i.footprint.vertices||!i.footprint.vertices.length)continue;const n=i.footprint.vertices;let r=t.getElevationAt(n[0].x,n[0].y,!0,!0);for(let e=1;e<n.length;e++)r=Math.min(r,t.getElevationAt(n[e].x,n[e].y,!0,!0));i.elevation=r}}this.terrainTile=r.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,i,n){let r=t._dem._modifiedForSources[n];if(void 0===r&&(t._dem._modifiedForSources[n]=[],r=t._dem._modifiedForSources[n]),r.includes(i.canonical))return;const s=t._dem.dim;r.push(i.canonical);let o=!1;for(const e of this.getNodesInfo()){const i=e.node;if(!i.footprint||!i.footprint.grid)continue;const n=i.footprint.grid,r=t.tileCoordToPixel(n.min.x,n.min.y),a=t.tileCoordToPixel(n.max.x,n.max.y),l=Math.min(Math.min(s-a.y,r.x),Math.min(r.y,s-a.x));if(l<0)continue;const c=M(l,2,5);let u=Math.max(0,r.x-c),h=Math.max(0,r.y-c),d=Math.min(a.x+c,s-1),p=Math.min(a.y+c,s-1);for(let e=h;e<=p;++e)for(let t=u;t<=d;++t)Sv[e*s+t]=255;let f=0,m=0;for(let e=0;e<n.cellsY;++e)for(let i=0;i<n.cellsX;++i){if(!n.cells[e*n.cellsX+i])continue;const r=t.tileCoordToPixel(n.min.x+i/n.xScale,n.min.y+e/n.yScale),o=t.tileCoordToPixel(n.min.x+(i+1)/n.xScale,n.min.y+(e+1)/n.yScale);for(let e=r.y;e<=Math.min(o.y+1,s-1);++e)for(let i=r.x;i<=Math.min(o.x+1,s-1);++i)255===Sv[e*s+i]&&(Sv[e*s+i]=0,f+=t.getElevationAtPixel(i,e),m++)}const g=f/m;u=Math.max(1,r.x-c),h=Math.max(1,r.y-c),d=Math.min(a.x+c,s-2),p=Math.min(a.y+c,s-2),o=!0;for(let e=h;e<=p;++e)for(let i=u;i<=d;++i)0===Sv[e*s+i]&&(wv[e*s+i]=t._dem.set(i,e,g));for(let e=1;e<c;++e){u=Math.max(1,r.x-e),h=Math.max(1,r.y-e),d=Math.min(a.x+e,s-2),p=Math.min(a.y+e,s-2);for(let i=h;i<=p;++i)for(let n=u;n<=d;++n){const r=i*s+n;if(255===Sv[r]){let o=0,a=0,l=-1,u=-1;for(let t=-1;t<=1;++t)for(let r=-1;r<=1;++r){const c=(i+t)*s+n+r;if(Sv[c]>=e)continue;const h=wv[c],d=Math.abs(h);d>a&&(o=h,a=d,l=r,u=t)}if(a>.1){const s=1-(e+.5*Math.abs(l*u))/c;let a=t._dem.get(n,i)+o*s;const h=t._dem.get(n+l,i+u),d=t._dem.get(n-l,i-u,!0);(a-h)*(a-d)>0&&(a=(h+d)/2),wv[r]=t._dem.set(n,i,a),Sv[r]=e}}}}}o&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=oe.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const t of e)Sy(t.node),Ty(t.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped()),n=this.getNodesInfo();for(let e=0;e<this.nodesInfo.length;e++){const t=n[e].node;n[e].hiddenByReplacement=!!t.footprint&&!i.find((e=>e.footprint===t.footprint))}}getHeightAtTileCoord(e,t){const i=this.getNodesInfo(),n=[];for(let r=0;r<this.nodesInfo.length;r++){const s=i[r],o=s.node.meshes[0];if(e<o.aabb.min[0]||t<o.aabb.min[1]||e>o.aabb.max[0]||t>o.aabb.max[1])continue;const a=(e-o.aabb.min[0])/(o.aabb.max[0]-o.aabb.min[0])*_y|0,l=Math.min(63,(t-o.aabb.min[1])/(o.aabb.max[1]-o.aabb.min[1])*_y|0)*_y+Math.min(63,a);if(!(o.heightmap[l]<0&&s.node.footprint)){if(s.hiddenByReplacement)return;return{height:o.heightmap[l],maxHeight:s.feature.properties.height,hidden:!1,verticalScale:s.evaluatedScale[2]}}if(s.node.footprint.grid.query(new _(e,t),new _(e,t),n),n.length>0)return{height:void 0,maxHeight:s.feature.properties.height,hidden:s.hiddenByReplacement,verticalScale:s.evaluatedScale[2]}}}}function Cv(e,t){return!e.isLightConstant&&t}function Pv(e,t,i,n,r,s,o,a){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,u=240&t|(240&t)>>4;i[3]>0&&(l=ct(l,255*i[0],i[3]),c=ct(c,255*i[1],i[3]),u=ct(u,255*i[2],i[3]));const h=l<<8|c,d=u<<8|Math.floor(255*n[3]),p=function(e){const t=M(e,0,2);return Math.min(Math.round(.5*t*255),255)}(n[2])<<8|15*n[0]<<4|15*n[1],f=M(r[0],0,1),m=M(r[1],0,1),g=M(r[2],0,1),_=M(r[3],0,1);let y,v,x,b;if(f!==m&&o!==s&&m!==f){const e=o-s;v=1/(e*(m-f)),x=-(s+e*f)/(e*(m-f));const t=M(r[4],-1,1);b=Math.pow(10,t),y=255*g<<8|255*_}else y=65535,v=0,x=1,b=1;if(e.emplaceBack(h,d,p,y,v,x,b),a){const e=a.length;a.clear();for(let t=0;t<e;t++)a.emplaceBack(h,d,p,y,v,x,b)}}function kv(e,t,i){const n=e.node;let r=0;const s=i&yy.HasMeshoptCompression;for(const i of n.meshes){if(n.lights&&n.lightMeshIndex===r)continue;if(!i.featureData)continue;i.featureArray=new Vo,i.featureArray.reserve(i.featureData.length);let o=t;for(const t of i.featureData){const r=s?65535&t:t>>16&65535,a=s?t>>16&65535:65535&t,l=(15&a)<8?15&a:0,c=e.evaluatedRMEA[l],u=e.evaluatedColor[l],h=e.emissionHeightBasedParams[l];let d;if(o&&2===l&&n.lights&&(d=new Vo,d.resize(10*n.lights.length)),Pv(i.featureArray,r,u,c,h,i.aabb.min[2],i.aabb.max[2],d),d&&o){o=!1;const e=n.meshes[n.lightMeshIndex];e.featureArray=d,e.featureArray._trim()}}i.featureArray._trim(),r++}}function Rv(e,t,i,n){const r=1<<e.z;t.lat=gl((n/ki+e.y)/r),t.lng=ml((i/ki+e.x)/r)}is(Av,"Tiled3dModelBucket",{omit:["layers"]}),is(Iv,"Tiled3dModelFeature");const Lv={circle:class extends oo{constructor(e,t,i){super(e,tc,t,i)}createBucket(e){return new Ol(e)}queryRadius(e){const t=e;return Yl("circle-radius",this,t)+Yl("circle-stroke-width",this,t)+Kl(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,n,r,s,o,a){const l=Ql(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return ud(e,n,s,o,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const i=cd(this);return{config:new Oa(this,t),defines:i,overrideFog:!1}}},heatmap:class extends oo{createBucket(e){return new md(e)}constructor(e,t,i){super(e,Sd,t,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Td({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Yl("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,n,r,s,o,a){const l=this.paint.get("heatmap-radius").evaluate(t,i);return ud(e,n,s,o,a,!0,!0,new _(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return"heatmap"===e?{config:new Oa(this,t),overrideFog:!1}:{}}},hillshade:class extends oo{constructor(e,t,i){super(e,Md,t,i)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends oo{constructor(e,t,i){super(e,cp,t,i)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(e,t){return{config:new Oa(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new ap(e)}queryRadius(){return Kl(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,n,r,s){return!e.queryGeometry.isAboveHorizon&&Fl(Jl(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends oo{constructor(e,t,i){super(e,If,t,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new mf(e)}queryRadius(){return Kl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,i,n,r,s,o,a,l,c){const u=Ql(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(i,n),d=this.paint.get("fill-extrusion-base").evaluate(i,n),p=[0,0],f=l&&o.elevation,m=o.elevation?o.elevation.exaggeration():1,g=t.tile.getBucket(this);if(f&&g instanceof mf){const e=g.centroidVertexArray,t=c+1;t<e.length&&(p[0]=e.geta_centroid_pos0(t),p[1]=e.geta_centroid_pos1(t))}if(0===p[0]&&1===p[1])return!1;"globe"===o.projection.name&&(r=Tf([r],[new _(0,0),new _(ki,ki)],t.tileID.canonical).map((e=>e.polygon)).flat());const y=f?l:null,[v,x]=function(t,i,n,r,s,o,a,l,c,u,h){return"globe"===t.projection.name?function(t,i,n,r,s,o,a,l,c,u,h){const d=[],p=[],f=t.projection.upVectorScale(h,t.center.lat,t.worldSize).metersToTile,m=[0,0,0,1],g=[0,0,0,1],_=(e,t,i,n)=>{e[0]=t,e[1]=i,e[2]=n,e[3]=1},y=Sf();n>0&&(n+=y),r+=y;for(const y of i){const i=[],v=[];for(const d of y){const p=d.x+s.x,y=d.y+s.y,x=t.projection.projectTilePoint(p,y,h),b=t.projection.upVector(h,d.x,d.y);let w=n,S=r;if(a){const e=kf(p,y,n,r,a,l,c,u);w+=e.base,S+=e.top}0!==n?_(m,x.x+b[0]*f*w,x.y+b[1]*f*w,x.z+b[2]*f*w):_(m,x.x,x.y,x.z),_(g,x.x+b[0]*f*S,x.y+b[1]*f*S,x.z+b[2]*f*S),e.N.transformMat4(m,m,o),e.N.transformMat4(g,g,o),i.push(new Af(m[0],m[1],m[2])),v.push(new Af(g[0],g[1],g[2]))}d.push(i),p.push(v)}return[d,p]}(t,i,n,r,s,o,a,l,c,u,h):a?function(t,i,n,r,s,o,a,l,c){const u=[],h=[],d=[0,0,0,1];for(const p of t){const t=[],f=[];for(const u of p){const h=u.x+r.x,p=u.y+r.y,m=kf(h,p,i,n,o,a,l,c);d[0]=h,d[1]=p,d[2]=m.base,d[3]=1,e.a7.transformMat4(d,d,s),d[3]=Math.max(d[3],1e-5);const g=new Af(d[0]/d[3],d[1]/d[3],d[2]/d[3]);d[0]=h,d[1]=p,d[2]=m.top,d[3]=1,e.a7.transformMat4(d,d,s),d[3]=Math.max(d[3],1e-5);const _=new Af(d[0]/d[3],d[1]/d[3],d[2]/d[3]);t.push(g),f.push(_)}u.push(t),h.push(f)}return[u,h]}(i,n,r,s,o,a,l,c,u):function(e,t,i,n,r){const s=[],o=[],a=r[8]*t,l=r[9]*t,c=r[10]*t,u=r[11]*t,h=r[8]*i,d=r[9]*i,p=r[10]*i,f=r[11]*i;for(const t of e){const e=[],i=[];for(const s of t){const t=s.x+n.x,o=s.y+n.y,m=r[0]*t+r[4]*o+r[12],g=r[1]*t+r[5]*o+r[13],_=r[2]*t+r[6]*o+r[14],y=r[3]*t+r[7]*o+r[15],v=m+a,x=g+l,b=_+c,w=Math.max(y+u,1e-5),S=m+h,T=g+d,E=_+p,M=Math.max(y+f,1e-5);e.push(new Af(v/w,x/w,b/w)),i.push(new Af(S/M,T/M,E/M))}s.push(e),o.push(i)}return[s,o]}(i,n,r,s,o)}(o,r,d,h,u,a,y,p,m,o.center.lat,t.tileID.canonical),b=t.queryGeometry;return function(e,t,i){let n=1/0;Fl(i,t)&&(n=Pf(i,t[0]));for(let r=0;r<t.length;r++){const s=t[r],o=e[r];for(let e=0;e<s.length-1;e++){const t=s[e],r=[t,s[e+1],o[e+1],o[e],t];Nl(i,r)&&(n=Math.min(n,Pf(i,r)))}}return n!==1/0&&n}(v,x,b.isPointQuery()?b.screenBounds:b.screenGeometry)}},line:class extends oo{constructor(e,t,i){super(e,Vf,t,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof En,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=$f.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Bf(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const i=Wf(this);return{config:new Oa(this,t),defines:i,overrideFog:!1}}queryRadius(e){const t=e,i=Zf(Yl("line-width",this,t),Yl("line-gap-width",this,t)),n=Yl("line-offset",this,t);return i/2+Math.abs(n)+Kl(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,n,r,s){if(e.queryGeometry.isAboveHorizon)return!1;const o=Jl(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*Zf(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),l=this.paint.get("line-offset").evaluate(t,i);return l&&(n=function(e,t){const i=[],n=new _(0,0);for(let r=0;r<e.length;r++){const s=e[r],o=[];for(let e=0;e<s.length;e++){const i=s[e],r=s[e+1],a=0===e?n:i.sub(s[e-1])._unit()._perp(),l=e===s.length-1?n:r.sub(i)._unit()._perp(),c=a._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),o.push(c._mult(t)._add(i))}i.push(o)}return i}(n,l*e.pixelToTileUnitsFactor)),function(e,t,i){for(let n=0;n<t.length;n++){const r=t[n];if(e.length>=3)for(let t=0;t<r.length;t++)if(Wl(e,r[t]))return!0;if(Bl(e,r,i))return!0}return!1}(o,n,a)}isTileClipped(){return!0}},symbol:I_,background:class extends oo{constructor(e,t,i){super(e,C_,t,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:U_,"raster-particle":G_,sky:class extends oo{constructor(e,t,i){super(e,q_,t,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Td({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),n=!i,r=e.style.light,s=r.properties.get("position");return n&&"viewport"===r.properties.get("anchor")&&j("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?$_(s.azimuthal,90-s.polar,t):$_(i[0],90-i[1],t)}const i=this.paint.get("sky-gradient-center");return $_(i[0],90-i[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends oo{constructor(e,t,i){super(e,Z_,t)}},model:class extends oo{constructor(e,t,i){super(e,gy,t,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new fy(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(e){return e instanceof Av?ki-1:0}queryIntersectsFeature(t,i,n,r,s,o){if(!this.modelManager)return!1;const a=this.modelManager,l=t.tile.getBucket(this);if(!(l&&l instanceof fy))return!1;const c=l;for(const n in c.instancesPerModel){const r=c.instancesPerModel[n];if(r.idToFeaturesIndex.hasOwnProperty(i.id)){const s=r.features[r.idToFeaturesIndex[i.id]],l=a.getModel(n,this.scope);if(!l)return!1;let u=e.a6.create();const h=new el(0,0),d=c.canonical;let p=Number.MAX_VALUE;for(let i=0;i<s.instancedDataCount;++i){const n=16*(s.instancedDataOffset+i),a=r.instancedDataArray.float32,c=[a[n+4],a[n+5],a[n+6]];Rv(d,h,a[n],0|a[n+1]),vy(u,l,o,h,s.rotation,s.scale,c,!1,!1,!1),"globe"===o.projection.name&&(u=ny(u,o));const f=e.a6.multiply([],o.projMatrix,u),m=t.queryGeometry,g=ry(m.isPointQuery()?m.screenBounds:m.screenGeometry,o,f,l.aabb);null!=g&&(p=Math.min(g,p))}return p!==Number.MAX_VALUE&&p}}return!1}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof $r}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,i,n,r){const s=t.tile,o=s.getBucket(this);let a=null,l=Number.MAX_VALUE;if(!(o&&o instanceof Av))return{queryFeature:a,intersectionZ:l};const c=o.getNodesInfo()[i];if(c.hiddenByReplacement||!c.node.meshes||!n.filter(new As(s.tileID.overscaledZ),c.feature,s.tileID.canonical))return{queryFeature:a,intersectionZ:l};const u=c.node,h=r.calculatePosMatrix(s.tileID.toUnwrapped(),r.worldSize),d=c.evaluatedScale;let p=0;r.elevation&&u.elevation&&(p=u.elevation*r.elevation.exaggeration()),e.a6.translate(h,h,[(u.anchor?u.anchor[0]:0)*(d[0]-1),(u.anchor?u.anchor[1]:0)*(d[1]-1),p]),e.a6.scale(h,h,d),e.a6.multiply(h,h,u.matrix);const f=t.queryGeometry,m=f.isPointQuery()?f.screenBounds:f.screenGeometry,g=function(t){const i=e.a6.multiply([],h,t.matrix),n=e.a6.multiply(i,r.expandedFarZProjMatrix,i);for(let e=0;e<t.meshes.length;++e){const i=t.meshes[e];if(e===t.lightMeshIndex)continue;const s=ry(m,r,n,i.aabb);null!=s&&(l=Math.min(s,l))}if(t.children)for(const e of t.children)g(e)};if(g(u),l===Number.MAX_VALUE)return{queryFeature:a,intersectionZ:l};const _=new el(0,0);return Rv(s.tileID.canonical,_,c.node.anchor[0],c.node.anchor[1]),a={type:"Feature",geometry:{type:"Point",coordinates:[_.lng,_.lat]},properties:c.feature.properties,id:c.feature.id,state:{},layer:this.serialize()},{queryFeature:a,intersectionZ:l}}}},Dv={read:function(e,t){return e.readFields(Dv._readField,{header_length:0,x:0,y:0,z:0,layers:[]},t)},_readField:function(e,t,i){1===e?t.header_length=i.readFixed32():2===e?t.x=i.readVarint():3===e?t.y=i.readVarint():4===e?t.z=i.readVarint():5===e&&t.layers.push(Dv.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Dv.Filter.read=function(e,t){return e.readFields(Dv.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},t)},Dv.Filter._readField=function(e,t,i){1===e?(t.delta_filter=Dv.Filter.Delta.read(i,i.readVarint()+i.pos),t.filter="delta_filter"):2===e?(t.zigzag_filter=Dv.Filter.Zigzag.read(i,i.readVarint()+i.pos),t.filter="zigzag_filter"):3===e?(t.bitshuffle_filter=Dv.Filter.BitShuffle.read(i,i.readVarint()+i.pos),t.filter="bitshuffle_filter"):4===e&&(t.byteshuffle_filter=Dv.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),t.filter="byteshuffle_filter")},Dv.Filter.Delta={},Dv.Filter.Delta.read=function(e,t){return e.readFields(Dv.Filter.Delta._readField,{block_size:0},t)},Dv.Filter.Delta._readField=function(e,t,i){1===e&&(t.block_size=i.readVarint())},Dv.Filter.Zigzag={},Dv.Filter.Zigzag.read=function(e,t){return e.readFields(Dv.Filter.Zigzag._readField,{},t)},Dv.Filter.Zigzag._readField=function(e,t,i){},Dv.Filter.BitShuffle={},Dv.Filter.BitShuffle.read=function(e,t){return e.readFields(Dv.Filter.BitShuffle._readField,{},t)},Dv.Filter.BitShuffle._readField=function(e,t,i){},Dv.Filter.ByteShuffle={},Dv.Filter.ByteShuffle.read=function(e,t){return e.readFields(Dv.Filter.ByteShuffle._readField,{},t)},Dv.Filter.ByteShuffle._readField=function(e,t,i){},Dv.Codec={},Dv.Codec.read=function(e,t){return e.readFields(Dv.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},t)},Dv.Codec._readField=function(e,t,i){1===e?(t.gzip_data=Dv.Codec.GzipData.read(i,i.readVarint()+i.pos),t.codec="gzip_data"):2===e?(t.jpeg_image=Dv.Codec.JpegImage.read(i,i.readVarint()+i.pos),t.codec="jpeg_image"):3===e?(t.webp_image=Dv.Codec.WebpImage.read(i,i.readVarint()+i.pos),t.codec="webp_image"):4===e&&(t.png_image=Dv.Codec.PngImage.read(i,i.readVarint()+i.pos),t.codec="png_image")},Dv.Codec.GzipData={},Dv.Codec.GzipData.read=function(e,t){return e.readFields(Dv.Codec.GzipData._readField,{},t)},Dv.Codec.GzipData._readField=function(e,t,i){},Dv.Codec.JpegImage={},Dv.Codec.JpegImage.read=function(e,t){return e.readFields(Dv.Codec.JpegImage._readField,{},t)},Dv.Codec.JpegImage._readField=function(e,t,i){},Dv.Codec.WebpImage={},Dv.Codec.WebpImage.read=function(e,t){return e.readFields(Dv.Codec.WebpImage._readField,{},t)},Dv.Codec.WebpImage._readField=function(e,t,i){},Dv.Codec.PngImage={},Dv.Codec.PngImage.read=function(e,t){return e.readFields(Dv.Codec.PngImage._readField,{},t)},Dv.Codec.PngImage._readField=function(e,t,i){},Dv.DataIndexEntry={},Dv.DataIndexEntry.read=function(e,t){return e.readFields(Dv.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)},Dv.DataIndexEntry._readField=function(e,t,i){1===e?t.first_byte=i.readFixed64():2===e?t.last_byte=i.readFixed64():3===e?t.filters.push(Dv.Filter.read(i,i.readVarint()+i.pos)):4===e?t.codec=Dv.Codec.read(i,i.readVarint()+i.pos):5===e?t.offset=i.readFloat():6===e?t.scale=i.readFloat():7===e&&t.bands.push(i.readString())},Dv.Layer={},Dv.Layer.read=function(e,t){return e.readFields(Dv.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},t)},Dv.Layer._readField=function(e,t,i){1===e?t.version=i.readVarint():2===e?t.name=i.readString():3===e?t.units=i.readString():4===e?t.tilesize=i.readVarint():5===e?t.buffer=i.readVarint():6===e?t.pixel_format=i.readVarint():7===e&&t.data_index.push(Dv.DataIndexEntry.read(i,i.readVarint()+i.pos))};const Ov={read:function(e,t){return e.readFields(Ov._readField,{uint32_values:null,values:null,fixed32_values:null},t)},_readField:function(e,t,i){2===e?(t.uint32_values=Ov.Uint32Values.read(i,i.readVarint()+i.pos),t.values="uint32_values"):3===e&&(t.fixed32_values=Ov.Fixed32Values.read(i,i.readVarint()+i.pos),t.values="fixed32_values")},Uint32Values:{}};Ov.Uint32Values.read=function(e,t){return e.readFields(Ov.Uint32Values._readField,{values:[]},t)},Ov.Uint32Values._readField=function(e,t,i){1===e&&(t.readValuesInto=function(e){if(2!==e.type)throw new Error(`Unsupported pbf type "${e.type}"`);const t=function(e){return 2===e.type?e.readVarint()+e.pos:e.pos+1}(e),i=e.pos;return e.pos=t,function(n){e.pos=i;let r=0;for(;e.pos<t;){const t=e.readVarint();n[r++]=t}return n}}(i))},Ov.Fixed32Values={},Ov.Fixed32Values.read=function(e,t){return e.readFields(Ov.Fixed32Values._readField,{values:[]},t)},Ov.Fixed32Values._readField=function(e,t,i){throw new Error("Not implemented")};class Nv{constructor(e=0,t=0,i=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=i,this.size=0,this.ttl=t}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const t=this.items[e];delete this.items[e],this.size--,null!==t.prev&&(t.prev.next=t.next),null!==t.next&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),this.last===t&&(this.last=t.prev)}return this}entries(e=this.keys()){return e.map((e=>[e,this.get(e)]))}evict(e=!1){if(e||this.size>0){const e=this.first;delete this.items[e.key],0==--this.size?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(e){let t;return this.has(e)&&(t=this.items[e].expiry),t}get(e){let t;if(this.has(e)){const i=this.items[e];this.ttl>0&&i.expiry<=Date.now()?this.delete(e):(t=i.value,this.set(e,t,!0))}return t}has(e){return e in this.items}keys(){const e=[];let t=this.first;for(;null!==t;)e.push(t.key),t=t.next;return e}set(e,t,i=!1,n=this.resetTtl){let r;if(i||this.has(e)){if(r=this.items[e],r.value=t,!1===i&&n&&(r.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==r){const e=this.last,t=r.next,i=r.prev;this.first===r&&(this.first=r.next),r.next=null,r.prev=this.last,e.next=r,null!==i&&(i.next=t),null!==t&&(t.prev=i)}}else this.max>0&&this.size===this.max&&this.evict(!0),r=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:t},1==++this.size?this.first=r:this.last.next=r;return this.last=r,this}values(e=this.keys()){return e.map((e=>this.get(e)))}}function zv(e,t){if(4!==t.length)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let i=t[3];for(let n=2;n>=1;n--){const r=1===n?1:0,s=2===n?1:0;for(let n=0;n<t[0];n++){const o=t[1]*n;for(let n=r;n<t[1];n++){const r=t[2]*(n+o);for(let n=s;n<t[2];n++){const s=t[3]*(n+r);for(let n=0;n<t[3];n++){const t=s+n;e[t]+=e[t-i]}}}}i*=t[n]}return e}function Fv(e){for(let t=0,i=e.length;t<i;t++)e[t]=e[t]>>>1^-(1&e[t]);return e}function Bv(e,t){switch(t){case"uint32":return e;case"uint16":for(let t=0;t<e.length;t+=2){const i=e[t],n=e[t+1];e[t]=(240&i)>>4|(61440&i)>>8|(240&n)<<4|61440&n,e[t+1]=15&i|(3840&i)>>4|(15&n)<<8|(3840&n)<<4}return e;case"uint8":for(let t=0;t<e.length;t+=4){const i=e[t],n=e[t+1],r=e[t+2],s=e[t+3];e[t+0]=(192&i)>>6|(192&n)>>4|(192&r)>>2|192&s,e[t+1]=(48&i)>>4|(48&n)>>2|48&r|(48&s)<<2,e[t+2]=(12&i)>>2|12&n|(12&r)<<2|(12&s)<<4,e[t+3]=3&i|(3&n)<<2|(3&r)<<4|(3&s)<<6}return e;default:throw new Error(`Invalid pixel format, "${t}"`)}}class Uv extends Error{constructor(e){super(e),this.name="MRTError"}}var Vv=Uint8Array,jv=Uint16Array,Gv=Int32Array,Hv=new Vv([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Wv=new Vv([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),qv=new Vv([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$v=function(e,t){for(var i=new jv(31),n=0;n<31;++n)i[n]=t+=1<<e[n-1];var r=new Gv(i[30]);for(n=1;n<30;++n)for(var s=i[n];s<i[n+1];++s)r[s]=s-i[n]<<5|n;return{b:i,r}},Zv=$v(Hv,2),Xv=Zv.b,Yv=Zv.r;Xv[28]=258,Yv[258]=28;for(var Kv=$v(Wv,0).b,Jv=new jv(32768),Qv=0;Qv<32768;++Qv){var ex=(43690&Qv)>>1|(21845&Qv)<<1;Jv[Qv]=((65280&(ex=(61680&(ex=(52428&ex)>>2|(13107&ex)<<2))>>4|(3855&ex)<<4))>>8|(255&ex)<<8)>>1}var tx=function(e,t,i){for(var n=e.length,r=0,s=new jv(t);r<n;++r)e[r]&&++s[e[r]-1];var o,a=new jv(t);for(r=1;r<t;++r)a[r]=a[r-1]+s[r-1]<<1;if(i){o=new jv(1<<t);var l=15-t;for(r=0;r<n;++r)if(e[r])for(var c=r<<4|e[r],u=t-e[r],h=a[e[r]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)o[Jv[h]>>l]=c}else for(o=new jv(n),r=0;r<n;++r)e[r]&&(o[r]=Jv[a[e[r]-1]++]>>15-e[r]);return o},ix=new Vv(288);for(Qv=0;Qv<144;++Qv)ix[Qv]=8;for(Qv=144;Qv<256;++Qv)ix[Qv]=9;for(Qv=256;Qv<280;++Qv)ix[Qv]=7;for(Qv=280;Qv<288;++Qv)ix[Qv]=8;var nx=new Vv(32);for(Qv=0;Qv<32;++Qv)nx[Qv]=5;var rx=tx(ix,9,1),sx=tx(nx,5,1),ox=function(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},ax=function(e,t,i){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&i},lx=function(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(7&t)},cx=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ux=function(e,t,i){var n=new Error(t||cx[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,ux),!i)throw n;return n},hx=new Vv(0),dx="undefined"!=typeof TextDecoder&&new TextDecoder;try{dx.decode(hx,{stream:!0})}catch(e){}const px={gzip_data:"gzip"},fx={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},mx={uint32:1,uint16:2,uint8:4},gx={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class _x{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const t=new Uint8Array(e),i=new DataView(e);if(13!==t[0])throw new Uv("File is not a valid MRT.");return i.getUint32(1,!0)}parseHeader(e){const t=new Uint8Array(e),i=this.getHeaderLength(e);if(t.length<i)throw new Uv(`Expected header with length >= ${i} but got buffer of length ${t.length}`);const n=new Nm(t.subarray(0,i)),r=Dv.read(n);if(!isNaN(this.x)&&(this.x!==r.x||this.y!==r.y||this.z!==r.z))throw new Uv(`Invalid attempt to parse header ${r.z}/${r.x}/${r.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=r.x,this.y=r.y,this.z=r.z;for(const e of r.layers)this.layers[e.name]=new yx(e,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const t=[],i=this.getLayer(e.layerName);for(let n=0;n<i.dataIndex.length;n++){const r=i.dataIndex[n],s=r.first_byte-e.firstByte,o=r.last_byte+1-e.firstByte;if(n<e.firstBlock||n>e.lastBlock)continue;if(i._blocksInProgress.has(n))continue;const a={layerName:i.name,firstByte:s,lastByte:o,pixelFormat:i.pixelFormat,blockIndex:n,blockShape:[r.bands.length].concat(i.bandShape),buffer:i.buffer,codec:r.codec.codec,filters:r.filters.map((e=>e.filter))};i._blocksInProgress.add(n),t.push(a)}return new vx(t,(()=>{t.forEach((e=>i._blocksInProgress.delete(e.blockIndex)))}),((e,n)=>{if(t.forEach((e=>i._blocksInProgress.delete(e.blockIndex))),e)throw e;n.forEach((e=>{this.getLayer(e.layerName).processDecodedData(e)}))}))}}class yx{constructor({version:e,name:t,units:i,tilesize:n,pixel_format:r,buffer:s,data_index:o},a){if(this.version=e,1!==this.version)throw new Uv(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=t,this.units=i,this.tileSize=n,this.buffer=s,this.pixelFormat=fx[r],this.dataIndex=o,this.bandShape=[n+2*s,n+2*s,mx[this.pixelFormat]],this._decodedBlocks=function(e=1e3,t=0,i=!1){if(isNaN(e)||e<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if("boolean"!=typeof i)throw new TypeError("Invalid resetTtl value");return new Nv(e,t,i)}(a?a.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const t=e.blockIndex.toString();this._decodedBlocks.get(t)||this._decodedBlocks.set(t,e.data)}getBlockForBand(e){let t=0;switch(typeof e){case"string":for(const[i,n]of this.dataIndex.entries()){for(const[r,s]of n.bands.entries())if(s===e)return{bandIndex:t+r,blockIndex:i,blockBandIndex:r};t+=n.bands.length}break;case"number":for(const[i,n]of this.dataIndex.entries()){if(e>=t&&e<t+n.bands.length)return{bandIndex:e,blockIndex:i,blockBandIndex:e-t};t+=n.bands.length}break;default:throw new Uv(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Uv(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let t=1/0,i=-1/0,n=1/0,r=-1/0;for(const s of e){const{blockIndex:e}=this.getBlockForBand(s);if(e<0)throw new Uv(`Invalid band: ${JSON.stringify(s)}`);const o=this.dataIndex[e];n=Math.min(n,e),r=Math.max(r,e),t=Math.min(t,o.first_byte),i=Math.max(i,o.last_byte)}return{layerName:this.name,firstByte:t,lastByte:i,firstBlock:n,lastBlock:r}}hasBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0}hasDataForBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0&&!!this._decodedBlocks.get(t.toString())}getBandView(e){const{blockIndex:t,blockBandIndex:i}=this.getBlockForBand(e),n=this._decodedBlocks.get(t.toString());if(!n)throw new Uv(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const r=this.dataIndex[t],s=this.bandShape.reduce(((e,t)=>e*t),1),o=i*s,a=n.subarray(o,o+s);return{data:a,bytes:new Uint8Array(a.buffer).subarray(a.byteOffset,a.byteOffset+a.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:r.offset,scale:r.scale}}}class vx{constructor(e,t,i){this.tasks=e,this._onCancel=t,this._onComplete=i,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,t){this._finalized||(this._onComplete(e,t),this._finalized=!0)}}_x.performDecoding=function(e,t){return Promise.all(t.tasks.map((t=>{const{layerName:i,firstByte:n,lastByte:r,pixelFormat:s,blockShape:o,blockIndex:a,filters:l,codec:c}=t,u=new Uint8Array(e).subarray(n,r+1),h=new Uint32Array(o[0]*o[1]*o[2]);let d;if("gzip_data"!==c)throw new Error(`Unhandled codec: ${c}`);return d=function(e,t){if(!globalThis.DecompressionStream&&"gzip_data"===t)return Promise.resolve(((s=function(e){31==e[0]&&139==e[1]&&8==e[2]||ux(6,"invalid gzip data");var t=e[3],i=10;4&t&&(i+=2+(e[10]|e[11]<<8));for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[i++]);return i+(2&t)}(r=e))+8>r.length&&ux(6,"invalid gzip data"),function(e,t,i,n){var r=e.length;if(!r||t.f&&!t.l)return i||new Vv(0);var s=!i,o=s||2!=t.i,a=t.i;s&&(i=new Vv(3*r));var l=function(e){var t=i.length;if(e>t){var n=new Vv(Math.max(2*t,e));n.set(i),i=n}},c=t.f||0,u=t.p||0,h=t.b||0,d=t.l,p=t.d,f=t.m,m=t.n,g=8*r;do{if(!d){c=ax(e,u,1);var _=ax(e,u+1,3);if(u+=3,!_){var y=e[(C=4+((u+7)/8|0))-4]|e[C-3]<<8,v=C+y;if(v>r){a&&ux(0);break}o&&l(h+y),i.set(e.subarray(C,v),h),t.b=h+=y,t.p=u=8*v,t.f=c;continue}if(1==_)d=rx,p=sx,f=9,m=5;else if(2==_){var x=ax(e,u,31)+257,b=ax(e,u+10,15)+4,w=x+ax(e,u+5,31)+1;u+=14;for(var S=new Vv(w),T=new Vv(19),E=0;E<b;++E)T[qv[E]]=ax(e,u+3*E,7);u+=3*b;var M=ox(T),I=(1<<M)-1,A=tx(T,M,1);for(E=0;E<w;){var C,P=A[ax(e,u,I)];if(u+=15&P,(C=P>>4)<16)S[E++]=C;else{var k=0,R=0;for(16==C?(R=3+ax(e,u,3),u+=2,k=S[E-1]):17==C?(R=3+ax(e,u,7),u+=3):18==C&&(R=11+ax(e,u,127),u+=7);R--;)S[E++]=k}}var L=S.subarray(0,x),D=S.subarray(x);f=ox(L),m=ox(D),d=tx(L,f,1),p=tx(D,m,1)}else ux(1);if(u>g){a&&ux(0);break}}o&&l(h+131072);for(var O=(1<<f)-1,N=(1<<m)-1,z=u;;z=u){var F=(k=d[lx(e,u)&O])>>4;if((u+=15&k)>g){a&&ux(0);break}if(k||ux(2),F<256)i[h++]=F;else{if(256==F){z=u,d=null;break}var B=F-254;F>264&&(B=ax(e,u,(1<<(j=Hv[E=F-257]))-1)+Xv[E],u+=j);var U=p[lx(e,u)&N],V=U>>4;if(U||ux(3),u+=15&U,D=Kv[V],V>3){var j=Wv[V];D+=lx(e,u)&(1<<j)-1,u+=j}if(u>g){a&&ux(0);break}o&&l(h+131072);var G=h+B;if(h<D){var H=0-D,W=Math.min(D,G);for(H+h<0&&ux(3);h<W;++h)i[h]=undefined[H+h]}for(;h<G;++h)i[h]=i[h-D]}}t.l=d,t.p=z,t.b=h,t.f=c,d&&(c=1,t.m=f,t.d=p,t.n=m)}while(!c);return h!=i.length&&s?function(e,t,i){return(null==t||t<0)&&(t=0),(null==i||i>e.length)&&(i=e.length),new Vv(e.subarray(t,i))}(i,0,h):i.subarray(0,h)}(r.subarray(s,-8),{i:2},new Vv(((i=r)[(n=i.length)-4]|i[n-3]<<8|i[n-2]<<16|i[n-1]<<24)>>>0))));var i,n,r,s;const o=px[t];if(!o)throw new Error(`Unhandled codec: ${t}`);const a=new globalThis.DecompressionStream(o);return new Response(new Blob([e]).stream().pipeThrough(a)).arrayBuffer().then((e=>new Uint8Array(e)))}(u,c).then((e=>{const t=Ov.read(new Nm(e));if("uint32_values"===t.values)return t.uint32_values.readValuesInto(h),new(0,gx[s])(h.buffer);throw new Error(`Unhandled numeric data "${t.values}"`)})),d.then((e=>{for(let t=l.length-1;t>=0;t--)switch(l[t]){case"delta_filter":zv(e,o);break;case"zigzag_filter":Fv(e);break;case"bitshuffle_filter":Bv(e,s);break;default:throw new Error(`Unhandled filter "${l[t]}"`)}return{layerName:i,blockIndex:a,data:e}})).catch((e=>{throw e}))})))},is(vx,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const xx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class bx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,i]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const n=i>>4;if(1!==n)throw new Error(`Got v${n} data when expected v1.`);const r=xx[15&i];if(!r)throw new Error("Unrecognized array type.");const[s]=new Uint16Array(e,2,1),[o]=new Uint32Array(e,4,1);return new bx(o,s,r,e)}constructor(e,t=64,i=Float64Array,n){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=xx.indexOf(this.ArrayType),s=2*e*this.ArrayType.BYTES_PER_ELEMENT,o=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-o%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${i}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+s+o+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=t,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return wx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:s,nodeSize:o}=this,a=[0,r.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=o){for(let o=h;o<=u;o++){const a=s[2*o],c=s[2*o+1];a>=e&&a<=i&&c>=t&&c<=n&&l.push(r[o])}continue}const d=h+u>>1,p=s[2*d],f=s[2*d+1];p>=e&&p<=i&&f>=t&&f<=n&&l.push(r[d]),(0===c?e<=p:t<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?i>=p:n>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:r,nodeSize:s}=this,o=[0,n.length-1,0],a=[],l=i*i;for(;o.length;){const c=o.pop()||0,u=o.pop()||0,h=o.pop()||0;if(u-h<=s){for(let i=h;i<=u;i++)Mx(r[2*i],r[2*i+1],e,t)<=l&&a.push(n[i]);continue}const d=h+u>>1,p=r[2*d],f=r[2*d+1];Mx(p,f,e,t)<=l&&a.push(n[d]),(0===c?e-i<=p:t-i<=f)&&(o.push(h),o.push(d-1),o.push(1-c)),(0===c?e+i>=p:t+i>=f)&&(o.push(d+1),o.push(u),o.push(1-c))}return a}}function wx(e,t,i,n,r,s){if(r-n<=i)return;const o=n+r>>1;Sx(e,t,o,n,r,s),wx(e,t,i,n,o-1,1-s),wx(e,t,i,o+1,r,1-s)}function Sx(e,t,i,n,r,s){for(;r>n;){if(r-n>600){const o=r-n+1,a=i-n+1,l=Math.log(o),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(o-c)/o)*(a-o/2<0?-1:1);Sx(e,t,i,Math.max(n,Math.floor(i-a*c/o+u)),Math.min(r,Math.floor(i+(o-a)*c/o+u)),s)}const o=t[2*i+s];let a=n,l=r;for(Tx(e,t,n,i),t[2*r+s]>o&&Tx(e,t,n,r);a<l;){for(Tx(e,t,a,l),a++,l--;t[2*a+s]<o;)a++;for(;t[2*l+s]>o;)l--}t[2*n+s]===o?Tx(e,t,n,l):(l++,Tx(e,t,l,r)),l<=i&&(n=l+1),i<=l&&(r=l-1)}}function Tx(e,t,i,n){Ex(e,i,n),Ex(t,2*i,2*n),Ex(t,2*i+1,2*n+1)}function Ex(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}function Mx(e,t,i,n){const r=e-i,s=t-n;return r*r+s*s}e.$=qg,e.A=Or,e.B=Rr,e.C=ni,e.D=Gs,e.E=tt,e.F=Us,e.G=zs,e.H=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return W(e.expression.evaluate(t))}interpolate(e,t,i){return{x:ct(e.x,t.x,i),y:ct(e.y,t.y,i),z:ct(e.z,t.z,i),azimuthal:ct(e.azimuthal,t.azimuthal,i),polar:ct(e.polar,t.polar,i)}}},e.I=fg,e.J=ks,e.K=As,e.L=Sl,e.M=class{constructor(e,t,i,n){this.id=e,this.position=null!=t?new el(t[0],t[1]):new el(0,0),this.orientation=null!=i?i:[0,0,0],this.nodes=n,this.uploaded=!1,this.aabb=new Rh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,i){if(e.a6.multiply(t.matrix,i,t.matrix),t.meshes)for(const e of t.meshes){const i=Rh.applyTransform(e.aabb,t.matrix);this.aabb.encapsulate(i)}if(t.children)for(const e of t.children)this._applyTransformations(e,t.matrix)}computeBoundsAndApplyParent(){const t=e.a6.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(e,t,i,n,r,s,o=!1){vy(this.matrix,this,e.transform,this.position,t,i,n,r,s,o)}upload(e){if(!this.uploaded){for(const t of this.nodes)wy(t,e);for(const e of this.nodes)Sy(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)Ty(e)}},e.O=I,e.P=_,e.Q=Ns,e.R=Te,e.S=id,e.T=L_,e.U=ct,e.V=ki,e.W=ut,e.X=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([e,t]){const i=W([1,e,t]);return{x:i.x,y:i.y,z:i.z}}(e.expression.evaluate(t))}interpolate(e,t,i){return{x:ct(e.x,t.x,i),y:ct(e.y,t.y,i),z:ct(e.z,t.z,i)}}},e.Y=function(e,t,i=0,n=!0){const r=new _(i,i),s=e.sub(r),o=t.add(r),a=[s,new _(o.x,s.y),o,new _(s.x,o.y)];return n&&a.push(s.clone()),a},e.Z=$r,e._=function(e,t){const i=[];for(let n=0;n<e.length;n++){const r=A(n-1,-1,e.length-1),s=A(n+1,-1,e.length-1),o=e[n],a=e[s],l=e[r].sub(o).unit(),c=a.sub(o).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));i.push(o.add(h))}return i},e.a=et,e.a$=function(e){const t=[];for(const i in e)t.push(e[i]);return t},e.a0=ql,e.a1=function(t,i,n=0){return e.N.fromValues(((i.x-n)*t.scale-t.x)*ki,(i.y*t.scale-t.y)*ki,_l(i.z,i.y))},e.a2=Eh,e.a3=jf,e.a4=function(e){let t=1/0,i=1/0,n=-1/0,r=-1/0;for(const s of e)t=Math.min(t,s.x),i=Math.min(i,s.y),n=Math.max(n,s.x),r=Math.max(r,s.y);return{min:new _(t,i),max:new _(n,r)}},e.a5=dl,e.a8=Wl,e.a9=El,e.aA=xr,e.aB=ia,e.aC=R,e.aD=Ho,e.aE=S_,e.aF=function(){Is.isLoading()||Is.isLoaded()||"deferred"!==Es()||Ms()},e.aG=Ws,e.aH=Rl,e.aI=yv,e.aJ=$,e.aK=Bf,e.aL=ap,e.aM=kl,e.aN=po,e.aO=zo,e.aP=Nh,e.aQ=ip,e.aR=R_,e.aS=function(t,i){const n=id(i.zoom);if(0===n)return jh(t);const r=qh(t),s=$h(r),o=dl(r.getWest())*i.worldSize,a=dl(r.getEast())*i.worldSize,l=pl(r.getNorth())*i.worldSize,c=pl(r.getSouth())*i.worldSize,u=[o,l,0],h=[a,l,0],d=[o,c,0],p=[a,c,0],f=e.a6.invert([],i.globeMatrix);return e.N.transformMat4(u,u,f),e.N.transformMat4(h,h,f),e.N.transformMat4(d,d,f),e.N.transformMat4(p,p,f),s[0]=Gh(s[0],d,n),s[1]=Gh(s[1],p,n),s[2]=Gh(s[2],h,n),s[3]=Gh(s[3],u,n),Rh.fromPoints(s)},e.aT=Kh,e.aU=Zh,e.aV=Gh,e.aW=fo,e.aX=Oh,e.aY=N,e.aZ=_x,e.a_=Ae,e.aa=M,e.ab=ja,e.ac=function(e,t){const i={};for(let n=0;n<t.length;n++){const r=t[n];r in e&&(i[r]=e[r])}return i},e.ad=tl,e.ae=pl,e.af=class{constructor(e){this.entries={},this.scheduler=e}request(e,t,i,n){const r=this.entries[e]=this.entries[e]||{callbacks:[]};if(r.result){const[e,i]=r.result;return this.scheduler?this.scheduler.add((()=>{n(e,i)}),t):n(e,i),()=>{}}return r.callbacks.push(n),r.cancel||(r.cancel=i(((i,n)=>{r.result=[i,n];for(const e of r.callbacks)this.scheduler?this.scheduler.add((()=>{e(i,n)}),t):e(i,n);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{r.result||(r.callbacks=r.callbacks.filter((e=>e!==n)),r.callbacks.length||(r.cancel(),delete this.entries[e]))}}},e.ag=ro,e.ah=function(e,t,i){const n=JSON.stringify(e.request);return e.data&&(this.deduped.entries[n]={result:[null,e.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const n=Ae(e.request,((e,n,r,s)=>{e?t(e):n&&t(null,{vectorTile:i?void 0:new Ap(new Nm(n)),rawData:n,cacheControl:r,expires:s})}));return()=>{n.cancel(),t()}}),t)},e.ai=function(e){ge++,ge>he&&(e.getActor().send("enforceCacheSizeLimit",ue),ge=0)},e.aj=Ge,e.ak=se,e.al=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.am=ol,e.an=U_,e.ao=G_,e.ap=F_,e.aq=function(e,t){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let t=0;t<e.length;t++){const n=document.createElement("source");Ce(e[t])||(i.crossOrigin="Anonymous"),n.src=e[t],i.appendChild(n)}return{cancel:()=>{}}},e.ar=D_,e.as=Wg,e.at=ml,e.au=gl,e.av=mo,e.aw=Po,e.ax=lt,e.ay=uo,e.az=Fo,e.b=Qe,e.b$=ws,e.b0=function(e,t){const i=[];for(const n in e)n in t||i.push(n);return i},e.b1=C,e.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.b3=function(t,i){const{x:n,y:r}=t.point,s=td(n,r,t.worldSize/t._pixelsPerMercatorPixel,0,0);return e.a6.multiply(s,s,Jh(jh(i)))},e.b5=lm,e.b6=jm,e.b7=am,e.b8=function(e,t,i,n,r){const s=5*t+2;e.float32[s+0]=i,e.float32[s+1]=n,e.float32[s+2]=r},e.b9=v_,e.bA=K_,e.bB=X_,e.bC=function(t){const i=X_(t,!0);return e.b4.invert([],[i[0],i[1],i[4],i[5]])},e.bD=Mh,e.bE=function(e){const{x:t,y:i}=e.point,{lng:n,lat:r}=e._center;return td(t,i,e.worldSize,n,r)},e.bF=b,e.bG=Ga,e.bH=function(e){const t=Math.round((e+45+360)%360/90)%4;return w[t]},e.bI=45,e.bJ=hl,e.bK=Ea,e.bL=xa,e.bM=ba,e.bN=va,e.bO=ya,e.bP=wa,e.bQ=function(e,t,i){const n=Math.sqrt(e*e+t*t+i*i),r=n>0?Math.acos(i/n)*v:0;let s=0!==e||0!==t?Math.atan2(-t,-e)*v+90:0;return s<0&&(s+=360),[n,s,r]},e.bR=wl,e.bS=Rh,e.bT=W,e.bU=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},e.bV=function(e){return e({pluginStatus:xs,pluginURL:bs}),Ts.on("pluginStateChange",e),e},e.bW=Ay,e.bX=Dy,e.bY=bg,e.bZ=xg,e.b_=Me,e.ba=hg,e.bb=Nl,e.bc=rm,e.bd=Dg,e.be=Og,e.bf=Qm,e.bg=bx,e.bh=A,e.bj=x,e.bk=ie,e.bl=fl,e.bm=function(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},e.bn=el,e.bo=p_,e.bp=sl,e.bq=kh,e.br=Y_,e.bs=rl,e.bt=Wh,e.bu=function(e,t,i,n,r,s,o,a,l){if("globe"===l.name)return Wh(e,t,new rl(i,n,r),!1);const c=Wg({z:i,x:n,y:r},l);return new Rh([(s+c.x/c.scale)*t,t*(c.y/c.scale),o],[(s+c.x2/c.scale)*t,t*(c.y2/c.scale),a])},e.bv=function(e,t,i){let n=0;for(let r=0;r<2;++r){const s=i?i[r]:0;e[r]>s&&(n+=(e[r]-s)*(e[r]-s)),t[r]<s&&(n+=(s-t[r])*(s-t[r]))}return n},e.bw=yl,e.bx=Ha,e.by=function(t){const i=e.a6.identity(new Float64Array(16));e.a6.multiply(i,t.pixelMatrix,t.globeMatrix);const n=[0,Za,0],r=[0,Xa,0];return e.N.transformMat4(n,n,i),e.N.transformMat4(r,r,i),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!rd(t,new el(t.center.lat,90)),r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!rd(t,new el(t.center.lat,-90))]},e.bz=function(t,i){const{scale:n}=t.tileTransform,r=n*ki/(t.tileSize*Math.pow(2,i.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return e.b4.scale(new Float32Array(4),i.inverseAdjustmentMatrix,[r,r])},e.c=pv,e.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},e.c0=s,e.c1=U,e.c2=function(e,t,i){return"custom"===e.type?new H_(e,t):new Lv[e.type](e,t,i)},e.c3=function(e){const t=e.indexOf(no);return t>=0?e.slice(0,t):e},e.c4=function(e){return e.indexOf(no)>=0},e.c5=function(e){const t=e.indexOf(no);return t>=0?e.slice(t+1):""},e.c6=function(e){const t=[],i=e.id;return void 0===i&&t.push({message:`layers.${i}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${i}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},e.c7=B,e.c8=Ts,e.c9=Ie,e.cA=Wf,e.cB=(e,t,i,n,r,s)=>{const o=e.transform;return{u_matrix:Hf(e,t,i,n),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:o.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:r,u_image:0,u_tile_units_to_pixels:Gf(t,o),u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:s}},e.cC=(e,t,i,n,r,s,o)=>{const a=e.transform,l=a.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:Hf(e,t,i,n),u_pixels_to_tile_units:l,u_device_pixel_ratio:s,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:r,u_texsize:qf(i)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Gf(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:o,u_emissive_strength:i.paint.get("line-emissive-strength")}},e.cD=D,e.cE=Td,e.cF=Sf,e.cG=ll,e.cH=mf,e.cI=rf,e.cJ=450,e.cK=7,e.cL=B_,e.cM=256,e.cN=Jh,e.cO=Do,e.cP=Oo,e.cQ=function(e,t,i,n,r){return M((e-t)/(i-t)*(r-n)+n,n,r)},e.cR=xl,e.cS=ny,e.cT=[1,1,1],e.cU=Yp,e.cV=yy,e.cW=Eo,e.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const t=Dp(new _(0,0),new _(ki,ki),e),i=[];for(const n of this._activeRegions){if(n.hiddenByOverlap)continue;if(!Lp(t,n))continue;const r=Op(n.min,n.max,e);i.push({min:r.min,max:r.max,sourceId:this._sourceIds[n.priority],footprint:n.footprint,footprintTileId:n.tileId})}return i}setSources(e){this._setSources(e.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const i of e.cache.getVisibleCoordinates()){const n=e.cache.getTile(i).buckets[e.layer];if(n)for(const e of n.getNodesInfo()){const n=e.node;n.footprint&&t.push({footprint:n.footprint,id:i.toUnwrapped()})}}return t}}))))}_addSource(e){const t=e.getFootprints();if(0!==t.length){for(const e of t){if(!e.footprint)continue;const t=Dp(e.footprint.min,e.footprint.max,e.id);this._activeRegions.push({min:t.min,max:t.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:e.id,footprint:e.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort(((e,t)=>e.priority-t.priority||kp(e.min,t.min)||kp(e.max,t.max)));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0,i=0;for(;!e&&t!==this._activeRegions.length;){const n=this._activeRegions[t],r=this._prevRegions[i];e=n.priority!==r.priority||!Rp(n,r),++t,++i}}if(e){++this._updateTime;const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const i=t[e].priority;for(;e<t.length&&t[e].priority===i;)++e;return e};if(this._sourceIds.length>1){let t=0,i=e(t);for(;t!==i;){let n=t;const r=t;for(;n!==i;){const e=this._activeRegions[n];e.hiddenByOverlap=!1;for(let t=0;t<r;t++){const i=this._activeRegions[t];if(!i.hiddenByOverlap&&Lp(e,i)&&(e.hiddenByOverlap=zp(e.footprint,e.tileId,i.footprint,i.tileId),e.hiddenByOverlap))break}++n}t=i,i=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}},e.cY=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const i=new po,n=new Po,r=[],s=e+1+2,o=t[0]+1,a=t[0]+1+(1+t.length),l=(e,t,i)=>{let n=e===s-1?e-2:0===e?e:e-1;return n+=i?24575:0,[n,t]};for(let e=0;e<s;++e)i.emplaceBack(...l(e,0,!0));for(let e=0;e<o;++e)for(let t=0;t<s;++t)i.emplaceBack(...l(t,e,(0===t||t===s-1)&&!0));for(let e=0;e<t.length;++e){const n=t[e];for(let e=0;e<s;++e)i.emplaceBack(...l(e,n,!0))}for(let e=0;e<t.length;++e){const o=n.length,l=t[e]+1+2,c=new Po;for(let i=0;i<l-1;i++){const r=i===l-2,o=r?s*(a-t.length+e-i):s;for(let e=0;e<s-1;e++){const t=i*s+e;0===i||r||0===e||e===s-2?(c.emplaceBack(t+1,t,t+o),c.emplaceBack(t+o,t+o+1,t+1)):(n.emplaceBack(t+1,t,t+o),n.emplaceBack(t+o,t+o+1,t+1))}}const u=ia.simpleSegment(0,o,i.length,n.length-o);for(let e=0;e<c.uint16.length;e+=3)n.emplaceBack(c.uint16[e],c.uint16[e+1],c.uint16[e+2]);const h=ia.simpleSegment(0,o,i.length,n.length-o);r.push({withoutSkirts:u,withSkirts:h})}return{vertices:i,indices:n,segments:r}}_createGrid(e){const t=this._fillGridMeshWithLods(qa,$a);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Nh.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new Po;for(let e=0;e<=qa;e++)t.emplaceBack(0,e+1,e+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const i=new Do,n=new Do,r=new Do,s=new Do;this._poleSegments=[];for(let e=0,t=0;e<Ga;e++){const o=360/(1<<e);i.emplaceBack(0,-ja,0,.5,0),n.emplaceBack(0,-ja,0,.5,1),r.emplaceBack(0,-ja,0,.5,.5),s.emplaceBack(0,-ja,0,.5,.5);for(let e=0;e<=qa;e++){let t=e/qa,a=0;const l=ct(0,o,t),[c,u,h]=Ya(od,ad,l,ja);i.emplaceBack(c,u,h,t,a),n.emplaceBack(c,u,h,t,1-a);const d=x(l);t=.5+.5*Math.sin(d),a=.5+.5*Math.cos(d),r.emplaceBack(c,u,h,t,a),s.emplaceBack(c,u,h,t,1-a)}this._poleSegments.push(ia.simpleSegment(t,0,66,64)),t+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,Dh,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(n,Dh,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(r,Dh,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(s,Dh,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},e.cZ=function(e){return Ye.has(e)},e.c_=T,e.ca=Sa,e.cb=class extends _a{constructor(e){super(e),this.current=Ma}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},e.cc=S,e.cd=function(e,t,i){const n=id(i.zoom),r=e.style.map._antialias,s=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===n&&!r&&!s},e.ce=function(t){const i=t.pixelsPerMeter,n=i/fl(1,t.center.lat),r=e.a6.identity(new Float64Array(16));return e.a6.translate(r,r,[t.point.x,t.point.y,0]),e.a6.scale(r,r,[n,n,i]),Float32Array.from(r)},e.cf=qh,e.cg=function(e){const t=yl-5;e=M(e,-t,t)/t*90;const i=Math.pow(Math.abs(Math.sin(x(e))),3);return Math.round(i*($a.length-1))},e.ch=function(t,i,n,r){const s=i.getNorth(),o=i.getSouth(),a=i.getWest(),l=i.getEast(),c=1<<t.z,u=l-a,h=s-o,d=u/qa,p=-h/$a[n],f=[0,d,0,p,0,0,s,a,0];if(t.z>0){const t=180/r;e.co.multiply(f,f,[t/u+1,0,0,0,t/h+1,0,-.5*t/d,.5*t/p,1])}return f[2]=c,f[5]=t.x,f[8]=t.y,f},e.ci=jh,e.cj=function(t,i,n){const r=e.a6.identity(new Float64Array(16)),s=(i/(1<<t)-.5)*Math.PI*2;return e.a6.rotateY(r,n.globeMatrix,s),Float32Array.from(r)},e.ck=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const i=t.getSource().maxzoom,n=1<<i,r=Math.floor(e.x),s=Math.floor((e.x-r)*n),o=Math.floor(e.y*n),a=this.findDEMTileFor(new ol(i,r,i,s,o));return!(!a||!a.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,i=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);const n=this._source();if(!n)return t;if(e.y<0||e.y>1)return t;const r=n.getSource().maxzoom,s=1<<r,o=Math.floor(e.x),a=e.x-o,l=new ol(r,o,r,Math.floor(a*s),Math.floor(e.y*s)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,p=(e.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(i?this.exaggeration():1)*ct(ct(u.get(f,m),u.get(f,m+1),p-m),ct(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(e,t,i){const n=1<<e.canonical.z;return this.getAtPointOrZero(new Sl(e.wrap+(e.canonical.x+t/ki)/n,(e.canonical.y+i/ki)/n))}getAtTileOffsetFunc(t,i,n,r){return s=>{const o=this.getAtTileOffset(t,s.x,s.y),a=r.upVector(t.canonical,s.x,s.y),l=r.upVectorScale(t.canonical,i,n).metersToTile;return e.N.scale(a,a,o*l),a}}getForTilePoints(e,t,i,n){if(this.isUsingMockSource())return!1;const r=Yp.create(this,e,n);return!!r&&(t.forEach((e=>{e[2]=this.exaggeration()*r.getElevationAt(e[0],e[1],i)})),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const i=t.dem.tree,n=t.tileID,r=1<<e.canonical.z-n.canonical.z;let s=e.canonical.x/r-n.canonical.x,o=e.canonical.y/r-n.canonical.y,a=0;for(let t=0;t<e.canonical.z-n.canonical.z&&!i.leaves[a];t++){s*=2,o*=2;const e=2*Math.floor(o)+Math.floor(s);a=i.childOffsets[a]+e,s%=1,o%=1}return{min:this.exaggeration()*i.minimums[a],max:this.exaggeration()*i.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(0===e.length)return null;let t=!1,i=Number.MAX_VALUE,n=Number.MIN_VALUE;for(const r of e){const e=this.getMinMaxForTile(r.tileID);e&&(i=Math.min(i,e.min),n=Math.max(n,e.max),t=!0)}return t?{min:i,max:n}:null}},e.cl=zh,e.cm=bd,e.cn=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},e.cp=ed,e.cq=256,e.cr=function(t,i){const n=[0,0,0],r=Kh(jh(i.canonical));return e.N.transformMat4(n,n,r),e.N.transformMat4(n,n,t),n},e.cs=e=>({u_camera_to_center_distance:new va(e),u_extrude_scale:new Aa(e),u_device_pixel_ratio:new va(e),u_matrix:new Ea(e),u_inv_rot_matrix:new Ea(e),u_merc_center:new xa(e),u_tile_id:new ba(e),u_zoom_transition:new va(e),u_up_dir:new ba(e),u_emissive_strength:new va(e)}),e.ct=e=>({u_matrix:new Ea(e),u_pixels_to_tile_units:new Aa(e),u_device_pixel_ratio:new va(e),u_units_to_pixels:new xa(e),u_dash_image:new ya(e),u_gradient_image:new ya(e),u_image_height:new va(e),u_texsize:new xa(e),u_tile_units_to_pixels:new va(e),u_alpha_discard_threshold:new va(e),u_trim_offset:new xa(e),u_emissive_strength:new va(e)}),e.cu=e=>({u_matrix:new Ea(e),u_texsize:new xa(e),u_pixels_to_tile_units:new Aa(e),u_device_pixel_ratio:new va(e),u_image:new ya(e),u_units_to_pixels:new xa(e),u_tile_units_to_pixels:new va(e),u_alpha_discard_threshold:new va(e),u_trim_offset:new xa(e)}),e.cv=Ao,e.cw=nm,e.cx=cm,e.cy=cd,e.cz=(e,t,i,n,r,s)=>{const o=e.transform,a="globe"===o.projection.name;let l;if("map"===s.paint.get("circle-pitch-alignment"))if(a){const e=ed(o.zoom,t.canonical)*o._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=o.calculatePixelsToTileUnitsMatrix(i);else l=new Float32Array([o.pixelsToGLUnits[0],0,0,o.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(o.projection),u_matrix:e.translatePosMatrix(t.projMatrix,i,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:oe.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:ld,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:s.paint.get("circle-emissive-strength")};if(a){c.u_inv_rot_matrix=n,c.u_merc_center=r,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=id(o.zoom);const e=r[0]*ki,i=r[1]*ki;c.u_up_dir=o.projection.upVector(new rl(0,0,0),e,i)}return c},e.d=Le,e.d0=E,e.d1=bl,e.d2=Ka,e.d3=function([e,t,i]){const n=Math.hypot(e,t,i),r=Math.atan2(e,i),s=.5*Math.PI-Math.acos(-t/n);return new el(b(r),b(s))},e.d4=Ja,e.d5=n,e.d6=rd,e.d7=nd,e.d8=function(t){const i=[0,0,0],n=e.a6.identity(new Float64Array(16));return e.a6.multiply(n,t.pixelMatrix,t.globeMatrix),e.N.transformMat4(i,i,n),new _(i[0],i[1])},e.d9=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==ee){const t=e.navigator?e.navigator.userAgent:null;ee=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ee}(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},e.dA=vg,e.dB=gv,e.dC=vv,e.dD=Nf,e.dE=F,e.dF=mg,e.dG=function(e,t,i,n,r,s,o,a,l,c,u){e.createArrays(),e.tilePixelRatio=ki/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const h=e.layers[0].layout,d=e.layers[0]._unevaluatedLayout._values,p={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:i}=e.textSizeData;p.compositeTextSizes=[d["text-size"].possiblyEvaluate(new As(t),a),d["text-size"].possiblyEvaluate(new As(i),a)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:i}=e.iconSizeData;p.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new As(t),a),d["icon-size"].possiblyEvaluate(new As(i),a)]}p.layoutTextSize=d["text-size"].possiblyEvaluate(new As(l+1),a),p.layoutIconSize=d["icon-size"].possiblyEvaluate(new As(l+1),a),p.textMaxSize=d["text-size"].possiblyEvaluate(new As(18),a);const f="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),m=h.get("text-size");let g=!1;for(const t of e.features)if(t.icon&&t.icon.nameSecondary){g=!0;break}for(const s of e.features){const l=h.get("text-font").evaluate(s,{},a).join(","),d=m.evaluate(s,{},a),_=p.layoutTextSize.evaluate(s,{},a),y=(p.layoutIconSize.evaluate(s,{},a),{horizontal:{},vertical:void 0}),v=s.text;let x,b=[0,0];if(v){const n=v.toString(),o=h.get("text-letter-spacing").evaluate(s,{},a)*rm,c=h.get("text-line-height").evaluate(s,{},a)*rm,u=cs(n)?o:0,p=h.get("text-anchor").evaluate(s,{},a),m=h.get("text-variable-anchor");if(!m){const e=h.get("text-radial-offset").evaluate(s,{},a);b=e?Dg(p,[e*rm,Rg]):h.get("text-offset").evaluate(s,{},a).map((e=>e*rm))}let g=f?"center":h.get("text-justify").evaluate(s,{},a);const x="point"===h.get("symbol-placement"),w=x?h.get("text-max-width").evaluate(s,{},a)*rm:1/0,S=s=>{e.allowVerticalPlacement&&ls(n)&&(y.vertical=Wm(v,t,i,r,l,w,c,p,s,u,b,jm.vertical,!0,_,d))};if(!f&&m){const e="auto"===g?m.map((e=>Og(e))):[g];let n=!1;for(let s=0;s<e.length;s++){const o=e[s];if(!y.horizontal[o])if(n)y.horizontal[o]=y.horizontal[0];else{const e=Wm(v,t,i,r,l,w,c,"center",o,u,b,jm.horizontal,!1,_,d);e&&(y.horizontal[o]=e,n=1===e.positionedLines.length)}}S("left")}else{if("auto"===g&&(g=Og(p)),x||h.get("text-writing-mode").indexOf("horizontal")>=0||!ls(n)){const e=Wm(v,t,i,r,l,w,c,p,g,u,b,jm.horizontal,!1,_,d);e&&(y.horizontal[g]=e)}S(x?"left":g)}}let w=!1;if(s.icon&&s.icon.namePrimary){const t=n[s.icon.namePrimary];t&&(x=tg(r[s.icon.namePrimary],s.icon.nameSecondary?r[s.icon.nameSecondary]:void 0,h.get("icon-offset").evaluate(s,{},a),h.get("icon-anchor").evaluate(s,{},a)),w=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&j("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==h.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const S=Ug(y.horizontal)||y.vertical;e.iconsInText||(e.iconsInText=!!S&&S.iconsInText),(S||x)&&Ng(e,s,y,x,n,p,_,0,b,w,o,a,c,u,g)}s&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)},e.dH=Ap,e.dI=Nm,e.dJ=Xp,e.dK=h,e.dL=Cp,e.dM=gp,e.dN=m,e.dO=mm,e.dP=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==Ky){const i=new Uint32Array(e,0,7),[,,n,r,s,o]=i;t=i.byteLength+r+s+o+s,(n!==e.byteLength||t>=e.byteLength)&&j("Invalid b3dm header information.")}return nv(e,t)},e.dQ=function(e,t){const i=pv(e);for(const e of i){for(const t of e.meshes)fv(t);e.lights&&(e.lightMeshIndex=e.meshes.length,e.meshes.push(mv(e.lights,t)))}return i},e.dR=Av,e.dS=Iy,e.dT=Is,e.dU=function(e){pe(),le&&le.then((t=>{t.keys().then((i=>{for(let n=0;n<i.length-e;n++)t.delete(i[n])}))}))},e.da=class{constructor(e,t,i){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",De,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,i){if(!s(e))return e;const n=ze(e);return n.params.push(`sdk=js-${t}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||i)}normalizeGlyphsURL(e,t){if(!s(e))return e;const i=ze(e);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeModelURL(e,t){if(!s(e))return e;const i=ze(e);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(e,t,i,n){if(!s(e))return e;const r=ze(e);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),i&&r.params.push(`language=${i}`),n&&r.params.push(`worldview=${n}`),this._makeAPIURL(r,this._customAccessToken||t)}normalizeSpriteURL(e,t,i,n){const r=ze(e);return s(e)?(r.path=`/styles/v1${r.path}/sprite${t}${i}`,this._makeAPIURL(r,this._customAccessToken||n)):(r.path+=`${t}${i}`,Fe(r))}normalizeTileURL(e,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!s(e))return e;const r=ze(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||i&&"raster"!==r.authority&&512===i?"@2x":""}${_e.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${n.RASTER_URL_PREFIX}${r.path}`:"rasterarrays"===r.authority?r.path=`/${n.RASTERARRAYS_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${n.TILE_URL_VERSION}${r.path}`);const o=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(r.params)||n.ACCESS_TOKEN;return n.REQUIRE_ACCESS_TOKEN&&o&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,o)}canonicalizeTileURL(e,t){const i=ze(e);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${n.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?r+=`rasterarrays/${i.path.replace(`/${n.RASTERARRAYS_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${n.TILE_URL_VERSION}/`,"")}`;let s=i.params;return t&&(s=s.filter((e=>!e.match(/^access_token=/)))),s.length&&(r+=`?${s.join("&")}`),r}canonicalizeTileset(e,t){const i=!!t&&s(t),n=[];for(const t of e.tiles||[])r(t)?n.push(this.canonicalizeTileURL(t,i)):n.push(t);return n}_makeAPIURL(e,t){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=ze(n.API_URL);if(e.protocol=r.protocol,e.authority=r.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==r.path&&(e.path=`${r.path}${e.path}`),!n.REQUIRE_ACCESS_TOKEN)return Fe(e);if(t=t||n.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t||""}`),Fe(e)}},e.db=function(e,t){t?Ye.add(e):Ye.delete(e)},e.dc=_e,e.dd=$e,e.de=Xe,e.df=Oe,e.dg=We,e.dh=function(e){Ye.delete(e)},e.di=Ze,e.dj=He,e.dk=t,e.dl=function(e,t){ue=e,he=t},e.dm=function(e,t,i=!1){if(xs===gs||xs===_s||xs===ys)throw new Error("setRTLTextPlugin cannot be called multiple times.");bs=oe.resolveURL(e),xs=gs,vs=t,Ss(),i||Ms()},e.dn=Es,e.dp=function(){Dy().acquire(ky)},e.dq=function(){const e=Ly;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(ky),Ly=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.dr=Ry,e.ds=function(e){const t=de();if(!t)return;const i=t.delete(ae);e&&i.catch(e).then((()=>e()))},e.dt=Cy,e.du=Vy,e.dv=function(e){Ny=oe.resolveURL(e),Uy||(Uy=new Ay(Dy(),new tt)),Uy.broadcast("setDracoUrl",Ny)},e.dw=jy,e.dx=function(e){Fy=oe.resolveURL(e),Uy||(Uy=new Ay(Dy(),new tt)),Uy.broadcast("setMeshoptUrl",Fy)},e.dy=is,e.dz=vd,e.e=P,e.f=oe,e.g=function(e,t){return Ie(P(e,{type:"json"}),t)},e.h=xd,e.i=Xt,e.j=dt,e.k=kr,e.l=function(e){return fetch(e).then((e=>e.arrayBuffer())).then((t=>nv(t,0,e)))},e.m=Lr,e.n=Hr,e.o=js,e.p=dg,e.q=Zr,e.r=Wr,e.s=Dr,e.t=mn,e.u=Vs,e.v=_n,e.w=j,e.x=fn,e.z=Hs})),n(0,(function(e){function t(e){const t=e?e.url.toString():void 0;return t?performance.getEntriesByName(t):[]}function i(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const n of e)t+=`${i(n)},`;return`${t}]`}let t="{";for(const n of Object.keys(e).sort())t+=`${n}:${i(e[n])},`;return`${t}}`}function n(t){let n="";for(const r of e.b2)n+=`/${i(t[r])}`;return n}class r{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,i,r){this._options=r;for(const i of t)this._layerConfigs[i.id]=i,(this._layers[i.id]=e.c2(i,this.scope,this._options)).compileFilter(),this.keyCache[i.id]&&delete this.keyCache[i.id];for(const e of i)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const s=function(e,t){const i={};for(let r=0;r<e.length;r++){const s=t&&t[e[r].id]||n(e[r]);t&&(t[e[r].id]=s);let o=i[s];o||(o=i[s]=[]),o.push(e[r])}const r=[];for(const e in i)r.push(i[e]);return r}(e.a$(this._layerConfigs),this.keyCache);for(const e of s){const t=e.map((e=>this._layers[e.id])),i=t[0];if("none"===i.visibility)continue;const n=i.source||"";let r=this.familiesBySource[n];r||(r=this.familiesBySource[n]={});const s=i.sourceLayer||"_geojsonTileLayer";let o=r[s];o||(o=r[s]=[]),o.push(t)}}}const s=1*e.dA;class o{constructor(t){const i={},n=[];for(const e in t){const r=t[e],o=i[e]={};for(const e in r.glyphs){const t=r.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const i=t.metrics.localGlyph?s:1,a={x:0,y:0,w:t.bitmap.width+2*i,h:t.bitmap.height+2*i};n.push(a),o[e]=a}}const{w:r,h:o}=e.p(n),a=new e.dz({width:r||1,height:o||1});for(const n in t){const r=t[n];for(const t in r.glyphs){const o=r.glyphs[+t];if(!o||0===o.bitmap.width||0===o.bitmap.height)continue;const l=i[n][t],c=o.metrics.localGlyph?s:1;e.dz.copy(o.bitmap,a,{x:0,y:0},{x:l.x+c,y:l.y+c},o.bitmap)}}this.image=a,this.positions=i}}e.dy(o,"GlyphAtlas");class a{constructor(t){this.tileID=new e.am(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=e.as(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,i,n,r,s){this.status="parsing",this.data=t,this.collisionBoxArray=new e.aD;const a=new e.dB(Object.keys(t.layers).sort()),c=new e.dC(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h=new e.dD(256,256),d={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:h,availableImages:n,brightness:this.brightness},p=i.familiesBySource[this.source];for(const i in p){const r=t.layers[i];if(!r)continue;let s=!1,o=!1,h=!1;for(const e of p[i])"symbol"===e[0].type?s=!0:o=!0,e[0].is3D()&&"model"!==e[0].type&&(h=!0);if(this.extraShadowCaster&&!h)continue;if(!0===this.isSymbolTile&&!s)continue;if(!1===this.isSymbolTile&&!o)continue;1===r.version&&e.w(`Vector tile source "${this.source}" layer "${i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const f=a.encode(i),m=[];for(let e=0;e<r.length;e++){const t=r.feature(e),n=c.getId(t,i);m.push({feature:t,id:n,index:e,sourceLayerIndex:f})}for(const e of p[i]){const t=e[0];(!this.extraShadowCaster||t.is3D()&&"model"!==t.type)&&(void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(l(e,this.zoom,d.brightness,n),(u[t.id]=t.createBucket({index:c.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:f,sourceID:this.source,projection:this.projection.spec})).populate(m,d,this.tileID.canonical,this.tileTransform),c.bucketLayerIDs.push(e.map((e=>e.id)))))}}let f,m,g,_;h.trim();const y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},v=()=>{if(f)return this.status="done",s(f);if(this.extraShadowCaster)this.status="done",s(null,{buckets:e.a$(u).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:d.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(m&&g&&_){const t=new o(m),i=new e.dF(g,_);for(const r in u){const s=u[r];s instanceof e.aE?(l(s.layers,this.zoom,d.brightness,n),e.dG(s,m,t.positions,g,i.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):s.hasPattern&&(s instanceof e.aK||s instanceof e.aL||s instanceof e.cH)&&(l(s.layers,this.zoom,d.brightness,n),s.addFeatures(d,this.tileID.canonical,i.patternPositions,n,this.tileTransform,this.brightness))}this.status="done",s(null,{buckets:e.a$(u).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,lineAtlas:h,imageAtlas:i,brightness:d.brightness})}};if(!this.extraShadowCaster){const t=e.dE(d.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(t).length?r.send("getGlyphs",{uid:this.uid,stacks:t,scope:this.scope},((e,t)=>{f||(f=e,m=t,v())}),void 0,!1,y):m={};const i=Object.keys(d.iconDependencies);i.length?r.send("getImages",{icons:i,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((e,t)=>{f||(f=e,g=t,v())}),void 0,!1,y):g={};const n=Object.keys(d.patternDependencies);n.length?r.send("getImages",{icons:n,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((e,t)=>{f||(f=e,_=t,v())}),void 0,!1,y):_={}}v()}}function l(t,i,n,r){const s=new e.K(i,{brightness:n});for(const e of t)e.recalculate(s,r)}class c extends e.E{constructor(t,i,n,r,s,o){super(),this.actor=t,this.layerIndex=i,this.availableImages=n,this.loadVectorData=s||e.ah,this.loading={},this.loaded={},this.deduped=new e.af(t.scheduler),this.isSpriteLoaded=r,this.scheduler=t.scheduler,this.brightness=o}loadTile(i,n){const r=i.uid,s=i&&i.request,o=s&&s.collectResourceTiming,l=this.loading[r]=new a(i);l.abort=this.loadVectorData(i,((a,c)=>{const u=!this.loading[r];if(delete this.loading[r],u||a||!c)return l.status="done",u||(this.loaded[r]=l),n(a);const h=c.rawData,d={};c.expires&&(d.expires=c.expires),c.cacheControl&&(d.cacheControl=c.cacheControl),l.vectorTile=c.vectorTile||new e.dH(new e.dI(h));const p=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,((i,r)=>{if(i||!r)return n(i);const a={};if(o){const e=t(s);e.length>0&&(a.resourceTiming=JSON.parse(JSON.stringify(e)))}n(null,e.e({rawTileData:h.slice(0)},r,d,a))}))};this.isSpriteLoaded?p():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(p,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):p()})),this.loaded=this.loaded||{},this.loaded[r]=l}))}reloadTile(t,i){const n=this.loaded,r=t.uid,s=this;if(n&&n[r]){const o=n[r];o.showCollisionBoxes=t.showCollisionBoxes,o.projection=t.projection,o.brightness=t.brightness,o.tileTransform=e.as(t.tileID.canonical,t.projection),o.extraShadowCaster=t.extraShadowCaster;const a=(e,t)=>{const n=o.reloadCallback;n&&(delete o.reloadCallback,o.parse(o.vectorTile,s.layerIndex,this.availableImages,s.actor,n)),i(e,t)};"parsing"===o.status?o.reloadCallback=a:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,a):a())}else i(null,void 0)}abortTile(e,t){const i=e.uid,n=this.loading[i];n&&(n.abort&&n.abort(),delete this.loading[i]),t()}removeTile(e,t){const i=this.loaded,n=e.uid;i&&i[n]&&delete i[n],t()}}class u{loadTile(t,i){const{uid:n,encoding:r,rawImageData:s,padding:o}=t,a=ImageBitmap&&s instanceof ImageBitmap?this.getImageData(s,o):s;i(null,new e.dJ(n,a,r,o<1))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const i=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}class h{decodeRasterArray({task:t,buffer:i},n){e.aZ.performDecoding(i,t).then((e=>{n(null,e)}),(e=>{n(e)}))}}function d(e,t){if(0!==e.length){p(e[0],t);for(var i=1;i<e.length;i++)p(e[i],!t)}}function p(e,t){for(var i=0,n=0,r=0,s=e.length,o=s-1;r<s;o=r++){var a=(e[r][0]-e[o][0])*(e[o][1]+e[r][1]),l=i+a;n+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+n>=0!=!!t&&e.reverse()}var f=e.dK((function e(t,i){var n,r=t&&t.type;if("FeatureCollection"===r)for(n=0;n<t.features.length;n++)e(t.features[n],i);else if("GeometryCollection"===r)for(n=0;n<t.geometries.length;n++)e(t.geometries[n],i);else if("Feature"===r)e(t.geometry,i);else if("Polygon"===r)d(t.coordinates,i);else if("MultiPolygon"===r)for(n=0;n<t.coordinates.length;n++)d(t.coordinates[n],i);return t}));const m=e.dL.prototype.toGeoJSON;let g=class{constructor(t){this._feature=t,this.extent=e.V,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const i of this._feature.geometry)t.push([new e.P(i[0],i[1])]);return t}{const t=[];for(const i of this._feature.geometry){const n=[];for(const t of i)n.push(new e.P(t[0],t[1]));t.push(n)}return t}}toGeoJSON(e,t,i){return m.call(this,e,t,i)}},_=class{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.V,this.length=t.length,this._features=t}feature(e){return new g(this._features[e])}};var y={exports:{}},v=e.dN,x=e.dM.VectorTileFeature,b=w;function w(e,t){this.options=t||{},this.features=e,this.length=e.length}function S(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}w.prototype.feature=function(e){return new S(this.features[e],this.options.extent)},S.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var i=e[t],n=[],r=0;r<i.length;r++)n.push(new v(i[r][0],i[r][1]));this.geometry.push(n)}return this.geometry},S.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,i=-1/0,n=1/0,r=-1/0,s=0;s<e.length;s++)for(var o=e[s],a=0;a<o.length;a++){var l=o[a];t=Math.min(t,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[t,n,i,r]},S.prototype.toGeoJSON=x.prototype.toGeoJSON;var T=e.dO,E=b;function M(e){var t=new T;return function(e,t){for(var i in e.layers)t.writeMessage(3,I,e.layers[i])}(e,t),t.finish()}function I(e,t){var i;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<e.length;i++)n.feature=e.feature(i),t.writeMessage(2,A,n);var r=n.keys;for(i=0;i<r.length;i++)t.writeStringField(3,r[i]);var s=n.values;for(i=0;i<s.length;i++)t.writeMessage(4,L,s[i])}function A(e,t){var i=e.feature;void 0!==i.id&&t.writeVarintField(1,i.id),t.writeMessage(2,C,e),t.writeVarintField(3,i.type),t.writeMessage(4,R,i)}function C(e,t){var i=e.feature,n=e.keys,r=e.values,s=e.keycache,o=e.valuecache;for(var a in i.properties){var l=i.properties[a],c=s[a];if(null!==l){void 0===c&&(n.push(a),s[a]=c=n.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=o[h];void 0===d&&(r.push(l),o[h]=d=r.length-1),t.writeVarint(d)}}}function P(e,t){return(t<<3)+(7&e)}function k(e){return e<<1^e>>31}function R(e,t){for(var i=e.loadGeometry(),n=e.type,r=0,s=0,o=i.length,a=0;a<o;a++){var l=i[a],c=1;1===n&&(c=l.length),t.writeVarint(P(1,c));for(var u=3===n?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==n&&t.writeVarint(P(2,u-1));var d=l[h].x-r,p=l[h].y-s;t.writeVarint(k(d)),t.writeVarint(k(p)),r+=d,s+=p}3===n&&t.writeVarint(P(7,1))}}function L(e,t){var i=typeof e;"string"===i?t.writeStringField(1,e):"boolean"===i?t.writeBooleanField(7,e):"number"===i&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}y.exports=M,y.exports.fromVectorTileJs=M,y.exports.fromGeojsonVt=function(e,t){t=t||{};var i={};for(var n in e)i[n]=new E(e[n].features,t),i[n].name=n,i[n].version=t.version,i[n].extent=t.extent;return M({layers:i})},y.exports.GeoJSONWrapper=E;var D=e.dK(y.exports);const O={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},N=Math.fround||(z=new Float32Array(1),e=>(z[0]=+e,z[0]));var z;const F=3,B=5,U=6;class V{constructor(e){this.options=Object.assign(Object.create(O),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:i,maxZoom:n}=this.options;t&&console.time("total time");const r=`prepare ${e.length} points`;t&&console.time(r),this.points=e;const s=[];for(let t=0;t<e.length;t++){const i=e[t];if(!i.geometry)continue;const[n,r]=i.geometry.coordinates,o=N(H(n)),a=N(W(r));s.push(o,a,1/0,t,-1,1),this.options.reduce&&s.push(0)}let o=this.trees[n+1]=this._createTree(s);t&&console.timeEnd(r);for(let e=n;e>=i;e--){const i=+Date.now();o=this.trees[e]=this._createTree(this._cluster(o,e)),t&&console.log("z%d: %d clusters in %dms",e,o.numItems,+Date.now()-i)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let i=((e[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const s=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,r=180;else if(i>r){const e=this.getClusters([i,n,180,s],t),o=this.getClusters([-180,n,r,s],t);return e.concat(o)}const o=this.trees[this._limitZoom(t)],a=o.range(H(i),W(s),H(r),W(n)),l=o.data,c=[];for(const e of a){const t=this.stride*e;c.push(l[t+B]>1?j(l,t,this.clusterProps):this.points[l[t+F]])}return c}getChildren(e){const t=this._getOriginId(e),i=this._getOriginZoom(e),n="No cluster with the specified id.",r=this.trees[i];if(!r)throw new Error(n);const s=r.data;if(t*this.stride>=s.length)throw new Error(n);const o=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=r.within(s[t*this.stride],s[t*this.stride+1],o),l=[];for(const t of a){const i=t*this.stride;s[i+4]===e&&l.push(s[i+B]>1?j(s,i,this.clusterProps):this.points[s[i+F]])}if(0===l.length)throw new Error(n);return l}getLeaves(e,t,i){const n=[];return this._appendLeaves(n,e,t=t||10,i=i||0,0),n}getTile(e,t,i){const n=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:s,radius:o}=this.options,a=o/s,l=(i-a)/r,c=(i+1+a)/r,u={features:[]};return this._addTileFeatures(n.range((t-a)/r,l,(t+1+a)/r,c),n.data,t,i,r,u),0===t&&this._addTileFeatures(n.range(1-a/r,l,1,c),n.data,r,i,r,u),t===r-1&&this._addTileFeatures(n.range(0,l,a/r,c),n.data,-1,i,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const i=this.getChildren(e);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t}_appendLeaves(e,t,i,n,r){const s=this.getChildren(t);for(const t of s){const s=t.properties;if(s&&s.cluster?r+s.point_count<=n?r+=s.point_count:r=this._appendLeaves(e,s.cluster_id,i,n,r):r<n?r++:e.push(t),e.length===i)break}return r}_createTree(t){const i=new e.bg(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)i.add(t[e],t[e+1]);return i.finish(),i.data=t,i}_addTileFeatures(e,t,i,n,r,s){for(const o of e){const e=o*this.stride,a=t[e+B]>1;let l,c,u;if(a)l=G(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const i=this.points[t[e+F]];l=i.properties;const[n,r]=i.geometry.coordinates;c=H(n),u=W(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-i)),Math.round(this.options.extent*(u*r-n))]],tags:l};let d;d=a||this.options.generateId?t[e+F]:this.points[t[e+F]].id,void 0!==d&&(h.id=d),s.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:i,extent:n,reduce:r,minPoints:s}=this.options,o=i/(n*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=t)continue;a[i+2]=t;const n=a[i],u=a[i+1],h=e.within(a[i],a[i+1],o),d=a[i+B];let p=d;for(const e of h){const i=e*c;a[i+2]>t&&(p+=a[i+B])}if(p>d&&p>=s){let e,s=n*d,o=u*d,f=-1;const m=(i/c<<5)+(t+1)+this.points.length;for(const n of h){const l=n*c;if(a[l+2]<=t)continue;a[l+2]=t;const u=a[l+B];s+=a[l]*u,o+=a[l+1]*u,a[l+4]=m,r&&(e||(e=this._map(a,i,!0),f=this.clusterProps.length,this.clusterProps.push(e)),r(e,this._map(a,l)))}a[i+4]=m,l.push(s/p,o/p,1/0,m,-1,p),r&&l.push(f)}else{for(let e=0;e<c;e++)l.push(a[i+e]);if(p>1)for(const e of h){const i=e*c;if(!(a[i+2]<=t)){a[i+2]=t;for(let e=0;e<c;e++)l.push(a[i+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,i){if(e[t+B]>1){const n=this.clusterProps[e[t+U]];return i?Object.assign({},n):n}const n=this.points[e[t+F]].properties,r=this.options.map(n);return i&&r===n?Object.assign({},r):r}}function j(e,t,i){return{type:"Feature",id:e[t+F],properties:G(e,t,i),geometry:{type:"Point",coordinates:[(n=e[t],360*(n-.5)),q(e[t+1])]}};var n}function G(e,t,i){const n=e[t+B],r=n>=1e4?`${Math.round(n/1e3)}k`:n>=1e3?Math.round(n/100)/10+"k":n,s=e[t+U],o=-1===s?{}:Object.assign({},i[s]);return Object.assign(o,{cluster:!0,cluster_id:e[t+F],point_count:n,point_count_abbreviated:r})}function H(e){return e/360+.5}function W(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function q(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}var $={exports:{}};$.exports=function(){function e(i,n,r,s){for(var o,a=s,l=r-n>>1,c=r-n,u=i[n],h=i[n+1],d=i[r],p=i[r+1],f=n+3;f<r;f+=3){var m=t(i[f],i[f+1],u,h,d,p);if(m>a)o=f,a=m;else if(m===a){var g=Math.abs(f-l);g<c&&(o=f,c=g)}}a>s&&(o-n>3&&e(i,n,o,s),i[o+2]=a,r-o>3&&e(i,o,r,s))}function t(e,t,i,n,r,s){var o=r-i,a=s-n;if(0!==o||0!==a){var l=((e-i)*o+(t-n)*a)/(o*o+a*a);l>1?(i=r,n=s):l>0&&(i+=o*l,n+=a*l)}return(o=e-i)*o+(a=t-n)*a}function i(e,t,i,r){var s={id:void 0===e?null:e,type:t,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,i=e.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)n(e,t);else if("Polygon"===i||"MultiLineString"===i)for(var r=0;r<t.length;r++)n(e,t[r]);else if("MultiPolygon"===i)for(r=0;r<t.length;r++)for(var s=0;s<t[r].length;s++)n(e,t[r][s])}(s),s}function n(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function r(e,t,n,l){if(t.geometry){var c=t.geometry.coordinates,u=t.geometry.type,h=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),d=[],p=t.id;if(n.promoteId?p=t.properties[n.promoteId]:n.generateId&&(p=l||0),"Point"===u)s(c,d);else if("MultiPoint"===u)for(var f=0;f<c.length;f++)s(c[f],d);else if("LineString"===u)o(c,d,h,!1);else if("MultiLineString"===u){if(n.lineMetrics){for(f=0;f<c.length;f++)o(c[f],d=[],h,!1),e.push(i(p,"LineString",d,t.properties));return}a(c,d,h,!1)}else if("Polygon"===u)a(c,d,h,!0);else{if("MultiPolygon"!==u){if("GeometryCollection"===u){for(f=0;f<t.geometry.geometries.length;f++)r(e,{id:p,geometry:t.geometry.geometries[f],properties:t.properties},n,l);return}throw new Error("Input data is not a valid GeoJSON object.")}for(f=0;f<c.length;f++){var m=[];a(c[f],m,h,!0),d.push(m)}}e.push(i(p,u,d,t.properties))}}function s(e,t){t.push(l(e[0])),t.push(c(e[1])),t.push(0)}function o(t,i,n,r){for(var s,o,a=0,u=0;u<t.length;u++){var h=l(t[u][0]),d=c(t[u][1]);i.push(h),i.push(d),i.push(0),u>0&&(a+=r?(s*d-h*o)/2:Math.sqrt(Math.pow(h-s,2)+Math.pow(d-o,2))),s=h,o=d}var p=i.length-3;i[2]=1,e(i,0,p,n),i[p+2]=1,i.size=Math.abs(a),i.start=0,i.end=i.size}function a(e,t,i,n){for(var r=0;r<e.length;r++){var s=[];o(e[r],s,i,n),t.push(s)}}function l(e){return e/360+.5}function c(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function u(e,t,n,r,s,o,a,l){if(r/=t,o>=(n/=t)&&a<r)return e;if(a<n||o>=r)return null;for(var c=[],u=0;u<e.length;u++){var p=e[u],m=p.geometry,g=p.type,_=0===s?p.minX:p.minY,y=0===s?p.maxX:p.maxY;if(_>=n&&y<r)c.push(p);else if(!(y<n||_>=r)){var v=[];if("Point"===g||"MultiPoint"===g)h(m,v,n,r,s);else if("LineString"===g)d(m,v,n,r,s,!1,l.lineMetrics);else if("MultiLineString"===g)f(m,v,n,r,s,!1);else if("Polygon"===g)f(m,v,n,r,s,!0);else if("MultiPolygon"===g)for(var x=0;x<m.length;x++){var b=[];f(m[x],b,n,r,s,!0),b.length&&v.push(b)}if(v.length){if(l.lineMetrics&&"LineString"===g){for(x=0;x<v.length;x++)c.push(i(p.id,g,v[x],p.tags));continue}"LineString"!==g&&"MultiLineString"!==g||(1===v.length?(g="LineString",v=v[0]):g="MultiLineString"),"Point"!==g&&"MultiPoint"!==g||(g=3===v.length?"Point":"MultiPoint"),c.push(i(p.id,g,v,p.tags))}}}return c.length?c:null}function h(e,t,i,n,r){for(var s=0;s<e.length;s+=3){var o=e[s+r];o>=i&&o<=n&&(t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]))}}function d(e,t,i,n,r,s,o){for(var a,l,c=p(e),u=0===r?g:_,h=e.start,d=0;d<e.length-3;d+=3){var f=e[d],y=e[d+1],v=e[d+2],x=e[d+3],b=e[d+4],w=0===r?f:y,S=0===r?x:b,T=!1;o&&(a=Math.sqrt(Math.pow(f-x,2)+Math.pow(y-b,2))),w<i?S>i&&(l=u(c,f,y,x,b,i),o&&(c.start=h+a*l)):w>n?S<n&&(l=u(c,f,y,x,b,n),o&&(c.start=h+a*l)):m(c,f,y,v),S<i&&w>=i&&(l=u(c,f,y,x,b,i),T=!0),S>n&&w<=n&&(l=u(c,f,y,x,b,n),T=!0),!s&&T&&(o&&(c.end=h+a*l),t.push(c),c=p(e)),o&&(h+=a)}var E=e.length-3;f=e[E],y=e[E+1],v=e[E+2],(w=0===r?f:y)>=i&&w<=n&&m(c,f,y,v),E=c.length-3,s&&E>=3&&(c[E]!==c[0]||c[E+1]!==c[1])&&m(c,c[0],c[1],c[2]),c.length&&t.push(c)}function p(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function f(e,t,i,n,r,s){for(var o=0;o<e.length;o++)d(e[o],t,i,n,r,s,!1)}function m(e,t,i,n){e.push(t),e.push(i),e.push(n)}function g(e,t,i,n,r,s){var o=(s-t)/(n-t);return e.push(s),e.push(i+(r-i)*o),e.push(1),o}function _(e,t,i,n,r,s){var o=(s-i)/(r-i);return e.push(t+(n-t)*o),e.push(s),e.push(1),o}function y(e,t){for(var n=[],r=0;r<e.length;r++){var s,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)s=v(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){s=[];for(var l=0;l<o.geometry.length;l++)s.push(v(o.geometry[l],t))}else if("MultiPolygon"===a)for(s=[],l=0;l<o.geometry.length;l++){for(var c=[],u=0;u<o.geometry[l].length;u++)c.push(v(o.geometry[l][u],t));s.push(c)}n.push(i(o.id,a,s,o.tags))}return n}function v(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var n=0;n<e.length;n+=3)i.push(e[n]+t,e[n+1],e[n+2]);return i}function x(e,t){if(e.transformed)return e;var i,n,r,s=1<<e.z,o=e.x,a=e.y;for(i=0;i<e.features.length;i++){var l=e.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(n=0;n<c.length;n+=2)l.geometry.push(b(c[n],c[n+1],t,s,o,a));else for(n=0;n<c.length;n++){var h=[];for(r=0;r<c[n].length;r+=2)h.push(b(c[n][r],c[n][r+1],t,s,o,a));l.geometry.push(h)}}return e.transformed=!0,e}function b(e,t,i,n,r,s){return[Math.round(i*(e*n-r)),Math.round(i*(t*n-s))]}function w(e,t,i,n,r){for(var s=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){o.numFeatures++,S(o,e[a],s,r);var l=e[a].minX,c=e[a].minY,u=e[a].maxX,h=e[a].maxY;l<o.minX&&(o.minX=l),c<o.minY&&(o.minY=c),u>o.maxX&&(o.maxX=u),h>o.maxY&&(o.maxY=h)}return o}function S(e,t,i,n){var r=t.geometry,s=t.type,o=[];if("Point"===s||"MultiPoint"===s)for(var a=0;a<r.length;a+=3)o.push(r[a]),o.push(r[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===s)T(o,r,e,i,!1,!1);else if("MultiLineString"===s||"Polygon"===s)for(a=0;a<r.length;a++)T(o,r[a],e,i,"Polygon"===s,0===a);else if("MultiPolygon"===s)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)T(o,c[a],e,i,!0,0===a)}if(o.length){var u=t.tags||null;if("LineString"===s&&n.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:o,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function T(e,t,i,n,r,s){var o=n*n;if(n>0&&t.size<(r?o:n))i.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===n||t[l+2]>o)&&(i.numSimplified++,a.push(t[l]),a.push(t[l+1])),i.numPoints++;r&&function(e,t){for(var i=0,n=0,r=e.length,s=r-2;n<r;s=n,n+=2)i+=(e[n]-e[s])*(e[n+1]+e[s+1]);if(i>0===t)for(n=0,r=e.length;n<r/2;n+=2){var o=e[n],a=e[n+1];e[n]=e[r-2-n],e[n+1]=e[r-1-n],e[r-2-n]=o,e[r-1-n]=a}}(a,s),e.push(a)}}function E(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)r(i,e.features[n],t,n);else r(i,"Feature"===e.type?e:{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(e,t){var i=t.buffer/t.extent,n=e,r=u(e,1,-1-i,i,0,-1,2,t),s=u(e,1,1-i,2+i,0,-1,2,t);return(r||s)&&(n=u(e,1,-i,1+i,0,-1,2,t)||[],r&&(n=y(r,1).concat(n)),s&&(n=n.concat(y(s,-1)))),n}(n,t)).length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function M(e,t,i){return 32*((1<<e)*i+t)+e}return E.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},E.prototype.splitTile=function(e,t,i,n,r,s,o){for(var a=[e,t,i,n],l=this.options,c=l.debug;a.length;){n=a.pop(),i=a.pop(),t=a.pop(),e=a.pop();var h=1<<t,d=M(t,i,n),p=this.tiles[d];if(!p&&(c>1&&console.time("creation"),p=this.tiles[d]=w(e,t,i,n,l),this.tileCoords.push({z:t,x:i,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=e,r){if(t===l.maxZoom||t===r)continue;var m=1<<r-t;if(i!==Math.floor(s/m)||n!==Math.floor(o/m))continue}else if(t===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==e.length){c>1&&console.time("clipping");var g,_,y,v,x,b,S=.5*l.buffer/l.extent,T=.5-S,E=.5+S,I=1+S;g=_=y=v=null,x=u(e,h,i-S,i+E,0,p.minX,p.maxX,l),b=u(e,h,i+T,i+I,0,p.minX,p.maxX,l),e=null,x&&(g=u(x,h,n-S,n+E,1,p.minY,p.maxY,l),_=u(x,h,n+T,n+I,1,p.minY,p.maxY,l),x=null),b&&(y=u(b,h,n-S,n+E,1,p.minY,p.maxY,l),v=u(b,h,n+T,n+I,1,p.minY,p.maxY,l),b=null),c>1&&console.timeEnd("clipping"),a.push(g||[],t+1,2*i,2*n),a.push(_||[],t+1,2*i,2*n+1),a.push(y||[],t+1,2*i+1,2*n),a.push(v||[],t+1,2*i+1,2*n+1)}}},E.prototype.getTile=function(e,t,i){var n=this.options,r=n.extent,s=n.debug;if(e<0||e>24)return null;var o=1<<e,a=M(e,t=(t%o+o)%o,i);if(this.tiles[a])return x(this.tiles[a],r);s>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var l,c=e,u=t,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[M(c,u,h)];return l&&l.source?(s>1&&console.log("found parent tile z%d-%d-%d",c,u,h),s>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,i),s>1&&console.timeEnd("drilling down"),this.tiles[a]?x(this.tiles[a],r):null):null},function(e,t){return new E(e,t)}}();var Z=e.dK($.exports);function X(e,t){const i=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return t(null,null);const r=new _(n.features);let s=D(r);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),t(null,{vectorTile:r,rawData:s.buffer})}class Y extends c{constructor(e,t,i,n,r,s){super(e,t,i,n,X,s),r&&(this.loadGeoJSON=r)}loadData(i,n){const r=i&&i.request,s=r&&r.collectResourceTiming;this.loadGeoJSON(i,((o,a)=>{if(o||!a)return n(o);if("object"!=typeof a)return n(new Error(`Input data given to '${i.source}' is not a valid GeoJSON object.`));{f(a,!0);try{if(i.filter){const t=e.r(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const n=a.features.filter((e=>t.value.evaluate({zoom:0},e)));a={type:"FeatureCollection",features:n}}this._geoJSONIndex=i.cluster?new V(function({superclusterOptions:t,clusterProperties:i}){if(!i||!t)return t;const n={},r={},s={accumulated:null,zoom:0},o={properties:null},a=Object.keys(i);for(const t of a){const[s,o]=i[t],a=e.r(o),l=e.r("string"==typeof s?[s,["accumulated"],["get",t]]:s);n[t]=a.value,r[t]=l.value}return t.map=e=>{o.properties=e;const t={};for(const e of a)t[e]=n[e].evaluate(s,o);return t},t.reduce=(e,t)=>{o.properties=t;for(const t of a)s.accumulated=e[t],e[t]=r[t].evaluate(s,o)},t}(i)).load(a.features):Z(a,i.geojsonVtOptions)}catch(o){return n(o)}this.loaded={};const l={};if(s){const e=t(r);e&&(l.resourceTiming={},l.resourceTiming[i.source]=JSON.parse(JSON.stringify(e)))}n(null,l)}}))}reloadTile(e,t){const i=this.loaded;return i&&i[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,i){if(t.request)e.g(t.request,i);else{if("string"!=typeof t.data)return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(t.data))}catch(e){return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class K{constructor(t,i){this.tileID=new e.am(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=i}parse(t,i,n,r){this.status="parsing";const s=new e.am(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),o={},a=i.familiesBySource[n.source],l=new e.dC(s,n.promoteId);return l.bucketLayerIDs=[],l.is3DTile=!0,e.dP(t).then((t=>{if(!t)return r(new Error("Could not parse tile"));const i=e.dQ(t,1/e.bR(n.tileID.canonical)),c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features")||t.json.asset.extras&&t.json.asset.extras.MAPBOX_mesh_features,u=t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression"),h=new e.K(this.zoom,{brightness:this.brightness});for(const t in a)for(const n of a[t]){const t=n[0];l.bucketLayerIDs.push(n.map((e=>e.id))),t.recalculate(h,[]);const r=new e.dR(i,s,c,u,this.brightness,l);c||(r.needsUpload=!0),o[t.fqid]=r,r.evaluate(t)}this.status="done",r(null,{buckets:o,featureIndex:l})})).catch((e=>r(new Error(e.message))))}}class J{constructor(e,t,i,n,r,s){this.actor=e,this.layerIndex=t,this.brightness=s,this.loading={},this.loaded={}}loadTile(t,i){const n=t.uid,r=this.loading[n]=new K(t,this.brightness);e.a_(t.request,((e,s)=>{const o=!this.loading[n];return delete this.loading[n],o||e?(r.status="done",o||(this.loaded[n]=r),i(e)):s&&0!==s.byteLength?void r.parse(s,this.layerIndex,t,((e,t)=>{r.status="done",this.loaded=this.loaded||{},this.loaded[n]=r,e||!t?i(e):i(null,t)})):(r.status="done",this.loaded[n]=r,i())}))}reloadTile(e,t){const i=this.loaded,n=e.uid;if(i&&i[n]){const r=i[n];r.projection=e.projection,r.brightness=e.brightness;const s=(i,n)=>{r.reloadCallback&&(delete r.reloadCallback,this.loadTile(e,t)),t(i,n)};"parsing"===r.status?r.reloadCallback=s:"done"===r.status&&this.loadTile(e,t)}}abortTile(e,t){const i=e.uid;this.loading[i]&&delete this.loading[i],t()}removeTile(e,t){const i=this.loaded,n=e.uid;i&&i[n]&&delete i[n],t()}}class Q{constructor(t){this.self=t,this.actor=new e.dS(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.bo({name:"mercator"}),this.workerSourceTypes={vector:c,geojson:Y,"batched-model":J},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.dT.isParsed())throw new Error("RTL text plugin already registered.");e.dT.applyArabicShaping=t.applyArabicShaping,e.dT.processBidirectionalText=t.processBidirectionalText,e.dT.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,i){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],delete this.rasterArrayWorkerSource,i()}checkIfReady(e,t,i){i()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,{scope:i,isLoaded:n}){if(this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),this.isSpriteLoaded[t][i]=n,this.workerSources[t]&&this.workerSources[t][i])for(const r in this.workerSources[t][i]){const s=this.workerSources[t][i][r];for(const t in s)s[t]instanceof c&&(s[t].isSpriteLoaded=n,s[t].fire(new e.b("isSpriteLoaded")))}}setImages(e,{scope:t,images:i},n){if(this.availableImages[e]||(this.availableImages[e]={}),this.availableImages[e][t]=i,this.workerSources[e]&&this.workerSources[e][t]){for(const n in this.workerSources[e][t]){const r=this.workerSources[e][t][n];for(const e in r)r[e].availableImages=i}n()}else n()}setProjection(t,i){this.projections[t]=e.bo(i)}setBrightness(e,t,i){this.brightness=t,i()}setLayers(e,t,i){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),i()}updateLayers(e,t,i){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),i()}loadTile(e,t,i){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,i)}loadDEMTile(e,t,i){this.getDEMWorkerSource(e,t.source,t.scope).loadTile(t,i)}decodeRasterArray(e,t,i){this.getRasterArrayWorkerSource().decodeRasterArray(t,i)}reloadTile(e,t,i){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,i)}abortTile(e,t,i){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,i)}removeTile(e,t,i){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,i)}removeSource(e,t,i){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const n=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==n.removeSource?n.removeSource(t,i):i()}loadWorkerSource(e,t,i){try{this.self.importScripts(t.url),i()}catch(e){i(e.toString())}}syncRTLPluginState(t,i,n){try{e.dT.setState(i);const t=e.dT.getPluginURL();if(e.dT.isLoaded()&&!e.dT.isParsed()&&null!=t){this.self.importScripts(t);const i=e.dT.isParsed();n(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),i)}}catch(e){n(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let i=this.availableImages[e][t];return i||(i=[]),i}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let i=this.layerIndexes[e][t];return i||(i=this.layerIndexes[e][t]=new r,i.scope=t),i}getWorkerSource(e,t,i,n){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][n]||(this.workerSources[e][n]={}),this.workerSources[e][n][t]||(this.workerSources[e][n][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),!this.workerSources[e][n][t][i]){const r={send:(t,i,n,r,s,o)=>{this.actor.send(t,i,n,e,s,o)},scheduler:this.actor.scheduler};this.workerSources[e][n][t][i]=new this.workerSourceTypes[t](r,this.getLayerIndex(e,n),this.getAvailableImages(e,n),this.isSpriteLoaded[e][n],void 0,this.brightness)}return this.workerSources[e][n][t][i]}getDEMWorkerSource(e,t,i){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][i]||(this.demWorkerSources[e][i]={}),this.demWorkerSources[e][i][t]||(this.demWorkerSources[e][i][t]=new u),this.demWorkerSources[e][i][t]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new h),this.rasterArrayWorkerSource}enforceCacheSizeLimit(t,i){e.dU(i)}getWorkerPerformanceMetrics(e,t,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Q(self)),Q})),n(0,(function(e){function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let n=0;n<e.length;n++)if(!t(e[n],i[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const n in e)if(!t(e[n],i[n]))return!1;return!0}return e===i}var i=n;function n(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,i=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(i);try{t=new Worker(n),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(n),e}()?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===r[t=e&&e.failIfMajorPerformanceCaveat]&&(r[t]=function(e){var t,i=function(e){var t=document.createElement("canvas"),i=Object.create(n.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=e,t.getContext("webgl2",i)}(e);if(!i)return!1;try{t=i.createShader(i.VERTEX_SHADER)}catch(e){return!1}return!(!t||i.isContextLost())&&(i.shaderSource(t,"void main() {}"),i.compileShader(t),!0===i.getShaderParameter(t,i.COMPILE_STATUS))}(t)),r[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var t}(e)}var r={};function s(e,t,i){const n=document.createElement(e);return null!=t&&(n.className=t),i&&i.appendChild(n),n}function o(e,t,i){const n=document.createElementNS("http://www.w3.org/2000/svg",e);for(const e of Object.keys(t))n.setAttributeNS(null,e,String(t[e]));return i&&i.appendChild(n),n}n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const a="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,l=a&&void 0!==a.userSelect?"userSelect":"WebkitUserSelect";let c;function u(){a&&l&&(c=a[l],a[l]="none")}function h(){a&&l&&(a[l]=c)}function d(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",d,!0)}function p(){window.addEventListener("click",d,!0),window.setTimeout((()=>{window.removeEventListener("click",d,!0)}),0)}function f(e,t){const i=e.getBoundingClientRect();return _(e,i,t)}function m(e,t){const i=e.getBoundingClientRect(),n=[];for(let r=0;r<t.length;r++)n.push(_(e,i,t[r]));return n}function g(e){return void 0!==window.InstallTrigger&&2===e.button&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function _(t,i,n){const r=t.offsetWidth===i.width?1:t.offsetWidth/i.width;return new e.P((n.clientX-i.left)*r,(n.clientY-i.top)*r)}class y{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty()}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(e){this._updatedImages.add(e),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class v extends e.E{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(t,i){return e.l(this.requestManager.transformRequest(i,e.R.Model).url).then((i=>{if(!i)return;const n=e.c(i),r=new e.M(t,void 0,void 0,n);return r.computeBoundsAndApplyParent(),r})).catch((n=>{this.fire(new e.a(new Error(`Could not load model ${t} from ${i}: ${n.message}`)))}))}load(t,i){this.models[i]||(this.models[i]={});const n=Object.keys(t);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+n.length;const r=[];for(const e of n)r.push(this.loadModel(e,t[e]));Promise.allSettled(r).then((t=>{for(let e=0;e<t.length;e++){const{status:r,value:s}=t[e];"fulfilled"===r&&s&&(this.models[i][n[e]]=s)}this.numModelsLoading[i]-=n.length,this.fire(new e.b("data",{dataType:"style"}))})).catch((t=>{this.fire(new e.a(new Error(`Could not load models: ${t.message}`)))}))}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!this.getModel(e,t)}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]}addModel(e,t,i){this.models[i]||(this.models[i]={}),this.hasModel(e,i)&&this.removeModel(e,i),this.load({[e]:this.requestManager.normalizeModelURL(t)},i)}addModels(e,t){const i={};for(const t in e)i[t]=this.requestManager.normalizeModelURL(e[t]);this.load(i,t)}removeModel(e,t){this.models[t]||(this.models[t]={});const i=this.models[t][e];delete this.models[t][e],i.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const i in this.models[t])this.models[t][i].upload(e.context)}}class x{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,n){const r=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},e.e(this.stateChanges[t][r],n),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==r&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][r]){this.deletedStates[t][r]={};for(const e in this.state[t][r])n[e]||(this.deletedStates[t][r][e]=null)}else for(const e in n)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][e]&&delete this.deletedStates[t][r][e]}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const n=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][n]&&(this.deletedStates[e][n]=this.deletedStates[e][n]||{},this.deletedStates[e][n][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][n])for(i in this.deletedStates[e][n]={},this.stateChanges[e][n])this.deletedStates[e][n][i]=null;else this.deletedStates[e][n]=null;else this.deletedStates[e]=null}getState(t,i){const n=String(i),r=e.e({},(this.state[t]||{})[n],(this.stateChanges[t]||{})[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const e=this.deletedStates[t][i];if(null===e)return{};for(const t in e)delete r[t]}return r}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(t,i){const n={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const i={};for(const n in this.stateChanges[t])this.state[t][n]||(this.state[t][n]={}),e.e(this.state[t][n],this.stateChanges[t][n]),i[n]=this.state[t][n];n[t]=i}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const i={};if(null===this.deletedStates[t])for(const e in this.state[t])i[e]={},this.state[t][e]={};else for(const e in this.deletedStates[t]){if(null===this.deletedStates[t][e])this.state[t][e]={};else if(this.state[t][e])for(const i of Object.keys(this.deletedStates[t][e]))delete this.state[t][e][i];i[e]=this.state[t][e]}n[t]=n[t]||{},e.e(n[t],i)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const e in t)t[e].setFeatureState(n,i)}}function b(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class w extends e.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new e.h({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,t){if(this.loaded[t]!==e&&(this.loaded[t]=e,e)){for(const{ids:e,callback:i}of this.requestors)this._notify(e,t,i);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images[t][e]}addImage(e,t,i){this._validate(e,i)&&(this.images[t][e]=i)}_validate(t,i){let n=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.a(new Error(`Image "${t}" has invalid "stretchX" value`))),n=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.a(new Error(`Image "${t}" has invalid "stretchY" value`))),n=!1),this._validateContent(i.content,i)||(this.fire(new e.a(new Error(`Image "${t}" has invalid "content" value`))),n=!1),n}_validateStretch(e,t){if(!e)return!0;let i=0;for(const n of e){if(n[0]<i||n[1]<n[0]||t<n[1])return!1;i=n[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t,i){i.version=this.images[t][e].version+1,this.images[t][e]=i,this.updatedImages[t][e]=!0}removeImage(e,t){const i=this.images[t][e];delete this.images[t][e],delete this.patterns[t][e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,t,i){let n=!0;const r=!!this.loaded[t];if(!r)for(const i of e)this.images[t][i]||(n=!1);r||n?this._notify(e,t,i):this.requestors.push({ids:e,scope:t,callback:i})}getUpdatedImages(e){return this.updatedImages[e]}_notify(t,i,n){const r={};for(const n of t){this.images[i][n]||this.fire(new e.b("styleimagemissing",{id:n}));const t=this.images[i][n];t?r[n]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.w(`Image "${n}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,r)}getPixelSize(e){const{width:t,height:i}=this.atlasImage[e];return{width:t,height:i}}getPattern(t,i){const n=this.patterns[i][t],r=this.getImage(t,i);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{const n={w:r.data.width+2,h:r.data.height+2,x:0,y:0},s=new e.I(n,r);this.patterns[i][t]={bin:n,position:s}}return this._updatePatternAtlas(i),this.patterns[i][t].position}bind(t,i){const n=t.gl;let r=this.atlasTexture[i];r?this.dirty&&(r.update(this.atlasImage[i]),this.dirty=!1):(r=new e.T(t,this.atlasImage[i],n.RGBA),this.atlasTexture[i]=r),r.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(t){const i=[];for(const e in this.patterns[t])i.push(this.patterns[t][e].bin);const{w:n,h:r}=e.p(i),s=this.atlasImage[t];s.resize({width:n||1,height:r||1});for(const i in this.patterns[t]){const{bin:n}=this.patterns[t][i],r=n.x+1,o=n.y+1,a=this.images[t][i].data,l=a.width,c=a.height;e.h.copy(a,s,{x:0,y:0},{x:r,y:o},{width:l,height:c}),e.h.copy(a,s,{x:0,y:c-1},{x:r,y:o-1},{width:l,height:1}),e.h.copy(a,s,{x:0,y:0},{x:r,y:o+c},{width:l,height:1}),e.h.copy(a,s,{x:l-1,y:0},{x:r-1,y:o},{width:1,height:c}),e.h.copy(a,s,{x:0,y:0},{x:r+l,y:o},{width:1,height:c})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,t){for(const i of e){if(this.callbackDispatchedThisFrame[t][i])continue;this.callbackDispatchedThisFrame[t][i]=!0;const e=this.images[t][i];b(e)&&this.updateImage(i,t,e)}}}class S{constructor(e,t,i,n){this.message=(e?`${e}: `:"")+i,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__)}}class T extends S{}function E(t){const i=t.key,n=t.value,r=t.valueSpec||{},s=t.objectElementValidators||{},o=t.style,a=t.styleSpec;let l=[];const c=e.i(n);if("object"!==c)return[new S(i,n,`object expected, ${c} found`)];for(const e in n){const t=e.split(".")[0];let c;s[t]?c=s[t]:r[t]?c=Z:s["*"]?c=s["*"]:r["*"]&&(c=Z),c?l=l.concat(c({key:(i?`${i}.`:i)+e,value:n[e],valueSpec:r[t]||r["*"],style:o,styleSpec:a,object:n,objectKey:e},n)):l.push(new T(i,n[e],`unknown property "${e}"`))}for(const e in r)s[e]||r[e].required&&void 0===r[e].default&&void 0===n[e]&&l.push(new S(i,n,`missing required property "${e}"`));return l}function M(t){const i=t.value,n=t.valueSpec,r=t.style,s=t.styleSpec,o=t.key,a=t.arrayElementValidator||Z;if("array"!==e.i(i))return[new S(o,i,`array expected, ${e.i(i)} found`)];if(n.length&&i.length!==n.length)return[new S(o,i,`array length ${n.length} expected, length ${i.length} found`)];if(n["min-length"]&&i.length<n["min-length"])return[new S(o,i,`array length at least ${n["min-length"]} expected, length ${i.length} found`)];let l={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};s.$version<7&&(l.function=n.function),"object"===e.i(n.value)&&(l=n.value);let c=[];for(let e=0;e<i.length;e++)c=c.concat(a({array:i,arrayIndex:e,value:i[e],valueSpec:l,style:r,styleSpec:s,key:`${o}[${e}]`},!0));return c}function I(t){const i=t.key,n=t.value,r=t.valueSpec;let s=e.i(n);if("number"===s&&n!=n&&(s="NaN"),"number"!==s)return[new S(i,n,`number expected, ${s} found`)];if("minimum"in r){let s=r.minimum;if("array"===e.i(r.minimum)&&(s=r.minimum[t.arrayIndex]),n<s)return[new S(i,n,`${n} is less than the minimum value ${s}`)]}if("maximum"in r){let s=r.maximum;if("array"===e.i(r.maximum)&&(s=r.maximum[t.arrayIndex]),n>s)return[new S(i,n,`${n} is greater than the maximum value ${s}`)]}return[]}function A(t){const i=t.valueSpec,n=e.u(t.value.type);let r,s,o,a={};const l="categorical"!==n&&void 0===t.value.property,c=!l,u="array"===e.i(t.value.stops)&&"array"===e.i(t.value.stops[0])&&"object"===e.i(t.value.stops[0][0]),h=E({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===n)return[new S(t.key,t.value,'identity function may not have a "stops" property')];let i=[];const r=t.value;return i=i.concat(M({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:d})),"array"===e.i(r)&&0===r.length&&i.push(new S(t.key,r,"array must have at least one stop")),i},default:function(e){return Z({key:e.key,value:e.value,valueSpec:i,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===n&&l&&h.push(new S(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||h.push(new S(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!e.s(t.valueSpec)&&h.push(new S(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(c&&!e.k(t.valueSpec)?h.push(new S(t.key,t.value,"property functions not supported")):l&&!e.m(t.valueSpec)&&h.push(new S(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!u||void 0!==t.value.property||h.push(new S(t.key,t.value,'"property" property is required')),h;function d(t){let n=[];const r=t.value,l=t.key;if("array"!==e.i(r))return[new S(l,r,`array expected, ${e.i(r)} found`)];if(2!==r.length)return[new S(l,r,`array length 2 expected, length ${r.length} found`)];if(u){if("object"!==e.i(r[0]))return[new S(l,r,`object expected, ${e.i(r[0])} found`)];if(void 0===r[0].zoom)return[new S(l,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new S(l,r,"object stop key must have value")];const i=e.u(r[0].zoom);if("number"!=typeof i)return[new S(l,r[0].zoom,"stop zoom values must be numbers")];if(o&&o>i)return[new S(l,r[0].zoom,"stop zoom values must appear in ascending order")];i!==o&&(o=i,s=void 0,a={}),n=n.concat(E({key:`${l}[0]`,value:r[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:I,value:p}}))}else n=n.concat(p({key:`${l}[0]`,value:r[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},r));return e.n(e.o(r[1]))?n.concat([new S(`${l}[1]`,r[1],"expressions are not allowed in function stops.")]):n.concat(Z({key:`${l}[1]`,value:r[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function p(t,o){const l=e.i(t.value),c=e.u(t.value),u=null!==t.value?t.value:o;if(r){if(l!==r)return[new S(t.key,u,`${l} stop domain type must match previous stop domain type ${r}`)]}else r=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return[new S(t.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==n){let r=`number expected, ${l} found`;return e.k(i)&&void 0===n&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new S(t.key,u,r)]}return"categorical"!==n||"number"!==l||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==n&&"number"===l&&"number"==typeof c&&"number"==typeof s&&void 0!==s&&c<s?[new S(t.key,u,"stop domain values must appear in ascending order")]:(s=c,"categorical"===n&&c in a?[new S(t.key,u,"stop domain values must be unique")]:(a[c]=!0,[])):[new S(t.key,u,`integer expected, found ${String(c)}`)]}}function C(t){const i=("property"===t.expressionContext?e.q:e.r)(e.o(t.value),t.valueSpec);if("error"===i.result)return i.value.map((e=>new S(`${t.key}${e.key}`,t.value,e.message)));const n=i.value.expression||i.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new S(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!e.t(n))return[new S(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return P(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!e.v(n,["zoom","feature-state"]))return[new S(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!e.x(n))return[new S(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function P(t,i){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const e of i.valueSpec.expression.parameters)n.delete(e);if(0===n.size)return[];const r=[];return t instanceof e.C&&n.has(t.name)?[new S(i.key,i.value,`["${t.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(t.eachChild((e=>{r.push(...P(e,i))})),r)}function k(t){const i=t.key,n=t.value,r=t.valueSpec,s=[];return Array.isArray(r.values)?-1===r.values.indexOf(e.u(n))&&s.push(new S(i,n,`expected one of [${r.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(r.values).indexOf(e.u(n))&&s.push(new S(i,n,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(n)} found`)),s}function R(t){return e.z(e.o(t.value))?C(e.j({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):L(t)}function L(t){const i=t.value,n=t.key;if("array"!==e.i(i))return[new S(n,i,`array expected, ${e.i(i)} found`)];const r=t.styleSpec;let s,o=[];if(i.length<1)return[new S(n,i,"filter array must have at least 1 element")];switch(o=o.concat(k({key:`${n}[0]`,value:i[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),e.u(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===e.u(i[1])&&o.push(new S(n,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&o.push(new S(n,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(s=e.i(i[1]),"string"!==s&&o.push(new S(`${n}[1]`,i[1],`string expected, ${s} found`)));for(let a=2;a<i.length;a++)s=e.i(i[a]),"$type"===e.u(i[1])?o=o.concat(k({key:`${n}[${a}]`,value:i[a],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==s&&"number"!==s&&"boolean"!==s&&o.push(new S(`${n}[${a}]`,i[a],`string, number, or boolean expected, ${s} found`));break;case"any":case"all":case"none":for(let e=1;e<i.length;e++)o=o.concat(L({key:`${n}[${e}]`,value:i[e],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":s=e.i(i[1]),2!==i.length?o.push(new S(n,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==s&&o.push(new S(`${n}[1]`,i[1],`string expected, ${s} found`))}return o}function D(t,i){const n=t.key,r=t.style,s=t.layer,o=t.styleSpec,a=t.value,l=t.objectKey,c=o[`${i}_${t.layerType}`];if(!c)return[];const u=l.match(/^(.*)-transition$/);if("paint"===i&&u&&c[u[1]]&&c[u[1]].transition)return Z({key:n,value:a,valueSpec:o.transition,style:r,styleSpec:o});const h=t.valueSpec||c[l];if(!h)return[new T(n,a,`unknown property "${l}"`)];let d;if("string"===e.i(a)&&e.k(h)&&!h.tokens&&(d=/^{([^}]+)}$/.exec(a))){const e=`\`{ "type": "identity", "property": ${d?JSON.stringify(d[1]):'"_"'} }\``;return[new S(n,a,`"${l}" does not support interpolation syntax\nUse an identity property function instead: ${e}.`)]}const p=[];if("symbol"===t.layerType)"text-field"!==l||!r||r.glyphs||r.imports||p.push(new S(n,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&e.A(e.o(a))&&"identity"===e.u(a.type)&&p.push(new S(n,a,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===i&&s&&s.layout&&s.layout.hasOwnProperty("model-id")&&e.k(h)&&(e.B(h)||e.m(h))){const t=e.q(e.o(a),h),i=t.value.expression||t.value._styleExpression.expression;i&&!e.v(i,["measure-light"])&&("model-emissive-strength"===l&&e.x(i)&&e.t(i)||p.push(new S(n,a,`${l} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return p.concat(Z({key:t.key,value:a,valueSpec:h,style:r,styleSpec:o,expressionContext:"property",propertyType:i,propertyKey:l}))}function O(e){return D(e,"paint")}function N(e){return D(e,"layout")}function z(t){let i=[];const n=t.value,r=t.key,s=t.style,o=t.styleSpec;n.type||n.ref||i.push(new S(r,n,'either "type" or "ref" is required'));let a=e.u(n.type);const l=e.u(n.ref);if(n.id){const o=e.u(n.id);for(let a=0;a<t.arrayIndex;a++){const t=s.layers[a];e.u(t.id)===o&&i.push(new S(r,n.id,`duplicate layer id "${n.id}", previously used at line ${t.id.__line__}`))}}if("ref"in n){let t;["type","source","source-layer","filter","layout"].forEach((e=>{e in n&&i.push(new S(r,n[e],`"${e}" is prohibited for ref layers`))})),s.layers.forEach((i=>{e.u(i.id)===l&&(t=i)})),t?t.ref?i.push(new S(r,n.ref,"ref cannot reference another ref layer")):a=e.u(t.type):"string"==typeof l&&i.push(new S(r,n.ref,`ref layer "${l}" not found`))}else if("background"!==a&&"sky"!==a&&"slot"!==a)if(n.source){const t=s.sources&&s.sources[n.source],o=t&&e.u(t.type);t?"vector"===o&&"raster"===a?i.push(new S(r,n.source,`layer "${n.id}" requires a raster source`)):"raster"===o&&"raster"!==a?i.push(new S(r,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==o||n["source-layer"]?"raster-dem"===o&&"hillshade"!==a?i.push(new S(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==o||["raster","raster-particle"].includes(a)?"line"!==a||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===o&&t.lineMetrics?"raster-particle"===a&&"raster-array"!==o&&i.push(new S(r,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):i.push(new S(r,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new S(r,n.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new S(r,n,`layer "${n.id}" must specify a "source-layer"`)):i.push(new S(r,n.source,`source "${n.source}" not found`))}else i.push(new S(r,n,'missing required property "source"'));return i=i.concat(E({key:r,value:n,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Z({key:`${r}.type`,value:n.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:t=>R(e.j({layerType:a},t)),layout:t=>E({layer:n,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>N(e.j({layerType:a},t))}}),paint:t=>E({layer:n,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>O(e.j({layerType:a,layer:n},t))}})}})),i}function F(t){const i=t.value,n=t.key,r=e.i(i);return"string"!==r?[new S(n,i,`string expected, ${r} found`)]:[]}const B={promoteId:function({key:t,value:i}){if("string"===e.i(i))return F({key:t,value:i});{const e=[];for(const n in i)e.push(...F({key:`${t}.${n}`,value:i[n]}));return e}}};function U(t){const i=t.value,n=t.key,r=t.styleSpec,s=t.style;if(!i.type)return[new S(n,i,'"type" is required')];const o=e.u(i.type);let a=[];switch(["vector","raster","raster-dem","raster-array"].includes(o)&&(i.url||i.tiles||a.push(new T(n,i,'Either "url" or "tiles" is required.'))),o){case"vector":case"raster":case"raster-dem":case"raster-array":return a=a.concat(E({key:n,value:i,valueSpec:r[`source_${o.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:B})),a;case"geojson":if(a=E({key:n,value:i,valueSpec:r.source_geojson,style:s,styleSpec:r,objectElementValidators:B}),i.cluster)for(const e in i.clusterProperties){const[t,r]=i.clusterProperties[e],s="string"==typeof t?[t,["accumulated"],["get",e]]:t;a.push(...C({key:`${n}.${e}.map`,value:r,expressionContext:"cluster-map"})),a.push(...C({key:`${n}.${e}.reduce`,value:s,expressionContext:"cluster-reduce"}))}return a;case"video":return E({key:n,value:i,valueSpec:r.source_video,style:s,styleSpec:r});case"image":return E({key:n,value:i,valueSpec:r.source_image,style:s,styleSpec:r});case"canvas":return[new S(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return k({key:`${n}.type`,value:i.type,valueSpec:{values:V(r)},style:s,styleSpec:r})}}function V(e){return e.source.reduce(((t,i)=>{const n=e[i];return"enum"===n.type.type&&(t=t.concat(Object.keys(n.type.values))),t}),[])}function j(t){const i=t.value;let n=[];if(!i)return n;const r=e.i(i);return"string"!==r?(n=n.concat([new S(t.key,i,`string expected, "${r}" found`)]),n):(function(e){const t=-1===e.indexOf("://");try{return new URL(e,t?"http://example.com":void 0),!0}catch(e){return!1}}(i)||(n=n.concat([new S(t.key,i,`invalid url "${i}"`)])),n)}function G(t){const i=t.value,n=t.styleSpec,r=n.light,s=t.style;let o=[];const a=e.i(i);if(void 0===i)return o;if("object"!==a)return o=o.concat([new S("light",i,`object expected, ${a} found`)]),o;for(const e in i){const t=e.match(/^(.*)-transition$/);o=o.concat(t&&r[t[1]]&&r[t[1]].transition?Z({key:e,value:i[e],valueSpec:n.transition,style:s,styleSpec:n}):r[e]?Z({key:e,value:i[e],valueSpec:r[e],style:s,styleSpec:n}):[new S(e,i[e],`unknown property "${e}"`)])}return o}function H(t){const i=t.value;let n=[];if(!i)return n;const r=e.i(i);if("object"!==r)return n=n.concat([new S("light-3d",i,`object expected, ${r} found`)]),n;const s=t.styleSpec,o=s["light-3d"],a=t.key,l=t.style,c=t.style.lights;for(const e of["type","id"])if(!(e in i))return n=n.concat([new S("light-3d",i,`missing property ${e} on light`)]),n;if(i.type&&c)for(let r=0;r<t.arrayIndex;r++){const t=e.u(i.type),s=c[r];e.u(s.type)===t&&n.push(new S(a,i.id,`duplicate light type "${i.type}", previously defined at line ${s.id.__line__}`))}const u=`properties_light_${i.type}`;if(!(u in s))return n=n.concat([new S("light-3d",i,`Invalid light type ${i.type}`)]),n;const h=s[u];for(const r in i)if("properties"===r){const o=i[r],a=e.i(o);if("object"!==a)return n=n.concat([new S("properties",o,`object expected, ${a} found`)]),n;for(const e in o)n=n.concat(h[e]?Z({key:e,value:o[e],valueSpec:h[e],style:l,styleSpec:s}):[new T(t.key,o[e],`unknown property "${e}"`)])}else{const e=r.match(/^(.*)-transition$/);n=n.concat(e&&o[e[1]]&&o[e[1]].transition?Z({key:r,value:i[r],valueSpec:s.transition,style:l,styleSpec:s}):o[r]?Z({key:r,value:i[r],valueSpec:o[r],style:l,styleSpec:s}):[new T(r,i[r],`unknown property "${r}"`)])}return n}function W(t){const i=t.value,n=t.key,r=t.style,s=t.styleSpec,o=s.terrain;let a=[];const l=e.i(i);if(void 0===i)return a;if("null"===l)return a;if("object"!==l)return a=a.concat([new S("terrain",i,`object expected, ${l} found`)]),a;for(const e in i){const t=e.match(/^(.*)-transition$/);a=a.concat(t&&o[t[1]]&&o[t[1]].transition?Z({key:e,value:i[e],valueSpec:s.transition,style:r,styleSpec:s}):o[e]?Z({key:e,value:i[e],valueSpec:o[e],style:r,styleSpec:s}):[new T(e,i[e],`unknown property "${e}"`)])}if(i.source){const t=r.sources&&r.sources[i.source],s=t&&e.u(t.type);t?"raster-dem"!==s&&a.push(new S(n,i.source,`terrain cannot be used with a source of type ${String(s)}, it only be used with a "raster-dem" source type`)):a.push(new S(n,i.source,`source "${i.source}" not found`))}else a.push(new S(n,i,'terrain is missing required property "source"'));return a}function q(t){const i=t.value,n=t.style,r=t.styleSpec,s=r.fog;let o=[];const a=e.i(i);if(void 0===i)return o;if("object"!==a)return o=o.concat([new S("fog",i,`object expected, ${a} found`)]),o;for(const e in i){const t=e.match(/^(.*)-transition$/);o=o.concat(t&&s[t[1]]&&s[t[1]].transition?Z({key:e,value:i[e],valueSpec:r.transition,style:n,styleSpec:r}):s[e]?Z({key:e,value:i[e],valueSpec:s[e],style:n,styleSpec:r}):[new T(e,i[e],`unknown property "${e}"`)])}return o}const $={"*":()=>[],array:M,boolean:function(t){const i=t.value,n=t.key,r=e.i(i);return"boolean"!==r?[new S(n,i,`boolean expected, ${r} found`)]:[]},number:I,color:function(t){const i=t.key,n=t.value,r=e.i(n);return"string"!==r?[new S(i,n,`color expected, ${r} found`)]:null===e.y(n)?[new S(i,n,`color expected, "${n}" found`)]:[]},enum:k,filter:R,function:A,layer:z,object:E,source:U,model:j,light:G,"light-3d":H,terrain:W,fog:q,string:F,formatted:function(e){return 0===F(e).length?[]:C(e)},resolvedImage:function(e){return 0===F(e).length?[]:C(e)},projection:function(t){const i=t.value,n=t.styleSpec,r=n.projection,s=t.style;let o=[];const a=e.i(i);if("object"===a)for(const e in i)o=o.concat(Z({key:e,value:i[e],valueSpec:r[e],style:s,styleSpec:n}));else"string"!==a&&(o=o.concat([new S("projection",i,`object or string expected, ${a} found`)]));return o},import:function(t){const{value:i,styleSpec:n}=t,{data:r,...s}=i;Object.defineProperty(s,"__line__",{value:i.__line__,enumerable:!1});let o=E(e.j({},t,{value:s,valueSpec:n.import}));return""===e.u(s.id)&&o.push(new S(`${t.key}.id`,s,"import id can't be an empty string")),r&&(o=o.concat(Y(r,n,{key:`${t.key}.data`}))),o}};function Z(t,i=!1){const n=t.value,r=t.valueSpec,s=t.styleSpec;if(r.expression&&e.A(e.u(n)))return A(t);if(r.expression&&e.n(e.o(n)))return C(t);if(r.type&&$[r.type]){const n=$[r.type](t);return!0===i&&n.length>0&&"array"===e.i(t.value)?C(t):n}return E(e.j({},t,{valueSpec:r.type?s[r.type]:r}))}function X(e){const t=e.value,i=e.key,n=F(e);return n.length||(-1===t.indexOf("{fontstack}")&&n.push(new S(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&n.push(new S(i,t,'"glyphs" url must include a "{range}" token'))),n}function Y(t,i=e.D,n={}){return Z({key:n.key||"",value:t,valueSpec:i.$root,styleSpec:i,style:t,objectElementValidators:{glyphs:X,"*":()=>[]}})}function K(t,i=e.D){return le(Y(t,i))}const J=e=>le(U(e)),Q=e=>le(G(e)),ee=e=>le(H(e)),te=e=>le(W(e)),ie=e=>le(q(e)),ne=e=>le(z(e)),re=e=>le(R(e)),se=e=>le(O(e)),oe=e=>le(N(e)),ae=e=>le(j(e));function le(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function ce(t,i){let n=!1;if(i&&i.length)for(const r of i)r instanceof T?e.w(r.message):(t.fire(new e.a(new Error(r.message))),n=!0);return n}const ue=new e.F({anchor:new e.G(e.D.light.anchor),position:new e.H(e.D.light.position),color:new e.G(e.D.light.color),intensity:new e.G(e.D.light.intensity)});class he extends e.E{constructor(t,i="flat"){super(),this._transitionable=new e.J(ue),this.setLight(t,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t,i={}){this._validate(Q,e,i)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,n){return(!n||!1!==n.validate)&&ce(this,t.call(K,e.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.D})))}}const de=new e.F({source:new e.G(e.D.terrain.source),exaggeration:new e.G(e.D.terrain.exaggeration)});let pe=class extends e.E{constructor(t,i,n,r){super(),this.scope=n,this._transitionable=new e.J(de,n,r),this._transitionable.setTransitionOrValue(t,r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new e.K(t)).get("exaggeration")}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof e.Z}};const fe=45,me=65,ge=.05;function _e(t,i,n,r){const s=e.O(fe,me,n),[o,a]=ye(t,r);let l=1-Math.min(1,Math.exp((i-o)/(a-o)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*s*t.alpha}function ye(e,t){const i=.5/Math.tan(.5*t);return[e.range[0]+i,e.range[1]+i]}function ve(t,i,n,r,s){const o=e.N.transformMat4([],[i,n,r],s.mercatorFogMatrix);return _e(t,e.N.length(o),s.pitch,s._fov)}function xe(t,i,n,r,s,o,a){const l=[[n,r,0],[s,r,0],[s,o,0],[n,o,0]];let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(const t of l){const n=e.N.transformMat4([],t,i),r=e.N.length(n);c=Math.min(c,r),u=Math.max(u,r)}return[_e(t,c,a.pitch,a._fov),_e(t,u,a.pitch,a._fov)]}const be=new e.F({range:new e.G(e.D.fog.range),color:new e.G(e.D.fog.color),"high-color":new e.G(e.D.fog["high-color"]),"space-color":new e.G(e.D.fog["space-color"]),"horizon-blend":new e.G(e.D.fog["horizon-blend"]),"star-intensity":new e.G(e.D.fog["star-intensity"]),"vertical-range":new e.G(e.D.fog["vertical-range"])});class we extends e.E{constructor(t,i,n,r){super(),this._transitionable=new e.J(be,n,new Map(r)),this.set(t,r),this._transitioning=this._transitionable.untransitioned(),this._transform=i,this.properties=new e.Q(be)}get state(){const t=this._transform,i="globe"===t.projection.name,n=e.S(t.zoom),r=this.properties.get("range"),s=[.5,3];return{range:i?[e.U(s[0],r[0],n),e.U(s[1],r[1],n)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i,n={}){if(this._validate(ie,t,n))return;const r=e.e({},t);for(const t of Object.keys(e.D.fog))void 0===r[t]&&(r[t]=e.D.fog[t].default);this._options=r,this._transitionable.setTransitionOrValue(this._options,i)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.O(fe,me,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(t,i,n){const r=e.L.fromLngLat(i),s=n.elevation?n.elevation.getAtPointOrZero(r):0;return ve(t,r.x,r.y,s,n)}(this.state,t,i):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const i=this._transform.calculateFogTileMatrix(t.toUnwrapped());return xe(this.state,i,0,0,e.V,e.V,this._transform)}getOpacityForBounds(e,t,i,n,r){return this._transform.projection.supportsFog?xe(this.state,e,t,i,n,r,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?ye(this.state,e):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const i=[4,5,6,7];for(const n of i){const i=t.points[n];let r;if(i[2]>=0)r=i;else{const s=t.points[n-4];r=e.W(s,i,s[2]/(s[2]-i[2]))}if(ve(this.state,r[0],r[1],0,this._transform)>=ge)return!0}return!1}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,n){return(!n||!1!==n.validate)&&ce(this,t.call(K,e.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.D})))}}class Se extends e.E{constructor(t,i,n,r){super(),this.scope=n,this._options=t,this.properties=new e.Q(i),this._transitionable=new e.J(i,n,new Map(r)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const Te=new e.F({color:new e.G(e.D.properties_light_ambient.color),intensity:new e.G(e.D.properties_light_ambient.intensity)}),Ee=new e.F({direction:new e.X(e.D.properties_light_directional.direction),color:new e.G(e.D.properties_light_directional.color),intensity:new e.G(e.D.properties_light_directional.intensity),"cast-shadows":new e.G(e.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new e.G(e.D.properties_light_directional["shadow-intensity"])});class Me{constructor(e,t,i,n){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(t,i){let n,r;if(t instanceof e.P||"number"==typeof t[0]){const s=e.P.convert(t);n=[s],r=i.isPointAboveHorizon(s)}else{const s=e.P.convert(t[0]),o=e.P.convert(t[1]);n=[s,o],r=e.Y(s,o).every((e=>i.isPointAboveHorizon(e)))}return new Me(n,i.getCameraPoint(),r,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.Y(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],r=e.Y(i,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<n.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?r[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(r[3]=this.cameraPoint)),e._(r,t)}bufferedCameraGeometryGlobe(t){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],r=e.Y(i,n,t),s=this.cameraPoint.clone();switch(3*((s.y>i.y)+(s.y>n.y))+((s.x>i.x)+(s.x>n.x))){case 0:r[0]=s,r[4]=s.clone();break;case 1:r.splice(1,0,s);break;case 2:r[1]=s;break;case 3:r.splice(4,0,s);break;case 5:r.splice(2,0,s);break;case 6:r[3]=s;break;case 7:r.splice(3,0,s);break;case 8:r[2]=s}return r}containsTile(t,i,n,r=0){const s=t.queryPadding/i._pixelsPerMercatorPixel+1,o=n?this._bufferedCameraMercator(s,i):this._bufferedScreenMercator(s,i);let a=t.tileID.wrap+(o.unwrapped?r:0);const l=o.polygon.map((i=>e.$(t.tileTransform,i,a)));if(!e.a0(l,0,0,e.V,e.V))return;a=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);const c=this.screenGeometryMercator.polygon.map((i=>e.a1(t.tileTransform,i,a))),u=c.map((t=>new e.P(t[0],t[1]))),h=i.getFreeCameraOptions().position||new e.L(0,0,0),d=e.a1(t.tileTransform,h,a),p=c.map((t=>{const i=e.N.sub(t,t,d);return e.N.normalize(i,i),new e.a2(d,i)})),f=e.a3(t,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=e.a4(l),m.min.x=e.aa(m.min.x,0,e.V),m.min.y=e.aa(m.min.y,0,e.V),m.max.x=e.aa(m.max.x,0,e.V),m.max.y=e.aa(m.max.y,0,e.V),m),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:f};var m}_bufferedScreenMercator(e,t){const i=Ce(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let n;return n="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[i]=n,n}}_bufferedCameraMercator(e,t){const i=Ce(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let n;return n="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[i]=n,n}}_projectAndResample(t,i){const n=function(t,i){const n=e.a6.multiply([],i.pixelMatrix,i.globeMatrix),r=[0,-e.ab,0,1],s=[0,e.ab,0,1],o=[0,0,0,1];e.a7.transformMat4(r,r,n),e.a7.transformMat4(s,s,n),e.a7.transformMat4(o,o,n);const a=new e.P(r[0]/r[3],r[1]/r[3]),l=new e.P(s[0]/s[3],s[1]/s[3]),c=e.a8(t,a)&&r[3]<o[3],u=e.a8(t,l)&&s[3]<o[3];if(!c&&!u)return null;const h=function(e,t,i){for(let n=1;n<e.length;n++){const r=Ae(t.pointCoordinate3D(e[n-1]).x),s=Ae(t.pointCoordinate3D(e[n]).x);if(i<0){if(r<s)return{idx:n,t:-r/(s-1-r)}}else if(s<r)return{idx:n,t:(1-r)/(s+1-r)}}return null}(t,i,c?-1:1);if(!h)return null;const{idx:d,t:p}=h;let f=d>1?Ie(t.slice(0,d),i):[],m=d<t.length?Ie(t.slice(d),i):[];f=f.map((t=>new e.P(Ae(t.x),t.y))),m=m.map((t=>new e.P(Ae(t.x),t.y)));const g=[...f];0===g.length&&g.push(m[m.length-1]);const _=e.U(g[g.length-1].y,(0===m.length?f[0]:m[0]).y,p);let y;return y=c?[new e.P(0,_),new e.P(0,0),new e.P(1,0),new e.P(1,_)]:[new e.P(1,_),new e.P(1,1),new e.P(0,1),new e.P(0,_)],g.push(...y),0===m.length?g.push(f[0]):g.push(...m),{polygon:g.map((t=>new e.L(t.x,t.y))),unwrapped:!1}}(t,i);if(n)return n;const r=function(t,i){let n=!1,r=-1/0,s=0;for(let e=0;e<t.length-1;e++)t[e].x>r&&(r=t[e].x,s=e);for(let e=0;e<t.length-1;e++){const i=(s+e)%(t.length-1),r=t[i],o=t[i+1];Math.abs(r.x-o.x)>.5&&(r.x<o.x?(r.x+=1,0===i&&(t[t.length-1].x+=1)):(o.x+=1,i+1===t.length-1&&(t[0].x+=1)),n=!0)}const o=e.a5(i.center.lng);return n&&o<Math.abs(o-1)&&t.forEach((e=>{e.x-=1})),{polygon:t,unwrapped:n}}(Ie(t,i).map((t=>new e.P(Ae(t.x),t.y))),i);return{polygon:r.polygon.map((t=>new e.L(t.x,t.y))),unwrapped:r.unwrapped}}}function Ie(t,i){return e.a9(t,(e=>{const t=i.pointCoordinate3D(e);e.x=t.x,e.y=t.y}),1/256)}function Ae(e){return e<0?1+e%1:e%1}function Ce(e){return 100*e|0}function Pe(t,i,n,r,s){const o=function(n,r){if(n)return s(n);if(r){t.url&&r.tiles&&t.tiles&&delete t.tiles;const n=e.ac(e.e(r,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);r.vector_layers&&(n.vectorLayers=r.vector_layers,n.vectorLayerIds=n.vectorLayers.map((e=>e.id))),r.raster_layers&&(n.rasterLayers=r.raster_layers,n.rasterLayerIds=n.rasterLayers.map((e=>e.id))),n.tiles=i.canonicalizeTileset(n,t.url),s(null,n)}};return t.url?e.g(i.transformRequest(i.normalizeSourceURL(t.url,null,n,r),e.R.Source),o):e.f.frame((()=>o(null,t)))}class ke{constructor(t,i,n){this.bounds=e.ad.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),n=Math.floor(e.a5(this.bounds.getWest())*i),r=Math.floor(e.ae(this.bounds.getNorth())*i),s=Math.ceil(e.a5(this.bounds.getEast())*i),o=Math.ceil(e.ae(this.bounds.getSouth())*i);return t.x>=n&&t.x<s&&t.y>=r&&t.y<o}}class Re extends e.E{constructor(t,i,n,r){if(super(),this.id=t,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.e(this,e.ac(i,["url","scheme","tileSize","promoteId"])),this._options=e.e({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new e.af}load(t){this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=Pe(this._options,this.map._requestManager,i,n,((r,s)=>{this._tileJSONRequest=null,this._loaded=!0,r?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new e.a(r))):s&&(e.e(this,s),s.bounds&&(this.tileBounds=new ke(s.bounds,this.minzoom,this.maxzoom)),e.aj(s.tiles,this.map._requestManager._customAccessToken),this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.ag(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return e.e({},this._options)}loadTile(t,i){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(n,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:e.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(r.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=i:t.request=t.actor.send("reloadTile",r,s.bind(this));else if(t.actor=this._tileWorkers[n]=this._tileWorkers[n]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",r,s.bind(this),void 0,!0);else{const i=e.ah.call({deduped:this._deduped},r,((e,i)=>{e||!i?s.call(this,e):(r.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},t.actor&&t.actor.send("loadTile",r,s.bind(this),void 0,!0))}),!0);t.request={cancel:i}}function s(n,r){return delete t.request,t.aborted?i(null):n&&404!==n.status?i(n):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),e.ai(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Le extends e.E{constructor(t,i,n,r){super(),this.id=t,this.dispatcher=n,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.e({type:"raster"},i),e.e(this,e.ac(i,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"})),this._tileJSONRequest=Pe(this._options,this.map._requestManager,null,null,((i,n)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new e.a(i)):n&&(e.e(this,n),n.bounds&&(this.tileBounds=new ke(n.bounds,this.minzoom,this.maxzoom)),e.aj(n.tiles),this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.ag(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return e.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const n=e.f.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);t.request=e.d(this.map._requestManager.transformRequest(r,e.R.Tile),((n,r,s,o)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):n?(t.state="errored",i(n)):r?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:s,expires:o}),t.setTexture(r,this.map.painter),t.state="loaded",e.ai(this.dispatcher),void i(null)):i(null))))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(t,i){t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class De extends Le{constructor(t,i,n,r){super(t,i,n,r),this.type="raster-array",this.maxzoom=22,this._options=e.e({type:"raster-array"},i)}triggerRepaint(e){const t=this.map.painter._terrain,i=this.map.style.getSourceCache(this.id);t&&t.enabled&&i&&t._clearRenderCacheForTile(i.id,e.tileID),this.map.triggerRepaint()}loadTile(t,i){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),r=this.map._requestManager.transformRequest(n,e.R.Tile);t.requestParams=r,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,((e,n,r,s)=>{if(delete t.request,t.aborted)return t.state="unloaded",i(null);if(e){if(20===e.code)return;return t.state="errored",i(e)}this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:r,expires:s}),t.state="empty",i(null)}))}unloadTile(t){const i=t.texture;i&&i instanceof e.T?(t.destroy(!0),this.map.painter.saveTileTexture(i)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,i,n){t._isHeaderLoaded&&("empty"!==t.state&&(t.state="reloading"),t.fetchBand(i,n,((i,n)=>{if(i)return t.state="errored",this.fire(new e.a(i)),void this.triggerRepaint(t);n&&(t.setTexture(n,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(e){if(!this.rasterLayers)return 0;const t=this.rasterLayers.find((({id:t})=>t===e)),i=t&&t.fields,n=i&&i.bands&&i.bands;return n?n[0]:0}getTextureDescriptor(t,i,n){if(!t)return;const r=i.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!r)return;let s=null;i instanceof e.an?s=i.paint.get("raster-array-band"):i instanceof e.ao&&(s=i.paint.get("raster-particle-array-band"));const o=s||this.getInitialBand(r);if(null!=o)if(t.textureDescriptor){if(!t.updateNeeded(r,o)||n)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,r,o)}}const Oe=32,Ne=33,ze=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,i=0,n=0,r=0,s=0,o=0,a=0;for(1&t?r=s=o=Oe:i=n=a=Oe;(t>>=1)>1;){const e=i+r>>1,l=n+s>>1;1&t?(r=i,s=n,i=o,n=a):(i=r,n=s,r=o,s=a),o=e,a=l}const l=4*e;ze[l+0]=i,ze[l+1]=n,ze[l+2]=r,ze[l+3]=s}const Fe=new Uint16Array(2178),Be=new Uint8Array(1089),Ue=new Uint16Array(1089);function Ve(e){return 0===e?-.03125:32===e?.03125:0}class je{constructor(e,t,i,n){this.id=je.uniqueIdxCounter,je.uniqueIdxCounter++,this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||n||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=je.uniqueIdxCounter,je.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}je.uniqueIdxCounter=0;const Ge={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class He{constructor(e,t,i,n,r,s){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=n,this.instanceCount=s,this.context=e;const o=e.gl;this.buffer=o.createBuffer(),e.bindVertexBuffer.set(this.buffer),o.bufferData(o.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||r||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const n=t.attributes[this.attributes[i].name];void 0!==n&&e.enableVertexAttribArray(n)}}setVertexAttribPointers(e,t,i){for(let n=0;n<this.attributes.length;n++){const r=this.attributes[n],s=t.attributes[r.name];void 0!==s&&e.vertexAttribPointer(s,r.components,e[Ge[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0))}}setVertexAttribDivisor(e,t,i){for(let n=0;n<this.attributes.length;n++){const r=t.attributes[this.attributes[n].name];void 0!==r&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(r,i)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class We{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qe extends We{getDefault(){return e.ax.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class $e extends We{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Ze extends We{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Xe extends We{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ye extends We{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Ke extends We{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Je extends We{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Qe extends We{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class et extends We{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class tt extends We{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class it extends We{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class nt extends We{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class rt extends We{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class st extends We{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ot extends We{getDefault(){return e.ax.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class at extends We{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class lt extends We{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class ct extends We{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ut extends We{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let ht=class extends We{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class dt extends We{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class pt extends We{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ft extends We{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class mt extends We{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class gt extends We{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class _t extends We{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class yt extends We{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class vt extends We{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class xt extends We{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class bt extends We{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class wt extends We{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class St extends We{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class Tt extends St{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Et extends St{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Mt extends St{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class It extends Et{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class At{constructor(e,t,i,n,r){this.context=e,this.width=t,this.height=i;const s=this.framebuffer=e.gl.createFramebuffer();n&&(this.colorAttachment=new Tt(e,s)),r&&(this.depthAttachmentType=r,this.depthAttachment="renderbuffer"===r?new Et(e,s):new Mt(e,s))}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class Ct{constructor(e,t,i){this.func=e,this.mask=t,this.range=i}}Ct.ReadOnly=!1,Ct.ReadWrite=!0,Ct.disabled=new Ct(519,Ct.ReadOnly,[0,1]);const Pt=7680;class kt{constructor(e,t,i,n,r,s){this.test=e,this.ref=t,this.mask=i,this.fail=n,this.depthFail=r,this.pass=s}}kt.disabled=new kt({func:519,mask:0},0,0,Pt,Pt,Pt);const Rt=771;class Lt{constructor(e,t,i,n){this.blendFunction=e,this.blendColor=t,this.mask=i,this.blendEquation=n}}Lt.Replace=[1,0,1,0],Lt.disabled=new Lt(Lt.Replace,e.ax.transparent,[!1,!1,!1,!1]),Lt.unblended=new Lt(Lt.Replace,e.ax.transparent,[!0,!0,!0,!0]),Lt.alphaBlended=new Lt([1,Rt,1,Rt],e.ax.transparent,[!0,!0,!0,!0]),Lt.multiply=new Lt([774,0,774,0],e.ax.transparent,[!0,!0,!0,!0]);const Dt=1029,Ot=2305;class Nt{constructor(e,t,i){this.enable=e,this.mode=t,this.frontFace=i}}Nt.disabled=new Nt(!1,Dt,Ot),Nt.backCCW=new Nt(!0,Dt,Ot),Nt.backCW=new Nt(!0,Dt,2304),Nt.frontCW=new Nt(!0,1028,2304),Nt.frontCCW=new Nt(!0,1028,Ot);class zt{constructor(e,t){this.gl=e,this.clearColor=new qe(this),this.clearDepth=new $e(this),this.clearStencil=new Ze(this),this.colorMask=new Xe(this),this.depthMask=new Ye(this),this.stencilMask=new Ke(this),this.stencilFunc=new Je(this),this.stencilOp=new Qe(this),this.stencilTest=new et(this),this.depthRange=new tt(this),this.depthTest=new it(this),this.depthFunc=new nt(this),this.blend=new rt(this),this.blendFunc=new st(this),this.blendColor=new ot(this),this.blendEquation=new at(this),this.cullFace=new lt(this),this.cullFaceSide=new ct(this),this.frontFace=new ut(this),this.program=new ht(this),this.activeTexture=new dt(this),this.viewport=new pt(this),this.bindFramebuffer=new ft(this),this.bindRenderbuffer=new mt(this),this.bindTexture=new gt(this),this.bindVertexBuffer=new _t(this),this.bindElementBuffer=new yt(this),this.bindVertexArrayOES=new vt(this),this.pixelStoreUnpack=new xt(this),this.pixelStoreUnpackPremultiplyAlpha=new bt(this),this.pixelStoreUnpackFlipY=new wt(this),this.options=t?{...t}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPointSize=e.getParameter(e.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,i){return new je(this,e,t,i)}createVertexBuffer(e,t,i,n,r){return new He(this,e,t,i,n,r)}createRenderbuffer(e,t,i){const n=this.gl,r=n.createRenderbuffer();return this.bindRenderbuffer.set(r),n.renderbufferStorage(n.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),r}createFramebuffer(e,t,i,n){return new At(this,e,t,i,n)}clear({color:e,depth:t,stencil:i,colorMask:n}){const r=this.gl;let s=0;e&&(s|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(n||[!0,!0,!0,!0])),void 0!==t&&(s|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==i&&(s|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(s)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){t(e.blendFunction,Lt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var Ft=e.ay([{name:"a_pos",type:"Float32",components:3}]);class Bt{constructor(t,i,n,r){const s={width:n[0],height:n[1],data:null},o=t.gl;this.targetColorTexture=new e.T(t,s,o.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new e.T(t,s,o.RGBA,{useMipmap:!1}),this.context=t,this.setNumParticles(i,r),this.lastInvalidatedAt=0}setNumParticles(t,i){if(this.numParticles===i)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());const n=new e.az;n.reserve(Math.round(i));const r=e.aA(t.key);for(let e=0;e<i;e++)n.emplaceBack(r(),r(),r());this.particleVertices0=this.context.createVertexBuffer(n,Ft.members,!0),this.particleVertices1=this.context.createVertexBuffer(n,Ft.members,!0),this.particleSegment=e.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=i}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=e.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}const Ut={type:2,extent:e.V,loadGeometry:()=>[[new e.P(0,0),new e.P(e.V+1,0),new e.P(e.V+1,e.V+1),new e.P(0,e.V+1),new e.P(0,0)]]};class Vt{constructor(t,i,n,r,s){this.tileID=t,this.uid=e.aC(),this.uses=0,this.tileSize=i,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=s,r&&r.style&&(this._lastUpdatedBrightness=r.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",r&&r.transform&&(this.projection=r.transform.projection)}registerFadeDuration(t){const i=t+this.timeAdded;i<e.f.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=e.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,n){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(e,t){const i={};if(!t)return i;for(const n of e){const e=n.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){n.layers=e,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)i[t.fqid]=n}}return i}(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.aE){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.aE&&i.hasRTLText){this.hasRTLText=!0,e.aF();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e],n=i.style.getOwnLayer(e);if(!n)continue;const r=n.queryRadius(t);this.queryPadding=Math.max(this.queryPadding,r)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new e.aD}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t)}const i=t.gl,n=this.imageAtlas;if(n&&!n.uploaded){const r=!!Object.keys(n.patternPositions).length;this.imageAtlasTexture=new e.T(t,n.image,i.RGBA,{useMipmap:r}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.T(t,this.glyphAtlasImage,i.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new e.T(t,this.lineAtlas.image,i.R8),this.lineAtlas.uploaded=!0)}prepare(e,t,i){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,i),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const n=t.style.getBrightness();(this._lastUpdatedBrightness||n)&&(this._lastUpdatedBrightness&&n&&Math.abs(this._lastUpdatedBrightness-n)<.001||(this._lastUpdatedBrightness=n,this.updateBuckets(void 0,t)))}queryRenderedFeatures(e,t,i,n,r,s,o,a){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:o,transform:s,params:r,tileTransform:this.tileTransform},e,t,i):{}}querySourceFeatures(t,i){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const r=n.loadVTLayers(),s=i?i.sourceLayer:"",o=r._geojsonTileLayer||r[s];if(!o)return;const a=e.aG(i&&i.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let i=0;i<o.length;i++){const r=o.feature(i);if(a.needGeometry){const t=e.aH(r,!0);if(!a.filter(new e.K(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!a.filter(new e.K(this.tileID.overscaledZ),r))continue;const d=n.getId(r,s),p=new e.aI(r,l,c,u,d);p.tile=h,t.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const i=e.aJ(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(i)if(this.expirationTime<i)t=!0;else{const n=this.expirationTime-i;n?this.expirationTime=e+Math.max(n,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t&&this.updateBuckets(e,t)}updateBuckets(t,i){if(!this.latestFeatureIndex)return;const n=this.latestFeatureIndex.loadVTLayers(),r=i.style.listImages(),s=i.style.getBrightness();for(const o in this.buckets){if(!i.style.hasLayer(o))continue;const a=this.buckets[o],l=a.layers[0].sourceLayer||"_geojsonTileLayer",c=n[l];let u={};if(t&&(u=t[l],!c||!u||0===Object.keys(u).length))continue;if(a.update(u,c,r,this.imageAtlas&&this.imageAtlas.patternPositions||{},s),a instanceof e.aK||a instanceof e.aL){const e=i.style.getOwnSourceCache(a.layers[0].source);i._terrain&&i._terrain.enabled&&e&&a.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(e.id,this.tileID)}const h=i&&i.style&&i.style.getOwnLayer(o);h&&(this.queryPadding=Math.max(this.queryPadding,h.queryRadius(a)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=e.f.now()+t}setTexture(t,i){const n=i.context,r=n.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t,{useMipmap:!0}):(this.texture=new e.T(n,t,r.RGBA,{useMipmap:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE))}setDependencies(e,t){const i={};for(const e of t)i[e]=!0;this.dependencies[e]=i}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const n=e.aM(Ut,this.tileID.canonical,this.tileTransform)[0],r=new e.aN,s=new e.aO;for(let e=0;e<n.length;e++){const{x:t,y:i}=n[e];r.emplaceBack(t,i),s.emplaceBack(e)}s.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(s),this._tileDebugBuffer=t.createVertexBuffer(r,e.aP.members),this._tileDebugSegments=e.aB.simpleSegment(0,0,r.length,s.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const n=e.aM(Ut,this.tileID.canonical,this.tileTransform)[0];let r,s;if(this.isRaster){const t=function(t,i){const n=e.as(t,i),r=Math.pow(2,t.z);for(let s=0;s<Ne;s++)for(let o=0;o<Ne;o++){const a=e.at((t.x+(o+Ve(o))/Oe)/r),l=e.au((t.y+(s+Ve(s))/Oe)/r),c=i.project(a,l),u=s*Ne+o;Fe[2*u+0]=Math.round((c.x*n.scale-n.x)*e.V),Fe[2*u+1]=Math.round((c.y*n.scale-n.y)*e.V)}Be.fill(0),Ue.fill(0);for(let e=2045;e>=0;e--){const t=4*e,i=ze[t+0],n=ze[t+1],r=ze[t+2],s=ze[t+3],o=i+r>>1,a=n+s>>1,l=o+a-n,c=a+i-o,u=n*Ne+i,h=s*Ne+r,d=a*Ne+o,p=Math.hypot((Fe[2*u+0]+Fe[2*h+0])/2-Fe[2*d+0],(Fe[2*u+1]+Fe[2*h+1])/2-Fe[2*d+1])>=16;Be[d]=Be[d]||(p?1:0),e<1022&&(Be[d]=Be[d]||Be[(n+c>>1)*Ne+(i+l>>1)]||Be[(s+c>>1)*Ne+(r+l>>1)])}const s=new e.av,o=new e.aw;let a=0;function l(t,i){const n=i*Ne+t;return 0===Ue[n]&&(s.emplaceBack(Fe[2*n+0],Fe[2*n+1],t*e.V/Oe,i*e.V/Oe),Ue[n]=++a),Ue[n]-1}function c(e,t,i,n,r,s){const a=e+i>>1,u=t+n>>1;if(Math.abs(e-r)+Math.abs(t-s)>1&&Be[u*Ne+a])c(r,s,e,t,a,u),c(i,n,r,s,a,u);else{const a=l(e,t),c=l(i,n),u=l(r,s);o.emplaceBack(a,c,u)}}return c(0,0,Oe,Oe,Oe,0),c(Oe,Oe,0,0,0,Oe),{vertices:s,indices:o}}(this.tileID.canonical,i);r=t.vertices,s=t.indices}else{r=new e.av,s=new e.aw;for(const{x:e,y:t}of n)r.emplaceBack(e,t,0,0);const t=e.aQ(r.int16,void 0,4);for(let e=0;e<t.length;e+=3)s.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(r,e.aR.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(s),this._tileBoundsSegments=e.aB.simpleSegment(0,0,r.length,s.length)}_makeGlobeTileDebugBuffers(t,i){const n=i.projection;if(!n||"globe"!==n.name||i.freezeTileCoverage)return;const r=this.tileID.canonical,s=e.aS(r,i),o=e.aT(s),a=e.S(i.zoom);let l;a>0&&(l=e.a6.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,r,i,o,l,a),this._makeGlobeTileDebugTextBuffer(t,r,i,o,l,a)}_globePoint(t,i,n,r,s,o,a){let l=e.aU(t,i,n);if(o){const s=1<<n.z,c=e.a5(r.center.lng),u=e.ae(r.center.lat),h=(n.x+.5)/s-c;let d=0;h>.5?d=-1:h<-.5&&(d=1);let p=(t/e.V+n.x)/s+d,f=(i/e.V+n.y)/s;p=(p-c)*r._pixelsPerMercatorPixel+c,f=(f-u)*r._pixelsPerMercatorPixel+u;const m=[p*r.worldSize,f*r.worldSize,0];e.N.transformMat4(m,m,o),l=e.aV(l,m,a)}return e.N.transformMat4(l,l,s)}_makeGlobeTileDebugBorderBuffer(t,i,n,r,s,o){const a=new e.aN,l=new e.aO,c=new e.aW,u=(e,t,u,h,d)=>{const p=(u-e)/(d-1),f=(h-t)/(d-1),m=a.length;for(let u=0;u<d;u++){const h=e+u*p,d=t+u*f;a.emplaceBack(h,d);const g=this._globePoint(h,d,i,n,r,s,o);c.emplaceBack(g[0],g[1],g[2]),l.emplaceBack(m+u)}},h=e.V;u(0,0,h,0,16),u(h,0,h,h,16),u(h,h,0,h,16),u(0,h,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(l),this._tileDebugBuffer=t.createVertexBuffer(a,e.aP.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(c,e.aX.members),this._tileDebugSegments=e.aB.simpleSegment(0,0,a.length,l.length)}_makeGlobeTileDebugTextBuffer(t,i,n,r,s,o){const a=e.V/4,l=new e.aN,c=new e.aw,u=new e.aW,h=25;c.reserve(32),l.reserve(h),u.reserve(h);const d=(e,t)=>h*e+t;for(let e=0;e<h;e++){const t=e*a;for(let e=0;e<h;e++){const c=e*a;l.emplaceBack(c,t);const h=this._globePoint(c,t,i,n,r,s,o);u.emplaceBack(h[0],h[1],h[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const i=d(e,t),n=d(e,t+1),r=d(e+1,t),s=d(e+1,t+1);c.emplaceBack(i,n,r),c.emplaceBack(r,n,s)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(c),this._tileDebugTextBuffer=t.createVertexBuffer(l,e.aP.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(u,e.aX.members),this._tileDebugTextSegments=e.aB.simpleSegment(0,0,h,32)}destroy(t=!1){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof e.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const jt={vector:Re,raster:Le,"raster-dem":class extends Le{constructor(t,i,n,r){super(t,i,n,r),this.type="raster-dem",this.maxzoom=22,this._options=e.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(t,i){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(e,n){e&&(t.state="errored",i(e)),n&&(t.dem=n,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",i(null))}t.request=e.d(this.map._requestManager.transformRequest(n,e.R.Tile),function(n,s,o,a){if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(n)t.state="errored",i(n);else if(s){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:a});const i=ImageBitmap&&s instanceof ImageBitmap&&e.ak(),n=1-(s.width-e.al(s.width))/2;n<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=i?s:e.f.getImageData(s,n),c={uid:t.uid,coord:t.tileID,source:this.id,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:n};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",c,r.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const i=t.canonical,n=Math.pow(2,i.z),r=(i.x-1+n)%n,s=0===i.x?t.wrap-1:t.wrap,o=(i.x+1+n)%n,a=i.x+1===n?t.wrap+1:t.wrap,l={};return l[new e.am(t.overscaledZ,s,i.z,r,i.y).key]={backfilled:!1},l[new e.am(t.overscaledZ,a,i.z,o,i.y).key]={backfilled:!1},i.y>0&&(l[new e.am(t.overscaledZ,s,i.z,r,i.y-1).key]={backfilled:!1},l[new e.am(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.am(t.overscaledZ,a,i.z,o,i.y-1).key]={backfilled:!1}),i.y+1<n&&(l[new e.am(t.overscaledZ,s,i.z,r,i.y+1).key]={backfilled:!1},l[new e.am(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.am(t.overscaledZ,a,i.z,o,i.y+1).key]={backfilled:!1}),l}},"raster-array":De,geojson:class extends e.E{constructor(t,i,n,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(r),this._data=i.data,this._options=e.e({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const s=e.V/this.tileSize;this.workerOptions=e.e({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*s,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*s,extent:e.V,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.V,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*s,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,i,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:i},n),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.b("dataloading",{dataType:"source"})),this._loaded=!1;const t=e.e({},this.workerOptions);t.scope=this.scope;const i=this._data;"string"==typeof i?(t.request=this.map._requestManager.transformRequest(e.f.resolveURL(i),e.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((t,i)=>{if(this._loaded=!0,this._pendingLoad=null,t)this.fire(new e.a(t));else{const t={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(t.resourceTiming=i.resourceTiming[this.id]),this.fire(new e.b("data",t)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(t,i){const n=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const r={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:e.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};t.request=this.actor.send(n,r,((e,r)=>(delete t.request,t.destroy(),t.aborted?i(null):e?i(e):(t.loadVectorData(r,this.map.painter,"reloadTile"===n),i(null)))),void 0,"loadTile"===n)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends e.ap{constructor(e,t,i,n){super(e,t,i,n),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const i of t.urls)this.urls.push(this.map._requestManager.transformRequest(i,e.R.Source).url);e.aq(this.urls,((t,i)=>{this._loaded=!0,t?this.fire(new e.a(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.a(new S(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:e.ap,model:class extends e.E{constructor(e,t,i,n){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const t=[];for(const i in this._options.models){const n=this._options.models[i],r=e.l(this.map._requestManager.transformRequest(n.uri,e.R.Model).url).then((t=>{if(!t)return;const r=e.c(t),s=new e.M(i,n.position,n.orientation,r);s.computeBoundsAndApplyParent(),this.models.push(s)})).catch((t=>{this.fire(new e.a(new Error(`Could not load model ${i} from ${n.uri}: ${t.message}`)))}));t.push(r)}return Promise.allSettled(t).then((()=>{this._loaded=!0,this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((t=>{this.fire(new e.a(new Error(`Could not load models: ${t.message}`)))}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends e.E{constructor(e,t,i,n){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(n)}onAdd(e){this.map=e,this.load()}load(t){this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=Pe(this._options,this.map._requestManager,i,n,((r,s)=>{this._tileJSONRequest=null,this._loaded=!0,r?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new e.a(r))):s&&(e.e(this,s),s.bounds&&(this.tileBounds=new ke(s.bounds,this.minzoom,this.maxzoom)),e.aj(s.tiles,this.map._requestManager._customAccessToken),this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)}))}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(t,i){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(n,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=i;else{if(t.buckets){const e=Object.values(t.buckets);for(const t of e)t.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",r,s.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",r,s.bind(this),void 0,!0);function s(e,n){return t.aborted?i(null):e&&404!==e.status?i(e):(n&&(n.resourceTiming&&(t.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(n),t.buckets={...t.buckets,...n.buckets},n.featureIndex&&(t.latestFeatureIndex=n.featureIndex)),t.state="loaded",void i(null))}}serialize(){return e.e({},this._options)}},canvas:class extends e.ap{constructor(t,i,n,r){super(t,i,n,r),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.a(new S(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.a(new S(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.a(new S(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new e.a(new S(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.a(new S(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof e.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.E{constructor(t,i,n,r){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=i,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new e.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ke(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),e.e(this,e.ac(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:i,z:n}=e.canonical;return this._implementation.hasTile({x:t,y:i,z:n})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:i,y:n,z:r}=e.tileID.canonical,s=new AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:i,y:n,z:r},{signal:s.signal})).then(function(i){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===i?(e.state="errored",t(null)):null===i?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(e){return e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof ImageBitmap||e instanceof HTMLImageElement}(i)?(this.loadTileData(e,i),e.state="loaded",void t(null)):(e.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((i=>{20!==i.code&&(e.state="errored",t(i))})),e.request.cancel=()=>s.abort()}loadTileData(e,t){e.setTexture(t,this._map.painter)}unloadTile(t,i){if(t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this._map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:e,y:i,z:n}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:i,z:n})}i()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_clearTiles(){const t=e.ag(this.id,this.scope);this._map.style.clearSource(t)}_update(){this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))}}},Gt=function(t,i,n,r){const s=new jt[i.type](t,i,n,r);if(s.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${s.id}`);return e.aY(["load","abort","unload","serialize","prepare"],s),s};function Ht(t,i){const n=e.a6.identity([]);return e.a6.scale(n,n,[.5*t.width,.5*-t.height,1]),e.a6.translate(n,n,[1,-1,0]),e.a6.multiply(n,n,t.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(n)}function Wt(e,t,i,n,r,s,o,a=!1){const l=e.tilesIn(n,o,a);l.sort($t);const c=[];for(const n of l)c.push({wrappedTileID:n.tile.tileID.wrapped().key,queryResults:n.tile.queryRenderedFeatures(t,i,e._state,n,r,s,Ht(e.transform,n.tile.tileID),a)});const u=function(e){const t={},i={};for(const n of e){const e=n.queryResults,r=n.wrappedTileID,s=i[r]=i[r]||{};for(const i in e){const n=e[i],r=s[i]=s[i]||{},o=t[i]=t[i]||[];for(const e of n)r[e.featureIndex]||(r[e.featureIndex]=!0,o.push(e))}}return t}(c);for(const t in u)u[t].forEach((t=>{const i=t.feature,n=i.layer;n&&"background"!==n.type&&"sky"!==n.type&&"slot"!==n.type&&(i.source=n.source,n["source-layer"]&&(i.sourceLayer=n["source-layer"]),i.state=void 0!==i.id?e.getFeatureState(n["source-layer"],i.id):{})}));return u}function qt(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),n=[],r={};for(let e=0;e<i.length;e++){const s=i[e],o=s.tileID.canonical.key;r[o]||(r[o]=!0,s.querySourceFeatures(n,t))}return n}function $t(e,t){const i=e.tileID,n=t.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}class Zt extends Vt{constructor(e,t,i,n,r){super(e,t,i,n,r),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,i){const n=i.context,r=n.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t,{useMipmap:!1,premultiply:!1}):this.texture=new e.T(n,t,r.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,i){const n=this._mrt=new e.aZ(30),r=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=e.a_(r,((e,r,s,o)=>{if(e)i(e);else try{const e=n.getHeaderLength(r);if(e>t)return void(this.request=this.fetchHeader(e,i));n.parseHeader(r),this._isHeaderLoaded=!0;let a=0;for(const e of Object.values(n.layers))a=Math.max(a,e.dataIndex[e.dataIndex.length-1].last_byte);r.byteLength>=a&&(this.entireBuffer=r),i(null,this.entireBuffer||r,s,o)}catch(e){i(e)}})),this.request}fetchBand(t,i,n){const r=this._mrt;if(!this._isHeaderLoaded||!r)return void n(new Error("Tile header is not ready"));const s=this.actor;if(!s)return void n(new Error("Can't fetch tile band without an actor"));let o;const a=(e,r)=>{o.complete(e,r),e?n(e):(this.updateTextureDescriptor(t,i),n(null,this.textureDescriptor&&this.textureDescriptor.img))},l=(e,t)=>{if(e)return n(e);const i=s.send("decodeRasterArray",{buffer:t,task:o},a,void 0,!0);this._workQueue.push((()=>{i&&i.cancel(),o.cancel()}))},c=r.getLayer(t);if(!c)return void n(new Error(`Unknown sourceLayer "${t}"`));if(c.hasDataForBand(i))return this.updateTextureDescriptor(t,i),void n(null,this.textureDescriptor?this.textureDescriptor.img:null);const u=c.getDataRange([i]);if(o=r.createDecodingTask(u),!o||o.tasks.length)if(this.flushQueues(),this.entireBuffer)l(null,this.entireBuffer.slice(u.firstByte,u.lastByte+1));else{const t=Object.assign({},this.requestParams,{headers:{Range:`bytes=${u.firstByte}-${u.lastByte}`}}),i=e.a_(t,l);this._fetchQueue.push((()=>{i.cancel(),o.cancel()}))}else n(null)}updateNeeded(e,t){return(!this.textureDescriptor||this.textureDescriptor.band!==t||this.textureDescriptor.layer!==e)&&"errored"!==this.state}updateTextureDescriptor(t,i){if(!this._mrt)return;const n=this._mrt.getLayer(t);if(!n||!n.hasBand(i)||!n.hasDataForBand(i))return;const{bytes:r,tileSize:s,buffer:o,offset:a,scale:l}=n.getBandView(i),c=s+2*o,u={data:r,width:c,height:c},h=this.texture;h&&h instanceof e.T&&h.update(u,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:t,band:i,img:u,buffer:o,offset:a,tileSize:s,format:n.pixelFormat,mix:[l,256*l,65536*l,16777216*l]}}}class Xt{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const n=e.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const r={value:t,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout((()=>{this.remove(e,r)}),i)),this.data[n].push(r),this.order.push(n),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,n=void 0===t?0:this.data[i].indexOf(t),r=this.data[i][n];return this.data[i].splice(n,1),r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(r.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const i in this.data)for(const n of this.data[i])e(n.value)||t.push(n);for(const e of t)this.remove(e.value.tileID,e)}}class Yt extends e.E{constructor(e,t,i){super(),this.id=e,this._onlySymbols=i,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new Xt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new x,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("errored"!==t.state&&("loaded"!==t.state||!t.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const i=this._tiles[t];i.upload(e),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return e.a$(this._tiles).map((e=>e.tileID)).sort(Kt).map((e=>e.key))}getRenderableIds(t,i){const n=[];for(const e in this._tiles)this._isIdRenderable(+e,t,i)&&n.push(this._tiles[e]);return t?n.sort(((t,i)=>{const n=t.tileID,r=i.tileID,s=new e.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),o=new e.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-r.overscaledZ||o.y-s.y||o.x-s.x})).map((e=>e.tileID.key)):n.map((e=>e.tileID)).sort(Kt).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(i||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)))}_tileLoaded(t,i,n,r){if(r)if(t.state="errored",404!==r.status)this._source.fire(new e.a(r,{tile:t}));else{if(!(t.tileID.key in this._loadedParentTiles))return void this._source.fire(new e.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=e.f.now(),"expired"===n&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.b("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let n=0;n<t.length;n++){const r=t[n];if(e.neighboringTiles&&e.neighboringTiles[r]){const t=this.getTileByID(r);i(e,t),i(t,e)}}function i(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let i=t.tileID.canonical.x-e.tileID.canonical.x;const n=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),s=t.tileID.key;0===i&&0===n||Math.abs(n)>1||(Math.abs(i)>1&&(1===Math.abs(i+r)?i+=r:1===Math.abs(i-r)&&(i-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,i,n),e.neighboringTiles&&e.neighboringTiles[s]&&(e.neighboringTiles[s].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,i,n){for(const r in this._tiles){let s=this._tiles[r];if(n[r]||!s.hasData()||s.tileID.overscaledZ<=t||s.tileID.overscaledZ>i)continue;let o=s.tileID;for(;s&&s.tileID.overscaledZ>t+1;){const e=s.tileID.scaledTo(s.tileID.overscaledZ-1);s=this._tiles[e.key],s&&s.hasData()&&(o=e)}let a=o;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){n[o.key]=o;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(let i=e.overscaledZ-1;i>=t;i--){const t=e.scaledTo(i),n=this._getLoadedTile(t);if(n)return n}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const i=Math.ceil(e.width/t)+1,n=Math.ceil(e.height/t)+1,r=Math.floor(i*n*5),s="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,r):r,o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,s):s;this._cache.setMaxSize(o)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const i in this._tiles){const n=this._tiles[i];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),e[n.tileID.key]=n}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(t,i,n,r){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!n)return;let s;if(this.updateCacheSize(t,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)s=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new e.am(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)));else if(0!==this.tileCoverLift){const r=t.clone();r.tileCoverLift=this.tileCoverLift,s=r.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&"globe"===t.projection.name&&(s.push(new e.am(1,0,1,0,0)),s.push(new e.am(1,0,1,1,0)),s.push(new e.am(1,0,1,0,1)),s.push(new e.am(1,0,1,1,1)))}else s=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(s=s.filter((e=>this._source.hasTile(e))));else s=[];if(s.length>0&&this.castsShadows&&r&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Jt(this._source.type)){const e=t.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!n}),o=Math.min(e,this._source.maxzoom),a=t.extendTileCoverForShadows(s,r,o);for(const e of a)this._shadowCasterTiles[e.key]=!0,s.push(e)}const o=this._updateRetainedTiles(s);if(Jt(this._source.type)&&0!==s.length){const t={},i={},n=Object.keys(o);for(const r of n){const n=o[r],s=this._tiles[r];if(!s||s.fadeEndTime&&s.fadeEndTime<=e.f.now())continue;const a=this.findLoadedParent(n,Math.max(n.overscaledZ-Yt.maxOverzooming,this._source.minzoom));a&&(this._addTile(a.tileID),t[a.tileID.key]=a.tileID),i[r]=n}const r=s[s.length-1].overscaledZ;for(const e in this._tiles){const t=this._tiles[e];if(o[e]||!t.hasData())continue;let n=t.tileID;for(;n.overscaledZ>r;){n=n.scaledTo(n.overscaledZ-1);const r=this._tiles[n.key];if(r&&r.hasData()&&i[n.key]){o[e]=t.tileID;break}}}for(const e in t)o[e]||(this._coveredTiles[e]=!0,o[e]=t[e])}for(const e in o)this._tiles[e].clearFadeHold();const a=e.b0(this._tiles,o);for(const e of a){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const i={},n=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),r=e[0].overscaledZ,s=Math.max(r-Yt.maxOverzooming,this._source.minzoom),o=Math.max(r+Yt.maxUnderzooming,this._source.minzoom),a={};for(const i of e){const e=this._addTile(i);t[i.key]=i,e.hasData()||n<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,n,o,t);for(const n of e){let e=this._tiles[n.key];if(e.hasData())continue;if(n.canonical.z>=this._source.maxzoom){const e=n.children(this._source.maxzoom)[0],i=this.getTile(e);if(i&&i.hasData()){t[e.key]=e;continue}}else{const e=n.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let r=e.wasRequested();for(let o=n.overscaledZ-1;o>=s;--o){const s=n.scaledTo(o);if(i[s.key])break;if(i[s.key]=!0,e=this.getTile(s),!e&&r&&(e=this._addTile(s)),e&&(t[s.key]=s,r=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let i,n=this._tiles[e].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){i=this._loadedParentTiles[n.key];break}t.push(n.key);const e=n.scaledTo(n.overscaledZ-1);if(i=this._getLoadedTile(e),i)break;n=e}for(const e of t)this._loadedParentTiles[e]=i}}_addTile(t){let i=this._tiles[t.key];if(i)return!0!==i.isExtraShadowCaster||!!this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const n=Boolean(i);if(!n){const e=this.map?this.map.painter:null,n=this._source.tileSize*t.overscaleFactor();i="raster-array"===this._source.type?new Zt(t,n,this.transform.tileZoom,e,this._isRaster):new Vt(t,n,this.transform.tileZoom,e,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,n||this._source.fire(new e.b("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),i))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state||"empty"===t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,n){const r=[],s=this.transform;if(!s)return r;const o="globe"===s.projection.name,a=e.a5(s.center.lng);for(const l in this._tiles){const c=this._tiles[l];if(n&&c.clearQueryDebugViz(),c.holdingForFade())continue;let u;if(o){const t=c.tileID.canonical;if(0===t.z){const i=[Math.abs(e.aa(a,...Qt(t,-1))-a),Math.abs(e.aa(a,...Qt(t,1))-a)];u=[0,2*i.indexOf(Math.min(...i))-1]}else{const i=[Math.abs(e.aa(a,...Qt(t,-1))-a),Math.abs(e.aa(a,...Qt(t,0))-a),Math.abs(e.aa(a,...Qt(t,1))-a)];u=[i.indexOf(Math.min(...i))-1]}}else u=[0];for(const e of u){const n=t.containsTile(c,s,i,e);n&&r.push(n)}}return r}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const i=this.getRenderableIds(e,t).map((e=>this._tiles[e].tileID)),n="globe"===this.transform.projection.name;for(const e of i)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped()),e.expandedProjMatrix=n?this.transform.calculateProjMatrix(e.toUnwrapped(),!1,!0):e.projMatrix;return i}sortCoordinatesByDistance(e){const t=e.slice(),i=this.transform._camera.position,n=this.transform._camera.forward(),r={};for(const e of t){const t=1/(1<<e.canonical.z);r[e.key]=((e.canonical.x+.5)*t+e.wrap-i[0])*n[0]+((e.canonical.y+.5)*t-i[1])*n[1]-i[2]*n[2]}return t.sort(((e,t)=>r[e.key]-r[t.key])),t}hasTransition(){if(this._source.hasTransition())return!0;if(Jt(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=e.f.now())return!0}return!1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i)}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const n=this._tiles[e];n&&n.setDependencies(t,i)}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)))}_preloadTiles(t,i){if(!this._sourceLoaded){const e=()=>{this._sourceLoaded&&(this._source.off("data",e),this._preloadTiles(t,i))};return void this._source.on("data",e)}const n=new Map,r=Array.isArray(t)?t:[t],s=this.map.painter.terrain,o=this.usedForTerrain&&s?s.getScaledDemTileSize():this._source.tileSize;for(const e of r){const t=e.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)n.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}const a=Array.from(n.values());e.b1(a,((e,t)=>{const i=new Vt(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,(e=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),t(e,i)}))}),i)}}function Kt(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),n=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||n-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Jt(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Qt(e,t){const i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}Yt.maxOverzooming=10,Yt.maxUnderzooming=3;class ei{constructor(e){this.style=e,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const e=!1,t=!1;for(const i in this.style._mergedLayers){const n=this.style._mergedLayers[i];if("fill-extrusion"===n.type)this.layers.push({layer:n,visible:e,visibilityChanged:t});else if("model"===n.type){const i=this.style.getLayerSource(n);i&&"batched-model"===i.type&&this.layers.push({layer:n,visible:e,visibilityChanged:t})}}}onNewFrame(e){this.layersGotHidden=!1;for(const t of this.layers){const i=t.layer;let n=!1;"fill-extrusion"===i.type?n=!i.isHidden(e)&&i.paint.get("fill-extrusion-opacity")>0:"model"===i.type&&(n=!i.isHidden(e)&&i.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!n&&t.visible,t.visible=n}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(const e of this.layers){const i=e.layer,n=this.style.getLayerSourceCache(i);let r=1;"fill-extrusion"===i.type&&(r=e.visible?i.paint.get("fill-extrusion-vertical-scale"):0);let s=n?n.getTile(t):null;if(!s&&n&&t.canonical.z>n.getSource().minzoom){let e=t.scaledTo(Math.min(n.getSource().maxzoom,t.overscaledZ-1));for(;e.overscaledZ>=n.getSource().minzoom&&(s=n.getTile(e),!s&&0!==e.overscaledZ);)e=e.scaledTo(e.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:s?s.getBucket(i):null,tileID:s?s.tileID:t,verticalScale:r})}e.hasAnyZOffset=!1;let i=!1;for(let n=0;n<e.symbolInstances.length;n++){const r=e.symbolInstances.get(n),s=r.zOffset,o=this._getHeightAtTileOffset(t,r.tileAnchorX,r.tileAnchorY);r.zOffset=o!==Number.NEGATIVE_INFINITY?o:s,i||s===r.zOffset||(i=!0),e.hasAnyZOffset||0===r.zOffset||(e.hasAnyZOffset=!0)}i&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,i,n,r){let s=i,o=n;if(t.canonical.z!==r.canonical.z){const a=r.canonical,l=1/(1<<t.canonical.z-a.z);s=(i+t.canonical.x*e.V)*l-a.x*e.V|0,o=(n+t.canonical.y*e.V)*l-a.y*e.V|0}return{tileX:s,tileY:o}}_getHeightAtTileOffset(e,t,i){let n,r;for(let s=0;s<this.layers.length;++s){if("fill-extrusion"!==this.layers[s].layer.type)continue;const{bucket:o,tileID:a,verticalScale:l}=this.currentBuildingBuckets[s];if(!o)continue;const{tileX:c,tileY:u}=this._mapCoordToOverlappingTile(e,t,i,a),h=o.getHeightAtTileCoord(c,u);h&&void 0!==h.height&&(h.hidden?n=h.height:r=Math.max(h.height*l,r||0))}if(void 0!==r)return r;for(let r=0;r<this.layers.length;++r){const s=this.layers[r];if("model"!==s.layer.type||!s.visible)continue;const{bucket:o,tileID:a}=this.currentBuildingBuckets[r];if(!o)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,i,a),u=o.getHeightAtTileCoord(l,c);if(u&&!u.hidden)return void 0===u.height&&void 0!==n?Math.min(u.maxHeight,n)*u.verticalScale:(u.height||0)*u.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ti(t,i){const n={};for(const e in t)"ref"!==e&&(n[e]=t[e]);return e.b2.forEach((e=>{e in i&&(n[e]=i[e])})),n}function ii(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=ti(e[i],t[e[i].ref]));return e}const ni={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function ri(e,t,i){i.push({command:ni.addSource,args:[e,t[e]]})}function si(e,t,i){t.push({command:ni.removeSource,args:[e]}),i[e]=!0}function oi(e,t,i,n){si(e,i,n),ri(e,t,i)}function ai(e,i,n){let r;for(r in e[n])if(e[n].hasOwnProperty(r)&&"data"!==r&&!t(e[n][r],i[n][r]))return!1;for(r in i[n])if(i[n].hasOwnProperty(r)&&"data"!==r&&!t(e[n][r],i[n][r]))return!1;return!0}function li(e,i,n,r,s,o){let a;for(a in i=i||{},e=e||{})e.hasOwnProperty(a)&&(t(e[a],i[a])||n.push({command:o,args:[r,a,i[a],s]}));for(a in i)i.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(t(e[a],i[a])||n.push({command:o,args:[r,a,i[a],s]}))}function ci(e){return e.id}function ui(e,t){return e[t.id]=t,e}class hi{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.aa(t,0,1);let i=1,n=this._distances[i];const r=t*this.paddedLength+this.padding;for(;n<r&&i<this._distances.length;)n=this._distances[++i];const s=i-1,o=this._distances[s],a=n-o,l=a>0?(r-o)/a:0;return this.points[s].mult(1-l).add(this.points[i].mult(l))}}class di{constructor(e,t,i){const n=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)n.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,n,r){this._forEachCell(t,i,n,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)}insertCircle(e,t,i,n){this._forEachCell(t-n,i-n,t+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(n)}_insertBoxCell(e,t,i,n,r,s){this.boxCells[r].push(s)}_insertCircleCell(e,t,i,n,r,s){this.circleCells[r].push(s)}_query(e,t,i,n,r,s){if(i<0||e>this.width||n<0||t>this.height)return!r&&[];const o=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=n){if(r)return!0;for(let e=0;e<this.boxKeys.length;e++)o.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],n=this.circles[3*e+2];o.push({key:this.circleKeys[e],x1:t-n,y1:i-n,x2:t+n,y2:i+n})}return s?o.filter(s):o}return this._forEachCell(e,t,i,n,this._queryCell,o,{hitTest:r,seenUids:{box:{},circle:{}}},s),r?o.length>0:o}_queryCircle(e,t,i,n,r){const s=e-i,o=e+i,a=t-i,l=t+i;if(o<0||s>this.width||l<0||a>this.height)return!n&&[];const c=[];return this._forEachCell(s,a,o,l,this._queryCellCircle,c,{hitTest:n,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},r),n?c.length>0:c}query(e,t,i,n,r){return this._query(e,t,i,n,!1,r)}hitTest(e,t,i,n,r){return this._query(e,t,i,n,!0,r)}hitTestCircle(e,t,i,n){return this._queryCircle(e,t,i,!0,n)}_queryCell(e,t,i,n,r,s,o,a){const l=o.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=r[c+2]&&t<=r[c+3]&&i>=r[c+0]&&n>=r[c+1]&&(!a||a(this.boxKeys[u]))){if(o.hitTest)return s.push(!0),!0;s.push({key:this.boxKeys[u],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(r[u],r[u+1],r[u+2],e,t,i,n)&&(!a||a(this.circleKeys[c]))){if(o.hitTest)return s.push(!0),!0;{const e=r[u],t=r[u+1],i=r[u+2];s.push({key:this.circleKeys[c],x1:e-i,y1:t-i,x2:e+i,y2:t+i})}}}}}_queryCellCircle(e,t,i,n,r,s,o,a){const l=o.circle,c=o.seenUids,u=this.boxCells[r];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!a||a(this.boxKeys[t])))return s.push(!0),!0}}const h=this.circleCells[r];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return s.push(!0),!0}}}_forEachCell(e,t,i,n,r,s,o,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(n);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,e,t,i,n,this.xCellCount*l+d,s,o,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,n,r,s){const o=n-e,a=r-t,l=i+s;return l*l>o*o+a*a}_circleAndRectCollide(e,t,i,n,r,s,o){const a=(s-n)/2,l=Math.abs(e-(n+a));if(l>a+i)return!1;const c=(o-r)/2,u=Math.abs(t-(r+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=i*i}}const pi={unknown:0,flipRequired:1,flipNotRequired:2},fi=Math.tan(85*Math.PI/180);function mi(t,i,n,r,s,o,a){const l=e.a6.create();if(n)if("globe"===o.name){const t=e.b3(s,i);e.a6.multiply(l,l,t)}else{const t=e.b4.invert([],a);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],r||e.a6.rotateZ(l,l,s.angle)}else e.a6.multiply(l,s.labelPlaneMatrix,t);return l}function gi(e,t,i,n,r,s,o){const a=mi(e,t,i,n,r,s,o);return"globe"===s.name&&i||(a[2]=a[6]=a[10]=a[14]=0),a}function _i(t,i,n,r,s,o,a){if(n){if("globe"===o.name){const l=mi(t,i,n,r,s,o,a);return e.a6.invert(l,l),e.a6.multiply(l,t,l),l}{const i=e.a6.clone(t),n=e.a6.identity([]);return n[0]=a[0],n[1]=a[1],n[4]=a[2],n[5]=a[3],e.a6.multiply(i,i,n),r||e.a6.rotateZ(i,i,-s.angle),i}}return s.glCoordMatrix}function yi(t,i,n,r){const s=[t,i,n,1];n?e.a7.transformMat4(s,s,r):Ci(s,s,r);const o=s[3];return s[0]/=o,s[1]/=o,s[2]/=o,s}function vi(e,t){return Math.min(.5+e/t*.5,1.5)}function xi(e,t){const i=e[0]/e[3],n=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&n>=-t[1]&&n<=t[1]}function bi(t,i,n,r,s,o,a,l,c,u){const h=n.transform,d=r?t.textSizeData:t.iconSizeData,p=e.b5(d,n.transform.zoom),f="globe"===h.projection.name,m=[256/n.width*2+1,256/n.height*2+1],g=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;g.clear();let _=null;f&&(_=r?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const y=t.lineVertexArray,v=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,x=n.transform.width/n.transform.height;let b,w=!1;for(let r=0;r<v.length;r++){const f=v.get(r),{numGlyphs:S,writingMode:T}=f;if(T!==e.b6.vertical||w||b===e.b6.horizontal||(w=!0),b=T,(f.hidden||T===e.b6.vertical)&&!w){Ai(S,g);continue}w=!1;const E=new e.P(f.tileAnchorX,f.tileAnchorY);let{x:M,y:I,z:A}=h.projection.projectTilePoint(E.x,E.y,u.canonical);if(c){const[e,t,i]=c(E);M+=e,I+=t,A+=i}const C=[M,I,A,1];if(e.a7.transformMat4(C,C,i),!xi(C,m)){Ai(S,g);continue}const P=C[3],k=vi(n.transform.getCameraToCenterDistance(h.projection),P),R=e.b7(d,p,f),L=a?R/k:R*k,D=yi(M,I,A,s);if(D[3]<=0){Ai(S,g);continue}let O={};const N=a?null:c,z=Ti(f,L,!1,l,i,s,o,t.glyphOffsetArray,y,g,_,D,E,O,x,N,h.projection,u,a);w=z.useVertical,N&&z.needsFlipping&&(O={}),(z.notEnoughRoom||w||z.needsFlipping&&Ti(f,L,!0,l,i,s,o,t.glyphOffsetArray,y,g,_,D,E,O,x,N,h.projection,u,a).notEnoughRoom)&&Ai(S,g)}r?(t.text.dynamicLayoutVertexBuffer.updateData(g),_&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(_)):(t.icon.dynamicLayoutVertexBuffer.updateData(g),_&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(_))}function wi(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m){const{lineStartIndex:g,glyphStartIndex:_,segment:y}=a,v=_+a.numGlyphs,x=g+a.lineLength,b=t.getoffsetX(_),w=t.getoffsetX(v-1),S=Ii(e*b,i,n,r,s,o,y,g,x,l,c,u,h,d,!0,p,f,m);if(!S)return null;const T=Ii(e*w,i,n,r,s,o,y,g,x,l,c,u,h,d,!0,p,f,m);return T?{first:S,last:T}:null}function Si(t,i,n,r){return t===e.b6.horizontal&&Math.abs(r)>Math.abs(n)?{useVertical:!0}:t===e.b6.vertical?r>0?{needsFlipping:!0}:null:i!==pi.unknown&&function(e,t){return 0===e||Math.abs(t/e)>fi}(n,r)?i===pi.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function Ti(t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,v){const x=i/24,b=t.lineOffsetX*x,w=t.lineOffsetY*x,{lineStartIndex:S,glyphStartIndex:T,numGlyphs:E,segment:M,writingMode:I,flipState:A}=t,C=S+t.lineLength,P=t=>{if(h){const[i,n,r]=t.up,s=u.length;e.b8(h,s+0,i,n,r),e.b8(h,s+1,i,n,r),e.b8(h,s+2,i,n,r),e.b8(h,s+3,i,n,r)}const[i,n,r]=t.point;e.b9(u,i,n,r,t.angle)};if(E>1){const e=wi(x,l,b,w,n,d,p,t,c,o,f,g,!1,_,y,v);if(!e)return{notEnoughRoom:!0};if(r&&!n){let[i,n,r]=e.first.point,[s,o,l]=e.last.point;[i,n]=yi(i,n,r,a),[s,o]=yi(s,o,l,a);const c=Si(I,A,(s-i)*m,o-n);if(t.flipState=c&&c.needsFlipping?pi.flipRequired:pi.flipNotRequired,c)return c}P(e.first);for(let e=T+1;e<T+E-1;e++){const t=Ii(x*l.getoffsetX(e),b,w,n,d,p,M,S,C,c,o,f,g,!1,!1,_,y,v);if(!t)return u.length-=4*(e-T),{notEnoughRoom:!0};P(t)}P(e.last)}else{if(r&&!n){const i=yi(p.x,p.y,0,s),n=S+M+1,r=new e.P(c.getx(n),c.gety(n)),o=yi(r.x,r.y,0,s),a=o[3]>0?o:Mi(p,r,i,1,s,void 0,_,y.canonical),l=Si(I,A,(a[0]-i[0])*m,a[1]-i[1]);if(t.flipState=l&&l.needsFlipping?pi.flipRequired:pi.flipNotRequired,l)return l}const i=Ii(x*l.getoffsetX(T),b,w,n,d,p,M,S,C,c,o,f,g,!1,!1,_,y,v);if(!i)return{notEnoughRoom:!0};P(i)}return{}}function Ei(e,t,i,n,r){const{x:s,y:o,z:a}=n.projectTilePoint(e.x,e.y,t);if(!r)return yi(s,o,a,i);const[l,c,u]=r(e);return yi(s+l,o+c,a+u,i)}function Mi(t,i,n,r,s,o,a,l){const c=Ei(t.sub(i)._unit()._add(t),l,s,a,o);return e.N.sub(c,n,c),e.N.normalize(c,c),e.N.scaleAndAdd(c,n,c,r)}function Ii(t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y){const v=r?t-i:t+i;let x=v>0?1:-1,b=0;r&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);let w=l+a+(x>0?0:1)|0,S=s,T=s,E=0,M=0;const I=Math.abs(v),A=[],C=[];let P=o,k=P;const R=()=>Mi(k,P,T,I-E+1,h,p,g,_.canonical);for(;E+M<=I;){if(w+=x,w<l||w>=c)return null;if(T=S,k=P,A.push(T),f&&C.push(k),P=new e.P(u.getx(w),u.gety(w)),S=d[w],!S){const e=Ei(P,_.canonical,h,g,p);S=e[3]>0?d[w]=e:R()}E+=M,M=e.N.distance(T,S)}m&&p&&(d[w]&&(S=R(),M=e.N.distance(T,S)),d[w]=S);const L=(I-E)/M,D=P.sub(k)._mult(L)._add(k),O=e.N.sub([],S,T),N=e.N.scaleAndAdd([],T,O,L);let z=[0,0,1],F=O[0],B=O[1];if(y&&(z=g.upVector(_.canonical,D.x,D.y),0!==z[0]||0!==z[1]||1!==z[2])){const t=[z[2],0,-z[0]],i=e.N.cross([],z,t);e.N.normalize(t,t),e.N.normalize(i,i),F=e.N.dot(O,t),B=e.N.dot(O,i)}if(n){const t=e.N.cross([],z,O);e.N.normalize(t,t),e.N.scaleAndAdd(N,N,t,n*x)}const U=b+Math.atan2(B,F);return A.push(N),f&&C.push(D),{point:N,angle:U,path:A,tilePath:C,up:z}}function Ai(e,t){const i=t.length,n=i+4*e;t.resize(n),t.float32.fill(-1/0,4*i,4*n)}function Ci(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[4]*r+i[12],e[1]=i[1]*n+i[5]*r+i[13],e[3]=i[3]*n+i[7]*r+i[15],e}const Pi=100;class ki{constructor(e,t,i=new di(e.width+200,e.height+200,25),n=new di(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=n,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Pi,this.screenBottomBoundary=e.height+Pi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,i,n,r,s,o,a){let l=i.projectedAnchorX,c=i.projectedAnchorY,u=i.projectedAnchorZ;const h=i.elevation,d=i.tileID,p=e.getProjection();if(h&&d){const[e,t,n]=p.upVector(d.canonical,i.tileAnchorX,i.tileAnchorY),r=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*h*r,c+=t*h*r,u+=n*h*r}const f=this.projectAndGetPerspectiveRatio(o,l,c,u,i.tileID,"globe"===p.name||!!h||this.transform.pitch>0,p),m=s*f.perspectiveRatio,g=(i.x1*t+n.x-i.padding)*m+f.point.x,_=(i.y1*t+n.y-i.padding)*m+f.point.y,y=(i.x2*t+n.x+i.padding)*m+f.point.x,v=(i.y2*t+n.y+i.padding)*m+f.point.y,x=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(g,_,y,v)||!r&&this.grid.hitTest(g,_,y,v,a)||x?{box:[],offscreen:!1,occluded:f.occluded}:{box:[g,_,y,v],offscreen:this.isOffscreen(g,_,y,v),occluded:!1}}placeCollisionCircles(t,i,n,r,s,o,a,l,c,u,h,d,p,f,m){const g=[],_=this.transform.elevation,y=t.getProjection(),v=_?_.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,y):null,x=new e.P(n.tileAnchorX,n.tileAnchorY);let{x:b,y:w,z:S}=y.projectTilePoint(x.x,x.y,m.canonical);if(v){const[e,t,i]=v(x);b+=e,w+=t,S+=i}const T="globe"===y.name,E=this.projectAndGetPerspectiveRatio(a,b,w,S,m,T||!!_||this.transform.pitch>0,y),{perspectiveRatio:M}=E,I=(h?o/M:o*M)/e.bc,A=yi(b,w,S,l),C=E.signedDistanceFromCamera>0?wi(I,s,n.lineOffsetX*I,n.lineOffsetY*I,!1,A,x,n,r,l,{},_&&!h?v:null,h&&!!_,y,m,h):null;let P=!1,k=!1,R=!0;if(C&&!E.occluded){const t=.5*p*M+f,n=new e.P(-100,-100),r=new e.P(this.screenRightBoundary,this.screenBottomBoundary),s=new hi,{first:o,last:a}=C,l=o.path.length;let h=[];for(let e=l-1;e>=1;e--)h.push(o.path[e]);for(let e=1;e<a.path.length;e++)h.push(a.path[e]);const m=2.5*t;c&&(h=h.map((([e,t,i],n)=>(v&&!T&&(i=v(n<l-1?o.tilePath[l-1-n]:a.tilePath[n-l+2])[2]),yi(e,t,i,c)))),h.some((e=>e[3]<=0))&&(h=[]));let _=[];if(h.length>0){let t=1/0,i=-1/0,s=1/0,o=-1/0;for(const e of h)t=Math.min(t,e[0]),s=Math.min(s,e[1]),i=Math.max(i,e[0]),o=Math.max(o,e[1]);i>=n.x&&t<=r.x&&o>=n.y&&s<=r.y&&(_=[h.map((t=>new e.P(t[0],t[1])))],(t<n.x||i>r.x||s<n.y||o>r.y)&&(_=e.ba(_,n.x,n.y,r.x,r.y)))}for(const e of _){s.reset(e,.25*t);let n=0;n=s.length<=.5*t?1:Math.ceil(s.paddedLength/m)+1;for(let e=0;e<n;e++){const r=e/Math.max(n-1,1),o=s.lerp(r),a=o.x+Pi,l=o.y+Pi;g.push(a,l,t,0);const c=a-t,h=l-t,p=a+t,f=l+t;if(R=R&&this.isOffscreen(c,h,p,f),k=k||this.isInsideGrid(c,h,p,f),!i&&this.grid.hitTestCircle(a,l,t,d)&&(P=!0,!u))return{circles:[],offscreen:!1,collisionDetected:P,occluded:!1}}}}return{circles:!u&&P||!k?[]:g,offscreen:R,collisionDetected:P,occluded:E.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let n=1/0,r=1/0,s=-1/0,o=-1/0;for(const a of t){const t=new e.P(a.x+Pi,a.y+Pi);n=Math.min(n,t.x),r=Math.min(r,t.y),s=Math.max(s,t.x),o=Math.max(o,t.y),i.push(t)}const a=this.grid.query(n,r,s,o).concat(this.ignoredGrid.query(n,r,s,o)),l={},c={};for(const t of a){const n=t.key;if(void 0===l[n.bucketInstanceId]&&(l[n.bucketInstanceId]={}),l[n.bucketInstanceId][n.featureIndex])continue;const r=[new e.P(t.x1,t.y1),new e.P(t.x2,t.y1),new e.P(t.x2,t.y2),new e.P(t.x1,t.y2)];e.bb(i,r)&&(l[n.bucketInstanceId][n.featureIndex]=!0,void 0===c[n.bucketInstanceId]&&(c[n.bucketInstanceId]=[]),c[n.bucketInstanceId].push(n.featureIndex))}return c}insertCollisionBox(e,t,i,n,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:n,collisionGroupID:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,i,n,r){const s=t?this.ignoredGrid:this.grid,o={bucketInstanceId:i,featureIndex:n,collisionGroupID:r};for(let t=0;t<e.length;t+=4)s.insertCircle(o,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(t,i,n,r,s,o,a){const l=[i,n,r,1];let c=!1;if(r||this.transform.pitch>0){if(e.a7.transformMat4(l,l,t),this.fogState&&s&&"globe"!==a.name){const t=function(t,i,n,r,s,o){const a=o.calculateFogTileMatrix(s),l=[i,n,r];return e.N.transformMat4(l,l,a),_e(t,e.N.length(l),o.pitch,o._fov)}(this.fogState,i,n,r,s.toUnwrapped(),this.transform);c=t>.9}}else Ci(l,l,t);const u=l[3];return{point:new e.P((l[0]/u+1)/2*this.transform.width+Pi,(-l[1]/u+1)/2*this.transform.height+Pi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/u*.5,1.5),signedDistanceFromCamera:u,occluded:o&&l[2]>u||c}}isOffscreen(e,t,i,n){return i<Pi||e>=this.screenRightBoundary||n<Pi||t>this.screenBottomBoundary}isInsideGrid(e,t,i,n){return i>=0&&e<this.gridRightBoundary&&n>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.a6.identity([]);return e.a6.translate(t,t,[-100,-100,0]),t}}function Ri(t,i,n){const r=i.createTileMatrix(t,t.worldSize,n.toUnwrapped());return e.a6.multiply(new Float32Array(16),t.projMatrix,r)}function Li(e,t,i){if(t.projection.name===i.projection.name)return e.projMatrix;const n=i.clone();return n.setProjection(t.projection),Ri(n,t.getProjection(),e)}function Di(e,t,i){return t.name===i.projection.name?e.projMatrix:Ri(i,t,e)}class Oi{constructor(e,t,i,n){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):n&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Ni{constructor(e,t,i,n,r,s=!1){this.text=new Oi(e?e.text:null,t,i,r),this.icon=new Oi(e?e.icon:null,t,n,r),this.clipped=s}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class zi{constructor(e,t,i,n=!1){this.text=e,this.icon=t,this.skipFade=i,this.clipped=n}}class Fi{constructor(){this.invProjMatrix=e.a6.create(),this.viewportMatrix=e.a6.create(),this.circles=[]}}class Bi{constructor(e,t,i,n,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=n,this.tileID=r}}class Ui{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function Vi(t,i,n,r,s){const{horizontalAlign:o,verticalAlign:a}=e.bf(t),l=-(o-.5)*i,c=-(a-.5)*n,u=e.bd(t,r);return new e.P(l+u[0]*s,c+u[1]*s)}function ji(t,i,n,r,s){const o=new e.P(t,i);return n&&o._rotate(r?s:-s),o}class Gi{constructor(e,t,i,n,r,s){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new ki(this.transform,r),this.buildingIndex=s,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Ui(i),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,n,r){const s=n.getBucket(i),o=n.latestFeatureIndex;if(!s||!o||i.fqid!==s.layerIds[0])return;const a=s.layers[0].layout,l=n.collisionBoxArray,c=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),u=n.tileSize/e.V,h=n.tileID.toUnwrapped();this.transform.setProjection(s.projection);const d=(p=n.tileID,f=s.getProjection(),m=this.transform,f.name===this.projection?m.calculateProjMatrix(p.toUnwrapped()):Ri(m,f,p));var p,f,m;const g="map"===a.get("text-pitch-alignment"),_="map"===a.get("text-rotation-alignment");i.compileFilter();const y=i.dynamicFilter(),v=i.dynamicFilterNeedsFeature(),x=this.transform.calculatePixelsToTileUnitsMatrix(n),b=gi(d,n.tileID.canonical,g,_,this.transform,s.getProjection(),x);let w=null;if(g){const t=_i(d,n.tileID.canonical,g,_,this.transform,s.getProjection(),x);w=e.a6.multiply([],this.transform.labelPlaneMatrix,t)}let S=null;y&&n.latestFeatureIndex&&(S={unwrappedTileID:h,dynamicFilter:y,dynamicFilterNeedsFeature:v,featureIndex:n.latestFeatureIndex}),this.retainedQueryData[s.bucketInstanceId]=new Bi(s.bucketInstanceId,o,s.sourceLayerIndex,s.index,n.tileID);const T={bucket:s,layout:a,posMatrix:d,textLabelPlaneMatrix:b,labelToScreenMatrix:w,clippingData:S,scale:c,textPixelRatio:u,holdingForFade:n.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:e.b5(s.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.b5(s.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(s.sourceID)};if(r)for(const e of s.sortKeyRanges){const{sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r}=e;t.push({sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r,parameters:T})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:s.symbolInstances.length,parameters:T})}attemptAnchorPlacement(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_){const{textOffset0:y,textOffset1:v,crossTileID:x}=h,b=[y,v],w=Vi(e,i,n,b,r),S=this.collisionIndex.placeCollisionBox(p,r,t,ji(w.x,w.y,s,o,this.transform.angle),u,a,l,c.predicate);if(m){const e=p.getSymbolInstanceIconSize(_,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,e,m,ji(w.x,w.y,s,o,this.transform.angle),u,a,l,c.predicate).box.length)return}if(S.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[x]&&this.prevPlacement.placements[x]&&this.prevPlacement.placements[x].text&&(t=this.prevPlacement.variableOffsets[x].anchor),this.variableOffsets[x]={textOffset:b,width:i,height:n,anchor:e,textScale:r,prevAnchor:t},this.markUsedJustification(p,e,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[x]=f),{shift:w,placedGlyphBoxes:S}}}placeLayerBucketPart(t,i,n,r){const{bucket:s,layout:o,posMatrix:a,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:u,textPixelRatio:h,holdingForFade:d,collisionBoxArray:p,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:m,collisionGroup:g}=t.parameters,_=o.get("text-optional"),y=o.get("icon-optional"),v=o.get("text-allow-overlap"),x=o.get("icon-allow-overlap"),b="map"===o.get("text-rotation-alignment"),w="map"===o.get("text-pitch-alignment"),S="viewport-y"===o.get("symbol-z-order"),T=o.get("symbol-z-elevate");this.transform.setProjection(s.projection);let E=v&&(x||!s.hasIconData()||y),M=x&&(v||!s.hasTextData()||_);!s.collisionArrays&&p&&s.deserializeCollisionBoxes(p),n&&r&&s.updateCollisionDebugBuffers(this.transform.zoom,p);const I=(t,r,p)=>{const{crossTileID:S,numVerticalGlyphVertices:T}=t;if(u){const n={zoom:this.transform.zoom,pitch:this.transform.pitch};let r=null;if(u.dynamicFilterNeedsFeature){const e=this.retainedQueryData[s.bucketInstanceId];r=u.featureIndex.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(n,r,this.retainedQueryData[s.bucketInstanceId].tileID.canonical,new e.P(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[S]=new zi(!1,!1,!1,!0),void i.add(S)}if(i.has(S))return;if(d)return void(this.placements[S]=new zi(!1,!1,!1));let I=!1,A=!1,C=!0,P=!1,k=!1,R=null,L={box:null,offscreen:null,occluded:null},D={box:null,offscreen:null,occluded:null},O=null,N=null,z=null,F=0,B=0,U=0;p.textFeatureIndex?F=p.textFeatureIndex:t.useRuntimeCollisionCircles&&(F=t.featureIndex),p.verticalTextFeatureIndex&&(B=p.verticalTextFeatureIndex);const V=e=>{e.tileID=this.retainedQueryData[s.bucketInstanceId].tileID;const i=this.transform.elevation;e.elevation=t.zOffset+(i?i.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0)},j=p.textBox;if(j){V(j);const i=i=>{let n=e.b6.horizontal;if(s.allowVerticalPlacement&&!i&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[S];e&&(this.placedOrientations[S]=e,n=e,this.markUsedOrientation(s,n,t))}return n},n=(t,i)=>{if(s.allowVerticalPlacement&&T>0&&p.verticalTextBox){for(const n of s.writingModes)if(n===e.b6.vertical?(L=i(),D=L):L=t(),L&&L.box&&L.box.length)break}else L=t()};if(o.get("text-variable-anchor")){let l=o.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[S]){const e=this.prevPlacement.variableOffsets[S];l.indexOf(e.anchor)>0&&(l=l.filter((t=>t!==e.anchor)),l.unshift(e.anchor))}const c=(e,i,n)=>{const o=s.getSymbolInstanceTextSize(f,t,this.transform.zoom,r),c=(e.x2-e.x1)*o+2*e.padding,u=(e.y2-e.y1)*o+2*e.padding,d=t.hasIconTextFit&&!x?i:null;d&&V(d);let p={box:[],offscreen:!1,occluded:!1};const _=v?2*l.length:l.length;for(let i=0;i<_;++i){const _=this.attemptAnchorPlacement(l[i%l.length],e,c,u,o,b,w,h,a,g,i>=l.length,t,r,s,n,d,f,m);if(_&&(p=_.placedGlyphBoxes,p&&p.box&&p.box.length)){I=!0,R=_.shift;break}}return p};n((()=>c(j,p.iconBox,e.b6.horizontal)),(()=>{const t=p.verticalTextBox;return t&&V(t),s.allowVerticalPlacement&&!(L&&L.box&&L.box.length)&&T>0&&t?c(t,p.verticalIconBox,e.b6.vertical):{box:null,offscreen:null,occluded:null}})),L&&(I=L.box,C=L.offscreen,P=L.occluded);const u=i(!(!L||!L.box));if(!I&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[S];e&&(this.variableOffsets[S]=e,this.markUsedJustification(s,e.anchor,t,u))}}else{const o=(i,n)=>{const o=s.getSymbolInstanceTextSize(f,t,this.transform.zoom,r),l=this.collisionIndex.placeCollisionBox(s,o,i,new e.P(0,0),v,h,a,g.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(s,n,t),this.placedOrientations[S]=n),l};n((()=>o(j,e.b6.horizontal)),(()=>{const t=p.verticalTextBox;return s.allowVerticalPlacement&&T>0&&t?(V(t),o(t,e.b6.vertical)):{box:null,offscreen:null,occluded:null}})),i(!!(L&&L.box&&L.box.length))}}if(O=L,I=O&&O.box&&O.box.length>0,C=O&&O.offscreen,P=O&&O.occluded,t.useRuntimeCollisionCircles){const i=s.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),r=e.b7(s.textSizeData,f,i),u=o.get("text-padding");N=this.collisionIndex.placeCollisionCircles(s,v,i,s.lineVertexArray,s.glyphOffsetArray,r,a,l,c,n,w,g.predicate,t.collisionCircleDiameter*r/e.bc,u,this.retainedQueryData[s.bucketInstanceId].tileID),I=v||N.circles.length>0&&!N.collisionDetected,C=C&&N.offscreen,P=N.occluded}if(p.iconFeatureIndex&&(U=p.iconFeatureIndex),p.iconBox){const i=i=>{V(i);const n=t.hasIconTextFit&&R?ji(R.x,R.y,b,w,this.transform.angle):new e.P(0,0),r=s.getSymbolInstanceIconSize(m,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(s,r,i,n,x,h,a,g.predicate)};D&&D.box&&D.box.length&&p.verticalIconBox?(z=i(p.verticalIconBox),A=z.box.length>0):(z=i(p.iconBox),A=z.box.length>0),C=C&&z.offscreen,k=z.occluded}const G=_||0===t.numHorizontalGlyphVertices&&0===T,H=y||0===t.numIconVertices;if(G||H?H?G||(A=A&&I):I=A&&I:A=I=A&&I,I&&O&&O.box&&this.collisionIndex.insertCollisionBox(O.box,o.get("text-ignore-placement"),s.bucketInstanceId,D&&D.box&&B?B:F,g.ID),A&&z&&this.collisionIndex.insertCollisionBox(z.box,o.get("icon-ignore-placement"),s.bucketInstanceId,U,g.ID),N&&(I&&this.collisionIndex.insertCollisionCircles(N.circles,o.get("text-ignore-placement"),s.bucketInstanceId,F,g.ID),n)){const e=s.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new Fi);for(let e=0;e<N.circles.length;e+=4)t.circles.push(N.circles[e+0]),t.circles.push(N.circles[e+1]),t.circles.push(N.circles[e+2]),t.circles.push(N.collisionDetected?1:0)}const W="globe"!==s.projection.name;E=E&&(W||!P),M=M&&(W||!k),this.placements[S]=new zi(I||E,A||M,C||s.justReloaded),i.add(S)};if(T&&this.buildingIndex&&(this.buildingIndex.updateZOffset(s,this.retainedQueryData[s.bucketInstanceId].tileID),s.updateZOffset()),S){const t=s.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const i=t[e];I(s.symbolInstances.get(i),i,s.collisionArrays[i])}s.hasAnyZOffset&&e.w(`${s.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(s.hasAnyZOffset){const e=s.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const i=e[t];I(s.symbolInstances.get(i),i,s.collisionArrays[i])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)I(s.symbolInstances.get(e),e,s.collisionArrays[e]);if(n&&s.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[s.bucketInstanceId];e.a6.invert(t.invProjMatrix,a),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}s.justReloaded=!1}markUsedJustification(t,i,n,r){const{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l,crossTileID:c}=n,u=e.be(i),h=r===e.b6.vertical?l:"left"===u?s:"center"===u?o:"right"===u?a:-1;s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=h>=0&&s!==h?0:c),o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=h>=0&&o!==h?0:c),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=h>=0&&a!==h?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=h>=0&&l!==h?0:c)}markUsedOrientation(t,i,n){const r=i===e.b6.horizontal||i===e.b6.horizontalOnly?i:0,s=i===e.b6.vertical?i:0,{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=n,u=t.text.placedSymbolArray;o>=0&&(u.get(o).placedOrientation=r),a>=0&&(u.get(a).placedOrientation=r),l>=0&&(u.get(l).placedOrientation=r),c>=0&&(u.get(c).placedOrientation=s)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const n=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},s=t?t.variableOffsets:{},o=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],s=r[e];s?(this.opacities[e]=new Ni(s,n,t.text,t.icon,null,t.clipped),i=i||t.text!==s.text.placed||t.icon!==s.icon.placed):(this.opacities[e]=new Ni(null,n,t.text,t.icon,t.skipFade,t.clipped),i=i||t.text||t.icon)}for(const e in r){const t=r[e];if(!this.opacities[e]){const r=new Ni(t,n,!1,!1);r.isHidden()||(this.opacities[e]=r,i=i||t.text.placed||t.icon.placed)}}for(const e in s)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=s[e]);for(const e in o)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=o[e]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const i=new Set;for(const n of t){const t=n.getBucket(e);t&&n.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,i,n.collisionBoxArray),t.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(t,n.tileID),t.updateZOffset()))}}updateBucketOpacities(t,i,n){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const r=t.layers[0].layout,s=!!t.layers[0].dynamicFilter(),o=new Ni(null,0,!1,!1,!0),a=r.get("text-allow-overlap"),l=r.get("icon-allow-overlap"),c=r.get("text-variable-anchor"),u="map"===r.get("text-rotation-alignment"),h="map"===r.get("text-pitch-alignment"),d=new Ni(null,0,a&&(l||!t.hasIconData()||r.get("icon-optional")),l&&(a||!t.hasTextData()||r.get("text-optional")),!0);!t.collisionArrays&&n&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(n);const p=(e,t,i)=>{for(let n=0;n<t/4;n++)e.opacityVertexArray.emplaceBack(i)};let f=0;for(let n=0;n<t.symbolInstances.length;n++){const r=t.symbolInstances.get(n),{numHorizontalGlyphVertices:a,numVerticalGlyphVertices:l,crossTileID:m,numIconVertices:g}=r,_=i.has(m);let y=this.opacities[m];_?y=o:y||(y=d,this.opacities[m]=y),i.add(m);const v=a>0||l>0,x=g>0,b=this.placedOrientations[m],w=b===e.b6.vertical,S=b===e.b6.horizontal||b===e.b6.horizontalOnly;if(!v&&!x||y.isHidden()||f++,v){const e=Ji(y.text);p(t.text,a,w?Qi:e),p(t.text,l,S?Qi:e);const i=y.text.isHidden(),{leftJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:o,verticalPlacedTextSymbolIndex:c}=r,u=t.text.placedSymbolArray,h=i||w?1:0;n>=0&&(u.get(n).hidden=h),s>=0&&(u.get(s).hidden=h),o>=0&&(u.get(o).hidden=h),c>=0&&(u.get(c).hidden=i||S?1:0);const d=this.variableOffsets[m];d&&this.markUsedJustification(t,d.anchor,r,b);const f=this.placedOrientations[m];f&&(this.markUsedJustification(t,"left",r,f),this.markUsedOrientation(t,f,r))}if(x){const e=Ji(y.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:n}=r,s=t.icon.placedSymbolArray,o=y.icon.isHidden()?1:0;i>=0&&(p(t.icon,g,w?Qi:e),s.get(i).hidden=o),n>=0&&(p(t.icon,r.numVerticalIconVertices,S?Qi:e),s.get(n).hidden=o)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const i=t.collisionArrays[n];if(i){let n=new e.P(0,0),o=!0;if(i.textBox||i.verticalTextBox){if(c){const e=this.variableOffsets[m];e?(n=Vi(e.anchor,e.width,e.height,e.textOffset,e.textScale),u&&n._rotate(h?this.transform.angle:-this.transform.angle)):o=!1}s&&(o=!y.clipped),i.textBox&&Hi(t.textCollisionBox.collisionVertexArray,y.text.placed,!o||w,n.x,n.y),i.verticalTextBox&&Hi(t.textCollisionBox.collisionVertexArray,y.text.placed,!o||S,n.x,n.y)}const a=o&&Boolean(!S&&i.verticalIconBox);i.iconBox&&Hi(t.iconCollisionBox.collisionVertexArray,y.icon.placed,a,r.hasIconTextFit?n.x:0,r.hasIconTextFit?n.y:0),i.verticalIconBox&&Hi(t.iconCollisionBox.collisionVertexArray,y.icon.placed,!a,r.hasIconTextFit?n.x:0,r.hasIconTextFit?n.y:0)}}}if(t.fullyClipped=0===f,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function Hi(e,t,i,n,r){e.emplaceBack(t?1:0,i?1:0,n||0,r||0),e.emplaceBack(t?1:0,i?1:0,n||0,r||0),e.emplaceBack(t?1:0,i?1:0,n||0,r||0),e.emplaceBack(t?1:0,i?1:0,n||0,r||0)}const Wi=Math.pow(2,25),qi=Math.pow(2,24),$i=Math.pow(2,17),Zi=Math.pow(2,16),Xi=Math.pow(2,9),Yi=Math.pow(2,8),Ki=Math.pow(2,1);function Ji(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*Wi+t*qi+i*$i+t*Zi+i*Xi+t*Yi+i*Ki+t}const Qi=0;class en{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,i,n,r){const s=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(s,n,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,s.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<s.length;){const e=s[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,i,0===e.symbolInstanceStart),this._currentPartIndex++,r())return!0}return!1}}class tn{constructor(e,t,i,n,r,s,o,a,l){this.placement=new Gi(e,r,s,o,a,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(t,i,n,r){const s=e.f.now(),o=()=>{const t=e.f.now()-s;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const s=i[t[this._currentPlacementIndex]],a=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=a)&&(!s.maxzoom||s.maxzoom>a)){const t=s,i=t.layout.get("symbol-z-elevate"),a=this._inProgressLayer=this._inProgressLayer||new en(t),l=e.ag(s.source,s.scope);if(a.continuePlacement(i?r[l]:n[l],this.placement,this._showCollisionBoxes,s,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const nn=512/e.V/2;class rn{constructor(t,i,n){this.tileID=t,this.bucketInstanceId=n,this.index=new e.bg(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const r=t.canonical.x*e.V,s=t.canonical.y*e.V;for(let e=0;e<i.length;e++){const{key:t,crossTileID:n,tileAnchorX:o,tileAnchorY:a}=i.get(e),l=Math.floor((r+o)*nn),c=Math.floor((s+a)*nn);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(n)}this.index.finish()}findMatches(t,i,n){const r=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),s=nn/Math.pow(2,i.canonical.z-this.tileID.canonical.z),o=i.canonical.x*e.V,a=i.canonical.y*e.V;for(let e=0;e<t.length;e++){const i=t.get(e);if(i.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=i,h=Math.floor((o+c)*s),d=Math.floor((a+u)*s),p=this.index.range(h-r,d-r,h+r,d+r);for(const e of p){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!n.has(t)){n.add(t),i.crossTileID=t;break}}}}}class sn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class on{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const i=this.indexes[e],n={};for(const e in i){const r=i[e];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),n[r.tileID.key]=r}this.indexes[e]=n}this.lng=e}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const n=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const r=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in r){const s=r[i];s.tileID.isChildOf(e)&&s.findMatches(t.symbolInstances,e,n)}else{const s=r[e.scaledTo(Number(i)).key];s&&s.findMatches(t.symbolInstances,e,n)}}for(let e=0;e<t.symbolInstances.length;e++){const r=t.symbolInstances.get(e);r.crossTileID||(r.crossTileID=i.generate(),n.add(r.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new rn(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i of t.crossTileIDs)this.usedCrossTileIDs[e].delete(i)}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const n=this.indexes[i];for(const r in n)e[n[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[r]),delete n[r],t=!0)}return t}}class an{constructor(){this.layerIndexes={},this.crossTileIDs=new sn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,i,n){let r=this.layerIndexes[e.fqid];void 0===r&&(r=this.layerIndexes[e.fqid]=new on);let s=!1;const o={};"globe"!==n.name&&r.handleWrapJump(i);for(const i of t){const t=i.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(i.tileID,t,this.crossTileIDs)&&(s=!0),o[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(s=!0),s}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}class ln{constructor(e=0,t=0,i=0,n=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=n}interpolate(t,i,n){return null!=i.top&&null!=t.top&&(this.top=e.U(t.top,i.top,n)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.U(t.bottom,i.bottom,n)),null!=i.left&&null!=t.left&&(this.left=e.U(t.left,i.left,n)),null!=i.right&&null!=t.right&&(this.right=e.U(t.right,i.right,n)),this}getCenter(t,i){const n=e.aa((this.left+t-this.right)/2,0,t),r=e.aa((this.top+i-this.bottom)/2,0,i);return new e.P(n,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ln(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function cn(t,i){const n=e.bk(t,3);e.a6.fromQuat(t,i),e.bm(t,3,n)}function un(t,i){const n=e.bi.identity([]);return e.bi.rotateZ(n,n,-i),e.bi.rotateX(n,n,-t),n}function hn(t,i){const n=[t[0],t[1],0],r=[i[0],i[1],0];if(e.N.length(n)>=1e-15){const t=e.N.normalize([],n);e.N.scale(r,t,e.N.dot(r,t)),i[0]=r[0],i[1]=r[1]}const s=e.N.cross([],i,t);if(e.N.len(s)<1e-15)return null;const o=Math.atan2(-s[1],s[0]);return un(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),o)}class dn{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const i=t instanceof e.L?t:new e.L(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=e.bh(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;const n=this.position,r=this._elevation?this._elevation.getAtPointOrZero(e.L.fromLngLat(t)):0,s=e.L.fromLngLat(t,r),o=[s.x-n.x,s.y-n.y,s.z-n.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=hn(o,i)}setPitchBearing(t,i){this.orientation=un(e.bj(t),e.bj(-i))}}class pn{constructor(t,i){this._transform=e.a6.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){const t=this.position;return new e.L(t[0],t[1],t[2])}get position(){const t=e.bk(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&e.bm(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.bi.identity([]),t&&cn(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=un(e,t),cn(this._transform,this._orientation)}forward(){const t=e.bk(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.bk(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.bk(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){const n=new Float64Array(16);return e.a6.invert(n,this.getWorldToCamera(t,i)),n}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,i,n){const r=this.position;e.N.scale(r,r,-t);const s=new Float64Array(16);return e.a6.fromScaling(s,[n,n,n]),e.a6.translate(s,s,r),s[10]*=i,s}getWorldToCamera(t,i){const n=new Float64Array(16),r=new Float64Array(4),s=this.position;return e.bi.conjugate(r,this._orientation),e.N.scale(s,s,-t),e.a6.fromQuat(n,r),e.a6.translate(n,n,s),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=i,n[9]*=i,n[10]*=i,n[11]*=i,n}getCameraToClipPerspective(t,i,n,r){const s=new Float64Array(16);return e.a6.perspective(s,t,i,n,r),s}getCameraToClipOrthographic(t,i,n,r,s,o){const a=new Float64Array(16);return e.a6.ortho(a,t,i,n,r,s,o),a}getDistanceToElevation(t,i=!1){const n=0===t?0:e.bl(t,i?e.au(this.position[1]):this.position[1]),r=this.forward();return(n-this.position[2])/r[2]}clone(){return new pn([...this.position],[...this.orientation])}}const fn=(e,t,i)=>(1-i)*e+i*t,mn=e=>e*e*e*e*e;class gn{constructor(t,i,n,r,s,o,a){this.tileSize=512,this._renderWorldCopies=void 0===s||s,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=null==n?0:n,this._maxPitch=null==r?60:r,this.setProjection(o),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new e.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ln,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new pn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new gn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e,t=!1){const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(e||i)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return e.ac(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=e.bo(this.projectionOptions);const r=!t(n,this.getProjection());return r&&this._calcMatrices(),this.mercatorFromTransition=!1,r}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.bo({name:"mercator"});const i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return e.bh(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const i=-t*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=e.b4.create(),e.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=e.aa(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.bj(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(e){this._tileCoverLift!==e&&(this._tileCoverLift=e)}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let r=0,s=0;for(let o=0;o<i.length;o++){const a=new e.P(i[o][0]*this.width,n+i[o][1]*(this.height-n)),l=t.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*c,s+=c}return 0===s?NaN:r/s}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*t,n=this._mercatorZfromZoom(e),r=this._mercatorZfromZoom(this._maxZoom),s=Math.max(n-i,r);this._setZoom(this._zoomFromMercatorZ(s))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let n;n=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const r=e.N.length(e.N.sub([],this._camera.position,n));return e.aa(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!e.bi.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const n=[t.position.x,t.position.y,t.position.z];e.N.exactEquals(n,this._camera.position)||(this._setCameraPosition(n),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new dn;return i.position=new e.L(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!e.bi.length(t))return!1;e.bi.normalize(t,t);const i=e.N.transformQuat([],[0,0,-1],t),n=e.N.transformQuat([],[0,-1,0],t);if(n[2]<0)return!1;const r=hn(i,n);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;t[2]=e.aa(t[2],r/n,r/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const i=[new e.bp(0,t)];if(this.renderWorldCopies){const n=this.pointCoordinate(new e.P(0,0)),r=this.pointCoordinate(new e.P(this.width,0)),s=this.pointCoordinate(new e.P(this.width,this.height)),o=this.pointCoordinate(new e.P(0,this.height)),a=Math.floor(Math.min(n.x,r.x,s.x,o.x)),l=Math.floor(Math.max(n.x,r.x,s.x,o.x)),c=1;for(let n=a-c;n<=l+c;n++)0!==n&&i.push(new e.bp(n,t))}return i}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,i,n){let r=[];if(0===i[0]&&0===i[1])return r;for(const n of t){const t=n.canonical,s=n.overscaledZ,o=n.wrap,a=1<<t.z,l=t.x+1<a,c=t.x>0,u=t.y+1<a,h=t.y>0,d=n.wrap-(c?0:1),p=n.wrap+(l?0:1),f=c?t.x-1:a-1,m=l?t.x+1:0;i[0]<0?(r.push(new e.am(s,p,t.z,m,t.y)),i[1]<0&&u&&(r.push(new e.am(s,o,t.z,t.x,t.y+1)),r.push(new e.am(s,p,t.z,m,t.y+1))),i[1]>0&&h&&(r.push(new e.am(s,o,t.z,t.x,t.y-1)),r.push(new e.am(s,p,t.z,m,t.y-1)))):i[0]>0?(r.push(new e.am(s,d,t.z,f,t.y)),i[1]<0&&u&&(r.push(new e.am(s,o,t.z,t.x,t.y+1)),r.push(new e.am(s,d,t.z,f,t.y+1))),i[1]>0&&h&&(r.push(new e.am(s,o,t.z,t.x,t.y-1)),r.push(new e.am(s,d,t.z,f,t.y-1)))):i[1]<0&&u?r.push(new e.am(s,o,t.z,t.x,t.y+1)):h&&r.push(new e.am(s,o,t.z,t.x,t.y-1))}if(r.length>1){r.sort(((e,t)=>e.overscaledZ-t.overscaledZ||e.wrap-t.wrap||e.canonical.z-t.canonical.z||e.canonical.x-t.canonical.x||e.canonical.y-t.canonical.y));let e=0,t=0;for(;t<r.length;)r[t].equals(r[e])?++t:r[++e]=r[t++];r.length=e+1}const s=[];for(const e of r)r.some((t=>e.isChildOf(t)))||s.push(e);return r=s.filter((e=>!t.some((t=>!!(e.overscaledZ<n&&t.isChildOf(e))||e.equals(t)||e.isChildOf(t))))),r}coveringTiles(t){let i=this.coveringZoomLevel(t);const n=i,r=this.elevation&&this.elevation.exaggeration(),s=r&&!t.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);const a=this.locationCoordinate(this.center),l=this.center.lat,c=1<<i,u=[c*a.x,c*a.y,0],h="globe"===this.projection.name,d=!h,p=e.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,d),f=h?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),m=c*e.bl(1,this.center.lat),g=this._camera.position[2]/e.bl(1,this.center.lat),_=[c*f.x,c*f.y,g*(d?1:m)],y=h||r,v=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),x=this.isLODDisabled(!0)?i:0;let b;if(this._elevation&&t.isTerrainDEM)b=1e4*this._elevation.exaggeration();else if(this._elevation){const e=this._elevation.getMinMaxForVisibleTiles();b=e?e.max:this._centerAltitude}else b=this._centerAltitude;const w=t.isTerrainDEM?-b:this._elevation?this._elevation.getMinElevationBelowMSL():0,S=this.projection.isReprojectedInTileSpace?e.br(this):1,T=t=>{const i=1/4e4,n=new e.L(t.x+i,t.y,t.z),r=new e.L(t.x,t.y+i,t.z),s=t.toLngLat(),o=n.toLngLat(),a=r.toLngLat(),l=this.locationCoordinate(s),c=this.locationCoordinate(o),u=this.locationCoordinate(a),h=Math.hypot(c.x-l.x,c.y-l.y),d=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*d)*S/i},E=t=>{const i=b,n=w;return{aabb:e.bu(this,c,0,0,0,t,n,i,this.projection),zoom:0,x:0,y:0,minZ:n,maxZ:i,wrap:t,fullyVisible:!1}},M=[];let I=[];const A=i,C=t.reparseOverscaled?n:i,P=e=>e*e,k=P((g-this._centerAltitude)*m),R=e=>{if(!this._elevation||!e.tileID||!o)return;const t=this._elevation.getMinMaxForTile(e.tileID),i=e.aabb;t?(i.min[2]=t.min,i.max[2]=t.max,i.center[2]=(i.min[2]+i.max[2])/2):(e.shouldSplit=L(e),e.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},L=t=>{if(t.zoom<x)return!0;if(t.zoom===A)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const i=t.aabb.distanceX(_),r=t.aabb.distanceY(_);let o=k,a=1;if(h){o=P(t.aabb.distanceZ(_));const i=Math.pow(2,t.zoom),n=e.au((t.y+1)/i),r=e.au(t.y/i),s=Math.min(Math.max(l,n),r),c=e.bJ(s)/e.bJ(l);if(a=s===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,c/this._mercatorScaleRatio),this.zoom<=e.bG&&t.zoom===A-1&&c>=.9)return!0}else if(s&&(o=P(t.aabb.distanceZ(_)*m)),this.projection.isReprojectedInTileSpace&&n<=5){const i=Math.pow(2,t.zoom),n=T(new e.L((t.x+.5)/i,(t.y+.5)/i));a=n>.85?1:n}const c=i*i+r*r+o,u=P((1<<A-t.zoom)*v*a*((e,t)=>{if(t*P(.707)<e)return 1;const i=Math.sqrt(t/e);return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(o,k),c));return c<u};if(this.renderWorldCopies)for(let e=1;e<=3;e++)M.push(E(-e)),M.push(E(e));for(M.push(E(0));M.length>0;){const n=M.pop(),r=n.x,a=n.y;let l=n.fullyVisible;const d=()=>"globe"===this.projection.name&&(0===n.y||n.y===(1<<n.zoom)-1);if(!l){let t=y?n.aabb.intersects(p):n.aabb.intersectsFlat(p);if(0===t&&d()){const i=new e.bs(n.zoom,r,a);t=e.bt(this,c,i,!0).intersects(p)}if(0===t)continue;l=2===t}if(n.zoom!==A&&L(n))for(let t=0;t<4;t++){const i=(r<<1)+t%2,u=(a<<1)+(t>>1),d={aabb:o?n.aabb.quadrant(t):e.bu(this,c,n.zoom+1,i,u,n.wrap,n.minZ,n.maxZ,this.projection),zoom:n.zoom+1,x:i,y:u,wrap:n.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:n.minZ,maxZ:n.maxZ};s&&!h&&(d.tileID=new e.am(n.zoom+1===A?C:n.zoom+1,n.wrap,n.zoom+1,i,u),R(d)),M.push(d)}else{const s=n.zoom===A?C:n.zoom;if(t.minzoom&&t.minzoom>s)continue;if(!l){let t=y?n.aabb.intersectsPrecise(p):n.aabb.intersectsPreciseFlat(p);if(0===t&&d()){const i=new e.bs(n.zoom,r,a);t=e.bt(this,c,i,!0).intersectsPrecise(p)}if(0===t)continue}const o=u[0]-(.5+r+(n.wrap<<n.zoom))*(1<<i-n.zoom),h=u[1]-.5-a,f=n.tileID?n.tileID:new e.am(s,n.wrap,n.zoom,r,a);I.push({tileID:f,distanceSq:o*o+h*h})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,n=this.horizonLineFromTop();I=I.filter((r=>{const s=[0,0,0,1],o=[e.V,e.V,0,1],a=this.calculateFogTileMatrix(r.tileID.toUnwrapped());e.a7.transformMat4(s,s,a),e.a7.transformMat4(o,o,a);const l=e.a7.min([],s,o),c=e.a7.max([],s,o),u=e.bv(l,c);if(0===u)return!0;let h=!1;const d=this._elevation;if(d&&u>i&&0!==n){const i=this.calculateProjMatrix(r.tileID.toUnwrapped());let s;t.isTerrainDEM||(s=d.getMinMaxForTile(r.tileID)),s||(s={min:w,max:b});const o=e.bH(this.rotation),a=[o[0]*e.V,o[1]*e.V,s.max];e.N.transformMat4(a,a,i),h=(1-a[1])*this.height*.5<n}return u<i||h}))}return I.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const i=e.aa(t.lat,-e.bw,e.bw),n=this.projection.project(t.lng,i);return new e.P(n.x*this.worldSize,n.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let n,r;const s=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;n=(i.x-s.x)/e,r=(i.y-s.y)/e}else{const e=this.pointCoordinate(i),t=this.pointCoordinate(s);n=e.x-t.x,r=e.y-t.y}const o=this.locationCoordinate(t);this.setLocation(new e.L(o.x-n,o.y-r))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(t,i){const n=i?e.bl(i,t.lat):void 0,r=this.projection.project(t.lng,t.lat);return new e.L(r.x,r.y,n)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,i){const n=null!=i?i:this._centerAltitude,r=[t.x,t.y,0,1],s=[t.x,t.y,1,1];e.a7.transformMat4(r,r,this.pixelMatrixInverse),e.a7.transformMat4(s,s,this.pixelMatrixInverse);const o=s[3];e.a7.scale(r,r,1/r[3]),e.a7.scale(s,s,1/o);const a=r[2],l=s[2];return{p0:r,p1:s,t:a===l?0:(n-a)/(l-a)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],n=[t.x,t.y,1,1];return e.a7.transformMat4(i,i,this.pixelMatrixInverse),e.a7.transformMat4(n,n,this.pixelMatrixInverse),e.a7.scale(i,i,1/i[3]),e.a7.scale(n,n,1/n[3]),i[2]=e.bl(i[2],this._center.lat)*this.worldSize,n[2]=e.bl(n[2],this._center.lat)*this.worldSize,e.a7.scale(i,i,1/this.worldSize),e.a7.scale(n,n,1/this.worldSize),new e.a2([i[0],i[1],i[2]],e.N.normalize([],e.N.sub([],n,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:n,t:r}=t,s=e.bl(i[2],this._center.lat),o=e.bl(n[2],this._center.lat);return new e.L(e.U(i[0],n[0],r)/this.worldSize,e.U(i[1],n[1],r)/this.worldSize,e.U(s,o,r))}pointCoordinate(e,t=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new e.L(i[0],i[1],i[2]);let n=0,r=this.horizonLineFromTop();if(t.y>r)return this.pointCoordinate(t);const s=.02*r,o=t.clone();for(let t=0;t<10&&r-n>s;t++){o.y=e.U(n,r,.66);const t=this.projection.pointCoordinate3D(this,o.x,o.y);t?(r=o.y,i=t):n=o.y}return i?new e.L(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=e.bx)return!this.isPointAboveHorizon(t);const i=this.pointCoordinate(t);return i.y>=0&&i.y<=1}_coordinatePoint(t,i){const n=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,r=[t.x*this.worldSize,t.y*this.worldSize,n+t.toAltitude(),1];return e.a7.transformMat4(r,r,this.pixelMatrix),r[3]>0?new e.P(r[0]/r[3],r[1]/r[3]):new e.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:i}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,r=this.width-this._edgeInsets.right,s=this.pointLocation3D(new e.P(i,t)),o=this.pointLocation3D(new e.P(r,t)),a=this.pointLocation3D(new e.P(r,n)),l=this.pointLocation3D(new e.P(i,n));let c=Math.min(s.lng,o.lng,a.lng,l.lng),u=Math.max(s.lng,o.lng,a.lng,l.lng),h=Math.min(s.lat,o.lat,a.lat,l.lat),d=Math.max(s.lat,o.lat,a.lat,l.lat);const p=Math.pow(2,-this.zoom)/16*270,f="globe"===this.projection.name?1:4,m=(t,i,n,r,s)=>{const o=(t+n)/2,a=(i+r)/2,l=new e.P(o,a),{lng:g,lat:_}=this.pointLocation3D(l),y=Math.max(0,c-g,h-_,g-u,_-d);c=Math.min(c,g),u=Math.max(u,g),h=Math.min(h,_),d=Math.max(d,_),(s<f||y>p)&&(m(t,i,o,a,s+1),m(o,a,n,r,s+1))};if(m(i,t,r,t,1),m(r,t,r,n,1),m(r,n,i,n,1),m(i,n,i,t,1),"globe"===this.projection.name){const[t,i]=e.by(this);t?(d=90,u=180,c=-180):i&&(h=-90,u=180,c=-180)}return new e.ad(new e.bn(c,h),new e.bn(u,d))}_getBoundsRectangular(t,i){const{top:n,left:r}=this._edgeInsets,s=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,a=new e.P(r,n),l=new e.P(o,n),c=new e.P(o,s),u=new e.P(r,s);let h=this.pointCoordinate(a,t),d=this.pointCoordinate(l,t);const p=this.pointCoordinate(c,i),f=this.pointCoordinate(u,i),m=(e,t)=>(t.y-e.y)/(t.x-e.x);return h.y>1&&d.y>=0?h=new e.L((1-f.y)/m(f,h)+f.x,1):h.y<0&&d.y<=1&&(h=new e.L(-f.y/m(f,h)+f.x,0)),d.y>1&&h.y>=0?d=new e.L((1-p.y)/m(p,d)+p.x,1):d.y<0&&h.y<=1&&(d=new e.L(-p.y/m(p,d)+p.x,0)),(new e.ad).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(p))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const i=t.dem.tree;e.min=Math.min(e.min,i.minimums[0]),e.max=Math.max(e.max,i.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.bw,this.maxLat=e.bw,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.a5(this.minLng)*this.tileSize,this.worldMaxX=e.a5(this.maxLng)*this.tileSize,this.worldMinY=e.ae(this.maxLat)*this.tileSize,this.worldMaxY=e.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const i=t.key,n=this._distanceTileDataCache;if(n[i])return n[i];const r=t.canonical,s=1/this.height,o=this.cameraWorldSize,a=o/this.zoomScale(r.z),l=(r.x+Math.pow(2,r.z)*t.wrap)*a,c=r.y*a,u=this.point;u.x*=o/this.worldSize,u.y*=o/this.worldSize;const h=this.angle,d=Math.sin(-h),p=-Math.cos(-h);return n[i]={bearing:[d,p],center:[(u.x-l)*s,(u.y-c)*s],scale:a/e.V*s},n[i]}calculateFogTileMatrix(t){const i=t.key,n=this._fogTileMatrixCache;if(n[i])return n[i];const r=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.a6.multiply(r,this.worldToFogMatrix,r),n[i]=new Float32Array(r),n[i]}calculateProjMatrix(t,i=!1,n=!1){const r=t.key;let s;if(s=n?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,s[r])return s[r];const o=this.calculatePosMatrix(t,this.worldSize);let a;return a=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,e.a6.multiply(o,a,o),s[r]=new Float32Array(o),s[r]}calculatePixelsToTileUnitsMatrix(t){const i=t.tileID.key,n=this._pixelsToTileUnitsCache;if(n[i])return n[i];const r=e.bz(t,this);return n[i]=r,n[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,i=e.a6.fromScaling([],[t,t,t]);return e.a6.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const i=e.bl(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(i),r=this._camera.forward(),s=e.bl(1,this._center.lat);n[2]/=s,r[2]/=s,e.N.normalize(r,r);const o=t.raycast(n,r,t.exaggeration());if(o){const t=e.N.scaleAndAdd([],n,r,o),i=new e.L(t[0],t[1],e.bl(t[2],e.au(t[1]))),a=(i.z+e.N.length([i.x-n[0],i.y-n[1],i.z-n[2]*s]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const i=this._elevation,n=e.bl(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(n),s=i.getAtPointOrZero(new e.L(...r)),o=this.pixelsPerMeter/this.worldSize*s,a=this._minimumHeightOverTerrain(),l=r[2]-o;if(l<=a)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),i=[r[0],r[1],t.z-r[2]],n=e.N.length(i);i[2]-=(a-l)/this._pixelsPerMercatorPixel;const s=e.N.length(i);if(0===s)return;e.N.scale(i,i,n/s*this._pixelsPerMercatorPixel),this._camera.position=[r[0],r[1],t.z*this._pixelsPerMercatorPixel-i[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const i=this.center;return i.lat=e.aa(i.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(i.lng=e.aa(i.lng,this.minLng,this.maxLng)),this.center=i,void(this._constraining=!1)}const i=this._unmodified,{x:n,y:r}=this.point;let s=0,o=n,a=r;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,h=this.worldMaxY*this.scale;if(r-c<u&&(a=u+c),r+c>h&&(a=h-c),h-u<this.height&&(s=Math.max(s,this.height/(h-u)),a=(h+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,i=this.worldSize/2-(e+t)/2;o=(n+i+this.worldSize)%this.worldSize-i,o-l<e&&(o=e+l),o+l>t&&(o=t-l),t-e<this.width&&(s=Math.max(s,this.width/(t-e)),o=(t+e)/2)}o===n&&a===r||(this.center=this.unproject(new e.P(o,a))),s&&(this.zoom+=this.scaleZoom(s)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i="globe"===this.projection.name,n=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.bl(1,this.center.lat)/e.bl(1,e.bI));const r=e.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,r),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const s="meters"===this.projection.zAxisUnit?n:1,o=this._camera.getWorldToCamera(this.worldSize,s);let a;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,this.isOrthographic){let e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),i=e*this.aspect,n=-i,r=-e;i-=t.x,n-=t.x,e+=t.y,r+=t.y,a=this._camera.getCameraToClipOrthographic(n,i,r,e,this._nearZ,this._farZ),((e,t,i,n)=>{for(let r=0;r<16;r++)e[r]=fn(t[r],i[r],n)})(a,a,l,mn(this.pitch>=15?1:this.pitch/15))}else a=l;const c=e.a6.mul([],l,o);let u=e.a6.mul([],a,o);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),i=e.a6.identity([]);e.a6.translate(i,i,[t.x*this.worldSize,t.y*this.worldSize,0]),e.a6.multiply(i,i,e.bB(this)),e.a6.translate(i,i,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.a6.multiply(u,u,i),e.a6.multiply(c,c,i),this.inverseAdjustmentMatrix=e.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=e.a6.scale([],u,[this.worldSize,this.worldSize,this.worldSize/s,1]),this.projMatrix=u,this.invProjMatrix=e.a6.invert(new Float64Array(16),this.projMatrix),i){const i=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);i[8]=2*-t.x/this.width,i[9]=2*t.y/this.height,this.expandedFarZProjMatrix=e.a6.mul([],i,o)}else this.expandedFarZProjMatrix=this.projMatrix;const h=e.a6.invert([],a);this.frustumCorners=e.bD.fromInvProjectionMatrix(h,this.horizonLineFromTop(),this.height),this.cameraFrustum=e.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const d=new Float32Array(16);e.a6.identity(d),e.a6.scale(d,d,[1,-1,1]),e.a6.rotateX(d,d,this._pitch),e.a6.rotateZ(d,d,this.angle);const p=e.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=e.a6.clone(p);const f=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;p[8]=2*-t.x/this.width,p[9]=2*(t.y+f)/this.height,this.skyboxMatrix=e.a6.multiply(d,p,d);const m=this.point,g=m.x,_=m.y,y=this.width%2/2,v=this.height%2/2,x=Math.cos(this.angle),b=Math.sin(this.angle),w=g-Math.round(g)+x*y+b*v,S=_-Math.round(_)+x*v+b*y,T=new Float64Array(u);if(e.a6.translate(T,T,[w>.5?w-1:w,S>.5?S-1:S,0]),this.alignedProjMatrix=T,u=e.a6.create(),e.a6.scale(u,u,[this.width/2,-this.height/2,1]),e.a6.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=e.a6.create(),e.a6.scale(u,u,[1,-1,1]),e.a6.translate(u,u,[-1,-1,0]),e.a6.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=e.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},u=e.a6.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.bE(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.N.transformMat4(t,t,o),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,n=this._camera.position,r=1/this.height/this._pixelsPerMercatorPixel,s=[t,t,i];e.N.scale(s,s,r),e.N.scale(n,n,-1),e.N.multiply(n,n,s);const o=e.a6.create();e.a6.translate(o,o,n),e.a6.scale(o,o,s),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,r)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),n=this.point,r=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-i[0]*r,n.y/this.worldSize-i[1]*r,e/this.worldSize*this._centerAltitude-i[2]*r]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=this._camera.position[2],r=t[2];let s=1;this.projection.wrap&&(this.center=this.center.wrap()),r>0&&(s=Math.min((i-n)/r,1)),this._camera.position=e.N.scaleAndAdd([],this._camera.position,t,s),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:n,bearing:r}=this._camera.getPitchBearing(),s=e.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.bj(this._maxPitch)),a=Math.max((t[2]-s)/Math.cos(n),o),l=this._zoomFromMercatorZ(a);e.N.scaleAndAdd(t,t,i,a),this._pitch=e.aa(n,e.bj(this.minPitch),e.bj(this.maxPitch)),this.angle=e.bh(r,-Math.PI,Math.PI),this._setZoom(e.aa(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.L(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,n=e.bx,r=0,s=1/0;for(;n-i>1e-6&&n>i;){const e=i+.5*(n-i),o=this.tileSize*Math.pow(2,e),a=this.getCameraToCenterDistance(this.projection,e,o),l=this.scaleZoom(a/(t*this.tileSize)),c=Math.abs(e-l);c<s&&(s=c,r=e),e<l?i=e:n=e}return r}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){const n=Math.min(t.x,i.x),r=Math.max(t.x,i.x),s=Math.min(t.y,i.y),o=Math.max(t.y,i.y);if(s<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new e.P(n,s),new e.P(r,o),new e.P(n,o),new e.P(r,s)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of a){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const i=this.rayIntersectionCoordinate(t);if(i.x<l||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.P(0,0),new e.P(this.width,this.height))}zoomDeltaToMovement(t,i){const n=e.N.length(e.N.sub([],this._camera.position,t)),r=this._zoomFromMercatorZ(n)+i;return n-this._mercatorZfromZoom(r)}getCameraPoint(){if("globe"===this.projection.name){const t=function([t,i,n],r){const s=[t,i,n,1];e.a7.transformMat4(s,s,r);const o=s[3]=Math.max(s[3],1e-6);return s[0]/=o,s[1]/=o,s[2]/=o,s}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}}getCameraToCenterDistance(t,i=this.zoom,n=this.worldSize){const r=e.bA(t,i,this.width,this.height,1024),s=t.pixelSpaceConversion(this.center.lat,n,r);let o=.5/Math.tan(.5*this._fov)*this.height*s;return this.isOrthographic&&(o=fn(1,o,mn(this.pitch>=15?1:this.pitch/15))),o}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.a6.multiply(t,t,this.globeMatrix),t}getFrustum(t){return e.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}const _n={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},yn=(t,i)=>{if(i>0&&t.terrain&&e.w("Cutoff is currently disabled on terrain"),i<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=t.transform,r=Math.max(Math.abs(n._zoom-(t.minCutoffZoom-1)),1),s=n.isLODDisabled(!1)?e.O(60,45,n.pitch):e.O(30,15,n.pitch),o=n._farZ-n._nearZ,a=i*n.height,l=((1-(c=s))*n.cameraToCenterDistance+c*(n._farZ+a))*r;var c;return{shouldRenderCutoff:s<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(l-n._nearZ)/o,(l-a-n._nearZ)/o]}}},vn={cascadeCount:2,shadowMapResolution:2048};class xn{constructor(e,t){this.aabb=e,this.lastCascade=t}}class bn{add(e,t){const i=this.receivers[e.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],t.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],t.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],t.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],t.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],t.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],t.max[2])):this.receivers[e.key]=new xn(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(t,i,n){const r=e.bS.fromPoints(t.points);let s=0;for(const t in this.receivers){const o=this.receivers[t];if(!o)continue;if(!r.intersectsAabb(o.aabb))continue;o.aabb.min=r.closestPoint(o.aabb.min),o.aabb.max=r.closestPoint(o.aabb.max);const a=o.aabb.getCorners();for(let t=0;t<n.length;t++){let r=!0;for(const s of a){const o=[s[0]*i,s[1]*i,s[2]];if(e.N.transformMat4(o,o,n[t].matrix),o[0]<-1||o[0]>1||o[1]<-1||o[1]>1){r=!1;break}}if(o.lastCascade=t,s=Math.max(s,t),r)break}}return s+1}}class wn{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new bn,this._depthMode=new Ct(e.context.gl.LEQUAL,Ct.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,e.tp.registerParameter(vn,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),e.tp.registerParameter(vn,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,i){const n=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const r=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||r<=0)return;if(this._shadowLayerCount=n.style.order.reduce(((e,i)=>{const r=n.style._mergedLayers[i];return e+(r.hasShadowPass()&&!r.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this._enabled)return;const s=n.context,o=vn.shadowMapResolution,a=vn.shadowMapResolution;if(0===this._cascades.length||vn.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let t=0;t<vn.cascadeCount;++t){const t=n._shadowMapDebug,i=s.gl,r=s.createFramebuffer(o,a,t,"texture"),l=new e.T(s,{width:o,height:a,data:null},i.DEPTH_COMPONENT);if(r.depthAttachment.set(l.texture),t){const t=new e.T(s,{width:o,height:a,data:null},i.RGBA);r.colorAttachment.set(t.texture)}this._cascades.push({framebuffer:r,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new e.bq,scale:0})}}this.shadowDirection=Tn(i);let l=0;if(t.elevation){const e=t.elevation,i=[1e4,-1e4];e.visibleDemTiles.filter((e=>e.dem)).forEach((e=>{const t=e.dem.tree;i[0]=Math.min(i[0],t.minimums[0]),i[1]=Math.max(i[1],t.maximums[0])})),1e4!==i[0]&&(l=(i[1]-i[0])*e.exaggeration())}const c=1.5*t.cameraToCenterDistance,u=3*c,h=new Float64Array(16);for(let i=0;i<this._cascades.length;++i){const n=this._cascades[i];let r=t.height/50,s=1;1===vn.cascadeCount?s=u:0===i?s=c:(r=c,s=u);const[o,a]=Mn(t,this.shadowDirection,r,s,vn.shadowMapResolution,l);n.scale=t.scale,n.matrix=o,n.boundingSphereRadius=a,e.a6.invert(h,n.matrix),n.frustum=e.bq.fromInvProjectionMatrix(h,1,0,!0),n.far=s}const d=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[d].far,this._cascades[d].far],this._uniformValues.u_shadow_intensity=r,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/vn.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=vn.shadowMapResolution,this._uniformValues.u_shadowmap_0=_n.ShadowMap0,this._uniformValues.u_shadowmap_1=_n.ShadowMap0+1,this._groundShadowTiles=n.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const p=n.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(p){const i=p.getMinMaxForTile(e);i&&(t=i)}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(t,i){if(!this._enabled)return;const n=this.painter,r=n.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(n.transform.getFrustum(0),n.transform.worldSize,this._cascades),r.viewport.set([0,0,vn.shadowMapResolution,vn.shadowMapResolution]);for(let s=0;s<this._numCascadesToRender;++s){n.currentShadowCascade=s,r.bindFramebuffer.set(this._cascades[s].framebuffer.framebuffer),r.clear({color:e.ax.white,depth:1});for(const e of t.order){const r=t._mergedLayers[e];if(!r.hasShadowPass()||r.isHidden(n.transform.zoom))continue;const s=t.getLayerSourceCache(r),o=s?i[s.id]:void 0;("model"===r.type||o&&o.length)&&n.renderLayer(n,s,r,o)}}n.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const e=this.painter,t=e.style,i=e.context,n=t.directionalLight,r=t.ambientLight;if(!n||!r)return;const s=[],o=yn(e,e.longestCutoffRange);o.shouldRenderCutoff&&s.push("RENDER_CUTOFF");const a=En(n,r),l=new Ct(i.gl.LEQUAL,Ct.ReadOnly,e.depthRangeFor3D);for(const t of this._groundShadowTiles){const n=t.toUnwrapped(),r=e.isTileAffectedByFog(t),c=e.getOrCreateProgram("groundShadow",{defines:s,overrideFog:r});this.setupShadows(n,c),e.uploadCommonUniforms(i,c,n,null,o);const u={u_matrix:e.transform.calculateProjMatrix(n),u_ground_shadow_factor:a};c.draw(e,i.gl.TRIANGLES,l,kt.disabled,Lt.multiply,Nt.disabled,u,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Lt.unblended:Lt.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const i=this.painter.transform,n=i.calculatePosMatrix(t,i.worldSize);return e.a6.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}calculateShadowPassMatrixFromMatrix(t){return e.a6.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,i,n,r=0){if(!this._enabled)return;const s=this.painter.transform,o=this.painter.context,a=o.gl,l=this._uniformValues,c=new Float64Array(16),u=s.calculatePosMatrix(t,s.worldSize);for(let t=0;t<this._cascades.length;t++)e.a6.multiply(c,this._cascades[t].matrix,u),l[0===t?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(c),o.activeTexture.set(a.TEXTURE0+_n.ShadowMap0+t),this._cascades[t].texture.bind(a.NEAREST,a.CLAMP_TO_EDGE);if(this.useNormalOffset=!!n,this.useNormalOffset){const i=e.bR(t.canonical),o=2/s.tileSize*e.V/vn.shadowMapResolution,a=o*this._cascades[0].boundingSphereRadius,c=o*this._cascades[this._cascades.length-1].boundingSphereRadius,u=("vector-tile"===n?1:3)/Math.pow(2,r-t.canonical.z-(1-s.zoom+Math.floor(s.zoom)));l.u_shadow_normal_offset=[i,a*u,c*u],l.u_shadow_bias=[6e-5,.0012,.012]}else l.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(o,l)}setupShadowsFromMatrix(t,i,n=!1){if(!this._enabled)return;const r=this.painter.context,s=r.gl,o=this._uniformValues,a=new Float64Array(16);for(let i=0;i<vn.cascadeCount;i++)e.a6.multiply(a,this._cascades[i].matrix,t),o[0===i?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(a),r.activeTexture.set(s.TEXTURE0+_n.ShadowMap0+i),this._cascades[i].texture.bind(s.NEAREST,s.CLAMP_TO_EDGE);if(this.useNormalOffset=n,n){const e=5;o.u_shadow_normal_offset=[1,e,e],o.u_shadow_bias=[6e-5,.0012,.012]}else o.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(r,o)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,i,n,r){if(r[2]>=0)return{};const s=function(t,i,n){const r=n/(1<<t.canonical.z);return new e.bS([t.canonical.x*r+t.wrap*n,t.canonical.y*r+t.wrap*n,0],[(t.canonical.x+1)*r+t.wrap*n,(t.canonical.y+1)*r+t.wrap*n,i])}(t,i,n).getCorners(),o=i/-r[2];r[0]<0?(e.N.add(s[0],s[0],[r[0]*o,0,0]),e.N.add(s[3],s[3],[r[0]*o,0,0])):r[0]>0&&(e.N.add(s[1],s[1],[r[0]*o,0,0]),e.N.add(s[2],s[2],[r[0]*o,0,0])),r[1]<0?(e.N.add(s[0],s[0],[0,r[1]*o,0]),e.N.add(s[1],s[1],[0,r[1]*o,0])):r[1]>0&&(e.N.add(s[2],s[2],[0,r[1]*o,0]),e.N.add(s[3],s[3],[0,r[1]*o,0]));const a={};return a.vertices=s,a.planes=[Sn(s[1],s[0],s[4]),Sn(s[2],s[1],s[5]),Sn(s[3],s[2],s[6]),Sn(s[0],s[3],s[7])],a}addShadowReceiver(t,i,n){this._receivers.add(t,e.bS.fromTileIdAndHeight(t,i,n))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function Sn(t,i,n){const r=e.N.sub([],n,i),s=e.N.sub([],t,i),o=e.N.cross([],r,s),a=e.N.length(o);return 0===a?[0,0,1,0]:(e.N.scale(o,o,1/a),[o[0],o[1],o[2],-e.N.dot(o,i)])}function Tn(t){const i=t.properties.get("direction"),n=e.bQ(i.x,i.y,i.z);n[2]=e.aa(n[2],0,75);const r=e.bT([n[0],n[1],n[2]]);return e.N.fromValues(r.x,r.y,r.z)}function En(t,i){const n=t.properties.get("color"),r=t.properties.get("intensity"),s=t.properties.get("direction"),o=[s.x,s.y,s.z],a=i.properties.get("color"),l=i.properties.get("intensity"),c=Math.max(e.N.dot([0,0,1],o),0),u=[0,0,0];e.N.scale(u,a.toArray01Linear().slice(0,3),l);const h=[0,0,0];return e.N.scale(h,n.toArray01Linear().slice(0,3),c*r),e.bU([u[0]>0?u[0]/(u[0]+h[0]):0,u[1]>0?u[1]/(u[1]+h[1]):0,u[2]>0?u[2]/(u[2]+h[2]):0])}function Mn(t,i,n,r,s,o){const a=t.zoom,l=t.scale,c=t.worldSize,u=1/c,h=t.aspect,d=Math.sqrt(1+h*h)*Math.tan(.5*t.fovX),p=d*d,f=r-n,m=r+n;let g,_;p>f/m?(g=r,_=r*d):(g=.5*m*(1+p),_=.5*Math.sqrt(f*f+2*(r*r+n*n)*p+m*m*p*p));const y=t.projection.pixelsPerMeter(t.center.lat,c),v=t._camera.getCameraToWorldMercator(),x=[0,0,-g*u];e.N.transformMat4(x,x,v);let b=_*u;const w=t._edgeInsets;if(!(0===w.left&&0===w.top&&0===w.right&&0===w.bottom||w.left===w.right&&w.top===w.bottom)){const i=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?y:1),s=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,n,r);s[8]=2*-t.centerOffset.x/t.width,s[9]=2*t.centerOffset.y/t.height;const o=new Float64Array(16);e.a6.mul(o,s,i);const u=new Float64Array(16);e.a6.invert(u,o);const h=e.bq.fromInvProjectionMatrix(u,c,a,!0);for(const i of h.points){const n=((S=i)[0]/=l,S[1]/=l,S[2]=e.bl(S[2],t._center.lat),S);b=Math.max(b,e.N.len(e.N.subtract([],x,n)))}}var S;b*=s/(s-1);const T=Math.acos(i[2]),E=Math.atan2(-i[0],-i[1]),M=new pn;M.position=x,M.setPitchBearing(T,E);const I=M.getWorldToCamera(c,y),A=b*c,C=Math.min(t._mercatorZfromZoom(17)*c*-2,-2*A),P=M.getCameraToClipOrthographic(-A,A,-A,A,C,(A+o*y)/i[2]),k=new Float64Array(16);e.a6.multiply(k,P,I);const R=e.N.fromValues(Math.floor(1e6*x[0])/1e6*c,Math.floor(1e6*x[1])/1e6*c,0),L=.5*s,D=[0,0,0];e.N.transformMat4(D,R,k),e.N.scale(D,D,L);const O=[Math.floor(D[0]),Math.floor(D[1]),Math.floor(D[2])],N=[0,0,0];e.N.sub(N,D,O),e.N.scale(N,N,-1/L);const z=new Float64Array(16);return e.a6.identity(z),e.a6.translate(z,z,N),e.a6.multiply(k,z,k),[k,A]}const In=(e,t)=>ce(e,t&&t.filter((e=>"source.canvas"!==e.identifier))),An=e.ac(ni,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Cn=e.ac(ni,["setCenter","setZoom","setBearing","setPitch"]),Pn={version:8,layers:[],sources:{}},kn={duration:300,delay:0},Rn=new Set(["fill","line","background","hillshade","raster"]);class Ln extends e.E{constructor(t,i={}){super(),this.map=t,this.scope=i.scope||"",this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=e.e({},kn),this._buildingIndex=new ei(this),this.crossTileSymbolIndex=new an,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new y,this.dispatcher=i.dispatcher?i.dispatcher:new e.bW(e.bX(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new w,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new e.bY(t._requestManager,i.localFontFamily?e.bZ.all:i.localIdeographFontFamily?e.bZ.ideographs:e.bZ.none,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new v(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=i.configOptions?i.configOptions:new Map,this._configDependentLayers=i.configDependentLayers?i.configDependentLayers:new Set,this._config=i.config,this.dispatcher.broadcast("setReferrer",e.b_());const n=this;this._rtlTextPluginCallback=Ln.registerForPluginStateChange((t=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,i)=>{if(e.b$(t),i&&i.every((e=>e)))for(const e in n._sourceCaches){const t=n._sourceCaches[e],i=t.getSource().type;"vector"!==i&&"geojson"!==i||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){const i=this._layers[e];i.source===t.id&&this._validateLayer(i)}}))}loadURL(t,i={}){this.fire(new e.b("dataloading",{dataType:"style"}));const n="boolean"==typeof i.validate?i.validate:!e.c0(t);t=this.map._requestManager.normalizeStyleURL(t,i.accessToken),this.resolvedImports.add(t);const r=this.importsCache.get(t);if(r)return this._load(r,n);const s=this.map._requestManager.transformRequest(t,e.R.Style);this._request=e.g(s,((i,r)=>{if(this._request=null,i)this.fire(new e.a(i));else if(r)return this.importsCache.set(t,r),this._load(r,n)}))}loadJSON(t,i={}){this.fire(new e.b("dataloading",{dataType:"style"})),this._request=e.f.frame((()=>{this._request=null,this._load(t,!1!==i.validate)}))}loadEmpty(){this.fire(new e.b("dataloading",{dataType:"style"})),this._load(Pn,!1)}_loadImports(t,i,n){if(this.importDepth>=4)return e.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const r=[];for(const e of t){const t=this._createFragmentStyle(e),s=new Promise((e=>{t.once("style.import.load",e),t.once("error",e)})).then((()=>this.mergeAll()));if(r.push(s),this.resolvedImports.has(e.url)){t.loadEmpty();continue}const o=e.data||this.importsCache.get(e.url);o?t.loadJSON(o,{validate:i}):e.url?t.loadURL(e.url,{validate:i}):t.loadEmpty();const a={style:t,id:e.id,config:e.config};if(n){const e=this.fragments.findIndex((({id:e})=>e===n));this.fragments=this.fragments.slice(0,e).concat(a).concat(this.fragments.slice(e))}else this.fragments.push(a)}return Promise.allSettled(r)}_createFragmentStyle(t){const i=this.scope?e.ag(t.id,this.scope):t.id,n=new Ln(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:t.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return n.setEventedParent(this.map,{style:n}),n}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const t=this.isRootStyle();this._shouldPrecompile=t,this.fire(new e.b(t?"style.load":"style.import.load"))}_load(t,i){const n=t.schema;if(this.isRootStyle()&&(t.fragment||n&&!1!==t.fragment)){const n=e.e({},Pn,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(n,i)}if(this.setConfig(this._config,n),i&&In(this,K(t)))return;this._loaded=!0,this.stylesheet=e.c1(t);for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const r=ii(this.stylesheet.layers);if(this._order=r.map((e=>e.id)),this.stylesheet.light&&e.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new he(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new he(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const t of r){const i=e.c2(t,this.scope,this.options);i.isConfigDependent&&this._configDependentLayers.add(i.fqid),i.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i,this._serializedLayers[i.id]=i.serialize();const n=this.getOwnLayerSourceCache(i),r=!!this.directionalLight&&this.directionalLight.shadowsEnabled();n&&i.canCastShadows()&&r&&(n.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const s=this.stylesheet.terrain;s&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=e.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?e.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(s,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new e.b("data",{dataType:"style"})),t.imports?this._loadImports(t.imports,i).then((()=>this._reloadImports())):this._reloadImports()}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,i,n,r,s,o,a,l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((e=>{if(e.stylesheet){if(null!=e.light&&(t=e.light),e.stylesheet.lights)for(const t of e.stylesheet.lights)"ambient"===t.type&&null!=e.ambientLight&&(i=e.ambientLight),"directional"===t.type&&null!=e.directionalLight&&(n=e.directionalLight);r=this._prioritizeTerrain(r,e.terrain,e.stylesheet.terrain),e.stylesheet.fog&&null!=e.fog&&(s=e.fog),null!=e.stylesheet.camera&&(l=e.stylesheet.camera),null!=e.stylesheet.projection&&(o=e.stylesheet.projection),null!=e.stylesheet.transition&&(a=e.stylesheet.transition)}})),this.light=t,this.ambientLight=i,this.directionalLight=n,this.fog=s,null===r?delete this.terrain:this.terrain=r,this.camera=l||{"camera-projection":"perspective"},this.projection=o||{name:"mercator"},this.transition=e.e({},kn,a),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const t=i=>{for(const e of i.fragments)t(e.style);e(i)};t(this)}_prioritizeTerrain(e,t,i){const n=e&&0===e.drapeRenderMode;return null===i?t&&0===t.drapeRenderMode?t:n?e:null:null!=t&&(!e||n||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((t=>{e=this._prioritizeTerrain(e,t.terrain,t.stylesheet.terrain)})),null===e?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle((t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)})),this.projection=e||{name:"mercator"}}mergeSources(){const t={},i={},n={};this.forEachFragmentStyle((r=>{for(const i in r._sourceCaches){const n=e.ag(i,r.scope);t[n]=r._sourceCaches[i]}for(const t in r._otherSourceCaches){const n=e.ag(t,r.scope);i[n]=r._otherSourceCaches[t]}for(const t in r._symbolSourceCaches){const i=e.ag(t,r.scope);n[i]=r._symbolSourceCaches[t]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=n}mergeLayers(){const t={},i=[],n={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((n=>{for(const r of n._order){const s=n._layers[r];if("slot"===s.type){const i=e.c3(r);if(t[i])continue;t[i]=[]}s.slot&&t[s.slot]?t[s.slot].push(s):i.push(s)}})),this._mergedOrder=[];const r=(i=[])=>{for(const s of i)if("slot"===s.type){const i=e.c3(s.id);t[i]&&r(t[i])}else{const t=e.ag(s.id,s.scope);this._mergedOrder.push(t),n[t]=s,s.is3D()&&(this._has3DLayers=!0),"circle"===s.type&&(this._hasCircleLayers=!0),"symbol"===s.type&&(this._hasSymbolLayers=!0)}};r(i),this._mergedLayers=n,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=e.e({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(t,i,n){let r,s,o;const a=e.f.devicePixelRatio>1?"@2x":"";let l=e.g(i.transformRequest(i.normalizeSpriteURL(t,a,".json"),e.R.SpriteJSON),((e,t)=>{l=null,o||(o=e,r=t,u())})),c=e.d(i.transformRequest(i.normalizeSpriteURL(t,a,".png"),e.R.SpriteImage),((e,t)=>{c=null,o||(o=e,s=t,u())}));function u(){if(o)n(o);else if(r&&s){const t=e.f.getImageData(s),i={};for(const n in r){const{width:s,height:o,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=r[n],f=new e.h({width:s,height:o});e.h.copy(t,f,{x:a,y:l},{x:0,y:0},{width:s,height:o}),i[n]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p}}n(null,i)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.a(t));else if(i)for(const e in i)this.imageManager.addImage(e,this.scope,i[e]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.b("data",{dataType:"style"}))}))}_validateLayer(t){const i=this.getOwnSource(t.source);if(!i)return;const n=t.sourceLayer;n&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(n))&&this.fire(new e.a(new Error(`Source layer "${n}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((e,t)=>{const i=this.fragments[t];return i&&i.style&&(e.data=i.style.serialize()),e}))}_serializeSources(){const e={};for(const t in this._sourceCaches){const i=this._sourceCaches[t].getSource();e[i.id]||(e[i.id]=i.serialize())}return e}_serializeLayers(e){const t=[];for(const i of e){const e=this._layers[i];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped(this.getLayerSourceCache(e)):Rn.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const i=this.getOwnLayer(t);if(i)return i;this.fire(new e.a(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const i=this.getOwnSource(t);if(i)return i;this.fire(new e.a(new Error(`The source '${t}' does not exist in the map's style.`)))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const i=this.calculateLightsBrightness();t.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));const n=this._changes.isDirty();if(this._changes.isDirty()){const e=this._changes.getLayerUpdatesByScope();for(const t in e){const{updatedIds:i,removedIds:n}=e[t];(i||n)&&this._updateWorkerLayers(t,i,n)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const r={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];r[e]=t.used,t.used=!1,t.tileCoverLift=0}for(const e of this._mergedOrder){const i=this._mergedLayers[e];if(i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)){const e=this.getLayerSourceCache(i);e&&(e.used=!0,e.tileCoverLift=Math.max(e.tileCoverLift,i.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let e=i.minzoom||0;e<(i.maxzoom||25.5);e++){const e=this.map.painter;if(e){const n=i.getProgramIds();if(!n)continue;for(const r of n){const n=i.getDefaultProgramParams(r,t.zoom);n&&(e.style=this,this.fog&&(e._fogVisible=!0,n.overrideFog=!0,e.getOrCreateProgram(r,n)),e._fogVisible=!1,n.overrideFog=!1,e.getOrCreateProgram(r,n),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(n.overrideRtt=!0,e.getOrCreateProgram(r,n)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const t in r){const i=this._mergedSourceCaches[t];r[t]!==i.used&&i.getSource().fire(new e.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),n&&this.fire(new e.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=this._changes.getUpdatedImages();if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changes.resetUpdatedImages()}}_updateWorkerLayers(e,t,i){const n=this.getFragmentStyle(e);n&&this.dispatcher.broadcast("updateLayers",{layers:t?n._serializeLayers(t):[],scope:e,removedIds:i||[],options:n.options})}setState(i){if(this._checkLoaded(),In(this,K(i)))return!1;(i=e.c1(i)).layers=ii(i.layers);const n=function(e,i){if(!e)return[{command:ni.setStyle,args:[i]}];let n=[];try{if(!t(e.version,i.version))return[{command:ni.setStyle,args:[i]}];t(e.center,i.center)||n.push({command:ni.setCenter,args:[i.center]}),t(e.zoom,i.zoom)||n.push({command:ni.setZoom,args:[i.zoom]}),t(e.bearing,i.bearing)||n.push({command:ni.setBearing,args:[i.bearing]}),t(e.pitch,i.pitch)||n.push({command:ni.setPitch,args:[i.pitch]}),t(e.sprite,i.sprite)||n.push({command:ni.setSprite,args:[i.sprite]}),t(e.glyphs,i.glyphs)||n.push({command:ni.setGlyphs,args:[i.glyphs]}),t(e.imports,i.imports)||function(e=[],i=[],n){i=i||[];const r=(e=e||[]).map(ci),s=i.map(ci),o=e.reduce(ui,{}),a=i.reduce(ui,{}),l=r.slice();let c,u,h,d;for(c=0,u=0;c<r.length;c++)h=r[c],a.hasOwnProperty(h)?u++:(n.push({command:ni.removeImport,args:[h]}),l.splice(l.indexOf(h,u),1));for(c=0,u=0;c<s.length;c++)h=s[s.length-1-c],l[l.length-1-c]!==h&&(o.hasOwnProperty(h)?(n.push({command:ni.removeImport,args:[h]}),l.splice(l.lastIndexOf(h,l.length-u),1)):u++,d=l[l.length-c],n.push({command:ni.addImport,args:[a[h],d]}),l.splice(l.length-c,0,h));for(const e of i){const i=o[e.id];i&&!t(i,e)&&n.push({command:ni.updateImport,args:[e.id,e]})}}(e.imports,i.imports,n),t(e.transition,i.transition)||n.push({command:ni.setTransition,args:[i.transition]}),t(e.light,i.light)||n.push({command:ni.setLight,args:[i.light]}),t(e.fog,i.fog)||n.push({command:ni.setFog,args:[i.fog]}),t(e.projection,i.projection)||n.push({command:ni.setProjection,args:[i.projection]}),t(e.lights,i.lights)||n.push({command:ni.setLights,args:[i.lights]}),t(e.camera,i.camera)||n.push({command:ni.setCamera,args:[i.camera]});const r={},s=[];!function(e,i,n,r){let s;for(s in i=i||{},e=e||{})e.hasOwnProperty(s)&&(i.hasOwnProperty(s)||si(s,n,r));for(s in i){if(!i.hasOwnProperty(s))continue;const o=i[s];e.hasOwnProperty(s)?t(e[s],o)||("geojson"===e[s].type&&"geojson"===o.type&&ai(e,i,s)?n.push({command:ni.setGeoJSONSourceData,args:[s,o.data]}):oi(s,i,n,r)):ri(s,i,n)}}(e.sources,i.sources,s,r);const o=[];e.layers&&e.layers.forEach((e=>{e.source&&r[e.source]?n.push({command:ni.removeLayer,args:[e.id]}):o.push(e)}));let a=e.terrain;a&&r[a.source]&&(n.push({command:ni.setTerrain,args:[void 0]}),a=void 0),n=n.concat(s),t(a,i.terrain)||n.push({command:ni.setTerrain,args:[i.terrain]}),function(e,i,n){i=i||[];const r=(e=e||[]).map(ci),s=i.map(ci),o=e.reduce(ui,{}),a=i.reduce(ui,{}),l=r.slice(),c=Object.create(null);let u,h,d,p,f,m,g;for(u=0,h=0;u<r.length;u++)d=r[u],a.hasOwnProperty(d)?h++:(n.push({command:ni.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<s.length;u++)d=s[s.length-1-u],l[l.length-1-u]!==d&&(o.hasOwnProperty(d)?(n.push({command:ni.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-u],n.push({command:ni.addLayer,args:[a[d],m]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<s.length;u++)if(d=s[u],p=o[d],f=a[d],!c[d]&&!t(p,f))if(t(p.source,f.source)&&t(p["source-layer"],f["source-layer"])&&t(p.type,f.type)){for(g in li(p.layout,f.layout,n,d,null,ni.setLayoutProperty),li(p.paint,f.paint,n,d,null,ni.setPaintProperty),t(p.slot,f.slot)||n.push({command:ni.setSlot,args:[d,f.slot]}),t(p.filter,f.filter)||n.push({command:ni.setFilter,args:[d,f.filter]}),t(p.minzoom,f.minzoom)&&t(p.maxzoom,f.maxzoom)||n.push({command:ni.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?li(p[g],f[g],n,d,g.slice(6),ni.setPaintProperty):t(p[g],f[g])||n.push({command:ni.setLayerProperty,args:[d,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?li(p[g],f[g],n,d,g.slice(6),ni.setPaintProperty):t(p[g],f[g])||n.push({command:ni.setLayerProperty,args:[d,g,f[g]]}))}else n.push({command:ni.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],n.push({command:ni.addLayer,args:[f,m]})}(o,i.layers,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:ni.setStyle,args:[i]}]}return n}(this.serialize(),i).filter((e=>!(e.command in Cn)));if(0===n.length)return!1;const r=n.filter((e=>!(e.command in An)));if(r.length>0)throw new Error(`Unimplemented: ${r.map((e=>e.command)).join(", ")}.`);return n.forEach((e=>{this[e.command].apply(this,e.args)})),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,i){return this.getImage(t)?this.fire(new e.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,i),this._afterImageUpdated(t),this)}updateImage(e,t){this.imageManager.updateImage(e,this.scope,t)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new e.a(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new e.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,t,i={}){return this._checkLoaded(),this._validate(ae,`models.${e}`,t,null,i)||(this.modelManager.addModel(e,t,this.scope),this._changes.setDirty()),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new e.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,i,n={}){if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error(`There is already a source with ID "${t}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(J,`sources.${t}`,i,null,n))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const r=Gt(t,i,this.dispatcher,this);r.scope=this.scope,r.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(r.id),source:r.serialize(),sourceId:r.id})));const s=t=>{const i=(t?"symbol:":"other:")+r.id,n=e.ag(i,this.scope),s=this._sourceCaches[i]=new Yt(n,r,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[r.id]=s,s.onAdd(this.map)};s(!1),"vector"!==i.type&&"geojson"!==i.type||s(!0),r.onAdd&&r.onAdd(this.map),n.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const i=this.getOwnSource(t);if(!i)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.a(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new e.a(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const n=this.getOwnSourceCaches(t);for(const t of n){const i=e.c3(t.id);delete this._sourceCaches[i],this._changes.discardSourceCacheUpdate(t.id),t.fire(new e.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:t.getSource().id})),t.setEventedParent(null),t.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty()}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const i=this.getOwnSourceCache(t);i&&e.push(i.getSource())}return e}areTilesLoaded(){const e=this._mergedSourceCaches;for(const t in e){const i=e[t]._tiles;for(const e in i){const t=i[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const e of t){if(this._validate(ee,"lights",e))return;switch(e.type){case"ambient":if(this.ambientLight){const t=this.ambientLight;t.set(e),t.updateTransitions(i)}else this.ambientLight=new Se(e,Te,this.scope,this.options);break;case"directional":if(this.directionalLight){const t=this.directionalLight;t.set(e),t.updateTransitions(i)}else this.directionalLight=new Se(e,Ee,this.scope,this.options)}}const n=new e.K(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,i=this.ambientLight;if(!t||!i)return;const n=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),r=t.properties.get("color").toArray01(),s=t.properties.get("intensity"),o=t.properties.get("direction"),a=1-e.bQ(o.x,o.y,o.z)[2]/90,l=n(r)*s*a,c=i.properties.get("color").toArray01(),u=i.properties.get("intensity");return(l+n(c)*u)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(e.c4(t)){const i=e.c5(t),n=this.fragments.find((({id:e})=>e===i));if(!n)throw new Error(`Style import not found: ${t}`);const r=e.c3(t);return n.style.getFragmentStyle(r)}{const e=this.fragments.find((({id:e})=>e===t));if(!e)throw new Error(`Style import not found: ${t}`);return e.style}}getConfigProperty(t,i){const n=this.getFragmentStyle(t);if(!n)return null;const r=e.ag(i,n.scope),s=n.options.get(r),o=s?s.value||s.default:null;return o?o.serialize():null}setConfigProperty(t,i,n){const r=e.r(n);if("success"!==r.result)return void In(this,r.value);const s=r.value.expression,o=this.getFragmentStyle(t);if(!o)return;const a=e.ag(i,o.scope),l=o.options.get(a);l&&(this.options.set(a,{...l,value:s}),this.updateConfigDependencies())}setConfig(t,i){if(this._config=t,t||i)if(i)for(const n in i){let r,s;const o=e.r(i[n].default);if("success"===o.result&&(r=o.value.expression),t&&void 0!==t[n]){const i=e.r(t[n]);"success"===i.result&&(s=i.value.expression)}const{minValue:a,maxValue:l,stepValue:c,type:u,values:h}=i[n];if(r){const t=e.ag(n,this.scope);this.options.set(t,{default:r,value:s,minValue:a,maxValue:l,stepValue:c,type:u,values:h})}else this.fire(new e.a(new Error(`No schema defined for config option "${n}".`)))}else this.fire(new e.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const e of this._configDependentLayers){const t=this.getLayer(e);t&&(t.possiblyEvaluateVisibility(),this._updateLayer(t))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(t,i,n={}){this._checkLoaded();const r=t.id;if(this._layers[r])return void this.fire(new e.a(new Error(`Layer with id "${r}" already exists on this map`)));let s;if("custom"===t.type){if(In(this,e.c6(t)))return;s=e.c2(t,this.scope,this.options)}else{if("object"==typeof t.source&&(this.addSource(r,t.source),t=e.c1(t),t=e.e(t,{source:r})),this._validate(ne,`layers.${r}`,t,{arrayIndex:-1},n))return;s=e.c2(t,this.scope,this.options),this._validateLayer(s),s.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[s.id]=s.serialize()}s.isConfigDependent&&this._configDependentLayers.add(s.fqid);let o=this._order.length;if(i){const t=this._order.indexOf(i);if(-1===t)return void this.fire(new e.a(new Error(`Layer with id "${i}" does not exist on this map.`)));s.slot===this._layers[i].slot?o=t:e.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(o,0,r),this._layerOrderChanged=!0,this._layers[r]=s;const a=this.getOwnLayerSourceCache(s),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();a&&s.canCastShadows()&&l&&(a.castsShadows=!0);const c=this._changes.getRemovedLayer(s);if(c&&s.source&&a&&"custom"!==s.type){this._changes.discardLayerRemoval(s);const t=e.ag(s.source,s.scope);c.type!==s.type?this._changes.updateSourceCache(t,"clear"):(this._changes.updateSourceCache(t,"reload"),a.pause())}this._updateLayer(s),s.onAdd&&s.onAdd(this.map),s.scope=this.scope,this.mergeLayers()}moveLayer(t,i){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;if(t===i)return;const r=this._order.indexOf(t);this._order.splice(r,1);let s=this._order.length;if(i){const t=this._order.indexOf(i);if(-1===t)return void this.fire(new e.a(new Error(`Layer with id "${i}" does not exist on this map.`)));n.slot===this._layers[i].slot?s=t:e.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(s,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const i=this._order.indexOf(e);this._order.splice(i,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const n=this.getOwnLayerSourceCache(t);if(n&&n.castsShadows){let e=!1;for(const i in this._layers)if(this._layers[i].source===t.source&&this._layers[i].canCastShadows()){e=!0;break}n.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,i){this._checkLoaded();const n=this._checkLayer(e);n&&(n.minzoom===t&&n.maxzoom===i||(null!=t&&(n.minzoom=t),null!=i&&(n.maxzoom=i),this._updateLayer(n)))}setSlot(e,t){this._checkLoaded();const i=this._checkLayer(e);i&&i.slot!==t&&(i.slot=t,this._updateLayer(i))}setFilter(i,n,r={}){this._checkLoaded();const s=this._checkLayer(i);if(s&&!t(s.filter,n))return null==n?(s.filter=void 0,void this._updateLayer(s)):void(this._validate(re,`layers.${s.id}.filter`,n,{layerType:s.type},r)||(s.filter=e.c1(n),this._updateLayer(s)))}getFilter(t){const i=this._checkLayer(t);if(i)return e.c1(i.filter)}setLayoutProperty(i,n,r,s={}){this._checkLoaded();const o=this._checkLayer(i);if(o&&!t(o.getLayoutProperty(n),r)){if(null!=r&&(!s||!1!==s.validate)&&In(o,oe.call(K,{key:`layers.${i}.layout.${n}`,layerType:o.type,objectKey:n,value:r,styleSpec:e.D,style:{glyphs:!0,sprite:!0}})))return;o.setLayoutProperty(n,r),o.isConfigDependent&&this._configDependentLayers.add(o.fqid),this._updateLayer(o)}}getLayoutProperty(e,t){const i=this._checkLayer(e);if(i)return i.getLayoutProperty(t)}setPaintProperty(i,n,r,s={}){this._checkLoaded();const o=this._checkLayer(i);if(!o)return;if(t(o.getPaintProperty(n),r))return;if(null!=r&&(!s||!1!==s.validate)&&In(o,se.call(K,{key:`layers.${i}.paint.${n}`,layerType:o.type,objectKey:n,value:r,styleSpec:e.D})))return;const a=o.setPaintProperty(n,r);o.isConfigDependent&&this._configDependentLayers.add(o.fqid),a&&this._updateLayer(o),this._changes.updatePaintProperties(o)}getPaintProperty(e,t){const i=this._checkLayer(e);if(i)return i.getPaintProperty(t)}setFeatureState(t,i){this._checkLoaded();const n=t.source,r=t.sourceLayer,s=this._checkSource(n);if(!s)return;const o=s.type;if("geojson"===o&&r)return void this.fire(new e.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===o&&!r)return void this.fire(new e.a(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.a(new Error("The feature id parameter must be provided.")));const a=this.getOwnSourceCaches(n);for(const e of a)e.setFeatureState(r,t.id,i)}removeFeatureState(t,i){this._checkLoaded();const n=t.source,r=this._checkSource(n);if(!r)return;const s=r.type,o="vector"===s?t.sourceLayer:void 0;if("vector"===s&&!o)return void this.fire(new e.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.a(new Error("A feature id is required to remove its specific state property.")));const a=this.getOwnSourceCaches(n);for(const e of a)e.removeFeatureState(o,t.id,i)}getFeatureState(t){this._checkLoaded();const i=t.source,n=t.sourceLayer,r=this._checkSource(i);if(r){if("vector"!==r.type||n)return void 0===t.id&&this.fire(new e.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(n,t.id);this.fire(new e.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=e.e({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return e.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),i=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return e.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(t){this._changes.updateLayer(t);const i=this.getLayerSourceCache(t),n=e.ag(t.source,t.scope),r=this._changes.getUpdatedSourceCaches();t.source&&!r[n]&&i&&"raster"!==i.getSource().type&&(this._changes.updateSourceCache(n,"reload"),i.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._mergedLayers[e].type||"model"===this._mergedLayers[e].type,i=this.order,n={},r=[];for(let s=i.length-1;s>=0;s--){const o=i[s];if(t(o)){n[o]=s;for(const t of e){const e=t[o];if(e)for(const t of e)r.push(t)}}}r.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const s=[];for(let o=i.length-1;o>=0;o--){const a=i[o];if(t(a))for(let e=r.length-1;e>=0;e--){const t=r[e].feature;if(n[t.layer.id]<o)break;s.push(t),r.pop()}else for(const t of e){const e=t[a];if(e)for(const t of e)s.push(t.feature)}}return s}queryRenderedFeatures(t,i,n){i&&i.filter&&this._validate(re,"queryRenderedFeatures.filter",i.filter,null,i),i.scope=this.scope,i.availableImages=this._availableImages,i.serializedLayers=this._serializedLayers;const r={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.a(new Error("parameters.layers must be an Array."))),[];for(const t of i.layers){const i=this._mergedLayers[t];if(!i)return this.fire(new e.a(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];r[i.source]=!0}}const s=[],o=i.serializedLayers||{},a=i&&i.layers?i.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),l=Me.createFromScreenPoints(t,n);for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e].getSource();if(!t||t.scope!==i.scope)continue;const c=this._mergedSourceCaches[e].getSource().id;i.layers&&!r[c]||s.push(Wt(this._mergedSourceCaches[e],this._mergedLayers,o,l,i,n,a,!!this.map._showQueryGeometry))}return this.placement&&s.push(function(e,t,i,n,r,s,o){const a={},l=s.queryRenderedSymbols(n),c=[];for(const e of Object.keys(l).map(Number))c.push(o[e]);c.sort($t);for(const i of c){const n=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],t,i.bucketIndex,i.sourceLayerIndex,r.filter,r.layers,r.availableImages,e);for(const e in n){const t=a[e]=a[e]||[],r=n[e];r.sort(((e,t)=>{const n=i.featureSortOrder;if(n){const i=n.indexOf(e.featureIndex);return n.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(const e of r)t.push(e)}}for(const t in a)a[t].forEach((n=>{const r=n.feature,s=i(e[t]);if(!s)return;const o=s.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=o}));return a}(this._mergedLayers,o,this.getLayerSourceCache.bind(this),l.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(s)}querySourceFeatures(e,t){t&&t.filter&&this._validate(re,"querySourceFeatures.filter",t.filter,null,t);const i=this.getOwnSourceCaches(e);let n=[];for(const e of i)n=n.concat(qt(e,t));return n}addSourceType(e,t,i){return Ln.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(Ln.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,i,n={}){this._checkLoaded();const r=this.light.getLight();let s=!1;for(const i in e)if(!t(e[i],r[i])){s=!0;break}if(!s)return;const o=this._getTransitionParameters();this.light.setLight(e,i,n),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,n=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()&&0!==n||delete this.terrain,null===i?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let r=i;const s=null==i.source;if(1===n){if("object"==typeof r.source){const t="terrain-dem-src";this.addSource(t,r.source),r=e.c1(r),r=e.e(r,{source:t})}const t=e.e({},r),i={};if(this.terrain&&s){t.source=this.terrain.get().source;const e=this.terrain?this.getFragmentStyle(this.terrain.scope):null;e&&(i.style=e.serialize())}if(this._validate(te,"terrain",t,i))return}if(!this.terrain||this.terrain.scope!==this.scope&&!s||this.terrain&&n!==this.terrain.drapeRenderMode){if(!r)return;this._createTerrain(r,n),this.fire(new e.b("data",{dataType:"style"}))}else{const n=this.terrain,s=n.get();for(const t of Object.keys(e.D.terrain))!r.hasOwnProperty(t)&&e.D.terrain[t].default&&(r[t]=e.D.terrain[t].default);for(const r in i)if(!t(i[r],s[r])){n.set(i,this.options),this.stylesheet.terrain=i;const t=this._getTransitionParameters({duration:0});n.updateTransitions(t),this.fire(new e.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new we(e,this.map.transform,this.scope,this.options);this.stylesheet.fog=t.get();const i=this._getTransitionParameters({duration:0});t.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!t(i.get(),e)){i.set(e,this.options),this.stylesheet.fog=i.get();const t=this._getTransitionParameters({duration:0});i.updateTransitions(t)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:e.f.now(),transition:e.e(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const i in this._mergedLayers)this.isLayerDraped(this._mergedLayers[i])?e.push(i):t.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const i=this.terrain=new pe(e,t,this.scope,this.options);1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const n=this._getTransitionParameters({duration:0});i.updateTransitions(n)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,i,n,r,s={}){if(s&&!1===s.validate)return!1;const o=e.e({},this.serialize());return In(this,t.call(K,e.e({key:i,style:o,value:n,styleSpec:e.D},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const e of t)e.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const t=this.getSourceCaches(e);for(const e of t)e.resume(),e.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}updateSources(e){let t;this.directionalLight&&(t=Tn(this.directionalLight));for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(e,void 0,void 0,t)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,i,n,r,s=!1){let o=!1,a=!1;const l={},c={};for(const i of this._mergedOrder){const n=this._mergedLayers[i];if("symbol"!==n.type)continue;const r=e.ag(n.source,n.scope);let s=l[r];if(!s){const e=this.getLayerSourceCache(n);if(!e)continue;const t=e.getRenderableIds(!0).map((t=>e.getTileByID(t)));c[r]=t.slice(),s=l[r]=t.sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const a=this.crossTileSymbolIndex.addLayer(n,s,t.center.lng,t.projection);o=o||a}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),s=s||this._layerOrderChanged||0===n,this._layerOrderChanged&&this.fire(new e.b("neworder")),(s||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.f.now(),t.zoom))&&(this.pauseablePlacement=new tn(t,this._mergedOrder,s,i,n,r,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,l,c),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.f.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o){this._buildingIndex.onNewFrame(t.zoom);for(const t of this._mergedOrder){const i=this._mergedLayers[t];"symbol"===i.type&&this.placement.updateLayerOpacities(i,l[e.ag(i.source,i.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.f.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(t,i){this._checkLoaded();const n=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==n.findIndex((({id:e})=>e===t.id)))return this.fire(new e.a(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!i)return n.push(t),this._loadImports([t],!0),this;const r=n.findIndex((({id:e})=>e===i));return-1===r?this.fire(new e.a(new Error(`Import with id "${i}" does not exist on this map.`))):(this.stylesheet.imports=n.slice(0,r).concat(t).concat(n.slice(r)),this._loadImports([t],!0,i),this)}updateImport(e,i){this._checkLoaded();const n=this.stylesheet.imports||[],r=this.getImportIndex(e);return-1===r?this:"string"==typeof i?(this.setImportUrl(e,i),this):(i.url&&i.url!==n[r].url&&this.setImportUrl(e,i.url),t(i.config,n[r].config)||this.setImportConfig(e,i.config),t(i.data,n[r].data)||this.setImportData(e,i.data),this)}moveImport(e,t){this._checkLoaded();let i=this.stylesheet.imports||[];const n=this.getImportIndex(e);if(-1===n)return this;const r=this.getImportIndex(t);if(-1===r)return this;const s=i[n],o=this.fragments[n];return i=i.filter((({id:t})=>t!==e)),this.fragments=this.fragments.filter((({id:t})=>t!==e)),this.stylesheet.imports=i.slice(0,r).concat(s).concat(i.slice(r)),this.fragments=this.fragments.slice(0,r).concat(o).concat(this.fragments.slice(r)),this.mergeLayers(),this}setImportUrl(e,t){this._checkLoaded();const i=this.stylesheet.imports||[],n=this.getImportIndex(e);if(-1===n)return this;i[n].url=t;const r=this.fragments[n];return r.style=this._createFragmentStyle(i[n]),r.style.on("style.import.load",(()=>this.mergeAll())),r.style.loadURL(t),this}setImportData(e,t){this._checkLoaded();const i=this.getImportIndex(e),n=this.stylesheet.imports||[];return-1===i?this:t?(this.fragments[i].style.setState(t),this._reloadImports(),this):(delete n[i].data,this.setImportUrl(e,n[i].url))}setImportConfig(e,t){this._checkLoaded();const i=this.getImportIndex(e),n=this.stylesheet.imports||[];if(-1===i)return this;t?n[i].config=t:delete n[i].config;const r=this.fragments[i],s=r.style.stylesheet&&r.style.stylesheet.schema;return r.config=t,r.style.setConfig(t,s),this.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],i=this.getImportIndex(e);return-1===i||(t.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports()),this}getImportIndex(t){const i=(this.stylesheet.imports||[]).findIndex((e=>e.id===t));return-1===i&&this.fire(new e.a(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),i}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const i=this._mergedOtherSourceCaches[t];i&&e.push(i.getSource())}return e}getSource(e,t){const i=this.getSourceCache(e,t);return i&&i.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(t,i){const n=e.ag(t,i);return this._mergedOtherSourceCaches[n]}getLayerSourceCache(t){const i=e.ag(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(e){const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const t in e){const i=e[t];"reload"===i?this.reloadSource(t):"clear"===i&&this.clearSource(t)}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const i of t){const t=this.getLayer(i);t&&t.updateTransitions(e)}}getImages(e,t,i){this.imageManager.getImages(t.icons,t.scope,i),this._updateTilesForChangedImages();const n=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};n(this._otherSourceCaches[t.source]),n(this._symbolSourceCaches[t.source])}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,t.scope,i)}getResource(t,i,n){return e.c9(i,n)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const i=this.getOwnSourceCaches(t);return 0===i.length?(this.fire(new e.a(new Error(`There is no source with ID '${t}'`))),!1):i.every((e=>e.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((e=>{e.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ln.getSourceType=function(e){return jt[e]},Ln.setSourceType=function(e,t){jt[e]=t},Ln.registerForPluginStateChange=e.bV;var Dn="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",On="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}",Nn="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",zn="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Fn="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Bn="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Un="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Vn="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",jn="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);\n#ifdef DATA_FORMAT_UINT32\nvec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;\n#else\nvec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));\n#endif\nreturn velocity/max(u_max_speed,length(velocity));}\n#endif",Gn="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Hn="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Wn=[];Kn(Dn,Wn),Kn(Nn,Wn),Kn(On,Wn);const qn={"_prelude_fog.vertex.glsl":Bn,"_prelude_terrain.vertex.glsl":Fn,"_prelude_shadow.vertex.glsl":Gn,"_prelude_fog.fragment.glsl":Un,"_prelude_shadow.fragment.glsl":Hn,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Vn,"_prelude_raster_particle.glsl":jn},$n={};Jn("",Fn),Jn(Un,Bn),Jn(Hn,Gn),Jn(Vn,""),Jn(jn,"");const Zn=Jn(On,Nn),Xn=Dn;var Yn={background:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Jn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Jn('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Jn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Jn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Jn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Jn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Jn("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Jn('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Jn("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Jn("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nvec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Jn("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'precision highp float;\n#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}'),rasterParticleTexture:Jn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Jn("void main() {}",'#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);\n#ifdef DATA_FORMAT_UINT32\nvec2 dp=vec2(0);\n#else\nvec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;\n#endif\nvec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(\nvec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)\n);}'),symbolIcon:Jn('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:Jn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Jn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Jn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Jn('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',zn),skyboxGradient:Jn('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',zn),skyboxCapture:Jn("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Jn('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Jn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Jn("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Jn("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function Kn(e,t){const i=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let e of i)if(e=e.trim(),"#"===e[0]&&e.includes("if")&&!e.includes("endif")){e=e.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const i=e.split(" ");for(const e of i)t.includes(e)||t.push(e)}}function Jn(e,t){const i=/#include\s+"([^"]+)"/g,n=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let r=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);r&&(r=r.map((e=>{const t=e.split(" ");return t[t.length-1]})),r=[...new Set(r)]);const s={},o=[],a=[];if(e=e.replace(i,((e,t)=>(a.push(t),""))),(t=t.replace(i,((e,t)=>(o.push(t),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...Wn];Kn(e,l),Kn(t,l);for(const e of[...o,...a])qn[e]||console.error(`Undefined include: ${e}`),$n[e]||($n[e]=[],Kn(qn[e],$n[e])),l=[...l,...$n[e]];return{fragmentSource:e=e.replace(n,((e,t,i,n,r)=>(s[r]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nin ${i} ${n} ${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"initialize"===t?`\n#ifdef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${r}\n    in ${i} ${n} ${r};\n#endif\n`:"initialize-attribute"===t?"":void 0))),vertexSource:t=t.replace(n,((e,t,i,n,r)=>{const o="float"===n?"vec2":n,a=r.match(/color/)?"color":o;return"define-attribute-vertex-shader-only"===t?`\n#ifdef HAS_ATTRIBUTE_a_${r}\nin ${i} ${n} a_${r};\n#endif\n`:s[r]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nin ${i} ${o} a_${r};\nout ${i} ${n} ${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"initialize"===t?"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${a}(a_${r}, u_${r}_t);\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${r}\n    in ${i} ${n} a_${r};\n    out ${i} ${n} ${r};\n#endif\n`:"initialize-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${r}\n    ${r} = a_${r};\n#endif\n`:void 0:"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nin ${i} ${o} a_${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"define-instanced"===t?"mat4"===a?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${r}0;\nin vec4 a_${r}1;\nin vec4 a_${r}2;\nin vec4 a_${r}3;\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${i} ${o} a_${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"initialize-attribute-custom"===t?`\n#ifdef HAS_ATTRIBUTE_a_${r}\n    ${i} ${n} ${r} = a_${r};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = a_${r};\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = unpack_mix_${a}(a_${r}, u_${r}_t);\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`})),staticAttributes:r,usedDefines:l,vertexIncludes:o,fragmentIncludes:a}}class Qn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,i,n,r,s,o,a){this.context=e;let l=this.boundPaintVertexBuffers.length!==n.length;for(let e=0;!l&&e<n.length;e++)this.boundPaintVertexBuffers[e]!==n[e]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==o.length;for(let e=0;!c&&e<o.length;e++)this.boundDynamicVertexBuffers[e]!==o[e]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==i||l||c||this.boundIndexBuffer!==r||this.boundVertexOffset!==s)this.freshBind(t,i,n,r,s,o,a);else{e.bindVertexArrayOES.set(this.vao);for(const i of o)i&&(i.bind(),a&&i.instanceCount&&i.setVertexAttribDivisor(e.gl,t,a));r&&r.dynamicDraw&&r.bind()}}freshBind(e,t,i,n,r,s,o){const a=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=r,this.boundDynamicVertexBuffers=s,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r);for(const t of i)t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r);for(const t of s)t&&(t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r),o&&t.instanceCount&&t.setVertexAttribDivisor(c,e,o));n&&n.bind(),l.currentNumAttributes=a}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function er(t,i){const n=Math.pow(2,i.canonical.z),r=i.canonical.y;return[new e.L(0,r/n).toLngLat().lat,new e.L(0,(r+1)/n).toLngLat().lat]}function tr(t,i,n,r,s,o,a){const l=t.context,c=l.gl,u=n.hillshadeFBO;if(!u)return;t.prepareDrawTile();const h=t.isTileAffectedByFog(i),d=t.getOrCreateProgram("hillshade",{overrideFog:h});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const p=((t,i,n,r)=>{const s=n.paint.get("hillshade-shadow-color"),o=n.paint.get("hillshade-highlight-color"),a=n.paint.get("hillshade-accent-color"),l=n.paint.get("hillshade-emissive-strength");let c=e.bj(n.paint.get("hillshade-illumination-direction"));if("viewport"===n.paint.get("hillshade-illumination-anchor"))c-=t.transform.angle;else if(t.style&&t.style.enable3dLights()&&t.style.directionalLight){const i=t.style.directionalLight.properties.get("direction"),n=e.bQ(i.x,i.y,i.z);c=e.bj(n[1])}const u=!t.options.moving;return{u_matrix:r||t.transform.calculateProjMatrix(i.tileID.toUnwrapped(),u),u_image:0,u_latrange:er(0,i.tileID),u_light:[n.paint.get("hillshade-exaggeration"),c],u_shadow:s,u_highlight:o,u_emissive_strength:l,u_accent:a}})(t,n,r,t.terrain?i.projMatrix:null);t.uploadCommonUniforms(l,d,i.toUnwrapped());const{tileBoundsBuffer:f,tileBoundsIndexBuffer:m,tileBoundsSegments:g}=t.getTileBoundsBuffers(n);d.draw(t,c.TRIANGLES,s,o,a,Nt.disabled,p,r.id,f,m,g)}function ir(t,i,n){if(!i.needsDEMTextureUpload)return;const r=t.context,s=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(n.stride);const o=n.getPixels();i.demTexture?i.demTexture.update(o,{premultiply:!1}):i.demTexture=new e.T(r,o,s.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function nr(t,i,n){const r=t.context,s=r.gl;if(!i.dem)return;const o=i.dem;if(r.activeTexture.set(s.TEXTURE1),ir(t,i,o),!i.demTexture)return;i.demTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE);const a=o.dim;r.activeTexture.set(s.TEXTURE0);let l=i.hillshadeFBO;if(!l){const t=new e.T(r,{width:a,height:a,data:null},s.RGBA);t.bind(s.LINEAR,s.CLAMP_TO_EDGE),l=i.hillshadeFBO=r.createFramebuffer(a,a,!0,"renderbuffer"),l.colorAttachment.set(t.texture)}r.bindFramebuffer.set(l.framebuffer),r.viewport.set([0,0,a,a]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:u,tileBoundsSegments:h}=t.getMercatorTileBoundsBuffers(),d=[];t.linearFloatFilteringSupported()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:d}).draw(t,s.TRIANGLES,Ct.disabled,kt.disabled,Lt.unblended,Nt.disabled,((t,i)=>{const n=i.stride,r=e.a6.create();return e.a6.ortho(r,0,e.V,-e.V,0,0,1),e.a6.translate(r,r,[0,-e.V,0]),{u_matrix:r,u_image:1,u_dimension:[n,n],u_zoom:t.overscaledZ}})(i.tileID,o),n.id,c,u,h),i.needsHillshadePrepare=!1}const rr=t=>({u_matrix:new e.bK(t),u_image0:new e.bO(t),u_skirt_height:new e.bN(t),u_ground_shadow_factor:new e.bM(t)}),sr=(e,t,i)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:i}),or=(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(n),u_merc_matrix:i,u_zoom_transition:r,u_merc_center:s,u_image0:0,u_frustum_tl:o,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:m?Float32Array.from(m):new Float32Array(9),u_skirt_height:p,u_far_z_cutoff:f});function ar(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const lr=new class{constructor(){this.operations={}}newMorphing(e,t,i,n,r){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==i.tileID.key&&(t.queued=i)}else this.operations[e]={startTime:n,phase:0,duration:r,from:t,to:i,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},cr={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ur(e,t,i){if(0===t)return 0;const n=t<1&&514===i?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*n}function hr(e,t){const i=1<<e.z;return!t&&(0===e.x||e.x===i-1)||0===e.y||e.y===i-1}const dr=e=>({u_matrix:e});function pr(t,i,n,r,s){if(s>0){const o=e.f.now(),a=(o-t.timeAdded)/s,l=i?(o-i.timeAdded)/s:-1,c=n.getSource(),u=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!i||Math.abs(i.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),d=h&&t.refreshedUponExpiration?1:e.aa(h?a:1-l,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class fr extends Yt{constructor(t){const i={type:"raster-dem",maxzoom:t.transform.maxZoom},n=new e.bW(e.bX(),null),r=Gt("mock-dem",i,n,t.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class mr extends Yt{constructor(t){const i=Gt("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new e.bW(e.bX(),null),t.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,t,i){if(e.freezeTileCoverage)return;this.transform=e;const n=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((t,i)=>{if(t[i.key]="",!this._tiles[i.key]){const t=new Vt(i,this._source.tileSize*i.overscaleFactor(),e.tileZoom);t.state="loaded",this._tiles[i.key]=t}return t}),{});for(const e in this._tiles)e in n||(this.freeFBO(e),this._tiles[e].unloadVectorData(),delete this._tiles[e])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const i=Object.values(t);this.renderCachePool.push(...i),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class gr extends e.am{constructor(e,t,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=i}}class _r extends e.ck{constructor(t,i){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,r,s]=function(t){const i=new e.aN,n=new e.aw,r=131;i.reserve(17161),n.reserve(33800);const s=e.V/128,o=e.V+s/2,a=o+s;for(let t=-s;t<a;t+=s)for(let n=-s;n<a;n+=s){const r=n<0||n>o||t<0||t>o?24575:0,s=e.aa(Math.round(n),0,e.V),a=e.aa(Math.round(t),0,e.V);i.emplaceBack(s+r,a)}const l=(e,t)=>{const i=t*r+e;n.emplaceBack(i+1,i,i+r),n.emplaceBack(i+r,i+r+1,i+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)l(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)l(t,e),l(e,t)})),[i,n,32768]}(),o=t.context;this.gridBuffer=o.createVertexBuffer(n,e.aP.members),this.gridIndexBuffer=o.createIndexBuffer(r),this.gridSegments=e.aB.simpleSegment(0,0,n.length,r.length),this.gridNoSkirtSegments=e.aB.simpleSegment(0,0,n.length,s),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new mr(i.map),this.orthoMatrix=e.a6.create(),e.a6.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.V,0,e.V,0,1);const a=o.gl;this._overlapStencilMode=new kt({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new fr(i.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,i,n){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const r=t.terrain.properties,s=0===t.terrain.drapeRenderMode,o=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=e.f.now();const a=t.terrain&&t.terrain.scope,l=r.get("source"),c=s?this._mockSourceCache:t.getSourceCache(l,a);if(!c)return void e.w(`Couldn't find terrain source "${l}".`);if(this.sourceCache=c,this._exaggeration=o?this.calculateExaggeration(i):r.get("exaggeration"),!i.projection.requiresDraping&&o&&0===this._exaggeration)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&e.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.getScaledDemTileSize();this.sourceCache.update(i,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),i.updateElevation(!0,n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(t){const i=this._previousCameraAltitude,n=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=n;const r=null!=i?n-i:Number.MAX_VALUE;if(Math.abs(r)<2)return this._exaggeration;const s=t.zoom,o=this._style.terrain;if(!this._previousUpdateTimestamp)return o.getExaggeration(s);let a=s-this._previousZoom;const l=this._previousUpdateTimestamp;let c=s;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(s-c)>.5&&(a=.5*(s-c+a)),a*r<0&&(c+=a)),this._evaluationZoom=c;const u=o.getExaggeration(c),h=u===o.getExaggeration(Math.max(0,c-.1));if(h&&Math.abs(u-this._exaggeration)<.01)return u;let d=Math.min(.1,.00375*(this._updateTimestamp-l));return(h||u<.1||Math.abs(a)<1e-4)&&(d=Math.min(.2,4*d)),e.U(this._exaggeration,u,d)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(e.L.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.proxyCoords=i.getIds().map((e=>{const t=i.getTileByID(e).tileID;return t.projMatrix=n.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,i){const n=i.transform.pointCoordinate(i.transform.getCameraPoint()),r=new e.P(n.x,n.y);t.sort(((t,i)=>{if(i.overscaledZ-t.overscaledZ)return i.overscaledZ-t.overscaledZ;const n=new e.P(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),s=new e.P(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),o=r.mult(1<<t.canonical.z);return o.x-=.5,o.y-=.5,o.distSqr(n)-o.distSqr(s)}))}(r,this.painter);const s=this.proxyToSource||{};this.proxyToSource={},r.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const o=this._style._mergedSourceCaches;for(const e in o){const i=o[e];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,t[e],s),i.usedForTerrain)continue;const n=t[e];i.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[i.id]=r.map((e=>new gr(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(s),this.renderingToTexture=!1;const a={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const i=t.tileID.key;i in a||(this._visibleDemTiles.push(t),a[i]=i)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const i in this.terrainTileForTile){const n=this.terrainTileForTile[i],r=n.dem;!r||n.demTexture&&!n.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),ir(this.painter,n,r))}}_prepareDemTileUniforms(e,t,i,n){if(!t||null==t.demTexture)return!1;const r=e.tileID.canonical,s=Math.pow(2,t.tileID.canonical.z-r.z),o=n||"";return i[`u_dem_tl${o}`]=[r.x*s%1,r.y*s%1],i[`u_dem_scale${o}`]=s,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,i=t.gl;if(!this._emptyDepthBufferTexture){const n=new e.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new e.T(t,n,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,i)=>{if(!i.dem)return t;const n=i.dem.tree.minimums[0];return n>0&&e++,t+n}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const n=this._getLoadedAreaMinimum(),[r,s]=(()=>{const t=new e.cm({width:1,height:1},new Float32Array([n]));return[i.R32F,t]})();this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(s,{premultiply:!1}):o=this._emptyDEMTexture=new e.T(t,s,r,{premultiply:!1}),o}setupElevationDraw(t,i,n){const r=this.painter.context,s=r.gl,o={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};o.u_exaggeration=this.exaggeration();let a=null,l=null,c=1;if(n&&n.morphing&&this._useVertexMorphing){const e=n.morphing.srcDemTile,i=n.morphing.dstDemTile;c=n.morphing.phase,e&&i&&(this._prepareDemTileUniforms(t,e,o,"_prev")&&(l=e),this._prepareDemTileUniforms(t,i,o)&&(a=i))}const u=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?s.LINEAR:s.NEAREST,h=e=>{o.u_dem_size=1===e.size[0]?1:e.size[0]-2};if(l&&a)r.activeTexture.set(s.TEXTURE2),a.demTexture.bind(u(a),s.CLAMP_TO_EDGE),r.activeTexture.set(s.TEXTURE4),l.demTexture.bind(u(l),s.CLAMP_TO_EDGE),a.demTexture&&h(a.demTexture),o.u_dem_lerp=c;else{a=this.terrainTileForTile[t.tileID.key],r.activeTexture.set(s.TEXTURE2);const e=this._prepareDemTileUniforms(t,a,o)?a.demTexture:this.emptyDEMTexture;e.bind(u(a),s.CLAMP_TO_EDGE),h(e)}if(r.activeTexture.set(s.TEXTURE3),n&&n.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE),this._depthFBO&&(o.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE),o.u_depth_size_inv=[1,1]),n&&n.useMeterToDem&&a){const t=(1<<a.tileID.canonical.z)*e.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=t}if(n&&n.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),i.setTerrainUniformValues(r,o),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,n&&n.useDenormalizedUpVectorScale);i.setGlobeUniformValues(r,e)}}globeUniformValues(t,i,n){const r=t.projection;return{u_tile_tl_up:r.upVector(i,0,0),u_tile_tr_up:r.upVector(i,e.V,0),u_tile_br_up:r.upVector(i,e.V,e.V),u_tile_bl_up:r.upVector(i,0,e.V),u_tile_up_scale:n?e.cl(1):r.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const i=this.painter,n=this.painter.context;0!==t.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,i,n,r,s){if("globe"===t.transform.projection.name)!function(t,i,n,r,s){const o=t.context,a=o.gl;let l,c;const u=t.transform,h=e.cd(t,o,u),d=(e,i)=>{if(c===i)return;const n=[cr[i],"PROJECTION_GLOBE_VIEW"];h&&n.push("CUSTOM_ANTIALIASING");const r=t.isTileAffectedByFog(e);l=t.getOrCreateProgram("globeRaster",{defines:n,overrideFog:r}),c=i},p=t.colorModeForRenderPass(),f=new Ct(a.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D);lr.update(s);const m=e.ce(u),g=[e.a5(u.center.lng),e.ae(u.center.lat)],_=t.globeSharedBuffers,y=[u.width*e.f.devicePixelRatio,u.height*e.f.devicePixelRatio],v=Float32Array.from(u.globeMatrix),x={useDenormalizedUpVectorScale:!0};{const u=t.transform,h=ur(u.zoom,i.exaggeration(),i.sourceCache._source.tileSize);c=-1;const b=a.TRIANGLES;for(const c of r){const r=n.getTile(c),w=kt.disabled,S=i.prevTerrainTileForTile[c.key],T=i.terrainTileForTile[c.key];ar(S,T)&&lr.newMorphing(c.key,S,T,s,250),o.activeTexture.set(a.TEXTURE0),r.texture&&r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const E=lr.getMorphValuesForProxy(c.key),M=E?1:0;E&&e.j(x,{morphing:{srcDemTile:E.from,dstDemTile:E.to,phase:e.cc(E.phase)}});const I=e.cf(c.canonical),A=e.cg(I.getCenter().lat),C=e.ch(c.canonical,I,A,u.worldSize/u._pixelsPerMercatorPixel),P=e.aT(e.ci(c.canonical)),k=or(u.expandedFarZProjMatrix,v,m,P,e.S(u.zoom),g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,h,u._farZ,C);if(d(c,M),l&&(i.setupElevationDraw(r,l,x),t.uploadCommonUniforms(o,l,c.toUnwrapped()),_)){const[e,i,n]=_.getGridBuffers(A,0!==h);l.draw(t,b,f,w,p,Nt.backCCW,k,"globe_raster",e,i,n)}}}if(_&&(t.renderDefaultNorthPole||t.renderDefaultSouthPole)){const s=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];h&&s.push("CUSTOM_ANTIALIASING"),l=t.getOrCreateProgram("globeRaster",{defines:s});for(const s of r){const{x:r,y:c,z:h}=s.canonical,d=0===c,m=c===(1<<h)-1,[v,b,w,S]=_.getPoleBuffers(h,!1);if(S&&(d||m)){const c=n.getTile(s);o.activeTexture.set(a.TEXTURE0),c.texture&&c.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let _=e.cj(h,r,u);const T=e.aT(e.ci(s.canonical)),E=(e,i)=>e.draw(t,a.TRIANGLES,f,kt.disabled,p,Nt.disabled,or(u.expandedFarZProjMatrix,_,_,T,0,g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,0,u._farZ),"globe_pole_raster",i,w,S);i.setupElevationDraw(c,l,x),t.uploadCommonUniforms(o,l,s.toUnwrapped()),d&&t.renderDefaultNorthPole&&E(l,v),m&&t.renderDefaultSouthPole&&(_=e.a6.scale(e.a6.create(),_,[1,-1,1]),E(l,b))}}}}(t,i,n,r,s);else{const o=t.context,a=o.gl;let l,c;const u=t.shadowRenderer,h=yn(t,t.longestCutoffRange),d=e=>{if(c===e)return;const i=[];i.push(cr[e]),h.shouldRenderCutoff&&i.push("RENDER_CUTOFF"),l=t.getOrCreateProgram("terrainRaster",{defines:i}),c=e},p=t.colorModeForRenderPass(),f=new Ct(a.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D);lr.update(s);const m=t.transform,g=ur(m.zoom,i.exaggeration(),i.sourceCache._source.tileSize);let _=[0,0,0];if(u){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(_=En(e,i))}{c=-1;const y=a.TRIANGLES,[v,x]=[i.gridIndexBuffer,i.gridSegments];for(const c of r){const r=n.getTile(c),b=kt.disabled,w=i.prevTerrainTileForTile[c.key],S=i.terrainTileForTile[c.key];ar(w,S)&&lr.newMorphing(c.key,w,S,s,250),o.activeTexture.set(a.TEXTURE0),r.texture&&r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const T=lr.getMorphValuesForProxy(c.key),E=T?1:0;let M;T&&(M={morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:e.cc(T.phase)}});const I=sr(c.projMatrix,hr(c.canonical,m.renderWorldCopies)?g/10:g,_);if(d(E),!l)continue;i.setupElevationDraw(r,l,M);const A=c.toUnwrapped();u&&u.setupShadows(A,l),t.uploadCommonUniforms(o,l,A,null,h),l.draw(t,y,f,b,p,Nt.backCCW,I,"terrain_raster",i.gridBuffer,v,x)}}}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const i=this.painter,n=this.painter.context,r=this.proxySourceCache,s=this.proxiedCoords[r.id],o=this._drapedRenderBatches.shift(),a=i.style.order,l=[];let c=0;for(const u of s){const s=r.getTileByID(u.proxyTileKey),h=r.proxyCachedFBO[u.key]?r.proxyCachedFBO[u.key][t]:void 0,d=void 0!==h?r.renderCache[h]:this.pool[c++],p=void 0!==h;if(s.texture=d.tex,p&&!d.dirty){l.push(s.tileID);continue}let f;n.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(n.clear({color:e.ax.transparent,stencil:0}),d.dirty=!1);for(let e=o.start;e<=o.end;++e){const t=i.style._mergedLayers[a[e]];if(t.isHidden(i.transform.zoom))continue;const r=i.style.getLayerSourceCache(t),s=r?this.proxyToSource[u.key][r.id]:[u];if(!s)continue;const o=s;n.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(r?r.id:null)&&(this._setupStencil(d,s,t,r),f=r?r.id:null),i.renderLayer(i,r,t,o)}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const t=i.style._mergedLayers[a[e]];if(t.isHidden(i.transform.zoom))continue;const r=i.style.getLayerSourceCache(t),s=r?this.proxyToSource[u.key][r.id]:[u];if(!s)continue;const o=s;n.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(r?r.id:null)&&(this._setupStencil(d,s,t,r),f=r?r.id:null),i.renderLayer(i,r,t,o)}this.renderedToTile?(d.dirty=!0,l.push(s.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),o.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let i=-1,n=t;for(let r=0;r<t;++r)this._style.isLayerDraped(e._mergedLayers[e.order[r]])?i=Math.max(i,r):n=Math.min(n,r);return n>i}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,i){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter((e=>e.dem)).map((n=>{const r=n.tileID,s=1<<r.overscaledZ,{x:o,y:a}=r.canonical,l=o/s,c=(o+1)/s,u=a/s,h=(a+1)/s;return{minx:l,miny:u,maxx:c,maxy:h,t:n.dem.tree.raycastRoot(l,u,c,h,e,t,i),tile:n}}));n.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const r of n){if(null==r.t)return null;const n=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,e,t,i);if(null!=n)return n}return null}_createFBO(){const t=this.painter.context,i=t.gl,n=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const r=new e.T(t,{width:n[0],height:n[1],data:null},i.RGBA);r.bind(i.LINEAR,i.CLAMP_TO_EDGE);const s=t.createFramebuffer(n[0],n[1],!0,null);return s.colorAttachment.set(r.texture),s.depthAttachment=new It(t,s.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,s.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):s.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:s,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._mergedLayers[e],i=t.isHidden(this.painter.transform.zoom);return"custom"===t.type?!i&&t.shouldRedrape():!i&&t.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style.getSources())if(e instanceof Re){t=!0;break}if(!t)return;const i={};for(let t=0;t<this._style.order.length;++t){const n=this._style._mergedLayers[this._style.order[t]],r=this._style.getLayerSourceCache(n);if(r&&!i[r.id]&&!n.isHidden(this.painter.transform.zoom)&&"line"===n.type&&n.widthExpression()instanceof e.Z){i[r.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][r.id];if(t)for(const e of t)this._clearRenderCacheForTile(r.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t]._source instanceof Le){e=!0;break}if(!e)return;const t={};for(let e=0;e<this._style.order.length;++e){const i=this._style._mergedLayers[this._style.order[e]],n=this._style.getLayerSourceCache(i);if(!n||t[n.id])continue;if(i.isHidden(this.painter.transform.zoom)||"raster"!==i.type)continue;const r=i.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][n.id];if(t)for(const e of t){const t=pr(n.getTile(e),n.findLoadedParent(e,0),n,this.painter.transform,r);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(n.id,e)}}}}_setupDrapedRenderBatches(){const t=this._style.order,i=t.length;if(0===i)return;const n=[];this._pendingGroundEffectLayers=[];let r,s=0,o=this._style._mergedLayers[t[s]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++s<i;)o=this._style._mergedLayers[t[s]];for(;s<i;++s){const e=this._style._mergedLayers[t[s]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===r&&(r=s):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(s),void 0!==r&&(n.push({start:r,end:s-1}),r=void 0)))}if(void 0!==r&&n.push({start:r,end:s-1}),0!==n.length){const t=n[n.length-1];this._pendingGroundEffectLayers.every((e=>e>t.end))||e.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=n}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let i=0;i<e.length;++i){const n=Object.values(e[i]);t.renderCachePool.push(...n)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,n=this._tilesDirty;for(let r=i.length-1;r>=0;r--){const s=i[r];if(t.getTileByID(s.key),void 0!==t.proxyCachedFBO[s.key]){const i=e[s.key],r=this.proxyToSource[s.key];let o=0;for(const e in r){const t=r[e],s=i[e];if(!s||s.length!==t.length||t.some(((t,i)=>t!==s[i]||n[e]&&n[e].hasOwnProperty(t.key)))){o=-1;break}++o}for(const e in t.proxyCachedFBO[s.key])t.renderCache[t.proxyCachedFBO[s.key][e]].dirty=o<0||o!==Object.values(i).length}}const r=[...this._drapedRenderBatches];r.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const e of r)for(const n of i){if(t.proxyCachedFBO[n.key])continue;let i=t.renderCachePool.pop();void 0===i&&t.renderCache.length<50&&(i=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==i&&(t.proxyCachedFBO[n.key]={},t.proxyCachedFBO[n.key][e.start]=i,t.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,i,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const r=this.painter.context,s=r.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let o;if(i.isTileClipped())o=t.length,this._overlapStencilMode.test={func:s.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);o=1,this._overlapStencilMode.test={func:s.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+o>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=o,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):kt.disabled}_renderTileClippingMasks(e,t){const i=this.painter,n=this.painter.context,r=n.gl;i._tileClippingMaskIDs={},n.setColorMode(Lt.disabled),n.setDepthMode(Ct.disabled);const s=i.getOrCreateProgram("clippingMask");for(const n of e){const e=i._tileClippingMaskIDs[n.key]=--t;s.draw(i,r.TRIANGLES,Ct.disabled,new kt({func:r.ALWAYS,mask:0},e,255,r.KEEP,r.KEEP,r.REPLACE),Lt.disabled,Nt.disabled,dr(n.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const n=[t.x,t.y,1,1];e.a7.transformMat4(n,n,i.pixelMatrixInverse),e.a7.scale(n,n,1/n[3]),n[0]/=i.worldSize,n[1]/=i.worldSize;const r=i._camera.position,s=e.bl(1,i.center.lat),o=[r[0],r[1],r[2]/s,0],a=e.N.subtract([],n.slice(0,3),o);e.N.normalize(a,a);const l=this.raycast(o,a,this._exaggeration);return null!==l&&l?(e.N.scaleAndAdd(o,o,a,l),o[3]=o[2],o[2]*=s,o):null}drawDepth(){const t=this.painter,i=t.context,n=this.proxySourceCache,r=Math.ceil(t.width),s=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===s||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const t=i.gl,n=i.createFramebuffer(r,s,!0,"renderbuffer");i.activeTexture.set(t.TEXTURE0);const o=new e.T(i,{width:r,height:s,data:null},t.RGBA);o.bind(t.NEAREST,t.CLAMP_TO_EDGE),n.colorAttachment.set(o.texture);const a=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,r,s);n.depthAttachment.set(a),this._depthFBO=n,this._depthTexture=o}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,r,s]),function(e,t,i,n){if("globe"===e.transform.projection.name)return;const r=e.context,s=r.gl;r.clear({depth:1});const o=e.getOrCreateProgram("terrainDepth"),a=new Ct(s.LESS,Ct.ReadWrite,e.depthRangeFor3D);for(const r of n){const n=i.getTile(r),l=sr(r.projMatrix,0,[0,0,0]);t.setupElevationDraw(n,o),o.draw(e,s.TRIANGLES,a,kt.disabled,Lt.unblended,Nt.backCCW,l,"terrain_depth",t.gridBuffer,t.gridIndexBuffer,t.gridNoSkirtSegments)}}(t,this,n,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,i,n){if(t.getSource()instanceof e.ap)return this._setupProxiedCoordsForImageSource(t,i,n);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const r=this.proxiedCoords[t.id]=[],s=this.proxyCoords;for(let e=0;e<s.length;e++){const i=s[e],o=this._findTileCoveringTileID(i,t);if(o){const e=this._createProxiedId(i,o,n[i.key]&&n[i.key][t.id]);r.push(e),this.proxyToSource[i.key][t.id]=[e]}}let o=!1;const a=new Set;for(let e=0;e<i.length;e++){const s=t.getTile(i[e]);if(!s||!s.hasData())continue;const l=this._findTileCoveringTileID(s.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==s.tileID.canonical.z){const e=this.proxyToSource[l.tileID.key][t.id],i=this._createProxiedId(l.tileID,s,n[l.tileID.key]&&n[l.tileID.key][t.id]);e?e.splice(e.length-1,0,i):this.proxyToSource[l.tileID.key][t.id]=[i];const c=this.proxyToSource[l.tileID.key][t.id];a.has(c)||a.add(c),r.push(i),o=!0}}if(this._sourceTilesOverlap[t.id]=o,o&&this._debugParams.sortTilesHiZFirst)for(const e of a)e.sort(((e,t)=>t.overscaledZ-e.overscaledZ))}_setupProxiedCoordsForImageSource(t,i,n){if(!t.getSource().loaded())return;const r=this.proxiedCoords[t.id]=[],s=this.proxyCoords,o=t.getSource(),a=o.tileID;if(!a)return;const l=new e.P(a.x,a.y)._div(1<<a.z),c=o.coordinates.map(e.L.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-l.x),e.min.y=Math.min(e.min.y,t.y-l.y),e.max.x=Math.max(e.max.x,t.x-l.x),e.max.y=Math.max(e.max.y,t.y-l.y),e)),{min:new e.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(t,i)=>{const n=t.wrap+t.canonical.x/(1<<t.canonical.z),r=t.canonical.y/(1<<t.canonical.z),s=e.V/(1<<t.canonical.z),o=i.wrap+i.canonical.x/(1<<i.canonical.z),a=i.canonical.y/(1<<i.canonical.z);return n+s<o+c.min.x||n>o+c.max.x||r+s<a+c.min.y||r>a+c.max.y};for(let e=0;e<s.length;e++){const o=s[e];for(let e=0;e<i.length;e++){const s=t.getTile(i[e]);if(!s||!s.hasData())continue;if(u(o,s.tileID))continue;const a=this._createProxiedId(o,s,n[o.key]&&n[o.key][t.id]),l=this.proxyToSource[o.key][t.id];l?l.push(a):this.proxyToSource[o.key][t.id]=[a],r.push(a)}}}_createProxiedId(t,i,n){let r=this.orthoMatrix;if(n){const e=n.find((e=>e.key===i.tileID.key));if(e)return e}if(i.tileID.key!==t.key){const n=t.canonical.z-i.tileID.canonical.z;let s,o,a;r=e.a6.create();const l=i.tileID.wrap-t.wrap<<t.overscaledZ;n>0?(s=e.V>>n,o=s*((i.tileID.canonical.x<<n)-t.canonical.x+l),a=s*((i.tileID.canonical.y<<n)-t.canonical.y)):(s=e.V<<-n,o=e.V*(i.tileID.canonical.x-(t.canonical.x+l<<-n)),a=e.V*(i.tileID.canonical.y-(t.canonical.y<<-n))),e.a6.ortho(r,0,s,0,s,0,1),e.a6.translate(r,r,[o,a,0])}return new gr(i.tileID,t.key,r)}_findTileCoveringTileID(t,i){let n=i.getTile(t);if(n&&n.hasData())return n;const r=this._findCoveringTileCache[i.id],s=r[t.key];if(n=s?i.getTileByID(s):null,n&&n.hasData()||null===s)return n;let o=n?n.tileID:t,a=o.overscaledZ;const l=i.getSource().minzoom,c=[];if(!s){const r=i.getSource().maxzoom;if(t.canonical.z>=r){const n=t.canonical.z-r;i.getSource().reparseOverscaled?(a=Math.max(t.canonical.z+2,i.transform.tileZoom),o=new e.am(a,t.wrap,r,t.canonical.x>>n,t.canonical.y>>n)):0!==n&&(a=r,o=new e.am(a,t.wrap,r,t.canonical.x>>n,t.canonical.y>>n))}o.key!==t.key&&(c.push(o.key),n=i.getTile(o))}const u=e=>{c.forEach((t=>{r[t]=e})),c.length=0};for(a-=1;a>=l&&(!n||!n.hasData());a--){n&&u(n.tileID.key);const e=o.calculateScaledKey(a);if(n=i.getTileByID(e),n&&n.hasData())break;const t=r[e];if(null===t)break;void 0===t?c.push(e):n=i.getTileByID(t)}return u(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[t.key]=!0}}function yr(t,i,n){const r=function(t,i,n){const r=e.N.dot(i,t),s=e.N.dot(n,[.2126,.7152,.0722]),o=(e,t,i)=>(1-i)*e+i*t,a=o(1-.3*Math.min(s,1),1,Math.min(r+1,1));return o(.92,1,Math.asin(e.aa(i[2],-1,1))/Math.PI+.5)*a}(t,[0,0,1],i),s=[0,0,0];e.N.scale(s,n.slice(0,3),r);const o=[0,0,0];e.N.scale(o,i.slice(0,3),t[2]);const a=[0,0,0];return e.N.add(a,s,o),e.bU(a)}const vr=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],xr=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class br{static cacheKey(e,t,i,n){let r=`${t}${n?n.cacheKey:""}`;for(const t of i)e.usedDefines.includes(t)&&(r+=`/${t}`);return r}constructor(t,i,n,r,s,o,a){const l=t.gl;this.program=l.createProgram(),this.configuration=r,this.name=i,this.fixedDefines=[...o];const c=r?r.getBinderAttributes():[],u=(n.staticAttributes||[]).concat(c);let h=r?r.defines():[];h=h.concat(o.map((e=>`#define ${e}`)));const d="#version 300 es\n";let p=d+h.concat("precision mediump float;",Xn,Zn.fragmentSource).join("\n");for(const e of n.fragmentIncludes)p+=`\n${qn[e]}`;p+=`\n${n.fragmentSource}`;let f=d+h.concat("precision highp float;",Xn,Zn.vertexSource).join("\n");for(const e of n.vertexIncludes)f+=`\n${qn[e]}`;f+=`\n${n.vertexSource}`;const m=l.createShader(l.FRAGMENT_SHADER);if(l.isContextLost())return void(this.failedToCreate=!0);l.shaderSource(m,p),l.compileShader(m),l.attachShader(this.program,m);const g=l.createShader(l.VERTEX_SHADER);if(l.isContextLost())this.failedToCreate=!0;else{l.shaderSource(g,f),l.compileShader(g),l.attachShader(this.program,g),this.attributes={},this.numAttributes=u.length;for(let e=0;e<this.numAttributes;e++)if(u[e]){const t=u[e].startsWith("a_")?u[e]:`a_${u[e]}`;l.bindAttribLocation(this.program,e,t),this.attributes[t]=e}a&&a.shaderVaryings.length>0&&l.transformFeedbackVaryings(this.program,a.shaderVaryings,a.bufferMode),l.linkProgram(this.program),l.deleteShader(g),l.deleteShader(m),this.fixedUniforms=s(t),this.binderUniforms=r?r.getUniforms(t):[],o.includes("TERRAIN")&&(this.terrainUniforms=(t=>({u_dem:new e.bO(t),u_dem_prev:new e.bO(t),u_dem_tl:new e.bL(t),u_dem_scale:new e.bN(t),u_dem_tl_prev:new e.bL(t),u_dem_scale_prev:new e.bN(t),u_dem_size:new e.bN(t),u_dem_lerp:new e.bN(t),u_exaggeration:new e.bN(t),u_depth:new e.bO(t),u_depth_size_inv:new e.bL(t),u_meter_to_dem:new e.bN(t),u_label_plane_matrix_inv:new e.bK(t)}))(t)),o.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.bM(t),u_tile_tr_up:new e.bM(t),u_tile_br_up:new e.bM(t),u_tile_bl_up:new e.bM(t),u_tile_up_scale:new e.bN(t)}))(t)),o.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.bK(t),u_fog_range:new e.bL(t),u_fog_color:new e.bP(t),u_fog_horizon_blend:new e.bN(t),u_fog_vertical_limit:new e.bL(t),u_fog_temporal_offset:new e.bN(t),u_frustum_tl:new e.bM(t),u_frustum_tr:new e.bM(t),u_frustum_br:new e.bM(t),u_frustum_bl:new e.bM(t),u_globe_pos:new e.bM(t),u_globe_radius:new e.bN(t),u_globe_transition:new e.bN(t),u_is_globe:new e.bO(t),u_viewport:new e.bL(t)}))(t)),o.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(t=>({u_cutoff_params:new e.bP(t)}))(t)),o.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(t=>({u_lighting_ambient_color:new e.bM(t),u_lighting_directional_dir:new e.bM(t),u_lighting_directional_color:new e.bM(t),u_ground_radiance:new e.bM(t)}))(t)),o.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(t=>({u_light_matrix_0:new e.bK(t),u_light_matrix_1:new e.bK(t),u_fade_range:new e.bL(t),u_shadow_normal_offset:new e.bM(t),u_shadow_intensity:new e.bN(t),u_shadow_texel_size:new e.bN(t),u_shadow_map_resolution:new e.bN(t),u_shadow_direction:new e.bM(t),u_shadow_bias:new e.bM(t),u_shadowmap_0:new e.bO(t),u_shadowmap_1:new e.bO(t)}))(t))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const i=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const i=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const i=this.shadowUniforms;e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}_drawDebugWireframe(t,i,n,r,s,o,a,l,c,u){const h=t.options.wireframe;if(!1===h.terrain&&!1===h.layers2D&&!1===h.layers3D)return;const d=t.context;if(!(()=>!(!h.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!h.layers2D||t._terrain&&t._terrain.renderingToTexture||!vr.includes(this.name))||!(!h.layers3D||!xr.includes(this.name)))())return;const p=d.gl,f=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,s,d);if(!f)return;const m=[...this.fixedDefines];m.push("DEBUG_WIREFRAME");const g=t.getOrCreateProgram(this.name,{config:this.configuration,defines:m});d.program.set(g.program);const _=(e,t,i)=>{if(t[e]&&i[e])for(const n in t[e])i[e][n]&&i[e][n].set(i.program,n,t[e][n].current)};c&&c.setUniforms(g.program,d,g.binderUniforms,a,{zoom:l}),_("fixedUniforms",this,g),_("terrainUniforms",this,g),_("globeUniforms",this,g),_("fogUniforms",this,g),_("lightsUniforms",this,g),_("shadowUniforms",this,g),f.bind(),d.setColorMode(new Lt([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.ZERO,p.ONE],e.ax.transparent,[!0,!0,!0,!1])),d.setDepthMode(new Ct(i.func===p.LESS?p.LEQUAL:i.func,Ct.ReadOnly,i.range)),d.setStencilMode(kt.disabled);const y=3*o.primitiveLength*2,v=3*o.primitiveOffset*2*2;u&&u>1?p.drawElementsInstanced(p.LINES,y,p.UNSIGNED_SHORT,v,u):p.drawElements(p.LINES,y,p.UNSIGNED_SHORT,v),s.bind(),d.program.set(this.program),d.setDepthMode(i),d.setStencilMode(n),d.setColorMode(r)}draw(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g){const _=e.context,y=_.gl;if(this.failedToCreate)return;_.program.set(this.program),_.setDepthMode(i),_.setStencilMode(n),_.setColorMode(r),_.setCullFace(s);for(const e of Object.keys(this.fixedUniforms))this.fixedUniforms[e].set(this.program,e,o[e]);p&&p.setUniforms(this.program,_,this.binderUniforms,h,{zoom:d});const v={[y.POINTS]:1,[y.LINES]:2,[y.TRIANGLES]:3,[y.LINE_STRIP]:1}[t],x=g&&g.length>0;if(x){for(const e of g)y.bindBufferBase(y.TRANSFORM_FEEDBACK_BUFFER,e.targetIndex,e.buffer.buffer);y.beginTransformFeedback(t)}const b=m&&m>0?1:void 0;for(const s of u.get()){const o=s.vaos||(s.vaos={});(o[a]||(o[a]=new Qn)).bind(_,this,l,p?p.getPaintVertexBuffers():[],c,s.vertexOffset,f||[],b),m&&m>1?y.drawElementsInstanced(t,s.primitiveLength*v,y.UNSIGNED_SHORT,s.primitiveOffset*v*2,m):c?y.drawElements(t,s.primitiveLength*v,y.UNSIGNED_SHORT,s.primitiveOffset*v*2):y.drawArrays(t,s.vertexOffset,s.vertexLength),t===y.TRIANGLES&&c&&this._drawDebugWireframe(e,i,n,r,c,s,h,d,p,m)}x&&y.endTransformFeedback()}}function wr(t,i){const n=Math.pow(2,i.tileID.overscaledZ),r=i.tileSize*Math.pow(2,t.transform.tileZoom)/n,s=r*(i.tileID.canonical.x+i.tileID.wrap*n),o=r*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/e.a3(i,1,t.transform.tileZoom),u_pixel_coord_upper:[s>>16,o>>16],u_pixel_coord_lower:[65535&s,65535&o]}}const Sr=e.a6.create(),Tr=(t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g)=>{const _=i.style.light,y=_.properties.get("position"),v=[y.x,y.y,y.z],x=e.co.create();"viewport"===_.properties.get("anchor")&&(e.co.fromRotation(x,-i.transform.angle),e.N.transformMat3(v,v,x));const b=_.properties.get("color"),w=i.transform,S={u_matrix:t,u_lightpos:v,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+n,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Sr,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:s,u_edge_radius:o,u_flood_light_color:d,u_vertical_scale:p,u_flood_light_intensity:f,u_ground_shadow_factor:m,u_emissive_strength:g};return"globe"===w.projection.name&&(S.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],S.u_zoom_transition=c,S.u_inv_rot_matrix=h,S.u_merc_center=u,S.u_up_dir=w.projection.upVector(new e.bs(0,0,0),u[0]*e.V,u[1]*e.V),S.u_height_lift=l),S},Er=(e,t,i)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:i}),Mr=(t,i,n,r,s,o,a,l,c,u,h,d,p,f)=>{const m=Tr(t,i,n,r,s,o,a,c,u,h,d,p,f,1,[0,0,0],0),g={u_height_factor:-Math.pow(2,a.overscaledZ)/l.tileSize/8};return e.e(m,wr(i,l),g)},Ir=(e,t)=>({u_matrix:e,u_emissive_strength:t}),Ar=(t,i,n,r)=>e.e(Ir(t,i),wr(n,r)),Cr=(e,t,i)=>({u_matrix:e,u_world:i,u_emissive_strength:t}),Pr=(t,i,n,r,s)=>e.e(Ar(t,i,n,r),{u_world:s}),kr=(t,i,n,r)=>{const s=e.V/n.tileSize;return{u_matrix:t,u_camera_to_center_distance:i.getCameraToCenterDistance(r),u_extrude_scale:[i.pixelsToGLUnits[0]/s,i.pixelsToGLUnits[1]/s]}},Rr=(e,t,i=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:i}),Lr=e.a6.create(),Dr=(t,i,n,r,s,o,a)=>{const l=t.transform,c="globe"===l.projection.name,u=c?e.cp(l.zoom,i.canonical)*l._pixelsPerMercatorPixel:e.a3(n,1,o),h={u_matrix:i.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:Lr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=r,h.u_merc_center=s,h.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],h.u_zoom_transition=e.S(l.zoom);const t=s[0]*e.V,n=s[1]*e.V;h.u_up_dir=l.projection.upVector(new e.bs(0,0,0),t,n)}return h};function Or(e,[t,i,n,r],[s,o]){if(s===o)return[0,0,0,0];const a=255*(e-1)/(e*(o-s));return[t*a,i*a,n*a,r*a]}function Nr(e,t,[i,n]){return i===n?0:.5/e+(t-i)*(e-1)/(e*(n-i))}const zr=(t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,v,x,b)=>{return{u_matrix:t,u_normalize_matrix:i,u_globe_matrix:n,u_merc_matrix:r,u_grid_matrix:s,u_tl_parent:o,u_scale_parent:u,u_fade_t:h.mix,u_opacity:h.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(S=d.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(w=d.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Fr(d.paint.get("raster-hue-rotate")),u_perspective_transform:p,u_raster_elevation:f,u_zoom_transition:a,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:Or(e.cq,g,y),u_colorization_offset:Nr(e.cq,_,y),u_color_ramp:m,u_texture_offset:[x/(v+2*x),v/(v+2*x)],u_texture_res:[v+2*x,v+2*x],u_emissive_strength:b};var w,S};function Fr(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const Br=(e,t,i,n,r,s,o,a,l,c,u,h)=>({u_matrix:e,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:n,u_grid_matrix:r,u_tl_parent:s,u_scale_parent:c,u_fade_t:u.mix,u_opacity:u.opacity,u_image0:0,u_image1:1,u_raster_elevation:h,u_zoom_transition:o,u_merc_center:a,u_cutoff_params:l}),Ur=(e,t,i,n,r,s,o,a)=>({u_tile_offset:e,u_velocity:t,u_color_ramp:n,u_velocity_res:i,u_max_speed:r,u_texture_offset:s,u_data_scale:o,u_data_offset:a}),Vr=(e,t,i,n,r,s,o,a)=>({u_velocity:e,u_velocity_res:t,u_max_speed:i,u_speed_factor:n,u_lifetime_delta:r,u_rand_seed:Math.random(),u_texture_offset:s,u_data_scale:o,u_data_offset:a}),jr=e.a6.create(),Gr=(t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y)=>{const v=s.transform,x={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:v.getCameraToCenterDistance(g),u_rotate_symbol:+n,u_aspect_ratio:v.width/v.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+r,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:jr,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:jr,u_up_vector:[0,-1,0],u_icon_transition:y||0,u_icon_saturation:_};return"globe"===g.name&&(x.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],x.u_zoom_transition=d,x.u_inv_rot_matrix=f,x.u_merc_center=p,x.u_camera_forward=v._camera.forward(),x.u_ecef_origin=e.cr(v.globeMatrix,h.toUnwrapped()),x.u_tile_matrix=Float32Array.from(v.globeMatrix),x.u_up_vector=m),x},Hr=(t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_)=>e.e(Gr(t,i,n,r,s,o,a,l,c,u,d,p,f,m,g,_,1),{u_gamma_scale:r?s.transform.getCameraToCenterDistance(_)*Math.cos(s.terrain?0:s.transform._pitch):1,u_device_pixel_ratio:e.f.devicePixelRatio,u_is_halo:+h,undefined:void 0}),Wr=(t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g)=>e.e(Hr(t,i,n,r,s,o,a,l,!0,c,!0,h,d,p,f,m,g),{u_texsize_icon:u,u_texture_icon:1}),qr=(e,t,i,n)=>({u_matrix:e,u_emissive_strength:t,u_opacity:i,u_color:n}),$r=(t,i,n,r,s,o,a)=>e.e(function(t,i,n,r){const s=n.imageManager.getPattern(t.toString(),i),{width:o,height:a}=n.imageManager.getPixelSize(i),l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,n.transform.tileZoom)/l,u=c*(r.tileID.canonical.x+r.tileID.wrap*l),h=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl:s.tl,u_pattern_br:s.br,u_texsize:[o,a],u_pattern_size:s.displaySize,u_tile_units_to_pixels:1/e.a3(r,1,n.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(s,o,r,a),{u_matrix:t,u_emissive_strength:i,u_opacity:n}),Zr=(t,i,n,r,s,o,a,l,c,u,h,d,p=[0,0,0],f)=>{const m=r.style.light,g=m.properties.get("position"),_=[-g.x,-g.y,g.z],y=e.co.create();"viewport"===m.properties.get("anchor")&&(e.co.fromRotation(y,-r.transform.angle),e.N.transformMat3(_,_,y));const v="MASK"===u.alphaMode,x=m.properties.get("color"),b=d.paint.get("model-ambient-occlusion-intensity"),w=d.paint.get("model-color").constantOr(e.ax.white),S=d.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:i,u_normal_matrix:n,u_lightpos:_,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_camera_pos:p,u_opacity:s,u_baseTextureIsAlpha:0,u_alphaMask:+v,u_alphaCutoff:u.alphaCutoff,u_baseColorFactor:[o.r,o.g,o.b,o.a],u_emissiveFactor:[a[0],a[1],a[2],1],u_metallicFactor:l,u_roughnessFactor:c,u_baseColorTexture:_n.BaseColor,u_metallicRoughnessTexture:_n.MetallicRoughness,u_normalTexture:_n.Normal,u_occlusionTexture:_n.Occlusion,u_emissionTexture:_n.Emission,u_color_mix:[w.r,w.g,w.b,S],u_aoIntensity:b,u_emissive_strength:h,u_occlusionTextureTransform:f||[0,0,0,0]}},Xr=new Float32Array(16),Yr=(e,t=Xr,i=Xr)=>({u_matrix:e,u_instance:t,u_node_matrix:i}),Kr={fillExtrusion:t=>({u_matrix:new e.bK(t),u_lightpos:new e.bM(t),u_lightintensity:new e.bN(t),u_lightcolor:new e.bM(t),u_vertical_gradient:new e.bN(t),u_opacity:new e.bN(t),u_edge_radius:new e.bN(t),u_ao:new e.bL(t),u_tile_id:new e.bM(t),u_zoom_transition:new e.bN(t),u_inv_rot_matrix:new e.bK(t),u_merc_center:new e.bL(t),u_up_dir:new e.bM(t),u_height_lift:new e.bN(t),u_flood_light_color:new e.bM(t),u_vertical_scale:new e.bN(t),u_flood_light_intensity:new e.bN(t),u_ground_shadow_factor:new e.bM(t),u_emissive_strength:new e.bN(t)}),fillExtrusionDepth:t=>({u_matrix:new e.bK(t),u_edge_radius:new e.bN(t),u_vertical_scale:new e.bN(t)}),fillExtrusionPattern:t=>({u_matrix:new e.bK(t),u_lightpos:new e.bM(t),u_lightintensity:new e.bN(t),u_lightcolor:new e.bM(t),u_vertical_gradient:new e.bN(t),u_height_factor:new e.bN(t),u_edge_radius:new e.bN(t),u_ao:new e.bL(t),u_tile_id:new e.bM(t),u_zoom_transition:new e.bN(t),u_inv_rot_matrix:new e.bK(t),u_merc_center:new e.bL(t),u_up_dir:new e.bM(t),u_height_lift:new e.bN(t),u_image:new e.bO(t),u_texsize:new e.bL(t),u_pixel_coord_upper:new e.bL(t),u_pixel_coord_lower:new e.bL(t),u_tile_units_to_pixels:new e.bN(t),u_opacity:new e.bN(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new e.bK(t),u_opacity:new e.bN(t),u_ao_pass:new e.bN(t),u_meter_to_tile:new e.bN(t),u_ao:new e.bL(t),u_flood_light_intensity:new e.bN(t),u_flood_light_color:new e.bM(t),u_attenuation:new e.bN(t),u_edge_radius:new e.bN(t),u_fb:new e.bO(t),u_fb_size:new e.bN(t)}),fill:t=>({u_matrix:new e.bK(t),u_emissive_strength:new e.bN(t)}),fillPattern:t=>({u_matrix:new e.bK(t),u_emissive_strength:new e.bN(t),u_image:new e.bO(t),u_texsize:new e.bL(t),u_pixel_coord_upper:new e.bL(t),u_pixel_coord_lower:new e.bL(t),u_tile_units_to_pixels:new e.bN(t)}),fillOutline:t=>({u_matrix:new e.bK(t),u_emissive_strength:new e.bN(t),u_world:new e.bL(t)}),fillOutlinePattern:t=>({u_matrix:new e.bK(t),u_emissive_strength:new e.bN(t),u_world:new e.bL(t),u_image:new e.bO(t),u_texsize:new e.bL(t),u_pixel_coord_upper:new e.bL(t),u_pixel_coord_lower:new e.bL(t),u_tile_units_to_pixels:new e.bN(t)}),circle:e.cs,collisionBox:t=>({u_matrix:new e.bK(t),u_camera_to_center_distance:new e.bN(t),u_extrude_scale:new e.bL(t)}),collisionCircle:t=>({u_matrix:new e.bK(t),u_inv_matrix:new e.bK(t),u_camera_to_center_distance:new e.bN(t),u_viewport_size:new e.bL(t)}),debug:t=>({u_color:new e.ca(t),u_matrix:new e.bK(t),u_overlay:new e.bO(t),u_overlay_scale:new e.bN(t)}),clippingMask:t=>({u_matrix:new e.bK(t)}),heatmap:t=>({u_extrude_scale:new e.bN(t),u_intensity:new e.bN(t),u_matrix:new e.bK(t),u_inv_rot_matrix:new e.bK(t),u_merc_center:new e.bL(t),u_tile_id:new e.bM(t),u_zoom_transition:new e.bN(t),u_up_dir:new e.bM(t)}),heatmapTexture:t=>({u_image:new e.bO(t),u_color_ramp:new e.bO(t),u_opacity:new e.bN(t)}),hillshade:t=>({u_matrix:new e.bK(t),u_image:new e.bO(t),u_latrange:new e.bL(t),u_light:new e.bL(t),u_shadow:new e.ca(t),u_highlight:new e.ca(t),u_emissive_strength:new e.bN(t),u_accent:new e.ca(t)}),hillshadePrepare:t=>({u_matrix:new e.bK(t),u_image:new e.bO(t),u_dimension:new e.bL(t),u_zoom:new e.bN(t)}),line:e.ct,linePattern:e.cu,raster:t=>({u_matrix:new e.bK(t),u_normalize_matrix:new e.bK(t),u_globe_matrix:new e.bK(t),u_merc_matrix:new e.bK(t),u_grid_matrix:new e.cb(t),u_tl_parent:new e.bL(t),u_scale_parent:new e.bN(t),u_fade_t:new e.bN(t),u_opacity:new e.bN(t),u_image0:new e.bO(t),u_image1:new e.bO(t),u_brightness_low:new e.bN(t),u_brightness_high:new e.bN(t),u_saturation_factor:new e.bN(t),u_contrast_factor:new e.bN(t),u_spin_weights:new e.bM(t),u_perspective_transform:new e.bL(t),u_raster_elevation:new e.bN(t),u_zoom_transition:new e.bN(t),u_merc_center:new e.bL(t),u_cutoff_params:new e.bP(t),u_colorization_mix:new e.bP(t),u_colorization_offset:new e.bN(t),u_color_ramp:new e.bO(t),u_texture_offset:new e.bL(t),u_texture_res:new e.bL(t),u_emissive_strength:new e.bN(t)}),rasterParticle:t=>({u_matrix:new e.bK(t),u_normalize_matrix:new e.bK(t),u_globe_matrix:new e.bK(t),u_merc_matrix:new e.bK(t),u_grid_matrix:new e.cb(t),u_tl_parent:new e.bL(t),u_scale_parent:new e.bN(t),u_fade_t:new e.bN(t),u_opacity:new e.bN(t),u_image0:new e.bO(t),u_image1:new e.bO(t),u_raster_elevation:new e.bN(t),u_zoom_transition:new e.bN(t),u_merc_center:new e.bL(t),u_cutoff_params:new e.bP(t)}),rasterParticleTexture:t=>({u_texture:new e.bO(t),u_opacity:new e.bN(t)}),rasterParticleDraw:t=>({u_tile_offset:new e.bL(t),u_velocity:new e.bO(t),u_color_ramp:new e.bO(t),u_velocity_res:new e.bL(t),u_max_speed:new e.bN(t),u_texture_offset:new e.bL(t),u_data_scale:new e.bP(t),u_data_offset:new e.bN(t)}),rasterParticleUpdate:t=>({u_velocity:new e.bO(t),u_velocity_res:new e.bL(t),u_max_speed:new e.bN(t),u_speed_factor:new e.bN(t),u_lifetime_delta:new e.bN(t),u_rand_seed:new e.bN(t),u_texture_offset:new e.bL(t),u_data_scale:new e.bP(t),u_data_offset:new e.bN(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new e.bO(t),u_is_size_feature_constant:new e.bO(t),u_size_t:new e.bN(t),u_size:new e.bN(t),u_camera_to_center_distance:new e.bN(t),u_rotate_symbol:new e.bO(t),u_aspect_ratio:new e.bN(t),u_fade_change:new e.bN(t),u_matrix:new e.bK(t),u_label_plane_matrix:new e.bK(t),u_coord_matrix:new e.bK(t),u_is_text:new e.bO(t),u_pitch_with_map:new e.bO(t),u_texsize:new e.bL(t),u_tile_id:new e.bM(t),u_zoom_transition:new e.bN(t),u_inv_rot_matrix:new e.bK(t),u_merc_center:new e.bL(t),u_camera_forward:new e.bM(t),u_tile_matrix:new e.bK(t),u_up_vector:new e.bM(t),u_ecef_origin:new e.bM(t),u_texture:new e.bO(t),u_icon_transition:new e.bN(t),u_icon_saturation:new e.bN(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new e.bO(t),u_is_size_feature_constant:new e.bO(t),u_size_t:new e.bN(t),u_size:new e.bN(t),u_camera_to_center_distance:new e.bN(t),u_rotate_symbol:new e.bO(t),u_aspect_ratio:new e.bN(t),u_fade_change:new e.bN(t),u_matrix:new e.bK(t),u_label_plane_matrix:new e.bK(t),u_coord_matrix:new e.bK(t),u_is_text:new e.bO(t),u_pitch_with_map:new e.bO(t),u_texsize:new e.bL(t),u_texture:new e.bO(t),u_gamma_scale:new e.bN(t),u_device_pixel_ratio:new e.bN(t),u_tile_id:new e.bM(t),u_zoom_transition:new e.bN(t),u_inv_rot_matrix:new e.bK(t),u_merc_center:new e.bL(t),u_camera_forward:new e.bM(t),u_tile_matrix:new e.bK(t),u_up_vector:new e.bM(t),u_ecef_origin:new e.bM(t),u_is_halo:new e.bO(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new e.bO(t),u_is_size_feature_constant:new e.bO(t),u_size_t:new e.bN(t),u_size:new e.bN(t),u_camera_to_center_distance:new e.bN(t),u_rotate_symbol:new e.bO(t),u_aspect_ratio:new e.bN(t),u_fade_change:new e.bN(t),u_matrix:new e.bK(t),u_label_plane_matrix:new e.bK(t),u_coord_matrix:new e.bK(t),u_is_text:new e.bO(t),u_pitch_with_map:new e.bO(t),u_texsize:new e.bL(t),u_texsize_icon:new e.bL(t),u_texture:new e.bO(t),u_texture_icon:new e.bO(t),u_gamma_scale:new e.bN(t),u_device_pixel_ratio:new e.bN(t),u_is_halo:new e.bO(t)}),background:t=>({u_matrix:new e.bK(t),u_emissive_strength:new e.bN(t),u_opacity:new e.bN(t),u_color:new e.ca(t)}),backgroundPattern:t=>({u_matrix:new e.bK(t),u_emissive_strength:new e.bN(t),u_opacity:new e.bN(t),u_image:new e.bO(t),u_pattern_tl:new e.bL(t),u_pattern_br:new e.bL(t),u_texsize:new e.bL(t),u_pattern_size:new e.bL(t),u_pixel_coord_upper:new e.bL(t),u_pixel_coord_lower:new e.bL(t),u_tile_units_to_pixels:new e.bN(t)}),terrainRaster:rr,terrainDepth:rr,skybox:t=>({u_matrix:new e.bK(t),u_sun_direction:new e.bM(t),u_cubemap:new e.bO(t),u_opacity:new e.bN(t),u_temporal_offset:new e.bN(t)}),skyboxGradient:t=>({u_matrix:new e.bK(t),u_color_ramp:new e.bO(t),u_center_direction:new e.bM(t),u_radius:new e.bN(t),u_opacity:new e.bN(t),u_temporal_offset:new e.bN(t)}),skyboxCapture:t=>({u_matrix_3f:new e.cb(t),u_sun_direction:new e.bM(t),u_sun_intensity:new e.bN(t),u_color_tint_r:new e.bP(t),u_color_tint_m:new e.bP(t),u_luminance:new e.bN(t)}),globeRaster:t=>({u_proj_matrix:new e.bK(t),u_globe_matrix:new e.bK(t),u_normalize_matrix:new e.bK(t),u_merc_matrix:new e.bK(t),u_zoom_transition:new e.bN(t),u_merc_center:new e.bL(t),u_image0:new e.bO(t),u_grid_matrix:new e.cb(t),u_skirt_height:new e.bN(t),u_far_z_cutoff:new e.bN(t),u_frustum_tl:new e.bM(t),u_frustum_tr:new e.bM(t),u_frustum_br:new e.bM(t),u_frustum_bl:new e.bM(t),u_globe_pos:new e.bM(t),u_globe_radius:new e.bN(t),u_viewport:new e.bL(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.bM(t),u_frustum_tr:new e.bM(t),u_frustum_br:new e.bM(t),u_frustum_bl:new e.bM(t),u_horizon:new e.bN(t),u_transition:new e.bN(t),u_fadeout_range:new e.bN(t),u_color:new e.bP(t),u_high_color:new e.bP(t),u_space_color:new e.bP(t),u_temporal_offset:new e.bN(t),u_horizon_angle:new e.bN(t)}),model:t=>({u_matrix:new e.bK(t),u_lighting_matrix:new e.bK(t),u_normal_matrix:new e.bK(t),u_lightpos:new e.bM(t),u_lightintensity:new e.bN(t),u_lightcolor:new e.bM(t),u_camera_pos:new e.bM(t),u_opacity:new e.bN(t),u_baseColorFactor:new e.bP(t),u_emissiveFactor:new e.bP(t),u_metallicFactor:new e.bN(t),u_roughnessFactor:new e.bN(t),u_baseTextureIsAlpha:new e.bO(t),u_alphaMask:new e.bO(t),u_alphaCutoff:new e.bN(t),u_baseColorTexture:new e.bO(t),u_metallicRoughnessTexture:new e.bO(t),u_normalTexture:new e.bO(t),u_occlusionTexture:new e.bO(t),u_emissionTexture:new e.bO(t),u_color_mix:new e.bP(t),u_aoIntensity:new e.bN(t),u_emissive_strength:new e.bN(t),u_occlusionTextureTransform:new e.bP(t)}),modelDepth:t=>({u_matrix:new e.bK(t),u_instance:new e.bK(t),u_node_matrix:new e.bK(t)}),groundShadow:t=>({u_matrix:new e.bK(t),u_ground_shadow_factor:new e.bM(t)}),stars:t=>({u_matrix:new e.bK(t),u_up:new e.bM(t),u_right:new e.bM(t),u_intensity_multiplier:new e.bN(t)})};let Jr;function Qr(t,i,n,r,s,o,a){const l=t.context,c=l.gl,u=t.transform,h=t.getOrCreateProgram("collisionBox"),d=[];let p=0,f=0;for(let l=0;l<r.length;l++){const m=r[l],g=i.getTile(m),_=g.getBucket(n);if(!_)continue;const y=Li(m,_,u);let v=y;0===s[0]&&0===s[1]||(v=t.translatePosMatrix(y,g,s,o));const x=a?_.textCollisionBox:_.iconCollisionBox,b=_.collisionCircleArray;if(b.length>0){const t=e.a6.create(),i=v;e.a6.mul(t,_.placementInvProjMatrix,u.glCoordMatrix),e.a6.mul(t,t,_.placementViewportMatrix),d.push({circleArray:b,circleOffset:f,transform:i,invTransform:t,projection:_.getProjection()}),p+=b.length/4,f=p}x&&(t.terrain&&t.terrain.setupElevationDraw(g,h),h.draw(t,c.LINES,Ct.disabled,kt.disabled,t.colorModeForRenderPass(),Nt.disabled,kr(v,u,g,_.getProjection()),n.id,x.layoutVertexBuffer,x.indexBuffer,x.segments,null,u.zoom,null,[x.collisionVertexBuffer,x.collisionVertexBufferExt]))}if(!a||!d.length)return;const m=t.getOrCreateProgram("collisionCircle"),g=new e.cv;g.resize(4*p),g._trim();let _=0;for(const e of d)for(let t=0;t<e.circleArray.length/4;t++){const i=4*t,n=e.circleArray[i+0],r=e.circleArray[i+1],s=e.circleArray[i+2],o=e.circleArray[i+3];g.emplace(_++,n,r,s,o,0),g.emplace(_++,n,r,s,o,1),g.emplace(_++,n,r,s,o,2),g.emplace(_++,n,r,s,o,3)}(!Jr||Jr.length<2*p)&&(Jr=function(t){const i=2*t,n=new e.aw;n.resize(i),n._trim();for(let e=0;e<i;e++){const t=6*e;n.uint16[t+0]=4*e+0,n.uint16[t+1]=4*e+1,n.uint16[t+2]=4*e+2,n.uint16[t+3]=4*e+2,n.uint16[t+4]=4*e+3,n.uint16[t+5]=4*e+0}return n}(p));const y=l.createIndexBuffer(Jr,!0),v=l.createVertexBuffer(g,e.cw.members,!0);for(const i of d){const r={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(x=u).getCameraToCenterDistance(i.projection),u_viewport_size:[x.width,x.height]};m.draw(t,c.TRIANGLES,Ct.disabled,kt.disabled,t.colorModeForRenderPass(),Nt.disabled,r,n.id,v,y,e.aB.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,u.zoom)}var x;v.destroy(),y.destroy()}const es=e.a6.create();function ts(t){const i=t._camera.getWorldToCamera(t.worldSize,1),n=e.a6.multiply([],i,t.globeMatrix);e.a6.invert(n,n);const r=[0,0,0],s=[0,1,0,0];return e.a7.transformMat4(s,s,n),r[0]=s[0],r[1]=s[1],r[2]=s[2],e.N.normalize(r,r),r}function is({width:t,height:i,anchor:n,textOffset:r,textScale:s},o){const{horizontalAlign:a,verticalAlign:l}=e.bf(n),c=-(a-.5)*t,u=-(l-.5)*i,h=e.bd(n,r);return new e.P((c/s+h[0])*o,(u/s+h[1])*o)}function ns(t,i,n,r,s,o,a,l,c,u,h){const d=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,m={},g=t.getProjection(),_=Di(l,g,o),y=o.elevation,v=g.upVectorScale(l.canonical,o.center.lat,o.worldSize).metersToTile;p.clear();for(let f=0;f<d.length;f++){const x=d.get(f),{tileAnchorX:b,tileAnchorY:w,numGlyphs:S}=x,T=x.hidden||!x.crossTileID||t.allowVerticalPlacement&&!x.placedOrientation?null:r[x.crossTileID];if(T){let r=0,d=0,f=0;if(y){const e=y?y.getAtTileOffset(l,b,w):0,[t,i,n]=g.upVector(l.canonical,b,w);r=e*t*v,d=e*i*v,f=e*n*v}let[E,M,I,A]=yi(x.projectedAnchorX+r,x.projectedAnchorY+d,x.projectedAnchorZ+f,n?_:a);const C=vi(o.getCameraToCenterDistance(g),A);let P=s.evaluateSizeForFeature(t.textSizeData,u,x)*C/e.bc;n&&(P*=t.tilePixelRatio/c);const k=is(T,P);n?(({x:E,y:M,z:I}=g.projectTilePoint(b+k.x,w+k.y,l.canonical)),[E,M,I]=yi(E+r,M+d,I+f,a)):(i&&k._rotate(-o.angle),E+=k.x,M+=k.y,I=0);const R=t.allowVerticalPlacement&&x.placedOrientation===e.b6.vertical?Math.PI/2:0;for(let t=0;t<S;t++)e.b9(p,E,M,I,R);h&&x.associatedIconIndex>=0&&(m[x.associatedIconIndex]={x:E,y:M,z:I,angle:R})}else Ai(S,p)}if(h){f.clear();const i=t.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const n=i.get(t),{numGlyphs:r}=n,s=m[t];if(n.hidden||!s)Ai(r,f);else{const{x:t,y:i,z:n,angle:o}=s;for(let s=0;s<r;s++)e.b9(f,t,i,n,o)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function rs(t,i,n,r,s,o,a={}){const l=n.paint.get("icon-translate"),c=n.paint.get("text-translate"),u=n.paint.get("icon-translate-anchor"),h=n.paint.get("text-translate-anchor"),d=n.layout.get("icon-rotation-alignment"),p=n.layout.get("text-rotation-alignment"),f=n.layout.get("icon-pitch-alignment"),m=n.layout.get("text-pitch-alignment"),g=n.layout.get("icon-keep-upright"),_=n.layout.get("text-keep-upright"),y=n.paint.get("icon-color-saturation"),v=t.context,x=v.gl,b=t.transform,w="map"===d,S="map"===p,T="map"===f,E="map"===m,M=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let I=!1;const A=t.depthModeForSublayer(0,Ct.ReadOnly),C=[e.a5(b.center.lng),e.ae(b.center.lat)],P=n.layout.get("text-variable-anchor"),k="globe"===b.projection.name,R=[],L=[0,-1,0];for(const s of r){const r=i.getTile(s),o=r.getBucket(n);if(!o)continue;if("mercator"===o.projection.name&&k)continue;if(o.fullyClipped)continue;const d="globe"===o.projection.name,p=d?e.S(b.zoom):0,f=Di(s,o.getProjection(),b),m=b.calculatePixelsToTileUnitsMatrix(r),v=P&&o.hasTextData(),A=o.hasIconTextFit()&&v&&o.hasIconData(),D=o.getProjection().createInversionMatrix(b,s.canonical),O=()=>{const i=w&&"point"!==n.layout.get("symbol-placement"),a=[],c=i||A,h=n.paint.get("icon-image-cross-fade").constantOr(0);t.terrainRenderModeElevated()&&T&&a.push("PITCH_WITH_MAP_TERRAIN"),d&&(a.push("PROJECTION_GLOBE_VIEW"),c&&a.push("PROJECTED_POS_ON_VIEWPORT")),h>0&&a.push("ICON_TRANSITION"),o.icon.zOffsetVertexBuffer&&a.push("Z_OFFSET"),y<1&&a.push("SATURATION");const _=o.icon.programConfigurations.get(n.id),v=t.getOrCreateProgram(o.sdfIcons?"symbolSDF":"symbolIcon",{config:_,defines:a});let S;const E=r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],M=o.iconSizeData,I=e.b5(M,b.zoom),P=T||0!==b.pitch,R=mi(f,r.tileID.canonical,T,w,b,o.getProjection(),m),O=_i(f,r.tileID.canonical,T,w,b,o.getProjection(),m),N=t.translatePosMatrix(O,r,l,u,!0),z=t.translatePosMatrix(f,r,l,u),F=c?es:R,B=w&&!T&&!i;let U=L;!k&&!b.mercatorFromTransition||w||(U=ts(b));const V=d?U:L;S=o.sdfIcons&&!o.iconsInText?Hr(M.kind,I,B,T,t,z,F,N,!1,E,!0,s,p,C,D,V,o.getProjection()):Gr(M.kind,I,B,T,t,z,F,N,!1,E,s,p,C,D,V,o.getProjection(),y,h);const j=r.imageAtlasTexture?r.imageAtlasTexture:null,G=1!==n.layout.get("icon-size").constantOr(0)||o.iconsNeedLinear,H=o.sdfIcons||t.options.rotating||t.options.zooming||G||P?x.LINEAR:x.NEAREST,W=o.sdfIcons&&0!==n.paint.get("icon-halo-width").constantOr(1),q=t.terrain&&T&&i?e.a6.invert(e.a6.create(),R):es;if(i&&o.icon){const e=b.elevation,i=e?e.getAtTileOffsetFunc(s,b.center.lat,b.worldSize,o.getProjection()):null,n=gi(f,r.tileID.canonical,T,w,b,o.getProjection(),m);bi(o,f,t,!1,n,O,T,g,i,s)}return{program:v,buffers:o.icon,uniformValues:S,atlasTexture:j,atlasTextureIcon:null,atlasInterpolation:H,atlasInterpolationIcon:null,isSDF:o.sdfIcons,hasHalo:W,tile:r,labelPlaneMatrixInv:q}},N=()=>{const i=S&&"point"!==n.layout.get("symbol-placement"),a=[],l=i||P||A;t.terrainRenderModeElevated()&&E&&a.push("PITCH_WITH_MAP_TERRAIN"),d&&(a.push("PROJECTION_GLOBE_VIEW"),l&&a.push("PROJECTED_POS_ON_VIEWPORT")),o.text.zOffsetVertexBuffer&&a.push("Z_OFFSET");const u=o.text.programConfigurations.get(n.id),g=t.getOrCreateProgram(o.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:u,defines:a});let y,v=[0,0],w=null;const T=o.textSizeData;o.iconsInText&&(v=r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],w=r.imageAtlasTexture?r.imageAtlasTexture:null,y=E||0!==b.pitch||t.options.rotating||t.options.zooming||"composite"===T.kind||"camera"===T.kind?x.LINEAR:x.NEAREST);const M=r.glyphAtlasTexture?r.glyphAtlasTexture.size:[0,0],I=e.b5(T,b.zoom),R=mi(f,r.tileID.canonical,E,S,b,o.getProjection(),m),O=_i(f,r.tileID.canonical,E,S,b,o.getProjection(),m),N=t.translatePosMatrix(O,r,c,h,!0),z=t.translatePosMatrix(f,r,c,h),F=l?es:R,B=S&&!E&&!i;let U=L;!k&&!b.mercatorFromTransition||S||(U=ts(b));const V=d?U:L;let j;j=o.iconsInText?Wr(T.kind,I,B,E,t,z,F,N,M,v,s,p,C,D,V,o.getProjection()):Hr(T.kind,I,B,E,t,z,F,N,!0,M,!0,s,p,C,D,V,o.getProjection());const G=r.glyphAtlasTexture?r.glyphAtlasTexture:null,H=x.LINEAR,W=0!==n.paint.get("text-halo-width").constantOr(1),q=t.terrain&&E&&i?e.a6.invert(e.a6.create(),R):es;if(i&&o.text){const e=b.elevation,i=e?e.getAtTileOffsetFunc(s,b.center.lat,b.worldSize,o.getProjection()):null,n=gi(f,r.tileID.canonical,E,S,b,o.getProjection(),m);bi(o,f,t,!0,n,O,E,_,i,s)}return{program:g,buffers:o.text,uniformValues:j,atlasTexture:G,atlasTextureIcon:w,atlasInterpolation:H,atlasInterpolationIcon:y,isSDF:!0,hasHalo:W,tile:r,labelPlaneMatrixInv:q}},z=o.icon.segments.get().length,F=o.text.segments.get().length,B=z&&!a.onlyText?O():null,U=F&&!a.onlyIcons?N():null,V=n.paint.get("icon-opacity").constantOr(1),j=n.paint.get("text-opacity").constantOr(1);if(M&&o.canOverlap){I=!0;const t=V&&!a.onlyText?o.icon.segments.get():[],i=j&&!a.onlyIcons?o.text.segments.get():[];for(const i of t)R.push({segments:new e.aB([i]),sortKey:i.sortKey,state:B});for(const t of i)R.push({segments:new e.aB([t]),sortKey:t.sortKey,state:U})}else a.onlyText||R.push({segments:V?o.icon.segments:new e.aB([]),sortKey:0,state:B}),a.onlyIcons||R.push({segments:j?o.text.segments:new e.aB([]),sortKey:0,state:U})}I&&R.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of R){const i=e.state;if(i)if(t.terrain&&t.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:b.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:i.labelPlaneMatrixInv}),v.activeTexture.set(x.TEXTURE0),i.atlasTexture&&i.atlasTexture.bind(i.atlasInterpolation,x.CLAMP_TO_EDGE,!0),i.atlasTextureIcon&&(v.activeTexture.set(x.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,x.CLAMP_TO_EDGE,!0)),t.uploadCommonLightUniforms(t.context,i.program),i.hasHalo){const r=i.uniformValues;r.u_is_halo=1,ss(i.buffers,e.segments,n,t,i.program,A,s,o,r,2),r.u_is_halo=0}else{if(i.isSDF){const r=i.uniformValues;i.hasHalo&&(r.u_is_halo=1,ss(i.buffers,e.segments,n,t,i.program,A,s,o,r,1)),r.u_is_halo=0}ss(i.buffers,e.segments,n,t,i.program,A,s,o,i.uniformValues,1)}}}function ss(e,t,i,n,r,s,o,a,l,c){const u=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];r.draw(n,n.context.gl.TRIANGLES,s,o,a,Nt.disabled,l,i.id,e.layoutVertexBuffer,e.indexBuffer,t,i.paint,n.transform.zoom,e.programConfigurations.get(i.id),u,c)}function os(e,t,i,n,r,s,o){const a=e.context.gl,l=i.paint.get("fill-pattern"),c=l&&l.constantOr(1);let u,h,d,p,f;o?(h=c&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",u=a.LINES):(h=c?"fillPattern":"fill",u=a.TRIANGLES);for(const m of n){const n=t.getTile(m);if(c&&!n.patternsLoaded())continue;const g=n.getBucket(i);if(!g)continue;e.prepareDrawTile();const _=g.programConfigurations.get(i.id),y=e.isTileAffectedByFog(m),v=e.getOrCreateProgram(h,{config:_,overrideFog:y});c&&(e.context.activeTexture.set(a.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),_.updatePaintBuffers());const x=l.constantOr(null);if(x&&n.imageAtlas){const e=n.imageAtlas.patternPositions[x.toString()];e&&_.setConstantPatternPositions(e)}const b=e.translatePosMatrix(m.projMatrix,n,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),w=i.paint.get("fill-emissive-strength");if(o){p=g.indexBuffer2,f=g.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[a.drawingBufferWidth,a.drawingBufferHeight];d="fillOutlinePattern"===h&&c?Pr(b,w,e,n,t):Cr(b,w,t)}else p=g.indexBuffer,f=g.segments,d=c?Ar(b,w,e,n):Ir(b,w);e.uploadCommonUniforms(e.context,v,m.toUnwrapped()),v.draw(e,u,r,e.stencilModeForClipping(m),s,Nt.disabled,d,i.id,g.layoutVertexBuffer,p,f,i.paint,e.transform.zoom,_,void 0)}}function as(t,i,n,r,s,o,a,l){n.resetLayerRenderingStats(t);const c=t.context,u=c.gl,h=t.transform,d=n.paint.get("fill-extrusion-pattern"),p=d.constantOr(1),f=n.paint.get("fill-extrusion-opacity"),m=t.style.enable3dLights(),g=n.paint.get(m&&!p?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),g],y=n.layout.get("fill-extrusion-edge-radius"),v=y>0&&!n.paint.get("fill-extrusion-rounded-roof"),x=v?0:y,b="globe"===h.projection.name?e.cF():0,w="globe"===h.projection.name,S=w?e.S(h.zoom):0,T=[e.a5(h.center.lng),e.ae(h.center.lat)],E=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),M=n.paint.get("fill-extrusion-flood-light-intensity"),I=n.paint.get("fill-extrusion-vertical-scale"),A=yn(t,n.paint.get("fill-extrusion-cutoff-fade-range")),C=n.paint.get("fill-extrusion-emissive-strength"),P=[];let k;w&&P.push("PROJECTION_GLOBE_VIEW"),_[0]>0&&P.push("FAUX_AO"),v&&P.push("ZERO_ROOF_RADIUS"),l&&P.push("HAS_CENTROID"),M>0&&P.push("FLOOD_LIGHT"),A.shouldRenderCutoff&&P.push("RENDER_CUTOFF");const R="shadow"===t.renderPass,L=t.shadowRenderer,D=R&&!!L;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let O=[0,0,0];if(L){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(O=En(e,i)),k=P.concat(["SHADOWS_SINGLE_CASCADE"])}const N=D?"fillExtrusionDepth":p?"fillExtrusionPattern":"fillExtrusion",z=n.getLayerRenderingStats();for(const e of r){const r=i.getTile(e),m=r.getBucket(n);if(!m||m.projection.name!==h.projection.name)continue;let g=!1;L&&(g=0===L.getMaxCascadeForTile(e.toUnwrapped()));const y=t.isTileAffectedByFog(e),v=m.programConfigurations.get(n.id),D=t.getOrCreateProgram(N,{config:v,defines:g?k:P,overrideFog:y});if(t.terrain&&t.terrain.setupElevationDraw(r,D,{useMeterToDem:!0}),!m.centroidVertexBuffer){const e=D.attributes.a_centroid_pos;void 0!==e&&u.vertexAttrib2f(e,0,0)}!R&&L&&L.setupShadows(r.tileID.toUnwrapped(),D,"vector-tile",r.tileID.overscaledZ),p&&(t.context.activeTexture.set(u.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),v.updatePaintBuffers());const F=d.constantOr(null);if(F&&r.imageAtlas){const e=r.imageAtlas.patternPositions[F.toString()];e&&v.setConstantPatternPositions(e)}const B=n.paint.get("fill-extrusion-vertical-gradient");let U;if(R&&L){if(ps(r.tileID,m,t))continue;const e=L.calculateShadowPassMatrixFromTile(r.tileID.toUnwrapped());U=Er(e,x,I)}else{const i=t.translatePosMatrix(e.expandedProjMatrix,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),s=h.projection.createInversionMatrix(h,e.canonical);U=p?Mr(i,t,B,f,_,x,e,r,b,S,T,s,E,I):Tr(i,t,B,f,_,x,e,b,S,T,s,E,I,M,O,C)}t.uploadCommonUniforms(c,D,e.toUnwrapped(),null,A);let V=m.segments;if("mercator"===h.projection.name&&!R&&(V=m.getVisibleSegments(r.tileID,t.terrain,t.transform.getFrustum(0)),!V.get().length))continue;if(z)if(R)for(const e of V.get())z.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(const e of V.get())z.numRenderedVerticesInTransparentPass+=e.primitiveLength;const j=[];(t.terrain||l)&&j.push(m.centroidVertexBuffer),w&&j.push(m.layoutVertexExtBuffer),D.draw(t,c.gl.TRIANGLES,s,o,a,Nt.backCCW,U,n.id,m.layoutVertexBuffer,m.indexBuffer,V,n.paint,t.transform.zoom,v,j)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function ls(t,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,v){const x=t.context,b=x.gl,w=t.transform,S=t.transform.zoom,T=[],E=yn(t,n.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===u?(T.push("CLEAR_SUBPASS"),v&&(T.push("CLEAR_FROM_TEXTURE"),x.activeTexture.set(b.TEXTURE0),v.bind(b.LINEAR,b.CLAMP_TO_EDGE))):"sdf"===u&&T.push("SDF_SUBPASS"),_&&T.push("HAS_CENTROID"),E.shouldRenderCutoff&&T.push("RENDER_CUTOFF");const M=n.layout.get("fill-extrusion-edge-radius"),I=(e,i,r,u,y)=>{const b=i.programConfigurations.get(n.id),w=t.isTileAffectedByFog(e),I=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:b,defines:T,overrideFog:w}),A=((e,t,i,n,r,s,o,a,l,c,u)=>({u_matrix:t,u_opacity:i,u_ao_pass:n?1:0,u_meter_to_tile:r,u_ao:s,u_flood_light_intensity:o,u_flood_light_color:a,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u}))(0,u,h,c,y,[d,p*y],f,m,g,S>=17?0:M*y,v?v.size[0]:0),C=[];_&&C.push(i.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(x,I,e.toUnwrapped(),null,E),I.draw(t,x.gl.TRIANGLES,s,o,a,l,A,n.id,i.vertexBuffer,i.indexBuffer,r,n.paint,S,b,C)};for(const s of r){const r=i.getTile(s),o=r.getBucket(n);if(!o||o.projection.name!==w.projection.name||!o.groundEffect||o.groundEffect&&!o.groundEffect.hasData())continue;const a=o.groundEffect,l=1/o.tileToMeter;{const e=t.translatePosMatrix(s.projMatrix,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),i=a.getDefaultSegment();I(s,a,i,e,l)}if(y)for(let o=0;o<4;o++){const a=e.cG[o](s),c=i.getTile(a);if(!c)continue;const u=c.getBucket(n);if(!u||u.projection.name!==w.projection.name||!u.groundEffect||u.groundEffect&&!u.groundEffect.hasData())continue;const h=u.groundEffect;let d,p;0===o?(d=[-e.V,0,0],p=1):1===o?(d=[e.V,0,0],p=0):2===o?(d=[0,-e.V,0],p=3):(d=[0,e.V,0],p=2);const f=h.regionSegments[p];if(!f)continue;const m=new Float32Array(16);e.a6.translate(m,s.projMatrix,d),I(s,h,f,t.translatePosMatrix(m,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),l)}}}function cs(t,i,n,r,s,o,a){0===r.centroidVertexArray.length&&r.createCentroidsBuffer();const l=o?o.findDEMTileFor(n):null;if(!(l&&l.dem||a))return;const c=t=>new e.P(Math.ceil((t+e.cJ)*e.cK),0),u=e=>{const t=i.getSource().minzoom,n=e=>{const t=i.getTileByID(e);if(t&&t.hasData())return t.getBucket(s)},r=[0,-1,1];for(const i of r){if(e.overscaledZ+i<t)continue;const r=n(e.calculateScaledKey(e.overscaledZ+i));if(r)return r}},h=[0,0,0],d=(t,i)=>(h[0]=Math.min(t.min.y,i.min.y),h[1]=Math.max(t.max.y,i.max.y),h[2]=e.V-i.min.x>t.max.x?i.min.x-e.V:t.max.x,h),p=(t,i)=>(h[0]=Math.min(t.min.x,i.min.x),h[1]=Math.max(t.max.x,i.max.x),h[2]=e.V-i.min.y>t.max.y?i.min.y-e.V:t.max.y,h),f=[(e,t)=>d(e,t),(e,t)=>d(t,e),(e,t)=>p(e,t),(e,t)=>p(t,e)],m=(t,i,r,s,a,c,u)=>{if(!o)return 0;const h=[[c?r:t,c?t:r,0],[c?r:i,c?i:r,0]],d=u<0?e.V+u:u,p=[c?d:(t+i)/2,c?(t+i)/2:d,0];return 0===r&&u<0||0!==r&&u>0?o.getForTilePoints(a,[p],!0,s):h.push(p),o.getForTilePoints(n,h,!0,l),Math.max(h[0][2],h[1][2],p[2])/o.exaggeration()};for(let t=0;t<4;t++){const i=r.borderFeatureIndices[t];if(0===i.length)continue;const s=e.cG[t](n),l=u(s);if(!(l&&l instanceof e.cH))continue;if(r.borderDoneWithNeighborZ[t]===l.canonical.z)continue;0===l.centroidVertexArray.length&&l.createCentroidsBuffer();const h=o?o.findDEMTileFor(s):null;if(!(h&&h.dem||a))continue;const d=(t<2?1:5)-t,p=l.borderDoneWithNeighborZ[d]!==r.canonical.z,y=l.borderFeatureIndices[d];let v=0;if(r.canonical.z!==l.canonical.z){for(const e of i)r.showCentroid(r.featuresOnBorder[e]);if(p)for(const e of y)l.showCentroid(l.featuresOnBorder[e]);r.borderDoneWithNeighborZ[t]=l.canonical.z,l.borderDoneWithNeighborZ[d]=r.canonical.z}for(const n of i){const i=r.featuresOnBorder[n],o=r.centroidData[i.centroidDataIndex],u=i.borders[t];let p;for(;v<y.length;){p=l.featuresOnBorder[y[v]];const e=p.borders[d];if(e[1]>u[0]+3||e[0]>u[0]-3)break;l.showCentroid(p),v++}if(p&&v<y.length){const n=v;let x=0;for(;!(p.borders[d][0]>u[1]-3)&&(x++,++v!==y.length);)p=l.featuresOnBorder[y[v]];if(p=l.featuresOnBorder[y[n]],x>1){const e=p.borders[d];Math.abs(u[0]-e[0])<3&&Math.abs(u[1]-e[1])<3&&(x=1,v=n+1)}else if(0===x){r.showCentroid(i);continue}const b=l.centroidData[p.centroidDataIndex];a&&1===x&&(((g=o).flags|(_=b).flags)&e.cI?(g.flags|=e.cI,_.flags|=e.cI):(g.flags&=~e.cI,_.flags&=~e.cI));const w=i.intersectsCount()>1||p.intersectsCount()>1;if(x>1)v=n,o.centroidXY=b.centroidXY=new e.P(0,0);else if(h&&h.dem&&!w){const i=f[t](o,b),n=t%2?e.V-1:0,r=m(i[0],Math.min(e.V-1,i[1]),n,h,s,t<2,i[2]);o.centroidXY=b.centroidXY=c(r)}else w?o.centroidXY=b.centroidXY=new e.P(0,0):(o.centroidXY=r.encodeBorderCentroid(i),b.centroidXY=l.encodeBorderCentroid(p));r.writeCentroidToBuffer(o),l.writeCentroidToBuffer(b)}else r.showCentroid(i)}r.borderDoneWithNeighborZ[t]=l.canonical.z,l.borderDoneWithNeighborZ[d]=r.canonical.z}var g,_;(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(t)}const us=[1,0,0],hs=[0,1,0],ds=[0,0,1];function ps(t,i,n){const r=n.transform,s=n.shadowRenderer;if(!s)return!0;const o=t.toUnwrapped(),a=r.tileSize*s._cascades[n.currentShadowCascade].scale;let l=i.maxHeight;if(r.elevation){const e=r.elevation.getMinMaxForTile(t);e&&(l+=e.max)}const c=[...s.shadowDirection];c[2]=-c[2];const u=s.computeSimplifiedTileShadowVolume(o,l,a,c);if(!u)return!1;const h=[us,hs,ds,c,[c[0],0,c[2]],[0,c[1],c[2]]],d="globe"===r.projection.name,p=r.scaleZoom(a),f=e.bq.fromInvProjectionMatrix(r.invProjMatrix,r.worldSize,p,!d),m=s.getCurrentCascadeFrustum();return 0===f.intersectsPrecise(u.vertices,u.planes,h)||0===m.intersectsPrecise(u.vertices,u.planes,h)}function fs(t){return[t[0]*e.cL,t[1]*e.cL,t[2]*e.cL,0]}function ms(t,i,n,r,s,o,a,l,c){const u=r.getSource(),h=n.globeSharedBuffers;if(!h)return;let d,p,f;if(i&&(d=r.getTile(i)),u instanceof e.ap?(p=u.texture,f=e.cj(0,0,n.transform)):d&&i&&(p=d.texture,f=e.cj(i.canonical.z,i.canonical.x,n.transform)),!p||!f)return;t||(f=e.a6.scale(e.a6.create(),f,[1,-1,1]));const m=n.context,g=m.gl,_="nearest"===s.paint.get("raster-resampling")?g.NEAREST:g.LINEAR,y=n.colorModeForDrapableLayerRenderPass(o),v=a.defines;v.push("GLOBE_POLES");const x=new Ct(g.LEQUAL,Ct.ReadWrite,n.depthRangeFor3D),b=Float32Array.from(n.transform.expandedFarZProjMatrix),w=Float32Array.from(e.aT(e.ci(new e.bs(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),m.activeTexture.set(g.TEXTURE0),p.bind(_,g.CLAMP_TO_EDGE),m.activeTexture.set(g.TEXTURE1),p.bind(_,g.CLAMP_TO_EDGE),p.useMipmap&&m.extTextureFilterAnisotropic&&n.transform.pitch>20&&g.texParameterf(g.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax);const[S,T,E,M]=i?h.getPoleBuffers(i.canonical.z,!1):h.getPoleBuffers(0,!0),I=s.paint.get("raster-elevation");let A;t?(A=S,n.renderDefaultNorthPole=0!==I):(A=T,n.renderDefaultSouthPole=0!==I);const C=fs(a.mix),P=((e,t,i,n,r,s,o,a,l,c,u,h,d)=>zr(e,t,i,new Float32Array(16),new Float32Array(9),[0,0],n,[0,0],[0,0,0,0],1,{opacity:1,mix:0},s,[0,0]||0,a,2,c,u,h,1,0,d))(b,w,f,e.S(n.transform.zoom),0,s,0,I,0,C,a.offset,a.range,o),k=n.getOrCreateProgram("raster",{defines:v});n.uploadCommonUniforms(m,k,null),k.draw(n,g.TRIANGLES,x,c,y,l,P,s.id,A,E,M)}function gs(e){const t=e._nearZ,i=e.projection.farthestPixelDistance(e),n=i-t,r=.2*e.height,s=t+r;return[t,i,(s-r-t)/n,(s-t)/n]}function _s(e,t,i,n){if(e)return t instanceof De&&e instanceof Zt?t.getTextureDescriptor(e,i,!0):{texture:e.texture,mix:fs(n.mix),offset:n.offset,buffer:0,tileSize:1}}function ys(t,i,n){if(!t)return null;const r=i.getTextureDescriptor(t,n,!0);if(!r)return null;let{texture:s,mix:o,offset:a,tileSize:l,buffer:c,format:u}=r;if(!s||!u)return null;let h=!1;return"uint32"===u&&(h=!0,o[3]=0,o=Or(e.cM,o,[0,n.paint.get("raster-particle-max-speed")]),a=Nr(e.cM,a,[0,n.paint.get("raster-particle-max-speed")])),{texture:s,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:h,scale:o,offset:a,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[u]]}}function vs(e){const t=e._nearZ,i=e.projection.farthestPixelDistance(e),n=i-t,r=.2*e.height,s=t+r;return[t,i,(s-r-t)/n,(s-t)/n]}const xs=new e.ax(1,0,0,1),bs=new e.ax(0,1,0,1),ws=new e.ax(0,0,1,1),Ss=new e.ax(1,0,1,1),Ts=new e.ax(0,1,1,1);function Es(t,i,n,r,s,o,a){const l=t.context,c=t.transform,u=l.gl,h="globe"===c.projection.name,d=h?["PROJECTION_GLOBE_VIEW"]:[];let p=e.a6.clone(n.projMatrix);if(h&&e.S(c.zoom)>0){const t=e.aS(n.canonical,c),i=e.cN(t);p=e.a6.multiply(new Float32Array(16),c.globeMatrix,i),e.a6.multiply(p,c.projMatrix,p)}const f=e.a6.create();f[12]+=2*s/(e.f.devicePixelRatio*c.width),f[13]+=2*o/(e.f.devicePixelRatio*c.height),e.a6.multiply(p,f,p);const m=t.getOrCreateProgram("debug",{defines:d}),g=i.getTileByID(n.key);t.terrain&&t.terrain.setupElevationDraw(g,m);const _=Ct.disabled,y=kt.disabled,v=t.colorModeForRenderPass(),x="$debug";l.activeTexture.set(u.TEXTURE0),t.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),h?g._makeGlobeTileDebugBuffers(t.context,c):g._makeDebugTileBoundsBuffers(t.context,c.projection);const b=g._tileDebugBuffer||t.debugBuffer,w=g._tileDebugIndexBuffer||t.debugIndexBuffer,S=g._tileDebugSegments||t.debugSegments;if(m.draw(t,u.LINE_STRIP,_,y,v,Nt.disabled,Rr(p,r),x,b,w,S,null,null,null,[g._globeTileDebugBorderBuffer]),a){const e=g.latestRawTileData,i=Math.floor((e&&e.byteLength||0)/1024);let r=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(r+=` => ${n.overscaledZ}`),r+=` ${g.state}`,r+=` ${i}kb`,function(e,t){e.initDebugOverlayCanvas();const i=e.debugOverlayCanvas,n=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,i.width,i.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(i),e.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(t,r)}const T=i.getTile(n).tileSize,E=512/Math.min(T,512)*(n.overscaledZ/c.zoom)*.5,M=g._tileDebugTextBuffer||t.debugBuffer,I=g._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,A=g._tileDebugTextSegments||t.debugSegments;m.draw(t,u.TRIANGLES,_,y,Lt.alphaBlended,Nt.disabled,Rr(p,e.ax.transparent,E),x,M,I,A,null,null,null,[g._globeTileDebugTextBuffer])}function Ms(e,t,i,n){As(e,0,t+i/2,e.transform.width,i,n)}function Is(e,t,i,n){As(e,t-i/2,0,i,e.transform.height,n)}function As(t,i,n,r,s,o){const a=t.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*e.f.devicePixelRatio,n*e.f.devicePixelRatio,r*e.f.devicePixelRatio,s*e.f.devicePixelRatio),a.clear({color:o}),l.disable(l.SCISSOR_TEST)}const Cs=e.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ps}=Cs;function ks(e,t,i,n){e.emplaceBack(t,i,n)}class Rs{constructor(t){this.vertexArray=new e.az,this.indices=new e.aw,ks(this.vertexArray,-1,-1,1),ks(this.vertexArray,1,-1,1),ks(this.vertexArray,-1,1,1),ks(this.vertexArray,1,1,1),ks(this.vertexArray,-1,-1,-1),ks(this.vertexArray,1,-1,-1),ks(this.vertexArray,-1,1,-1),ks(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Ps),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.aB.simpleSegment(0,0,36,12)}}function Ls(t,i,n,r,s,o){const a=t.context.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),u=i.paint.get("sky-atmosphere-sun-intensity"),h=((e,t,i,n,r)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:i,u_color_tint_r:[n.r,n.g,n.b,n.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(e.co.fromMat4(e.co.create(),r),s,u,l,c);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+o,i.skyboxTexture,0),n.draw(t,a.TRIANGLES,Ct.disabled,kt.disabled,Lt.unblended,Nt.frontCW,h,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Ds=e.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Os{constructor(t){const i=new e.cO;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const n=new e.aw;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,Ds.members),this.indexBuffer=t.createIndexBuffer(n),this.segments=e.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ns=e.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class zs{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Fs{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Lt([1,Rt,1,Rt],e.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Lt([1,0,1,0],e.ax.transparent,[!1,!1,!1,!0]),this.params=new zs,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(t){const i=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Os(i);const t=this.params.sizeRange,n=this.params.intensityRange,r=function(t){const i=e.aA(30),n=[];for(let r=0;r<t;++r){const t=2*Math.PI*i(),r=Math.acos(1-2*i())-.5*Math.PI;n.push(e.N.fromValues(Math.cos(r)*Math.cos(t),Math.cos(r)*Math.sin(t),Math.sin(r)))}return n}(this.params.starsCount),s=e.aA(300),o=new e.cP,a=new e.aw;let l=0;for(let i=0;i<r.length;++i){const c=e.N.scale([],r[i],200),u=Math.max(0,1+.01*t*(1*s()-.5)),h=Math.max(0,1+.01*n*(1*s()-.5));o.emplaceBack(c[0],c[1],c[2],-1,-1,u,h),o.emplaceBack(c[0],c[1],c[2],1,-1,u,h),o.emplaceBack(c[0],c[1],c[2],1,1,u,h),o.emplaceBack(c[0],c[1],c[2],-1,1,u,h),a.emplaceBack(l+0,l+1,l+2),a.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=i.createVertexBuffer(o,Ns.members),this.starsIdx=i.createIndexBuffer(a),this.starsSegments=e.aB.simpleSegment(0,0,o.length,a.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,i){const n=t.context,r=n.gl,s=t.transform,o=new Ct(r.LEQUAL,Ct.ReadOnly,[0,1]),a=e.S(s.zoom),l=i.properties.get("color").toArray01(),c=i.properties.get("high-color").toArray01(),u=i.properties.get("space-color").toArray01PremultipliedAlpha(),h=5e-4,d=e.cQ(i.properties.get("horizon-blend"),0,1,h,.25),p=e.cd(t,n,s)&&d===h?s.worldSize/(2*Math.PI*1.025)-1:s.globeRadius,f=t.frameCounter/1e3%1,m=e.N.length(s.globeCenterInViewSpace),g=Math.sqrt(Math.pow(m,2)-Math.pow(p,2)),_=Math.acos(g/m),y=e=>{const i="globe"===s.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];e&&i.push("ALPHA_PASS");const h=t.getOrCreateProgram("globeAtmosphere",{defines:i}),p=((e,t,i,n,r,s,o,a,l,c,u,h)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:i,u_frustum_bl:n,u_horizon:r,u_transition:s,u_fadeout_range:o,u_color:a,u_high_color:l,u_space_color:c,u_temporal_offset:u,u_horizon_angle:h}))(s.frustumCorners.TL,s.frustumCorners.TR,s.frustumCorners.BR,s.frustumCorners.BL,s.frustumCorners.horizon,a,d,l,c,u,f,_);t.uploadCommonUniforms(n,h);const m=this.atmosphereBuffer;m&&h.draw(t,r.TRIANGLES,o,kt.disabled,e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Nt.backCW,p,e?"atmosphere_glow_alpha":"atmosphere_glow",m.vertexBuffer,m.indexBuffer,m.segments)};y(!1),y(!0)}drawStars(t,i){const n=e.aa(i.properties.get("star-intensity"),0,1);if(0===n)return;const r=t.context,s=r.gl,o=t.transform,a=t.getOrCreateProgram("stars"),l=e.bi.identity([]);e.bi.rotateX(l,l,-o._pitch),e.bi.rotateZ(l,l,-o.angle),e.bi.rotateX(l,l,e.bj(o._center.lat)),e.bi.rotateY(l,l,-e.bj(o._center.lng));const c=e.a6.fromQuat(new Float32Array(16),l),u=e.a6.multiply([],o.starsProjMatrix,c),h=e.co.fromMat4([],c),d=e.co.invert([],h),p=[0,1,0];e.N.transformMat3(p,p,d),e.N.scale(p,p,this.params.sizeMultiplier);const f=[1,0,0];e.N.transformMat3(f,f,d),e.N.scale(f,f,this.params.sizeMultiplier);const m=(g=p,_=f,y=n,{u_matrix:Float32Array.from(u),u_up:g,u_right:_,u_intensity_multiplier:y});var g,_,y;t.uploadCommonUniforms(r,a),this.starsVx&&this.starsIdx&&a.draw(t,s.TRIANGLES,Ct.disabled,kt.disabled,this.colorModeAlphaBlendedWriteRGB,Nt.disabled,m,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Bs(t,i){const n=[...t],r=i.cameraWorldSizeForFog/i.worldSize,s=e.a6.identity([]);return e.a6.scale(s,s,[r,r,1]),e.a6.multiply(n,s,n),e.a6.multiply(n,i.worldToFogMatrix,n),n}function Us(e,t,i,n){const r=i.material,s=n.context,{baseColorTexture:o,metallicRoughnessTexture:a}=r.pbrMetallicRoughness,{normalTexture:l,occlusionTexture:c,emissionTexture:u}=r;function h(t,i,n){if(t&&(e.push(i),s.activeTexture.set(s.gl.TEXTURE0+n),t.gfxTexture)){const{minFilter:e,magFilter:i,wrapS:n,wrapT:r}=t.sampler;t.gfxTexture.bindExtraParam(e,i,n,r)}}h(o,"HAS_TEXTURE_u_baseColorTexture",_n.BaseColor),h(a,"HAS_TEXTURE_u_metallicRoughnessTexture",_n.MetallicRoughness),h(l,"HAS_TEXTURE_u_normalTexture",_n.Normal),h(c,"HAS_TEXTURE_u_occlusionTexture",_n.Occlusion),h(u,"HAS_TEXTURE_u_emissionTexture",_n.Emission),i.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(i.texcoordBuffer)),i.colorBuffer&&(e.push(12===i.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(i.colorBuffer)),i.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(i.normalBuffer)),i.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(i.pbrBuffer)),"OPAQUE"!==r.alphaMode&&"MASK"!==r.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),r.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function Vs(t,i,n,r,s,o){const a=n.paint.get("model-opacity"),l=i.context,c=new Ct(i.context.gl.LEQUAL,Ct.ReadWrite,i.depthRangeFor3D),u=i.transform,h=t.mesh,d=h.material,p=d.pbrMetallicRoughness,f=i.style.fog;let m;m="pixels"===i.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:e.a6.multiply([],r.zScaleMatrix,t.nodeModelMatrix),e.a6.multiply(m,r.negCameraPosMatrix,m);const g=e.a6.invert([],m);e.a6.transpose(g,g);const _=n.paint.get("model-emissive-strength").constantOr(0),y=Zr(new Float32Array(t.worldViewProjection),new Float32Array(m),new Float32Array(g),i,a,p.baseColorFactor,d.emissiveFactor,p.metallicFactor,p.roughnessFactor,d,_,n),v={defines:[]},x=[];Us(v.defines,x,h,i);const b=i.shadowRenderer;b&&(b.useNormalOffset=!1);let w=null;if(f){const e=Bs(t.nodeModelMatrix,i.transform);if(w=new Float32Array(e),"globe"!==u.projection.name){const t=h.aabb.min,i=h.aabb.max,[n,r]=f.getOpacityForBounds(e,t[0],t[1],i[0],i[1]);v.overrideFog=n>=ge||r>=ge}}const S=yn(i,n.paint.get("model-cutoff-fade-range"));S.shouldRenderCutoff&&v.defines.push("RENDER_CUTOFF");const T=i.getOrCreateProgram("model",v);i.uploadCommonUniforms(l,T,null,w,S),"shadow"!==i.renderPass&&b&&b.setupShadowsFromMatrix(t.nodeModelMatrix,T),T.draw(i,l.gl.TRIANGLES,c,s,o,h.material.doubleSided?Nt.disabled:Nt.backCCW,y,n.id,h.vertexBuffer,h.indexBuffer,h.segments,n.paint,i.transform.zoom,void 0,x)}function js(t,i,n,r,s,o,a){let l;l="globe"===t.projection.name?e.cS(n,t):[...n],e.a6.multiply(l,l,i.matrix);const c=e.a6.multiply([],r,l);if(i.meshes)for(const t of i.meshes){if("BLEND"!==t.material.alphaMode){a.push({mesh:t,depth:0,modelIndex:s,worldViewProjection:c,nodeModelMatrix:l});continue}const i=e.N.transformMat4([],t.centroid,c);i[2]>0&&o.push({mesh:t,depth:i[2],modelIndex:s,worldViewProjection:c,nodeModelMatrix:l})}if(i.children)for(const e of i.children)js(t,e,n,r,s,o,a)}function Gs(e,t,i,n){const r=i.shadowRenderer;if(!r)return;const s=r.getShadowPassDepthMode(),o=r.getShadowPassColorMode(),a=r.calculateShadowPassMatrixFromMatrix(t),l=Yr(a);i.getOrCreateProgram("modelDepth",{defines:i._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,s,kt.disabled,o,Nt.backCCW,l,n.id,e.vertexBuffer,e.indexBuffer,e.segments,n.paint,i.transform.zoom,void 0,void 0)}function Hs(t,i,n){const r=i.updateZoomBasedPaintProperties(),s=function(t,i,n){let r,s,o,a=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&a>0){const i=t.terrain,s=i.findDEMTileFor(n);s&&s.dem?r=e.cU.create(i,n,s):a=0}if(0===a&&(i.terrainElevationMin=0,i.terrainElevationMax=0),a===i.validForExaggeration&&(0===a||r&&r._demTile&&r._demTile.tileID===i.validForDEMTile.id&&r._dem._timestamp===i.validForDEMTile.timestamp))return!1;for(const e in i.instancesPerModel){const t=i.instancesPerModel[e];for(let e=0;e<t.instancedDataArray.length;++e){const n=(r?a*r.getElevationAt(0|t.instancedDataArray.float32[16*e],0|t.instancedDataArray.float32[16*e+1],!0,!0):0)+t.instancesEvaluatedElevation[e];t.instancedDataArray.float32[16*e+6]=n,s=s?Math.min(i.terrainElevationMin,n):n,o=o?Math.max(i.terrainElevationMax,n):n}}return i.terrainElevationMin=s||0,i.terrainElevationMax=o||0,i.validForExaggeration=a,i.validForDEMTile=r&&r._demTile?{id:r._demTile.tileID,timestamp:r._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,i,n);(r||s)&&(i.uploaded=!1,i.upload(t.context))}const Ws={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new e.bS([0,0,0],[e.V,e.V,0])};function qs(t,i){const n=1<<t.canonical.z,r=i.getFreeCameraOptions().position,s=i.elevation,o=t.canonical.x/n,a=(t.canonical.x+1)/n,l=t.canonical.y/n,c=(t.canonical.y+1)/n;let u=i._centerAltitude;if(s){const e=s.getMinMaxForTile(t);e&&e.max>u&&(u=e.max)}const h=e.aa(r.x,o,a)-r.x,d=e.aa(r.y,l,c)-r.y,p=e.bl(u,i.center.lat)-r.z;return i._zoomFromMercatorZ(Math.sqrt(h*h+d*d+p*p))}function $s(e,t,i,n,r,s,o){const a=e.context,l="shadow"===e.renderPass,c=e.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new Ct(a.gl.LEQUAL,Ct.ReadWrite,e.depthRangeFor3D),h=e.isTileAffectedByFog(s);if(i.meshes)for(const d of i.meshes){const p=["MODEL_POSITION_ON_GPU"],f=[];let m,g,_;n.instancedDataArray.length>20&&p.push("INSTANCED_ARRAYS");const y=yn(e,t.paint.get("model-cutoff-fade-range"));if(y.shouldRenderCutoff&&p.push("RENDER_CUTOFF"),l&&c)m=e.getOrCreateProgram("modelDepth",{defines:p}),g=Yr(o.shadowTileMatrix,o.shadowTileMatrix,Float32Array.from(i.matrix)),_=c.getShadowPassColorMode();else{Us(p,f,d,e),m=e.getOrCreateProgram("model",{defines:p,overrideFog:h});const n=d.material,l=n.pbrMetallicRoughness,u=t.paint.get("model-opacity"),v=t.paint.get("model-emissive-strength").constantOr(0);g=Zr(s.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),e,u,l.baseColorFactor,n.emissiveFactor,l.metallicFactor,l.roughnessFactor,n,v,t,r),c&&(o.shadowUniformsInitialized?m.setShadowUniformValues(a,c.getShadowUniformValues()):(c.setupShadows(s.toUnwrapped(),m,"model-tile",s.overscaledZ),o.shadowUniformsInitialized=!0)),_=y.shouldRenderCutoff||u<1||"OPAQUE"!==n.alphaMode?Lt.alphaBlended:Lt.unblended}e.uploadCommonUniforms(a,m,s.toUnwrapped(),null,y);const v=d.material.doubleSided?Nt.disabled:Nt.backCCW;if(n.instancedDataArray.length>20)f.push(n.instancedDataBuffer),m.draw(e,a.gl.TRIANGLES,u,kt.disabled,_,v,g,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,f,n.instancedDataArray.length);else{const i=l?"u_instance":"u_normal_matrix";for(let r=0;r<n.instancedDataArray.length;++r)g[i]=new Float32Array(n.instancedDataArray.arrayBuffer,64*r,16),m.draw(e,a.gl.TRIANGLES,u,kt.disabled,_,v,g,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,f)}}if(i.children)for(const a of i.children)$s(e,t,a,n,r,s,o)}const Zs=[1,-1,1];function Xs(t,i,n,r){if(!n.modelManager)return!0;const s=n.modelManager;if(!n.shadowRenderer)return!0;const o=n.shadowRenderer,a=i.aabb;let l=!0,c=t.maxHeight;if(0===c){let e=0;for(const i in t.instancesPerModel){const t=s.getModel(i,r);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):l=!1}c=t.maxScale*e*1.41+t.maxVerticalOffset,l&&(t.maxHeight=c)}a.max[2]=c,a.min[2]+=t.terrainElevationMin,a.max[2]+=t.terrainElevationMax,e.N.transformMat4(a.min,a.min,i.tileMatrix),e.N.transformMat4(a.max,a.max,i.tileMatrix);const u=a.intersects(o.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===u),0===u}class Ys{}class Ks{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,i,n){{const e=this._storage.get(i.id);if(e)return e.lastUsedFrameIdx=t,e.buf}const r=n.gl,s=r.getBufferParameter(r.ELEMENT_ARRAY_BUFFER,r.BUFFER_SIZE),o=new ArrayBuffer(s),a=new Int16Array(o);r.getBufferSubData(r.ELEMENT_ARRAY_BUFFER,0,new Int16Array(o));const l=new e.cW;for(let e=0;e<s/2;e+=3){const t=a[e],i=a[e+1],n=a[e+2];l.emplaceBack(t,i),l.emplaceBack(i,n),l.emplaceBack(n,t)}const c=n.bindVertexArrayOES.current,u=new Ys;return u.buf=new je(n,l),u.lastUsedFrameIdx=t,this._storage.set(i.id,u),n.bindVertexArrayOES.set(c),u.buf}update(e){for(const[t,i]of this._storage)e-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}class Js{registerParameter(e,t,i,n,r){}registerButton(e,t,i){}}const Qs={symbol:function(t,i,n,r,s){if("translucent"!==t.renderPass)return;const o=kt.disabled,a=t.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(t,i,n,r,s,o,a){const l=i.transform,c="map"===s,u="map"===o;for(const i of t){const t=r.getTile(i),s=t.getBucket(n);if(!s||!s.text||!s.text.segments.get().length)continue;const o=e.b5(s.textSizeData,l.zoom),h=Di(i,s.getProjection(),l),d=l.calculatePixelsToTileUnitsMatrix(t),p=mi(h,t.tileID.canonical,u,c,l,s.getProjection(),d),f=s.hasIconTextFit()&&s.hasIconData();if(o){const n=Math.pow(2,l.zoom-t.tileID.overscaledZ);ns(s,c,u,a,e.cx,l,p,i,n,o,f)}}}(r,t,n,i,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),s);const l=0!==n.paint.get("icon-opacity").constantOr(1),c=0!==n.paint.get("text-opacity").constantOr(1);void 0!==n.layout.get("symbol-sort-key").constantOr(1)&&(l||c)?rs(t,i,n,r,o,a):(l&&rs(t,i,n,r,o,a,{onlyIcons:!0}),c&&rs(t,i,n,r,o,a,{onlyText:!0})),i.map.showCollisionBoxes&&(Qr(t,i,n,r,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Qr(t,i,n,r,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(t,i,n,r){if("translucent"!==t.renderPass)return;const s=n.paint.get("circle-opacity"),o=n.paint.get("circle-stroke-width"),a=n.paint.get("circle-stroke-opacity"),l=void 0!==n.layout.get("circle-sort-key").constantOr(1),c=n.paint.get("circle-emissive-strength");if(0===s.constantOr(1)&&(0===o.constantOr(1)||0===a.constantOr(1)))return;const u=t.context,h=u.gl,d=t.transform,p=t.depthModeForSublayer(0,Ct.ReadOnly),f=kt.disabled,m=t.colorModeForDrapableLayerRenderPass(c),g="globe"===d.projection.name,_=[e.a5(d.center.lng),e.ae(d.center.lat)],y=[];for(let s=0;s<r.length;s++){const o=r[s],a=i.getTile(o),c=a.getBucket(n);if(!c||c.projection.name!==d.projection.name)continue;const u=c.programConfigurations.get(n.id),h=e.cy(n),p=t.isTileAffectedByFog(o);g&&h.push("PROJECTION_GLOBE_VIEW");const f=t.getOrCreateProgram("circle",{config:u,defines:h,overrideFog:p}),m=c.layoutVertexBuffer,v=c.globeExtVertexBuffer,x=c.indexBuffer,b=d.projection.createInversionMatrix(d,o.canonical),w={programConfiguration:u,program:f,layoutVertexBuffer:m,globeExtVertexBuffer:v,indexBuffer:x,uniformValues:e.cz(t,o,a,b,_,n),tile:a};if(l){const t=c.segments.get();for(const i of t)y.push({segments:new e.aB([i]),sortKey:i.sortKey,state:w})}else y.push({segments:c.segments,sortKey:0,state:w})}l&&y.sort(((e,t)=>e.sortKey-t.sortKey));const v={useDepthForOcclusion:d.depthOcclusionForSymbolsAndCircles};for(const e of y){const{programConfiguration:i,program:r,layoutVertexBuffer:s,globeExtVertexBuffer:o,indexBuffer:a,uniformValues:l,tile:c}=e.state,g=e.segments;t.terrain&&t.terrain.setupElevationDraw(c,r,v),t.uploadCommonUniforms(u,r,c.tileID.toUnwrapped()),r.draw(t,h.TRIANGLES,p,f,m,Nt.disabled,l,n.id,s,a,g,n.paint,d.zoom,i,[o])}},heatmap:function(t,i,n,r){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const s=t.context,o=s.gl,a=kt.disabled,l=new Lt([o.ONE,o.ONE,o.ONE,o.ONE],e.ax.transparent,[!0,!0,!0,!0]);!function(e,t,i,n){const r=e.gl,s=t.width*n,o=t.height*n;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,s,o]);let a=i.heatmapFbo;if(!a||a&&(a.width!==s||a.height!==o)){a&&a.destroy();const t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),a=i.heatmapFbo=e.createFramebuffer(s,o,!0,null),function(e,t,i,n,r,s){const o=e.gl;o.texImage2D(o.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?o.RGBA16F:o.RGBA,r,s,0,o.RGBA,e.extRenderToTextureHalfFloat?o.HALF_FLOAT:o.UNSIGNED_BYTE,null),n.colorAttachment.set(i)}(e,0,t,a,s,o)}else r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),e.bindFramebuffer.set(a.framebuffer)}(s,t,n,"globe"===t.transform.projection.name?.5:.25),s.clear({color:e.ax.transparent});const c=t.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:[],d=u?Nt.frontCCW:Nt.disabled,p=[e.a5(c.center.lng),e.ae(c.center.lat)];for(let e=0;e<r.length;e++){const f=r[e];if(i.hasRenderableParent(f))continue;const m=i.getTile(f),g=m.getBucket(n);if(!g||g.projection.name!==c.projection.name)continue;const _=t.isTileAffectedByFog(f),y=g.programConfigurations.get(n.id),v=t.getOrCreateProgram("heatmap",{config:y,defines:h,overrideFog:_}),{zoom:x}=t.transform;t.terrain&&t.terrain.setupElevationDraw(m,v),t.uploadCommonUniforms(s,v,f.toUnwrapped());const b=c.projection.createInversionMatrix(c,f.canonical);v.draw(t,o.TRIANGLES,Ct.disabled,a,l,d,Dr(t,f,m,b,p,x,n.paint.get("heatmap-intensity")),n.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,n.paint,t.transform.zoom,y,u?[g.globeExtVertexBuffer]:null)}s.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,i){const n=t.context,r=n.gl,s=i.heatmapFbo;if(!s)return;n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,s.colorAttachment.get()),n.activeTexture.set(r.TEXTURE1);let o=i.colorRampTexture;o||(o=i.colorRampTexture=new e.T(n,i.colorRamp,r.RGBA)),o.bind(r.LINEAR,r.CLAMP_TO_EDGE),t.getOrCreateProgram("heatmapTexture").draw(t,r.TRIANGLES,Ct.disabled,kt.disabled,t.colorModeForRenderPass(),Nt.disabled,((e,t,i,n)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,i),i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom)}(t,n))},line:function(t,i,n,r){if("translucent"!==t.renderPass)return;const s=n.paint.get("line-opacity"),o=n.paint.get("line-width");if(0===s.constantOr(1)||0===o.constantOr(1))return;const a=n.paint.get("line-emissive-strength"),l=t.depthModeForSublayer(0,Ct.ReadOnly),c=t.colorModeForDrapableLayerRenderPass(a),u=t.terrain&&t.terrain.renderingToTexture?1:e.f.devicePixelRatio,h=n.paint.get("line-dasharray"),d=h.constantOr(1),p=n.layout.get("line-cap"),f=n.paint.get("line-pattern"),m=f.constantOr(1),g=n.paint.get("line-pattern").constantOr(1),_=1!==n.paint.get("line-opacity").constantOr(1);let y=!g&&_;const v=n.paint.get("line-gradient"),x=m?"linePattern":"line",b=t.context,w=b.gl,S=e.cA(n);t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(y=!1);for(const s of r){const r=i.getTile(s);if(m&&!r.patternsLoaded())continue;const o=r.getBucket(n);if(!o)continue;t.prepareDrawTile();const a=o.programConfigurations.get(n.id),g=t.isTileAffectedByFog(s),_=t.getOrCreateProgram(x,{config:a,defines:S,overrideFog:g}),T=f.constantOr(null);if(T&&r.imageAtlas){const e=r.imageAtlas.patternPositions[T.toString()];e&&a.setConstantPatternPositions(e)}const E=h.constantOr(null),M=p.constantOr(null);if(!m&&E&&M&&r.lineAtlas){const e=r.lineAtlas.getDash(E,M);e&&a.setConstantPatternPositions(e)}let[I,A]=n.paint.get("line-trim-offset");if("round"===M||"square"===M){const e=1;I!==A&&(0===I&&(I-=e),1===A&&(A+=e))}const C=t.terrain?s.projMatrix:null,P=m?e.cB(t,r,n,C,u,[I,A]):e.cC(t,r,n,C,o.lineClipsArray.length,u,[I,A]);if(v){const r=o.gradients[n.id];let a=r.texture;if(n.gradientVersion!==r.version){let l=256;if(n.stepInterpolant){const n=i.getSource().maxzoom,r=s.canonical.z===n?Math.ceil(1<<t.transform.maxZoom-s.canonical.z):1;l=e.aa(e.cD(o.maxLineLength/e.V*1024*r),256,b.maxTextureSize)}r.gradient=e.cE({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:r.gradient||void 0,clips:o.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new e.T(b,r.gradient,w.RGBA),r.version=n.gradientVersion,a=r.texture}b.activeTexture.set(w.TEXTURE1),a.bind(n.stepInterpolant?w.NEAREST:w.LINEAR,w.CLAMP_TO_EDGE)}d&&(b.activeTexture.set(w.TEXTURE0),r.lineAtlasTexture&&r.lineAtlasTexture.bind(w.LINEAR,w.REPEAT),a.updatePaintBuffers()),m&&(b.activeTexture.set(w.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),a.updatePaintBuffers()),t.uploadCommonUniforms(b,_,s.toUnwrapped());const k=e=>{_.draw(t,w.TRIANGLES,l,e,c,Nt.disabled,P,n.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,n.paint,t.transform.zoom,a,[o.layoutVertexBuffer2])};if(y){const e=t.stencilModeForClipping(s).ref;0===e&&t.terrain&&b.clear({stencil:0});const i={func:w.EQUAL,mask:255};P.u_alpha_discard_threshold=.8,k(new kt(i,e,255,w.KEEP,w.KEEP,w.INVERT)),P.u_alpha_discard_threshold=0,k(new kt(i,e,255,w.KEEP,w.KEEP,w.KEEP))}else k(t.stencilModeForClipping(s))}y&&(t.resetStencilClippingMasks(),t.terrain&&b.clear({stencil:0}))},fill:function(t,i,n,r){const s=n.paint.get("fill-color"),o=n.paint.get("fill-opacity");if(0===o.constantOr(1))return;const a=n.paint.get("fill-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(a),c=n.paint.get("fill-pattern"),u=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===s.constantOr(e.ax.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(t.renderPass===u){const e=t.depthModeForSublayer(1,"opaque"===t.renderPass?Ct.ReadWrite:Ct.ReadOnly);os(t,i,n,r,e,l,!1)}if("translucent"===t.renderPass&&n.paint.get("fill-antialias")){const e=t.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Ct.ReadOnly);os(t,i,n,r,e,l,!0)}},"fill-extrusion":function(t,i,n,r){const s=n.paint.get("fill-extrusion-opacity"),o=t.context,a=o.gl,l=t.terrain,c=l&&l.renderingToTexture;if(0===s)return;const u=t.conflationActive&&t.layerUsedInConflation(n,i.getSource());if(u&&function(e,t,i,n){for(const r of n){const n=t.getTile(r).getBucket(i);n&&(n.updateReplacement(r,e.replacementSource),n.uploadCentroid(e.context))}}(t,i,n,r),l||u)for(const e of r){const r=i.getTile(e).getBucket(n);r&&cs(t.context,i,e,r,n,l,u)}if("shadow"===t.renderPass&&t.shadowRenderer){const o=t.shadowRenderer;if(l&&s<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof e.Z)return;const a=o.getShadowPassDepthMode(),c=o.getShadowPassColorMode();as(t,i,n,r,a,kt.disabled,c,u)}else if("translucent"===t.renderPass){const h=!n.paint.get("fill-extrusion-pattern").constantOr(1),d=n.paint.get("fill-extrusion-color").constantOr(e.ax.white);if(!c&&0!==d.a){const e=new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D);1===s&&h?as(t,i,n,r,e,kt.disabled,Lt.unblended,u):(as(t,i,n,r,e,kt.disabled,Lt.disabled,u),as(t,i,n,r,e,t.stencilModeFor3D(),t.colorModeForRenderPass(),u),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&h&&(!l&&"globe"!==t.transform.projection.name||c)){const s=n.paint.get("fill-extrusion-opacity"),h=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),d=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),p=n.paint.get("fill-extrusion-flood-light-intensity"),f=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),m=h>0&&d>0,g=p>0,_=(e,t,i)=>(1-i)*e+i*t,y=o=>{const l=t.depthModeForSublayer(1,Ct.ReadOnly,a.LEQUAL,!0),c=n.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),m=_(.1,3,c),g=t._showOverdrawInspector;if(!g){const c=new kt({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),g=new Lt([a.ONE,a.ONE,a.ONE,a.ONE],e.ax.transparent,[!1,!1,!1,!0],a.MIN);ls(t,i,n,r,l,c,g,Nt.disabled,o,"sdf",s,h,d,p,f,m,u,!1)}{const c=g?kt.disabled:new kt({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),_=g?t.colorModeForRenderPass():new Lt([a.ONE_MINUS_DST_ALPHA,a.DST_ALPHA,a.ONE,a.ONE],e.ax.transparent,[!0,!0,!0,!0]);ls(t,i,n,r,l,c,_,Nt.disabled,o,"color",s,h,d,p,f,m,u,!1)}};if(c){const c=(o,l,c)=>{const m=t.depthModeForSublayer(1,Ct.ReadOnly,a.LEQUAL,!1),g=n.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),y=_(.1,3,g);{const c=new Lt([a.ONE,a.ONE,a.ONE,a.ONE],e.ax.transparent,[!1,!1,!1,!0]);ls(t,i,n,r,m,kt.disabled,c,Nt.disabled,o,"clear",s,h,d,p,f,y,u,l)}{const c=new kt({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),g=new Lt([a.ONE,a.ONE,a.ONE,a.ONE],e.ax.transparent,[!1,!1,!1,!0],a.MIN);ls(t,i,n,r,m,c,g,Nt.disabled,o,"sdf",s,h,d,p,f,y,u,l)}{const c=o?a.ZERO:a.ONE_MINUS_DST_ALPHA,g=new kt({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),_=new Lt([c,a.DST_ALPHA,a.ONE_MINUS_DST_ALPHA,a.ZERO],e.ax.transparent,[!0,!0,!0,!0]);ls(t,i,n,r,m,g,_,Nt.disabled,o,"color",s,h,d,p,f,y,u,l)}{const g=new Lt([a.ONE,a.ONE,a.ONE,o?a.ZERO:a.ONE],e.ax.transparent,[!1,!1,!1,!0],o?a.FUNC_ADD:a.MAX);ls(t,i,n,r,m,kt.disabled,g,Nt.disabled,o,"clear",s,h,d,p,f,y,u,l,c)}};if(m||g){let i;if(t.prepareDrawTile(),l){const t=l.drapeBufferSize[0],n=l.drapeBufferSize[1];i=l.framebufferCopyTexture,i&&(!i||i.size[0]===t&&i.size[1]===n)||(i&&i.destroy(),i=l.framebufferCopyTexture=new e.T(o,new e.h({width:t,height:n}),a.RGBA)),i.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,t,n,0)}m&&c(!0,!1,i),g&&c(!1,!0,i)}}else m&&y(!0),g&&y(!1)}}},hillshade:function(e,t,i,n){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;if(e.style.disableElevatedTerrain)return;const r=e.context,s=e.terrain&&e.terrain.renderingToTexture,[o,a]="translucent"!==e.renderPass||s?[{},n]:e.stencilConfigForOverlap(n);for(const n of a){const r=t.getTile(n);if(r.needsHillshadePrepare&&"offscreen"===e.renderPass)nr(e,r,i);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,Ct.ReadOnly),a=i.paint.get("hillshade-emissive-strength"),l=e.colorModeForDrapableLayerRenderPass(a),c=s&&e.terrain?e.terrain.stencilModeForRTTOverlap(n):o[n.overscaledZ];tr(e,n,r,i,t,c,l)}}r.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(t,i,n,r,s,o){if("translucent"!==t.renderPass)return;if(0===n.paint.get("raster-opacity"))return;const a="globe"===t.transform.projection.name,l=0!==n.paint.get("raster-elevation"),c=l&&a;if(t.renderElevatedRasterBackface&&!c)return;const u=t.context,h=u.gl,d=i.getSource(),p=function(t,i,n,r){const s=i.paint.get("raster-color"),o="raster-array"===t.type,a=[],l=i.paint.get("raster-resampling"),c=i.paint.get("raster-color-mix");let u=i.paint.get("raster-color-range");const h=[c[0],c[1],c[2],0],d=c[3];let p="nearest"===l?r.NEAREST:r.LINEAR;if(o&&(a.push("RASTER_ARRAY"),s||a.push("RASTER_COLOR"),"linear"===l&&a.push("RASTER_ARRAY_LINEAR"),p=r.NEAREST,!u&&t.rasterLayers)){const e=t.rasterLayers.find((({id:e})=>e===i.sourceLayer));e&&e.fields&&e.fields.range&&(u=e.fields.range)}if(u=u||[0,1],s){a.push("RASTER_COLOR"),n.activeTexture.set(r.TEXTURE2),i.updateColorRamp(u);let t=i.colorRampTexture;t||(t=i.colorRampTexture=new e.T(n,i.colorRamp,r.RGBA)),t.bind(r.LINEAR,r.CLAMP_TO_EDGE)}return{mix:h,range:u,offset:d,defines:a,resampling:p}}(d,n,u,h);if(d instanceof e.ap&&!r.length&&!a)return;const f=n.paint.get("raster-emissive-strength"),m=t.colorModeForDrapableLayerRenderPass(f),g=t.terrain&&t.terrain.renderingToTexture,_=!t.options.moving,y="nearest"===n.paint.get("raster-resampling")?h.NEAREST:h.LINEAR;if(d instanceof e.ap&&!r.length&&(d.onNorthPole||d.onSouthPole)){const e=l?t.stencilModeFor3D():kt.disabled;return void ms(!!d.onNorthPole,null,t,i,n,f,p,Nt.disabled,e)}if(!r.length)return;const[v,x]=d instanceof e.ap||g?[{},r]:t.stencilConfigForOverlap(r),b=x[x.length-1].overscaledZ;c&&p.defines.push("PROJECTION_GLOBE_VIEW"),l&&p.defines.push("RENDER_CUTOFF");const w=(r,s,x)=>{for(const w of r){const r=w.toUnwrapped(),S=i.getTile(w);if(g&&(!S||!S.hasData()))continue;u.activeTexture.set(h.TEXTURE0);const T=_s(S,d,n,p);if(!T||!T.texture)continue;const{texture:E,mix:M,offset:I,tileSize:A,buffer:C}=T;let P,k;g?(P=Ct.disabled,k=w.projMatrix):l?(P=new Ct(h.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D),k=a?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(r,_)):(P=t.depthModeForSublayer(w.overscaledZ-b,1===n.paint.get("raster-opacity")?Ct.ReadWrite:Ct.ReadOnly,h.LESS),k=t.transform.calculateProjMatrix(r,_));const R=t.terrain&&g?t.terrain.stencilModeForRTTOverlap(w):v[w.overscaledZ],L=o?0:n.paint.get("raster-fade-duration");S.registerFadeDuration(L);const D=i.findLoadedParent(w,0),O=pr(S,D,i,t.transform,L);let N,z;t.terrain&&t.terrain.prepareDrawTile(),u.activeTexture.set(h.TEXTURE0),E.bind(y,h.CLAMP_TO_EDGE),u.activeTexture.set(h.TEXTURE1),D?(D.texture&&D.texture.bind(y,h.CLAMP_TO_EDGE),N=Math.pow(2,D.tileID.overscaledZ-S.tileID.overscaledZ),z=[S.tileID.canonical.x*N%1,S.tileID.canonical.y*N%1]):E.bind(y,h.CLAMP_TO_EDGE),E.useMipmap&&u.extTextureFilterAnisotropic&&t.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const F=t.transform;let B;const U=l?gs(F):[0,0,0,0];let V,j,G,H,W,q=0;if(c&&d instanceof e.ap&&d.coordinates.length>3)V=Float32Array.from(e.aT(e.ci(new e.bs(0,0,0)))),j=Float32Array.from(F.globeMatrix),G=Float32Array.from(e.ce(F)),H=[e.a5(F.center.lng),e.ae(F.center.lat)],B=d.elevatedGlobePerspectiveTransform,W=d.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const t=e.cf(w.canonical);q=e.cg(t.getCenter().lat),V=Float32Array.from(e.aT(e.ci(w.canonical))),j=Float32Array.from(F.globeMatrix),G=Float32Array.from(e.ce(F)),H=[e.a5(F.center.lng),e.ae(F.center.lat)],B=[0,0],W=Float32Array.from(e.ch(w.canonical,t,q,F.worldSize/F._pixelsPerMercatorPixel))}else B=d instanceof e.ap?d.perspectiveTransform:[0,0],V=new Float32Array(16),j=new Float32Array(9),G=new Float32Array(16),H=[0,0],W=new Float32Array(9);const $=zr(k,V,j,G,W,z||[0,0],e.S(t.transform.zoom),H,U,N||1,O,n,B,l?n.paint.get("raster-elevation"):0,2,M,I,p.range,A,C,f),Z=t.isTileAffectedByFog(w),X=t.getOrCreateProgram("raster",{defines:p.defines,overrideFog:Z});if(t.uploadCommonUniforms(u,X,r),d instanceof e.ap){const i=d.elevatedGlobeVertexBuffer,r=d.elevatedGlobeIndexBuffer;if(g||!a)d.boundsBuffer&&d.boundsSegments&&X.draw(t,h.TRIANGLES,P,kt.disabled,m,Nt.disabled,$,n.id,d.boundsBuffer,t.quadTriangleIndexBuffer,d.boundsSegments);else if(i&&r){const o=F.zoom<=e.bG?d.elevatedGlobeSegments:d.getSegmentsForLongitude(F.center.lng);o&&X.draw(t,h.TRIANGLES,P,kt.disabled,m,s,$,n.id,i,r,o)}}else if(c){P=new Ct(h.LEQUAL,Ct.ReadOnly,t.depthRangeFor3D);const e=t.globeSharedBuffers;if(e){const[i,r,o]=e.getGridBuffers(q,!1);X.draw(t,h.TRIANGLES,P,x||R,t.colorModeForRenderPass(),s,$,n.id,i,r,o)}}else{const{tileBoundsBuffer:e,tileBoundsIndexBuffer:i,tileBoundsSegments:r}=t.getTileBoundsBuffers(S);X.draw(t,h.TRIANGLES,P,R,m,Nt.disabled,$,n.id,e,i,r)}}if(!(d instanceof e.ap)&&c)for(const e of r){const r=e.canonical.y===(1<<e.canonical.z)-1;0===e.canonical.y&&ms(!0,e,t,i,n,f,p,s,x||kt.disabled),r&&ms(!1,e,t,i,n,f,p,s===Nt.frontCW?Nt.backCW:Nt.frontCW,x||kt.disabled)}};c?w(x,t.renderElevatedRasterBackface?Nt.backCW:Nt.frontCW,t.stencilModeFor3D()):w(x,Nt.disabled,void 0),t.resetStencilClippingMasks()},"raster-particle":function(t,i,n,r,s,o){"offscreen"===t.renderPass&&function(t,i,n,r){if(!r.length)return;const s=t.context,o=s.gl,a=i.getSource();if(!(a instanceof De))return;const l=[];for(const e of r){const t=i.getTile(e);if(!(t instanceof Zt))continue;const r=ys(t,a,n);if(!r)continue;const o=[r.tileSize,r.tileSize];let c=n.tileFramebuffer;c||(c=n.tileFramebuffer=s.createFramebuffer(o[0],o[1],!0,null));let u=t.rasterParticleState;const h=n.paint.get("raster-particle-count");u||(u=t.rasterParticleState=new Bt(s,e,o,h));const d=u.update(n.lastInvalidatedAt);u.numParticles!==h&&u.setNumParticles(e,h);const p=u.targetColorTexture;u.targetColorTexture=u.backgroundColorTexture,u.backgroundColorTexture=p;const f=u.particleVertices0;u.particleVertices0=u.particleVertices1,u.particleVertices1=f,l.push([e,r,u,d])}if(0===l.length)return;const c=e.f.now(),u=n.previousDrawTimestamp?.001*(c-n.previousDrawTimestamp):.0167;if(n.previousDrawTimestamp=c,n.hasColorMap()){s.activeTexture.set(o.TEXTURE0+2);let t=n.colorRampTexture;t||(t=n.colorRampTexture=new e.T(s,n.colorRamp,o.RGBA)),t.bind(o.LINEAR,o.CLAMP_TO_EDGE)}s.bindFramebuffer.set(n.tileFramebuffer.framebuffer),s.activeTexture.set(o.TEXTURE0),function(t,i,n){const r=t.context,s=r.gl,o=i.tileFramebuffer;r.activeTexture.set(s.TEXTURE0);const a={u_texture:0,u_opacity:1.05*(c=i.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=t.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const c of n){const[,,n,u]=c;o.colorAttachment.set(n.targetColorTexture.texture),r.viewport.set([0,0,o.width,o.height]),r.clear({color:e.ax.transparent}),u&&(n.backgroundColorTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE),l.draw(t,s.TRIANGLES,Ct.disabled,kt.disabled,Lt.alphaBlended,Nt.disabled,a,i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments))}}(t,n,l),function(t,i,n,r){const s=t.context.gl,o=n.tileFramebuffer,a="globe"===t.transform.projection.name,l=n.paint.get("raster-particle-max-speed");for(const c of r){const[r,u,h]=c;u.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),o.colorAttachment.set(h.targetColorTexture.texture);const d=t.getOrCreateProgram("rasterParticleDraw",{defines:u.defines,overrideFog:!1}),p=u.scalarData?[]:[0,1,2,3].map((t=>e.cG[t](r)));p.push(r);const f=r.canonical.x,m=r.canonical.y;for(const e of p){const o=i.getTile(a?e.wrapped():e);if(!o)continue;const c=o.rasterParticleState;if(!c)continue;const h=Ur([e.canonical.x+(1<<e.canonical.z)*(e.wrap-r.wrap)-f,e.canonical.y-m],0,u.texture.size,2,l,u.textureOffset,u.scale,u.offset);d.draw(t,s.POINTS,Ct.disabled,kt.disabled,Lt.alphaBlended,Nt.disabled,h,n.id,c.particleVertices0,void 0,c.particleSegment)}}}(t,i,n,l),function(e,t,i,n){const r=e.context.gl;let s=t.transformFeedbackObject;s||(s=t.transformFeedbackObject=r.createTransformFeedback()),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,t.transformFeedbackObject);const o=t.paint.get("raster-particle-max-speed"),a=n*t.paint.get("raster-particle-speed-factor")*.3,l=(c=t.paint.get("raster-particle-reset-rate-factor"),Math.pow(c,6));var c;for(const n of i){const[,i,s]=n;i.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE);const c=Vr(0,i.texture.size,o,a,l,i.textureOffset,i.scale,i.offset);e.getOrCreateProgram("rasterParticleUpdate",{defines:i.defines,transformFeedback:{bufferMode:r.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(e,r.POINTS,Ct.disabled,kt.disabled,Lt.disabled,Nt.disabled,c,t.id,s.particleVertices0,void 0,s.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:s.particleVertices1,targetIndex:0}])}r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null)}(t,n,l,u)}(t,i,n,r),"translucent"===t.renderPass&&(function(t,i,n,r,s){const o=t.context,a=o.gl,l=!t.options.moving,c="globe"===t.transform.projection.name;if(!r.length)return;const[u,h]=t.stencilConfigForOverlap(r),d=[];c&&d.push("PROJECTION_GLOBE_VIEW");for(const r of h){const s=r.toUnwrapped(),h=i.getTile(r);if(!h.rasterParticleState)continue;const p=h.rasterParticleState,f=100;h.registerFadeDuration(f);const m=i.findLoadedParent(r,0),g=pr(h,m,i,t.transform,f);let _,y;t.terrain&&t.terrain.prepareDrawTile(),o.activeTexture.set(a.TEXTURE0),p.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),o.activeTexture.set(a.TEXTURE1),m&&m.rasterParticleState?(m.rasterParticleState.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),_=Math.pow(2,m.tileID.overscaledZ-h.tileID.overscaledZ),y=[h.tileID.canonical.x*_%1,h.tileID.canonical.y*_%1]):p.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const v=c?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(s,l),x=t.transform,b=vs(x),w=e.cf(r.canonical),S=e.cg(w.getCenter().lat);let T,E,M,I,A;c?(T=Float32Array.from(e.aT(e.ci(r.canonical))),E=Float32Array.from(x.globeMatrix),M=Float32Array.from(e.ce(x)),I=[e.a5(x.center.lng),e.ae(x.center.lat)],A=Float32Array.from(e.ch(r.canonical,w,S,x.worldSize/x._pixelsPerMercatorPixel))):(T=new Float32Array(16),E=new Float32Array(9),M=new Float32Array(16),I=[0,0],A=new Float32Array(9));const C=Br(v,T,E,M,A,y||[0,0],e.S(t.transform.zoom),I,b,_||1,g,250),P=t.isTileAffectedByFog(r),k=t.getOrCreateProgram("rasterParticle",{defines:d,overrideFog:P});if(t.uploadCommonUniforms(o,k,s),c){const e=new Ct(a.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D),i=0,r=t.globeSharedBuffers;if(r){const[s,o,l]=r.getGridBuffers(S,0!==i);k.draw(t,a.TRIANGLES,e,kt.disabled,Lt.alphaBlended,Nt.backCCW,C,n.id,s,o,l)}}else{const e=t.depthModeForSublayer(0,Ct.ReadOnly),i=u[r.overscaledZ],{tileBoundsBuffer:s,tileBoundsIndexBuffer:o,tileBoundsSegments:l}=t.getTileBoundsBuffers(h);k.draw(t,a.TRIANGLES,e,i,Lt.alphaBlended,Nt.disabled,C,n.id,s,o,l)}}t.resetStencilClippingMasks()}(t,i,n,r),t.style.map.triggerRepaint())},background:function(e,t,i,n){const r=i.paint.get("background-color"),s=i.paint.get("background-opacity"),o=i.paint.get("background-emissive-strength");if(0===s)return;const a=e.context,l=a.gl,c=e.transform,u=c.tileSize,h=i.paint.get("background-pattern");if(e.isPatternMissing(h,i.scope))return;const d=!h&&1===r.a&&1===s&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==d)return;const p=kt.disabled,f=e.depthModeForSublayer(0,"opaque"===d?Ct.ReadWrite:Ct.ReadOnly),m=e.colorModeForDrapableLayerRenderPass(o),g=h?"backgroundPattern":"background";let _,y=n;y||(_=e.getBackgroundTiles(),y=Object.values(_).map((e=>e.tileID))),h&&(a.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context,i.scope));for(const d of y){const y=e.isTileAffectedByFog(d),v=e.getOrCreateProgram(g,{overrideFog:y}),x=d.toUnwrapped(),b=n?d.projMatrix:e.transform.calculateProjMatrix(x);e.prepareDrawTile();const w=t?t.getTile(d):_?_[d.key]:new Vt(d,u,c.zoom,e),S=h?$r(b,o,s,e,h,i.scope,{tileID:d,tileSize:u}):qr(b,o,s,r);e.uploadCommonUniforms(a,v,x);const{tileBoundsBuffer:T,tileBoundsIndexBuffer:E,tileBoundsSegments:M}=e.getTileBoundsBuffers(w);v.draw(e,l.TRIANGLES,f,p,m,Nt.disabled,S,i.id,T,E,M)}},sky:function(t,i,n){const r=t._atmosphere?e.S(t.transform.zoom):1,s=n.paint.get("sky-opacity")*r;if(0===s)return;const o=t.context,a=n.paint.get("sky-type"),l=new Ct(o.gl.LEQUAL,Ct.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===a?"offscreen"===t.renderPass?n.needsSkyboxCapture(t)&&(function(t,i,n,r){const s=t.context,o=s.gl;let a=i.skyboxFbo;if(!a){a=i.skyboxFbo=s.createFramebuffer(32,32,!0,null),i.skyboxGeometry=new Rs(s),i.skyboxTexture=s.gl.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,i.skyboxTexture),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR);for(let e=0;e<6;++e)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,o.RGBA,32,32,0,o.RGBA,o.UNSIGNED_BYTE,null)}s.bindFramebuffer.set(a.framebuffer),s.viewport.set([0,0,32,32]);const l=i.getCenter(t,!0),c=t.getOrCreateProgram("skyboxCapture"),u=new Float64Array(16);e.a6.identity(u),e.a6.rotateY(u,u,.5*-Math.PI),Ls(t,i,c,u,l,0),e.a6.identity(u),e.a6.rotateY(u,u,.5*Math.PI),Ls(t,i,c,u,l,1),e.a6.identity(u),e.a6.rotateX(u,u,.5*-Math.PI),Ls(t,i,c,u,l,2),e.a6.identity(u),e.a6.rotateX(u,u,.5*Math.PI),Ls(t,i,c,u,l,3),e.a6.identity(u),Ls(t,i,c,u,l,4),e.a6.identity(u),e.a6.rotateY(u,u,Math.PI),Ls(t,i,c,u,l,5),s.viewport.set([0,0,t.width,t.height])}(t,n),n.markSkyboxValid(t)):"sky"===t.renderPass&&function(e,t,i,n,r){const s=e.context,o=s.gl,a=e.transform,l=e.getOrCreateProgram("skybox");s.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_CUBE_MAP,t.skyboxTexture);const c=((e,t,i,n,r)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:n,u_temporal_offset:r}))(a.skyboxMatrix,t.getCenter(e,!1),0,n,r);e.uploadCommonUniforms(s,l),l.draw(e,o.TRIANGLES,i,kt.disabled,e.colorModeForRenderPass(),Nt.backCW,c,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(t,n,l,s,c):"gradient"===a&&"sky"===t.renderPass&&function(t,i,n,r,s){const o=t.context,a=o.gl,l=t.transform,c=t.getOrCreateProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new Rs(o)),o.activeTexture.set(a.TEXTURE0);let u=i.colorRampTexture;u||(u=i.colorRampTexture=new e.T(o,i.colorRamp,a.RGBA)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((t,i,n,r,s)=>({u_matrix:t,u_color_ramp:0,u_center_direction:i,u_radius:e.bj(n),u_opacity:r,u_temporal_offset:s}))(l.skyboxMatrix,i.getCenter(t,!1),i.paint.get("sky-gradient-radius"),r,s);t.uploadCommonUniforms(o,c),c.draw(t,a.TRIANGLES,n,kt.disabled,t.colorModeForRenderPass(),Nt.backCW,h,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,n,l,s,c)},debug:function(t,i,n,r,s,o){for(let a=0;a<n.length;a++)if(s){const s=1,l=.8,c=new e.ax(r.r*l,r.g*l,r.b*l,1);Es(t,i,n[a],r,-s,-s,o),Es(t,i,n[a],r,-s,s,o),Es(t,i,n[a],r,s,s,o),Es(t,i,n[a],r,s,-s,o),Es(t,i,n[a],c,0,0,o)}else Es(t,i,n[a],r,0,0,o)},custom:function(t,i,n,r){const s=t.context,o=n.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&n.isLayerDraped(i)){if("offscreen"===t.renderPass){const i=o.prerender;if(i){if(t.setCustomLayerDefaults(),s.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const n=t.transform.pointMerc;i.call(o,s.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.S(t.transform.zoom),[n.x,n.y],t.transform.pixelsPerMeterRatio)}else i.call(o,s.gl,t.transform.customLayerMatrix());s.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const i=o.renderToTile;if(i){const n=r[0].canonical,a=new e.L(n.x+r[0].wrap*(1<<n.z),n.y,n.z);s.setDepthMode(Ct.disabled),s.setStencilMode(kt.disabled),s.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),i.call(o,s.gl,a),s.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),s.setColorMode(t.colorModeForRenderPass()),s.setStencilMode(kt.disabled);const i="3d"===o.renderingMode?new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Ct.ReadOnly);if(s.setDepthMode(i),"globe"===t.transform.projection.name){const i=t.transform.pointMerc;o.render(s.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.S(t.transform.zoom),[i.x,i.y],t.transform.pixelsPerMeterRatio)}else o.render(s.gl,t.transform.customLayerMatrix());s.setDirty(),t.setBaseState(),s.bindFramebuffer.set(null)}}else e.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,i,n,r){if("opaque"===t.renderPass)return;const s=n.paint.get("model-opacity");if(0===s)return;const o=n.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!o)return;if(t.terrain&&s<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof e.Z)return}const a=t.shadowRenderer,l=n.paint.get("model-receive-shadows");a&&(a.useNormalOffset=!0,l||(a.enabled=!1));const c=()=>{a&&(a.useNormalOffset=!0,l||(a.enabled=!0))},u=i.getSource();if("light-beam"===t.renderPass&&"batched-model"!==u.type)return;if("vector"===u.type||"geojson"===u.type)return function(t,i,n,r){const s=t.transform;if("mercator"!==s.projection.name)return void e.w(`Drawing 3D models for ${s.projection.name} projection is not yet implemented`);const o=s.getFreeCameraOptions().position;if(!t.modelManager)return;const a=t.modelManager;n.modelManager=a;const l=t.shadowRenderer;if(!n._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const c=n._unevaluatedLayout._values["model-id"],u={...n.layout.get("model-id").parameters};for(const h of r){const r=i.getTile(h).getBucket(n);if(!r||r.projection.name!==s.projection.name)continue;const d=qs(h,s);u.zoom=d;const p=c.possiblyEvaluate(u);if(Hs(t,r,h),Ws.shadowUniformsInitialized=!1,Ws.useSingleShadowCascade=!!l&&0===l.getMaxCascadeForTile(h.toUnwrapped()),"shadow"===t.renderPass&&l){if(1===t.currentShadowCascade&&r.isInsideFirstShadowMapFrustum)continue;const i=s.calculatePosMatrix(h.toUnwrapped(),s.worldSize);if(Ws.tileMatrix.set(i),Ws.shadowTileMatrix=Float32Array.from(l.calculateShadowPassMatrixFromMatrix(i)),Ws.aabb.min.fill(0),Ws.aabb.max[0]=Ws.aabb.max[1]=e.V,Ws.aabb.max[2]=0,Xs(r,Ws,t,n.scope))continue}const f=1<<h.canonical.z,m=[((o.x-h.wrap)*f-h.canonical.x)*e.V,(o.y*f-h.canonical.y)*e.V,o.z*f*e.V];for(let e in r.instancesPerModel){const i=r.instancesPerModel[e];i.features.length>0&&(e=p.evaluate(i.features[0].feature,{}));const s=a.getModel(e,n.scope);if(s&&s.uploaded)for(const e of s.nodes)$s(t,n,e,i,m,h,Ws)}}}(t,i,n,r),void c();if(!u.loaded())return;if("batched-model"===u.type)return function(t,i,n,r){n.resetLayerRenderingStats(t);const s=t.context,o=t.transform,a=t.style.fog,l=t.shadowRenderer;if("mercator"!==o.projection.name)return void e.w(`Drawing 3D landmark models for ${o.projection.name} projection is not yet implemented`);const c=t.transform.getFreeCameraOptions().position,u=e.N.scale([],[c.x,c.y,c.z],t.transform.worldSize);e.N.negate(u,u);const h=e.a6.identity([]),d=e.cR(o.center.lat,o.zoom),p=e.a6.fromScaling([],[1,1,1/d]);e.a6.translate(h,h,u);const f=n.paint.get("model-opacity"),m=new Ct(s.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D),g=new Ct(s.gl.LEQUAL,Ct.ReadOnly,t.depthRangeFor3D),_=new e.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),y="shadow"===t.renderPass,v=y&&l?l.getCurrentCascadeFrustum():o.getFrustum(o.scaleZoom(o.worldSize)),x=n.getLayerRenderingStats(),b=function(c,u){for(const d of r){const r=i.getTile(d).getBucket(n);if(!r||!r.uploaded)continue;let b=!1;l&&(b=0===l.getMaxCascadeForTile(d.toUnwrapped()));const w=o.calculatePosMatrix(d.toUnwrapped(),o.worldSize),S=r.modelTraits;for(const i of r.getNodesInfo()){if(i.hiddenByReplacement)continue;if(!i.node.meshes)continue;const r=i.evaluatedScale,T=i.node;let E=0;if(t.terrain&&T.elevation&&(E=T.elevation*t.terrain.exaggeration()),r[0]<=1&&r[1]<=1&&r[2]<=1&&0===(()=>{const t=i.getLocalBounds();return _.min=[...t.min],_.max=[...t.max],_.min[2]+=E,_.max[2]+=E,e.N.transformMat4(_.min,_.min,w),e.N.transformMat4(_.max,_.max,w),_})().intersects(v))continue;const M="light-beam"===t.renderPass,I=[...w];e.a6.translate(I,I,[(T.anchor?T.anchor[0]:0)*(r[0]-1),(T.anchor?T.anchor[1]:0)*(r[1]-1),E]),e.N.exactEquals(r,e.cT)||e.a6.scale(I,I,r),e.a6.multiply(I,I,T.matrix);const A=e.a6.multiply([],p,I);e.a6.multiply(A,h,A);const C=e.a6.invert([],A);e.a6.transpose(C,C),e.a6.scale(C,C,Zs);const P=e.a6.multiply([],o.expandedFarZProjMatrix,I),k=S&e.cV.HasMapboxMeshFeatures,R=k?0:i.evaluatedRMEA[0][2];for(let e=0;e<T.meshes.length;++e){const r=T.meshes[e],h=e===T.lightMeshIndex;if(h){if(!M&&!t.terrain&&t.shadowRenderer){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);continue}}else if(M)continue;const p={defines:[]},_=[];if(Us(p.defines,_,r,t),k||p.defines.push("DIFFUSE_SHADED"),b&&p.defines.push("SHADOWS_SINGLE_CASCADE"),x&&(y?x.numRenderedVerticesInShadowPass+=r.vertexArray.length:x.numRenderedVerticesInTransparentPass+=r.vertexArray.length),y){Gs(r,I,t,n);continue}let v=null;if(a){const e=Bs(I,t.transform);if(v=new Float32Array(e),"globe"!==o.projection.name){const t=r.aabb.min,i=r.aabb.max,[n,s]=a.getOpacityForBounds(e,t[0],t[1],i[0],i[1]);p.overrideFog=n>=ge||s>=ge}}const w=r.material;let S;w.occlusionTexture&&w.occlusionTexture.offsetScale&&(S=w.occlusionTexture.offsetScale,p.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!y&&l&&(l.useNormalOffset=!!r.normalBuffer);const E=t.getOrCreateProgram("model",p);!y&&l&&l.setupShadowsFromMatrix(I,E,l.useNormalOffset),t.uploadCommonUniforms(s,E,d.toUnwrapped(),v);const L=w.pbrMetallicRoughness;L.metallicFactor=.9,L.roughnessFactor=.5;const D=Zr(new Float32Array(P),new Float32Array(A),new Float32Array(C),t,f,L.baseColorFactor,w.emissiveFactor,L.metallicFactor,L.roughnessFactor,w,R,n,[0,0,0],S);E.draw(t,s.gl.TRIANGLES,u&&!h?m:g,kt.disabled,c?h||f<1||i.hasTranslucentParts?Lt.alphaBlended:Lt.unblended:Lt.disabled,Nt.backCCW,D,n.id,r.vertexBuffer,r.indexBuffer,r.segments,n.paint,t.transform.zoom,void 0,_)}}}};(function(e,t,i,n){const r=e.terrain?e.terrain.exaggeration():0,s=e.transform.zoom;for(const o of n){const n=t.getTile(o).getBucket(i);n&&(e.conflationActive&&n.updateReplacement(o,e.replacementSource),n.evaluateScale(e,i),e.terrain&&r>0&&n.elevationUpdate(e.terrain,r,o,i.source),n.needsReEvaluation(e,s,i)&&n.evaluate(i))}})(t,i,n,r),1===f?b(!0,!0):(b(!1,!0),b(!0,!1))}(t,i,n,r),void c();const h=u.getModels(),d=[],p=t.transform.getFreeCameraOptions().position,f=e.N.scale([],[p.x,p.y,p.z],t.transform.worldSize);e.N.negate(f,f);const m=[],g=[];let _=0;for(const i of h){const r=n.paint.get("model-rotation").constantOr(null),s=n.paint.get("model-scale").constantOr(null),o=n.paint.get("model-translation").constantOr(null);i.computeModelMatrix(t,r,s,o,!0,!0,!1);const a=e.a6.identity([]),l=e.cR(i.position.lat,t.transform.zoom),c=e.a6.fromScaling([],[1,1,1/l]);e.a6.translate(a,a,f),d.push({zScaleMatrix:c,negCameraPosMatrix:a});for(const e of i.nodes)js(t.transform,e,i.matrix,t.transform.expandedFarZProjMatrix,_,m,g);_++}if(m.sort(((e,t)=>t.depth-e.depth)),"shadow"!==t.renderPass){if(1===s)for(const e of g)Vs(e,t,n,d[e.modelIndex],kt.disabled,t.colorModeForRenderPass());else{for(const e of g)Vs(e,t,n,d[e.modelIndex],kt.disabled,Lt.disabled);for(const e of g)Vs(e,t,n,d[e.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const e of m)Vs(e,t,n,d[e.modelIndex],kt.disabled,t.colorModeForRenderPass());c()}else{for(const e of g)Gs(e.mesh,e.nodeModelMatrix,t,n);for(const e of m)Gs(e.mesh,e.nodeModelMatrix,t,n);c()}}},eo={model:function(e,t,i){const n=e.scope,r=t.getSource();if(!r.loaded())return;if("vector"===r.type||"geojson"===r.type)return void(i.modelManager&&i.modelManager.upload(i,n));if("batched-model"===r.type)return;const s=r.getModels();for(const e of s)e.upload(i.context)},raster:function(e,t,i){const n=t.getSource();if(!(n instanceof De&&n.loaded()))return;const r=e.sourceLayer||n.rasterLayerIds&&n.rasterLayerIds[0];if(!r)return;const s=e.paint.get("raster-array-band")||n.getInitialBand(r);if(null==s)return;const o=t.getIds().map((e=>t.getTileByID(e)));for(const e of o)e.updateNeeded(r,s)&&n.prepareTile(e,r,s)},"raster-particle":function(e,t,i){const n=t.getSource();if(!(n instanceof De&&n.loaded()))return;const r=e.sourceLayer||n.rasterLayerIds&&n.rasterLayerIds[0];if(!r)return;const s=e.paint.get("raster-particle-array-band")||n.getInitialBand(r);if(null==s)return;const o=t.getIds().map((e=>t.getTileByID(e)));for(const e of o)e.updateNeeded(r,s)&&n.prepareTile(e,r,s)}};class to{constructor(t,i,n,r){this.context=new zt(t,i),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=r,this._debugParams={showTerrainProxyTiles:!1},r.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),this.setup(),this.numSublayers=Yt.maxUnderzooming+Yt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new e.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new wn(this),this._wireframeDebugCache=new Ks,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,t){const i=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new _r(this,e));const n=this._terrain;this.transform.elevation=i?n:null,n.update(e,this.transform,t),this.transform.elevation&&!n.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,n]=t.getFovAdjustedRange(this.transform._fov);if(i>n)return void(this.transform.fogCullDistSq=null);const r=i+.78*(n-i);this.transform.fogCullDistSq=r*r}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,i){if(this.width=t*e.f.devicePixelRatio,this.height=i*e.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize()}setup(){const t=this.context,i=new e.aN;i.emplaceBack(0,0),i.emplaceBack(e.V,0),i.emplaceBack(0,e.V),i.emplaceBack(e.V,e.V),this.tileExtentBuffer=t.createVertexBuffer(i,e.aP.members),this.tileExtentSegments=e.aB.simpleSegment(0,0,4,2);const n=new e.aN;n.emplaceBack(0,0),n.emplaceBack(e.V,0),n.emplaceBack(0,e.V),n.emplaceBack(e.V,e.V),this.debugBuffer=t.createVertexBuffer(n,e.aP.members),this.debugSegments=e.aB.simpleSegment(0,0,4,5);const r=new e.aN;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(-1,1),r.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(r,e.aP.members),this.viewportSegments=e.aB.simpleSegment(0,0,4,2);const s=new e.av;s.emplaceBack(0,0,0,0),s.emplaceBack(e.V,0,e.V,0),s.emplaceBack(0,e.V,0,e.V),s.emplaceBack(e.V,e.V,e.V,e.V),this.mercatorBoundsBuffer=t.createVertexBuffer(s,e.aR.members),this.mercatorBoundsSegments=e.aB.simpleSegment(0,0,4,2);const o=new e.aw;o.emplaceBack(0,1,2),o.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(o);const a=new e.aO;for(const e of[0,1,3,2,0])a.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new e.T(t,new e.h({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=e.a6.create();const l=this.context.gl;this.stencilClearMode=new kt({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,Ct.disabled,this.stencilClearMode,Lt.disabled,Nt.disabled,dr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,i){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!i||0===i.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of i)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const n=this.context,r=n.gl;this.nextStencilID+i.length>256&&this.clearStencil(),n.setColorMode(Lt.disabled),n.setDepthMode(Ct.disabled);const s=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const e of i){const i=t.getTile(e),n=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,{tileBoundsBuffer:o,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=this.getTileBoundsBuffers(i);s.draw(this,r.TRIANGLES,Ct.disabled,new kt({func:r.ALWAYS,mask:0},n,255,r.KEEP,r.KEEP,r.REPLACE),Lt.disabled,Nt.disabled,dr(e.projMatrix),"$clipping",o,a,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new kt({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new kt({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,i=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),n=i[i.length-1].overscaledZ,r=i[0].overscaledZ-n+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const e={};for(let i=0;i<r;i++)e[i+n]=new kt({func:t.GEQUAL,mask:255},i+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=r,[e,i]}return[{[n]:kt.disabled},i]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new Lt([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new e.ax(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Lt.unblended:Lt.alphaBlended}colorModeForDrapableLayerRenderPass(t){const i=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Lt([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new e.ax(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,t,i,n=!1){if(!this.opaquePassEnabledForLayer()&&!n)return Ct.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Ct(i||this.context.gl.LEQUAL,t,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){this._wireframeDebugCache.update(this.frameCounter),this.style=t,this.options=i;const n=this.style._mergedLayers,r=this.style.order,s=r.map((e=>n[e])),o=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.f.now()),this.imageManager.beginFrame();let a=0,l=!1;for(const e in o){const t=o[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++a)}for(const e of s)e.isHidden(this.transform.zoom)||this.prepareLayer(e);const c={},u={},h={},d={},p={};for(const e in o){const t=o[e];c[e]=t.getVisibleCoordinates(),u[e]=c[e].slice().reverse(),h[e]=t.getVisibleCoordinates(!0).reverse(),d[e]=t.getShadowCasterCoordinates(),p[e]=t.sortCoordinatesByDistance(c[e])}const f=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(a){const e=[];for(const t of s)this.layerUsedInConflation(t,f(t))&&e.push(t);if(e&&e.length>1){const t=[];for(const i of e){const e=this.style.getLayerSourceCache(i);e&&e.used&&e.getSource().usedInConflation&&t.push({layer:i.fqid,cache:e})}this.replacementSource.setSources(t),l=!0}}l||this.replacementSource.clear(),this.conflationActive=l,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const e of s){const t=e.cutoffRange();if(this.longestCutoffRange=Math.max(t,this.longestCutoffRange),t>0){const t=f(e);t&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom)),e.minzoom&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let e=0;e<s.length;e++)if(s[e].is3D()){this.opaquePassCutoff=e;break}const m=this.style&&this.style.fog;m?(this._fogVisible=0!==m.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=m.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(h),this.opaquePassCutoff=0);const g=this._shadowRenderer;if(g){g.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in o)for(const t of c[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),g.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Fs(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!e.cZ(this.context.gl))return;this.renderPass="offscreen";for(const e of s){const i=t.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const n=i?u[i.id]:void 0;("custom"===e.type||"raster"===e.type||"raster-particle"===e.type||e.isSky()||n&&n.length)&&this.renderLayer(this,i,e,n)}this.depthRangeFor3D=[0,1-(s.length+2)*this.numSublayers*this.depthEpsilon];const _=this.terrain;_&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&_.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,d)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const y="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),v=(()=>{if(i.showOverdrawInspector)return e.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!y){const t=this.style.fog.properties.get("color").toArray01();return new e.ax(...t)}if(this.style.fog&&this.transform.projection.supportsFog&&y){const t=this.style.fog.properties.get("space-color").toArray01();return new e.ax(...t)}return e.ax.transparent})();if(this.context.clear({color:v,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const e=s[this.currentLayer],i=t.getLayerSourceCache(e);if(e.isSky())continue;const n=i?(e.is3D()?p:u)[i.id]:void 0;this._renderTileClippingMasks(e,i,n),this.renderLayer(this,i,e,n)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||e.S(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const e=s[this.currentLayer],i=t.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,i,e,i?u[i.id]:void 0)}function x(e,t){let i;return t&&(i=("symbol"===e.type?h:e.is3D()?p:u)[t.id]),i}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<r.length;){const e=s[this.currentLayer];if("raster"===e.type){const i=t.getLayerSourceCache(e);this.renderLayer(this,i,e,x(e,i))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let b=0;for(g&&(b=g.getShadowCastingLayerCount());this.currentLayer<r.length;){const e=s[this.currentLayer],i=t.getLayerSourceCache(e);if(e.isSky())++this.currentLayer;else if(_&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=_.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(e,i,i?c[i.id]:void 0),this.renderLayer(this,i,e,x(e,i)),!_&&g&&b>0&&e.hasShadowPass()&&0==--b&&(g.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){const e=s[this.currentLayer];if(!e.hasLightBeamPass())continue;const i=t.getLayerSourceCache(e);this.renderLayer(this,i,e,i?u[i.id]:void 0)}this.currentLayer=e,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let i=null;s.forEach((e=>{const n=t.getLayerSourceCache(e);n&&!e.isHidden(this.transform.zoom)&&n.getVisibleCoordinates().length&&(!i||i.getSource().maxzoom<n.getSource().maxzoom)&&(i=n)})),i&&this.options.showTileBoundaries&&Qs.debug(this,i,i.getVisibleCoordinates(),e.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Qs.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new e.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(e){const t=e.transform.padding;Ms(e,e.transform.height-(t.top||0),3,xs),Ms(e,t.bottom||0,3,bs),Is(e,t.left||0,3,ws),Is(e,e.transform.width-(t.right||0),3,Ss);const i=e.transform.centerPoint;!function(e,t,i,n){As(e,t-1,i-10,2,20,n),As(e,t-10,i-1,20,2,n)}(e,i.x,e.transform.height-i.y,Ts)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),l||(this.conflationActive=!1)}prepareLayer(e){this.gpuTimingStart(e);const{unsupportedLayers:t}=this.transform.projection,i=!t||!t.includes(e.type);if(eo[e.type]&&(i||this.terrain&&"custom"===e.type)){const t=this.style.getLayerSourceCache(e);eo[e.type](e,t,this)}this.gpuTimingEnd()}renderLayer(e,t,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||"raster-particle"===i.type||n&&n.length)&&(this.id=i.id,this.gpuTimingStart(i),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(i.type)||e.terrain&&"custom"===i.type)&&Qs[i.type](e,t,i,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,i=this.context.gl;let n=this.gpuTimers[e.id];n||(n=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:i.createQuery()}),n.calls++,i.beginQuery(t.TIME_ELAPSED_EXT,n.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,i=t.createQuery();this.deferredRenderGpuTimeQueries.push(i),t.beginQuery(e.TIME_ELAPSED_EXT,i)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const i in e){const n=e[i],r=this.context.extTimerQuery,s=r.getQueryParameter(n.query,this.context.gl.QUERY_RESULT)/1e6;r.deleteQueryEXT(n.query),t[i]=s}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery,i=this.context.gl;let n=0;for(const r of e)n+=t.getQueryParameter(r,i.QUERY_RESULT)/1e6,t.deleteQueryEXT(r);return n}translatePosMatrix(t,i,n,r,s){if(!n[0]&&!n[1])return t;const o=s?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(o){const e=Math.sin(o),t=Math.cos(o);n=[n[0]*t-n[1]*e,n[0]*e+n[1]*t]}const a=[s?n[0]:e.a3(i,n[0],this.transform.zoom),s?n[1]:e.a3(i,n[1],this.transform.zoom),0],l=new Float32Array(16);return e.a6.translate(l,t,a),l}saveTileTexture(e){const t=e.size[0],i=this._tileTextures[t];i?i.push(e):this._tileTextures[t]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e,t){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString(),t)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,i){const n=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,r=this.terrain&&0===this.terrain.exaggeration(),s=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(s.push("LIGHTING_3D_MODE"),s.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):n||s.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||s.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?s.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):s.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(s.push("TERRAIN"),this.linearFloatFilteringSupported()&&s.push("TERRAIN_DEM_FLOAT_FORMAT"),r&&s.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&s.push("GLOBE"),!this._fogVisible||n||void 0!==t&&!t||s.push("FOG","FOG_DITHERING"),n&&s.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&s.push("OVERDRAW_INSPECTOR"),s}getOrCreateProgram(e,t){this.cache=this.cache||{};const i=t&&t.defines||[],n=t&&t.config,r=t&&t.transformFeedback,s=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(i),o=br.cacheKey(Yn[e],e,s,n);return this.cache[o]||(this.cache[o]=new br(this.context,e,Yn[e],n,Kr[e],s,r)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,i){if(this.style.enable3dLights()){const n=this.style.directionalLight,r=this.style.ambientLight;if(n&&r){const s=((t,i)=>{const n=t.properties.get("direction"),r=t.properties.get("color").toArray01(),s=t.properties.get("intensity"),o=i.properties.get("color").toArray01(),a=i.properties.get("intensity"),l=[n.x,n.y,n.z],c=e.cn(o,a),u=e.cn(r,s);return{u_lighting_ambient_color:c,u_lighting_directional_dir:l,u_lighting_directional_color:u,u_ground_radiance:yr(l,u,c)}})(n,r);i.setLightsUniformValues(t,s)}}}uploadCommonUniforms(t,i,n,r,s){if(this.uploadCommonLightUniforms(t,i),this.terrain&&this.terrain.renderingToTexture)return;const o=this.style.fog;if(o){const s=o.getOpacity(this.transform.pitch),a=((t,i,n,r,s,o,a,l,c,u,h,d)=>{const p=t.transform,f=i.properties.get("color").toArray01();f[3]=r;const m=t.frameCounter/1e3%1,[g,_]=i.properties.get("vertical-range");return{u_fog_matrix:n?p.calculateFogTileMatrix(n):d||t.identityMat,u_fog_range:i.getFovAdjustedRange(p._fov),u_fog_color:f,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(g,_),_],u_fog_temporal_offset:m,u_frustum_tl:s,u_frustum_tr:o,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:e.S(p.zoom),u_is_globe:+("globe"===p.projection.name)}})(this,o,n,s,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.f.devicePixelRatio,this.transform.height*e.f.devicePixelRatio],r);i.setFogUniformValues(t,a)}s&&i.setCutoffUniformValues(t,s.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(const n of i)t[n.key]=e[n.key]||new Vt(n,512,this.transform.tileZoom,this);return t}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,t){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||"building"!==e.sourceLayer&&(!t||"batched-model"!==t.type))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=ge||t[1]>=ge}}function io(e,t){let i=!1,n=null;const r=()=>{n=null,i&&(e(),n=setTimeout(r,t),i=!1)};return()=>(i=!0,n||r(),n)}class no{constructor(t){this._hashName=t&&encodeURIComponent(t),e.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=io(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const t=ro(e);if(this._hashName){const e=this._hashName;let i=!1;const n=location.hash.slice(1).split("&").map((n=>{const r=n.split("=")[0];return r===e?(i=!0,`${r}=${t}`):n})).filter((e=>e));return i||n.push(`${e}=${t}`),`#${n.join("&")}`}return`#${t}`}_getCurrentHash(){const e=location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const i=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:i,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ro(e,t){const i=e.getCenter(),n=Math.round(100*e.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),s=Math.pow(10,r),o=Math.round(i.lng*s)/s,a=Math.round(i.lat*s)/s,l=e.getBearing(),c=e.getPitch();let u=t?`/${o}/${a}/${n}`:`${n}/${a}/${o}`;return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),u}const so={linearity:.3,easing:e.c_(0,0,.3,1)},oo=e.e({deceleration:2500,maxSpeed:1400},so),ao=e.e({deceleration:20,maxSpeed:1400},so),lo=e.e({deceleration:1e3,maxSpeed:360},so),co=e.e({deceleration:1e3,maxSpeed:90},so);class uo{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.f.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=e.f.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)i.zoom+=e.zoomDelta||0,i.bearing+=e.bearingDelta||0,i.pitch+=e.pitchDelta||0,e.panDelta&&i.pan._add(e.panDelta),e.around&&(i.around=e.around),e.pinchAround&&(i.pinchAround=e.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(i.pan.mag()){const s=po(i.pan.mag(),n,e.e({},oo,t||{}));r.offset=i.pan.mult(s.amount/i.pan.mag()),r.center=this._map.transform.center,ho(r,s)}if(i.zoom){const e=po(i.zoom,n,ao);r.zoom=this._map.transform.zoom+e.amount,ho(r,e)}if(i.bearing){const t=po(i.bearing,n,lo);r.bearing=this._map.transform.bearing+e.aa(t.amount,-179,179),ho(r,t)}if(i.pitch){const e=po(i.pitch,n,co);r.pitch=this._map.transform.pitch+e.amount,ho(r,e)}if(r.zoom||r.bearing){const e=void 0===i.pinchAround?i.around:i.pinchAround;r.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),r.noMoveStart=!0,r}}function ho(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function po(t,i,n){const{maxSpeed:r,linearity:s,deceleration:o}=n,a=e.aa(t*s/(i/1e3),-r,r),l=Math.abs(a)/(o*s);return{easing:n.easing,duration:1e3*l,amount:a*(l/2)}}class fo extends e.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n,r={}){const s=f(i.getCanvasContainer(),n),o=i.unproject(s);super(t,e.e({point:s,lngLat:o,originalEvent:n},r)),this._defaultPrevented=!1,this.target=i}}class mo extends e.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n){const r="touchend"===t?n.changedTouches:n.touches,s=m(i.getCanvasContainer(),r),o=s.map((e=>i.unproject(e))),a=s.reduce(((e,t,i,n)=>e.add(t.div(n.length))),new e.P(0,0));super(t,{points:s,point:a,lngLats:o,lngLat:i.unproject(a),originalEvent:n}),this._defaultPrevented=!1}}class go extends e.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class _o{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new go(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new fo(e.type,this._map,e))}mouseup(e){this._map.fire(new fo(e.type,this._map,e))}preclick(t){const i=e.e({},t);i.type="preclick",this._map.fire(new fo(i.type,this._map,i))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new fo(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new fo(e.type,this._map,e))}mouseover(e){this._map.fire(new fo(e.type,this._map,e))}mouseout(e){this._map.fire(new fo(e.type,this._map,e))}touchstart(e){return this._firePreventable(new mo(e.type,this._map,e))}touchmove(e){this._map.fire(new mo(e.type,this._map,e))}touchend(e){this._map.fire(new mo(e.type,this._map,e))}touchcancel(e){this._map.fire(new mo(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yo{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new fo(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new fo(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vo{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(u(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const i=t,n=this._startPos,r=this._lastPos;if(!n||!r||r.equals(i)||!this._box&&i.dist(n)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=s("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const o=Math.min(n.x,i.x),a=Math.max(n.x,i.x),l=Math.min(n.y,i.y),c=Math.max(n.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${o}px,${l}px)`,this._box.style.width=a-o+"px",this._box.style.height=c-l+"px")}))}mouseupWindow(t,i){if(!this._active)return;const n=this._startPos,r=i;if(n&&0===t.button){if(this.reset(),p(),n.x!==r.x||n.y!==r.y)return this._map.fire(new e.b("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(n,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new e.b(t,{originalEvent:i}))}}function xo(e,t){const i={};for(let n=0;n<e.length;n++)i[e[n].identifier]=t[n];return i}class bo{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=function(t){const i=new e.P(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=xo(n,i)))}touchmove(e,t,i){if(this.aborted||!this.centroid)return;const n=xo(i,t);for(const e in this.touches){const t=n[e];(!t||t.dist(this.touches[e])>30)&&(this.aborted=!0)}}touchend(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class wo{constructor(e){this.singleTap=new bo(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,i){this.singleTap.touchstart(e,t,i)}touchmove(e,t,i){this.singleTap.touchmove(e,t,i)}touchend(e,t,i){const n=this.singleTap.touchend(e,t,i);if(n){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(n)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class So{constructor(){this._zoomIn=new wo({numTouches:1,numTaps:2}),this._zoomOut=new wo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i)}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i)}touchend(e,t,i){const n=this._zoomIn.touchend(e,t,i),r=this._zoomOut.touchend(e,t,i);return n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(n)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const To={0:1,2:2};class Eo{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const i=g(e);this._correctButton(e,i)&&(this._lastPoint=t,this._eventButton=i)}mousemoveWindow(e,t){const i=this._lastPoint;if(i)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const i=To[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(e){this._lastPoint&&g(e)===this._eventButton&&(this._moved&&p(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mo extends Eo{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class Io extends Eo{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault()}}class Ao extends Eo{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault()}}class Co{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),e.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(t,i,n){if(this._active&&!(n.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===n.length&&!e.c$())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,n)}}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,n){n.length>0&&(this._active=!0);const r=xo(n,i),s=new e.P(0,0),o=new e.P(0,0);let a=0;for(const e in r){const t=r[e],i=this._touches[e];i&&(s._add(t),o._add(t.sub(i)),a++,r[e]=t)}if(this._touches=r,a<this._minTouches||!o.mag())return;const l=o.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:s.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=s("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Po{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,i){return{}}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,i){const n=this._firstTwoTouches;if(!n)return;e.preventDefault();const[r,s]=n,o=ko(i,t,r),a=ko(i,t,s);if(!o||!a)return;const l=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],l,e)}touchend(e,t,i){if(!this._firstTwoTouches)return;const[n,r]=this._firstTwoTouches,s=ko(i,t,n),o=ko(i,t,r);s&&o||(this._active&&p(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ko(e,t,i){for(let n=0;n<e.length;n++)if(e[n].identifier===i)return t[n]}function Ro(e,t){return Math.log(e/t)/Math.LN2}class Lo extends Po{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ro(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ro(this._distance,i),pinchAround:t}}}function Do(e,t){return 180*e.angleWith(t)/Math.PI}class Oo extends Po{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const i=this._vector;if(this._vector=e[0].sub(e[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Do(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const n=Do(e,i);return Math.abs(n)<t}}function No(e){return Math.abs(e.y)>Math.abs(e.x)}class zo extends Po{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,No(e[0].sub(e[1]))&&(this._valid=!1)}_move(t,i,n){const r=this._lastPoints;if(!r)return;const s=t[0].sub(r[0]),o=t[1].sub(r[1]);return this._map._cooperativeGestures&&!e.c$()&&n.touches.length<3||(this._valid=this.gestureBeginsVertically(s,o,n.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(s.y+o.y)/2*-.5})}gestureBeginsVertically(e,t,i){if(void 0!==this._valid)return this._valid;const n=e.mag()>=2,r=t.mag()>=2;if(!n&&!r)return;if(!n||!r)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const s=e.y>0==t.y>0;return No(e)&&No(t)&&s}}const Fo={panStep:100,bearingStep:15,pitchStep:10};class Bo{constructor(){const e=Fo;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,i=0,n=0,r=0,s=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?n=1:(e.preventDefault(),s=-1);break;case 40:e.shiftKey?n=-1:(e.preventDefault(),s=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:o=>{const a=o.getZoom();o.easeTo({duration:300,easeId:"keyboardHandler",easing:Uo,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:o.getBearing()+i*this._bearingStep,pitch:o.getPitch()+n*this._pitchStep,offset:[-r*this._panStep,-s*this._panStep],center:o.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Uo(e){return e*(2-e)}const Vo=4.000244140625,jo=1/450;class Go{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=jo,e.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.c$()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const n=e.f.now(),r=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==i&&i%Vo==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(r*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=f(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>Vo?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==n&&(n=1/n);const r=i(),s=Math.pow(2,r),o="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):s;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(o*n))),"wheel"===this._type&&(this._startZoom=r,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:i(),r=this._startZoom,s=this._easing;let o,a=!1;if("wheel"===this._type&&r&&s){const t=Math.min((e.f.now()-this._lastWheelEventTime)/200,1),i=s(t);o=e.U(r,n,i),t<1?this._frameId||(this._frameId=!0):a=!0}else o=n,a=!0;this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let l=o-i();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!a,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.d0;if(this._prevEase){const t=this._prevEase,n=(e.f.now()-t.start)/t.duration,r=t.easing(n+.01)-t.easing(n),s=.27/Math.sqrt(r*r+1e-4)*.01,o=Math.sqrt(.0729-s*s);i=e.c_(s,o,.25,1)}return this._prevEase={start:e.f.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=s("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Ho{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wo{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qo{constructor(){this._tap=new wo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=t[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,t,i))}touchmove(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const n=t[0],r=n.y-this._swipePoint.y;return this._swipePoint=n,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,i)}touchend(e,t,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,t,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $o{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zo{constructor(e,t,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xo{constructor(e,t,i,n){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Yo=e=>e.zoom||e.drag||e.pitch||e.rotate;class Ko extends e.b{}class Jo{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){const n=e.N.sub([],i,t);this.radius=e.N.length(n[2]<0?e.N.div([],n,this.constants):[n[0],n[1],0])}projectRay(t){e.N.div(t,t,this.constants),e.N.normalize(t,t),e.N.mul(t,t,this.constants);const i=e.N.scale([],t,this.radius);if(i[2]>0){const t=e.N.scale([],[0,0,1],e.N.dot(i,[0,0,1])),n=e.N.scale([],e.N.normalize([],[i[0],i[1],0]),this.radius),r=e.N.add([],i,e.N.scale([],e.N.sub([],e.N.add([],n,t),i),2));i[0]=r[0],i[1]=r[1]}return i}}function Qo(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class ea{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new uo(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Jo,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),e.aY(["handleEvent","handleWindowEvent"],this);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,t,i]of this._listeners){const n=e===document?this.handleWindowEvent:this.handleEvent;e.addEventListener(t,n,i)}}destroy(){for(const[e,t,i]of this._listeners){const n=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(t,n,i)}}_addDefaultHandlers(e){const t=this._map,i=t.getCanvasContainer();this._add("mapEvent",new _o(t,e));const n=t.boxZoom=new vo(t,e);this._add("boxZoom",n);const r=new So,s=new Wo;t.doubleClickZoom=new Ho(s,r),this._add("tapZoom",r),this._add("clickZoom",s);const o=new qo;this._add("tapDragZoom",o);const a=t.touchPitch=new zo(t);this._add("touchPitch",a);const l=new Io(e),c=new Ao(e);t.dragRotate=new Zo(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new Mo(e),h=new Co(t,e);t.dragPan=new $o(i,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new Oo,p=new Lo;t.touchZoomRotate=new Xo(i,p,d,o),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new yo(t));const f=t.scrollZoom=new Go(t,this);this._add("scrollZoom",f,["mousePan"]);const m=t.keyboard=new Bo;this._add("keyboard",m);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[i]&&t[i].enable(e[i])}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Yo(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,i){for(const n in e)if(n!==i&&(!t||t.indexOf(n)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}handleEvent(e,t){this._updatingCamera=!0;const i="renderFrame"===e.type,n=i?void 0:e,r={needsRenderFrame:!1},s={},o={},a=e.touches?this._getMapTouches(e.touches):void 0,l=a?m(this._el,a):i?void 0:f(this._el,e);for(const{handlerName:i,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;this._blockedByActive(o,u,i)?c.reset():c[t||e.type]&&(h=c[t||e.type](e,l,a),this.mergeHandlerResult(r,s,h,i,n),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||c.isActive())&&(o[i]=c)}const c={};for(const e in this._previousActiveHandlers)o[e]||(c[e]=n);this._previousActiveHandlers=o,(Object.keys(c).length||Qo(r))&&(this._changes.push([r,s,c]),this._triggerRenderFrame()),(Object.keys(o).length||Qo(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=r;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(t,i,n,r,s){if(!n)return;e.e(t,n);const o={handlerName:r,originalEvent:n.originalEvent||s};void 0!==n.zoomDelta&&(i.zoom=o),void 0!==n.panDelta&&(i.drag=o),void 0!==n.pitchDelta&&(i.pitch=o),void 0!==n.bearingDelta&&(i.rotate=o)}_applyChanges(){const t={},i={},n={};for(const[r,s,o]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.aroundCoord&&(t.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),e.e(i,s),e.e(n,o);this._updateMapTransform(t,i,n),this._changes=[]}_updateMapTransform(t,i,n){const r=this._map,s=r.transform,o=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!Qo(t)){const e=s.zoom;s.cameraElevationReference="sea",null!=this._originalZoom&&s._orthographicProjectionAtLowPitch&&"globe"!==s.projection.name&&0===s.pitch?(s.cameraElevationReference="ground",s.zoom=this._originalZoom):(s.recenterOnTerrain(),s.cameraElevationReference="ground"),e!==s.zoom&&this._map._update(!0)}if(s._isCameraConstrained&&r._stop(!0),!Qo(t))return void this._fireEvents(i,n,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:p}=t;s._isCameraConstrained&&(l>0&&(l=0),s._isCameraConstrained=!1),void 0!==p&&(h=p),(l||(e=>i[e]&&!this._eventsInProgress[e])("drag"))&&h&&(this._dragOrigin=o(s.pointCoordinate3D(h)),this._originalZoom=s.zoom,this._trackingEllipsoid.setup(s._camera.position,this._dragOrigin)),s.cameraElevationReference="sea",r._stop(!0),h=h||r.transform.centerPoint,c&&(s.bearing+=c),u&&(s.pitch+=u),s._updateCameraState();const f=[0,0,0];if(a)if("mercator"===s.projection.name){const e=this._trackingEllipsoid.projectRay(s.screenPointToMercatorRay(h).dir),t=this._trackingEllipsoid.projectRay(s.screenPointToMercatorRay(h.sub(a)).dir);f[0]=t[0]-e[0],f[1]=t[1]-e[1]}else{const t=s.pointCoordinate(h);if("globe"===s.projection.name){a=a.rotate(-s.angle);const i=s._pixelsPerMercatorPixel/s.worldSize;f[0]=-a.x*e.d1(e.au(t.y))*i,f[1]=-a.y*e.d1(s.center.lat)*i}else{const e=s.pointCoordinate(h.sub(a));t&&e&&(f[0]=e.x-t.x,f[1]=e.y-t.y)}}const m=s.zoom,g=[0,0,0];if(l){const t=o(d||s.pointCoordinate3D(h)),i={dir:e.N.normalize([],e.N.sub([],t,s._camera.position))};if(i.dir[2]<0){const n=s.zoomDeltaToMovement(t,l);e.N.scale(g,i.dir,n)}}const _=e.N.add(f,f,g);s._translateCameraConstrained(_),l&&Math.abs(s.zoom-m)>1e-4&&s.recenterOnTerrain(),s.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,n,!0)}_fireEvents(t,i,n){const r=Yo(this._eventsInProgress),s=Yo(t),o={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(o[`${e}start`]=i),this._eventsInProgress[e]=t[e]}!r&&s&&this._fireEvent("movestart",s.originalEvent);for(const e in o)this._fireEvent(e,o[e]);s&&this._fireEvent("move",s.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i)}const a={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:n}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=i[t]||n,a[`${e}end`]=l)}for(const e in a)this._fireEvent(e,a[e]);const c=Yo(this._eventsInProgress);if(n&&(r||s)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(i(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.b("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new e.b(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new Ko("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ta="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ia extends e.E{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=!1!==i.respectPrefersReducedMotion,e.aY(["_renderFrameCallback"],this)}getCenter(){return new e.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,i,n){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.e({offset:t},i),n)}panTo(t,i,n){return this.easeTo(e.e({center:t},i),n)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,i,n){return this.easeTo(e.e({zoom:t},i),n)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,i,n){return this.easeTo(e.e({bearing:t},i),n)}resetNorth(t,i){return this.rotateTo(0,e.e({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(e.e({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,i){t=e.ad.convert(t);const n=i&&i.bearing||0,r=i&&i.pitch||0,s=t.getNorthWest(),o=t.getSouthEast();return this._cameraForBounds(this.transform,s,o,n,r,i)}_extendCameraOptions(t){const i={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=e.e({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const e=t.padding;t.padding={top:e,bottom:e,right:e,left:e}}return t.padding=e.e(i,t.padding),t}_minimumAABBFrustumDistance(e,t){const i=t.max[0]-t.min[0],n=t.max[1]-t.min[1];return i/n>e.aspect?i/(2*Math.tan(.5*e.fovX)*e.aspect):n/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,i,n,r,s,o){const a=t.clone(),l=this._extendCameraOptions(o);a.bearing=r,a.pitch=s;const c=e.bn.convert(i),u=e.bn.convert(n),h=.5*(c.lat+u.lat),d=.5*(c.lng+u.lng),p=e.d2(h,d),f=e.N.normalize([],p),m=e.N.normalize([],e.N.cross([],f,[0,1,0])),g=e.N.cross([],m,f),_=[m[0],m[1],m[2],0,g[0],g[1],g[2],0,f[0],f[1],f[2],0,0,0,0,1],y=[p,e.d2(c.lat,c.lng),e.d2(u.lat,c.lng),e.d2(u.lat,u.lng),e.d2(c.lat,u.lng),e.d2(h,c.lng),e.d2(h,u.lng),e.d2(c.lat,d),e.d2(u.lat,d)];let v=e.bS.fromPoints(y.map((t=>[e.N.dot(m,t),e.N.dot(g,t),e.N.dot(f,t)])));const x=e.N.transformMat4([],v.center,_);0===e.N.squaredLength(x)&&e.N.set(x,0,0,1),e.N.normalize(x,x),e.N.scale(x,x,e.ab),a.center=e.d3(x);const b=a.getWorldToCameraMatrix(),w=e.a6.invert(new Float64Array(16),b);v=e.bS.applyTransform(v,e.a6.multiply([],b,_)),e.N.transformMat4(x,x,b);const S=.5*(v.max[2]-v.min[2]),T=this._minimumAABBFrustumDistance(a,v),E=e.N.scale([],[0,0,1],S),M=e.N.add(E,x,E),I=T+(0===a.pitch?0:e.N.distance(x,M)),A=a.globeCenterInViewSpace,C=e.N.sub([],x,[A[0],A[1],A[2]]);e.N.normalize(C,C),e.N.scale(C,C,I);const P=e.N.add([],x,C);e.N.transformMat4(P,P,w);const k=e.d4/e.ab,R=e.N.length(P),L=e.bl(Math.max(R*k-e.d4,Number.EPSILON),0),D=Math.min(a.zoomFromMercatorZAdjusted(L),l.maxZoom);return D>.5*(e.bG+e.bx)?(a.setProjection({name:"mercator"}),a.zoom=D,this._cameraForBounds(a,i,n,r,s,o)):{center:a.center,zoom:D,bearing:r,pitch:s}}queryTerrainElevation(t,i){const n=this.transform.elevation;return n?(i=e.e({},{exaggerated:!0},i),n.getAtPoint(e.L.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,n,r,s,o){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,i,n,r,s,o);const a=t.clone(),l=this._extendCameraOptions(o),c=a.padding;a.bearing=r,a.pitch=s;const u=e.bn.convert(i),h=e.bn.convert(n),d=new e.bn(u.lng,h.lat),p=new e.bn(h.lng,u.lat),f=a.project(u),m=a.project(h),g=this.queryTerrainElevation(u),_=this.queryTerrainElevation(h),y=this.queryTerrainElevation(d),v=this.queryTerrainElevation(p),x=[[f.x,f.y,Math.min(g||0,_||0,y||0,v||0)],[m.x,m.y,Math.max(g||0,_||0,y||0,v||0)]];let b=e.bS.fromPoints(x);const w=a.getWorldToCameraMatrix(),S=e.a6.invert(new Float64Array(16),w);b=e.bS.applyTransform(b,w);const T=e.N.sub([],b.max,b.min),E=c.left||0,M=c.right||0,I=c.bottom||0,A=c.top||0,{left:C,right:P,top:k,bottom:R}=l.padding,L=.5*(E+M),D=.5*(A+I),O=Math.min(a.scaleZoom(a.scale*Math.min((a.width-(E+M+C+P))/T[0],(a.height-(I+A+R+k))/T[1])),l.maxZoom),N=a.scale/a.zoomScale(O);b=new e.bS([b.min[0]-(C+L)*N,b.min[1]-(R+D)*N,b.min[2]],[b.max[0]+(P+L)*N,b.max[1]+(k+D)*N,b.max[2]]);const z=.5*T[2],F=this._minimumAABBFrustumDistance(a,b),B=[0,0,1,0];e.a7.transformMat4(B,B,w),e.a7.normalize(B,B);const U=e.N.scale([],B,F+z),V=e.N.add([],b.center,U),j=("number"==typeof l.offset.x&&"number"==typeof l.offset.y?new e.P(l.offset.x,l.offset.y):e.P.convert(l.offset)).rotate(-e.bj(r));b.center[0]-=j.x*N,b.center[1]+=j.y*N,e.N.transformMat4(b.center,b.center,S),e.N.transformMat4(V,V,S);const G=[b.center[0],b.center[1],V[2]*a.pixelsPerMeter];e.N.scale(G,G,1/a.worldSize);const H=e.at(G[0]),W=e.au(G[1]),q=Math.min(a._zoomFromMercatorZ(G[2]),l.maxZoom),$=new e.bn(H,W);return a.mercatorFromTransition&&q<.5*(e.bG+e.bx)?(a.setProjection({name:"globe"}),a.zoom=q,this._cameraForBounds(a,i,n,r,s,o)):{center:$,zoom:q,bearing:r,pitch:s}}fitBounds(e,t,i){const n=this.cameraForBounds(e,t);return this._fitInternal(n,t,i)}fitScreenCoordinates(t,i,n,r,s){const o=e.P.convert(t),a=e.P.convert(i),l=new e.P(Math.min(o.x,a.x),Math.min(o.y,a.y)),c=new e.P(Math.max(o.x,a.x),Math.max(o.y,a.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(o,a))return this;const u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(c),d=this.transform.pointLocation3D(new e.P(l.x,c.y)),p=this.transform.pointLocation3D(new e.P(c.x,l.y)),f=[Math.min(u.lng,h.lng,d.lng,p.lng),Math.min(u.lat,h.lat,d.lat,p.lat)],m=[Math.max(u.lng,h.lng,d.lng,p.lng),Math.max(u.lat,h.lat,d.lat,p.lat)],g=r&&r.pitch?r.pitch:this.getPitch(),_=this._cameraForBounds(this.transform,f,m,n,g,r);return this._fitInternal(_,r,s)}_fitInternal(t,i,n){return t?(delete(i=e.e(t,i)).padding,i.linear?this.easeTo(i,n):this.flyTo(i,n)):this}jumpTo(t,i){this.stop();const n=t.preloadOnly?this.transform.clone():this.transform;let r=!1,s=!1,o=!1;return"zoom"in t&&n.zoom!==+t.zoom&&(r=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=e.bn.convert(t.center)),"bearing"in t&&n.bearing!==+t.bearing&&(s=!0,n.bearing=+t.bearing),"pitch"in t&&n.pitch!==+t.pitch&&(o=!0,n.pitch=+t.pitch),null==t.padding||n.isPaddingEqual(t.padding)||(n.padding=t.padding),t.preloadOnly?(this._preloadTiles(n),this):(this.fire(new e.b("movestart",i)).fire(new e.b("move",i)),r&&this.fire(new e.b("zoomstart",i)).fire(new e.b("zoom",i)).fire(new e.b("zoomend",i)),s&&this.fire(new e.b("rotatestart",i)).fire(new e.b("rotate",i)).fire(new e.b("rotateend",i)),o&&this.fire(new e.b("pitchstart",i)).fire(new e.b("pitch",i)).fire(new e.b("pitchend",i)),this.fire(new e.b("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.w(ta),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){const n=this.transform;if(!n.projection.supportsFreeCamera)return e.w(ta),this;this.stop();const r=n.zoom,s=n.pitch,o=n.bearing;n.setFreeCameraOptions(t);const a=r!==n.zoom,l=s!==n.pitch,c=o!==n.bearing;return this.fire(new e.b("movestart",i)).fire(new e.b("move",i)),a&&this.fire(new e.b("zoomstart",i)).fire(new e.b("zoom",i)).fire(new e.b("zoomend",i)),c&&this.fire(new e.b("rotatestart",i)).fire(new e.b("rotate",i)).fire(new e.b("rotateend",i)),l&&this.fire(new e.b("pitchstart",i)).fire(new e.b("pitch",i)).fire(new e.b("pitchend",i)),this.fire(new e.b("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),(!1===(t=e.e({offset:[0,0],duration:500,easing:e.d0},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const n=this.transform,r=this.getZoom(),s=this.getBearing(),o=this.getPitch(),a=this.getPadding(),l="zoom"in t?+t.zoom:r,c="bearing"in t?this._normalizeBearing(t.bearing,s):s,u="pitch"in t?+t.pitch:o,h="padding"in t?t.padding:n.padding,d=e.P.convert(t.offset);let p,f,m;if("globe"===n.projection.name){const i=e.L.fromLngLat(n.center),r=d.rotate(-n.angle);i.x+=r.x/n.worldSize,i.y+=r.y/n.worldSize;const s=i.toLngLat(),o=e.bn.convert(t.center||s);this._normalizeCenter(o),p=n.centerPoint.add(r),f=new e.P(i.x,i.y).mult(n.worldSize),m=new e.P(e.a5(o.lng),e.ae(o.lat)).mult(n.worldSize).sub(f)}else{p=n.centerPoint.add(d);const i=n.pointLocation(p),r=e.bn.convert(t.center||i);this._normalizeCenter(r),f=n.project(i),m=n.project(r).sub(f)}const g=n.zoomScale(l-r);let _,y;t.around&&(_=e.bn.convert(t.around),y=n.locationPoint(_));const v=this._zooming||l!==r,x=this._rotating||s!==c,b=this._pitching||u!==o,w=!n.isPaddingEqual(h),S=n=>S=>{if(v&&(n.zoom=e.U(r,l,S)),x&&(n.bearing=e.U(s,c,S)),b&&(n.pitch=e.U(o,u,S)),w&&(n.interpolatePadding(a,h,S),p=n.centerPoint.add(d)),_)n.setLocationAtPoint(_,y);else{const e=n.zoomScale(n.zoom-r),t=l>r?Math.min(2,g):Math.max(.5,g),i=Math.pow(t,1-S),s=n.unproject(f.add(m.mult(S*i)).mult(e));n.setLocationAtPoint(n.renderWorldCopies?s.wrap():s,p)}return t.preloadOnly||this._fireMoveEvents(i),n};if(t.preloadOnly){const e=this._emulate(S,t.duration,n);return this._preloadTiles(e),this}const T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=x,this._pitching=b,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,T),this._ease(S(n),(e=>{"sea"===n.cameraElevationReference&&n.recenterOnTerrain(),this._afterEase(i,e)}),t),this}_prepareEase(t,i,n={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),i||n.moving||this.fire(new e.b("movestart",t)),this._zooming&&!n.zooming&&this.fire(new e.b("zoomstart",t)),this._rotating&&!n.rotating&&this.fire(new e.b("rotatestart",t)),this._pitching&&!n.pitching&&this.fire(new e.b("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.b("move",t)),this._zooming&&this.fire(new e.b("zoom",t)),this._rotating&&this.fire(new e.b("rotate",t)),this._pitching&&this.fire(new e.b("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const n=this._zooming,r=this._rotating,s=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,n&&this.fire(new e.b("zoomend",t)),r&&this.fire(new e.b("rotateend",t)),s&&this.fire(new e.b("pitchend",t)),this.fire(new e.b("moveend",t))}flyTo(t,i){if(this._prefersReducedMotion(t)){const n=e.ac(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,i)}this.stop(),t=e.e({offset:[0,0],speed:1.2,curve:1.42,easing:e.d0},t);const n=this.transform,r=this.getZoom(),s=this.getBearing(),o=this.getPitch(),a="zoom"in t?e.aa(+t.zoom,n.minZoom,n.maxZoom):r,l="bearing"in t?this._normalizeBearing(t.bearing,s):s,c="pitch"in t?+t.pitch:o,u=n.zoomScale(a-r),h=e.P.convert(t.offset),d=n.centerPoint.add(h),p=n.pointLocation(d);let f=t.center;if(f&&t.padding){const e=this._cameraForBounds(this.transform,f,f,l,c,t);e&&(f=e.center)}f=e.bn.convert(f||p),this._normalizeCenter(f);const m=n.project(p),g=n.project(f).sub(m);let _=t.curve;const y=Math.max(n.width,n.height),v=y/u,x=g.mag();if("minZoom"in t){const i=e.aa(Math.min(t.minZoom,r,a),n.minZoom,n.maxZoom),s=y/n.zoomScale(i-r);_=Math.sqrt(s/x*2)}const b=_*_;function w(e){const t=(v*v-y*y+(e?-1:1)*b*b*x*x)/(2*(e?v:y)*b*x);return Math.log(Math.sqrt(t*t+1)-t)}function S(e){return(Math.exp(e)-Math.exp(-e))/2}function T(e){return(Math.exp(e)+Math.exp(-e))/2}const E=w(0);let M=function(e){return T(E)/T(E+_*e)},I=function(e){return y*((T(E)*(S(t=E+_*e)/T(t))-S(E))/b)/x;var t},A=(w(1)-E)/_;if(Math.abs(x)<1e-6||!isFinite(A)){if(Math.abs(y-v)<1e-6)return this.easeTo(t,i);const e=v<y?-1:1;A=Math.abs(Math.log(v/y))/_,I=function(){return 0},M=function(t){return Math.exp(e*_*t)}}t.duration="duration"in t?+t.duration:1e3*A/("screenSpeed"in t?+t.screenSpeed/_:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const C=s!==l,P=c!==o,k=n=>u=>{const h=u*A,p=1/M(h);n.zoom=1===u?a:r+n.scaleZoom(p),C&&(n.bearing=e.U(s,l,u)),P&&(n.pitch=e.U(o,c,u));const _=1===u?f:n.unproject(m.add(g.mult(I(h))).mult(p));return n.setLocationAtPoint(n.renderWorldCopies?_.wrap():_,d),n._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),n};if(t.preloadOnly){const e=this._emulate(k,t.duration,n);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=C,this._pitching=P,this._prepareEase(i,!1),this._ease(k(n),(()=>this._afterEase(i)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,i,n){!1===n.animate||0===n.duration?(t(1),i()):(this._easeStart=e.f.now(),this._easeOptions=n,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.f.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=e.bh(t,-180,180);const n=Math.abs(t-i);return Math.abs(t-360-i)<n&&(t-=360),Math.abs(t+360-i)<n&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(t.maxBounds)return;if("globe"!==t.projection.name&&!t.renderWorldCopies)return;const i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&e.f.prefersReducedMotion&&!(t&&t.essential)}_emulate(e,t,i){const n=Math.ceil(15*t/1e3),r=[],s=e(i.clone());for(let e=0;e<=n;e++){const t=s(e/n);r.push(t.clone())}return r}}class na{constructor(t={}){this.options=t,e.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=s("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=s("button","mapboxgl-ctrl-attrib-button",this._container),s("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=s("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const i=this._map._getUIString(`AttributionControl.${t}`);e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.d5.ACCESS_TOKEN}];if(t){const n=i.reduce(((e,t,n)=>(t.value&&(e+=`${t.key}=${t.value}${n<i.length-1?"&":""}`),e)),"?");t.href=`${e.d5.FEEDBACK_URL}/${n}#${ro(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const i in t){const n=t[i];if(n.used){const t=n.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let n=i+1;n<e.length;n++)if(e[n].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ra{constructor(){e.aY(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=s("div","mapboxgl-ctrl");const t=s("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const i=e[t].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class sa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function oa(t,i,n){if(t=new e.bn(t.lng,t.lat),i){const r=new e.bn(t.lng-360,t.lat),s=new e.bn(t.lng+360,t.lat),o=360*Math.ceil(Math.abs(t.lng-n.center.lng)/360),a=n.locationPoint(t).distSqr(i),l=i.x<0||i.y<0||i.x>n.width||i.y>n.height;n.locationPoint(r).distSqr(i)<a&&(l||Math.abs(r.lng-n.center.lng)<o)?t=r:n.locationPoint(s).distSqr(i)<a&&(l||Math.abs(s.lng-n.center.lng)<o)&&(t=s)}for(;Math.abs(t.lng-n.center.lng)>180;){const e=n.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=n.width&&e.y<=n.height)break;t.lng>n.center.lng?t.lng-=360:t.lng+=360}return t}const aa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class la extends e.E{constructor(t,i){if(super(),(t instanceof HTMLElement||i)&&(t=e.e({element:t},i)),e.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=s("div");const i=41,n=27,r=o("svg",{display:"block",height:i*this._scale+"px",width:n*this._scale+"px",viewBox:`0 0 ${n} ${i}`},this._element),a=o("radialGradient",{id:"shadowGradient"},o("defs",{},r));o("stop",{offset:"10%","stop-opacity":.4},a),o("stop",{offset:"100%","stop-opacity":.05},a),o("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r),o("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),o("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),o("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),this._offset=e.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const n=this._element.classList;for(const e in aa)n.remove(`mapboxgl-marker-anchor-${e}`);n.add(`mapboxgl-marker-anchor-${this._anchor}`);const r=t&&t.className?t.className.trim().split(/\s+/):[];n.add(...r),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.bn.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,n=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[n,-1*(t-i+n)],"bottom-right":[-n,-1*(t-i+n)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const i=e.unproject(t),n=e.getFreeCameraOptions();if(!n.position)return!1;const r=n.position.toLngLat();return r.distanceTo(i)<.9*r.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();const n=t.unproject(i);let r;t._showingGlobe()&&e.d6(t.transform,this._lngLat)?r=0:(r=1-t._queryFogOpacity(n),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(r*=this._occludedOpacity)),this._element.style.opacity=`${r}`,this._element.style.pointerEvents=r>0?"auto":"none",this._popup&&this._popup._setOpacity(r),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px)\n            ${aa[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${t.x}px,${t.y}px)\n        `}_calculateXYTransform(){const t=this._pos,i=this._map,n=this.getPitchAlignment();if(!i||!t||"map"!==n)return"";if(!i._showingGlobe()){const e=i.getPitch();return e?`rotateX(${e}deg)`:""}const r=e.bF(e.d7(i.transform,this._lngLat)),s=t.sub(e.d8(i.transform)),o=Math.abs(s.x)+Math.abs(s.y);if(0===o)return"";const a=r/o;return`rotateX(${-s.y*a}deg) rotateY(${s.x*a}deg)`}_calculateZTransform(){const t=this._pos,i=this._map;if(!i||!t)return"";let n=0;const r=this.getRotationAlignment();if("map"===r)if(i._showingGlobe()){const t=i.project(new e.bn(this._lngLat.lng,this._lngLat.lat+.001)),r=i.project(new e.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(t);n=e.bF(Math.atan2(r.y,r.x))-90}else n=-i.getBearing();else if("horizon"===r){const r=e.O(4,6,i.getZoom()),s=e.d8(i.transform);s.y+=r*i.transform.height;const o=t.sub(s),a=e.bF(Math.atan2(o.y,o.x));n=(a>90?a-270:a+90)*(1-r)}return n+=this._rotation,n?`rotateZ(${n}deg)`:""}_update(e){cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=oa(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat),!0===e?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),t._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(t){const i=this._map;if(!i)return;const n=this._pointerdownPos,r=this._positionDelta;if(n&&r){if(!this._isDragging){const e=this._clickTolerance||i._clickTolerance;if(t.point.dist(n)<e)return;this._isDragging=!0}this._pos=t.point.sub(r),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.b("dragstart"))),this.fire(new e.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.b("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,i=this._pos;t&&i&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(i),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ca={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ua=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ha(t=new e.P(0,0),i="bottom"){if("number"==typeof t){const n=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(i){case"top":return new e.P(0,t);case"top-left":return new e.P(n,n);case"top-right":return new e.P(-n,n);case"bottom":return new e.P(0,-t);case"bottom-left":return new e.P(n,-n);case"bottom-right":return new e.P(-n,-n);case"left":return new e.P(t,0);case"right":return new e.P(-t,0)}return new e.P(0,0)}return t instanceof e.P||Array.isArray(t)?e.P.convert(t):e.P.convert(t[i]||[0,0])}class da{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const i=e.cc((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,i){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+i}}const pa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},fa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class ma{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const ga={showCompass:!0,showZoom:!0,visualizePitch:!1};class _a{constructor(t,i,n=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new Io({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,n&&(this.mousePitch=new Ao({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),u()}move(e,t){const i=this.map,n=this.mouseRotate.mousemoveWindow(e,t),r=n&&n.bearingDelta;if(r&&i.setBearing(i.getBearing()+r),this.mousePitch){const n=this.mousePitch.mousemoveWindow(e,t),r=n&&n.pitchDelta;r&&i.setPitch(i.getPitch()+r)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.e({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),f(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,f(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=m(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=m(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ya={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},va={maxWidth:100,unit:"metric"},xa={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ba={version:e.dk,supported:i,setRTLTextPlugin:e.dm,getRTLTextPluginStatus:e.dn,Map:class extends ia{constructor(t){const i=t;if(null!=(t=e.e({},fa,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.d9(window)&&(t.antialias=!1,e.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new gn(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._repaint=!1,this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new sa,this._domRenderTaskQueue=new sa,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.aC(),this._locale=e.e({},pa,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new da(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new e.da(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?{...t.contextCreateOptions}:{},"string"==typeof t.container){const e=document.getElementById(t.container);if(!e)throw new Error(`Container '${t.container.toString()}' not found.`);this._container=e}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),e.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new ma,this._tp=t.devtools?new Js(this):new Js,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,(e=>{this.repaint=e})),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,(e=>{this.showTileAABBs=e})),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,(e=>{this.showPadding=e})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,(()=>{this._update()})),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ea(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||e.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new no("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==i.center&&null==i.zoom||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const n=t.bounds;n&&(this.resize(),this.fitBounds(n,e.e({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new na({customAttribution:t.customAttribution})),this._logoControl=new ra,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.b(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.b(`${t.dataType}dataloading`,t))}))}_getMapId(){return this._mapId}addControl(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[i];return-1!==i.indexOf("bottom")?r.insertBefore(n,r.firstChild):r.appendChild(n),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new e.b("movestart",t)).fire(new e.b("move",t)),this.fire(new e.b("resize",t)),i&&this.fire(new e.b("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.ad.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.b("zoomstart")).fire(new e.b("zoom")).fire(new e.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.b("zoomstart")).fire(new e.b("zoom")).fire(new e.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.b("pitchstart")).fire(new e.b("pitch")).fire(new e.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.b("pitchstart")).fire(new e.b("pitch")).fire(new e.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map((e=>"auto"===e?navigator.language:e)):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const e of this._controls)e._setLanguage&&e._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,i=t.projection.name;let n;"globe"===i&&t.zoom>=e.bx?(t.setMercatorFromTransition(),n=!0):"mercator"===i&&t.zoom<e.bx&&(t.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let i;return i="globe"===t.name&&this.transform.zoom>=e.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t){return this.transform.locationPoint3D(e.bn.convert(t))}unproject(t){return this.transform.pointLocation3D(e.P.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,i){if("mouseenter"===e||"mouseover"===e){let n=!1;const r=r=>{const s=t.filter((e=>this.getLayer(e))),o=s.length?this.queryRenderedFeatures(r.point,{layers:s}):[];o.length?n||(n=!0,i.call(this,new fo(e,this,r.originalEvent,{features:o}))):n=!1},s=()=>{n=!1};return{layers:new Set(t),listener:i,delegates:{mousemove:r,mouseout:s}}}if("mouseleave"===e||"mouseout"===e){let n=!1;const r=r=>{const s=t.filter((e=>this.getLayer(e)));(s.length?this.queryRenderedFeatures(r.point,{layers:s}):[]).length?n=!0:n&&(n=!1,i.call(this,new fo(e,this,r.originalEvent)))},s=t=>{n&&(n=!1,i.call(this,new fo(e,this,t.originalEvent)))};return{layers:new Set(t),listener:i,delegates:{mousemove:r,mouseout:s}}}{const n=e=>{const n=t.filter((e=>this.getLayer(e))),r=n.length?this.queryRenderedFeatures(e.point,{layers:n}):[];r.length&&(e.features=r,i.call(this,e),delete e.features)};return{layers:new Set(t),listener:i,delegates:{[e]:n}}}}on(e,t,i){if(void 0===i)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t)for(const e of t)if(!this._isValidId(e))return this;const n=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(n);for(const e in n.delegates)this.on(e,n.delegates[e]);return this}once(e,t,i){if(void 0===i)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t)for(const e of t)if(!this._isValidId(e))return this;const n=this._createDelegatedListener(e,t,i);for(const e in n.delegates)this.once(e,n.delegates[e]);return this}off(e,t,i){if(void 0===i)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(const e of t)if(!this._isValidId(e))return this;const n=(e,t)=>{if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0},r=this._delegatedListeners?this._delegatedListeners[e]:void 0;return r&&(e=>{for(let r=0;r<e.length;r++){const s=e[r];if(s.listener===i&&n(s.layers,t)){for(const e in s.delegates)this.off(e,s.delegates[e]);return e.splice(r,1),this}}})(r),this}queryRenderedFeatures(t,i){if(!this.style)return[];if(void 0!==i||void 0===t||t instanceof e.P||Array.isArray(t)||(i=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers))for(const e of i.layers)if(!this._isValidId(e))return[];return this.style.queryRenderedFeatures(t,i,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(t){const{name:i}=this.transform.projection;return"globe"!==i&&"mercator"!==i&&e.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(e.P.convert(t))}setStyle(t,i){return!1!==(i=e.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(t,i))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new Ln(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ln(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,i){if("string"==typeof t){const n=this._requestManager.normalizeStyleURL(t),r=this._requestManager.transformRequest(n,e.R.Style);e.g(r,((t,n)=>{t?this.fire(new e.a(t)):n&&this._updateDiff(n,i)}))}else"object"==typeof t&&this._updateDiff(t,i)}_updateDiff(t,i){try{this.style.setState(t)&&this._update(!0)}catch(n){e.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(t,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.w("There is no style added to the map."),!1)}_isValidId(t){return null==t?(this.fire(new e.a(new Error("IDs can't be empty."))),!1):!e.c4(t)||(this.fire(new e.a(new Error(`IDs can't contain special symbols: "${t}".`))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(t,i,{pixelRatio:n=1,sdf:r=!1,stretchX:s,stretchY:o,content:a}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:l,height:c,data:u}=e.f.getImageData(i);this.style.addImage(t,{data:new e.h({width:l,height:c},u),pixelRatio:n,stretchX:s,stretchY:o,content:a,sdf:r,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new e.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=i,u=i;this.style.addImage(t,{data:new e.h({width:l,height:c},new Uint8Array(u.data)),pixelRatio:n,stretchX:s,stretchY:o,content:a,sdf:r,version:0,userImage:u}),u.onAdd&&u.onAdd(this,t)}}updateImage(t,i){this._lazyInitEmptyStyle();const n=this.style.getImage(t);if(!n)return void this.fire(new e.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?e.f.getImageData(i):i,{width:s,height:o}=r,a=r.data;if(void 0===s||void 0===o)return void this.fire(new e.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(s!==n.data.width||o!==n.data.height)return void this.fire(new e.a(new Error(`The width and height of the updated image (${s}, ${o})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`)));const l=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);n.data.replace(a,l),this.style.updateImage(t,n)}hasImage(t){return t?!!this.style&&!!this.style.getImage(t):(this.fire(new e.a(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(t,i){e.d(this._requestManager.transformRequest(t,e.R.Image),((t,n)=>{i(t,n instanceof HTMLImageElement?e.f.getImageData(n):n)}))}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new e.a(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}getSlot(e){const t=this.getLayer(e);return t&&t.slot||null}setSlot(e,t){return this.style.setSlot(e,t),this.style.mergeLayers(),this._update(!0)}addImport(e,t){return this.style.addImport(e,t),this}updateImport(e,t){return"string"!=typeof t&&t.id!==e?(this.removeImport(e),this.addImport(t)):(this.style.updateImport(e,t),this._update(!0))}removeImport(e){return this.style.removeImport(e),this}moveImport(e,t){return this.style.moveImport(e,t),this._update(!0)}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,i){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,i),this._update(!0)):this}setFilter(e,t,i={}){return this._isValidId(e)?(this.style.setFilter(e,t,i),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,i,n={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,i,n),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,i,n={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,i,n),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,i){return this.style.setConfigProperty(e,t,i),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.bn.convert(t),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let i,n,r,s=this._container;for(;s&&(!n||!r);){const e=window.getComputedStyle(s).transform;e&&"none"!==e&&(i=e.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&"0"!==i[0]&&"1"!==i[0]&&(n=i[0]),i[3]&&"0"!==i[3]&&"1"!==i[3]&&(r=i[3])),s=s.parentElement}this._containerWidth=n?Math.abs(e/n):e,this._containerHeight=r?Math.abs(t/r):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=s("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=s("div","mapboxgl-canvas-container",e);this._canvas=s("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=s("div","mapboxgl-control-container",e),n=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{n[e]=s("div",`mapboxgl-ctrl-${e}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,i){const n=e.f.devicePixelRatio||1;this._canvas.width=n*Math.ceil(t),this._canvas.height=n*Math.ceil(i),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${i}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const t=e.e({},i.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",t);n?(e.db(n,!0),this.painter=new to(n,this._contextCreateOptions,this.transform,this._tp),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.dc.testSupport(n)):this.fire(new e.a(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.b("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.b("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let i;this.fire(new e.b("renderstart"));const n=this.painter.context.extTimerQuery,r=e.f.now(),s=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=s.createQuery(),s.beginQuery(n.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const o=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,i=this.transform.pitch,n=e.f.now(),r=new e.K(t,{now:n,fadeDuration:o,pitch:i,transition:this.style.transition});this.style.update(r)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(r),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):a=this._updateAverageElevation(r),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const t=e.f.now()-r;s.endQuery(n.TIME_ELAPSED_EXT),setTimeout((()=>{const n=s.getQueryParameter(i,s.QUERY_RESULT)/1e6;s.deleteQuery(i),this.fire(new e.b("gpu-timing-frame",{cpuTime:t,gpuTime:n}))}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(t);this.fire(new e.b("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.b("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(l||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(t&&(a=this._updateAverageElevation(r,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.b("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._performanceMetricsCollection&&e.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){const i=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);const n=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(n||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let r=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(r)?r=0:this._averageElevationLastSampledAt=e;const s=Math.abs(t-r);if(s>1){if(this._isInitialLoad||n)return this._averageElevation.jumpTo(r),i(r);this._averageElevation.easeTo(r,e,300)}else if(s>1e-4)return this._averageElevation.jumpTo(r),i(r)}return!!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}_authenticate(){e.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===e.df||401===t.status)){const t=this.painter.context.gl;e.db(t,!1),this._logoControl instanceof ra&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),e.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,n=i.createFramebuffer();function r(e){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0);const t=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,t),t}return i.bindFramebuffer(i.FRAMEBUFFER,n),this._canvasPixelComparison(r(e),t.canvasCopies.map(r),t.timeStamps)}_canvasPixelComparison(e,t,i){let n=i[1]-i[0];const r=e.length/4;for(let s=0;s<t.length;s++){const o=t[s];let a=0;for(let t=0;t<o.length;t+=4)o[t]===e[t]&&o[t+1]===e[t+1]&&o[t+2]===e[t+2]&&o[t+3]===e[t+3]&&(a+=1);n+=(i[s+2]-i[s+1])*(1-a/r)}return n}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),e.dh(this.painter.context.gl),e.di.remove(),e.dj.remove(),this._removed=!0,this.fire(new e.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.f.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(t){const i=this.style?Object.values(this.style._sourceCaches):[];return e.b1(i,((e,i)=>e._preloadTiles(t,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(e){this._showParseStatus!==e&&(this._showParseStatus=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(t,i){e.dl(t,i)}get version(){return e.dk}},NavigationControl:class{constructor(t){this.options=e.e({},ga,t),this._container=s("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),s("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),s("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=s("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),i=t===e.getMaxZoom(),n=t===e.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _a(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const i=s("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends e.E{constructor(t){super();const i=navigator.geolocation;this.options=e.e({geolocation:i},ya,t),e.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=io(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=s("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){const t=(t=!!this.options.geolocation)=>{this._supportsGeolocation=t,e(t)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then((e=>t("denied"!==e.state))).catch((()=>t())):t()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),i=e.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.b("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.b("geolocate",t)),this._finish()}}_updateCamera(t){const i=new e.bn(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,r=this._map.getBearing(),s=e.e({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(n),s,{geolocateSource:!0})}_updateMarker(t){if(t){const i=new e.bn(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,i=e.bl(1,t._center.lat)*t.worldSize,n=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.b("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=s("button","mapboxgl-ctrl-geolocate",this._container),s("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=s("div","mapboxgl-user-location"),this._dotElement.appendChild(s("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(s("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new la({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=s("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new la({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.b("trackuserlocationend")))}))}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&e()})).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:na,ScaleControl:class{constructor(t){this.options=e.e({},va,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),e.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,n=t._containerWidth/2-e/2,r=t.unproject([n,i]),s=t.unproject([n+e,i]),o=r.distanceTo(s);if("imperial"===this.options.unit){const t=3.2808*o;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,o/1852,"nautical-mile"):o>=1e3?this._setScale(e,o/1e3,"kilometer"):this._setScale(e,o,"meter")}_setScale(e,t,i){this._map._requestDomTask((()=>{const n=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(i),t*i}(t),r=n/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==i?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(n):`${n}&nbsp;${xa[i]}`,this._container.style.width=e*r+"px"}))}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=s("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),e.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=s("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=s("button","mapboxgl-ctrl-fullscreen",this._controlContainer);s("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.E{constructor(t){super(),this.options=e.e(Object.create(ca),t),e.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.b("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.bn.convert(t),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),i=document.createElement("body");let n;for(i.innerHTML=e;n=i.firstChild,n;)t.appendChild(n);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=s("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=s("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,i=this._container,n=this._pos;if(!t||!i||!n)return"bottom";const r=i.offsetWidth,s=i.offsetHeight,o=n.x<r/2,a=n.x>t.transform.width-r/2;if(n.y+e<s)return o?"top-left":a?"top-right":"top";if(n.y>t.transform.height-s){if(o)return"bottom-left";if(a)return"bottom-right"}return o?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const i=this._map,n=this._content;if(!i||!this._lngLat&&!this._trackPointer||!n)return;let r=this._container;if(r||(r=this._container=s("div","mapboxgl-popup",i.getContainer()),this._tip=s("div","mapboxgl-popup-tip",r),r.appendChild(n)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=oa(this._lngLat,this._pos,i.transform)),!this._trackPointer||t){const e=this._pos=this._trackPointer&&t?t:i.project(this._lngLat),n=ha(this.options.offset),r=this._anchor=this._getAnchor(n.y),s=ha(this.options.offset,r),o=e.add(s).round();i._requestDomTask((()=>{this._container&&r&&(this._container.style.transform=`${aa[r]} translate(${o.x}px,${o.y}px)`)}))}if(!this._marker&&i._showingGlobe()){const t=e.d6(i.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(ua);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:la,Style:Ln,LngLat:e.bn,LngLatBounds:e.ad,Point:e.P,MercatorCoordinate:e.L,FreeCameraOptions:dn,Evented:e.E,config:e.d5,prewarm:e.dp,clearPrewarmedResources:e.dq,get accessToken(){return e.d5.ACCESS_TOKEN},set accessToken(t){e.d5.ACCESS_TOKEN=t},get baseApiUrl(){return e.d5.API_URL},set baseApiUrl(t){e.d5.API_URL=t},get workerCount(){return e.dr.workerCount},set workerCount(t){e.dr.workerCount=t},get maxParallelImageRequests(){return e.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.d5.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.ds(t)},get workerUrl(){return e.dt.workerUrl},set workerUrl(t){e.dt.workerUrl=t},get workerClass(){return e.dt.workerClass},set workerClass(t){e.dt.workerClass=t},get workerParams(){return e.dt.workerParams},set workerParams(t){e.dt.workerParams=t},get dracoUrl(){return e.du()},set dracoUrl(t){e.dv(t)},get meshoptUrl(){return e.dw()},set meshoptUrl(t){e.dx(t)},setNow:e.f.setNow,restoreNow:e.f.restoreNow};return ba})),i}()},544:()=>{!function(){"use strict";var e=function(e){this.element_=e,this.init()};window.MaterialButton=e,e.prototype.Constant_={},e.prototype.CssClasses_={RIPPLE_EFFECT:"mdl-js-ripple-effect",RIPPLE_CONTAINER:"mdl-button__ripple-container",RIPPLE:"mdl-ripple"},e.prototype.blurHandler_=function(e){e&&this.element_.blur()},e.prototype.disable=function(){this.element_.disabled=!0},e.prototype.disable=e.prototype.disable,e.prototype.enable=function(){this.element_.disabled=!1},e.prototype.enable=e.prototype.enable,e.prototype.init=function(){if(this.element_){if(this.element_.classList.contains(this.CssClasses_.RIPPLE_EFFECT)){var e=document.createElement("span");e.classList.add(this.CssClasses_.RIPPLE_CONTAINER),this.rippleElement_=document.createElement("span"),this.rippleElement_.classList.add(this.CssClasses_.RIPPLE),e.appendChild(this.rippleElement_),this.boundRippleBlurHandler=this.blurHandler_.bind(this),this.rippleElement_.addEventListener("mouseup",this.boundRippleBlurHandler),this.element_.appendChild(e)}this.boundButtonBlurHandler=this.blurHandler_.bind(this),this.element_.addEventListener("mouseup",this.boundButtonBlurHandler),this.element_.addEventListener("mouseleave",this.boundButtonBlurHandler)}},componentHandler.register({constructor:e,classAsString:"MaterialButton",cssClass:"mdl-js-button",widget:!0})}()},511:()=>{var e={upgradeDom:function(e,t){},upgradeElement:function(e,t){},upgradeElements:function(e){},upgradeAllRegistered:function(){},registerUpgradedCallback:function(e,t){},register:function(e){},downgradeElements:function(e){}};(e=function(){"use strict";var e=[],t=[],i="mdlComponentConfigInternal_";function n(t,i){for(var n=0;n<e.length;n++)if(e[n].className===t)return void 0!==i&&(e[n]=i),e[n];return!1}function r(e){var t=e.getAttribute("data-upgraded");return null===t?[""]:t.split(",")}function s(e,t){return-1!==r(e).indexOf(t)}function o(e,t,i){if("CustomEvent"in window&&"function"==typeof window.CustomEvent)return new CustomEvent(e,{bubbles:t,cancelable:i});var n=document.createEvent("Events");return n.initEvent(e,t,i),n}function a(t,i){if(void 0===t&&void 0===i)for(var r=0;r<e.length;r++)a(e[r].className,e[r].cssClass);else{var s=t;if(void 0===i){var o=n(s);o&&(i=o.cssClass)}for(var c=document.querySelectorAll("."+i),u=0;u<c.length;u++)l(c[u],s)}}function l(a,l){if(!("object"==typeof a&&a instanceof Element))throw new Error("Invalid argument provided to upgrade MDL element.");var c=o("mdl-componentupgrading",!0,!0);if(a.dispatchEvent(c),!c.defaultPrevented){var u=r(a),h=[];if(l)s(a,l)||h.push(n(l));else{var d=a.classList;e.forEach((function(e){d.contains(e.cssClass)&&-1===h.indexOf(e)&&!s(a,e.className)&&h.push(e)}))}for(var p,f=0,m=h.length;f<m;f++){if(!(p=h[f]))throw new Error("Unable to find a registered component for the given class.");u.push(p.className),a.setAttribute("data-upgraded",u.join(","));var g=new p.classConstructor(a);g[i]=p,t.push(g);for(var _=0,y=p.callbacks.length;_<y;_++)p.callbacks[_](a);p.widget&&(a[p.className]=g);var v=o("mdl-componentupgraded",!0,!1);a.dispatchEvent(v)}}}function c(e){if(e){var n=t.indexOf(e);t.splice(n,1);var r=e.element_.getAttribute("data-upgraded").split(","),s=r.indexOf(e[i].classAsString);r.splice(s,1),e.element_.setAttribute("data-upgraded",r.join(","));var a=o("mdl-componentdowngraded",!0,!1);e.element_.dispatchEvent(a)}}return{upgradeDom:a,upgradeElement:l,upgradeElements:function e(t){Array.isArray(t)||(t=t instanceof Element?[t]:Array.prototype.slice.call(t));for(var i,n=0,r=t.length;n<r;n++)(i=t[n])instanceof HTMLElement&&(l(i),i.children.length>0&&e(i.children))},upgradeAllRegistered:function(){for(var t=0;t<e.length;t++)a(e[t].className)},registerUpgradedCallback:function(e,t){var i=n(e);i&&i.callbacks.push(t)},register:function(t){var r=!0;void 0===t.widget&&void 0===t.widget||(r=t.widget||t.widget);var s={classConstructor:t.constructor||t.constructor,className:t.classAsString||t.classAsString,cssClass:t.cssClass||t.cssClass,widget:r,callbacks:[]};if(e.forEach((function(e){if(e.cssClass===s.cssClass)throw new Error("The provided cssClass has already been registered: "+e.cssClass);if(e.className===s.className)throw new Error("The provided className has already been registered")})),t.constructor.prototype.hasOwnProperty(i))throw new Error("MDL component classes must not have "+i+" defined as a property.");n(t.classAsString,s)||e.push(s)},downgradeElements:function(e){var i=function(e){t.filter((function(t){return t.element_===e})).forEach(c)};if(e instanceof Array||e instanceof NodeList)for(var n=0;n<e.length;n++)i(e[n]);else{if(!(e instanceof Node))throw new Error("Invalid argument provided to downgrade MDL nodes.");i(e)}}}}()).ComponentConfigPublic,e.ComponentConfig,e.Component,e.upgradeDom=e.upgradeDom,e.upgradeElement=e.upgradeElement,e.upgradeElements=e.upgradeElements,e.upgradeAllRegistered=e.upgradeAllRegistered,e.registerUpgradedCallback=e.registerUpgradedCallback,e.register=e.register,e.downgradeElements=e.downgradeElements,window.componentHandler=e,window.componentHandler=e,window.addEventListener("load",(function(){"use strict";"classList"in document.createElement("div")&&"querySelector"in document&&"addEventListener"in window&&Array.prototype.forEach?(document.documentElement.classList.add("mdl-js"),e.upgradeAllRegistered()):(e.upgradeElement=function(){},e.register=function(){})}))},550:()=>{!function(){"use strict";var e=function(e){this.element_=e,this.init()};window.MaterialProgress=e,e.prototype.Constant_={},e.prototype.CssClasses_={INDETERMINATE_CLASS:"mdl-progress__indeterminate"},e.prototype.setProgress=function(e){this.element_.classList.contains(this.CssClasses_.INDETERMINATE_CLASS)||(this.progressbar_.style.width=e+"%")},e.prototype.setProgress=e.prototype.setProgress,e.prototype.setBuffer=function(e){this.bufferbar_.style.width=e+"%",this.auxbar_.style.width=100-e+"%"},e.prototype.setBuffer=e.prototype.setBuffer,e.prototype.init=function(){if(this.element_){var e=document.createElement("div");e.className="progressbar bar bar1",this.element_.appendChild(e),this.progressbar_=e,(e=document.createElement("div")).className="bufferbar bar bar2",this.element_.appendChild(e),this.bufferbar_=e,(e=document.createElement("div")).className="auxbar bar bar3",this.element_.appendChild(e),this.auxbar_=e,this.progressbar_.style.width="0%",this.bufferbar_.style.width="100%",this.auxbar_.style.width="0%",this.element_.classList.add("is-upgraded")}},componentHandler.register({constructor:e,classAsString:"MaterialProgress",cssClass:"mdl-js-progress",widget:!0})}()},822:()=>{!function(){"use strict";var e=function(e){this.element_=e,this.init()};window.MaterialSpinner=e,e.prototype.Constant_={MDL_SPINNER_LAYER_COUNT:4},e.prototype.CssClasses_={MDL_SPINNER_LAYER:"mdl-spinner__layer",MDL_SPINNER_CIRCLE_CLIPPER:"mdl-spinner__circle-clipper",MDL_SPINNER_CIRCLE:"mdl-spinner__circle",MDL_SPINNER_GAP_PATCH:"mdl-spinner__gap-patch",MDL_SPINNER_LEFT:"mdl-spinner__left",MDL_SPINNER_RIGHT:"mdl-spinner__right"},e.prototype.createLayer=function(e){var t=document.createElement("div");t.classList.add(this.CssClasses_.MDL_SPINNER_LAYER),t.classList.add(this.CssClasses_.MDL_SPINNER_LAYER+"-"+e);var i=document.createElement("div");i.classList.add(this.CssClasses_.MDL_SPINNER_CIRCLE_CLIPPER),i.classList.add(this.CssClasses_.MDL_SPINNER_LEFT);var n=document.createElement("div");n.classList.add(this.CssClasses_.MDL_SPINNER_GAP_PATCH);var r=document.createElement("div");r.classList.add(this.CssClasses_.MDL_SPINNER_CIRCLE_CLIPPER),r.classList.add(this.CssClasses_.MDL_SPINNER_RIGHT);for(var s=[i,n,r],o=0;o<s.length;o++){var a=document.createElement("div");a.classList.add(this.CssClasses_.MDL_SPINNER_CIRCLE),s[o].appendChild(a)}t.appendChild(i),t.appendChild(n),t.appendChild(r),this.element_.appendChild(t)},e.prototype.createLayer=e.prototype.createLayer,e.prototype.stop=function(){this.element_.classList.remove("is-active")},e.prototype.stop=e.prototype.stop,e.prototype.start=function(){this.element_.classList.add("is-active")},e.prototype.start=e.prototype.start,e.prototype.init=function(){if(this.element_){for(var e=1;e<=this.Constant_.MDL_SPINNER_LAYER_COUNT;e++)this.createLayer(e);this.element_.classList.add("is-upgraded")}},componentHandler.register({constructor:e,classAsString:"MaterialSpinner",cssClass:"mdl-js-spinner",widget:!0})}()},930:()=>{!function(){"use strict";var e=function(e){this.element_=e,this.maxRows=this.Constant_.NO_MAX_ROWS,this.init()};window.MaterialTextfield=e,e.prototype.Constant_={NO_MAX_ROWS:-1,MAX_ROWS_ATTRIBUTE:"maxrows"},e.prototype.CssClasses_={LABEL:"mdl-textfield__label",INPUT:"mdl-textfield__input",IS_DIRTY:"is-dirty",IS_FOCUSED:"is-focused",IS_DISABLED:"is-disabled",IS_INVALID:"is-invalid",IS_UPGRADED:"is-upgraded",HAS_PLACEHOLDER:"has-placeholder"},e.prototype.onKeyDown_=function(e){var t=e.target.value.split("\n").length;13===e.keyCode&&t>=this.maxRows&&e.preventDefault()},e.prototype.onFocus_=function(e){this.element_.classList.add(this.CssClasses_.IS_FOCUSED)},e.prototype.onBlur_=function(e){this.element_.classList.remove(this.CssClasses_.IS_FOCUSED)},e.prototype.onReset_=function(e){this.updateClasses_()},e.prototype.updateClasses_=function(){this.checkDisabled(),this.checkValidity(),this.checkDirty(),this.checkFocus()},e.prototype.checkDisabled=function(){this.input_.disabled?this.element_.classList.add(this.CssClasses_.IS_DISABLED):this.element_.classList.remove(this.CssClasses_.IS_DISABLED)},e.prototype.checkDisabled=e.prototype.checkDisabled,e.prototype.checkFocus=function(){Boolean(this.element_.querySelector(":focus"))?this.element_.classList.add(this.CssClasses_.IS_FOCUSED):this.element_.classList.remove(this.CssClasses_.IS_FOCUSED)},e.prototype.checkFocus=e.prototype.checkFocus,e.prototype.checkValidity=function(){this.input_.validity&&(this.input_.validity.valid?this.element_.classList.remove(this.CssClasses_.IS_INVALID):this.element_.classList.add(this.CssClasses_.IS_INVALID))},e.prototype.checkValidity=e.prototype.checkValidity,e.prototype.checkDirty=function(){this.input_.value&&this.input_.value.length>0?this.element_.classList.add(this.CssClasses_.IS_DIRTY):this.element_.classList.remove(this.CssClasses_.IS_DIRTY)},e.prototype.checkDirty=e.prototype.checkDirty,e.prototype.disable=function(){this.input_.disabled=!0,this.updateClasses_()},e.prototype.disable=e.prototype.disable,e.prototype.enable=function(){this.input_.disabled=!1,this.updateClasses_()},e.prototype.enable=e.prototype.enable,e.prototype.change=function(e){this.input_.value=e||"",this.updateClasses_()},e.prototype.change=e.prototype.change,e.prototype.init=function(){if(this.element_&&(this.label_=this.element_.querySelector("."+this.CssClasses_.LABEL),this.input_=this.element_.querySelector("."+this.CssClasses_.INPUT),this.input_)){this.input_.hasAttribute(this.Constant_.MAX_ROWS_ATTRIBUTE)&&(this.maxRows=parseInt(this.input_.getAttribute(this.Constant_.MAX_ROWS_ATTRIBUTE),10),isNaN(this.maxRows)&&(this.maxRows=this.Constant_.NO_MAX_ROWS)),this.input_.hasAttribute("placeholder")&&this.element_.classList.add(this.CssClasses_.HAS_PLACEHOLDER),this.boundUpdateClassesHandler=this.updateClasses_.bind(this),this.boundFocusHandler=this.onFocus_.bind(this),this.boundBlurHandler=this.onBlur_.bind(this),this.boundResetHandler=this.onReset_.bind(this),this.input_.addEventListener("input",this.boundUpdateClassesHandler),this.input_.addEventListener("focus",this.boundFocusHandler),this.input_.addEventListener("blur",this.boundBlurHandler),this.input_.addEventListener("reset",this.boundResetHandler),this.maxRows!==this.Constant_.NO_MAX_ROWS&&(this.boundKeyDownHandler=this.onKeyDown_.bind(this),this.input_.addEventListener("keydown",this.boundKeyDownHandler));var e=this.element_.classList.contains(this.CssClasses_.IS_INVALID);this.updateClasses_(),this.element_.classList.add(this.CssClasses_.IS_UPGRADED),e&&this.element_.classList.add(this.CssClasses_.IS_INVALID),this.input_.hasAttribute("autofocus")&&(this.element_.focus(),this.checkFocus())}},componentHandler.register({constructor:e,classAsString:"MaterialTextfield",cssClass:"mdl-js-textfield",widget:!0})}()},72:e=>{"use strict";var t=[];function i(e){for(var i=-1,n=0;n<t.length;n++)if(t[n].identifier===e){i=n;break}return i}function n(e,n){for(var s={},o=[],a=0;a<e.length;a++){var l=e[a],c=n.base?l[0]+n.base:l[0],u=s[c]||0,h="".concat(c," ").concat(u);s[c]=u+1;var d=i(h),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)t[d].references++,t[d].updater(p);else{var f=r(p,n);n.byIndex=a,t.splice(a,0,{identifier:h,updater:f,references:1})}o.push(h)}return o}function r(e,t){var i=t.domAPI(t);return i.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,r){var s=n(e=e||[],r=r||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=i(s[o]);t[a].references--}for(var l=n(e,r),c=0;c<s.length;c++){var u=i(s[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}s=l}}},659:e=>{"use strict";var t={};e.exports=function(e,i){var n=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(i)}},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,i)=>{"use strict";e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var n="";i.supports&&(n+="@supports (".concat(i.supports,") {")),i.media&&(n+="@media ".concat(i.media," {"));var r=void 0!==i.layer;r&&(n+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),n+=i.css,r&&(n+="}"),i.media&&(n+="}"),i.supports&&(n+="}");var s=i.sourceMap;s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},625:()=>{document.getElementById("loadingScreen").style.opacity=1,window.addEventListener("load",(function(){setTimeout((function(){let e=document.querySelectorAll(".loadup");function t(e){return new Promise((t=>{let i=0;const n=setInterval((function(){i+=.02,e.style.opacity=Math.min(i,1),i>=1&&(clearInterval(n),t())}),10)}))}(async function(){for(let i of e)await t(i)})().then((()=>{document.getElementById("loadingScreen").style.display="none"}))}),500)}))},48:e=>{"use strict";e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+Cjxzdmcgd2lkdGg9IjEyIiBoZWlnaHQ9IjQiIHZpZXdQb3J0PSIwIDAgMTIgNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxlbGxpcHNlIGN4PSIyIiBjeT0iMiIgcng9IjIiIHJ5PSIyIj4KICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImN4IiBmcm9tPSIyIiB0bz0iLTEwIiBkdXI9IjAuNnMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiAvPgogIDwvZWxsaXBzZT4KICA8ZWxsaXBzZSBjeD0iMTQiIGN5PSIyIiByeD0iMiIgcnk9IjIiIGNsYXNzPSJsb2FkZXIiPgogICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iY3giIGZyb209IjE0IiB0bz0iMiIgZHVyPSIwLjZzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgLz4KICA8L2VsbGlwc2U+Cjwvc3ZnPgo="}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={id:n,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}i.m=e,i.amdD=function(){throw new Error("define cannot be used indirect")},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.b=document.baseURI||self.location.href,i.nc=void 0,(()=>{"use strict";var e={};i.r(e),i.d(e,{FirebaseError:()=>In,SDK_VERSION:()=>rs,_DEFAULT_ENTRY_NAME:()=>jr,_addComponent:()=>$r,_addOrOverwriteComponent:()=>Zr,_apps:()=>Hr,_clearComponents:()=>es,_components:()=>qr,_getProvider:()=>Yr,_isFirebaseApp:()=>Jr,_isFirebaseServerApp:()=>Qr,_registerComponent:()=>Xr,_removeServiceInstance:()=>Kr,_serverApps:()=>Wr,deleteApp:()=>cs,getApp:()=>as,getApps:()=>ls,initializeApp:()=>ss,initializeServerApp:()=>os,onLog:()=>hs,registerVersion:()=>us,setLogLevel:()=>ds}),i(625);var t=i(842),n=i.n(t);class r extends Error{}class s extends r{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class o extends r{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class a extends r{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class l extends r{}class c extends r{constructor(e){super(`Invalid unit ${e}`)}}class u extends r{}class h extends r{constructor(){super("Zone is an abstract class")}}const d="numeric",p="short",f="long",m={year:d,month:d,day:d},g={year:d,month:p,day:d},_={year:d,month:p,day:d,weekday:p},y={year:d,month:f,day:d},v={year:d,month:f,day:d,weekday:f},x={hour:d,minute:d},b={hour:d,minute:d,second:d},w={hour:d,minute:d,second:d,timeZoneName:p},S={hour:d,minute:d,second:d,timeZoneName:f},T={hour:d,minute:d,hourCycle:"h23"},E={hour:d,minute:d,second:d,hourCycle:"h23"},M={hour:d,minute:d,second:d,hourCycle:"h23",timeZoneName:p},I={hour:d,minute:d,second:d,hourCycle:"h23",timeZoneName:f},A={year:d,month:d,day:d,hour:d,minute:d},C={year:d,month:d,day:d,hour:d,minute:d,second:d},P={year:d,month:p,day:d,hour:d,minute:d},k={year:d,month:p,day:d,hour:d,minute:d,second:d},R={year:d,month:p,day:d,weekday:p,hour:d,minute:d},L={year:d,month:f,day:d,hour:d,minute:d,timeZoneName:p},D={year:d,month:f,day:d,hour:d,minute:d,second:d,timeZoneName:p},O={year:d,month:f,day:d,weekday:f,hour:d,minute:d,timeZoneName:f},N={year:d,month:f,day:d,weekday:f,hour:d,minute:d,second:d,timeZoneName:f};class z{get type(){throw new h}get name(){throw new h}get ianaName(){return this.name}get isUniversal(){throw new h}offsetName(e,t){throw new h}formatOffset(e,t){throw new h}offset(e){throw new h}equals(e){throw new h}get isValid(){throw new h}}let F=null;class B extends z{static get instance(){return null===F&&(F=new B),F}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return Je(e,t,i)}formatOffset(e,t){return it(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return"system"===e.type}get isValid(){return!0}}let U={};const V={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};let j={};class G extends z{static create(e){return j[e]||(j[e]=new G(e)),j[e]}static resetCache(){j={},U={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(e){return!1}}constructor(e){super(),this.zoneName=e,this.valid=G.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return Je(e,t,i,this.name)}formatOffset(e,t){return it(this.offset(e),t)}offset(e){const t=new Date(e);if(isNaN(t))return NaN;const i=(n=this.name,U[n]||(U[n]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:n,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),U[n]);var n;let[r,s,o,a,l,c,u]=i.formatToParts?function(e,t){const i=e.formatToParts(t),n=[];for(let e=0;e<i.length;e++){const{type:t,value:r}=i[e],s=V[t];"era"===t?n[s]=r:ke(s)||(n[s]=parseInt(r,10))}return n}(i,t):function(e,t){const i=e.format(t).replace(/\u200E/g,""),n=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,r,s,o,a,l,c,u]=n;return[o,r,s,a,l,c,u]}(i,t);"BC"===a&&(r=1-Math.abs(r));let h=+t;const d=h%1e3;return h-=d>=0?d:1e3+d,(Ze({year:r,month:s,day:o,hour:24===l?0:l,minute:c,second:u,millisecond:0})-h)/6e4}equals(e){return"iana"===e.type&&e.name===this.name}get isValid(){return this.valid}}let H={},W={};function q(e,t={}){const i=JSON.stringify([e,t]);let n=W[i];return n||(n=new Intl.DateTimeFormat(e,t),W[i]=n),n}let $={},Z={},X=null,Y={};function K(e,t,i,n){const r=e.listingMode();return"error"===r?null:"en"===r?i(t):n(t)}class J{constructor(e,t,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:n,floor:r,...s}=i;if(!t||Object.keys(s).length>0){const t={useGrouping:!1,...i};i.padTo>0&&(t.minimumIntegerDigits=i.padTo),this.inf=function(e,t={}){const i=JSON.stringify([e,t]);let n=$[i];return n||(n=new Intl.NumberFormat(e,t),$[i]=n),n}(e,t)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}return Ue(this.floor?Math.floor(e):He(e,3),this.padTo)}}class Q{constructor(e,t,i){let n;if(this.opts=i,this.originalZone=void 0,this.opts.timeZone)this.dt=e;else if("fixed"===e.zone.type){const t=e.offset/60*-1,i=t>=0?`Etc/GMT+${t}`:`Etc/GMT${t}`;0!==e.offset&&G.create(i).valid?(n=i,this.dt=e):(n="UTC",this.dt=0===e.offset?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else"system"===e.zone.type?this.dt=e:"iana"===e.zone.type?(this.dt=e,n=e.zone.name):(n="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const r={...this.opts};r.timeZone=r.timeZone||n,this.dtf=q(t,r)}format(){return this.originalZone?this.formatToParts().map((({value:e})=>e)).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map((e=>{if("timeZoneName"===e.type){const t=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...e,value:t}}return e})):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class ee{constructor(e,t,i){this.opts={style:"long",...i},!t&&De()&&(this.rtf=function(e,t={}){const{base:i,...n}=t,r=JSON.stringify([e,n]);let s=Z[r];return s||(s=new Intl.RelativeTimeFormat(e,t),Z[r]=s),s}(e,i))}format(e,t){return this.rtf?this.rtf.format(e,t):function(e,t,i="always",n=!1){const r={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=-1===["hours","minutes","seconds"].indexOf(e);if("auto"===i&&s){const i="days"===e;switch(t){case 1:return i?"tomorrow":`next ${r[e][0]}`;case-1:return i?"yesterday":`last ${r[e][0]}`;case 0:return i?"today":`this ${r[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=1===a,c=r[e],u=n?l?c[1]:c[2]||c[1]:l?r[e][0]:e;return o?`${a} ${u} ago`:`in ${a} ${u}`}(t,e,this.opts.numeric,"long"!==this.opts.style)}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}const te={firstDay:1,minimalDays:4,weekend:[6,7]};class ie{static fromOpts(e){return ie.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,t,i,n,r=!1){const s=e||me.defaultLocale,o=s||(r?"en-US":X||(X=(new Intl.DateTimeFormat).resolvedOptions().locale,X)),a=t||me.defaultNumberingSystem,l=i||me.defaultOutputCalendar,c=Fe(n)||me.defaultWeekSettings;return new ie(o,a,l,c,s)}static resetCache(){X=null,W={},$={},Z={}}static fromObject({locale:e,numberingSystem:t,outputCalendar:i,weekSettings:n}={}){return ie.create(e,t,i,n)}constructor(e,t,i,n,r){const[s,o,a]=function(e){const t=e.indexOf("-x-");-1!==t&&(e=e.substring(0,t));const i=e.indexOf("-u-");if(-1===i)return[e];{let t,n;try{t=q(e).resolvedOptions(),n=e}catch(r){const s=e.substring(0,i);t=q(s).resolvedOptions(),n=s}const{numberingSystem:r,calendar:s}=t;return[n,r,s]}}(e);this.locale=s,this.numberingSystem=t||o||null,this.outputCalendar=i||a||null,this.weekSettings=n,this.intl=function(e,t,i){return i||t?(e.includes("-u-")||(e+="-u"),i&&(e+=`-ca-${i}`),t&&(e+=`-nu-${t}`),e):e}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=r,this.fastNumbersCached=null}get fastNumbers(){var e;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(e=this).numberingSystem||"latn"===e.numberingSystem)&&("latn"===e.numberingSystem||!e.locale||e.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return e&&t?"en":"intl"}clone(e){return e&&0!==Object.getOwnPropertyNames(e).length?ie.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,Fe(e.weekSettings)||this.weekSettings,e.defaultToEN||!1):this}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,t=!1){return K(this,e,at,(()=>{const i=t?{month:e,day:"numeric"}:{month:e},n=t?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=function(e){const t=[];for(let i=1;i<=12;i++){const n=cn.utc(2009,i,1);t.push(e(n))}return t}((e=>this.extract(e,i,"month")))),this.monthsCache[n][e]}))}weekdays(e,t=!1){return K(this,e,ht,(()=>{const i=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=t?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=function(e){const t=[];for(let i=1;i<=7;i++){const n=cn.utc(2016,11,13+i);t.push(e(n))}return t}((e=>this.extract(e,i,"weekday")))),this.weekdaysCache[n][e]}))}meridiems(){return K(this,void 0,(()=>dt),(()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[cn.utc(2016,11,13,9),cn.utc(2016,11,13,19)].map((t=>this.extract(t,e,"dayperiod")))}return this.meridiemCache}))}eras(e){return K(this,e,gt,(()=>{const t={era:e};return this.eraCache[e]||(this.eraCache[e]=[cn.utc(-40,1,1),cn.utc(2017,1,1)].map((e=>this.extract(e,t,"era")))),this.eraCache[e]}))}extract(e,t,i){const n=this.dtFormatter(e,t).formatToParts().find((e=>e.type.toLowerCase()===i));return n?n.value:null}numberFormatter(e={}){return new J(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new Q(e,this.intl,t)}relFormatter(e={}){return new ee(this.intl,this.isEnglish(),e)}listFormatter(e={}){return function(e,t={}){const i=JSON.stringify([e,t]);let n=H[i];return n||(n=new Intl.ListFormat(e,t),H[i]=n),n}(this.intl,e)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:Oe()?function(e){let t=Y[e];if(!t){const i=new Intl.Locale(e);t="getWeekInfo"in i?i.getWeekInfo():i.weekInfo,Y[e]=t}return t}(this.locale):te}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let ne=null;class re extends z{static get utcInstance(){return null===ne&&(ne=new re(0)),ne}static instance(e){return 0===e?re.utcInstance:new re(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new re(Qe(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${it(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${it(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return it(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return"fixed"===e.type&&e.fixed===this.fixed}get isValid(){return!0}}class se extends z{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function oe(e,t){if(ke(e)||null===e)return t;if(e instanceof z)return e;if("string"==typeof e){const i=e.toLowerCase();return"default"===i?t:"local"===i||"system"===i?B.instance:"utc"===i||"gmt"===i?re.utcInstance:re.parseSpecifier(i)||G.create(e)}return Re(e)?re.instance(e):"object"==typeof e&&"offset"in e&&"function"==typeof e.offset?e:new se(e)}let ae,le=()=>Date.now(),ce="system",ue=null,he=null,de=null,pe=60,fe=null;class me{static get now(){return le}static set now(e){le=e}static set defaultZone(e){ce=e}static get defaultZone(){return oe(ce,B.instance)}static get defaultLocale(){return ue}static set defaultLocale(e){ue=e}static get defaultNumberingSystem(){return he}static set defaultNumberingSystem(e){he=e}static get defaultOutputCalendar(){return de}static set defaultOutputCalendar(e){de=e}static get defaultWeekSettings(){return fe}static set defaultWeekSettings(e){fe=Fe(e)}static get twoDigitCutoffYear(){return pe}static set twoDigitCutoffYear(e){pe=e%100}static get throwOnInvalid(){return ae}static set throwOnInvalid(e){ae=e}static resetCaches(){ie.resetCache(),G.resetCache()}}class ge{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const _e=[0,31,59,90,120,151,181,212,243,273,304,334],ye=[0,31,60,91,121,152,182,213,244,274,305,335];function ve(e,t){return new ge("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function xe(e,t,i){const n=new Date(Date.UTC(e,t-1,i));e<100&&e>=0&&n.setUTCFullYear(n.getUTCFullYear()-1900);const r=n.getUTCDay();return 0===r?7:r}function be(e,t,i){return i+(We(e)?ye:_e)[t-1]}function we(e,t){const i=We(e)?ye:_e,n=i.findIndex((e=>e<t));return{month:n+1,day:t-i[n]}}function Se(e,t){return(e-t+7)%7+1}function Te(e,t=4,i=1){const{year:n,month:r,day:s}=e,o=be(n,r,s),a=Se(xe(n,r,s),i);let l,c=Math.floor((o-a+14-t)/7);return c<1?(l=n-1,c=Ye(l,t,i)):c>Ye(n,t,i)?(l=n+1,c=1):l=n,{weekYear:l,weekNumber:c,weekday:a,...nt(e)}}function Ee(e,t=4,i=1){const{weekYear:n,weekNumber:r,weekday:s}=e,o=Se(xe(n,1,t),i),a=qe(n);let l,c=7*r+s-o-7+t;c<1?(l=n-1,c+=qe(l)):c>a?(l=n+1,c-=qe(n)):l=n;const{month:u,day:h}=we(l,c);return{year:l,month:u,day:h,...nt(e)}}function Me(e){const{year:t,month:i,day:n}=e;return{year:t,ordinal:be(t,i,n),...nt(e)}}function Ie(e){const{year:t,ordinal:i}=e,{month:n,day:r}=we(t,i);return{year:t,month:n,day:r,...nt(e)}}function Ae(e,t){if(!ke(e.localWeekday)||!ke(e.localWeekNumber)||!ke(e.localWeekYear)){if(!ke(e.weekday)||!ke(e.weekNumber)||!ke(e.weekYear))throw new l("Cannot mix locale-based week fields with ISO-based week fields");return ke(e.localWeekday)||(e.weekday=e.localWeekday),ke(e.localWeekNumber)||(e.weekNumber=e.localWeekNumber),ke(e.localWeekYear)||(e.weekYear=e.localWeekYear),delete e.localWeekday,delete e.localWeekNumber,delete e.localWeekYear,{minDaysInFirstWeek:t.getMinDaysInFirstWeek(),startOfWeek:t.getStartOfWeek()}}return{minDaysInFirstWeek:4,startOfWeek:1}}function Ce(e){const t=Le(e.year),i=Be(e.month,1,12),n=Be(e.day,1,$e(e.year,e.month));return t?i?!n&&ve("day",e.day):ve("month",e.month):ve("year",e.year)}function Pe(e){const{hour:t,minute:i,second:n,millisecond:r}=e,s=Be(t,0,23)||24===t&&0===i&&0===n&&0===r,o=Be(i,0,59),a=Be(n,0,59),l=Be(r,0,999);return s?o?a?!l&&ve("millisecond",r):ve("second",n):ve("minute",i):ve("hour",t)}function ke(e){return void 0===e}function Re(e){return"number"==typeof e}function Le(e){return"number"==typeof e&&e%1==0}function De(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(e){return!1}}function Oe(){try{return"undefined"!=typeof Intl&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch(e){return!1}}function Ne(e,t,i){if(0!==e.length)return e.reduce(((e,n)=>{const r=[t(n),n];return e&&i(e[0],r[0])===e[0]?e:r}),null)[1]}function ze(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Fe(e){if(null==e)return null;if("object"!=typeof e)throw new u("Week settings must be an object");if(!Be(e.firstDay,1,7)||!Be(e.minimalDays,1,7)||!Array.isArray(e.weekend)||e.weekend.some((e=>!Be(e,1,7))))throw new u("Invalid week settings");return{firstDay:e.firstDay,minimalDays:e.minimalDays,weekend:Array.from(e.weekend)}}function Be(e,t,i){return Le(e)&&e>=t&&e<=i}function Ue(e,t=2){let i;return i=e<0?"-"+(""+-e).padStart(t,"0"):(""+e).padStart(t,"0"),i}function Ve(e){return ke(e)||null===e||""===e?void 0:parseInt(e,10)}function je(e){return ke(e)||null===e||""===e?void 0:parseFloat(e)}function Ge(e){if(!ke(e)&&null!==e&&""!==e){const t=1e3*parseFloat("0."+e);return Math.floor(t)}}function He(e,t,i=!1){const n=10**t;return(i?Math.trunc:Math.round)(e*n)/n}function We(e){return e%4==0&&(e%100!=0||e%400==0)}function qe(e){return We(e)?366:365}function $e(e,t){const i=function(e,t){return e-12*Math.floor(e/12)}(t-1)+1;return 2===i?We(e+(t-i)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function Ze(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(e.year,e.month-1,e.day)),+t}function Xe(e,t,i){return-Se(xe(e,1,t),i)+t-1}function Ye(e,t=4,i=1){const n=Xe(e,t,i),r=Xe(e+1,t,i);return(qe(e)-n+r)/7}function Ke(e){return e>99?e:e>me.twoDigitCutoffYear?1900+e:2e3+e}function Je(e,t,i,n=null){const r=new Date(e),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};n&&(s.timeZone=n);const o={timeZoneName:t,...s},a=new Intl.DateTimeFormat(i,o).formatToParts(r).find((e=>"timezonename"===e.type.toLowerCase()));return a?a.value:null}function Qe(e,t){let i=parseInt(e,10);Number.isNaN(i)&&(i=0);const n=parseInt(t,10)||0;return 60*i+(i<0||Object.is(i,-0)?-n:n)}function et(e){const t=Number(e);if("boolean"==typeof e||""===e||Number.isNaN(t))throw new u(`Invalid unit value ${e}`);return t}function tt(e,t){const i={};for(const n in e)if(ze(e,n)){const r=e[n];if(null==r)continue;i[t(n)]=et(r)}return i}function it(e,t){const i=Math.trunc(Math.abs(e/60)),n=Math.trunc(Math.abs(e%60)),r=e>=0?"+":"-";switch(t){case"short":return`${r}${Ue(i,2)}:${Ue(n,2)}`;case"narrow":return`${r}${i}${n>0?`:${n}`:""}`;case"techie":return`${r}${Ue(i,2)}${Ue(n,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function nt(e){return function(e,t){return["hour","minute","second","millisecond"].reduce(((t,i)=>(t[i]=e[i],t)),{})}(e)}const rt=["January","February","March","April","May","June","July","August","September","October","November","December"],st=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ot=["J","F","M","A","M","J","J","A","S","O","N","D"];function at(e){switch(e){case"narrow":return[...ot];case"short":return[...st];case"long":return[...rt];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const lt=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ct=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],ut=["M","T","W","T","F","S","S"];function ht(e){switch(e){case"narrow":return[...ut];case"short":return[...ct];case"long":return[...lt];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const dt=["AM","PM"],pt=["Before Christ","Anno Domini"],ft=["BC","AD"],mt=["B","A"];function gt(e){switch(e){case"narrow":return[...mt];case"short":return[...ft];case"long":return[...pt];default:return null}}function _t(e,t){let i="";for(const n of e)n.literal?i+=n.val:i+=t(n.val);return i}const yt={D:m,DD:g,DDD:y,DDDD:v,t:x,tt:b,ttt:w,tttt:S,T,TT:E,TTT:M,TTTT:I,f:A,ff:P,fff:L,ffff:O,F:C,FF:k,FFF:D,FFFF:N};class vt{static create(e,t={}){return new vt(e,t)}static parseFormat(e){let t=null,i="",n=!1;const r=[];for(let s=0;s<e.length;s++){const o=e.charAt(s);"'"===o?(i.length>0&&r.push({literal:n||/^\s+$/.test(i),val:i}),t=null,i="",n=!n):n||o===t?i+=o:(i.length>0&&r.push({literal:/^\s+$/.test(i),val:i}),i=o,t=o)}return i.length>0&&r.push({literal:n||/^\s+$/.test(i),val:i}),r}static macroTokenToFormatOpts(e){return yt[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){return null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...t}).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t})}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return Ue(e,t);const i={...this.opts};return t>0&&(i.padTo=t),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,t){const i="en"===this.loc.listingMode(),n=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,r=(t,i)=>this.loc.extract(e,t,i),s=t=>e.isOffsetFixed&&0===e.offset&&t.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,t.format):"",o=(t,n)=>i?function(e,t){return at(t)[e.month-1]}(e,t):r(n?{month:t}:{month:t,day:"numeric"},"month"),a=(t,n)=>i?function(e,t){return ht(t)[e.weekday-1]}(e,t):r(n?{weekday:t}:{weekday:t,month:"long",day:"numeric"},"weekday"),l=t=>{const i=vt.macroTokenToFormatOpts(t);return i?this.formatWithSystemDefault(e,i):t},c=t=>i?function(e,t){return gt(t)[e.year<0?0:1]}(e,t):r({era:t},"era");return _t(vt.parseFormat(t),(t=>{switch(t){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12==0?12:e.hour%12);case"hh":return this.num(e.hour%12==0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return s({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return s({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return s({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return i?function(e){return dt[e.hour<12?0:1]}(e):r({hour:"numeric",hourCycle:"h12"},"dayperiod");case"d":return n?r({day:"numeric"},"day"):this.num(e.day);case"dd":return n?r({day:"2-digit"},"day"):this.num(e.day,2);case"c":case"E":return this.num(e.weekday);case"ccc":return a("short",!0);case"cccc":return a("long",!0);case"ccccc":return a("narrow",!0);case"EEE":return a("short",!1);case"EEEE":return a("long",!1);case"EEEEE":return a("narrow",!1);case"L":return n?r({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?r({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return o("short",!0);case"LLLL":return o("long",!0);case"LLLLL":return o("narrow",!0);case"M":return n?r({month:"numeric"},"month"):this.num(e.month);case"MM":return n?r({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return o("short",!1);case"MMMM":return o("long",!1);case"MMMMM":return o("narrow",!1);case"y":return n?r({year:"numeric"},"year"):this.num(e.year);case"yy":return n?r({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?r({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?r({year:"numeric"},"year"):this.num(e.year,6);case"G":return c("short");case"GG":return c("long");case"GGGGG":return c("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return l(t)}}))}formatDurationFromString(e,t){const i=e=>{switch(e[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=vt.parseFormat(t),r=n.reduce(((e,{literal:t,val:i})=>t?e:e.concat(i)),[]);return _t(n,(e=>t=>{const n=i(t);return n?this.num(e.get(n),t.length):t})(e.shiftTo(...r.map(i).filter((e=>e)))))}}const xt=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function bt(...e){const t=e.reduce(((e,t)=>e+t.source),"");return RegExp(`^${t}$`)}function wt(...e){return t=>e.reduce((([e,i,n],r)=>{const[s,o,a]=r(t,n);return[{...e,...s},o||i,a]}),[{},null,1]).slice(0,2)}function St(e,...t){if(null==e)return[null,null];for(const[i,n]of t){const t=i.exec(e);if(t)return n(t)}return[null,null]}function Tt(...e){return(t,i)=>{const n={};let r;for(r=0;r<e.length;r++)n[e[r]]=Ve(t[i+r]);return[n,null,i+r]}}const Et=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Mt=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,It=RegExp(`${Mt.source}(?:${Et.source}?(?:\\[(${xt.source})\\])?)?`),At=RegExp(`(?:T${It.source})?`),Ct=Tt("weekYear","weekNumber","weekDay"),Pt=Tt("year","ordinal"),kt=RegExp(`${Mt.source} ?(?:${Et.source}|(${xt.source}))?`),Rt=RegExp(`(?: ${kt.source})?`);function Lt(e,t,i){const n=e[t];return ke(n)?i:Ve(n)}function Dt(e,t){return[{hours:Lt(e,t,0),minutes:Lt(e,t+1,0),seconds:Lt(e,t+2,0),milliseconds:Ge(e[t+3])},null,t+4]}function Ot(e,t){const i=!e[t]&&!e[t+1],n=Qe(e[t+1],e[t+2]);return[{},i?null:re.instance(n),t+3]}function Nt(e,t){return[{},e[t]?G.create(e[t]):null,t+1]}const zt=RegExp(`^T?${Mt.source}$`),Ft=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Bt(e){const[t,i,n,r,s,o,a,l,c]=e,u="-"===t[0],h=l&&"-"===l[0],d=(e,t=!1)=>void 0!==e&&(t||e&&u)?-e:e;return[{years:d(je(i)),months:d(je(n)),weeks:d(je(r)),days:d(je(s)),hours:d(je(o)),minutes:d(je(a)),seconds:d(je(l),"-0"===l),milliseconds:d(Ge(c),h)}]}const Ut={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Vt(e,t,i,n,r,s,o){const a={year:2===t.length?Ke(Ve(t)):Ve(t),month:st.indexOf(i)+1,day:Ve(n),hour:Ve(r),minute:Ve(s)};return o&&(a.second=Ve(o)),e&&(a.weekday=e.length>3?lt.indexOf(e)+1:ct.indexOf(e)+1),a}const jt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Gt(e){const[,t,i,n,r,s,o,a,l,c,u,h]=e,d=Vt(t,r,n,i,s,o,a);let p;return p=l?Ut[l]:c?0:Qe(u,h),[d,new re(p)]}const Ht=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Wt=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,qt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function $t(e){const[,t,i,n,r,s,o,a]=e;return[Vt(t,r,n,i,s,o,a),re.utcInstance]}function Zt(e){const[,t,i,n,r,s,o,a]=e;return[Vt(t,a,i,n,r,s,o),re.utcInstance]}const Xt=bt(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,At),Yt=bt(/(\d{4})-?W(\d\d)(?:-?(\d))?/,At),Kt=bt(/(\d{4})-?(\d{3})/,At),Jt=bt(It),Qt=wt((function(e,t){return[{year:Lt(e,t),month:Lt(e,t+1,1),day:Lt(e,t+2,1)},null,t+3]}),Dt,Ot,Nt),ei=wt(Ct,Dt,Ot,Nt),ti=wt(Pt,Dt,Ot,Nt),ii=wt(Dt,Ot,Nt),ni=wt(Dt),ri=bt(/(\d{4})-(\d\d)-(\d\d)/,Rt),si=bt(kt),oi=wt(Dt,Ot,Nt),ai="Invalid Duration",li={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},ci={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},...li},ui={years:{quarters:4,months:12,weeks:52.1775,days:365.2425,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:4.3481250000000005,days:30.436875,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3},...li},hi=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],di=hi.slice(0).reverse();function pi(e,t,i=!1){const n={values:i?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new gi(n)}function fi(e,t){let i=t.milliseconds??0;for(const n of di.slice(1))t[n]&&(i+=t[n]*e[n].milliseconds);return i}function mi(e,t){const i=fi(e,t)<0?-1:1;hi.reduceRight(((n,r)=>{if(ke(t[r]))return n;if(n){const s=t[n]*i,o=e[r][n],a=Math.floor(s/o);t[r]+=a*i,t[n]-=a*o*i}return r}),null),hi.reduce(((i,n)=>{if(ke(t[n]))return i;if(i){const r=t[i]%1;t[i]-=r,t[n]+=r*e[i][n]}return n}),null)}class gi{constructor(e){const t="longterm"===e.conversionAccuracy||!1;let i=t?ui:ci;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||ie.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,t){return gi.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(null==e||"object"!=typeof e)throw new u("Duration.fromObject: argument expected to be an object, got "+(null===e?"null":typeof e));return new gi({values:tt(e,gi.normalizeUnit),loc:ie.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(Re(e))return gi.fromMillis(e);if(gi.isDuration(e))return e;if("object"==typeof e)return gi.fromObject(e);throw new u(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){const[i]=function(e){return St(e,[Ft,Bt])}(e);return i?gi.fromObject(i,t):gi.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){const[i]=function(e){return St(e,[zt,ni])}(e);return i?gi.fromObject(i,t):gi.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new u("need to specify a reason the Duration is invalid");const i=e instanceof ge?e:new ge(e,t);if(me.throwOnInvalid)throw new a(i);return new gi({invalid:i})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e?e.toLowerCase():e];if(!t)throw new c(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){const i={...t,floor:!1!==t.round&&!1!==t.floor};return this.isValid?vt.create(this.loc,i).formatDurationFromString(this,e):ai}toHuman(e={}){if(!this.isValid)return ai;const t=hi.map((t=>{const i=this.values[t];return ke(i)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:t.slice(0,-1)}).format(i)})).filter((e=>e));return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(t)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return 0!==this.years&&(e+=this.years+"Y"),0===this.months&&0===this.quarters||(e+=this.months+3*this.quarters+"M"),0!==this.weeks&&(e+=this.weeks+"W"),0!==this.days&&(e+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(e+="T"),0!==this.hours&&(e+=this.hours+"H"),0!==this.minutes&&(e+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(e+=He(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===e&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const t=this.toMillis();return t<0||t>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},cn.fromMillis(t,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?fi(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=gi.fromDurationLike(e),i={};for(const e of hi)(ze(t.values,e)||ze(this.values,e))&&(i[e]=t.get(e)+this.get(e));return pi(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const t=gi.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=et(e(this.values[i],i));return pi(this,{values:t},!0)}get(e){return this[gi.normalizeUnit(e)]}set(e){return this.isValid?pi(this,{values:{...this.values,...tt(e,gi.normalizeUnit)}}):this}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:i,matrix:n}={}){return pi(this,{loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:n,conversionAccuracy:i})}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return mi(this.matrix,e),pi(this,{values:e},!0)}rescale(){return this.isValid?pi(this,{values:function(e){const t={};for(const[i,n]of Object.entries(e))0!==n&&(t[i]=n);return t}(this.normalize().shiftToAll().toObject())},!0):this}shiftTo(...e){if(!this.isValid)return this;if(0===e.length)return this;e=e.map((e=>gi.normalizeUnit(e)));const t={},i={},n=this.toObject();let r;for(const s of hi)if(e.indexOf(s)>=0){r=s;let e=0;for(const t in i)e+=this.matrix[t][s]*i[t],i[t]=0;Re(n[s])&&(e+=n[s]);const o=Math.trunc(e);t[s]=o,i[s]=(1e3*e-1e3*o)/1e3}else Re(n[s])&&(i[s]=n[s]);for(const e in i)0!==i[e]&&(t[r]+=e===r?i[e]:i[e]/this.matrix[r][e]);return mi(this.matrix,t),pi(this,{values:t},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=0===this.values[t]?0:-this.values[t];return pi(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid)return!1;if(!this.loc.equals(e.loc))return!1;for(const n of hi)if(t=this.values[n],i=e.values[n],!(void 0===t||0===t?void 0===i||0===i:t===i))return!1;var t,i;return!0}}const _i="Invalid Interval";class yi{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new u("need to specify a reason the Interval is invalid");const i=e instanceof ge?e:new ge(e,t);if(me.throwOnInvalid)throw new o(i);return new yi({invalid:i})}static fromDateTimes(e,t){const i=un(e),n=un(t),r=function(e,t){return e&&e.isValid?t&&t.isValid?t<e?yi.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null:yi.invalid("missing or invalid end"):yi.invalid("missing or invalid start")}(i,n);return null==r?new yi({start:i,end:n}):r}static after(e,t){const i=gi.fromDurationLike(t),n=un(e);return yi.fromDateTimes(n,n.plus(i))}static before(e,t){const i=gi.fromDurationLike(t),n=un(e);return yi.fromDateTimes(n.minus(i),n)}static fromISO(e,t){const[i,n]=(e||"").split("/",2);if(i&&n){let e,r,s,o;try{e=cn.fromISO(i,t),r=e.isValid}catch(n){r=!1}try{s=cn.fromISO(n,t),o=s.isValid}catch(n){o=!1}if(r&&o)return yi.fromDateTimes(e,s);if(r){const i=gi.fromISO(n,t);if(i.isValid)return yi.after(e,i)}else if(o){const e=gi.fromISO(i,t);if(e.isValid)return yi.before(s,e)}}return yi.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",t){if(!this.isValid)return NaN;const i=this.start.startOf(e,t);let n;return n=t?.useLocaleWeeks?this.end.reconfigure({locale:i.locale}):this.end,n=n.startOf(e,t),Math.floor(n.diff(i,e).get(e))+(n.valueOf()!==this.end.valueOf())}hasSame(e){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,e))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return!!this.isValid&&this.s>e}isBefore(e){return!!this.isValid&&this.e<=e}contains(e){return!!this.isValid&&this.s<=e&&this.e>e}set({start:e,end:t}={}){return this.isValid?yi.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];const t=e.map(un).filter((e=>this.contains(e))).sort(((e,t)=>e.toMillis()-t.toMillis())),i=[];let{s:n}=this,r=0;for(;n<this.e;){const e=t[r]||this.e,s=+e>+this.e?this.e:e;i.push(yi.fromDateTimes(n,s)),n=s,r+=1}return i}splitBy(e){const t=gi.fromDurationLike(e);if(!this.isValid||!t.isValid||0===t.as("milliseconds"))return[];let i,{s:n}=this,r=1;const s=[];for(;n<this.e;){const e=this.start.plus(t.mapUnits((e=>e*r)));i=+e>+this.e?this.e:e,s.push(yi.fromDateTimes(n,i)),n=i,r+=1}return s}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return!!this.isValid&&+this.e==+e.s}abutsEnd(e){return!!this.isValid&&+e.e==+this.s}engulfs(e){return!!this.isValid&&this.s<=e.s&&this.e>=e.e}equals(e){return!(!this.isValid||!e.isValid)&&this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return t>=i?null:yi.fromDateTimes(t,i)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return yi.fromDateTimes(t,i)}static merge(e){const[t,i]=e.sort(((e,t)=>e.s-t.s)).reduce((([e,t],i)=>t?t.overlaps(i)||t.abutsStart(i)?[e,t.union(i)]:[e.concat([t]),i]:[e,i]),[[],null]);return i&&t.push(i),t}static xor(e){let t=null,i=0;const n=[],r=e.map((e=>[{time:e.s,type:"s"},{time:e.e,type:"e"}])),s=Array.prototype.concat(...r).sort(((e,t)=>e.time-t.time));for(const e of s)i+="s"===e.type?1:-1,1===i?t=e.time:(t&&+t!=+e.time&&n.push(yi.fromDateTimes(t,e.time)),t=null);return yi.merge(n)}difference(...e){return yi.xor([this].concat(e)).map((e=>this.intersection(e))).filter((e=>e&&!e.isEmpty()))}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:_i}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=m,t={}){return this.isValid?vt.create(this.s.loc.clone(t),e).formatInterval(this):_i}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:_i}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:_i}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:_i}toFormat(e,{separator:t="  "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:_i}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):gi.invalid(this.invalidReason)}mapEndpoints(e){return yi.fromDateTimes(e(this.s),e(this.e))}}class vi{static hasDST(e=me.defaultZone){const t=cn.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return G.isValidZone(e)}static normalizeZone(e){return oe(e,me.defaultZone)}static getStartOfWeek({locale:e=null,locObj:t=null}={}){return(t||ie.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:t=null}={}){return(t||ie.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:t=null}={}){return(t||ie.create(e)).getWeekendDays().slice()}static months(e="long",{locale:t=null,numberingSystem:i=null,locObj:n=null,outputCalendar:r="gregory"}={}){return(n||ie.create(t,i,r)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:n=null,outputCalendar:r="gregory"}={}){return(n||ie.create(t,i,r)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:i=null,locObj:n=null}={}){return(n||ie.create(t,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:n=null}={}){return(n||ie.create(t,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return ie.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return ie.create(t,null,"gregory").eras(e)}static features(){return{relative:De(),localeWeek:Oe()}}}function xi(e,t){const i=e=>e.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),n=i(t)-i(e);return Math.floor(gi.fromMillis(n).as("days"))}const bi={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},wi={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Si=bi.hanidec.replace(/[\[|\]]/g,"").split("");function Ti({numberingSystem:e},t=""){return new RegExp(`${bi[e||"latn"]}${t}`)}function Ei(e,t=(e=>e)){return{regex:e,deser:([e])=>t(function(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let i=0;i<e.length;i++){const n=e.charCodeAt(i);if(-1!==e[i].search(bi.hanidec))t+=Si.indexOf(e[i]);else for(const e in wi){const[i,r]=wi[e];n>=i&&n<=r&&(t+=n-i)}}return parseInt(t,10)}return t}(e))}}const Mi=`[ ${String.fromCharCode(160)}]`,Ii=new RegExp(Mi,"g");function Ai(e){return e.replace(/\./g,"\\.?").replace(Ii,Mi)}function Ci(e){return e.replace(/\./g,"").replace(Ii," ").toLowerCase()}function Pi(e,t){return null===e?null:{regex:RegExp(e.map(Ai).join("|")),deser:([i])=>e.findIndex((e=>Ci(i)===Ci(e)))+t}}function ki(e,t){return{regex:e,deser:([,e,t])=>Qe(e,t),groups:t}}function Ri(e){return{regex:e,deser:([e])=>e}}const Li={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};let Di=null;function Oi(e,t){return Array.prototype.concat(...e.map((e=>function(e,t){if(e.literal)return e;const i=zi(vt.macroTokenToFormatOpts(e.val),t);return null==i||i.includes(void 0)?e:i}(e,t))))}function Ni(e,t,i){const n=Oi(vt.parseFormat(i),e),r=n.map((t=>function(e,t){const i=Ti(t),n=Ti(t,"{2}"),r=Ti(t,"{3}"),s=Ti(t,"{4}"),o=Ti(t,"{6}"),a=Ti(t,"{1,2}"),l=Ti(t,"{1,3}"),c=Ti(t,"{1,6}"),u=Ti(t,"{1,9}"),h=Ti(t,"{2,4}"),d=Ti(t,"{4,6}"),p=e=>{return{regex:RegExp((t=e.val,t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:([e])=>e,literal:!0};var t},f=(f=>{if(e.literal)return p(f);switch(f.val){case"G":return Pi(t.eras("short"),0);case"GG":return Pi(t.eras("long"),0);case"y":return Ei(c);case"yy":case"kk":return Ei(h,Ke);case"yyyy":case"kkkk":return Ei(s);case"yyyyy":return Ei(d);case"yyyyyy":return Ei(o);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return Ei(a);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return Ei(n);case"MMM":return Pi(t.months("short",!0),1);case"MMMM":return Pi(t.months("long",!0),1);case"LLL":return Pi(t.months("short",!1),1);case"LLLL":return Pi(t.months("long",!1),1);case"o":case"S":return Ei(l);case"ooo":case"SSS":return Ei(r);case"u":return Ri(u);case"uu":return Ri(a);case"uuu":case"E":case"c":return Ei(i);case"a":return Pi(t.meridiems(),0);case"EEE":return Pi(t.weekdays("short",!1),1);case"EEEE":return Pi(t.weekdays("long",!1),1);case"ccc":return Pi(t.weekdays("short",!0),1);case"cccc":return Pi(t.weekdays("long",!0),1);case"Z":case"ZZ":return ki(new RegExp(`([+-]${a.source})(?::(${n.source}))?`),2);case"ZZZ":return ki(new RegExp(`([+-]${a.source})(${n.source})?`),2);case"z":return Ri(/[a-z_+-/]{1,256}?/i);case" ":return Ri(/[^\S\n\r]/);default:return p(f)}})(e)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};return f.token=e,f}(t,e))),s=r.find((e=>e.invalidReason));if(s)return{input:t,tokens:n,invalidReason:s.invalidReason};{const[e,i]=function(e){const t=e.map((e=>e.regex)).reduce(((e,t)=>`${e}(${t.source})`),"");return[`^${t}$`,e]}(r),s=RegExp(e,"i"),[o,a]=function(e,t,i){const n=e.match(t);if(n){const e={};let t=1;for(const r in i)if(ze(i,r)){const s=i[r],o=s.groups?s.groups+1:1;!s.literal&&s.token&&(e[s.token.val[0]]=s.deser(n.slice(t,t+o))),t+=o}return[n,e]}return[n,{}]}(t,s,i),[c,u,h]=a?function(e){let t,i=null;ke(e.z)||(i=G.create(e.z)),ke(e.Z)||(i||(i=new re(e.Z)),t=e.Z),ke(e.q)||(e.M=3*(e.q-1)+1),ke(e.h)||(e.h<12&&1===e.a?e.h+=12:12===e.h&&0===e.a&&(e.h=0)),0===e.G&&e.y&&(e.y=-e.y),ke(e.u)||(e.S=Ge(e.u));const n=Object.keys(e).reduce(((t,i)=>{const n=(e=>{switch(e){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(i);return n&&(t[n]=e[i]),t}),{});return[n,i,t]}(a):[null,null,void 0];if(ze(a,"a")&&ze(a,"H"))throw new l("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:n,regex:s,rawMatches:o,matches:a,result:c,zone:u,specificOffset:h}}}function zi(e,t){if(!e)return null;const i=vt.create(t,e).dtFormatter((Di||(Di=cn.fromMillis(1555555555555)),Di)),n=i.formatToParts(),r=i.resolvedOptions();return n.map((t=>function(e,t,i){const{type:n,value:r}=e;if("literal"===n){const e=/^\s+$/.test(r);return{literal:!e,val:e?" ":r}}const s=t[n];let o=n;"hour"===n&&(o=null!=t.hour12?t.hour12?"hour12":"hour24":null!=t.hourCycle?"h11"===t.hourCycle||"h12"===t.hourCycle?"hour12":"hour24":i.hour12?"hour12":"hour24");let a=Li[o];if("object"==typeof a&&(a=a[s]),a)return{literal:!1,val:a}}(t,e,r)))}const Fi="Invalid DateTime",Bi=864e13;function Ui(e){return new ge("unsupported zone",`the zone "${e.name}" is not supported`)}function Vi(e){return null===e.weekData&&(e.weekData=Te(e.c)),e.weekData}function ji(e){return null===e.localWeekData&&(e.localWeekData=Te(e.c,e.loc.getMinDaysInFirstWeek(),e.loc.getStartOfWeek())),e.localWeekData}function Gi(e,t){const i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new cn({...i,...t,old:i})}function Hi(e,t,i){let n=e-60*t*1e3;const r=i.offset(n);if(t===r)return[n,t];n-=60*(r-t)*1e3;const s=i.offset(n);return r===s?[n,r]:[e-60*Math.min(r,s)*1e3,Math.max(r,s)]}function Wi(e,t){const i=new Date(e+=60*t*1e3);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function qi(e,t,i){return Hi(Ze(e),t,i)}function $i(e,t){const i=e.o,n=e.c.year+Math.trunc(t.years),r=e.c.month+Math.trunc(t.months)+3*Math.trunc(t.quarters),s={...e.c,year:n,month:r,day:Math.min(e.c.day,$e(n,r))+Math.trunc(t.days)+7*Math.trunc(t.weeks)},o=gi.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=Ze(s);let[l,c]=Hi(a,i,e.zone);return 0!==o&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function Zi(e,t,i,n,r,s){const{setZone:o,zone:a}=i;if(e&&0!==Object.keys(e).length||t){const n=t||a,r=cn.fromObject(e,{...i,zone:n,specificOffset:s});return o?r:r.setZone(a)}return cn.invalid(new ge("unparsable",`the input "${r}" can't be parsed as ${n}`))}function Xi(e,t,i=!0){return e.isValid?vt.create(ie.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function Yi(e,t){const i=e.c.year>9999||e.c.year<0;let n="";return i&&e.c.year>=0&&(n+="+"),n+=Ue(e.c.year,i?6:4),t?(n+="-",n+=Ue(e.c.month),n+="-",n+=Ue(e.c.day)):(n+=Ue(e.c.month),n+=Ue(e.c.day)),n}function Ki(e,t,i,n,r,s){let o=Ue(e.c.hour);return t?(o+=":",o+=Ue(e.c.minute),0===e.c.millisecond&&0===e.c.second&&i||(o+=":")):o+=Ue(e.c.minute),0===e.c.millisecond&&0===e.c.second&&i||(o+=Ue(e.c.second),0===e.c.millisecond&&n||(o+=".",o+=Ue(e.c.millisecond,3))),r&&(e.isOffsetFixed&&0===e.offset&&!s?o+="Z":e.o<0?(o+="-",o+=Ue(Math.trunc(-e.o/60)),o+=":",o+=Ue(Math.trunc(-e.o%60))):(o+="+",o+=Ue(Math.trunc(e.o/60)),o+=":",o+=Ue(Math.trunc(e.o%60)))),s&&(o+="["+e.zone.ianaName+"]"),o}const Ji={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Qi={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},en={ordinal:1,hour:0,minute:0,second:0,millisecond:0},tn=["year","month","day","hour","minute","second","millisecond"],nn=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],rn=["year","ordinal","hour","minute","second","millisecond"];function sn(e){switch(e.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return function(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new c(e);return t}(e)}}function on(e,t){const i=oe(t.zone,me.defaultZone),n=ie.fromObject(t),r=me.now();let s,o;if(ke(e.year))s=r;else{for(const t of tn)ke(e[t])&&(e[t]=Ji[t]);const t=Ce(e)||Pe(e);if(t)return cn.invalid(t);const n=i.offset(r);[s,o]=qi(e,n,i)}return new cn({ts:s,zone:i,loc:n,o})}function an(e,t,i){const n=!!ke(i.round)||i.round,r=(e,r)=>(e=He(e,n||i.calendary?0:2,!0),t.loc.clone(i).relFormatter(i).format(e,r)),s=n=>i.calendary?t.hasSame(e,n)?0:t.startOf(n).diff(e.startOf(n),n).get(n):t.diff(e,n).get(n);if(i.unit)return r(s(i.unit),i.unit);for(const e of i.units){const t=s(e);if(Math.abs(t)>=1)return r(t,e)}return r(e>t?-0:0,i.units[i.units.length-1])}function ln(e){let t,i={};return e.length>0&&"object"==typeof e[e.length-1]?(i=e[e.length-1],t=Array.from(e).slice(0,e.length-1)):t=Array.from(e),[i,t]}class cn{constructor(e){const t=e.zone||me.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new ge("invalid input"):null)||(t.isValid?null:Ui(t));this.ts=ke(e.ts)?me.now():e.ts;let n=null,r=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[n,r]=[e.old.c,e.old.o];else{const e=t.offset(this.ts);n=Wi(this.ts,e),i=Number.isNaN(n.year)?new ge("invalid input"):null,n=i?null:n,r=i?null:e}this._zone=t,this.loc=e.loc||ie.create(),this.invalid=i,this.weekData=null,this.localWeekData=null,this.c=n,this.o=r,this.isLuxonDateTime=!0}static now(){return new cn({})}static local(){const[e,t]=ln(arguments),[i,n,r,s,o,a,l]=t;return on({year:i,month:n,day:r,hour:s,minute:o,second:a,millisecond:l},e)}static utc(){const[e,t]=ln(arguments),[i,n,r,s,o,a,l]=t;return e.zone=re.utcInstance,on({year:i,month:n,day:r,hour:s,minute:o,second:a,millisecond:l},e)}static fromJSDate(e,t={}){const i=(n=e,"[object Date]"===Object.prototype.toString.call(n)?e.valueOf():NaN);var n;if(Number.isNaN(i))return cn.invalid("invalid input");const r=oe(t.zone,me.defaultZone);return r.isValid?new cn({ts:i,zone:r,loc:ie.fromObject(t)}):cn.invalid(Ui(r))}static fromMillis(e,t={}){if(Re(e))return e<-Bi||e>Bi?cn.invalid("Timestamp out of range"):new cn({ts:e,zone:oe(t.zone,me.defaultZone),loc:ie.fromObject(t)});throw new u(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(Re(e))return new cn({ts:1e3*e,zone:oe(t.zone,me.defaultZone),loc:ie.fromObject(t)});throw new u("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};const i=oe(t.zone,me.defaultZone);if(!i.isValid)return cn.invalid(Ui(i));const n=ie.fromObject(t),r=tt(e,sn),{minDaysInFirstWeek:s,startOfWeek:o}=Ae(r,n),a=me.now(),c=ke(t.specificOffset)?i.offset(a):t.specificOffset,u=!ke(r.ordinal),h=!ke(r.year),d=!ke(r.month)||!ke(r.day),p=h||d,f=r.weekYear||r.weekNumber;if((p||u)&&f)throw new l("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(d&&u)throw new l("Can't mix ordinal dates with month/day");const m=f||r.weekday&&!p;let g,_,y=Wi(a,c);m?(g=nn,_=Qi,y=Te(y,s,o)):u?(g=rn,_=en,y=Me(y)):(g=tn,_=Ji);let v=!1;for(const e of g)ke(r[e])?r[e]=v?_[e]:y[e]:v=!0;const x=m?function(e,t=4,i=1){const n=Le(e.weekYear),r=Be(e.weekNumber,1,Ye(e.weekYear,t,i)),s=Be(e.weekday,1,7);return n?r?!s&&ve("weekday",e.weekday):ve("week",e.weekNumber):ve("weekYear",e.weekYear)}(r,s,o):u?function(e){const t=Le(e.year),i=Be(e.ordinal,1,qe(e.year));return t?!i&&ve("ordinal",e.ordinal):ve("year",e.year)}(r):Ce(r),b=x||Pe(r);if(b)return cn.invalid(b);const w=m?Ee(r,s,o):u?Ie(r):r,[S,T]=qi(w,c,i),E=new cn({ts:S,zone:i,o:T,loc:n});return r.weekday&&p&&e.weekday!==E.weekday?cn.invalid("mismatched weekday",`you can't specify both a weekday of ${r.weekday} and a date of ${E.toISO()}`):E}static fromISO(e,t={}){const[i,n]=function(e){return St(e,[Xt,Qt],[Yt,ei],[Kt,ti],[Jt,ii])}(e);return Zi(i,n,t,"ISO 8601",e)}static fromRFC2822(e,t={}){const[i,n]=function(e){return St(function(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(e),[jt,Gt])}(e);return Zi(i,n,t,"RFC 2822",e)}static fromHTTP(e,t={}){const[i,n]=function(e){return St(e,[Ht,$t],[Wt,$t],[qt,Zt])}(e);return Zi(i,n,t,"HTTP",t)}static fromFormat(e,t,i={}){if(ke(e)||ke(t))throw new u("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:r=null}=i,s=ie.fromOpts({locale:n,numberingSystem:r,defaultToEN:!0}),[o,a,l,c]=function(e,t,i){const{result:n,zone:r,specificOffset:s,invalidReason:o}=Ni(e,t,i);return[n,r,s,o]}(s,e,t);return c?cn.invalid(c):Zi(o,a,i,`format ${t}`,e,l)}static fromString(e,t,i={}){return cn.fromFormat(e,t,i)}static fromSQL(e,t={}){const[i,n]=function(e){return St(e,[ri,Qt],[si,oi])}(e);return Zi(i,n,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new u("need to specify a reason the DateTime is invalid");const i=e instanceof ge?e:new ge(e,t);if(me.throwOnInvalid)throw new s(i);return new cn({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){const i=zi(e,ie.fromObject(t));return i?i.map((e=>e?e.val:null)).join(""):null}static expandFormat(e,t={}){return Oi(vt.parseFormat(e),ie.fromObject(t)).map((e=>e.val)).join("")}get(e){return this[e]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Vi(this).weekYear:NaN}get weekNumber(){return this.isValid?Vi(this).weekNumber:NaN}get weekday(){return this.isValid?Vi(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?ji(this).weekday:NaN}get localWeekNumber(){return this.isValid?ji(this).weekNumber:NaN}get localWeekYear(){return this.isValid?ji(this).weekYear:NaN}get ordinal(){return this.isValid?Me(this.c).ordinal:NaN}get monthShort(){return this.isValid?vi.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?vi.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?vi.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?vi.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,t=6e4,i=Ze(this.c),n=this.zone.offset(i-e),r=this.zone.offset(i+e),s=this.zone.offset(i-n*t),o=this.zone.offset(i-r*t);if(s===o)return[this];const a=i-s*t,l=i-o*t,c=Wi(a,s),u=Wi(l,o);return c.hour===u.hour&&c.minute===u.minute&&c.second===u.second&&c.millisecond===u.millisecond?[Gi(this,{ts:a}),Gi(this,{ts:l})]:[this]}get isInLeapYear(){return We(this.year)}get daysInMonth(){return $e(this.year,this.month)}get daysInYear(){return this.isValid?qe(this.year):NaN}get weeksInWeekYear(){return this.isValid?Ye(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?Ye(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:t,numberingSystem:i,calendar:n}=vt.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:i,outputCalendar:n}}toUTC(e=0,t={}){return this.setZone(re.instance(e),t)}toLocal(){return this.setZone(me.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:i=!1}={}){if((e=oe(e,me.defaultZone)).equals(this.zone))return this;if(e.isValid){let n=this.ts;if(t||i){const t=e.offset(this.ts),i=this.toObject();[n]=qi(i,t,e)}return Gi(this,{ts:n,zone:e})}return cn.invalid(Ui(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:i}={}){return Gi(this,{loc:this.loc.clone({locale:e,numberingSystem:t,outputCalendar:i})})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=tt(e,sn),{minDaysInFirstWeek:i,startOfWeek:n}=Ae(t,this.loc),r=!ke(t.weekYear)||!ke(t.weekNumber)||!ke(t.weekday),s=!ke(t.ordinal),o=!ke(t.year),a=!ke(t.month)||!ke(t.day),c=o||a,u=t.weekYear||t.weekNumber;if((c||s)&&u)throw new l("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(a&&s)throw new l("Can't mix ordinal dates with month/day");let h;r?h=Ee({...Te(this.c,i,n),...t},i,n):ke(t.ordinal)?(h={...this.toObject(),...t},ke(t.day)&&(h.day=Math.min($e(h.year,h.month),h.day))):h=Ie({...Me(this.c),...t});const[d,p]=qi(h,this.o,this.zone);return Gi(this,{ts:d,o:p})}plus(e){return this.isValid?Gi(this,$i(this,gi.fromDurationLike(e))):this}minus(e){return this.isValid?Gi(this,$i(this,gi.fromDurationLike(e).negate())):this}startOf(e,{useLocaleWeeks:t=!1}={}){if(!this.isValid)return this;const i={},n=gi.normalizeUnit(e);switch(n){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0}if("weeks"===n)if(t){const e=this.loc.getStartOfWeek(),{weekday:t}=this;t<e&&(i.weekNumber=this.weekNumber-1),i.weekday=e}else i.weekday=1;if("quarters"===n){const e=Math.ceil(this.month/3);i.month=3*(e-1)+1}return this.set(i)}endOf(e,t){return this.isValid?this.plus({[e]:1}).startOf(e,t).minus(1):this}toFormat(e,t={}){return this.isValid?vt.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):Fi}toLocaleString(e=m,t={}){return this.isValid?vt.create(this.loc.clone(t),e).formatDateTime(this):Fi}toLocaleParts(e={}){return this.isValid?vt.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:i=!1,includeOffset:n=!0,extendedZone:r=!1}={}){if(!this.isValid)return null;const s="extended"===e;let o=Yi(this,s);return o+="T",o+=Ki(this,s,t,i,n,r),o}toISODate({format:e="extended"}={}){return this.isValid?Yi(this,"extended"===e):null}toISOWeekDate(){return Xi(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:i=!0,includePrefix:n=!1,extendedZone:r=!1,format:s="extended"}={}){return this.isValid?(n?"T":"")+Ki(this,"extended"===s,t,e,i,r):null}toRFC2822(){return Xi(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return Xi(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Yi(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:i=!0}={}){let n="HH:mm:ss.SSS";return(t||e)&&(i&&(n+=" "),t?n+="z":e&&(n+="ZZ")),Xi(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():Fi}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",i={}){if(!this.isValid||!e.isValid)return gi.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...i},r=(a=t,Array.isArray(a)?a:[a]).map(gi.normalizeUnit),s=e.valueOf()>this.valueOf(),o=function(e,t,i,n){let[r,s,o,a]=function(e,t,i){const n=[["years",(e,t)=>t.year-e.year],["quarters",(e,t)=>t.quarter-e.quarter+4*(t.year-e.year)],["months",(e,t)=>t.month-e.month+12*(t.year-e.year)],["weeks",(e,t)=>{const i=xi(e,t);return(i-i%7)/7}],["days",xi]],r={},s=e;let o,a;for(const[l,c]of n)i.indexOf(l)>=0&&(o=l,r[l]=c(e,t),a=s.plus(r),a>t?(r[l]--,(e=s.plus(r))>t&&(a=e,r[l]--,e=s.plus(r))):e=a);return[e,r,a,o]}(e,t,i);const l=t-r,c=i.filter((e=>["hours","minutes","seconds","milliseconds"].indexOf(e)>=0));0===c.length&&(o<t&&(o=r.plus({[a]:1})),o!==r&&(s[a]=(s[a]||0)+l/(o-r)));const u=gi.fromObject(s,n);return c.length>0?gi.fromMillis(l,n).shiftTo(...c).plus(u):u}(s?this:e,s?e:this,r,n);var a;return s?o.negate():o}diffNow(e="milliseconds",t={}){return this.diff(cn.now(),e,t)}until(e){return this.isValid?yi.fromDateTimes(this,e):this}hasSame(e,t,i){if(!this.isValid)return!1;const n=e.valueOf(),r=this.setZone(e.zone,{keepLocalTime:!0});return r.startOf(t,i)<=n&&n<=r.endOf(t,i)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const t=e.base||cn.fromObject({},{zone:this.zone}),i=e.padding?this<t?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],r=e.unit;return Array.isArray(e.unit)&&(n=e.unit,r=void 0),an(t,this.plus(i),{...e,numeric:"always",units:n,unit:r})}toRelativeCalendar(e={}){return this.isValid?an(e.base||cn.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(cn.isDateTime))throw new u("min requires all arguments be DateTimes");return Ne(e,(e=>e.valueOf()),Math.min)}static max(...e){if(!e.every(cn.isDateTime))throw new u("max requires all arguments be DateTimes");return Ne(e,(e=>e.valueOf()),Math.max)}static fromFormatExplain(e,t,i={}){const{locale:n=null,numberingSystem:r=null}=i;return Ni(ie.fromOpts({locale:n,numberingSystem:r,defaultToEN:!0}),e,t)}static fromStringExplain(e,t,i={}){return cn.fromFormatExplain(e,t,i)}static get DATE_SHORT(){return m}static get DATE_MED(){return g}static get DATE_MED_WITH_WEEKDAY(){return _}static get DATE_FULL(){return y}static get DATE_HUGE(){return v}static get TIME_SIMPLE(){return x}static get TIME_WITH_SECONDS(){return b}static get TIME_WITH_SHORT_OFFSET(){return w}static get TIME_WITH_LONG_OFFSET(){return S}static get TIME_24_SIMPLE(){return T}static get TIME_24_WITH_SECONDS(){return E}static get TIME_24_WITH_SHORT_OFFSET(){return M}static get TIME_24_WITH_LONG_OFFSET(){return I}static get DATETIME_SHORT(){return A}static get DATETIME_SHORT_WITH_SECONDS(){return C}static get DATETIME_MED(){return P}static get DATETIME_MED_WITH_SECONDS(){return k}static get DATETIME_MED_WITH_WEEKDAY(){return R}static get DATETIME_FULL(){return L}static get DATETIME_FULL_WITH_SECONDS(){return D}static get DATETIME_HUGE(){return O}static get DATETIME_HUGE_WITH_SECONDS(){return N}}function un(e){if(cn.isDateTime(e))return e;if(e&&e.valueOf&&Re(e.valueOf()))return cn.fromJSDate(e);if(e&&"object"==typeof e)return cn.fromObject(e);throw new u(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const hn=function(e){const t=[];let i=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<128?t[i++]=r:r<2048?(t[i++]=r>>6|192,t[i++]=63&r|128):55296==(64512&r)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++n)),t[i++]=r>>18|240,t[i++]=r>>12&63|128,t[i++]=r>>6&63|128,t[i++]=63&r|128):(t[i++]=r>>12|224,t[i++]=r>>6&63|128,t[i++]=63&r|128)}return t},dn={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){const r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,c=r>>2,u=(3&r)<<4|o>>4;let h=(15&o)<<2|l>>6,d=63&l;a||(d=64,s||(h=64)),n.push(i[c],i[u],i[h],i[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(hn(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let i=0,n=0;for(;i<e.length;){const r=e[i++];if(r<128)t[n++]=String.fromCharCode(r);else if(r>191&&r<224){const s=e[i++];t[n++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&e[i++])<<12|(63&e[i++])<<6|63&e[i++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{const s=e[i++],o=e[i++];t[n++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const i=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){const r=i[e.charAt(t++)],s=t<e.length?i[e.charAt(t)]:0;++t;const o=t<e.length?i[e.charAt(t)]:64;++t;const a=t<e.length?i[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==a)throw new pn;const l=r<<2|s>>4;if(n.push(l),64!==o){const e=s<<4&240|o>>2;if(n.push(e),64!==a){const e=o<<6&192|a;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class pn extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const fn=function(e){return function(e){const t=hn(e);return dn.encodeByteArray(t,!0)}(e).replace(/\./g,"")},mn=function(e){try{return dn.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function gn(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const i in t)t.hasOwnProperty(i)&&"__proto__"!==i&&(e[i]=gn(e[i],t[i]));return e}const _n=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==i.g)return i.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&mn(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},yn=()=>{var e;return null===(e=_n())||void 0===e?void 0:e.config};class vn{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,i))}}}function xn(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function bn(){var e;const t=null===(e=_n())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(i.g.process)}catch(e){return!1}}function wn(){return"object"==typeof self&&self.self===self}function Sn(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function Tn(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function En(){const e=xn();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function Mn(){try{return"object"==typeof indexedDB}catch(e){return!1}}class In extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name="FirebaseError",Object.setPrototypeOf(this,In.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,An.prototype.create)}}class An{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},n=`${this.service}/${e}`,r=this.errors[e],s=r?function(e,t){return e.replace(Cn,((e,i)=>{const n=t[i];return null!=n?String(n):`<${i}?>`}))}(r,i):"Error",o=`${this.serviceName}: ${s} (${n}).`;return new In(n,o,i)}}const Cn=/\{\$([^}]+)}/g;function Pn(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function kn(e,t){if(e===t)return!0;const i=Object.keys(e),n=Object.keys(t);for(const r of i){if(!n.includes(r))return!1;const i=e[r],s=t[r];if(Rn(i)&&Rn(s)){if(!kn(i,s))return!1}else if(i!==s)return!1}for(const e of n)if(!i.includes(e))return!1;return!0}function Rn(e){return null!==e&&"object"==typeof e}function Ln(e){const t=[];for(const[i,n]of Object.entries(e))Array.isArray(n)?n.forEach((e=>{t.push(encodeURIComponent(i)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(i)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function Dn(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[i,n]=e.split("=");t[decodeURIComponent(i)]=decodeURIComponent(n)}})),t}function On(e){const t=e.indexOf("?");if(!t)return"";const i=e.indexOf("#",t);return e.substring(t,i>0?i:void 0)}function Nn(e,t){const i=new zn(e,t);return i.subscribe.bind(i)}class zn{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,i){let n;if(void 0===e&&void 0===t&&void 0===i)throw new Error("Missing Observer.");n=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:i},void 0===n.next&&(n.next=Fn),void 0===n.error&&(n.error=Fn),void 0===n.complete&&(n.complete=Fn);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}})),this.observers.push(n),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function Fn(){}function Bn(e){return e&&e._delegate?e._delegate:e}class Un{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Vn="[DEFAULT]";class jn{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new vn;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&e.resolve(i)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(i)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:i})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Vn})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:i});t.resolve(e)}catch(e){}}}}clearInstance(e=Vn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=Vn){return this.instances.has(e)}getOptions(e=Vn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[e,t]of this.instancesDeferred.entries())i===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){var i;const n=this.normalizeInstanceIdentifier(t),r=null!==(i=this.onInitCallbacks.get(n))&&void 0!==i?i:new Set;r.add(e),this.onInitCallbacks.set(n,r);const s=this.instances.get(n);return s&&e(s,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const n of i)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===Vn?void 0:n),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch(e){}var n;return i||null}normalizeInstanceIdentifier(e=Vn){return this.component?this.component.multipleInstances?e:Vn:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Gn{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new jn(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Hn=[];var Wn;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Wn||(Wn={}));const qn={debug:Wn.DEBUG,verbose:Wn.VERBOSE,info:Wn.INFO,warn:Wn.WARN,error:Wn.ERROR,silent:Wn.SILENT},$n=Wn.INFO,Zn={[Wn.DEBUG]:"log",[Wn.VERBOSE]:"log",[Wn.INFO]:"info",[Wn.WARN]:"warn",[Wn.ERROR]:"error"},Xn=(e,t,...i)=>{if(t<e.logLevel)return;const n=(new Date).toISOString(),r=Zn[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[r](`[${n}]  ${e.name}:`,...i)};class Yn{constructor(e){this.name=e,this._logLevel=$n,this._logHandler=Xn,this._userLogHandler=null,Hn.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Wn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?qn[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Wn.DEBUG,...e),this._logHandler(this,Wn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Wn.VERBOSE,...e),this._logHandler(this,Wn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Wn.INFO,...e),this._logHandler(this,Wn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Wn.WARN,...e),this._logHandler(this,Wn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Wn.ERROR,...e),this._logHandler(this,Wn.ERROR,...e)}}const Kn=(e,t)=>t.some((t=>e instanceof t));let Jn,Qn;const er=new WeakMap,tr=new WeakMap,ir=new WeakMap,nr=new WeakMap,rr=new WeakMap;let sr={get(e,t,i){if(e instanceof IDBTransaction){if("done"===t)return tr.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ir.get(e);if("store"===t)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return ar(e[t])},set:(e,t,i)=>(e[t]=i,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function or(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Qn||(Qn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(lr(this),e),ar(er.get(this))}:function(...e){return ar(t.apply(lr(this),e))}:function(e,...i){const n=t.call(lr(this),e,...i);return ir.set(n,e.sort?e.sort():[e]),ar(n)}:(e instanceof IDBTransaction&&function(e){if(tr.has(e))return;const t=new Promise(((t,i)=>{const n=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),n()},s=()=>{i(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)}));tr.set(e,t)}(e),Kn(e,Jn||(Jn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,sr):e);var t}function ar(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,i)=>{const n=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(ar(e.result)),n()},s=()=>{i(e.error),n()};e.addEventListener("success",r),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&er.set(t,e)})).catch((()=>{})),rr.set(t,e),t}(e);if(nr.has(e))return nr.get(e);const t=or(e);return t!==e&&(nr.set(e,t),rr.set(t,e)),t}const lr=e=>rr.get(e),cr=["get","getKey","getAll","getAllKeys","count"],ur=["put","add","delete","clear"],hr=new Map;function dr(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(hr.get(t))return hr.get(t);const i=t.replace(/FromIndex$/,""),n=t!==i,r=ur.includes(i);if(!(i in(n?IDBIndex:IDBObjectStore).prototype)||!r&&!cr.includes(i))return;const s=async function(e,...t){const s=this.transaction(e,r?"readwrite":"readonly");let o=s.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[i](...t),r&&s.done]))[0]};return hr.set(t,s),s}var pr;pr=sr,sr={...pr,get:(e,t,i)=>dr(e,t)||pr.get(e,t,i),has:(e,t)=>!!dr(e,t)||pr.has(e,t)};class fr{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const mr="@firebase/app",gr="0.10.2",_r=new Yn("@firebase/app"),yr="@firebase/app-compat",vr="@firebase/analytics-compat",xr="@firebase/analytics",br="@firebase/app-check-compat",wr="@firebase/app-check",Sr="@firebase/auth",Tr="@firebase/auth-compat",Er="@firebase/database",Mr="@firebase/database-compat",Ir="@firebase/functions",Ar="@firebase/functions-compat",Cr="@firebase/installations",Pr="@firebase/installations-compat",kr="@firebase/messaging",Rr="@firebase/messaging-compat",Lr="@firebase/performance",Dr="@firebase/performance-compat",Or="@firebase/remote-config",Nr="@firebase/remote-config-compat",zr="@firebase/storage",Fr="@firebase/storage-compat",Br="@firebase/firestore",Ur="@firebase/firestore-compat",Vr="firebase",jr="[DEFAULT]",Gr={[mr]:"fire-core",[yr]:"fire-core-compat",[xr]:"fire-analytics",[vr]:"fire-analytics-compat",[wr]:"fire-app-check",[br]:"fire-app-check-compat",[Sr]:"fire-auth",[Tr]:"fire-auth-compat",[Er]:"fire-rtdb",[Mr]:"fire-rtdb-compat",[Ir]:"fire-fn",[Ar]:"fire-fn-compat",[Cr]:"fire-iid",[Pr]:"fire-iid-compat",[kr]:"fire-fcm",[Rr]:"fire-fcm-compat",[Lr]:"fire-perf",[Dr]:"fire-perf-compat",[Or]:"fire-rc",[Nr]:"fire-rc-compat",[zr]:"fire-gcs",[Fr]:"fire-gcs-compat",[Br]:"fire-fst",[Ur]:"fire-fst-compat","fire-js":"fire-js",[Vr]:"fire-js-all"},Hr=new Map,Wr=new Map,qr=new Map;function $r(e,t){try{e.container.addComponent(t)}catch(i){_r.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,i)}}function Zr(e,t){e.container.addOrOverwriteComponent(t)}function Xr(e){const t=e.name;if(qr.has(t))return _r.debug(`There were multiple attempts to register component ${t}.`),!1;qr.set(t,e);for(const t of Hr.values())$r(t,e);for(const t of Wr.values())$r(t,e);return!0}function Yr(e,t){const i=e.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),e.container.getProvider(t)}function Kr(e,t,i=jr){Yr(e,t).clearInstance(i)}function Jr(e){return void 0!==e.options}function Qr(e){return void 0!==e.settings}function es(){qr.clear()}const ts=new An("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class is{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Un("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ts.create("app-deleted",{appName:this._name})}}class ns extends is{constructor(e,t,i,n){const r=void 0!==t.automaticDataCollectionEnabled&&t.automaticDataCollectionEnabled,s={name:i,automaticDataCollectionEnabled:r};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig=Object.assign({automaticDataCollectionEnabled:r},t),this._finalizationRegistry=new FinalizationRegistry((()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,us(mr,gr,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){cs(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw ts.create("server-app-deleted")}}const rs="10.11.1";function ss(e,t={}){let i=e;"object"!=typeof t&&(t={name:t});const n=Object.assign({name:jr,automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!=typeof r||!r)throw ts.create("bad-app-name",{appName:String(r)});if(i||(i=yn()),!i)throw ts.create("no-options");const s=Hr.get(r);if(s){if(kn(i,s.options)&&kn(n,s.config))return s;throw ts.create("duplicate-app",{appName:r})}const o=new Gn(r);for(const e of qr.values())o.addComponent(e);const a=new is(i,n,o);return Hr.set(r,a),a}function os(e,t){if(wn())throw ts.create("invalid-server-app-environment");let i;void 0===t.automaticDataCollectionEnabled&&(t.automaticDataCollectionEnabled=!1),i=Jr(e)?e.options:e;const n=Object.assign(Object.assign({},t),i);if(void 0!==n.releaseOnDeref&&delete n.releaseOnDeref,void 0!==t.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw ts.create("finalization-registry-not-supported",{});const r=""+(e=>[...e].reduce(((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0),0))(JSON.stringify(n)),s=Wr.get(r);if(s)return s.incRefCount(t.releaseOnDeref),s;const o=new Gn(r);for(const e of qr.values())o.addComponent(e);const a=new ns(i,t,r,o);return Wr.set(r,a),a}function as(e=jr){const t=Hr.get(e);if(!t&&e===jr&&yn())return ss();if(!t)throw ts.create("no-app",{appName:e});return t}function ls(){return Array.from(Hr.values())}async function cs(e){let t=!1;const i=e.name;Hr.has(i)?(t=!0,Hr.delete(i)):Wr.has(i)&&e.decRefCount()<=0&&(Wr.delete(i),t=!0),t&&(await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function us(e,t,i){var n;let r=null!==(n=Gr[e])&&void 0!==n?n:e;i&&(r+=`-${i}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${r}" with version "${t}":`];return s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void _r.warn(e.join(" "))}Xr(new Un(`${r}-version`,(()=>({library:r,version:t})),"VERSION"))}function hs(e,t){if(null!==e&&"function"!=typeof e)throw ts.create("invalid-log-argument");!function(e,t){for(const i of Hn){let n=null;t&&t.level&&(n=qn[t.level]),i.userLogHandler=null===e?null:(t,i,...r)=>{const s=r.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");i>=(null!=n?n:t.logLevel)&&e({level:Wn[i].toLowerCase(),message:s,args:r,type:t.name})}}}(e,t)}function ds(e){var t;t=e,Hn.forEach((e=>{e.setLogLevel(t)}))}const ps="firebase-heartbeat-database",fs=1,ms="firebase-heartbeat-store";let gs=null;function _s(){return gs||(gs=function(e,t,{blocked:i,upgrade:n,blocking:r,terminated:s}={}){const o=indexedDB.open(e,t),a=ar(o);return n&&o.addEventListener("upgradeneeded",(e=>{n(ar(o.result),e.oldVersion,e.newVersion,ar(o.transaction),e)})),i&&o.addEventListener("blocked",(e=>i(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(ps,fs,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ms)}catch(e){console.warn(e)}}}).catch((e=>{throw ts.create("idb-open",{originalErrorMessage:e.message})}))),gs}async function ys(e,t){try{const i=(await _s()).transaction(ms,"readwrite"),n=i.objectStore(ms);await n.put(t,vs(e)),await i.done}catch(e){if(e instanceof In)_r.warn(e.message);else{const t=ts.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});_r.warn(t.message)}}}function vs(e){return`${e.name}!${e.options.appId}`}class xs{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ws(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=bs();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==n&&!this._heartbeatsCache.heartbeats.some((e=>e.date===n)))return this._heartbeatsCache.heartbeats.push({date:n,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=bs(),{heartbeatsToSend:i,unsentEntries:n}=function(e,t=1024){const i=[];let n=e.slice();for(const r of e){const e=i.find((e=>e.agent===r.agent));if(e){if(e.dates.push(r.date),Ss(i)>t){e.dates.pop();break}}else if(i.push({agent:r.agent,dates:[r.date]}),Ss(i)>t){i.pop();break}n=n.slice(1)}return{heartbeatsToSend:i,unsentEntries:n}}(this._heartbeatsCache.heartbeats),r=fn(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function bs(){return(new Date).toISOString().substring(0,10)}class ws{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Mn()&&new Promise(((e,t)=>{try{let i=!0;const n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),i||self.indexedDB.deleteDatabase(n),e(!0)},r.onupgradeneeded=()=>{i=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await _s()).transaction(ms),i=await t.objectStore(ms).get(vs(e));return await t.done,i}catch(e){if(e instanceof In)_r.warn(e.message);else{const t=ts.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});_r.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return ys(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return ys(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}}}function Ss(e){return fn(JSON.stringify({version:2,heartbeats:e})).length}Xr(new Un("platform-logger",(e=>new fr(e)),"PRIVATE")),Xr(new Un("heartbeat",(e=>new xs(e)),"PRIVATE")),us(mr,gr,""),us(mr,gr,"esm2017"),us("fire-js",""),us("firebase","10.11.1","app");var Ts,Es="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ms={},Is=Is||{},As=Es||self;function Cs(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Ps(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var ks="closure_uid_"+(1e9*Math.random()>>>0),Rs=0;function Ls(e,t,i){return e.call.apply(e.bind,arguments)}function Ds(e,t,i){if(!e)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,n),e.apply(t,i)}}return function(){return e.apply(t,arguments)}}function Os(e,t,i){return(Os=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ls:Ds).apply(null,arguments)}function Ns(e,t){var i=Array.prototype.slice.call(arguments,1);return function(){var t=i.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function zs(e,t){function i(){}i.prototype=t.prototype,e.$=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.ac=function(e,i,n){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[i].apply(e,r)}}function Fs(){this.s=this.s,this.o=this.o}Fs.prototype.s=!1,Fs.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,ks)&&e[ks]||(e[ks]=++Rs))},Fs.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Bs=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let i=0;i<e.length;i++)if(i in e&&e[i]===t)return i;return-1};function Us(e){const t=e.length;if(0<t){const i=Array(t);for(let n=0;n<t;n++)i[n]=e[n];return i}return[]}function Vs(e,t){for(let t=1;t<arguments.length;t++){const i=arguments[t];if(Cs(i)){const t=e.length||0,n=i.length||0;e.length=t+n;for(let r=0;r<n;r++)e[t+r]=i[r]}else e.push(i)}}function js(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}js.prototype.h=function(){this.defaultPrevented=!0};var Gs=function(){if(!As.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};As.addEventListener("test",e,t),As.removeEventListener("test",e,t)}catch(e){}return e}();function Hs(e){return/^[\s\xa0]*$/.test(e)}function Ws(){var e=As.navigator;return e&&(e=e.userAgent)?e:""}function qs(e){return-1!=Ws().indexOf(e)}function $s(e){return $s[" "](e),e}$s[" "]=function(){};var Zs,Xs,Ys,Ks=qs("Opera"),Js=qs("Trident")||qs("MSIE"),Qs=qs("Edge"),eo=Qs||Js,to=qs("Gecko")&&!(-1!=Ws().toLowerCase().indexOf("webkit")&&!qs("Edge"))&&!(qs("Trident")||qs("MSIE"))&&!qs("Edge"),io=-1!=Ws().toLowerCase().indexOf("webkit")&&!qs("Edge");function no(){var e=As.document;return e?e.documentMode:void 0}e:{var ro="",so=(Xs=Ws(),to?/rv:([^\);]+)(\)|;)/.exec(Xs):Qs?/Edge\/([\d\.]+)/.exec(Xs):Js?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Xs):io?/WebKit\/(\S+)/.exec(Xs):Ks?/(?:Version)[ \/]?(\S+)/.exec(Xs):void 0);if(so&&(ro=so?so[1]:""),Js){var oo=no();if(null!=oo&&oo>parseFloat(ro)){Zs=String(oo);break e}}Zs=ro}As.document&&Js?Ys=no()||parseInt(Zs,10)||void 0:Ys=void 0;var ao=Ys;function lo(e,t){if(js.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var i=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(to){e:{try{$s(t.nodeName);var r=!0;break e}catch(e){}r=!1}r||(t=null)}}else"mouseover"==i?t=e.fromElement:"mouseout"==i&&(t=e.toElement);this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:co[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&lo.$.h.call(this)}}zs(lo,js);var co={2:"touch",3:"pen",4:"mouse"};lo.prototype.h=function(){lo.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var uo="closure_listenable_"+(1e6*Math.random()|0),ho=0;function po(e,t,i,n,r){this.listener=e,this.proxy=null,this.src=t,this.type=i,this.capture=!!n,this.la=r,this.key=++ho,this.fa=this.ia=!1}function fo(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function mo(e,t,i){for(const n in e)t.call(i,e[n],n,e)}function go(e){const t={};for(const i in e)t[i]=e[i];return t}const _o="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function yo(e,t){let i,n;for(let t=1;t<arguments.length;t++){for(i in n=arguments[t],n)e[i]=n[i];for(let t=0;t<_o.length;t++)i=_o[t],Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}}function vo(e){this.src=e,this.g={},this.h=0}function xo(e,t){var i=t.type;if(i in e.g){var n,r=e.g[i],s=Bs(r,t);(n=0<=s)&&Array.prototype.splice.call(r,s,1),n&&(fo(t),0==e.g[i].length&&(delete e.g[i],e.h--))}}function bo(e,t,i,n){for(var r=0;r<e.length;++r){var s=e[r];if(!s.fa&&s.listener==t&&s.capture==!!i&&s.la==n)return r}return-1}vo.prototype.add=function(e,t,i,n,r){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=bo(e,t,n,r);return-1<o?(t=e[o],i||(t.ia=!1)):((t=new po(t,this.src,s,!!n,r)).ia=i,e.push(t)),t};var wo="closure_lm_"+(1e6*Math.random()|0),So={};function To(e,t,i,n,r){if(n&&n.once)return Mo(e,t,i,n,r);if(Array.isArray(t)){for(var s=0;s<t.length;s++)To(e,t[s],i,n,r);return null}return i=Lo(i),e&&e[uo]?e.O(t,i,Ps(n)?!!n.capture:!!n,r):Eo(e,t,i,!1,n,r)}function Eo(e,t,i,n,r,s){if(!t)throw Error("Invalid event type");var o=Ps(r)?!!r.capture:!!r,a=ko(e);if(a||(e[wo]=a=new vo(e)),(i=a.add(t,i,n,o,s)).proxy)return i;if(n=function(){const e=Po;return function t(i){return e.call(t.src,t.listener,i)}}(),i.proxy=n,n.src=e,n.listener=i,e.addEventListener)Gs||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),n,r);else if(e.attachEvent)e.attachEvent(Co(t.toString()),n);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(n)}return i}function Mo(e,t,i,n,r){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Mo(e,t[s],i,n,r);return null}return i=Lo(i),e&&e[uo]?e.P(t,i,Ps(n)?!!n.capture:!!n,r):Eo(e,t,i,!0,n,r)}function Io(e,t,i,n,r){if(Array.isArray(t))for(var s=0;s<t.length;s++)Io(e,t[s],i,n,r);else n=Ps(n)?!!n.capture:!!n,i=Lo(i),e&&e[uo]?(e=e.i,(t=String(t).toString())in e.g&&-1<(i=bo(s=e.g[t],i,n,r))&&(fo(s[i]),Array.prototype.splice.call(s,i,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=ko(e))&&(t=e.g[t.toString()],e=-1,t&&(e=bo(t,i,n,r)),(i=-1<e?t[e]:null)&&Ao(i))}function Ao(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[uo])xo(t.i,e);else{var i=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(i,n,e.capture):t.detachEvent?t.detachEvent(Co(i),n):t.addListener&&t.removeListener&&t.removeListener(n),(i=ko(t))?(xo(i,e),0==i.h&&(i.src=null,t[wo]=null)):fo(e)}}}function Co(e){return e in So?So[e]:So[e]="on"+e}function Po(e,t){if(e.fa)e=!0;else{t=new lo(t,this);var i=e.listener,n=e.la||e.src;e.ia&&Ao(e),e=i.call(n,t)}return e}function ko(e){return(e=e[wo])instanceof vo?e:null}var Ro="__closure_events_fn_"+(1e9*Math.random()>>>0);function Lo(e){return"function"==typeof e?e:(e[Ro]||(e[Ro]=function(t){return e.handleEvent(t)}),e[Ro])}function Do(){Fs.call(this),this.i=new vo(this),this.S=this,this.J=null}function Oo(e,t){var i,n=e.J;if(n)for(i=[];n;n=n.J)i.push(n);if(e=e.S,n=t.type||t,"string"==typeof t)t=new js(t,e);else if(t instanceof js)t.target=t.target||e;else{var r=t;yo(t=new js(n,e),r)}if(r=!0,i)for(var s=i.length-1;0<=s;s--){var o=t.g=i[s];r=No(o,n,!0,t)&&r}if(r=No(o=t.g=e,n,!0,t)&&r,r=No(o,n,!1,t)&&r,i)for(s=0;s<i.length;s++)r=No(o=t.g=i[s],n,!1,t)&&r}function No(e,t,i,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==i){var a=o.listener,l=o.la||o.src;o.ia&&xo(e.i,o),r=!1!==a.call(l,n)&&r}}return r&&!n.defaultPrevented}zs(Do,Fs),Do.prototype[uo]=!0,Do.prototype.removeEventListener=function(e,t,i,n){Io(this,e,t,i,n)},Do.prototype.N=function(){if(Do.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var i=t.g[e],n=0;n<i.length;n++)fo(i[n]);delete t.g[e],t.h--}}this.J=null},Do.prototype.O=function(e,t,i,n){return this.i.add(String(e),t,!1,i,n)},Do.prototype.P=function(e,t,i,n){return this.i.add(String(e),t,!0,i,n)};var zo=As.JSON.stringify;function Fo(){var e=Wo;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Bo=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Uo),(e=>e.reset()));class Uo{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Vo(e){var t=1;e=e.split(":");const i=[];for(;0<t&&e.length;)i.push(e.shift()),t--;return e.length&&i.push(e.join(":")),i}function jo(e){As.setTimeout((()=>{throw e}),0)}let Go,Ho=!1,Wo=new class{constructor(){this.h=this.g=null}add(e,t){const i=Bo.get();i.set(e,t),this.h?this.h.next=i:this.g=i,this.h=i}},qo=()=>{const e=As.Promise.resolve(void 0);Go=()=>{e.then($o)}};var $o=()=>{for(var e;e=Fo();){try{e.h.call(e.g)}catch(e){jo(e)}var t=Bo;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Ho=!1};function Zo(e,t){Do.call(this),this.h=e||1,this.g=t||As,this.j=Os(this.qb,this),this.l=Date.now()}function Xo(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function Yo(e,t,i){if("function"==typeof e)i&&(e=Os(e,i));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Os(e.handleEvent,e)}return 2147483647<Number(t)?-1:As.setTimeout(e,t||0)}function Ko(e){e.g=Yo((()=>{e.g=null,e.i&&(e.i=!1,Ko(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}zs(Zo,Do),(Ts=Zo.prototype).ga=!1,Ts.T=null,Ts.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Oo(this,"tick"),this.ga&&(Xo(this),this.start()))}},Ts.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Ts.N=function(){Zo.$.N.call(this),Xo(this),delete this.g};class Jo extends Fs{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Ko(this)}N(){super.N(),this.g&&(As.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qo(e){Fs.call(this),this.h=e,this.g={}}zs(Qo,Fs);var ea=[];function ta(e,t,i,n){Array.isArray(i)||(i&&(ea[0]=i.toString()),i=ea);for(var r=0;r<i.length;r++){var s=To(t,i[r],n||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function ia(e){mo(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Ao(e)}),e),e.g={}}function na(){this.g=!0}function ra(e,t,i,n){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var i=JSON.parse(t);if(i)for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var n=i[e];if(!(2>n.length)){var r=n[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return zo(i)}catch(e){return t}}(e,i)+(n?" "+n:"")}))}Qo.prototype.N=function(){Qo.$.N.call(this),ia(this)},Qo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},na.prototype.Ea=function(){this.g=!1},na.prototype.info=function(){};var sa={},oa=null;function aa(){return oa=oa||new Do}function la(e){js.call(this,sa.Ta,e)}function ca(e){const t=aa();Oo(t,new la(t))}function ua(e,t){js.call(this,sa.STAT_EVENT,e),this.stat=t}function ha(e){const t=aa();Oo(t,new ua(t,e))}function da(e,t){js.call(this,sa.Ua,e),this.size=t}function pa(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return As.setTimeout((function(){e()}),t)}sa.Ta="serverreachability",zs(la,js),sa.STAT_EVENT="statevent",zs(ua,js),sa.Ua="timingevent",zs(da,js);var fa={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ma={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ga(){}function _a(e){return e.h||(e.h=e.i())}function ya(){}ga.prototype.h=null;var va,xa={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ba(){js.call(this,"d")}function wa(){js.call(this,"c")}function Sa(){}function Ta(e,t,i,n){this.l=e,this.j=t,this.m=i,this.W=n||1,this.U=new Qo(this),this.P=Ma,e=eo?125:void 0,this.V=new Zo(e),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Ea}function Ea(){this.i=null,this.g="",this.h=!1}zs(ba,js),zs(wa,js),zs(Sa,ga),Sa.prototype.g=function(){return new XMLHttpRequest},Sa.prototype.i=function(){return{}},va=new Sa;var Ma=45e3,Ia={},Aa={};function Ca(e,t,i){e.L=1,e.A=Za(Ga(t)),e.u=i,e.S=!0,Pa(e,null)}function Pa(e,t){e.G=Date.now(),Da(e),e.B=Ga(e.A);var i=e.B,n=e.W;Array.isArray(n)||(n=[String(n)]),al(i.i,"t",n),e.o=0,i=e.l.J,e.h=new Ea,e.g=ac(e.l,i?t:null,!e.u),0<e.O&&(e.M=new Jo(Os(e.Pa,e,e.g),e.O)),ta(e.U,e.g,"readystatechange",e.nb),t=e.I?go(e.I):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.B,e.v,e.u,t)):(e.v="GET",e.g.ha(e.B,e.v,null,t)),ca(),function(e,t,i,n,r,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+c+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+n+") [attempt "+r+"]: "+t+"\n"+i+"\n"+o}))}(e.j,e.v,e.B,e.m,e.W,e.u)}function ka(e){return!!e.g&&"GET"==e.v&&2!=e.L&&e.l.Ha}function Ra(e,t,i){let n,r=!0;for(;!e.J&&e.o<i.length;){if(n=La(e,i),n==Aa){4==t&&(e.s=4,ha(14),r=!1),ra(e.j,e.m,null,"[Incomplete Response]");break}if(n==Ia){e.s=4,ha(15),ra(e.j,e.m,i,"[Invalid Chunk]"),r=!1;break}ra(e.j,e.m,n,null),Ba(e,n)}ka(e)&&0!=e.o&&(e.h.g=e.h.g.slice(e.o),e.o=0),4!=t||0!=i.length||e.h.h||(e.s=1,ha(16),r=!1),e.i=e.i&&r,r?0<i.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+i.length),Ql(t),t.M=!0,ha(11))):(ra(e.j,e.m,i,"[Invalid Chunked Response]"),Fa(e),za(e))}function La(e,t){var i=e.o,n=t.indexOf("\n",i);return-1==n?Aa:(i=Number(t.substring(i,n)),isNaN(i)?Ia:(n+=1)+i>t.length?Aa:(t=t.slice(n,n+i),e.o=n+i,t))}function Da(e){e.Y=Date.now()+e.P,Oa(e,e.P)}function Oa(e,t){if(null!=e.C)throw Error("WatchDog timer not null");e.C=pa(Os(e.lb,e),t)}function Na(e){e.C&&(As.clearTimeout(e.C),e.C=null)}function za(e){0==e.l.H||e.J||ic(e.l,e)}function Fa(e){Na(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,Xo(e.V),ia(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Ba(e,t){try{var i=e.l;if(0!=i.H&&(i.g==e||fl(i.i,e)))if(!e.K&&fl(i.i,e)&&3==i.H){try{var n=i.Ja.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var r=n;if(0==r[0]){e:if(!i.u){if(i.g){if(!(i.g.G+3e3<e.G))break e;tc(i),Wl(i)}Jl(i),ha(18)}}else i.Fa=r[1],0<i.Fa-i.V&&37500>r[2]&&i.G&&0==i.A&&!i.v&&(i.v=pa(Os(i.ib,i),6e3));if(1>=pl(i.i)&&i.oa){try{i.oa()}catch(e){}i.oa=void 0}}else rc(i,11)}else if((e.K||i.g==e)&&tc(i),!Hs(t))for(r=i.Ja.g.parse(t),t=0;t<r.length;t++){let c=r[t];if(i.V=c[0],c=c[1],2==i.H)if("c"==c[0]){i.K=c[1],i.pa=c[2];const t=c[3];null!=t&&(i.ra=t,i.l.info("VER="+i.ra));const r=c[4];null!=r&&(i.Ga=r,i.l.info("SVER="+i.Ga));const u=c[5];null!=u&&"number"==typeof u&&0<u&&(n=1.5*u,i.L=n,i.l.info("backChannelRequestTimeoutMs_="+n)),n=i;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(ml(s,s.h),s.h=null))}if(n.F){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.Da=e,$a(n.I,n.F,e))}}i.H=3,i.h&&i.h.Ba(),i.ca&&(i.S=Date.now()-e.G,i.l.info("Handshake RTT: "+i.S+"ms"));var o=e;if((n=i).wa=oc(n,n.J?n.pa:null,n.Y),o.K){gl(n.i,o);var a=o,l=n.L;l&&a.setTimeout(l),a.C&&(Na(a),Da(a)),n.g=o}else Kl(n);0<i.j.length&&$l(i)}else"stop"!=c[0]&&"close"!=c[0]||rc(i,7);else 3==i.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?rc(i,7):Hl(i):"noop"!=c[0]&&i.h&&i.h.Aa(c),i.A=0)}ca()}catch(e){}}function Ua(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Cs(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var i=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Cs(e)||"string"==typeof e){var t=[];e=e.length;for(var i=0;i<e;i++)t.push(i);return t}t=[],i=0;for(const n in e)t[i++]=n;return t}}}(e),n=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Cs(e)){for(var t=[],i=e.length,n=0;n<i;n++)t.push(e[n]);return t}for(n in t=[],i=0,e)t[i++]=e[n];return t}(e),r=n.length,s=0;s<r;s++)t.call(void 0,n[s],i&&i[s],e)}(Ts=Ta.prototype).setTimeout=function(e){this.P=e},Ts.nb=function(e){e=e.target;const t=this.M;t&&3==Fl(e)?t.l():this.Pa(e)},Ts.Pa=function(e){try{if(e==this.g)e:{const u=Fl(this.g);var t=this.g.Ia();if(this.g.da(),!(3>u)&&(3!=u||eo||this.g&&(this.h.h||this.g.ja()||Bl(this.g)))){this.J||4!=u||7==t||ca(),Na(this);var i=this.g.da();this.ca=i;t:if(ka(this)){var n=Bl(this.g);e="";var r=n.length,s=4==Fl(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Fa(this),za(this);var o="";break t}this.h.i=new As.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(n[t],{stream:s&&t==r-1});n.length=0,this.h.g+=e,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==i,function(e,t,i,n,r,s,o){e.info((function(){return"XMLHTTP RESP ("+n+") [ attempt "+r+"]: "+t+"\n"+i+"\n"+s+" "+o}))}(this.j,this.v,this.B,this.m,this.W,u,i),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Hs(a)){var c=a;break t}}c=null}if(!(i=c)){this.i=!1,this.s=3,ha(12),Fa(this),za(this);break e}ra(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ba(this,i)}this.S?(Ra(this,u,o),eo&&this.i&&3==u&&(ta(this.U,this.V,"tick",this.mb),this.V.start())):(ra(this.j,this.m,o,null),Ba(this,o)),4==u&&Fa(this),this.i&&!this.J&&(4==u?ic(this.l,this):(this.i=!1,Da(this)))}else(function(e){const t={};e=(e.g&&2<=Fl(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(Hs(e[n]))continue;var i=Vo(e[n]);const r=i[0];if("string"!=typeof(i=i[1]))continue;i=i.trim();const s=t[r]||[];t[r]=s,s.push(i)}!function(e,t){for(const i in e)t.call(void 0,e[i],i,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==i&&0<o.indexOf("Unknown SID")?(this.s=3,ha(12)):(this.s=0,ha(13)),Fa(this),za(this)}}}catch(e){}},Ts.mb=function(){if(this.g){var e=Fl(this.g),t=this.g.ja();this.o<t.length&&(Na(this),Ra(this,e,t),this.i&&4!=e&&Da(this))}},Ts.cancel=function(){this.J=!0,Fa(this)},Ts.lb=function(){this.C=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.B),2!=this.L&&(ca(),ha(17)),Fa(this),this.s=2,za(this)):Oa(this,this.Y-e)};var Va=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ja(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof ja){this.h=e.h,Ha(this,e.j),this.s=e.s,this.g=e.g,Wa(this,e.m),this.l=e.l;var t=e.i,i=new nl;i.i=t.i,t.g&&(i.g=new Map(t.g),i.h=t.h),qa(this,i),this.o=e.o}else e&&(t=String(e).match(Va))?(this.h=!1,Ha(this,t[1]||"",!0),this.s=Xa(t[2]||""),this.g=Xa(t[3]||"",!0),Wa(this,t[4]),this.l=Xa(t[5]||"",!0),qa(this,t[6]||"",!0),this.o=Xa(t[7]||"")):(this.h=!1,this.i=new nl(null,this.h))}function Ga(e){return new ja(e)}function Ha(e,t,i){e.j=i?Xa(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Wa(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function qa(e,t,i){t instanceof nl?(e.i=t,function(e,t){t&&!e.j&&(rl(e),e.i=null,e.g.forEach((function(e,t){var i=t.toLowerCase();t!=i&&(sl(this,t),al(this,i,e))}),e)),e.j=t}(e.i,e.h)):(i||(t=Ya(t,tl)),e.i=new nl(t,e.h))}function $a(e,t,i){e.i.set(t,i)}function Za(e){return $a(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Xa(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Ya(e,t,i){return"string"==typeof e?(e=encodeURI(e).replace(t,Ka),i&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Ka(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}ja.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Ya(t,Ja,!0),":");var i=this.g;return(i||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Ya(t,Ja,!0),"@"),e.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.m)&&e.push(":",String(i))),(i=this.l)&&(this.g&&"/"!=i.charAt(0)&&e.push("/"),e.push(Ya(i,"/"==i.charAt(0)?el:Qa,!0))),(i=this.i.toString())&&e.push("?",i),(i=this.o)&&e.push("#",Ya(i,il)),e.join("")};var Ja=/[#\/\?@]/g,Qa=/[#\?:]/g,el=/[#\?]/g,tl=/[#\?@]/g,il=/#/g;function nl(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function rl(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var i=0;i<e.length;i++){var n=e[i].indexOf("="),r=null;if(0<=n){var s=e[i].substring(0,n);r=e[i].substring(n+1)}else s=e[i];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,(function(t,i){e.add(decodeURIComponent(t.replace(/\+/g," ")),i)})))}function sl(e,t){rl(e),t=ll(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function ol(e,t){return rl(e),t=ll(e,t),e.g.has(t)}function al(e,t,i){sl(e,t),0<i.length&&(e.i=null,e.g.set(ll(e,t),Us(i)),e.h+=i.length)}function ll(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(Ts=nl.prototype).add=function(e,t){rl(this),this.i=null,e=ll(this,e);var i=this.g.get(e);return i||this.g.set(e,i=[]),i.push(t),this.h+=1,this},Ts.forEach=function(e,t){rl(this),this.g.forEach((function(i,n){i.forEach((function(i){e.call(t,i,n,this)}),this)}),this)},Ts.ta=function(){rl(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),i=[];for(let n=0;n<t.length;n++){const r=e[n];for(let e=0;e<r.length;e++)i.push(t[n])}return i},Ts.Z=function(e){rl(this);let t=[];if("string"==typeof e)ol(this,e)&&(t=t.concat(this.g.get(ll(this,e))));else{e=Array.from(this.g.values());for(let i=0;i<e.length;i++)t=t.concat(e[i])}return t},Ts.set=function(e,t){return rl(this),this.i=null,ol(this,e=ll(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Ts.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},Ts.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var i=0;i<t.length;i++){var n=t[i];const s=encodeURIComponent(String(n)),o=this.Z(n);for(n=0;n<o.length;n++){var r=s;""!==o[n]&&(r+="="+encodeURIComponent(String(o[n]))),e.push(r)}}return this.i=e.join("&")};var cl=class{constructor(e,t){this.g=e,this.map=t}};function ul(e){this.l=e||hl,e=As.PerformanceNavigationTiming?0<(e=As.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(As.g&&As.g.Ka&&As.g.Ka()&&As.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var hl=10;function dl(e){return!!e.h||!!e.g&&e.g.size>=e.j}function pl(e){return e.h?1:e.g?e.g.size:0}function fl(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function ml(e,t){e.g?e.g.add(t):e.h=t}function gl(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function _l(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const i of e.g.values())t=t.concat(i.F);return t}return Us(e.i)}ul.prototype.cancel=function(){if(this.i=_l(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var yl=class{stringify(e){return As.JSON.stringify(e,void 0)}parse(e){return As.JSON.parse(e,void 0)}};function vl(){this.g=new yl}function xl(e,t,i){const n=i||"";try{Ua(e,(function(e,i){let r=e;Ps(e)&&(r=zo(e)),t.push(n+i+"="+encodeURIComponent(r))}))}catch(e){throw t.push(n+"type="+encodeURIComponent("_badmap")),e}}function bl(e,t,i,n,r){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,r(n)}catch(e){}}function wl(e){this.l=e.ec||null,this.j=e.ob||!1}function Sl(e,t){Do.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=Tl,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}zs(wl,ga),wl.prototype.g=function(){return new Sl(this.l,this.j)},wl.prototype.i=function(e){return function(){return e}}({}),zs(Sl,Do);var Tl=0;function El(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function Ml(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Il(e)}function Il(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Ts=Sl.prototype).open=function(e,t){if(this.readyState!=Tl)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Il(this)},Ts.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||As).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},Ts.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ml(this)),this.readyState=Tl},Ts.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Il(this)),this.g&&(this.readyState=3,Il(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==As.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;El(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},Ts.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Ml(this):Il(this),3==this.readyState&&El(this)}},Ts.Za=function(e){this.g&&(this.response=this.responseText=e,Ml(this))},Ts.Ya=function(e){this.g&&(this.response=e,Ml(this))},Ts.ka=function(){this.g&&Ml(this)},Ts.setRequestHeader=function(e,t){this.v.append(e,t)},Ts.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Ts.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var i=t.next();!i.done;)i=i.value,e.push(i[0]+": "+i[1]),i=t.next();return e.join("\r\n")},Object.defineProperty(Sl.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Al=As.JSON.parse;function Cl(e){Do.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Pl,this.L=this.M=!1}zs(Cl,Do);var Pl="",kl=/^https?$/i,Rl=["POST","PUT"];function Ll(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Dl(e),Nl(e)}function Dl(e){e.F||(e.F=!0,Oo(e,"complete"),Oo(e,"error"))}function Ol(e){if(e.h&&void 0!==Is&&(!e.C[1]||4!=Fl(e)||2!=e.da()))if(e.v&&4==Fl(e))Yo(e.La,0,e);else if(Oo(e,"readystatechange"),4==Fl(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var i;if(!(i=t)){var n;if(n=0===o){var r=String(e.I).match(Va)[1]||null;!r&&As.self&&As.self.location&&(r=As.self.location.protocol.slice(0,-1)),n=!kl.test(r?r.toLowerCase():"")}i=n}if(i)Oo(e,"complete"),Oo(e,"success");else{e.m=6;try{var s=2<Fl(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",Dl(e)}}finally{Nl(e)}}}function Nl(e,t){if(e.g){zl(e);const i=e.g,n=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||Oo(e,"ready");try{i.onreadystatechange=n}catch(e){}}}function zl(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(As.clearTimeout(e.A),e.A=null)}function Fl(e){return e.g?e.g.readyState:0}function Bl(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case Pl:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Ul(e){let t="";return mo(e,(function(e,i){t+=i,t+=":",t+=e,t+="\r\n"})),t}function Vl(e,t,i){e:{for(n in i){var n=!1;break e}n=!0}n||(i=Ul(i),"string"==typeof e?null!=i&&encodeURIComponent(String(i)):$a(e,t,i))}function jl(e,t,i){return i&&i.internalChannelParams&&i.internalChannelParams[e]||t}function Gl(e){this.Ga=0,this.j=[],this.l=new na,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=jl("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=jl("baseRetryDelayMs",5e3,e),this.hb=jl("retryDelaySeedMs",1e4,e),this.eb=jl("forwardChannelMaxRetries",2,e),this.xa=jl("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new ul(e&&e.concurrentRequestLimit),this.Ja=new vl,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Hl(e){if(ql(e),3==e.H){var t=e.W++,i=Ga(e.I);if($a(i,"SID",e.K),$a(i,"RID",t),$a(i,"TYPE","terminate"),Xl(e,i),(t=new Ta(e,e.l,t)).L=2,t.A=Za(Ga(i)),i=!1,As.navigator&&As.navigator.sendBeacon)try{i=As.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!i&&As.Image&&((new Image).src=t.A,i=!0),i||(t.g=ac(t.l,null),t.g.ha(t.A)),t.G=Date.now(),Da(t)}sc(e)}function Wl(e){e.g&&(Ql(e),e.g.cancel(),e.g=null)}function ql(e){Wl(e),e.u&&(As.clearTimeout(e.u),e.u=null),tc(e),e.i.cancel(),e.m&&("number"==typeof e.m&&As.clearTimeout(e.m),e.m=null)}function $l(e){if(!dl(e.i)&&!e.m){e.m=!0;var t=e.Na;Go||qo(),Ho||(Go(),Ho=!0),Wo.add(t,e),e.C=0}}function Zl(e,t){var i;i=t?t.m:e.W++;const n=Ga(e.I);$a(n,"SID",e.K),$a(n,"RID",i),$a(n,"AID",e.V),Xl(e,n),e.o&&e.s&&Vl(n,e.o,e.s),i=new Ta(e,e.l,i,e.C+1),null===e.o&&(i.I=e.s),t&&(e.j=t.F.concat(e.j)),t=Yl(e,i,1e3),i.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),ml(e.i,i),Ca(i,n,t)}function Xl(e,t){e.na&&mo(e.na,(function(e,i){$a(t,i,e)})),e.h&&Ua({},(function(e,i){$a(t,i,e)}))}function Yl(e,t,i){i=Math.min(e.j.length,i);var n=e.h?Os(e.h.Va,e.h,e):null;e:{var r=e.j;let t=-1;for(;;){const e=["count="+i];-1==t?0<i?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<i;o++){let i=r[o].g;const a=r[o].map;if(i-=t,0>i)t=Math.max(0,r[o].g-100),s=!1;else try{xl(a,e,"req"+i+"_")}catch(e){n&&n(a)}}if(s){n=e.join("&");break e}}}return e=e.j.splice(0,i),t.F=e,n}function Kl(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;Go||qo(),Ho||(Go(),Ho=!0),Wo.add(t,e),e.A=0}}function Jl(e){return!(e.g||e.u||3<=e.A||(e.ba++,e.u=pa(Os(e.Ma,e),nc(e,e.A)),e.A++,0))}function Ql(e){null!=e.B&&(As.clearTimeout(e.B),e.B=null)}function ec(e){e.g=new Ta(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=Ga(e.wa);$a(t,"RID","rpc"),$a(t,"SID",e.K),$a(t,"AID",e.V),$a(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&$a(t,"TO",e.qa),$a(t,"TYPE","xmlhttp"),Xl(e,t),e.o&&e.s&&Vl(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var i=e.g;e=e.pa,i.L=1,i.A=Za(Ga(t)),i.u=null,i.S=!0,Pa(i,e)}function tc(e){null!=e.v&&(As.clearTimeout(e.v),e.v=null)}function ic(e,t){var i=null;if(e.g==t){tc(e),Ql(e),e.g=null;var n=2}else{if(!fl(e.i,t))return;i=t.F,gl(e.i,t),n=1}if(0!=e.H)if(t.i)if(1==n){i=t.u?t.u.length:0,t=Date.now()-t.G;var r=e.C;Oo(n=aa(),new da(n,i)),$l(e)}else Kl(e);else if(3==(r=t.s)||0==r&&0<t.ca||!(1==n&&function(e,t){return!(pl(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=pa(Os(e.Na,e,t),nc(e,e.C)),e.C++,0)))}(e,t)||2==n&&Jl(e)))switch(i&&0<i.length&&(t=e.i,t.i=t.i.concat(i)),r){case 1:rc(e,5);break;case 4:rc(e,10);break;case 3:rc(e,6);break;default:rc(e,2)}}function nc(e,t){let i=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(i*=2),i*t}function rc(e,t){if(e.l.info("Error code "+t),2==t){var i=null;e.h&&(i=null);var n=Os(e.pb,e);i||(i=new ja("//www.google.com/images/cleardot.gif"),As.location&&"http"==As.location.protocol||Ha(i,"https"),Za(i)),function(e,t){const i=new na;if(As.Image){const n=new Image;n.onload=Ns(bl,i,n,"TestLoadImage: loaded",!0,t),n.onerror=Ns(bl,i,n,"TestLoadImage: error",!1,t),n.onabort=Ns(bl,i,n,"TestLoadImage: abort",!1,t),n.ontimeout=Ns(bl,i,n,"TestLoadImage: timeout",!1,t),As.setTimeout((function(){n.ontimeout&&n.ontimeout()}),1e4),n.src=e}else t(!1)}(i.toString(),n)}else ha(2);e.H=0,e.h&&e.h.za(t),sc(e),ql(e)}function sc(e){if(e.H=0,e.ma=[],e.h){const t=_l(e.i);0==t.length&&0==e.j.length||(Vs(e.ma,t),Vs(e.ma,e.j),e.i.i.length=0,Us(e.j),e.j.length=0),e.h.ya()}}function oc(e,t,i){var n=i instanceof ja?Ga(i):new ja(i);if(""!=n.g)t&&(n.g=t+"."+n.g),Wa(n,n.m);else{var r=As.location;n=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var s=new ja(null);n&&Ha(s,n),t&&(s.g=t),r&&Wa(s,r),i&&(s.l=i),n=s}return i=e.F,t=e.Da,i&&t&&$a(n,i,t),$a(n,"VER",e.ra),Xl(e,n),n}function ac(e,t,i){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ha&&!e.va?new Cl(new wl({ob:i})):new Cl(e.va)).Oa(e.J),t}function lc(){}function cc(){if(Js&&!(10<=Number(ao)))throw Error("Environmental error: no available transport.")}function uc(e,t){Do.call(this),this.g=new Gl(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!Hs(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Hs(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new pc(this)}function hc(e){ba.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const i in t){e=i;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function dc(){wa.call(this),this.status=1}function pc(e){this.g=e}function fc(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function mc(e,t,i){i||(i=0);var n=Array(16);if("string"==typeof t)for(var r=0;16>r;++r)n[r]=t.charCodeAt(i++)|t.charCodeAt(i++)<<8|t.charCodeAt(i++)<<16|t.charCodeAt(i++)<<24;else for(r=0;16>r;++r)n[r]=t[i++]|t[i++]<<8|t[i++]<<16|t[i++]<<24;t=e.g[0],i=e.g[1],r=e.g[2];var s=e.g[3],o=t+(s^i&(r^s))+n[0]+3614090360&4294967295;o=(i=(r=(s=(t=(i=(r=(s=(t=(i=(r=(s=(t=(i=(r=(s=(t=(i=(r=(s=(t=(i=(r=(s=(t=(i=(r=(s=(t=(i=(r=(s=(t=(i=(r=(s=(t=(i=(r=(s=(t=(i=(r=(s=(t=(i=(r=(s=(t=(i=(r=(s=(t=(i=(r=(s=(t=(i=(r=(s=(t=i+(o<<7&4294967295|o>>>25))+((o=s+(r^t&(i^r))+n[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(i^s&(t^i))+n[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=i+(t^r&(s^t))+n[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^i&(r^s))+n[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^t&(i^r))+n[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(i^s&(t^i))+n[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=i+(t^r&(s^t))+n[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^i&(r^s))+n[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^t&(i^r))+n[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(i^s&(t^i))+n[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=i+(t^r&(s^t))+n[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^i&(r^s))+n[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^t&(i^r))+n[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(i^s&(t^i))+n[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=i+(t^r&(s^t))+n[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^s&(i^r))+n[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(i^r&(t^i))+n[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^i&(s^t))+n[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=i+(s^t&(r^s))+n[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s&(i^r))+n[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(i^r&(t^i))+n[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^i&(s^t))+n[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=i+(s^t&(r^s))+n[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s&(i^r))+n[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(i^r&(t^i))+n[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^i&(s^t))+n[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=i+(s^t&(r^s))+n[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s&(i^r))+n[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(i^r&(t^i))+n[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^i&(s^t))+n[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=i+(s^t&(r^s))+n[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^r^s)+n[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^i^r)+n[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^i)+n[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=i+(r^s^t)+n[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^r^s)+n[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^i^r)+n[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^i)+n[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=i+(r^s^t)+n[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^r^s)+n[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^i^r)+n[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^i)+n[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=i+(r^s^t)+n[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^r^s)+n[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^i^r)+n[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^i)+n[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=i+(r^s^t)+n[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^(i|~s))+n[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(i^(t|~r))+n[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(s|~i))+n[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=i+(s^(r|~t))+n[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(r^(i|~s))+n[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(i^(t|~r))+n[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(s|~i))+n[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=i+(s^(r|~t))+n[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(r^(i|~s))+n[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(i^(t|~r))+n[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(s|~i))+n[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=i+(s^(r|~t))+n[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=i+((o=t+(r^(i|~s))+n[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(i^(t|~r))+n[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=s+((o=r+(t^(s|~i))+n[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+n[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+s&4294967295}function gc(e,t){this.h=t;for(var i=[],n=!0,r=e.length-1;0<=r;r--){var s=0|e[r];n&&s==t||(i[r]=s,n=!1)}this.g=i}(Ts=Cl.prototype).Oa=function(e){this.M=e},Ts.ha=function(e,t,i,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():va.g(),this.C=this.u?_a(this.u):_a(va),this.g.onreadystatechange=Os(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void Ll(this,e)}if(e=i||"",i=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var r in n)i.set(r,n[r]);else{if("function"!=typeof n.keys||"function"!=typeof n.get)throw Error("Unknown input type for opt_headers: "+String(n));for(const e of n.keys())i.set(e,n.get(e))}n=Array.from(i.keys()).find((e=>"content-type"==e.toLowerCase())),r=As.FormData&&e instanceof As.FormData,!(0<=Bs(Rl,t))||n||r||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of i)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{zl(this),0<this.B&&((this.L=function(e){return Js&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Os(this.ua,this)):this.A=Yo(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Ll(this,e)}},Ts.ua=function(){void 0!==Is&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Oo(this,"timeout"),this.abort(8))},Ts.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Oo(this,"complete"),Oo(this,"abort"),Nl(this))},Ts.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Nl(this,!0)),Cl.$.N.call(this)},Ts.La=function(){this.s||(this.G||this.v||this.l?Ol(this):this.kb())},Ts.kb=function(){Ol(this)},Ts.isActive=function(){return!!this.g},Ts.da=function(){try{return 2<Fl(this)?this.g.status:-1}catch(e){return-1}},Ts.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Ts.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Al(t)}},Ts.Ia=function(){return this.m},Ts.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Ts=Gl.prototype).ra=8,Ts.H=1,Ts.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const r=new Ta(this,this.l,e);let s=this.s;if(this.U&&(s?(s=go(s),yo(s,this.U)):s=this.U),null!==this.o||this.O||(r.I=s,s=null),this.P)e:{for(var t=0,i=0;i<this.j.length;i++){var n=this.j[i];if(void 0===(n="__data__"in n.map&&"string"==typeof(n=n.map.__data__)?n.length:void 0))break;if(4096<(t+=n)){t=i;break e}if(4096===t||i===this.j.length-1){t=i+1;break e}}t=1e3}else t=1e3;t=Yl(this,r,t),$a(i=Ga(this.I),"RID",e),$a(i,"CVER",22),this.F&&$a(i,"X-HTTP-Session-Id",this.F),Xl(this,i),s&&(this.O?t="headers="+encodeURIComponent(String(Ul(s)))+"&"+t:this.o&&Vl(i,this.o,s)),ml(this.i,r),this.bb&&$a(i,"TYPE","init"),this.P?($a(i,"$req",t),$a(i,"SID","null"),r.aa=!0,Ca(r,i,null)):Ca(r,i,t),this.H=2}}else 3==this.H&&(e?Zl(this,e):0==this.j.length||dl(this.i)||Zl(this))},Ts.Ma=function(){if(this.u=null,ec(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=pa(Os(this.jb,this),e)}},Ts.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ha(10),Wl(this),ec(this))},Ts.ib=function(){null!=this.v&&(this.v=null,Wl(this),Jl(this),ha(19))},Ts.pb=function(e){e?(this.l.info("Successfully pinged google.com"),ha(2)):(this.l.info("Failed to ping google.com"),ha(1))},Ts.isActive=function(){return!!this.h&&this.h.isActive(this)},(Ts=lc.prototype).Ba=function(){},Ts.Aa=function(){},Ts.za=function(){},Ts.ya=function(){},Ts.isActive=function(){return!0},Ts.Va=function(){},cc.prototype.g=function(e,t){return new uc(e,t)},zs(uc,Do),uc.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,i=this.h||void 0;ha(0),e.Y=t,e.na=i||{},e.G=e.aa,e.I=oc(e,null,e.Y),$l(e)},uc.prototype.close=function(){Hl(this.g)},uc.prototype.u=function(e){var t=this.g;if("string"==typeof e){var i={};i.__data__=e,e=i}else this.v&&((i={}).__data__=zo(e),e=i);t.j.push(new cl(t.fb++,e)),3==t.H&&$l(t)},uc.prototype.N=function(){this.g.h=null,delete this.j,Hl(this.g),delete this.g,uc.$.N.call(this)},zs(hc,ba),zs(dc,wa),zs(pc,lc),pc.prototype.Ba=function(){Oo(this.g,"a")},pc.prototype.Aa=function(e){Oo(this.g,new hc(e))},pc.prototype.za=function(e){Oo(this.g,new dc)},pc.prototype.ya=function(){Oo(this.g,"b")},zs(fc,(function(){this.blockSize=-1})),fc.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},fc.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var i=t-this.blockSize,n=this.m,r=this.h,s=0;s<t;){if(0==r)for(;s<=i;)mc(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(n[r++]=e.charCodeAt(s++),r==this.blockSize){mc(this,n),r=0;break}}else for(;s<t;)if(n[r++]=e[s++],r==this.blockSize){mc(this,n),r=0;break}}this.h=r,this.i+=t},fc.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var i=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&i,i/=256;for(this.j(e),e=Array(16),t=i=0;4>t;++t)for(var n=0;32>n;n+=8)e[i++]=this.g[t]>>>n&255;return e};var _c={};function yc(e){return-128<=e&&128>e?function(e,t){var i=_c;return Object.prototype.hasOwnProperty.call(i,e)?i[e]:i[e]=function(e){return new gc([0|e],0>e?-1:0)}(e)}(e):new gc([0|e],0>e?-1:0)}function vc(e){if(isNaN(e)||!isFinite(e))return bc;if(0>e)return Mc(vc(-e));for(var t=[],i=1,n=0;e>=i;n++)t[n]=e/i|0,i*=xc;return new gc(t,0)}var xc=4294967296,bc=yc(0),wc=yc(1),Sc=yc(16777216);function Tc(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function Ec(e){return-1==e.h}function Mc(e){for(var t=e.g.length,i=[],n=0;n<t;n++)i[n]=~e.g[n];return new gc(i,~e.h).add(wc)}function Ic(e,t){return e.add(Mc(t))}function Ac(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function Cc(e,t){this.g=e,this.h=t}function Pc(e,t){if(Tc(t))throw Error("division by zero");if(Tc(e))return new Cc(bc,bc);if(Ec(e))return t=Pc(Mc(e),t),new Cc(Mc(t.g),Mc(t.h));if(Ec(t))return t=Pc(e,Mc(t)),new Cc(Mc(t.g),t.h);if(30<e.g.length){if(Ec(e)||Ec(t))throw Error("slowDivide_ only works with positive integers.");for(var i=wc,n=t;0>=n.X(e);)i=kc(i),n=kc(n);var r=Rc(i,1),s=Rc(n,1);for(n=Rc(n,2),i=Rc(i,2);!Tc(n);){var o=s.add(n);0>=o.X(e)&&(r=r.add(i),s=o),n=Rc(n,1),i=Rc(i,1)}return t=Ic(e,r.R(t)),new Cc(r,t)}for(r=bc;0<=e.X(t);){for(i=Math.max(1,Math.floor(e.ea()/t.ea())),n=48>=(n=Math.ceil(Math.log(i)/Math.LN2))?1:Math.pow(2,n-48),o=(s=vc(i)).R(t);Ec(o)||0<o.X(e);)o=(s=vc(i-=n)).R(t);Tc(s)&&(s=wc),r=r.add(s),e=Ic(e,o)}return new Cc(r,e)}function kc(e){for(var t=e.g.length+1,i=[],n=0;n<t;n++)i[n]=e.D(n)<<1|e.D(n-1)>>>31;return new gc(i,e.h)}function Rc(e,t){var i=t>>5;t%=32;for(var n=e.g.length-i,r=[],s=0;s<n;s++)r[s]=0<t?e.D(s+i)>>>t|e.D(s+i+1)<<32-t:e.D(s+i);return new gc(r,e.h)}(Ts=gc.prototype).ea=function(){if(Ec(this))return-Mc(this).ea();for(var e=0,t=1,i=0;i<this.g.length;i++){var n=this.D(i);e+=(0<=n?n:xc+n)*t,t*=xc}return e},Ts.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(Tc(this))return"0";if(Ec(this))return"-"+Mc(this).toString(e);for(var t=vc(Math.pow(e,6)),i=this,n="";;){var r=Pc(i,t).g,s=((0<(i=Ic(i,r.R(t))).g.length?i.g[0]:i.h)>>>0).toString(e);if(Tc(i=r))return s+n;for(;6>s.length;)s="0"+s;n=s+n}},Ts.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},Ts.X=function(e){return Ec(e=Ic(this,e))?-1:Tc(e)?0:1},Ts.abs=function(){return Ec(this)?Mc(this):this},Ts.add=function(e){for(var t=Math.max(this.g.length,e.g.length),i=[],n=0,r=0;r<=t;r++){var s=n+(65535&this.D(r))+(65535&e.D(r)),o=(s>>>16)+(this.D(r)>>>16)+(e.D(r)>>>16);n=o>>>16,s&=65535,o&=65535,i[r]=o<<16|s}return new gc(i,-2147483648&i[i.length-1]?-1:0)},Ts.R=function(e){if(Tc(this)||Tc(e))return bc;if(Ec(this))return Ec(e)?Mc(this).R(Mc(e)):Mc(Mc(this).R(e));if(Ec(e))return Mc(this.R(Mc(e)));if(0>this.X(Sc)&&0>e.X(Sc))return vc(this.ea()*e.ea());for(var t=this.g.length+e.g.length,i=[],n=0;n<2*t;n++)i[n]=0;for(n=0;n<this.g.length;n++)for(var r=0;r<e.g.length;r++){var s=this.D(n)>>>16,o=65535&this.D(n),a=e.D(r)>>>16,l=65535&e.D(r);i[2*n+2*r]+=o*l,Ac(i,2*n+2*r),i[2*n+2*r+1]+=s*l,Ac(i,2*n+2*r+1),i[2*n+2*r+1]+=o*a,Ac(i,2*n+2*r+1),i[2*n+2*r+2]+=s*a,Ac(i,2*n+2*r+2)}for(n=0;n<t;n++)i[n]=i[2*n+1]<<16|i[2*n];for(n=t;n<2*t;n++)i[n]=0;return new gc(i,0)},Ts.gb=function(e){return Pc(this,e).h},Ts.and=function(e){for(var t=Math.max(this.g.length,e.g.length),i=[],n=0;n<t;n++)i[n]=this.D(n)&e.D(n);return new gc(i,this.h&e.h)},Ts.or=function(e){for(var t=Math.max(this.g.length,e.g.length),i=[],n=0;n<t;n++)i[n]=this.D(n)|e.D(n);return new gc(i,this.h|e.h)},Ts.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),i=[],n=0;n<t;n++)i[n]=this.D(n)^e.D(n);return new gc(i,this.h^e.h)},cc.prototype.createWebChannel=cc.prototype.g,uc.prototype.send=uc.prototype.u,uc.prototype.open=uc.prototype.m,uc.prototype.close=uc.prototype.close,fa.NO_ERROR=0,fa.TIMEOUT=8,fa.HTTP_ERROR=6,ma.COMPLETE="complete",ya.EventType=xa,xa.OPEN="a",xa.CLOSE="b",xa.ERROR="c",xa.MESSAGE="d",Do.prototype.listen=Do.prototype.O,Cl.prototype.listenOnce=Cl.prototype.P,Cl.prototype.getLastError=Cl.prototype.Sa,Cl.prototype.getLastErrorCode=Cl.prototype.Ia,Cl.prototype.getStatus=Cl.prototype.da,Cl.prototype.getResponseJson=Cl.prototype.Wa,Cl.prototype.getResponseText=Cl.prototype.ja,Cl.prototype.send=Cl.prototype.ha,Cl.prototype.setWithCredentials=Cl.prototype.Oa,fc.prototype.digest=fc.prototype.l,fc.prototype.reset=fc.prototype.reset,fc.prototype.update=fc.prototype.j,gc.prototype.add=gc.prototype.add,gc.prototype.multiply=gc.prototype.R,gc.prototype.modulo=gc.prototype.gb,gc.prototype.compare=gc.prototype.X,gc.prototype.toNumber=gc.prototype.ea,gc.prototype.toString=gc.prototype.toString,gc.prototype.getBits=gc.prototype.D,gc.fromNumber=vc,gc.fromString=function e(t,i){if(0==t.length)throw Error("number format error: empty string");if(2>(i=i||10)||36<i)throw Error("radix out of range: "+i);if("-"==t.charAt(0))return Mc(e(t.substring(1),i));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=vc(Math.pow(i,8)),r=bc,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),i);8>o?(o=vc(Math.pow(i,o)),r=r.R(o).add(vc(a))):r=(r=r.R(n)).add(vc(a))}return r};var Lc=Ms.createWebChannelTransport=function(){return new cc},Dc=Ms.getStatEventTarget=function(){return aa()},Oc=Ms.ErrorCode=fa,Nc=Ms.EventType=ma,zc=Ms.Event=sa,Fc=Ms.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Bc=Ms.FetchXmlHttpFactory=wl,Uc=Ms.WebChannel=ya,Vc=Ms.XhrIo=Cl,jc=Ms.Md5=fc,Gc=Ms.Integer=gc;const Hc="@firebase/firestore";class Wc{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Wc.UNAUTHENTICATED=new Wc(null),Wc.GOOGLE_CREDENTIALS=new Wc("google-credentials-uid"),Wc.FIRST_PARTY=new Wc("first-party-uid"),Wc.MOCK_USER=new Wc("mock-user");let qc="10.11.1";const $c=new Yn("@firebase/firestore");function Zc(){return $c.logLevel}function Xc(e,...t){if($c.logLevel<=Wn.DEBUG){const i=t.map(Jc);$c.debug(`Firestore (${qc}): ${e}`,...i)}}function Yc(e,...t){if($c.logLevel<=Wn.ERROR){const i=t.map(Jc);$c.error(`Firestore (${qc}): ${e}`,...i)}}function Kc(e,...t){if($c.logLevel<=Wn.WARN){const i=t.map(Jc);$c.warn(`Firestore (${qc}): ${e}`,...i)}}function Jc(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Qc(e="Unexpected state"){const t=`FIRESTORE (${qc}) INTERNAL ASSERTION FAILED: `+e;throw Yc(t),new Error(t)}function eu(e,t){e||Qc()}function tu(e,t){return e}const iu={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class nu extends In{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ru{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class su{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ou{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Wc.UNAUTHENTICATED)))}shutdown(){}}class au{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class lu{constructor(e){this.t=e,this.currentUser=Wc.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let i=this.i;const n=e=>this.i!==i?(i=this.i,t(e)):Promise.resolve();let r=new ru;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new ru,e.enqueueRetryable((()=>n(this.currentUser)))};const s=()=>{const t=r;e.enqueueRetryable((async()=>{await t.promise,await n(this.currentUser)}))},o=e=>{Xc("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Xc("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new ru)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Xc("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(eu("string"==typeof t.accessToken),new su(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return eu(null===e||"string"==typeof e),new Wc(e)}}class cu{constructor(e,t,i){this.l=e,this.h=t,this.P=i,this.type="FirstParty",this.user=Wc.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class uu{constructor(e,t,i){this.l=e,this.h=t,this.P=i}getToken(){return Promise.resolve(new cu(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(Wc.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class hu{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class du{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const i=e=>{null!=e.error&&Xc("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const i=e.token!==this.R;return this.R=e.token,Xc("FirebaseAppCheckTokenProvider",`Received ${i?"new":"existing"} token.`),i?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>i(t)))};const n=e=>{Xc("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>n(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?n(e):Xc("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(eu("string"==typeof e.token),this.R=e.token,new hu(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function pu(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),i=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(i);else for(let t=0;t<e;t++)i[t]=Math.floor(256*Math.random());return i}class fu{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const i=pu(40);for(let n=0;n<i.length;++n)t.length<20&&i[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[n]%62))}return t}}function mu(e,t){return e<t?-1:e>t?1:0}function gu(e,t,i){return e.length===t.length&&e.every(((e,n)=>i(e,t[n])))}class _u{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new nu(iu.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new nu(iu.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new nu(iu.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new nu(iu.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return _u.fromMillis(Date.now())}static fromDate(e){return _u.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new _u(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?mu(this.nanoseconds,e.nanoseconds):mu(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class yu{constructor(e){this.timestamp=e}static fromTimestamp(e){return new yu(e)}static min(){return new yu(new _u(0,0))}static max(){return new yu(new _u(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class vu{constructor(e,t,i){void 0===t?t=0:t>e.length&&Qc(),void 0===i?i=e.length-t:i>e.length-t&&Qc(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return 0===vu.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof vu?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let n=0;n<i;n++){const i=e.get(n),r=t.get(n);if(i<r)return-1;if(i>r)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class xu extends vu{construct(e,t,i){return new xu(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new nu(iu.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter((e=>e.length>0)))}return new xu(t)}static emptyPath(){return new xu([])}}const bu=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class wu extends vu{construct(e,t,i){return new wu(e,t,i)}static isValidIdentifier(e){return bu.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),wu.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new wu(["__name__"])}static fromServerFormat(e){const t=[];let i="",n=0;const r=()=>{if(0===i.length)throw new nu(iu.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let s=!1;for(;n<e.length;){const t=e[n];if("\\"===t){if(n+1===e.length)throw new nu(iu.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new nu(iu.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=t,n+=2}else"`"===t?(s=!s,n++):"."!==t||s?(i+=t,n++):(r(),n++)}if(r(),s)throw new nu(iu.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new wu(t)}static emptyPath(){return new wu([])}}class Su{constructor(e){this.path=e}static fromPath(e){return new Su(xu.fromString(e))}static fromName(e){return new Su(xu.fromString(e).popFirst(5))}static empty(){return new Su(xu.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===xu.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return xu.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Su(new xu(e.slice()))}}function Tu(e){return new Eu(e.readTime,e.key,-1)}class Eu{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new Eu(yu.min(),Su.empty(),-1)}static max(){return new Eu(yu.max(),Su.empty(),-1)}}function Mu(e,t){let i=e.readTime.compareTo(t.readTime);return 0!==i?i:(i=Su.comparator(e.documentKey,t.documentKey),0!==i?i:mu(e.largestBatchId,t.largestBatchId))}const Iu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Au{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Cu(e){if(e.code!==iu.FAILED_PRECONDITION||e.message!==Iu)throw e;Xc("LocalStore","Unexpectedly lost primary lease")}class Pu{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Qc(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Pu(((i,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(i,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(i,n)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Pu?t:Pu.resolve(t)}catch(e){return Pu.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Pu.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Pu.reject(t)}static resolve(e){return new Pu(((t,i)=>{t(e)}))}static reject(e){return new Pu(((t,i)=>{i(e)}))}static waitFor(e){return new Pu(((t,i)=>{let n=0,r=0,s=!1;e.forEach((e=>{++n,e.next((()=>{++r,s&&r===n&&t()}),(e=>i(e)))})),s=!0,r===n&&t()}))}static or(e){let t=Pu.resolve(!1);for(const i of e)t=t.next((e=>e?Pu.resolve(e):i()));return t}static forEach(e,t){const i=[];return e.forEach(((e,n)=>{i.push(t.call(this,e,n))})),this.waitFor(i)}static mapArray(e,t){return new Pu(((i,n)=>{const r=e.length,s=new Array(r);let o=0;for(let a=0;a<r;a++){const l=a;t(e[l]).next((e=>{s[l]=e,++o,o===r&&i(s)}),(e=>n(e)))}}))}static doWhile(e,t){return new Pu(((i,n)=>{const r=()=>{!0===e()?t().next((()=>{r()}),n):i()};r()}))}}function ku(e){return"IndexedDbTransactionError"===e.name}class Ru{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function Lu(e){return null==e}function Du(e){return 0===e&&1/e==-1/0}Ru.oe=-1;function Ou(e){let t=0;for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&t++;return t}function Nu(e,t){for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&t(i,e[i])}function zu(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Fu{constructor(e,t){this.comparator=e,this.root=t||Uu.EMPTY}insert(e,t){return new Fu(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Uu.BLACK,null,null))}remove(e){return new Fu(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Uu.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(0===i)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const n=this.comparator(e,i.key);if(0===n)return t+i.left.size;n<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,i)=>(e(t,i),!1)))}toString(){const e=[];return this.inorderTraversal(((t,i)=>(e.push(`${t}:${i}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Bu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Bu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Bu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Bu(this.root,e,this.comparator,!0)}}class Bu{constructor(e,t,i,n){this.isReverse=n,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?i(e.key,t):1,t&&n&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Uu{constructor(e,t,i,n,r){this.key=e,this.value=t,this.color=null!=i?i:Uu.RED,this.left=null!=n?n:Uu.EMPTY,this.right=null!=r?r:Uu.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,n,r){return new Uu(null!=e?e:this.key,null!=t?t:this.value,null!=i?i:this.color,null!=n?n:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let n=this;const r=i(e,n.key);return n=r<0?n.copy(null,null,null,n.left.insert(e,t,i),null):0===r?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,i)),n.fixUp()}removeMin(){if(this.left.isEmpty())return Uu.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,n=this;if(t(e,n.key)<0)n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return Uu.EMPTY;i=n.right.min(),n=n.copy(i.key,i.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Uu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Uu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Qc();if(this.right.isRed())throw Qc();const e=this.left.check();if(e!==this.right.check())throw Qc();return e+(this.isRed()?0:1)}}Uu.EMPTY=null,Uu.RED=!0,Uu.BLACK=!1,Uu.EMPTY=new class{constructor(){this.size=0}get key(){throw Qc()}get value(){throw Qc()}get color(){throw Qc()}get left(){throw Qc()}get right(){throw Qc()}copy(e,t,i,n,r){return this}insert(e,t,i){return new Uu(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Vu{constructor(e){this.comparator=e,this.data=new Fu(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,i)=>(e(t),!1)))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const n=i.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let i;for(i=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ju(this.data.getIterator())}getIteratorFrom(e){return new ju(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Vu))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=i.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Vu(this.comparator);return t.data=e,t}}class ju{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Gu{constructor(e){this.fields=e,e.sort(wu.comparator)}static empty(){return new Gu([])}unionWith(e){let t=new Vu(wu.comparator);for(const e of this.fields)t=t.add(e);for(const i of e)t=t.add(i);return new Gu(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return gu(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Hu extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Wu{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Hu("Invalid base64 string: "+e):e}}(e);return new Wu(t)}static fromUint8Array(e){const t=function(e){let t="";for(let i=0;i<e.length;++i)t+=String.fromCharCode(e[i]);return t}(e);return new Wu(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return mu(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Wu.EMPTY_BYTE_STRING=new Wu("");const qu=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function $u(e){if(eu(!!e),"string"==typeof e){let t=0;const i=qu.exec(e);if(eu(!!i),i[1]){let e=i[1];e=(e+"000000000").substr(0,9),t=Number(e)}const n=new Date(e);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:Zu(e.seconds),nanos:Zu(e.nanos)}}function Zu(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Xu(e){return"string"==typeof e?Wu.fromBase64String(e):Wu.fromUint8Array(e)}function Yu(e){var t,i;return"server_timestamp"===(null===(i=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===i?void 0:i.stringValue)}function Ku(e){const t=e.mapValue.fields.__previous_value__;return Yu(t)?Ku(t):t}function Ju(e){const t=$u(e.mapValue.fields.__local_write_time__.timestampValue);return new _u(t.seconds,t.nanos)}class Qu{constructor(e,t,i,n,r,s,o,a,l){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=n,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l}}class eh{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new eh("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof eh&&e.projectId===this.projectId&&e.database===this.database}}const th={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function ih(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Yu(e)?4:gh(e)?9007199254740991:10:Qc()}function nh(e,t){if(e===t)return!0;const i=ih(e);if(i!==ih(t))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ju(e).isEqual(Ju(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const i=$u(e.timestampValue),n=$u(t.timestampValue);return i.seconds===n.seconds&&i.nanos===n.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Xu(e.bytesValue).isEqual(Xu(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Zu(e.geoPointValue.latitude)===Zu(t.geoPointValue.latitude)&&Zu(e.geoPointValue.longitude)===Zu(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Zu(e.integerValue)===Zu(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const i=Zu(e.doubleValue),n=Zu(t.doubleValue);return i===n?Du(i)===Du(n):isNaN(i)&&isNaN(n)}return!1}(e,t);case 9:return gu(e.arrayValue.values||[],t.arrayValue.values||[],nh);case 10:return function(e,t){const i=e.mapValue.fields||{},n=t.mapValue.fields||{};if(Ou(i)!==Ou(n))return!1;for(const e in i)if(i.hasOwnProperty(e)&&(void 0===n[e]||!nh(i[e],n[e])))return!1;return!0}(e,t);default:return Qc()}}function rh(e,t){return void 0!==(e.values||[]).find((e=>nh(e,t)))}function sh(e,t){if(e===t)return 0;const i=ih(e),n=ih(t);if(i!==n)return mu(i,n);switch(i){case 0:case 9007199254740991:return 0;case 1:return mu(e.booleanValue,t.booleanValue);case 2:return function(e,t){const i=Zu(e.integerValue||e.doubleValue),n=Zu(t.integerValue||t.doubleValue);return i<n?-1:i>n?1:i===n?0:isNaN(i)?isNaN(n)?0:-1:1}(e,t);case 3:return oh(e.timestampValue,t.timestampValue);case 4:return oh(Ju(e),Ju(t));case 5:return mu(e.stringValue,t.stringValue);case 6:return function(e,t){const i=Xu(e),n=Xu(t);return i.compareTo(n)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const i=e.split("/"),n=t.split("/");for(let e=0;e<i.length&&e<n.length;e++){const t=mu(i[e],n[e]);if(0!==t)return t}return mu(i.length,n.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const i=mu(Zu(e.latitude),Zu(t.latitude));return 0!==i?i:mu(Zu(e.longitude),Zu(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const i=e.values||[],n=t.values||[];for(let e=0;e<i.length&&e<n.length;++e){const t=sh(i[e],n[e]);if(t)return t}return mu(i.length,n.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===th.mapValue&&t===th.mapValue)return 0;if(e===th.mapValue)return 1;if(t===th.mapValue)return-1;const i=e.fields||{},n=Object.keys(i),r=t.fields||{},s=Object.keys(r);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){const t=mu(n[e],s[e]);if(0!==t)return t;const o=sh(i[n[e]],r[s[e]]);if(0!==o)return o}return mu(n.length,s.length)}(e.mapValue,t.mapValue);default:throw Qc()}}function oh(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return mu(e,t);const i=$u(e),n=$u(t),r=mu(i.seconds,n.seconds);return 0!==r?r:mu(i.nanos,n.nanos)}function ah(e){return lh(e)}function lh(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=$u(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Xu(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Su.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",i=!0;for(const n of e.values||[])i?i=!1:t+=",",t+=lh(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let i="{",n=!0;for(const r of t)n?n=!1:i+=",",i+=`${r}:${lh(e.fields[r])}`;return i+"}"}(e.mapValue):Qc()}function ch(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function uh(e){return!!e&&"integerValue"in e}function hh(e){return!!e&&"arrayValue"in e}function dh(e){return!!e&&"nullValue"in e}function ph(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function fh(e){return!!e&&"mapValue"in e}function mh(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Nu(e.mapValue.fields,((e,i)=>t.mapValue.fields[e]=mh(i))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let i=0;i<(e.arrayValue.values||[]).length;++i)t.arrayValue.values[i]=mh(e.arrayValue.values[i]);return t}return Object.assign({},e)}function gh(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class _h{constructor(e){this.value=e}static empty(){return new _h({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!fh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=mh(t)}setAll(e){let t=wu.emptyPath(),i={},n=[];e.forEach(((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,i,n),i={},n=[],t=r.popLast()}e?i[r.lastSegment()]=mh(e):n.push(r.lastSegment())}));const r=this.getFieldsMap(t);this.applyChanges(r,i,n)}delete(e){const t=this.field(e.popLast());fh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return nh(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let n=t.mapValue.fields[e.get(i)];fh(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,i){Nu(t,((t,i)=>e[t]=i));for(const t of i)delete e[t]}clone(){return new _h(mh(this.value))}}class yh{constructor(e,t,i,n,r,s,o){this.key=e,this.documentType=t,this.version=i,this.readTime=n,this.createTime=r,this.data=s,this.documentState=o}static newInvalidDocument(e){return new yh(e,0,yu.min(),yu.min(),yu.min(),_h.empty(),0)}static newFoundDocument(e,t,i,n){return new yh(e,1,t,yu.min(),i,n,0)}static newNoDocument(e,t){return new yh(e,2,t,yu.min(),yu.min(),_h.empty(),0)}static newUnknownDocument(e,t){return new yh(e,3,t,yu.min(),yu.min(),_h.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(yu.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=_h.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=_h.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=yu.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof yh&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new yh(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class vh{constructor(e,t){this.position=e,this.inclusive=t}}function xh(e,t,i){let n=0;for(let r=0;r<e.position.length;r++){const s=t[r],o=e.position[r];if(n=s.field.isKeyField()?Su.comparator(Su.fromName(o.referenceValue),i.key):sh(o,i.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function bh(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let i=0;i<e.position.length;i++)if(!nh(e.position[i],t.position[i]))return!1;return!0}class wh{constructor(e,t="asc"){this.field=e,this.dir=t}}function Sh(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Th{}class Eh extends Th{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,i):new Rh(e,t,i):"array-contains"===t?new Nh(e,i):"in"===t?new zh(e,i):"not-in"===t?new Fh(e,i):"array-contains-any"===t?new Bh(e,i):new Eh(e,t,i)}static createKeyFieldInFilter(e,t,i){return"in"===t?new Lh(e,i):new Dh(e,i)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(sh(t,this.value)):null!==t&&ih(this.value)===ih(t)&&this.matchesComparison(sh(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Qc()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Mh extends Th{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Mh(e,t)}matches(e){return Ih(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ih(e){return"and"===e.op}function Ah(e){return function(e){for(const t of e.filters)if(t instanceof Mh)return!1;return!0}(e)&&Ih(e)}function Ch(e){if(e instanceof Eh)return e.field.canonicalString()+e.op.toString()+ah(e.value);if(Ah(e))return e.filters.map((e=>Ch(e))).join(",");{const t=e.filters.map((e=>Ch(e))).join(",");return`${e.op}(${t})`}}function Ph(e,t){return e instanceof Eh?function(e,t){return t instanceof Eh&&e.op===t.op&&e.field.isEqual(t.field)&&nh(e.value,t.value)}(e,t):e instanceof Mh?function(e,t){return t instanceof Mh&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,i,n)=>e&&Ph(i,t.filters[n])),!0)}(e,t):void Qc()}function kh(e){return e instanceof Eh?function(e){return`${e.field.canonicalString()} ${e.op} ${ah(e.value)}`}(e):e instanceof Mh?function(e){return e.op.toString()+" {"+e.getFilters().map(kh).join(" ,")+"}"}(e):"Filter"}class Rh extends Eh{constructor(e,t,i){super(e,t,i),this.key=Su.fromName(i.referenceValue)}matches(e){const t=Su.comparator(e.key,this.key);return this.matchesComparison(t)}}class Lh extends Eh{constructor(e,t){super(e,"in",t),this.keys=Oh(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Dh extends Eh{constructor(e,t){super(e,"not-in",t),this.keys=Oh(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Oh(e,t){var i;return((null===(i=t.arrayValue)||void 0===i?void 0:i.values)||[]).map((e=>Su.fromName(e.referenceValue)))}class Nh extends Eh{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return hh(t)&&rh(t.arrayValue,this.value)}}class zh extends Eh{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&rh(this.value.arrayValue,t)}}class Fh extends Eh{constructor(e,t){super(e,"not-in",t)}matches(e){if(rh(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!rh(this.value.arrayValue,t)}}class Bh extends Eh{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!hh(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>rh(this.value.arrayValue,e)))}}class Uh{constructor(e,t=null,i=[],n=[],r=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=n,this.limit=r,this.startAt=s,this.endAt=o,this.ue=null}}function Vh(e,t=null,i=[],n=[],r=null,s=null,o=null){return new Uh(e,t,i,n,r,s,o)}function jh(e){const t=tu(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>Ch(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Lu(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>ah(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>ah(e))).join(",")),t.ue=e}return t.ue}function Gh(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(!Sh(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if(!Ph(e.filters[i],t.filters[i]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!bh(e.startAt,t.startAt)&&bh(e.endAt,t.endAt)}function Hh(e){return Su.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Wh{constructor(e,t=null,i=[],n=[],r=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=n,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function qh(e){return new Wh(e)}function $h(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Zh(e){return null!==e.collectionGroup}function Xh(e){const t=tu(e);if(null===t.ce){t.ce=[];const e=new Set;for(const i of t.explicitOrderBy)t.ce.push(i),e.add(i.field.canonicalString());const i=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",n=function(e){let t=new Vu(wu.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);n.forEach((n=>{e.has(n.canonicalString())||n.isKeyField()||t.ce.push(new wh(n,i))})),e.has(wu.keyField().canonicalString())||t.ce.push(new wh(wu.keyField(),i))}return t.ce}function Yh(e){const t=tu(e);return t.le||(t.le=function(e,t){if("F"===e.limitType)return Vh(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new wh(e.field,t)}));const i=e.endAt?new vh(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new vh(e.startAt.position,e.startAt.inclusive):null;return Vh(e.path,e.collectionGroup,t,e.filters,e.limit,i,n)}}(t,Xh(e))),t.le}function Kh(e,t){const i=e.filters.concat([t]);return new Wh(e.path,e.collectionGroup,e.explicitOrderBy.slice(),i,e.limit,e.limitType,e.startAt,e.endAt)}function Jh(e,t,i){return new Wh(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,i,e.startAt,e.endAt)}function Qh(e,t){return Gh(Yh(e),Yh(t))&&e.limitType===t.limitType}function ed(e){return`${jh(Yh(e))}|lt:${e.limitType}`}function td(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>kh(e))).join(", ")}]`),Lu(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>ah(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>ah(e))).join(",")),`Target(${t})`}(Yh(e))}; limitType=${e.limitType})`}function id(e,t){return t.isFoundDocument()&&function(e,t){const i=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(i):Su.isDocumentKey(e.path)?e.path.isEqual(i):e.path.isImmediateParentOf(i)}(e,t)&&function(e,t){for(const i of Xh(e))if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1;return!0}(e,t)&&function(e,t){for(const i of e.filters)if(!i.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,i){const n=xh(e,t,i);return e.inclusive?n<=0:n<0}(e.startAt,Xh(e),t)||e.endAt&&!function(e,t,i){const n=xh(e,t,i);return e.inclusive?n>=0:n>0}(e.endAt,Xh(e),t))}(e,t)}function nd(e){return(t,i)=>{let n=!1;for(const r of Xh(e)){const e=rd(r,t,i);if(0!==e)return e;n=n||r.field.isKeyField()}return 0}}function rd(e,t,i){const n=e.field.isKeyField()?Su.comparator(t.key,i.key):function(e,t,i){const n=t.data.field(e),r=i.data.field(e);return null!==n&&null!==r?sh(n,r):Qc()}(e.field,t,i);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return Qc()}}class sd{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(void 0!==i)for(const[t,n]of i)if(this.equalsFn(t,e))return n}has(e){return void 0!==this.get(e)}set(e,t){const i=this.mapKeyFn(e),n=this.inner[i];if(void 0===n)return this.inner[i]=[[e,t]],void this.innerSize++;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return void(n[i]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(void 0===i)return!1;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return 1===i.length?delete this.inner[t]:i.splice(n,1),this.innerSize--,!0;return!1}forEach(e){Nu(this.inner,((t,i)=>{for(const[t,n]of i)e(t,n)}))}isEmpty(){return zu(this.inner)}size(){return this.innerSize}}const od=new Fu(Su.comparator);function ad(){return od}const ld=new Fu(Su.comparator);function cd(...e){let t=ld;for(const i of e)t=t.insert(i.key,i);return t}function ud(e){let t=ld;return e.forEach(((e,i)=>t=t.insert(e,i.overlayedDocument))),t}function hd(){return pd()}function dd(){return pd()}function pd(){return new sd((e=>e.toString()),((e,t)=>e.isEqual(t)))}new Fu(Su.comparator);const fd=new Vu(Su.comparator);function md(...e){let t=fd;for(const i of e)t=t.add(i);return t}const gd=new Vu(mu);function _d(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Du(t)?"-0":t}}function yd(e){return{integerValue:""+e}}function vd(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Du(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?yd(t):_d(e,t)}class xd{constructor(){this._=void 0}}function bd(e,t,i){return e instanceof Sd?function(e,t){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Yu(t)&&(t=Ku(t)),t&&(i.fields.__previous_value__=t),{mapValue:i}}(i,t):e instanceof Td?Ed(e,t):e instanceof Md?Id(e,t):function(e,t){const i=function(e,t){return e instanceof Ad?function(e){return uh(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}(e,t),n=Cd(i)+Cd(e.Pe);return uh(i)&&uh(e.Pe)?yd(n):_d(e.serializer,n)}(e,t)}function wd(e,t,i){return e instanceof Td?Ed(e,t):e instanceof Md?Id(e,t):i}class Sd extends xd{}class Td extends xd{constructor(e){super(),this.elements=e}}function Ed(e,t){const i=Pd(t);for(const t of e.elements)i.some((e=>nh(e,t)))||i.push(t);return{arrayValue:{values:i}}}class Md extends xd{constructor(e){super(),this.elements=e}}function Id(e,t){let i=Pd(t);for(const t of e.elements)i=i.filter((e=>!nh(e,t)));return{arrayValue:{values:i}}}class Ad extends xd{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Cd(e){return Zu(e.integerValue||e.doubleValue)}function Pd(e){return hh(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class kd{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new kd}static exists(e){return new kd(void 0,e)}static updateTime(e){return new kd(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Rd(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Ld{}function Dd(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Gd(e.key,kd.none()):new Fd(e.key,e.data,kd.none());{const i=e.data,n=_h.empty();let r=new Vu(wu.comparator);for(let e of t.fields)if(!r.has(e)){let t=i.field(e);null===t&&e.length>1&&(e=e.popLast(),t=i.field(e)),null===t?n.delete(e):n.set(e,t),r=r.add(e)}return new Bd(e.key,n,new Gu(r.toArray()),kd.none())}}function Od(e,t,i){e instanceof Fd?function(e,t,i){const n=e.value.clone(),r=Vd(e.fieldTransforms,t,i.transformResults);n.setAll(r),t.convertToFoundDocument(i.version,n).setHasCommittedMutations()}(e,t,i):e instanceof Bd?function(e,t,i){if(!Rd(e.precondition,t))return void t.convertToUnknownDocument(i.version);const n=Vd(e.fieldTransforms,t,i.transformResults),r=t.data;r.setAll(Ud(e)),r.setAll(n),t.convertToFoundDocument(i.version,r).setHasCommittedMutations()}(e,t,i):function(e,t,i){t.convertToNoDocument(i.version).setHasCommittedMutations()}(0,t,i)}function Nd(e,t,i,n){return e instanceof Fd?function(e,t,i,n){if(!Rd(e.precondition,t))return i;const r=e.value.clone(),s=jd(e.fieldTransforms,n,t);return r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,i,n):e instanceof Bd?function(e,t,i,n){if(!Rd(e.precondition,t))return i;const r=jd(e.fieldTransforms,n,t),s=t.data;return s.setAll(Ud(e)),s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===i?null:i.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,i,n):function(e,t,i){return Rd(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):i}(e,t,i)}function zd(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&gu(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Td&&t instanceof Td||e instanceof Md&&t instanceof Md?gu(e.elements,t.elements,nh):e instanceof Ad&&t instanceof Ad?nh(e.Pe,t.Pe):e instanceof Sd&&t instanceof Sd}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Fd extends Ld{constructor(e,t,i,n=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class Bd extends Ld{constructor(e,t,i,n,r=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=n,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Ud(e){const t=new Map;return e.fieldMask.fields.forEach((i=>{if(!i.isEmpty()){const n=e.data.field(i);t.set(i,n)}})),t}function Vd(e,t,i){const n=new Map;eu(e.length===i.length);for(let r=0;r<i.length;r++){const s=e[r],o=s.transform,a=t.data.field(s.field);n.set(s.field,wd(o,a,i[r]))}return n}function jd(e,t,i){const n=new Map;for(const r of e){const e=r.transform,s=i.data.field(r.field);n.set(r.field,bd(e,s,t))}return n}class Gd extends Ld{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Hd{constructor(e,t,i,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=n}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const n=this.mutations[t];n.key.isEqual(e.key)&&Od(n,e,i[t])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Nd(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Nd(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=dd();return this.mutations.forEach((n=>{const r=e.get(n.key),s=r.overlayedDocument;let o=this.applyToLocalView(s,r.mutatedFields);o=t.has(n.key)?null:o;const a=Dd(s,o);null!==a&&i.set(n.key,a),s.isValidDocument()||s.convertToNoDocument(yu.min())})),i}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),md())}isEqual(e){return this.batchId===e.batchId&&gu(this.mutations,e.mutations,((e,t)=>zd(e,t)))&&gu(this.baseMutations,e.baseMutations,((e,t)=>zd(e,t)))}}class Wd{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class qd{constructor(e,t){this.count=e,this.unchangedNames=t}}var $d,Zd;function Xd(e){if(void 0===e)return Yc("GRPC error has no .code"),iu.UNKNOWN;switch(e){case $d.OK:return iu.OK;case $d.CANCELLED:return iu.CANCELLED;case $d.UNKNOWN:return iu.UNKNOWN;case $d.DEADLINE_EXCEEDED:return iu.DEADLINE_EXCEEDED;case $d.RESOURCE_EXHAUSTED:return iu.RESOURCE_EXHAUSTED;case $d.INTERNAL:return iu.INTERNAL;case $d.UNAVAILABLE:return iu.UNAVAILABLE;case $d.UNAUTHENTICATED:return iu.UNAUTHENTICATED;case $d.INVALID_ARGUMENT:return iu.INVALID_ARGUMENT;case $d.NOT_FOUND:return iu.NOT_FOUND;case $d.ALREADY_EXISTS:return iu.ALREADY_EXISTS;case $d.PERMISSION_DENIED:return iu.PERMISSION_DENIED;case $d.FAILED_PRECONDITION:return iu.FAILED_PRECONDITION;case $d.ABORTED:return iu.ABORTED;case $d.OUT_OF_RANGE:return iu.OUT_OF_RANGE;case $d.UNIMPLEMENTED:return iu.UNIMPLEMENTED;case $d.DATA_LOSS:return iu.DATA_LOSS;default:return Qc()}}(Zd=$d||($d={}))[Zd.OK=0]="OK",Zd[Zd.CANCELLED=1]="CANCELLED",Zd[Zd.UNKNOWN=2]="UNKNOWN",Zd[Zd.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Zd[Zd.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Zd[Zd.NOT_FOUND=5]="NOT_FOUND",Zd[Zd.ALREADY_EXISTS=6]="ALREADY_EXISTS",Zd[Zd.PERMISSION_DENIED=7]="PERMISSION_DENIED",Zd[Zd.UNAUTHENTICATED=16]="UNAUTHENTICATED",Zd[Zd.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Zd[Zd.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Zd[Zd.ABORTED=10]="ABORTED",Zd[Zd.OUT_OF_RANGE=11]="OUT_OF_RANGE",Zd[Zd.UNIMPLEMENTED=12]="UNIMPLEMENTED",Zd[Zd.INTERNAL=13]="INTERNAL",Zd[Zd.UNAVAILABLE=14]="UNAVAILABLE",Zd[Zd.DATA_LOSS=15]="DATA_LOSS";const Yd=new Gc([4294967295,4294967295],0);function Kd(e){const t=(new TextEncoder).encode(e),i=new jc;return i.update(t),new Uint8Array(i.digest())}function Jd(e){const t=new DataView(e.buffer),i=t.getUint32(0,!0),n=t.getUint32(4,!0),r=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Gc([i,n],0),new Gc([r,s],0)]}class Qd{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new ep(`Invalid padding: ${t}`);if(i<0)throw new ep(`Invalid hash count: ${i}`);if(e.length>0&&0===this.hashCount)throw new ep(`Invalid hash count: ${i}`);if(0===e.length&&0!==t)throw new ep(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Gc.fromNumber(this.Ie)}Ee(e,t,i){let n=e.add(t.multiply(Gc.fromNumber(i)));return 1===n.compare(Yd)&&(n=new Gc([n.getBits(0),n.getBits(1)],0)),n.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=Kd(e),[i,n]=Jd(t);for(let e=0;e<this.hashCount;e++){const t=this.Ee(i,n,e);if(!this.de(t))return!1}return!0}static create(e,t,i){const n=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),s=new Qd(r,n,t);return i.forEach((e=>s.insert(e))),s}insert(e){if(0===this.Ie)return;const t=Kd(e),[i,n]=Jd(t);for(let e=0;e<this.hashCount;e++){const t=this.Ee(i,n,e);this.Ae(t)}}Ae(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class ep extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class tp{constructor(e,t,i,n,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=n,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const n=new Map;return n.set(e,ip.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new tp(yu.min(),n,new Fu(mu),ad(),md())}}class ip{constructor(e,t,i,n,r){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=n,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new ip(i,t,md(),md(),md())}}class np{constructor(e,t,i,n){this.Re=e,this.removedTargetIds=t,this.key=i,this.Ve=n}}class rp{constructor(e,t){this.targetId=e,this.me=t}}class sp{constructor(e,t,i=Wu.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=n}}class op{constructor(){this.fe=0,this.ge=cp(),this.pe=Wu.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=md(),t=md(),i=md();return this.ge.forEach(((n,r)=>{switch(r){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:i=i.add(n);break;default:Qc()}})),new ip(this.pe,this.ye,e,t,i)}ve(){this.we=!1,this.ge=cp()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,eu(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class ap{constructor(e){this.Le=e,this.Be=new Map,this.ke=ad(),this.qe=lp(),this.Qe=new Fu(mu)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,(t=>{const i=this.Ge(t);switch(e.state){case 0:this.ze(t)&&i.De(e.resumeToken);break;case 1:i.Oe(),i.Se||i.ve(),i.De(e.resumeToken);break;case 2:i.Oe(),i.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(i.Ne(),i.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),i.De(e.resumeToken));break;default:Qc()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach(((e,i)=>{this.ze(i)&&t(i)}))}He(e){const t=e.targetId,i=e.me.count,n=this.Je(t);if(n){const r=n.target;if(Hh(r))if(0===i){const e=new Su(r.path);this.Ue(t,e,yh.newNoDocument(e,yu.min()))}else eu(1===i);else{const n=this.Ye(t);if(n!==i){const i=this.Ze(e),r=i?this.Xe(i,e,n):1;if(0!==r){this.je(t);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:n=0},hashCount:r=0}=t;let s,o;try{s=Xu(i).toUint8Array()}catch(e){if(e instanceof Hu)return Kc("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new Qd(s,n,r)}catch(e){return Kc(e instanceof ep?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Ie?null:o}Xe(e,t,i){return t.me.count===i-this.nt(e,t.targetId)?0:2}nt(e,t){const i=this.Le.getRemoteKeysForTarget(t);let n=0;return i.forEach((i=>{const r=this.Le.tt(),s=`projects/${r.projectId}/databases/${r.database}/documents/${i.path.canonicalString()}`;e.mightContain(s)||(this.Ue(t,i,null),n++)})),n}rt(e){const t=new Map;this.Be.forEach(((i,n)=>{const r=this.Je(n);if(r){if(i.current&&Hh(r.target)){const t=new Su(r.target.path);null!==this.ke.get(t)||this.it(n,t)||this.Ue(n,t,yh.newNoDocument(t,e))}i.be&&(t.set(n,i.Ce()),i.ve())}}));let i=md();this.qe.forEach(((e,t)=>{let n=!0;t.forEachWhile((e=>{const t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)})),n&&(i=i.add(e))})),this.ke.forEach(((t,i)=>i.setReadTime(e)));const n=new tp(e,t,this.Qe,this.ke,i);return this.ke=ad(),this.qe=lp(),this.Qe=new Fu(mu),n}$e(e,t){if(!this.ze(e))return;const i=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,i),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,i){if(!this.ze(e))return;const n=this.Ge(e);this.it(e,t)?n.Fe(t,1):n.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),i&&(this.ke=this.ke.insert(t,i))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new op,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Vu(mu),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||Xc("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new op),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.Ue(e,t,null)}))}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function lp(){return new Fu(Su.comparator)}function cp(){return new Fu(Su.comparator)}const up={asc:"ASCENDING",desc:"DESCENDING"},hp={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},dp={and:"AND",or:"OR"};class pp{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function fp(e,t){return e.useProto3Json||Lu(t)?t:{value:t}}function mp(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function gp(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function _p(e){return eu(!!e),yu.fromTimestamp(function(e){const t=$u(e);return new _u(t.seconds,t.nanos)}(e))}function yp(e,t){return vp(e,t).canonicalString()}function vp(e,t){const i=function(e){return new xu(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?i:i.child(t)}function xp(e){const t=xu.fromString(e);return eu(Op(t)),t}function bp(e,t){const i=xp(t);if(i.get(1)!==e.databaseId.projectId)throw new nu(iu.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+e.databaseId.projectId);if(i.get(3)!==e.databaseId.database)throw new nu(iu.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+e.databaseId.database);return new Su(Tp(i))}function wp(e,t){return yp(e.databaseId,t)}function Sp(e){return new xu(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Tp(e){return eu(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Ep(e,t){return{documents:[wp(e,t.path)]}}function Mp(e,t){const i={structuredQuery:{}},n=t.path;let r;null!==t.collectionGroup?(r=n,i.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=n.popLast(),i.structuredQuery.from=[{collectionId:n.lastSegment()}]),i.parent=wp(e,r);const s=function(e){if(0!==e.length)return Dp(Mh.create(e,"and"))}(t.filters);s&&(i.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Rp(e.field),direction:Cp(e.dir)}}(e)))}(t.orderBy);o&&(i.structuredQuery.orderBy=o);const a=fp(e,t.limit);return null!==a&&(i.structuredQuery.limit=a),t.startAt&&(i.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(i.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:i,parent:r}}function Ip(e){let t=function(e){const t=xp(e);return 4===t.length?xu.emptyPath():Tp(t)}(e.parent);const i=e.structuredQuery,n=i.from?i.from.length:0;let r=null;if(n>0){eu(1===n);const e=i.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let s=[];i.where&&(s=function(e){const t=Ap(e);return t instanceof Mh&&Ah(t)?t.getFilters():[t]}(i.where));let o=[];i.orderBy&&(o=function(e){return e.map((e=>function(e){return new wh(Lp(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(i.orderBy));let a=null;i.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Lu(t)?null:t}(i.limit));let l=null;i.startAt&&(l=function(e){const t=!!e.before,i=e.values||[];return new vh(i,t)}(i.startAt));let c=null;return i.endAt&&(c=function(e){const t=!e.before,i=e.values||[];return new vh(i,t)}(i.endAt)),function(e,t,i,n,r,s,o,a){return new Wh(e,t,i,n,r,s,o,a)}(t,r,o,s,a,"F",l,c)}function Ap(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Lp(e.unaryFilter.field);return Eh.create(t,"==",{doubleValue:NaN});case"IS_NULL":const i=Lp(e.unaryFilter.field);return Eh.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const n=Lp(e.unaryFilter.field);return Eh.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Lp(e.unaryFilter.field);return Eh.create(r,"!=",{nullValue:"NULL_VALUE"});default:return Qc()}}(e):void 0!==e.fieldFilter?function(e){return Eh.create(Lp(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Qc()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Mh.create(e.compositeFilter.filters.map((e=>Ap(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Qc()}}(e.compositeFilter.op))}(e):Qc()}function Cp(e){return up[e]}function Pp(e){return hp[e]}function kp(e){return dp[e]}function Rp(e){return{fieldPath:e.canonicalString()}}function Lp(e){return wu.fromServerFormat(e.fieldPath)}function Dp(e){return e instanceof Eh?function(e){if("=="===e.op){if(ph(e.value))return{unaryFilter:{field:Rp(e.field),op:"IS_NAN"}};if(dh(e.value))return{unaryFilter:{field:Rp(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ph(e.value))return{unaryFilter:{field:Rp(e.field),op:"IS_NOT_NAN"}};if(dh(e.value))return{unaryFilter:{field:Rp(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Rp(e.field),op:Pp(e.op),value:e.value}}}(e):e instanceof Mh?function(e){const t=e.getFilters().map((e=>Dp(e)));return 1===t.length?t[0]:{compositeFilter:{op:kp(e.op),filters:t}}}(e):Qc()}function Op(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Np{constructor(e,t,i,n,r=yu.min(),s=yu.min(),o=Wu.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=n,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Np(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Np(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Np(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Np(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class zp{constructor(e){this.ut=e}}function Fp(e){const t=Ip({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Jh(t,t.limit,"L"):t}class Bp{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(Zu(e.integerValue));else if("doubleValue"in e){const i=Zu(e.doubleValue);isNaN(i)?this.Tt(t,13):(this.Tt(t,15),Du(i)?t.Et(0):t.Et(i))}else if("timestampValue"in e){let i=e.timestampValue;this.Tt(t,20),"string"==typeof i&&(i=$u(i)),t.dt(`${i.seconds||""}`),t.Et(i.nanos||0)}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt(Xu(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){const i=e.geoPointValue;this.Tt(t,45),t.Et(i.latitude||0),t.Et(i.longitude||0)}else"mapValue"in e?gh(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):Qc()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){const i=e.fields||{};this.Tt(t,55);for(const e of Object.keys(i))this.At(e,t),this.Pt(i[e],t)}yt(e,t){const i=e.values||[];this.Tt(t,50);for(const e of i)this.Pt(e,t)}ft(e,t){this.Tt(t,37),Su.fromName(e).path.forEach((e=>{this.Tt(t,60),this.wt(e,t)}))}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}}Bp.St=new Bp;class Up{constructor(){this.on=new Vp}addToCollectionParentIndex(e,t){return this.on.add(t),Pu.resolve()}getCollectionParents(e,t){return Pu.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return Pu.resolve()}deleteFieldIndex(e,t){return Pu.resolve()}deleteAllFieldIndexes(e){return Pu.resolve()}createTargetIndexes(e,t){return Pu.resolve()}getDocumentsMatchingTarget(e,t){return Pu.resolve(null)}getIndexType(e,t){return Pu.resolve(0)}getFieldIndexes(e,t){return Pu.resolve([])}getNextCollectionGroupToUpdate(e){return Pu.resolve(null)}getMinOffset(e,t){return Pu.resolve(Eu.min())}getMinOffsetFromCollectionGroup(e,t){return Pu.resolve(Eu.min())}updateCollectionGroup(e,t,i){return Pu.resolve()}updateIndexEntries(e,t){return Pu.resolve()}}class Vp{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),n=this.index[t]||new Vu(xu.comparator),r=!n.has(i);return this.index[t]=n.add(i),r}has(e){const t=e.lastSegment(),i=e.popLast(),n=this.index[t];return n&&n.has(i)}getEntries(e){return(this.index[e]||new Vu(xu.comparator)).toArray()}}new Uint8Array(0);class jp{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new jp(e,jp.DEFAULT_COLLECTION_PERCENTILE,jp.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}jp.DEFAULT_COLLECTION_PERCENTILE=10,jp.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,jp.DEFAULT=new jp(41943040,jp.DEFAULT_COLLECTION_PERCENTILE,jp.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),jp.DISABLED=new jp(-1,0,0);class Gp{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new Gp(0)}static Nn(){return new Gp(-1)}}class Hp{constructor(){this.changes=new sd((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,yh.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return void 0!==i?Pu.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Wp{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class qp{constructor(e,t,i,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=n}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next((n=>(i=n,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==i&&Nd(i.mutation,e,Gu.empty(),_u.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,md()).next((()=>t))))}getLocalViewOfDocuments(e,t,i=md()){const n=hd();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,i).next((e=>{let t=cd();return e.forEach(((e,i)=>{t=t.insert(e,i.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const i=hd();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,md())))}populateOverlays(e,t,i){const n=[];return i.forEach((e=>{t.has(e)||n.push(e)})),this.documentOverlayCache.getOverlays(e,n).next((e=>{e.forEach(((e,i)=>{t.set(e,i)}))}))}computeViews(e,t,i,n){let r=ad();const s=pd(),o=pd();return t.forEach(((e,t)=>{const o=i.get(t.key);n.has(t.key)&&(void 0===o||o.mutation instanceof Bd)?r=r.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Nd(o.mutation,t,o.mutation.getFieldMask(),_u.now())):s.set(t.key,Gu.empty())})),this.recalculateAndSaveOverlays(e,r).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var i;return o.set(e,new Wp(t,null!==(i=s.get(e))&&void 0!==i?i:null))})),o)))}recalculateAndSaveOverlays(e,t){const i=pd();let n=new Fu(((e,t)=>e-t)),r=md();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const r of e)r.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=i.get(e)||Gu.empty();o=r.applyToLocalView(s,o),i.set(e,o);const a=(n.get(r.batchId)||md()).add(e);n=n.insert(r.batchId,a)}))})).next((()=>{const s=[],o=n.getReverseIterator();for(;o.hasNext();){const n=o.getNext(),a=n.key,l=n.value,c=dd();l.forEach((e=>{if(!r.has(e)){const n=Dd(t.get(e),i.get(e));null!==n&&c.set(e,n),r=r.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,c))}return Pu.waitFor(s)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,i,n){return function(e){return Su.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Zh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,n):this.getDocumentsMatchingCollectionQuery(e,t,i,n)}getNextDocuments(e,t,i,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,n).next((r=>{const s=n-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,n-r.size):Pu.resolve(hd());let o=-1,a=r;return s.next((t=>Pu.forEach(t,((t,i)=>(o<i.largestBatchId&&(o=i.largestBatchId),r.get(t)?Pu.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,r))).next((()=>this.computeViews(e,a,t,md()))).next((e=>({batchId:o,changes:ud(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Su(t)).next((e=>{let t=cd();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,i,n){const r=t.collectionGroup;let s=cd();return this.indexManager.getCollectionParents(e,r).next((o=>Pu.forEach(o,(o=>{const a=function(e,t){return new Wh(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(r));return this.getDocumentsMatchingCollectionQuery(e,a,i,n).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,i,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next((s=>(r=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,r,n)))).next((e=>{r.forEach(((t,i)=>{const n=i.getKey();null===e.get(n)&&(e=e.insert(n,yh.newInvalidDocument(n)))}));let i=cd();return e.forEach(((e,n)=>{const s=r.get(e);void 0!==s&&Nd(s.mutation,n,Gu.empty(),_u.now()),id(t,n)&&(i=i.insert(e,n))})),i}))}}class $p{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return Pu.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,function(e){return{id:e.id,version:e.version,createTime:_p(e.createTime)}}(t)),Pu.resolve()}getNamedQuery(e,t){return Pu.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,function(e){return{name:e.name,query:Fp(e.bundledQuery),readTime:_p(e.readTime)}}(t)),Pu.resolve()}}class Zp{constructor(){this.overlays=new Fu(Su.comparator),this.lr=new Map}getOverlay(e,t){return Pu.resolve(this.overlays.get(t))}getOverlays(e,t){const i=hd();return Pu.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&i.set(t,e)})))).next((()=>i))}saveOverlays(e,t,i){return i.forEach(((i,n)=>{this.lt(e,t,n)})),Pu.resolve()}removeOverlaysForBatchId(e,t,i){const n=this.lr.get(i);return void 0!==n&&(n.forEach((e=>this.overlays=this.overlays.remove(e))),this.lr.delete(i)),Pu.resolve()}getOverlaysForCollection(e,t,i){const n=hd(),r=t.length+1,s=new Su(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===r&&e.largestBatchId>i&&n.set(e.getKey(),e)}return Pu.resolve(n)}getOverlaysForCollectionGroup(e,t,i,n){let r=new Fu(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>i){let t=r.get(e.largestBatchId);null===t&&(t=hd(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=hd(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=n)););return Pu.resolve(o)}lt(e,t,i){const n=this.overlays.get(i.key);if(null!==n){const e=this.lr.get(n.largestBatchId).delete(i.key);this.lr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(i.key,new Wd(t,i));let r=this.lr.get(t);void 0===r&&(r=md(),this.lr.set(t,r)),this.lr.set(t,r.add(i.key))}}class Xp{constructor(){this.hr=new Vu(Yp.Pr),this.Ir=new Vu(Yp.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){const i=new Yp(e,t);this.hr=this.hr.add(i),this.Ir=this.Ir.add(i)}Er(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.dr(new Yp(e,t))}Ar(e,t){e.forEach((e=>this.removeReference(e,t)))}Rr(e){const t=new Su(new xu([])),i=new Yp(t,e),n=new Yp(t,e+1),r=[];return this.Ir.forEachInRange([i,n],(e=>{this.dr(e),r.push(e.key)})),r}Vr(){this.hr.forEach((e=>this.dr(e)))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const t=new Su(new xu([])),i=new Yp(t,e),n=new Yp(t,e+1);let r=md();return this.Ir.forEachInRange([i,n],(e=>{r=r.add(e.key)})),r}containsKey(e){const t=new Yp(e,0),i=this.hr.firstAfterOrEqual(t);return null!==i&&e.isEqual(i.key)}}class Yp{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return Su.comparator(e.key,t.key)||mu(e.gr,t.gr)}static Tr(e,t){return mu(e.gr,t.gr)||Su.comparator(e.key,t.key)}}class Kp{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new Vu(Yp.Pr)}checkEmpty(e){return Pu.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,i,n){const r=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Hd(r,t,i,n);this.mutationQueue.push(s);for(const t of n)this.yr=this.yr.add(new Yp(t.key,r)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Pu.resolve(s)}lookupMutationBatch(e,t){return Pu.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,n=this.Sr(i),r=n<0?0:n;return Pu.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return Pu.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(e){return Pu.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new Yp(t,0),n=new Yp(t,Number.POSITIVE_INFINITY),r=[];return this.yr.forEachInRange([i,n],(e=>{const t=this.wr(e.gr);r.push(t)})),Pu.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Vu(mu);return t.forEach((e=>{const t=new Yp(e,0),n=new Yp(e,Number.POSITIVE_INFINITY);this.yr.forEachInRange([t,n],(e=>{i=i.add(e.gr)}))})),Pu.resolve(this.br(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,n=i.length+1;let r=i;Su.isDocumentKey(r)||(r=r.child(""));const s=new Yp(new Su(r),0);let o=new Vu(mu);return this.yr.forEachWhile((e=>{const t=e.key.path;return!!i.isPrefixOf(t)&&(t.length===n&&(o=o.add(e.gr)),!0)}),s),Pu.resolve(this.br(o))}br(e){const t=[];return e.forEach((e=>{const i=this.wr(e);null!==i&&t.push(i)})),t}removeMutationBatch(e,t){eu(0===this.Dr(t.batchId,"removed")),this.mutationQueue.shift();let i=this.yr;return Pu.forEach(t.mutations,(n=>{const r=new Yp(n.key,t.batchId);return i=i.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)})).next((()=>{this.yr=i}))}Fn(e){}containsKey(e,t){const i=new Yp(t,0),n=this.yr.firstAfterOrEqual(i);return Pu.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,Pu.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}wr(e){const t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Jp{constructor(e){this.Cr=e,this.docs=new Fu(Su.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,n=this.docs.get(i),r=n?n.size:0,s=this.Cr(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return Pu.resolve(i?i.document.mutableCopy():yh.newInvalidDocument(t))}getEntries(e,t){let i=ad();return t.forEach((e=>{const t=this.docs.get(e);i=i.insert(e,t?t.document.mutableCopy():yh.newInvalidDocument(e))})),Pu.resolve(i)}getDocumentsMatchingQuery(e,t,i,n){let r=ad();const s=t.path,o=new Su(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||Mu(Tu(o),i)<=0||(n.has(o.key)||id(t,o))&&(r=r.insert(o.key,o.mutableCopy()))}return Pu.resolve(r)}getAllFromCollectionGroup(e,t,i,n){Qc()}vr(e,t){return Pu.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Qp(this)}getSize(e){return Pu.resolve(this.size)}}class Qp extends Hp{constructor(e){super(),this._r=e}applyChanges(e){const t=[];return this.changes.forEach(((i,n)=>{n.isValidDocument()?t.push(this._r.addEntry(e,n)):this._r.removeEntry(i)})),Pu.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}class ef{constructor(e){this.persistence=e,this.Fr=new sd((e=>jh(e)),Gh),this.lastRemoteSnapshotVersion=yu.min(),this.highestTargetId=0,this.Mr=0,this.Or=new Xp,this.targetCount=0,this.Nr=Gp.On()}forEachTarget(e,t){return this.Fr.forEach(((e,i)=>t(i))),Pu.resolve()}getLastRemoteSnapshotVersion(e){return Pu.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Pu.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),Pu.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.Mr&&(this.Mr=t),Pu.resolve()}kn(e){this.Fr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Nr=new Gp(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,Pu.resolve()}updateTargetData(e,t){return this.kn(t),Pu.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,Pu.resolve()}removeTargets(e,t,i){let n=0;const r=[];return this.Fr.forEach(((s,o)=>{o.sequenceNumber<=t&&null===i.get(o.targetId)&&(this.Fr.delete(s),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),n++)})),Pu.waitFor(r).next((()=>n))}getTargetCount(e){return Pu.resolve(this.targetCount)}getTargetData(e,t){const i=this.Fr.get(t)||null;return Pu.resolve(i)}addMatchingKeys(e,t,i){return this.Or.Er(t,i),Pu.resolve()}removeMatchingKeys(e,t,i){this.Or.Ar(t,i);const n=this.persistence.referenceDelegate,r=[];return n&&t.forEach((t=>{r.push(n.markPotentiallyOrphaned(e,t))})),Pu.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),Pu.resolve()}getMatchingKeysForTargetId(e,t){const i=this.Or.mr(t);return Pu.resolve(i)}containsKey(e,t){return Pu.resolve(this.Or.containsKey(t))}}class tf{constructor(e,t){this.Lr={},this.overlays={},this.Br=new Ru(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new ef(this),this.indexManager=new Up,this.remoteDocumentCache=function(e){return new Jp(e)}((e=>this.referenceDelegate.Qr(e))),this.serializer=new zp(t),this.Kr=new $p(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Zp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.Lr[e.toKey()];return i||(i=new Kp(t,this.referenceDelegate),this.Lr[e.toKey()]=i),i}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,i){Xc("MemoryPersistence","Starting transaction:",e);const n=new nf(this.Br.next());return this.referenceDelegate.$r(),i(n).next((e=>this.referenceDelegate.Ur(n).next((()=>e)))).toPromise().then((e=>(n.raiseOnCommittedEvent(),e)))}Wr(e,t){return Pu.or(Object.values(this.Lr).map((i=>()=>i.containsKey(e,t))))}}class nf extends Au{constructor(e){super(),this.currentSequenceNumber=e}}class rf{constructor(e){this.persistence=e,this.Gr=new Xp,this.zr=null}static jr(e){return new rf(e)}get Hr(){if(this.zr)return this.zr;throw Qc()}addReference(e,t,i){return this.Gr.addReference(i,t),this.Hr.delete(i.toString()),Pu.resolve()}removeReference(e,t,i){return this.Gr.removeReference(i,t),this.Hr.add(i.toString()),Pu.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),Pu.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach((e=>this.Hr.add(e.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Hr.add(e.toString())))})).next((()=>i.removeTargetData(e,t)))}$r(){this.zr=new Set}Ur(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Pu.forEach(this.Hr,(i=>{const n=Su.fromPath(i);return this.Jr(e,n).next((e=>{e||t.removeEntry(n,yu.min())}))})).next((()=>(this.zr=null,t.apply(e))))}updateLimboDocument(e,t){return this.Jr(e,t).next((e=>{e?this.Hr.delete(t.toString()):this.Hr.add(t.toString())}))}Qr(e){return 0}Jr(e,t){return Pu.or([()=>Pu.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}class sf{constructor(e,t,i,n){this.targetId=e,this.fromCache=t,this.ki=i,this.qi=n}static Qi(e,t){let i=md(),n=md();for(const e of t.docChanges)switch(e.type){case 0:i=i.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new sf(e,t.fromCache,i,n)}}class of{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class af{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=!bn()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(e){const t=e.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}(xn())>0?6:4}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,i,n){const r={result:null};return this.zi(e,t).next((e=>{r.result=e})).next((()=>{if(!r.result)return this.ji(e,t,n,i).next((e=>{r.result=e}))})).next((()=>{if(r.result)return;const i=new of;return this.Hi(e,t,i).next((n=>{if(r.result=n,this.$i)return this.Ji(e,t,i,n.size)}))})).next((()=>r.result))}Ji(e,t,i,n){return i.documentReadCount<this.Ui?(Zc()<=Wn.DEBUG&&Xc("QueryEngine","SDK will not create cache indexes for query:",td(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),Pu.resolve()):(Zc()<=Wn.DEBUG&&Xc("QueryEngine","Query:",td(t),"scans",i.documentReadCount,"local documents and returns",n,"documents as results."),i.documentReadCount>this.Wi*n?(Zc()<=Wn.DEBUG&&Xc("QueryEngine","The SDK decides to create cache indexes for query:",td(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Yh(t))):Pu.resolve())}zi(e,t){if($h(t))return Pu.resolve(null);let i=Yh(t);return this.indexManager.getIndexType(e,i).next((n=>0===n?null:(null!==t.limit&&1===n&&(t=Jh(t,null,"F"),i=Yh(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next((n=>{const r=md(...n);return this.Gi.getDocuments(e,r).next((n=>this.indexManager.getMinOffset(e,i).next((i=>{const s=this.Yi(t,n);return this.Zi(t,s,r,i.readTime)?this.zi(e,Jh(t,null,"F")):this.Xi(e,s,t,i)}))))})))))}ji(e,t,i,n){return $h(t)||n.isEqual(yu.min())?Pu.resolve(null):this.Gi.getDocuments(e,i).next((r=>{const s=this.Yi(t,r);return this.Zi(t,s,i,n)?Pu.resolve(null):(Zc()<=Wn.DEBUG&&Xc("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),td(t)),this.Xi(e,s,t,function(e,t){const i=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1,r=yu.fromTimestamp(1e9===n?new _u(i+1,0):new _u(i,n));return new Eu(r,Su.empty(),t)}(n,-1)).next((e=>e)))}))}Yi(e,t){let i=new Vu(nd(e));return t.forEach(((t,n)=>{id(e,n)&&(i=i.add(n))})),i}Zi(e,t,i,n){if(null===e.limit)return!1;if(i.size!==t.size)return!0;const r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(n)>0)}Hi(e,t,i){return Zc()<=Wn.DEBUG&&Xc("QueryEngine","Using full collection scan to execute query:",td(t)),this.Gi.getDocumentsMatchingQuery(e,t,Eu.min(),i)}Xi(e,t,i,n){return this.Gi.getDocumentsMatchingQuery(e,i,n).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class lf{constructor(e,t,i,n){this.persistence=e,this.es=t,this.serializer=n,this.ts=new Fu(mu),this.ns=new sd((e=>jh(e)),Gh),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(i)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new qp(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ts)))}}async function cf(e,t){const i=tu(e);return await i.persistence.runTransaction("Handle user change","readonly",(e=>{let n;return i.mutationQueue.getAllMutationBatches(e).next((r=>(n=r,i.os(t),i.mutationQueue.getAllMutationBatches(e)))).next((t=>{const r=[],s=[];let o=md();for(const e of n){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return i.localDocuments.getDocuments(e,o).next((e=>({_s:e,removedBatchIds:r,addedBatchIds:s})))}))}))}function uf(e){const t=tu(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.qr.getLastRemoteSnapshotVersion(e)))}async function hf(e,t,i){const n=tu(e),r=n.ts.get(t),s=i?"readwrite":"readwrite-primary";try{i||await n.persistence.runTransaction("Release target",s,(e=>n.persistence.referenceDelegate.removeTarget(e,r)))}catch(e){if(!ku(e))throw e;Xc("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}n.ts=n.ts.remove(t),n.ns.delete(r.target)}function df(e,t,i){const n=tu(e);let r=yu.min(),s=md();return n.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,i){const n=tu(e),r=n.ns.get(i);return void 0!==r?Pu.resolve(n.ts.get(r)):n.qr.getTargetData(t,i)}(n,e,Yh(t)).next((t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,n.qr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>n.es.getDocumentsMatchingQuery(e,t,i?r:yu.min(),i?s:md()))).next((e=>(function(e,t,i){let n=e.rs.get(t)||yu.min();i.forEach(((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)})),e.rs.set(t,n)}(n,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,ls:s})))))}class pf{constructor(){this.activeTargetIds=gd}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ff{constructor(){this.eo=new pf,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,i){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new pf,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class mf{ro(e){}shutdown(){}}class gf{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){Xc("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){Xc("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let _f=null;function yf(){return null===_f?_f=268435456+Math.round(2147483648*Math.random()):_f++,"0x"+_f.toString(16)}const vf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class xf{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}Eo(e){this.Ao=e}onMessage(e){this.Ro=e}close(){this.lo()}send(e){this.co(e)}Vo(){this.Po()}mo(){this.To()}fo(e){this.Ao(e)}po(e){this.Ro(e)}}const bf="WebChannelConnection";class wf extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.yo=t+"://"+e.host,this.wo=`projects/${i}/databases/${n}`,this.So="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${n}`}get bo(){return!1}Do(e,t,i,n,r){const s=yf(),o=this.Co(e,t.toUriEncodedString());Xc("RestConnection",`Sending RPC '${e}' ${s}:`,o,i);const a={"google-cloud-resource-prefix":this.wo,"x-goog-request-params":this.So};return this.vo(a,n,r),this.Fo(e,o,a,i).then((t=>(Xc("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw Kc("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",i),t}))}Mo(e,t,i,n,r,s){return this.Do(e,t,i,n,r)}vo(e,t,i){e["X-Goog-Api-Client"]="gl-js/ fire/"+qc,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,i)=>e[i]=t)),i&&i.headers.forEach(((t,i)=>e[i]=t))}Co(e,t){const i=vf[e];return`${this.yo}/v1/${t}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Fo(e,t,i,n){const r=yf();return new Promise(((s,o)=>{const a=new Vc;a.setWithCredentials(!0),a.listenOnce(Nc.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Oc.NO_ERROR:const t=a.getResponseJson();Xc(bf,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(t)),s(t);break;case Oc.TIMEOUT:Xc(bf,`RPC '${e}' ${r} timed out`),o(new nu(iu.DEADLINE_EXCEEDED,"Request time out"));break;case Oc.HTTP_ERROR:const i=a.getStatus();if(Xc(bf,`RPC '${e}' ${r} failed with status:`,i,"response text:",a.getResponseText()),i>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(iu).indexOf(t)>=0?t:iu.UNKNOWN}(t.status);o(new nu(e,t.message))}else o(new nu(iu.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new nu(iu.UNAVAILABLE,"Connection failed."));break;default:Qc()}}finally{Xc(bf,`RPC '${e}' ${r} completed.`)}}));const l=JSON.stringify(n);Xc(bf,`RPC '${e}' ${r} sending request:`,n),a.send(t,"POST",l,i,15)}))}xo(e,t,i){const n=yf(),r=[this.yo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Lc(),o=Dc(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.xmlHttpFactory=new Bc({})),this.vo(a.initMessageHeaders,t,i),a.encodeInitMessageHeaders=!0;const c=r.join("");Xc(bf,`Creating RPC '${e}' stream ${n}: ${c}`,a);const u=s.createWebChannel(c,a);let h=!1,d=!1;const p=new xf({co:t=>{d?Xc(bf,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(h||(Xc(bf,`Opening RPC '${e}' stream ${n} transport.`),u.open(),h=!0),Xc(bf,`RPC '${e}' stream ${n} sending:`,t),u.send(t))},lo:()=>u.close()}),f=(e,t,i)=>{e.listen(t,(e=>{try{i(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return f(u,Uc.EventType.OPEN,(()=>{d||(Xc(bf,`RPC '${e}' stream ${n} transport opened.`),p.Vo())})),f(u,Uc.EventType.CLOSE,(()=>{d||(d=!0,Xc(bf,`RPC '${e}' stream ${n} transport closed`),p.fo())})),f(u,Uc.EventType.ERROR,(t=>{d||(d=!0,Kc(bf,`RPC '${e}' stream ${n} transport errored:`,t),p.fo(new nu(iu.UNAVAILABLE,"The operation could not be completed")))})),f(u,Uc.EventType.MESSAGE,(t=>{var i;if(!d){const r=t.data[0];eu(!!r);const s=r,o=s.error||(null===(i=s[0])||void 0===i?void 0:i.error);if(o){Xc(bf,`RPC '${e}' stream ${n} received error:`,o);const t=o.status;let i=function(e){const t=$d[e];if(void 0!==t)return Xd(t)}(t),r=o.message;void 0===i&&(i=iu.INTERNAL,r="Unknown error status: "+t+" with message "+o.message),d=!0,p.fo(new nu(i,r)),u.close()}else Xc(bf,`RPC '${e}' stream ${n} received:`,r),p.po(r)}})),f(o,zc.STAT_EVENT,(t=>{t.stat===Fc.PROXY?Xc(bf,`RPC '${e}' stream ${n} detected buffering proxy`):t.stat===Fc.NOPROXY&&Xc(bf,`RPC '${e}' stream ${n} detected no buffering proxy`)})),setTimeout((()=>{p.mo()}),0),p}}function Sf(){return"undefined"!=typeof document?document:null}function Tf(e){return new pp(e,!0)}class Ef{constructor(e,t,i=1e3,n=1.5,r=6e4){this.si=e,this.timerId=t,this.Oo=i,this.No=n,this.Lo=r,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(e){this.cancel();const t=Math.floor(this.Bo+this.$o()),i=Math.max(0,Date.now()-this.qo),n=Math.max(0,t-i);n>0&&Xc("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.Bo} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,n,(()=>(this.qo=Date.now(),e()))),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){null!==this.ko&&(this.ko.skipDelay(),this.ko=null)}cancel(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}}class Mf{constructor(e,t,i,n,r,s,o,a){this.si=e,this.Wo=i,this.Go=n,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.zo=0,this.jo=null,this.Ho=null,this.stream=null,this.Jo=new Ef(e,t)}Yo(){return 1===this.state||5===this.state||this.Zo()}Zo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Xo()}async stop(){this.Yo()&&await this.close(0)}e_(){this.state=0,this.Jo.reset()}t_(){this.Zo()&&null===this.jo&&(this.jo=this.si.enqueueAfterDelay(this.Wo,6e4,(()=>this.n_())))}r_(e){this.i_(),this.stream.send(e)}async n_(){if(this.Zo())return this.close(0)}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}async close(e,t){this.i_(),this.s_(),this.Jo.cancel(),this.zo++,4!==e?this.Jo.reset():t&&t.code===iu.RESOURCE_EXHAUSTED?(Yc(t.toString()),Yc("Using maximum backoff delay to prevent overloading the backend."),this.Jo.Qo()):t&&t.code===iu.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.o_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Eo(t)}o_(){}auth(){this.state=1;const e=this.__(this.zo),t=this.zo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,i])=>{this.zo===t&&this.a_(e,i)}),(t=>{e((()=>{const e=new nu(iu.UNKNOWN,"Fetching auth token failed: "+t.message);return this.u_(e)}))}))}a_(e,t){const i=this.__(this.zo);this.stream=this.c_(e,t),this.stream.ho((()=>{i((()=>this.listener.ho()))})),this.stream.Io((()=>{i((()=>(this.state=2,this.Ho=this.si.enqueueAfterDelay(this.Go,1e4,(()=>(this.Zo()&&(this.state=3),Promise.resolve()))),this.listener.Io())))})),this.stream.Eo((e=>{i((()=>this.u_(e)))})),this.stream.onMessage((e=>{i((()=>this.onMessage(e)))}))}Xo(){this.state=5,this.Jo.Ko((async()=>{this.state=0,this.start()}))}u_(e){return Xc("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}__(e){return t=>{this.si.enqueueAndForget((()=>this.zo===e?t():(Xc("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class If extends Mf{constructor(e,t,i,n,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,n,s),this.serializer=r}c_(e,t){return this.connection.xo("Listen",e,t)}onMessage(e){this.Jo.reset();const t=function(e,t){let i;if("targetChange"in t){t.targetChange;const n=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Qc()}(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(eu(void 0===t||"string"==typeof t),Wu.fromBase64String(t||"")):(eu(void 0===t||t instanceof Buffer||t instanceof Uint8Array),Wu.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?iu.UNKNOWN:Xd(e.code);return new nu(t,e.message||"")}(o);i=new sp(n,r,s,a||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const r=bp(e,n.document.name),s=_p(n.document.updateTime),o=n.document.createTime?_p(n.document.createTime):yu.min(),a=new _h({mapValue:{fields:n.document.fields}}),l=yh.newFoundDocument(r,s,o,a),c=n.targetIds||[],u=n.removedTargetIds||[];i=new np(c,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const r=bp(e,n.document),s=n.readTime?_p(n.readTime):yu.min(),o=yh.newNoDocument(r,s),a=n.removedTargetIds||[];i=new np([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const r=bp(e,n.document),s=n.removedTargetIds||[];i=new np([],s,r,null)}else{if(!("filter"in t))return Qc();{t.filter;const e=t.filter;e.targetId;const{count:n=0,unchangedNames:r}=e,s=new qd(n,r),o=e.targetId;i=new rp(o,s)}}return i}(this.serializer,e),i=function(e){if(!("targetChange"in e))return yu.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?yu.min():t.readTime?_p(t.readTime):yu.min()}(e);return this.listener.l_(t,i)}h_(e){const t={};t.database=Sp(this.serializer),t.addTarget=function(e,t){let i;const n=t.target;if(i=Hh(n)?{documents:Ep(e,n)}:{query:Mp(e,n)._t},i.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){i.resumeToken=gp(e,t.resumeToken);const n=fp(e,t.expectedCount);null!==n&&(i.expectedCount=n)}else if(t.snapshotVersion.compareTo(yu.min())>0){i.readTime=mp(e,t.snapshotVersion.toTimestamp());const n=fp(e,t.expectedCount);null!==n&&(i.expectedCount=n)}return i}(this.serializer,e);const i=function(e,t){const i=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Qc()}}(t.purpose);return null==i?null:{"goog-listen-tags":i}}(this.serializer,e);i&&(t.labels=i),this.r_(t)}P_(e){const t={};t.database=Sp(this.serializer),t.removeTarget=e,this.r_(t)}}class Af extends class{}{constructor(e,t,i,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=n,this.V_=!1}m_(){if(this.V_)throw new nu(iu.FAILED_PRECONDITION,"The client has already been terminated.")}Do(e,t,i,n){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.connection.Do(e,vp(t,i),n,r,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===iu.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new nu(iu.UNKNOWN,e.toString())}))}Mo(e,t,i,n,r){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.Mo(e,vp(t,i),n,s,o,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===iu.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new nu(iu.UNKNOWN,e.toString())}))}terminate(){this.V_=!0,this.connection.terminate()}}class Cf{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve()))))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(Yc(t),this.y_=!1):Xc("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class Pf{constructor(e,t,i,n,r){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=r,this.O_.ro((e=>{i.enqueueAndForget((async()=>{Bf(this)&&(Xc("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=tu(e);t.M_.add(4),await Rf(t),t.N_.set("Unknown"),t.M_.delete(4),await kf(t)}(this))}))})),this.N_=new Cf(i,n)}}async function kf(e){if(Bf(e))for(const t of e.x_)await t(!0)}async function Rf(e){for(const t of e.x_)await t(!1)}function Lf(e,t){const i=tu(e);i.F_.has(t.targetId)||(i.F_.set(t.targetId,t),Ff(i)?zf(i):$f(i).Zo()&&Of(i,t))}function Df(e,t){const i=tu(e),n=$f(i);i.F_.delete(t),n.Zo()&&Nf(i,t),0===i.F_.size&&(n.Zo()?n.t_():Bf(i)&&i.N_.set("Unknown"))}function Of(e,t){if(e.L_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(yu.min())>0){const i=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(i)}$f(e).h_(t)}function Nf(e,t){e.L_.xe(t),$f(e).P_(t)}function zf(e){e.L_=new ap({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.F_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),$f(e).start(),e.N_.w_()}function Ff(e){return Bf(e)&&!$f(e).Yo()&&e.F_.size>0}function Bf(e){return 0===tu(e).M_.size}function Uf(e){e.L_=void 0}async function Vf(e){e.N_.set("Online")}async function jf(e){e.F_.forEach(((t,i)=>{Of(e,t)}))}async function Gf(e,t){Uf(e),Ff(e)?(e.N_.D_(t),zf(e)):e.N_.set("Unknown")}async function Hf(e,t,i){if(e.N_.set("Online"),t instanceof sp&&2===t.state&&t.cause)try{await async function(e,t){const i=t.cause;for(const n of t.targetIds)e.F_.has(n)&&(await e.remoteSyncer.rejectListen(n,i),e.F_.delete(n),e.L_.removeTarget(n))}(e,t)}catch(i){Xc("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),i),await Wf(e,i)}else if(t instanceof np?e.L_.Ke(t):t instanceof rp?e.L_.He(t):e.L_.We(t),!i.isEqual(yu.min()))try{const t=await uf(e.localStore);i.compareTo(t)>=0&&await function(e,t){const i=e.L_.rt(t);return i.targetChanges.forEach(((i,n)=>{if(i.resumeToken.approximateByteSize()>0){const r=e.F_.get(n);r&&e.F_.set(n,r.withResumeToken(i.resumeToken,t))}})),i.targetMismatches.forEach(((t,i)=>{const n=e.F_.get(t);if(!n)return;e.F_.set(t,n.withResumeToken(Wu.EMPTY_BYTE_STRING,n.snapshotVersion)),Nf(e,t);const r=new Np(n.target,t,i,n.sequenceNumber);Of(e,r)})),e.remoteSyncer.applyRemoteEvent(i)}(e,i)}catch(t){Xc("RemoteStore","Failed to raise snapshot:",t),await Wf(e,t)}}async function Wf(e,t,i){if(!ku(t))throw t;e.M_.add(1),await Rf(e),e.N_.set("Offline"),i||(i=()=>uf(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Xc("RemoteStore","Retrying IndexedDB access"),await i(),e.M_.delete(1),await kf(e)}))}async function qf(e,t){const i=tu(e);i.asyncQueue.verifyOperationInProgress(),Xc("RemoteStore","RemoteStore received new credentials");const n=Bf(i);i.M_.add(3),await Rf(i),n&&i.N_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(t),i.M_.delete(3),await kf(i)}function $f(e){return e.B_||(e.B_=function(e,t,i){const n=tu(e);return n.m_(),new If(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,i)}(e.datastore,e.asyncQueue,{ho:Vf.bind(null,e),Io:jf.bind(null,e),Eo:Gf.bind(null,e),l_:Hf.bind(null,e)}),e.x_.push((async t=>{t?(e.B_.e_(),Ff(e)?zf(e):e.N_.set("Unknown")):(await e.B_.stop(),Uf(e))}))),e.B_}class Zf{constructor(e,t,i,n,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=n,this.removalCallback=r,this.deferred=new ru,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,n,r){const s=Date.now()+i,o=new Zf(e,t,s,n,r);return o.start(i),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new nu(iu.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Xf(e,t){if(Yc("AsyncQueue",`${t}: ${e}`),ku(e))return new nu(iu.UNAVAILABLE,`${t}: ${e}`);throw e}class Yf{constructor(e){this.comparator=e?(t,i)=>e(t,i)||Su.comparator(t.key,i.key):(e,t)=>Su.comparator(e.key,t.key),this.keyedMap=cd(),this.sortedSet=new Fu(this.comparator)}static emptySet(e){return new Yf(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,i)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Yf))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=i.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const i=new Yf;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}class Kf{constructor(){this.q_=new Fu(Su.comparator)}track(e){const t=e.doc.key,i=this.q_.get(t);i?0!==e.type&&3===i.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==i.type?this.q_=this.q_.insert(t,{type:i.type,doc:e.doc}):2===e.type&&2===i.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===i.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===i.type?this.q_=this.q_.remove(t):1===e.type&&2===i.type?this.q_=this.q_.insert(t,{type:1,doc:i.doc}):0===e.type&&1===i.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):Qc():this.q_=this.q_.insert(t,e)}Q_(){const e=[];return this.q_.inorderTraversal(((t,i)=>{e.push(i)})),e}}class Jf{constructor(e,t,i,n,r,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=n,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,i,n,r){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new Jf(e,t,Yf.emptySet(t),s,i,n,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Qh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==i[e].type||!t[e].doc.isEqual(i[e].doc))return!1;return!0}}class Qf{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some((e=>e.G_()))}}class em{constructor(){this.queries=new sd((e=>ed(e)),Qh),this.onlineState="Unknown",this.z_=new Set}}function tm(e,t){const i=tu(e);let n=!1;for(const e of t){const t=e.query,r=i.queries.get(t);if(r){for(const t of r.U_)t.H_(e)&&(n=!0);r.K_=e}}n&&nm(i)}function im(e,t,i){const n=tu(e),r=n.queries.get(t);if(r)for(const e of r.U_)e.onError(i);n.queries.delete(t)}function nm(e){e.z_.forEach((e=>{e.next()}))}var rm,sm;(sm=rm||(rm={})).J_="default",sm.Cache="cache";class om{constructor(e,t,i){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=i||{}}H_(e){if(!this.options.includeMetadataChanges){const t=[];for(const i of e.docChanges)3!==i.type&&t.push(i);e=new Jf(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache)return!0;if(!this.G_())return!0;const i="Offline"!==t;return(!this.options.ra||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){if(e.docChanges.length>0)return!0;const t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}na(e){e=Jf.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==rm.Cache}}class am{constructor(e){this.key=e}}class lm{constructor(e){this.key=e}}class cm{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=md(),this.mutatedKeys=md(),this.Ia=nd(e),this.Ta=new Yf(this.Ia)}get Ea(){return this.la}da(e,t){const i=t?t.Aa:new Kf,n=t?t.Ta:this.Ta;let r=t?t.mutatedKeys:this.mutatedKeys,s=n,o=!1;const a="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal(((e,t)=>{const c=n.get(e),u=id(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let p=!1;c&&u?c.data.isEqual(u.data)?h!==d&&(i.track({type:3,doc:u}),p=!0):this.Ra(c,u)||(i.track({type:2,doc:u}),p=!0,(a&&this.Ia(u,a)>0||l&&this.Ia(u,l)<0)&&(o=!0)):!c&&u?(i.track({type:0,doc:u}),p=!0):c&&!u&&(i.track({type:1,doc:c}),p=!0,(a||l)&&(o=!0)),p&&(u?(s=s.add(u),r=d?r.add(e):r.delete(e)):(s=s.delete(e),r=r.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),r=r.delete(e.key),i.track({type:1,doc:e})}return{Ta:s,Aa:i,Zi:o,mutatedKeys:r}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,n){const r=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const s=e.Aa.Q_();s.sort(((e,t)=>function(e,t){const i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Qc()}};return i(e)-i(t)}(e.type,t.type)||this.Ia(e.doc,t.doc))),this.Va(i),n=null!=n&&n;const o=t&&!n?this.ma():[],a=0===this.Pa.size&&this.current&&!n?1:0,l=a!==this.ha;return this.ha=a,0!==s.length||l?{snapshot:new Jf(this.query,e.Ta,r,s,e.mutatedKeys,0===a,l,!1,!!i&&i.resumeToken.approximateByteSize()>0),fa:o}:{fa:o}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Kf,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach((e=>this.la=this.la.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.la=this.la.delete(e))),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=md(),this.Ta.forEach((e=>{this.ga(e.key)&&(this.Pa=this.Pa.add(e.key))}));const t=[];return e.forEach((e=>{this.Pa.has(e)||t.push(new lm(e))})),this.Pa.forEach((i=>{e.has(i)||t.push(new am(i))})),t}pa(e){this.la=e.ls,this.Pa=md();const t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Jf.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class um{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class hm{constructor(e){this.key=e,this.wa=!1}}class dm{constructor(e,t,i,n,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=n,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.Sa={},this.ba=new sd((e=>ed(e)),Qh),this.Da=new Map,this.Ca=new Set,this.va=new Fu(Su.comparator),this.Fa=new Map,this.Ma=new Xp,this.xa={},this.Oa=new Map,this.Na=Gp.Nn(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}async function pm(e,t,i=!0){const n=Cm(e);let r;const s=n.ba.get(t);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.ya()):r=await mm(n,t,i,!0),r}async function fm(e,t){const i=Cm(e);await mm(i,t,!0,!1)}async function mm(e,t,i,n){const r=await function(e,t){const i=tu(e);return i.persistence.runTransaction("Allocate target","readwrite",(e=>{let n;return i.qr.getTargetData(e,t).next((r=>r?(n=r,Pu.resolve(n)):i.qr.allocateTargetId(e).next((r=>(n=new Np(t,r,"TargetPurposeListen",e.currentSequenceNumber),i.qr.addTargetData(e,n).next((()=>n)))))))})).then((e=>{const n=i.ts.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(i.ts=i.ts.insert(e.targetId,e),i.ns.set(t,e.targetId)),e}))}(e.localStore,Yh(t)),s=r.targetId,o=i?e.sharedClientState.addLocalQueryTarget(s):"not-current";let a;return n&&(a=await async function(e,t,i,n,r){e.Ba=(t,i,n)=>async function(e,t,i,n){let r=t.view.da(i);r.Zi&&(r=await df(e.localStore,t.query,!1).then((({documents:e})=>t.view.da(e,r))));const s=n&&n.targetChanges.get(t.targetId),o=n&&null!=n.targetMismatches.get(t.targetId),a=t.view.applyChanges(r,e.isPrimaryClient,s,o);return Sm(e,t.targetId,a.fa),a.snapshot}(e,t,i,n);const s=await df(e.localStore,t,!0),o=new cm(t,s.ls),a=o.da(s.documents),l=ip.createSynthesizedTargetChangeForCurrentChange(i,n&&"Offline"!==e.onlineState,r),c=o.applyChanges(a,e.isPrimaryClient,l);Sm(e,i,c.fa);const u=new um(t,i,o);return e.ba.set(t,u),e.Da.has(i)?e.Da.get(i).push(t):e.Da.set(i,[t]),c.snapshot}(e,t,s,"current"===o,r.resumeToken)),e.isPrimaryClient&&i&&Lf(e.remoteStore,r),a}async function gm(e,t,i){const n=tu(e),r=n.ba.get(t),s=n.Da.get(r.targetId);if(s.length>1)return n.Da.set(r.targetId,s.filter((e=>!Qh(e,t)))),void n.ba.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await hf(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),i&&Df(n.remoteStore,r.targetId),bm(n,r.targetId)})).catch(Cu)):(bm(n,r.targetId),await hf(n.localStore,r.targetId,!0))}async function _m(e,t){const i=tu(e),n=i.ba.get(t),r=i.Da.get(n.targetId);i.isPrimaryClient&&1===r.length&&(i.sharedClientState.removeLocalQueryTarget(n.targetId),Df(i.remoteStore,n.targetId))}async function ym(e,t){const i=tu(e);try{const e=await function(e,t){const i=tu(e),n=t.snapshotVersion;let r=i.ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=i.ss.newChangeBuffer({trackRemovals:!0});r=i.ts;const o=[];t.targetChanges.forEach(((s,a)=>{const l=r.get(a);if(!l)return;o.push(i.qr.removeMatchingKeys(e,s.removedDocuments,a).next((()=>i.qr.addMatchingKeys(e,s.addedDocuments,a))));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?c=c.withResumeToken(Wu.EMPTY_BYTE_STRING,yu.min()).withLastLimboFreeSnapshotVersion(yu.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,n)),r=r.insert(a,c),function(e,t,i){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size>0}(l,c,s)&&o.push(i.qr.updateTargetData(e,c))}));let a=ad(),l=md();if(t.documentUpdates.forEach((n=>{t.resolvedLimboDocuments.has(n)&&o.push(i.persistence.referenceDelegate.updateLimboDocument(e,n))})),o.push(function(e,t,i){let n=md(),r=md();return i.forEach((e=>n=n.add(e))),t.getEntries(e,n).next((e=>{let n=ad();return i.forEach(((i,s)=>{const o=e.get(i);s.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(i)),s.isNoDocument()&&s.version.isEqual(yu.min())?(t.removeEntry(i,s.readTime),n=n.insert(i,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),n=n.insert(i,s)):Xc("LocalStore","Ignoring outdated watch update for ",i,". Current version:",o.version," Watch version:",s.version)})),{us:n,cs:r}}))}(e,s,t.documentUpdates).next((e=>{a=e.us,l=e.cs}))),!n.isEqual(yu.min())){const t=i.qr.getLastRemoteSnapshotVersion(e).next((t=>i.qr.setTargetsMetadata(e,e.currentSequenceNumber,n)));o.push(t)}return Pu.waitFor(o).next((()=>s.apply(e))).next((()=>i.localDocuments.getLocalViewOfDocuments(e,a,l))).next((()=>a))})).then((e=>(i.ts=r,e)))}(i.localStore,t);t.targetChanges.forEach(((e,t)=>{const n=i.Fa.get(t);n&&(eu(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.wa=!0:e.modifiedDocuments.size>0?eu(n.wa):e.removedDocuments.size>0&&(eu(n.wa),n.wa=!1))})),await Mm(i,e,t)}catch(e){await Cu(e)}}function vm(e,t,i){const n=tu(e);if(n.isPrimaryClient&&0===i||!n.isPrimaryClient&&1===i){const e=[];n.ba.forEach(((i,n)=>{const r=n.view.j_(t);r.snapshot&&e.push(r.snapshot)})),function(e,t){const i=tu(e);i.onlineState=t;let n=!1;i.queries.forEach(((e,i)=>{for(const e of i.U_)e.j_(t)&&(n=!0)})),n&&nm(i)}(n.eventManager,t),e.length&&n.Sa.l_(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function xm(e,t,i){const n=tu(e);n.sharedClientState.updateQueryState(t,"rejected",i);const r=n.Fa.get(t),s=r&&r.key;if(s){let e=new Fu(Su.comparator);e=e.insert(s,yh.newNoDocument(s,yu.min()));const i=md().add(s),r=new tp(yu.min(),new Map,new Fu(mu),e,i);await ym(n,r),n.va=n.va.remove(s),n.Fa.delete(t),Em(n)}else await hf(n.localStore,t,!1).then((()=>bm(n,t,i))).catch(Cu)}function bm(e,t,i=null){e.sharedClientState.removeLocalQueryTarget(t);for(const n of e.Da.get(t))e.ba.delete(n),i&&e.Sa.ka(n,i);e.Da.delete(t),e.isPrimaryClient&&e.Ma.Rr(t).forEach((t=>{e.Ma.containsKey(t)||wm(e,t)}))}function wm(e,t){e.Ca.delete(t.path.canonicalString());const i=e.va.get(t);null!==i&&(Df(e.remoteStore,i),e.va=e.va.remove(t),e.Fa.delete(i),Em(e))}function Sm(e,t,i){for(const n of i)n instanceof am?(e.Ma.addReference(n.key,t),Tm(e,n)):n instanceof lm?(Xc("SyncEngine","Document no longer in limbo: "+n.key),e.Ma.removeReference(n.key,t),e.Ma.containsKey(n.key)||wm(e,n.key)):Qc()}function Tm(e,t){const i=t.key,n=i.path.canonicalString();e.va.get(i)||e.Ca.has(n)||(Xc("SyncEngine","New document in limbo: "+i),e.Ca.add(n),Em(e))}function Em(e){for(;e.Ca.size>0&&e.va.size<e.maxConcurrentLimboResolutions;){const t=e.Ca.values().next().value;e.Ca.delete(t);const i=new Su(xu.fromString(t)),n=e.Na.next();e.Fa.set(n,new hm(i)),e.va=e.va.insert(i,n),Lf(e.remoteStore,new Np(Yh(qh(i.path)),n,"TargetPurposeLimboResolution",Ru.oe))}}async function Mm(e,t,i){const n=tu(e),r=[],s=[],o=[];n.ba.isEmpty()||(n.ba.forEach(((e,a)=>{o.push(n.Ba(a,t,i).then((e=>{if((e||i)&&n.isPrimaryClient&&n.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){r.push(e);const t=sf.Qi(a.targetId,e);s.push(t)}})))})),await Promise.all(o),n.Sa.l_(r),await async function(e,t){const i=tu(e);try{await i.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Pu.forEach(t,(t=>Pu.forEach(t.ki,(n=>i.persistence.referenceDelegate.addReference(e,t.targetId,n))).next((()=>Pu.forEach(t.qi,(n=>i.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))))))}catch(e){if(!ku(e))throw e;Xc("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=i.ts.get(t),n=e.snapshotVersion,r=e.withLastLimboFreeSnapshotVersion(n);i.ts=i.ts.insert(t,r)}}}(n.localStore,s))}async function Im(e,t){const i=tu(e);if(!i.currentUser.isEqual(t)){Xc("SyncEngine","User change. New user:",t.toKey());const e=await cf(i.localStore,t);i.currentUser=t,function(e,t){e.Oa.forEach((e=>{e.forEach((e=>{e.reject(new nu(iu.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Oa.clear()}(i),i.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Mm(i,e._s)}}function Am(e,t){const i=tu(e),n=i.Fa.get(t);if(n&&n.wa)return md().add(n.key);{let e=md();const n=i.Da.get(t);if(!n)return e;for(const t of n){const n=i.ba.get(t);e=e.unionWith(n.view.Ea)}return e}}function Cm(e){const t=tu(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=ym.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Am.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=xm.bind(null,t),t.Sa.l_=tm.bind(null,t.eventManager),t.Sa.ka=im.bind(null,t.eventManager),t}class Pm{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Tf(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function(e,t,i,n){return new lf(e,t,i,n)}(this.persistence,new af,e.initialUser,this.serializer)}createPersistence(e){return new tf(rf.jr,this.serializer)}createSharedClientState(e){return new ff}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class km{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>vm(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Im.bind(null,this.syncEngine),await async function(e,t){const i=tu(e);t?(i.M_.delete(2),await kf(i)):t||(i.M_.add(2),await Rf(i),i.N_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new em}createDatastore(e){const t=Tf(e.databaseInfo.databaseId),i=function(e){return new wf(e)}(e.databaseInfo);return function(e,t,i,n){return new Af(e,t,i,n)}(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return function(e,t,i,n,r){return new Pf(e,t,i,n,r)}(this.localStore,this.datastore,e.asyncQueue,(e=>vm(this.syncEngine,e,0)),gf.D()?new gf:new mf)}createSyncEngine(e,t){return function(e,t,i,n,r,s,o){const a=new dm(e,t,i,n,r,s);return o&&(a.La=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=tu(e);Xc("RemoteStore","RemoteStore shutting down."),t.M_.add(5),await Rf(t),t.O_.shutdown(),t.N_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}class Rm{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):Yc("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Lm{constructor(e,t,i,n){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=n,this.user=Wc.UNAUTHENTICATED,this.clientId=fu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,(async e=>{Xc("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(i,(e=>(Xc("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new nu(iu.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ru;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=Xf(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}async function Dm(e,t){e.asyncQueue.verifyOperationInProgress(),Xc("FirestoreClient","Initializing OfflineComponentProvider");const i=e.configuration;await t.initialize(i);let n=i.initialUser;e.setCredentialChangeListener((async e=>{n.isEqual(e)||(await cf(t.localStore,e),n=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function Om(e,t){e.asyncQueue.verifyOperationInProgress();const i=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Xc("FirestoreClient","Using user provided OfflineComponentProvider");try{await Dm(e,e._uninitializedComponentsProvider._offline)}catch(t){const i=t;if(!function(e){return"FirebaseError"===e.name?e.code===iu.FAILED_PRECONDITION||e.code===iu.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(i))throw i;Kc("Error using user provided cache. Falling back to memory cache: "+i),await Dm(e,new Pm)}}else Xc("FirestoreClient","Using default OfflineComponentProvider"),await Dm(e,new Pm);return e._offlineComponents}(e);Xc("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(i,e.configuration),e.setCredentialChangeListener((e=>qf(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,i)=>qf(t.remoteStore,i))),e._onlineComponents=t}async function Nm(e){const t=await async function(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Xc("FirestoreClient","Using user provided OnlineComponentProvider"),await Om(e,e._uninitializedComponentsProvider._online)):(Xc("FirestoreClient","Using default OnlineComponentProvider"),await Om(e,new km))),e._onlineComponents}(e),i=t.eventManager;return i.onListen=pm.bind(null,t.syncEngine),i.onUnlisten=gm.bind(null,t.syncEngine),i.onFirstRemoteStoreListen=fm.bind(null,t.syncEngine),i.onLastRemoteStoreUnlisten=_m.bind(null,t.syncEngine),i}function zm(e,t,i={}){const n=new ru;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,i,n,r){const s=new Rm({next:i=>{t.enqueueAndForget((()=>async function(e,t){const i=tu(e),n=t.query;let r=3;const s=i.queries.get(n);if(s){const e=s.U_.indexOf(t);e>=0&&(s.U_.splice(e,1),0===s.U_.length?r=t.G_()?0:1:!s.W_()&&t.G_()&&(r=2))}switch(r){case 0:return i.queries.delete(n),i.onUnlisten(n,!0);case 1:return i.queries.delete(n),i.onUnlisten(n,!1);case 2:return i.onLastRemoteStoreUnlisten(n);default:return}}(e,o))),i.fromCache&&"server"===n.source?r.reject(new nu(iu.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(i)},error:e=>r.reject(e)}),o=new om(i,s,{includeMetadataChanges:!0,ra:!0});return async function(e,t){const i=tu(e);let n=3;const r=t.query;let s=i.queries.get(r);s?!s.W_()&&t.G_()&&(n=2):(s=new Qf,n=t.G_()?0:1);try{switch(n){case 0:s.K_=await i.onListen(r,!0);break;case 1:s.K_=await i.onListen(r,!1);break;case 2:await i.onFirstRemoteStoreListen(r)}}catch(e){const i=Xf(e,`Initialization of query '${td(t.query)}' failed`);return void t.onError(i)}i.queries.set(r,s),s.U_.push(t),t.j_(i.onlineState),s.K_&&t.H_(s.K_)&&nm(i)}(e,o)}(await Nm(e),e.asyncQueue,t,i,n))),n.promise}function Fm(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Bm=new Map;function Um(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Qc()}function Vm(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new nu(iu.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=Um(e);throw new nu(iu.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${i}`)}}return e}class jm{constructor(e){var t,i;if(void 0===e.host){if(void 0!==e.ssl)throw new nu(iu.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new nu(iu.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,i,n){if(!0===t&&!0===n)throw new nu(iu.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Fm(null!==(i=e.experimentalLongPollingOptions)&&void 0!==i?i:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new nu(iu.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new nu(iu.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new nu(iu.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Gm{constructor(e,t,i,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new jm({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new nu(iu.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new nu(iu.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new jm(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new ou;switch(e.type){case"firstParty":return new uu(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new nu(iu.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Bm.get(e);t&&(Xc("ComponentProvider","Removing Datastore"),Bm.delete(e),t.terminate())}(this),Promise.resolve()}}class Hm{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Hm(this.firestore,e,this._query)}}class Wm{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Wm(this.firestore,e,this._key)}}class qm extends Hm{constructor(e,t,i){super(e,t,qh(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Wm(this.firestore,null,new Su(e))}withConverter(e){return new qm(this.firestore,e,this._path)}}class $m{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new Ef(this,"async_queue_retry"),this.hu=()=>{const e=Sf();e&&Xc("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Jo.Uo()};const e=Sf();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const t=Sf();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise((()=>{}));const t=new ru;return this.Iu((()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.su.push(e),this.Tu())))}async Tu(){if(0!==this.su.length){try{await this.su[0](),this.su.shift(),this.Jo.reset()}catch(e){if(!ku(e))throw e;Xc("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Jo.Ko((()=>this.Tu()))}}Iu(e){const t=this.iu.then((()=>(this.uu=!0,e().catch((e=>{this.au=e,this.uu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Yc("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.uu=!1,e))))));return this.iu=t,t}enqueueAfterDelay(e,t,i){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);const n=Zf.createAndSchedule(this,e,t,i,(e=>this.Eu(e)));return this._u.push(n),n}Pu(){this.au&&Qc()}verifyOperationInProgress(){}async du(){let e;do{e=this.iu,await e}while(e!==this.iu)}Au(e){for(const t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then((()=>{this._u.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this._u)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()}))}Vu(e){this.lu.push(e)}Eu(e){const t=this._u.indexOf(e);this._u.splice(t,1)}}class Zm extends Gm{constructor(e,t,i,n){super(e,t,i,n),this.type="firestore",this._queue=new $m,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Xm(this),this._firestoreClient.terminate()}}function Xm(e){var t,i,n;const r=e._freezeSettings(),s=function(e,t,i,n){return new Qu(e,t,i,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,Fm(n.experimentalLongPollingOptions),n.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,r);e._firestoreClient=new Lm(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(i=r.localCache)||void 0===i?void 0:i._offlineComponentProvider)&&(null===(n=r.localCache)||void 0===n?void 0:n._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}class Ym{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ym(Wu.fromBase64String(e))}catch(e){throw new nu(iu.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Ym(Wu.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Km{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new nu(iu.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new wu(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Jm{constructor(e){this._methodName=e}}class Qm{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new nu(iu.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new nu(iu.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return mu(this._lat,e._lat)||mu(this._long,e._long)}}const eg=/^__.*__$/;function tg(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Qc()}}class ig{constructor(e,t,i,n,r,s){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=n,void 0===r&&this.mu(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new ig(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;const i=null===(t=this.path)||void 0===t?void 0:t.child(e),n=this.gu({path:i,yu:!1});return n.wu(e),n}Su(e){var t;const i=null===(t=this.path)||void 0===t?void 0:t.child(e),n=this.gu({path:i,yu:!1});return n.mu(),n}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return ag(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(tg(this.fu)&&eg.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class ng{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||Tf(e)}Fu(e,t,i,n=!1){return new ig({fu:e,methodName:t,vu:i,path:wu.emptyPath(),yu:!1,Cu:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function rg(e,t){if(sg(e=Bn(e)))return function(e,t,i){if(!sg(i)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(i)){const n=Um(i);throw"an object"===n?t.Du(e+" a custom object"):t.Du(e+" "+n)}}("Unsupported field value:",t,e),function(e,t){const i={};return zu(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Nu(e,((e,n)=>{const r=rg(n,t.pu(e));null!=r&&(i[e]=r)})),{mapValue:{fields:i}}}(e,t);if(e instanceof Jm)return function(e,t){if(!tg(t.fu))throw t.Du(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Du(`${e._methodName}() is not currently supported inside arrays`);const i=e._toFieldTransform(t);i&&t.fieldTransforms.push(i)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.yu&&4!==t.fu)throw t.Du("Nested arrays are not supported");return function(e,t){const i=[];let n=0;for(const r of e){let e=rg(r,t.bu(n));null==e&&(e={nullValue:"NULL_VALUE"}),i.push(e),n++}return{arrayValue:{values:i}}}(e,t)}return function(e,t){if(null===(e=Bn(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return vd(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const i=_u.fromDate(e);return{timestampValue:mp(t.serializer,i)}}if(e instanceof _u){const i=new _u(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:mp(t.serializer,i)}}if(e instanceof Qm)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Ym)return{bytesValue:gp(t.serializer,e._byteString)};if(e instanceof Wm){const i=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(i))throw t.Du(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:yp(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Du(`Unsupported field value: ${Um(e)}`)}(e,t)}function sg(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof _u||e instanceof Qm||e instanceof Ym||e instanceof Wm||e instanceof Jm)}const og=new RegExp("[~\\*/\\[\\]]");function ag(e,t,i,n,r){const s=n&&!n.isEmpty(),o=void 0!==r;let a=`Function ${t}() called with invalid data`;i&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${n}`),o&&(l+=` in document ${r}`),l+=")"),new nu(iu.INVALID_ARGUMENT,a+e+l)}class lg{constructor(e,t,i,n,r){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=n,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Wm(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new cg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ug("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class cg extends lg{data(){return super.data()}}function ug(e,t){return"string"==typeof t?function(e,t,i){if(t.search(og)>=0)throw ag(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,i);try{return new Km(...t.split("."))._internalPath}catch(n){throw ag(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,i)}}(e,t):t instanceof Km?t._internalPath:t._delegate._internalPath}class hg{}class dg extends hg{}function pg(e,t,...i){let n=[];t instanceof hg&&n.push(t),n=n.concat(i),function(e){const t=e.filter((e=>e instanceof gg)).length,i=e.filter((e=>e instanceof fg)).length;if(t>1||t>0&&i>0)throw new nu(iu.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const t of n)e=t._apply(e);return e}class fg extends dg{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new fg(e,t,i)}_apply(e){const t=this._parse(e);return bg(e._query,t),new Hm(e.firestore,e.converter,Kh(e._query,t))}_parse(e){const t=function(e){const t=e._freezeSettings(),i=Tf(e._databaseId);return new ng(e._databaseId,!!t.ignoreUndefinedProperties,i)}(e.firestore),i=function(e,t,i,n,r,s,o){let a;if(r.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new nu(iu.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){xg(o,s);const t=[];for(const i of o)t.push(vg(n,e,i));a={arrayValue:{values:t}}}else a=vg(n,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||xg(o,s),a=function(e,t,i,n=!1){return rg(i,e.Fu(n?4:3,t))}(i,"where",o,"in"===s||"not-in"===s);return Eh.create(r,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return i}}function mg(e,t,i){const n=t,r=ug("where",e);return fg._create(r,n,i)}class gg extends hg{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new gg(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:Mh.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let i=e;const n=t.getFlattenedFilters();for(const e of n)bg(i,e),i=Kh(i,e)}(e._query,t),new Hm(e.firestore,e.converter,Kh(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class _g extends dg{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new _g(e,t,i)}_apply(e){return new Hm(e.firestore,e.converter,Jh(e._query,this._limit,this._limitType))}}function yg(e){return function(e,t){if(t<=0)throw new nu(iu.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}("limit",e),_g._create("limit",e,"F")}function vg(e,t,i){if("string"==typeof(i=Bn(i))){if(""===i)throw new nu(iu.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Zh(t)&&-1!==i.indexOf("/"))throw new nu(iu.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const n=t.path.child(xu.fromString(i));if(!Su.isDocumentKey(n))throw new nu(iu.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ch(e,new Su(n))}if(i instanceof Wm)return ch(e,i._key);throw new nu(iu.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Um(i)}.`)}function xg(e,t){if(!Array.isArray(e)||0===e.length)throw new nu(iu.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function bg(e,t){const i=function(e,t){for(const i of e)for(const e of i.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==i)throw i===t.op?new nu(iu.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new nu(iu.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${i.toString()}' filters.`)}class wg{convertValue(e,t="none"){switch(ih(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Zu(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Xu(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Qc()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return Nu(e,((e,n)=>{i[e]=this.convertValue(n,t)})),i}convertGeoPoint(e){return new Qm(Zu(e.latitude),Zu(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const i=Ku(e);return null==i?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(Ju(e));default:return null}}convertTimestamp(e){const t=$u(e);return new _u(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=xu.fromString(e);eu(Op(i));const n=new eh(i.get(1),i.get(3)),r=new Su(i.popFirst(5));return n.isEqual(t)||Yc(`Document ${r} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}class Sg{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Tg extends lg{constructor(e,t,i,n,r,s){super(e,t,i,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Eg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(ug("DocumentSnapshot.get",e));if(null!==i)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class Eg extends Tg{data(e={}){return super.data(e)}}class Mg{constructor(e,t,i,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new Sg(n.hasPendingWrites,n.fromCache),this.query=i}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((i=>{e.call(t,new Eg(this._firestore,this._userDataWriter,i.key,i,new Sg(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new nu(iu.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((i=>{const n=new Eg(e._firestore,e._userDataWriter,i.doc.key,i.doc,new Sg(e._snapshot.mutatedKeys.has(i.doc.key),e._snapshot.fromCache),e.query.converter);return i.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}}))}{let i=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const n=new Eg(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Sg(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,s=-1;return 0!==t.type&&(r=i.indexOf(t.doc.key),i=i.delete(t.doc.key)),1!==t.type&&(i=i.add(t.doc),s=i.indexOf(t.doc.key)),{type:Ig(t.type),doc:n,oldIndex:r,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Ig(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Qc()}}class Ag extends wg{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ym(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Wm(this.firestore,null,t)}}function Cg(e){e=Vm(e,Hm);const t=Vm(e.firestore,Zm),i=function(e){return e._firestoreClient||Xm(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}(t),n=new Ag(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new nu(iu.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),zm(i,e._query).then((i=>new Mg(t,n,e,i)))}new WeakMap,function(e,t=!0){!function(e){qc=e}(rs),Xr(new Un("firestore",((e,{instanceIdentifier:i,options:n})=>{const r=e.getProvider("app").getImmediate(),s=new Zm(new lu(e.getProvider("auth-internal")),new du(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new nu(iu.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new eh(e.options.projectId,t)}(r,i),r);return n=Object.assign({useFetchStreams:t},n),s._setSettings(n),s}),"PUBLIC").setMultipleInstances(!0)),us(Hc,"4.6.1",e),us(Hc,"4.6.1","esm2017")}();class Pg{constructor(e,t){this._delegate=e,this.firebase=t,$r(e,new Un("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),cs(this._delegate))))}_getService(e,t=jr){var i;this._delegate.checkDestroyed();const n=this._delegate.container.getProvider(e);return n.isInitialized()||"EXPLICIT"!==(null===(i=n.getComponent())||void 0===i?void 0:i.instantiationMode)||n.initialize(),n.getImmediate({identifier:t})}_removeServiceInstance(e,t=jr){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){$r(this._delegate,e)}_addOrOverwriteComponent(e){Zr(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const kg=new An("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),Rg=function t(){const i=function(t){const i={},n={__esModule:!0,initializeApp:function(e,r={}){const s=ss(e,r);if(Pn(i,s.name))return i[s.name];const o=new t(s,n);return i[s.name]=o,o},app:r,registerVersion:us,setLogLevel:ds,onLog:hs,apps:null,SDK_VERSION:rs,INTERNAL:{registerComponent:function(e){const i=e.name,s=i.replace("-compat","");if(Xr(e)&&"PUBLIC"===e.type){const o=(e=r())=>{if("function"!=typeof e[s])throw kg.create("invalid-app-argument",{appName:i});return e[s]()};void 0!==e.serviceProps&&gn(o,e.serviceProps),n[s]=o,t.prototype[s]=function(...t){return this._getService.bind(this,i).apply(this,e.multipleInstances?t:[])}}return"PUBLIC"===e.type?n[s]:null},removeApp:function(e){delete i[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:e}};function r(e){if(!Pn(i,e=e||jr))throw kg.create("no-app",{appName:e});return i[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(i).map((e=>i[e]))}}),r.App=t,n}(Pg);return i.INTERNAL=Object.assign(Object.assign({},i.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(e){gn(i,e)},createSubscribe:Nn,ErrorFactory:An,deepExtend:gn}),i}(),Lg=new Yn("@firebase/app-compat");if(wn()&&void 0!==self.firebase){Lg.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&Lg.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const Dg=Rg;function Og(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}us("@firebase/app-compat","0.2.32",void 0),Dg.registerVersion("firebase","10.11.1","app-compat"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Ng={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"};const zg=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},Fg=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Bg=new An("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Ug=new Yn("@firebase/auth");function Vg(e,...t){Ug.logLevel<=Wn.ERROR&&Ug.error(`Auth (${rs}): ${e}`,...t)}function jg(e,...t){throw $g(e,...t)}function Gg(e,...t){return $g(e,...t)}function Hg(e,t,i){const n=Object.assign(Object.assign({},Fg()),{[t]:i});return new An("auth","Firebase",n).create(t,{appName:e.name})}function Wg(e){return Hg(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function qg(e,t,i){if(!(t instanceof i))throw i.name!==t.constructor.name&&jg(e,"argument-error"),Hg(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function $g(e,...t){if("string"!=typeof e){const i=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(i,...n)}return Bg.create(e,...t)}function Zg(e,t,...i){if(!e)throw $g(t,...i)}function Xg(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Vg(t),new Error(t)}function Yg(e,t){e||Xg(t)}function Kg(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Jg(){return"http:"===Qg()||"https:"===Qg()}function Qg(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class e_{constructor(e,t){this.shortDelay=e,this.longDelay=t,Yg(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(xn())||Tn()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Jg()||Sn()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function t_(e,t){Yg(e.emulator,"Emulator should always be set here");const{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class i_{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Xg("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Xg("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Xg("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const n_={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},r_=new e_(3e4,6e4);function s_(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function o_(e,t,i,n,r={}){return a_(e,r,(async()=>{let r={},s={};n&&("GET"===t?s=n:r={body:JSON.stringify(n)});const o=Ln(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),i_.fetch()(c_(e,e.config.apiHost,i,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},r))}))}async function a_(e,t,i){e._canInitEmulator=!1;const n=Object.assign(Object.assign({},n_),t);try{const t=new h_(e),r=await Promise.race([i(),t.promise]);t.clearNetworkTimeout();const s=await r.json();if("needConfirmation"in s)throw d_(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{const t=r.ok?s.errorMessage:s.error.message,[i,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===i)throw d_(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===i)throw d_(e,"email-already-in-use",s);if("USER_DISABLED"===i)throw d_(e,"user-disabled",s);const a=n[i]||i.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Hg(e,a,o);jg(e,a)}}catch(t){if(t instanceof In)throw t;jg(e,"network-request-failed",{message:String(t)})}}async function l_(e,t,i,n,r={}){const s=await o_(e,t,i,n,r);return"mfaPendingCredential"in s&&jg(e,"multi-factor-auth-required",{_serverResponse:s}),s}function c_(e,t,i,n){const r=`${t}${i}?${n}`;return e.config.emulator?t_(e.config,r):`${e.config.apiScheme}://${r}`}function u_(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class h_{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Gg(this.auth,"network-request-failed"))),r_.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function d_(e,t,i){const n={appName:e.name};i.email&&(n.email=i.email),i.phoneNumber&&(n.phoneNumber=i.phoneNumber);const r=Gg(e,t,n);return r.customData._tokenResponse=i,r}function p_(e){return void 0!==e&&void 0!==e.getResponse}function f_(e){return void 0!==e&&void 0!==e.enterprise}class m_{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return u_(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function g_(e,t){return o_(e,"POST","/v1/accounts:lookup",t)}function __(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function y_(e){return 1e3*Number(e)}function v_(e){const[t,i,n]=e.split(".");if(void 0===t||void 0===i||void 0===n)return Vg("JWT malformed, contained fewer than 3 sections"),null;try{const e=mn(i);return e?JSON.parse(e):(Vg("Failed to decode base64 JWT payload"),null)}catch(e){return Vg("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function x_(e){const t=v_(e);return Zg(t,"internal-error"),Zg(void 0!==t.exp,"internal-error"),Zg(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function b_(e,t,i=!1){if(i)return t;try{return await t}catch(t){throw t instanceof In&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class w_{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class S_{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=__(this.lastLoginAt),this.creationTime=__(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function T_(e){var t;const i=e.auth,n=await e.getIdToken(),r=await b_(e,g_(i,{idToken:n}));Zg(null==r?void 0:r.users.length,i,"internal-error");const s=r.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?E_(s.providerUserInfo):[],a=function(e,t){const i=e.filter((e=>!t.some((t=>t.providerId===e.providerId))));return[...i,...t]}(e.providerData,o),l=e.isAnonymous,c=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),u=!!l&&c,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new S_(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(e,h)}function E_(e){return e.map((e=>{var{providerId:t}=e,i=Og(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}}))}class M_{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Zg(e.idToken,"internal-error"),Zg(void 0!==e.idToken,"internal-error"),Zg(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):x_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Zg(0!==e.length,"internal-error");const t=x_(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(Zg(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:n,expiresIn:r}=await async function(e,t){const i=await a_(e,{},(async()=>{const i=Ln({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:r}=e.config,s=c_(e,n,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",i_.fetch()(s,{method:"POST",headers:o,body:i})}));return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}(e,t);this.updateTokensAndExpiration(i,n,Number(r))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*i}static fromJSON(e,t){const{refreshToken:i,accessToken:n,expirationTime:r}=t,s=new M_;return i&&(Zg("string"==typeof i,"internal-error",{appName:e}),s.refreshToken=i),n&&(Zg("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),r&&(Zg("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new M_,this.toJSON())}_performRefresh(){return Xg("not implemented")}}function I_(e,t){Zg("string"==typeof e||void 0===e,"internal-error",{appName:t})}class A_{constructor(e){var{uid:t,auth:i,stsTokenManager:n}=e,r=Og(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new w_(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new S_(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await b_(this,this.stsTokenManager.getToken(this.auth,e));return Zg(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const i=Bn(e),n=await i.getIdToken(t),r=v_(n);Zg(r&&r.exp&&r.auth_time&&r.iat,i.auth,"internal-error");const s="object"==typeof r.firebase?r.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:r,token:n,authTime:__(y_(r.auth_time)),issuedAtTime:__(y_(r.iat)),expirationTime:__(y_(r.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Bn(e);await T_(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Zg(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new A_(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Zg(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await T_(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Qr(this.auth.app))return Promise.reject(Wg(this.auth));const e=await this.getIdToken();return await b_(this,async function(e,t){return o_(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,n,r,s,o,a,l,c;const u=null!==(i=t.displayName)&&void 0!==i?i:void 0,h=null!==(n=t.email)&&void 0!==n?n:void 0,d=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,f=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(l=t.createdAt)&&void 0!==l?l:void 0,_=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:y,emailVerified:v,isAnonymous:x,providerData:b,stsTokenManager:w}=t;Zg(y&&w,e,"internal-error");const S=M_.fromJSON(this.name,w);Zg("string"==typeof y,e,"internal-error"),I_(u,e.name),I_(h,e.name),Zg("boolean"==typeof v,e,"internal-error"),Zg("boolean"==typeof x,e,"internal-error"),I_(d,e.name),I_(p,e.name),I_(f,e.name),I_(m,e.name),I_(g,e.name),I_(_,e.name);const T=new A_({uid:y,auth:e,email:h,emailVerified:v,displayName:u,isAnonymous:x,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:S,createdAt:g,lastLoginAt:_});return b&&Array.isArray(b)&&(T.providerData=b.map((e=>Object.assign({},e)))),m&&(T._redirectEventId=m),T}static async _fromIdTokenResponse(e,t,i=!1){const n=new M_;n.updateFromServerResponse(t);const r=new A_({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:i});return await T_(r),r}static async _fromGetAccountInfoResponse(e,t,i){const n=t.users[0];Zg(void 0!==n.localId,"internal-error");const r=void 0!==n.providerUserInfo?E_(n.providerUserInfo):[],s=!(n.email&&n.passwordHash||(null==r?void 0:r.length)),o=new M_;o.updateFromIdToken(i);const a=new A_({uid:n.localId,auth:e,stsTokenManager:o,isAnonymous:s}),l={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:r,metadata:new S_(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash||(null==r?void 0:r.length))};return Object.assign(a,l),a}}const C_=new Map;function P_(e){Yg(e instanceof Function,"Expected a class definition");let t=C_.get(e);return t?(Yg(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,C_.set(e,t),t)}class k_{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}k_.type="NONE";const R_=k_;function L_(e,t,i){return`firebase:${e}:${t}:${i}`}class D_{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:n,name:r}=this.auth;this.fullUserKey=L_(this.userKey,n.apiKey,r),this.fullPersistenceKey=L_("persistence",n.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?A_._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new D_(P_(R_),e,i);const n=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let r=n[0]||P_(R_);const s=L_(i,e.config.apiKey,e.name);let o=null;for(const i of t)try{const t=await i._get(s);if(t){const n=A_._fromJSON(e,t);i!==r&&(o=n),r=i;break}}catch(e){}const a=n.filter((e=>e._shouldAllowMigration));return r._shouldAllowMigration&&a.length?(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==r)try{await e._remove(s)}catch(e){}}))),new D_(r,e,i)):new D_(r,e,i)}}function O_(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(B_(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(N_(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(V_(t))return"Blackberry";if(j_(t))return"Webos";if(z_(t))return"Safari";if((t.includes("chrome/")||F_(t))&&!t.includes("edge/"))return"Chrome";if(U_(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=e.match(t);if(2===(null==i?void 0:i.length))return i[1]}return"Other"}function N_(e=xn()){return/firefox\//i.test(e)}function z_(e=xn()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function F_(e=xn()){return/crios\//i.test(e)}function B_(e=xn()){return/iemobile/i.test(e)}function U_(e=xn()){return/android/i.test(e)}function V_(e=xn()){return/blackberry/i.test(e)}function j_(e=xn()){return/webos/i.test(e)}function G_(e=xn()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function H_(e=xn()){return G_(e)||U_(e)||j_(e)||V_(e)||/windows phone/i.test(e)||B_(e)}function W_(e,t=[]){let i;switch(e){case"Browser":i=O_(xn());break;case"Worker":i=`${O_(xn())}-${e}`;break;default:i=e}const n=t.length?t.join(","):"FirebaseCore-web";return`${i}/JsCore/${rs}/${n}`}class q_{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=t=>new Promise(((i,n)=>{try{i(e(t))}catch(e){n(e)}}));i.onAbort=t,this.queue.push(i);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class $_{constructor(e){var t,i,n,r;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(i=e.allowedNonAlphanumericCharacters)||void 0===i?void 0:i.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(r=e.forceUpgradeOnSignin)&&void 0!==r&&r,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,n,r,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(i=a.meetsMaxPasswordLength)||void 0===i||i),a.isValid&&(a.isValid=null===(n=a.containsLowercaseLetter)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsUppercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let i;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)i=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,n,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class Z_{constructor(e,t,i,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Y_(this),this.idTokenSubscription=new Y_(this),this.beforeStateQueue=new q_(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Bg,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=P_(t)),this._initializationPromise=this.queue((async()=>{var i,n;if(!this._deleted&&(this.persistenceManager=await D_.create(this,e),!this._deleted)){if(null===(i=this._popupRedirectResolver)||void 0===i?void 0:i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(n=this.currentUser)||void 0===n?void 0:n.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await g_(this,{idToken:e}),i=await A_._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Qr(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let n=i,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==n?void 0:n._redirectEventId,o=await this.tryRedirectSignIn(e);i&&i!==s||!(null==o?void 0:o.user)||(n=o.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=i,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return Zg(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await T_(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Qr(this.app))return Promise.reject(Wg(this));const t=e?Bn(e):null;return t&&Zg(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Zg(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return Qr(this.app)?Promise.reject(Wg(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Qr(this.app)?Promise.reject(Wg(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(P_(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return o_(e,"GET","/v2/passwordPolicy",s_(e,t))}(this),t=new $_(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new An("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged((()=>{i(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return o_(e,"POST","/v2/accounts:revokeToken",s_(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return null===e?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&P_(e)||this._popupRedirectResolver;Zg(t,this,"argument-error"),this.redirectPersistenceManager=await D_.create(this,[P_(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(i=this.redirectUser)||void 0===i?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,n){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Zg(o,this,"internal-error"),o.then((()=>{s||r(this.currentUser)})),"function"==typeof t){const r=e.addObserver(t,i,n);return()=>{s=!0,r()}}{const i=e.addObserver(t);return()=>{s=!0,i()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Zg(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=W_(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());i&&(t["X-Firebase-Client"]=i);const n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Ug.logLevel<=Wn.WARN&&Ug.warn(`Auth (${rs}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function X_(e){return Bn(e)}class Y_{constructor(e){this.auth=e,this.observer=null,this.addObserver=Nn((e=>this.observer=e))}get next(){return Zg(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let K_={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function J_(e){return K_.loadJS(e)}function Q_(e){return`__${e}${Math.floor(1e6*Math.random())}`}class ey{constructor(e){this.type="recaptcha-enterprise",this.auth=X_(e)}async verify(e="verify",t=!1){function i(t,i,n){const r=window.grecaptcha;f_(r)?r.enterprise.ready((()=>{r.enterprise.execute(t,{action:e}).then((e=>{i(e)})).catch((()=>{i("NO_RECAPTCHA")}))})):n(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,n)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,i)=>{(async function(e,t){return o_(e,"GET","/v2/recaptchaConfig",s_(e,t))})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((n=>{if(void 0!==n.recaptchaKey){const i=new m_(n);return null==e.tenantId?e._agentRecaptchaConfig=i:e._tenantRecaptchaConfigs[e.tenantId]=i,t(i.siteKey)}i(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{i(e)}))}))})(this.auth).then((r=>{if(!t&&f_(window.grecaptcha))i(r,e,n);else{if("undefined"==typeof window)return void n(new Error("RecaptchaVerifier is only supported in browser"));let t=K_.recaptchaEnterpriseScript;0!==t.length&&(t+=r),J_(t).then((()=>{i(r,e,n)})).catch((e=>{n(e)}))}})).catch((e=>{n(e)}))}))}}async function ty(e,t,i,n=!1){const r=new ey(e);let s;try{s=await r.verify(i)}catch(e){s=await r.verify(i,!0)}const o=Object.assign({},t);return n?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function iy(e,t,i,n){var r;if(null===(r=e._getRecaptchaConfig())||void 0===r?void 0:r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await ty(e,t,i,"getOobCode"===i);return n(e,r)}return n(e,t).catch((async r=>{if("auth/missing-recaptcha-token"===r.code){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const r=await ty(e,t,i,"getOobCode"===i);return n(e,r)}return Promise.reject(r)}))}function ny(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function ry(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class sy{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Xg("not implemented")}_getIdTokenResponse(e){return Xg("not implemented")}_linkToIdToken(e,t){return Xg("not implemented")}_getReauthenticationResolver(e){return Xg("not implemented")}}async function oy(e,t){return o_(e,"POST","/v1/accounts:resetPassword",s_(e,t))}async function ay(e,t){return o_(e,"POST","/v1/accounts:signUp",t)}async function ly(e,t){return l_(e,"POST","/v1/accounts:signInWithPassword",s_(e,t))}async function cy(e,t){return o_(e,"POST","/v1/accounts:sendOobCode",s_(e,t))}async function uy(e,t){return cy(e,t)}async function hy(e,t){return cy(e,t)}class dy extends sy{constructor(e,t,i,n=null){super("password",i),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new dy(e,t,"password")}static _fromEmailAndCode(e,t,i=null){return new dy(e,t,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return iy(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",ly);case"emailLink":return async function(e,t){return l_(e,"POST","/v1/accounts:signInWithEmailLink",s_(e,t))}(e,{email:this._email,oobCode:this._password});default:jg(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return iy(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ay);case"emailLink":return async function(e,t){return l_(e,"POST","/v1/accounts:signInWithEmailLink",s_(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:jg(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function py(e,t){return l_(e,"POST","/v1/accounts:signInWithIdp",s_(e,t))}class fy extends sy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new fy(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):jg("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:i,signInMethod:n}=t,r=Og(t,["providerId","signInMethod"]);if(!i||!n)return null;const s=new fy(i,n);return s.idToken=r.idToken||void 0,s.accessToken=r.accessToken||void 0,s.secret=r.secret,s.nonce=r.nonce,s.pendingToken=r.pendingToken||null,s}_getIdTokenResponse(e){return py(e,this.buildRequest())}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,py(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,py(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ln(t)}return e}}const my={USER_NOT_FOUND:"user-not-found"};class gy extends sy{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new gy({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new gy({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return l_(e,"POST","/v1/accounts:signInWithPhoneNumber",s_(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const i=await l_(e,"POST","/v1/accounts:signInWithPhoneNumber",s_(e,t));if(i.temporaryProof)throw d_(e,"account-exists-with-different-credential",i);return i}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return l_(e,"POST","/v1/accounts:signInWithPhoneNumber",s_(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),my)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:i,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:i,code:n}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:i,phoneNumber:n,temporaryProof:r}=e;return i||t||n||r?new gy({verificationId:t,verificationCode:i,phoneNumber:n,temporaryProof:r}):null}}class _y{constructor(e){var t,i,n,r,s,o;const a=Dn(On(e)),l=null!==(t=a.apiKey)&&void 0!==t?t:null,c=null!==(i=a.oobCode)&&void 0!==i?i:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(n=a.mode)&&void 0!==n?n:null);Zg(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!==(r=a.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=Dn(On(e)).link,i=t?Dn(On(t)).deep_link_id:null,n=Dn(On(e)).deep_link_id;return(n?Dn(On(n)).link:null)||n||i||t||e}(e);try{return new _y(t)}catch(e){return null}}}class yy{constructor(){this.providerId=yy.PROVIDER_ID}static credential(e,t){return dy._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const i=_y.parseLink(t);return Zg(i,"argument-error"),dy._fromEmailAndCode(e,i.code,i.tenantId)}}yy.PROVIDER_ID="password",yy.EMAIL_PASSWORD_SIGN_IN_METHOD="password",yy.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class vy{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class xy extends vy{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class by extends xy{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return Zg("providerId"in t&&"signInMethod"in t,"argument-error"),fy._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Zg(e.idToken||e.accessToken,"argument-error"),fy._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return by.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return by.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i,oauthTokenSecret:n,pendingToken:r,nonce:s,providerId:o}=e;if(!(i||n||t||r))return null;if(!o)return null;try{return new by(o)._credential({idToken:t,accessToken:i,nonce:s,pendingToken:r})}catch(e){return null}}}class wy extends xy{constructor(){super("facebook.com")}static credential(e){return fy._fromParams({providerId:wy.PROVIDER_ID,signInMethod:wy.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return wy.credentialFromTaggedObject(e)}static credentialFromError(e){return wy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return wy.credential(e.oauthAccessToken)}catch(e){return null}}}wy.FACEBOOK_SIGN_IN_METHOD="facebook.com",wy.PROVIDER_ID="facebook.com";class Sy extends xy{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return fy._fromParams({providerId:Sy.PROVIDER_ID,signInMethod:Sy.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Sy.credentialFromTaggedObject(e)}static credentialFromError(e){return Sy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return Sy.credential(t,i)}catch(e){return null}}}Sy.GOOGLE_SIGN_IN_METHOD="google.com",Sy.PROVIDER_ID="google.com";class Ty extends xy{constructor(){super("github.com")}static credential(e){return fy._fromParams({providerId:Ty.PROVIDER_ID,signInMethod:Ty.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ty.credentialFromTaggedObject(e)}static credentialFromError(e){return Ty.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ty.credential(e.oauthAccessToken)}catch(e){return null}}}Ty.GITHUB_SIGN_IN_METHOD="github.com",Ty.PROVIDER_ID="github.com";class Ey extends sy{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return py(e,this.buildRequest())}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,py(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,py(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:i,signInMethod:n,pendingToken:r}=t;return i&&n&&r&&i===n?new Ey(i,r):null}static _create(e,t){return new Ey(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class My extends vy{constructor(e){Zg(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return My.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return My.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Ey.fromJSON(e);return Zg(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:i}=e;if(!t||!i)return null;try{return Ey._create(i,t)}catch(e){return null}}}class Iy extends xy{constructor(){super("twitter.com")}static credential(e,t){return fy._fromParams({providerId:Iy.PROVIDER_ID,signInMethod:Iy.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Iy.credentialFromTaggedObject(e)}static credentialFromError(e){return Iy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return Iy.credential(t,i)}catch(e){return null}}}async function Ay(e,t){return l_(e,"POST","/v1/accounts:signUp",s_(e,t))}Iy.TWITTER_SIGN_IN_METHOD="twitter.com",Iy.PROVIDER_ID="twitter.com";class Cy{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,n=!1){const r=await A_._fromIdTokenResponse(e,i,n),s=Py(i);return new Cy({user:r,providerId:s,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const n=Py(i);return new Cy({user:e,providerId:n,_tokenResponse:i,operationType:t})}}function Py(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class ky extends In{constructor(e,t,i,n){var r;super(t.code,t.message),this.operationType=i,this.user=n,Object.setPrototypeOf(this,ky.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,n){return new ky(e,t,i,n)}}function Ry(e,t,i,n){return("reauthenticate"===t?i._getReauthenticationResolver(e):i._getIdTokenResponse(e)).catch((i=>{if("auth/multi-factor-auth-required"===i.code)throw ky._fromErrorAndOperation(e,i,t,n);throw i}))}function Ly(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function Dy(e,t,i=!1){const n=await b_(e,t._linkToIdToken(e.auth,await e.getIdToken()),i);return Cy._forOperation(e,"link",n)}async function Oy(e,t,i){await T_(t);const n=!1===e?"provider-already-linked":"no-such-provider";Zg(Ly(t.providerData).has(i)===e,t.auth,n)}async function Ny(e,t,i=!1){const{auth:n}=e;if(Qr(n.app))return Promise.reject(Wg(n));const r="reauthenticate";try{const s=await b_(e,Ry(n,r,t,e),i);Zg(s.idToken,n,"internal-error");const o=v_(s.idToken);Zg(o,n,"internal-error");const{sub:a}=o;return Zg(e.uid===a,n,"user-mismatch"),Cy._forOperation(e,r,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&jg(n,"user-mismatch"),e}}async function zy(e,t,i=!1){if(Qr(e.app))return Promise.reject(Wg(e));const n="signIn",r=await Ry(e,n,t),s=await Cy._fromIdTokenResponse(e,n,r);return i||await e._updateCurrentUser(s.user),s}async function Fy(e,t){return zy(X_(e),t)}async function By(e,t){const i=Bn(e);return await Oy(!1,i,t.providerId),Dy(i,t)}async function Uy(e,t){return Ny(Bn(e),t)}class Vy{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?jy._fromServerResponse(e,t):"totpInfo"in t?Gy._fromServerResponse(e,t):jg(e,"internal-error")}}class jy extends Vy{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new jy(t)}}class Gy extends Vy{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Gy(t)}}function Hy(e,t,i){var n;Zg((null===(n=i.url)||void 0===n?void 0:n.length)>0,e,"invalid-continue-uri"),Zg(void 0===i.dynamicLinkDomain||i.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=i.url,t.dynamicLinkDomain=i.dynamicLinkDomain,t.canHandleCodeInApp=i.handleCodeInApp,i.iOS&&(Zg(i.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=i.iOS.bundleId),i.android&&(Zg(i.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=i.android.installApp,t.androidMinimumVersionCode=i.android.minimumVersion,t.androidPackageName=i.android.packageName)}async function Wy(e){const t=X_(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function qy(e,t){const i=Bn(e),n=await oy(i,{oobCode:t}),r=n.requestType;switch(Zg(r,i,"internal-error"),r){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Zg(n.newEmail,i,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Zg(n.mfaInfo,i,"internal-error");default:Zg(n.email,i,"internal-error")}let s=null;return n.mfaInfo&&(s=Vy._fromServerResponse(X_(i),n.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===n.requestType?n.newEmail:n.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===n.requestType?n.email:n.newEmail)||null,multiFactorInfo:s},operation:r}}async function $y(e,t,i){const{auth:n}=e,r={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(r.email=t),i&&(r.password=i);const s=await b_(e,async function(e,t){return o_(e,"POST","/v1/accounts:update",t)}(n,r));await e._updateTokensIfNecessary(s,!0)}class Zy{constructor(e,t,i={}){this.isNewUser=e,this.providerId=t,this.profile=i}}class Xy extends Zy{constructor(e,t,i,n){super(e,t,i),this.username=n}}class Yy extends Zy{constructor(e,t){super(e,"facebook.com",t)}}class Ky extends Xy{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Jy extends Zy{constructor(e,t){super(e,"google.com",t)}}class Qy extends Xy{constructor(e,t,i){super(e,"twitter.com",t,i)}}function ev(e){const{user:t,_tokenResponse:i}=e;return t.isAnonymous&&!i?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,i;if(!e)return null;const{providerId:n}=e,r=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!n&&(null==e?void 0:e.idToken)){const n=null===(i=null===(t=v_(e.idToken))||void 0===t?void 0:t.firebase)||void 0===i?void 0:i.sign_in_provider;if(n)return new Zy(s,"anonymous"!==n&&"custom"!==n?n:null)}if(!n)return null;switch(n){case"facebook.com":return new Yy(s,r);case"github.com":return new Ky(s,r);case"google.com":return new Jy(s,r);case"twitter.com":return new Qy(s,r,e.screenName||null);case"custom":case"anonymous":return new Zy(s,null);default:return new Zy(s,n,r)}}(i)}class tv{constructor(e,t,i){this.type=e,this.credential=t,this.user=i}static _fromIdtoken(e,t){return new tv("enroll",e,t)}static _fromMfaPendingCredential(e){return new tv("signin",e)}toJSON(){const e="enroll"===this.type?"idToken":"pendingCredential";return{multiFactorSession:{[e]:this.credential}}}static fromJSON(e){var t,i;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return tv._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(i=e.multiFactorSession)||void 0===i?void 0:i.idToken)return tv._fromIdtoken(e.multiFactorSession.idToken)}return null}}class iv{constructor(e,t,i){this.session=e,this.hints=t,this.signInResolver=i}static _fromError(e,t){const i=X_(e),n=t.customData._serverResponse,r=(n.mfaInfo||[]).map((e=>Vy._fromServerResponse(i,e)));Zg(n.mfaPendingCredential,i,"internal-error");const s=tv._fromMfaPendingCredential(n.mfaPendingCredential);return new iv(s,r,(async e=>{const r=await e._process(i,s);delete n.mfaInfo,delete n.mfaPendingCredential;const o=Object.assign(Object.assign({},n),{idToken:r.idToken,refreshToken:r.refreshToken});switch(t.operationType){case"signIn":const e=await Cy._fromIdTokenResponse(i,t.operationType,o);return await i._updateCurrentUser(e.user),e;case"reauthenticate":return Zg(t.user,i,"internal-error"),Cy._forOperation(t.user,t.operationType,o);default:jg(i,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}class nv{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>Vy._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new nv(e)}async getSession(){return tv._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const i=e,n=await this.getSession(),r=await b_(this.user,i._process(this.user.auth,n,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,i=await this.user.getIdToken();try{const e=await b_(this.user,function(e,t){return o_(e,"POST","/v2/accounts/mfaEnrollment:withdraw",s_(e,t))}(this.user.auth,{idToken:i,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}const rv=new WeakMap,sv="__sak";class ov{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(sv,"1"),this.storage.removeItem(sv),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class av extends ov{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=xn();return z_(e)||G_(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=H_(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),n=this.localCache[t];i!==n&&e(t,n,i)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,i)=>{this.notifyListeners(e,i)}));const i=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const n=this.storage.getItem(i);if(e.newValue!==n)null!==e.newValue?this.storage.setItem(i,e.newValue):this.storage.removeItem(i);else if(this.localCache[i]===e.newValue&&!t)return}const n=()=>{const e=this.storage.getItem(i);(t||this.localCache[i]!==e)&&this.notifyListeners(i,e)},r=this.storage.getItem(i);En()&&10===document.documentMode&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const e of Array.from(i))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}av.type="LOCAL";const lv=av;class cv extends ov{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}cv.type="SESSION";const uv=cv;class hv{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const i=new hv(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:n,data:r}=t.data,s=this.handlersMap[n];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:n});const o=Array.from(s).map((async e=>e(t.origin,r))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:i,eventType:n,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function dv(e="",t=10){let i="";for(let e=0;e<t;e++)i+=Math.floor(10*Math.random());return e+i}hv.receivers=[];class pv{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const n="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let r,s;return new Promise(((o,a)=>{const l=dv("",20);n.port1.start();const c=setTimeout((()=>{a(new Error("unsupported_event"))}),i);s={messageChannel:n,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),r=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),o(t.data.response);break;default:clearTimeout(c),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(s),n.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[n.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function fv(){return window}function mv(){return void 0!==fv().WorkerGlobalScope&&"function"==typeof fv().importScripts}const gv="firebaseLocalStorageDb",_v="firebaseLocalStorage",yv="fbase_key";class vv{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function xv(e,t){return e.transaction([_v],t?"readwrite":"readonly").objectStore(_v)}function bv(){const e=indexedDB.open(gv,1);return new Promise(((t,i)=>{e.addEventListener("error",(()=>{i(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(_v,{keyPath:yv})}catch(e){i(e)}})),e.addEventListener("success",(async()=>{const i=e.result;i.objectStoreNames.contains(_v)?t(i):(i.close(),await function(){const e=indexedDB.deleteDatabase(gv);return new vv(e).toPromise()}(),t(await bv()))}))}))}async function wv(e,t,i){const n=xv(e,!0).put({[yv]:t,value:i});return new vv(n).toPromise()}function Sv(e,t){const i=xv(e,!0).delete(t);return new vv(i).toPromise()}class Tv{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await bv()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return mv()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=hv._getInstance(mv()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new pv(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&(null===(e=i[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=i[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await bv();return await wv(e,sv,"1"),await Sv(e,sv),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((i=>wv(i,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const i=xv(e,!1).get(t),n=await new vv(i).toPromise();return void 0===n?null:n.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Sv(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=xv(e,!1).getAll();return new vv(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],i=new Set;if(0!==e.length)for(const{fbase_key:n,value:r}of e)i.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(r)&&(this.notifyListeners(n,r),t.push(n));for(const e of Object.keys(this.localCache))this.localCache[e]&&!i.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const e of Array.from(i))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Tv.type="LOCAL";const Ev=Tv,Mv=1e12;class Iv{constructor(e){this.auth=e,this.counter=Mv,this._widgets=new Map}render(e,t){const i=this.counter;return this._widgets.set(i,new Av(e,this.auth.name,t||{})),this.counter++,i}reset(e){var t;const i=e||Mv;null===(t=this._widgets.get(i))||void 0===t||t.delete(),this._widgets.delete(i)}getResponse(e){var t;const i=e||Mv;return(null===(t=this._widgets.get(i))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const i=e||Mv;return null===(t=this._widgets.get(i))||void 0===t||t.execute(),""}}class Av{constructor(e,t,i){this.params=i,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const n="string"==typeof e?document.getElementById(e):e;Zg(n,"argument-error",{appName:t}),this.container=n,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],i="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<50;e++)t.push(i.charAt(Math.floor(62*Math.random())));return t.join("")}();const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Cv=Q_("rcb"),Pv=new e_(3e4,6e4);class kv{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=fv().grecaptcha)||void 0===e?void 0:e.render)}load(e,t=""){return Zg(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&p_(fv().grecaptcha)?Promise.resolve(fv().grecaptcha):new Promise(((i,n)=>{const r=fv().setTimeout((()=>{n(Gg(e,"network-request-failed"))}),Pv.get());fv()[Cv]=()=>{fv().clearTimeout(r),delete fv()[Cv];const s=fv().grecaptcha;if(!s||!p_(s))return void n(Gg(e,"internal-error"));const o=s.render;s.render=(e,t)=>{const i=o(e,t);return this.counter++,i},this.hostLanguage=t,i(s)},J_(`${K_.recaptchaV2Script}?${Ln({onload:Cv,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(r),n(Gg(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=fv().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Rv{async load(e){return new Iv(e)}clearedOneInstance(){}}const Lv="recaptcha",Dv={theme:"light",type:"image"};class Ov{constructor(e,t,i=Object.assign({},Dv)){this.parameters=i,this.type=Lv,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=X_(e),this.isInvisible="invisible"===this.parameters.size,Zg("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const n="string"==typeof t?document.getElementById(t):t;Zg(n,this.auth,"argument-error"),this.container=n,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Rv:new kv,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha();return t.getResponse(e)||new Promise((i=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),i(e))};this.tokenChangeListeners.add(n),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){Zg(!this.parameters.sitekey,this.auth,"argument-error"),Zg(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Zg("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"==typeof e)e(t);else if("string"==typeof e){const i=fv()[e];"function"==typeof i&&i(t)}}}assertNotDestroyed(){Zg(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Zg(Jg()&&!mv(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await o_(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);Zg(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Zg(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Nv{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=gy._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function zv(e,t,i){var n;const r=await i.verify();try{let s;if(Zg("string"==typeof r,e,"argument-error"),Zg(i.type===Lv,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){Zg("enroll"===t.type,e,"internal-error");const i=await function(e,t){return o_(e,"POST","/v2/accounts/mfaEnrollment:start",s_(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:r}});return i.phoneSessionInfo.sessionInfo}{Zg("signin"===t.type,e,"internal-error");const i=(null===(n=s.multiFactorHint)||void 0===n?void 0:n.uid)||s.multiFactorUid;Zg(i,e,"missing-multi-factor-info");const o=await function(e,t){return o_(e,"POST","/v2/accounts/mfaSignIn:start",s_(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{recaptchaToken:r}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return o_(e,"POST","/v1/accounts:sendVerificationCode",s_(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:r});return t}}finally{i._reset()}}class Fv{constructor(e){this.providerId=Fv.PROVIDER_ID,this.auth=X_(e)}verifyPhoneNumber(e,t){return zv(this.auth,e,Bn(t))}static credential(e,t){return gy._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Fv.credentialFromTaggedObject(t)}static credentialFromError(e){return Fv.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:i}=e;return t&&i?gy._fromTokenResponse(t,i):null}}function Bv(e,t){return t?P_(t):(Zg(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Fv.PROVIDER_ID="phone",Fv.PHONE_SIGN_IN_METHOD="phone";class Uv extends sy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return py(e,this._buildIdpRequest())}_linkToIdToken(e,t){return py(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return py(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Vv(e){return zy(e.auth,new Uv(e),e.bypassAuthState)}function jv(e){const{auth:t,user:i}=e;return Zg(i,t,"internal-error"),Ny(i,new Uv(e),e.bypassAuthState)}async function Gv(e){const{auth:t,user:i}=e;return Zg(i,t,"internal-error"),Dy(i,new Uv(e),e.bypassAuthState)}class Hv{constructor(e,t,i,n,r=!1){this.auth=e,this.resolver=i,this.user=n,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:n,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:i,tenantId:r||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Vv;case"linkViaPopup":case"linkViaRedirect":return Gv;case"reauthViaPopup":case"reauthViaRedirect":return jv;default:jg(this.auth,"internal-error")}}resolve(e){Yg(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Yg(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Wv=new e_(2e3,1e4);class qv extends Hv{constructor(e,t,i,n,r){super(e,t,n,r),this.provider=i,this.authWindow=null,this.pollId=null,qv.currentPopupAction&&qv.currentPopupAction.cancel(),qv.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Zg(e,this.auth,"internal-error"),e}async onExecution(){Yg(1===this.filter.length,"Popup operations only handle one event");const e=dv();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Gg(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Gg(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,qv.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;(null===(i=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===i?void 0:i.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Gg(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Wv.get())};e()}}qv.currentPopupAction=null;const $v="pendingRedirect",Zv=new Map;class Xv extends Hv{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=Zv.get(this.auth._key());if(!e){try{const t=await async function(e,t){const i=Qv(t),n=Jv(e);if(!await n._isAvailable())return!1;const r="true"===await n._get(i);return await n._remove(i),r}(this.resolver,this.auth),i=t?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Zv.set(this.auth._key(),e)}return this.bypassAuthState||Zv.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Yv(e,t){return Jv(e)._set(Qv(t),"true")}function Kv(e,t){Zv.set(e._key(),t)}function Jv(e){return P_(e._redirectPersistence)}function Qv(e){return L_($v,e.config.apiKey,e.name)}async function ex(e,t,i=!1){if(Qr(e.app))return Promise.reject(Wg(e));const n=X_(e),r=Bv(n,t),s=new Xv(n,r,i),o=await s.execute();return o&&!i&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,t)),o}async function tx(e){const t=dv(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class ix{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return rx(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!rx(e)){const n=(null===(i=e.error.code)||void 0===i?void 0:i.split("auth/")[1])||"internal-error";t.onError(Gg(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(nx(e))}saveEventToCache(e){this.cachedEventUids.add(nx(e)),this.lastProcessedEventTime=Date.now()}}function nx(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function rx({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function sx(e,t={}){return o_(e,"GET","/v1/projects",t)}const ox=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ax=/^https?/;function lx(e){const t=Kg(),{protocol:i,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===n?"chrome-extension:"===i&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===i&&r.hostname===n}if(!ax.test(i))return!1;if(ox.test(e))return n===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(n)}const cx=new e_(3e4,6e4);function ux(){const e=fv().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function hx(e){return new Promise(((t,i)=>{var n,r,s;function o(){ux(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{ux(),i(Gg(e,"network-request-failed"))},timeout:cx.get()})}if(null===(r=null===(n=fv().gapi)||void 0===n?void 0:n.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=fv().gapi)||void 0===s?void 0:s.load)){const t=Q_("iframefcb");return fv()[t]=()=>{gapi.load?o():i(Gg(e,"network-request-failed"))},J_(`${K_.gapiScript}?onload=${t}`).catch((e=>i(e)))}o()}})).catch((e=>{throw dx=null,e}))}let dx=null;const px=new e_(5e3,15e3),fx="__/auth/iframe",mx="emulator/auth/iframe",gx={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_x=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function yx(e){const t=e.config;Zg(t.authDomain,e,"auth-domain-config-required");const i=t.emulator?t_(t,mx):`https://${e.config.authDomain}/${fx}`,n={apiKey:t.apiKey,appName:e.name,v:rs},r=_x.get(e.config.apiHost);r&&(n.eid=r);const s=e._getFrameworks();return s.length&&(n.fw=s.join(",")),`${i}?${Ln(n).slice(1)}`}const vx={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class xx{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const bx="__/auth/handler",wx="emulator/auth/handler",Sx=encodeURIComponent("fac");async function Tx(e,t,i,n,r,s){Zg(e.config.authDomain,e,"auth-domain-config-required"),Zg(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:i,redirectUrl:n,v:rs,eventId:r};if(t instanceof vy){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof xy){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const l=await e._getAppCheckToken(),c=l?`#${Sx}=${encodeURIComponent(l)}`:"";return`${function({config:e}){return e.emulator?t_(e,wx):`https://${e.authDomain}/${bx}`}(e)}?${Ln(a).slice(1)}${c}`}const Ex="webStorageSupport",Mx=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=uv,this._completeRedirectFn=ex,this._overrideRedirectResult=Kv}async _openPopup(e,t,i,n){var r;return Yg(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()"),function(e,t,i,n=500,r=600){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let a="";const l=Object.assign(Object.assign({},vx),{width:n.toString(),height:r.toString(),top:s,left:o}),c=xn().toLowerCase();i&&(a=F_(c)?"_blank":i),N_(c)&&(t=t||"http://localhost",l.scrollbars="yes");const u=Object.entries(l).reduce(((e,[t,i])=>`${e}${t}=${i},`),"");if(function(e=xn()){var t;return G_(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(c)&&"_self"!==a)return function(e,t){const i=document.createElement("a");i.href=e,i.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(n)}(t||"",a),new xx(null);const h=window.open(t||"",a,u);Zg(h,e,"popup-blocked");try{h.focus()}catch(e){}return new xx(h)}(e,await Tx(e,t,i,Kg(),n),dv())}async _openRedirect(e,t,i,n){return await this._originValidation(e),r=await Tx(e,t,i,Kg(),n),fv().location.href=r,new Promise((()=>{}));var r}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:i}=this.eventManagers[t];return e?Promise.resolve(e):(Yg(i,"If manager is not set, promise should be"),i)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch((()=>{delete this.eventManagers[t]})),i}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return dx=dx||hx(e),dx}(e),i=fv().gapi;return Zg(i,e,"internal-error"),t.open({where:document.body,url:yx(e),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:gx,dontclear:!0},(t=>new Promise((async(i,n)=>{await t.restyle({setHideOnLeave:!1});const r=Gg(e,"network-request-failed"),s=fv().setTimeout((()=>{n(r)}),px.get());function o(){fv().clearTimeout(s),i(t)}t.ping(o).then(o,(()=>{n(r)}))}))))}(e),i=new ix(e);return t.register("authEvent",(t=>(Zg(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:i.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ex,{type:Ex},(i=>{var n;const r=null===(n=null==i?void 0:i[0])||void 0===n?void 0:n[Ex];void 0!==r&&t(!!r),jg(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await sx(e);for(const e of t)try{if(lx(e))return}catch(e){}jg(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return H_()||z_()||G_()}};class Ix{constructor(e){this.factorId=e}_process(e,t,i){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,i);case"signin":return this._finalizeSignIn(e,t.credential);default:return Xg("unexpected MultiFactorSessionType")}}}class Ax extends Ix{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Ax(e)}_finalizeEnroll(e,t,i){return function(e,t){return o_(e,"POST","/v2/accounts/mfaEnrollment:finalize",s_(e,t))}(e,{idToken:t,displayName:i,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return o_(e,"POST","/v2/accounts/mfaSignIn:finalize",s_(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class Cx{constructor(){}static assertion(e){return Ax._fromCredential(e)}}Cx.FACTOR_ID="phone";var Px,kx,Rx="@firebase/auth",Lx="1.7.2";class Dx{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Zg(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Ox(){return window}null===(Px=_n())||void 0===Px||Px._authIdTokenMaxAge,function(e){K_=e}({loadJS:e=>new Promise(((t,i)=>{const n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.onerror=e=>{const t=Gg("internal-error");t.customData=e,i(t)},n.type="text/javascript",n.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(n)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),kx="Browser",Xr(new Un("auth",((e,{options:t})=>{const i=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=i.options;Zg(s&&!s.includes(":"),"invalid-api-key",{appName:i.name});const a={apiKey:s,authDomain:o,clientPlatform:kx,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:W_(kx)},l=new Z_(i,n,r,a);return function(e,t){const i=(null==t?void 0:t.persistence)||[],n=(Array.isArray(i)?i:[i]).map(P_);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,null==t?void 0:t.popupRedirectResolver)}(l,t),l}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,i)=>{e.getProvider("auth-internal").initialize()}))),Xr(new Un("auth-internal",(e=>(e=>new Dx(e))(X_(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),us(Rx,Lx,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(kx)),us(Rx,Lx,"esm2017");class Nx extends ix{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function zx(e){const t=await Bx()._get(Ux(e));return t&&await Bx()._remove(Ux(e)),t}function Fx(){const e=[];for(let t=0;t<20;t++){const t=Math.floor(62*Math.random());e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(t))}return e.join("")}function Bx(){return P_(lv)}function Ux(e){return L_("authEvent",e.config.apiKey,e.name)}function Vx(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...i]=e.split("?");return Dn(i.join("?"))}const jx=class{constructor(){this._redirectPersistence=uv,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=ex,this._overrideRedirectResult=Kv}async _initialize(e){const t=e._key();let i=this.eventManagers.get(t);return i||(i=new Nx(e),this.eventManagers.set(t,i),this.attachCallbackListeners(e,i)),i}_openPopup(e){jg(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,i,n){!function(e){var t,i,n,r,s,o,a,l,c,u;const h=Ox();Zg("function"==typeof(null===(t=null==h?void 0:h.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),Zg(void 0!==(null===(i=null==h?void 0:h.BuildInfo)||void 0===i?void 0:i.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),Zg("function"==typeof(null===(s=null===(r=null===(n=null==h?void 0:h.cordova)||void 0===n?void 0:n.plugins)||void 0===r?void 0:r.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Zg("function"==typeof(null===(l=null===(a=null===(o=null==h?void 0:h.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===l?void 0:l.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Zg("function"==typeof(null===(u=null===(c=null==h?void 0:h.cordova)||void 0===c?void 0:c.InAppBrowser)||void 0===u?void 0:u.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const r=await this._initialize(e);await r.initialized(),r.resetRedirect(),Zv.clear(),await this._originValidation(e);const s=function(e,t,i=null){return{type:t,eventId:i,urlResponse:null,sessionId:Fx(),postBody:null,tenantId:e.tenantId,error:Gg(e,"no-auth-event")}}(e,i,n);await function(e,t){return Bx()._set(Ux(e),t)}(e,s);const o=await async function(e,t,i){var n;const{BuildInfo:r}=Ox();Yg(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(Yg(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),i=new Uint8Array(t);for(let t=0;t<e.length;t++)i[t]=e.charCodeAt(t);return i}(e),i=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(i)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),o={};return G_()?o.ibi=r.packageName:U_()?o.apn=r.packageName:jg(e,"operation-not-supported-in-this-environment"),r.displayName&&(o.appDisplayName=r.displayName),o.sessionId=s,Tx(e,i,t.type,void 0,null!==(n=t.eventId)&&void 0!==n?n:void 0,o)}(e,s,t);return async function(e,t,i){const{cordova:n}=Ox();let r=()=>{};try{await new Promise(((s,o)=>{let a=null;function l(){var e;s();const t=null===(e=n.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==i?void 0:i.close)&&i.close()}function c(){a||(a=window.setTimeout((()=>{o(Gg(e,"redirect-cancelled-by-user"))}),2e3))}function u(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&c()}t.addPassiveListener(l),document.addEventListener("resume",c,!1),U_()&&document.addEventListener("visibilitychange",u,!1),r=()=>{t.removePassiveListener(l),document.removeEventListener("resume",c,!1),document.removeEventListener("visibilitychange",u,!1),a&&window.clearTimeout(a)}}))}finally{r()}}(e,r,await function(e){const{cordova:t}=Ox();return new Promise((i=>{t.plugins.browsertab.isAvailable((n=>{let r=null;n?t.plugins.browsertab.openUrl(e):r=t.InAppBrowser.open(e,function(e=xn()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),i(r)}))}))}(o))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=Ox(),i={};G_()?i.iosBundleId=t.packageName:U_()?i.androidPackageName=t.packageName:jg(e,"operation-not-supported-in-this-environment"),await sx(e,i)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:i,handleOpenURL:n,BuildInfo:r}=Ox(),s=setTimeout((async()=>{await zx(e),t.onEvent(Gx())}),500),o=async i=>{clearTimeout(s);const n=await zx(e);let r=null;n&&(null==i?void 0:i.url)&&(r=function(e,t){var i,n;const r=function(e){const t=Vx(e),i=t.link?decodeURIComponent(t.link):void 0,n=Vx(i).link,r=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return Vx(r).link||r||n||i||e}(t);if(r.includes("/__/auth/callback")){const t=Vx(r),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(n=null===(i=null==s?void 0:s.code)||void 0===i?void 0:i.split("auth/"))||void 0===n?void 0:n[1],a=o?Gg(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:r,postBody:null}}return null}(n,i.url)),t.onEvent(r||Gx())};void 0!==i&&"function"==typeof i.subscribe&&i.subscribe(null,o);const a=n,l=`${r.packageName.toLowerCase()}://`;Ox().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(l)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}};function Gx(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Gg("no-auth-event")}}function Hx(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Wx(e=xn()){return!("file:"!==Hx()&&"ionic:"!==Hx()&&"capacitor:"!==Hx()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function qx(){try{const e=self.localStorage,t=dv();if(e)return e.setItem(t,"1"),e.removeItem(t),!function(e=xn()){return En()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=xn()){return/Edge\/\d+/.test(e)}(e)}()||Mn()}catch(e){return $x()&&Mn()}return!1}function $x(){return void 0!==i.g&&"WorkerGlobalScope"in i.g&&"importScripts"in i.g}function Zx(){return("http:"===Hx()||"https:"===Hx()||Sn()||Wx())&&!(Tn()||bn())&&qx()&&!$x()}function Xx(){return Wx()&&"undefined"!=typeof document}const Yx={LOCAL:"local",NONE:"none",SESSION:"session"},Kx=Zg,Jx="persistence";async function Qx(e){await e._initializationPromise;const t=eb(),i=L_(Jx,e.config.apiKey,e.name);t&&t.setItem(i,e._getPersistence())}function eb(){var e;try{return(null===(e="undefined"!=typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(e){return null}}const tb=Zg;class ib{constructor(){this.browserResolver=P_(Mx),this.cordovaResolver=P_(jx),this.underlyingResolver=null,this._redirectPersistence=uv,this._completeRedirectFn=ex,this._overrideRedirectResult=Kv}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,i,n){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,i,n)}async _openRedirect(e,t,i,n){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,i,n)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Xx()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return tb(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!Xx()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function nb(e){return e.unwrap()}function rb(e){const{_tokenResponse:t}=e instanceof In?e.customData:e;if(!t)return null;if(!(e instanceof In)&&"temporaryProof"in t&&"phoneNumber"in t)return Fv.credentialFromResult(e);const i=t.providerId;if(!i||i===Ng.PASSWORD)return null;let n;switch(i){case Ng.GOOGLE:n=Sy;break;case Ng.FACEBOOK:n=wy;break;case Ng.GITHUB:n=Ty;break;case Ng.TWITTER:n=Iy;break;default:const{oauthIdToken:e,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return r||s||e||o?o?i.startsWith("saml.")?Ey._create(i,o):fy._fromParams({providerId:i,signInMethod:i,pendingToken:o,idToken:e,accessToken:r}):new by(i).credential({idToken:e,accessToken:r,rawNonce:a}):null}return e instanceof In?n.credentialFromError(e):n.credentialFromResult(e)}function sb(e,t){return t.catch((t=>{throw t instanceof In&&function(e,t){var i;const n=null===(i=t.customData)||void 0===i?void 0:i._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code))t.resolver=new ab(e,function(e,t){var i;const n=Bn(e),r=t;return Zg(t.customData.operationType,n,"argument-error"),Zg(null===(i=r.customData._serverResponse)||void 0===i?void 0:i.mfaPendingCredential,n,"argument-error"),iv._fromError(n,r)}(e,t));else if(n){const e=rb(t),i=t;e&&(i.credential=e,i.tenantId=n.tenantId||void 0,i.email=n.email||void 0,i.phoneNumber=n.phoneNumber||void 0)}}(e,t),t})).then((e=>{const t=e.operationType,i=e.user;return{operationType:t,credential:(n=e,rb(n)),additionalUserInfo:ev(e),user:lb.getOrCreate(i)};var n}))}async function ob(e,t){const i=await t;return{verificationId:i.verificationId,confirm:t=>sb(e,i.confirm(t))}}class ab{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return sb(nb(this.auth),this.resolver.resolveSignIn(e))}}class lb{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=Bn(e);return rv.has(t)||rv.set(t,nv._fromUser(t)),rv.get(t)}(e)}static getOrCreate(e){return lb.USER_MAP.has(e)||lb.USER_MAP.set(e,new lb(e)),lb.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return sb(this.auth,By(this._delegate,e))}async linkWithPhoneNumber(e,t){return ob(this.auth,async function(e,t,i){const n=Bn(e);await Oy(!1,n,"phone");const r=await zv(n.auth,t,Bn(i));return new Nv(r,(e=>By(n,e)))}(this._delegate,e,t))}async linkWithPopup(e){return sb(this.auth,async function(e,t,i){const n=Bn(e);qg(n.auth,t,vy);const r=Bv(n.auth,i);return new qv(n.auth,"linkViaPopup",t,r,n).executeNotNull()}(this._delegate,e,ib))}async linkWithRedirect(e){return await Qx(X_(this.auth)),function(e,t,i){return async function(e,t,i){const n=Bn(e);qg(n.auth,t,vy),await n.auth._initializationPromise;const r=Bv(n.auth,i);await Oy(!1,n,t.providerId),await Yv(r,n.auth);const s=await tx(n);return r._openRedirect(n.auth,t,"linkViaRedirect",s)}(e,t,i)}(this._delegate,e,ib)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return sb(this.auth,Uy(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return ob(this.auth,async function(e,t,i){const n=Bn(e);if(Qr(n.auth.app))return Promise.reject(Wg(n.auth));const r=await zv(n.auth,t,Bn(i));return new Nv(r,(e=>Uy(n,e)))}(this._delegate,e,t))}reauthenticateWithPopup(e){return sb(this.auth,async function(e,t,i){const n=Bn(e);if(Qr(n.auth.app))return Promise.reject(Gg(n.auth,"operation-not-supported-in-this-environment"));qg(n.auth,t,vy);const r=Bv(n.auth,i);return new qv(n.auth,"reauthViaPopup",t,r,n).executeNotNull()}(this._delegate,e,ib))}async reauthenticateWithRedirect(e){return await Qx(X_(this.auth)),function(e,t,i){return async function(e,t,i){const n=Bn(e);if(qg(n.auth,t,vy),Qr(n.auth.app))return Promise.reject(Wg(n.auth));await n.auth._initializationPromise;const r=Bv(n.auth,i);await Yv(r,n.auth);const s=await tx(n);return r._openRedirect(n.auth,t,"reauthViaRedirect",s)}(e,t,i)}(this._delegate,e,ib)}sendEmailVerification(e){return async function(e,t){const i=Bn(e),n={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Hy(i.auth,n,t);const{email:r}=await async function(e,t){return cy(e,t)}(i.auth,n);r!==e.email&&await e.reload()}(this._delegate,e)}async unlink(e){return await async function(e,t){const i=Bn(e);await Oy(!0,i,t);const{providerUserInfo:n}=await async function(e,t){return o_(e,"POST","/v1/accounts:update",t)}(i.auth,{idToken:await i.getIdToken(),deleteProvider:[t]}),r=Ly(n||[]);return i.providerData=i.providerData.filter((e=>r.has(e.providerId))),r.has("phone")||(i.phoneNumber=null),await i.auth._persistUserIfCurrent(i),i}(this._delegate,e),this}updateEmail(e){return function(e,t){const i=Bn(e);return Qr(i.auth.app)?Promise.reject(Wg(i.auth)):$y(i,t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return $y(Bn(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){const i=Bn(e);if(Qr(i.auth.app))return Promise.reject(Wg(i.auth));await Dy(i,t)}(this._delegate,e)}updateProfile(e){return async function(e,{displayName:t,photoURL:i}){if(void 0===t&&void 0===i)return;const n=Bn(e),r={idToken:await n.getIdToken(),displayName:t,photoUrl:i,returnSecureToken:!0},s=await b_(n,async function(e,t){return o_(e,"POST","/v1/accounts:update",t)}(n.auth,r));n.displayName=s.displayName||null,n.photoURL=s.photoUrl||null;const o=n.providerData.find((({providerId:e})=>"password"===e));o&&(o.displayName=n.displayName,o.photoURL=n.photoURL),await n._updateTokensIfNecessary(s)}(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return async function(e,t,i){const n=Bn(e),r={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};i&&Hy(n.auth,r,i);const{email:s}=await async function(e,t){return cy(e,t)}(n.auth,r);s!==e.email&&await e.reload()}(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}lb.USER_MAP=new WeakMap;const cb=Zg;class ub{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:i}=e.options;cb(i,"invalid-api-key",{appName:e.name}),cb(i,"invalid-api-key",{appName:e.name});const n="undefined"!=typeof window?ib:void 0;this._delegate=t.initialize({options:{persistence:db(i,e.name),popupRedirectResolver:n}}),this._delegate._updateErrorMap(zg),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?lb.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){!function(e,t,i){const n=X_(e);Zg(n._canInitEmulator,n,"emulator-config-failed"),Zg(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const r=!!(null==i?void 0:i.disableWarnings),s=ny(t),{host:o,port:a}=function(e){const t=ny(e),i=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!i)return{host:"",port:null};const n=i[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(n);if(r){const e=r[1];return{host:e,port:ry(n.substr(e.length+1))}}{const[e,t]=n.split(":");return{host:e,port:ry(t)}}}(t),l=null===a?"":`:${a}`;n.config.emulator={url:`${s}//${o}${l}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(this._delegate,e,t)}applyActionCode(e){return async function(e,t){await async function(e,t){return o_(e,"POST","/v1/accounts:update",s_(e,t))}(Bn(e),{oobCode:t})}(this._delegate,e)}checkActionCode(e){return qy(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,i){await oy(Bn(e),{oobCode:t,newPassword:i}).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Wy(e),t}))}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return sb(this._delegate,async function(e,t,i){if(Qr(e.app))return Promise.reject(Wg(e));const n=X_(e),r=iy(n,{returnSecureToken:!0,email:t,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ay),s=await r.catch((t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Wy(e),t})),o=await Cy._fromIdTokenResponse(n,"signIn",s);return await n._updateCurrentUser(o.user),o}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return async function(e,t){const i={identifier:t,continueUri:Jg()?Kg():"http://localhost"},{signinMethods:n}=await async function(e,t){return o_(e,"POST","/v1/accounts:createAuthUri",s_(e,t))}(Bn(e),i);return n||[]}(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const i=_y.parseLink(t);return"EMAIL_SIGNIN"===(null==i?void 0:i.operation)}(this._delegate,e)}async getRedirectResult(){cb(Zx(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await X_(e)._initializationPromise,ex(e,t,!1)}(this._delegate,ib);return e?sb(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){X_(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,i){const{next:n,error:r,complete:s}=hb(e,t,i);return this._delegate.onAuthStateChanged(n,r,s)}onIdTokenChanged(e,t,i){const{next:n,error:r,complete:s}=hb(e,t,i);return this._delegate.onIdTokenChanged(n,r,s)}sendSignInLinkToEmail(e,t){return async function(e,t,i){const n=X_(e),r={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};!function(e,t){Zg(t.handleCodeInApp,n,"argument-error"),t&&Hy(n,e,t)}(r,i),await iy(n,r,"getOobCode",hy)}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,i){const n=X_(e),r={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};i&&Hy(n,r,i),await iy(n,r,"getOobCode",uy)}(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){Kx(Object.values(Yx).includes(t),e,"invalid-persistence-type"),Tn()?Kx(t!==Yx.SESSION,e,"unsupported-persistence-type"):bn()?Kx(t===Yx.NONE,e,"unsupported-persistence-type"):$x()?Kx(t===Yx.NONE||t===Yx.LOCAL&&Mn(),e,"unsupported-persistence-type"):Kx(t===Yx.NONE||qx(),e,"unsupported-persistence-type")}(this._delegate,e),e){case Yx.SESSION:t=uv;break;case Yx.LOCAL:t=await P_(Ev)._isAvailable()?Ev:lv;break;case Yx.NONE:t=R_;break;default:return jg("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return sb(this._delegate,async function(e){var t;if(Qr(e.app))return Promise.reject(Wg(e));const i=X_(e);if(await i._initializationPromise,null===(t=i.currentUser)||void 0===t?void 0:t.isAnonymous)return new Cy({user:i.currentUser,providerId:null,operationType:"signIn"});const n=await Ay(i,{returnSecureToken:!0}),r=await Cy._fromIdTokenResponse(i,"signIn",n,!0);return await i._updateCurrentUser(r.user),r}(this._delegate))}signInWithCredential(e){return sb(this._delegate,Fy(this._delegate,e))}signInWithCustomToken(e){return sb(this._delegate,async function(e,t){if(Qr(e.app))return Promise.reject(Wg(e));const i=X_(e),n=await async function(e,t){return l_(e,"POST","/v1/accounts:signInWithCustomToken",s_(e,t))}(i,{token:t,returnSecureToken:!0}),r=await Cy._fromIdTokenResponse(i,"signIn",n);return await i._updateCurrentUser(r.user),r}(this._delegate,e))}signInWithEmailAndPassword(e,t){return sb(this._delegate,function(e,t,i){return Qr(e.app)?Promise.reject(Wg(e)):Fy(Bn(e),yy.credential(t,i)).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Wy(e),t}))}(this._delegate,e,t))}signInWithEmailLink(e,t){return sb(this._delegate,async function(e,t,i){if(Qr(e.app))return Promise.reject(Wg(e));const n=Bn(e),r=yy.credentialWithLink(t,i||Kg());return Zg(r._tenantId===(n.tenantId||null),n,"tenant-id-mismatch"),Fy(n,r)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return ob(this._delegate,async function(e,t,i){if(Qr(e.app))return Promise.reject(Wg(e));const n=X_(e),r=await zv(n,t,Bn(i));return new Nv(r,(e=>Fy(n,e)))}(this._delegate,e,t))}async signInWithPopup(e){return cb(Zx(),this._delegate,"operation-not-supported-in-this-environment"),sb(this._delegate,async function(e,t,i){if(Qr(e.app))return Promise.reject(Gg(e,"operation-not-supported-in-this-environment"));const n=X_(e);qg(e,t,vy);const r=Bv(n,i);return new qv(n,"signInViaPopup",t,r).executeNotNull()}(this._delegate,e,ib))}async signInWithRedirect(e){return cb(Zx(),this._delegate,"operation-not-supported-in-this-environment"),await Qx(this._delegate),function(e,t,i){return async function(e,t,i){if(Qr(e.app))return Promise.reject(Wg(e));const n=X_(e);qg(e,t,vy),await n._initializationPromise;const r=Bv(n,i);return await Yv(r,n),r._openRedirect(n,t,"signInViaRedirect")}(e,t,i)}(this._delegate,e,ib)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:i}=await qy(Bn(e),t);return i.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function hb(e,t,i){let n=e;"function"!=typeof e&&({next:n,error:t,complete:i}=e);const r=n;return{next:e=>r(e&&lb.getOrCreate(e)),error:t,complete:i}}function db(e,t){const i=function(e,t){const i=eb();if(!i)return[];const n=L_(Jx,e,t);switch(i.getItem(n)){case Yx.NONE:return[R_];case Yx.LOCAL:return[Ev,uv];case Yx.SESSION:return[uv];default:return[]}}(e,t);if("undefined"==typeof self||i.includes(Ev)||i.push(Ev),"undefined"!=typeof window)for(const e of[lv,uv])i.includes(e)||i.push(e);return i.includes(R_)||i.push(R_),i}ub.Persistence=Yx;class pb{constructor(){this.providerId="phone",this._delegate=new Fv(nb(Dg.auth()))}static credential(e,t){return Fv.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}pb.PHONE_SIGN_IN_METHOD=Fv.PHONE_SIGN_IN_METHOD,pb.PROVIDER_ID=Fv.PROVIDER_ID;const fb=Zg;var mb;(mb=Dg).INTERNAL.registerComponent(new Un("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),i=e.getProvider("auth");return new ub(t,i)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:yy,FacebookAuthProvider:wy,GithubAuthProvider:Ty,GoogleAuthProvider:Sy,OAuthProvider:by,SAMLAuthProvider:My,PhoneAuthProvider:pb,PhoneMultiFactorGenerator:Cx,RecaptchaVerifier:class{constructor(e,t,i=Dg.app()){var n;fb(null===(n=i.options)||void 0===n?void 0:n.apiKey,"invalid-api-key",{appName:i.name}),this._delegate=new Ov(i.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:Iy,Auth:ub,AuthCredential:sy,Error:In}).setInstantiationMode("LAZY").setMultipleInstances(!1)),mb.registerVersion("@firebase/auth-compat","0.5.7");var gb=i(999),_b=i.n(gb);i(511),i(544),i(550),i(822),i(930),function(){(function(){var e,t,n="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)t=Object.setPrototypeOf;else{var r;e:{var s={};try{s.__proto__={xb:!0},r=s.xb;break e}catch(e){}r=!1}t=r?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var o=t;function a(e,t){if(e.prototype=n(t.prototype),e.prototype.constructor=e,o)o(e,t);else for(var i in t)if("prototype"!=i)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(t,i);r&&Object.defineProperty(e,i,r)}else e[i]=t[i];e.K=t.prototype}var l="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,i){e!=Array.prototype&&e!=Object.prototype&&(e[t]=i.value)},c="undefined"!=typeof window&&window===this?this:void 0!==i.g&&null!=i.g?i.g:this;function u(e,t){if(t){var i=c;e=e.split(".");for(var n=0;n<e.length-1;n++){var r=e[n];r in i||(i[r]={}),i=i[r]}(t=t(n=i[e=e[e.length-1]]))!=n&&null!=t&&l(i,e,{configurable:!0,writable:!0,value:t})}}u("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}})),u("Array.prototype.includes",(function(e){return e||function(e,t){var i=this;i instanceof String&&(i=String(i));var n=i.length;for(0>(t=t||0)&&(t=Math.max(t+n,0));t<n;t++){var r=i[t];if(r===e||Object.is(r,e))return!0}return!1}}));var h=this;function d(e){return void 0!==e}function p(e){return"string"==typeof e}var f=/^[\w+/_-]+[=]{0,2}$/,m=null;function g(){}function _(e){e.W=void 0,e.Xa=function(){return e.W?e.W:e.W=new e}}function y(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var i=Object.prototype.toString.call(e);if("[object Window]"==i)return"object";if("[object Array]"==i||"number"==typeof e.length&&void 0!==e.splice&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==i||void 0!==e.call&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&void 0===e.call)return"object";return t}function v(e){return"array"==y(e)}function x(e){var t=y(e);return"array"==t||"object"==t&&"number"==typeof e.length}function b(e){return"function"==y(e)}function w(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var S="closure_uid_"+(1e9*Math.random()>>>0),T=0;function E(e,t,i){return e.call.apply(e.bind,arguments)}function M(e,t,i){if(!e)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,n),e.apply(t,i)}}return function(){return e.apply(t,arguments)}}function I(e,t,i){return(I=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?E:M).apply(null,arguments)}function A(e,t){var i=Array.prototype.slice.call(arguments,1);return function(){var t=i.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function C(e,t){for(var i in t)e[i]=t[i]}var P,k=Date.now||function(){return+new Date};function R(e,t){e=e.split(".");var i,n=h;e[0]in n||void 0===n.execScript||n.execScript("var "+e[0]);for(;e.length&&(i=e.shift());)!e.length&&d(t)?n[i]=t:n=n[i]&&n[i]!==Object.prototype[i]?n[i]:n[i]={}}function L(e,t){function i(){}i.prototype=t.prototype,e.K=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.vc=function(e,i,n){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[i].apply(e,r)}}function D(e){if(Error.captureStackTrace)Error.captureStackTrace(this,D);else{var t=Error().stack;t&&(this.stack=t)}e&&(this.message=String(e))}function O(e,t){for(var i="",n=(e=e.split("%s")).length-1,r=0;r<n;r++)i+=e[r]+(r<t.length?t[r]:"%s");D.call(this,i+e[n])}function N(e,t){throw new O("Failure"+(e?": "+e:""),Array.prototype.slice.call(arguments,1))}L(D,Error),D.prototype.name="CustomError",L(O,D),O.prototype.name="AssertionError";var z=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if(p(e))return p(t)&&1==t.length?e.indexOf(t,0):-1;for(var i=0;i<e.length;i++)if(i in e&&e[i]===t)return i;return-1},F=Array.prototype.forEach?function(e,t,i){Array.prototype.forEach.call(e,t,i)}:function(e,t,i){for(var n=e.length,r=p(e)?e.split(""):e,s=0;s<n;s++)s in r&&t.call(i,r[s],s,e)},B=Array.prototype.filter?function(e,t){return Array.prototype.filter.call(e,t,void 0)}:function(e,t){for(var i=e.length,n=[],r=0,s=p(e)?e.split(""):e,o=0;o<i;o++)if(o in s){var a=s[o];t.call(void 0,a,o,e)&&(n[r++]=a)}return n},U=Array.prototype.map?function(e,t){return Array.prototype.map.call(e,t,void 0)}:function(e,t){for(var i=e.length,n=Array(i),r=p(e)?e.split(""):e,s=0;s<i;s++)s in r&&(n[s]=t.call(void 0,r[s],s,e));return n},V=Array.prototype.some?function(e,t){return Array.prototype.some.call(e,t,void 0)}:function(e,t){for(var i=e.length,n=p(e)?e.split(""):e,r=0;r<i;r++)if(r in n&&t.call(void 0,n[r],r,e))return!0;return!1};function j(e,t){return 0<=z(e,t)}function G(e,t){var i;return(i=0<=(t=z(e,t)))&&H(e,t),i}function H(e,t){return 1==Array.prototype.splice.call(e,t,1).length}function W(e){return Array.prototype.concat.apply([],arguments)}function q(e){var t=e.length;if(0<t){for(var i=Array(t),n=0;n<t;n++)i[n]=e[n];return i}return[]}function $(e,t,i){return 2>=arguments.length?Array.prototype.slice.call(e,t):Array.prototype.slice.call(e,t,i)}var Z=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]},X=/&/g,Y=/</g,K=/>/g,J=/"/g,Q=/'/g,ee=/\x00/g,te=/[\x00&<>"']/;function ie(e,t){return e<t?-1:e>t?1:0}function ne(e){return te.test(e)&&(-1!=e.indexOf("&")&&(e=e.replace(X,"&amp;")),-1!=e.indexOf("<")&&(e=e.replace(Y,"&lt;")),-1!=e.indexOf(">")&&(e=e.replace(K,"&gt;")),-1!=e.indexOf('"')&&(e=e.replace(J,"&quot;")),-1!=e.indexOf("'")&&(e=e.replace(Q,"&#39;")),-1!=e.indexOf("\0")&&(e=e.replace(ee,"&#0;"))),e}function re(e,t,i){for(var n in e)t.call(i,e[n],n,e)}function se(e){var t,i={};for(t in e)i[t]=e[t];return i}var oe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ae(e,t){for(var i,n,r=1;r<arguments.length;r++){for(i in n=arguments[r])e[i]=n[i];for(var s=0;s<oe.length;s++)i=oe[s],Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}}var le="StopIteration"in h?h.StopIteration:{message:"StopIteration",stack:""};function ce(){}function ue(e){if(e instanceof ce)return e;if("function"==typeof e.ha)return e.ha(!1);if(x(e)){var t=0,i=new ce;return i.next=function(){for(;;){if(t>=e.length)throw le;if(t in e)return e[t++];t++}},i}throw Error("Not implemented")}function he(e,t){this.g={},this.a=[],this.j=this.h=0;var i=arguments.length;if(1<i){if(i%2)throw Error("Uneven number of arguments");for(var n=0;n<i;n+=2)this.set(arguments[n],arguments[n+1])}else if(e)if(e instanceof he)for(i=e.ja(),n=0;n<i.length;n++)this.set(i[n],e.get(i[n]));else for(n in e)this.set(n,e[n])}function de(e){if(e.h!=e.a.length){for(var t=0,i=0;t<e.a.length;){var n=e.a[t];pe(e.g,n)&&(e.a[i++]=n),t++}e.a.length=i}if(e.h!=e.a.length){var r={};for(i=t=0;t<e.a.length;)pe(r,n=e.a[t])||(e.a[i++]=n,r[n]=1),t++;e.a.length=i}}function pe(e,t){return Object.prototype.hasOwnProperty.call(e,t)}ce.prototype.next=function(){throw le},ce.prototype.ha=function(){return this},(e=he.prototype).la=function(){de(this);for(var e=[],t=0;t<this.a.length;t++)e.push(this.g[this.a[t]]);return e},e.ja=function(){return de(this),this.a.concat()},e.clear=function(){this.g={},this.j=this.h=this.a.length=0},e.get=function(e,t){return pe(this.g,e)?this.g[e]:t},e.set=function(e,t){pe(this.g,e)||(this.h++,this.a.push(e),this.j++),this.g[e]=t},e.forEach=function(e,t){for(var i=this.ja(),n=0;n<i.length;n++){var r=i[n],s=this.get(r);e.call(t,s,r,this)}},e.ha=function(e){de(this);var t=0,i=this.j,n=this,r=new ce;return r.next=function(){if(i!=n.j)throw Error("The map has changed since the iterator was created");if(t>=n.a.length)throw le;var r=n.a[t++];return e?r:n.g[r]},r};var fe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function me(e,t,i,n){for(var r=i.length;0<=(t=e.indexOf(i,t))&&t<n;){var s=e.charCodeAt(t-1);if(!(38!=s&&63!=s||(s=e.charCodeAt(t+r))&&61!=s&&38!=s&&35!=s))return t;t+=r+1}return-1}var ge=/#|$/;function _e(e,t){var i=e.search(ge),n=me(e,0,t,i);if(0>n)return null;var r=e.indexOf("&",n);return(0>r||r>i)&&(r=i),n+=t.length+1,decodeURIComponent(e.substr(n,r-n).replace(/\+/g," "))}var ye=/[?&]($|#)/;function ve(e,t){var i;this.h=this.A=this.j="",this.C=null,this.s=this.g="",this.i=!1,e instanceof ve?(this.i=d(t)?t:e.i,xe(this,e.j),this.A=e.A,this.h=e.h,be(this,e.C),this.g=e.g,we(this,Ne(e.a)),this.s=e.s):e&&(i=String(e).match(fe))?(this.i=!!t,xe(this,i[1]||"",!0),this.A=Te(i[2]||""),this.h=Te(i[3]||"",!0),be(this,i[4]),this.g=Te(i[5]||"",!0),we(this,i[6]||"",!0),this.s=Te(i[7]||"")):(this.i=!!t,this.a=new Re(null,this.i))}function xe(e,t,i){e.j=i?Te(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function be(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.C=t}else e.C=null}function we(e,t,i){t instanceof Re?(e.a=t,function(e,t){t&&!e.j&&(Le(e),e.h=null,e.a.forEach((function(e,t){var i=t.toLowerCase();t!=i&&(De(this,t),De(this,i),0<e.length&&(this.h=null,this.a.set(ze(this,i),q(e)),this.g+=e.length))}),e)),e.j=t}(e.a,e.i)):(i||(t=Ee(t,Pe)),e.a=new Re(t,e.i))}function Se(e){return e instanceof ve?new ve(e):new ve(e,void 0)}function Te(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Ee(e,t,i){return p(e)?(e=encodeURI(e).replace(t,Me),i&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Me(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}ve.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Ee(t,Ie,!0),":");var i=this.h;return(i||"file"==t)&&(e.push("//"),(t=this.A)&&e.push(Ee(t,Ie,!0),"@"),e.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.C)&&e.push(":",String(i))),(i=this.g)&&(this.h&&"/"!=i.charAt(0)&&e.push("/"),e.push(Ee(i,"/"==i.charAt(0)?Ce:Ae,!0))),(i=this.a.toString())&&e.push("?",i),(i=this.s)&&e.push("#",Ee(i,ke)),e.join("")};var Ie=/[#\/\?@]/g,Ae=/[#\?:]/g,Ce=/[#\?]/g,Pe=/[#\?@]/g,ke=/#/g;function Re(e,t){this.g=this.a=null,this.h=e||null,this.j=!!t}function Le(e){e.a||(e.a=new he,e.g=0,e.h&&function(e,t){if(e){e=e.split("&");for(var i=0;i<e.length;i++){var n=e[i].indexOf("="),r=null;if(0<=n){var s=e[i].substring(0,n);r=e[i].substring(n+1)}else s=e[i];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.h,(function(t,i){e.add(decodeURIComponent(t.replace(/\+/g," ")),i)})))}function De(e,t){Le(e),t=ze(e,t),pe(e.a.g,t)&&(e.h=null,e.g-=e.a.get(t).length,pe((e=e.a).g,t)&&(delete e.g[t],e.h--,e.j++,e.a.length>2*e.h&&de(e)))}function Oe(e,t){return Le(e),t=ze(e,t),pe(e.a.g,t)}function Ne(e){var t=new Re;return t.h=e.h,e.a&&(t.a=new he(e.a),t.g=e.g),t}function ze(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Fe(e){this.a=Se(e)}function Be(e){return e.a.a.get(je.Pa)||null}function Ue(e,t){t?e.a.a.set(je.PROVIDER_ID,t):De(e.a.a,je.PROVIDER_ID)}(e=Re.prototype).add=function(e,t){Le(this),this.h=null,e=ze(this,e);var i=this.a.get(e);return i||this.a.set(e,i=[]),i.push(t),this.g+=1,this},e.clear=function(){this.a=this.h=null,this.g=0},e.forEach=function(e,t){Le(this),this.a.forEach((function(i,n){F(i,(function(i){e.call(t,i,n,this)}),this)}),this)},e.ja=function(){Le(this);for(var e=this.a.la(),t=this.a.ja(),i=[],n=0;n<t.length;n++)for(var r=e[n],s=0;s<r.length;s++)i.push(t[n]);return i},e.la=function(e){Le(this);var t=[];if(p(e))Oe(this,e)&&(t=W(t,this.a.get(ze(this,e))));else{e=this.a.la();for(var i=0;i<e.length;i++)t=W(t,e[i])}return t},e.set=function(e,t){return Le(this),this.h=null,Oe(this,e=ze(this,e))&&(this.g-=this.a.get(e).length),this.a.set(e,[t]),this.g+=1,this},e.get=function(e,t){return e&&0<(e=this.la(e)).length?String(e[0]):t},e.toString=function(){if(this.h)return this.h;if(!this.a)return"";for(var e=[],t=this.a.ja(),i=0;i<t.length;i++){var n=t[i],r=encodeURIComponent(String(n));n=this.la(n);for(var s=0;s<n.length;s++){var o=r;""!==n[s]&&(o+="="+encodeURIComponent(String(n[s]))),e.push(o)}}return this.h=e.join("&")},Fe.prototype.toString=function(){return this.a.toString()};var Ve,je={Pa:"ui_auid",lc:"apiKey",Qa:"ui_sd",ub:"mode",$a:"oobCode",PROVIDER_ID:"ui_pid",Sa:"ui_sid",vb:"tenantId"};e:{var Ge=h.navigator;if(Ge){var He=Ge.userAgent;if(He){Ve=He;break e}}Ve=""}function We(e){return-1!=Ve.indexOf(e)}function qe(){return(We("Chrome")||We("CriOS"))&&!We("Edge")}function $e(e){return $e[" "](e),e}$e[" "]=g;var Ze,Xe=We("Opera"),Ye=We("Trident")||We("MSIE"),Ke=We("Edge"),Je=Ke||Ye,Qe=We("Gecko")&&!(-1!=Ve.toLowerCase().indexOf("webkit")&&!We("Edge"))&&!(We("Trident")||We("MSIE"))&&!We("Edge"),et=-1!=Ve.toLowerCase().indexOf("webkit")&&!We("Edge"),tt=et&&We("Mobile"),it=We("Macintosh");function nt(){var e=h.document;return e?e.documentMode:void 0}e:{var rt="",st=function(){var e=Ve;return Qe?/rv:([^\);]+)(\)|;)/.exec(e):Ke?/Edge\/([\d\.]+)/.exec(e):Ye?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):et?/WebKit\/(\S+)/.exec(e):Xe?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(st&&(rt=st?st[1]:""),Ye){var ot=nt();if(null!=ot&&ot>parseFloat(rt)){Ze=String(ot);break e}}Ze=rt}var at,lt={};function ct(e){return function(e,t){var i=lt;return Object.prototype.hasOwnProperty.call(i,e)?i[e]:i[e]=t()}(e,(function(){for(var t=0,i=Z(String(Ze)).split("."),n=Z(String(e)).split("."),r=Math.max(i.length,n.length),s=0;0==t&&s<r;s++){var o=i[s]||"",a=n[s]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=ie(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||ie(0==o[2].length,0==a[2].length)||ie(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t}))}var ut=h.document;function ht(e,t){this.a=e===pt&&t||"",this.g=dt}at=ut&&Ye?nt()||("CSS1Compat"==ut.compatMode?parseInt(Ze,10):5):void 0,ht.prototype.ma=!0,ht.prototype.ka=function(){return this.a},ht.prototype.toString=function(){return"Const{"+this.a+"}"};var dt={},pt={};function ft(){this.a="",this.h=gt}function mt(e){return e instanceof ft&&e.constructor===ft&&e.h===gt?e.a:(N("expected object of type TrustedResourceUrl, got '"+e+"' of type "+y(e)),"type_error:TrustedResourceUrl")}ft.prototype.ma=!0,ft.prototype.ka=function(){return this.a.toString()},ft.prototype.g=function(){return 1},ft.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var gt={};function _t(){this.a="",this.h=wt}function yt(e){return e instanceof _t&&e.constructor===_t&&e.h===wt?e.a:(N("expected object of type SafeUrl, got '"+e+"' of type "+y(e)),"type_error:SafeUrl")}_t.prototype.ma=!0,_t.prototype.ka=function(){return this.a.toString()},_t.prototype.g=function(){return 1},_t.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var vt=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function xt(e){return e instanceof _t?e:(e="object"==typeof e&&e.ma?e.ka():String(e),vt.test(e)||(e="about:invalid#zClosurez"),St(e))}function bt(e){return e instanceof _t?e:(e="object"==typeof e&&e.ma?e.ka():String(e),vt.test(e)||(e="about:invalid#zClosurez"),St(e))}var wt={};function St(e){var t=new _t;return t.a=e,t}function Tt(){this.a="",this.g=Et}St("about:blank"),Tt.prototype.ma=!0;var Et={};function Mt(){this.a="",this.j=At,this.h=null}function It(e){return e instanceof Mt&&e.constructor===Mt&&e.j===At?e.a:(N("expected object of type SafeHtml, got '"+e+"' of type "+y(e)),"type_error:SafeHtml")}Tt.prototype.ka=function(){return this.a},Tt.prototype.toString=function(){return"SafeStyle{"+this.a+"}"},Mt.prototype.g=function(){return this.h},Mt.prototype.ma=!0,Mt.prototype.ka=function(){return this.a.toString()},Mt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var At={};function Ct(e,t){var i=new Mt;return i.a=e,i.h=t,i}Ct("<!DOCTYPE html>",0);var Pt=Ct("",0);Ct("<br>",0);var kt=function(e){var t,i=!1;return function(){return i||(t=function(){if("undefined"==typeof document)return!1;var e=document.createElement("div"),t=document.createElement("div");return t.appendChild(document.createElement("div")),e.appendChild(t),!!e.firstChild&&(t=e.firstChild.firstChild,e.innerHTML=It(Pt),!t.parentElement)}(),i=!0),t}}();function Rt(e,t){t=t instanceof _t?t:bt(t),e.assign(yt(t))}function Lt(e,t){this.a=d(e)?e:0,this.g=d(t)?t:0}function Dt(e,t){this.width=e,this.height=t}function Ot(e){return e?new Wt(jt(e)):P||(P=new Wt)}function Nt(e,t){var i=t||document;return i.querySelectorAll&&i.querySelector?i.querySelectorAll("."+e):Ft(document,e,t)}function zt(e,t){var i=t||document;if(i.getElementsByClassName)e=i.getElementsByClassName(e)[0];else{i=document;var n=t||i;e=n.querySelectorAll&&n.querySelector&&e?n.querySelector(e?"."+e:""):Ft(i,e,t)[0]||null}return e||null}function Ft(e,t,i){var n;if((e=i||e).querySelectorAll&&e.querySelector&&t)return e.querySelectorAll(t?"."+t:"");if(t&&e.getElementsByClassName){var r=e.getElementsByClassName(t);return r}if(r=e.getElementsByTagName("*"),t){var s={};for(i=n=0;e=r[i];i++){var o=e.className;"function"==typeof o.split&&j(o.split(/\s+/),t)&&(s[n++]=e)}return s.length=n,s}return r}Lt.prototype.toString=function(){return"("+this.a+", "+this.g+")"},Lt.prototype.ceil=function(){return this.a=Math.ceil(this.a),this.g=Math.ceil(this.g),this},Lt.prototype.floor=function(){return this.a=Math.floor(this.a),this.g=Math.floor(this.g),this},Lt.prototype.round=function(){return this.a=Math.round(this.a),this.g=Math.round(this.g),this},(e=Dt.prototype).toString=function(){return"("+this.width+" x "+this.height+")"},e.aspectRatio=function(){return this.width/this.height},e.ceil=function(){return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},e.floor=function(){return this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},e.round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this};var Bt={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Ut(e){return e.scrollingElement?e.scrollingElement:(et||"CSS1Compat"!=e.compatMode)&&e.body||e.documentElement}function Vt(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function jt(e){return 9==e.nodeType?e:e.ownerDocument||e.document}function Gt(e,t){if("textContent"in e)e.textContent=t;else if(3==e.nodeType)e.data=String(t);else if(e.firstChild&&3==e.firstChild.nodeType){for(;e.lastChild!=e.firstChild;)e.removeChild(e.lastChild);e.firstChild.data=String(t)}else{for(var i;i=e.firstChild;)e.removeChild(i);e.appendChild(jt(e).createTextNode(String(t)))}}function Ht(e,t){return t?function(e,t){for(;e;){if(t(e))return e;e=e.parentNode}return null}(e,(function(e){return!t||p(e.className)&&j(e.className.split(/\s+/),t)})):null}function Wt(e){this.a=e||h.document||document}Wt.prototype.N=function(){return p(void 0)?this.a.getElementById(void 0):void 0};var qt={Fc:!0},$t={Hc:!0},Zt={Ec:!0},Xt={Gc:!0};function Yt(){throw Error("Do not instantiate directly")}function Kt(e,t,i,n){if(e=e(t||Qt,void 0,i),n=(n||Ot()).a.createElement("DIV"),(e=function(e){if(!w(e))return ne(String(e));if(e instanceof Yt){if(e.fa===qt)return e.content;if(e.fa===Xt)return ne(e.content)}return N("Soy template output is unsafe for use as HTML: "+e),"zSoyz"}(e)).match(Jt),e=Ct(e,null),kt())for(;n.lastChild;)n.removeChild(n.lastChild);return n.innerHTML=It(e),1==n.childNodes.length&&1==(e=n.firstChild).nodeType&&(n=e),n}Yt.prototype.va=null,Yt.prototype.toString=function(){return this.content};var Jt=/^<(body|caption|col|colgroup|head|html|tr|td|th|tbody|thead|tfoot)>/i,Qt={};function ei(){Yt.call(this)}function ti(e){return null!=e&&e.fa===qt?e:e instanceof Mt?si(It(e).toString(),e.g()):si(ne(String(String(e))),function(e){if(null!=e)switch(e.va){case 1:return 1;case-1:return-1;case 0:return 0}return null}(e))}function ii(){Yt.call(this)}function ni(e,t){this.content=String(e),this.va=null!=t?t:null}function ri(e){return new ni(e,void 0)}L(ei,Yt),ei.prototype.fa=qt,L(ii,Yt),ii.prototype.fa=$t,ii.prototype.va=1,L(ni,Yt),ni.prototype.fa=Xt;var si=function(e){function t(e){this.content=e}return t.prototype=e.prototype,function(e,i){return e=new t(String(e)),void 0!==i&&(e.va=i),e}}(ei),oi=function(e){function t(e){this.content=e}return t.prototype=e.prototype,function(e){return new t(String(e))}}(ii);function ai(e){return(e=String(e))?new ni(e,void 0):""}var li=function(e){function t(e){this.content=e}return t.prototype=e.prototype,function(e,i){return(e=String(e))?(e=new t(e),void 0!==i&&(e.va=i),e):""}}(ei);function ci(e){return null!=e&&e.fa===qt?String(String(e.content).replace(xi,"").replace(bi,"&lt;")).replace(gi,pi):ne(String(e))}function ui(e){return null!=e&&e.fa===$t?e=String(e).replace(_i,mi):e instanceof _t?e=String(yt(e).toString()).replace(_i,mi):(e=String(e),vi.test(e)?e=e.replace(_i,mi):(N("Bad value `%s` for |filterNormalizeUri",[e]),e="#zSoyz")),e}function hi(e){return null!=e&&e.fa===Zt?e=e.content:null==e?e="":e instanceof Tt?e instanceof Tt&&e.constructor===Tt&&e.g===Et?e=e.a:(N("expected object of type SafeStyle, got '"+e+"' of type "+y(e)),e="type_error:SafeStyle"):(e=String(e),yi.test(e)||(N("Bad value `%s` for |filterCssValue",[e]),e="zSoyz")),e}var di={"\0":"&#0;","\t":"&#9;","\n":"&#10;","\v":"&#11;","\f":"&#12;","\r":"&#13;"," ":"&#32;",'"':"&quot;","&":"&amp;","'":"&#39;","-":"&#45;","/":"&#47;","<":"&lt;","=":"&#61;",">":"&gt;","`":"&#96;","":"&#133;","":"&#160;","\u2028":"&#8232;","\u2029":"&#8233;"};function pi(e){return di[e]}var fi={"\0":"%00","":"%01","":"%02","":"%03","":"%04","":"%05","":"%06","":"%07","\b":"%08","\t":"%09","\n":"%0A","\v":"%0B","\f":"%0C","\r":"%0D","":"%0E","":"%0F","":"%10","":"%11","":"%12","":"%13","":"%14","":"%15","":"%16","":"%17","":"%18","":"%19","":"%1A","":"%1B","":"%1C","":"%1D","":"%1E","":"%1F"," ":"%20",'"':"%22","'":"%27","(":"%28",")":"%29","<":"%3C",">":"%3E","\\":"%5C","{":"%7B","}":"%7D","":"%7F","":"%C2%85","":"%C2%A0","\u2028":"%E2%80%A8","\u2029":"%E2%80%A9","":"%EF%BC%81","":"%EF%BC%83","":"%EF%BC%84","":"%EF%BC%86","":"%EF%BC%87","":"%EF%BC%88","":"%EF%BC%89","":"%EF%BC%8A","":"%EF%BC%8B","":"%EF%BC%8C","":"%EF%BC%8F","":"%EF%BC%9A","":"%EF%BC%9B","":"%EF%BC%9D","":"%EF%BC%9F","":"%EF%BC%A0","":"%EF%BC%BB","":"%EF%BC%BD"};function mi(e){return fi[e]}var gi=/[\x00\x22\x27\x3c\x3e]/g,_i=/[\x00- \x22\x27-\x29\x3c\x3e\\\x7b\x7d\x7f\x85\xa0\u2028\u2029\uff01\uff03\uff04\uff06-\uff0c\uff0f\uff1a\uff1b\uff1d\uff1f\uff20\uff3b\uff3d]/g,yi=/^(?!-*(?:expression|(?:moz-)?binding))(?:[.#]?-?(?:[_a-z0-9-]+)(?:-[_a-z0-9-]+)*-?|-?(?:[0-9]+(?:\.[0-9]*)?|\.[0-9]+)(?:[a-z]{1,2}|%)?|!important|)$/i,vi=/^(?![^#?]*\/(?:\.|%2E){2}(?:[\/?#]|$))(?:(?:https?|mailto):|[^&:\/?#]*(?:[\/?#]|$))/i,xi=/<(?:!|\/?([a-zA-Z][a-zA-Z0-9:\-]*))(?:[^>'"]|"[^"]*"|'[^']*')*>/g,bi=/</g;function wi(){return ri("Enter a valid phone number")}function Si(){return ri("Unable to send password reset code to specified email")}function Ti(){return ri("Something went wrong. Please try again.")}function Ei(){return ri("This email already exists without any means of sign-in. Please reset the password to recover.")}function Mi(e){var t="";switch((e=e||{}).code){case"invalid-argument":t+="Client specified an invalid argument.";break;case"invalid-configuration":t+="Client specified an invalid project configuration.";break;case"failed-precondition":t+="Request can not be executed in the current system state.";break;case"out-of-range":t+="Client specified an invalid range.";break;case"unauthenticated":t+="Request not authenticated due to missing, invalid, or expired OAuth token.";break;case"permission-denied":t+="Client does not have sufficient permission.";break;case"not-found":t+="Specified resource is not found.";break;case"aborted":t+="Concurrency conflict, such as read-modify-write conflict.";break;case"already-exists":t+="The resource that a client tried to create already exists.";break;case"resource-exhausted":t+="Either out of resource quota or reaching rate limiting.";break;case"cancelled":t+="Request cancelled by the client.";break;case"data-loss":t+="Unrecoverable data loss or data corruption.";break;case"unknown":t+="Unknown server error.";break;case"internal":t+="Internal server error.";break;case"not-implemented":t+="API method not implemented by the server.";break;case"unavailable":t+="Service unavailable.";break;case"deadline-exceeded":t+="Request deadline exceeded.";break;case"auth/user-disabled":t+="The user account has been disabled by an administrator.";break;case"auth/timeout":t+="The operation has timed out.";break;case"auth/too-many-requests":t+="We have blocked all requests from this device due to unusual activity. Try again later.";break;case"auth/quota-exceeded":t+="The quota for this operation has been exceeded. Try again later.";break;case"auth/network-request-failed":t+="A network error has occurred. Try again later.";break;case"restart-process":t+="An issue was encountered when authenticating your request. Please visit the URL that redirected you to this page again to restart the authentication process.";break;case"no-matching-tenant-for-email":t+="No sign-in provider is available for the given email, please try with a different email."}return ri(t)}function Ii(e,t,i){var n=Error.call(this);this.message=n.message,"stack"in n&&(this.stack=n.stack),this.code=Ai+e,(e=t)||(e="","firebaseui/merge-conflict"===this.code?e+="The current anonymous user failed to upgrade. The non-anonymous credential is already associated with a different user account.":e+=Ti(),e=ri(e).toString()),this.message=e||"",this.credential=i||null}a(Ii,Error),Ii.prototype.toJSON=function(){return{code:this.code,message:this.message}};var Ai="firebaseui/";function Ci(){0!=Pi&&(ki[this[S]||(this[S]=++T)]=this),this.T=this.T,this.C=this.C}var Pi=0,ki={};function Ri(e,t){e.T?d(void 0)?t.call(void 0):t():(e.C||(e.C=[]),e.C.push(d(void 0)?I(t,void 0):t))}function Li(e){e&&"function"==typeof e.m&&e.m()}Ci.prototype.T=!1,Ci.prototype.m=function(){if(!this.T&&(this.T=!0,this.o(),0!=Pi)){var e=this[S]||(this[S]=++T);if(0!=Pi&&this.C&&0<this.C.length)throw Error(this+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete ki[e]}},Ci.prototype.o=function(){if(this.C)for(;this.C.length;)this.C.shift()()};var Di=Object.freeze||function(e){return e},Oi=!Ye||9<=Number(at),Ni=Ye&&!ct("9"),zi=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{h.addEventListener("test",g,t),h.removeEventListener("test",g,t)}catch(e){}return e}();function Fi(e,t){this.type=e,this.g=this.target=t,this.h=!1,this.qb=!0}function Bi(e,t){if(Fi.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.j=this.keyCode=0,this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,e){var i=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Qe){e:{try{$e(t.nodeName);var r=!0;break e}catch(e){}r=!1}r||(t=null)}}else"mouseover"==i?t=e.fromElement:"mouseout"==i&&(t=e.toElement);this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.keyCode=e.keyCode||0,this.key=e.key||"",this.j=e.charCode||("keypress"==i?e.keyCode:0),this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=p(e.pointerType)?e.pointerType:Ui[e.pointerType]||"",this.a=e,e.defaultPrevented&&this.preventDefault()}}Fi.prototype.stopPropagation=function(){this.h=!0},Fi.prototype.preventDefault=function(){this.qb=!1},L(Bi,Fi);var Ui=Di({2:"touch",3:"pen",4:"mouse"});Bi.prototype.stopPropagation=function(){Bi.K.stopPropagation.call(this),this.a.stopPropagation?this.a.stopPropagation():this.a.cancelBubble=!0},Bi.prototype.preventDefault=function(){Bi.K.preventDefault.call(this);var e=this.a;if(e.preventDefault)e.preventDefault();else if(e.returnValue=!1,Ni)try{(e.ctrlKey||112<=e.keyCode&&123>=e.keyCode)&&(e.keyCode=-1)}catch(e){}};var Vi="closure_listenable_"+(1e6*Math.random()|0),ji=0;function Gi(e,t,i,n,r){this.listener=e,this.proxy=null,this.src=t,this.type=i,this.capture=!!n,this.La=r,this.key=++ji,this.sa=this.Ia=!1}function Hi(e){e.sa=!0,e.listener=null,e.proxy=null,e.src=null,e.La=null}function Wi(e){this.src=e,this.a={},this.g=0}function qi(e,t){var i=t.type;i in e.a&&G(e.a[i],t)&&(Hi(t),0==e.a[i].length&&(delete e.a[i],e.g--))}function $i(e,t,i,n){for(var r=0;r<e.length;++r){var s=e[r];if(!s.sa&&s.listener==t&&s.capture==!!i&&s.La==n)return r}return-1}Wi.prototype.add=function(e,t,i,n,r){var s=e.toString();(e=this.a[s])||(e=this.a[s]=[],this.g++);var o=$i(e,t,n,r);return-1<o?(t=e[o],i||(t.Ia=!1)):((t=new Gi(t,this.src,s,!!n,r)).Ia=i,e.push(t)),t};var Zi="closure_lm_"+(1e6*Math.random()|0),Xi={};function Yi(e,t,i,n,r){if(n&&n.once)return Ji(e,t,i,n,r);if(v(t)){for(var s=0;s<t.length;s++)Yi(e,t[s],i,n,r);return null}return i=ln(i),e&&e[Vi]?e.J.add(String(t),i,!1,w(n)?!!n.capture:!!n,r):Ki(e,t,i,!1,n,r)}function Ki(e,t,i,n,r,s){if(!t)throw Error("Invalid event type");var o=w(r)?!!r.capture:!!r,a=on(e);if(a||(e[Zi]=a=new Wi(e)),(i=a.add(t,i,n,o,s)).proxy)return i;if(n=function(){var e=sn,t=Oi?function(i){return e.call(t.src,t.listener,i)}:function(i){if(!(i=e.call(t.src,t.listener,i)))return i};return t}(),i.proxy=n,n.src=e,n.listener=i,e.addEventListener)zi||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),n,r);else if(e.attachEvent)e.attachEvent(tn(t.toString()),n);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(n)}return i}function Ji(e,t,i,n,r){if(v(t)){for(var s=0;s<t.length;s++)Ji(e,t[s],i,n,r);return null}return i=ln(i),e&&e[Vi]?e.J.add(String(t),i,!0,w(n)?!!n.capture:!!n,r):Ki(e,t,i,!0,n,r)}function Qi(e,t,i,n,r){if(v(t))for(var s=0;s<t.length;s++)Qi(e,t[s],i,n,r);else n=w(n)?!!n.capture:!!n,i=ln(i),e&&e[Vi]?(e=e.J,(t=String(t).toString())in e.a&&-1<(i=$i(s=e.a[t],i,n,r))&&(Hi(s[i]),H(s,i),0==s.length&&(delete e.a[t],e.g--))):e&&(e=on(e))&&(t=e.a[t.toString()],e=-1,t&&(e=$i(t,i,n,r)),(i=-1<e?t[e]:null)&&en(i))}function en(e){if("number"!=typeof e&&e&&!e.sa){var t=e.src;if(t&&t[Vi])qi(t.J,e);else{var i=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(i,n,e.capture):t.detachEvent?t.detachEvent(tn(i),n):t.addListener&&t.removeListener&&t.removeListener(n),(i=on(t))?(qi(i,e),0==i.g&&(i.src=null,t[Zi]=null)):Hi(e)}}}function tn(e){return e in Xi?Xi[e]:Xi[e]="on"+e}function nn(e,t,i,n){var r=!0;if((e=on(e))&&(t=e.a[t.toString()]))for(t=t.concat(),e=0;e<t.length;e++){var s=t[e];s&&s.capture==i&&!s.sa&&(s=rn(s,n),r=r&&!1!==s)}return r}function rn(e,t){var i=e.listener,n=e.La||e.src;return e.Ia&&en(e),i.call(n,t)}function sn(e,t){if(e.sa)return!0;if(!Oi){if(!t)e:{t=["window","event"];for(var i=h,n=0;n<t.length;n++)if(null==(i=i[t[n]])){t=null;break e}t=i}if(t=new Bi(n=t,this),i=!0,!(0>n.keyCode||null!=n.returnValue)){e:{var r=!1;if(0==n.keyCode)try{n.keyCode=-1;break e}catch(e){r=!0}(r||null==n.returnValue)&&(n.returnValue=!0)}for(n=[],r=t.g;r;r=r.parentNode)n.push(r);for(e=e.type,r=n.length-1;!t.h&&0<=r;r--){t.g=n[r];var s=nn(n[r],e,!0,t);i=i&&s}for(r=0;!t.h&&r<n.length;r++)t.g=n[r],s=nn(n[r],e,!1,t),i=i&&s}return i}return rn(e,new Bi(t,this))}function on(e){return(e=e[Zi])instanceof Wi?e:null}var an="__closure_events_fn_"+(1e9*Math.random()>>>0);function ln(e){return b(e)?e:(e[an]||(e[an]=function(t){return e.handleEvent(t)}),e[an])}function cn(){Ci.call(this),this.J=new Wi(this),this.wb=this,this.Ha=null}function un(e,t){var i,n=e.Ha;if(n)for(i=[];n;n=n.Ha)i.push(n);if(e=e.wb,n=t.type||t,p(t))t=new Fi(t,e);else if(t instanceof Fi)t.target=t.target||e;else{var r=t;ae(t=new Fi(n,e),r)}if(r=!0,i)for(var s=i.length-1;!t.h&&0<=s;s--){var o=t.g=i[s];r=hn(o,n,!0,t)&&r}if(t.h||(r=hn(o=t.g=e,n,!0,t)&&r,t.h||(r=hn(o,n,!1,t)&&r)),i)for(s=0;!t.h&&s<i.length;s++)r=hn(o=t.g=i[s],n,!1,t)&&r;return r}function hn(e,t,i,n){if(!(t=e.J.a[String(t)]))return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.sa&&o.capture==i){var a=o.listener,l=o.La||o.src;o.Ia&&qi(e.J,o),r=!1!==a.call(l,n)&&r}}return r&&0!=n.qb}L(cn,Ci),cn.prototype[Vi]=!0,cn.prototype.Za=function(e){this.Ha=e},cn.prototype.removeEventListener=function(e,t,i,n){Qi(this,e,t,i,n)},cn.prototype.o=function(){if(cn.K.o.call(this),this.J){var e,t=this.J;for(e in t.a){for(var i=t.a[e],n=0;n<i.length;n++)Hi(i[n]);delete t.a[e],t.g--}}this.Ha=null};var dn={},pn=0;function fn(e,t){if(!e)throw Error("Event target element must be provided!");if(e=mn(e),dn[e]&&dn[e].length)for(var i=0;i<dn[e].length;i++)un(dn[e][i],t)}function mn(e){return void 0===e.a&&(e.a=pn,pn++),e.a}function gn(e){if(!e)throw Error("Event target element must be provided!");cn.call(this),this.a=e}function _n(e){if(!e)return!1;try{return!!e.$goog_Thenable}catch(e){return!1}}function yn(e,t){this.h=e,this.j=t,this.g=0,this.a=null}function vn(e,t){e.j(t),100>e.g&&(e.g++,t.next=e.a,e.a=t)}function xn(){this.g=this.a=null}a(gn,cn),gn.prototype.N=function(){return this.a},gn.prototype.register=function(){var e=mn(this.N());dn[e]?j(dn[e],this)||dn[e].push(this):dn[e]=[this]},yn.prototype.get=function(){if(0<this.g){this.g--;var e=this.a;this.a=e.next,e.next=null}else e=this.h();return e};var bn,wn,Sn=new yn((function(){return new En}),(function(e){e.reset()}));function Tn(){var e=Cn,t=null;return e.a&&(t=e.a,e.a=e.a.next,e.a||(e.g=null),t.next=null),t}function En(){this.next=this.g=this.a=null}function Mn(e){h.setTimeout((function(){throw e}),0)}function In(e,t){wn||function(){if(h.Promise&&h.Promise.resolve){var e=h.Promise.resolve(void 0);wn=function(){e.then(Pn)}}else wn=function(){var e=Pn;!b(h.setImmediate)||h.Window&&h.Window.prototype&&!We("Edge")&&h.Window.prototype.setImmediate==h.setImmediate?(bn||(bn=function(){var e=h.MessageChannel;if(void 0===e&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!We("Presto")&&(e=function(){var e=document.createElement("IFRAME");e.style.display="none",e.src="",document.documentElement.appendChild(e);var t=e.contentWindow;(e=t.document).open(),e.write(""),e.close();var i="callImmediate"+Math.random(),n="file:"==t.location.protocol?"*":t.location.protocol+"//"+t.location.host;e=I((function(e){"*"!=n&&e.origin!=n||e.data!=i||this.port1.onmessage()}),this),t.addEventListener("message",e,!1),this.port1={},this.port2={postMessage:function(){t.postMessage(i,n)}}}),void 0!==e&&!We("Trident")&&!We("MSIE")){var t=new e,i={},n=i;return t.port1.onmessage=function(){if(d(i.next)){var e=(i=i.next).gb;i.gb=null,e()}},function(e){n.next={gb:e},n=n.next,t.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(e){var t=document.createElement("SCRIPT");t.onreadystatechange=function(){t.onreadystatechange=null,t.parentNode.removeChild(t),t=null,e(),e=null},document.documentElement.appendChild(t)}:function(e){h.setTimeout(e,0)}}()),bn(e)):h.setImmediate(e)}}(),An||(wn(),An=!0),Cn.add(e,t)}xn.prototype.add=function(e,t){var i=Sn.get();i.set(e,t),this.g?this.g.next=i:this.a=i,this.g=i},En.prototype.set=function(e,t){this.a=e,this.g=t,this.next=null},En.prototype.reset=function(){this.next=this.g=this.a=null};var An=!1,Cn=new xn;function Pn(){for(var e;e=Tn();){try{e.a.call(e.g)}catch(e){Mn(e)}vn(Sn,e)}An=!1}function kn(e){if(this.a=Rn,this.A=void 0,this.j=this.g=this.h=null,this.s=this.i=!1,e!=g)try{var t=this;e.call(void 0,(function(e){Gn(t,Ln,e)}),(function(e){if(!(e instanceof Xn))try{if(e instanceof Error)throw e;throw Error("Promise rejected.")}catch(e){}Gn(t,Dn,e)}))}catch(e){Gn(this,Dn,e)}}var Rn=0,Ln=2,Dn=3;function On(){this.next=this.j=this.g=this.s=this.a=null,this.h=!1}On.prototype.reset=function(){this.j=this.g=this.s=this.a=null,this.h=!1};var Nn=new yn((function(){return new On}),(function(e){e.reset()}));function zn(e,t,i){var n=Nn.get();return n.s=e,n.g=t,n.j=i,n}function Fn(e){if(e instanceof kn)return e;var t=new kn(g);return Gn(t,Ln,e),t}function Bn(e){return new kn((function(t,i){i(e)}))}function Un(e,t){if(e.a==Rn)if(e.h){var i=e.h;if(i.g){for(var n=0,r=null,s=null,o=i.g;o&&(o.h||(n++,o.a==e&&(r=o),!(r&&1<n)));o=o.next)r||(s=o);r&&(i.a==Rn&&1==n?Un(i,t):(s?((n=s).next==i.j&&(i.j=n),n.next=n.next.next):Wn(i),qn(i,r,Dn,t)))}e.h=null}else Gn(e,Dn,t)}function Vn(e,t){e.g||e.a!=Ln&&e.a!=Dn||Hn(e),e.j?e.j.next=t:e.g=t,e.j=t}function jn(e,t,i,n){var r=zn(null,null,null);return r.a=new kn((function(e,s){r.s=t?function(i){try{var r=t.call(n,i);e(r)}catch(e){s(e)}}:e,r.g=i?function(t){try{var r=i.call(n,t);!d(r)&&t instanceof Xn?s(t):e(r)}catch(e){s(e)}}:s})),r.a.h=e,Vn(e,r),r.a}function Gn(e,t,i){if(e.a==Rn){e===i&&(t=Dn,i=new TypeError("Promise cannot resolve to itself")),e.a=1;e:{var n=i,r=e.hc,s=e.ic;if(n instanceof kn){Vn(n,zn(r||g,s||null,e));var o=!0}else if(_n(n))n.then(r,s,e),o=!0;else{if(w(n))try{var a=n.then;if(b(a)){!function(e,t,i,n,r){function s(e){o||(o=!0,n.call(r,e))}var o=!1;try{t.call(e,(function(e){o||(o=!0,i.call(r,e))}),s)}catch(e){s(e)}}(n,a,r,s,e),o=!0;break e}}catch(t){s.call(e,t),o=!0;break e}o=!1}}o||(e.A=i,e.a=t,e.h=null,Hn(e),t!=Dn||i instanceof Xn||function(e,t){e.s=!0,In((function(){e.s&&Zn.call(null,t)}))}(e,i))}}function Hn(e){e.i||(e.i=!0,In(e.Hb,e))}function Wn(e){var t=null;return e.g&&(t=e.g,e.g=t.next,t.next=null),e.g||(e.j=null),t}function qn(e,t,i,n){if(i==Dn&&t.g&&!t.h)for(;e&&e.s;e=e.h)e.s=!1;if(t.a)t.a.h=null,$n(t,i,n);else try{t.h?t.s.call(t.j):$n(t,i,n)}catch(e){Zn.call(null,e)}vn(Nn,t)}function $n(e,t,i){t==Ln?e.s.call(e.j,i):e.g&&e.g.call(e.j,i)}kn.prototype.then=function(e,t,i){return jn(this,b(e)?e:null,b(t)?t:null,i)},kn.prototype.$goog_Thenable=!0,(e=kn.prototype).fc=function(e,t){return(e=zn(e,e,t)).h=!0,Vn(this,e),this},e.Ca=function(e,t){return jn(this,null,e,t)},e.cancel=function(e){this.a==Rn&&In((function(){Un(this,new Xn(e))}),this)},e.hc=function(e){this.a=Rn,Gn(this,Ln,e)},e.ic=function(e){this.a=Rn,Gn(this,Dn,e)},e.Hb=function(){for(var e;e=Wn(this);)qn(this,e,this.a,this.A);this.i=!1};var Zn=Mn;function Xn(e){D.call(this,e)}function Yn(e,t,i){t||(t={}),i=i||window;var n=e instanceof _t?e:xt(void 0!==e.href?e.href:String(e));e=t.target||e.target;var r=[];for(s in t)switch(s){case"width":case"height":case"top":case"left":r.push(s+"="+t[s]);break;case"target":case"noopener":case"noreferrer":break;default:r.push(s+"="+(t[s]?1:0))}var s=r.join(",");return(We("iPhone")&&!We("iPod")&&!We("iPad")||We("iPad")||We("iPod"))&&i.navigator&&i.navigator.standalone&&e&&"_self"!=e?(s=i.document.createElement("A"),n=n instanceof _t?n:bt(n),s.href=yt(n),s.setAttribute("target",e),t.noreferrer&&s.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,i,1),s.dispatchEvent(t),i={}):t.noreferrer?(i=i.open("",e,s),t=yt(n).toString(),i&&(Je&&-1!=t.indexOf(";")&&(t="'"+t.replace(/'/g,"%27")+"'"),i.opener=null,t=Ct('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+ne(t)+'">',null),i.document.write(It(t)),i.document.close())):(i=i.open(yt(n).toString(),e,s))&&t.noopener&&(i.opener=null),i}function Kn(){try{return!(!window.opener||!window.opener.location||window.opener.location.hostname!==window.location.hostname||window.opener.location.protocol!==window.location.protocol)}catch(e){}return!1}function Jn(e){Yn(e,{target:window.cordova&&window.cordova.InAppBrowser?"_system":"_blank"},void 0)}function Qn(e,t){if(null==(e=w(e)&&1==e.nodeType?e:document.querySelector(String(e))))throw Error(t||"Cannot find element.");return e}function er(){return window.location.href}function tr(e){var t=hr;this.s=[],this.T=t,this.O=e||null,this.j=this.a=!1,this.h=void 0,this.J=this.l=this.A=!1,this.i=0,this.g=null,this.C=0}function ir(e,t,i){e.a=!0,e.h=i,e.j=!t,or(e)}function nr(e){if(e.a){if(!e.J)throw new ar(e);e.J=!1}}function rr(e,t,i){e.s.push([t,i,void 0]),e.a&&or(e)}function sr(e){return V(e.s,(function(e){return b(e[1])}))}function or(e){if(e.i&&e.a&&sr(e)){var t=e.i,i=ur[t];i&&(h.clearTimeout(i.a),delete ur[t]),e.i=0}e.g&&(e.g.C--,delete e.g),t=e.h;for(var n=i=!1;e.s.length&&!e.A;){var r=e.s.shift(),s=r[0],o=r[1];if(r=r[2],s=e.j?o:s)try{var a=s.call(r||e.O,t);d(a)&&(e.j=e.j&&(a==t||a instanceof Error),e.h=t=a),(_n(t)||"function"==typeof h.Promise&&t instanceof h.Promise)&&(n=!0,e.A=!0)}catch(n){t=n,e.j=!0,sr(e)||(i=!0)}}e.h=t,n&&(a=I(e.L,e,!0),n=I(e.L,e,!1),t instanceof tr?(rr(t,a,n),t.l=!0):t.then(a,n)),i&&(t=new cr(t),ur[t.a]=t,e.i=t.a)}function ar(){D.call(this)}function lr(){D.call(this)}function cr(e){this.a=h.setTimeout(I(this.h,this),0),this.g=e}L(Xn,D),Xn.prototype.name="cancel",tr.prototype.cancel=function(e){if(this.a)this.h instanceof tr&&this.h.cancel();else{if(this.g){var t=this.g;delete this.g,e?t.cancel(e):(t.C--,0>=t.C&&t.cancel())}this.T?this.T.call(this.O,this):this.J=!0,this.a||(e=new lr(this),nr(this),ir(this,!1,e))}},tr.prototype.L=function(e,t){this.A=!1,ir(this,e,t)},tr.prototype.callback=function(e){nr(this),ir(this,!0,e)},tr.prototype.then=function(e,t,i){var n,r,s=new kn((function(e,t){n=e,r=t}));return rr(this,n,(function(e){e instanceof lr?s.cancel():r(e)})),s.then(e,t,i)},tr.prototype.$goog_Thenable=!0,L(ar,D),ar.prototype.message="Deferred has already fired",ar.prototype.name="AlreadyCalledError",L(lr,D),lr.prototype.message="Deferred was canceled",lr.prototype.name="CanceledError",cr.prototype.h=function(){throw delete ur[this.a],this.g};var ur={};function hr(){if(this&&this.rb){var e=this.rb;e&&"SCRIPT"==e.tagName&&dr(e,!0,this.sb)}}function dr(e,t,i){null!=i&&h.clearTimeout(i),e.onload=g,e.onerror=g,e.onreadystatechange=g,t&&window.setTimeout((function(){Vt(e)}),0)}var pr=0,fr=1;function mr(e,t){var i="Jsloader error (code #"+e+")";t&&(i+=": "+t),D.call(this,i),this.code=e}function gr(){return h.google&&h.google.accounts&&h.google.accounts.id||null}function _r(e){this.a=e||gr(),this.h=!1,this.g=null}function yr(e,t,i){return e.a&&t?(e.h=!0,new kn((function(n){e.g=n,e.a.initialize({client_id:t,callback:n,auto_select:!i}),e.a.prompt()}))):Fn(t?xr.Xa().load().then((function(){return e.a=gr(),yr(e,t,i)})).Ca((function(){return null})):null)}L(mr,D),_r.prototype.cancel=function(){this.a&&this.h&&(this.g&&this.g(null),this.a.cancel())},_(_r);var vr=new ht(pt,"https://accounts.google.com/gsi/client");function xr(){this.a=null}function br(e,t){this.a=e,this.g=t||function(e){throw e}}function wr(e,t,i){this.reset(e,t,i,void 0,void 0)}function Sr(e){this.s=e,this.a=this.h=this.j=this.g=null}function Tr(e,t){this.name=e,this.value=t}xr.prototype.load=function(){var e=this;if(this.a)return this.a;var t=function(){var e=vr;e instanceof ht&&e.constructor===ht&&e.g===dt?e=e.a:(N("expected object of type Const, got '"+e+"'"),e="type_error:Const");var t=new ft;return t.a=e,t}();return gr()?Fn():this.a=function(){var e=null;return new kn((function(t){"complete"==h.document.readyState?t():(e=function(){t()},Ji(window,"load",e))})).Ca((function(t){throw Qi(window,"load",e),t}))}().then((function(){if(!gr())return new kn((function(i,n){var r=setTimeout((function(){e.a=null,n(Error("Network error!"))}),1e4);h.onGoogleLibraryLoad=function(){clearTimeout(r),i()},Fn(function(e){var t={},i=t.document||document,n=mt(e).toString(),r=document.createElement("SCRIPT"),s={rb:r,sb:void 0},o=new tr(s),a=null,l=null!=t.timeout?t.timeout:5e3;return 0<l&&(a=window.setTimeout((function(){dr(r,!0);var e=new mr(fr,"Timeout reached for loading script "+n);nr(o),ir(o,!1,e)}),l),s.sb=a),r.onload=r.onreadystatechange=function(){r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(dr(r,t.xc||!1,a),o.callback(null))},r.onerror=function(){dr(r,!0,a);var e=new mr(pr,"Error while loading script "+n);nr(o),ir(o,!1,e)},ae(s=t.attributes||{},{type:"text/javascript",charset:"UTF-8"}),function(e,t){re(t,(function(t,i){t&&"object"==typeof t&&t.ma&&(t=t.ka()),"style"==i?e.style.cssText=t:"class"==i?e.className=t:"for"==i?e.htmlFor=t:Bt.hasOwnProperty(i)?e.setAttribute(Bt[i],t):0==i.lastIndexOf("aria-",0)||0==i.lastIndexOf("data-",0)?e.setAttribute(i,t):e[i]=t}))}(r,s),function(e,t){e.src=mt(t),null===m&&(m=(t=(t=h.document).querySelector&&t.querySelector("script[nonce]"))&&(t=t.nonce||t.getAttribute("nonce"))&&f.test(t)?t:""),(t=m)&&e.setAttribute("nonce",t)}(r,e),function(e){var t=(e||document).getElementsByTagName("HEAD");return t&&0!=t.length?t[0]:e.documentElement}(i).appendChild(r),o}(t)).then((function(){gr()&&i()})).Ca((function(t){clearTimeout(r),e.a=null,n(t)}))}))}))},_(xr),br.prototype.confirm=function(e){return Fn(this.a.confirm(e)).Ca(this.g)},wr.prototype.a=null,wr.prototype.reset=function(e,t,i,n,r){this.h=n||k(),this.j=e,this.s=t,this.g=i,delete this.a},Tr.prototype.toString=function(){return this.name};var Er=new Tr("SEVERE",1e3),Mr=new Tr("WARNING",900),Ir=new Tr("CONFIG",700);function Ar(e){return e.j?e.j:e.g?Ar(e.g):(N("Root logger has no level set."),null)}Sr.prototype.log=function(e,t,i){if(e.value>=Ar(this).value)for(b(t)&&(t=t()),e=new wr(e,String(t),this.s),i&&(e.a=i),i=this;i;){var n=i,r=e;if(n.a)for(var s=0;t=n.a[s];s++)t(r);i=i.g}};var Cr={},Pr=null;function kr(){Pr||(Pr=new Sr(""),Cr[""]=Pr,Pr.j=Ir)}function Rr(){this.a=k()}var Lr=null;function Dr(e){this.j=e||"",Lr||(Lr=new Rr),this.s=Lr}function Or(e){return 10>e?"0"+e:String(e)}function Nr(e){Dr.call(this,e)}function zr(){this.s=I(this.h,this),this.a=new Nr,this.a.g=!1,this.a.h=!1,this.g=this.a.a=!1,this.j={}}Rr.prototype.set=function(e){this.a=e},Rr.prototype.reset=function(){this.set(k())},Rr.prototype.get=function(){return this.a},Dr.prototype.a=!0,Dr.prototype.g=!0,Dr.prototype.h=!1,L(Nr,Dr),zr.prototype.h=function(e){if(!this.j[e.g]){var t=function(e,t){var i=[];if(i.push(e.j," "),e.g){var n=new Date(t.h);i.push("[",Or(n.getFullYear()-2e3)+Or(n.getMonth()+1)+Or(n.getDate())+" "+Or(n.getHours())+":"+Or(n.getMinutes())+":"+Or(n.getSeconds())+"."+Or(Math.floor(n.getMilliseconds()/10)),"] ")}return i.push("[",function(e,t){t=(e=(e.h-t)/1e3).toFixed(3);var i=0;if(1>e)i=2;else for(;100>e;)i++,e*=10;for(;0<i--;)t=" "+t;return t}(t,e.s.get()),"s] "),i.push("[",t.g,"] "),i.push(t.s),e.h&&(t=t.a)&&i.push("\n",t instanceof Error?t.message:t.toString()),e.a&&i.push("\n"),i.join("")}(this.a,e);Br&&function(e,t,i,n){e[t]?e[t](i,n||""):e.log(i,n||"")}(Br,function(e){if(e){if(e.value>=Er.value)return"error";if(e.value>=Mr.value)return"warn";if(e.value>=Ir.value)return"log"}return"debug"}(e.j),t,e.a)}};var Fr,Br=h.console;function Ur(e,t){Fr&&Fr.log(Er,e,t)}Fr=function e(t){var i;if(kr(),!(i=Cr[t])){i=new Sr(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=e(t.substr(0,n))).h||(n.h={}),n.h[r]=i,i.g=n,Cr[t]=i}return i}("firebaseui");var Vr=new zr;if(1!=Vr.g){var jr;kr(),jr=Pr;var Gr=Vr.s;jr.a||(jr.a=[]),jr.a.push(Gr),Vr.g=!0}function Hr(e){Fr&&Fr.log(Mr,e,void 0)}function Wr(){this.a=("undefined"==typeof document?null:document)||{cookie:""}}function qr(e){e=(e.a.cookie||"").split(";");for(var t,i,n=[],r=[],s=0;s<e.length;s++)-1==(t=(i=Z(e[s])).indexOf("="))?(n.push(""),r.push(i)):(n.push(i.substring(0,t)),r.push(i.substring(t+1)));return{keys:n,values:r}}(e=Wr.prototype).set=function(e,t,i,n,r,s){if(/[;=\s]/.test(e))throw Error('Invalid cookie name "'+e+'"');if(/[;\r\n]/.test(t))throw Error('Invalid cookie value "'+t+'"');d(i)||(i=-1),r=r?";domain="+r:"",n=n?";path="+n:"",s=s?";secure":"",i=0>i?"":0==i?";expires="+new Date(1970,1,1).toUTCString():";expires="+new Date(k()+1e3*i).toUTCString(),this.a.cookie=e+"="+t+r+n+i+s},e.get=function(e,t){for(var i,n=e+"=",r=(this.a.cookie||"").split(";"),s=0;s<r.length;s++){if(0==(i=Z(r[s])).lastIndexOf(n,0))return i.substr(n.length);if(i==e)return""}return t},e.ja=function(){return qr(this).keys},e.la=function(){return qr(this).values},e.clear=function(){for(var e=qr(this).keys,t=e.length-1;0<=t;t--){var i=e[t];this.get(i),this.set(i,"",0,void 0,void 0)}};var $r=new Wr;function Zr(){}function Xr(e,t,i,n){this.h=null!=e?e:-1,this.g=t||null,this.a=i||null,this.j=!!n}function Yr(e,t){this.g=e,this.a=t||null}function Kr(e){return{email:e.g,credential:e.a&&e.a.toJSON()}}function Jr(e){if(e&&e.email){var t=e.credential&&Dg.auth.AuthCredential.fromJSON(e.credential);return new Yr(e.email,t)}return null}function Qr(e){this.a=e||null}function es(e){for(var t=[],i=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);255<r&&(t[i++]=255&r,r>>=8),t[i++]=r}return t}function ts(e){return U(e,(function(e){return 1<(e=e.toString(16)).length?e:"0"+e})).join("")}function is(e){for(this.i=e,this.g=this.i.length/4,this.j=this.g+6,this.h=[[],[],[],[]],this.s=[[],[],[],[]],this.a=Array(ns*(this.j+1)),e=0;e<this.g;e++)this.a[e]=[this.i[4*e],this.i[4*e+1],this.i[4*e+2],this.i[4*e+3]];var t=Array(4);for(e=this.g;e<ns*(this.j+1);e++){if(t[0]=this.a[e-1][0],t[1]=this.a[e-1][1],t[2]=this.a[e-1][2],t[3]=this.a[e-1][3],0==e%this.g){var i=t,n=i[0];i[0]=i[1],i[1]=i[2],i[2]=i[3],i[3]=n,us(t),t[0]^=ps[e/this.g][0],t[1]^=ps[e/this.g][1],t[2]^=ps[e/this.g][2],t[3]^=ps[e/this.g][3]}else 6<this.g&&4==e%this.g&&us(t);this.a[e]=Array(4),this.a[e][0]=this.a[e-this.g][0]^t[0],this.a[e][1]=this.a[e-this.g][1]^t[1],this.a[e][2]=this.a[e-this.g][2]^t[2],this.a[e][3]=this.a[e-this.g][3]^t[3]}}a(Xr,Zr),Xr.prototype.set=function(e,t){$r.set(e,t,this.h,this.g,this.a,this.j)},Xr.prototype.get=function(e){return $r.get(e)||null},Xr.prototype.ra=function(e){var t=this.g,i=this.a;$r.get(e),$r.set(e,"",0,t,i)},is.prototype.A=16;var ns=is.prototype.A/4;function rs(e,t){for(var i,n=0;n<ns;n++)for(var r=0;4>r;r++)i=t[i=4*r+n],e.h[n][r]=i}function ss(e){for(var t=[],i=0;i<ns;i++)for(var n=0;4>n;n++)t[4*n+i]=e.h[i][n];return t}function os(e,t){for(var i=0;4>i;i++)for(var n=0;4>n;n++)e.h[i][n]^=e.a[4*t+n][i]}function as(e,t){for(var i=0;4>i;i++)for(var n=0;4>n;n++)e.h[i][n]=t[e.h[i][n]]}function ls(e){for(var t=1;4>t;t++)for(var i=0;4>i;i++)e.s[t][i]=e.h[t][i];for(t=1;4>t;t++)for(i=0;4>i;i++)e.h[t][i]=e.s[t][(i+t)%ns]}function cs(e){for(var t=1;4>t;t++)for(var i=0;4>i;i++)e.s[t][(i+t)%ns]=e.h[t][i];for(t=1;4>t;t++)for(i=0;4>i;i++)e.h[t][i]=e.s[t][i]}function us(e){e[0]=hs[e[0]],e[1]=hs[e[1]],e[2]=hs[e[2]],e[3]=hs[e[3]]}var hs=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],ds=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],ps=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]],fs=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,254,27,25,31,29,19,17,23,21,11,9,15,13,3,1,7,5,59,57,63,61,51,49,55,53,43,41,47,45,35,33,39,37,91,89,95,93,83,81,87,85,75,73,79,77,67,65,71,69,123,121,127,125,115,113,119,117,107,105,111,109,99,97,103,101,155,153,159,157,147,145,151,149,139,137,143,141,131,129,135,133,187,185,191,189,179,177,183,181,171,169,175,173,163,161,167,165,219,217,223,221,211,209,215,213,203,201,207,205,195,193,199,197,251,249,255,253,243,241,247,245,235,233,239,237,227,225,231,229],ms=[0,3,6,5,12,15,10,9,24,27,30,29,20,23,18,17,48,51,54,53,60,63,58,57,40,43,46,45,36,39,34,33,96,99,102,101,108,111,106,105,120,123,126,125,116,119,114,113,80,83,86,85,92,95,90,89,72,75,78,77,68,71,66,65,192,195,198,197,204,207,202,201,216,219,222,221,212,215,210,209,240,243,246,245,252,255,250,249,232,235,238,237,228,231,226,225,160,163,166,165,172,175,170,169,184,187,190,189,180,183,178,177,144,147,150,149,156,159,154,153,136,139,142,141,132,135,130,129,155,152,157,158,151,148,145,146,131,128,133,134,143,140,137,138,171,168,173,174,167,164,161,162,179,176,181,182,191,188,185,186,251,248,253,254,247,244,241,242,227,224,229,230,239,236,233,234,203,200,205,206,199,196,193,194,211,208,213,214,223,220,217,218,91,88,93,94,87,84,81,82,67,64,69,70,79,76,73,74,107,104,109,110,103,100,97,98,115,112,117,118,127,124,121,122,59,56,61,62,55,52,49,50,35,32,37,38,47,44,41,42,11,8,13,14,7,4,1,2,19,16,21,22,31,28,25,26],gs=[0,9,18,27,36,45,54,63,72,65,90,83,108,101,126,119,144,153,130,139,180,189,166,175,216,209,202,195,252,245,238,231,59,50,41,32,31,22,13,4,115,122,97,104,87,94,69,76,171,162,185,176,143,134,157,148,227,234,241,248,199,206,213,220,118,127,100,109,82,91,64,73,62,55,44,37,26,19,8,1,230,239,244,253,194,203,208,217,174,167,188,181,138,131,152,145,77,68,95,86,105,96,123,114,5,12,23,30,33,40,51,58,221,212,207,198,249,240,235,226,149,156,135,142,177,184,163,170,236,229,254,247,200,193,218,211,164,173,182,191,128,137,146,155,124,117,110,103,88,81,74,67,52,61,38,47,16,25,2,11,215,222,197,204,243,250,225,232,159,150,141,132,187,178,169,160,71,78,85,92,99,106,113,120,15,6,29,20,43,34,57,48,154,147,136,129,190,183,172,165,210,219,192,201,246,255,228,237,10,3,24,17,46,39,60,53,66,75,80,89,102,111,116,125,161,168,179,186,133,140,151,158,233,224,251,242,205,196,223,214,49,56,35,42,21,28,7,14,121,112,107,98,93,84,79,70],_s=[0,11,22,29,44,39,58,49,88,83,78,69,116,127,98,105,176,187,166,173,156,151,138,129,232,227,254,245,196,207,210,217,123,112,109,102,87,92,65,74,35,40,53,62,15,4,25,18,203,192,221,214,231,236,241,250,147,152,133,142,191,180,169,162,246,253,224,235,218,209,204,199,174,165,184,179,130,137,148,159,70,77,80,91,106,97,124,119,30,21,8,3,50,57,36,47,141,134,155,144,161,170,183,188,213,222,195,200,249,242,239,228,61,54,43,32,17,26,7,12,101,110,115,120,73,66,95,84,247,252,225,234,219,208,205,198,175,164,185,178,131,136,149,158,71,76,81,90,107,96,125,118,31,20,9,2,51,56,37,46,140,135,154,145,160,171,182,189,212,223,194,201,248,243,238,229,60,55,42,33,16,27,6,13,100,111,114,121,72,67,94,85,1,10,23,28,45,38,59,48,89,82,79,68,117,126,99,104,177,186,167,172,157,150,139,128,233,226,255,244,197,206,211,216,122,113,108,103,86,93,64,75,34,41,52,63,14,5,24,19,202,193,220,215,230,237,240,251,146,153,132,143,190,181,168,163],ys=[0,13,26,23,52,57,46,35,104,101,114,127,92,81,70,75,208,221,202,199,228,233,254,243,184,181,162,175,140,129,150,155,187,182,161,172,143,130,149,152,211,222,201,196,231,234,253,240,107,102,113,124,95,82,69,72,3,14,25,20,55,58,45,32,109,96,119,122,89,84,67,78,5,8,31,18,49,60,43,38,189,176,167,170,137,132,147,158,213,216,207,194,225,236,251,246,214,219,204,193,226,239,248,245,190,179,164,169,138,135,144,157,6,11,28,17,50,63,40,37,110,99,116,121,90,87,64,77,218,215,192,205,238,227,244,249,178,191,168,165,134,139,156,145,10,7,16,29,62,51,36,41,98,111,120,117,86,91,76,65,97,108,123,118,85,88,79,66,9,4,19,30,61,48,39,42,177,188,171,166,133,136,159,146,217,212,195,206,237,224,247,250,183,186,173,160,131,142,153,148,223,210,197,200,235,230,241,252,103,106,125,112,83,94,73,68,15,2,21,24,59,54,33,44,12,1,22,27,56,53,34,47,100,105,126,115,80,93,74,71,220,209,198,203,232,229,242,255,180,185,174,163,128,141,154,151],vs=[0,14,28,18,56,54,36,42,112,126,108,98,72,70,84,90,224,238,252,242,216,214,196,202,144,158,140,130,168,166,180,186,219,213,199,201,227,237,255,241,171,165,183,185,147,157,143,129,59,53,39,41,3,13,31,17,75,69,87,89,115,125,111,97,173,163,177,191,149,155,137,135,221,211,193,207,229,235,249,247,77,67,81,95,117,123,105,103,61,51,33,47,5,11,25,23,118,120,106,100,78,64,82,92,6,8,26,20,62,48,34,44,150,152,138,132,174,160,178,188,230,232,250,244,222,208,194,204,65,79,93,83,121,119,101,107,49,63,45,35,9,7,21,27,161,175,189,179,153,151,133,139,209,223,205,195,233,231,245,251,154,148,134,136,162,172,190,176,234,228,246,248,210,220,206,192,122,116,102,104,66,76,94,80,10,4,22,24,50,60,46,32,236,226,240,254,212,218,200,198,156,146,128,142,164,170,184,182,12,2,16,30,52,58,40,38,124,114,96,110,68,74,88,86,55,57,43,37,15,1,19,29,71,73,91,85,127,113,99,109,215,217,203,197,239,225,243,253,167,169,187,181,159,145,131,141];function xs(e,t){e=new is(ws(e));for(var i,n=(t=es(t)).splice(0,16),r="";n.length;){i=16-n.length;for(var s=0;s<i;s++)n.push(0);for(rs(i=e,n),os(i,0),n=1;n<i.j;++n){as(i,hs),ls(i),s=i.h;for(var o=i.s[0],a=0;4>a;a++)o[0]=s[0][a],o[1]=s[1][a],o[2]=s[2][a],o[3]=s[3][a],s[0][a]=fs[o[0]]^ms[o[1]]^o[2]^o[3],s[1][a]=o[0]^fs[o[1]]^ms[o[2]]^o[3],s[2][a]=o[0]^o[1]^fs[o[2]]^ms[o[3]],s[3][a]=ms[o[0]]^o[1]^o[2]^fs[o[3]];os(i,n)}as(i,hs),ls(i),os(i,i.j),r+=ts(ss(i)),n=t.splice(0,16)}return r}function bs(e,t){e=new is(ws(e));for(var i=[],n=0;n<t.length;n+=2)i.push(parseInt(t.substring(n,n+2),16));var r=i.splice(0,16);for(t="";r.length;){for(rs(n=e,r),os(n,n.j),r=1;r<n.j;++r){cs(n),as(n,ds),os(n,n.j-r);for(var s=n.h,o=n.s[0],a=0;4>a;a++)o[0]=s[0][a],o[1]=s[1][a],o[2]=s[2][a],o[3]=s[3][a],s[0][a]=vs[o[0]]^_s[o[1]]^ys[o[2]]^gs[o[3]],s[1][a]=gs[o[0]]^vs[o[1]]^_s[o[2]]^ys[o[3]],s[2][a]=ys[o[0]]^gs[o[1]]^vs[o[2]]^_s[o[3]],s[3][a]=_s[o[0]]^ys[o[1]]^gs[o[2]]^vs[o[3]]}if(cs(n),as(n,ds),os(n,0),8192>=(n=ss(n)).length)n=String.fromCharCode.apply(null,n);else{for(r="",s=0;s<n.length;s+=8192)r+=String.fromCharCode.apply(null,$(n,s,s+8192));n=r}t+=n,r=i.splice(0,16)}return t.replace(/(\x00)+$/,"")}function ws(e){for(var t=32-(e=es(e.substring(0,32))).length,i=0;i<t;i++)e.push(0);return e}function Ss(e){var t=[];return Es(new Ts,e,t),t.join("")}function Ts(){}function Es(e,t,i){if(null==t)i.push("null");else{if("object"==typeof t){if(v(t)){var n=t;t=n.length,i.push("[");for(var r="",s=0;s<t;s++)i.push(r),Es(e,n[s],i),r=",";return void i.push("]")}if(!(t instanceof String||t instanceof Number||t instanceof Boolean)){for(n in i.push("{"),r="",t)Object.prototype.hasOwnProperty.call(t,n)&&"function"!=typeof(s=t[n])&&(i.push(r),As(n,i),i.push(":"),Es(e,s,i),r=",");return void i.push("}")}t=t.valueOf()}switch(typeof t){case"string":As(t,i);break;case"number":i.push(isFinite(t)&&!isNaN(t)?String(t):"null");break;case"boolean":i.push(String(t));break;case"function":i.push("null");break;default:throw Error("Unknown type: "+typeof t)}}}var Ms={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Is=/\uffff/.test("")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function As(e,t){t.push('"',e.replace(Is,(function(e){var t=Ms[e];return t||(t="\\u"+(65536|e.charCodeAt(0)).toString(16).substr(1),Ms[e]=t),t})),'"')}function Cs(e){this.a=e}function Ps(){}function ks(e){this.a=e}function Rs(e){if(!e.a)return!1;try{return e.a.setItem("__sak","1"),e.a.removeItem("__sak"),!0}catch(e){return!1}}function Ls(){var e=null;try{e=window.localStorage||null}catch(e){}this.a=e}function Ds(){var e=null;try{e=window.sessionStorage||null}catch(e){}this.a=e}function Os(e,t){this.g=e,this.a=t+"::"}Cs.prototype.set=function(e,t){d(t)?this.a.set(e,Ss(t)):this.a.ra(e)},Cs.prototype.get=function(e){try{var t=this.a.get(e)}catch(e){return}if(null!==t)try{return JSON.parse(t)}catch(e){throw"Storage: Invalid value was encountered"}},L(Ps,Zr),Ps.prototype.clear=function(){var e=function(e){if(x(e))return q(e);e=ue(e);var t=[];return function(e,t){if(x(e))try{F(e,t,void 0)}catch(e){if(e!==le)throw e}else{e=ue(e);try{for(;;)t.call(void 0,e.next(),void 0,e)}catch(e){if(e!==le)throw e}}}(e,(function(e){t.push(e)})),t}(this.ha(!0)),t=this;F(e,(function(e){t.ra(e)}))},L(ks,Ps),(e=ks.prototype).set=function(e,t){try{this.a.setItem(e,t)}catch(e){if(0==this.a.length)throw"Storage mechanism: Storage disabled";throw"Storage mechanism: Quota exceeded"}},e.get=function(e){if(!p(e=this.a.getItem(e))&&null!==e)throw"Storage mechanism: Invalid value was encountered";return e},e.ra=function(e){this.a.removeItem(e)},e.ha=function(e){var t=0,i=this.a,n=new ce;return n.next=function(){if(t>=i.length)throw le;var n=i.key(t++);if(e)return n;if(!p(n=i.getItem(n)))throw"Storage mechanism: Invalid value was encountered";return n},n},e.clear=function(){this.a.clear()},e.key=function(e){return this.a.key(e)},L(Ls,ks),L(Ds,ks),L(Os,Ps),Os.prototype.set=function(e,t){this.g.set(this.a+e,t)},Os.prototype.get=function(e){return this.g.get(this.a+e)},Os.prototype.ra=function(e){this.g.ra(this.a+e)},Os.prototype.ha=function(e){var t=this.g.ha(!0),i=this,n=new ce;return n.next=function(){for(var n=t.next();n.substr(0,i.a.length)!=i.a;)n=t.next();return e?n.substr(i.a.length):i.g.get(n)},n},Rs(new Ls);var Ns=new Ds,zs=new Cs(Rs(Ns)?new Os(Ns,"firebaseui"):null),Fs={name:"pendingEmailCredential",storage:zs},Bs={name:"redirectStatus",storage:zs},Us={name:"redirectUrl",storage:zs},Vs={name:"emailForSignIn",storage:new Cs(new Xr(3600,"/"))},js={name:"pendingEncryptedCredential",storage:new Cs(new Xr(3600,"/"))};function Gs(e,t){return e.storage.get(t?e.name+":"+t:e.name)}function Hs(e,t){e.storage.a.ra(t?e.name+":"+t:e.name)}function Ws(e,t,i){e.storage.set(i?e.name+":"+i:e.name,t)}function qs(e){return Gs(Us,e)||null}function $s(e){return Jr(e=Gs(Fs,e)||null)}function Zs(e){Hs(Fs,e)}function Xs(e,t){Ws(Fs,Kr(e),t)}function Ys(e){return(e=Gs(Bs,e)||null)&&void 0!==e.tenantId?new Qr(e.tenantId):null}function Ks(){this.W={}}function Js(e,t,i){if(t.toLowerCase()in e.W)throw Error("Configuration "+t+" has already been defined.");e.W[t.toLowerCase()]=i}function Qs(e,t,i){if(!(t.toLowerCase()in e.W))throw Error("Configuration "+t+" is not defined.");e.W[t.toLowerCase()]=i}function eo(e,t){if(!(e=e.get(t)))throw Error("Configuration "+t+" is required.");return e}function to(){this.g=void 0,this.a={}}function io(e,t,i,n){for(var r=0;r<t.length;r++){var s=t.charAt(r);e.a[s]||(e.a[s]=new to),e=e.a[s]}if(n&&void 0!==e.g)throw Error('The collection already contains the key "'+t+'"');e.g=i}function no(e,t){for(var i in void 0!==e.g&&t.push(e.g),e.a)no(e.a[i],t)}function ro(e,t,i){for(var n in void 0!==e.g&&i.push(t),e.a)ro(e.a[n],t+n,i)}function so(e){for(this.a=e,this.g=new to,e=0;e<this.a.length;e++){var t=this.g.get("+"+this.a[e].b);t?t.push(this.a[e]):this.g.add("+"+this.a[e].b,[this.a[e]])}}function oo(e,t){var i={},n=0;for(void 0!==(e=e.g).g&&(i[n]=e.g);n<t.length;n++){var r=t.charAt(n);if(!(r in e.a))break;void 0!==(e=e.a[r]).g&&(i[n]=e.g)}for(var s in i)if(i.hasOwnProperty(s))return i[s];return[]}function ao(e){for(var t=0;t<ho.length;t++)if(ho[t].c===e)return ho[t];return null}function lo(e){e=e.toUpperCase();for(var t=[],i=0;i<ho.length;i++)ho[i].f===e&&t.push(ho[i]);return t}function co(e){if(0<e.length&&"+"==e.charAt(0)){e=e.substring(1);for(var t=[],i=0;i<ho.length;i++)ho[i].b==e&&t.push(ho[i]);e=t}else e=lo(e);return e}function uo(e){e.sort((function(e,t){return e.name.localeCompare(t.name,"en")}))}Ks.prototype.get=function(e){if(!(e.toLowerCase()in this.W))throw Error("Configuration "+e+" is not defined.");return this.W[e.toLowerCase()]},(e=to.prototype).set=function(e,t){io(this,e,t,!1)},e.add=function(e,t){io(this,e,t,!0)},e.get=function(e){e:{for(var t=this,i=0;i<e.length;i++)if(!(t=t.a[e.charAt(i)])){e=void 0;break e}e=t}return e?e.g:void 0},e.la=function(){var e=[];return no(this,e),e},e.ja=function(){var e=[];return ro(this,"",e),e},e.clear=function(){this.a={},this.g=void 0};var ho=[{name:"Afghanistan",c:"93-AF-0",b:"93",f:"AF"},{name:"land Islands",c:"358-AX-0",b:"358",f:"AX"},{name:"Albania",c:"355-AL-0",b:"355",f:"AL"},{name:"Algeria",c:"213-DZ-0",b:"213",f:"DZ"},{name:"American Samoa",c:"1-AS-0",b:"1",f:"AS"},{name:"Andorra",c:"376-AD-0",b:"376",f:"AD"},{name:"Angola",c:"244-AO-0",b:"244",f:"AO"},{name:"Anguilla",c:"1-AI-0",b:"1",f:"AI"},{name:"Antigua and Barbuda",c:"1-AG-0",b:"1",f:"AG"},{name:"Argentina",c:"54-AR-0",b:"54",f:"AR"},{name:"Armenia",c:"374-AM-0",b:"374",f:"AM"},{name:"Aruba",c:"297-AW-0",b:"297",f:"AW"},{name:"Ascension Island",c:"247-AC-0",b:"247",f:"AC"},{name:"Australia",c:"61-AU-0",b:"61",f:"AU"},{name:"Austria",c:"43-AT-0",b:"43",f:"AT"},{name:"Azerbaijan",c:"994-AZ-0",b:"994",f:"AZ"},{name:"Bahamas",c:"1-BS-0",b:"1",f:"BS"},{name:"Bahrain",c:"973-BH-0",b:"973",f:"BH"},{name:"Bangladesh",c:"880-BD-0",b:"880",f:"BD"},{name:"Barbados",c:"1-BB-0",b:"1",f:"BB"},{name:"Belarus",c:"375-BY-0",b:"375",f:"BY"},{name:"Belgium",c:"32-BE-0",b:"32",f:"BE"},{name:"Belize",c:"501-BZ-0",b:"501",f:"BZ"},{name:"Benin",c:"229-BJ-0",b:"229",f:"BJ"},{name:"Bermuda",c:"1-BM-0",b:"1",f:"BM"},{name:"Bhutan",c:"975-BT-0",b:"975",f:"BT"},{name:"Bolivia",c:"591-BO-0",b:"591",f:"BO"},{name:"Bosnia and Herzegovina",c:"387-BA-0",b:"387",f:"BA"},{name:"Botswana",c:"267-BW-0",b:"267",f:"BW"},{name:"Brazil",c:"55-BR-0",b:"55",f:"BR"},{name:"British Indian Ocean Territory",c:"246-IO-0",b:"246",f:"IO"},{name:"British Virgin Islands",c:"1-VG-0",b:"1",f:"VG"},{name:"Brunei",c:"673-BN-0",b:"673",f:"BN"},{name:"Bulgaria",c:"359-BG-0",b:"359",f:"BG"},{name:"Burkina Faso",c:"226-BF-0",b:"226",f:"BF"},{name:"Burundi",c:"257-BI-0",b:"257",f:"BI"},{name:"Cambodia",c:"855-KH-0",b:"855",f:"KH"},{name:"Cameroon",c:"237-CM-0",b:"237",f:"CM"},{name:"Canada",c:"1-CA-0",b:"1",f:"CA"},{name:"Cape Verde",c:"238-CV-0",b:"238",f:"CV"},{name:"Caribbean Netherlands",c:"599-BQ-0",b:"599",f:"BQ"},{name:"Cayman Islands",c:"1-KY-0",b:"1",f:"KY"},{name:"Central African Republic",c:"236-CF-0",b:"236",f:"CF"},{name:"Chad",c:"235-TD-0",b:"235",f:"TD"},{name:"Chile",c:"56-CL-0",b:"56",f:"CL"},{name:"China",c:"86-CN-0",b:"86",f:"CN"},{name:"Christmas Island",c:"61-CX-0",b:"61",f:"CX"},{name:"Cocos [Keeling] Islands",c:"61-CC-0",b:"61",f:"CC"},{name:"Colombia",c:"57-CO-0",b:"57",f:"CO"},{name:"Comoros",c:"269-KM-0",b:"269",f:"KM"},{name:"Democratic Republic Congo",c:"243-CD-0",b:"243",f:"CD"},{name:"Republic of Congo",c:"242-CG-0",b:"242",f:"CG"},{name:"Cook Islands",c:"682-CK-0",b:"682",f:"CK"},{name:"Costa Rica",c:"506-CR-0",b:"506",f:"CR"},{name:"Cte d'Ivoire",c:"225-CI-0",b:"225",f:"CI"},{name:"Croatia",c:"385-HR-0",b:"385",f:"HR"},{name:"Cuba",c:"53-CU-0",b:"53",f:"CU"},{name:"Curaao",c:"599-CW-0",b:"599",f:"CW"},{name:"Cyprus",c:"357-CY-0",b:"357",f:"CY"},{name:"Czech Republic",c:"420-CZ-0",b:"420",f:"CZ"},{name:"Denmark",c:"45-DK-0",b:"45",f:"DK"},{name:"Djibouti",c:"253-DJ-0",b:"253",f:"DJ"},{name:"Dominica",c:"1-DM-0",b:"1",f:"DM"},{name:"Dominican Republic",c:"1-DO-0",b:"1",f:"DO"},{name:"East Timor",c:"670-TL-0",b:"670",f:"TL"},{name:"Ecuador",c:"593-EC-0",b:"593",f:"EC"},{name:"Egypt",c:"20-EG-0",b:"20",f:"EG"},{name:"El Salvador",c:"503-SV-0",b:"503",f:"SV"},{name:"Equatorial Guinea",c:"240-GQ-0",b:"240",f:"GQ"},{name:"Eritrea",c:"291-ER-0",b:"291",f:"ER"},{name:"Estonia",c:"372-EE-0",b:"372",f:"EE"},{name:"Ethiopia",c:"251-ET-0",b:"251",f:"ET"},{name:"Falkland Islands [Islas Malvinas]",c:"500-FK-0",b:"500",f:"FK"},{name:"Faroe Islands",c:"298-FO-0",b:"298",f:"FO"},{name:"Fiji",c:"679-FJ-0",b:"679",f:"FJ"},{name:"Finland",c:"358-FI-0",b:"358",f:"FI"},{name:"France",c:"33-FR-0",b:"33",f:"FR"},{name:"French Guiana",c:"594-GF-0",b:"594",f:"GF"},{name:"French Polynesia",c:"689-PF-0",b:"689",f:"PF"},{name:"Gabon",c:"241-GA-0",b:"241",f:"GA"},{name:"Gambia",c:"220-GM-0",b:"220",f:"GM"},{name:"Georgia",c:"995-GE-0",b:"995",f:"GE"},{name:"Germany",c:"49-DE-0",b:"49",f:"DE"},{name:"Ghana",c:"233-GH-0",b:"233",f:"GH"},{name:"Gibraltar",c:"350-GI-0",b:"350",f:"GI"},{name:"Greece",c:"30-GR-0",b:"30",f:"GR"},{name:"Greenland",c:"299-GL-0",b:"299",f:"GL"},{name:"Grenada",c:"1-GD-0",b:"1",f:"GD"},{name:"Guadeloupe",c:"590-GP-0",b:"590",f:"GP"},{name:"Guam",c:"1-GU-0",b:"1",f:"GU"},{name:"Guatemala",c:"502-GT-0",b:"502",f:"GT"},{name:"Guernsey",c:"44-GG-0",b:"44",f:"GG"},{name:"Guinea Conakry",c:"224-GN-0",b:"224",f:"GN"},{name:"Guinea-Bissau",c:"245-GW-0",b:"245",f:"GW"},{name:"Guyana",c:"592-GY-0",b:"592",f:"GY"},{name:"Haiti",c:"509-HT-0",b:"509",f:"HT"},{name:"Heard Island and McDonald Islands",c:"672-HM-0",b:"672",f:"HM"},{name:"Honduras",c:"504-HN-0",b:"504",f:"HN"},{name:"Hong Kong",c:"852-HK-0",b:"852",f:"HK"},{name:"Hungary",c:"36-HU-0",b:"36",f:"HU"},{name:"Iceland",c:"354-IS-0",b:"354",f:"IS"},{name:"India",c:"91-IN-0",b:"91",f:"IN"},{name:"Indonesia",c:"62-ID-0",b:"62",f:"ID"},{name:"Iran",c:"98-IR-0",b:"98",f:"IR"},{name:"Iraq",c:"964-IQ-0",b:"964",f:"IQ"},{name:"Ireland",c:"353-IE-0",b:"353",f:"IE"},{name:"Isle of Man",c:"44-IM-0",b:"44",f:"IM"},{name:"Israel",c:"972-IL-0",b:"972",f:"IL"},{name:"Italy",c:"39-IT-0",b:"39",f:"IT"},{name:"Jamaica",c:"1-JM-0",b:"1",f:"JM"},{name:"Japan",c:"81-JP-0",b:"81",f:"JP"},{name:"Jersey",c:"44-JE-0",b:"44",f:"JE"},{name:"Jordan",c:"962-JO-0",b:"962",f:"JO"},{name:"Kazakhstan",c:"7-KZ-0",b:"7",f:"KZ"},{name:"Kenya",c:"254-KE-0",b:"254",f:"KE"},{name:"Kiribati",c:"686-KI-0",b:"686",f:"KI"},{name:"Kosovo",c:"377-XK-0",b:"377",f:"XK"},{name:"Kosovo",c:"381-XK-0",b:"381",f:"XK"},{name:"Kosovo",c:"386-XK-0",b:"386",f:"XK"},{name:"Kuwait",c:"965-KW-0",b:"965",f:"KW"},{name:"Kyrgyzstan",c:"996-KG-0",b:"996",f:"KG"},{name:"Laos",c:"856-LA-0",b:"856",f:"LA"},{name:"Latvia",c:"371-LV-0",b:"371",f:"LV"},{name:"Lebanon",c:"961-LB-0",b:"961",f:"LB"},{name:"Lesotho",c:"266-LS-0",b:"266",f:"LS"},{name:"Liberia",c:"231-LR-0",b:"231",f:"LR"},{name:"Libya",c:"218-LY-0",b:"218",f:"LY"},{name:"Liechtenstein",c:"423-LI-0",b:"423",f:"LI"},{name:"Lithuania",c:"370-LT-0",b:"370",f:"LT"},{name:"Luxembourg",c:"352-LU-0",b:"352",f:"LU"},{name:"Macau",c:"853-MO-0",b:"853",f:"MO"},{name:"Macedonia",c:"389-MK-0",b:"389",f:"MK"},{name:"Madagascar",c:"261-MG-0",b:"261",f:"MG"},{name:"Malawi",c:"265-MW-0",b:"265",f:"MW"},{name:"Malaysia",c:"60-MY-0",b:"60",f:"MY"},{name:"Maldives",c:"960-MV-0",b:"960",f:"MV"},{name:"Mali",c:"223-ML-0",b:"223",f:"ML"},{name:"Malta",c:"356-MT-0",b:"356",f:"MT"},{name:"Marshall Islands",c:"692-MH-0",b:"692",f:"MH"},{name:"Martinique",c:"596-MQ-0",b:"596",f:"MQ"},{name:"Mauritania",c:"222-MR-0",b:"222",f:"MR"},{name:"Mauritius",c:"230-MU-0",b:"230",f:"MU"},{name:"Mayotte",c:"262-YT-0",b:"262",f:"YT"},{name:"Mexico",c:"52-MX-0",b:"52",f:"MX"},{name:"Micronesia",c:"691-FM-0",b:"691",f:"FM"},{name:"Moldova",c:"373-MD-0",b:"373",f:"MD"},{name:"Monaco",c:"377-MC-0",b:"377",f:"MC"},{name:"Mongolia",c:"976-MN-0",b:"976",f:"MN"},{name:"Montenegro",c:"382-ME-0",b:"382",f:"ME"},{name:"Montserrat",c:"1-MS-0",b:"1",f:"MS"},{name:"Morocco",c:"212-MA-0",b:"212",f:"MA"},{name:"Mozambique",c:"258-MZ-0",b:"258",f:"MZ"},{name:"Myanmar [Burma]",c:"95-MM-0",b:"95",f:"MM"},{name:"Namibia",c:"264-NA-0",b:"264",f:"NA"},{name:"Nauru",c:"674-NR-0",b:"674",f:"NR"},{name:"Nepal",c:"977-NP-0",b:"977",f:"NP"},{name:"Netherlands",c:"31-NL-0",b:"31",f:"NL"},{name:"New Caledonia",c:"687-NC-0",b:"687",f:"NC"},{name:"New Zealand",c:"64-NZ-0",b:"64",f:"NZ"},{name:"Nicaragua",c:"505-NI-0",b:"505",f:"NI"},{name:"Niger",c:"227-NE-0",b:"227",f:"NE"},{name:"Nigeria",c:"234-NG-0",b:"234",f:"NG"},{name:"Niue",c:"683-NU-0",b:"683",f:"NU"},{name:"Norfolk Island",c:"672-NF-0",b:"672",f:"NF"},{name:"North Korea",c:"850-KP-0",b:"850",f:"KP"},{name:"Northern Mariana Islands",c:"1-MP-0",b:"1",f:"MP"},{name:"Norway",c:"47-NO-0",b:"47",f:"NO"},{name:"Oman",c:"968-OM-0",b:"968",f:"OM"},{name:"Pakistan",c:"92-PK-0",b:"92",f:"PK"},{name:"Palau",c:"680-PW-0",b:"680",f:"PW"},{name:"Palestinian Territories",c:"970-PS-0",b:"970",f:"PS"},{name:"Panama",c:"507-PA-0",b:"507",f:"PA"},{name:"Papua New Guinea",c:"675-PG-0",b:"675",f:"PG"},{name:"Paraguay",c:"595-PY-0",b:"595",f:"PY"},{name:"Peru",c:"51-PE-0",b:"51",f:"PE"},{name:"Philippines",c:"63-PH-0",b:"63",f:"PH"},{name:"Poland",c:"48-PL-0",b:"48",f:"PL"},{name:"Portugal",c:"351-PT-0",b:"351",f:"PT"},{name:"Puerto Rico",c:"1-PR-0",b:"1",f:"PR"},{name:"Qatar",c:"974-QA-0",b:"974",f:"QA"},{name:"Runion",c:"262-RE-0",b:"262",f:"RE"},{name:"Romania",c:"40-RO-0",b:"40",f:"RO"},{name:"Russia",c:"7-RU-0",b:"7",f:"RU"},{name:"Rwanda",c:"250-RW-0",b:"250",f:"RW"},{name:"Saint Barthlemy",c:"590-BL-0",b:"590",f:"BL"},{name:"Saint Helena",c:"290-SH-0",b:"290",f:"SH"},{name:"St. Kitts",c:"1-KN-0",b:"1",f:"KN"},{name:"St. Lucia",c:"1-LC-0",b:"1",f:"LC"},{name:"Saint Martin",c:"590-MF-0",b:"590",f:"MF"},{name:"Saint Pierre and Miquelon",c:"508-PM-0",b:"508",f:"PM"},{name:"St. Vincent",c:"1-VC-0",b:"1",f:"VC"},{name:"Samoa",c:"685-WS-0",b:"685",f:"WS"},{name:"San Marino",c:"378-SM-0",b:"378",f:"SM"},{name:"So Tom and Prncipe",c:"239-ST-0",b:"239",f:"ST"},{name:"Saudi Arabia",c:"966-SA-0",b:"966",f:"SA"},{name:"Senegal",c:"221-SN-0",b:"221",f:"SN"},{name:"Serbia",c:"381-RS-0",b:"381",f:"RS"},{name:"Seychelles",c:"248-SC-0",b:"248",f:"SC"},{name:"Sierra Leone",c:"232-SL-0",b:"232",f:"SL"},{name:"Singapore",c:"65-SG-0",b:"65",f:"SG"},{name:"Sint Maarten",c:"1-SX-0",b:"1",f:"SX"},{name:"Slovakia",c:"421-SK-0",b:"421",f:"SK"},{name:"Slovenia",c:"386-SI-0",b:"386",f:"SI"},{name:"Solomon Islands",c:"677-SB-0",b:"677",f:"SB"},{name:"Somalia",c:"252-SO-0",b:"252",f:"SO"},{name:"South Africa",c:"27-ZA-0",b:"27",f:"ZA"},{name:"South Georgia and the South Sandwich Islands",c:"500-GS-0",b:"500",f:"GS"},{name:"South Korea",c:"82-KR-0",b:"82",f:"KR"},{name:"South Sudan",c:"211-SS-0",b:"211",f:"SS"},{name:"Spain",c:"34-ES-0",b:"34",f:"ES"},{name:"Sri Lanka",c:"94-LK-0",b:"94",f:"LK"},{name:"Sudan",c:"249-SD-0",b:"249",f:"SD"},{name:"Suriname",c:"597-SR-0",b:"597",f:"SR"},{name:"Svalbard and Jan Mayen",c:"47-SJ-0",b:"47",f:"SJ"},{name:"Swaziland",c:"268-SZ-0",b:"268",f:"SZ"},{name:"Sweden",c:"46-SE-0",b:"46",f:"SE"},{name:"Switzerland",c:"41-CH-0",b:"41",f:"CH"},{name:"Syria",c:"963-SY-0",b:"963",f:"SY"},{name:"Taiwan",c:"886-TW-0",b:"886",f:"TW"},{name:"Tajikistan",c:"992-TJ-0",b:"992",f:"TJ"},{name:"Tanzania",c:"255-TZ-0",b:"255",f:"TZ"},{name:"Thailand",c:"66-TH-0",b:"66",f:"TH"},{name:"Togo",c:"228-TG-0",b:"228",f:"TG"},{name:"Tokelau",c:"690-TK-0",b:"690",f:"TK"},{name:"Tonga",c:"676-TO-0",b:"676",f:"TO"},{name:"Trinidad/Tobago",c:"1-TT-0",b:"1",f:"TT"},{name:"Tunisia",c:"216-TN-0",b:"216",f:"TN"},{name:"Turkey",c:"90-TR-0",b:"90",f:"TR"},{name:"Turkmenistan",c:"993-TM-0",b:"993",f:"TM"},{name:"Turks and Caicos Islands",c:"1-TC-0",b:"1",f:"TC"},{name:"Tuvalu",c:"688-TV-0",b:"688",f:"TV"},{name:"U.S. Virgin Islands",c:"1-VI-0",b:"1",f:"VI"},{name:"Uganda",c:"256-UG-0",b:"256",f:"UG"},{name:"Ukraine",c:"380-UA-0",b:"380",f:"UA"},{name:"United Arab Emirates",c:"971-AE-0",b:"971",f:"AE"},{name:"United Kingdom",c:"44-GB-0",b:"44",f:"GB"},{name:"United States",c:"1-US-0",b:"1",f:"US"},{name:"Uruguay",c:"598-UY-0",b:"598",f:"UY"},{name:"Uzbekistan",c:"998-UZ-0",b:"998",f:"UZ"},{name:"Vanuatu",c:"678-VU-0",b:"678",f:"VU"},{name:"Vatican City",c:"379-VA-0",b:"379",f:"VA"},{name:"Venezuela",c:"58-VE-0",b:"58",f:"VE"},{name:"Vietnam",c:"84-VN-0",b:"84",f:"VN"},{name:"Wallis and Futuna",c:"681-WF-0",b:"681",f:"WF"},{name:"Western Sahara",c:"212-EH-0",b:"212",f:"EH"},{name:"Yemen",c:"967-YE-0",b:"967",f:"YE"},{name:"Zambia",c:"260-ZM-0",b:"260",f:"ZM"},{name:"Zimbabwe",c:"263-ZW-0",b:"263",f:"ZW"}];uo(ho);var po=new so(ho);function fo(e,t){this.a=e,this.Aa=t}function mo(e){e=Z(e);var t=oo(po,e);return 0<t.length?new fo("1"==t[0].b?"1-US-0":t[0].c,Z(e.substr(t[0].b.length+1))):null}function go(e){var t=ao(e.a);if(!t)throw Error("Country ID "+e.a+" not found.");return"+"+t.b+e.Aa}function _o(e,t){for(var i=0;i<e.length;i++)if(!j(yo,e[i])&&(null!==vo&&e[i]in vo||j(t,e[i])))return e[i];return null}var yo=["emailLink","password","phone"],vo={"facebook.com":"FacebookAuthProvider","github.com":"GithubAuthProvider","google.com":"GoogleAuthProvider",password:"EmailAuthProvider","twitter.com":"TwitterAuthProvider",phone:"PhoneAuthProvider"};function xo(){this.a=new Ks,Js(this.a,"autoUpgradeAnonymousUsers"),Js(this.a,"callbacks"),Js(this.a,"credentialHelper",Xo),Js(this.a,"immediateFederatedRedirect",!1),Js(this.a,"popupMode",!1),Js(this.a,"privacyPolicyUrl"),Js(this.a,"queryParameterForSignInSuccessUrl","signInSuccessUrl"),Js(this.a,"queryParameterForWidgetMode","mode"),Js(this.a,"signInFlow"),Js(this.a,"signInOptions"),Js(this.a,"signInSuccessUrl"),Js(this.a,"siteName"),Js(this.a,"tosUrl"),Js(this.a,"widgetUrl"),Js(this.a,"adminRestrictedOperation")}function bo(e){var t=!!e.a.get("autoUpgradeAnonymousUsers");return t&&!jo(e)&&Ur('Missing "signInFailure" callback: "signInFailure" callback needs to be provided when "autoUpgradeAnonymousUsers" is set to true.',void 0),t}function wo(e){e=e.a.get("signInOptions")||[];for(var t=[],i=0;i<e.length;i++){var n=e[i];(n=w(n)?n:{provider:n}).provider&&t.push(n)}return t}function So(e,t){e=wo(e);for(var i=0;i<e.length;i++)if(e[i].provider===t)return e[i];return null}function To(e){return wo(e).map((function(e){return e.provider}))}function Eo(e,t){e=Mo(e);for(var i=0;i<e.length;i++)if(e[i].providerId===t)return e[i];return null}function Mo(e){return wo(e).map((function(e){if(vo[e.provider]||j(ea,e.provider)){for(var t in e={providerId:e.provider,S:e.providerName||null,V:e.fullLabel||null,ta:e.buttonColor||null,za:e.iconUrl?yt(xt(e.iconUrl)).toString():null})null===e[t]&&delete e[t];return e}return{providerId:e.provider,S:e.providerName||null,V:e.fullLabel||null,ta:e.buttonColor||null,za:e.iconUrl?yt(xt(e.iconUrl)).toString():null,Ob:e.loginHintKey||null}}))}function Io(e){var t,i=So(e,Dg.auth.GoogleAuthProvider.PROVIDER_ID);if(t=i&&i.clientId){e:{if("http:"===(window.location&&window.location.protocol)||"https:"===(window.location&&window.location.protocol))for(n in e=e.a.get("credentialHelper"),Yo)if(Yo[n]===e){var n=Yo[n];break e}n=Xo}t=n===Zo}return t&&i.clientId||null}function Ao(e){return!!((e=So(e,Dg.auth.EmailAuthProvider.PROVIDER_ID))&&e.disableSignUp&&e.disableSignUp.status)}function Co(e){return!(!(e=e.a.get("adminRestrictedOperation")||null)||!e.status)}function Po(e,t){return e=(e=So(e,t))&&e.scopes,Array.isArray(e)?e:[]}function ko(e,t){return w(e=(e=So(e,t))&&e.customParameters)?(e=se(e),t===Dg.auth.GoogleAuthProvider.PROVIDER_ID&&delete e.login_hint,t===Dg.auth.GithubAuthProvider.PROVIDER_ID&&delete e.login,e):null}function Ro(e){if(!(e=So(e,Dg.auth.PhoneAuthProvider.PROVIDER_ID)))return null;var t=e.whitelistedCountries,i=e.blacklistedCountries;if(void 0!==t&&(!Array.isArray(t)||0==t.length))throw Error("WhitelistedCountries must be a non-empty array.");if(void 0!==i&&!Array.isArray(i))throw Error("BlacklistedCountries must be an array.");if(t&&i)throw Error("Both whitelistedCountries and blacklistedCountries are provided.");if(!t&&!i)return ho;if(e=[],t){i={};for(var n=0;n<t.length;n++)for(var r=co(t[n]),s=0;s<r.length;s++)i[r[s].c]=r[s];for(var o in i)i.hasOwnProperty(o)&&e.push(i[o])}else{for(o={},t=0;t<i.length;t++)for(r=co(i[t]),n=0;n<r.length;n++)o[r[n].c]=r[n];for(r=0;r<ho.length;r++)null!==o&&ho[r].c in o||e.push(ho[r])}return e}function Lo(e){return eo(e.a,"queryParameterForWidgetMode")}function Do(e){var t=e.a.get("tosUrl")||null;if(e=e.a.get("privacyPolicyUrl")||null,t&&!e&&Hr("Privacy Policy URL is missing, the link will not be displayed."),t&&e){if("function"==typeof t)return t;if("string"==typeof t)return function(){Jn(t)}}return null}function Oo(e){var t=e.a.get("tosUrl")||null,i=e.a.get("privacyPolicyUrl")||null;if(i&&!t&&Hr("Term of Service URL is missing, the link will not be displayed."),t&&i){if("function"==typeof i)return i;if("string"==typeof i)return function(){Jn(i)}}return null}function No(e){return!(e=So(e,Dg.auth.EmailAuthProvider.PROVIDER_ID))||void 0===e.requireDisplayName||!!e.requireDisplayName}function zo(e){return!(!(e=So(e,Dg.auth.EmailAuthProvider.PROVIDER_ID))||e.signInMethod!==Dg.auth.EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD)}function Fo(e){var t=!!e.a.get("immediateFederatedRedirect"),i=To(e);return e=Bo(e),t&&1==i.length&&!j(yo,i[0])&&e==Ko}function Bo(e){for(var t in e=e.a.get("signInFlow"),Jo)if(Jo[t]==e)return Jo[t];return Ko}function Uo(e){return Go(e).signInSuccess||null}function Vo(e){return Go(e).signInSuccessWithAuthResult||null}function jo(e){return Go(e).signInFailure||null}function Go(e){return e.a.get("callbacks")||{}}var Ho,Wo,qo,$o,Zo="googleyolo",Xo="none",Yo={nc:Zo,NONE:Xo},Ko="redirect",Jo={qc:"popup",rc:Ko},Qo={mc:"callback",RECOVER_EMAIL:"recoverEmail",sc:"resetPassword",REVERT_SECOND_FACTOR_ADDITION:"revertSecondFactorAddition",tc:"select",uc:"signIn",VERIFY_AND_CHANGE_EMAIL:"verifyAndChangeEmail",VERIFY_EMAIL:"verifyEmail"},ea=["anonymous"],ta=["sitekey","tabindex","callback","expired-callback"],ia={};function na(e,t,i,n){ia[e].apply(null,Array.prototype.slice.call(arguments,1))}function ra(e){return e.classList?e.classList:p(e=e.className)&&e.match(/\S+/g)||[]}function sa(e,t){return e.classList?e.classList.contains(t):j(ra(e),t)}function oa(e,t){e.classList?e.classList.add(t):sa(e,t)||(e.className+=0<e.className.length?" "+t:t)}function aa(e,t){e.classList?e.classList.remove(t):sa(e,t)&&(e.className=B(ra(e),(function(e){return e!=t})).join(" "))}function la(e){var t=e.type;switch(p(t)&&t.toLowerCase()){case"checkbox":case"radio":return e.checked?e.value:null;case"select-one":return 0<=(t=e.selectedIndex)?e.options[t].value:null;case"select-multiple":t=[];for(var i,n=0;i=e.options[n];n++)i.selected&&t.push(i.value);return t.length?t:null;default:return null!=e.value?e.value:null}}function ca(e,t){var i=e.type;switch(p(i)&&i.toLowerCase()){case"checkbox":case"radio":e.checked=t;break;case"select-one":if(e.selectedIndex=-1,p(t))for(var n=0;i=e.options[n];n++)if(i.value==t){i.selected=!0;break}break;case"select-multiple":for(p(t)&&(t=[t]),n=0;i=e.options[n];n++)if(i.selected=!1,t)for(var r,s=0;r=t[s];s++)i.value==r&&(i.selected=!0);break;default:e.value=null!=t?t:""}}function ua(e,t,i,n,r,s){if(et&&!ct("525"))return!0;if(it&&r)return ha(e);if(r&&!n)return!1;if(!Qe&&("number"==typeof t&&(t=da(t)),(!i||it)&&(17==t||18==t||it&&91==t)||it&&16==t&&(n||s)))return!1;if((et||Ke)&&n&&i)switch(e){case 220:case 219:case 221:case 192:case 186:case 189:case 187:case 188:case 190:case 191:case 192:case 222:return!1}if(Ye&&n&&t==e)return!1;switch(e){case 13:return!(Qe&&(s||r||i&&n));case 27:return!(et||Ke||Qe)}return(!Qe||!(n||r||s))&&ha(e)}function ha(e){if(48<=e&&57>=e||96<=e&&106>=e||65<=e&&90>=e||(et||Ke)&&0==e)return!0;switch(e){case 32:case 43:case 63:case 64:case 107:case 109:case 110:case 111:case 186:case 59:case 189:case 187:case 61:case 188:case 190:case 191:case 192:case 222:case 219:case 220:case 221:case 163:return!0;case 173:return Qe;default:return!1}}function da(e){return Qe?e=function(e){switch(e){case 61:return 187;case 59:return 186;case 173:return 189;case 224:return 91;case 0:return 224;default:return e}}(e):it&&et&&93===e&&(e=91),e}function pa(e){cn.call(this),this.a=e,Yi(e,"keydown",this.g,!1,this),Yi(e,"click",this.h,!1,this)}function fa(e,t){var i=new ga(t);if(un(e,i)){i=new ma(t);try{un(e,i)}finally{t.stopPropagation()}}}function ma(e){Bi.call(this,e.a),this.type="action"}function ga(e){Bi.call(this,e.a),this.type="beforeaction"}function _a(e){cn.call(this),this.a=e,e=Ye?"focusout":"blur",this.g=Yi(this.a,Ye?"focusin":"focus",this,!Ye),this.h=Yi(this.a,e,this,!Ye)}function ya(e,t){cn.call(this),this.g=e||1,this.a=t||h,this.h=I(this.gc,this),this.j=k()}function va(e){e.Ka=!1,e.aa&&(e.a.clearTimeout(e.aa),e.aa=null)}function xa(e){Ci.call(this),this.g=e,this.a={}}L(pa,cn),pa.prototype.g=function(e){(13==e.keyCode||et&&3==e.keyCode)&&fa(this,e)},pa.prototype.h=function(e){fa(this,e)},pa.prototype.o=function(){pa.K.o.call(this),Qi(this.a,"keydown",this.g,!1,this),Qi(this.a,"click",this.h,!1,this),delete this.a},L(ma,Bi),L(ga,Bi),L(_a,cn),_a.prototype.handleEvent=function(e){var t=new Bi(e.a);t.type="focusin"==e.type||"focus"==e.type?"focusin":"focusout",un(this,t)},_a.prototype.o=function(){_a.K.o.call(this),en(this.g),en(this.h),delete this.a},L(ya,cn),(e=ya.prototype).Ka=!1,e.aa=null,e.gc=function(){if(this.Ka){var e=k()-this.j;0<e&&e<.8*this.g?this.aa=this.a.setTimeout(this.h,this.g-e):(this.aa&&(this.a.clearTimeout(this.aa),this.aa=null),un(this,"tick"),this.Ka&&(va(this),this.start()))}},e.start=function(){this.Ka=!0,this.aa||(this.aa=this.a.setTimeout(this.h,this.g),this.j=k())},e.o=function(){ya.K.o.call(this),va(this),delete this.a},L(xa,Ci);var ba=[];function wa(e,t,i,n){v(i)||(i&&(ba[0]=i.toString()),i=ba);for(var r=0;r<i.length;r++){var s=Yi(t,i[r],n||e.handleEvent,!1,e.g||e);if(!s)break;e.a[s.key]=s}}function Sa(e){re(e.a,(function(e,t){this.a.hasOwnProperty(t)&&en(e)}),e),e.a={}}function Ta(e){cn.call(this),this.a=null,this.g=e,e=Ye||Ke||et&&!ct("531")&&"TEXTAREA"==e.tagName,this.h=new xa(this),wa(this.h,this.g,e?["keydown","paste","cut","drop","input"]:"input",this)}function Ea(e){null!=e.a&&(h.clearTimeout(e.a),e.a=null)}function Ma(e){return(e=new Bi(e.a)).type="input",e}function Ia(e,t){cn.call(this),e&&(this.Oa&&Ra(this),this.qa=e,this.Na=Yi(this.qa,"keypress",this,t),this.Ya=Yi(this.qa,"keydown",this.Jb,t,this),this.Oa=Yi(this.qa,"keyup",this.Kb,t,this))}xa.prototype.o=function(){xa.K.o.call(this),Sa(this)},xa.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},L(Ta,cn),Ta.prototype.handleEvent=function(e){if("input"==e.type)Ye&&ct(10)&&0==e.keyCode&&0==e.j||(Ea(this),un(this,Ma(e)));else if("keydown"!=e.type||function(e){if(e.altKey&&!e.ctrlKey||e.metaKey||112<=e.keyCode&&123>=e.keyCode)return!1;if(ha(e.keyCode))return!0;switch(e.keyCode){case 18:case 20:case 93:case 17:case 40:case 35:case 27:case 36:case 45:case 37:case 224:case 91:case 144:case 12:case 34:case 33:case 19:case 255:case 44:case 39:case 145:case 16:case 38:case 252:case 224:case 92:return!1;case 0:return!Qe;default:return 166>e.keyCode||183<e.keyCode}}(e)){var t="keydown"==e.type?this.g.value:null;Ye&&229==e.keyCode&&(t=null);var i=Ma(e);Ea(this),this.a=function(e,t){if(b(e))t&&(e=I(e,t));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=I(e.handleEvent,e)}return 2147483647<Number(0)?-1:h.setTimeout(e,0)}((function(){this.a=null,this.g.value!=t&&un(this,i)}),this)}},Ta.prototype.o=function(){Ta.K.o.call(this),this.h.m(),Ea(this),delete this.g},L(Ia,cn),(e=Ia.prototype).qa=null,e.Na=null,e.Ya=null,e.Oa=null,e.R=-1,e.X=-1,e.Ua=!1;var Aa={3:13,12:144,63232:38,63233:40,63234:37,63235:39,63236:112,63237:113,63238:114,63239:115,63240:116,63241:117,63242:118,63243:119,63244:120,63245:121,63246:122,63247:123,63248:44,63272:46,63273:36,63275:35,63276:33,63277:34,63289:144,63302:45},Ca={Up:38,Down:40,Left:37,Right:39,Enter:13,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"U+007F":46,Home:36,End:35,PageUp:33,PageDown:34,Insert:45},Pa=!et||ct("525"),ka=it&&Qe;function Ra(e){e.Na&&(en(e.Na),en(e.Ya),en(e.Oa),e.Na=null,e.Ya=null,e.Oa=null),e.qa=null,e.R=-1,e.X=-1}function La(e,t,i,n){Bi.call(this,n),this.type="key",this.keyCode=e,this.j=t,this.repeat=i}function Da(e,t,i,n){this.top=e,this.right=t,this.bottom=i,this.left=n}function Oa(e,t){var i=jt(e);return i.defaultView&&i.defaultView.getComputedStyle&&(e=i.defaultView.getComputedStyle(e,null))&&(e[t]||e.getPropertyValue(t))||""}function Na(e){try{var t=e.getBoundingClientRect()}catch(e){return{left:0,top:0,right:0,bottom:0}}return Ye&&e.ownerDocument.body&&(e=e.ownerDocument,t.left-=e.documentElement.clientLeft+e.body.clientLeft,t.top-=e.documentElement.clientTop+e.body.clientTop),t}function za(e){var t=jt(e),i=new Lt(0,0),n=t?jt(t):document;return e==(n=!Ye||9<=Number(at)||"CSS1Compat"==Ot(n).a.compatMode?n.documentElement:n.body)||(e=Na(e),t=Ut(n=Ot(t).a),n=n.parentWindow||n.defaultView,t=Ye&&ct("10")&&n.pageYOffset!=t.scrollTop?new Lt(t.scrollLeft,t.scrollTop):new Lt(n.pageXOffset||t.scrollLeft,n.pageYOffset||t.scrollTop),i.a=e.left+t.a,i.g=e.top+t.g),i}(e=Ia.prototype).Jb=function(e){(et||Ke)&&(17==this.R&&!e.ctrlKey||18==this.R&&!e.altKey||it&&91==this.R&&!e.metaKey)&&(this.X=this.R=-1),-1==this.R&&(e.ctrlKey&&17!=e.keyCode?this.R=17:e.altKey&&18!=e.keyCode?this.R=18:e.metaKey&&91!=e.keyCode&&(this.R=91)),Pa&&!ua(e.keyCode,this.R,e.shiftKey,e.ctrlKey,e.altKey,e.metaKey)?this.handleEvent(e):(this.X=da(e.keyCode),ka&&(this.Ua=e.altKey))},e.Kb=function(e){this.X=this.R=-1,this.Ua=e.altKey},e.handleEvent=function(e){var t=e.a,i=t.altKey;if(Ye&&"keypress"==e.type)var n=this.X,r=13!=n&&27!=n?t.keyCode:0;else(et||Ke)&&"keypress"==e.type?(n=this.X,r=0<=t.charCode&&63232>t.charCode&&ha(n)?t.charCode:0):Xe&&!et?r=ha(n=this.X)?t.keyCode:0:("keypress"==e.type?(ka&&(i=this.Ua),t.keyCode==t.charCode?32>t.keyCode?(n=t.keyCode,r=0):(n=this.X,r=t.charCode):(n=t.keyCode||this.X,r=t.charCode||0)):(n=t.keyCode||this.X,r=t.charCode||0),it&&63==r&&224==n&&(n=191));var s=n=da(n);n?63232<=n&&n in Aa?s=Aa[n]:25==n&&e.shiftKey&&(s=9):t.keyIdentifier&&t.keyIdentifier in Ca&&(s=Ca[t.keyIdentifier]),Qe&&Pa&&"keypress"==e.type&&!ua(s,this.R,e.shiftKey,e.ctrlKey,i,e.metaKey)||(e=s==this.R,this.R=s,(t=new La(s,r,e,t)).altKey=i,un(this,t))},e.N=function(){return this.qa},e.o=function(){Ia.K.o.call(this),Ra(this)},L(La,Bi),Da.prototype.toString=function(){return"("+this.top+"t, "+this.right+"r, "+this.bottom+"b, "+this.left+"l)"},Da.prototype.ceil=function(){return this.top=Math.ceil(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom),this.left=Math.ceil(this.left),this},Da.prototype.floor=function(){return this.top=Math.floor(this.top),this.right=Math.floor(this.right),this.bottom=Math.floor(this.bottom),this.left=Math.floor(this.left),this},Da.prototype.round=function(){return this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom),this.left=Math.round(this.left),this};var Fa={thin:2,medium:4,thick:6};function Ba(e,t){if("none"==(e.currentStyle?e.currentStyle[t+"Style"]:null))return 0;var i=e.currentStyle?e.currentStyle[t+"Width"]:null;if(i in Fa)e=Fa[i];else if(/^\d+px?$/.test(i))e=parseInt(i,10);else{t=e.style.left;var n=e.runtimeStyle.left;e.runtimeStyle.left=e.currentStyle.left,e.style.left=i,i=e.style.pixelLeft,e.style.left=t,e.runtimeStyle.left=n,e=+i}return e}function Ua(){}function Va(e){cn.call(this),this.s=e||Ot(),this.cb=null,this.na=!1,this.g=null,this.L=void 0,this.oa=this.Ea=this.Y=null}function ja(e,t){return e.g?zt(t,e.g||e.s.a):null}function Ga(e){return e.L||(e.L=new xa(e)),e.L}function Ha(e,t){e.Ea&&F(e.Ea,t,void 0)}function Wa(e,t){var i=Ht(e,"firebaseui-textfield");t?(aa(e,"firebaseui-input-invalid"),oa(e,"firebaseui-input"),i&&aa(i,"firebaseui-textfield-invalid")):(aa(e,"firebaseui-input"),oa(e,"firebaseui-input-invalid"),i&&oa(i,"firebaseui-textfield-invalid"))}function qa(e,t,i){Ri(e,A(Li,t=new Ta(t))),wa(Ga(e),t,"input",i)}function $a(e,t,i){Ri(e,A(Li,t=new Ia(t))),wa(Ga(e),t,"key",(function(e){13==e.keyCode&&(e.stopPropagation(),e.preventDefault(),i(e))}))}function Za(e,t,i){Ri(e,A(Li,t=new pa(t))),wa(Ga(e),t,"action",(function(e){e.stopPropagation(),e.preventDefault(),i(e)}))}function Xa(e){oa(e,"firebaseui-hidden")}function Ya(e,t){t&&Gt(e,t),aa(e,"firebaseui-hidden")}function Ka(e){return!sa(e,"firebaseui-hidden")&&"none"!=e.style.display}function Ja(e){var t=(e=e||{}).email,i=e.disabled,n='<div class="firebaseui-textfield mdl-textfield mdl-js-textfield mdl-textfield--floating-label"><label class="mdl-textfield__label firebaseui-label" for="ui-sign-in-email-input">';return n=e.wc?n+"Enter new email address":n+"Email",n+='</label><input type="email" name="email" id="ui-sign-in-email-input" autocomplete="username" class="mdl-textfield__input firebaseui-input firebaseui-id-email" value="'+ci(null!=t?t:"")+'"'+(i?"disabled":"")+'></div><div class="firebaseui-error-wrapper"><p class="firebaseui-error firebaseui-text-input-error firebaseui-hidden firebaseui-id-email-error"></p></div>',si(n)}function Qa(e){var t='<button type="submit" class="firebaseui-id-submit firebaseui-button mdl-button mdl-js-button mdl-button--raised mdl-button--colored">';return t=(e=(e=e||{}).label)?t+ti(e):t+"Next",si(t+"</button>")}function el(){var e=""+Qa({label:ai("Sign In")});return si(e)}function tl(){var e=""+Qa({label:ai("Save")});return si(e)}function il(){var e=""+Qa({label:ai("Continue")});return si(e)}function nl(e){var t='<div class="firebaseui-new-password-component"><div class="firebaseui-textfield mdl-textfield mdl-js-textfield mdl-textfield--floating-label"><label class="mdl-textfield__label firebaseui-label" for="ui-sign-in-new-password-input">';return t=(e=(e=e||{}).label)?t+ti(e):t+"Choose password",si(t+'</label><input type="password" name="newPassword" id="ui-sign-in-new-password-input" autocomplete="new-password" class="mdl-textfield__input firebaseui-input firebaseui-id-new-password"></div><a href="javascript:void(0)" class="firebaseui-input-floating-button firebaseui-id-password-toggle firebaseui-input-toggle-on firebaseui-input-toggle-blur"></a><div class="firebaseui-error-wrapper"><p class="firebaseui-error firebaseui-text-input-error firebaseui-hidden firebaseui-id-new-password-error"></p></div></div>')}function rl(){var e='<div class="firebaseui-textfield mdl-textfield mdl-js-textfield mdl-textfield--floating-label"><label class="mdl-textfield__label firebaseui-label" for="ui-sign-in-password-input">';return si((e={}.current?e+"Current password":e+"Password")+'</label><input type="password" name="password" id="ui-sign-in-password-input" autocomplete="current-password" class="mdl-textfield__input firebaseui-input firebaseui-id-password"></div><div class="firebaseui-error-wrapper"><p class="firebaseui-error firebaseui-text-input-error firebaseui-hidden firebaseui-id-password-error"></p></div>')}function sl(){return si('<a class="firebaseui-link firebaseui-id-secondary-link" href="javascript:void(0)">Trouble signing in?</a>')}function ol(e){var t='<button class="firebaseui-id-secondary-link firebaseui-button mdl-button mdl-js-button mdl-button--primary">';return t=(e=(e=e||{}).label)?t+ti(e):t+"Cancel",si(t+"</button>")}function al(e){var t="";return e.F&&e.D&&(t+='<ul class="firebaseui-tos-list firebaseui-tos"><li class="firebaseui-inline-list-item"><a href="javascript:void(0)" class="firebaseui-link firebaseui-tos-link" target="_blank">Terms of Service</a></li><li class="firebaseui-inline-list-item"><a href="javascript:void(0)" class="firebaseui-link firebaseui-pp-link" target="_blank">Privacy Policy</a></li></ul>'),si(t)}function ll(e){var t="";return e.F&&e.D&&(t+='<p class="firebaseui-tos firebaseui-tospp-full-message">By continuing, you are indicating that you accept our <a href="javascript:void(0)" class="firebaseui-link firebaseui-tos-link" target="_blank">Terms of Service</a> and <a href="javascript:void(0)" class="firebaseui-link firebaseui-pp-link" target="_blank">Privacy Policy</a>.</p>'),si(t)}function cl(e){return e='<div class="firebaseui-info-bar firebaseui-id-info-bar"><p class="firebaseui-info-bar-message">'+ti(e.message)+'&nbsp;&nbsp;<a href="javascript:void(0)" class="firebaseui-link firebaseui-id-dismiss-info-bar">Dismiss</a></p></div>',si(e)}function ul(e){var t=e.content;return e=e.Ab,si('<dialog class="mdl-dialog firebaseui-dialog firebaseui-id-dialog'+(e?" "+ci(e):"")+'">'+ti(t)+"</dialog>")}function hl(e){var t=e.message;return si(ul({content:li('<div class="firebaseui-dialog-icon-wrapper"><div class="'+ci(e.Ma)+' firebaseui-dialog-icon"></div></div><div class="firebaseui-progress-dialog-message">'+ti(t)+"</div>")}))}function dl(e){for(var t='<div class="firebaseui-list-box-actions">',i=(e=e.items).length,n=0;n<i;n++){var r=e[n];t+='<button type="button" data-listboxid="'+ci(r.id)+'" class="mdl-button firebaseui-id-list-box-dialog-button firebaseui-list-box-dialog-button">'+(r.Ma?'<div class="firebaseui-list-box-icon-wrapper"><div class="firebaseui-list-box-icon '+ci(r.Ma)+'"></div></div>':"")+'<div class="firebaseui-list-box-label-wrapper">'+ti(r.label)+"</div></button>"}return t=""+ul({Ab:ai("firebaseui-list-box-dialog"),content:li(t+"</div>")}),si(t)}function pl(e){return si((e=e||{}).tb?'<div class="mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active firebaseui-busy-indicator firebaseui-id-busy-indicator"></div>':'<div class="mdl-progress mdl-js-progress mdl-progress__indeterminate firebaseui-busy-indicator firebaseui-id-busy-indicator"></div>')}function fl(e,t){return ri((e=(e=e||{}).ga).S?e.S:t.hb[e.providerId]?""+t.hb[e.providerId]:e.providerId&&0==e.providerId.indexOf("saml.")||e.providerId&&0==e.providerId.indexOf("oidc.")?e.providerId.substring(5):""+e.providerId)}function ml(e){yl(e,"upgradeElement")}function gl(e){yl(e,"downgradeElements")}_(Ua),Ua.prototype.a=0,L(Va,cn),(e=Va.prototype).Lb=Ua.Xa(),e.N=function(){return this.g},e.Za=function(e){if(this.Y&&this.Y!=e)throw Error("Method not supported");Va.K.Za.call(this,e)},e.kb=function(){this.g=this.s.a.createElement("DIV")},e.render=function(e){if(this.na)throw Error("Component already rendered");this.g||this.kb(),e?e.insertBefore(this.g,null):this.s.a.body.appendChild(this.g),this.Y&&!this.Y.na||this.v()},e.v=function(){this.na=!0,Ha(this,(function(e){!e.na&&e.N()&&e.v()}))},e.ya=function(){Ha(this,(function(e){e.na&&e.ya()})),this.L&&Sa(this.L),this.na=!1},e.o=function(){this.na&&this.ya(),this.L&&(this.L.m(),delete this.L),Ha(this,(function(e){e.m()})),this.g&&Vt(this.g),this.Y=this.g=this.oa=this.Ea=null,Va.K.o.call(this)},e.removeChild=function(e,t){if(e){var i=p(e)?e:e.cb||(e.cb=":"+(e.Lb.a++).toString(36));if(e=this.oa&&i&&(null!==(e=this.oa)&&i in e?e[i]:void 0)||null,i&&e){var n=this.oa;if(i in n&&delete n[i],G(this.Ea,e),t&&(e.ya(),e.g&&Vt(e.g)),null==(t=e))throw Error("Unable to set parent component");t.Y=null,Va.K.Za.call(t,null)}}if(!e)throw Error("Child is not in parent component");return e},cl.a="firebaseui.auth.soy2.element.infoBar",hl.a="firebaseui.auth.soy2.element.progressDialog",dl.a="firebaseui.auth.soy2.element.listBoxDialog",pl.a="firebaseui.auth.soy2.element.busyIndicator";var _l=["mdl-js-textfield","mdl-js-progress","mdl-js-spinner","mdl-js-button"];function yl(e,t){e&&window.componentHandler&&window.componentHandler[t]&&_l.forEach((function(i){sa(e,i)&&window.componentHandler[t](e),F(Nt(i,e),(function(e){window.componentHandler[t](e)}))}))}function vl(e,t,i){if(xl.call(this),document.body.appendChild(e),e.showModal||window.dialogPolyfill.registerDialog(e),e.showModal(),ml(e),t&&Za(this,e,(function(t){var i=e.getBoundingClientRect();(t.clientX<i.left||i.left+i.width<t.clientX||t.clientY<i.top||i.top+i.height<t.clientY)&&xl.call(this)})),!i){var n=this.N().parentElement||this.N().parentNode;if(n){var r=this;this.da=function(){if(e.open){var t=e.getBoundingClientRect().height,i=n.getBoundingClientRect().height,s=n.getBoundingClientRect().top-document.body.getBoundingClientRect().top,o=n.getBoundingClientRect().left-document.body.getBoundingClientRect().left,a=e.getBoundingClientRect().width,l=n.getBoundingClientRect().width;e.style.top=(s+(i-t)/2).toString()+"px",t=o+(l-a)/2,e.style.left=t.toString()+"px",e.style.right=(document.body.getBoundingClientRect().width-t-a).toString()+"px"}else window.removeEventListener("resize",r.da)},this.da(),window.addEventListener("resize",this.da,!1)}}}function xl(){var e=bl.call(this);e&&(gl(e),e.open&&e.close(),Vt(e),this.da&&window.removeEventListener("resize",this.da))}function bl(){return zt("firebaseui-id-dialog")}function wl(){Vt(Sl.call(this))}function Sl(){return ja(this,"firebaseui-id-info-bar")}function Tl(){return ja(this,"firebaseui-id-dismiss-info-bar")}var El={xa:{"google.com":"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg","github.com":"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/github.svg","facebook.com":"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/facebook.svg","twitter.com":"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/twitter.svg",password:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/mail.svg",phone:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/phone.svg",anonymous:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/anonymous.png","microsoft.com":"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/microsoft.svg","yahoo.com":"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/yahoo.svg","apple.com":"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/apple.png",saml:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/saml.svg",oidc:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/oidc.svg"},wa:{"google.com":"#ffffff","github.com":"#333333","facebook.com":"#3b5998","twitter.com":"#55acee",password:"#db4437",phone:"#02bd7e",anonymous:"#f4b400","microsoft.com":"#2F2F2F","yahoo.com":"#720E9E","apple.com":"#000000",saml:"#007bff",oidc:"#007bff"},hb:{"google.com":"Google","github.com":"GitHub","facebook.com":"Facebook","twitter.com":"Twitter",password:"Password",phone:"Phone",anonymous:"Guest","microsoft.com":"Microsoft","yahoo.com":"Yahoo","apple.com":"Apple"}};function Ml(e,t,i){for(var n in Fi.call(this,e,t),i)this[n]=i[n]}function Il(e,t,i,n,r){Va.call(this,i),this.fb=e,this.eb=t,this.Fa=!1,this.Ga=n||null,this.A=this.ca=null,this.Z=se(El),ae(this.Z,r||{})}function Al(e){return e.N().parentElement||e.N().parentNode}function Cl(e,t,i){$a(e,t,(function(){i.focus()}))}function Pl(e,t,i){$a(e,t,(function(){i()}))}function kl(e,t,i){t=(e=e||{}).Va;var n=e.ia;return e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-sign-in"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in with email</h1></div><div class="firebaseui-card-content"><div class="firebaseui-relative-wrapper">'+Ja(e)+'</div></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+(t?ol(null):"")+Qa(null)+'</div></div><div class="firebaseui-card-footer">'+(n?ll(i):al(i))+"</div></form></div>",si(e)}function Rl(e,t,i){return t=(e=e||{}).ia,e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-sign-in"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content">'+Ja(e)+rl()+'</div><div class="firebaseui-card-actions"><div class="firebaseui-form-links">'+sl()+'</div><div class="firebaseui-form-actions">'+el()+'</div></div><div class="firebaseui-card-footer">'+(t?ll(i):al(i))+"</div></form></div>",si(e)}function Ll(e,t,i){var n=(e=e||{}).Tb;t=e.Ta;var r=e.ia,s='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-sign-up"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Create account</h1></div><div class="firebaseui-card-content">'+Ja(e);return n?(e='<div class="firebaseui-textfield mdl-textfield mdl-js-textfield mdl-textfield--floating-label"><label class="mdl-textfield__label firebaseui-label" for="ui-sign-in-name-input">First &amp; last name</label><input type="text" name="name" id="ui-sign-in-name-input" autocomplete="name" class="mdl-textfield__input firebaseui-input firebaseui-id-name" value="'+ci(null!=(e=(e=e||{}).name)?e:"")+'"></div><div class="firebaseui-error-wrapper"><p class="firebaseui-error firebaseui-text-input-error firebaseui-hidden firebaseui-id-name-error"></p></div>',e=si(e)):e="",i=s+e+nl(null)+'</div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+(t?ol(null):"")+tl()+'</div></div><div class="firebaseui-card-footer">'+(r?ll(i):al(i))+"</div></form></div>",si(i)}function Dl(e,t,i){return t=(e=e||{}).Ta,e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-recovery"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Recover password</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Get instructions sent to this email that explain how to reset your password</p>'+Ja(e)+'</div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+(t?ol(null):"")+Qa({label:ai("Send")})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",si(e)}function Ol(e,t,i){t=e.G;var n="";return n+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-recovery-email-sent"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Check your email</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">'+(e="Follow the instructions sent to <strong>"+ti(e.email)+"</strong> to recover your password")+'</p></div><div class="firebaseui-card-actions">',t&&(n+='<div class="firebaseui-form-actions">'+Qa({label:ai("Done")})+"</div>"),n+='</div><div class="firebaseui-card-footer">'+al(i)+"</div></div>",si(n)}function Nl(e,t,i){return si('<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-callback"><div class="firebaseui-callback-indicator-container">'+pl(null)+"</div></div>")}function zl(e,t,i){return si('<div class="firebaseui-container firebaseui-id-page-spinner">'+pl({tb:!0})+"</div>")}function Fl(){return si('<div class="firebaseui-container firebaseui-id-page-blank firebaseui-use-spinner"></div>')}function Bl(e,t,i){return t="",t+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-link-sign-in-sent"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign-in email sent</h1></div><div class="firebaseui-card-content"><div class="firebaseui-email-sent"></div><p class="firebaseui-text">'+(e="A sign-in email with additional instructions was sent to <strong>"+ti(e.email)+"</strong>. Check your email to complete sign-in.")+'</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-links">'+si('<a class="firebaseui-link firebaseui-id-trouble-getting-email-link" href="javascript:void(0)">Trouble getting email?</a>')+'</div><div class="firebaseui-form-actions">'+ol({label:ai("Back")})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",si(t)}function Ul(e,t,i){return e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-not-received"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Trouble getting email?</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Try these common fixes:<ul><li>Check if the email was marked as spam or filtered.</li><li>Check your internet connection.</li><li>Check that you did not misspell your email.</li><li>Check that your inbox space is not running out or other inbox settings related issues.</li></ul></p><p class="firebaseui-text">If the steps above didn\'t work, you can resend the email. Note that this will deactivate the link in the older email.</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-links">'+si('<a class="firebaseui-link firebaseui-id-resend-email-link" href="javascript:void(0)">Resend</a>')+'</div><div class="firebaseui-form-actions">'+ol({label:ai("Back")})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",si(e)}function Vl(e,t,i){return e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-link-sign-in-confirmation"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Confirm email</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Confirm your email to complete sign in</p><div class="firebaseui-relative-wrapper">'+Ja(e)+'</div></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+ol(null)+Qa(null)+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",si(e)}function jl(){var e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-different-device-error"><div class="firebaseui-card-header"><h1 class="firebaseui-title">New device or browser detected</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Try opening the link using the same device or browser where you started the sign-in process.</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+ol({label:ai("Dismiss")})+"</div></div></div>";return si(e)}function Gl(){var e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-anonymous-user-mismatch"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Session ended</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">The session associated with this sign-in request has either expired or was cleared.</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+ol({label:ai("Dismiss")})+"</div></div></div>";return si(e)}function Hl(e,t,i){return t="",t+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-linking"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content"><h2 class="firebaseui-subtitle">You already have an account</h2><p class="firebaseui-text">'+(e="Youve already used <strong>"+ti(e.email)+"</strong> to sign in. Enter your password for that account.")+"</p>"+rl()+'</div><div class="firebaseui-card-actions"><div class="firebaseui-form-links">'+sl()+'</div><div class="firebaseui-form-actions">'+el()+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",si(t)}function Wl(e,t,i){var n=e.email;return t="",e=ai(e=""+fl(e,i)),t+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-link-sign-in-linking"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content"><h2 class="firebaseui-subtitle">You already have an account</h2><p class="firebaseui-text firebaseui-text-justify">'+(n="Youve already used <strong>"+ti(n)+"</strong>. You can connect your <strong>"+ti(e)+"</strong> account with <strong>"+ti(n)+"</strong> by signing in with email link below.")+'<p class="firebaseui-text firebaseui-text-justify">'+(e="For this flow to successfully connect your "+ti(e)+" account with this email, you have to open the link on the same device or browser.")+'</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+el()+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",si(t)}function ql(e,t,i){t="";var n=""+fl(e,i);return t+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-link-sign-in-linking-different-device"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text firebaseui-text-justify">'+(e="You originally intended to connect <strong>"+ti(n=ai(n))+"</strong> to your email account but have opened the link on a different device where you are not signed in.")+'</p><p class="firebaseui-text firebaseui-text-justify">'+(n="If you still want to connect your <strong>"+ti(n)+"</strong> account, open the link on the same device where you started sign-in. Otherwise, tap Continue to sign-in on this device.")+'</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+il()+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",si(t)}function $l(e,t,i){var n=e.email;return t="",e=ai(e=""+fl(e,i)),t+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-federated-linking"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content"><h2 class="firebaseui-subtitle">You already have an account</h2><p class="firebaseui-text">'+(n="Youve already used <strong>"+ti(n)+"</strong>. Sign in with "+ti(e)+" to continue.")+'</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+Qa({label:ai("Sign in with "+e)})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",si(t)}function Zl(e,t,i){var n=(e=e||{}).kc;t=e.yb,e=e.Eb;var r='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-unauthorized-user"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Not Authorized</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">';return r+=n?n="<strong>"+ti(n)+"</strong> is not authorized to view the requested page.":"User is not authorized to view the requested page.",r+="</p>",t&&(r+='<p class="firebaseui-text firebaseui-id-unauthorized-user-admin-email">'+(t="Please contact <strong>"+ti(t)+"</strong> for authorization.")+"</p>"),r+='</div><div class="firebaseui-card-actions"><div class="firebaseui-form-links">',e&&(r+='<a class="firebaseui-link firebaseui-id-unauthorized-user-help-link" href="javascript:void(0)" target="_blank">Learn More</a>'),r+='</div><div class="firebaseui-form-actions">'+ol({label:ai("Back")})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",si(r)}function Xl(e,t,i){return t="",t+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-unsupported-provider"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">'+(e="To continue sign in with <strong>"+ti(e.email)+"</strong> on this device, you have to recover the password.")+'</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+ol(null)+Qa({label:ai("Recover password")})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",si(t)}function Yl(e){var t="";return t+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-reset"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Reset your password</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">for <strong>'+ti(e.email)+"</strong></p>"+nl(function(e){function t(){}var i={label:ai("New password")};for(var n in t.prototype=e,e=new t,i)e[n]=i[n];return e}(e))+'</div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+tl()+"</div></div></form></div>",si(t)}function Kl(e){return e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-reset-success"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Password changed</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">You can now sign in with your new password</p></div><div class="firebaseui-card-actions">'+((e=e||{}).G?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",si(e)}function Jl(e){return e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-password-reset-failure"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Try resetting your password again</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Your request to reset your password has expired or the link has already been used</p></div><div class="firebaseui-card-actions">'+((e=e||{}).G?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",si(e)}function Ql(e){var t=e.G,i="";return i+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-change-revoke-success"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Updated email address</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">'+(e="Your sign-in email address has been changed back to <strong>"+ti(e.email)+"</strong>.")+'</p><p class="firebaseui-text">If you didnt ask to change your sign-in email, its possible someone is trying to access your account and you should <a class="firebaseui-link firebaseui-id-reset-password-link" href="javascript:void(0)">change your password right away</a>.</p></div><div class="firebaseui-card-actions">'+(t?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></form></div>",si(i)}function ec(e){return e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-change-revoke-failure"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Unable to update your email address</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">There was a problem changing your sign-in email back.</p><p class="firebaseui-text">If you try again and still cant reset your email, try asking your administrator for help.</p></div><div class="firebaseui-card-actions">'+((e=e||{}).G?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",si(e)}function tc(e){return e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-verification-success"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Your email has been verified</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">You can now sign in with your new account</p></div><div class="firebaseui-card-actions">'+((e=e||{}).G?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",si(e)}function ic(e){return e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-verification-failure"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Try verifying your email again</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Your request to verify your email has expired or the link has already been used</p></div><div class="firebaseui-card-actions">'+((e=e||{}).G?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",si(e)}function nc(e){var t=e.G,i="";return i+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-verify-and-change-email-success"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Your email has been verified and changed</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">'+(e="You can now sign in with your new email <strong>"+ti(e.email)+"</strong>.")+'</p></div><div class="firebaseui-card-actions">'+(t?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",si(i)}function rc(e){return e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-verify-and-change-email-failure"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Try updating your email again</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Your request to verify and update your email has expired or the link has already been used.</p></div><div class="firebaseui-card-actions">'+((e=e||{}).G?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",si(e)}function sc(e){var t=e.factorId,i=e.phoneNumber;e=e.G;var n='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-revert-second-factor-addition-success"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Removed second factor</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">';return n+="phone"===t?t="The <strong>"+ti(t)+" "+ti(i)+"</strong> was removed as a second authentication step.":"The device or app was removed as a second authentication step.",n+='</p><p class="firebaseui-text">If you don\'t recognize this device, someone might be trying to access your account. Consider <a class="firebaseui-link firebaseui-id-reset-password-link" href="javascript:void(0)">changing your password right away</a>.</p></div><div class="firebaseui-card-actions">'+(e?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></form></div>",si(n)}function oc(e){return e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-revert-second-factor-addition-failure"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Couldn\'t remove your second factor</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">Something went wrong removing your second factor.</p><p class="firebaseui-text">Try removing it again. If that doesn\'t work, contact support for assistance.</p></div><div class="firebaseui-card-actions">'+((e=e||{}).G?'<div class="firebaseui-form-actions">'+il()+"</div>":"")+"</div></div>",si(e)}function ac(e){var t=e.zb;return e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-recoverable-error"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Error encountered</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">'+ti(e.errorMessage)+'</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">',t&&(e+=Qa({label:ai("Retry")})),si(e+"</div></div></div>")}function lc(e){return e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-unrecoverable-error"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Error encountered</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">'+ti(e.errorMessage)+"</p></div></div>",si(e)}function cc(e,t,i){var n=e.Qb;return t="",t+='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-email-mismatch"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content"><h2 class="firebaseui-subtitle">'+(e="Continue with "+ti(e.jc)+"?")+'</h2><p class="firebaseui-text">'+(n="You originally wanted to sign in with "+ti(n))+'</p></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+ol(null)+Qa({label:ai("Continue")})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form></div>",si(t)}function uc(e,t,i){var n='<div class="firebaseui-container firebaseui-page-provider-sign-in firebaseui-id-page-provider-sign-in firebaseui-use-spinner"><div class="firebaseui-card-content"><form onsubmit="return false;"><ul class="firebaseui-idp-list">';t=(e=e.Sb).length;for(var r=0;r<t;r++){var s={ga:e[r]},o=i,a=(s=s||{}).ga,l=s,c="";switch((l=l||{}).ga.providerId){case"google.com":c+="firebaseui-idp-google";break;case"github.com":c+="firebaseui-idp-github";break;case"facebook.com":c+="firebaseui-idp-facebook";break;case"twitter.com":c+="firebaseui-idp-twitter";break;case"phone":c+="firebaseui-idp-phone";break;case"anonymous":c+="firebaseui-idp-anonymous";break;case"password":c+="firebaseui-idp-password";break;default:c+="firebaseui-idp-generic"}l=(l='<button class="firebaseui-idp-button mdl-button mdl-js-button mdl-button--raised '+ci(ri(c))+' firebaseui-id-idp-button" data-provider-id="'+ci(a.providerId)+'" style="background-color:')+ci(hi(ri((c=(c=(c=s)||{}).ga).ta?c.ta:o.wa[c.providerId]?""+o.wa[c.providerId]:0==c.providerId.indexOf("saml.")?""+o.wa.saml:0==c.providerId.indexOf("oidc.")?""+o.wa.oidc:""+o.wa.password)))+'"><span class="firebaseui-idp-icon-wrapper"><img class="firebaseui-idp-icon" alt="" src="';var u=s;c=o,u=(u=u||{}).ga,c=oi(u.za?ui(u.za):c.xa[u.providerId]?ui(c.xa[u.providerId]):0==u.providerId.indexOf("saml.")?ui(c.xa.saml):0==u.providerId.indexOf("oidc.")?ui(c.xa.oidc):ui(c.xa.password)),l=l+ci(ui(c))+'"></span>',"password"==a.providerId?(l+='<span class="firebaseui-idp-text firebaseui-idp-text-long">',a.V?l+=ti(a.V):a.S?l+=s="Sign in with "+ti(fl(s,o)):l+="Sign in with email",l+='</span><span class="firebaseui-idp-text firebaseui-idp-text-short">',l=a.S?l+ti(a.S):l+"Email",l+="</span>"):"phone"==a.providerId?(l+='<span class="firebaseui-idp-text firebaseui-idp-text-long">',a.V?l+=ti(a.V):a.S?l+=s="Sign in with "+ti(fl(s,o)):l+="Sign in with phone",l+='</span><span class="firebaseui-idp-text firebaseui-idp-text-short">',l=a.S?l+ti(a.S):l+"Phone",l+="</span>"):"anonymous"==a.providerId?(l+='<span class="firebaseui-idp-text firebaseui-idp-text-long">',a.V?l+=ti(a.V):a.S?l+=s="Sign in with "+ti(fl(s,o)):l+="Continue as guest",l+='</span><span class="firebaseui-idp-text firebaseui-idp-text-short">',l=a.S?l+ti(a.S):l+"Guest",l+="</span>"):(l+='<span class="firebaseui-idp-text firebaseui-idp-text-long">',a.V?l+=ti(a.V):l+=c="Sign in with "+ti(fl(s,o)),l+='</span><span class="firebaseui-idp-text firebaseui-idp-text-short">'+(a.S?ti(a.S):ti(fl(s,o)))+"</span>"),n+='<li class="firebaseui-list-item">'+(a=si(l+"</button>"))+"</li>"}return n+='</ul></form></div><div class="firebaseui-card-footer firebaseui-provider-sign-in-footer">'+ll(i)+"</div></div>",si(n)}function hc(e,t,i){var n,r=(e=e||{}).Gb,s=e.Va;return t=e.ia,e='<div class="firebaseui-phone-number"><button class="firebaseui-id-country-selector firebaseui-country-selector mdl-button mdl-js-button"><span class="firebaseui-flag firebaseui-country-selector-flag firebaseui-id-country-selector-flag"></span><span class="firebaseui-id-country-selector-code"></span></button><div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label firebaseui-textfield firebaseui-phone-input-wrapper"><label class="mdl-textfield__label firebaseui-label" for="ui-sign-in-phone-number-input">Phone number</label><input type="tel" name="phoneNumber" id="ui-sign-in-phone-number-input" class="mdl-textfield__input firebaseui-input firebaseui-id-phone-number" value="'+ci(null!=(e=(e=e||{}).Aa)?e:"")+'"></div></div><div class="firebaseui-error-wrapper"><p class="firebaseui-error firebaseui-text-input-error firebaseui-hidden firebaseui-phone-number-error firebaseui-id-phone-number-error"></p></div>',n=(e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-phone-sign-in-start"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Enter your phone number</h1></div><div class="firebaseui-card-content"><div class="firebaseui-relative-wrapper">'+si(e))+(n=r?si('<div class="firebaseui-recaptcha-wrapper"><div class="firebaseui-recaptcha-container"></div><div class="firebaseui-error-wrapper firebaseui-recaptcha-error-wrapper"><p class="firebaseui-error firebaseui-hidden firebaseui-id-recaptcha-error"></p></div></div>'):"")+'</div></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+(s?ol(null):"")+Qa({label:ai("Verify")})+'</div></div><div class="firebaseui-card-footer">',t?(t='<p class="firebaseui-tos firebaseui-phone-tos">',t=i.F&&i.D?t+'By tapping Verify, you are indicating that you accept our <a href="javascript:void(0)" class="firebaseui-link firebaseui-tos-link" target="_blank">Terms of Service</a> and <a href="javascript:void(0)" class="firebaseui-link firebaseui-pp-link" target="_blank">Privacy Policy</a>. An SMS may be sent. Message &amp; data rates may apply.':t+"By tapping Verify, an SMS may be sent. Message &amp; data rates may apply.",i=si(t+"</p>")):i=si('<p class="firebaseui-tos firebaseui-phone-sms-notice">By tapping Verify, an SMS may be sent. Message &amp; data rates may apply.</p>')+al(i),si(n+i+"</div></form></div>")}function dc(e,t,i){var n="";return e='Enter the 6-digit code we sent to <a class="firebaseui-link firebaseui-change-phone-number-link firebaseui-id-change-phone-number-link" href="javascript:void(0)">&lrm;'+ti(t=(e=e||{}).phoneNumber)+"</a>",ti(t),t=n,i='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-phone-sign-in-finish"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Verify your phone number</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">'+e+"</p>"+(n=si('<div class="firebaseui-textfield mdl-textfield mdl-js-textfield mdl-textfield--floating-label"><label class="mdl-textfield__label firebaseui-label" for="ui-sign-in-phone-confirmation-code-input">6-digit code</label><input type="number" name="phoneConfirmationCode" id="ui-sign-in-phone-confirmation-code-input" class="mdl-textfield__input firebaseui-input firebaseui-id-phone-confirmation-code"></div><div class="firebaseui-error-wrapper"><p class="firebaseui-error firebaseui-text-input-error firebaseui-hidden firebaseui-id-phone-confirmation-code-error"></p></div>'))+'</div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+ol(null)+Qa({label:ai("Continue")})+'</div></div><div class="firebaseui-card-footer">'+al(i)+"</div></form>",e=si('<div class="firebaseui-resend-container"><span class="firebaseui-id-resend-countdown"></span><a href="javascript:void(0)" class="firebaseui-id-resend-link firebaseui-hidden firebaseui-link">Resend</a></div>'),si(t+(i+e+"</div>"))}function pc(){return si('<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-sign-out"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign Out</h1></div><div class="firebaseui-card-content"><p class="firebaseui-text">You are now successfully signed out.</p></div></div>')}function fc(e,t,i){var n='<div class="firebaseui-container firebaseui-page-select-tenant firebaseui-id-page-select-tenant"><div class="firebaseui-card-content"><form onsubmit="return false;"><ul class="firebaseui-tenant-list">';t=(e=e.ec).length;for(var r=0;r<t;r++){var s=e[r],o="",a=ti(s.displayName),l=s.tenantId?s.tenantId:"top-level-project";o+='<button class="firebaseui-tenant-button mdl-button mdl-js-button mdl-button--raised firebaseui-tenant-selection-'+ci(l=ai(l))+' firebaseui-id-tenant-selection-button"'+(s.tenantId?'data-tenant-id="'+ci(s.tenantId)+'"':"")+'style="background-color:'+ci(hi(s.ta))+'"><span class="firebaseui-idp-icon-wrapper"><img class="firebaseui-idp-icon" alt="" src="'+ci(ui(s.za))+'"></span><span class="firebaseui-idp-text firebaseui-idp-text-long">',s.V?o+=ti(s.V):o+=s="Sign in to "+ti(s.displayName),n+='<li class="firebaseui-list-item">'+(o=si(o+'</span><span class="firebaseui-idp-text firebaseui-idp-text-short">'+a+"</span></button>"))+"</li>"}return n+='</ul></form></div><div class="firebaseui-card-footer firebaseui-provider-sign-in-footer">'+ll(i)+"</div></div>",si(n)}function mc(e,t,i){return e='<div class="mdl-card mdl-shadow--2dp firebaseui-container firebaseui-id-page-provider-match-by-email"><form onsubmit="return false;"><div class="firebaseui-card-header"><h1 class="firebaseui-title">Sign in</h1></div><div class="firebaseui-card-content"><div class="firebaseui-relative-wrapper">'+Ja(null)+'</div></div><div class="firebaseui-card-actions"><div class="firebaseui-form-actions">'+Qa(null)+'</div></div><div class="firebaseui-card-footer">'+ll(i)+"</div></form></div>",si(e)}function gc(){return ja(this,"firebaseui-id-submit")}function _c(){return ja(this,"firebaseui-id-secondary-link")}function yc(e,t){Za(this,gc.call(this),(function(t){e(t)}));var i=_c.call(this);i&&t&&Za(this,i,(function(e){t(e)}))}function vc(){return ja(this,"firebaseui-id-password")}function xc(){return ja(this,"firebaseui-id-password-error")}function bc(){var e=vc.call(this),t=xc.call(this);qa(this,e,(function(){Ka(t)&&(Wa(e,!0),Xa(t))}))}function wc(){var e=vc.call(this),t=xc.call(this);return la(e)?(Wa(e,!0),Xa(t),t=!0):(Wa(e,!1),Ya(t,ri("Enter your password").toString()),t=!1),t?la(e):null}function Sc(e,t,i,n,r,s){Il.call(this,Hl,{email:e},s,"passwordLinking",{F:n,D:r}),this.w=t,this.H=i}L(Ml,Fi),L(Il,Va),(e=Il.prototype).kb=function(){var e=Kt(this.fb,this.eb,this.Z,this.s);ml(e),this.g=e},e.v=function(){if(Il.K.v.call(this),fn(Al(this),new Ml("pageEnter",Al(this),{pageId:this.Ga})),this.bb()&&this.Z.F){var e=this.Z.F;Za(this,this.bb(),(function(){e()}))}if(this.ab()&&this.Z.D){var t=this.Z.D;Za(this,this.ab(),(function(){t()}))}},e.ya=function(){fn(Al(this),new Ml("pageExit",Al(this),{pageId:this.Ga})),Il.K.ya.call(this)},e.o=function(){window.clearTimeout(this.ca),this.eb=this.fb=this.ca=null,this.Fa=!1,this.A=null,gl(this.N()),Il.K.o.call(this)},e.I=function(e,t,i,n){function r(){if(s.T)return null;s.Fa=!1,window.clearTimeout(s.ca),s.ca=null,s.A&&(gl(s.A),Vt(s.A),s.A=null)}var s=this;return s.Fa?null:(function(e){e.Fa=!0;var t=sa(e.N(),"firebaseui-use-spinner");e.ca=window.setTimeout((function(){e.N()&&null===e.A&&(e.A=Kt(pl,{tb:t},null,e.s),e.N().appendChild(e.A),ml(e.A))}),500)}(s),e.apply(null,t).then(i,n).then(r,r))},C(Il.prototype,{a:function(e){wl.call(this);var t=Kt(cl,{message:e},null,this.s);this.N().appendChild(t),Za(this,Tl.call(this),(function(){Vt(t)}))},yc:wl,Ac:Sl,zc:Tl,$:function(e,t){e=Kt(hl,{Ma:e,message:t},null,this.s),vl.call(this,e)},h:xl,Cb:bl,Cc:function(){return ja(this,"firebaseui-tos")},bb:function(){return ja(this,"firebaseui-tos-link")},ab:function(){return ja(this,"firebaseui-pp-link")},Dc:function(){return ja(this,"firebaseui-tos-list")}}),kl.a="firebaseui.auth.soy2.page.signIn",Rl.a="firebaseui.auth.soy2.page.passwordSignIn",Ll.a="firebaseui.auth.soy2.page.passwordSignUp",Dl.a="firebaseui.auth.soy2.page.passwordRecovery",Ol.a="firebaseui.auth.soy2.page.passwordRecoveryEmailSent",Nl.a="firebaseui.auth.soy2.page.callback",zl.a="firebaseui.auth.soy2.page.spinner",Fl.a="firebaseui.auth.soy2.page.blank",Bl.a="firebaseui.auth.soy2.page.emailLinkSignInSent",Ul.a="firebaseui.auth.soy2.page.emailNotReceived",Vl.a="firebaseui.auth.soy2.page.emailLinkSignInConfirmation",jl.a="firebaseui.auth.soy2.page.differentDeviceError",Gl.a="firebaseui.auth.soy2.page.anonymousUserMismatch",Hl.a="firebaseui.auth.soy2.page.passwordLinking",Wl.a="firebaseui.auth.soy2.page.emailLinkSignInLinking",ql.a="firebaseui.auth.soy2.page.emailLinkSignInLinkingDifferentDevice",$l.a="firebaseui.auth.soy2.page.federatedLinking",Zl.a="firebaseui.auth.soy2.page.unauthorizedUser",Xl.a="firebaseui.auth.soy2.page.unsupportedProvider",Yl.a="firebaseui.auth.soy2.page.passwordReset",Kl.a="firebaseui.auth.soy2.page.passwordResetSuccess",Jl.a="firebaseui.auth.soy2.page.passwordResetFailure",Ql.a="firebaseui.auth.soy2.page.emailChangeRevokeSuccess",ec.a="firebaseui.auth.soy2.page.emailChangeRevokeFailure",tc.a="firebaseui.auth.soy2.page.emailVerificationSuccess",ic.a="firebaseui.auth.soy2.page.emailVerificationFailure",nc.a="firebaseui.auth.soy2.page.verifyAndChangeEmailSuccess",rc.a="firebaseui.auth.soy2.page.verifyAndChangeEmailFailure",sc.a="firebaseui.auth.soy2.page.revertSecondFactorAdditionSuccess",oc.a="firebaseui.auth.soy2.page.revertSecondFactorAdditionFailure",ac.a="firebaseui.auth.soy2.page.recoverableError",lc.a="firebaseui.auth.soy2.page.unrecoverableError",cc.a="firebaseui.auth.soy2.page.emailMismatch",uc.a="firebaseui.auth.soy2.page.providerSignIn",hc.a="firebaseui.auth.soy2.page.phoneSignInStart",dc.a="firebaseui.auth.soy2.page.phoneSignInFinish",pc.a="firebaseui.auth.soy2.page.signOut",fc.a="firebaseui.auth.soy2.page.selectTenant",mc.a="firebaseui.auth.soy2.page.providerMatchByEmail",a(Sc,Il),Sc.prototype.v=function(){this.P(),this.M(this.w,this.H),Pl(this,this.i(),this.w),this.i().focus(),Il.prototype.v.call(this)},Sc.prototype.o=function(){this.w=null,Il.prototype.o.call(this)},Sc.prototype.j=function(){return la(ja(this,"firebaseui-id-email"))},C(Sc.prototype,{i:vc,B:xc,P:bc,u:wc,ea:gc,ba:_c,M:yc});var Tc=/^[+a-zA-Z0-9_.!#$%&'*\/=?^`{|}~-]+@([a-zA-Z0-9-]+\.)+[a-zA-Z0-9]{2,63}$/;function Ec(){return ja(this,"firebaseui-id-email")}function Mc(){return ja(this,"firebaseui-id-email-error")}function Ic(e){var t=Ec.call(this),i=Mc.call(this);qa(this,t,(function(){Ka(i)&&(Wa(t,!0),Xa(i))})),e&&$a(this,t,(function(){e()}))}function Ac(){return Z(la(Ec.call(this))||"")}function Cc(){var e=Ec.call(this),t=Mc.call(this),i=la(e)||"";return i?Tc.test(i)?(Wa(e,!0),Xa(t),t=!0):(Wa(e,!1),Ya(t,ri("That email address isn't correct").toString()),t=!1):(Wa(e,!1),Ya(t,ri("Enter your email address to continue").toString()),t=!1),t?Z(la(e)):null}function Pc(e,t,i,n,r,s,o){Il.call(this,Rl,{email:i,ia:!!s},o,"passwordSignIn",{F:n,D:r}),this.w=e,this.H=t}function kc(e,t,i,n,r,s){Il.call(this,e,t,n,r||"notice",s),this.i=i||null}function Rc(e,t,i,n,r){kc.call(this,Ol,{email:e,G:!!t},t,r,"passwordRecoveryEmailSent",{F:i,D:n})}function Lc(e,t){kc.call(this,tc,{G:!!e},e,t,"emailVerificationSuccess")}function Dc(e,t){kc.call(this,ic,{G:!!e},e,t,"emailVerificationFailure")}function Oc(e,t,i){kc.call(this,nc,{email:e,G:!!t},t,i,"verifyAndChangeEmailSuccess")}function Nc(e,t){kc.call(this,rc,{G:!!e},e,t,"verifyAndChangeEmailFailure")}function zc(e,t){kc.call(this,oc,{G:!!e},e,t,"revertSecondFactorAdditionFailure")}function Fc(e){kc.call(this,pc,void 0,void 0,e,"signOut")}function Bc(e,t){kc.call(this,Kl,{G:!!e},e,t,"passwordResetSuccess")}function Uc(e,t){kc.call(this,Jl,{G:!!e},e,t,"passwordResetFailure")}function Vc(e,t){kc.call(this,ec,{G:!!e},e,t,"emailChangeRevokeFailure")}function jc(e,t,i){kc.call(this,ac,{errorMessage:e,zb:!!t},t,i,"recoverableError")}function Gc(e,t){kc.call(this,lc,{errorMessage:e},void 0,t,"unrecoverableError")}function Hc(e){if("auth/invalid-credential"===e.code&&e.message&&-1!==e.message.indexOf("error=consent_required"))return{code:"auth/user-cancelled"};if(e.message&&-1!==e.message.indexOf("HTTP Cloud Function returned an error:")){var t=JSON.parse(e.message.substring(e.message.indexOf("{"),e.message.lastIndexOf("}")+1));return{code:e.code,message:t&&t.error&&t.error.message||e.message}}return e}function Wc(e,t,i,n){function r(i){if(!i.name||"cancel"!=i.name){e:{var n=i.message;try{var r=((JSON.parse(n).error||{}).message||"").toLowerCase().match(/invalid.+(access|id)_token/);if(r&&r.length){var s=!0;break e}}catch(e){}s=!1}if(s)i=Al(t),t.m(),Jc(e,i,void 0,ri("Your sign-in session has expired. Please try again.").toString());else{if(s=i&&i.message||"",i.code){if("auth/email-already-in-use"==i.code||"auth/credential-already-in-use"==i.code)return;s=Zc(i)}t.a(s)}}}if(wh(e),n)return qc(e,i),Fn();if(!i.credential)throw Error("No credential found!");if(!dh(e).currentUser&&!i.user)throw Error("User not logged in.");try{var s=function(e,t){return Eh(e),vh(e,(function(i){if(e.j&&!e.j.isAnonymous&&bo(Th(e))&&!dh(e).currentUser)return Ih(e).then((function(){return"password"==t.credential.providerId&&(t.credential=null),t}));if(i)return Ih(e).then((function(){return i.linkWithCredential(t.credential)})).then((function(e){return t.user=e.user,t.credential=e.credential,t.operationType=e.operationType,t.additionalUserInfo=e.additionalUserInfo,t}),(function(i){if(i&&"auth/email-already-in-use"==i.code&&i.email&&i.credential)throw i;return Ah(e,i,t.credential)}));if(!t.user)throw Error('Internal error: An incompatible or outdated version of "firebase.js" may be used.');return Ih(e).then((function(){return ph(e).updateCurrentUser(t.user)})).then((function(){return t.user=ph(e).currentUser,t.operationType="signIn",t.credential&&t.credential.providerId&&"password"==t.credential.providerId&&(t.credential=null),t}))}))}(e,i)}catch(e){return Ur(e.code||e.message,e),t.a(e.code||e.message),Fn()}return i=s.then((function(t){qc(e,t)}),r).then(void 0,r),bh(e,s),Fn(i)}function qc(e,t){if(!t.user)throw Error("No user found");var i=Vo(Th(e));if(Uo(Th(e))&&i&&Hr("Both signInSuccess and signInSuccessWithAuthResult callbacks are provided. Only signInSuccessWithAuthResult callback will be invoked."),i){i=Vo(Th(e));var n=qs(fh(e))||void 0;Hs(Us,fh(e));var r=!1;Kn()?(i&&!i(t,n)||(r=!0,Rt(window.opener.location,$c(e,n))),i||window.close()):i&&!i(t,n)||(r=!0,Rt(window.location,$c(e,n))),r||e.reset()}else{i=t.user,t=t.credential,n=Uo(Th(e)),r=qs(fh(e))||void 0,Hs(Us,fh(e));var s=!1;Kn()?(n&&!n(i,t,r)||(s=!0,Rt(window.opener.location,$c(e,r))),n||window.close()):n&&!n(i,t,r)||(s=!0,Rt(window.location,$c(e,r))),s||e.reset()}}function $c(e,t){if(!(e=t||Th(e).a.get("signInSuccessUrl")))throw Error("No redirect URL has been found. You must either specify a signInSuccessUrl in the configuration, pass in a redirect URL to the widget URL, or return false from the callback.");return e}function Zc(e){var t={code:e.code},i="";switch((t=t||{}).code){case"auth/email-already-in-use":i+="The email address is already used by another account";break;case"auth/requires-recent-login":case"auth/user-token-expired":i+=ri("Please login again to perform this operation");break;case"auth/too-many-requests":i+="You have entered an incorrect password too many times. Please try again in a few minutes.";break;case"auth/user-cancelled":i+="Please authorize the required permissions to sign in to the application";break;case"auth/user-not-found":i+="That email address doesn't match an existing account";break;case"auth/weak-password":i+="Strong passwords have at least 6 characters and a mix of letters and numbers";break;case"auth/wrong-password":i+="The email and password you entered don't match";break;case"auth/network-request-failed":i+="A network error has occurred";break;case"auth/invalid-phone-number":i+=wi();break;case"auth/invalid-verification-code":i+=ri("Wrong code. Try again.");break;case"auth/code-expired":i+="This code is no longer valid";break;case"auth/expired-action-code":i+="This code has expired.";break;case"auth/invalid-action-code":i+="The action code is invalid. This can happen if the code is malformed, expired, or has already been used."}if(t=ri(i).toString())return t;try{return JSON.parse(e.message),Ur("Internal error: "+e.message,void 0),Ti().toString()}catch(t){return e.message}}function Xc(e,t,i,n){function r(){!function(e,t){Ws(Bs,{tenantId:e.a},t)}(new Qr(e.h.tenantId||null),fh(e)),bh(e,t.I(I(e.dc,e),[l],(function(){if("file:"===(window.location&&window.location.protocol))return bh(e,ch(e).then((function(i){t.m(),Hs(Bs,fh(e)),na("callback",e,a,Fn(i))}),s))}),o))}function s(n){if(Hs(Bs,fh(e)),!n.name||"cancel"!=n.name)switch(n=Hc(n),n.code){case"auth/popup-blocked":r();break;case"auth/popup-closed-by-user":case"auth/cancelled-popup-request":case"auth/credential-already-in-use":break;case"auth/network-request-failed":case"auth/too-many-requests":case"auth/user-cancelled":t.a(Zc(n));break;case"auth/admin-restricted-operation":t.m(),Co(Th(e))?na("handleUnauthorizedUser",e,a,null,i):na("callback",e,a,Bn(n));break;default:t.m(),na("callback",e,a,Bn(n))}}function o(i){Hs(Bs,fh(e)),i.name&&"cancel"==i.name||(Ur("signInWithRedirect: "+i.code,void 0),i=Zc(i),"blank"==t.Ga&&Fo(Th(e))?(t.m(),na("providerSignIn",e,a,i)):t.a(i))}var a=Al(t),l=function(e,t,i){var n=vo[t]&&Dg.auth[vo[t]]?new Dg.auth[vo[t]]:0==t.indexOf("saml.")?new Dg.auth.SAMLAuthProvider(t):new Dg.auth.OAuthProvider(t);if(!n)throw Error("Invalid Firebase Auth provider!");var r=Po(Th(e),t);if(n.addScope)for(var s=0;s<r.length;s++)n.addScope(r[s]);return r=ko(Th(e),t)||{},i&&(e=t==Dg.auth.GoogleAuthProvider.PROVIDER_ID?"login_hint":t==Dg.auth.GithubAuthProvider.PROVIDER_ID?"login":(e=Eo(Th(e),t))&&e.Ob)&&(r[e]=i),n.setCustomParameters&&n.setCustomParameters(r),n}(e,i,n);Bo(Th(e))==Ko?r():bh(e,function(e,t){return Eh(e),vh(e,(function(i){return i&&!$s(fh(e))?i.linkWithPopup(t).then((function(e){return e}),(function(t){if(t&&"auth/email-already-in-use"==t.code&&t.email&&t.credential)throw t;return Ah(e,t)})):dh(e).signInWithPopup(t)}))}(e,l).then((function(i){t.m(),na("callback",e,a,Fn(i))}),s))}function Yc(e){return 1==(e=To(Th(e))).length&&e[0]==Dg.auth.EmailAuthProvider.PROVIDER_ID}function Kc(e){return 1==(e=To(Th(e))).length&&e[0]==Dg.auth.PhoneAuthProvider.PROVIDER_ID}function Jc(e,t,i,n){Yc(e)?n?na("signIn",e,t,i,n):iu(e,t,i):e&&Kc(e)&&!n?na("phoneSignInStart",e,t):e&&Fo(Th(e))&&!n?na("federatedRedirect",e,t,i):na("providerSignIn",e,t,n,i)}function Qc(e,t,i,n){var r=Al(t);bh(e,t.I(I(dh(e).fetchSignInMethodsForEmail,dh(e)),[i],(function(s){t.m(),eu(e,r,s,i,n)}),(function(e){e=Zc(e),t.a(e)})))}function eu(e,t,i,n,r,s){i.length||zo(Th(e))&&!zo(Th(e))?j(i,Dg.auth.EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD)?na("passwordSignIn",e,t,n,s):1==i.length&&i[0]===Dg.auth.EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD?zo(Th(e))?na("sendEmailLinkForSignIn",e,t,n,(function(){na("signIn",e,t)})):na("unsupportedProvider",e,t,n):(i=_o(i,To(Th(e))))?(Xs(new Yr(n),fh(e)),na("federatedSignIn",e,t,n,i,r)):na("unsupportedProvider",e,t,n):Ao(Th(e))?na("handleUnauthorizedUser",e,t,n,Dg.auth.EmailAuthProvider.PROVIDER_ID):zo(Th(e))?na("sendEmailLinkForSignIn",e,t,n,(function(){na("signIn",e,t)})):na("passwordSignUp",e,t,n,void 0,void 0,s)}function tu(e,t,i,n,r,s){var o=Al(t);bh(e,t.I(I(e.Ib,e),[i,s],(function(){t.m(),na("emailLinkSignInSent",e,o,i,n,s)}),r))}function iu(e,t,i){i?na("prefilledEmailSignIn",e,t,i):na("signIn",e,t)}function nu(){return _e(er(),"oobCode")}function ru(){var e=_e(er(),"continueUrl");return e?function(){Rt(window.location,e)}:null}function su(e,t){Il.call(this,Gl,void 0,t,"anonymousUserMismatch"),this.i=e}function ou(e){Il.call(this,Nl,void 0,e,"callback")}function au(e,t,i){if(i.user){var n={user:i.user,credential:i.credential,operationType:i.operationType,additionalUserInfo:i.additionalUserInfo},r=$s(fh(e)),s=r&&r.g;if(s&&!function(e,t){if(t==e.email)return!0;if(e.providerData)for(var i=0;i<e.providerData.length;i++)if(t==e.providerData[i].email)return!0;return!1}(i.user,s))!function(e,t,i){var n=Al(t);bh(e,Ih(e).then((function(){t.m(),na("emailMismatch",e,n,i)}),(function(e){e.name&&"cancel"==e.name||(e=Zc(e.code),t.a(e))})))}(e,t,n);else{var o=r&&r.a;o?bh(e,i.user.linkWithCredential(o).then((function(i){n={user:i.user,credential:o,operationType:i.operationType,additionalUserInfo:i.additionalUserInfo},lu(e,t,n)}),(function(i){cu(e,t,i)}))):lu(e,t,n)}}else i=Al(t),t.m(),Zs(fh(e)),Jc(e,i)}function lu(e,t,i){Zs(fh(e)),Wc(e,t,i)}function cu(e,t,i){var n=Al(t);Zs(fh(e)),i=Zc(i),t.m(),Jc(e,n,void 0,i)}function uu(e,t,i,n){var r=Al(t);bh(e,dh(e).fetchSignInMethodsForEmail(i).then((function(s){t.m(),s.length?j(s,Dg.auth.EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD)?na("passwordLinking",e,r,i):1==s.length&&s[0]===Dg.auth.EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD?na("emailLinkSignInLinking",e,r,i):(s=_o(s,To(Th(e))))?na("federatedLinking",e,r,i,s,n):(Zs(fh(e)),na("unsupportedProvider",e,r,i)):(Zs(fh(e)),na("passwordRecovery",e,r,i,!1,Ei().toString()))}),(function(i){cu(e,t,i)})))}function hu(e,t){Il.call(this,jl,void 0,t,"differentDeviceError"),this.i=e}function du(e,t,i,n){Il.call(this,Ql,{email:e,G:!!i},n,"emailChangeRevoke"),this.l=t,this.i=i||null}function pu(){return ja(this,"firebaseui-id-new-password")}function fu(){return ja(this,"firebaseui-id-password-toggle")}function mu(){this.Ra=!this.Ra;var e=fu.call(this),t=pu.call(this);this.Ra?(t.type="text",oa(e,"firebaseui-input-toggle-off"),aa(e,"firebaseui-input-toggle-on")):(t.type="password",oa(e,"firebaseui-input-toggle-on"),aa(e,"firebaseui-input-toggle-off")),t.focus()}function gu(){return ja(this,"firebaseui-id-new-password-error")}function _u(){this.Ra=!1;var e=pu.call(this);e.type="password";var t=gu.call(this);qa(this,e,(function(){Ka(t)&&(Wa(e,!0),Xa(t))}));var i=fu.call(this);oa(i,"firebaseui-input-toggle-on"),aa(i,"firebaseui-input-toggle-off"),function(e,t,i){Ri(e,A(Li,t=new _a(t))),wa(Ga(e),t,"focusin",i)}(this,e,(function(){oa(i,"firebaseui-input-toggle-focus"),aa(i,"firebaseui-input-toggle-blur")})),function(e,t,i){Ri(e,A(Li,t=new _a(t))),wa(Ga(e),t,"focusout",i)}(this,e,(function(){oa(i,"firebaseui-input-toggle-blur"),aa(i,"firebaseui-input-toggle-focus")})),Za(this,i,I(mu,this))}function yu(){var e=pu.call(this),t=gu.call(this);return la(e)?(Wa(e,!0),Xa(t),t=!0):(Wa(e,!1),Ya(t,ri("Enter your password").toString()),t=!1),t?la(e):null}function vu(e,t,i){Il.call(this,Yl,{email:e},i,"passwordReset"),this.l=t}function xu(e,t,i,n,r){Il.call(this,sc,{factorId:e,phoneNumber:i||null,G:!!n},r,"revertSecondFactorAdditionSuccess"),this.l=t,this.i=n||null}function bu(e,t,i,n){"auth/weak-password"==(n&&n.code)?(e=Zc(n),Wa(i.i(),!1),Ya(i.w(),e),i.i().focus()):(i&&i.m(),(i=new Uc).render(t),uh(e,i))}function wu(e,t){try{var i="number"==typeof e.selectionStart}catch(e){i=!1}i?(e.selectionStart=t,e.selectionEnd=t):Ye&&!ct("9")&&("textarea"==e.type&&(t=e.value.substring(0,t).replace(/(\r\n|\r|\n)/g,"\n").length),(e=e.createTextRange()).collapse(!0),e.move("character",t),e.select())}function Su(e,t,i,n,r,s){Il.call(this,Vl,{email:i},s,"emailLinkSignInConfirmation",{F:n,D:r}),this.l=e,this.u=t}function Tu(e,t,i,n,r){Il.call(this,ql,{ga:e},r,"emailLinkSignInLinkingDifferentDevice",{F:i,D:n}),this.i=t}function Eu(e){Il.call(this,Fl,void 0,e,"blank")}function Mu(e,t,i,n,r){var s=new Eu,o=new Fe(i),a=o.a.a.get(je.$a)||"",l=o.a.a.get(je.Sa)||"",c="1"===o.a.a.get(je.Qa),u=Be(o),h=o.a.a.get(je.PROVIDER_ID)||null;o=o.a.a.get(je.vb)||null,Sh(e,o);var d=!Gs(Vs,fh(e)),p=n||function(e,t){var i=null;if(t=Gs(Vs,t))try{var n=bs(e,t),r=JSON.parse(n);i=r&&r.email||null}catch(e){}return i}(l,fh(e)),f=(n=function(e,t){var i=null;if(t=Gs(js,t))try{var n=bs(e,t);i=JSON.parse(n)}catch(e){}return Jr(i||null)}(l,fh(e)))&&n.a;h&&f&&f.providerId!==h&&(f=null),s.render(t),uh(e,s),bh(e,s.I((function(){var t=Fn(null);t=u&&d||d&&c?Bn(Error("anonymous-user-not-found")):function(e,t){var i=Be(new Fe(t));return i?(t=new kn((function(t,n){var r=ph(e).onAuthStateChanged((function(e){r(),e&&e.isAnonymous&&e.uid===i?t(e):e&&e.isAnonymous&&e.uid!==i?n(Error("anonymous-user-mismatch")):n(Error("anonymous-user-not-found"))}));bh(e,r)})),bh(e,t),t):Fn(null)}(e,i).then((function(e){if(h&&!f)throw Error("pending-credential-not-found");return e}));var n=null;return t.then((function(t){return n=t,r?null:dh(e).checkActionCode(a)})).then((function(){return n}))}),[],(function(n){p?function(e,t,i,n,r,s){var o=Al(t);t.$("mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active firebaseui-progress-dialog-loading-icon",ri("Signing in...").toString());var a=null;r=(s?function(e,t,i,n,r){Eh(e);var s=r||null,o=Dg.auth.EmailAuthProvider.credentialWithLink(i,n);return i=s?dh(e).signInWithEmailLink(i,n).then((function(e){return e.user.linkWithCredential(s)})).then((function(){return Ih(e)})).then((function(){return Ah(e,{code:"auth/email-already-in-use"},s)})):dh(e).fetchSignInMethodsForEmail(i).then((function(i){return i.length?Ah(e,{code:"auth/email-already-in-use"},o):t.linkWithCredential(o)})),bh(e,i),i}(e,s,i,n,r):function(e,t,i,n){Eh(e);var r,s=n||null;return t=dh(e).signInWithEmailLink(t,i).then((function(e){if(r={user:e.user,credential:null,operationType:e.operationType,additionalUserInfo:e.additionalUserInfo},s)return e.user.linkWithCredential(s).then((function(e){r={user:e.user,credential:s,operationType:r.operationType,additionalUserInfo:e.additionalUserInfo}}))})).then((function(){Ih(e)})).then((function(){return ph(e).updateCurrentUser(r.user)})).then((function(){return r.user=ph(e).currentUser,r})),bh(e,t),t}(e,i,n,r)).then((function(i){Hs(js,fh(e)),Hs(Vs,fh(e)),t.h(),t.$("firebaseui-icon-done",ri("Signed in!").toString()),a=setTimeout((function(){t.h(),Wc(e,t,i,!0)}),1e3),bh(e,(function(){t&&(t.h(),t.m()),clearTimeout(a)}))}),(function(r){if(t.h(),t.m(),!r.name||"cancel"!=r.name){var s=Zc(r=Hc(r));"auth/email-already-in-use"==r.code||"auth/credential-already-in-use"==r.code?(Hs(js,fh(e)),Hs(Vs,fh(e))):"auth/invalid-email"==r.code?(s=ri("The email provided does not match the current sign-in session.").toString(),na("emailLinkConfirmation",e,o,n,Iu,null,s)):Jc(e,o,i,s)}})),bh(e,r)}(e,s,p,i,f,n):c?(s.m(),na("differentDeviceError",e,t)):(s.m(),na("emailLinkConfirmation",e,t,i,Iu))}),(function(n){var r=void 0;if(!n||!n.name||"cancel"!=n.name)switch(s.m(),n&&n.message){case"anonymous-user-not-found":na("differentDeviceError",e,t);break;case"anonymous-user-mismatch":na("anonymousUserMismatch",e,t);break;case"pending-credential-not-found":na("emailLinkNewDeviceLinking",e,t,i,Au);break;default:n&&(r=Zc(n)),Jc(e,t,void 0,r)}})))}function Iu(e,t,i,n){Mu(e,t,n,i,!0)}function Au(e,t,i){Mu(e,t,i)}function Cu(e,t,i,n,r,s){Il.call(this,Wl,{email:e,ga:t},s,"emailLinkSignInLinking",{F:n,D:r}),this.i=i}function Pu(e,t,i,n,r,s){Il.call(this,Bl,{email:e},s,"emailLinkSignInSent",{F:n,D:r}),this.u=t,this.i=i}function ku(e,t,i,n,r,s,o){Il.call(this,cc,{jc:e,Qb:t},o,"emailMismatch",{F:r,D:s}),this.l=i,this.i=n}function Ru(e,t,i,n,r){Il.call(this,Ul,void 0,r,"emailNotReceived",{F:i,D:n}),this.l=e,this.i=t}function Lu(e,t,i,n,r,s){Il.call(this,$l,{email:e,ga:t},s,"federatedLinking",{F:n,D:r}),this.i=i}function Du(e,t,i,n,r,s){Il.call(this,Dl,{email:i,Ta:!!t},s,"passwordRecovery",{F:n,D:r}),this.l=e,this.u=t}function Ou(){return ja(this,"firebaseui-id-name")}function Nu(){return ja(this,"firebaseui-id-name-error")}function zu(e,t,i,n,r,s,o,a,l){Il.call(this,Ll,{email:n,Tb:e,name:r,Ta:!!i,ia:!!a},l,"passwordSignUp",{F:s,D:o}),this.w=t,this.H=i,this.B=e}function Fu(){return ja(this,"firebaseui-id-phone-confirmation-code")}function Bu(){return ja(this,"firebaseui-id-phone-confirmation-code-error")}function Uu(){return ja(this,"firebaseui-id-resend-countdown")}function Vu(e,t,i,n,r,s,o,a,l){Il.call(this,dc,{phoneNumber:r},l,"phoneSignInFinish",{F:o,D:a}),this.jb=s,this.i=new ya(1e3),this.B=s,this.P=e,this.l=t,this.H=i,this.M=n}a(Pc,Il),Pc.prototype.v=function(){this.P(),this.ea(),this.ba(this.w,this.H),Cl(this,this.l(),this.i()),Pl(this,this.i(),this.w),la(this.l())?this.i().focus():this.l().focus(),Il.prototype.v.call(this)},Pc.prototype.o=function(){this.H=this.w=null,Il.prototype.o.call(this)},C(Pc.prototype,{l:Ec,U:Mc,P:Ic,M:Ac,j:Cc,i:vc,B:xc,ea:bc,u:wc,ua:gc,pa:_c,ba:yc}),L(kc,Il),kc.prototype.v=function(){this.i&&(this.u(this.i),this.l().focus()),kc.K.v.call(this)},kc.prototype.o=function(){this.i=null,kc.K.o.call(this)},C(kc.prototype,{l:gc,w:_c,u:yc}),L(Rc,kc),L(Lc,kc),L(Dc,kc),L(Oc,kc),L(Nc,kc),L(zc,kc),L(Fc,kc),L(Bc,kc),L(Uc,kc),L(Vc,kc),L(jc,kc),L(Gc,kc),a(su,Il),su.prototype.v=function(){var e=this;Za(this,this.l(),(function(){e.i()})),this.l().focus(),Il.prototype.v.call(this)},su.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},C(su.prototype,{l:_c}),ia.anonymousUserMismatch=function(e,t){var i=new su((function(){i.m(),Jc(e,t)}));i.render(t),uh(e,i)},a(ou,Il),ou.prototype.I=function(e,t,i,n){return e.apply(null,t).then(i,n)},ia.callback=function(e,t,i){var n=new ou;n.render(t),uh(e,n),i=i||ch(e),bh(e,i.then((function(t){au(e,n,t)}),(function(i){if((i=Hc(i))&&("auth/account-exists-with-different-credential"==i.code||"auth/email-already-in-use"==i.code)&&i.email&&i.credential)Xs(new Yr(i.email,i.credential),fh(e)),uu(e,n,i.email);else if(i&&"auth/user-cancelled"==i.code){var r=$s(fh(e)),s=Zc(i);r&&r.a?uu(e,n,r.g,s):r?Qc(e,n,r.g,s):cu(e,n,i)}else i&&"auth/credential-already-in-use"==i.code||(i&&"auth/operation-not-supported-in-this-environment"==i.code&&Yc(e)?au(e,n,{user:null,credential:null}):i&&"auth/admin-restricted-operation"==i.code&&Co(Th(e))?(n.m(),Zs(fh(e)),na("handleUnauthorizedUser",e,t,null,null)):cu(e,n,i))})))},a(hu,Il),hu.prototype.v=function(){var e=this;Za(this,this.l(),(function(){e.i()})),this.l().focus(),Il.prototype.v.call(this)},hu.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},C(hu.prototype,{l:_c}),ia.differentDeviceError=function(e,t){var i=new hu((function(){i.m(),Jc(e,t)}));i.render(t),uh(e,i)},a(du,Il),du.prototype.v=function(){var e=this;Za(this,ja(this,"firebaseui-id-reset-password-link"),(function(){e.l()})),this.i&&(this.w(this.i),this.u().focus()),Il.prototype.v.call(this)},du.prototype.o=function(){this.l=this.i=null,Il.prototype.o.call(this)},C(du.prototype,{u:gc,B:_c,w:yc}),a(vu,Il),vu.prototype.v=function(){this.H(),this.B(this.l),Pl(this,this.i(),this.l),this.i().focus(),Il.prototype.v.call(this)},vu.prototype.o=function(){this.l=null,Il.prototype.o.call(this)},C(vu.prototype,{i:pu,w:gu,M:fu,H:_u,u:yu,U:gc,P:_c,B:yc}),a(xu,Il),xu.prototype.v=function(){var e=this;Za(this,ja(this,"firebaseui-id-reset-password-link"),(function(){e.l()})),this.i&&(this.w(this.i),this.u().focus()),Il.prototype.v.call(this)},xu.prototype.o=function(){this.l=this.i=null,Il.prototype.o.call(this)},C(xu.prototype,{u:gc,B:_c,w:yc}),ia.passwordReset=function(e,t,i,n){bh(e,dh(e).verifyPasswordResetCode(i).then((function(r){var s=new vu(r,(function(){!function(e,t,i,n,r){var s=i.u();s&&bh(e,i.I(I(dh(e).confirmPasswordReset,dh(e)),[n,s],(function(){i.m();var n=new Bc(r);n.render(t),uh(e,n)}),(function(n){bu(e,t,i,n)})))}(e,t,s,i,n)}));s.render(t),uh(e,s)}),(function(){bu(e,t)})))},ia.emailChangeRevocation=function(e,t,i){var n=null;bh(e,dh(e).checkActionCode(i).then((function(t){return n=t.data.email,dh(e).applyActionCode(i)})).then((function(){!function(e,t,i){var n=new du(i,(function(){bh(e,n.I(I(dh(e).sendPasswordResetEmail,dh(e)),[i],(function(){n.m(),(n=new Rc(i,void 0,Do(Th(e)),Oo(Th(e)))).render(t),uh(e,n)}),(function(){n.a(Si().toString())})))}));n.render(t),uh(e,n)}(e,t,n)}),(function(){var i=new Vc;i.render(t),uh(e,i)})))},ia.emailVerification=function(e,t,i,n){bh(e,dh(e).applyActionCode(i).then((function(){var i=new Lc(n);i.render(t),uh(e,i)}),(function(){var i=new Dc;i.render(t),uh(e,i)})))},ia.revertSecondFactorAddition=function(e,t,i){var n=null,r=null;bh(e,dh(e).checkActionCode(i).then((function(t){return n=t.data.email,r=t.data.multiFactorInfo,dh(e).applyActionCode(i)})).then((function(){!function(e,t,i,n){var r=new xu(n.factorId,(function(){r.I(I(dh(e).sendPasswordResetEmail,dh(e)),[i],(function(){r.m(),(r=new Rc(i,void 0,Do(Th(e)),Oo(Th(e)))).render(t),uh(e,r)}),(function(){r.a(Si().toString())}))}),n.phoneNumber);r.render(t),uh(e,r)}(e,t,n,r)}),(function(){var i=new zc;i.render(t),uh(e,i)})))},ia.verifyAndChangeEmail=function(e,t,i,n){var r=null;bh(e,dh(e).checkActionCode(i).then((function(t){return r=t.data.email,dh(e).applyActionCode(i)})).then((function(){var i=new Oc(r,n);i.render(t),uh(e,i)}),(function(){var i=new Nc;i.render(t),uh(e,i)})))},a(Su,Il),Su.prototype.v=function(){this.w(this.l),this.B(this.l,this.u),this.i().focus(),wu(this.i(),(this.i().value||"").length),Il.prototype.v.call(this)},Su.prototype.o=function(){this.u=this.l=null,Il.prototype.o.call(this)},C(Su.prototype,{i:Ec,M:Mc,w:Ic,H:Ac,j:Cc,U:gc,P:_c,B:yc}),ia.emailLinkConfirmation=function(e,t,i,n,r,s){var o=new Su((function(){var r=o.j();r?(o.m(),n(e,t,r,i)):o.i().focus()}),(function(){o.m(),Jc(e,t,r||void 0)}),r||void 0,Do(Th(e)),Oo(Th(e)));o.render(t),uh(e,o),s&&o.a(s)},a(Tu,Il),Tu.prototype.v=function(){this.u(this.i),this.l().focus(),Il.prototype.v.call(this)},Tu.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},C(Tu.prototype,{l:gc,u:yc}),ia.emailLinkNewDeviceLinking=function(e,t,i,n){var r=new Fe(i);if(i=r.a.a.get(je.PROVIDER_ID)||null,Ue(r,null),i){var s=new Tu(Eo(Th(e),i),(function(){s.m(),n(e,t,r.toString())}),Do(Th(e)),Oo(Th(e)));s.render(t),uh(e,s)}else Jc(e,t)},a(Eu,Il),ia.emailLinkSignInCallback=Mu,a(Cu,Il),Cu.prototype.v=function(){this.u(this.i),this.l().focus(),Il.prototype.v.call(this)},Cu.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},C(Cu.prototype,{l:gc,u:yc}),ia.emailLinkSignInLinking=function(e,t,i){var n=$s(fh(e));if(Zs(fh(e)),n){var r=n.a.providerId,s=new Cu(i,Eo(Th(e),r),(function(){!function(e,t,i,n){var r=Al(t);tu(e,t,i,(function(){Jc(e,r,i)}),(function(n){if(!n.name||"cancel"!=n.name){var s=Zc(n);n&&"auth/network-request-failed"==n.code?t.a(s):(t.m(),Jc(e,r,i,s))}}),n)}(e,s,i,n)}),Do(Th(e)),Oo(Th(e)));s.render(t),uh(e,s)}else Jc(e,t)},a(Pu,Il),Pu.prototype.v=function(){var e=this;Za(this,this.l(),(function(){e.i()})),Za(this,ja(this,"firebaseui-id-trouble-getting-email-link"),(function(){e.u()})),this.l().focus(),Il.prototype.v.call(this)},Pu.prototype.o=function(){this.i=this.u=null,Il.prototype.o.call(this)},C(Pu.prototype,{l:_c}),ia.emailLinkSignInSent=function(e,t,i,n,r){var s=new Pu(i,(function(){s.m(),na("emailNotReceived",e,t,i,n,r)}),(function(){s.m(),n()}),Do(Th(e)),Oo(Th(e)));s.render(t),uh(e,s)},a(ku,Il),ku.prototype.v=function(){this.w(this.l,this.i),this.u().focus(),Il.prototype.v.call(this)},ku.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},C(ku.prototype,{u:gc,B:_c,w:yc}),ia.emailMismatch=function(e,t,i){var n=$s(fh(e));if(n){var r=new ku(i.user.email,n.g,(function(){var t=r;Zs(fh(e)),Wc(e,t,i)}),(function(){var t=i.credential.providerId,s=Al(r);r.m(),n.a?na("federatedLinking",e,s,n.g,t):na("federatedSignIn",e,s,n.g,t)}),Do(Th(e)),Oo(Th(e)));r.render(t),uh(e,r)}else Jc(e,t)},a(Ru,Il),Ru.prototype.v=function(){var e=this;Za(this,this.u(),(function(){e.i()})),Za(this,this.Da(),(function(){e.l()})),this.u().focus(),Il.prototype.v.call(this)},Ru.prototype.Da=function(){return ja(this,"firebaseui-id-resend-email-link")},Ru.prototype.o=function(){this.i=this.l=null,Il.prototype.o.call(this)},C(Ru.prototype,{u:_c}),ia.emailNotReceived=function(e,t,i,n,r){var s=new Ru((function(){tu(e,s,i,n,(function(e){e=Zc(e),s.a(e)}),r)}),(function(){s.m(),Jc(e,t,i)}),Do(Th(e)),Oo(Th(e)));s.render(t),uh(e,s)},a(Lu,Il),Lu.prototype.v=function(){this.u(this.i),this.l().focus(),Il.prototype.v.call(this)},Lu.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},C(Lu.prototype,{l:gc,u:yc}),ia.federatedLinking=function(e,t,i,n,r){var s=$s(fh(e));if(s&&s.a){var o=new Lu(i,Eo(Th(e),n),(function(){Xc(e,o,n,i)}),Do(Th(e)),Oo(Th(e)));o.render(t),uh(e,o),r&&o.a(r)}else Jc(e,t)},ia.federatedRedirect=function(e,t,i){var n=new Eu;n.render(t),uh(e,n),Xc(e,n,t=To(Th(e))[0],i)},ia.federatedSignIn=function(e,t,i,n,r){var s=new Lu(i,Eo(Th(e),n),(function(){Xc(e,s,n,i)}),Do(Th(e)),Oo(Th(e)));s.render(t),uh(e,s),r&&s.a(r)},ia.passwordLinking=function(e,t,i){var n=$s(fh(e));Zs(fh(e));var r=n&&n.a;if(r){var s=new Sc(i,(function(){!function(e,t,i,n){var r=t.u();r?bh(e,t.I(I(e.Xb,e),[i,r],(function(i){return i=i.user.linkWithCredential(n).then((function(i){return Wc(e,t,{user:i.user,credential:n,operationType:i.operationType,additionalUserInfo:i.additionalUserInfo})})),bh(e,i),i}),(function(e){if(!e.name||"cancel"!=e.name)switch(e.code){case"auth/wrong-password":Wa(t.i(),!1),Ya(t.B(),Zc(e));break;case"auth/too-many-requests":t.a(Zc(e));break;default:Ur("signInWithEmailAndPassword: "+e.message,void 0),t.a(Zc(e))}}))):t.i().focus()}(e,s,i,r)}),(function(){s.m(),na("passwordRecovery",e,t,i)}),Do(Th(e)),Oo(Th(e)));s.render(t),uh(e,s)}else Jc(e,t)},a(Du,Il),Du.prototype.v=function(){this.B(),this.H(this.l,this.u),la(this.i())||this.i().focus(),Pl(this,this.i(),this.l),Il.prototype.v.call(this)},Du.prototype.o=function(){this.u=this.l=null,Il.prototype.o.call(this)},C(Du.prototype,{i:Ec,w:Mc,B:Ic,M:Ac,j:Cc,U:gc,P:_c,H:yc}),ia.passwordRecovery=function(e,t,i,n,r){var s=new Du((function(){!function(e,t){var i=t.j();if(i){var n=Al(t);bh(e,t.I(I(dh(e).sendPasswordResetEmail,dh(e)),[i],(function(){t.m();var r=new Rc(i,(function(){r.m(),Jc(e,n)}),Do(Th(e)),Oo(Th(e)));r.render(n),uh(e,r)}),(function(e){Wa(t.i(),!1),Ya(t.w(),Zc(e))})))}else t.i().focus()}(e,s)}),n?void 0:function(){s.m(),Jc(e,t)},i,Do(Th(e)),Oo(Th(e)));s.render(t),uh(e,s),r&&s.a(r)},ia.passwordSignIn=function(e,t,i,n){var r=new Pc((function(){!function(e,t){var i=t.j(),n=t.u();if(i)if(n){var r=Dg.auth.EmailAuthProvider.credential(i,n);bh(e,t.I(I(e.bc,e),[i,n],(function(i){return Wc(e,t,{user:i.user,credential:r,operationType:i.operationType,additionalUserInfo:i.additionalUserInfo})}),(function(e){if(!e.name||"cancel"!=e.name)switch(e.code){case"auth/email-already-in-use":break;case"auth/email-exists":Wa(t.l(),!1),Ya(t.U(),Zc(e));break;case"auth/too-many-requests":case"auth/wrong-password":Wa(t.i(),!1),Ya(t.B(),Zc(e));break;default:Ur("verifyPassword: "+e.message,void 0),t.a(Zc(e))}})))}else t.i().focus();else t.l().focus()}(e,r)}),(function(){var i=r.M();r.m(),na("passwordRecovery",e,t,i)}),i,Do(Th(e)),Oo(Th(e)),n);r.render(t),uh(e,r)},a(zu,Il),zu.prototype.v=function(){this.ea(),this.B&&this.Ja(),this.ua(),this.pa(this.w,this.H),this.B?(Cl(this,this.i(),this.u()),Cl(this,this.u(),this.l())):Cl(this,this.i(),this.l()),this.w&&Pl(this,this.l(),this.w),la(this.i())?this.B&&!la(this.u())?this.u().focus():this.l().focus():this.i().focus(),Il.prototype.v.call(this)},zu.prototype.o=function(){this.H=this.w=null,Il.prototype.o.call(this)},C(zu.prototype,{i:Ec,U:Mc,ea:Ic,jb:Ac,j:Cc,u:Ou,Bc:Nu,Ja:function(){var e=Ou.call(this),t=Nu.call(this);qa(this,e,(function(){Ka(t)&&(Wa(e,!0),Xa(t))}))},M:function(){var e=Ou.call(this),t=Nu.call(this),i=la(e);return Wa(e,i=!/^[\s\xa0]*$/.test(null==i?"":String(i))),i?(Xa(t),t=!0):(Ya(t,ri("Enter your account name").toString()),t=!1),t?Z(la(e)):null},l:pu,ba:gu,lb:fu,ua:_u,P:yu,Nb:gc,Mb:_c,pa:yc}),ia.passwordSignUp=function(e,t,i,n,r,s){var o=new zu(No(Th(e)),(function(){!function(e,t){var i=No(Th(e)),n=t.j(),r=null;i&&(r=t.M());var s=t.P();if(n){if(i){if(!r)return void t.u().focus();r=ne(r)}if(s){var o=Dg.auth.EmailAuthProvider.credential(n,s);bh(e,t.I(I(e.Yb,e),[n,s],(function(n){var s={user:n.user,credential:o,operationType:n.operationType,additionalUserInfo:n.additionalUserInfo};return i?(n=n.user.updateProfile({displayName:r}).then((function(){return Wc(e,t,s)})),bh(e,n),n):Wc(e,t,s)}),(function(i){if(!i.name||"cancel"!=i.name){var r=Hc(i);switch(i=Zc(r),r.code){case"auth/email-already-in-use":return function(e,t,i,n){function r(){var e=Zc(n);Wa(t.i(),!1),Ya(t.U(),e),t.i().focus()}var s=dh(e).fetchSignInMethodsForEmail(i).then((function(n){n.length?r():(n=Al(t),t.m(),na("passwordRecovery",e,n,i,!1,Ei().toString()))}),(function(){r()}));return bh(e,s),s}(e,t,n,r);case"auth/too-many-requests":i=ri("Too many account requests are coming from your IP address. Try again in a few minutes.").toString();case"auth/operation-not-allowed":case"auth/weak-password":Wa(t.l(),!1),Ya(t.ba(),i);break;case"auth/admin-restricted-operation":Co(Th(e))?(i=Al(t),t.m(),na("handleUnauthorizedUser",e,i,n,Dg.auth.EmailAuthProvider.PROVIDER_ID)):t.a(i);break;default:Ur(r="setAccountInfo: "+Ss(r),void 0),t.a(i)}}})))}else t.l().focus()}else t.i().focus()}(e,o)}),r?void 0:function(){o.m(),Jc(e,t)},i,n,Do(Th(e)),Oo(Th(e)),s);o.render(t),uh(e,o)},a(Vu,Il),Vu.prototype.v=function(){var e=this;this.U(this.jb),Yi(this.i,"tick",this.w,!1,this),this.i.start(),Za(this,ja(this,"firebaseui-id-change-phone-number-link"),(function(){e.P()})),Za(this,this.Da(),(function(){e.M()})),this.Ja(this.l),this.ea(this.l,this.H),this.u().focus(),Il.prototype.v.call(this)},Vu.prototype.o=function(){this.M=this.H=this.l=this.P=null,va(this.i),Qi(this.i,"tick",this.w),this.i=null,Il.prototype.o.call(this)},Vu.prototype.w=function(){--this.B,0<this.B?this.U(this.B):(va(this.i),Qi(this.i,"tick",this.w),this.ua(),this.lb())},C(Vu.prototype,{u:Fu,pa:Bu,Ja:function(e){var t=Fu.call(this),i=Bu.call(this);qa(this,t,(function(){Ka(i)&&(Wa(t,!0),Xa(i))})),e&&$a(this,t,(function(){e()}))},ba:function(){var e=Z(la(Fu.call(this))||"");return/^\d{6}$/.test(e)?e:null},Fb:Uu,U:function(e){Gt(Uu.call(this),ri("Resend code in "+(9<e?"0:":"0:0")+e).toString())},ua:function(){Xa(this.Fb())},Da:function(){return ja(this,"firebaseui-id-resend-link")},lb:function(){Ya(this.Da())},Nb:gc,Mb:_c,ea:yc}),ia.phoneSignInFinish=function(e,t,i,n,r,s){var o=new Vu((function(){o.m(),na("phoneSignInStart",e,t,i)}),(function(){!function(e,t,i,n){function r(e){t.u().focus(),Wa(t.u(),!1),Ya(t.pa(),e)}var s=t.ba();s?(t.$("mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active firebaseui-progress-dialog-loading-icon",ri("Verifying...").toString()),bh(e,t.I(I(n.confirm,n),[s],(function(i){t.h(),t.$("firebaseui-icon-done",ri("Verified!").toString());var n=setTimeout((function(){t.h(),t.m();var n={user:ph(e).currentUser,credential:null,operationType:i.operationType,additionalUserInfo:i.additionalUserInfo};Wc(e,t,n,!0)}),1e3);bh(e,(function(){t&&t.h(),clearTimeout(n)}))}),(function(n){if(n.name&&"cancel"==n.name)t.h();else{var s=Hc(n);switch(n=Zc(s),s.code){case"auth/credential-already-in-use":t.h();break;case"auth/code-expired":s=Al(t),t.h(),t.m(),na("phoneSignInStart",e,s,i,n);break;case"auth/missing-verification-code":case"auth/invalid-verification-code":t.h(),r(n);break;default:t.h(),t.a(n)}}})))):r(ri("Wrong code. Try again.").toString())}(e,o,i,r)}),(function(){o.m(),Jc(e,t)}),(function(){o.m(),na("phoneSignInStart",e,t,i)}),go(i),n,Do(Th(e)),Oo(Th(e)));o.render(t),uh(e,o),s&&o.a(s)};var ju=!(Ye||We("Safari")&&!(qe()||We("Coast")||We("Opera")||We("Edge")||We("Firefox")||We("FxiOS")||We("Silk")||We("Android")));function Gu(e,t){return/-[a-z]/.test(t)?null:ju&&e.dataset?!We("Android")||qe()||We("Firefox")||We("FxiOS")||We("Opera")||We("Silk")||t in e.dataset?void 0===(e=e.dataset[t])?null:e:null:e.getAttribute("data-"+String(t).replace(/([A-Z])/g,"-$1").toLowerCase())}function Hu(e,t,i){var n=this;e=Kt(dl,{items:e},null,this.s),vl.call(this,e,!0,!0),i&&(i=function(e,t){e=(e||document).getElementsByTagName("BUTTON");for(var i=0;i<e.length;i++)if(Gu(e[i],"listboxid")===t)return e[i];return null}(e,i))&&(i.focus(),function(e,t){var i=(t=t||Ut(document))||Ut(document),n=za(e),r=za(i);if(!Ye||9<=Number(at)){o=Oa(i,"borderLeftWidth");var s=Oa(i,"borderRightWidth");a=Oa(i,"borderTopWidth"),l=Oa(i,"borderBottomWidth"),s=new Da(parseFloat(a),parseFloat(s),parseFloat(l),parseFloat(o))}else{var o=Ba(i,"borderLeft");s=Ba(i,"borderRight");var a=Ba(i,"borderTop"),l=Ba(i,"borderBottom");s=new Da(a,s,l,o)}i==Ut(document)?(o=n.a-i.scrollLeft,n=n.g-i.scrollTop,!Ye||10<=Number(at)||(o+=s.left,n+=s.top)):(o=n.a-r.a-s.left,n=n.g-r.g-s.top),r=e.offsetWidth,s=e.offsetHeight,a=et&&!r&&!s,e=d(r)&&!a||!e.getBoundingClientRect?new Dt(r,s):new Dt((e=Na(e)).right-e.left,e.bottom-e.top),r=i.clientHeight-e.height,s=i.scrollLeft,a=i.scrollTop,i=new Lt(s+=Math.min(o,Math.max(o-(i.clientWidth-e.width),0)),a+=Math.min(n,Math.max(n-r,0))),t.scrollLeft=i.a,t.scrollTop=i.g}(i,e)),Za(this,e,(function(e){(e=(e=Ht(e.target,"firebaseui-id-list-box-dialog-button"))&&Gu(e,"listboxid"))&&(xl.call(n),t(e))}))}function Wu(){return ja(this,"firebaseui-id-phone-number")}function qu(){return ja(this,"firebaseui-id-country-selector")}function $u(){return ja(this,"firebaseui-id-phone-number-error")}function Zu(e,t){var i,n=e.a,r=Xu("1-US-0",n);if(!(i=t&&Xu(t,n)?t:r?"1-US-0":0<n.length?n[0].c:null))throw Error("No available default country");Ju.call(this,i,e)}function Xu(e,t){return!(!(e=ao(e))||!j(t,e))}function Yu(e){return"firebaseui-flag-"+e.f}function Ku(e){var t=this;Hu.call(this,function(e){return e.map((function(e){return{id:e.c,Ma:"firebaseui-flag "+Yu(e),label:e.name+" +"+e.b}}))}(e.a),(function(i){Ju.call(t,i,e,!0),t.O().focus()}),this.Ba)}function Ju(e,t,i){var n=ao(e);n&&(i&&(t=oo(t,i=Z(la(Wu.call(this))||""))).length&&t[0].b!=n.b&&(i="+"+n.b+i.substr(t[0].b.length+1),ca(Wu.call(this),i)),t=ao(this.Ba),this.Ba=e,e=ja(this,"firebaseui-id-country-selector-flag"),t&&aa(e,Yu(t)),oa(e,Yu(n)),Gt(ja(this,"firebaseui-id-country-selector-code"),"+"+n.b))}function Qu(e,t,i,n,r,s,o,a,l,c){Il.call(this,hc,{Gb:t,Aa:l||null,Va:!!i,ia:!!s},c,"phoneSignInStart",{F:n,D:r}),this.H=a||null,this.M=t,this.l=e,this.w=i||null,this.pa=o||null}function eh(e,t,i,n){try{var r=t.U(qo)}catch(e){return}r?Ho?(t.$("mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active firebaseui-progress-dialog-loading-icon",ri("Verifying...").toString()),bh(e,t.I(I(e.cc,e),[go(r),i],(function(i){var n=Al(t);t.$("firebaseui-icon-done",ri("Code sent!").toString());var s=setTimeout((function(){t.h(),t.m(),na("phoneSignInFinish",e,n,r,15,i)}),1e3);bh(e,(function(){t&&t.h(),clearTimeout(s)}))}),(function(i){if(t.h(),!i.name||"cancel"!=i.name){grecaptcha.reset($o),Ho=null;var n=i&&i.message||"";if(i.code)switch(i.code){case"auth/too-many-requests":n=ri("This phone number has been used too many times").toString();break;case"auth/invalid-phone-number":case"auth/missing-phone-number":return t.O().focus(),void Ya(t.B(),wi().toString());case"auth/admin-restricted-operation":if(Co(Th(e)))return i=Al(t),t.m(),void na("handleUnauthorizedUser",e,i,go(r),Dg.auth.PhoneAuthProvider.PROVIDER_ID);n=Zc(i);break;default:n=Zc(i)}t.a(n)}})))):Wo?Ya(t.u(),ri("Solve the reCAPTCHA").toString()):!Wo&&n&&t.i().click():(t.O().focus(),Ya(t.B(),wi().toString()))}function th(e,t,i,n,r){Il.call(this,uc,{Sb:t},r,"providerSignIn",{F:i,D:n}),this.i=e}function ih(e,t,i,n,r,s,o){Il.call(this,kl,{email:i,Va:!!t,ia:!!s},o,"signIn",{F:n,D:r}),this.i=e,this.u=t}function nh(e,t,i,n,r,s,o){Il.call(this,Zl,{kc:e,yb:i,Eb:!!n},o,"unauthorizedUser",{F:r,D:s}),this.l=t,this.i=n}function rh(e,t,i,n,r,s){Il.call(this,Xl,{email:e},s,"unsupportedProvider",{F:n,D:r}),this.l=t,this.i=i}function sh(e,t){this.$=!1;var i=lh(t);if(ah[i])throw Error('An AuthUI instance already exists for the key "'+i+'"');ah[i]=this,this.a=e,this.u=null,this.Y=!1,oh(this.a),this.h=Dg.initializeApp({apiKey:e.app.options.apiKey,authDomain:e.app.options.authDomain},e.app.name+"-firebaseui-temp").auth(),(e=e.emulatorConfig)&&(i=e.port,this.h.useEmulator(e.protocol+"://"+e.host+(null===i?"":":"+i),e.options)),oh(this.h),this.h.setPersistence&&this.h.setPersistence(Dg.auth.Auth.Persistence.SESSION),this.oa=t,this.ca=new xo,this.g=this.T=this.i=this.J=this.O=null,this.s=[],this.Z=!1,this.l=_r.Xa(),this.j=this.C=null,this.da=this.A=!1}function oh(e){e&&e.INTERNAL&&e.INTERNAL.logFramework&&e.INTERNAL.logFramework("FirebaseUI-web")}a(Qu,Il),Qu.prototype.v=function(){this.ea(this.pa,this.H),this.P(this.l,this.w||void 0),this.M||Cl(this,this.O(),this.i()),Pl(this,this.i(),this.l),this.O().focus(),wu(this.O(),(this.O().value||"").length),Il.prototype.v.call(this)},Qu.prototype.o=function(){this.w=this.l=null,Il.prototype.o.call(this)},C(Qu.prototype,{Cb:bl,O:Wu,B:$u,ea:function(e,t,i){var n=this,r=Wu.call(this),s=qu.call(this),o=$u.call(this),a=e||po,l=a.a;if(0==l.length)throw Error("No available countries provided.");Zu.call(n,a,t),Za(this,s,(function(){Ku.call(n,a)})),qa(this,r,(function(){Ka(o)&&(Wa(r,!0),Xa(o));var e=Z(la(r)||""),t=ao(this.Ba),i=oo(a,e);e=Xu("1-US-0",l),i.length&&i[0].b!=t.b&&(t=i[0],Ju.call(n,"1"==t.b&&e?"1-US-0":t.c,a))})),i&&$a(this,r,(function(){i()}))},U:function(e){var t=Z(la(Wu.call(this))||""),i=(e=e||po).a,n=oo(po,t);if(n.length&&!j(i,n[0]))throw ca(Wu.call(this)),Wu.call(this).focus(),Ya($u.call(this),ri("The country code provided is not supported.").toString()),Error("The country code provided is not supported.");return i=ao(this.Ba),n.length&&n[0].b!=i.b&&Ju.call(this,n[0].c,e),n.length&&(t=t.substr(n[0].b.length+1)),t?new fo(this.Ba,t):null},Ja:qu,ba:function(){return ja(this,"firebaseui-recaptcha-container")},u:function(){return ja(this,"firebaseui-id-recaptcha-error")},i:gc,ua:_c,P:yc}),ia.phoneSignInStart=function(e,t,i,n){var r=function(e){var t=null;if(wo(e).forEach((function(e){e.provider==Dg.auth.PhoneAuthProvider.PROVIDER_ID&&w(e.recaptchaParameters)&&!Array.isArray(e.recaptchaParameters)&&(t=se(e.recaptchaParameters))})),t){var i=[];ta.forEach((function(e){void 0!==t[e]&&(i.push(e),delete t[e])})),i.length&&Hr('The following provided "recaptchaParameters" keys are not allowed: '+i.join(", "))}return t}(Th(e))||{};Ho=null,Wo=!(r&&"invisible"===r.size);var s=Kc(e),o=function(e){var t=(e=So(e,Dg.auth.PhoneAuthProvider.PROVIDER_ID))&&e.defaultCountry||null;t=t&&lo(t);var i=null;return e&&"string"==typeof e.loginHint&&(i=mo(e.loginHint)),t&&t[0]||i&&ao(i.a)||null}(Th(e)),a=s?function(e){var t=null;return(e=So(e,Dg.auth.PhoneAuthProvider.PROVIDER_ID))&&"string"==typeof e.loginHint&&(t=mo(e.loginHint)),e&&e.defaultNationalNumber||t&&t.Aa||null}(Th(e)):null;o=i&&i.a||o&&o.c||null,i=i&&i.Aa||a,(a=Ro(Th(e)))&&uo(a),qo=a?new so(Ro(Th(e))):po;var l=new Qu((function(t){eh(e,l,c,!(!t||!t.keyCode))}),Wo,s?null:function(){c.clear(),l.m(),Jc(e,t)},Do(Th(e)),Oo(Th(e)),s,qo,o,i);l.render(t),uh(e,l),n&&l.a(n),r.callback=function(t){l.u()&&Xa(l.u()),Ho=t,Wo||eh(e,l,c)},r["expired-callback"]=function(){Ho=null};var c=new Dg.auth.RecaptchaVerifier(Wo?l.ba():l.i(),r,ph(e).app);bh(e,l.I(I(c.render,c),[],(function(e){$o=e}),(function(i){i.name&&"cancel"==i.name||(i=Zc(i),l.m(),Jc(e,t,void 0,i))})))},ia.prefilledEmailSignIn=function(e,t,i){var n=new Eu;n.render(t),uh(e,n),bh(e,n.I(I(dh(e).fetchSignInMethodsForEmail,dh(e)),[i],(function(r){n.m();var s=!(!Yc(e)||!mh(e));eu(e,t,r,i,void 0,s)}),(function(r){r=Zc(r),n.m(),na("signIn",e,t,i,r)})))},a(th,Il),th.prototype.v=function(){this.l(this.i),Il.prototype.v.call(this)},th.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},C(th.prototype,{l:function(e){function t(t){e(t)}for(var i=this.g?Nt("firebaseui-id-idp-button",this.g||this.s.a):[],n=0;n<i.length;n++){var r=i[n];Za(this,r,A(t,Gu(r,"providerId")))}}}),ia.providerSignIn=function(e,t,i,n){var r=new th((function(i){i==Dg.auth.EmailAuthProvider.PROVIDER_ID?(r.m(),iu(e,t,n)):i==Dg.auth.PhoneAuthProvider.PROVIDER_ID?(r.m(),na("phoneSignInStart",e,t)):"anonymous"==i?function(e,t){bh(e,t.I(I(e.$b,e),[],(function(i){return t.m(),Wc(e,t,i,!0)}),(function(e){e.name&&"cancel"==e.name||(Ur("ContinueAsGuest: "+e.code,void 0),e=Zc(e),t.a(e))})))}(e,r):Xc(e,r,i,n),Eh(e),e.l.cancel()}),Mo(Th(e)),Do(Th(e)),Oo(Th(e)));r.render(t),uh(e,r),i&&r.a(i),function(e){Eh(e);try{yr(e.l,Io(Th(e)),function(e){var t;return Eh(e),(t=e.Z)||(t=!(!(e=ko(e=Th(e),Dg.auth.GoogleAuthProvider.PROVIDER_ID))||"select_account"!==e.prompt)),t}(e)).then((function(t){return!!e.g&&function(e,t,i){if(i&&i.credential&&i.clientId===Io(Th(e))){if(Po(Th(e),Dg.auth.GoogleAuthProvider.PROVIDER_ID).length){try{var n=JSON.parse(atob(i.credential.split(".")[1])).email}catch(r){}return Xc(e,t,Dg.auth.GoogleAuthProvider.PROVIDER_ID,n),Fn(!0)}return r=Dg.auth.GoogleAuthProvider.credential(i.credential),s=!1,r=t.I(I(e.ac,e),[r],(function(i){var n=Al(t);t.m(),na("callback",e,n,Fn(i)),s=!0}),(function(i){if(!(i.name&&"cancel"==i.name||i&&"auth/credential-already-in-use"==i.code))if(i&&"auth/email-already-in-use"==i.code&&i.email&&i.credential){var n=Al(t);t.m(),na("callback",e,n,Bn(i))}else i&&"auth/admin-restricted-operation"==i.code&&Co(Th(e))?(i=Al(t),t.m(),na("handleUnauthorizedUser",e,i,null,Dg.auth.GoogleAuthProvider.PROVIDER_ID)):(i=Zc(i),t.a(i))})),bh(e,r),r.then((function(){return s}),(function(){return!1}))}var r,s;return i&&t.a(ri("The selected credential for the authentication provider is not supported!").toString()),Fn(!1)}(e,e.g,t)}))}catch(e){}}(e)},ia.sendEmailLinkForSignIn=function(e,t,i,n){var r=new ou;r.render(t),uh(e,r),tu(e,r,i,n,(function(n){r.m(),n&&"auth/admin-restricted-operation"==n.code&&Co(Th(e))?na("handleUnauthorizedUser",e,t,i,Dg.auth.EmailAuthProvider.PROVIDER_ID):(n=Zc(n),na("signIn",e,t,i,n))}))},a(ih,Il),ih.prototype.v=function(){this.w(this.i),this.B(this.i,this.u||void 0),this.l().focus(),wu(this.l(),(this.l().value||"").length),Il.prototype.v.call(this)},ih.prototype.o=function(){this.u=this.i=null,Il.prototype.o.call(this)},C(ih.prototype,{l:Ec,M:Mc,w:Ic,H:Ac,j:Cc,U:gc,P:_c,B:yc}),ia.signIn=function(e,t,i,n){var r=Yc(e),s=new ih((function(){var t=s,i=t.j()||"";i&&Qc(e,t,i)}),r?null:function(){s.m(),Jc(e,t,i)},i,Do(Th(e)),Oo(Th(e)),r);s.render(t),uh(e,s),n&&s.a(n)},a(nh,Il),nh.prototype.v=function(){var e=this,t=ja(this,"firebaseui-id-unauthorized-user-help-link");this.i&&t&&Za(this,t,(function(){e.i()})),Za(this,this.u(),(function(){e.l()})),this.u().focus(),Il.prototype.v.call(this)},nh.prototype.o=function(){this.i=this.l=null,Il.prototype.o.call(this)},C(nh.prototype,{u:_c}),ia.handleUnauthorizedUser=function(e,t,i,n){function r(){Jc(e,t)}n===Dg.auth.EmailAuthProvider.PROVIDER_ID?r=function(){iu(e,t)}:n===Dg.auth.PhoneAuthProvider.PROVIDER_ID&&(r=function(){na("phoneSignInStart",e,t)});var s=null,o=null;n===Dg.auth.EmailAuthProvider.PROVIDER_ID&&Ao(Th(e))?(s=function(e){return(e=So(e,Dg.auth.EmailAuthProvider.PROVIDER_ID))&&e.disableSignUp&&e.disableSignUp.adminEmail||null}(Th(e)),o=function(e){if((e=So(e,Dg.auth.EmailAuthProvider.PROVIDER_ID))&&e.disableSignUp){var t=e.disableSignUp.helpLink||null;if(t&&"string"==typeof t)return function(){Jn(t)}}return null}(Th(e))):Co(Th(e))&&(s=function(e){return(e=e.a.get("adminRestrictedOperation"))&&e.adminEmail?e.adminEmail:null}(Th(e)),o=function(e){if(e=e.a.get("adminRestrictedOperation")||null){var t=e.helpLink||null;if(t&&"string"==typeof t)return function(){Jn(t)}}return null}(Th(e)));var a=new nh(i,(function(){a.m(),r()}),s,o,Do(Th(e)),Oo(Th(e)));a.render(t),uh(e,a)},a(rh,Il),rh.prototype.v=function(){this.w(this.l,this.i),this.u().focus(),Il.prototype.v.call(this)},rh.prototype.o=function(){this.i=this.l=null,Il.prototype.o.call(this)},C(rh.prototype,{u:gc,B:_c,w:yc}),ia.unsupportedProvider=function(e,t,i){var n=new rh(i,(function(){n.m(),na("passwordRecovery",e,t,i)}),(function(){n.m(),Jc(e,t,i)}),Do(Th(e)),Oo(Th(e)));n.render(t),uh(e,n)};var ah={};function lh(e){return e||"[DEFAULT]"}function ch(e){return Eh(e),e.i||(e.i=vh(e,(function(t){return t&&!$s(fh(e))?Fn(ph(e).getRedirectResult().then((function(e){return e}),(function(t){if(t&&"auth/email-already-in-use"==t.code&&t.email&&t.credential)throw t;return Ah(e,t)}))):Fn(dh(e).getRedirectResult().then((function(t){return bo(Th(e))&&!t.user&&e.j&&!e.j.isAnonymous?ph(e).getRedirectResult():t})))}))),e.i}function uh(e,t){Eh(e),e.g=t}var hh=null;function dh(e){return Eh(e),e.h}function ph(e){return Eh(e),e.a}function fh(e){return Eh(e),e.oa}function mh(e){return Eh(e),e.O?e.O.emailHint:void 0}function gh(e){return"signIn"===((e=new Fe(e)).a.a.get(je.ub)||null)&&!!e.a.a.get(je.$a)}function _h(e,t,i,n){Eh(e),void 0!==e.a.languageCode&&(e.u=e.a.languageCode);var r="en".replace(/_/g,"-");e.a.languageCode=r,e.h.languageCode=r,e.Y=!0,void 0!==e.a.tenantId&&(e.h.tenantId=e.a.tenantId),e.ib(i),e.O=n||null;var s=h.document;e.C?e.C.then((function(){"complete"==s.readyState?yh(e,t):Ji(window,"load",(function(){yh(e,t)}))})):"complete"==s.readyState?yh(e,t):Ji(window,"load",(function(){yh(e,t)}))}function yh(e,t){var i=Qn(t,"Could not find the FirebaseUI widget element on the page.");if(i.setAttribute("lang","en".replace(/_/g,"-")),hh){var n=hh;Eh(n),$s(fh(n))&&Hr("UI Widget is already rendered on the page and is pending some user interaction. Only one widget instance can be rendered per page. The previous instance has been automatically reset."),hh.reset()}if(hh=e,e.T=i,function(e,t){e.L=null,e.J=new gn(t),e.J.register(),Yi(e.J,"pageEnter",(function(t){if(t=t&&t.pageId,e.L!=t){var i=Th(e);(i=Go(i).uiChanged||null)&&i(e.L,t),e.L=t}}))}(e,i),Rs(new Ls)&&Rs(new Ds)){t=Qn(t,"Could not find the FirebaseUI widget element on the page."),i=(i=_e(i=er(),n=eo(Th(e).a,"queryParameterForSignInSuccessUrl")))?yt(xt(i)).toString():null;e:{n=er();var r=Lo(Th(e));for(s in n=_e(n,r)||"",Qo)if(Qo[s].toLowerCase()==n.toLowerCase()){var s=Qo[s];break e}s="callback"}switch(s){case"callback":i&&(s=fh(e),Ws(Us,i,s)),e.nb()?na("callback",e,t):Jc(e,t,mh(e));break;case"resetPassword":na("passwordReset",e,t,nu(),ru());break;case"recoverEmail":na("emailChangeRevocation",e,t,nu());break;case"revertSecondFactorAddition":na("revertSecondFactorAddition",e,t,nu());break;case"verifyEmail":na("emailVerification",e,t,nu(),ru());break;case"verifyAndChangeEmail":na("verifyAndChangeEmail",e,t,nu(),ru());break;case"signIn":na("emailLinkSignInCallback",e,t,er()),Mh();break;case"select":i&&(s=fh(e),Ws(Us,i,s)),Jc(e,t);break;default:throw Error("Unhandled widget operation.")}(t=Go(t=Th(e)).uiShown||null)&&t()}else t=Qn(t,"Could not find the FirebaseUI widget element on the page."),(s=new Gc(ri("The browser you are using does not support Web Storage. Please try again in a different browser.").toString())).render(t),uh(e,s);t=e.g&&"blank"==e.g.Ga&&Fo(Th(e)),Ys(fh(e))&&!t&&(Sh(e,(t=Ys(fh(e))).a),Hs(Bs,fh(e)))}function vh(e,t){if(e.A)return t(xh(e));if(bh(e,(function(){e.A=!1})),bo(Th(e))){var i=new kn((function(i){bh(e,e.a.onAuthStateChanged((function(n){e.j=n,e.A||(e.A=!0,i(t(xh(e))))})))}));return bh(e,i),i}return e.A=!0,t(null)}function xh(e){return Eh(e),bo(Th(e))&&e.j&&e.j.isAnonymous?e.j:null}function bh(e,t){if(Eh(e),t){e.s.push(t);var i=function(){!function(e,t){!function(e,t){for(var i=p(e)?e.split(""):e,n=e.length-1;0<=n;--n)n in i&&t.call(void 0,i[n],n,e)}(e,(function(i,n){t.call(void 0,i,n,e)&&H(e,n)}))}(e.s,(function(e){return e==t}))};"function"!=typeof t&&t.then(i,i)}}function wh(e){void 0!==e.a.languageCode&&e.Y&&(e.Y=!1,e.a.languageCode=e.u)}function Sh(e,t){e.a.tenantId=t,e.h.tenantId=t}function Th(e){return Eh(e),e.ca}function Eh(e){if(e.$)throw Error("AuthUI instance is deleted!")}function Mh(){var e=er();if(gh(e)){for(var t in e=new Fe(e),je)je.hasOwnProperty(t)&&De(e.a.a,je[t]);t={state:"signIn",mode:"emailLink",operation:"clear"};var i=h.document.title;h.history&&h.history.replaceState&&h.history.replaceState(t,i,e.toString())}}function Ih(e){return Eh(e),dh(e).signOut()}function Ah(e,t,i){if(Eh(e),t&&t.code&&("auth/email-already-in-use"==t.code||"auth/credential-already-in-use"==t.code)){var n=jo(Th(e));return Fn().then((function(){return n(new Ii("anonymous-upgrade-merge-conflict",null,i||t.credential))})).then((function(){throw e.g&&(e.g.m(),e.g=null),t}))}return Bn(t)}function Ch(e,t,i,n){Il.call(this,mc,void 0,n,"providerMatchByEmail",{F:t,D:i}),this.i=e}function Ph(e,t,i,n,r){Il.call(this,fc,{ec:t},r,"selectTenant",{F:i,D:n}),this.i=e}function kh(e){Il.call(this,zl,void 0,e,"spinner")}function Rh(e){for(var t in this.a=new Ks,Js(this.a,"authDomain"),Js(this.a,"displayMode",Bh),Js(this.a,"tenants"),Js(this.a,"callbacks"),Js(this.a,"tosUrl"),Js(this.a,"privacyPolicyUrl"),e)if(e.hasOwnProperty(t))try{Qs(this.a,t,e[t])}catch(e){Ur('Invalid config: "'+t+'"',void 0)}}function Lh(e){return e.a.get("callbacks")||{}}function Dh(e){var t=e.a.get("tosUrl")||null;if(e=e.a.get("privacyPolicyUrl")||null,t&&!e&&Hr("Privacy Policy URL is missing, the link will not be displayed."),t&&e){if("function"==typeof t)return t;if("string"==typeof t)return function(){Jn(t)}}return null}function Oh(e){var t=e.a.get("tosUrl")||null,i=e.a.get("privacyPolicyUrl")||null;if(i&&!t&&Hr("Terms of Service URL is missing, the link will not be displayed."),t&&i){if("function"==typeof i)return i;if("string"==typeof i)return function(){Jn(i)}}return null}function Nh(e,t){if(!(e=e.a.get("tenants"))||!e.hasOwnProperty(t)&&!e.hasOwnProperty(Vh))throw Error("Invalid tenant configuration!")}function zh(e,t,i){if(!(e=e.a.get("tenants")))throw Error("Invalid tenant configuration!");var n=[];if(!(e=e[t]||e[Vh]))return Ur("Invalid tenant configuration: "+t+" is not configured!",void 0),n;if(!(t=e.signInOptions))throw Error("Invalid tenant configuration: signInOptions are invalid!");return t.forEach((function(e){if("string"==typeof e)n.push(e);else if("string"==typeof e.provider){var t=e.hd;t&&i?(t instanceof RegExp?t:new RegExp("@"+t.replace(".","\\.")+"$")).test(i)&&n.push(e.provider):n.push(e.provider)}else Ur(e="Invalid tenant configuration: signInOption "+JSON.stringify(e)+" is invalid!",void 0)})),n}(e=sh.prototype).nb=function(){return Eh(this),!!Ys(fh(this))||gh(er())},e.start=function(e,t){_h(this,e,t)},e.Db=function(){Eh(this),this.Z=!0},e.reset=function(){Eh(this);var e=this;this.T&&this.T.removeAttribute("lang"),this.J&&function(e){var t=mn(e.N());dn[t]&&dn[t].length&&(function(e,t){e:{for(var i=e.length,n=p(e)?e.split(""):e,r=0;r<i;r++)if(r in n&&t.call(void 0,n[r],r,e)){t=r;break e}t=-1}0<=t&&H(e,t)}(dn[t],(function(t){return t==e})),dn[t].length||delete dn[t])}(this.J),wh(this),this.O=null,Mh(),Hs(Bs,fh(this)),Eh(this),this.l.cancel(),this.i=Fn({user:null,credential:null}),hh==this&&(hh=null),this.T=null;for(var t=0;t<this.s.length;t++)"function"==typeof this.s[t]?this.s[t]():this.s[t].cancel&&this.s[t].cancel();this.s=[],Zs(fh(this)),this.g&&(this.g.m(),this.g=null),this.L=null,this.h&&(this.C=Ih(this).then((function(){e.C=null}),(function(){e.C=null})))},e.ib=function(e){Eh(this);var t,i=this.ca;for(t in e)try{Qs(i.a,t,e[t])}catch(e){Ur('Invalid config: "'+t+'"',void 0)}tt&&Qs(i.a,"popupMode",!1),Ro(i),!this.da&&Uo(Th(this))&&(Hr("signInSuccess callback is deprecated. Please use signInSuccessWithAuthResult callback instead."),this.da=!0)},e.Wb=function(){Eh(this);var e=Th(this),t=eo(e.a,"widgetUrl");e=Lo(e);for(var i,n=t.search(ge),r=0,s=[];0<=(i=me(t,r,e,n));)s.push(t.substring(r,i)),r=Math.min(t.indexOf("&",i)+1||n,n);s.push(t.substr(r)),t=s.join("").replace(ye,"$1"),(e+=n="="+encodeURIComponent("select"))?(0>(n=t.indexOf("#"))&&(n=t.length),0>(r=t.indexOf("?"))||r>n?(r=n,i=""):i=t.substring(r+1,n),n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,n=t[0]+(t[1]?"?"+t[1]:"")+t[2]):n=t,Th(this).a.get("popupMode")?(n=n||"about:blank",(e={width:500,height:600,top:0<(e=(window.screen.availHeight-600)/2)?e:0,left:0<(t=(window.screen.availWidth-500)/2)?t:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1}).target=e.target||n.target||"google_popup",e.width=e.width||690,e.height=e.height||500,(e=Yn(n,e))&&e.focus()):Rt(window.location,n)},e.Wa=function(){var e=this;return Eh(this),this.h.app.delete().then((function(){var t=lh(fh(e));delete ah[t],e.reset(),e.$=!0}))},e.Ib=function(e,t){Eh(this);var i=this,n=function(){for(var e=32,t=[];0<e;)t.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),e--;return t.join("")}();if(!zo(Th(this)))return Bn(Error("Email link sign-in should be enabled to trigger email sending."));var r=function(e){if(zo(e)){var t={url:er(),handleCodeInApp:!0};(e=So(e,Dg.auth.EmailAuthProvider.PROVIDER_ID))&&"function"==typeof e.emailLinkSignIn&&ae(t,e.emailLinkSignIn()),e=t.url;var i=er();i instanceof ve||(i=Se(i)),e instanceof ve||(e=Se(e));var n=i;i=new ve(n);var r=!!e.j;r?xe(i,e.j):r=!!e.A,r?i.A=e.A:r=!!e.h,r?i.h=e.h:r=null!=e.C;var s=e.g;if(r)be(i,e.C);else if(r=!!e.g)if("/"!=s.charAt(0)&&(n.h&&!n.g?s="/"+s:-1!=(n=i.g.lastIndexOf("/"))&&(s=i.g.substr(0,n+1)+s)),".."==s||"."==s)s="";else if(-1!=s.indexOf("./")||-1!=s.indexOf("/.")){n=0==s.lastIndexOf("/",0),s=s.split("/");for(var o=[],a=0;a<s.length;){var l=s[a++];"."==l?n&&a==s.length&&o.push(""):".."==l?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),n&&a==s.length&&o.push("")):(o.push(l),n=!0)}s=o.join("/")}return r?i.g=s:r=""!==e.a.toString(),r?we(i,Ne(e.a)):r=!!e.s,r&&(i.s=e.s),t.url=i.toString(),t}return null}(Th(this)),s=new Fe(r.url);return function(e,t){t?e.a.a.set(je.Sa,t):De(e.a.a,je.Sa)}(s,n),t&&t.a&&(function(e,t,i){Ws(js,xs(e,JSON.stringify(Kr(t))),i)}(n,t,fh(this)),Ue(s,t.a.providerId)),function(e,t){null!==t?e.a.a.set(je.Qa,t?"1":"0"):De(e.a.a,je.Qa)}(s,function(e){return!(!(e=So(e,Dg.auth.EmailAuthProvider.PROVIDER_ID))||!e.forceSameDevice)}(Th(this))),vh(this,(function(t){return t&&((t=t.uid)?s.a.a.set(je.Pa,t):De(s.a.a,je.Pa)),r.url=s.toString(),dh(i).sendSignInLinkToEmail(e,r)})).then((function(){var t=fh(i),r={};r.email=e,Ws(Vs,xs(n,JSON.stringify(r)),t)}),(function(e){throw Hs(js,fh(i)),Hs(Vs,fh(i)),e}))},e.bc=function(e,t){Eh(this);var i=this;return dh(this).signInWithEmailAndPassword(e,t).then((function(n){return vh(i,(function(r){return r?Ih(i).then((function(){return Ah(i,{code:"auth/email-already-in-use"},Dg.auth.EmailAuthProvider.credential(e,t))})):n}))}))},e.Yb=function(e,t){Eh(this);var i=this;return vh(this,(function(n){if(n){var r=Dg.auth.EmailAuthProvider.credential(e,t);return n.linkWithCredential(r)}return dh(i).createUserWithEmailAndPassword(e,t)}))},e.ac=function(e){Eh(this);var t=this;return vh(this,(function(i){return i?i.linkWithCredential(e).then((function(e){return e}),(function(i){if(i&&"auth/email-already-in-use"==i.code&&i.email&&i.credential)throw i;return Ah(t,i,e)})):dh(t).signInWithCredential(e)}))},e.dc=function(e){Eh(this);var t=this,i=this.i;return this.i=null,vh(this,(function(i){return i&&!$s(fh(t))?i.linkWithRedirect(e):dh(t).signInWithRedirect(e)})).then((function(){}),(function(e){throw t.i=i,e}))},e.cc=function(e,t){Eh(this);var i=this;return vh(this,(function(n){return n?n.linkWithPhoneNumber(e,t).then((function(e){return new br(e,(function(e){if("auth/credential-already-in-use"==e.code)return Ah(i,e);throw e}))})):ph(i).signInWithPhoneNumber(e,t).then((function(e){return new br(e)}))}))},e.$b=function(){return Eh(this),ph(this).signInAnonymously()},e.Xb=function(e,t){return Eh(this),dh(this).signInWithEmailAndPassword(e,t)},a(Ch,Il),Ch.prototype.v=function(){this.u(this.i),this.w(this.i),this.l().focus(),wu(this.l(),(this.l().value||"").length),Il.prototype.v.call(this)},Ch.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},C(Ch.prototype,{l:Ec,H:Mc,u:Ic,B:Ac,j:Cc,M:gc,w:yc}),a(Ph,Il),Ph.prototype.v=function(){!function(e,t){function i(e){t(e)}for(var n=e.g?Nt("firebaseui-id-tenant-selection-button",e.g||e.s.a):[],r=0;r<n.length;r++){var s=n[r];Za(e,s,A(i,Gu(s,"tenantId")))}}(this,this.i),Il.prototype.v.call(this)},Ph.prototype.o=function(){this.i=null,Il.prototype.o.call(this)},a(kh,Il);var Fh=["immediateFederatedRedirect","privacyPolicyUrl","signInFlow","signInOptions","tosUrl"],Bh="optionFirst",Uh={pc:Bh,oc:"identifierFirst"},Vh="*";function jh(e,t){var i=this;this.s=Qn(e),this.a={},Object.keys(t).forEach((function(e){i.a[e]=new Rh(t[e])})),this.ob=this.g=this.A=this.h=this.i=this.j=null,Object.defineProperty(this,"languageCode",{get:function(){return this.ob},set:function(e){this.ob=e||null},enumerable:!1})}function Gh(e){e.j&&e.j.reset(),e.mb(),e.g&&e.g.m()}(e=jh.prototype).Ub=function(e,t){var i=this;Gh(this);var n=e.apiKey;return new kn((function(e,r){if(i.a.hasOwnProperty(n)){var s=Lh(i.a[n]).selectTenantUiHidden||null;if(function(e){for(var t in e=e.a.get("displayMode"),Uh)if(Uh[t]===e)return Uh[t];return Bh}(i.a[n])===Bh){var o=[];t.forEach((function(e){e=e||"_";var t=i.a[n].a.get("tenants");if(!t)throw Error("Invalid tenant configuration!");(t=t[e]||t[Vh])?e={tenantId:"_"!==e?e:null,V:t.fullLabel||null,displayName:t.displayName,za:t.iconUrl,ta:t.buttonColor}:(Ur("Invalid tenant configuration: "+e+" is not configured!",void 0),e=null),e&&o.push(e)}));var a=function(t){t={tenantId:t,providerIds:zh(i.a[n],t||"_")},e(t)};if(1===o.length)return void a(o[0].tenantId);i.g=new Ph((function(e){Gh(i),s&&s(),a(e)}),o,Dh(i.a[n]),Oh(i.a[n]))}else i.g=new Ch((function(){var r=i.g.j();if(r){for(var o=0;o<t.length;o++){var a=zh(i.a[n],t[o]||"_",r);if(0!==a.length)return r={tenantId:t[o],providerIds:a,email:r},Gh(i),s&&s(),void e(r)}i.g.a(Mi({code:"no-matching-tenant-for-email"}).toString())}}),Dh(i.a[n]),Oh(i.a[n]));i.g.render(i.s),(r=Lh(i.a[n]).selectTenantUiShown||null)&&r()}else{var l=Error("Invalid project configuration: API key is invalid!");l.code="invalid-configuration",i.pb(l),r(l)}}))},e.Pb=function(e,t){if(!this.a.hasOwnProperty(e))throw Error("Invalid project configuration: API key is invalid!");var i=t||void 0;Nh(this.a[e],t||"_");try{this.i=Dg.app(i).auth()}catch(r){var n=this.a[e].a.get("authDomain");if(!n)throw Error("Invalid project configuration: authDomain is required!");(e=Dg.initializeApp({apiKey:e,authDomain:n},i)).auth().tenantId=t,this.i=e.auth()}return this.i},e.Zb=function(e,t){var i=this;return new kn((function(n,r){function s(t,n){i.j=new sh(e),_h(i.j,i.s,t,n)}var o=e.app.options.apiKey;i.a.hasOwnProperty(o)||r(Error("Invalid project configuration: API key is invalid!"));var a=function(e,t,i){return e=function(e,t){var i=Fh,n=void 0===n?{}:n;return Nh(e,t),function(e,t,i){return i=void 0===i?{}:i,Object.keys(e).filter((function(e){return t.includes(e)})).reduce((function(t,i){return t[i]=e[i],t}),i)}((e=e.a.get("tenants"))[t]||e[Vh],i,n)}(e,t),(t=e.signInOptions)&&i&&(t=t.filter((function(e){return"string"==typeof e?i.includes(e):i.includes(e.provider)})),e.signInOptions=t),e}(i.a[o],e.tenantId||"_",t&&t.providerIds);Gh(i),r={signInSuccessWithAuthResult:function(e){return n(e),!1}};var l,c=Lh(i.a[o]).signInUiShown||null,u=!1;r.uiChanged=function(t,n){null===t&&"callback"===n?((t=zt("firebaseui-id-page-callback",i.s))&&Xa(t),i.h=new kh,i.h.render(i.s)):u||null===t&&"spinner"===n||"blank"===n||(i.h&&(i.h.m(),i.h=null),u=!0,c&&c(e.tenantId))},a.callbacks=r,a.credentialHelper="none",t&&t.email&&(l={emailHint:t.email}),i.j?i.j.Wa().then((function(){s(a,l)})):s(a,l)}))},e.reset=function(){var e=this;return Fn().then((function(){e.j&&e.j.Wa()})).then((function(){e.j=null,Gh(e)}))},e.Vb=function(){var e=this;this.h||this.A||(this.A=window.setTimeout((function(){Gh(e),e.h=new kh,e.g=e.h,e.h.render(e.s),e.A=null}),500))},e.mb=function(){window.clearTimeout(this.A),this.A=null,this.h&&(this.h.m(),this.h=null)},e.Bb=function(){return Gh(this),this.g=new Fc,this.g.render(this.s),Fn()},e.pb=function(e){var t,i=this,n=Mi({code:e.code}).toString()||e.message;Gh(this),e.retry&&"function"==typeof e.retry&&(t=function(){i.reset(),e.retry()}),this.g=new jc(n,t),this.g.render(this.s)},e.Rb=function(e){var t=this;return Fn().then((function(){var i=t.i&&t.i.app.options.apiKey;if(!t.a.hasOwnProperty(i))throw Error("Invalid project configuration: API key is invalid!");if(Nh(t.a[i],e.tenantId||"_"),!t.i.currentUser||t.i.currentUser.uid!==e.uid)throw Error("The user being processed does not match the signed in user!");return(i=Lh(t.a[i]).beforeSignInSuccess||null)?i(e):e})).then((function(t){if(t.uid!==e.uid)throw Error("User with mismatching UID returned.");return t}))},R("firebaseui.auth.FirebaseUiHandler",jh),R("firebaseui.auth.FirebaseUiHandler.prototype.selectTenant",jh.prototype.Ub),R("firebaseui.auth.FirebaseUiHandler.prototype.getAuth",jh.prototype.Pb),R("firebaseui.auth.FirebaseUiHandler.prototype.startSignIn",jh.prototype.Zb),R("firebaseui.auth.FirebaseUiHandler.prototype.reset",jh.prototype.reset),R("firebaseui.auth.FirebaseUiHandler.prototype.showProgressBar",jh.prototype.Vb),R("firebaseui.auth.FirebaseUiHandler.prototype.hideProgressBar",jh.prototype.mb),R("firebaseui.auth.FirebaseUiHandler.prototype.completeSignOut",jh.prototype.Bb),R("firebaseui.auth.FirebaseUiHandler.prototype.handleError",jh.prototype.pb),R("firebaseui.auth.FirebaseUiHandler.prototype.processUser",jh.prototype.Rb),R("firebaseui.auth.AuthUI",sh),R("firebaseui.auth.AuthUI.getInstance",(function(e){return e=lh(e),ah[e]?ah[e]:null})),R("firebaseui.auth.AuthUI.prototype.disableAutoSignIn",sh.prototype.Db),R("firebaseui.auth.AuthUI.prototype.start",sh.prototype.start),R("firebaseui.auth.AuthUI.prototype.setConfig",sh.prototype.ib),R("firebaseui.auth.AuthUI.prototype.signIn",sh.prototype.Wb),R("firebaseui.auth.AuthUI.prototype.reset",sh.prototype.reset),R("firebaseui.auth.AuthUI.prototype.delete",sh.prototype.Wa),R("firebaseui.auth.AuthUI.prototype.isPendingRedirect",sh.prototype.nb),R("firebaseui.auth.AuthUIError",Ii),R("firebaseui.auth.AuthUIError.prototype.toJSON",Ii.prototype.toJSON),R("firebaseui.auth.CredentialHelper.GOOGLE_YOLO",Zo),R("firebaseui.auth.CredentialHelper.NONE",Xo),R("firebaseui.auth.AnonymousAuthProvider.PROVIDER_ID","anonymous"),kn.prototype.catch=kn.prototype.Ca,kn.prototype.finally=kn.prototype.fc}).apply(void 0!==i.g?i.g:"undefined"!=typeof self?self:window)}.apply(void 0!==i.g?i.g:"undefined"!=typeof self?self:window),"undefined"!=typeof window&&(window.dialogPolyfill=_b());var yb=firebaseui.auth,vb=i(72),xb=i.n(vb),bb=i(825),wb=i.n(bb),Sb=i(659),Tb=i.n(Sb),Eb=i(56),Mb=i.n(Eb),Ib=i(540),Ab=i.n(Ib),Cb=i(113),Pb=i.n(Cb),kb=i(591),Rb={};Rb.styleTagTransform=Pb(),Rb.setAttributes=Mb(),Rb.insert=Tb().bind(null,"head"),Rb.domAPI=wb(),Rb.insertStyleElement=Ab(),xb()(kb.A,Rb),kb.A&&kb.A.locals&&kb.A.locals,Dg.initializeApp({apiKey:"AIzaSyC7GBQB3LVoKhtmvMqRn5UjgWWFh4JH-yc",authDomain:"demorsi-a1501.firebaseapp.com",databaseURL:"https://demorsi-a1501-default-rtdb.firebaseio.com",projectId:"demorsi-a1501",storageBucket:"demorsi-a1501.appspot.com",messagingSenderId:"817015833630",appId:"1:817015833630:web:8527005d0d234165b21a0f"});const Lb=function(e,t){const i=Yr(as(),"firestore").getImmediate({identifier:"(default)"});if(!i._initialized){const e=(e=>{const t=(e=>{var t,i;return null===(i=null===(t=_n())||void 0===t?void 0:t.emulatorHosts)||void 0===i?void 0:i[e]})(e);if(!t)return;const i=t.lastIndexOf(":");if(i<=0||i+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(i+1),10);return"["===t[0]?[t.substring(1,i-1),n]:[t.substring(0,i),n]})("firestore");e&&function(e,t,i,n={}){var r;const s=(e=Vm(e,Gm))._getSettings(),o=`${t}:${i}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Kc("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),n.mockUserToken){let t,i;if("string"==typeof n.mockUserToken)t=n.mockUserToken,i=Wc.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i=t||"demo-project",n=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:n,exp:n+3600,auth_time:n,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[fn(JSON.stringify({alg:"none",type:"JWT"})),fn(JSON.stringify(s)),""].join(".")}(n.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);const s=n.mockUserToken.sub||n.mockUserToken.user_id;if(!s)throw new nu(iu.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");i=new Wc(s)}e._authCredentials=new au(new su(t,i))}}(i,...e)}return i}();var Db={callbacks:{signInSuccessWithAuthResult:function(e){return console.log("yes"),document.querySelector(".grey-out").style.display="none",console.log(e.user.uid),!1},uiShown:function(){document.getElementById("loader").style.display="none"}},signInOptions:[{provider:Dg.auth.EmailAuthProvider.PROVIDER_ID,requireDisplayName:!1}]},Ob=new yb.AuthUI(Dg.auth());async function Nb(e,t){const i=function(e,t){if(e=Vm(e,Gm),function(e,t,i){if(!i)throw new nu(iu.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new nu(iu.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Hm(e,null,function(e){return new Wh(xu.emptyPath(),e)}(t))}(Lb,"Images"),n=_u.fromDate(e),r=new Date(t.getTime()-36e5),s=_u.fromDate(r),o=_u.fromDate(t),a=await pg(i,yg(5e3),mg("Date",">=",n),mg("Date","<=",o),mg("Type","==","AVL")),l=await pg(i,yg(300),mg("Date",">=",s),mg("Date","<=",o),mg("Type","==","RWIS")),c=await Cg(a),u=await Cg(l),h=[],d=[];return c.forEach((e=>{"AVL"==e.data().Type&&h.push({id:e.id,data:e.data()})})),u.forEach((e=>{"RWIS"==e.data().Type&&d.push({id:e.id,data:e.data()})})),console.log("Size of AVL Query: "+h.length+", RWIS Query: "+d.length),[h,d]}Ob.start("#firebaseui-auth-container",Db),Ob.isPendingRedirect()&&Ob.start("#firebaseui-auth-container",Db);const zb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Fb{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,i]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const n=i>>4;if(1!==n)throw new Error(`Got v${n} data when expected v1.`);const r=zb[15&i];if(!r)throw new Error("Unrecognized array type.");const[s]=new Uint16Array(e,2,1),[o]=new Uint32Array(e,4,1);return new Fb(o,s,r,e)}constructor(e,t=64,i=Float64Array,n){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=zb.indexOf(this.ArrayType),s=2*e*this.ArrayType.BYTES_PER_ELEMENT,o=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-o%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${i}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+s+o+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=t,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Bb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:s,nodeSize:o}=this,a=[0,r.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=o){for(let o=h;o<=u;o++){const a=s[2*o],c=s[2*o+1];a>=e&&a<=i&&c>=t&&c<=n&&l.push(r[o])}continue}const d=h+u>>1,p=s[2*d],f=s[2*d+1];p>=e&&p<=i&&f>=t&&f<=n&&l.push(r[d]),(0===c?e<=p:t<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?i>=p:n>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:r,nodeSize:s}=this,o=[0,n.length-1,0],a=[],l=i*i;for(;o.length;){const c=o.pop()||0,u=o.pop()||0,h=o.pop()||0;if(u-h<=s){for(let i=h;i<=u;i++)Gb(r[2*i],r[2*i+1],e,t)<=l&&a.push(n[i]);continue}const d=h+u>>1,p=r[2*d],f=r[2*d+1];Gb(p,f,e,t)<=l&&a.push(n[d]),(0===c?e-i<=p:t-i<=f)&&(o.push(h),o.push(d-1),o.push(1-c)),(0===c?e+i>=p:t+i>=f)&&(o.push(d+1),o.push(u),o.push(1-c))}return a}}function Bb(e,t,i,n,r,s){if(r-n<=i)return;const o=n+r>>1;Ub(e,t,o,n,r,s),Bb(e,t,i,n,o-1,1-s),Bb(e,t,i,o+1,r,1-s)}function Ub(e,t,i,n,r,s){for(;r>n;){if(r-n>600){const o=r-n+1,a=i-n+1,l=Math.log(o),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(o-c)/o)*(a-o/2<0?-1:1);Ub(e,t,i,Math.max(n,Math.floor(i-a*c/o+u)),Math.min(r,Math.floor(i+(o-a)*c/o+u)),s)}const o=t[2*i+s];let a=n,l=r;for(Vb(e,t,n,i),t[2*r+s]>o&&Vb(e,t,n,r);a<l;){for(Vb(e,t,a,l),a++,l--;t[2*a+s]<o;)a++;for(;t[2*l+s]>o;)l--}t[2*n+s]===o?Vb(e,t,n,l):(l++,Vb(e,t,l,r)),l<=i&&(n=l+1),i<=l&&(r=l-1)}}function Vb(e,t,i,n){jb(e,i,n),jb(t,2*i,2*n),jb(t,2*i+1,2*n+1)}function jb(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}function Gb(e,t,i,n){const r=e-i,s=t-n;return r*r+s*s}class Hb{constructor(e=[],t=Wb){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,n=t[e];for(;e>0;){const r=e-1>>1,s=t[r];if(i(n,s)>=0)break;t[e]=s,e=r}t[e]=n}_down(e){const{data:t,compare:i}=this,n=this.length>>1,r=t[e];for(;e<n;){let n=1+(e<<1),s=t[n];const o=n+1;if(o<this.length&&i(t[o],s)<0&&(n=o,s=t[o]),i(s,r)>=0)break;t[e]=s,e=n}t[e]=r}}function Wb(e,t){return e<t?-1:e>t?1:0}const qb=6371,$b=Math.PI/180;function Zb(e,t,i,n,r,s){let o=1;const a=[];void 0===n&&(n=1/0),void 0!==r&&(o=Kb(r/qb));const l=new Hb([],Yb);let c={left:0,right:e.ids.length-1,axis:0,dist:0,minLng:-180,minLat:-90,maxLng:180,maxLat:90};const u=Math.cos(i*$b);for(;c;){const r=c.right,h=c.left;if(r-h<=e.nodeSize)for(let n=h;n<=r;n++){const r=e.ids[n];s&&!s(r)||l.push({item:r,dist:Qb(t,i,e.coords[2*n],e.coords[2*n+1],u)})}else{const n=h+r>>1,o=e.coords[2*n],a=e.coords[2*n+1],d=e.ids[n];s&&!s(d)||l.push({item:d,dist:Qb(t,i,o,a,u)});const p=(c.axis+1)%2,f={left:h,right:n-1,axis:p,minLng:c.minLng,minLat:c.minLat,maxLng:0===c.axis?o:c.maxLng,maxLat:1===c.axis?a:c.maxLat,dist:0},m={left:n+1,right:r,axis:p,minLng:0===c.axis?o:c.minLng,minLat:1===c.axis?a:c.minLat,maxLng:c.maxLng,maxLat:c.maxLat,dist:0};f.dist=Xb(t,i,u,f),m.dist=Xb(t,i,u,m),l.push(f),l.push(m)}for(;l.length&&void 0!==l.peek().item;){const e=l.pop();if(e.dist>o)return a;if(a.push(e.item),a.length===n)return a}c=l.pop()}return a}function Xb(e,t,i,n){const r=n.minLng,s=n.maxLng,o=n.minLat,a=n.maxLat;if(e>=r&&e<=s)return t<o?Kb((t-o)*$b):t>a?Kb((t-a)*$b):0;const l=Math.min(Kb((e-r)*$b),Kb((e-s)*$b)),c=function(e,t){const i=1-2*t;return i<=0?e>0?90:-90:Math.atan(Math.tan(e*$b)/i)/$b}(t,l);return c>o&&c<a?Jb(l,i,t,c):Math.min(Jb(l,i,t,o),Jb(l,i,t,a))}function Yb(e,t){return e.dist-t.dist}function Kb(e){const t=Math.sin(e/2);return t*t}function Jb(e,t,i,n){return t*Math.cos(n*$b)*e+Kb((i-n)*$b)}function Qb(e,t,i,n,r){return Jb(Kb((e-i)*$b),r,t,n)}async function ew(e){try{const t=await fetch(e);return await t.json()}catch(e){return console.error("Error loading GeoJSON:",e),null}}function tw(){const e=document.getElementById("loadingScreen");e.style.display="flex",e.classList.add("fadeInAnimation"),e.style.display="flex",document.querySelectorAll(".loadup").forEach((e=>{e.classList.add("fadeOutAnimation"),e.style.opacity=.3,e.classList.remove("fadeOutAnimation")}))}function iw(){const e=document.getElementById("loadingScreen");e.classList.remove("fadeInAnimation"),e.classList.add("fadeOutAnimation"),e.classList.remove("fadeOutAnimation"),document.querySelectorAll(".loadup").forEach((e=>{e.style.opacity=1}))}async function nw(e){if(console.log("Interpolating current data with NN method..."),!e)return;tw();let t=await ew("./assets/I35I80_Lanes_100ft.geojson"),i=e;i=rw(e,t,.05);const n=await sw(t,i,30);return console.log("Interpolation complete."),iw(),n}function rw(e,t,i){const n=new Fb(138137),r=new Map;t.features.map((e=>{e.geometry.coordinates.map((t=>{const i=n.add(t[0],t[1]);r.set(i,e)}))})),n.finish();for(const t of e.features){const e=Zb(n,t.geometry.coordinates[0],t.geometry.coordinates[1],3,i);for(const i of e){const e=r.get(i);if(e){t.properties.direction=e.properties.ROUTEID;break}}}return e}async function sw(e,t,i){const n=new Fb(t.features.length),r=new Map;t.features.forEach((e=>{const t=n.add(e.geometry.coordinates[0],e.geometry.coordinates[1]);e.properties.geoid=t,r.set(t,e)})),n.finish();for(const t of e.features){const e=ow(t.geometry.coordinates),s=Zb(n,e[0],e[1],10,i);for(const e of s){const i=r.get(e);if(i&&i.properties.direction===t.properties.ROUTEID){t.properties.classification=i.properties.classification;break}}}return e}function ow(e){let t=0,i=0;const n=e.length;return e.forEach((e=>{t+=e[1],i+=e[0]})),[i/n,t/n]}var aw=i(735);const lw=document.querySelector("#studyarea-toggle");let cw=!0;lw.addEventListener("change",(e=>{cw=!!e.target.checked}));const uw=document.querySelector("#realtime-toggle"),hw=document.querySelectorAll(".archived-query");let dw=!1;uw.addEventListener("change",(e=>{e.target.checked?(dw=!0,hw.forEach((e=>{e.style.display="none"}))):(dw=!1,hw.forEach((e=>{e.style.display="flex"}))),console.log(`Realtime: ${dw}`)})),document.getElementById("shift-button").addEventListener("click",(function(){document.getElementById("console").classList.toggle("shifted"),document.getElementById("shift-button").classList.toggle("shifted");const e=document.getElementById("arrow-img").classList.toggle("flipped"),t={};let i=document.getElementById("console").clientWidth;t.right=e?0:i,oV.easeTo({padding:t,duration:1e3})}));const pw=document.getElementById("time-range"),fw=document.getElementById("slider-value");let mw=0;function gw(){let e=document.querySelector(".console.resizable");e.scrollTop=e.scrollHeight}async function _w(e,t){const[i,n]=Iw(e,t),[r,s]=await Nb(i,n),o=await async function(e,t){console.log("Performing get request to mesonet...");const i=new Date(e).toISOString(),n=`https://mesonet.agron.iastate.edu/api/1/idot_dashcam.json?valid=${encodeURIComponent(i)}&window=${t}`;console.log(n);try{const e=await fetch(n,{method:"GET",headers:{Accept:"application/json"}});if(!e.ok)throw new Error("Network response was not ok "+e.statusText);const t=await e.json();return console.log("Response from mesonet API:",t),t}catch(e){throw console.error("There was a problem fetching the AVL data:",e),e}}(e,t),a=await async function(e,t){const i=["IDOT-000-03","IDOT-001-00","IDOT-008-00","IDOT-010-01","IDOT-025-01","IDOT-025-04","IDOT-030-01","IDOT-036-00","IDOT-036-03","IDOT-040-00","IDOT-047-00","IDOT-047-01","IDOT-047-02","IDOT-047-05","IDOT-047-06","IDOT-051-01","IDOT-051-02","IDOT-053-00","IDOT-053-02","IDOT-056-00"];let n=new Date(t);n.setMinutes(n.getMinutes()-60);const r=[];if(s=n,o=new Date(t),s.toDateString()!==o.toDateString()){console.log("Query spans two UTC days");let e=new Date(n);e.setHours(24,0,0,0);for(const s of i){const i=await Pw(s,n,e);r.push(...i);const o=await Pw(s,e,t);r.push(...o)}}else for(const e of i){const i=await Pw(e,n,t);r.push(...i)}var s,o;return console.log("Available RWIS images: "+r.length),r}(0,n),l=function(e,t){const i={};for(const n of e){let e=!1;for(const i of t)if(i.data.Image==n){e=!0;break}e||(i[n.replace(".jpg","").split("/").pop()]=n)}return 0!==Object.keys(i).length&&i}(a,s),c=function(e,t){console.log(e);const i={};for(const n of e.data){let e=!1;for(const i of t)if(i.data.IMAGE_URL==n.imgurl){e=!0,console.log("TRUE TRUE TRUE");break}e||(i[n.imgurl.split("/").pop().replace(".jpg","")]=n)}return 0!==Object.keys(i).length&&i}(o,r);c?(console.log("Unpredicted AVL images were found, sending to backend..."),console.log("# of unpredicted AVL images: "+Object.keys(c).length),async function(e,t,i){tw();try{console.log("POSTing to AVL Backend"),console.time("Request Duration");const t=await vw(e,100,"/avl");console.timeEnd("Request Duration"),console.log("Response from AVL Backend: ",t)}catch(e){console.error("Error:",e)}const[n,r]=Iw(t,i),[s,o]=await Nb(n,r);xw(s,o),iw()}(c,e,t)):console.log("All available AVL images already have predictions."),l?(console.log("Unpredicted RWIS images were found, sending to backend..."),console.log("# of unpredicted RWIS images: "+Object.keys(l).length),async function(e,t,i){try{console.log("POSTing to RWIS Backend"),console.time("Request Duration");const t=await vw(e,10,"");console.timeEnd("Request Duration"),console.log("Response from RWIS Backend: ",t)}catch(e){console.error("Error:",e)}const[n,r]=Iw(t,i),[s,o]=await Nb(n,r);xw(s,o)}(l,e,t)):console.log("All available RWIS images already have predictions."),xw(r,s)}pw.addEventListener("input",(function(){fw.textContent=this.value,mw=this.value,console.log(mw)})),document.addEventListener("DOMContentLoaded",(function(){let e=document.getElementById("pointImage");e.addEventListener("click",(function(){let t=yV.image;if(yV.CAM||"RWIS"!=yV.type)e.src=t,yV.CAM=!1;else{let i=`https://storage.googleapis.com/rwis_cam_images/images/${t.split("/").pop()}_gradcam.png`;e.src=i,yV.CAM=!0}}))}));const yw="https://index-xmctotgaqq-uc.a.run.app";function vw(e,t,i){const n=yw+i,r=function(e,t){const i=[];let n={};for(const[r,s]of Object.entries(e))n[r]=s,Object.keys(n).length===t&&(i.push(n),n={});return Object.keys(n).length>0&&i.push(n),i}(e,t).map((e=>fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(!e.ok)throw new Error("Network response was not ok "+e.statusText);return e.json()}))));return console.log("\n# of requests to backend: "+Object.keys(r).length),Promise.all(r)}async function xw(e,t){const i=function(e,t){let i=[];for(const t of e){const e=t.data,l=Aw(t.id),c=e.Position.latitude,u=e.Position.longitude,h={Undefined:e.Undefined,Bare:e.Bare,Full:e.Full,Partly:e.Partly},d=(n=e.Undefined,r=e.Bare,s=e.Full,o=e.Partly,a=void 0,(a=Math.max(n,r,s,o))===n?"Undefined":a===r?"Bare":a===s?"Full":a===o?"Partly":void 0),p=e.IMAGE_URL,f=e.Date.seconds;i.push({id:l,type:"AVL",lat:c,lng:u,class:h,classification:d,url:p,timestamp:f})}var n,r,s,o,a;const l={};for(const e of t){const t=e.data,i=Aw(e.id).substring(0,8);if(!(i in l)){const e={id:i,type:"RWIS",lat:t.Coordinates.latitude,lng:t.Coordinates.longitude,angles:{}};l[i]=e}}for(const e of t){const t=e.data,i=Aw(e.id).substring(0,8),n={Undefined:t["Class 4"],Bare:t["Class 1"],Partly:t["Class 2"],Full:t["Class 3"]},r=1===(c=t["Predicted Class"])?"Bare":2===c?"Partly":3===c?"Full":4===c?"Undefined":void 0,s=t.Image,o=t.Date.seconds,a=t.GradCam,u=Aw(e.id).split("-")[2],h={angle:u,timestamp:o,url:s,class:n,classification:r,gradcam:a};u in l[i].angles?l[i].angles[u].timestamp<o&&(l[i].angles[u]=h):l[i].angles[u]=h}var c;for(const e in l){const t=l[e];let n,r=0;for(const e in t.angles){let i=t.angles[e].timestamp;i>r&&(n=e,r=i)}t.classification=t.angles[n].classification,t.timestamp=r,t.recentangle=n,i.push(t)}return aw.parse(i,{Point:["lat","lng"]})}(e,t);cV(i),Ew&&(console.log("\n\nINTERPOLATION GEOJSON: "),console.log(aV),Tw=await nw(aV),uV(Tw)),Sw&&(console.log("\n\nINTERPOLATION GEOJSON: "),console.log(ww),Tw=await async function(e){if(console.log("Interpolating current data with NIK method..."),!e)return;tw();let t=await ew("./assets/I35I80_Lanes_100ft.geojson"),i=e;i=rw(e,t,.05);const n=await sw(t,i,30);return console.log("Interpolation complete."),iw(),n}(ww),uV(Tw))}async function bw(e){console.time("GET Request Duration "+e);const t=await fetch(yw,{method:"GET",headers:{"Content-Type":"application/json"}}),i=await t.json();console.log("Backend triggered successfully:",i),console.timeEnd("GET Request Duration "+e)}let ww;document.getElementById("query-form").addEventListener("submit",(async function(e){let t,i;if(e.preventDefault(),gw(),!dw){const e=new FormData(this);t=e.get("calendar"),console.log("TEST 1:"+t),t=cn.fromISO(t,{zone:"America/Chicago"}).setZone("America/Chicago").toISO(),console.log("QUERY DATE: "+t),i=e.get("window");const n=document.getElementById("submit-query");n.disabled=!0,n.style.cursor="not-allowed",setTimeout((()=>{n.disabled=!1,n.style.cursor="pointer",console.log("Button Available")}),160*i),console.log("\n\nTEST DATE: "+t+"\nTEST WINDOW: "+i+"\n\n"),await _w(t,i)}})),document.addEventListener("DOMContentLoaded",(async e=>{console.log("Webpage has been opened, spinning up RWIS and AVL backend containers");const t=[];for(let e=0;e<5;e++)t.push(bw(e));await Promise.all(t)})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("nik-options");fetch("../docs/assets/generatedNIKInterpolations/").then((e=>e.text())).then((t=>{const i=(new DOMParser).parseFromString(t,"text/html").querySelectorAll("a");Array.from(i).map((e=>e.href.split("/").pop())).filter((e=>e.endsWith(".geojson"))).forEach((t=>{const i=document.createElement("option");i.value=t.split(".")[0],i.textContent=t.split(".")[0].replaceAll("_","-"),e.appendChild(i)}))})).catch((e=>console.error("Error:",e)))})),document.getElementById("nik-options").addEventListener("change",(async function(){var e=this.value;console.log("Selected NIK interpolation: ",e);try{const t=await fetch(`./assets/generatedNIKInterpolations/${e}.geojson`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);ww=await t.json(),console.log("Loaded GeoJSON file:",e)}catch(e){console.error("Error loading GeoJSON file:",e)}let t=function(e){const[t,i,n,r]=e.split("_");return cn.fromObject({year:parseInt(t),month:parseInt(i),day:parseInt(n),hour:parseInt(r),minute:30,second:0,millisecond:0},{zone:"America/Chicago"}).toISO()}(e);console.log("\n\nTEST DATE: "+t+"\nTEST WINDOW: 30\n\n"),await _w(t,30)}));let Sw=!1;document.getElementById("nik-interpolation").addEventListener("click",(async e=>{e.preventDefault(),Ew=!1,console.log("NIK Interpolation Enabled"),function(){const e=document.querySelectorAll(".nik-remove"),t=document.querySelectorAll(".nik-add");e.forEach((e=>{e.style.display="none"})),t.forEach((e=>{e.style.display="flex"}))}(),Sw=!0}));let Tw,Ew=!1;document.getElementById("interpolation").addEventListener("click",(async e=>{e.preventDefault(),Sw=!1,console.log("NN Interpolation Enabled"),Tw=await nw(aV),uV(Tw),Ew=!0}));let Mw=!1;function Iw(e,t){let i=1*t;const n=new Date(e),r=new Date(n.getTime()-6e4*i),s=new Date(n.getTime()+6e4*i);return console.log("UTC start: "+r.toISOString()+"\nUTC end: "+s.toISOString()),[r,s]}function Aw(e){return e.replace(/_.*/,"")}setInterval((async function(){if(Mw)console.log("Previous realtime update is already in progress, skipping this interval");else{if(Mw=!0,dw){console.log("\n\nPerforming realtime update...");let e=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});const t=new FormData(document.getElementById("query-form"));let i=cn.now().setZone("America/Chicago");i=i.toISO(),console.log("Realtime Date: "+i);const n=t.get("window");await _w(i,n),console.log("Window:",mw),console.log(`Latest map update: ${e}`)}else console.log("Not in realtime state, not updating map");Mw=!1}}),4e4);class Cw{constructor(e,t=0){this.date=new Date(e),this.date.setHours(this.date.getHours()+t)}get year(){return this.date.getUTCFullYear()}get month(){return String(this.date.getUTCMonth()+1).padStart(2,"0")}get day(){return String(this.date.getUTCDate()).padStart(2,"0")}get hour(){return String(this.date.getUTCHours()).padStart(2,"0")}get minute(){return String(this.date.getUTCMinutes()).padStart(2,"0")}}async function Pw(e,t,i){const n=new Cw(t),r=new Cw(i),s=`https://mesonet.agron.iastate.edu/archive/data/${n.year}/${n.month}/${n.day}/camera/${e}`,o=await async function(e){let t=[];try{const i=await fetch(e),n=await i.text();(new DOMParser).parseFromString(n,"text/html").querySelectorAll("a").forEach((i=>{const n=i.getAttribute("href");n.startsWith("IDOT")&&n.endsWith(".jpg")&&t.push(e+"/"+n)}))}catch(e){console.error("Error fetching or parsing the URL:",e)}return t}(s);return function(e,t,i){let n=[];for(const r of e){const e=r.lastIndexOf("_")+1,s=r.lastIndexOf(".");kw(r.substring(e,s).slice(-4),t,i)&&n.push(r)}return n}(o,n,r)}function kw(e,t,i){const n=parseInt(e.slice(0,2),10),r=parseInt(e.slice(-2),10),s=parseInt(t.hour,10),o=parseInt(t.minute,10),a=parseInt(i.hour,10),l=parseInt(i.minute,10),c=60*n+r;return c>=60*s+o&&c<=60*a+l}function Rw(e){return e+.5|0}const Lw=(e,t,i)=>Math.max(Math.min(e,i),t);function Dw(e){return Lw(Rw(2.55*e),0,255)}function Ow(e){return Lw(Rw(255*e),0,255)}function Nw(e){return Lw(Rw(e/2.55)/100,0,1)}function zw(e){return Lw(Rw(100*e),0,100)}const Fw={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Bw=[..."0123456789ABCDEF"],Uw=e=>Bw[15&e],Vw=e=>Bw[(240&e)>>4]+Bw[15&e],jw=e=>(240&e)>>4==(15&e);const Gw=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Hw(e,t,i){const n=t*Math.min(i,1-i),r=(t,r=(t+e/30)%12)=>i-n*Math.max(Math.min(r-3,9-r,1),-1);return[r(0),r(8),r(4)]}function Ww(e,t,i){const n=(n,r=(n+e/60)%6)=>i-i*t*Math.max(Math.min(r,4-r,1),0);return[n(5),n(3),n(1)]}function qw(e,t,i){const n=Hw(e,1,.5);let r;for(t+i>1&&(r=1/(t+i),t*=r,i*=r),r=0;r<3;r++)n[r]*=1-t-i,n[r]+=t;return n}function $w(e){const t=e.r/255,i=e.g/255,n=e.b/255,r=Math.max(t,i,n),s=Math.min(t,i,n),o=(r+s)/2;let a,l,c;return r!==s&&(c=r-s,l=o>.5?c/(2-r-s):c/(r+s),a=function(e,t,i,n,r){return e===r?(t-i)/n+(t<i?6:0):t===r?(i-e)/n+2:(e-t)/n+4}(t,i,n,c,r),a=60*a+.5),[0|a,l||0,o]}function Zw(e,t,i,n){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,i,n)).map(Ow)}function Xw(e,t,i){return Zw(Hw,e,t,i)}function Yw(e){return(e%360+360)%360}const Kw={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Jw={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let Qw;const eS=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,tS=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055,iS=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function nS(e,t,i){if(e){let n=$w(e);n[t]=Math.max(0,Math.min(n[t]+n[t]*i,0===t?360:1)),n=Xw(n),e.r=n[0],e.g=n[1],e.b=n[2]}}function rS(e,t){return e?Object.assign(t||{},e):e}function sS(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=Ow(e[3]))):(t=rS(e,{r:0,g:0,b:0,a:1})).a=Ow(t.a),t}function oS(e){return"r"===e.charAt(0)?function(e){const t=eS.exec(e);let i,n,r,s=255;if(t){if(t[7]!==i){const e=+t[7];s=t[8]?Dw(e):Lw(255*e,0,255)}return i=+t[1],n=+t[3],r=+t[5],i=255&(t[2]?Dw(i):Lw(i,0,255)),n=255&(t[4]?Dw(n):Lw(n,0,255)),r=255&(t[6]?Dw(r):Lw(r,0,255)),{r:i,g:n,b:r,a:s}}}(e):function(e){const t=Gw.exec(e);let i,n=255;if(!t)return;t[5]!==i&&(n=t[6]?Dw(+t[5]):Ow(+t[5]));const r=Yw(+t[2]),s=+t[3]/100,o=+t[4]/100;return i="hwb"===t[1]?function(e,t,i){return Zw(qw,e,t,i)}(r,s,o):"hsv"===t[1]?function(e,t,i){return Zw(Ww,e,t,i)}(r,s,o):Xw(r,s,o),{r:i[0],g:i[1],b:i[2],a:n}}(e)}class aS{constructor(e){if(e instanceof aS)return e;const t=typeof e;let i;var n,r,s;"object"===t?i=sS(e):"string"===t&&(s=(n=e).length,"#"===n[0]&&(4===s||5===s?r={r:255&17*Fw[n[1]],g:255&17*Fw[n[2]],b:255&17*Fw[n[3]],a:5===s?17*Fw[n[4]]:255}:7!==s&&9!==s||(r={r:Fw[n[1]]<<4|Fw[n[2]],g:Fw[n[3]]<<4|Fw[n[4]],b:Fw[n[5]]<<4|Fw[n[6]],a:9===s?Fw[n[7]]<<4|Fw[n[8]]:255})),i=r||function(e){Qw||(Qw=function(){const e={},t=Object.keys(Jw),i=Object.keys(Kw);let n,r,s,o,a;for(n=0;n<t.length;n++){for(o=a=t[n],r=0;r<i.length;r++)s=i[r],a=a.replace(s,Kw[s]);s=parseInt(Jw[o],16),e[a]=[s>>16&255,s>>8&255,255&s]}return e}(),Qw.transparent=[0,0,0,0]);const t=Qw[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:4===t.length?t[3]:255}}(e)||oS(e)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var e=rS(this._rgb);return e&&(e.a=Nw(e.a)),e}set rgb(e){this._rgb=sS(e)}rgbString(){return this._valid?function(e){return e&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${Nw(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`)}(this._rgb):void 0}hexString(){return this._valid?function(e){var t=(e=>jw(e.r)&&jw(e.g)&&jw(e.b)&&jw(e.a))(e)?Uw:Vw;return e?"#"+t(e.r)+t(e.g)+t(e.b)+((e,t)=>e<255?t(e):"")(e.a,t):void 0}(this._rgb):void 0}hslString(){return this._valid?function(e){if(!e)return;const t=$w(e),i=t[0],n=zw(t[1]),r=zw(t[2]);return e.a<255?`hsla(${i}, ${n}%, ${r}%, ${Nw(e.a)})`:`hsl(${i}, ${n}%, ${r}%)`}(this._rgb):void 0}mix(e,t){if(e){const i=this.rgb,n=e.rgb;let r;const s=t===r?.5:t,o=2*s-1,a=i.a-n.a,l=((o*a==-1?o:(o+a)/(1+o*a))+1)/2;r=1-l,i.r=255&l*i.r+r*n.r+.5,i.g=255&l*i.g+r*n.g+.5,i.b=255&l*i.b+r*n.b+.5,i.a=s*i.a+(1-s)*n.a,this.rgb=i}return this}interpolate(e,t){return e&&(this._rgb=function(e,t,i){const n=iS(Nw(e.r)),r=iS(Nw(e.g)),s=iS(Nw(e.b));return{r:Ow(tS(n+i*(iS(Nw(t.r))-n))),g:Ow(tS(r+i*(iS(Nw(t.g))-r))),b:Ow(tS(s+i*(iS(Nw(t.b))-s))),a:e.a+i*(t.a-e.a)}}(this._rgb,e._rgb,t)),this}clone(){return new aS(this.rgb)}alpha(e){return this._rgb.a=Ow(e),this}clearer(e){return this._rgb.a*=1-e,this}greyscale(){const e=this._rgb,t=Rw(.3*e.r+.59*e.g+.11*e.b);return e.r=e.g=e.b=t,this}opaquer(e){return this._rgb.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return nS(this._rgb,2,e),this}darken(e){return nS(this._rgb,2,-e),this}saturate(e){return nS(this._rgb,1,e),this}desaturate(e){return nS(this._rgb,1,-e),this}rotate(e){return function(e,t){var i=$w(e);i[0]=Yw(i[0]+t),i=Xw(i),e.r=i[0],e.g=i[1],e.b=i[2]}(this._rgb,e),this}}function lS(){}const cS=(()=>{let e=0;return()=>e++})();function uS(e){return null==e}function hS(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return"[object"===t.slice(0,7)&&"Array]"===t.slice(-6)}function dS(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function pS(e){return("number"==typeof e||e instanceof Number)&&isFinite(+e)}function fS(e,t){return pS(e)?e:t}function mS(e,t){return void 0===e?t:e}const gS=(e,t)=>"string"==typeof e&&e.endsWith("%")?parseFloat(e)/100*t:+e;function _S(e,t,i){if(e&&"function"==typeof e.call)return e.apply(i,t)}function yS(e,t,i,n){let r,s,o;if(hS(e))if(s=e.length,n)for(r=s-1;r>=0;r--)t.call(i,e[r],r);else for(r=0;r<s;r++)t.call(i,e[r],r);else if(dS(e))for(o=Object.keys(e),s=o.length,r=0;r<s;r++)t.call(i,e[o[r]],o[r])}function vS(e,t){let i,n,r,s;if(!e||!t||e.length!==t.length)return!1;for(i=0,n=e.length;i<n;++i)if(r=e[i],s=t[i],r.datasetIndex!==s.datasetIndex||r.index!==s.index)return!1;return!0}function xS(e){if(hS(e))return e.map(xS);if(dS(e)){const t=Object.create(null),i=Object.keys(e),n=i.length;let r=0;for(;r<n;++r)t[i[r]]=xS(e[i[r]]);return t}return e}function bS(e){return-1===["__proto__","prototype","constructor"].indexOf(e)}function wS(e,t,i,n){if(!bS(e))return;const r=t[e],s=i[e];dS(r)&&dS(s)?SS(r,s,n):t[e]=xS(s)}function SS(e,t,i){const n=hS(t)?t:[t],r=n.length;if(!dS(e))return e;const s=(i=i||{}).merger||wS;let o;for(let t=0;t<r;++t){if(o=n[t],!dS(o))continue;const r=Object.keys(o);for(let t=0,n=r.length;t<n;++t)s(r[t],e,o,i)}return e}function TS(e,t){return SS(e,t,{merger:ES})}function ES(e,t,i){if(!bS(e))return;const n=t[e],r=i[e];dS(n)&&dS(r)?TS(n,r):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=xS(r))}const MS={"":e=>e,x:e=>e.x,y:e=>e.y};function IS(e,t){const i=MS[t]||(MS[t]=function(e){const t=function(e){const t=e.split("."),i=[];let n="";for(const e of t)n+=e,n.endsWith("\\")?n=n.slice(0,-1)+".":(i.push(n),n="");return i}(e);return e=>{for(const i of t){if(""===i)break;e=e&&e[i]}return e}}(t));return i(e)}function AS(e){return e.charAt(0).toUpperCase()+e.slice(1)}const CS=e=>void 0!==e,PS=e=>"function"==typeof e,kS=(e,t)=>{if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0},RS=Math.PI,LS=2*RS,DS=LS+RS,OS=Number.POSITIVE_INFINITY,NS=RS/180,zS=RS/2,FS=RS/4,BS=2*RS/3,US=Math.log10,VS=Math.sign;function jS(e,t,i){return Math.abs(e-t)<i}function GS(e){const t=Math.round(e);e=jS(e,t,e/1e3)?t:e;const i=Math.pow(10,Math.floor(US(e))),n=e/i;return(n<=1?1:n<=2?2:n<=5?5:10)*i}function HS(e){return!isNaN(parseFloat(e))&&isFinite(e)}function WS(e,t,i){let n,r,s;for(n=0,r=e.length;n<r;n++)s=e[n][i],isNaN(s)||(t.min=Math.min(t.min,s),t.max=Math.max(t.max,s))}function qS(e){return e*(RS/180)}function $S(e){return e*(180/RS)}function ZS(e){if(!pS(e))return;let t=1,i=0;for(;Math.round(e*t)/t!==e;)t*=10,i++;return i}function XS(e,t){const i=t.x-e.x,n=t.y-e.y,r=Math.sqrt(i*i+n*n);let s=Math.atan2(n,i);return s<-.5*RS&&(s+=LS),{angle:s,distance:r}}function YS(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function KS(e,t){return(e-t+DS)%LS-RS}function JS(e){return(e%LS+LS)%LS}function QS(e,t,i,n){const r=JS(e),s=JS(t),o=JS(i),a=JS(s-r),l=JS(o-r),c=JS(r-s),u=JS(r-o);return r===s||r===o||n&&s===o||a>l&&c<u}function eT(e,t,i){return Math.max(t,Math.min(i,e))}function tT(e,t,i,n=1e-6){return e>=Math.min(t,i)-n&&e<=Math.max(t,i)+n}function iT(e,t,i){i=i||(i=>e[i]<t);let n,r=e.length-1,s=0;for(;r-s>1;)n=s+r>>1,i(n)?s=n:r=n;return{lo:s,hi:r}}const nT=(e,t,i,n)=>iT(e,i,n?n=>{const r=e[n][t];return r<i||r===i&&e[n+1][t]===i}:n=>e[n][t]<i),rT=(e,t,i)=>iT(e,i,(n=>e[n][t]>=i)),sT=["push","pop","shift","splice","unshift"];function oT(e,t){const i=e._chartjs;if(!i)return;const n=i.listeners,r=n.indexOf(t);-1!==r&&n.splice(r,1),n.length>0||(sT.forEach((t=>{delete e[t]})),delete e._chartjs)}function aT(e){const t=new Set(e);return t.size===e.length?e:Array.from(t)}const lT="undefined"==typeof window?function(e){return e()}:window.requestAnimationFrame;function cT(e,t){let i=[],n=!1;return function(...r){i=r,n||(n=!0,lT.call(window,(()=>{n=!1,e.apply(t,i)})))}}const uT=e=>"start"===e?"left":"end"===e?"right":"center",hT=(e,t,i)=>"start"===e?t:"end"===e?i:(t+i)/2;function dT(e,t,i){const n=t.length;let r=0,s=n;if(e._sorted){const{iScale:o,_parsed:a}=e,l=o.axis,{min:c,max:u,minDefined:h,maxDefined:d}=o.getUserBounds();h&&(r=eT(Math.min(nT(a,l,c).lo,i?n:nT(t,l,o.getPixelForValue(c)).lo),0,n-1)),s=d?eT(Math.max(nT(a,o.axis,u,!0).hi+1,i?0:nT(t,l,o.getPixelForValue(u),!0).hi+1),r,n)-r:n-r}return{start:r,count:s}}function pT(e){const{xScale:t,yScale:i,_scaleRanges:n}=e,r={xmin:t.min,xmax:t.max,ymin:i.min,ymax:i.max};if(!n)return e._scaleRanges=r,!0;const s=n.xmin!==t.min||n.xmax!==t.max||n.ymin!==i.min||n.ymax!==i.max;return Object.assign(n,r),s}const fT=e=>0===e||1===e,mT=(e,t,i)=>-Math.pow(2,10*(e-=1))*Math.sin((e-t)*LS/i),gT=(e,t,i)=>Math.pow(2,-10*e)*Math.sin((e-t)*LS/i)+1,_T={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>1-Math.cos(e*zS),easeOutSine:e=>Math.sin(e*zS),easeInOutSine:e=>-.5*(Math.cos(RS*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>fT(e)?e:e<.5?.5*Math.pow(2,10*(2*e-1)):.5*(2-Math.pow(2,-10*(2*e-1))),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>fT(e)?e:mT(e,.075,.3),easeOutElastic:e=>fT(e)?e:gT(e,.075,.3),easeInOutElastic(e){const t=.1125;return fT(e)?e:e<.5?.5*mT(2*e,t,.45):.5+.5*gT(2*e-1,t,.45)},easeInBack(e){const t=1.70158;return e*e*((t+1)*e-t)},easeOutBack(e){const t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},easeInBounce:e=>1-_T.easeOutBounce(1-e),easeOutBounce(e){const t=7.5625,i=2.75;return e<1/i?t*e*e:e<2/i?t*(e-=1.5/i)*e+.75:e<2.5/i?t*(e-=2.25/i)*e+.9375:t*(e-=2.625/i)*e+.984375},easeInOutBounce:e=>e<.5?.5*_T.easeInBounce(2*e):.5*_T.easeOutBounce(2*e-1)+.5};function yT(e){if(e&&"object"==typeof e){const t=e.toString();return"[object CanvasPattern]"===t||"[object CanvasGradient]"===t}return!1}function vT(e){return yT(e)?e:new aS(e)}function xT(e){return yT(e)?e:new aS(e).saturate(.5).darken(.1).hexString()}const bT=["x","y","borderWidth","radius","tension"],wT=["color","borderColor","backgroundColor"],ST=new Map;function TT(e,t,i){return function(e,t){t=t||{};const i=e+JSON.stringify(t);let n=ST.get(i);return n||(n=new Intl.NumberFormat(e,t),ST.set(i,n)),n}(t,i).format(e)}const ET={values:e=>hS(e)?e:""+e,numeric(e,t,i){if(0===e)return"0";const n=this.chart.options.locale;let r,s=e;if(i.length>1){const t=Math.max(Math.abs(i[0].value),Math.abs(i[i.length-1].value));(t<1e-4||t>1e15)&&(r="scientific"),s=function(e,t){let i=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(i)>=1&&e!==Math.floor(e)&&(i=e-Math.floor(e)),i}(e,i)}const o=US(Math.abs(s)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:r,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),TT(e,n,l)},logarithmic(e,t,i){if(0===e)return"0";const n=i[t].significand||e/Math.pow(10,Math.floor(US(e)));return[1,2,3,5,10,15].includes(n)||t>.8*i.length?ET.numeric.call(this,e,t,i):""}};var MT={formatters:ET};const IT=Object.create(null),AT=Object.create(null);function CT(e,t){if(!t)return e;const i=t.split(".");for(let t=0,n=i.length;t<n;++t){const n=i[t];e=e[n]||(e[n]=Object.create(null))}return e}function PT(e,t,i){return"string"==typeof t?SS(CT(e,t),i):SS(CT(e,""),t)}class kT{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=e=>e.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(e,t)=>xT(t.backgroundColor),this.hoverBorderColor=(e,t)=>xT(t.borderColor),this.hoverColor=(e,t)=>xT(t.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return PT(this,e,t)}get(e){return CT(this,e)}describe(e,t){return PT(AT,e,t)}override(e,t){return PT(IT,e,t)}route(e,t,i,n){const r=CT(this,e),s=CT(this,i),o="_"+t;Object.defineProperties(r,{[o]:{value:r[t],writable:!0},[t]:{enumerable:!0,get(){const e=this[o],t=s[n];return dS(e)?Object.assign({},t,e):mS(e,t)},set(e){this[o]=e}}})}apply(e){e.forEach((e=>e(this)))}}var RT=new kT({_scriptable:e=>!e.startsWith("on"),_indexable:e=>"events"!==e,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(e){e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>"onProgress"!==e&&"onComplete"!==e&&"fn"!==e}),e.set("animations",{colors:{type:"color",properties:wT},numbers:{type:"number",properties:bT}}),e.describe("animations",{_fallback:"animation"}),e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>0|e}}}})},function(e){e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(e){e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:MT.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),e.route("scale.ticks","color","","color"),e.route("scale.grid","color","","borderColor"),e.route("scale.border","color","","borderColor"),e.route("scale.title","color","","color"),e.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&"callback"!==e&&"parser"!==e,_indexable:e=>"borderDash"!==e&&"tickBorderDash"!==e&&"dash"!==e}),e.describe("scales",{_fallback:"scale"}),e.describe("scale.ticks",{_scriptable:e=>"backdropPadding"!==e&&"callback"!==e,_indexable:e=>"backdropPadding"!==e})}]);function LT(e,t,i,n,r){let s=t[r];return s||(s=t[r]=e.measureText(r).width,i.push(r)),s>n&&(n=s),n}function DT(e,t,i,n){let r=(n=n||{}).data=n.data||{},s=n.garbageCollect=n.garbageCollect||[];n.font!==t&&(r=n.data={},s=n.garbageCollect=[],n.font=t),e.save(),e.font=t;let o=0;const a=i.length;let l,c,u,h,d;for(l=0;l<a;l++)if(h=i[l],null==h||hS(h)){if(hS(h))for(c=0,u=h.length;c<u;c++)d=h[c],null==d||hS(d)||(o=LT(e,r,s,o,d))}else o=LT(e,r,s,o,h);e.restore();const p=s.length/2;if(p>i.length){for(l=0;l<p;l++)delete r[s[l]];s.splice(0,p)}return o}function OT(e,t,i){const n=e.currentDevicePixelRatio,r=0!==i?Math.max(i/2,.5):0;return Math.round((t-r)*n)/n+r}function NT(e,t){(t=t||e.getContext("2d")).save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore()}function zT(e,t,i,n){FT(e,t,i,n,null)}function FT(e,t,i,n,r){let s,o,a,l,c,u,h,d;const p=t.pointStyle,f=t.rotation,m=t.radius;let g=(f||0)*NS;if(p&&"object"==typeof p&&(s=p.toString(),"[object HTMLImageElement]"===s||"[object HTMLCanvasElement]"===s))return e.save(),e.translate(i,n),e.rotate(g),e.drawImage(p,-p.width/2,-p.height/2,p.width,p.height),void e.restore();if(!(isNaN(m)||m<=0)){switch(e.beginPath(),p){default:r?e.ellipse(i,n,r/2,m,0,0,LS):e.arc(i,n,m,0,LS),e.closePath();break;case"triangle":u=r?r/2:m,e.moveTo(i+Math.sin(g)*u,n-Math.cos(g)*m),g+=BS,e.lineTo(i+Math.sin(g)*u,n-Math.cos(g)*m),g+=BS,e.lineTo(i+Math.sin(g)*u,n-Math.cos(g)*m),e.closePath();break;case"rectRounded":c=.516*m,l=m-c,o=Math.cos(g+FS)*l,h=Math.cos(g+FS)*(r?r/2-c:l),a=Math.sin(g+FS)*l,d=Math.sin(g+FS)*(r?r/2-c:l),e.arc(i-h,n-a,c,g-RS,g-zS),e.arc(i+d,n-o,c,g-zS,g),e.arc(i+h,n+a,c,g,g+zS),e.arc(i-d,n+o,c,g+zS,g+RS),e.closePath();break;case"rect":if(!f){l=Math.SQRT1_2*m,u=r?r/2:l,e.rect(i-u,n-l,2*u,2*l);break}g+=FS;case"rectRot":h=Math.cos(g)*(r?r/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),e.moveTo(i-h,n-a),e.lineTo(i+d,n-o),e.lineTo(i+h,n+a),e.lineTo(i-d,n+o),e.closePath();break;case"crossRot":g+=FS;case"cross":h=Math.cos(g)*(r?r/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),e.moveTo(i-h,n-a),e.lineTo(i+h,n+a),e.moveTo(i+d,n-o),e.lineTo(i-d,n+o);break;case"star":h=Math.cos(g)*(r?r/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),e.moveTo(i-h,n-a),e.lineTo(i+h,n+a),e.moveTo(i+d,n-o),e.lineTo(i-d,n+o),g+=FS,h=Math.cos(g)*(r?r/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),e.moveTo(i-h,n-a),e.lineTo(i+h,n+a),e.moveTo(i+d,n-o),e.lineTo(i-d,n+o);break;case"line":o=r?r/2:Math.cos(g)*m,a=Math.sin(g)*m,e.moveTo(i-o,n-a),e.lineTo(i+o,n+a);break;case"dash":e.moveTo(i,n),e.lineTo(i+Math.cos(g)*(r?r/2:m),n+Math.sin(g)*m);break;case!1:e.closePath()}e.fill(),t.borderWidth>0&&e.stroke()}}function BT(e,t,i){return i=i||.5,!t||e&&e.x>t.left-i&&e.x<t.right+i&&e.y>t.top-i&&e.y<t.bottom+i}function UT(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function VT(e){e.restore()}function jT(e,t,i,n,r){if(!t)return e.lineTo(i.x,i.y);if("middle"===r){const n=(t.x+i.x)/2;e.lineTo(n,t.y),e.lineTo(n,i.y)}else"after"===r!=!!n?e.lineTo(t.x,i.y):e.lineTo(i.x,t.y);e.lineTo(i.x,i.y)}function GT(e,t,i,n){if(!t)return e.lineTo(i.x,i.y);e.bezierCurveTo(n?t.cp1x:t.cp2x,n?t.cp1y:t.cp2y,n?i.cp2x:i.cp1x,n?i.cp2y:i.cp1y,i.x,i.y)}function HT(e,t,i,n,r){if(r.strikethrough||r.underline){const s=e.measureText(n),o=t-s.actualBoundingBoxLeft,a=t+s.actualBoundingBoxRight,l=i-s.actualBoundingBoxAscent,c=i+s.actualBoundingBoxDescent,u=r.strikethrough?(l+c)/2:c;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=r.decorationWidth||2,e.moveTo(o,u),e.lineTo(a,u),e.stroke()}}function WT(e,t){const i=e.fillStyle;e.fillStyle=t.color,e.fillRect(t.left,t.top,t.width,t.height),e.fillStyle=i}function qT(e,t,i,n,r,s={}){const o=hS(t)?t:[t],a=s.strokeWidth>0&&""!==s.strokeColor;let l,c;for(e.save(),e.font=r.string,function(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),uS(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}(e,s),l=0;l<o.length;++l)c=o[l],s.backdrop&&WT(e,s.backdrop),a&&(s.strokeColor&&(e.strokeStyle=s.strokeColor),uS(s.strokeWidth)||(e.lineWidth=s.strokeWidth),e.strokeText(c,i,n,s.maxWidth)),e.fillText(c,i,n,s.maxWidth),HT(e,i,n,c,s),n+=Number(r.lineHeight);e.restore()}function $T(e,t){const{x:i,y:n,w:r,h:s,radius:o}=t;e.arc(i+o.topLeft,n+o.topLeft,o.topLeft,1.5*RS,RS,!0),e.lineTo(i,n+s-o.bottomLeft),e.arc(i+o.bottomLeft,n+s-o.bottomLeft,o.bottomLeft,RS,zS,!0),e.lineTo(i+r-o.bottomRight,n+s),e.arc(i+r-o.bottomRight,n+s-o.bottomRight,o.bottomRight,zS,0,!0),e.lineTo(i+r,n+o.topRight),e.arc(i+r-o.topRight,n+o.topRight,o.topRight,0,-zS,!0),e.lineTo(i+o.topLeft,n)}const ZT=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,XT=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function YT(e,t){const i=(""+e).match(ZT);if(!i||"normal"===i[1])return 1.2*t;switch(e=+i[2],i[3]){case"px":return e;case"%":e/=100}return t*e}const KT=e=>+e||0;function JT(e,t){const i={},n=dS(t),r=n?Object.keys(t):t,s=dS(e)?n?i=>mS(e[i],e[t[i]]):t=>e[t]:()=>e;for(const e of r)i[e]=KT(s(e));return i}function QT(e){return JT(e,{top:"y",right:"x",bottom:"y",left:"x"})}function eE(e){return JT(e,["topLeft","topRight","bottomLeft","bottomRight"])}function tE(e){const t=QT(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function iE(e,t){e=e||{},t=t||RT.font;let i=mS(e.size,t.size);"string"==typeof i&&(i=parseInt(i,10));let n=mS(e.style,t.style);n&&!(""+n).match(XT)&&(console.warn('Invalid font style specified: "'+n+'"'),n=void 0);const r={family:mS(e.family,t.family),lineHeight:YT(mS(e.lineHeight,t.lineHeight),i),size:i,style:n,weight:mS(e.weight,t.weight),string:""};return r.string=function(e){return!e||uS(e.size)||uS(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}(r),r}function nE(e,t,i,n){let r,s,o,a=!0;for(r=0,s=e.length;r<s;++r)if(o=e[r],void 0!==o&&(void 0!==t&&"function"==typeof o&&(o=o(t),a=!1),void 0!==i&&hS(o)&&(o=o[i%o.length],a=!1),void 0!==o))return n&&!a&&(n.cacheable=!1),o}function rE(e,t){return Object.assign(Object.create(e),t)}function sE(e,t=[""],i,n,r=(()=>e[0])){const s=i||e;void 0===n&&(n=gE("_fallback",e));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:s,_fallback:n,_getTarget:r,override:i=>sE([i,...e],t,s,n)};return new Proxy(o,{deleteProperty:(t,i)=>(delete t[i],delete t._keys,delete e[0][i],!0),get:(i,n)=>uE(i,n,(()=>function(e,t,i,n){let r;for(const s of t)if(r=gE(lE(s,e),i),void 0!==r)return cE(e,r)?fE(i,n,e,r):r}(n,t,e,i))),getOwnPropertyDescriptor:(e,t)=>Reflect.getOwnPropertyDescriptor(e._scopes[0],t),getPrototypeOf:()=>Reflect.getPrototypeOf(e[0]),has:(e,t)=>_E(e).includes(t),ownKeys:e=>_E(e),set(e,t,i){const n=e._storage||(e._storage=r());return e[t]=n[t]=i,delete e._keys,!0}})}function oE(e,t,i,n){const r={_cacheable:!1,_proxy:e,_context:t,_subProxy:i,_stack:new Set,_descriptors:aE(e,n),setContext:t=>oE(e,t,i,n),override:r=>oE(e.override(r),t,i,n)};return new Proxy(r,{deleteProperty:(t,i)=>(delete t[i],delete e[i],!0),get:(e,t,i)=>uE(e,t,(()=>function(e,t,i){const{_proxy:n,_context:r,_subProxy:s,_descriptors:o}=e;let a=n[t];return PS(a)&&o.isScriptable(t)&&(a=function(e,t,i,n){const{_proxy:r,_context:s,_subProxy:o,_stack:a}=i;if(a.has(e))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+e);a.add(e);let l=t(s,o||n);return a.delete(e),cE(e,l)&&(l=fE(r._scopes,r,e,l)),l}(t,a,e,i)),hS(a)&&a.length&&(a=function(e,t,i,n){const{_proxy:r,_context:s,_subProxy:o,_descriptors:a}=i;if(void 0!==s.index&&n(e))return t[s.index%t.length];if(dS(t[0])){const i=t,n=r._scopes.filter((e=>e!==i));t=[];for(const l of i){const i=fE(n,r,e,l);t.push(oE(i,s,o&&o[e],a))}}return t}(t,a,e,o.isIndexable)),cE(t,a)&&(a=oE(a,r,s&&s[t],o)),a}(e,t,i))),getOwnPropertyDescriptor:(t,i)=>t._descriptors.allKeys?Reflect.has(e,i)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,i),getPrototypeOf:()=>Reflect.getPrototypeOf(e),has:(t,i)=>Reflect.has(e,i),ownKeys:()=>Reflect.ownKeys(e),set:(t,i,n)=>(e[i]=n,delete t[i],!0)})}function aE(e,t={scriptable:!0,indexable:!0}){const{_scriptable:i=t.scriptable,_indexable:n=t.indexable,_allKeys:r=t.allKeys}=e;return{allKeys:r,scriptable:i,indexable:n,isScriptable:PS(i)?i:()=>i,isIndexable:PS(n)?n:()=>n}}const lE=(e,t)=>e?e+AS(t):t,cE=(e,t)=>dS(t)&&"adapters"!==e&&(null===Object.getPrototypeOf(t)||t.constructor===Object);function uE(e,t,i){if(Object.prototype.hasOwnProperty.call(e,t))return e[t];const n=i();return e[t]=n,n}function hE(e,t,i){return PS(e)?e(t,i):e}const dE=(e,t)=>!0===e?t:"string"==typeof e?IS(t,e):void 0;function pE(e,t,i,n,r){for(const s of t){const t=dE(i,s);if(t){e.add(t);const s=hE(t._fallback,i,r);if(void 0!==s&&s!==i&&s!==n)return s}else if(!1===t&&void 0!==n&&i!==n)return null}return!1}function fE(e,t,i,n){const r=t._rootScopes,s=hE(t._fallback,i,n),o=[...e,...r],a=new Set;a.add(n);let l=mE(a,o,i,s||i,n);return null!==l&&(void 0===s||s===i||(l=mE(a,o,s,l,n),null!==l))&&sE(Array.from(a),[""],r,s,(()=>function(e,t,i){const n=e._getTarget();t in n||(n[t]={});const r=n[t];return hS(r)&&dS(i)?i:r||{}}(t,i,n)))}function mE(e,t,i,n,r){for(;i;)i=pE(e,t,i,n,r);return i}function gE(e,t){for(const i of t){if(!i)continue;const t=i[e];if(void 0!==t)return t}}function _E(e){let t=e._keys;return t||(t=e._keys=function(e){const t=new Set;for(const i of e)for(const e of Object.keys(i).filter((e=>!e.startsWith("_"))))t.add(e);return Array.from(t)}(e._scopes)),t}function yE(e,t,i,n){const{iScale:r}=e,{key:s="r"}=this._parsing,o=new Array(n);let a,l,c,u;for(a=0,l=n;a<l;++a)c=a+i,u=t[c],o[a]={r:r.parse(IS(u,s),c)};return o}const vE=Number.EPSILON||1e-14,xE=(e,t)=>t<e.length&&!e[t].skip&&e[t],bE=e=>"x"===e?"y":"x";function wE(e,t,i,n){const r=e.skip?t:e,s=t,o=i.skip?t:i,a=YS(s,r),l=YS(o,s);let c=a/(a+l),u=l/(a+l);c=isNaN(c)?0:c,u=isNaN(u)?0:u;const h=n*c,d=n*u;return{previous:{x:s.x-h*(o.x-r.x),y:s.y-h*(o.y-r.y)},next:{x:s.x+d*(o.x-r.x),y:s.y+d*(o.y-r.y)}}}function SE(e,t,i){return Math.max(Math.min(e,i),t)}function TE(e,t,i,n,r){let s,o,a,l;if(t.spanGaps&&(e=e.filter((e=>!e.skip))),"monotone"===t.cubicInterpolationMode)!function(e,t="x"){const i=bE(t),n=e.length,r=Array(n).fill(0),s=Array(n);let o,a,l,c=xE(e,0);for(o=0;o<n;++o)if(a=l,l=c,c=xE(e,o+1),l){if(c){const e=c[t]-l[t];r[o]=0!==e?(c[i]-l[i])/e:0}s[o]=a?c?VS(r[o-1])!==VS(r[o])?0:(r[o-1]+r[o])/2:r[o-1]:r[o]}!function(e,t,i){const n=e.length;let r,s,o,a,l,c=xE(e,0);for(let u=0;u<n-1;++u)l=c,c=xE(e,u+1),l&&c&&(jS(t[u],0,vE)?i[u]=i[u+1]=0:(r=i[u]/t[u],s=i[u+1]/t[u],a=Math.pow(r,2)+Math.pow(s,2),a<=9||(o=3/Math.sqrt(a),i[u]=r*o*t[u],i[u+1]=s*o*t[u])))}(e,r,s),function(e,t,i="x"){const n=bE(i),r=e.length;let s,o,a,l=xE(e,0);for(let c=0;c<r;++c){if(o=a,a=l,l=xE(e,c+1),!a)continue;const r=a[i],u=a[n];o&&(s=(r-o[i])/3,a[`cp1${i}`]=r-s,a[`cp1${n}`]=u-s*t[c]),l&&(s=(l[i]-r)/3,a[`cp2${i}`]=r+s,a[`cp2${n}`]=u+s*t[c])}}(e,s,t)}(e,r);else{let i=n?e[e.length-1]:e[0];for(s=0,o=e.length;s<o;++s)a=e[s],l=wE(i,a,e[Math.min(s+1,o-(n?0:1))%o],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,i=a}t.capBezierPoints&&function(e,t){let i,n,r,s,o,a=BT(e[0],t);for(i=0,n=e.length;i<n;++i)o=s,s=a,a=i<n-1&&BT(e[i+1],t),s&&(r=e[i],o&&(r.cp1x=SE(r.cp1x,t.left,t.right),r.cp1y=SE(r.cp1y,t.top,t.bottom)),a&&(r.cp2x=SE(r.cp2x,t.left,t.right),r.cp2y=SE(r.cp2y,t.top,t.bottom)))}(e,i)}function EE(){return"undefined"!=typeof window&&"undefined"!=typeof document}function ME(e){let t=e.parentNode;return t&&"[object ShadowRoot]"===t.toString()&&(t=t.host),t}function IE(e,t,i){let n;return"string"==typeof e?(n=parseInt(e,10),-1!==e.indexOf("%")&&(n=n/100*t.parentNode[i])):n=e,n}const AE=e=>e.ownerDocument.defaultView.getComputedStyle(e,null),CE=["top","right","bottom","left"];function PE(e,t,i){const n={};i=i?"-"+i:"";for(let r=0;r<4;r++){const s=CE[r];n[s]=parseFloat(e[t+"-"+s+i])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}const kE=(e,t,i)=>(e>0||t>0)&&(!i||!i.shadowRoot);function RE(e,t){if("native"in e)return e;const{canvas:i,currentDevicePixelRatio:n}=t,r=AE(i),s="border-box"===r.boxSizing,o=PE(r,"padding"),a=PE(r,"border","width"),{x:l,y:c,box:u}=function(e,t){const i=e.touches,n=i&&i.length?i[0]:e,{offsetX:r,offsetY:s}=n;let o,a,l=!1;if(kE(r,s,e.target))o=r,a=s;else{const e=t.getBoundingClientRect();o=n.clientX-e.left,a=n.clientY-e.top,l=!0}return{x:o,y:a,box:l}}(e,i),h=o.left+(u&&a.left),d=o.top+(u&&a.top);let{width:p,height:f}=t;return s&&(p-=o.width+a.width,f-=o.height+a.height),{x:Math.round((l-h)/p*i.width/n),y:Math.round((c-d)/f*i.height/n)}}const LE=e=>Math.round(10*e)/10;function DE(e,t,i){const n=t||1,r=Math.floor(e.height*n),s=Math.floor(e.width*n);e.height=Math.floor(e.height),e.width=Math.floor(e.width);const o=e.canvas;return o.style&&(i||!o.style.height&&!o.style.width)&&(o.style.height=`${e.height}px`,o.style.width=`${e.width}px`),(e.currentDevicePixelRatio!==n||o.height!==r||o.width!==s)&&(e.currentDevicePixelRatio=n,o.height=r,o.width=s,e.ctx.setTransform(n,0,0,n,0,0),!0)}const OE=function(){let e=!1;try{const t={get passive(){return e=!0,!1}};EE()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch(e){}return e}();function NE(e,t){const i=function(e,t){return AE(e).getPropertyValue(t)}(e,t),n=i&&i.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}function zE(e,t,i,n){return{x:e.x+i*(t.x-e.x),y:e.y+i*(t.y-e.y)}}function FE(e,t,i,n){return{x:e.x+i*(t.x-e.x),y:"middle"===n?i<.5?e.y:t.y:"after"===n?i<1?e.y:t.y:i>0?t.y:e.y}}function BE(e,t,i,n){const r={x:e.cp2x,y:e.cp2y},s={x:t.cp1x,y:t.cp1y},o=zE(e,r,i),a=zE(r,s,i),l=zE(s,t,i),c=zE(o,a,i),u=zE(a,l,i);return zE(c,u,i)}function UE(e,t,i){return e?function(e,t){return{x:i=>e+e+t-i,setWidth(e){t=e},textAlign:e=>"center"===e?e:"right"===e?"left":"right",xPlus:(e,t)=>e-t,leftForLtr:(e,t)=>e-t}}(t,i):{x:e=>e,setWidth(e){},textAlign:e=>e,xPlus:(e,t)=>e+t,leftForLtr:(e,t)=>e}}function VE(e,t){let i,n;"ltr"!==t&&"rtl"!==t||(i=e.canvas.style,n=[i.getPropertyValue("direction"),i.getPropertyPriority("direction")],i.setProperty("direction",t,"important"),e.prevTextDirection=n)}function jE(e,t){void 0!==t&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function GE(e){return"angle"===e?{between:QS,compare:KS,normalize:JS}:{between:tT,compare:(e,t)=>e-t,normalize:e=>e}}function HE({start:e,end:t,count:i,loop:n,style:r}){return{start:e%i,end:t%i,loop:n&&(t-e+1)%i==0,style:r}}function WE(e,t,i){if(!i)return[e];const{property:n,start:r,end:s}=i,o=t.length,{compare:a,between:l,normalize:c}=GE(n),{start:u,end:h,loop:d,style:p}=function(e,t,i){const{property:n,start:r,end:s}=i,{between:o,normalize:a}=GE(n),l=t.length;let c,u,{start:h,end:d,loop:p}=e;if(p){for(h+=l,d+=l,c=0,u=l;c<u&&o(a(t[h%l][n]),r,s);++c)h--,d--;h%=l,d%=l}return d<h&&(d+=l),{start:h,end:d,loop:p,style:e.style}}(e,t,i),f=[];let m,g,_,y=!1,v=null;for(let e=u,i=u;e<=h;++e)g=t[e%o],g.skip||(m=c(g[n]),m!==_&&(y=l(m,r,s),null===v&&(y||l(r,_,m)&&0!==a(r,_))&&(v=0===a(m,r)?e:i),null!==v&&(!y||0===a(s,m)||l(s,_,m))&&(f.push(HE({start:v,end:e,loop:d,count:o,style:p})),v=null),i=e,_=m));return null!==v&&f.push(HE({start:v,end:h,loop:d,count:o,style:p})),f}function qE(e,t){const i=[],n=e.segments;for(let r=0;r<n.length;r++){const s=WE(n[r],e.points,t);s.length&&i.push(...s)}return i}function $E(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function ZE(e,t){if(!t)return!1;const i=[],n=function(e,t){return yT(t)?(i.includes(t)||i.push(t),i.indexOf(t)):t};return JSON.stringify(e,n)!==JSON.stringify(t,n)}class XE{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,i,n){const r=t.listeners[n],s=t.duration;r.forEach((n=>n({chart:e,initial:t.initial,numSteps:s,currentStep:Math.min(i-t.start,s)})))}_refresh(){this._request||(this._running=!0,this._request=lT.call(window,(()=>{this._update(),this._request=null,this._running&&this._refresh()})))}_update(e=Date.now()){let t=0;this._charts.forEach(((i,n)=>{if(!i.running||!i.items.length)return;const r=i.items;let s,o=r.length-1,a=!1;for(;o>=0;--o)s=r[o],s._active?(s._total>i.duration&&(i.duration=s._total),s.tick(e),a=!0):(r[o]=r[r.length-1],r.pop());a&&(n.draw(),this._notify(n,i,e,"progress")),r.length||(i.running=!1,this._notify(n,i,e,"complete"),i.initial=!1),t+=r.length})),this._lastDate=e,0===t&&(this._running=!1)}_getAnims(e){const t=this._charts;let i=t.get(e);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,i)),i}listen(e,t,i){this._getAnims(e).listeners[t].push(i)}add(e,t){t&&t.length&&this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce(((e,t)=>Math.max(e,t._duration)),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!!(t&&t.running&&t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const i=t.items;let n=i.length-1;for(;n>=0;--n)i[n].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var YE=new XE;const KE="transparent",JE={boolean:(e,t,i)=>i>.5?t:e,color(e,t,i){const n=vT(e||KE),r=n.valid&&vT(t||KE);return r&&r.valid?r.mix(n,i).hexString():t},number:(e,t,i)=>e+(t-e)*i};class QE{constructor(e,t,i,n){const r=t[i];n=nE([e.to,n,r,e.from]);const s=nE([e.from,r,n]);this._active=!0,this._fn=e.fn||JE[e.type||typeof s],this._easing=_T[e.easing]||_T.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=i,this._from=s,this._to=n,this._promises=void 0}active(){return this._active}update(e,t,i){if(this._active){this._notify(!1);const n=this._target[this._prop],r=i-this._start,s=this._duration-r;this._start=i,this._duration=Math.floor(Math.max(s,e.duration)),this._total+=r,this._loop=!!e.loop,this._to=nE([e.to,t,n,e.from]),this._from=nE([e.from,n,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,i=this._duration,n=this._prop,r=this._from,s=this._loop,o=this._to;let a;if(this._active=r!==o&&(s||t<i),!this._active)return this._target[n]=o,void this._notify(!0);t<0?this._target[n]=r:(a=t/i%2,a=s&&a>1?2-a:a,a=this._easing(Math.min(1,Math.max(0,a))),this._target[n]=this._fn(r,o,a))}wait(){const e=this._promises||(this._promises=[]);return new Promise(((t,i)=>{e.push({res:t,rej:i})}))}_notify(e){const t=e?"res":"rej",i=this._promises||[];for(let e=0;e<i.length;e++)i[e][t]()}}class eM{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!dS(e))return;const t=Object.keys(RT.animation),i=this._properties;Object.getOwnPropertyNames(e).forEach((n=>{const r=e[n];if(!dS(r))return;const s={};for(const e of t)s[e]=r[e];(hS(r.properties)&&r.properties||[n]).forEach((e=>{e!==n&&i.has(e)||i.set(e,s)}))}))}_animateOptions(e,t){const i=t.options,n=function(e,t){if(!t)return;let i=e.options;if(i)return i.$shared&&(e.options=i=Object.assign({},i,{$shared:!1,$animations:{}})),i;e.options=t}(e,i);if(!n)return[];const r=this._createAnimations(n,i);return i.$shared&&function(e,t){const i=[],n=Object.keys(t);for(let t=0;t<n.length;t++){const r=e[n[t]];r&&r.active()&&i.push(r.wait())}return Promise.all(i)}(e.options.$animations,i).then((()=>{e.options=i}),(()=>{})),r}_createAnimations(e,t){const i=this._properties,n=[],r=e.$animations||(e.$animations={}),s=Object.keys(t),o=Date.now();let a;for(a=s.length-1;a>=0;--a){const l=s[a];if("$"===l.charAt(0))continue;if("options"===l){n.push(...this._animateOptions(e,t));continue}const c=t[l];let u=r[l];const h=i.get(l);if(u){if(h&&u.active()){u.update(h,c,o);continue}u.cancel()}h&&h.duration?(r[l]=u=new QE(h,e,l,c),n.push(u)):e[l]=c}return n}update(e,t){if(0===this._properties.size)return void Object.assign(e,t);const i=this._createAnimations(e,t);return i.length?(YE.add(this._chart,i),!0):void 0}}function tM(e,t){const i=e&&e.options||{},n=i.reverse,r=void 0===i.min?t:0,s=void 0===i.max?t:0;return{start:n?s:r,end:n?r:s}}function iM(e,t){const i=[],n=e._getSortedDatasetMetas(t);let r,s;for(r=0,s=n.length;r<s;++r)i.push(n[r].index);return i}function nM(e,t,i,n={}){const r=e.keys,s="single"===n.mode;let o,a,l,c;if(null!==t){for(o=0,a=r.length;o<a;++o){if(l=+r[o],l===i){if(n.all)continue;break}c=e.values[l],pS(c)&&(s||0===t||VS(t)===VS(c))&&(t+=c)}return t}}function rM(e,t){const i=e&&e.options.stacked;return i||void 0===i&&void 0!==t.stack}function sM(e,t,i){const n=e[t]||(e[t]={});return n[i]||(n[i]={})}function oM(e,t,i,n){for(const r of t.getMatchingVisibleMetas(n).reverse()){const t=e[r.index];if(i&&t>0||!i&&t<0)return r.index}return null}function aM(e,t){const{chart:i,_cachedMeta:n}=e,r=i._stacks||(i._stacks={}),{iScale:s,vScale:o,index:a}=n,l=s.axis,c=o.axis,u=function(e,t,i){return`${e.id}.${t.id}.${i.stack||i.type}`}(s,o,n),h=t.length;let d;for(let e=0;e<h;++e){const i=t[e],{[l]:s,[c]:h}=i;d=(i._stacks||(i._stacks={}))[c]=sM(r,u,s),d[a]=h,d._top=oM(d,o,!0,n.type),d._bottom=oM(d,o,!1,n.type),(d._visualValues||(d._visualValues={}))[a]=h}}function lM(e,t){const i=e.scales;return Object.keys(i).filter((e=>i[e].axis===t)).shift()}function cM(e,t){const i=e.controller.index,n=e.vScale&&e.vScale.axis;if(n){t=t||e._parsed;for(const e of t){const t=e._stacks;if(!t||void 0===t[n]||void 0===t[n][i])return;delete t[n][i],void 0!==t[n]._visualValues&&void 0!==t[n]._visualValues[i]&&delete t[n]._visualValues[i]}}}const uM=e=>"reset"===e||"none"===e,hM=(e,t)=>t?e:Object.assign({},e);class dM{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=rM(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&cM(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,i=this.getDataset(),n=(e,t,i,n)=>"x"===e?t:"r"===e?n:i,r=t.xAxisID=mS(i.xAxisID,lM(e,"x")),s=t.yAxisID=mS(i.yAxisID,lM(e,"y")),o=t.rAxisID=mS(i.rAxisID,lM(e,"r")),a=t.indexAxis,l=t.iAxisID=n(a,r,s,o),c=t.vAxisID=n(a,s,r,o);t.xScale=this.getScaleForId(r),t.yScale=this.getScaleForId(s),t.rScale=this.getScaleForId(o),t.iScale=this.getScaleForId(l),t.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&oT(this._data,this),e._stacked&&cM(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),i=this._data;if(dS(t))this._data=function(e){const t=Object.keys(e),i=new Array(t.length);let n,r,s;for(n=0,r=t.length;n<r;++n)s=t[n],i[n]={x:s,y:e[s]};return i}(t);else if(i!==t){if(i){oT(i,this);const e=this._cachedMeta;cM(e),e._parsed=[]}t&&Object.isExtensible(t)&&(this,(n=t)._chartjs?n._chartjs.listeners.push(this):(Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[this]}}),sT.forEach((e=>{const t="_onData"+AS(e),i=n[e];Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value(...e){const r=i.apply(this,e);return n._chartjs.listeners.forEach((i=>{"function"==typeof i[t]&&i[t](...e)})),r}})})))),this._syncList=[],this._data=t}var n}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,i=this.getDataset();let n=!1;this._dataCheck();const r=t._stacked;t._stacked=rM(t.vScale,t),t.stack!==i.stack&&(n=!0,cM(t),t.stack=i.stack),this._resyncElements(e),(n||r!==t._stacked)&&aM(this,t._parsed)}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),i=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:i,_data:n}=this,{iScale:r,_stacked:s}=i,o=r.axis;let a,l,c,u=0===e&&t===n.length||i._sorted,h=e>0&&i._parsed[e-1];if(!1===this._parsing)i._parsed=n,i._sorted=!0,c=n;else{c=hS(n[e])?this.parseArrayData(i,n,e,t):dS(n[e])?this.parseObjectData(i,n,e,t):this.parsePrimitiveData(i,n,e,t);const r=()=>null===l[o]||h&&l[o]<h[o];for(a=0;a<t;++a)i._parsed[a+e]=l=c[a],u&&(r()&&(u=!1),h=l);i._sorted=u}s&&aM(this,c)}parsePrimitiveData(e,t,i,n){const{iScale:r,vScale:s}=e,o=r.axis,a=s.axis,l=r.getLabels(),c=r===s,u=new Array(n);let h,d,p;for(h=0,d=n;h<d;++h)p=h+i,u[h]={[o]:c||r.parse(l[p],p),[a]:s.parse(t[p],p)};return u}parseArrayData(e,t,i,n){const{xScale:r,yScale:s}=e,o=new Array(n);let a,l,c,u;for(a=0,l=n;a<l;++a)c=a+i,u=t[c],o[a]={x:r.parse(u[0],c),y:s.parse(u[1],c)};return o}parseObjectData(e,t,i,n){const{xScale:r,yScale:s}=e,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,l=new Array(n);let c,u,h,d;for(c=0,u=n;c<u;++c)h=c+i,d=t[h],l[c]={x:r.parse(IS(d,o),h),y:s.parse(IS(d,a),h)};return l}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,i){const n=this.chart,r=this._cachedMeta,s=t[e.axis];return nM({keys:iM(n,!0),values:t._stacks[e.axis]._visualValues},s,r.index,{mode:i})}updateRangeFromParsed(e,t,i,n){const r=i[t.axis];let s=null===r?NaN:r;const o=n&&i._stacks[t.axis];n&&o&&(n.values=o,s=nM(n,r,this._cachedMeta.index)),e.min=Math.min(e.min,s),e.max=Math.max(e.max,s)}getMinMax(e,t){const i=this._cachedMeta,n=i._parsed,r=i._sorted&&e===i.iScale,s=n.length,o=this._getOtherScale(e),a=((e,t,i)=>e&&!t.hidden&&t._stacked&&{keys:iM(i,!0),values:null})(t,i,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:u}=function(e){const{min:t,max:i,minDefined:n,maxDefined:r}=e.getUserBounds();return{min:n?t:Number.NEGATIVE_INFINITY,max:r?i:Number.POSITIVE_INFINITY}}(o);let h,d;function p(){d=n[h];const t=d[o.axis];return!pS(d[e.axis])||c>t||u<t}for(h=0;h<s&&(p()||(this.updateRangeFromParsed(l,e,d,a),!r));++h);if(r)for(h=s-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(l,e,d,a);break}return l}getAllParsedValues(e){const t=this._cachedMeta._parsed,i=[];let n,r,s;for(n=0,r=t.length;n<r;++n)s=t[n][e.axis],pS(s)&&i.push(s);return i}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,i=t.iScale,n=t.vScale,r=this.getParsed(e);return{label:i?""+i.getLabelForValue(r[i.axis]):"",value:n?""+n.getLabelForValue(r[n.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=function(e){let t,i,n,r;return dS(e)?(t=e.top,i=e.right,n=e.bottom,r=e.left):t=i=n=r=e,{top:t,right:i,bottom:n,left:r,disabled:!1===e}}(mS(this.options.clip,function(e,t,i){if(!1===i)return!1;const n=tM(e,i),r=tM(t,i);return{top:r.end,right:n.end,bottom:r.start,left:n.start}}(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,i=this._cachedMeta,n=i.data||[],r=t.chartArea,s=[],o=this._drawStart||0,a=this._drawCount||n.length-o,l=this.options.drawActiveElementsOnTop;let c;for(i.dataset&&i.dataset.draw(e,r,o,a),c=o;c<o+a;++c){const t=n[c];t.hidden||(t.active&&l?s.push(t):t.draw(e,r))}for(c=0;c<s.length;++c)s[c].draw(e,r)}getStyle(e,t){const i=t?"active":"default";return void 0===e&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(e||0,i)}getContext(e,t,i){const n=this.getDataset();let r;if(e>=0&&e<this._cachedMeta.data.length){const t=this._cachedMeta.data[e];r=t.$context||(t.$context=function(e,t,i){return rE(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:i,index:t,mode:"default",type:"data"})}(this.getContext(),e,t)),r.parsed=this.getParsed(e),r.raw=n.data[e],r.index=r.dataIndex=e}else r=this.$context||(this.$context=function(e,t){return rE(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),r.dataset=n,r.index=r.datasetIndex=this.index;return r.active=!!t,r.mode=i,r}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",i){const n="active"===t,r=this._cachedDataOpts,s=e+"-"+t,o=r[s],a=this.enableOptionSharing&&CS(i);if(o)return hM(o,a);const l=this.chart.config,c=l.datasetElementScopeKeys(this._type,e),u=n?[`${e}Hover`,"hover",e,""]:[e,""],h=l.getOptionScopes(this.getDataset(),c),d=Object.keys(RT.elements[e]),p=l.resolveNamedOptions(h,d,(()=>this.getContext(i,n,t)),u);return p.$shared&&(p.$shared=a,r[s]=Object.freeze(hM(p,a))),p}_resolveAnimations(e,t,i){const n=this.chart,r=this._cachedDataOpts,s=`animation-${t}`,o=r[s];if(o)return o;let a;if(!1!==n.options.animation){const n=this.chart.config,r=n.datasetAnimationScopeKeys(this._type,t),s=n.getOptionScopes(this.getDataset(),r);a=n.createResolver(s,this.getContext(e,i,t))}const l=new eM(n,a&&a.animations);return a&&a._cacheable&&(r[s]=Object.freeze(l)),l}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||uM(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const i=this.resolveDataElementOptions(e,t),n=this._sharedOptions,r=this.getSharedOptions(i),s=this.includeOptions(t,r)||r!==n;return this.updateSharedOptions(r,t,i),{sharedOptions:r,includeOptions:s}}updateElement(e,t,i,n){uM(n)?Object.assign(e,i):this._resolveAnimations(t,n).update(e,i)}updateSharedOptions(e,t,i){e&&!uM(t)&&this._resolveAnimations(void 0,t).update(e,i)}_setStyle(e,t,i,n){e.active=n;const r=this.getStyle(t,n);this._resolveAnimations(t,i,n).update(e,{options:!n&&this.getSharedOptions(r)||r})}removeHoverStyle(e,t,i){this._setStyle(e,i,"active",!1)}setHoverStyle(e,t,i){this._setStyle(e,i,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,i=this._cachedMeta.data;for(const[e,t,i]of this._syncList)this[e](t,i);this._syncList=[];const n=i.length,r=t.length,s=Math.min(r,n);s&&this.parse(0,s),r>n?this._insertElements(n,r-n,e):r<n&&this._removeElements(r,n-r)}_insertElements(e,t,i=!0){const n=this._cachedMeta,r=n.data,s=e+t;let o;const a=e=>{for(e.length+=t,o=e.length-1;o>=s;o--)e[o]=e[o-t]};for(a(r),o=e;o<s;++o)r[o]=new this.dataElementType;this._parsing&&a(n._parsed),this.parse(e,t),i&&this.updateElements(r,e,t,"reset")}updateElements(e,t,i,n){}_removeElements(e,t){const i=this._cachedMeta;if(this._parsing){const n=i._parsed.splice(e,t);i._stacked&&cM(i,n)}i.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,i,n]=e;this[t](i,n)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const i=arguments.length-2;i&&this._sync(["_insertElements",e,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function pM(e){const t=e.iScale,i=function(e,t){if(!e._cache.$bar){const i=e.getMatchingVisibleMetas(t);let n=[];for(let t=0,r=i.length;t<r;t++)n=n.concat(i[t].controller.getAllParsedValues(e));e._cache.$bar=aT(n.sort(((e,t)=>e-t)))}return e._cache.$bar}(t,e.type);let n,r,s,o,a=t._length;const l=()=>{32767!==s&&-32768!==s&&(CS(o)&&(a=Math.min(a,Math.abs(s-o)||a)),o=s)};for(n=0,r=i.length;n<r;++n)s=t.getPixelForValue(i[n]),l();for(o=void 0,n=0,r=t.ticks.length;n<r;++n)s=t.getPixelForTick(n),l();return a}function fM(e,t,i,n){return hS(e)?function(e,t,i,n){const r=i.parse(e[0],n),s=i.parse(e[1],n),o=Math.min(r,s),a=Math.max(r,s);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),t[i.axis]=c,t._custom={barStart:l,barEnd:c,start:r,end:s,min:o,max:a}}(e,t,i,n):t[i.axis]=i.parse(e,n),t}function mM(e,t,i,n){const r=e.iScale,s=e.vScale,o=r.getLabels(),a=r===s,l=[];let c,u,h,d;for(c=i,u=i+n;c<u;++c)d=t[c],h={},h[r.axis]=a||r.parse(o[c],c),l.push(fM(d,h,s,c));return l}function gM(e){return e&&void 0!==e.barStart&&void 0!==e.barEnd}function _M(e,t,i,n){let r=t.borderSkipped;const s={};if(!r)return void(e.borderSkipped=s);if(!0===r)return void(e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:o,end:a,reverse:l,top:c,bottom:u}=function(e){let t,i,n,r,s;return e.horizontal?(t=e.base>e.x,i="left",n="right"):(t=e.base<e.y,i="bottom",n="top"),t?(r="end",s="start"):(r="start",s="end"),{start:i,end:n,reverse:t,top:r,bottom:s}}(e);"middle"===r&&i&&(e.enableBorderRadius=!0,(i._top||0)===n?r=c:(i._bottom||0)===n?r=u:(s[yM(u,o,a,l)]=!0,r=c)),s[yM(r,o,a,l)]=!0,e.borderSkipped=s}function yM(e,t,i,n){var r,s,o;return n?(o=i,e=vM(e=(r=e)===(s=t)?o:r===o?s:r,i,t)):e=vM(e,t,i),e}function vM(e,t,i){return"start"===e?t:"end"===e?i:e}function xM(e,{inflateAmount:t},i){e.inflateAmount="auto"===t?1===i?.33:0:t}class bM extends dM{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:e=>"spacing"!==e,_indexable:e=>"spacing"!==e&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:i,color:n}}=e.legend.options;return t.labels.map(((t,r)=>{const s=e.getDatasetMeta(0).controller.getStyle(r);return{text:t,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,fontColor:n,lineWidth:s.borderWidth,pointStyle:i,hidden:!e.getDataVisibility(r),index:r}}))}return[]}},onClick(e,t,i){i.chart.toggleDataVisibility(t.index),i.chart.update()}}}};constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const i=this.getDataset().data,n=this._cachedMeta;if(!1===this._parsing)n._parsed=i;else{let r,s,o=e=>+i[e];if(dS(i[e])){const{key:e="value"}=this._parsing;o=t=>+IS(i[t],e)}for(r=e,s=e+t;r<s;++r)n._parsed[r]=o(r)}}_getRotation(){return qS(this.options.rotation-90)}_getCircumference(){return qS(this.options.circumference)}_getRotationExtents(){let e=LS,t=-LS;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const n=this.chart.getDatasetMeta(i).controller,r=n._getRotation(),s=n._getCircumference();e=Math.min(e,r),t=Math.max(t,r+s)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:i}=t,n=this._cachedMeta,r=n.data,s=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,o=Math.max((Math.min(i.width,i.height)-s)/2,0),a=Math.min((c=o,"string"==typeof(l=this.options.cutout)&&l.endsWith("%")?parseFloat(l)/100:+l/c),1);var l,c;const u=this._getRingWeight(this.index),{circumference:h,rotation:d}=this._getRotationExtents(),{ratioX:p,ratioY:f,offsetX:m,offsetY:g}=function(e,t,i){let n=1,r=1,s=0,o=0;if(t<LS){const a=e,l=a+t,c=Math.cos(a),u=Math.sin(a),h=Math.cos(l),d=Math.sin(l),p=(e,t,n)=>QS(e,a,l,!0)?1:Math.max(t,t*i,n,n*i),f=(e,t,n)=>QS(e,a,l,!0)?-1:Math.min(t,t*i,n,n*i),m=p(0,c,h),g=p(zS,u,d),_=f(RS,c,h),y=f(RS+zS,u,d);n=(m-_)/2,r=(g-y)/2,s=-(m+_)/2,o=-(g+y)/2}return{ratioX:n,ratioY:r,offsetX:s,offsetY:o}}(d,h,a),_=(i.width-s)/p,y=(i.height-s)/f,v=Math.max(Math.min(_,y)/2,0),x=gS(this.options.radius,v),b=(x-Math.max(x*a,0))/this._getVisibleDatasetWeightTotal();this.offsetX=m*x,this.offsetY=g*x,n.total=this.calculateTotal(),this.outerRadius=x-b*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-b*u,0),this.updateElements(r,0,r.length,e)}_circumference(e,t){const i=this.options,n=this._cachedMeta,r=this._getCircumference();return t&&i.animation.animateRotate||!this.chart.getDataVisibility(e)||null===n._parsed[e]||n.data[e].hidden?0:this.calculateCircumference(n._parsed[e]*r/LS)}updateElements(e,t,i,n){const r="reset"===n,s=this.chart,o=s.chartArea,a=s.options.animation,l=(o.left+o.right)/2,c=(o.top+o.bottom)/2,u=r&&a.animateScale,h=u?0:this.innerRadius,d=u?0:this.outerRadius,{sharedOptions:p,includeOptions:f}=this._getSharedOptions(t,n);let m,g=this._getRotation();for(m=0;m<t;++m)g+=this._circumference(m,r);for(m=t;m<t+i;++m){const t=this._circumference(m,r),i=e[m],s={x:l+this.offsetX,y:c+this.offsetY,startAngle:g,endAngle:g+t,circumference:t,outerRadius:d,innerRadius:h};f&&(s.options=p||this.resolveDataElementOptions(m,i.active?"active":n)),g+=t,this.updateElement(i,m,s,n)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let i,n=0;for(i=0;i<t.length;i++){const r=e._parsed[i];null===r||isNaN(r)||!this.chart.getDataVisibility(i)||t[i].hidden||(n+=Math.abs(r))}return n}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?LS*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,i=this.chart,n=i.data.labels||[],r=TT(t._parsed[e],i.options.locale);return{label:n[e]||"",value:r}}getMaxBorderWidth(e){let t=0;const i=this.chart;let n,r,s,o,a;if(!e)for(n=0,r=i.data.datasets.length;n<r;++n)if(i.isDatasetVisible(n)){s=i.getDatasetMeta(n),e=s.data,o=s.controller;break}if(!e)return 0;for(n=0,r=e.length;n<r;++n)a=o.resolveDataElementOptions(n),"inner"!==a.borderAlign&&(t=Math.max(t,a.borderWidth||0,a.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let i=0,n=e.length;i<n;++i){const e=this.resolveDataElementOptions(i);t=Math.max(t,e.offset||0,e.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let i=0;i<e;++i)this.chart.isDatasetVisible(i)&&(t+=this._getRingWeight(i));return t}_getRingWeight(e){return Math.max(mS(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class wM extends dM{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:i,color:n}}=e.legend.options;return t.labels.map(((t,r)=>{const s=e.getDatasetMeta(0).controller.getStyle(r);return{text:t,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,fontColor:n,lineWidth:s.borderWidth,pointStyle:i,hidden:!e.getDataVisibility(r),index:r}}))}return[]}},onClick(e,t,i){i.chart.toggleDataVisibility(t.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,i=this.chart,n=i.data.labels||[],r=TT(t._parsed[e].r,i.options.locale);return{label:n[e]||"",value:r}}parseObjectData(e,t,i,n){return yE.bind(this)(e,t,i,n)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach(((e,i)=>{const n=this.getParsed(i).r;!isNaN(n)&&this.chart.getDataVisibility(i)&&(n<t.min&&(t.min=n),n>t.max&&(t.max=n))})),t}_updateRadius(){const e=this.chart,t=e.chartArea,i=e.options,n=Math.min(t.right-t.left,t.bottom-t.top),r=Math.max(n/2,0),s=(r-Math.max(i.cutoutPercentage?r/100*i.cutoutPercentage:1,0))/e.getVisibleDatasetCount();this.outerRadius=r-s*this.index,this.innerRadius=this.outerRadius-s}updateElements(e,t,i,n){const r="reset"===n,s=this.chart,o=s.options.animation,a=this._cachedMeta.rScale,l=a.xCenter,c=a.yCenter,u=a.getIndexAngle(0)-.5*RS;let h,d=u;const p=360/this.countVisibleElements();for(h=0;h<t;++h)d+=this._computeAngle(h,n,p);for(h=t;h<t+i;h++){const t=e[h];let i=d,f=d+this._computeAngle(h,n,p),m=s.getDataVisibility(h)?a.getDistanceFromCenterForValue(this.getParsed(h).r):0;d=f,r&&(o.animateScale&&(m=0),o.animateRotate&&(i=f=u));const g={x:l,y:c,innerRadius:0,outerRadius:m,startAngle:i,endAngle:f,options:this.resolveDataElementOptions(h,t.active?"active":n)};this.updateElement(t,h,g,n)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach(((e,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&t++})),t}_computeAngle(e,t,i){return this.chart.getDataVisibility(e)?qS(this.resolveDataElementOptions(e,t).angle||i):0}}var SM=Object.freeze({__proto__:null,BarController:class extends dM{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(e,t,i,n){return mM(e,t,i,n)}parseArrayData(e,t,i,n){return mM(e,t,i,n)}parseObjectData(e,t,i,n){const{iScale:r,vScale:s}=e,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,l="x"===r.axis?o:a,c="x"===s.axis?o:a,u=[];let h,d,p,f;for(h=i,d=i+n;h<d;++h)f=t[h],p={},p[r.axis]=r.parse(IS(f,l),h),u.push(fM(IS(f,c),p,s,h));return u}updateRangeFromParsed(e,t,i,n){super.updateRangeFromParsed(e,t,i,n);const r=i._custom;r&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,r.min),e.max=Math.max(e.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:i,vScale:n}=t,r=this.getParsed(e),s=r._custom,o=gM(s)?"["+s.start+", "+s.end+"]":""+n.getLabelForValue(r[n.axis]);return{label:""+i.getLabelForValue(r[i.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,i,n){const r="reset"===n,{index:s,_cachedMeta:{vScale:o}}=this,a=o.getBasePixel(),l=o.isHorizontal(),c=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(t,n);for(let d=t;d<t+i;d++){const t=this.getParsed(d),i=r||uS(t[o.axis])?{base:a,head:a}:this._calculateBarValuePixels(d),p=this._calculateBarIndexPixels(d,c),f=(t._stacks||{})[o.axis],m={horizontal:l,base:i.base,enableBorderRadius:!f||gM(t._custom)||s===f._top||s===f._bottom,x:l?i.head:p.center,y:l?p.center:i.head,height:l?p.size:Math.abs(i.size),width:l?Math.abs(i.size):p.size};h&&(m.options=u||this.resolveDataElementOptions(d,e[d].active?"active":n));const g=m.options||e[d].options;_M(m,g,f,s),xM(m,g,c.ratio),this.updateElement(e[d],d,m,n)}}_getStacks(e,t){const{iScale:i}=this._cachedMeta,n=i.getMatchingVisibleMetas(this._type).filter((e=>e.controller.options.grouped)),r=i.options.stacked,s=[],o=e=>{const i=e.controller.getParsed(t),n=i&&i[e.vScale.axis];if(uS(n)||isNaN(n))return!0};for(const i of n)if((void 0===t||!o(i))&&((!1===r||-1===s.indexOf(i.stack)||void 0===r&&void 0===i.stack)&&s.push(i.stack),i.index===e))break;return s.length||s.push(void 0),s}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,t,i){const n=this._getStacks(e,i),r=void 0!==t?n.indexOf(t):-1;return-1===r?n.length-1:r}_getRuler(){const e=this.options,t=this._cachedMeta,i=t.iScale,n=[];let r,s;for(r=0,s=t.data.length;r<s;++r)n.push(i.getPixelForValue(this.getParsed(r)[i.axis],r));const o=e.barThickness;return{min:o||pM(t),pixels:n,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:e.grouped,ratio:o?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:i,index:n},options:{base:r,minBarLength:s}}=this,o=r||0,a=this.getParsed(e),l=a._custom,c=gM(l);let u,h,d=a[t.axis],p=0,f=i?this.applyStack(t,a,i):d;f!==d&&(p=f-d,f=d),c&&(d=l.barStart,f=l.barEnd-l.barStart,0!==d&&VS(d)!==VS(l.barEnd)&&(p=0),p+=d);const m=uS(r)||c?p:r;let g=t.getPixelForValue(m);if(u=this.chart.getDataVisibility(e)?t.getPixelForValue(p+f):g,h=u-g,Math.abs(h)<s){h=function(e,t,i){return 0!==e?VS(e):(t.isHorizontal()?1:-1)*(t.min>=i?1:-1)}(h,t,o)*s,d===o&&(g-=h/2);const e=t.getPixelForDecimal(0),r=t.getPixelForDecimal(1),l=Math.min(e,r),p=Math.max(e,r);g=Math.max(Math.min(g,p),l),u=g+h,i&&!c&&(a._stacks[t.axis]._visualValues[n]=t.getValueForPixel(u)-t.getValueForPixel(g))}if(g===t.getPixelForValue(o)){const e=VS(h)*t.getLineWidthForValue(o)/2;g+=e,h-=e}return{size:h,base:g,head:u,center:u+h/2}}_calculateBarIndexPixels(e,t){const i=t.scale,n=this.options,r=n.skipNull,s=mS(n.maxBarThickness,1/0);let o,a;if(t.grouped){const i=r?this._getStackCount(e):t.stackCount,l="flex"===n.barThickness?function(e,t,i,n){const r=t.pixels,s=r[e];let o=e>0?r[e-1]:null,a=e<r.length-1?r[e+1]:null;const l=i.categoryPercentage;null===o&&(o=s-(null===a?t.end-t.start:a-s)),null===a&&(a=s+s-o);const c=s-(s-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/n,ratio:i.barPercentage,start:c}}(e,t,n,i):function(e,t,i,n){const r=i.barThickness;let s,o;return uS(r)?(s=t.min*i.categoryPercentage,o=i.barPercentage):(s=r*n,o=1),{chunk:s/n,ratio:o,start:t.pixels[e]-s/2}}(e,t,n,i),c=this._getStackIndex(this.index,this._cachedMeta.stack,r?e:void 0);o=l.start+l.chunk*c+l.chunk/2,a=Math.min(s,l.chunk*l.ratio)}else o=i.getPixelForValue(this.getParsed(e)[i.axis],e),a=Math.min(s,t.min*t.ratio);return{base:o-a/2,head:o+a/2,center:o,size:a}}draw(){const e=this._cachedMeta,t=e.vScale,i=e.data,n=i.length;let r=0;for(;r<n;++r)null!==this.getParsed(r)[t.axis]&&i[r].draw(this._ctx)}},BubbleController:class extends dM{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,i,n){const r=super.parsePrimitiveData(e,t,i,n);for(let e=0;e<r.length;e++)r[e]._custom=this.resolveDataElementOptions(e+i).radius;return r}parseArrayData(e,t,i,n){const r=super.parseArrayData(e,t,i,n);for(let e=0;e<r.length;e++){const n=t[i+e];r[e]._custom=mS(n[2],this.resolveDataElementOptions(e+i).radius)}return r}parseObjectData(e,t,i,n){const r=super.parseObjectData(e,t,i,n);for(let e=0;e<r.length;e++){const n=t[i+e];r[e]._custom=mS(n&&n.r&&+n.r,this.resolveDataElementOptions(e+i).radius)}return r}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let i=e.length-1;i>=0;--i)t=Math.max(t,e[i].size(this.resolveDataElementOptions(i))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:r}=t,s=this.getParsed(e),o=n.getLabelForValue(s.x),a=r.getLabelForValue(s.y),l=s._custom;return{label:i[e]||"",value:"("+o+", "+a+(l?", "+l:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,i,n){const r="reset"===n,{iScale:s,vScale:o}=this._cachedMeta,{sharedOptions:a,includeOptions:l}=this._getSharedOptions(t,n),c=s.axis,u=o.axis;for(let h=t;h<t+i;h++){const t=e[h],i=!r&&this.getParsed(h),d={},p=d[c]=r?s.getPixelForDecimal(.5):s.getPixelForValue(i[c]),f=d[u]=r?o.getBasePixel():o.getPixelForValue(i[u]);d.skip=isNaN(p)||isNaN(f),l&&(d.options=a||this.resolveDataElementOptions(h,t.active?"active":n),r&&(d.options.radius=0)),this.updateElement(t,h,d,n)}}resolveDataElementOptions(e,t){const i=this.getParsed(e);let n=super.resolveDataElementOptions(e,t);n.$shared&&(n=Object.assign({},n,{$shared:!1}));const r=n.radius;return"active"!==t&&(n.radius=0),n.radius+=mS(i&&i._custom,r),n}},DoughnutController:bM,LineController:class extends dM{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:i,data:n=[],_dataset:r}=t,s=this.chart._animationsDisabled;let{start:o,count:a}=dT(t,n,s);this._drawStart=o,this._drawCount=a,pT(t)&&(o=0,a=n.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!r._decimated,i.points=n;const l=this.resolveDatasetElementOptions(e);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(i,void 0,{animated:!s,options:l},e),this.updateElements(n,o,a,e)}updateElements(e,t,i,n){const r="reset"===n,{iScale:s,vScale:o,_stacked:a,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:u}=this._getSharedOptions(t,n),h=s.axis,d=o.axis,{spanGaps:p,segment:f}=this.options,m=HS(p)?p:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||r||"none"===n,_=t+i,y=e.length;let v=t>0&&this.getParsed(t-1);for(let i=0;i<y;++i){const p=e[i],y=g?p:{};if(i<t||i>=_){y.skip=!0;continue}const x=this.getParsed(i),b=uS(x[d]),w=y[h]=s.getPixelForValue(x[h],i),S=y[d]=r||b?o.getBasePixel():o.getPixelForValue(a?this.applyStack(o,x,a):x[d],i);y.skip=isNaN(w)||isNaN(S)||b,y.stop=i>0&&Math.abs(x[h]-v[h])>m,f&&(y.parsed=x,y.raw=l.data[i]),u&&(y.options=c||this.resolveDataElementOptions(i,p.active?"active":n)),g||this.updateElement(p,i,y,n),v=x}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,i=t.options&&t.options.borderWidth||0,n=e.data||[];if(!n.length)return i;const r=n[0].size(this.resolveDataElementOptions(0)),s=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(i,r,s)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}},PieController:class extends bM{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}},PolarAreaController:wM,RadarController:class extends dM{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(e){const t=this._cachedMeta.vScale,i=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(i[t.axis])}}parseObjectData(e,t,i,n){return yE.bind(this)(e,t,i,n)}update(e){const t=this._cachedMeta,i=t.dataset,n=t.data||[],r=t.iScale.getLabels();if(i.points=n,"resize"!==e){const t=this.resolveDatasetElementOptions(e);this.options.showLine||(t.borderWidth=0);const s={_loop:!0,_fullLoop:r.length===n.length,options:t};this.updateElement(i,void 0,s,e)}this.updateElements(n,0,n.length,e)}updateElements(e,t,i,n){const r=this._cachedMeta.rScale,s="reset"===n;for(let o=t;o<t+i;o++){const t=e[o],i=this.resolveDataElementOptions(o,t.active?"active":n),a=r.getPointPositionForValue(o,this.getParsed(o).r),l=s?r.xCenter:a.x,c=s?r.yCenter:a.y,u={x:l,y:c,angle:a.angle,skip:isNaN(l)||isNaN(c),options:i};this.updateElement(t,o,u,n)}}},ScatterController:class extends dM{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(e){const t=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:r}=t,s=this.getParsed(e),o=n.getLabelForValue(s.x),a=r.getLabelForValue(s.y);return{label:i[e]||"",value:"("+o+", "+a+")"}}update(e){const t=this._cachedMeta,{data:i=[]}=t,n=this.chart._animationsDisabled;let{start:r,count:s}=dT(t,i,n);if(this._drawStart=r,this._drawCount=s,pT(t)&&(r=0,s=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:r,_dataset:s}=t;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!s._decimated,r.points=i;const o=this.resolveDatasetElementOptions(e);o.segment=this.options.segment,this.updateElement(r,void 0,{animated:!n,options:o},e)}else this.datasetElementType&&(delete t.dataset,this.datasetElementType=!1);this.updateElements(i,r,s,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,t,i,n){const r="reset"===n,{iScale:s,vScale:o,_stacked:a,_dataset:l}=this._cachedMeta,c=this.resolveDataElementOptions(t,n),u=this.getSharedOptions(c),h=this.includeOptions(n,u),d=s.axis,p=o.axis,{spanGaps:f,segment:m}=this.options,g=HS(f)?f:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||r||"none"===n;let y=t>0&&this.getParsed(t-1);for(let c=t;c<t+i;++c){const t=e[c],i=this.getParsed(c),f=_?t:{},v=uS(i[p]),x=f[d]=s.getPixelForValue(i[d],c),b=f[p]=r||v?o.getBasePixel():o.getPixelForValue(a?this.applyStack(o,i,a):i[p],c);f.skip=isNaN(x)||isNaN(b)||v,f.stop=c>0&&Math.abs(i[d]-y[d])>g,m&&(f.parsed=i,f.raw=l.data[c]),h&&(f.options=u||this.resolveDataElementOptions(c,t.active?"active":n)),_||this.updateElement(t,c,f,n),y=i}this.updateSharedOptions(u,n,c)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}const i=e.dataset,n=i.options&&i.options.borderWidth||0;if(!t.length)return n;const r=t[0].size(this.resolveDataElementOptions(0)),s=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(n,r,s)/2}}});function TM(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class EM{static override(e){Object.assign(EM.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return TM()}parse(){return TM()}format(){return TM()}add(){return TM()}diff(){return TM()}startOf(){return TM()}endOf(){return TM()}}var MM=EM;function IM(e,t,i,n){const{controller:r,data:s,_sorted:o}=e,a=r._cachedMeta.iScale;if(a&&t===a.axis&&"r"!==t&&o&&s.length){const e=a._reversePixels?rT:nT;if(!n)return e(s,t,i);if(r._sharedOptions){const n=s[0],r="function"==typeof n.getRange&&n.getRange(t);if(r){const n=e(s,t,i-r),o=e(s,t,i+r);return{lo:n.lo,hi:o.hi}}}}return{lo:0,hi:s.length-1}}function AM(e,t,i,n,r){const s=e.getSortedVisibleDatasetMetas(),o=i[t];for(let e=0,i=s.length;e<i;++e){const{index:i,data:a}=s[e],{lo:l,hi:c}=IM(s[e],t,o,r);for(let e=l;e<=c;++e){const t=a[e];t.skip||n(t,i,e)}}}function CM(e,t,i,n,r){const s=[];return r||e.isPointInArea(t)?(AM(e,i,t,(function(i,o,a){(r||BT(i,e.chartArea,0))&&i.inRange(t.x,t.y,n)&&s.push({element:i,datasetIndex:o,index:a})}),!0),s):s}function PM(e,t,i,n,r,s){return s||e.isPointInArea(t)?"r"!==i||n?function(e,t,i,n,r,s){let o=[];const a=function(e){const t=-1!==e.indexOf("x"),i=-1!==e.indexOf("y");return function(e,n){const r=t?Math.abs(e.x-n.x):0,s=i?Math.abs(e.y-n.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(s,2))}}(i);let l=Number.POSITIVE_INFINITY;return AM(e,i,t,(function(i,c,u){const h=i.inRange(t.x,t.y,r);if(n&&!h)return;const d=i.getCenterPoint(r);if(!s&&!e.isPointInArea(d)&&!h)return;const p=a(t,d);p<l?(o=[{element:i,datasetIndex:c,index:u}],l=p):p===l&&o.push({element:i,datasetIndex:c,index:u})})),o}(e,t,i,n,r,s):function(e,t,i,n){let r=[];return AM(e,i,t,(function(e,i,s){const{startAngle:o,endAngle:a}=e.getProps(["startAngle","endAngle"],n),{angle:l}=XS(e,{x:t.x,y:t.y});QS(l,o,a)&&r.push({element:e,datasetIndex:i,index:s})})),r}(e,t,i,r):[]}function kM(e,t,i,n,r){const s=[],o="x"===i?"inXRange":"inYRange";let a=!1;return AM(e,i,t,((e,n,l)=>{e[o](t[i],r)&&(s.push({element:e,datasetIndex:n,index:l}),a=a||e.inRange(t.x,t.y,r))})),n&&!a?[]:s}var RM={evaluateInteractionItems:AM,modes:{index(e,t,i,n){const r=RE(t,e),s=i.axis||"x",o=i.includeInvisible||!1,a=i.intersect?CM(e,r,s,n,o):PM(e,r,s,!1,n,o),l=[];return a.length?(e.getSortedVisibleDatasetMetas().forEach((e=>{const t=a[0].index,i=e.data[t];i&&!i.skip&&l.push({element:i,datasetIndex:e.index,index:t})})),l):[]},dataset(e,t,i,n){const r=RE(t,e),s=i.axis||"xy",o=i.includeInvisible||!1;let a=i.intersect?CM(e,r,s,n,o):PM(e,r,s,!1,n,o);if(a.length>0){const t=a[0].datasetIndex,i=e.getDatasetMeta(t).data;a=[];for(let e=0;e<i.length;++e)a.push({element:i[e],datasetIndex:t,index:e})}return a},point:(e,t,i,n)=>CM(e,RE(t,e),i.axis||"xy",n,i.includeInvisible||!1),nearest(e,t,i,n){const r=RE(t,e),s=i.axis||"xy",o=i.includeInvisible||!1;return PM(e,r,s,i.intersect,n,o)},x:(e,t,i,n)=>kM(e,RE(t,e),"x",i.intersect,n),y:(e,t,i,n)=>kM(e,RE(t,e),"y",i.intersect,n)}};const LM=["left","top","right","bottom"];function DM(e,t){return e.filter((e=>e.pos===t))}function OM(e,t){return e.filter((e=>-1===LM.indexOf(e.pos)&&e.box.axis===t))}function NM(e,t){return e.sort(((e,i)=>{const n=t?i:e,r=t?e:i;return n.weight===r.weight?n.index-r.index:n.weight-r.weight}))}function zM(e,t,i,n){return Math.max(e[i],t[i])+Math.max(e[n],t[n])}function FM(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function BM(e,t,i,n){const{pos:r,box:s}=i,o=e.maxPadding;if(!dS(r)){i.size&&(e[r]-=i.size);const t=n[i.stack]||{size:0,count:1};t.size=Math.max(t.size,i.horizontal?s.height:s.width),i.size=t.size/t.count,e[r]+=i.size}s.getPadding&&FM(o,s.getPadding());const a=Math.max(0,t.outerWidth-zM(o,e,"left","right")),l=Math.max(0,t.outerHeight-zM(o,e,"top","bottom")),c=a!==e.w,u=l!==e.h;return e.w=a,e.h=l,i.horizontal?{same:c,other:u}:{same:u,other:c}}function UM(e,t){const i=t.maxPadding;return function(e){const n={left:0,top:0,right:0,bottom:0};return e.forEach((e=>{n[e]=Math.max(t[e],i[e])})),n}(e?["left","right"]:["top","bottom"])}function VM(e,t,i,n){const r=[];let s,o,a,l,c,u;for(s=0,o=e.length,c=0;s<o;++s){a=e[s],l=a.box,l.update(a.width||t.w,a.height||t.h,UM(a.horizontal,t));const{same:o,other:h}=BM(t,i,a,n);c|=o&&r.length,u=u||h,l.fullSize||r.push(a)}return c&&VM(r,t,i,n)||u}function jM(e,t,i,n,r){e.top=i,e.left=t,e.right=t+n,e.bottom=i+r,e.width=n,e.height=r}function GM(e,t,i,n){const r=i.padding;let{x:s,y:o}=t;for(const a of e){const e=a.box,l=n[a.stack]||{count:1,placed:0,weight:1},c=a.stackWeight/l.weight||1;if(a.horizontal){const n=t.w*c,s=l.size||e.height;CS(l.start)&&(o=l.start),e.fullSize?jM(e,r.left,o,i.outerWidth-r.right-r.left,s):jM(e,t.left+l.placed,o,n,s),l.start=o,l.placed+=n,o=e.bottom}else{const n=t.h*c,o=l.size||e.width;CS(l.start)&&(s=l.start),e.fullSize?jM(e,s,r.top,o,i.outerHeight-r.bottom-r.top):jM(e,s,t.top+l.placed,o,n),l.start=s,l.placed+=n,s=e.right}}t.x=s,t.y=o}var HM={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},e.boxes.push(t)},removeBox(e,t){const i=e.boxes?e.boxes.indexOf(t):-1;-1!==i&&e.boxes.splice(i,1)},configure(e,t,i){t.fullSize=i.fullSize,t.position=i.position,t.weight=i.weight},update(e,t,i,n){if(!e)return;const r=tE(e.options.layout.padding),s=Math.max(t-r.width,0),o=Math.max(i-r.height,0),a=function(e){const t=function(e){const t=[];let i,n,r,s,o,a;for(i=0,n=(e||[]).length;i<n;++i)r=e[i],({position:s,options:{stack:o,stackWeight:a=1}}=r),t.push({index:i,box:r,pos:s,horizontal:r.isHorizontal(),weight:r.weight,stack:o&&s+o,stackWeight:a});return t}(e),i=NM(t.filter((e=>e.box.fullSize)),!0),n=NM(DM(t,"left"),!0),r=NM(DM(t,"right")),s=NM(DM(t,"top"),!0),o=NM(DM(t,"bottom")),a=OM(t,"x"),l=OM(t,"y");return{fullSize:i,leftAndTop:n.concat(s),rightAndBottom:r.concat(l).concat(o).concat(a),chartArea:DM(t,"chartArea"),vertical:n.concat(r).concat(l),horizontal:s.concat(o).concat(a)}}(e.boxes),l=a.vertical,c=a.horizontal;yS(e.boxes,(e=>{"function"==typeof e.beforeLayout&&e.beforeLayout()}));const u=l.reduce(((e,t)=>t.box.options&&!1===t.box.options.display?e:e+1),0)||1,h=Object.freeze({outerWidth:t,outerHeight:i,padding:r,availableWidth:s,availableHeight:o,vBoxMaxWidth:s/2/u,hBoxMaxHeight:o/2}),d=Object.assign({},r);FM(d,tE(n));const p=Object.assign({maxPadding:d,w:s,h:o,x:r.left,y:r.top},r),f=function(e,t){const i=function(e){const t={};for(const i of e){const{stack:e,pos:n,stackWeight:r}=i;if(!e||!LM.includes(n))continue;const s=t[e]||(t[e]={count:0,placed:0,weight:0,size:0});s.count++,s.weight+=r}return t}(e),{vBoxMaxWidth:n,hBoxMaxHeight:r}=t;let s,o,a;for(s=0,o=e.length;s<o;++s){a=e[s];const{fullSize:o}=a.box,l=i[a.stack],c=l&&a.stackWeight/l.weight;a.horizontal?(a.width=c?c*n:o&&t.availableWidth,a.height=r):(a.width=n,a.height=c?c*r:o&&t.availableHeight)}return i}(l.concat(c),h);VM(a.fullSize,p,h,f),VM(l,p,h,f),VM(c,p,h,f)&&VM(l,p,h,f),function(e){const t=e.maxPadding;function i(i){const n=Math.max(t[i]-e[i],0);return e[i]+=n,n}e.y+=i("top"),e.x+=i("left"),i("right"),i("bottom")}(p),GM(a.leftAndTop,p,h,f),p.x+=p.w,p.y+=p.h,GM(a.rightAndBottom,p,h,f),e.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},yS(a.chartArea,(t=>{const i=t.box;Object.assign(i,e.chartArea),i.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})}))}};class WM{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,i){}removeEventListener(e,t,i){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,i,n){return t=Math.max(0,t||e.width),i=i||e.height,{width:t,height:Math.max(0,n?Math.floor(t/n):i)}}isAttached(e){return!0}updateConfig(e){}}class qM extends WM{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const $M="$chartjs",ZM={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},XM=e=>null===e||""===e,YM=!!OE&&{passive:!0};function KM(e,t,i){e&&e.canvas&&e.canvas.removeEventListener(t,i,YM)}function JM(e,t){for(const i of e)if(i===t||i.contains(t))return!0}function QM(e,t,i){const n=e.canvas,r=new MutationObserver((e=>{let t=!1;for(const i of e)t=t||JM(i.addedNodes,n),t=t&&!JM(i.removedNodes,n);t&&i()}));return r.observe(document,{childList:!0,subtree:!0}),r}function eI(e,t,i){const n=e.canvas,r=new MutationObserver((e=>{let t=!1;for(const i of e)t=t||JM(i.removedNodes,n),t=t&&!JM(i.addedNodes,n);t&&i()}));return r.observe(document,{childList:!0,subtree:!0}),r}const tI=new Map;let iI=0;function nI(){const e=window.devicePixelRatio;e!==iI&&(iI=e,tI.forEach(((t,i)=>{i.currentDevicePixelRatio!==e&&t()})))}function rI(e,t,i){const n=e.canvas,r=n&&ME(n);if(!r)return;const s=cT(((e,t)=>{const n=r.clientWidth;i(e,t),n<r.clientWidth&&i()}),window),o=new ResizeObserver((e=>{const t=e[0],i=t.contentRect.width,n=t.contentRect.height;0===i&&0===n||s(i,n)}));return o.observe(r),function(e,t){tI.size||window.addEventListener("resize",nI),tI.set(e,t)}(e,s),o}function sI(e,t,i){i&&i.disconnect(),"resize"===t&&function(e){tI.delete(e),tI.size||window.removeEventListener("resize",nI)}(e)}function oI(e,t,i){const n=e.canvas,r=cT((t=>{null!==e.ctx&&i(function(e,t){const i=ZM[e.type]||e.type,{x:n,y:r}=RE(e,t);return{type:i,chart:t,native:e,x:void 0!==n?n:null,y:void 0!==r?r:null}}(t,e))}),e);return function(e,t,i){e&&e.addEventListener(t,i,YM)}(n,t,r),r}class aI extends WM{acquireContext(e,t){const i=e&&e.getContext&&e.getContext("2d");return i&&i.canvas===e?(function(e,t){const i=e.style,n=e.getAttribute("height"),r=e.getAttribute("width");if(e[$M]={initial:{height:n,width:r,style:{display:i.display,height:i.height,width:i.width}}},i.display=i.display||"block",i.boxSizing=i.boxSizing||"border-box",XM(r)){const t=NE(e,"width");void 0!==t&&(e.width=t)}if(XM(n))if(""===e.style.height)e.height=e.width/(t||2);else{const t=NE(e,"height");void 0!==t&&(e.height=t)}}(e,t),i):null}releaseContext(e){const t=e.canvas;if(!t[$M])return!1;const i=t[$M].initial;["height","width"].forEach((e=>{const n=i[e];uS(n)?t.removeAttribute(e):t.setAttribute(e,n)}));const n=i.style||{};return Object.keys(n).forEach((e=>{t.style[e]=n[e]})),t.width=t.width,delete t[$M],!0}addEventListener(e,t,i){this.removeEventListener(e,t);const n=e.$proxies||(e.$proxies={}),r={attach:QM,detach:eI,resize:rI}[t]||oI;n[t]=r(e,t,i)}removeEventListener(e,t){const i=e.$proxies||(e.$proxies={}),n=i[t];n&&(({attach:sI,detach:sI,resize:sI}[t]||KM)(e,t,n),i[t]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,i,n){return function(e,t,i,n){const r=AE(e),s=PE(r,"margin"),o=IE(r.maxWidth,e,"clientWidth")||OS,a=IE(r.maxHeight,e,"clientHeight")||OS,l=function(e,t,i){let n,r;if(void 0===t||void 0===i){const s=ME(e);if(s){const e=s.getBoundingClientRect(),o=AE(s),a=PE(o,"border","width"),l=PE(o,"padding");t=e.width-l.width-a.width,i=e.height-l.height-a.height,n=IE(o.maxWidth,s,"clientWidth"),r=IE(o.maxHeight,s,"clientHeight")}else t=e.clientWidth,i=e.clientHeight}return{width:t,height:i,maxWidth:n||OS,maxHeight:r||OS}}(e,t,i);let{width:c,height:u}=l;if("content-box"===r.boxSizing){const e=PE(r,"border","width"),t=PE(r,"padding");c-=t.width+e.width,u-=t.height+e.height}return c=Math.max(0,c-s.width),u=Math.max(0,n?c/n:u-s.height),c=LE(Math.min(c,o,l.maxWidth)),u=LE(Math.min(u,a,l.maxHeight)),c&&!u&&(u=LE(c/2)),(void 0!==t||void 0!==i)&&n&&l.height&&u>l.height&&(u=l.height,c=LE(Math.floor(u*n))),{width:c,height:u}}(e,t,i,n)}isAttached(e){const t=ME(e);return!(!t||!t.isConnected)}}class lI{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){const{x:t,y:i}=this.getProps(["x","y"],e);return{x:t,y:i}}hasValue(){return HS(this.x)&&HS(this.y)}getProps(e,t){const i=this.$animations;if(!t||!i)return this;const n={};return e.forEach((e=>{n[e]=i[e]&&i[e].active()?i[e]._to:this[e]})),n}}function cI(e,t,i,n,r){const s=mS(n,0),o=Math.min(mS(r,e.length),e.length);let a,l,c,u=0;for(i=Math.ceil(i),r&&(a=r-n,i=a/Math.floor(a/i)),c=s;c<0;)u++,c=Math.round(s+u*i);for(l=Math.max(s,0);l<o;l++)l===c&&(t.push(e[l]),u++,c=Math.round(s+u*i))}const uI=(e,t,i)=>"top"===t||"left"===t?e[t]+i:e[t]-i,hI=(e,t)=>Math.min(t||e,e);function dI(e,t){const i=[],n=e.length/t,r=e.length;let s=0;for(;s<r;s+=n)i.push(e[Math.floor(s)]);return i}function pI(e,t,i){const n=e.ticks.length,r=Math.min(t,n-1),s=e._startPixel,o=e._endPixel,a=1e-6;let l,c=e.getPixelForTick(r);if(!(i&&(l=1===n?Math.max(c-s,o-c):0===t?(e.getPixelForTick(1)-c)/2:(c-e.getPixelForTick(r-1))/2,c+=r<t?l:-l,c<s-a||c>o+a)))return c}function fI(e){return e.drawTicks?e.tickLength:0}function mI(e,t){if(!e.display)return 0;const i=iE(e.font,t),n=tE(e.padding);return(hS(e.text)?e.text.length:1)*i.lineHeight+n.height}function gI(e,t,i){let n=uT(e);return(i&&"right"!==t||!i&&"right"===t)&&(n=(e=>"left"===e?"right":"right"===e?"left":e)(n)),n}class _I extends lI{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:i,_suggestedMax:n}=this;return e=fS(e,Number.POSITIVE_INFINITY),t=fS(t,Number.NEGATIVE_INFINITY),i=fS(i,Number.POSITIVE_INFINITY),n=fS(n,Number.NEGATIVE_INFINITY),{min:fS(e,i),max:fS(t,n),minDefined:pS(e),maxDefined:pS(t)}}getMinMax(e){let t,{min:i,max:n,minDefined:r,maxDefined:s}=this.getUserBounds();if(r&&s)return{min:i,max:n};const o=this.getMatchingVisibleMetas();for(let a=0,l=o.length;a<l;++a)t=o[a].controller.getMinMax(this,e),r||(i=Math.min(i,t.min)),s||(n=Math.max(n,t.max));return i=s&&i>n?n:i,n=r&&i>n?i:n,{min:fS(i,fS(n,i)),max:fS(n,fS(i,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){_S(this.options.beforeUpdate,[this])}update(e,t,i){const{beginAtZero:n,grace:r,ticks:s}=this.options,o=s.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(e,t,i){const{min:n,max:r}=e,s=gS(t,(r-n)/2),o=(e,t)=>i&&0===e?0:e+t;return{min:o(n,-Math.abs(s)),max:o(r,s)}}(this,r,n),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const a=o<this.ticks.length;this._convertTicksToLabels(a?dI(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),s.display&&(s.autoSkip||"auto"===s.source)&&(this.ticks=function(e,t){const i=e.options.ticks,n=function(e){const t=e.options.offset,i=e._tickSize(),n=e._length/i+(t?0:1),r=e._maxLength/i;return Math.floor(Math.min(n,r))}(e),r=Math.min(i.maxTicksLimit||n,n),s=i.major.enabled?function(e){const t=[];let i,n;for(i=0,n=e.length;i<n;i++)e[i].major&&t.push(i);return t}(t):[],o=s.length,a=s[0],l=s[o-1],c=[];if(o>r)return function(e,t,i,n){let r,s=0,o=i[0];for(n=Math.ceil(n),r=0;r<e.length;r++)r===o&&(t.push(e[r]),s++,o=i[s*n])}(t,c,s,o/r),c;const u=function(e,t,i){const n=function(e){const t=e.length;let i,n;if(t<2)return!1;for(n=e[0],i=1;i<t;++i)if(e[i]-e[i-1]!==n)return!1;return n}(e),r=t.length/i;if(!n)return Math.max(r,1);const s=function(e){const t=[],i=Math.sqrt(e);let n;for(n=1;n<i;n++)e%n==0&&(t.push(n),t.push(e/n));return i===(0|i)&&t.push(i),t.sort(((e,t)=>e-t)).pop(),t}(n);for(let e=0,t=s.length-1;e<t;e++){const t=s[e];if(t>r)return t}return Math.max(r,1)}(s,t,r);if(o>0){let e,i;const n=o>1?Math.round((l-a)/(o-1)):null;for(cI(t,c,u,uS(n)?0:a-n,a),e=0,i=o-1;e<i;e++)cI(t,c,u,s[e],s[e+1]);return cI(t,c,u,l,uS(n)?t.length:l+n),c}return cI(t,c,u),c}(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),a&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e,t,i=this.options.reverse;this.isHorizontal()?(e=this.left,t=this.right):(e=this.top,t=this.bottom,i=!i),this._startPixel=e,this._endPixel=t,this._reversePixels=i,this._length=t-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){_S(this.options.afterUpdate,[this])}beforeSetDimensions(){_S(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){_S(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),_S(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){_S(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let i,n,r;for(i=0,n=e.length;i<n;i++)r=e[i],r.label=_S(t.callback,[r.value,i,e],this)}afterTickToLabelConversion(){_S(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){_S(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,i=hI(this.ticks.length,e.ticks.maxTicksLimit),n=t.minRotation||0,r=t.maxRotation;let s,o,a,l=n;if(!this._isVisible()||!t.display||n>=r||i<=1||!this.isHorizontal())return void(this.labelRotation=n);const c=this._getLabelSizes(),u=c.widest.width,h=c.highest.height,d=eT(this.chart.width-u,0,this.maxWidth);s=e.offset?this.maxWidth/i:d/(i-1),u+6>s&&(s=d/(i-(e.offset?.5:1)),o=this.maxHeight-fI(e.grid)-t.padding-mI(e.title,this.chart.options.font),a=Math.sqrt(u*u+h*h),l=$S(Math.min(Math.asin(eT((c.highest.height+6)/s,-1,1)),Math.asin(eT(o/a,-1,1))-Math.asin(eT(h/a,-1,1)))),l=Math.max(n,Math.min(r,l))),this.labelRotation=l}afterCalculateLabelRotation(){_S(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){_S(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:i,title:n,grid:r}}=this,s=this._isVisible(),o=this.isHorizontal();if(s){const s=mI(n,t.options.font);if(o?(e.width=this.maxWidth,e.height=fI(r)+s):(e.height=this.maxHeight,e.width=fI(r)+s),i.display&&this.ticks.length){const{first:t,last:n,widest:r,highest:s}=this._getLabelSizes(),a=2*i.padding,l=qS(this.labelRotation),c=Math.cos(l),u=Math.sin(l);if(o){const t=i.mirror?0:u*r.width+c*s.height;e.height=Math.min(this.maxHeight,e.height+t+a)}else{const t=i.mirror?0:c*r.width+u*s.height;e.width=Math.min(this.maxWidth,e.width+t+a)}this._calculatePadding(t,n,u,c)}}this._handleMargins(),o?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,i,n){const{ticks:{align:r,padding:s},position:o}=this.options,a=0!==this.labelRotation,l="top"!==o&&"x"===this.axis;if(this.isHorizontal()){const o=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,h=0;a?l?(u=n*e.width,h=i*t.height):(u=i*e.height,h=n*t.width):"start"===r?h=t.width:"end"===r?u=e.width:"inner"!==r&&(u=e.width/2,h=t.width/2),this.paddingLeft=Math.max((u-o+s)*this.width/(this.width-o),0),this.paddingRight=Math.max((h-c+s)*this.width/(this.width-c),0)}else{let i=t.height/2,n=e.height/2;"start"===r?(i=0,n=e.height):"end"===r&&(i=t.height,n=0),this.paddingTop=i+s,this.paddingBottom=n+s}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){_S(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return"top"===t||"bottom"===t||"x"===e}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){let t,i;for(this.beforeTickToLabelConversion(),this.generateTickLabels(e),t=0,i=e.length;t<i;t++)uS(e[t].label)&&(e.splice(t,1),i--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let i=this.ticks;t<i.length&&(i=dI(i,t)),this._labelSizes=e=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,i){const{ctx:n,_longestTextCache:r}=this,s=[],o=[],a=Math.floor(t/hI(t,i));let l,c,u,h,d,p,f,m,g,_,y,v=0,x=0;for(l=0;l<t;l+=a){if(h=e[l].label,d=this._resolveTickFontOptions(l),n.font=p=d.string,f=r[p]=r[p]||{data:{},gc:[]},m=d.lineHeight,g=_=0,uS(h)||hS(h)){if(hS(h))for(c=0,u=h.length;c<u;++c)y=h[c],uS(y)||hS(y)||(g=LT(n,f.data,f.gc,g,y),_+=m)}else g=LT(n,f.data,f.gc,g,h),_=m;s.push(g),o.push(_),v=Math.max(g,v),x=Math.max(_,x)}!function(e,t){yS(e,(e=>{const i=e.gc,n=i.length/2;let r;if(n>t){for(r=0;r<n;++r)delete e.data[i[r]];i.splice(0,n)}}))}(r,t);const b=s.indexOf(v),w=o.indexOf(x),S=e=>({width:s[e]||0,height:o[e]||0});return{first:S(0),last:S(t-1),widest:S(b),highest:S(w),widths:s,heights:o}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return eT(this._alignToPixels?OT(this.chart,t,0):t,-32768,32767)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const i=t[e];return i.$context||(i.$context=function(e,t,i){return rE(e,{tick:i,index:t,type:"tick"})}(this.getContext(),e,i))}return this.$context||(this.$context=function(e,t){return rE(e,{scale:t,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=qS(this.labelRotation),i=Math.abs(Math.cos(t)),n=Math.abs(Math.sin(t)),r=this._getLabelSizes(),s=e.autoSkipPadding||0,o=r?r.widest.width+s:0,a=r?r.highest.height+s:0;return this.isHorizontal()?a*i>o*n?o/i:a/n:a*n<o*i?a/i:o/n}_isVisible(){const e=this.options.display;return"auto"!==e?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,i=this.chart,n=this.options,{grid:r,position:s,border:o}=n,a=r.offset,l=this.isHorizontal(),c=this.ticks.length+(a?1:0),u=fI(r),h=[],d=o.setContext(this.getContext()),p=d.display?d.width:0,f=p/2,m=function(e){return OT(i,e,p)};let g,_,y,v,x,b,w,S,T,E,M,I;if("top"===s)g=m(this.bottom),b=this.bottom-u,S=g-f,E=m(e.top)+f,I=e.bottom;else if("bottom"===s)g=m(this.top),E=e.top,I=m(e.bottom)-f,b=g+f,S=this.top+u;else if("left"===s)g=m(this.right),x=this.right-u,w=g-f,T=m(e.left)+f,M=e.right;else if("right"===s)g=m(this.left),T=e.left,M=m(e.right)-f,x=g+f,w=this.left+u;else if("x"===t){if("center"===s)g=m((e.top+e.bottom)/2+.5);else if(dS(s)){const e=Object.keys(s)[0],t=s[e];g=m(this.chart.scales[e].getPixelForValue(t))}E=e.top,I=e.bottom,b=g+f,S=b+u}else if("y"===t){if("center"===s)g=m((e.left+e.right)/2);else if(dS(s)){const e=Object.keys(s)[0],t=s[e];g=m(this.chart.scales[e].getPixelForValue(t))}x=g-f,w=x-u,T=e.left,M=e.right}const A=mS(n.ticks.maxTicksLimit,c),C=Math.max(1,Math.ceil(c/A));for(_=0;_<c;_+=C){const e=this.getContext(_),t=r.setContext(e),n=o.setContext(e),s=t.lineWidth,c=t.color,u=n.dash||[],d=n.dashOffset,p=t.tickWidth,f=t.tickColor,m=t.tickBorderDash||[],g=t.tickBorderDashOffset;y=pI(this,_,a),void 0!==y&&(v=OT(i,y,s),l?x=w=T=M=v:b=S=E=I=v,h.push({tx1:x,ty1:b,tx2:w,ty2:S,x1:T,y1:E,x2:M,y2:I,width:s,color:c,borderDash:u,borderDashOffset:d,tickWidth:p,tickColor:f,tickBorderDash:m,tickBorderDashOffset:g}))}return this._ticksLength=c,this._borderValue=g,h}_computeLabelItems(e){const t=this.axis,i=this.options,{position:n,ticks:r}=i,s=this.isHorizontal(),o=this.ticks,{align:a,crossAlign:l,padding:c,mirror:u}=r,h=fI(i.grid),d=h+c,p=u?-c:d,f=-qS(this.labelRotation),m=[];let g,_,y,v,x,b,w,S,T,E,M,I,A="middle";if("top"===n)b=this.bottom-p,w=this._getXAxisLabelAlignment();else if("bottom"===n)b=this.top+p,w=this._getXAxisLabelAlignment();else if("left"===n){const e=this._getYAxisLabelAlignment(h);w=e.textAlign,x=e.x}else if("right"===n){const e=this._getYAxisLabelAlignment(h);w=e.textAlign,x=e.x}else if("x"===t){if("center"===n)b=(e.top+e.bottom)/2+d;else if(dS(n)){const e=Object.keys(n)[0],t=n[e];b=this.chart.scales[e].getPixelForValue(t)+d}w=this._getXAxisLabelAlignment()}else if("y"===t){if("center"===n)x=(e.left+e.right)/2-d;else if(dS(n)){const e=Object.keys(n)[0],t=n[e];x=this.chart.scales[e].getPixelForValue(t)}w=this._getYAxisLabelAlignment(h).textAlign}"y"===t&&("start"===a?A="top":"end"===a&&(A="bottom"));const C=this._getLabelSizes();for(g=0,_=o.length;g<_;++g){y=o[g],v=y.label;const e=r.setContext(this.getContext(g));S=this.getPixelForTick(g)+r.labelOffset,T=this._resolveTickFontOptions(g),E=T.lineHeight,M=hS(v)?v.length:1;const t=M/2,i=e.color,a=e.textStrokeColor,c=e.textStrokeWidth;let h,d=w;if(s?(x=S,"inner"===w&&(d=g===_-1?this.options.reverse?"left":"right":0===g?this.options.reverse?"right":"left":"center"),I="top"===n?"near"===l||0!==f?-M*E+E/2:"center"===l?-C.highest.height/2-t*E+E:-C.highest.height+E/2:"near"===l||0!==f?E/2:"center"===l?C.highest.height/2-t*E:C.highest.height-M*E,u&&(I*=-1),0===f||e.showLabelBackdrop||(x+=E/2*Math.sin(f))):(b=S,I=(1-M)*E/2),e.showLabelBackdrop){const t=tE(e.backdropPadding),i=C.heights[g],n=C.widths[g];let r=I-t.top,s=0-t.left;switch(A){case"middle":r-=i/2;break;case"bottom":r-=i}switch(w){case"center":s-=n/2;break;case"right":s-=n;break;case"inner":g===_-1?s-=n:g>0&&(s-=n/2)}h={left:s,top:r,width:n+t.width,height:i+t.height,color:e.backdropColor}}m.push({label:v,font:T,textOffset:I,options:{rotation:f,color:i,strokeColor:a,strokeWidth:c,textAlign:d,textBaseline:A,translation:[x,b],backdrop:h}})}return m}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-qS(this.labelRotation))return"top"===e?"left":"right";let i="center";return"start"===t.align?i="left":"end"===t.align?i="right":"inner"===t.align&&(i="inner"),i}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:i,mirror:n,padding:r}}=this.options,s=e+r,o=this._getLabelSizes().widest.width;let a,l;return"left"===t?n?(l=this.right+r,"near"===i?a="left":"center"===i?(a="center",l+=o/2):(a="right",l+=o)):(l=this.right-s,"near"===i?a="right":"center"===i?(a="center",l-=o/2):(a="left",l=this.left)):"right"===t?n?(l=this.left+r,"near"===i?a="right":"center"===i?(a="center",l-=o/2):(a="left",l-=o)):(l=this.left+s,"near"===i?a="left":"center"===i?(a="center",l+=o/2):(a="right",l=this.right)):a="right",{textAlign:a,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;return"left"===t||"right"===t?{top:0,left:this.left,bottom:e.height,right:this.right}:"top"===t||"bottom"===t?{top:this.top,left:0,bottom:this.bottom,right:e.width}:void 0}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:i,top:n,width:r,height:s}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(i,n,r,s),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const i=this.ticks.findIndex((t=>t.value===e));return i>=0?t.setContext(this.getContext(i)).lineWidth:0}drawGrid(e){const t=this.options.grid,i=this.ctx,n=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let r,s;const o=(e,t,n)=>{n.width&&n.color&&(i.save(),i.lineWidth=n.width,i.strokeStyle=n.color,i.setLineDash(n.borderDash||[]),i.lineDashOffset=n.borderDashOffset,i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.stroke(),i.restore())};if(t.display)for(r=0,s=n.length;r<s;++r){const e=n[r];t.drawOnChartArea&&o({x:e.x1,y:e.y1},{x:e.x2,y:e.y2},e),t.drawTicks&&o({x:e.tx1,y:e.ty1},{x:e.tx2,y:e.ty2},{color:e.tickColor,width:e.tickWidth,borderDash:e.tickBorderDash,borderDashOffset:e.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:i,grid:n}}=this,r=i.setContext(this.getContext()),s=i.display?r.width:0;if(!s)return;const o=n.setContext(this.getContext(0)).lineWidth,a=this._borderValue;let l,c,u,h;this.isHorizontal()?(l=OT(e,this.left,s)-s/2,c=OT(e,this.right,o)+o/2,u=h=a):(u=OT(e,this.top,s)-s/2,h=OT(e,this.bottom,o)+o/2,l=c=a),t.save(),t.lineWidth=r.width,t.strokeStyle=r.color,t.beginPath(),t.moveTo(l,u),t.lineTo(c,h),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const t=this.ctx,i=this._computeLabelArea();i&&UT(t,i);const n=this.getLabelItems(e);for(const e of n){const i=e.options,n=e.font;qT(t,e.label,0,e.textOffset,n,i)}i&&VT(t)}drawTitle(){const{ctx:e,options:{position:t,title:i,reverse:n}}=this;if(!i.display)return;const r=iE(i.font),s=tE(i.padding),o=i.align;let a=r.lineHeight/2;"bottom"===t||"center"===t||dS(t)?(a+=s.bottom,hS(i.text)&&(a+=r.lineHeight*(i.text.length-1))):a+=s.top;const{titleX:l,titleY:c,maxWidth:u,rotation:h}=function(e,t,i,n){const{top:r,left:s,bottom:o,right:a,chart:l}=e,{chartArea:c,scales:u}=l;let h,d,p,f=0;const m=o-r,g=a-s;if(e.isHorizontal()){if(d=hT(n,s,a),dS(i)){const e=Object.keys(i)[0],n=i[e];p=u[e].getPixelForValue(n)+m-t}else p="center"===i?(c.bottom+c.top)/2+m-t:uI(e,i,t);h=a-s}else{if(dS(i)){const e=Object.keys(i)[0],n=i[e];d=u[e].getPixelForValue(n)-g+t}else d="center"===i?(c.left+c.right)/2-g+t:uI(e,i,t);p=hT(n,o,r),f="left"===i?-zS:zS}return{titleX:d,titleY:p,maxWidth:h,rotation:f}}(this,a,t,o);qT(e,i.text,0,0,r,{color:i.color,maxWidth:u,rotation:h,textAlign:gI(o,t,n),textBaseline:"middle",translation:[l,c]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,i=mS(e.grid&&e.grid.z,-1),n=mS(e.border&&e.border.z,0);return this._isVisible()&&this.draw===_I.prototype.draw?[{z:i,draw:e=>{this.drawBackground(),this.drawGrid(e),this.drawTitle()}},{z:n,draw:()=>{this.drawBorder()}},{z:t,draw:e=>{this.drawLabels(e)}}]:[{z:t,draw:e=>{this.draw(e)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",n=[];let r,s;for(r=0,s=t.length;r<s;++r){const s=t[r];s[i]!==this.id||e&&s.type!==e||n.push(s)}return n}_resolveTickFontOptions(e){return iE(this.options.ticks.setContext(this.getContext(e)).font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class yI{constructor(e,t,i){this.type=e,this.scope=t,this.override=i,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let i;(function(e){return"id"in e&&"defaults"in e})(t)&&(i=this.register(t));const n=this.items,r=e.id,s=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+e);return r in n||(n[r]=e,function(e,t,i){const n=SS(Object.create(null),[i?RT.get(i):{},RT.get(t),e.defaults]);RT.set(t,n),e.defaultRoutes&&function(e,t){Object.keys(t).forEach((i=>{const n=i.split("."),r=n.pop(),s=[e].concat(n).join("."),o=t[i].split("."),a=o.pop(),l=o.join(".");RT.route(s,r,l,a)}))}(t,e.defaultRoutes),e.descriptors&&RT.describe(t,e.descriptors)}(e,s,i),this.override&&RT.override(e.id,e.overrides)),s}get(e){return this.items[e]}unregister(e){const t=this.items,i=e.id,n=this.scope;i in t&&delete t[i],n&&i in RT[n]&&(delete RT[n][i],this.override&&delete IT[i])}}class vI{constructor(){this.controllers=new yI(dM,"datasets",!0),this.elements=new yI(lI,"elements"),this.plugins=new yI(Object,"plugins"),this.scales=new yI(_I,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,i){[...t].forEach((t=>{const n=i||this._getRegistryForType(t);i||n.isForType(t)||n===this.plugins&&t.id?this._exec(e,n,t):yS(t,(t=>{const n=i||this._getRegistryForType(t);this._exec(e,n,t)}))}))}_exec(e,t,i){const n=AS(e);_S(i["before"+n],[],i),t[e](i),_S(i["after"+n],[],i)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const i=this._typedRegistries[t];if(i.isForType(e))return i}return this.plugins}_get(e,t,i){const n=t.get(e);if(void 0===n)throw new Error('"'+e+'" is not a registered '+i+".");return n}}var xI=new vI;class bI{constructor(){this._init=[]}notify(e,t,i,n){"beforeInit"===t&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const r=n?this._descriptors(e).filter(n):this._descriptors(e),s=this._notify(r,e,t,i);return"afterDestroy"===t&&(this._notify(r,e,"stop"),this._notify(this._init,e,"uninstall")),s}_notify(e,t,i,n){n=n||{};for(const r of e){const e=r.plugin;if(!1===_S(e[i],[t,n,r.options],e)&&n.cancelable)return!1}return!0}invalidate(){uS(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const i=e&&e.config,n=mS(i.options&&i.options.plugins,{}),r=function(e){const t={},i=[],n=Object.keys(xI.plugins.items);for(let e=0;e<n.length;e++)i.push(xI.getPlugin(n[e]));const r=e.plugins||[];for(let e=0;e<r.length;e++){const n=r[e];-1===i.indexOf(n)&&(i.push(n),t[n.id]=!0)}return{plugins:i,localIds:t}}(i);return!1!==n||t?function(e,{plugins:t,localIds:i},n,r){const s=[],o=e.getContext();for(const a of t){const t=a.id,l=wI(n[t],r);null!==l&&s.push({plugin:a,options:SI(e.config,{plugin:a,local:i[t]},l,o)})}return s}(e,r,n,t):[]}_notifyStateChanges(e){const t=this._oldCache||[],i=this._cache,n=(e,t)=>e.filter((e=>!t.some((t=>e.plugin.id===t.plugin.id))));this._notify(n(t,i),e,"stop"),this._notify(n(i,t),e,"start")}}function wI(e,t){return t||!1!==e?!0===e?{}:e:null}function SI(e,{plugin:t,local:i},n,r){const s=e.pluginScopeKeys(t),o=e.getOptionScopes(n,s);return i&&t.defaults&&o.push(t.defaults),e.createResolver(o,r,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function TI(e,t){const i=RT.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||i.indexAxis||"x"}function EI(e){if("x"===e||"y"===e||"r"===e)return e}function MI(e,...t){if(EI(e))return e;for(const n of t){const t=n.axis||("top"===(i=n.position)||"bottom"===i?"x":"left"===i||"right"===i?"y":void 0)||e.length>1&&EI(e[0].toLowerCase());if(t)return t}var i;throw new Error(`Cannot determine type of '${e}' axis. Please provide 'axis' or 'position' option.`)}function II(e,t,i){if(i[t+"AxisID"]===e)return{axis:t}}function AI(e){const t=e.options||(e.options={});t.plugins=mS(t.plugins,{}),t.scales=function(e,t){const i=IT[e.type]||{scales:{}},n=t.scales||{},r=TI(e.type,t),s=Object.create(null);return Object.keys(n).forEach((t=>{const o=n[t];if(!dS(o))return console.error(`Invalid scale configuration for scale: ${t}`);if(o._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${t}`);const a=MI(t,o,function(e,t){if(t.data&&t.data.datasets){const i=t.data.datasets.filter((t=>t.xAxisID===e||t.yAxisID===e));if(i.length)return II(e,"x",i[0])||II(e,"y",i[0])}return{}}(t,e),RT.scales[o.type]),l=function(e,t){return e===t?"_index_":"_value_"}(a,r),c=i.scales||{};s[t]=TS(Object.create(null),[{axis:a},o,c[a],c[l]])})),e.data.datasets.forEach((i=>{const r=i.type||e.type,o=i.indexAxis||TI(r,t),a=(IT[r]||{}).scales||{};Object.keys(a).forEach((e=>{const t=function(e,t){let i=e;return"_index_"===e?i=t:"_value_"===e&&(i="x"===t?"y":"x"),i}(e,o),r=i[t+"AxisID"]||t;s[r]=s[r]||Object.create(null),TS(s[r],[{axis:t},n[r],a[e]])}))})),Object.keys(s).forEach((e=>{const t=s[e];TS(t,[RT.scales[t.type],RT.scale])})),s}(e,t)}function CI(e){return(e=e||{}).datasets=e.datasets||[],e.labels=e.labels||[],e}const PI=new Map,kI=new Set;function RI(e,t){let i=PI.get(e);return i||(i=t(),PI.set(e,i),kI.add(i)),i}const LI=(e,t,i)=>{const n=IS(t,i);void 0!==n&&e.add(n)};class DI{constructor(e){this._config=function(e){return(e=e||{}).data=CI(e.data),AI(e),e}(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=CI(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),AI(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return RI(e,(()=>[[`datasets.${e}`,""]]))}datasetAnimationScopeKeys(e,t){return RI(`${e}.transition.${t}`,(()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]]))}datasetElementScopeKeys(e,t){return RI(`${e}-${t}`,(()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]]))}pluginScopeKeys(e){const t=e.id;return RI(`${this.type}-plugin-${t}`,(()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]]))}_cachedScopes(e,t){const i=this._scopeCache;let n=i.get(e);return n&&!t||(n=new Map,i.set(e,n)),n}getOptionScopes(e,t,i){const{options:n,type:r}=this,s=this._cachedScopes(e,i),o=s.get(t);if(o)return o;const a=new Set;t.forEach((t=>{e&&(a.add(e),t.forEach((t=>LI(a,e,t)))),t.forEach((e=>LI(a,n,e))),t.forEach((e=>LI(a,IT[r]||{},e))),t.forEach((e=>LI(a,RT,e))),t.forEach((e=>LI(a,AT,e)))}));const l=Array.from(a);return 0===l.length&&l.push(Object.create(null)),kI.has(t)&&s.set(t,l),l}chartOptionScopes(){const{options:e,type:t}=this;return[e,IT[t]||{},RT.datasets[t]||{},{type:t},RT,AT]}resolveNamedOptions(e,t,i,n=[""]){const r={$shared:!0},{resolver:s,subPrefixes:o}=OI(this._resolverCache,e,n);let a=s;(function(e,t){const{isScriptable:i,isIndexable:n}=aE(e);for(const r of t){const t=i(r),s=n(r),o=(s||t)&&e[r];if(t&&(PS(o)||NI(o))||s&&hS(o))return!0}return!1})(s,t)&&(r.$shared=!1,a=oE(s,i=PS(i)?i():i,this.createResolver(e,i,o)));for(const e of t)r[e]=a[e];return r}createResolver(e,t,i=[""],n){const{resolver:r}=OI(this._resolverCache,e,i);return dS(t)?oE(r,t,void 0,n):r}}function OI(e,t,i){let n=e.get(t);n||(n=new Map,e.set(t,n));const r=i.join();let s=n.get(r);return s||(s={resolver:sE(t,i),subPrefixes:i.filter((e=>!e.toLowerCase().includes("hover")))},n.set(r,s)),s}const NI=e=>dS(e)&&Object.getOwnPropertyNames(e).some((t=>PS(e[t]))),zI=["top","bottom","left","right","chartArea"];function FI(e,t){return"top"===e||"bottom"===e||-1===zI.indexOf(e)&&"x"===t}function BI(e,t){return function(i,n){return i[e]===n[e]?i[t]-n[t]:i[e]-n[e]}}function UI(e){const t=e.chart,i=t.options.animation;t.notifyPlugins("afterRender"),_S(i&&i.onComplete,[e],t)}function VI(e){const t=e.chart,i=t.options.animation;_S(i&&i.onProgress,[e],t)}function jI(e){return EE()&&"string"==typeof e?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const GI={},HI=e=>{const t=jI(e);return Object.values(GI).filter((e=>e.canvas===t)).pop()};function WI(e,t,i){const n=Object.keys(e);for(const r of n){const n=+r;if(n>=t){const s=e[r];delete e[r],(i>0||n>t)&&(e[n+i]=s)}}}function qI(e,t,i){return e.options.clip?e[i]:t[i]}class $I{static defaults=RT;static instances=GI;static overrides=IT;static registry=xI;static version="4.4.2";static getChart=HI;static register(...e){xI.add(...e),ZI()}static unregister(...e){xI.remove(...e),ZI()}constructor(e,t){const i=this.config=new DI(t),n=jI(e),r=HI(n);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const s=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||function(e){return!EE()||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?qM:aI}(n)),this.platform.updateConfig(i);const o=this.platform.acquireContext(n,s.aspectRatio),a=o&&o.canvas,l=a&&a.height,c=a&&a.width;this.id=cS(),this.ctx=o,this.canvas=a,this.width=c,this.height=l,this._options=s,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new bI,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(e,t){let i;return function(...n){return t?(clearTimeout(i),i=setTimeout(e,t,n)):e.apply(this,n),t}}((e=>this.update(e)),s.resizeDelay||0),this._dataChanges=[],GI[this.id]=this,o&&a?(YE.listen(this,"complete",UI),YE.listen(this,"progress",VI),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:i,height:n,_aspectRatio:r}=this;return uS(e)?t&&r?r:n?i/n:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return xI}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():DE(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return NT(this.canvas,this.ctx),this}stop(){return YE.stop(this),this}resize(e,t){YE.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const i=this.options,n=this.canvas,r=i.maintainAspectRatio&&this.aspectRatio,s=this.platform.getMaximumSize(n,e,t,r),o=i.devicePixelRatio||this.platform.getDevicePixelRatio(),a=this.width?"resize":"attach";this.width=s.width,this.height=s.height,this._aspectRatio=this.aspectRatio,DE(this,o,!0)&&(this.notifyPlugins("resize",{size:s}),_S(i.onResize,[this,s],this),this.attached&&this._doResize(a)&&this.render())}ensureScalesHaveIDs(){yS(this.options.scales||{},((e,t)=>{e.id=t}))}buildOrUpdateScales(){const e=this.options,t=e.scales,i=this.scales,n=Object.keys(i).reduce(((e,t)=>(e[t]=!1,e)),{});let r=[];t&&(r=r.concat(Object.keys(t).map((e=>{const i=t[e],n=MI(e,i),r="r"===n,s="x"===n;return{options:i,dposition:r?"chartArea":s?"bottom":"left",dtype:r?"radialLinear":s?"category":"linear"}})))),yS(r,(t=>{const r=t.options,s=r.id,o=MI(s,r),a=mS(r.type,t.dtype);void 0!==r.position&&FI(r.position,o)===FI(t.dposition)||(r.position=t.dposition),n[s]=!0;let l=null;s in i&&i[s].type===a?l=i[s]:(l=new(xI.getScale(a))({id:s,type:a,ctx:this.ctx,chart:this}),i[l.id]=l),l.init(r,e)})),yS(n,((e,t)=>{e||delete i[t]})),yS(i,(e=>{HM.configure(this,e,e.options),HM.addBox(this,e)}))}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,i=e.length;if(e.sort(((e,t)=>e.index-t.index)),i>t){for(let e=t;e<i;++e)this._destroyDatasetMeta(e);e.splice(t,i-t)}this._sortedMetasets=e.slice(0).sort(BI("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach(((e,i)=>{0===t.filter((t=>t===e._dataset)).length&&this._destroyDatasetMeta(i)}))}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let i,n;for(this._removeUnreferencedMetasets(),i=0,n=t.length;i<n;i++){const n=t[i];let r=this.getDatasetMeta(i);const s=n.type||this.config.type;if(r.type&&r.type!==s&&(this._destroyDatasetMeta(i),r=this.getDatasetMeta(i)),r.type=s,r.indexAxis=n.indexAxis||TI(s,this.options),r.order=n.order||0,r.index=i,r.label=""+n.label,r.visible=this.isDatasetVisible(i),r.controller)r.controller.updateIndex(i),r.controller.linkScales();else{const t=xI.getController(s),{datasetElementType:n,dataElementType:o}=RT.datasets[s];Object.assign(t,{dataElementType:xI.getElement(o),datasetElementType:n&&xI.getElement(n)}),r.controller=new t(this,i),e.push(r.controller)}}return this._updateMetasets(),e}_resetElements(){yS(this.data.datasets,((e,t)=>{this.getDatasetMeta(t).controller.reset()}),this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const i=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),n=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0}))return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let s=0;for(let e=0,t=this.data.datasets.length;e<t;e++){const{controller:t}=this.getDatasetMeta(e),i=!n&&-1===r.indexOf(t);t.buildOrUpdateElements(i),s=Math.max(+t.getMaxOverflow(),s)}s=this._minPadding=i.layout.autoPadding?s:0,this._updateLayout(s),n||yS(r,(e=>{e.reset()})),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(BI("z","_idx"));const{_active:o,_lastEvent:a}=this;a?this._eventHandler(a,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){yS(this.scales,(e=>{HM.removeBox(this,e)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),i=new Set(e.events);kS(t,i)&&!!this._responsiveListeners===e.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:i,start:n,count:r}of t)WI(e,n,"_removeElements"===i?-r:r)}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,i=t=>new Set(e.filter((e=>e[0]===t)).map(((e,t)=>t+","+e.splice(1).join(",")))),n=i(0);for(let e=1;e<t;e++)if(!kS(n,i(e)))return;return Array.from(n).map((e=>e.split(","))).map((e=>({method:e[1],start:+e[2],count:+e[3]})))}_updateLayout(e){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;HM.update(this,this.width,this.height,e);const t=this.chartArea,i=t.width<=0||t.height<=0;this._layers=[],yS(this.boxes,(e=>{i&&"chartArea"===e.position||(e.configure&&e.configure(),this._layers.push(...e._layers()))}),this),this._layers.forEach(((e,t)=>{e._idx=t})),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})){for(let e=0,t=this.data.datasets.length;e<t;++e)this.getDatasetMeta(e).controller.configure();for(let t=0,i=this.data.datasets.length;t<i;++t)this._updateDataset(t,PS(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const i=this.getDatasetMeta(e),n={meta:i,index:e,mode:t,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",n)&&(i.controller._update(t),n.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",n))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(YE.has(this)?this.attached&&!YE.running(this)&&YE.start(this):(this.draw(),UI({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:e,height:t}=this._resizeBeforeDraw;this._resize(e,t),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,i=[];let n,r;for(n=0,r=t.length;n<r;++n){const r=t[n];e&&!r.visible||i.push(r)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,i=e._clip,n=!i.disabled,r=function(e,t){const{xScale:i,yScale:n}=e;return i&&n?{left:qI(i,t,"left"),right:qI(i,t,"right"),top:qI(n,t,"top"),bottom:qI(n,t,"bottom")}:t}(e,this.chartArea),s={meta:e,index:e.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",s)&&(n&&UT(t,{left:!1===i.left?0:r.left-i.left,right:!1===i.right?this.width:r.right+i.right,top:!1===i.top?0:r.top-i.top,bottom:!1===i.bottom?this.height:r.bottom+i.bottom}),e.controller.draw(),n&&VT(t),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(e){return BT(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,i,n){const r=RM.modes[t];return"function"==typeof r?r(this,e,i,n):[]}getDatasetMeta(e){const t=this.data.datasets[e],i=this._metasets;let n=i.filter((e=>e&&e._dataset===t)).pop();return n||(n={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},i.push(n)),n}getContext(){return this.$context||(this.$context=rE(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const i=this.getDatasetMeta(e);return"boolean"==typeof i.hidden?!i.hidden:!t.hidden}setDatasetVisibility(e,t){this.getDatasetMeta(e).hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,i){const n=i?"show":"hide",r=this.getDatasetMeta(e),s=r.controller._resolveAnimations(void 0,n);CS(t)?(r.data[t].hidden=!i,this.update()):(this.setDatasetVisibility(e,i),s.update(r,{visible:i}),this.update((t=>t.datasetIndex===e?n:void 0)))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),YE.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),NT(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete GI[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,i=(i,n)=>{t.addEventListener(this,i,n),e[i]=n},n=(e,t,i)=>{e.offsetX=t,e.offsetY=i,this._eventHandler(e)};yS(this.options.events,(e=>i(e,n)))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,i=(i,n)=>{t.addEventListener(this,i,n),e[i]=n},n=(i,n)=>{e[i]&&(t.removeEventListener(this,i,n),delete e[i])},r=(e,t)=>{this.canvas&&this.resize(e,t)};let s;const o=()=>{n("attach",o),this.attached=!0,this.resize(),i("resize",r),i("detach",s)};s=()=>{this.attached=!1,n("resize",r),this._stop(),this._resize(0,0),i("attach",o)},t.isAttached(this.canvas)?o():s()}unbindEvents(){yS(this._listeners,((e,t)=>{this.platform.removeEventListener(this,t,e)})),this._listeners={},yS(this._responsiveListeners,((e,t)=>{this.platform.removeEventListener(this,t,e)})),this._responsiveListeners=void 0}updateHoverStyle(e,t,i){const n=i?"set":"remove";let r,s,o,a;for("dataset"===t&&(r=this.getDatasetMeta(e[0].datasetIndex),r.controller["_"+n+"DatasetHoverStyle"]()),o=0,a=e.length;o<a;++o){s=e[o];const t=s&&this.getDatasetMeta(s.datasetIndex).controller;t&&t[n+"HoverStyle"](s.element,s.datasetIndex,s.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],i=e.map((({datasetIndex:e,index:t})=>{const i=this.getDatasetMeta(e);if(!i)throw new Error("No dataset found at index "+e);return{datasetIndex:e,element:i.data[t],index:t}}));!vS(i,t)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,t))}notifyPlugins(e,t,i){return this._plugins.notify(this,e,t,i)}isPluginEnabled(e){return 1===this._plugins._cache.filter((t=>t.plugin.id===e)).length}_updateHoverStyles(e,t,i){const n=this.options.hover,r=(e,t)=>e.filter((e=>!t.some((t=>e.datasetIndex===t.datasetIndex&&e.index===t.index)))),s=r(t,e),o=i?e:r(e,t);s.length&&this.updateHoverStyle(s,n.mode,!1),o.length&&n.mode&&this.updateHoverStyle(o,n.mode,!0)}_eventHandler(e,t){const i={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},n=t=>(t.options.events||this.options.events).includes(e.native.type);if(!1===this.notifyPlugins("beforeEvent",i,n))return;const r=this._handleEvent(e,t,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,n),(r||i.changed)&&this.render(),this}_handleEvent(e,t,i){const{_active:n=[],options:r}=this,s=t,o=this._getActiveElements(e,n,i,s),a=function(e){return"mouseup"===e.type||"click"===e.type||"contextmenu"===e.type}(e),l=function(e,t,i,n){return i&&"mouseout"!==e.type?n?t:e:null}(e,this._lastEvent,i,a);i&&(this._lastEvent=null,_S(r.onHover,[e,o,this],this),a&&_S(r.onClick,[e,o,this],this));const c=!vS(o,n);return(c||t)&&(this._active=o,this._updateHoverStyles(o,n,t)),this._lastEvent=l,c}_getActiveElements(e,t,i,n){if("mouseout"===e.type)return[];if(!i)return t;const r=this.options.hover;return this.getElementsAtEventForMode(e,r.mode,r,n)}}function ZI(){return yS($I.instances,(e=>e._plugins.invalidate()))}function XI(e,t,i,n){return{x:i+e*Math.cos(t),y:n+e*Math.sin(t)}}function YI(e,t,i,n,r,s){const{x:o,y:a,startAngle:l,pixelMargin:c,innerRadius:u}=t,h=Math.max(t.outerRadius+n+i-c,0),d=u>0?u+n+i+c:0;let p=0;const f=r-l;if(n){const e=((u>0?u-n:0)+(h>0?h-n:0))/2;p=(f-(0!==e?f*e/(e+n):f))/2}const m=(f-Math.max(.001,f*h-i/RS)/h)/2,g=l+m+p,_=r-m-p,{outerStart:y,outerEnd:v,innerStart:x,innerEnd:b}=function(e,t,i,n){const r=JT(e.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]),s=(i-t)/2,o=Math.min(s,n*t/2),a=e=>{const t=(i-Math.min(s,e))*n/2;return eT(e,0,Math.min(s,t))};return{outerStart:a(r.outerStart),outerEnd:a(r.outerEnd),innerStart:eT(r.innerStart,0,o),innerEnd:eT(r.innerEnd,0,o)}}(t,d,h,_-g),w=h-y,S=h-v,T=g+y/w,E=_-v/S,M=d+x,I=d+b,A=g+x/M,C=_-b/I;if(e.beginPath(),s){const t=(T+E)/2;if(e.arc(o,a,h,T,t),e.arc(o,a,h,t,E),v>0){const t=XI(S,E,o,a);e.arc(t.x,t.y,v,E,_+zS)}const i=XI(I,_,o,a);if(e.lineTo(i.x,i.y),b>0){const t=XI(I,C,o,a);e.arc(t.x,t.y,b,_+zS,C+Math.PI)}const n=(_-b/d+(g+x/d))/2;if(e.arc(o,a,d,_-b/d,n,!0),e.arc(o,a,d,n,g+x/d,!0),x>0){const t=XI(M,A,o,a);e.arc(t.x,t.y,x,A+Math.PI,g-zS)}const r=XI(w,g,o,a);if(e.lineTo(r.x,r.y),y>0){const t=XI(w,T,o,a);e.arc(t.x,t.y,y,g-zS,T)}}else{e.moveTo(o,a);const t=Math.cos(T)*h+o,i=Math.sin(T)*h+a;e.lineTo(t,i);const n=Math.cos(E)*h+o,r=Math.sin(E)*h+a;e.lineTo(n,r)}e.closePath()}function KI(e,t,i=t){e.lineCap=mS(i.borderCapStyle,t.borderCapStyle),e.setLineDash(mS(i.borderDash,t.borderDash)),e.lineDashOffset=mS(i.borderDashOffset,t.borderDashOffset),e.lineJoin=mS(i.borderJoinStyle,t.borderJoinStyle),e.lineWidth=mS(i.borderWidth,t.borderWidth),e.strokeStyle=mS(i.borderColor,t.borderColor)}function JI(e,t,i){e.lineTo(i.x,i.y)}function QI(e,t,i={}){const n=e.length,{start:r=0,end:s=n-1}=i,{start:o,end:a}=t,l=Math.max(r,o),c=Math.min(s,a),u=r<o&&s<o||r>a&&s>a;return{count:n,start:l,loop:t.loop,ilen:c<l&&!u?n+c-l:c-l}}function eA(e,t,i,n){const{points:r,options:s}=t,{count:o,start:a,loop:l,ilen:c}=QI(r,i,n),u=function(e){return e.stepped?jT:e.tension||"monotone"===e.cubicInterpolationMode?GT:JI}(s);let h,d,p,{move:f=!0,reverse:m}=n||{};for(h=0;h<=c;++h)d=r[(a+(m?c-h:h))%o],d.skip||(f?(e.moveTo(d.x,d.y),f=!1):u(e,p,d,m,s.stepped),p=d);return l&&(d=r[(a+(m?c:0))%o],u(e,p,d,m,s.stepped)),!!l}function tA(e,t,i,n){const r=t.points,{count:s,start:o,ilen:a}=QI(r,i,n),{move:l=!0,reverse:c}=n||{};let u,h,d,p,f,m,g=0,_=0;const y=e=>(o+(c?a-e:e))%s,v=()=>{p!==f&&(e.lineTo(g,f),e.lineTo(g,p),e.lineTo(g,m))};for(l&&(h=r[y(0)],e.moveTo(h.x,h.y)),u=0;u<=a;++u){if(h=r[y(u)],h.skip)continue;const t=h.x,i=h.y,n=0|t;n===d?(i<p?p=i:i>f&&(f=i),g=(_*g+t)/++_):(v(),e.lineTo(t,i),d=n,_=0,p=f=i),m=i}v()}function iA(e){const t=e.options,i=t.borderDash&&t.borderDash.length;return e._decimated||e._loop||t.tension||"monotone"===t.cubicInterpolationMode||t.stepped||i?eA:tA}const nA="function"==typeof Path2D;class rA extends lI{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:e=>"borderDash"!==e&&"fill"!==e};constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const i=this.options;if((i.tension||"monotone"===i.cubicInterpolationMode)&&!i.stepped&&!this._pointsUpdated){const n=i.spanGaps?this._loop:this._fullLoop;TE(this._points,i,e,n,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(e,t){const i=e.points,n=e.options.spanGaps,r=i.length;if(!r)return[];const s=!!e._loop,{start:o,end:a}=function(e,t,i,n){let r=0,s=t-1;if(i&&!n)for(;r<t&&!e[r].skip;)r++;for(;r<t&&e[r].skip;)r++;for(r%=t,i&&(s+=r);s>r&&e[s%t].skip;)s--;return s%=t,{start:r,end:s}}(i,r,s,n);return function(e,t,i,n){return n&&n.setContext&&i?function(e,t,i,n){const r=e._chart.getContext(),s=$E(e.options),{_datasetIndex:o,options:{spanGaps:a}}=e,l=i.length,c=[];let u=s,h=t[0].start,d=h;function p(e,t,n,r){const s=a?-1:1;if(e!==t){for(e+=l;i[e%l].skip;)e-=s;for(;i[t%l].skip;)t+=s;e%l!=t%l&&(c.push({start:e%l,end:t%l,loop:n,style:r}),u=r,h=t%l)}}for(const e of t){h=a?h:e.start;let t,s=i[h%l];for(d=h+1;d<=e.end;d++){const a=i[d%l];t=$E(n.setContext(rE(r,{type:"segment",p0:s,p1:a,p0DataIndex:(d-1)%l,p1DataIndex:d%l,datasetIndex:o}))),ZE(t,u)&&p(h,d-1,e.loop,u),s=a,u=t}h<d-1&&p(h,d-1,e.loop,u)}return c}(e,t,i,n):t}(e,!0===n?[{start:o,end:a,loop:s}]:function(e,t,i,n){const r=e.length,s=[];let o,a=t,l=e[t];for(o=t+1;o<=i;++o){const i=e[o%r];i.skip||i.stop?l.skip||(n=!1,s.push({start:t%r,end:(o-1)%r,loop:n}),t=a=i.stop?o:null):(a=o,l.skip&&(t=o)),l=i}return null!==a&&s.push({start:t%r,end:a%r,loop:n}),s}(i,o,a<o?a+r:a,!!e._fullLoop&&0===o&&a===r-1),i,t)}(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,i=e.length;return i&&t[e[i-1].end]}interpolate(e,t){const i=this.options,n=e[t],r=this.points,s=qE(this,{property:t,start:n,end:n});if(!s.length)return;const o=[],a=function(e){return e.stepped?FE:e.tension||"monotone"===e.cubicInterpolationMode?BE:zE}(i);let l,c;for(l=0,c=s.length;l<c;++l){const{start:c,end:u}=s[l],h=r[c],d=r[u];if(h===d){o.push(h);continue}const p=a(h,d,Math.abs((n-h[t])/(d[t]-h[t])),i.stepped);p[t]=e[t],o.push(p)}return 1===o.length?o[0]:o}pathSegment(e,t,i){return iA(this)(e,this,t,i)}path(e,t,i){const n=this.segments,r=iA(this);let s=this._loop;t=t||0,i=i||this.points.length-t;for(const o of n)s&=r(e,this,o,{start:t,end:t+i-1});return!!s}draw(e,t,i,n){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(e.save(),function(e,t,i,n){nA&&!t.options.segment?function(e,t,i,n){let r=t._path;r||(r=t._path=new Path2D,t.path(r,i,n)&&r.closePath()),KI(e,t.options),e.stroke(r)}(e,t,i,n):function(e,t,i,n){const{segments:r,options:s}=t,o=iA(t);for(const a of r)KI(e,s,a.style),e.beginPath(),o(e,t,a,{start:i,end:i+n-1})&&e.closePath(),e.stroke()}(e,t,i,n)}(e,this,i,n),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function sA(e,t,i,n){const r=e.options,{[i]:s}=e.getProps([i],n);return Math.abs(t-s)<r.radius+r.hitRadius}function oA(e,t){const{x:i,y:n,base:r,width:s,height:o}=e.getProps(["x","y","base","width","height"],t);let a,l,c,u,h;return e.horizontal?(h=o/2,a=Math.min(i,r),l=Math.max(i,r),c=n-h,u=n+h):(h=s/2,a=i-h,l=i+h,c=Math.min(n,r),u=Math.max(n,r)),{left:a,top:c,right:l,bottom:u}}function aA(e,t,i,n){return e?0:eT(t,i,n)}function lA(e,t,i,n){const r=null===t,s=null===i,o=e&&!(r&&s)&&oA(e,n);return o&&(r||tT(t,o.left,o.right))&&(s||tT(i,o.top,o.bottom))}function cA(e,t){e.rect(t.x,t.y,t.w,t.h)}function uA(e,t,i={}){const n=e.x!==i.x?-t:0,r=e.y!==i.y?-t:0,s=(e.x+e.w!==i.x+i.w?t:0)-n,o=(e.y+e.h!==i.y+i.h?t:0)-r;return{x:e.x+n,y:e.y+r,w:e.w+s,h:e.h+o,radius:e.radius}}var hA=Object.freeze({__proto__:null,ArcElement:class extends lI{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:e=>"borderDash"!==e};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,i){const n=this.getProps(["x","y"],i),{angle:r,distance:s}=XS(n,{x:e,y:t}),{startAngle:o,endAngle:a,innerRadius:l,outerRadius:c,circumference:u}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),h=(this.options.spacing+this.options.borderWidth)/2,d=mS(u,a-o)>=LS||QS(r,o,a),p=tT(s,l+h,c+h);return d&&p}getCenterPoint(e){const{x:t,y:i,startAngle:n,endAngle:r,innerRadius:s,outerRadius:o}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:a,spacing:l}=this.options,c=(n+r)/2,u=(s+o+l+a)/2;return{x:t+Math.cos(c)*u,y:i+Math.sin(c)*u}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:t,circumference:i}=this,n=(t.offset||0)/4,r=(t.spacing||0)/2,s=t.circular;if(this.pixelMargin="inner"===t.borderAlign?.33:0,this.fullCircles=i>LS?Math.floor(i/LS):0,0===i||this.innerRadius<0||this.outerRadius<0)return;e.save();const o=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(o)*n,Math.sin(o)*n);const a=n*(1-Math.sin(Math.min(RS,i||0)));e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,function(e,t,i,n,r){const{fullCircles:s,startAngle:o,circumference:a}=t;let l=t.endAngle;if(s){YI(e,t,i,n,l,r);for(let t=0;t<s;++t)e.fill();isNaN(a)||(l=o+(a%LS||LS))}YI(e,t,i,n,l,r),e.fill()}(e,this,a,r,s),function(e,t,i,n,r){const{fullCircles:s,startAngle:o,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:u,borderDash:h,borderDashOffset:d}=l,p="inner"===l.borderAlign;if(!c)return;e.setLineDash(h||[]),e.lineDashOffset=d,p?(e.lineWidth=2*c,e.lineJoin=u||"round"):(e.lineWidth=c,e.lineJoin=u||"bevel");let f=t.endAngle;if(s){YI(e,t,i,n,f,r);for(let t=0;t<s;++t)e.stroke();isNaN(a)||(f=o+(a%LS||LS))}p&&function(e,t,i){const{startAngle:n,pixelMargin:r,x:s,y:o,outerRadius:a,innerRadius:l}=t;let c=r/a;e.beginPath(),e.arc(s,o,a,n-c,i+c),l>r?(c=r/l,e.arc(s,o,l,i+c,n-c,!0)):e.arc(s,o,r,i+zS,n-zS),e.closePath(),e.clip()}(e,t,f),s||(YI(e,t,i,n,f,r),e.stroke())}(e,this,a,r,s),e.restore()}},BarElement:class extends lI{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:i,backgroundColor:n}}=this,{inner:r,outer:s}=function(e){const t=oA(e),i=t.right-t.left,n=t.bottom-t.top,r=function(e,t,i){const n=e.options.borderWidth,r=e.borderSkipped,s=QT(n);return{t:aA(r.top,s.top,0,i),r:aA(r.right,s.right,0,t),b:aA(r.bottom,s.bottom,0,i),l:aA(r.left,s.left,0,t)}}(e,i/2,n/2),s=function(e,t,i){const{enableBorderRadius:n}=e.getProps(["enableBorderRadius"]),r=e.options.borderRadius,s=eE(r),o=Math.min(t,i),a=e.borderSkipped,l=n||dS(r);return{topLeft:aA(!l||a.top||a.left,s.topLeft,0,o),topRight:aA(!l||a.top||a.right,s.topRight,0,o),bottomLeft:aA(!l||a.bottom||a.left,s.bottomLeft,0,o),bottomRight:aA(!l||a.bottom||a.right,s.bottomRight,0,o)}}(e,i/2,n/2);return{outer:{x:t.left,y:t.top,w:i,h:n,radius:s},inner:{x:t.left+r.l,y:t.top+r.t,w:i-r.l-r.r,h:n-r.t-r.b,radius:{topLeft:Math.max(0,s.topLeft-Math.max(r.t,r.l)),topRight:Math.max(0,s.topRight-Math.max(r.t,r.r)),bottomLeft:Math.max(0,s.bottomLeft-Math.max(r.b,r.l)),bottomRight:Math.max(0,s.bottomRight-Math.max(r.b,r.r))}}}}(this),o=(a=s.radius).topLeft||a.topRight||a.bottomLeft||a.bottomRight?$T:cA;var a;e.save(),s.w===r.w&&s.h===r.h||(e.beginPath(),o(e,uA(s,t,r)),e.clip(),o(e,uA(r,-t,s)),e.fillStyle=i,e.fill("evenodd")),e.beginPath(),o(e,uA(r,t)),e.fillStyle=n,e.fill(),e.restore()}inRange(e,t,i){return lA(this,e,t,i)}inXRange(e,t){return lA(this,e,null,t)}inYRange(e,t){return lA(this,null,e,t)}getCenterPoint(e){const{x:t,y:i,base:n,horizontal:r}=this.getProps(["x","y","base","horizontal"],e);return{x:r?(t+n)/2:t,y:r?i:(i+n)/2}}getRange(e){return"x"===e?this.width/2:this.height/2}},LineElement:rA,PointElement:class extends lI{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,i){const n=this.options,{x:r,y:s}=this.getProps(["x","y"],i);return Math.pow(e-r,2)+Math.pow(t-s,2)<Math.pow(n.hitRadius+n.radius,2)}inXRange(e,t){return sA(this,e,"x",t)}inYRange(e,t){return sA(this,e,"y",t)}getCenterPoint(e){const{x:t,y:i}=this.getProps(["x","y"],e);return{x:t,y:i}}size(e){let t=(e=e||this.options||{}).radius||0;return t=Math.max(t,t&&e.hoverRadius||0),2*(t+(t&&e.borderWidth||0))}draw(e,t){const i=this.options;this.skip||i.radius<.1||!BT(this,t,this.size(i)/2)||(e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.fillStyle=i.backgroundColor,zT(e,i,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}});const dA=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],pA=dA.map((e=>e.replace("rgb(","rgba(").replace(")",", 0.5)")));function fA(e){return dA[e%dA.length]}function mA(e){return pA[e%pA.length]}function gA(e){let t;for(t in e)if(e[t].borderColor||e[t].backgroundColor)return!0;return!1}var _A={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(e,t,i){if(!i.enabled)return;const{data:{datasets:n},options:r}=e.config,{elements:s}=r;if(!i.forceOverride&&(gA(n)||(o=r)&&(o.borderColor||o.backgroundColor)||s&&gA(s)))return;var o;const a=function(e){let t=0;return(i,n)=>{const r=e.getDatasetMeta(n).controller;r instanceof bM?t=function(e,t){return e.backgroundColor=e.data.map((()=>fA(t++))),t}(i,t):r instanceof wM?t=function(e,t){return e.backgroundColor=e.data.map((()=>mA(t++))),t}(i,t):r&&(t=function(e,t){return e.borderColor=fA(t),e.backgroundColor=mA(t),++t}(i,t))}}(e);n.forEach(a)}};function yA(e){if(e._decimated){const t=e._data;delete e._decimated,delete e._data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function vA(e){e.data.datasets.forEach((e=>{yA(e)}))}var xA={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(e,t,i)=>{if(!i.enabled)return void vA(e);const n=e.width;e.data.datasets.forEach(((t,r)=>{const{_data:s,indexAxis:o}=t,a=e.getDatasetMeta(r),l=s||t.data;if("y"===nE([o,e.options.indexAxis]))return;if(!a.controller.supportsDecimation)return;const c=e.scales[a.xAxisID];if("linear"!==c.type&&"time"!==c.type)return;if(e.options.parsing)return;let u,{start:h,count:d}=function(e,t){const i=t.length;let n,r=0;const{iScale:s}=e,{min:o,max:a,minDefined:l,maxDefined:c}=s.getUserBounds();return l&&(r=eT(nT(t,s.axis,o).lo,0,i-1)),n=c?eT(nT(t,s.axis,a).hi+1,r,i)-r:i-r,{start:r,count:n}}(a,l);if(d<=(i.threshold||4*n))yA(t);else{switch(uS(s)&&(t._data=l,delete t.data,Object.defineProperty(t,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(e){this._data=e}})),i.algorithm){case"lttb":u=function(e,t,i,n,r){const s=r.samples||n;if(s>=i)return e.slice(t,t+i);const o=[],a=(i-2)/(s-2);let l=0;const c=t+i-1;let u,h,d,p,f,m=t;for(o[l++]=e[m],u=0;u<s-2;u++){let n,r=0,s=0;const c=Math.floor((u+1)*a)+1+t,g=Math.min(Math.floor((u+2)*a)+1,i)+t,_=g-c;for(n=c;n<g;n++)r+=e[n].x,s+=e[n].y;r/=_,s/=_;const y=Math.floor(u*a)+1+t,v=Math.min(Math.floor((u+1)*a)+1,i)+t,{x,y:b}=e[m];for(d=p=-1,n=y;n<v;n++)p=.5*Math.abs((x-r)*(e[n].y-b)-(x-e[n].x)*(s-b)),p>d&&(d=p,h=e[n],f=n);o[l++]=h,m=f}return o[l++]=e[c],o}(l,h,d,n,i);break;case"min-max":u=function(e,t,i,n){let r,s,o,a,l,c,u,h,d,p,f=0,m=0;const g=[],_=t+i-1,y=e[t].x,v=e[_].x-y;for(r=t;r<t+i;++r){s=e[r],o=(s.x-y)/v*n,a=s.y;const t=0|o;if(t===l)a<d?(d=a,c=r):a>p&&(p=a,u=r),f=(m*f+s.x)/++m;else{const i=r-1;if(!uS(c)&&!uS(u)){const t=Math.min(c,u),n=Math.max(c,u);t!==h&&t!==i&&g.push({...e[t],x:f}),n!==h&&n!==i&&g.push({...e[n],x:f})}r>0&&i!==h&&g.push(e[i]),g.push(s),l=t,m=0,d=p=a,c=u=h=r}}return g}(l,h,d,n);break;default:throw new Error(`Unsupported decimation algorithm '${i.algorithm}'`)}t._decimated=u}}))},destroy(e){vA(e)}};function bA(e,t,i,n){if(n)return;let r=t[e],s=i[e];return"angle"===e&&(r=JS(r),s=JS(s)),{property:e,start:r,end:s}}function wA(e,t,i){for(;t>e;t--){const e=i[t];if(!isNaN(e.x)&&!isNaN(e.y))break}return t}function SA(e,t,i,n){return e&&t?n(e[i],t[i]):e?e[i]:t?t[i]:0}function TA(e,t){let i=[],n=!1;return hS(e)?(n=!0,i=e):i=function(e,t){const{x:i=null,y:n=null}=e||{},r=t.points,s=[];return t.segments.forEach((({start:e,end:t})=>{t=wA(e,t,r);const o=r[e],a=r[t];null!==n?(s.push({x:o.x,y:n}),s.push({x:a.x,y:n})):null!==i&&(s.push({x:i,y:o.y}),s.push({x:i,y:a.y}))})),s}(e,t),i.length?new rA({points:i,options:{tension:0},_loop:n,_fullLoop:n}):null}function EA(e){return e&&!1!==e.fill}function MA(e,t,i){let n=e[t].fill;const r=[t];let s;if(!i)return n;for(;!1!==n&&-1===r.indexOf(n);){if(!pS(n))return n;if(s=e[n],!s)return!1;if(s.visible)return n;r.push(n),n=s.fill}return!1}function IA(e,t,i){const n=function(e){const t=e.options,i=t.fill;let n=mS(i&&i.target,i);return void 0===n&&(n=!!t.backgroundColor),!1!==n&&null!==n&&(!0===n?"origin":n)}(e);if(dS(n))return!isNaN(n.value)&&n;let r=parseFloat(n);return pS(r)&&Math.floor(r)===r?function(e,t,i,n){return"-"!==e&&"+"!==e||(i=t+i),!(i===t||i<0||i>=n)&&i}(n[0],t,r,i):["origin","start","end","stack","shape"].indexOf(n)>=0&&n}function AA(e,t,i){const n=[];for(let r=0;r<i.length;r++){const s=i[r],{first:o,last:a,point:l}=CA(s,t,"x");if(!(!l||o&&a))if(o)n.unshift(l);else if(e.push(l),!a)break}e.push(...n)}function CA(e,t,i){const n=e.interpolate(t,i);if(!n)return{};const r=n[i],s=e.segments,o=e.points;let a=!1,l=!1;for(let e=0;e<s.length;e++){const t=s[e],n=o[t.start][i],c=o[t.end][i];if(tT(r,n,c)){a=r===n,l=r===c;break}}return{first:a,last:l,point:n}}class PA{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,i){const{x:n,y:r,radius:s}=this;return t=t||{start:0,end:LS},e.arc(n,r,s,t.end,t.start,!0),!i.bounds}interpolate(e){const{x:t,y:i,radius:n}=this,r=e.angle;return{x:t+Math.cos(r)*n,y:i+Math.sin(r)*n,angle:r}}}function kA(e,t,i){const n=function(e){const{chart:t,fill:i,line:n}=e;if(pS(i))return function(e,t){const i=e.getDatasetMeta(t);return i&&e.isDatasetVisible(t)?i.dataset:null}(t,i);if("stack"===i)return function(e){const{scale:t,index:i,line:n}=e,r=[],s=n.segments,o=n.points,a=function(e,t){const i=[],n=e.getMatchingVisibleMetas("line");for(let e=0;e<n.length;e++){const r=n[e];if(r.index===t)break;r.hidden||i.unshift(r.dataset)}return i}(t,i);a.push(TA({x:null,y:t.bottom},n));for(let e=0;e<s.length;e++){const t=s[e];for(let e=t.start;e<=t.end;e++)AA(r,o[e],a)}return new rA({points:r,options:{}})}(e);if("shape"===i)return!0;const r=function(e){return(e.scale||{}).getPointPositionForValue?function(e){const{scale:t,fill:i}=e,n=t.options,r=t.getLabels().length,s=n.reverse?t.max:t.min,o=function(e,t,i){let n;return n="start"===e?i:"end"===e?t.options.reverse?t.min:t.max:dS(e)?e.value:t.getBaseValue(),n}(i,t,s),a=[];if(n.grid.circular){const e=t.getPointPositionForValue(0,s);return new PA({x:e.x,y:e.y,radius:t.getDistanceFromCenterForValue(o)})}for(let e=0;e<r;++e)a.push(t.getPointPositionForValue(e,o));return a}(e):function(e){const{scale:t={},fill:i}=e,n=function(e,t){let i=null;return"start"===e?i=t.bottom:"end"===e?i=t.top:dS(e)?i=t.getPixelForValue(e.value):t.getBasePixel&&(i=t.getBasePixel()),i}(i,t);if(pS(n)){const e=t.isHorizontal();return{x:e?n:null,y:e?null:n}}return null}(e)}(e);return r instanceof PA?r:TA(r,n)}(t),{line:r,scale:s,axis:o}=t,a=r.options,l=a.fill,c=a.backgroundColor,{above:u=c,below:h=c}=l||{};n&&r.points.length&&(UT(e,i),function(e,t){const{line:i,target:n,above:r,below:s,area:o,scale:a}=t,l=i._loop?"angle":t.axis;e.save(),"x"===l&&s!==r&&(RA(e,n,o.top),LA(e,{line:i,target:n,color:r,scale:a,property:l}),e.restore(),e.save(),RA(e,n,o.bottom)),LA(e,{line:i,target:n,color:s,scale:a,property:l}),e.restore()}(e,{line:r,target:n,above:u,below:h,area:i,scale:s,axis:o}),VT(e))}function RA(e,t,i){const{segments:n,points:r}=t;let s=!0,o=!1;e.beginPath();for(const a of n){const{start:n,end:l}=a,c=r[n],u=r[wA(n,l,r)];s?(e.moveTo(c.x,c.y),s=!1):(e.lineTo(c.x,i),e.lineTo(c.x,c.y)),o=!!t.pathSegment(e,a,{move:o}),o?e.closePath():e.lineTo(u.x,i)}e.lineTo(t.first().x,i),e.closePath(),e.clip()}function LA(e,t){const{line:i,target:n,property:r,color:s,scale:o}=t,a=function(e,t,i){const n=e.segments,r=e.points,s=t.points,o=[];for(const e of n){let{start:n,end:a}=e;a=wA(n,a,r);const l=bA(i,r[n],r[a],e.loop);if(!t.segments){o.push({source:e,target:l,start:r[n],end:r[a]});continue}const c=qE(t,l);for(const t of c){const n=bA(i,s[t.start],s[t.end],t.loop),a=WE(e,r,n);for(const e of a)o.push({source:e,target:t,start:{[i]:SA(l,n,"start",Math.max)},end:{[i]:SA(l,n,"end",Math.min)}})}}return o}(i,n,r);for(const{source:t,target:l,start:c,end:u}of a){const{style:{backgroundColor:a=s}={}}=t,h=!0!==n;e.save(),e.fillStyle=a,DA(e,o,h&&bA(r,c,u)),e.beginPath();const d=!!i.pathSegment(e,t);let p;if(h){d?e.closePath():OA(e,n,u,r);const t=!!n.pathSegment(e,l,{move:d,reverse:!0});p=d&&t,p||OA(e,n,c,r)}e.closePath(),e.fill(p?"evenodd":"nonzero"),e.restore()}}function DA(e,t,i){const{top:n,bottom:r}=t.chart.chartArea,{property:s,start:o,end:a}=i||{};"x"===s&&(e.beginPath(),e.rect(o,n,a-o,r-n),e.clip())}function OA(e,t,i,n){const r=t.interpolate(i,n);r&&e.lineTo(r.x,r.y)}var NA={id:"filler",afterDatasetsUpdate(e,t,i){const n=(e.data.datasets||[]).length,r=[];let s,o,a,l;for(o=0;o<n;++o)s=e.getDatasetMeta(o),a=s.dataset,l=null,a&&a.options&&a instanceof rA&&(l={visible:e.isDatasetVisible(o),index:o,fill:IA(a,o,n),chart:e,axis:s.controller.options.indexAxis,scale:s.vScale,line:a}),s.$filler=l,r.push(l);for(o=0;o<n;++o)l=r[o],l&&!1!==l.fill&&(l.fill=MA(r,o,i.propagate))},beforeDraw(e,t,i){const n="beforeDraw"===i.drawTime,r=e.getSortedVisibleDatasetMetas(),s=e.chartArea;for(let t=r.length-1;t>=0;--t){const i=r[t].$filler;i&&(i.line.updateControlPoints(s,i.axis),n&&i.fill&&kA(e.ctx,i,s))}},beforeDatasetsDraw(e,t,i){if("beforeDatasetsDraw"!==i.drawTime)return;const n=e.getSortedVisibleDatasetMetas();for(let t=n.length-1;t>=0;--t){const i=n[t].$filler;EA(i)&&kA(e.ctx,i,e.chartArea)}},beforeDatasetDraw(e,t,i){const n=t.meta.$filler;EA(n)&&"beforeDatasetDraw"===i.drawTime&&kA(e.ctx,n,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const zA=(e,t)=>{let{boxHeight:i=t,boxWidth:n=t}=e;return e.usePointStyle&&(i=Math.min(i,t),n=e.pointStyleWidth||Math.min(n,t)),{boxWidth:n,boxHeight:i,itemHeight:Math.max(t,i)}};class FA extends lI{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,i){this.maxWidth=e,this.maxHeight=t,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=_S(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter((t=>e.filter(t,this.chart.data)))),e.sort&&(t=t.sort(((t,i)=>e.sort(t,i,this.chart.data)))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display)return void(this.width=this.height=0);const i=e.labels,n=iE(i.font),r=n.size,s=this._computeTitleHeight(),{boxWidth:o,itemHeight:a}=zA(i,r);let l,c;t.font=n.string,this.isHorizontal()?(l=this.maxWidth,c=this._fitRows(s,r,o,a)+10):(c=this.maxHeight,l=this._fitCols(s,n,o,a)+10),this.width=Math.min(l,e.maxWidth||this.maxWidth),this.height=Math.min(c,e.maxHeight||this.maxHeight)}_fitRows(e,t,i,n){const{ctx:r,maxWidth:s,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],l=this.lineWidths=[0],c=n+o;let u=e;r.textAlign="left",r.textBaseline="middle";let h=-1,d=-c;return this.legendItems.forEach(((e,p)=>{const f=i+t/2+r.measureText(e.text).width;(0===p||l[l.length-1]+f+2*o>s)&&(u+=c,l[l.length-(p>0?0:1)]=0,d+=c,h++),a[p]={left:0,top:d,row:h,width:f,height:n},l[l.length-1]+=f+o})),u}_fitCols(e,t,i,n){const{ctx:r,maxHeight:s,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],l=this.columnSizes=[],c=s-e;let u=o,h=0,d=0,p=0,f=0;return this.legendItems.forEach(((e,s)=>{const{itemWidth:m,itemHeight:g}=function(e,t,i,n,r){const s=function(e,t,i,n){let r=e.text;return r&&"string"!=typeof r&&(r=r.reduce(((e,t)=>e.length>t.length?e:t))),t+i.size/2+n.measureText(r).width}(n,e,t,i),o=function(e,t,i){let n=e;return"string"!=typeof t.text&&(n=BA(t,i)),n}(r,n,t.lineHeight);return{itemWidth:s,itemHeight:o}}(i,t,r,e,n);s>0&&d+g+2*o>c&&(u+=h+o,l.push({width:h,height:d}),p+=h+o,f++,h=d=0),a[s]={left:p,top:d,col:f,width:m,height:g},h=Math.max(h,m),d+=g+o})),u+=h,l.push({width:h,height:d}),u}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:i,labels:{padding:n},rtl:r}}=this,s=UE(r,this.left,this.width);if(this.isHorizontal()){let r=0,o=hT(i,this.left+n,this.right-this.lineWidths[r]);for(const a of t)r!==a.row&&(r=a.row,o=hT(i,this.left+n,this.right-this.lineWidths[r])),a.top+=this.top+e+n,a.left=s.leftForLtr(s.x(o),a.width),o+=a.width+n}else{let r=0,o=hT(i,this.top+e+n,this.bottom-this.columnSizes[r].height);for(const a of t)a.col!==r&&(r=a.col,o=hT(i,this.top+e+n,this.bottom-this.columnSizes[r].height)),a.top=o,a.left+=this.left+n,a.left=s.leftForLtr(s.x(a.left),a.width),o+=a.height+n}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const e=this.ctx;UT(e,this),this._draw(),VT(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:i,ctx:n}=this,{align:r,labels:s}=e,o=RT.color,a=UE(e.rtl,this.left,this.width),l=iE(s.font),{padding:c}=s,u=l.size,h=u/2;let d;this.drawTitle(),n.textAlign=a.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=l.string;const{boxWidth:p,boxHeight:f,itemHeight:m}=zA(s,u),g=this.isHorizontal(),_=this._computeTitleHeight();d=g?{x:hT(r,this.left+c,this.right-i[0]),y:this.top+c+_,line:0}:{x:this.left+c,y:hT(r,this.top+_+c,this.bottom-t[0].height),line:0},VE(this.ctx,e.textDirection);const y=m+c;this.legendItems.forEach(((v,x)=>{n.strokeStyle=v.fontColor,n.fillStyle=v.fontColor;const b=n.measureText(v.text).width,w=a.textAlign(v.textAlign||(v.textAlign=s.textAlign)),S=p+h+b;let T=d.x,E=d.y;if(a.setWidth(this.width),g?x>0&&T+S+c>this.right&&(E=d.y+=y,d.line++,T=d.x=hT(r,this.left+c,this.right-i[d.line])):x>0&&E+y>this.bottom&&(T=d.x=T+t[d.line].width+c,d.line++,E=d.y=hT(r,this.top+_+c,this.bottom-t[d.line].height)),function(e,t,i){if(isNaN(p)||p<=0||isNaN(f)||f<0)return;n.save();const r=mS(i.lineWidth,1);if(n.fillStyle=mS(i.fillStyle,o),n.lineCap=mS(i.lineCap,"butt"),n.lineDashOffset=mS(i.lineDashOffset,0),n.lineJoin=mS(i.lineJoin,"miter"),n.lineWidth=r,n.strokeStyle=mS(i.strokeStyle,o),n.setLineDash(mS(i.lineDash,[])),s.usePointStyle){const o={radius:f*Math.SQRT2/2,pointStyle:i.pointStyle,rotation:i.rotation,borderWidth:r},l=a.xPlus(e,p/2);FT(n,o,l,t+h,s.pointStyleWidth&&p)}else{const s=t+Math.max((u-f)/2,0),o=a.leftForLtr(e,p),l=eE(i.borderRadius);n.beginPath(),Object.values(l).some((e=>0!==e))?$T(n,{x:o,y:s,w:p,h:f,radius:l}):n.rect(o,s,p,f),n.fill(),0!==r&&n.stroke()}n.restore()}(a.x(T),E,v),T=((e,t,i,n)=>e===(n?"left":"right")?i:"center"===e?(t+i)/2:t)(w,T+p+h,g?T+S:this.right,e.rtl),function(e,t,i){qT(n,i.text,e,t+m/2,l,{strikethrough:i.hidden,textAlign:a.textAlign(i.textAlign)})}(a.x(T),E,v),g)d.x+=S+c;else if("string"!=typeof v.text){const e=l.lineHeight;d.y+=BA(v,e)+c}else d.y+=y})),jE(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,i=iE(t.font),n=tE(t.padding);if(!t.display)return;const r=UE(e.rtl,this.left,this.width),s=this.ctx,o=t.position,a=i.size/2,l=n.top+a;let c,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),c=this.top+l,u=hT(e.align,u,this.right-h);else{const t=this.columnSizes.reduce(((e,t)=>Math.max(e,t.height)),0);c=l+hT(e.align,this.top,this.bottom-t-e.labels.padding-this._computeTitleHeight())}const d=hT(o,u,u+h);s.textAlign=r.textAlign(uT(o)),s.textBaseline="middle",s.strokeStyle=t.color,s.fillStyle=t.color,s.font=i.string,qT(s,t.text,d,c,i)}_computeTitleHeight(){const e=this.options.title,t=iE(e.font),i=tE(e.padding);return e.display?t.lineHeight+i.height:0}_getLegendItemAt(e,t){let i,n,r;if(tT(e,this.left,this.right)&&tT(t,this.top,this.bottom))for(r=this.legendHitBoxes,i=0;i<r.length;++i)if(n=r[i],tT(e,n.left,n.left+n.width)&&tT(t,n.top,n.top+n.height))return this.legendItems[i];return null}handleEvent(e){const t=this.options;if(!function(e,t){return!("mousemove"!==e&&"mouseout"!==e||!t.onHover&&!t.onLeave)||!(!t.onClick||"click"!==e&&"mouseup"!==e)}(e.type,t))return;const i=this._getLegendItemAt(e.x,e.y);if("mousemove"===e.type||"mouseout"===e.type){const n=this._hoveredItem,r=((e,t)=>null!==e&&null!==t&&e.datasetIndex===t.datasetIndex&&e.index===t.index)(n,i);n&&!r&&_S(t.onLeave,[e,n,this],this),this._hoveredItem=i,i&&!r&&_S(t.onHover,[e,i,this],this)}else i&&_S(t.onClick,[e,i,this],this)}}function BA(e,t){return t*(e.text?e.text.length:0)}var UA={id:"legend",_element:FA,start(e,t,i){const n=e.legend=new FA({ctx:e.ctx,options:i,chart:e});HM.configure(e,n,i),HM.addBox(e,n)},stop(e){HM.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,i){const n=e.legend;HM.configure(e,n,i),n.options=i},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,i){const n=t.datasetIndex,r=i.chart;r.isDatasetVisible(n)?(r.hide(n),t.hidden=!0):(r.show(n),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:i,pointStyle:n,textAlign:r,color:s,useBorderRadius:o,borderRadius:a}}=e.legend.options;return e._getSortedDatasetMetas().map((e=>{const l=e.controller.getStyle(i?0:void 0),c=tE(l.borderWidth);return{text:t[e.index].label,fillStyle:l.backgroundColor,fontColor:s,hidden:!e.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(c.width+c.height)/4,strokeStyle:l.borderColor,pointStyle:n||l.pointStyle,rotation:l.rotation,textAlign:r||l.textAlign,borderRadius:o&&(a||l.borderRadius),datasetIndex:e.index}}),this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class VA extends lI{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const i=this.options;if(this.left=0,this.top=0,!i.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=e,this.height=this.bottom=t;const n=hS(i.text)?i.text.length:1;this._padding=tE(i.padding);const r=n*iE(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const e=this.options.position;return"top"===e||"bottom"===e}_drawArgs(e){const{top:t,left:i,bottom:n,right:r,options:s}=this,o=s.align;let a,l,c,u=0;return this.isHorizontal()?(l=hT(o,i,r),c=t+e,a=r-i):("left"===s.position?(l=i+e,c=hT(o,n,t),u=-.5*RS):(l=r-e,c=hT(o,t,n),u=.5*RS),a=n-t),{titleX:l,titleY:c,maxWidth:a,rotation:u}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const i=iE(t.font),n=i.lineHeight/2+this._padding.top,{titleX:r,titleY:s,maxWidth:o,rotation:a}=this._drawArgs(n);qT(e,t.text,0,0,i,{color:t.color,maxWidth:o,rotation:a,textAlign:uT(t.align),textBaseline:"middle",translation:[r,s]})}}var jA={id:"title",_element:VA,start(e,t,i){!function(e,t){const i=new VA({ctx:e.ctx,options:t,chart:e});HM.configure(e,i,t),HM.addBox(e,i),e.titleBlock=i}(e,i)},stop(e){const t=e.titleBlock;HM.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,i){const n=e.titleBlock;HM.configure(e,n,i),n.options=i},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const GA=new WeakMap;var HA={id:"subtitle",start(e,t,i){const n=new VA({ctx:e.ctx,options:i,chart:e});HM.configure(e,n,i),HM.addBox(e,n),GA.set(e,n)},stop(e){HM.removeBox(e,GA.get(e)),GA.delete(e)},beforeUpdate(e,t,i){const n=GA.get(e);HM.configure(e,n,i),n.options=i},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const WA={average(e){if(!e.length)return!1;let t,i,n=new Set,r=0,s=0;for(t=0,i=e.length;t<i;++t){const i=e[t].element;if(i&&i.hasValue()){const e=i.tooltipPosition();n.add(e.x),r+=e.y,++s}}const o=[...n].reduce(((e,t)=>e+t))/n.size;return{x:o,y:r/s}},nearest(e,t){if(!e.length)return!1;let i,n,r,s=t.x,o=t.y,a=Number.POSITIVE_INFINITY;for(i=0,n=e.length;i<n;++i){const n=e[i].element;if(n&&n.hasValue()){const e=YS(t,n.getCenterPoint());e<a&&(a=e,r=n)}}if(r){const e=r.tooltipPosition();s=e.x,o=e.y}return{x:s,y:o}}};function qA(e,t){return t&&(hS(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function $A(e){return("string"==typeof e||e instanceof String)&&e.indexOf("\n")>-1?e.split("\n"):e}function ZA(e,t){const{element:i,datasetIndex:n,index:r}=t,s=e.getDatasetMeta(n).controller,{label:o,value:a}=s.getLabelAndValue(r);return{chart:e,label:o,parsed:s.getParsed(r),raw:e.data.datasets[n].data[r],formattedValue:a,dataset:s.getDataset(),dataIndex:r,datasetIndex:n,element:i}}function XA(e,t){const i=e.chart.ctx,{body:n,footer:r,title:s}=e,{boxWidth:o,boxHeight:a}=t,l=iE(t.bodyFont),c=iE(t.titleFont),u=iE(t.footerFont),h=s.length,d=r.length,p=n.length,f=tE(t.padding);let m=f.height,g=0,_=n.reduce(((e,t)=>e+t.before.length+t.lines.length+t.after.length),0);_+=e.beforeBody.length+e.afterBody.length,h&&(m+=h*c.lineHeight+(h-1)*t.titleSpacing+t.titleMarginBottom),_&&(m+=p*(t.displayColors?Math.max(a,l.lineHeight):l.lineHeight)+(_-p)*l.lineHeight+(_-1)*t.bodySpacing),d&&(m+=t.footerMarginTop+d*u.lineHeight+(d-1)*t.footerSpacing);let y=0;const v=function(e){g=Math.max(g,i.measureText(e).width+y)};return i.save(),i.font=c.string,yS(e.title,v),i.font=l.string,yS(e.beforeBody.concat(e.afterBody),v),y=t.displayColors?o+2+t.boxPadding:0,yS(n,(e=>{yS(e.before,v),yS(e.lines,v),yS(e.after,v)})),y=0,i.font=u.string,yS(e.footer,v),i.restore(),g+=f.width,{width:g,height:m}}function YA(e,t,i,n){const{x:r,width:s}=i,{width:o,chartArea:{left:a,right:l}}=e;let c="center";return"center"===n?c=r<=(a+l)/2?"left":"right":r<=s/2?c="left":r>=o-s/2&&(c="right"),function(e,t,i,n){const{x:r,width:s}=n,o=i.caretSize+i.caretPadding;return"left"===e&&r+s+o>t.width||"right"===e&&r-s-o<0||void 0}(c,e,t,i)&&(c="center"),c}function KA(e,t,i){const n=i.yAlign||t.yAlign||function(e,t){const{y:i,height:n}=t;return i<n/2?"top":i>e.height-n/2?"bottom":"center"}(e,i);return{xAlign:i.xAlign||t.xAlign||YA(e,t,i,n),yAlign:n}}function JA(e,t,i,n){const{caretSize:r,caretPadding:s,cornerRadius:o}=e,{xAlign:a,yAlign:l}=i,c=r+s,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=eE(o);let f=function(e,t){let{x:i,width:n}=e;return"right"===t?i-=n:"center"===t&&(i-=n/2),i}(t,a);const m=function(e,t,i){let{y:n,height:r}=e;return"top"===t?n+=i:n-="bottom"===t?r+i:r/2,n}(t,l,c);return"center"===l?"left"===a?f+=c:"right"===a&&(f-=c):"left"===a?f-=Math.max(u,d)+r:"right"===a&&(f+=Math.max(h,p)+r),{x:eT(f,0,n.width-t.width),y:eT(m,0,n.height-t.height)}}function QA(e,t,i){const n=tE(i.padding);return"center"===t?e.x+e.width/2:"right"===t?e.x+e.width-n.right:e.x+n.left}function eC(e){return qA([],$A(e))}function tC(e,t){const i=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return i?e.override(i):e}const iC={beforeTitle:lS,title(e){if(e.length>0){const t=e[0],i=t.chart.data.labels,n=i?i.length:0;if(this&&this.options&&"dataset"===this.options.mode)return t.dataset.label||"";if(t.label)return t.label;if(n>0&&t.dataIndex<n)return i[t.dataIndex]}return""},afterTitle:lS,beforeBody:lS,beforeLabel:lS,label(e){if(this&&this.options&&"dataset"===this.options.mode)return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const i=e.formattedValue;return uS(i)||(t+=i),t},labelColor(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:lS,afterBody:lS,beforeFooter:lS,footer:lS,afterFooter:lS};function nC(e,t,i,n){const r=e[t].call(i,n);return void 0===r?iC[t].call(i,n):r}class rC extends lI{static positioners=WA;constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,i=this.options.setContext(this.getContext()),n=i.enabled&&t.options.animation&&i.animations,r=new eM(this.chart,n);return n._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=function(e,t,i){return rE(e,{tooltip:t,tooltipItems:i,type:"tooltip"})}(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:i}=t,n=nC(i,"beforeTitle",this,e),r=nC(i,"title",this,e),s=nC(i,"afterTitle",this,e);let o=[];return o=qA(o,$A(n)),o=qA(o,$A(r)),o=qA(o,$A(s)),o}getBeforeBody(e,t){return eC(nC(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:i}=t,n=[];return yS(e,(e=>{const t={before:[],lines:[],after:[]},r=tC(i,e);qA(t.before,$A(nC(r,"beforeLabel",this,e))),qA(t.lines,nC(r,"label",this,e)),qA(t.after,$A(nC(r,"afterLabel",this,e))),n.push(t)})),n}getAfterBody(e,t){return eC(nC(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:i}=t,n=nC(i,"beforeFooter",this,e),r=nC(i,"footer",this,e),s=nC(i,"afterFooter",this,e);let o=[];return o=qA(o,$A(n)),o=qA(o,$A(r)),o=qA(o,$A(s)),o}_createItems(e){const t=this._active,i=this.chart.data,n=[],r=[],s=[];let o,a,l=[];for(o=0,a=t.length;o<a;++o)l.push(ZA(this.chart,t[o]));return e.filter&&(l=l.filter(((t,n,r)=>e.filter(t,n,r,i)))),e.itemSort&&(l=l.sort(((t,n)=>e.itemSort(t,n,i)))),yS(l,(t=>{const i=tC(e.callbacks,t);n.push(nC(i,"labelColor",this,t)),r.push(nC(i,"labelPointStyle",this,t)),s.push(nC(i,"labelTextColor",this,t))})),this.labelColors=n,this.labelPointStyles=r,this.labelTextColors=s,this.dataPoints=l,l}update(e,t){const i=this.options.setContext(this.getContext()),n=this._active;let r,s=[];if(n.length){const e=WA[i.position].call(this,n,this._eventPosition);s=this._createItems(i),this.title=this.getTitle(s,i),this.beforeBody=this.getBeforeBody(s,i),this.body=this.getBody(s,i),this.afterBody=this.getAfterBody(s,i),this.footer=this.getFooter(s,i);const t=this._size=XA(this,i),o=Object.assign({},e,t),a=KA(this.chart,i,o),l=JA(i,o,a,this.chart);this.xAlign=a.xAlign,this.yAlign=a.yAlign,r={opacity:1,x:l.x,y:l.y,width:t.width,height:t.height,caretX:e.x,caretY:e.y}}else 0!==this.opacity&&(r={opacity:0});this._tooltipItems=s,this.$context=void 0,r&&this._resolveAnimations().update(this,r),e&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,i,n){const r=this.getCaretPosition(e,i,n);t.lineTo(r.x1,r.y1),t.lineTo(r.x2,r.y2),t.lineTo(r.x3,r.y3)}getCaretPosition(e,t,i){const{xAlign:n,yAlign:r}=this,{caretSize:s,cornerRadius:o}=i,{topLeft:a,topRight:l,bottomLeft:c,bottomRight:u}=eE(o),{x:h,y:d}=e,{width:p,height:f}=t;let m,g,_,y,v,x;return"center"===r?(v=d+f/2,"left"===n?(m=h,g=m-s,y=v+s,x=v-s):(m=h+p,g=m+s,y=v-s,x=v+s),_=m):(g="left"===n?h+Math.max(a,c)+s:"right"===n?h+p-Math.max(l,u)-s:this.caretX,"top"===r?(y=d,v=y-s,m=g-s,_=g+s):(y=d+f,v=y+s,m=g+s,_=g-s),x=y),{x1:m,x2:g,x3:_,y1:y,y2:v,y3:x}}drawTitle(e,t,i){const n=this.title,r=n.length;let s,o,a;if(r){const l=UE(i.rtl,this.x,this.width);for(e.x=QA(this,i.titleAlign,i),t.textAlign=l.textAlign(i.titleAlign),t.textBaseline="middle",s=iE(i.titleFont),o=i.titleSpacing,t.fillStyle=i.titleColor,t.font=s.string,a=0;a<r;++a)t.fillText(n[a],l.x(e.x),e.y+s.lineHeight/2),e.y+=s.lineHeight+o,a+1===r&&(e.y+=i.titleMarginBottom-o)}}_drawColorBox(e,t,i,n,r){const s=this.labelColors[i],o=this.labelPointStyles[i],{boxHeight:a,boxWidth:l}=r,c=iE(r.bodyFont),u=QA(this,"left",r),h=n.x(u),d=a<c.lineHeight?(c.lineHeight-a)/2:0,p=t.y+d;if(r.usePointStyle){const t={radius:Math.min(l,a)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},i=n.leftForLtr(h,l)+l/2,c=p+a/2;e.strokeStyle=r.multiKeyBackground,e.fillStyle=r.multiKeyBackground,zT(e,t,i,c),e.strokeStyle=s.borderColor,e.fillStyle=s.backgroundColor,zT(e,t,i,c)}else{e.lineWidth=dS(s.borderWidth)?Math.max(...Object.values(s.borderWidth)):s.borderWidth||1,e.strokeStyle=s.borderColor,e.setLineDash(s.borderDash||[]),e.lineDashOffset=s.borderDashOffset||0;const t=n.leftForLtr(h,l),i=n.leftForLtr(n.xPlus(h,1),l-2),o=eE(s.borderRadius);Object.values(o).some((e=>0!==e))?(e.beginPath(),e.fillStyle=r.multiKeyBackground,$T(e,{x:t,y:p,w:l,h:a,radius:o}),e.fill(),e.stroke(),e.fillStyle=s.backgroundColor,e.beginPath(),$T(e,{x:i,y:p+1,w:l-2,h:a-2,radius:o}),e.fill()):(e.fillStyle=r.multiKeyBackground,e.fillRect(t,p,l,a),e.strokeRect(t,p,l,a),e.fillStyle=s.backgroundColor,e.fillRect(i,p+1,l-2,a-2))}e.fillStyle=this.labelTextColors[i]}drawBody(e,t,i){const{body:n}=this,{bodySpacing:r,bodyAlign:s,displayColors:o,boxHeight:a,boxWidth:l,boxPadding:c}=i,u=iE(i.bodyFont);let h=u.lineHeight,d=0;const p=UE(i.rtl,this.x,this.width),f=function(i){t.fillText(i,p.x(e.x+d),e.y+h/2),e.y+=h+r},m=p.textAlign(s);let g,_,y,v,x,b,w;for(t.textAlign=s,t.textBaseline="middle",t.font=u.string,e.x=QA(this,m,i),t.fillStyle=i.bodyColor,yS(this.beforeBody,f),d=o&&"right"!==m?"center"===s?l/2+c:l+2+c:0,v=0,b=n.length;v<b;++v){for(g=n[v],_=this.labelTextColors[v],t.fillStyle=_,yS(g.before,f),y=g.lines,o&&y.length&&(this._drawColorBox(t,e,v,p,i),h=Math.max(u.lineHeight,a)),x=0,w=y.length;x<w;++x)f(y[x]),h=u.lineHeight;yS(g.after,f)}d=0,h=u.lineHeight,yS(this.afterBody,f),e.y-=r}drawFooter(e,t,i){const n=this.footer,r=n.length;let s,o;if(r){const a=UE(i.rtl,this.x,this.width);for(e.x=QA(this,i.footerAlign,i),e.y+=i.footerMarginTop,t.textAlign=a.textAlign(i.footerAlign),t.textBaseline="middle",s=iE(i.footerFont),t.fillStyle=i.footerColor,t.font=s.string,o=0;o<r;++o)t.fillText(n[o],a.x(e.x),e.y+s.lineHeight/2),e.y+=s.lineHeight+i.footerSpacing}}drawBackground(e,t,i,n){const{xAlign:r,yAlign:s}=this,{x:o,y:a}=e,{width:l,height:c}=i,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=eE(n.cornerRadius);t.fillStyle=n.backgroundColor,t.strokeStyle=n.borderColor,t.lineWidth=n.borderWidth,t.beginPath(),t.moveTo(o+u,a),"top"===s&&this.drawCaret(e,t,i,n),t.lineTo(o+l-h,a),t.quadraticCurveTo(o+l,a,o+l,a+h),"center"===s&&"right"===r&&this.drawCaret(e,t,i,n),t.lineTo(o+l,a+c-p),t.quadraticCurveTo(o+l,a+c,o+l-p,a+c),"bottom"===s&&this.drawCaret(e,t,i,n),t.lineTo(o+d,a+c),t.quadraticCurveTo(o,a+c,o,a+c-d),"center"===s&&"left"===r&&this.drawCaret(e,t,i,n),t.lineTo(o,a+u),t.quadraticCurveTo(o,a,o+u,a),t.closePath(),t.fill(),n.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,i=this.$animations,n=i&&i.x,r=i&&i.y;if(n||r){const i=WA[e.position].call(this,this._active,this._eventPosition);if(!i)return;const s=this._size=XA(this,e),o=Object.assign({},i,this._size),a=KA(t,e,o),l=JA(e,o,a,t);n._to===l.x&&r._to===l.y||(this.xAlign=a.xAlign,this.yAlign=a.yAlign,this.width=s.width,this.height=s.height,this.caretX=i.x,this.caretY=i.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(t);const n={width:this.width,height:this.height},r={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const s=tE(t.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&o&&(e.save(),e.globalAlpha=i,this.drawBackground(r,e,n,t),VE(e,t.textDirection),r.y+=s.top,this.drawTitle(r,e,t),this.drawBody(r,e,t),this.drawFooter(r,e,t),jE(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const i=this._active,n=e.map((({datasetIndex:e,index:t})=>{const i=this.chart.getDatasetMeta(e);if(!i)throw new Error("Cannot find a dataset at index "+e);return{datasetIndex:e,element:i.data[t],index:t}})),r=!vS(i,n),s=this._positionChanged(n,t);(r||s)&&(this._active=n,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,i=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const n=this.options,r=this._active||[],s=this._getActiveElements(e,r,t,i),o=this._positionChanged(s,e),a=t||!vS(s,r)||o;return a&&(this._active=s,(n.enabled||n.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),a}_getActiveElements(e,t,i,n){const r=this.options;if("mouseout"===e.type)return[];if(!n)return t.filter((e=>this.chart.data.datasets[e.datasetIndex]&&void 0!==this.chart.getDatasetMeta(e.datasetIndex).controller.getParsed(e.index)));const s=this.chart.getElementsAtEventForMode(e,r.mode,r,i);return r.reverse&&s.reverse(),s}_positionChanged(e,t){const{caretX:i,caretY:n,options:r}=this,s=WA[r.position].call(this,e,t);return!1!==s&&(i!==s.x||n!==s.y)}}var sC={id:"tooltip",_element:rC,positioners:WA,afterInit(e,t,i){i&&(e.tooltip=new rC({chart:e,options:i}))},beforeUpdate(e,t,i){e.tooltip&&e.tooltip.initialize(i)},reset(e,t,i){e.tooltip&&e.tooltip.initialize(i)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const i={tooltip:t};if(!1===e.notifyPlugins("beforeTooltipDraw",{...i,cancelable:!0}))return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",i)}},afterEvent(e,t){if(e.tooltip){const i=t.replay;e.tooltip.handleEvent(t.event,i,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:iC},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>"filter"!==e&&"itemSort"!==e&&"external"!==e,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},oC=Object.freeze({__proto__:null,Colors:_A,Decimation:xA,Filler:NA,Legend:UA,SubTitle:HA,Title:jA,Tooltip:sC});function aC(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}function lC(e,t,{horizontal:i,minRotation:n}){const r=qS(n),s=(i?Math.sin(r):Math.cos(r))||.001,o=.75*t*(""+e).length;return Math.min(t/s,o)}class cC extends _I{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return uS(e)||("number"==typeof e||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:i}=this.getUserBounds();let{min:n,max:r}=this;const s=e=>n=t?n:e,o=e=>r=i?r:e;if(e){const e=VS(n),t=VS(r);e<0&&t<0?o(0):e>0&&t>0&&s(0)}if(n===r){let t=0===r?1:Math.abs(.05*r);o(r+t),e||s(n-t)}this.min=n,this.max=r}getTickLimit(){const e=this.options.ticks;let t,{maxTicksLimit:i,stepSize:n}=e;return n?(t=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,t>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${t} ticks. Limiting to 1000.`),t=1e3)):(t=this.computeTickLimit(),i=i||11),i&&(t=Math.min(i,t)),t}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let i=this.getTickLimit();i=Math.max(2,i);const n=function(e,t){const i=[],{bounds:n,step:r,min:s,max:o,precision:a,count:l,maxTicks:c,maxDigits:u,includeBounds:h}=e,d=r||1,p=c-1,{min:f,max:m}=t,g=!uS(s),_=!uS(o),y=!uS(l),v=(m-f)/(u+1);let x,b,w,S,T=GS((m-f)/p/d)*d;if(T<1e-14&&!g&&!_)return[{value:f},{value:m}];S=Math.ceil(m/T)-Math.floor(f/T),S>p&&(T=GS(S*T/p/d)*d),uS(a)||(x=Math.pow(10,a),T=Math.ceil(T*x)/x),"ticks"===n?(b=Math.floor(f/T)*T,w=Math.ceil(m/T)*T):(b=f,w=m),g&&_&&r&&function(e,t){const i=Math.round(e);return i-t<=e&&i+t>=e}((o-s)/r,T/1e3)?(S=Math.round(Math.min((o-s)/T,c)),T=(o-s)/S,b=s,w=o):y?(b=g?s:b,w=_?o:w,S=l-1,T=(w-b)/S):(S=(w-b)/T,S=jS(S,Math.round(S),T/1e3)?Math.round(S):Math.ceil(S));const E=Math.max(ZS(T),ZS(b));x=Math.pow(10,uS(a)?E:a),b=Math.round(b*x)/x,w=Math.round(w*x)/x;let M=0;for(g&&(h&&b!==s?(i.push({value:s}),b<s&&M++,jS(Math.round((b+M*T)*x)/x,s,lC(s,v,e))&&M++):b<s&&M++);M<S;++M){const e=Math.round((b+M*T)*x)/x;if(_&&e>o)break;i.push({value:e})}return _&&h&&w!==o?i.length&&jS(i[i.length-1].value,o,lC(o,v,e))?i[i.length-1].value=o:i.push({value:o}):_&&w!==o||i.push({value:w}),i}({maxTicks:i,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:!1!==t.includeBounds},this._range||this);return"ticks"===e.bounds&&WS(n,this,"value"),e.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}configure(){const e=this.ticks;let t=this.min,i=this.max;if(super.configure(),this.options.offset&&e.length){const n=(i-t)/Math.max(e.length-1,1)/2;t-=n,i+=n}this._startValue=t,this._endValue=i,this._valueRange=i-t}getLabelForValue(e){return TT(e,this.chart.options.locale,this.options.ticks.format)}}class uC extends cC{static id="linear";static defaults={ticks:{callback:MT.formatters.numeric}};determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=pS(e)?e:0,this.max=pS(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,i=qS(this.options.ticks.minRotation),n=(e?Math.sin(i):Math.cos(i))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,r.lineHeight/n))}getPixelForValue(e){return null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}const hC=e=>Math.floor(US(e)),dC=(e,t)=>Math.pow(10,hC(e)+t);function pC(e){return 1==e/Math.pow(10,hC(e))}function fC(e,t,i){const n=Math.pow(10,i),r=Math.floor(e/n);return Math.ceil(t/n)-r}class mC extends _I{static id="logarithmic";static defaults={ticks:{callback:MT.formatters.logarithmic,major:{enabled:!0}}};constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const i=cC.prototype.parse.apply(this,[e,t]);if(0!==i)return pS(i)&&i>0?i:null;this._zero=!0}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=pS(e)?Math.max(0,e):null,this.max=pS(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!pS(this._userMin)&&(this.min=e===dC(this.min,0)?dC(this.min,-1):dC(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let i=this.min,n=this.max;const r=t=>i=e?i:t,s=e=>n=t?n:e;i===n&&(i<=0?(r(1),s(10)):(r(dC(i,-1)),s(dC(n,1)))),i<=0&&r(dC(n,-1)),n<=0&&s(dC(i,1)),this.min=i,this.max=n}buildTicks(){const e=this.options,t=function(e,{min:t,max:i}){t=fS(e.min,t);const n=[],r=hC(t);let s=function(e,t){let i=hC(t-e);for(;fC(e,t,i)>10;)i++;for(;fC(e,t,i)<10;)i--;return Math.min(i,hC(e))}(t,i),o=s<0?Math.pow(10,Math.abs(s)):1;const a=Math.pow(10,s),l=r>s?Math.pow(10,r):0,c=Math.round((t-l)*o)/o,u=Math.floor((t-l)/a/10)*a*10;let h=Math.floor((c-u)/Math.pow(10,s)),d=fS(e.min,Math.round((l+u+h*Math.pow(10,s))*o)/o);for(;d<i;)n.push({value:d,major:pC(d),significand:h}),h>=10?h=h<15?15:20:h++,h>=20&&(s++,h=2,o=s>=0?1:o),d=Math.round((l+u+h*Math.pow(10,s))*o)/o;const p=fS(e.max,d);return n.push({value:p,major:pC(p),significand:h}),n}({min:this._userMin,max:this._userMax},this);return"ticks"===e.bounds&&WS(t,this,"value"),e.reverse?(t.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),t}getLabelForValue(e){return void 0===e?"0":TT(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=US(e),this._valueRange=US(this.max)-US(e)}getPixelForValue(e){return void 0!==e&&0!==e||(e=this.min),null===e||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(US(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}function gC(e){const t=e.ticks;if(t.display&&e.display){const e=tE(t.backdropPadding);return mS(t.font&&t.font.size,RT.font.size)+e.height}return 0}function _C(e,t,i,n,r){return e===n||e===r?{start:t-i/2,end:t+i/2}:e<n||e>r?{start:t-i,end:t}:{start:t,end:t+i}}function yC(e,t,i,n,r){const s=Math.abs(Math.sin(i)),o=Math.abs(Math.cos(i));let a=0,l=0;n.start<t.l?(a=(t.l-n.start)/s,e.l=Math.min(e.l,t.l-a)):n.end>t.r&&(a=(n.end-t.r)/s,e.r=Math.max(e.r,t.r+a)),r.start<t.t?(l=(t.t-r.start)/o,e.t=Math.min(e.t,t.t-l)):r.end>t.b&&(l=(r.end-t.b)/o,e.b=Math.max(e.b,t.b+l))}function vC(e,t,i){const n=e.drawingArea,{extra:r,additionalAngle:s,padding:o,size:a}=i,l=e.getPointPosition(t,n+r+o,s),c=Math.round($S(JS(l.angle+zS))),u=function(e,t,i){return 90===i||270===i?e-=t/2:(i>270||i<90)&&(e-=t),e}(l.y,a.h,c),h=function(e){return 0===e||180===e?"center":e<180?"left":"right"}(c),d=function(e,t,i){return"right"===i?e-=t:"center"===i&&(e-=t/2),e}(l.x,a.w,h);return{visible:!0,x:l.x,y:u,textAlign:h,left:d,top:u,right:d+a.w,bottom:u+a.h}}function xC(e,t){if(!t)return!0;const{left:i,top:n,right:r,bottom:s}=e;return!(BT({x:i,y:n},t)||BT({x:i,y:s},t)||BT({x:r,y:n},t)||BT({x:r,y:s},t))}function bC(e,t,i){const{left:n,top:r,right:s,bottom:o}=i,{backdropColor:a}=t;if(!uS(a)){const i=eE(t.borderRadius),l=tE(t.backdropPadding);e.fillStyle=a;const c=n-l.left,u=r-l.top,h=s-n+l.width,d=o-r+l.height;Object.values(i).some((e=>0!==e))?(e.beginPath(),$T(e,{x:c,y:u,w:h,h:d,radius:i}),e.fill()):e.fillRect(c,u,h,d)}}function wC(e,t,i,n){const{ctx:r}=e;if(i)r.arc(e.xCenter,e.yCenter,t,0,LS);else{let i=e.getPointPosition(0,t);r.moveTo(i.x,i.y);for(let s=1;s<n;s++)i=e.getPointPosition(s,t),r.lineTo(i.x,i.y)}}class SC extends cC{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:MT.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:e=>e,padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=tE(gC(this.options)/2),t=this.width=this.maxWidth-e.width,i=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+i/2+e.top),this.drawingArea=Math.floor(Math.min(t,i)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=pS(e)&&!isNaN(e)?e:0,this.max=pS(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/gC(this.options))}generateTickLabels(e){cC.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map(((e,t)=>{const i=_S(this.options.pointLabels.callback,[e,t],this);return i||0===i?i:""})).filter(((e,t)=>this.chart.getDataVisibility(t)))}fit(){const e=this.options;e.display&&e.pointLabels.display?function(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},i=Object.assign({},t),n=[],r=[],s=e._pointLabels.length,o=e.options.pointLabels,a=o.centerPointLabels?RS/s:0;for(let h=0;h<s;h++){const s=o.setContext(e.getPointLabelContext(h));r[h]=s.padding;const d=e.getPointPosition(h,e.drawingArea+r[h],a),p=iE(s.font),f=(l=e.ctx,c=p,u=hS(u=e._pointLabels[h])?u:[u],{w:DT(l,c.string,u),h:u.length*c.lineHeight});n[h]=f;const m=JS(e.getIndexAngle(h)+a),g=Math.round($S(m));yC(i,t,m,_C(g,d.x,f.w,0,180),_C(g,d.y,f.h,90,270))}var l,c,u;e.setCenterPoint(t.l-i.l,i.r-t.r,t.t-i.t,i.b-t.b),e._pointLabelItems=function(e,t,i){const n=[],r=e._pointLabels.length,s=e.options,{centerPointLabels:o,display:a}=s.pointLabels,l={extra:gC(s)/2,additionalAngle:o?RS/r:0};let c;for(let s=0;s<r;s++){l.padding=i[s],l.size=t[s];const r=vC(e,s,l);n.push(r),"auto"===a&&(r.visible=xC(r,c),r.visible&&(c=r))}return n}(e,n,r)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,i,n){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((i-n)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,i,n))}getIndexAngle(e){return JS(e*(LS/(this._pointLabels.length||1))+qS(this.options.startAngle||0))}getDistanceFromCenterForValue(e){if(uS(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(uS(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const i=t[e];return function(e,t,i){return rE(e,{label:i,index:t,type:"pointLabel"})}(this.getContext(),e,i)}}getPointPosition(e,t,i=0){const n=this.getIndexAngle(e)-zS+i;return{x:Math.cos(n)*t+this.xCenter,y:Math.sin(n)*t+this.yCenter,angle:n}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:i,right:n,bottom:r}=this._pointLabelItems[e];return{left:t,top:i,right:n,bottom:r}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const i=this.ctx;i.save(),i.beginPath(),wC(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),i.closePath(),i.fillStyle=e,i.fill(),i.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:i,grid:n,border:r}=t,s=this._pointLabels.length;let o,a,l;if(t.pointLabels.display&&function(e,t){const{ctx:i,options:{pointLabels:n}}=e;for(let r=t-1;r>=0;r--){const t=e._pointLabelItems[r];if(!t.visible)continue;const s=n.setContext(e.getPointLabelContext(r));bC(i,s,t);const o=iE(s.font),{x:a,y:l,textAlign:c}=t;qT(i,e._pointLabels[r],a,l+o.lineHeight/2,o,{color:s.color,textAlign:c,textBaseline:"middle"})}}(this,s),n.display&&this.ticks.forEach(((e,t)=>{if(0!==t||0===t&&this.min<0){a=this.getDistanceFromCenterForValue(e.value);const i=this.getContext(t),o=n.setContext(i),l=r.setContext(i);!function(e,t,i,n,r){const s=e.ctx,o=t.circular,{color:a,lineWidth:l}=t;!o&&!n||!a||!l||i<0||(s.save(),s.strokeStyle=a,s.lineWidth=l,s.setLineDash(r.dash),s.lineDashOffset=r.dashOffset,s.beginPath(),wC(e,i,o,n),s.closePath(),s.stroke(),s.restore())}(this,o,a,s,l)}})),i.display){for(e.save(),o=s-1;o>=0;o--){const n=i.setContext(this.getPointLabelContext(o)),{color:r,lineWidth:s}=n;s&&r&&(e.lineWidth=s,e.strokeStyle=r,e.setLineDash(n.borderDash),e.lineDashOffset=n.borderDashOffset,a=this.getDistanceFromCenterForValue(t.ticks.reverse?this.min:this.max),l=this.getPointPosition(o,a),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(l.x,l.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,i=t.ticks;if(!i.display)return;const n=this.getIndexAngle(0);let r,s;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(n),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach(((n,o)=>{if(0===o&&this.min>=0&&!t.reverse)return;const a=i.setContext(this.getContext(o)),l=iE(a.font);if(r=this.getDistanceFromCenterForValue(this.ticks[o].value),a.showLabelBackdrop){e.font=l.string,s=e.measureText(n.label).width,e.fillStyle=a.backdropColor;const t=tE(a.backdropPadding);e.fillRect(-s/2-t.left,-r-l.size/2-t.top,s+t.width,l.size+t.height)}qT(e,n.label,0,-r,l,{color:a.color,strokeColor:a.textStrokeColor,strokeWidth:a.textStrokeWidth})})),e.restore()}drawTitle(){}}const TC={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},EC=Object.keys(TC);function MC(e,t){return e-t}function IC(e,t){if(uS(t))return null;const i=e._adapter,{parser:n,round:r,isoWeekday:s}=e._parseOpts;let o=t;return"function"==typeof n&&(o=n(o)),pS(o)||(o="string"==typeof n?i.parse(o,n):i.parse(o)),null===o?null:(r&&(o="week"!==r||!HS(s)&&!0!==s?i.startOf(o,r):i.startOf(o,"isoWeek",s)),+o)}function AC(e,t,i,n){const r=EC.length;for(let s=EC.indexOf(e);s<r-1;++s){const e=TC[EC[s]],r=e.steps?e.steps:Number.MAX_SAFE_INTEGER;if(e.common&&Math.ceil((i-t)/(r*e.size))<=n)return EC[s]}return EC[r-1]}function CC(e,t,i){if(i){if(i.length){const{lo:n,hi:r}=iT(i,t);e[i[n]>=t?i[n]:i[r]]=!0}}else e[t]=!0}function PC(e,t,i){const n=[],r={},s=t.length;let o,a;for(o=0;o<s;++o)a=t[o],r[a]=o,n.push({value:a,major:!1});return 0!==s&&i?function(e,t,i,n){const r=e._adapter,s=+r.startOf(t[0].value,n),o=t[t.length-1].value;let a,l;for(a=s;a<=o;a=+r.add(a,1,n))l=i[a],l>=0&&(t[l].major=!0);return t}(e,n,r,i):n}class kC extends _I{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){const i=e.time||(e.time={}),n=this._adapter=new MM(e.adapters.date);n.init(t),TS(i.displayFormats,n.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return void 0===e?null:IC(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,i=e.time.unit||"day";let{min:n,max:r,minDefined:s,maxDefined:o}=this.getUserBounds();function a(e){s||isNaN(e.min)||(n=Math.min(n,e.min)),o||isNaN(e.max)||(r=Math.max(r,e.max))}s&&o||(a(this._getLabelBounds()),"ticks"===e.bounds&&"labels"===e.ticks.source||a(this.getMinMax(!1))),n=pS(n)&&!isNaN(n)?n:+t.startOf(Date.now(),i),r=pS(r)&&!isNaN(r)?r:+t.endOf(Date.now(),i)+1,this.min=Math.min(n,r-1),this.max=Math.max(n+1,r)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],i=e[e.length-1]),{min:t,max:i}}buildTicks(){const e=this.options,t=e.time,i=e.ticks,n="labels"===i.source?this.getLabelTimestamps():this._generate();"ticks"===e.bounds&&n.length&&(this.min=this._userMin||n[0],this.max=this._userMax||n[n.length-1]);const r=this.min,s=function(e,t,i){let n=0,r=e.length;for(;n<r&&e[n]<t;)n++;for(;r>n&&e[r-1]>i;)r--;return n>0||r<e.length?e.slice(n,r):e}(n,r,this.max);return this._unit=t.unit||(i.autoSkip?AC(t.minUnit,this.min,this.max,this._getLabelCapacity(r)):function(e,t,i,n,r){for(let s=EC.length-1;s>=EC.indexOf(i);s--){const i=EC[s];if(TC[i].common&&e._adapter.diff(r,n,i)>=t-1)return i}return EC[i?EC.indexOf(i):0]}(this,s.length,t.minUnit,this.min,this.max)),this._majorUnit=i.major.enabled&&"year"!==this._unit?function(e){for(let t=EC.indexOf(e)+1,i=EC.length;t<i;++t)if(TC[EC[t]].common)return EC[t]}(this._unit):void 0,this.initOffsets(n),e.reverse&&s.reverse(),PC(this,s,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map((e=>+e.value)))}initOffsets(e=[]){let t,i,n=0,r=0;this.options.offset&&e.length&&(t=this.getDecimalForValue(e[0]),n=1===e.length?1-t:(this.getDecimalForValue(e[1])-t)/2,i=this.getDecimalForValue(e[e.length-1]),r=1===e.length?i:(i-this.getDecimalForValue(e[e.length-2]))/2);const s=e.length<3?.5:.25;n=eT(n,0,s),r=eT(r,0,s),this._offsets={start:n,end:r,factor:1/(n+1+r)}}_generate(){const e=this._adapter,t=this.min,i=this.max,n=this.options,r=n.time,s=r.unit||AC(r.minUnit,t,i,this._getLabelCapacity(t)),o=mS(n.ticks.stepSize,1),a="week"===s&&r.isoWeekday,l=HS(a)||!0===a,c={};let u,h,d=t;if(l&&(d=+e.startOf(d,"isoWeek",a)),d=+e.startOf(d,l?"day":s),e.diff(i,t,s)>1e5*o)throw new Error(t+" and "+i+" are too far apart with stepSize of "+o+" "+s);const p="data"===n.ticks.source&&this.getDataTimestamps();for(u=d,h=0;u<i;u=+e.add(u,o,s),h++)CC(c,u,p);return u!==i&&"ticks"!==n.bounds&&1!==h||CC(c,u,p),Object.keys(c).sort(MC).map((e=>+e))}getLabelForValue(e){const t=this._adapter,i=this.options.time;return i.tooltipFormat?t.format(e,i.tooltipFormat):t.format(e,i.displayFormats.datetime)}format(e,t){const i=this.options.time.displayFormats,n=this._unit,r=t||i[n];return this._adapter.format(e,r)}_tickFormatFunction(e,t,i,n){const r=this.options,s=r.ticks.callback;if(s)return _S(s,[e,t,i],this);const o=r.time.displayFormats,a=this._unit,l=this._majorUnit,c=a&&o[a],u=l&&o[l],h=i[t],d=l&&u&&h&&h.major;return this._adapter.format(e,n||(d?u:c))}generateTickLabels(e){let t,i,n;for(t=0,i=e.length;t<i;++t)n=e[t],n.label=this._tickFormatFunction(n.value,t,e)}getDecimalForValue(e){return null===e?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,i=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+i)*t.factor)}getValueForPixel(e){const t=this._offsets,i=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+i*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,i=this.ctx.measureText(e).width,n=qS(this.isHorizontal()?t.maxRotation:t.minRotation),r=Math.cos(n),s=Math.sin(n),o=this._resolveTickFontOptions(0).size;return{w:i*r+o*s,h:i*s+o*r}}_getLabelCapacity(e){const t=this.options.time,i=t.displayFormats,n=i[t.unit]||i.millisecond,r=this._tickFormatFunction(e,0,PC(this,[e],this._majorUnit),n),s=this._getLabelSize(r),o=Math.floor(this.isHorizontal()?this.width/s.w:this.height/s.h)-1;return o>0?o:1}getDataTimestamps(){let e,t,i=this._cache.data||[];if(i.length)return i;const n=this.getMatchingVisibleMetas();if(this._normalized&&n.length)return this._cache.data=n[0].controller.getAllParsedValues(this);for(e=0,t=n.length;e<t;++e)i=i.concat(n[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(i)}getLabelTimestamps(){const e=this._cache.labels||[];let t,i;if(e.length)return e;const n=this.getLabels();for(t=0,i=n.length;t<i;++t)e.push(IC(this,n[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return aT(e.sort(MC))}}function RC(e,t,i){let n,r,s,o,a=0,l=e.length-1;i?(t>=e[a].pos&&t<=e[l].pos&&({lo:a,hi:l}=nT(e,"pos",t)),({pos:n,time:s}=e[a]),({pos:r,time:o}=e[l])):(t>=e[a].time&&t<=e[l].time&&({lo:a,hi:l}=nT(e,"time",t)),({time:n,pos:s}=e[a]),({time:r,pos:o}=e[l]));const c=r-n;return c?s+(o-s)*(t-n)/c:s}var LC=Object.freeze({__proto__:null,CategoryScale:class extends _I{static id="category";static defaults={ticks:{callback:aC}};constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const e=this.getLabels();for(const{index:i,label:n}of t)e[i]===n&&e.splice(i,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(uS(e))return null;const i=this.getLabels();return((e,t)=>null===e?null:eT(Math.round(e),0,t))(t=isFinite(t)&&i[t]===e?t:function(e,t,i,n){const r=e.indexOf(t);return-1===r?((e,t,i,n)=>("string"==typeof t?(i=e.push(t)-1,n.unshift({index:i,label:t})):isNaN(t)&&(i=null),i))(e,t,i,n):r!==e.lastIndexOf(t)?i:r}(i,e,mS(t,e),this._addedLabels),i.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:i,max:n}=this.getMinMax(!0);"ticks"===this.options.bounds&&(e||(i=0),t||(n=this.getLabels().length-1)),this.min=i,this.max=n}buildTicks(){const e=this.min,t=this.max,i=this.options.offset,n=[];let r=this.getLabels();r=0===e&&t===r.length-1?r:r.slice(e,t+1),this._valueRange=Math.max(r.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let i=e;i<=t;i++)n.push({value:i});return n}getLabelForValue(e){return aC.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return"number"!=typeof e&&(e=this.parse(e)),null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}},LinearScale:uC,LogarithmicScale:mC,RadialLinearScale:SC,TimeScale:kC,TimeSeriesScale:class extends kC{static id="timeseries";static defaults=kC.defaults;constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=RC(t,this.min),this._tableRange=RC(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:i}=this,n=[],r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;++s)l=e[s],l>=t&&l<=i&&n.push(l);if(n.length<2)return[{time:t,pos:0},{time:i,pos:1}];for(s=0,o=n.length;s<o;++s)c=n[s+1],a=n[s-1],l=n[s],Math.round((c+a)/2)!==l&&r.push({time:l,pos:s/(o-1)});return r}_generate(){const e=this.min,t=this.max;let i=super.getDataTimestamps();return i.includes(e)&&i.length||i.splice(0,0,e),i.includes(t)&&1!==i.length||i.push(t),i.sort(((e,t)=>e-t))}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),i=this.getLabelTimestamps();return e=t.length&&i.length?this.normalize(t.concat(i)):t.length?t:i,e=this._cache.all=e,e}getDecimalForValue(e){return(RC(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,i=this.getDecimalForPixel(e)/t.factor-t.end;return RC(this._table,i*this._tableRange+this._minPos,!0)}}});const DC=[SM,hA,oC,LC];$I.register(...DC);const OC=$I,NC={type:"doughnut",data:{labels:["Undefined","Full","Partly","Bare"],datasets:[{label:" Deep Learning Prediction",data:[.3,.5,.15,.05],backgroundColor:["#554f56","#E51000","#EFC44E","#80B932"],hoverOffset:4}]},options:{elements:{point:{borderColor:"rgba(255, 255, 255, 0)",borderWidth:8}},plugins:{legend:{position:"right",labels:{padding:30,boxHeight:20,boxWidth:20,textAlign:"right",usePointStyle:!0,font:{size:14},color:"white"},onClick:function(e,t,i){i.chart.toggleDataVisibility(t.index),i.chart.update(),function(e){const t=FC.indexOf(e);-1!==t?FC.splice(t,1):FC.push(e),console.log(FC),oV.setFilter("latestLayer",["in","classification"].concat(FC)),oV.setFilter("latestInterpolationLayer",["in","classification"].concat(FC))}(t.text)}},maintainAspectRatio:!1,responsive:!0,animation:{animateRotate:!0,animateScale:!0},layout:{padding:20},hoverOffset:20}}};let zC,FC=["Full","Bare","Partly","Undefined"];function BC(){document.getElementById("inner-console").clientWidth<420?(NC.options.plugins.legend.position="top",NC.options.plugins.legend.labels.padding=15):(NC.options.plugins.legend.position="right",NC.options.plugins.legend.labels.padding=30,NC.options.plugins.legend.padding=5)}function UC(e){e.data.datasets[0].data=[],e.update(),e.canvas.parentNode.style.display="none"}function VC(e,t){const i=JSON.parse(t),n=[i.Undefined,i.Full,i.Partly,i.Bare],r=(8,n.map((function(e){return parseFloat(e.toFixed(8))})));e.data.datasets[0].data=r,e.update(),e.canvas.parentNode.style.display="flex"}let jC=!1;window.addEventListener("mousedown",(e=>{"console"===e.target.id&&(jC=!0)})),window.addEventListener("mousemove",(()=>{jC&&(BC(),zC.update())})),window.addEventListener("mouseup",(()=>{jC=!1})),BC();const GC="137",HC=0,WC=1,qC=2,$C=1,ZC=2,XC=3,YC=0,KC=1,JC=2,QC=0,eP=1,tP=2,iP=3,nP=4,rP=5,sP=100,oP=101,aP=102,lP=103,cP=104,uP=200,hP=201,dP=202,pP=203,fP=204,mP=205,gP=206,_P=207,yP=208,vP=209,xP=210,bP=0,wP=1,SP=2,TP=3,EP=4,MP=5,IP=6,AP=7,CP=0,PP=1,kP=2,RP=0,LP=1,DP=2,OP=3,NP=4,zP=5,FP=301,BP=302,UP=303,VP=304,jP=306,GP=307,HP=1e3,WP=1001,qP=1002,$P=1003,ZP=1004,XP=1005,YP=1006,KP=1007,JP=1008,QP=1009,ek=1010,tk=1011,ik=1012,nk=1013,rk=1014,sk=1015,ok=1016,ak=1017,lk=1018,ck=1020,uk=1021,hk=1022,dk=1023,pk=1024,fk=1025,mk=1026,gk=1027,_k=1028,yk=1029,vk=1030,xk=1031,bk=1033,wk=33776,Sk=33777,Tk=33778,Ek=33779,Mk=35840,Ik=35841,Ak=35842,Ck=35843,Pk=36196,kk=37492,Rk=37496,Lk=37808,Dk=37809,Ok=37810,Nk=37811,zk=37812,Fk=37813,Bk=37814,Uk=37815,Vk=37816,jk=37817,Gk=37818,Hk=37819,Wk=37820,qk=37821,$k=36492,Zk=2300,Xk=2301,Yk=2302,Kk=2400,Jk=2401,Qk=2402,eR=3e3,tR=3001,iR=3201,nR=0,rR=1,sR=7680,oR=35044,aR=35048,lR="300 es",cR=1035;class uR{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e);e.target=null}}}const hR=[];for(let e=0;e<256;e++)hR[e]=(e<16?"0":"")+e.toString(16);const dR=Math.PI/180,pR=180/Math.PI;function fR(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(hR[255&e]+hR[e>>8&255]+hR[e>>16&255]+hR[e>>24&255]+"-"+hR[255&t]+hR[t>>8&255]+"-"+hR[t>>16&15|64]+hR[t>>24&255]+"-"+hR[63&i|128]+hR[i>>8&255]+"-"+hR[i>>16&255]+hR[i>>24&255]+hR[255&n]+hR[n>>8&255]+hR[n>>16&255]+hR[n>>24&255]).toUpperCase()}function mR(e,t,i){return Math.max(t,Math.min(i,e))}function gR(e,t,i){return(1-i)*e+i*t}function _R(e){return!(e&e-1)&&0!==e}function yR(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}class vR{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*i-s*n+e.x,this.y=r*n+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}vR.prototype.isVector2=!0;class xR{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,n,r,s,o,a,l){const c=this.elements;return c[0]=e,c[1]=n,c[2]=o,c[3]=t,c[4]=r,c[5]=a,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,s=i[0],o=i[3],a=i[6],l=i[1],c=i[4],u=i[7],h=i[2],d=i[5],p=i[8],f=n[0],m=n[3],g=n[6],_=n[1],y=n[4],v=n[7],x=n[2],b=n[5],w=n[8];return r[0]=s*f+o*_+a*x,r[3]=s*m+o*y+a*b,r[6]=s*g+o*v+a*w,r[1]=l*f+c*_+u*x,r[4]=l*m+c*y+u*b,r[7]=l*g+c*v+u*w,r[2]=h*f+d*_+p*x,r[5]=h*m+d*y+p*b,r[8]=h*g+d*v+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*s*c-t*o*l-i*r*c+i*o*a+n*r*l-n*s*a}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=c*s-o*l,h=o*a-c*r,d=l*r-s*a,p=t*u+i*h+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(n*l-c*i)*f,e[2]=(o*i-n*s)*f,e[3]=h*f,e[4]=(c*t-n*a)*f,e[5]=(n*r-o*t)*f,e[6]=d*f,e[7]=(i*a-l*t)*f,e[8]=(s*t-i*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(i*a,i*l,-i*(a*s+l*o)+s+e,-n*l,n*a,-n*(-l*s+a*o)+o+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),n=this.elements,r=n[0],s=n[3],o=n[6],a=n[1],l=n[4],c=n[7];return n[0]=t*r+i*a,n[3]=t*s+i*l,n[6]=t*o+i*c,n[1]=-i*r+t*a,n[4]=-i*s+t*l,n[7]=-i*o+t*c,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function bR(e){for(let t=e.length-1;t>=0;--t)if(e[t]>65535)return!0;return!1}function wR(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}xR.prototype.isMatrix3=!0;const SR={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},TR={h:0,s:0,l:0},ER={h:0,s:0,l:0};function MR(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function IR(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function AR(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class CR{constructor(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=function(e,t){return(e%1+1)%1}(e),t=mR(t,0,1),i=mR(i,0,1),0===t)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+t):i+t-i*t,r=2*i-n;this.r=MR(r,n,e+1/3),this.g=MR(r,n,e),this.b=MR(r,n,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const n=i[1],r=i[2];switch(n){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const i=parseFloat(e[1])/360,n=parseInt(e[2],10)/100,r=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(i,n,r)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=SR[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=IR(e.r),this.g=IR(e.g),this.b=IR(e.b),this}copyLinearToSRGB(e){return this.r=AR(e.r),this.g=AR(e.g),this.b=AR(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,i=this.g,n=this.b,r=Math.max(t,i,n),s=Math.min(t,i,n);let o,a;const l=(s+r)/2;if(s===r)o=0,a=0;else{const e=r-s;switch(a=l<=.5?e/(r+s):e/(2-r-s),r){case t:o=(i-n)/e+(i<n?6:0);break;case i:o=(n-t)/e+2;break;case n:o=(t-i)/e+4}o/=6}return e.h=o,e.s=a,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,i){return this.getHSL(TR),TR.h+=e,TR.s+=t,TR.l+=i,this.setHSL(TR.h,TR.s,TR.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(TR),e.getHSL(ER);const i=gR(TR.h,ER.h,t),n=gR(TR.s,ER.s,t),r=gR(TR.l,ER.l,t);return this.setHSL(i,n,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}let PR;CR.NAMES=SR,CR.prototype.isColor=!0,CR.prototype.r=1,CR.prototype.g=1,CR.prototype.b=1;class kR{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===PR&&(PR=wR("canvas")),PR.width=e.width,PR.height=e.height;const i=PR.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=PR}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=wR("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let e=0;e<r.length;e++)r[e]=255*IR(r[e]/255);return i.putImageData(n,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*IR(t[e]/255)):t[e]=IR(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let RR=0;class LR extends uR{constructor(e=LR.DEFAULT_IMAGE,t=LR.DEFAULT_MAPPING,i=WP,n=WP,r=YP,s=JP,o=dk,a=QP,l=1,c=eR){super(),Object.defineProperty(this,"id",{value:RR++}),this.uuid=fR(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new vR(0,0),this.repeat=new vR(1,1),this.center=new vR(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new xR,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=fR()),!t&&void 0===e.images[n.uuid]){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(DR(n[e].image)):t.push(DR(n[e]))}else t=DR(n);e.images[n.uuid]={uuid:n.uuid,url:t}}i.image=n.uuid}return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case HP:e.x=e.x-Math.floor(e.x);break;case WP:e.x=e.x<0?0:1;break;case qP:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case HP:e.y=e.y-Math.floor(e.y);break;case WP:e.y=e.y<0?0:1;break;case qP:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function DR(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?kR.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}LR.DEFAULT_IMAGE=void 0,LR.DEFAULT_MAPPING=300,LR.prototype.isTexture=!0;class OR{constructor(e=0,t=0,i=0,n=1){this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*t+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*t+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*t+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;const s=.01,o=.1,a=e.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<s&&Math.abs(u-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(d+1)/2,_=(g+1)/2,y=(c+h)/4,v=(u+f)/4,x=(p+m)/4;return e>a&&e>_?e<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(e),n=y/i,r=v/i):a>_?a<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(a),i=y/n,r=x/n):_<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(_),i=v/r,n=x/r),this.set(i,n,r,t),this}let _=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(_)<.001&&(_=1),this.x=(m-p)/_,this.y=(u-f)/_,this.z=(h-c)/_,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}OR.prototype.isVector4=!0;class NR extends uR{constructor(e,t,i={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new OR(0,0,e,t),this.scissorTest=!1,this.viewport=new OR(0,0,e,t),this.texture=new LR(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:YP,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,i=1){this.width===e&&this.height===t&&this.depth===i||(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}NR.prototype.isWebGLRenderTarget=!0,class extends NR{constructor(e,t,i){super(e,t);const n=this.texture;this.texture=[];for(let e=0;e<i;e++)this.texture[e]=n.clone()}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=e,this.texture[n].image.height=t,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone();return this}}.prototype.isWebGLMultipleRenderTargets=!0;class zR extends NR{constructor(e,t,i={}){super(e,t,i),this.samples=4,this.ignoreDepthForMultisampleCopy=void 0===i.ignoreDepth||i.ignoreDepth,this.useRenderToTexture=void 0!==i.useRenderToTexture&&i.useRenderToTexture,this.useRenderbuffer=!1===this.useRenderToTexture}copy(e){return super.copy.call(this,e),this.samples=e.samples,this.useRenderToTexture=e.useRenderToTexture,this.useRenderbuffer=e.useRenderbuffer,this}}zR.prototype.isWebGLMultisampleRenderTarget=!0;class FR{constructor(e=0,t=0,i=0,n=1){this._x=e,this._y=t,this._z=i,this._w=n}static slerp(e,t,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,n)}static slerpFlat(e,t,i,n,r,s,o){let a=i[n+0],l=i[n+1],c=i[n+2],u=i[n+3];const h=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===o)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===o)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||a!==h||l!==d||c!==p){let e=1-o;const t=a*h+l*d+c*p+u*f,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,t*i);e=Math.sin(e*s)/r,o=Math.sin(o*s)/r}const r=o*i;if(a=a*e+h*r,l=l*e+d*r,c=c*e+p*r,u=u*e+f*r,e===1-o){const e=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=e,l*=e,c*=e,u*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,n,r,s){const o=i[n],a=i[n+1],l=i[n+2],c=i[n+3],u=r[s],h=r[s+1],d=r[s+2],p=r[s+3];return e[t]=o*p+c*u+a*d-l*h,e[t+1]=a*p+c*h+l*u-o*d,e[t+2]=l*p+c*d+o*h-a*u,e[t+3]=c*p-o*u-a*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,n=e._y,r=e._z,s=e._order,o=Math.cos,a=Math.sin,l=o(i/2),c=o(n/2),u=o(r/2),h=a(i/2),d=a(n/2),p=a(r/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],r=t[8],s=t[1],o=t[5],a=t[9],l=t[2],c=t[6],u=t[10],h=i+o+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-a)*e,this._y=(r-l)*e,this._z=(s-n)*e}else if(i>o&&i>u){const e=2*Math.sqrt(1+i-o-u);this._w=(c-a)/e,this._x=.25*e,this._y=(n+s)/e,this._z=(r+l)/e}else if(o>u){const e=2*Math.sqrt(1+o-i-u);this._w=(r-l)/e,this._x=(n+s)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+u-i-o);this._w=(s-n)/e,this._x=(r+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(mR(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,r=e._z,s=e._w,o=t._x,a=t._y,l=t._z,c=t._w;return this._x=i*c+s*o+n*l-r*a,this._y=n*c+s*a+r*o-i*l,this._z=r*c+s*l+i*a-n*o,this._w=s*c-i*o-n*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,n=this._y,r=this._z,s=this._w;let o=s*e._w+i*e._x+n*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=s*u+this._w*h,this._x=i*u+this._x*h,this._y=n*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(n),i*Math.sin(r),i*Math.cos(r),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}FR.prototype.isQuaternion=!0;class BR{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(VR.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(VR.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=e.elements,s=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,s=e.y,o=e.z,a=e.w,l=a*t+s*n-o*i,c=a*i+o*t-r*n,u=a*n+r*i-s*t,h=-r*t-s*i-o*n;return this.x=l*a+h*-r+c*-o-u*-s,this.y=c*a+h*-s+u*-r-l*-o,this.z=u*a+h*-o+l*-s-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,r=e.z,s=t.x,o=t.y,a=t.z;return this.x=n*a-r*o,this.y=r*s-i*a,this.z=i*o-n*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return UR.copy(this).projectOnVector(e),this.sub(UR)}reflect(e){return this.sub(UR.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(mR(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}BR.prototype.isVector3=!0;const UR=new BR,VR=new FR;class jR{constructor(e=new BR(1/0,1/0,1/0),t=new BR(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],u=e[a+2];l<t&&(t=l),c<i&&(i=c),u<n&&(n=u),l>r&&(r=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(t,i,n),this.max.set(r,s,o),this}setFromBufferAttribute(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.count;a<l;a++){const l=e.getX(a),c=e.getY(a),u=e.getZ(a);l<t&&(t=l),c<i&&(i=c),u<n&&(n=u),l>r&&(r=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(t,i,n),this.max.set(r,s,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=HR.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(void 0!==i)if(t&&null!=i.attributes&&void 0!==i.attributes.position){const t=i.attributes.position;for(let i=0,n=t.count;i<n;i++)HR.fromBufferAttribute(t,i).applyMatrix4(e.matrixWorld),this.expandByPoint(HR)}else null===i.boundingBox&&i.computeBoundingBox(),WR.copy(i.boundingBox),WR.applyMatrix4(e.matrixWorld),this.union(WR);const n=e.children;for(let e=0,i=n.length;e<i;e++)this.expandByObject(n[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,HR),HR.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(JR),QR.subVectors(this.max,JR),qR.subVectors(e.a,JR),$R.subVectors(e.b,JR),ZR.subVectors(e.c,JR),XR.subVectors($R,qR),YR.subVectors(ZR,$R),KR.subVectors(qR,ZR);let t=[0,-XR.z,XR.y,0,-YR.z,YR.y,0,-KR.z,KR.y,XR.z,0,-XR.x,YR.z,0,-YR.x,KR.z,0,-KR.x,-XR.y,XR.x,0,-YR.y,YR.x,0,-KR.y,KR.x,0];return!!iL(t,qR,$R,ZR,QR)&&(t=[1,0,0,0,1,0,0,0,1],!!iL(t,qR,$R,ZR,QR)&&(eL.crossVectors(XR,YR),t=[eL.x,eL.y,eL.z],iL(t,qR,$R,ZR,QR)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return HR.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(HR).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(GR[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),GR[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),GR[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),GR[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),GR[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),GR[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),GR[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),GR[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(GR)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}jR.prototype.isBox3=!0;const GR=[new BR,new BR,new BR,new BR,new BR,new BR,new BR,new BR],HR=new BR,WR=new jR,qR=new BR,$R=new BR,ZR=new BR,XR=new BR,YR=new BR,KR=new BR,JR=new BR,QR=new BR,eL=new BR,tL=new BR;function iL(e,t,i,n,r){for(let s=0,o=e.length-3;s<=o;s+=3){tL.fromArray(e,s);const o=r.x*Math.abs(tL.x)+r.y*Math.abs(tL.y)+r.z*Math.abs(tL.z),a=t.dot(tL),l=i.dot(tL),c=n.dot(tL);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const nL=new jR,rL=new BR,sL=new BR,oL=new BR;class aL{constructor(e=new BR,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):nL.setFromPoints(e).getCenter(i);let n=0;for(let t=0,r=e.length;t<r;t++)n=Math.max(n,i.distanceToSquared(e[t]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){oL.subVectors(e,this.center);const t=oL.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),i=.5*(e-this.radius);this.center.add(oL.multiplyScalar(i/e)),this.radius+=i}return this}union(e){return!0===this.center.equals(e.center)?sL.set(0,0,1).multiplyScalar(e.radius):sL.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(rL.copy(e.center).add(sL)),this.expandByPoint(rL.copy(e.center).sub(sL)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const lL=new BR,cL=new BR,uL=new BR,hL=new BR,dL=new BR,pL=new BR,fL=new BR;class mL{constructor(e=new BR,t=new BR(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,lL)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=lL.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(lL.copy(this.direction).multiplyScalar(t).add(this.origin),lL.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){cL.copy(e).add(t).multiplyScalar(.5),uL.copy(t).sub(e).normalize(),hL.copy(this.origin).sub(cL);const r=.5*e.distanceTo(t),s=-this.direction.dot(uL),o=hL.dot(this.direction),a=-hL.dot(uL),l=hL.lengthSq(),c=Math.abs(1-s*s);let u,h,d,p;if(c>0)if(u=s*a-o,h=s*o-a,p=r*c,u>=0)if(h>=-p)if(h<=p){const e=1/c;u*=e,h*=e,d=u*(u+s*h+2*o)+h*(s*u+h+2*a)+l}else h=r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;else h=-r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-s*r+o)),h=u>0?-r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-a),r),d=h*(h+2*a)+l):(u=Math.max(0,-(s*r+o)),h=u>0?r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l);else h=s>0?-r:r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),n&&n.copy(uL).multiplyScalar(h).add(cL),d}intersectSphere(e,t){lL.subVectors(e.center,this.origin);const i=lL.dot(this.direction),n=lL.dot(lL)-i*i,r=e.radius*e.radius;if(n>r)return null;const s=Math.sqrt(r-n),o=i-s,a=i+s;return o<0&&a<0?null:o<0?this.at(a,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,n=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,n=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),u>=0?(o=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(o=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,t)))}intersectsBox(e){return null!==this.intersectBox(e,lL)}intersectTriangle(e,t,i,n,r){dL.subVectors(t,e),pL.subVectors(i,e),fL.crossVectors(dL,pL);let s,o=this.direction.dot(fL);if(o>0){if(n)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}hL.subVectors(this.origin,e);const a=s*this.direction.dot(pL.crossVectors(hL,pL));if(a<0)return null;const l=s*this.direction.dot(dL.cross(hL));if(l<0)return null;if(a+l>o)return null;const c=-s*hL.dot(fL);return c<0?null:this.at(c/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class gL{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,n,r,s,o,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new gL).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/_L.setFromMatrixColumn(e,0).length(),r=1/_L.setFromMatrixColumn(e,1).length(),s=1/_L.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,n=e.y,r=e.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=s*c,i=s*u,n=o*c,r=o*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=i+n*l,t[5]=e-r*l,t[9]=-o*a,t[2]=r-e*l,t[6]=n+i*l,t[10]=s*a}else if("YXZ"===e.order){const e=a*c,i=a*u,n=l*c,r=l*u;t[0]=e+r*o,t[4]=n*o-i,t[8]=s*l,t[1]=s*u,t[5]=s*c,t[9]=-o,t[2]=i*o-n,t[6]=r+e*o,t[10]=s*a}else if("ZXY"===e.order){const e=a*c,i=a*u,n=l*c,r=l*u;t[0]=e-r*o,t[4]=-s*u,t[8]=n+i*o,t[1]=i+n*o,t[5]=s*c,t[9]=r-e*o,t[2]=-s*l,t[6]=o,t[10]=s*a}else if("ZYX"===e.order){const e=s*c,i=s*u,n=o*c,r=o*u;t[0]=a*c,t[4]=n*l-i,t[8]=e*l+r,t[1]=a*u,t[5]=r*l+e,t[9]=i*l-n,t[2]=-l,t[6]=o*a,t[10]=s*a}else if("YZX"===e.order){const e=s*a,i=s*l,n=o*a,r=o*l;t[0]=a*c,t[4]=r-e*u,t[8]=n*u+i,t[1]=u,t[5]=s*c,t[9]=-o*c,t[2]=-l*c,t[6]=i*u+n,t[10]=e-r*u}else if("XZY"===e.order){const e=s*a,i=s*l,n=o*a,r=o*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=s*c,t[9]=i*u-n,t[2]=n*u-i,t[6]=o*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(vL,e,xL)}lookAt(e,t,i){const n=this.elements;return SL.subVectors(e,t),0===SL.lengthSq()&&(SL.z=1),SL.normalize(),bL.crossVectors(i,SL),0===bL.lengthSq()&&(1===Math.abs(i.z)?SL.x+=1e-4:SL.z+=1e-4,SL.normalize(),bL.crossVectors(i,SL)),bL.normalize(),wL.crossVectors(SL,bL),n[0]=bL.x,n[4]=wL.x,n[8]=SL.x,n[1]=bL.y,n[5]=wL.y,n[9]=SL.y,n[2]=bL.z,n[6]=wL.z,n[10]=SL.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,s=i[0],o=i[4],a=i[8],l=i[12],c=i[1],u=i[5],h=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],_=i[3],y=i[7],v=i[11],x=i[15],b=n[0],w=n[4],S=n[8],T=n[12],E=n[1],M=n[5],I=n[9],A=n[13],C=n[2],P=n[6],k=n[10],R=n[14],L=n[3],D=n[7],O=n[11],N=n[15];return r[0]=s*b+o*E+a*C+l*L,r[4]=s*w+o*M+a*P+l*D,r[8]=s*S+o*I+a*k+l*O,r[12]=s*T+o*A+a*R+l*N,r[1]=c*b+u*E+h*C+d*L,r[5]=c*w+u*M+h*P+d*D,r[9]=c*S+u*I+h*k+d*O,r[13]=c*T+u*A+h*R+d*N,r[2]=p*b+f*E+m*C+g*L,r[6]=p*w+f*M+m*P+g*D,r[10]=p*S+f*I+m*k+g*O,r[14]=p*T+f*A+m*R+g*N,r[3]=_*b+y*E+v*C+x*L,r[7]=_*w+y*M+v*P+x*D,r[11]=_*S+y*I+v*k+x*O,r[15]=_*T+y*A+v*R+x*N,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],s=e[1],o=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*a*u-n*l*u-r*o*h+i*l*h+n*o*d-i*a*d)+e[7]*(+t*a*d-t*l*h+r*s*h-n*s*d+n*l*c-r*a*c)+e[11]*(+t*l*u-t*o*d-r*s*u+i*s*d+r*o*c-i*l*c)+e[15]*(-n*o*c-t*a*u+t*o*h+n*s*u-i*s*h+i*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],_=u*m*l-f*h*l+f*a*d-o*m*d-u*a*g+o*h*g,y=p*h*l-c*m*l-p*a*d+s*m*d+c*a*g-s*h*g,v=c*f*l-p*u*l+p*o*d-s*f*d-c*o*g+s*u*g,x=p*u*a-c*f*a-p*o*h+s*f*h+c*o*m-s*u*m,b=t*_+i*y+n*v+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return e[0]=_*w,e[1]=(f*h*r-u*m*r-f*n*d+i*m*d+u*n*g-i*h*g)*w,e[2]=(o*m*r-f*a*r+f*n*l-i*m*l-o*n*g+i*a*g)*w,e[3]=(u*a*r-o*h*r-u*n*l+i*h*l+o*n*d-i*a*d)*w,e[4]=y*w,e[5]=(c*m*r-p*h*r+p*n*d-t*m*d-c*n*g+t*h*g)*w,e[6]=(p*a*r-s*m*r-p*n*l+t*m*l+s*n*g-t*a*g)*w,e[7]=(s*h*r-c*a*r+c*n*l-t*h*l-s*n*d+t*a*d)*w,e[8]=v*w,e[9]=(p*u*r-c*f*r-p*i*d+t*f*d+c*i*g-t*u*g)*w,e[10]=(s*f*r-p*o*r+p*i*l-t*f*l-s*i*g+t*o*g)*w,e[11]=(c*o*r-s*u*r-c*i*l+t*u*l+s*i*d-t*o*d)*w,e[12]=x*w,e[13]=(c*f*n-p*u*n+p*i*h-t*f*h-c*i*m+t*u*m)*w,e[14]=(p*o*n-s*f*n-p*i*a+t*f*a+s*i*m-t*o*m)*w,e[15]=(s*u*n-c*o*n+c*i*a-t*u*a-s*i*h+t*o*h)*w,this}scale(e){const t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),r=1-i,s=e.x,o=e.y,a=e.z,l=r*s,c=r*o;return this.set(l*s+i,l*o-n*a,l*a+n*o,0,l*o+n*a,c*o+i,c*a-n*s,0,l*a-n*o,c*a+n*s,r*a*a+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,s){return this.set(1,i,r,0,e,1,s,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,r=t._x,s=t._y,o=t._z,a=t._w,l=r+r,c=s+s,u=o+o,h=r*l,d=r*c,p=r*u,f=s*c,m=s*u,g=o*u,_=a*l,y=a*c,v=a*u,x=i.x,b=i.y,w=i.z;return n[0]=(1-(f+g))*x,n[1]=(d+v)*x,n[2]=(p-y)*x,n[3]=0,n[4]=(d-v)*b,n[5]=(1-(h+g))*b,n[6]=(m+_)*b,n[7]=0,n[8]=(p+y)*w,n[9]=(m-_)*w,n[10]=(1-(h+f))*w,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=_L.set(n[0],n[1],n[2]).length();const s=_L.set(n[4],n[5],n[6]).length(),o=_L.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],yL.copy(this);const a=1/r,l=1/s,c=1/o;return yL.elements[0]*=a,yL.elements[1]*=a,yL.elements[2]*=a,yL.elements[4]*=l,yL.elements[5]*=l,yL.elements[6]*=l,yL.elements[8]*=c,yL.elements[9]*=c,yL.elements[10]*=c,t.setFromRotationMatrix(yL),i.x=r,i.y=s,i.z=o,this}makePerspective(e,t,i,n,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*r/(t-e),l=2*r/(i-n),c=(t+e)/(t-e),u=(i+n)/(i-n),h=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,i,n,r,s){const o=this.elements,a=1/(t-e),l=1/(i-n),c=1/(s-r),u=(t+e)*a,h=(i+n)*l,d=(s+r)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<16;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}gL.prototype.isMatrix4=!0;const _L=new BR,yL=new gL,vL=new BR(0,0,0),xL=new BR(1,1,1),bL=new BR,wL=new BR,SL=new BR,TL=new gL,EL=new FR;class ML{constructor(e=0,t=0,i=0,n=ML.DefaultOrder){this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const n=e.elements,r=n[0],s=n[4],o=n[8],a=n[1],l=n[5],c=n[9],u=n[2],h=n[6],d=n[10];switch(t){case"XYZ":this._y=Math.asin(mR(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-mR(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(mR(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-mR(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(mR(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-mR(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return TL.makeRotationFromQuaternion(e),this.setFromRotationMatrix(TL,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return EL.setFromEuler(this),this.setFromQuaternion(EL,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new BR(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}ML.prototype.isEuler=!0,ML.DefaultOrder="XYZ",ML.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class IL{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let AL=0;const CL=new BR,PL=new FR,kL=new gL,RL=new BR,LL=new BR,DL=new BR,OL=new FR,NL=new BR(1,0,0),zL=new BR(0,1,0),FL=new BR(0,0,1),BL={type:"added"},UL={type:"removed"};class VL extends uR{constructor(){super(),Object.defineProperty(this,"id",{value:AL++}),this.uuid=fR(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=VL.DefaultUp.clone();const e=new BR,t=new ML,i=new FR,n=new BR(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new gL},normalMatrix:{value:new xR}}),this.matrix=new gL,this.matrixWorld=new gL,this.matrixAutoUpdate=VL.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new IL,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return PL.setFromAxisAngle(e,t),this.quaternion.multiply(PL),this}rotateOnWorldAxis(e,t){return PL.setFromAxisAngle(e,t),this.quaternion.premultiply(PL),this}rotateX(e){return this.rotateOnAxis(NL,e)}rotateY(e){return this.rotateOnAxis(zL,e)}rotateZ(e){return this.rotateOnAxis(FL,e)}translateOnAxis(e,t){return CL.copy(e).applyQuaternion(this.quaternion),this.position.add(CL.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(NL,e)}translateY(e){return this.translateOnAxis(zL,e)}translateZ(e){return this.translateOnAxis(FL,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(kL.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?RL.copy(e):RL.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),LL.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?kL.lookAt(LL,RL,this.up):kL.lookAt(RL,LL,this.up),this.quaternion.setFromRotationMatrix(kL),n&&(kL.extractRotation(n.matrixWorld),PL.setFromRotationMatrix(kL),this.quaternion.premultiply(PL.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(BL)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(UL)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(UL)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),kL.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),kL.multiply(e.parent.matrixWorld)),e.applyMatrix4(kL),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(LL,e,DL),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(LL,OL,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const n=i[t];r(e.shapes,n)}else r(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(r(e.materials,this.material[i]));n.material=t}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){const i=this.animations[t];n.animations.push(r(e.animations,i))}}if(t){const t=s(e.geometries),n=s(e.materials),r=s(e.textures),o=s(e.images),a=s(e.shapes),l=s(e.skeletons),c=s(e.animations);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c)}return i.object=n,i;function s(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const i=e.children[t];this.add(i.clone())}return this}}VL.DefaultUp=new BR(0,1,0),VL.DefaultMatrixAutoUpdate=!0,VL.prototype.isObject3D=!0;const jL=new BR,GL=new BR,HL=new BR,WL=new BR,qL=new BR,$L=new BR,ZL=new BR,XL=new BR,YL=new BR,KL=new BR;class JL{constructor(e=new BR,t=new BR,i=new BR){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),jL.subVectors(e,t),n.cross(jL);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){jL.subVectors(n,t),GL.subVectors(i,t),HL.subVectors(e,t);const s=jL.dot(jL),o=jL.dot(GL),a=jL.dot(HL),l=GL.dot(GL),c=GL.dot(HL),u=s*l-o*o;if(0===u)return r.set(-2,-1,-1);const h=1/u,d=(l*a-o*c)*h,p=(s*c-o*a)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,WL),WL.x>=0&&WL.y>=0&&WL.x+WL.y<=1}static getUV(e,t,i,n,r,s,o,a){return this.getBarycoord(e,t,i,n,WL),a.set(0,0),a.addScaledVector(r,WL.x),a.addScaledVector(s,WL.y),a.addScaledVector(o,WL.z),a}static isFrontFacing(e,t,i,n){return jL.subVectors(i,t),GL.subVectors(e,t),jL.cross(GL).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return jL.subVectors(this.c,this.b),GL.subVectors(this.a,this.b),.5*jL.cross(GL).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return JL.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return JL.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,r){return JL.getUV(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return JL.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return JL.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,n=this.b,r=this.c;let s,o;qL.subVectors(n,i),$L.subVectors(r,i),XL.subVectors(e,i);const a=qL.dot(XL),l=$L.dot(XL);if(a<=0&&l<=0)return t.copy(i);YL.subVectors(e,n);const c=qL.dot(YL),u=$L.dot(YL);if(c>=0&&u<=c)return t.copy(n);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return s=a/(a-c),t.copy(i).addScaledVector(qL,s);KL.subVectors(e,r);const d=qL.dot(KL),p=$L.dot(KL);if(p>=0&&d<=p)return t.copy(r);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),t.copy(i).addScaledVector($L,o);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return ZL.subVectors(r,n),o=(u-c)/(u-c+(d-p)),t.copy(n).addScaledVector(ZL,o);const g=1/(m+f+h);return s=f*g,o=h*g,t.copy(i).addScaledVector(qL,s).addScaledVector($L,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let QL=0;class eD extends uR{constructor(){super(),Object.defineProperty(this,"id",{value:QL++}),this.uuid=fR(),this.name="",this.type="Material",this.fog=!0,this.blending=eP,this.side=YC,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=fP,this.blendDst=mP,this.blendEquation=sP,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=TP,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=sR,this.stencilZFail=sR,this.stencilZPass=sR,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;continue}const n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==eP&&(i.blending=this.blending),this.side!==YC&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){const t=n(e.textures),r=n(e.images);t.length>0&&(i.textures=t),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const e=t.length;i=new Array(e);for(let n=0;n!==e;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}eD.prototype.isMaterial=!0;class tD extends eD{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new CR(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=CP,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}tD.prototype.isMeshBasicMaterial=!0;const iD=new BR,nD=new vR;class rD{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=oR,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new CR),t[i++]=r.r,t[i++]=r.g,t[i++]=r.b}return this}copyVector2sArray(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new vR),t[i++]=r.x,t[i++]=r.y}return this}copyVector3sArray(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new BR),t[i++]=r.x,t[i++]=r.y,t[i++]=r.z}return this}copyVector4sArray(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new OR),t[i++]=r.x,t[i++]=r.y,t[i++]=r.z,t[i++]=r.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)nD.fromBufferAttribute(this,t),nD.applyMatrix3(e),this.setXY(t,nD.x,nD.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)iD.fromBufferAttribute(this,t),iD.applyMatrix3(e),this.setXYZ(t,iD.x,iD.y,iD.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)iD.x=this.getX(t),iD.y=this.getY(t),iD.z=this.getZ(t),iD.applyMatrix4(e),this.setXYZ(t,iD.x,iD.y,iD.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)iD.x=this.getX(t),iD.y=this.getY(t),iD.z=this.getZ(t),iD.applyNormalMatrix(e),this.setXYZ(t,iD.x,iD.y,iD.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)iD.x=this.getX(t),iD.y=this.getY(t),iD.z=this.getZ(t),iD.transformDirection(e),this.setXYZ(t,iD.x,iD.y,iD.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==oR&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}rD.prototype.isBufferAttribute=!0;class sD extends rD{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class oD extends rD{constructor(e,t,i){super(new Uint32Array(e),t,i)}}(class extends rD{constructor(e,t,i){super(new Uint16Array(e),t,i)}}).prototype.isFloat16BufferAttribute=!0;class aD extends rD{constructor(e,t,i){super(new Float32Array(e),t,i)}}let lD=0;const cD=new gL,uD=new VL,hD=new BR,dD=new jR,pD=new jR,fD=new BR;class mD extends uR{constructor(){super(),Object.defineProperty(this,"id",{value:lD++}),this.uuid=fR(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(bR(e)?oD:sD)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const t=(new xR).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return cD.makeRotationFromQuaternion(e),this.applyMatrix4(cD),this}rotateX(e){return cD.makeRotationX(e),this.applyMatrix4(cD),this}rotateY(e){return cD.makeRotationY(e),this.applyMatrix4(cD),this}rotateZ(e){return cD.makeRotationZ(e),this.applyMatrix4(cD),this}translate(e,t,i){return cD.makeTranslation(e,t,i),this.applyMatrix4(cD),this}scale(e,t,i){return cD.makeScale(e,t,i),this.applyMatrix4(cD),this}lookAt(e){return uD.lookAt(e),uD.updateMatrix(),this.applyMatrix4(uD.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(hD).negate(),this.translate(hD.x,hD.y,hD.z),this}setFromPoints(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new aD(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new jR);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new BR(-1/0,-1/0,-1/0),new BR(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];dD.setFromBufferAttribute(i),this.morphTargetsRelative?(fD.addVectors(this.boundingBox.min,dD.min),this.boundingBox.expandByPoint(fD),fD.addVectors(this.boundingBox.max,dD.max),this.boundingBox.expandByPoint(fD)):(this.boundingBox.expandByPoint(dD.min),this.boundingBox.expandByPoint(dD.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new aL);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new BR,1/0);if(e){const i=this.boundingSphere.center;if(dD.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];pD.setFromBufferAttribute(i),this.morphTargetsRelative?(fD.addVectors(dD.min,pD.min),dD.expandByPoint(fD),fD.addVectors(dD.max,pD.max),dD.expandByPoint(fD)):(dD.expandByPoint(pD.min),dD.expandByPoint(pD.max))}dD.getCenter(i);let n=0;for(let t=0,r=e.count;t<r;t++)fD.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(fD));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],o=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)fD.fromBufferAttribute(s,t),o&&(hD.fromBufferAttribute(e,t),fD.add(hD)),n=Math.max(n,i.distanceToSquared(fD))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,n=t.position.array,r=t.normal.array,s=t.uv.array,o=n.length/3;void 0===t.tangent&&this.setAttribute("tangent",new rD(new Float32Array(4*o),4));const a=t.tangent.array,l=[],c=[];for(let e=0;e<o;e++)l[e]=new BR,c[e]=new BR;const u=new BR,h=new BR,d=new BR,p=new vR,f=new vR,m=new vR,g=new BR,_=new BR;function y(e,t,i){u.fromArray(n,3*e),h.fromArray(n,3*t),d.fromArray(n,3*i),p.fromArray(s,2*e),f.fromArray(s,2*t),m.fromArray(s,2*i),h.sub(u),d.sub(u),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),_.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[i].add(g),c[e].add(_),c[t].add(_),c[i].add(_))}let v=this.groups;0===v.length&&(v=[{start:0,count:i.length}]);for(let e=0,t=v.length;e<t;++e){const t=v[e],n=t.start;for(let e=n,r=n+t.count;e<r;e+=3)y(i[e+0],i[e+1],i[e+2])}const x=new BR,b=new BR,w=new BR,S=new BR;function T(e){w.fromArray(r,3*e),S.copy(w);const t=l[e];x.copy(t),x.sub(w.multiplyScalar(w.dot(t))).normalize(),b.crossVectors(S,t);const i=b.dot(c[e])<0?-1:1;a[4*e]=x.x,a[4*e+1]=x.y,a[4*e+2]=x.z,a[4*e+3]=i}for(let e=0,t=v.length;e<t;++e){const t=v[e],n=t.start;for(let e=n,r=n+t.count;e<r;e+=3)T(i[e+0]),T(i[e+1]),T(i[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new rD(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);const n=new BR,r=new BR,s=new BR,o=new BR,a=new BR,l=new BR,c=new BR,u=new BR;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);n.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),c.subVectors(s,r),u.subVectors(n,r),c.cross(u),o.fromBufferAttribute(i,d),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),o.add(c),a.add(c),l.add(c),i.setXYZ(d,o.x,o.y,o.z),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,o=t.count;e<o;e+=3)n.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,r),u.subVectors(n,r),c.cross(u),i.setXYZ(e+0,c.x,c.y,c.z),i.setXYZ(e+1,c.x,c.y,c.z),i.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===e.attributes[n])continue;const r=i[n].array,s=e.attributes[n],o=s.array,a=s.itemSize*t,l=Math.min(o.length,r.length-a);for(let e=0,t=a;e<l;e++,t++)r[t]=o[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)fD.fromBufferAttribute(e,t),fD.normalize(),e.setXYZ(t,fD.x,fD.y,fD.z)}toNonIndexed(){function e(e,t){const i=e.array,n=e.itemSize,r=e.normalized,s=new i.constructor(t.length*n);let o=0,a=0;for(let r=0,l=t.length;r<l;r++){o=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*n;for(let e=0;e<n;e++)s[a++]=i[o++]}return new rD(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new mD,i=this.index.array,n=this.attributes;for(const r in n){const s=e(n[r],i);t.setAttribute(r,s)}const r=this.morphAttributes;for(const n in r){const s=[],o=r[n];for(let t=0,n=o.length;t<n;t++){const n=e(o[t],i);s.push(n)}t.morphAttributes[n]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,i=s.length;e<i;e++){const i=s[e];t.addGroup(i.start,i.count,i.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const t in i){const n=i[t];e.data.attributes[t]=n.toJSON(e.data)}const n={};let r=!1;for(const t in this.morphAttributes){const i=this.morphAttributes[t],s=[];for(let t=0,n=i.length;t<n;t++){const n=i[t];s.push(n.toJSON(e.data))}s.length>0&&(n[t]=s,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const n=e.attributes;for(const e in n){const i=n[e];this.setAttribute(e,i.clone(t))}const r=e.morphAttributes;for(const e in r){const i=[],n=r[e];for(let e=0,r=n.length;e<r;e++)i.push(n[e].clone(t));this.morphAttributes[e]=i}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}mD.prototype.isBufferGeometry=!0;const gD=new gL,_D=new mL,yD=new aL,vD=new BR,xD=new BR,bD=new BR,wD=new BR,SD=new BR,TD=new BR,ED=new BR,MD=new BR,ID=new BR,AD=new vR,CD=new vR,PD=new vR,kD=new BR,RD=new BR;class LD extends VL{constructor(e=new mD,t=new tD){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),yD.copy(i.boundingSphere),yD.applyMatrix4(r),!1===e.ray.intersectsSphere(yD))return;if(gD.copy(r).invert(),_D.copy(e.ray).applyMatrix4(gD),null!==i.boundingBox&&!1===_D.intersectsBox(i.boundingBox))return;let s;if(i.isBufferGeometry){const r=i.index,o=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,u=i.attributes.uv2,h=i.groups,d=i.drawRange;if(null!==r)if(Array.isArray(n))for(let i=0,p=h.length;i<p;i++){const p=h[i],f=n[p.materialIndex];for(let i=Math.max(p.start,d.start),n=Math.min(r.count,Math.min(p.start+p.count,d.start+d.count));i<n;i+=3){const n=r.getX(i),h=r.getX(i+1),d=r.getX(i+2);s=DD(this,f,e,_D,o,a,l,c,u,n,h,d),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=p.materialIndex,t.push(s))}}else for(let i=Math.max(0,d.start),h=Math.min(r.count,d.start+d.count);i<h;i+=3){const h=r.getX(i),d=r.getX(i+1),p=r.getX(i+2);s=DD(this,n,e,_D,o,a,l,c,u,h,d,p),s&&(s.faceIndex=Math.floor(i/3),t.push(s))}else if(void 0!==o)if(Array.isArray(n))for(let i=0,r=h.length;i<r;i++){const r=h[i],p=n[r.materialIndex];for(let i=Math.max(r.start,d.start),n=Math.min(o.count,Math.min(r.start+r.count,d.start+d.count));i<n;i+=3)s=DD(this,p,e,_D,o,a,l,c,u,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,t.push(s))}else for(let i=Math.max(0,d.start),r=Math.min(o.count,d.start+d.count);i<r;i+=3)s=DD(this,n,e,_D,o,a,l,c,u,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),t.push(s))}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function DD(e,t,i,n,r,s,o,a,l,c,u,h){vD.fromBufferAttribute(r,c),xD.fromBufferAttribute(r,u),bD.fromBufferAttribute(r,h);const d=e.morphTargetInfluences;if(s&&d){ED.set(0,0,0),MD.set(0,0,0),ID.set(0,0,0);for(let e=0,t=s.length;e<t;e++){const t=d[e],i=s[e];0!==t&&(wD.fromBufferAttribute(i,c),SD.fromBufferAttribute(i,u),TD.fromBufferAttribute(i,h),o?(ED.addScaledVector(wD,t),MD.addScaledVector(SD,t),ID.addScaledVector(TD,t)):(ED.addScaledVector(wD.sub(vD),t),MD.addScaledVector(SD.sub(xD),t),ID.addScaledVector(TD.sub(bD),t)))}vD.add(ED),xD.add(MD),bD.add(ID)}e.isSkinnedMesh&&(e.boneTransform(c,vD),e.boneTransform(u,xD),e.boneTransform(h,bD));const p=function(e,t,i,n,r,s,o,a){let l;if(l=t.side===KC?n.intersectTriangle(o,s,r,!0,a):n.intersectTriangle(r,s,o,t.side!==JC,a),null===l)return null;RD.copy(a),RD.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(RD);return c<i.near||c>i.far?null:{distance:c,point:RD.clone(),object:e}}(e,t,i,n,vD,xD,bD,kD);if(p){a&&(AD.fromBufferAttribute(a,c),CD.fromBufferAttribute(a,u),PD.fromBufferAttribute(a,h),p.uv=JL.getUV(kD,vD,xD,bD,AD,CD,PD,new vR)),l&&(AD.fromBufferAttribute(l,c),CD.fromBufferAttribute(l,u),PD.fromBufferAttribute(l,h),p.uv2=JL.getUV(kD,vD,xD,bD,AD,CD,PD,new vR));const e={a:c,b:u,c:h,normal:new BR,materialIndex:0};JL.getNormal(vD,xD,bD,e.normal),p.face=e}return p}LD.prototype.isMesh=!0;class OD extends mD{constructor(e=1,t=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const o=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const a=[],l=[],c=[],u=[];let h=0,d=0;function p(e,t,i,n,r,s,p,f,m,g,_){const y=s/m,v=p/g,x=s/2,b=p/2,w=f/2,S=m+1,T=g+1;let E=0,M=0;const I=new BR;for(let s=0;s<T;s++){const o=s*v-b;for(let a=0;a<S;a++){const h=a*y-x;I[e]=h*n,I[t]=o*r,I[i]=w,l.push(I.x,I.y,I.z),I[e]=0,I[t]=0,I[i]=f>0?1:-1,c.push(I.x,I.y,I.z),u.push(a/m),u.push(1-s/g),E+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const i=h+t+S*e,n=h+t+S*(e+1),r=h+(t+1)+S*(e+1),s=h+(t+1)+S*e;a.push(i,n,s),a.push(n,r,s),M+=6}o.addGroup(d,M,_),d+=M,h+=E}p("z","y","x",-1,-1,i,t,e,s,r,0),p("z","y","x",1,-1,i,t,-e,s,r,1),p("x","z","y",1,1,e,i,t,n,s,2),p("x","z","y",1,-1,e,i,-t,n,s,3),p("x","y","z",1,-1,e,t,i,n,r,4),p("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(a),this.setAttribute("position",new aD(l,3)),this.setAttribute("normal",new aD(c,3)),this.setAttribute("uv",new aD(u,2))}static fromJSON(e){return new OD(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function ND(e){const t={};for(const i in e){t[i]={};for(const n in e[i]){const r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}}return t}function zD(e){const t={};for(let i=0;i<e.length;i++){const n=ND(e[i]);for(const e in n)t[e]=n[e]}return t}const FD={clone:ND,merge:zD};class BD extends eD{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ND(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const e in this.extensions)!0===this.extensions[e]&&(i[e]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}BD.prototype.isShaderMaterial=!0;class UD extends VL{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new gL,this.projectionMatrix=new gL,this.projectionMatrixInverse=new gL}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}UD.prototype.isCamera=!0;class VD extends UD{constructor(e=50,t=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*pR*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*dR*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*pR*Math.atan(Math.tan(.5*dR*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*dR*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,o=s.fullHeight;r+=s.offsetX*n/e,t-=s.offsetY*i/o,n*=s.width/e,i*=s.height/o}const o=this.filmOffset;0!==o&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}VD.prototype.isPerspectiveCamera=!0;const jD=90;class GD extends VL{constructor(e,t,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new VD(jD,1,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new BR(1,0,0)),this.add(n);const r=new VD(jD,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new BR(-1,0,0)),this.add(r);const s=new VD(jD,1,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new BR(0,1,0)),this.add(s);const o=new VD(jD,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new BR(0,-1,0)),this.add(o);const a=new VD(jD,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new BR(0,0,1)),this.add(a);const l=new VD(jD,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new BR(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,s,o,a,l]=this.children,c=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;const h=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,n),e.setRenderTarget(i,1),e.render(t,r),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,o),e.setRenderTarget(i,4),e.render(t,a),i.texture.generateMipmaps=h,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(u),e.xr.enabled=c,i.texture.needsPMREMUpdate=!0}}class HD extends LR{constructor(e,t,i,n,r,s,o,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:FP,i,n,r,s,o,a,l,c),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}HD.prototype.isCubeTexture=!0;class WD extends NR{constructor(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),super(e,e,t),t=t||{},this.texture=new HD(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:YP}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=dk,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={tEquirect:{value:null}},n="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new OD(5,5,5),o=new BD({name:"CubemapFromEquirect",uniforms:ND(i),vertexShader:n,fragmentShader:r,side:KC,blending:QC});o.uniforms.tEquirect.value=t;const a=new LD(s,o),l=t.minFilter;return t.minFilter===JP&&(t.minFilter=YP),new GD(1,10,this).update(e,a),t.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,i,n){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,i,n);e.setRenderTarget(r)}}WD.prototype.isWebGLCubeRenderTarget=!0;const qD=new BR,$D=new BR,ZD=new xR;class XD{constructor(e=new BR(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=qD.subVectors(i,t).cross($D.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(qD),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(i).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||ZD.getNormalMatrix(e),n=this.coplanarPoint(qD).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}XD.prototype.isPlane=!0;const YD=new aL,KD=new BR;class JD{constructor(e=new XD,t=new XD,i=new XD,n=new XD,r=new XD,s=new XD){this.planes=[e,t,i,n,r,s]}set(e,t,i,n,r,s){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(n),o[4].copy(r),o[5].copy(s),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,n=i[0],r=i[1],s=i[2],o=i[3],a=i[4],l=i[5],c=i[6],u=i[7],h=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],_=i[14],y=i[15];return t[0].setComponents(o-n,u-a,f-h,y-m).normalize(),t[1].setComponents(o+n,u+a,f+h,y+m).normalize(),t[2].setComponents(o+r,u+l,f+d,y+g).normalize(),t[3].setComponents(o-r,u-l,f-d,y-g).normalize(),t[4].setComponents(o-s,u-c,f-p,y-_).normalize(),t[5].setComponents(o+s,u+c,f+p,y+_).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),YD.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(YD)}intersectsSprite(e){return YD.center.set(0,0,0),YD.radius=.7071067811865476,YD.applyMatrix4(e.matrixWorld),this.intersectsSphere(YD)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(KD.x=n.normal.x>0?e.max.x:e.min.x,KD.y=n.normal.y>0?e.max.y:e.min.y,KD.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(KD)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function QD(){let e=null,t=!1,i=null,n=null;function r(t,s){i(t,s),n=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function eO(e,t){const i=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const i=n.get(t);i&&(e.deleteBuffer(i.buffer),n.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=n.get(t);return void((!e||e.version<t.version)&&n.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=n.get(t);void 0===s?n.set(t,function(t,n){const r=t.array,s=t.usage,o=e.createBuffer();e.bindBuffer(n,o),e.bufferData(n,r,s),t.onUploadCallback();let a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?t.isFloat16BufferAttribute?i?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(a=5121),{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):s.version<t.version&&(function(t,n,r){const s=n.array,o=n.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,s):(i?e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,t,r),s.version=t.version)}}}class tO extends mD{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const r=e/2,s=t/2,o=Math.floor(i),a=Math.floor(n),l=o+1,c=a+1,u=e/o,h=t/a,d=[],p=[],f=[],m=[];for(let e=0;e<c;e++){const t=e*h-s;for(let i=0;i<l;i++){const n=i*u-r;p.push(n,-t,0),f.push(0,0,1),m.push(i/o),m.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<o;t++){const i=t+l*e,n=t+l*(e+1),r=t+1+l*(e+1),s=t+1+l*e;d.push(i,n,s),d.push(n,r,s)}this.setIndex(d),this.setAttribute("position",new aD(p,3)),this.setAttribute("normal",new aD(f,3)),this.setAttribute("uv",new aD(m,2))}static fromJSON(e){return new tO(e.width,e.height,e.widthSegments,e.heightSegments)}}const iO={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\treturn texture2D( envMap, uv ).rgb;\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},nO={common:{diffuse:{value:new CR(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new xR},uv2Transform:{value:new xR},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new vR(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new CR(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new CR(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new xR}},sprite:{diffuse:{value:new CR(16777215)},opacity:{value:1},center:{value:new vR(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new xR}}},rO={basic:{uniforms:zD([nO.common,nO.specularmap,nO.envmap,nO.aomap,nO.lightmap,nO.fog]),vertexShader:iO.meshbasic_vert,fragmentShader:iO.meshbasic_frag},lambert:{uniforms:zD([nO.common,nO.specularmap,nO.envmap,nO.aomap,nO.lightmap,nO.emissivemap,nO.fog,nO.lights,{emissive:{value:new CR(0)}}]),vertexShader:iO.meshlambert_vert,fragmentShader:iO.meshlambert_frag},phong:{uniforms:zD([nO.common,nO.specularmap,nO.envmap,nO.aomap,nO.lightmap,nO.emissivemap,nO.bumpmap,nO.normalmap,nO.displacementmap,nO.fog,nO.lights,{emissive:{value:new CR(0)},specular:{value:new CR(1118481)},shininess:{value:30}}]),vertexShader:iO.meshphong_vert,fragmentShader:iO.meshphong_frag},standard:{uniforms:zD([nO.common,nO.envmap,nO.aomap,nO.lightmap,nO.emissivemap,nO.bumpmap,nO.normalmap,nO.displacementmap,nO.roughnessmap,nO.metalnessmap,nO.fog,nO.lights,{emissive:{value:new CR(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:iO.meshphysical_vert,fragmentShader:iO.meshphysical_frag},toon:{uniforms:zD([nO.common,nO.aomap,nO.lightmap,nO.emissivemap,nO.bumpmap,nO.normalmap,nO.displacementmap,nO.gradientmap,nO.fog,nO.lights,{emissive:{value:new CR(0)}}]),vertexShader:iO.meshtoon_vert,fragmentShader:iO.meshtoon_frag},matcap:{uniforms:zD([nO.common,nO.bumpmap,nO.normalmap,nO.displacementmap,nO.fog,{matcap:{value:null}}]),vertexShader:iO.meshmatcap_vert,fragmentShader:iO.meshmatcap_frag},points:{uniforms:zD([nO.points,nO.fog]),vertexShader:iO.points_vert,fragmentShader:iO.points_frag},dashed:{uniforms:zD([nO.common,nO.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:iO.linedashed_vert,fragmentShader:iO.linedashed_frag},depth:{uniforms:zD([nO.common,nO.displacementmap]),vertexShader:iO.depth_vert,fragmentShader:iO.depth_frag},normal:{uniforms:zD([nO.common,nO.bumpmap,nO.normalmap,nO.displacementmap,{opacity:{value:1}}]),vertexShader:iO.meshnormal_vert,fragmentShader:iO.meshnormal_frag},sprite:{uniforms:zD([nO.sprite,nO.fog]),vertexShader:iO.sprite_vert,fragmentShader:iO.sprite_frag},background:{uniforms:{uvTransform:{value:new xR},t2D:{value:null}},vertexShader:iO.background_vert,fragmentShader:iO.background_frag},cube:{uniforms:zD([nO.envmap,{opacity:{value:1}}]),vertexShader:iO.cube_vert,fragmentShader:iO.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:iO.equirect_vert,fragmentShader:iO.equirect_frag},distanceRGBA:{uniforms:zD([nO.common,nO.displacementmap,{referencePosition:{value:new BR},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:iO.distanceRGBA_vert,fragmentShader:iO.distanceRGBA_frag},shadow:{uniforms:zD([nO.lights,nO.fog,{color:{value:new CR(0)},opacity:{value:1}}]),vertexShader:iO.shadow_vert,fragmentShader:iO.shadow_frag}};function sO(e,t,i,n,r,s){const o=new CR(0);let a,l,c=!0===r?0:1,u=null,h=0,d=null;function p(e,t){i.buffers.color.setClear(e.r,e.g,e.b,t,s)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),c=t,p(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(e){c=e,p(o,c)},render:function(i,r){let s=!1,f=!0===r.isScene?r.background:null;f&&f.isTexture&&(f=t.get(f));const m=e.xr,g=m.getSession&&m.getSession();g&&"additive"===g.environmentBlendMode&&(f=null),null===f?p(o,c):f&&f.isColor&&(p(f,1),s=!0),(e.autoClear||s)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),f&&(f.isCubeTexture||f.mapping===jP)?(void 0===l&&(l=new LD(new OD(1,1,1),new BD({name:"BackgroundCubeMaterial",uniforms:ND(rO.cube.uniforms),vertexShader:rO.cube.vertexShader,fragmentShader:rO.cube.fragmentShader,side:KC,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=f,l.material.uniforms.flipEnvMap.value=f.isCubeTexture&&!1===f.isRenderTargetTexture?-1:1,u===f&&h===f.version&&d===e.toneMapping||(l.material.needsUpdate=!0,u=f,h=f.version,d=e.toneMapping),i.unshift(l,l.geometry,l.material,0,0,null)):f&&f.isTexture&&(void 0===a&&(a=new LD(new tO(2,2),new BD({name:"BackgroundMaterial",uniforms:ND(rO.background.uniforms),vertexShader:rO.background.vertexShader,fragmentShader:rO.background.fragmentShader,side:YC,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(a)),a.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),a.material.uniforms.uvTransform.value.copy(f.matrix),u===f&&h===f.version&&d===e.toneMapping||(a.material.needsUpdate=!0,u=f,h=f.version,d=e.toneMapping),i.unshift(a,a.geometry,a.material,0,0,null))}}}function oO(e,t,i,n){const r=e.getParameter(34921),s=n.isWebGL2?null:t.get("OES_vertex_array_object"),o=n.isWebGL2||null!==s,a={},l=d(null);let c=l;function u(t){return n.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function h(t){return n.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function d(e){const t=[],i=[],n=[];for(let e=0;e<r;e++)t[e]=0,i[e]=0,n[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:n,object:e,attributes:{},index:null}}function p(){const e=c.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function f(e){m(e,0)}function m(i,r){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;s[i]=1,0===o[i]&&(e.enableVertexAttribArray(i),o[i]=1),a[i]!==r&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),a[i]=r)}function g(){const t=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==t[n]&&(e.disableVertexAttribArray(n),i[n]=0)}function _(t,i,r,s,o,a){!0!==n.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,i,r,s,o,a):e.vertexAttribIPointer(t,i,r,o,a)}function y(){v(),c!==l&&(c=l,u(c.object))}function v(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,h,y,v){let x=!1;if(o){const t=function(t,i,r){const o=!0===r.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let u=c[o];return void 0===u&&(u=d(n.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),c[o]=u),u}(y,h,l);c!==t&&(c=t,u(c.object)),x=function(e,t){const i=c.attributes,n=e.attributes;let r=0;for(const e in n){const t=i[e],s=n[e];if(void 0===t)return!0;if(t.attribute!==s)return!0;if(t.data!==s.data)return!0;r++}return c.attributesNum!==r||c.index!==t}(y,v),x&&function(e,t){const i={},n=e.attributes;let r=0;for(const e in n){const t=n[e],s={};s.attribute=t,t.data&&(s.data=t.data),i[e]=s,r++}c.attributes=i,c.attributesNum=r,c.index=t}(y,v)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===e||(c.geometry=y.id,c.program=h.id,c.wireframe=e,x=!0)}!0===r.isInstancedMesh&&(x=!0),null!==v&&i.update(v,34963),x&&(function(r,s,o,a){if(!1===n.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,c=o.getAttributes(),u=s.defaultAttributeValues;for(const t in c){const n=c[t];if(n.location>=0){let s=l[t];if(void 0===s&&("instanceMatrix"===t&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const t=s.normalized,o=s.itemSize,l=i.get(s);if(void 0===l)continue;const c=l.buffer,u=l.type,h=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,l=i.stride,d=s.offset;if(i&&i.isInstancedInterleavedBuffer){for(let e=0;e<n.locationSize;e++)m(n.location+e,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<n.locationSize;e++)f(n.location+e);e.bindBuffer(34962,c);for(let e=0;e<n.locationSize;e++)_(n.location+e,o/n.locationSize,u,t,l*h,(d+o/n.locationSize*e)*h)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<n.locationSize;e++)m(n.location+e,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<n.locationSize;e++)f(n.location+e);e.bindBuffer(34962,c);for(let e=0;e<n.locationSize;e++)_(n.location+e,o/n.locationSize,u,t,o*h,o/n.locationSize*e*h)}}else if(void 0!==u){const i=u[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(n.location,i);break;case 3:e.vertexAttrib3fv(n.location,i);break;case 4:e.vertexAttrib4fv(n.location,i);break;default:e.vertexAttrib1fv(n.location,i)}}}}g()}(r,l,h,y),null!==v&&e.bindBuffer(34963,i.get(v).buffer))},reset:y,resetDefaultState:v,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const i=t[e];for(const e in i)h(i[e].object),delete i[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const i=t[e];for(const e in i)h(i[e].object),delete i[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const i=a[t];if(void 0===i[e.id])continue;const n=i[e.id];for(const e in n)h(n[e].object),delete n[e];delete i[e.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function aO(e,t,i,n){const r=n.isWebGL2;let s;this.setMode=function(e){s=e},this.render=function(t,n){e.drawArrays(s,t,n),i.update(n,s,1)},this.renderInstances=function(n,o,a){if(0===a)return;let l,c;if(r)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,n,o,a),i.update(o,s,a)}}function lO(e,t,i){let n;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let o=void 0!==i.precision?i.precision:"highp";const a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=s||t.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,u=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),_=e.getParameter(36349),y=h>0,v=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){const i=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:y,floatFragmentTextures:v,floatVertexTextures:y&&v,maxSamples:s?e.getParameter(36183):0}}function cO(e){const t=this;let i=null,n=0,r=!1,s=!1;const o=new XD,a=new xR,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function u(e,i,n,r){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const t=n+4*s,r=i.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,i=n;t!==s;++t,i+=4)o.copy(e[t]).applyMatrix4(r,a),o.normal.toArray(c,i),c[i+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,s){const o=0!==e.length||t||0!==n||r;return r=t,i=u(e,s,0),n=e.length,o},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1,c()},this.setState=function(t,o,a){const h=t.clippingPlanes,d=t.clipIntersection,p=t.clipShadows,f=e.get(t);if(!r||null===h||0===h.length||s&&!p)s?u(null):c();else{const e=s?0:n,t=4*e;let r=f.clippingState||null;l.value=r,r=u(h,o,t,a);for(let e=0;e!==t;++e)r[e]=i[e];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function uO(e){let t=new WeakMap;function i(e,t){return t===UP?e.mapping=FP:t===VP&&(e.mapping=BP),e}function n(e){const i=e.target;i.removeEventListener("dispose",n);const r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(s===UP||s===VP){if(t.has(r))return i(t.get(r).texture,r.mapping);{const s=r.image;if(s&&s.height>0){const o=new WD(s.height/2);return o.fromEquirectangularTexture(e,r),t.set(r,o),r.addEventListener("dispose",n),i(o.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}rO.physical={uniforms:zD([rO.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new vR(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new CR(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new vR},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new CR(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new CR(1,1,1)},specularColorMap:{value:null}}]),vertexShader:iO.meshphysical_vert,fragmentShader:iO.meshphysical_frag};class hO extends UD{constructor(e=-1,t=1,i=1,n=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-e,s=i+e,o=n+t,a=n-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,o-=t*this.view.offsetY,a=o-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}hO.prototype.isOrthographicCamera=!0;class dO extends BD{constructor(e){super(e),this.type="RawShaderMaterial"}}dO.prototype.isRawShaderMaterial=!0;const pO=Math.pow(2,8),fO=[.125,.215,.35,.446,.526,.582],mO=5+fO.length,gO=new hO,{_lodPlanes:_O,_sizeLods:yO,_sigmas:vO}=MO(),xO=new CR;let bO=null;const wO=(1+Math.sqrt(5))/2,SO=1/wO,TO=[new BR(1,1,1),new BR(-1,1,1),new BR(1,1,-1),new BR(-1,1,-1),new BR(0,wO,SO),new BR(0,wO,-SO),new BR(SO,0,wO),new BR(-SO,0,wO),new BR(wO,SO,0),new BR(-wO,SO,0)];class EO{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(20),i=new BR(0,1,0);return new dO({name:"SphericalGaussianBlur",defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:QC,depthTest:!1,depthWrite:!1})}(),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){bO=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=PO(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=CO(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<_O.length;e++)_O[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(bO),e.scissorTest=!1,AO(e,0,0,e.width,e.height)}_fromTexture(e,t){bO=this._renderer.getRenderTarget();const i=t||this._allocateTargets(e);return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(e){const t={magFilter:YP,minFilter:YP,generateMipmaps:!1,type:ok,format:dk,encoding:eR,depthBuffer:!1},i=IO(t);return i.depthBuffer=!e,null===this._pingPongRenderTarget&&(this._pingPongRenderTarget=IO(t)),i}_compileMaterial(e){const t=new LD(_O[0],e);this._renderer.compile(t,gO)}_sceneToCubeUV(e,t,i,n){const r=new VD(90,1,t,i),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(xO),a.toneMapping=RP,a.autoClear=!1;const u=new tD({name:"PMREM.Background",side:KC,depthWrite:!1,depthTest:!1}),h=new LD(new OD,u);let d=!1;const p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,d=!0):(u.color.copy(xO),d=!0);for(let t=0;t<6;t++){const i=t%3;0===i?(r.up.set(0,s[t],0),r.lookAt(o[t],0,0)):1===i?(r.up.set(0,0,s[t]),r.lookAt(0,o[t],0)):(r.up.set(0,s[t],0),r.lookAt(0,0,o[t])),AO(n,i*pO,t>2?pO:0,pO,pO),a.setRenderTarget(n),d&&a.render(h,r),a.render(e,r)}h.geometry.dispose(),h.material.dispose(),a.toneMapping=c,a.autoClear=l,e.background=p}_textureToCubeUV(e,t){const i=this._renderer,n=e.mapping===FP||e.mapping===BP;n?(null===this._cubemapShader&&(this._cubemapShader=PO()),this._cubemapShader.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectShader&&(this._equirectShader=CO());const r=n?this._cubemapShader:this._equirectShader,s=new LD(_O[0],r),o=r.uniforms;o.envMap.value=e,n||o.texelSize.value.set(1/e.image.width,1/e.image.height),AO(t,0,0,3*pO,2*pO),i.setRenderTarget(t),i.render(s,gO)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let t=1;t<mO;t++){const i=Math.sqrt(vO[t]*vO[t]-vO[t-1]*vO[t-1]),n=TO[(t-1)%TO.length];this._blur(e,t-1,t,i,n)}t.autoClear=i}_blur(e,t,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,n,"latitudinal",r),this._halfBlur(s,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new LD(_O[n],l),u=l.uniforms,h=yO[i]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/p,i=Math.exp(-t*t/2);m.push(i),0===e?g+=i:e<f&&(g+=2*i)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o),u.dTheta.value=d,u.mipInt.value=8-i;const _=yO[n];AO(t,3*Math.max(0,pO-2*_),(0===n?0:2*pO)+2*_*(n>4?n-8+4:0),3*_,2*_),a.setRenderTarget(t),a.render(c,gO)}}function MO(){const e=[],t=[],i=[];let n=8;for(let r=0;r<mO;r++){const s=Math.pow(2,n);t.push(s);let o=1/s;r>4?o=fO[r-8+4-1]:0===r&&(o=0),i.push(o);const a=1/(s-1),l=-a/2,c=1+a/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*h),_=new Float32Array(f*d*h),y=new Float32Array(m*d*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,i=e>2?0:-1,n=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];g.set(n,p*d*e),_.set(u,f*d*e);const r=[e,e,e,e,e,e];y.set(r,m*d*e)}const v=new mD;v.setAttribute("position",new rD(g,p)),v.setAttribute("uv",new rD(_,f)),v.setAttribute("faceIndex",new rD(y,m)),e.push(v),n>4&&n--}return{_lodPlanes:e,_sizeLods:t,_sigmas:i}}function IO(e){const t=new NR(3*pO,3*pO,e);return t.texture.mapping=jP,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function AO(e,t,i,n,r){e.viewport.set(t,i,n,r),e.scissor.set(t,i,n,r)}function CO(){const e=new vR(1,1);return new dO({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = texture2D ( envMap, uv ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t}\n\t\t",blending:QC,depthTest:!1,depthWrite:!1})}function PO(){return new dO({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:QC,depthTest:!1,depthWrite:!1})}function kO(e){let t=new WeakMap,i=null;function n(e){const i=e.target;i.removeEventListener("dispose",n);const r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,o=s===UP||s===VP,a=s===FP||s===BP;if(o||a){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let n=t.get(r);return null===i&&(i=new EO(e)),n=o?i.fromEquirectangular(r,n):i.fromCubemap(r,n),t.set(r,n),n.texture}if(t.has(r))return t.get(r).texture;{const s=r.image;if(o&&s&&s.height>0||a&&s&&function(e){let t=0;for(let i=0;i<6;i++)void 0!==e[i]&&t++;return 6===t}(s)){null===i&&(i=new EO(e));const s=o?i.fromEquirectangular(r):i.fromCubemap(r);return t.set(r,s),r.addEventListener("dispose",n),s.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function RO(e){const t={};function i(i){if(void 0!==t[i])return t[i];let n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(e){const t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function LO(e,t,i,n){const r={},s=new WeakMap;function o(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);a.removeEventListener("dispose",o),delete r[a.id];const l=s.get(a);l&&(t.remove(l),s.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(e){const i=[],n=e.index,r=e.attributes.position;let o=0;if(null!==n){const e=n.array;o=n.version;for(let t=0,n=e.length;t<n;t+=3){const n=e[t+0],r=e[t+1],s=e[t+2];i.push(n,r,r,s,s,n)}}else{const e=r.array;o=r.version;for(let t=0,n=e.length/3-1;t<n;t+=3){const e=t+0,n=t+1,r=t+2;i.push(e,n,n,r,r,e)}}const a=new(bR(i)?oD:sD)(i,1);a.version=o;const l=s.get(e);l&&t.remove(l),s.set(e,a)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,i.memory.geometries++),t},update:function(e){const i=e.attributes;for(const e in i)t.update(i[e],34962);const n=e.morphAttributes;for(const e in n){const i=n[e];for(let e=0,n=i.length;e<n;e++)t.update(i[e],34962)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const i=e.index;null!==i&&t.version<i.version&&a(e)}else a(e);return s.get(e)}}}function DO(e,t,i,n){const r=n.isWebGL2;let s,o,a;this.setMode=function(e){s=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,n){e.drawElements(s,n,o,t*a),i.update(n,s,1)},this.renderInstances=function(n,l,c){if(0===c)return;let u,h;if(r)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](s,l,o,n*a,c),i.update(l,s,c)}}function OO(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,n){switch(t.calls++,i){case 4:t.triangles+=n*(e/3);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}class NO extends LR{constructor(e=null,t=1,i=1,n=1){super(null),this.image={data:e,width:t,height:i,depth:n},this.magFilter=$P,this.minFilter=$P,this.wrapR=WP,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}function zO(e,t){return e[0]-t[0]}function FO(e,t){return Math.abs(t[1])-Math.abs(e[1])}function BO(e,t){let i=1;const n=t.isInterleavedBufferAttribute?t.data.array:t.array;n instanceof Int8Array?i=127:n instanceof Int16Array?i=32767:n instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),e.divideScalar(i)}function UO(e,t,i){const n={},r=new Float32Array(8),s=new WeakMap,o=new BR,a=[];for(let e=0;e<8;e++)a[e]=[e,0];return{update:function(l,c,u,h){const d=l.morphTargetInfluences;if(!0===t.isWebGL2){const p=c.morphAttributes.position.length;let f=s.get(c);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();const _=void 0!==c.morphAttributes.normal,y=c.morphAttributes.position,v=c.morphAttributes.normal||[],x=!0===_?2:1;let b=c.attributes.position.count*x,w=1;b>t.maxTextureSize&&(w=Math.ceil(b/t.maxTextureSize),b=t.maxTextureSize);const S=new Float32Array(b*w*4*p),T=new NO(S,b,w,p);T.format=dk,T.type=sk,T.needsUpdate=!0;const E=4*x;for(let I=0;I<p;I++){const A=y[I],C=v[I],P=b*w*4*I;for(let k=0;k<A.count;k++){o.fromBufferAttribute(A,k),!0===A.normalized&&BO(o,A);const R=k*E;S[P+R+0]=o.x,S[P+R+1]=o.y,S[P+R+2]=o.z,S[P+R+3]=0,!0===_&&(o.fromBufferAttribute(C,k),!0===C.normalized&&BO(o,C),S[P+R+4]=o.x,S[P+R+5]=o.y,S[P+R+6]=o.z,S[P+R+7]=0)}}function M(){T.dispose(),s.delete(c),c.removeEventListener("dispose",M)}f={count:p,texture:T,size:new vR(b,w)},s.set(c,f),c.addEventListener("dispose",M)}let m=0;for(let L=0;L<d.length;L++)m+=d[L];const g=c.morphTargetsRelative?1:1-m;h.getUniforms().setValue(e,"morphTargetBaseInfluence",g),h.getUniforms().setValue(e,"morphTargetInfluences",d),h.getUniforms().setValue(e,"morphTargetsTexture",f.texture,i),h.getUniforms().setValue(e,"morphTargetsTextureSize",f.size)}else{const D=void 0===d?0:d.length;let O=n[c.id];if(void 0===O||O.length!==D){O=[];for(let U=0;U<D;U++)O[U]=[U,0];n[c.id]=O}for(let V=0;V<D;V++){const j=O[V];j[0]=V,j[1]=d[V]}O.sort(FO);for(let G=0;G<8;G++)G<D&&O[G][1]?(a[G][0]=O[G][0],a[G][1]=O[G][1]):(a[G][0]=Number.MAX_SAFE_INTEGER,a[G][1]=0);a.sort(zO);const N=c.morphAttributes.position,z=c.morphAttributes.normal;let F=0;for(let H=0;H<8;H++){const W=a[H],q=W[0],$=W[1];q!==Number.MAX_SAFE_INTEGER&&$?(N&&c.getAttribute("morphTarget"+H)!==N[q]&&c.setAttribute("morphTarget"+H,N[q]),z&&c.getAttribute("morphNormal"+H)!==z[q]&&c.setAttribute("morphNormal"+H,z[q]),r[H]=$,F+=$):(N&&!0===c.hasAttribute("morphTarget"+H)&&c.deleteAttribute("morphTarget"+H),z&&!0===c.hasAttribute("morphNormal"+H)&&c.deleteAttribute("morphNormal"+H),r[H]=0)}const B=c.morphTargetsRelative?1:1-F;h.getUniforms().setValue(e,"morphTargetBaseInfluence",B),h.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function VO(e,t,i,n){let r=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){const o=n.render.frame,a=e.geometry,l=t.get(e,a);return r.get(l)!==o&&(t.update(l),r.set(l,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",s)&&e.addEventListener("dispose",s),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}NO.prototype.isDataTexture2DArray=!0;class jO extends LR{constructor(e=null,t=1,i=1,n=1){super(null),this.image={data:e,width:t,height:i,depth:n},this.magFilter=$P,this.minFilter=$P,this.wrapR=WP,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}jO.prototype.isDataTexture3D=!0;const GO=new LR,HO=new NO,WO=new jO,qO=new HD,$O=[],ZO=[],XO=new Float32Array(16),YO=new Float32Array(9),KO=new Float32Array(4);function JO(e,t,i){const n=e[0];if(n<=0||n>0)return e;const r=t*i;let s=$O[r];if(void 0===s&&(s=new Float32Array(r),$O[r]=s),0!==t){n.toArray(s,0);for(let n=1,r=0;n!==t;++n)r+=i,e[n].toArray(s,r)}return s}function QO(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function eN(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function tN(e,t){let i=ZO[t];void 0===i&&(i=new Int32Array(t),ZO[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function iN(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function nN(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(QO(i,t))return;e.uniform2fv(this.addr,t),eN(i,t)}}function rN(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(QO(i,t))return;e.uniform3fv(this.addr,t),eN(i,t)}}function sN(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(QO(i,t))return;e.uniform4fv(this.addr,t),eN(i,t)}}function oN(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(QO(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),eN(i,t)}else{if(QO(i,n))return;KO.set(n),e.uniformMatrix2fv(this.addr,!1,KO),eN(i,n)}}function aN(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(QO(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),eN(i,t)}else{if(QO(i,n))return;YO.set(n),e.uniformMatrix3fv(this.addr,!1,YO),eN(i,n)}}function lN(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(QO(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),eN(i,t)}else{if(QO(i,n))return;XO.set(n),e.uniformMatrix4fv(this.addr,!1,XO),eN(i,n)}}function cN(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function uN(e,t){const i=this.cache;QO(i,t)||(e.uniform2iv(this.addr,t),eN(i,t))}function hN(e,t){const i=this.cache;QO(i,t)||(e.uniform3iv(this.addr,t),eN(i,t))}function dN(e,t){const i=this.cache;QO(i,t)||(e.uniform4iv(this.addr,t),eN(i,t))}function pN(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function fN(e,t){const i=this.cache;QO(i,t)||(e.uniform2uiv(this.addr,t),eN(i,t))}function mN(e,t){const i=this.cache;QO(i,t)||(e.uniform3uiv(this.addr,t),eN(i,t))}function gN(e,t){const i=this.cache;QO(i,t)||(e.uniform4uiv(this.addr,t),eN(i,t))}function _N(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.safeSetTexture2D(t||GO,r)}function yN(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||WO,r)}function vN(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.safeSetTextureCube(t||qO,r)}function xN(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||HO,r)}function bN(e,t){e.uniform1fv(this.addr,t)}function wN(e,t){const i=JO(t,this.size,2);e.uniform2fv(this.addr,i)}function SN(e,t){const i=JO(t,this.size,3);e.uniform3fv(this.addr,i)}function TN(e,t){const i=JO(t,this.size,4);e.uniform4fv(this.addr,i)}function EN(e,t){const i=JO(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function MN(e,t){const i=JO(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function IN(e,t){const i=JO(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function AN(e,t){e.uniform1iv(this.addr,t)}function CN(e,t){e.uniform2iv(this.addr,t)}function PN(e,t){e.uniform3iv(this.addr,t)}function kN(e,t){e.uniform4iv(this.addr,t)}function RN(e,t){e.uniform1uiv(this.addr,t)}function LN(e,t){e.uniform2uiv(this.addr,t)}function DN(e,t){e.uniform3uiv(this.addr,t)}function ON(e,t){e.uniform4uiv(this.addr,t)}function NN(e,t,i){const n=t.length,r=tN(i,n);e.uniform1iv(this.addr,r);for(let e=0;e!==n;++e)i.safeSetTexture2D(t[e]||GO,r[e])}function zN(e,t,i){const n=t.length,r=tN(i,n);e.uniform1iv(this.addr,r);for(let e=0;e!==n;++e)i.setTexture3D(t[e]||WO,r[e])}function FN(e,t,i){const n=t.length,r=tN(i,n);e.uniform1iv(this.addr,r);for(let e=0;e!==n;++e)i.safeSetTextureCube(t[e]||qO,r[e])}function BN(e,t,i){const n=t.length,r=tN(i,n);e.uniform1iv(this.addr,r);for(let e=0;e!==n;++e)i.setTexture2DArray(t[e]||HO,r[e])}function UN(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return iN;case 35664:return nN;case 35665:return rN;case 35666:return sN;case 35674:return oN;case 35675:return aN;case 35676:return lN;case 5124:case 35670:return cN;case 35667:case 35671:return uN;case 35668:case 35672:return hN;case 35669:case 35673:return dN;case 5125:return pN;case 36294:return fN;case 36295:return mN;case 36296:return gN;case 35678:case 36198:case 36298:case 36306:case 35682:return _N;case 35679:case 36299:case 36307:return yN;case 35680:case 36300:case 36308:case 36293:return vN;case 36289:case 36303:case 36311:case 36292:return xN}}(t.type)}function VN(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return bN;case 35664:return wN;case 35665:return SN;case 35666:return TN;case 35674:return EN;case 35675:return MN;case 35676:return IN;case 5124:case 35670:return AN;case 35667:case 35671:return CN;case 35668:case 35672:return PN;case 35669:case 35673:return kN;case 5125:return RN;case 36294:return LN;case 36295:return DN;case 36296:return ON;case 35678:case 36198:case 36298:case 36306:case 35682:return NN;case 35679:case 36299:case 36307:return zN;case 35680:case 36300:case 36308:case 36293:return FN;case 36289:case 36303:case 36311:case 36292:return BN}}(t.type)}function jN(e){this.id=e,this.seq=[],this.map={}}VN.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),eN(t,e)},jN.prototype.setValue=function(e,t,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(e,t[s.id],i)}};const GN=/(\w+)(\])?(\[|\.)?/g;function HN(e,t){e.seq.push(t),e.map[t.id]=t}function WN(e,t,i){const n=e.name,r=n.length;for(GN.lastIndex=0;;){const s=GN.exec(n),o=GN.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===r){HN(i,void 0===c?new UN(a,e,t):new VN(a,e,t));break}{let e=i.map[a];void 0===e&&(e=new jN(a),HN(i,e)),i=e}}}function qN(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let n=0;n<i;++n){const i=e.getActiveUniform(t,n);WN(i,e.getUniformLocation(t,i.name),this)}}function $N(e,t,i){const n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}qN.prototype.setValue=function(e,t,i,n){const r=this.map[t];void 0!==r&&r.setValue(e,i,n)},qN.prototype.setOptional=function(e,t,i){const n=t[i];void 0!==n&&this.setValue(e,i,n)},qN.upload=function(e,t,i,n){for(let r=0,s=t.length;r!==s;++r){const s=t[r],o=i[s.id];!1!==o.needsUpdate&&s.setValue(e,o.value,n)}},qN.seqWithValue=function(e,t){const i=[];for(let n=0,r=e.length;n!==r;++n){const r=e[n];r.id in t&&i.push(r)}return i};let ZN=0;function XN(e,t,i){const n=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return n&&""===r?"":i.toUpperCase()+"\n\n"+r+"\n\n"+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function YN(e,t){const i=function(e){switch(e){case eR:return["Linear","( value )"];case tR:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function KN(e,t){let i;switch(t){case LP:i="Linear";break;case DP:i="Reinhard";break;case OP:i="OptimizedCineon";break;case NP:i="ACESFilmic";break;case zP:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function JN(e){return""!==e}function QN(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ez(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const tz=/^[ \t]*#include +<([\w\d./]+)>/gm;function iz(e){return e.replace(tz,nz)}function nz(e,t){const i=iO[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return iz(i)}const rz=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,sz=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function oz(e){return e.replace(sz,lz).replace(rz,az)}function az(e,t,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),lz(0,t,i,n)}function lz(e,t,i,n){let r="";for(let e=parseInt(t);e<parseInt(i);e++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function cz(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function uz(e,t,i,n){const r=e.getContext(),s=i.defines;let o=i.vertexShader,a=i.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===$C?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===ZC?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===XC&&(t="SHADOWMAP_TYPE_VSM"),t}(i),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case FP:case BP:t="ENVMAP_TYPE_CUBE";break;case jP:case GP:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),u=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case BP:case GP:t="ENVMAP_MODE_REFRACTION"}return t}(i),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case CP:t="ENVMAP_BLENDING_MULTIPLY";break;case PP:t="ENVMAP_BLENDING_MIX";break;case kP:t="ENVMAP_BLENDING_ADD"}return t}(i),d=i.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(JN).join("\n")}(i),p=function(e){const t=[];for(const i in e){const n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(s),f=r.createProgram();let m,g,_=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(m=[p].filter(JN).join("\n"),m.length>0&&(m+="\n"),g=[d,p].filter(JN).join("\n"),g.length>0&&(g+="\n")):(m=[cz(i),"#define SHADER_NAME "+i.shaderName,p,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(JN).join("\n"),g=[d,cz(i),"#define SHADER_NAME "+i.shaderName,p,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==RP?"#define TONE_MAPPING":"",i.toneMapping!==RP?iO.tonemapping_pars_fragment:"",i.toneMapping!==RP?KN("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.transparent?"":"#define OPAQUE",iO.encodings_pars_fragment,YN("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(JN).join("\n")),o=iz(o),o=QN(o,i),o=ez(o,i),a=iz(a),a=QN(a,i),a=ez(a,i),o=oz(o),a=oz(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(_="#version 300 es\n",m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,g=["#define varying in",i.glslVersion===lR?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===lR?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g);const y=_+g+a,v=$N(r,35633,_+m+o),x=$N(r,35632,y);if(r.attachShader(f,v),r.attachShader(f,x),void 0!==i.index0AttributeName?r.bindAttribLocation(f,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(f,0,"position"),r.linkProgram(f),e.debug.checkShaderErrors){const e=r.getProgramInfoLog(f).trim(),t=r.getShaderInfoLog(v).trim(),i=r.getShaderInfoLog(x).trim();let n=!0,s=!0;if(!1===r.getProgramParameter(f,35714)){n=!1;const t=XN(r,v,"vertex"),i=XN(r,x,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(f,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+i)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==i||(s=!1);s&&(this.diagnostics={runnable:n,programLog:e,vertexShader:{log:t,prefix:m},fragmentShader:{log:i,prefix:g}})}let b,w;return r.deleteShader(v),r.deleteShader(x),this.getUniforms=function(){return void 0===b&&(b=new qN(r,f)),b},this.getAttributes=function(){return void 0===w&&(w=function(e,t){const i={},n=e.getProgramParameter(t,35721);for(let r=0;r<n;r++){const n=e.getActiveAttrib(t,r),s=n.name;let o=1;35674===n.type&&(o=2),35675===n.type&&(o=3),35676===n.type&&(o=4),i[s]={type:n.type,location:e.getAttribLocation(t,s),locationSize:o}}return i}(r,f)),w},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(f),this.program=void 0},this.name=i.shaderName,this.id=ZN++,this.cacheKey=t,this.usedTimes=1,this.program=f,this.vertexShader=v,this.fragmentShader=x,this}let hz=0;class dz{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;if(!1===t.has(e)){const i=new pz;t.set(e,i)}return t.get(e)}}class pz{constructor(){this.id=hz++,this.usedTimes=0}}function fz(e,t,i,n,r,s,o){const a=new IL,l=new dz,c=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,d=r.floatVertexTextures,p=r.maxVertexUniforms,f=r.vertexTextures;let m=r.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,a,c,_,y){const v=_.fog,x=s.isMeshStandardMaterial?_.environment:null,b=(s.isMeshStandardMaterial?i:t).get(s.envMap||x),w=g[s.type],S=y.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(d)return 1024;{const e=p,i=Math.floor((e-20)/4),n=Math.min(i,t.length);return n<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+n+"."),0):n}}(y):0;let T,E,M,I;if(null!==s.precision&&(m=r.getMaxPrecision(s.precision),m!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",m,"instead.")),w){const e=rO[w];T=e.vertexShader,E=e.fragmentShader}else T=s.vertexShader,E=s.fragmentShader,l.update(s),M=l.getVertexShaderID(s),I=l.getFragmentShaderID(s);const A=e.getRenderTarget(),C=s.alphaTest>0,P=s.clearcoat>0;return{isWebGL2:u,shaderID:w,shaderName:s.type,vertexShader:T,fragmentShader:E,defines:s.defines,customVertexShaderID:M,customFragmentShaderID:I,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:m,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:f,outputEncoding:null===A?e.outputEncoding:!0===A.isXRRenderTarget?A.texture.encoding:eR,map:!!s.map,matcap:!!s.matcap,envMap:!!b,envMapMode:b&&b.mapping,envMapCubeUV:!!b&&(b.mapping===jP||b.mapping===GP),lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:s.normalMapType===rR,tangentSpaceNormalMap:s.normalMapType===nR,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===tR,clearcoat:P,clearcoatMap:P&&!!s.clearcoatMap,clearcoatRoughnessMap:P&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:P&&!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,transparent:s.transparent,alphaMap:!!s.alphaMap,alphaTest:C,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!y.geometry&&!!y.geometry.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.geometry&&!!y.geometry.attributes.color&&4===y.geometry.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.displacementMap||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheenColorMap||s.sheenRoughnessMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap||!s.displacementMap),fog:!!v,useFog:s.fog,fogExp2:v&&v.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===y.isSkinnedMesh&&S>0,maxBones:S,useVertexTexture:d,morphTargets:!!y.geometry&&!!y.geometry.morphAttributes.position,morphNormals:!!y.geometry&&!!y.geometry.morphAttributes.normal,morphTargetsCount:y.geometry&&y.geometry.morphAttributes.position?y.geometry.morphAttributes.position.length:0,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:s.toneMapped?e.toneMapping:RP,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===JC,flipSided:s.side===KC,depthPacking:void 0!==s.depthPacking&&s.depthPacking,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){const i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.customVertexShaderID),i.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)i.push(e),i.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.maxBones),e.push(t.morphTargetsCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection)}(i,t),function(e,t){a.disableAll(),t.isWebGL2&&a.enable(0),t.supportsVertexTextures&&a.enable(1),t.instancing&&a.enable(2),t.instancingColor&&a.enable(3),t.map&&a.enable(4),t.matcap&&a.enable(5),t.envMap&&a.enable(6),t.envMapCubeUV&&a.enable(7),t.lightMap&&a.enable(8),t.aoMap&&a.enable(9),t.emissiveMap&&a.enable(10),t.bumpMap&&a.enable(11),t.normalMap&&a.enable(12),t.objectSpaceNormalMap&&a.enable(13),t.tangentSpaceNormalMap&&a.enable(14),t.clearcoat&&a.enable(15),t.clearcoatMap&&a.enable(16),t.clearcoatRoughnessMap&&a.enable(17),t.clearcoatNormalMap&&a.enable(18),t.displacementMap&&a.enable(19),t.specularMap&&a.enable(20),t.roughnessMap&&a.enable(21),t.metalnessMap&&a.enable(22),t.gradientMap&&a.enable(23),t.alphaMap&&a.enable(24),t.alphaTest&&a.enable(25),t.vertexColors&&a.enable(26),t.vertexAlphas&&a.enable(27),t.vertexUvs&&a.enable(28),t.vertexTangents&&a.enable(29),t.uvsVertexOnly&&a.enable(30),t.fog&&a.enable(31),e.push(a.mask),a.disableAll(),t.useFog&&a.enable(0),t.flatShading&&a.enable(1),t.logarithmicDepthBuffer&&a.enable(2),t.skinning&&a.enable(3),t.useVertexTexture&&a.enable(4),t.morphTargets&&a.enable(5),t.morphNormals&&a.enable(6),t.premultipliedAlpha&&a.enable(7),t.shadowMapEnabled&&a.enable(8),t.physicallyCorrectLights&&a.enable(9),t.doubleSided&&a.enable(10),t.flipSided&&a.enable(11),t.depthPacking&&a.enable(12),t.dithering&&a.enable(13),t.specularIntensityMap&&a.enable(14),t.specularColorMap&&a.enable(15),t.transmission&&a.enable(16),t.transmissionMap&&a.enable(17),t.thicknessMap&&a.enable(18),t.sheen&&a.enable(19),t.sheenColorMap&&a.enable(20),t.sheenRoughnessMap&&a.enable(21),t.decodeVideoTexture&&a.enable(22),t.transparent&&a.enable(23),e.push(a.mask)}(i,t),i.push(e.outputEncoding)),i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){const t=g[e.type];let i;if(t){const e=rO[t];i=FD.clone(e.uniforms)}else i=e.uniforms;return i},acquireProgram:function(t,i){let n;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(t.cacheKey===i){n=t,++n.usedTimes;break}}return void 0===n&&(n=new uz(e,i,t,s),c.push(n)),n},releaseProgram:function(e){if(0==--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function mz(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function gz(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function _z(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function yz(){const e=[];let t=0;const i=[],n=[],r=[];function s(i,n,r,s,o,a){let l=e[t];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:s,renderOrder:i.renderOrder,z:o,group:a},e[t]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=s,l.renderOrder=i.renderOrder,l.z=o,l.group=a),t++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){t=0,i.length=0,n.length=0,r.length=0},push:function(e,t,o,a,l,c){const u=s(e,t,o,a,l,c);o.transmission>0?n.push(u):!0===o.transparent?r.push(u):i.push(u)},unshift:function(e,t,o,a,l,c){const u=s(e,t,o,a,l,c);o.transmission>0?n.unshift(u):!0===o.transparent?r.unshift(u):i.unshift(u)},finish:function(){for(let i=t,n=e.length;i<n;i++){const t=e[i];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){i.length>1&&i.sort(e||gz),n.length>1&&n.sort(t||_z),r.length>1&&r.sort(t||_z)}}}function vz(){let e=new WeakMap;return{get:function(t,i){let n;return!1===e.has(t)?(n=new yz,e.set(t,[n])):i>=e.get(t).length?(n=new yz,e.get(t).push(n)):n=e.get(t)[i],n},dispose:function(){e=new WeakMap}}}function xz(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new BR,color:new CR};break;case"SpotLight":i={position:new BR,direction:new BR,color:new CR,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new BR,color:new CR,distance:0,decay:0};break;case"HemisphereLight":i={direction:new BR,skyColor:new CR,groundColor:new CR};break;case"RectAreaLight":i={color:new CR,position:new BR,halfWidth:new BR,halfHeight:new BR}}return e[t.id]=i,i}}}let bz=0;function wz(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Sz(e,t){const i=new xz,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new vR};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new vR,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)r.probe.push(new BR);const s=new BR,o=new gL,a=new gL;return{setup:function(s,o){let a=0,l=0,c=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let u=0,h=0,d=0,p=0,f=0,m=0,g=0,_=0;s.sort(wz);const y=!0!==o?Math.PI:1;for(let e=0,t=s.length;e<t;e++){const t=s[e],o=t.color,v=t.intensity,x=t.distance,b=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=o.r*v*y,l+=o.g*v*y,c+=o.b*v*y;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],v);else if(t.isDirectionalLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.directionalShadow[u]=i,r.directionalShadowMap[u]=b,r.directionalShadowMatrix[u]=t.shadow.matrix,m++}r.directional[u]=e,u++}else if(t.isSpotLight){const e=i.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(v*y),e.distance=x,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.spotShadow[d]=i,r.spotShadowMap[d]=b,r.spotShadowMatrix[d]=t.shadow.matrix,_++}r.spot[d]=e,d++}else if(t.isRectAreaLight){const e=i.get(t);e.color.copy(o).multiplyScalar(v),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,r.pointShadow[h]=i,r.pointShadowMap[h]=b,r.pointShadowMatrix[h]=t.shadow.matrix,g++}r.point[h]=e,h++}else if(t.isHemisphereLight){const e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(v*y),e.groundColor.copy(t.groundColor).multiplyScalar(v*y),r.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=nO.LTC_FLOAT_1,r.rectAreaLTC2=nO.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=nO.LTC_HALF_1,r.rectAreaLTC2=nO.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=c;const v=r.hash;v.directionalLength===u&&v.pointLength===h&&v.spotLength===d&&v.rectAreaLength===p&&v.hemiLength===f&&v.numDirectionalShadows===m&&v.numPointShadows===g&&v.numSpotShadows===_||(r.directional.length=u,r.spot.length=d,r.rectArea.length=p,r.point.length=h,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotShadowMatrix.length=_,v.directionalLength=u,v.pointLength=h,v.spotLength=d,v.rectAreaLength=p,v.hemiLength=f,v.numDirectionalShadows=m,v.numPointShadows=g,v.numSpotShadows=_,r.version=bz++)},setupView:function(e,t){let i=0,n=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=r.directional[i];e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(h),i++}else if(d.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),a.identity(),o.copy(d.matrixWorld),o.premultiply(h),a.extractRotation(o),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const e=r.point[n];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),n++}else if(d.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),e.direction.normalize(),u++}}},state:r}}function Tz(e,t){const i=new Sz(e,t),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(e){i.setup(n,e)},setupLightsView:function(e){i.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function Ez(e,t){let i=new WeakMap;return{get:function(n,r=0){let s;return!1===i.has(n)?(s=new Tz(e,t),i.set(n,[s])):r>=i.get(n).length?(s=new Tz(e,t),i.get(n).push(s)):s=i.get(n)[r],s},dispose:function(){i=new WeakMap}}}class Mz extends eD{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}Mz.prototype.isMeshDepthMaterial=!0;class Iz extends eD{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new BR,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}Iz.prototype.isMeshDistanceMaterial=!0;const Az="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",Cz="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function Pz(e,t,i){let n=new JD;const r=new vR,s=new vR,o=new OR,a=new Mz({depthPacking:iR}),l=new Iz,c={},u=i.maxTextureSize,h={0:KC,1:YC,2:JC},d=new BD({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new vR},radius:{value:4}},vertexShader:Az,fragmentShader:Cz}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new mD;f.setAttribute("position",new rD(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new LD(f,d),g=this;function _(i,n){const r=t.update(m);d.defines.VSM_SAMPLES!==i.blurSamples&&(d.defines.VSM_SAMPLES=i.blurSamples,p.defines.VSM_SAMPLES=i.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),d.uniforms.shadow_pass.value=i.map.texture,d.uniforms.resolution.value=i.mapSize,d.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,r,d,m,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,r,p,m,null)}function y(t,i,n,r,s,o,u){let d=null;const p=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(d=void 0!==p?p:!0===r.isPointLight?l:a,e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const e=d.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=d.clone(),i[t]=r),d=r}return d.visible=n.visible,d.wireframe=n.wireframe,d.side=u===XC?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],d.alphaMap=n.alphaMap,d.alphaTest=n.alphaTest,d.clipShadows=n.clipShadows,d.clippingPlanes=n.clippingPlanes,d.clipIntersection=n.clipIntersection,d.displacementMap=n.displacementMap,d.displacementScale=n.displacementScale,d.displacementBias=n.displacementBias,d.wireframeLinewidth=n.wireframeLinewidth,d.linewidth=n.linewidth,!0===r.isPointLight&&!0===d.isMeshDistanceMaterial&&(d.referencePosition.setFromMatrixPosition(r.matrixWorld),d.nearDistance=s,d.farDistance=o),d}function v(i,r,s,o,a){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&a===XC)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=t.update(i),r=i.material;if(Array.isArray(r)){const t=n.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=r[c.materialIndex];if(u&&u.visible){const t=y(i,0,u,o,s.near,s.far,a);e.renderBufferDirect(s,null,n,t,i,c)}}}else if(r.visible){const t=y(i,0,r,o,s.near,s.far,a);e.renderBufferDirect(s,null,n,t,i,null)}}const l=i.children;for(let e=0,t=l.length;e<t;e++)v(l[e],r,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=$C,this.render=function(t,i,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(QC),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,c=t.length;l<c;l++){const c=t[l],h=c.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;r.copy(h.mapSize);const p=h.getFrameExtents();if(r.multiply(p),s.copy(h.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/p.x),r.x=s.x*p.x,h.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/p.y),r.y=s.y*p.y,h.mapSize.y=s.y)),null===h.map&&!h.isPointLightShadow&&this.type===XC){const e={minFilter:YP,magFilter:YP,format:dk};h.map=new NR(r.x,r.y,e),h.map.texture.name=c.name+".shadowMap",h.mapPass=new NR(r.x,r.y,e),h.camera.updateProjectionMatrix()}if(null===h.map){const e={minFilter:$P,magFilter:$P,format:dk};h.map=new NR(r.x,r.y,e),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const f=h.getViewportCount();for(let e=0;e<f;e++){const t=h.getViewport(e);o.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),d.viewport(o),h.updateMatrices(c,e),n=h.getFrustum(),v(i,a,h.camera,c,this.type)}h.isPointLightShadow||this.type!==XC||_(h,a),h.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(l,c,h)}}function kz(e,t,i){const n=i.isWebGL2,r=new function(){let t=!1;const i=new OR;let n=null;const r=new OR(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,s,o,a){!0===a&&(t*=o,n*=o,s*=o),i.set(t,n,s,o),!1===r.equals(i)&&(e.clearColor(t,n,s,o),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}},s=new function(){let t=!1,i=null,n=null,r=null;return{setTest:function(e){e?F(2929):B(2929)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case bP:e.depthFunc(512);break;case wP:e.depthFunc(519);break;case SP:e.depthFunc(513);break;case TP:e.depthFunc(515);break;case EP:e.depthFunc(514);break;case MP:e.depthFunc(518);break;case IP:e.depthFunc(516);break;case AP:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,i=null,n=null,r=null}}},o=new function(){let t=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(e){t||(e?F(2960):B(2960))},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,o){n===t&&r===i&&s===o||(e.stencilFunc(t,i,o),n=t,r=i,s=o)},setOp:function(t,i,n){o===t&&a===i&&l===n||(e.stencilOp(t,i,n),o=t,a=i,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,c=null}}};let a={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,_=null,y=null,v=null,x=!1,b=null,w=null,S=null,T=null,E=null;const M=e.getParameter(35661);let I=!1,A=0;const C=e.getParameter(7938);-1!==C.indexOf("WebGL")?(A=parseFloat(/^WebGL (\d)/.exec(C)[1]),I=A>=1):-1!==C.indexOf("OpenGL ES")&&(A=parseFloat(/^OpenGL ES (\d)/.exec(C)[1]),I=A>=2);let P=null,k={};const R=e.getParameter(3088),L=e.getParameter(2978),D=(new OR).fromArray(R),O=(new OR).fromArray(L);function N(t,i,n){const r=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<n;t++)e.texImage2D(i+t,0,6408,1,1,0,6408,5121,r);return s}const z={};function F(t){!0!==a[t]&&(e.enable(t),a[t]=!0)}function B(t){!1!==a[t]&&(e.disable(t),a[t]=!1)}z[3553]=N(3553,3553,1),z[34067]=N(34067,34069,6),r.setClear(0,0,0,1),s.setClear(1),o.setClear(0),F(2929),s.setFunc(TP),G(!1),H(WC),F(2884),j(QC);const U={[sP]:32774,[oP]:32778,[aP]:32779};if(n)U[lP]=32775,U[cP]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(U[lP]=e.MIN_EXT,U[cP]=e.MAX_EXT)}const V={[uP]:0,[hP]:1,[dP]:768,[fP]:770,[xP]:776,[yP]:774,[gP]:772,[pP]:769,[mP]:771,[vP]:775,[_P]:773};function j(t,i,n,r,s,o,a,l){if(t!==QC){if(!1===d&&(F(3042),d=!0),t===rP)s=s||i,o=o||n,a=a||r,i===f&&s===_||(e.blendEquationSeparate(U[i],U[s]),f=i,_=s),n===m&&r===g&&o===y&&a===v||(e.blendFuncSeparate(V[n],V[r],V[o],V[a]),m=n,g=r,y=o,v=a),p=t,x=null;else if(t!==p||l!==x){if(f===sP&&_===sP||(e.blendEquation(32774),f=sP,_=sP),l)switch(t){case eP:e.blendFuncSeparate(1,771,1,771);break;case tP:e.blendFunc(1,1);break;case iP:e.blendFuncSeparate(0,769,0,1);break;case nP:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case eP:e.blendFuncSeparate(770,771,1,771);break;case tP:e.blendFunc(770,1);break;case iP:e.blendFuncSeparate(0,769,0,1);break;case nP:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}m=null,g=null,y=null,v=null,p=t,x=l}}else!0===d&&(B(3042),d=!1)}function G(t){b!==t&&(t?e.frontFace(2304):e.frontFace(2305),b=t)}function H(t){t!==HC?(F(2884),t!==w&&(t===WC?e.cullFace(1029):t===qC?e.cullFace(1028):e.cullFace(1032))):B(2884),w=t}function W(t,i,n){t?(F(32823),T===i&&E===n||(e.polygonOffset(i,n),T=i,E=n)):B(32823)}function q(t){void 0===t&&(t=33984+M-1),P!==t&&(e.activeTexture(t),P=t)}return{buffers:{color:r,depth:s,stencil:o},enable:F,disable:B,bindFramebuffer:function(t,i){return l[t]!==i&&(e.bindFramebuffer(t,i),l[t]=i,n&&(36009===t&&(l[36160]=i),36160===t&&(l[36009]=i)),!0)},drawBuffers:function(n,r){let s=u,o=!1;if(n)if(s=c.get(r),void 0===s&&(s=[],c.set(r,s)),n.isWebGLMultipleRenderTargets){const e=n.texture;if(s.length!==e.length||36064!==s[0]){for(let t=0,i=e.length;t<i;t++)s[t]=36064+t;s.length=e.length,o=!0}}else 36064!==s[0]&&(s[0]=36064,o=!0);else 1029!==s[0]&&(s[0]=1029,o=!0);o&&(i.isWebGL2?e.drawBuffers(s):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:j,setMaterial:function(e,t){e.side===JC?B(2884):F(2884);let i=e.side===KC;t&&(i=!i),G(i),e.blending===eP&&!1===e.transparent?j(QC):j(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),r.setMask(e.colorWrite);const n=e.stencilWrite;o.setTest(n),n&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),W(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?F(32926):B(32926)},setFlipSided:G,setCullFace:H,setLineWidth:function(t){t!==S&&(I&&e.lineWidth(t),S=t)},setPolygonOffset:W,setScissorTest:function(e){e?F(3089):B(3089)},activeTexture:q,bindTexture:function(t,i){null===P&&q();let n=k[P];void 0===n&&(n={type:void 0,texture:void 0},k[P]=n),n.type===t&&n.texture===i||(e.bindTexture(t,i||z[t]),n.type=t,n.texture=i)},unbindTexture:function(){const t=k[P];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===D.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),D.copy(t))},viewport:function(t){!1===O.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),O.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===n&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),a={},P=null,k={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,_=null,y=null,v=null,x=!1,b=null,w=null,S=null,T=null,E=null,D.set(0,0,e.canvas.width,e.canvas.height),O.set(0,0,e.canvas.width,e.canvas.height),r.reset(),s.reset(),o.reset()}}}function Rz(e,t,i,n,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):void 0,p=new WeakMap;let f,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function g(e,t){return m?new OffscreenCanvas(e,t):wR("canvas")}function _(e,t,i,n){let r=1;if((e.width>n||e.height>n)&&(r=n/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const n=t?yR:Math.floor,s=n(r*e.width),o=n(r*e.height);void 0===f&&(f=g(s,o));const a=i?g(s,o):f;return a.width=s,a.height=o,a.getContext("2d").drawImage(e,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+o+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function y(e){return _R(e.width)&&_R(e.height)}function v(e,t){return e.generateMipmaps&&t&&e.minFilter!==$P&&e.minFilter!==YP}function x(t){e.generateMipmap(t)}function b(i,n,r,s,o=!1){if(!1===a)return n;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let l=n;return 6403===n&&(5126===r&&(l=33326),5131===r&&(l=33325),5121===r&&(l=33321)),33319===n&&(5126===r&&(l=33328),5131===r&&(l=33327),5121===r&&(l=33323)),6408===n&&(5126===r&&(l=34836),5131===r&&(l=34842),5121===r&&(l=s===tR&&!1===o?35907:32856),32819===r&&(l=32854),32820===r&&(l=32855)),33325!==l&&33326!==l&&33327!==l&&33328!==l&&34842!==l&&34836!==l||t.get("EXT_color_buffer_float"),l}function w(e,t,i){return!0===v(e,i)||e.isFramebufferTexture&&e.minFilter!==$P&&e.minFilter!==YP?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function S(e){return e===$P||e===ZP||e===XP?9728:9729}function T(t){const i=t.target;i.removeEventListener("dispose",T),function(t){const i=n.get(t);void 0!==i.__webglInit&&(e.deleteTexture(i.__webglTexture),n.remove(t))}(i),i.isVideoTexture&&p.delete(i),o.memory.textures--}function E(t){const i=t.target;i.removeEventListener("dispose",E),function(t){const i=t.texture,r=n.get(t),s=n.get(i);if(t){if(void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),o.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&e.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let t=0,r=i.length;t<r;t++){const r=n.get(i[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),o.memory.textures--),n.remove(i[t])}n.remove(i),n.remove(t)}}(i)}let M=0;function I(e,t){const r=n.get(e);if(e.isVideoTexture&&function(e){const t=o.render.frame;p.get(e)!==t&&(p.set(e,t),e.update())}(e),e.version>0&&r.__version!==e.version){const i=e.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void L(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+t),i.bindTexture(3553,r.__webglTexture)}function A(t,r){const o=n.get(t);t.version>0&&o.__version!==t.version?function(t,n,r){if(6!==n.image.length)return;R(t,n),i.activeTexture(33984+r),i.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment),e.pixelStorei(37443,0);const o=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),l=n.image[0]&&n.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=o||l?l?n.image[e].image:n.image[e]:_(n.image[e],!1,!0,c),u[e]=F(n,u[e]);const h=u[0],d=y(h)||a,p=s.convert(n.format,n.encoding),f=s.convert(n.type),m=b(n.internalFormat,p,f,n.encoding),g=a&&!0!==n.isVideoTexture,S=void 0===t.__version;let T,E=w(n,h,d);if(k(34067,n,d),o){g&&S&&i.texStorage2D(34067,E,m,h.width,h.height);for(let e=0;e<6;e++){T=u[e].mipmaps;for(let t=0;t<T.length;t++){const r=T[t];n.format!==dk?null!==p?g?i.compressedTexSubImage2D(34069+e,t,0,0,r.width,r.height,p,r.data):i.compressedTexImage2D(34069+e,t,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g?i.texSubImage2D(34069+e,t,0,0,r.width,r.height,p,f,r.data):i.texImage2D(34069+e,t,m,r.width,r.height,0,p,f,r.data)}}}else{T=n.mipmaps,g&&S&&(T.length>0&&E++,i.texStorage2D(34067,E,m,u[0].width,u[0].height));for(let e=0;e<6;e++)if(l){g?i.texSubImage2D(34069+e,0,0,0,u[e].width,u[e].height,p,f,u[e].data):i.texImage2D(34069+e,0,m,u[e].width,u[e].height,0,p,f,u[e].data);for(let t=0;t<T.length;t++){const n=T[t].image[e].image;g?i.texSubImage2D(34069+e,t+1,0,0,n.width,n.height,p,f,n.data):i.texImage2D(34069+e,t+1,m,n.width,n.height,0,p,f,n.data)}}else{g?i.texSubImage2D(34069+e,0,0,0,p,f,u[e]):i.texImage2D(34069+e,0,m,p,f,u[e]);for(let t=0;t<T.length;t++){const n=T[t];g?i.texSubImage2D(34069+e,t+1,0,0,p,f,n.image[e]):i.texImage2D(34069+e,t+1,m,p,f,n.image[e])}}}v(n,d)&&x(34067),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}(o,t,r):(i.activeTexture(33984+r),i.bindTexture(34067,o.__webglTexture))}const C={[HP]:10497,[WP]:33071,[qP]:33648},P={[$P]:9728,[ZP]:9984,[XP]:9986,[YP]:9729,[KP]:9985,[JP]:9987};function k(i,s,o){if(o?(e.texParameteri(i,10242,C[s.wrapS]),e.texParameteri(i,10243,C[s.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,C[s.wrapR]),e.texParameteri(i,10240,P[s.magFilter]),e.texParameteri(i,10241,P[s.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),s.wrapS===WP&&s.wrapT===WP||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,S(s.magFilter)),e.texParameteri(i,10241,S(s.minFilter)),s.minFilter!==$P&&s.minFilter!==YP&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(s.type===sk&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&s.type===ok&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(e.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function R(t,i){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",T),t.__webglTexture=e.createTexture(),o.memory.textures++)}function L(t,n,r){let o=3553;n.isDataTexture2DArray&&(o=35866),n.isDataTexture3D&&(o=32879),R(t,n),i.activeTexture(33984+r),i.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment),e.pixelStorei(37443,0);const l=function(e){return!a&&(e.wrapS!==WP||e.wrapT!==WP||e.minFilter!==$P&&e.minFilter!==YP)}(n)&&!1===y(n.image);let c=_(n.image,l,!1,u);c=F(n,c);const h=y(c)||a,d=s.convert(n.format,n.encoding);let p,f=s.convert(n.type),m=b(n.internalFormat,d,f,n.encoding,n.isVideoTexture);k(o,n,h);const g=n.mipmaps,S=a&&!0!==n.isVideoTexture,T=void 0===t.__version,E=w(n,c,h);if(n.isDepthTexture)m=6402,a?m=n.type===sk?36012:n.type===rk?33190:n.type===ck?35056:33189:n.type===sk&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===mk&&6402===m&&n.type!==ik&&n.type!==rk&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=ik,f=s.convert(n.type)),n.format===gk&&6402===m&&(m=34041,n.type!==ck&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=ck,f=s.convert(n.type))),S&&T?i.texStorage2D(3553,1,m,c.width,c.height):i.texImage2D(3553,0,m,c.width,c.height,0,d,f,null);else if(n.isDataTexture)if(g.length>0&&h){S&&T&&i.texStorage2D(3553,E,m,g[0].width,g[0].height);for(let e=0,t=g.length;e<t;e++)p=g[e],S?i.texSubImage2D(3553,0,0,0,p.width,p.height,d,f,p.data):i.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);n.generateMipmaps=!1}else S?(T&&i.texStorage2D(3553,E,m,c.width,c.height),i.texSubImage2D(3553,0,0,0,c.width,c.height,d,f,c.data)):i.texImage2D(3553,0,m,c.width,c.height,0,d,f,c.data);else if(n.isCompressedTexture){S&&T&&i.texStorage2D(3553,E,m,g[0].width,g[0].height);for(let e=0,t=g.length;e<t;e++)p=g[e],n.format!==dk?null!==d?S?i.compressedTexSubImage2D(3553,e,0,0,p.width,p.height,d,p.data):i.compressedTexImage2D(3553,e,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):S?i.texSubImage2D(3553,e,0,0,p.width,p.height,d,f,p.data):i.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data)}else if(n.isDataTexture2DArray)S?(T&&i.texStorage3D(35866,E,m,c.width,c.height,c.depth),i.texSubImage3D(35866,0,0,0,0,c.width,c.height,c.depth,d,f,c.data)):i.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,f,c.data);else if(n.isDataTexture3D)S?(T&&i.texStorage3D(32879,E,m,c.width,c.height,c.depth),i.texSubImage3D(32879,0,0,0,0,c.width,c.height,c.depth,d,f,c.data)):i.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,f,c.data);else if(n.isFramebufferTexture)S&&T?i.texStorage2D(3553,E,m,c.width,c.height):i.texImage2D(3553,0,m,c.width,c.height,0,d,f,null);else if(g.length>0&&h){S&&T&&i.texStorage2D(3553,E,m,g[0].width,g[0].height);for(let e=0,t=g.length;e<t;e++)p=g[e],S?i.texSubImage2D(3553,e,0,0,d,f,p):i.texImage2D(3553,e,m,d,f,p);n.generateMipmaps=!1}else S?(T&&i.texStorage2D(3553,E,m,c.width,c.height),i.texSubImage2D(3553,0,0,0,d,f,c)):i.texImage2D(3553,0,m,d,f,c);v(n,h)&&x(o),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function D(t,r,o,a,l){const c=s.convert(o.format,o.encoding),u=s.convert(o.type),h=b(o.internalFormat,c,u,o.encoding);n.get(r).__hasExternalTextures||(32879===l||35866===l?i.texImage3D(l,0,h,r.width,r.height,r.depth,0,c,u,null):i.texImage2D(l,0,h,r.width,r.height,0,c,u,null)),i.bindFramebuffer(36160,t),r.useRenderToTexture?d.framebufferTexture2DMultisampleEXT(36160,a,l,n.get(o).__webglTexture,0,z(r)):e.framebufferTexture2D(36160,a,l,n.get(o).__webglTexture,0),i.bindFramebuffer(36160,null)}function O(t,i,n){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n||i.useRenderToTexture){const t=i.depthTexture;t&&t.isDepthTexture&&(t.type===sk?r=36012:t.type===rk&&(r=33190));const n=z(i);i.useRenderToTexture?d.renderbufferStorageMultisampleEXT(36161,n,r,i.width,i.height):e.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else e.renderbufferStorage(36161,r,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){const r=z(i);n&&i.useRenderbuffer?e.renderbufferStorageMultisample(36161,r,35056,i.width,i.height):i.useRenderToTexture?d.renderbufferStorageMultisampleEXT(36161,r,35056,i.width,i.height):e.renderbufferStorage(36161,34041,i.width,i.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,r=s.convert(t.format,t.encoding),o=s.convert(t.type),a=b(t.internalFormat,r,o,t.encoding),l=z(i);n&&i.useRenderbuffer?e.renderbufferStorageMultisample(36161,l,a,i.width,i.height):i.useRenderToTexture?d.renderbufferStorageMultisampleEXT(36161,l,a,i.width,i.height):e.renderbufferStorage(36161,a,i.width,i.height)}e.bindRenderbuffer(36161,null)}function N(t){const r=n.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),I(r.depthTexture,0);const s=n.get(r.depthTexture).__webglTexture,o=z(r);if(r.depthTexture.format===mk)r.useRenderToTexture?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,o):e.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==gk)throw new Error("Unknown depthTexture format");r.useRenderToTexture?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,o):e.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,t)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=e.createRenderbuffer(),O(r.__webglDepthbuffer[n],t,!1)}else i.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),O(r.__webglDepthbuffer,t,!1);i.bindFramebuffer(36160,null)}function z(e){return a&&(e.useRenderbuffer||e.useRenderToTexture)?Math.min(h,e.samples):0}function F(e,i){const n=e.encoding,r=e.format,s=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===cR||n!==eR&&(n===tR?!1===a?!0===t.has("EXT_sRGB")&&r===dk?(e.format=cR,e.minFilter=YP,e.generateMipmaps=!1):i=kR.sRGBToLinear(i):r===dk&&s===QP||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",n)),i}let B=!1,U=!1;this.allocateTextureUnit=function(){const e=M;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=I,this.setTexture2DArray=function(e,t){const r=n.get(e);e.version>0&&r.__version!==e.version?L(r,e,t):(i.activeTexture(33984+t),i.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){const r=n.get(e);e.version>0&&r.__version!==e.version?L(r,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=A,this.rebindTextures=function(e,t,i){const r=n.get(e);void 0!==t&&D(r.__webglFramebuffer,e,e.texture,36064,3553),void 0!==i&&N(e)},this.setupRenderTarget=function(t){const l=t.texture,c=n.get(t),u=n.get(l);t.addEventListener("dispose",E),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,o.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=l.isDataTexture3D||l.isDataTexture2DArray,f=y(t)||a;if(h){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else if(c.__webglFramebuffer=e.createFramebuffer(),d)if(r.drawBuffers){const i=t.texture;for(let t=0,r=i.length;t<r;t++){const r=n.get(i[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(t.useRenderbuffer)if(a){c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const n=s.convert(l.format,l.encoding),r=s.convert(l.type),o=b(l.internalFormat,n,r,l.encoding),a=z(t);e.renderbufferStorageMultisample(36161,a,o,t.width,t.height),i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),O(c.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){i.bindTexture(34067,u.__webglTexture),k(34067,l,f);for(let e=0;e<6;e++)D(c.__webglFramebuffer[e],t,l,36064,34069+e);v(l,f)&&x(34067),i.unbindTexture()}else if(d){const e=t.texture;for(let r=0,s=e.length;r<s;r++){const s=e[r],o=n.get(s);i.bindTexture(3553,o.__webglTexture),k(3553,s,f),D(c.__webglFramebuffer,t,s,36064+r,3553),v(s,f)&&x(3553)}i.unbindTexture()}else{let e=3553;p&&(a?e=l.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),i.bindTexture(e,u.__webglTexture),k(e,l,f),D(c.__webglFramebuffer,t,l,36064,e),v(l,f)&&x(e),i.unbindTexture()}t.depthBuffer&&N(t)},this.updateRenderTargetMipmap=function(e){const t=y(e)||a,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let s=0,o=r.length;s<o;s++){const o=r[s];if(v(o,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,r=n.get(o).__webglTexture;i.bindTexture(t,r),x(t),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.useRenderbuffer)if(a){const r=t.width,s=t.height;let o=16384;const a=[36064],l=t.stencilBuffer?33306:36096;t.depthBuffer&&a.push(l),t.ignoreDepthForMultisampleCopy||(t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024));const c=n.get(t);i.bindFramebuffer(36008,c.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,c.__webglFramebuffer),t.ignoreDepthForMultisampleCopy&&(e.invalidateFramebuffer(36008,[l]),e.invalidateFramebuffer(36009,[l])),e.blitFramebuffer(0,0,r,s,0,0,r,s,o,9728),e.invalidateFramebuffer(36008,a),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,c.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.setupDepthRenderbuffer=N,this.setupFrameBufferTexture=D,this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),B=!0),e=e.texture),I(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),U=!0),e=e.texture),A(e,t)}}function Lz(e,t,i){const n=i.isWebGL2;return{convert:function(e,i=null){let r;if(e===QP)return 5121;if(e===ak)return 32819;if(e===lk)return 32820;if(e===ek)return 5120;if(e===tk)return 5122;if(e===ik)return 5123;if(e===nk)return 5124;if(e===rk)return 5125;if(e===sk)return 5126;if(e===ok)return n?5131:(r=t.get("OES_texture_half_float"),null!==r?r.HALF_FLOAT_OES:null);if(e===uk)return 6406;if(e===dk)return 6408;if(e===pk)return 6409;if(e===fk)return 6410;if(e===mk)return 6402;if(e===gk)return 34041;if(e===_k)return 6403;if(e===hk)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(e===cR)return r=t.get("EXT_sRGB"),null!==r?r.SRGB_ALPHA_EXT:null;if(e===yk)return 36244;if(e===vk)return 33319;if(e===xk)return 33320;if(e===bk)return 36249;if(e===wk||e===Sk||e===Tk||e===Ek)if(i===tR){if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(e===wk)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===Sk)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===Tk)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===Ek)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=t.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(e===wk)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Sk)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Tk)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Ek)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===Mk||e===Ik||e===Ak||e===Ck){if(r=t.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(e===Mk)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Ik)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Ak)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Ck)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===Pk)return r=t.get("WEBGL_compressed_texture_etc1"),null!==r?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(e===kk||e===Rk){if(r=t.get("WEBGL_compressed_texture_etc"),null===r)return null;if(e===kk)return i===tR?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(e===Rk)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(e===Lk||e===Dk||e===Ok||e===Nk||e===zk||e===Fk||e===Bk||e===Uk||e===Vk||e===jk||e===Gk||e===Hk||e===Wk||e===qk){if(r=t.get("WEBGL_compressed_texture_astc"),null===r)return null;if(e===Lk)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Dk)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Ok)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Nk)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===zk)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===Fk)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===Bk)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===Uk)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===Vk)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===jk)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===Gk)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Hk)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===Wk)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===qk)return i===tR?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(e===$k){if(r=t.get("EXT_texture_compression_bptc"),null===r)return null;if(e===$k)return i===tR?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}return e===ck?n?34042:(r=t.get("WEBGL_depth_texture"),null!==r?r.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Dz extends VD{constructor(e=[]){super(),this.cameras=e}}Dz.prototype.isArrayCamera=!0;class Oz extends VL{constructor(){super(),this.type="Group"}}Oz.prototype.isGroup=!0;const Nz={type:"move"};class zz{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Oz,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Oz,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new BR,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new BR),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Oz,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new BR,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new BR),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==o&&(n=t.getPose(e.targetRaySpace,i),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Nz))),l&&e.hand){s=!0;for(const n of e.hand.values()){const e=t.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const e=new Oz;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[n.jointName]=e,l.add(e)}const r=l.joints[n.jointName];null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=e.radius),r.visible=null!==e}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=n.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class Fz extends LR{constructor(e,t,i,n,r,s,o,a,l,c){if((c=void 0!==c?c:mk)!==mk&&c!==gk)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===mk&&(i=ik),void 0===i&&c===gk&&(i=ck),super(null,n,r,s,o,a,c,i,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:$P,this.minFilter=void 0!==a?a:$P,this.flipY=!1,this.generateMipmaps=!1}}Fz.prototype.isDepthTexture=!0;class Bz extends uR{constructor(e,t){super();const i=this;let n=null,r=1,s=null,o="local-floor";const a=e.extensions.has("WEBGL_multisampled_render_to_texture");let l=null,c=null,u=null,h=null,d=!1,p=null;const f=t.getContextAttributes();let m=null,g=null;const _=[],y=new Map,v=new VD;v.layers.enable(1),v.viewport=new OR;const x=new VD;x.layers.enable(2),x.viewport=new OR;const b=[v,x],w=new Dz;w.layers.enable(1),w.layers.enable(2);let S=null,T=null;function E(e){const t=y.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function M(){y.forEach((function(e,t){e.disconnect(t)})),y.clear(),S=null,T=null,e.setRenderTarget(m),h=null,u=null,c=null,n=null,g=null,R.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function I(e){const t=n.inputSources;for(let e=0;e<_.length;e++)y.set(t[e],_[e]);for(let t=0;t<e.removed.length;t++){const i=e.removed[t],n=y.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),y.delete(i))}for(let t=0;t<e.added.length;t++){const i=e.added[t],n=y.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=_[e];return void 0===t&&(t=new zz,_[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=_[e];return void 0===t&&(t=new zz,_[e]=t),t.getGripSpace()},this.getHand=function(e){let t=_[e];return void 0===t&&(t=new zz,_[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getBaseLayer=function(){return null!==u?u:h},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=async function(l){if(n=l,null!==n){if(m=e.getRenderTarget(),n.addEventListener("select",E),n.addEventListener("selectstart",E),n.addEventListener("selectend",E),n.addEventListener("squeeze",E),n.addEventListener("squeezestart",E),n.addEventListener("squeezeend",E),n.addEventListener("end",M),n.addEventListener("inputsourceschange",I),!0!==f.xrCompatible&&await t.makeXRCompatible(),void 0===n.renderState.layers||!1===e.capabilities.isWebGL2){const i={antialias:void 0!==n.renderState.layers||f.antialias,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(n,t,i),n.updateRenderState({baseLayer:h}),g=new NR(h.framebufferWidth,h.framebufferHeight,{format:dk,type:QP,encoding:e.outputEncoding})}else{d=f.antialias;let i=null,s=null,o=null;f.depth&&(o=f.stencil?35056:33190,i=f.stencil?gk:mk,s=f.stencil?ck:ik);const l={colorFormat:e.outputEncoding===tR?35907:32856,depthFormat:o,scaleFactor:r};c=new XRWebGLBinding(n,t),u=c.createProjectionLayer(l),n.updateRenderState({layers:[u]}),g=d?new zR(u.textureWidth,u.textureHeight,{format:dk,type:QP,depthTexture:new Fz(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:f.stencil,ignoreDepth:u.ignoreDepthValues,useRenderToTexture:a,encoding:e.outputEncoding}):new NR(u.textureWidth,u.textureHeight,{format:dk,type:QP,depthTexture:new Fz(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:f.stencil,ignoreDepth:u.ignoreDepthValues,encoding:e.outputEncoding})}g.isXRRenderTarget=!0,this.setFoveation(1),s=await n.requestReferenceSpace(o),R.setContext(n),R.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const A=new BR,C=new BR;function P(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===n)return;w.near=x.near=v.near=e.near,w.far=x.far=v.far=e.far,S===w.near&&T===w.far||(n.updateRenderState({depthNear:w.near,depthFar:w.far}),S=w.near,T=w.far);const t=e.parent,i=w.cameras;P(w,t);for(let e=0;e<i.length;e++)P(i[e],t);w.matrixWorld.decompose(w.position,w.quaternion,w.scale),e.position.copy(w.position),e.quaternion.copy(w.quaternion),e.scale.copy(w.scale),e.matrix.copy(w.matrix),e.matrixWorld.copy(w.matrixWorld);const r=e.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld(!0);2===i.length?function(e,t,i){A.setFromMatrixPosition(t.matrixWorld),C.setFromMatrixPosition(i.matrixWorld);const n=A.distanceTo(C),r=t.projectionMatrix.elements,s=i.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(s[8]+1)/s[0],d=o*u,p=o*h,f=n/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+f,_=a+f,y=d-m,v=p+(n-m),x=l*a/_*g,b=c*a/_*g;e.projectionMatrix.makePerspective(y,v,x,b,g,_)}(w,v,x):w.projectionMatrix.copy(v.projectionMatrix)},this.getCamera=function(){return w},this.getFoveation=function(){return null!==u?u.fixedFoveation:null!==h?h.fixedFoveation:void 0},this.setFoveation=function(e){null!==u&&(u.fixedFoveation=e),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=e)};let k=null;const R=new QD;R.setAnimationLoop((function(t,i){if(l=i.getViewerPose(s),p=i,null!==l){const t=l.views;null!==h&&(e.setRenderTargetFramebuffer(g,h.framebuffer),e.setRenderTarget(g));let i=!1;t.length!==w.cameras.length&&(w.cameras.length=0,i=!0);for(let n=0;n<t.length;n++){const r=t[n];let s=null;if(null!==h)s=h.getViewport(r);else{const t=c.getViewSubImage(u,r);s=t.viewport,0===n&&(e.setRenderTargetTextures(g,t.colorTexture,u.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}const o=b[n];o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===n&&w.matrix.copy(o.matrix),!0===i&&w.cameras.push(o)}}const r=n.inputSources;for(let e=0;e<_.length;e++){const t=_[e],n=r[e];t.update(n,i,s)}k&&k(t,i),p=null})),this.setAnimationLoop=function(e){k=e},this.dispose=function(){}}}function Uz(e){function t(t,i){t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map),i.alphaMap&&(t.alphaMap.value=i.alphaMap),i.specularMap&&(t.specularMap.value=i.specularMap),i.alphaTest>0&&(t.alphaTest.value=i.alphaTest);const n=e.get(i).envMap;let r,s;n&&(t.envMap.value=n,t.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,t.reflectivity.value=i.reflectivity,t.ior.value=i.ior,t.refractionRatio.value=i.refractionRatio),i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap?r=i.clearcoatRoughnessMap:i.specularIntensityMap?r=i.specularIntensityMap:i.specularColorMap?r=i.specularColorMap:i.transmissionMap?r=i.transmissionMap:i.thicknessMap?r=i.thicknessMap:i.sheenColorMap?r=i.sheenColorMap:i.sheenRoughnessMap&&(r=i.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix)),i.aoMap?s=i.aoMap:i.lightMap&&(s=i.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),t.uv2Transform.value.copy(s.matrix))}function i(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap),i.bumpMap&&(t.bumpMap.value=i.bumpMap,t.bumpScale.value=i.bumpScale,i.side===KC&&(t.bumpScale.value*=-1)),i.normalMap&&(t.normalMap.value=i.normalMap,t.normalScale.value.copy(i.normalScale),i.side===KC&&t.normalScale.value.negate()),i.displacementMap&&(t.displacementMap.value=i.displacementMap,t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias),e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,n,r,s,o){n.isMeshBasicMaterial?t(e,n):n.isMeshLambertMaterial?(t(e,n),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,n)):n.isMeshToonMaterial?(t(e,n),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===KC&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===KC&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshPhongMaterial?(t(e,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===KC&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===KC&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshStandardMaterial?(t(e,n),n.isMeshPhysicalMaterial?function(e,t,n){i(e,t),e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap)),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===KC&&e.clearcoatNormalScale.value.negate())),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,n,o):i(e,n)):n.isMeshMatcapMaterial?(t(e,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===KC&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===KC&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshDepthMaterial?(t(e,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshDistanceMaterial?(t(e,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,n)):n.isMeshNormalMaterial?(t(e,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===KC&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===KC&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,n)):n.isPointsMaterial?function(e,t,i,n){let r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*n,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,n,r,s):n.isSpriteMaterial?function(e,t){let i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,n):n.isShadowMaterial?(e.color.value.copy(n.color),e.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function Vz(e={}){const t=void 0!==e.canvas?e.canvas:function(){const e=wR("canvas");return e.style.display="block",e}(),i=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h=null,d=null;const p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=eR,this.physicallyCorrectLights=!1,this.toneMapping=RP,this.toneMappingExposure=1;const m=this;let g=!1,_=0,y=0,v=null,x=-1,b=null;const w=new OR,S=new OR;let T=null,E=t.width,M=t.height,I=1,A=null,C=null;const P=new OR(0,0,E,M),k=new OR(0,0,E,M);let R=!1;const L=new JD;let D=!1,O=!1,N=null;const z=new gL,F=new BR,B={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function U(){return null===v?I:1}let V,j,G,H,W,q,$,Z,X,Y,K,J,Q,ee,te,ie,ne,re,se,oe,ae,le,ce,ue=i;function he(e,i){for(let n=0;n<e.length;n++){const r=e[n],s=t.getContext(r,i);if(null!==s)return s}return null}try{const e={alpha:!0,depth:r,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${GC}`),t.addEventListener("webglcontextlost",fe,!1),t.addEventListener("webglcontextrestored",me,!1),null===ue){const t=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&t.shift(),ue=he(t,e),null===ue)throw he(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ue.getShaderPrecisionFormat&&(ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function de(){V=new RO(ue),j=new lO(ue,V,e),V.init(j),le=new Lz(ue,V,j),G=new kz(ue,V,j),H=new OO(ue),W=new mz,q=new Rz(ue,V,G,W,j,le,H),$=new uO(m),Z=new kO(m),X=new eO(ue,j),ce=new oO(ue,V,X,j),Y=new LO(ue,X,H,ce),K=new VO(ue,Y,X,H),se=new UO(ue,j,q),ie=new cO(W),J=new fz(m,$,Z,V,j,ce,ie),Q=new Uz(W),ee=new vz,te=new Ez(V,j),re=new sO(m,$,G,K,n,a),ne=new Pz(m,K,j),oe=new aO(ue,V,H,j),ae=new DO(ue,V,H,j),H.programs=J.programs,m.capabilities=j,m.extensions=V,m.properties=W,m.renderLists=ee,m.shadowMap=ne,m.state=G,m.info=H}de();const pe=new Bz(m,ue);function fe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function me(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const e=H.autoReset,t=ne.enabled,i=ne.autoUpdate,n=ne.needsUpdate,r=ne.type;de(),H.autoReset=e,ne.enabled=t,ne.autoUpdate=i,ne.needsUpdate=n,ne.type=r}function ge(e){const t=e.target;t.removeEventListener("dispose",ge),function(e){(function(e){const t=W.get(e).programs;void 0!==t&&(t.forEach((function(e){J.releaseProgram(e)})),e.isShaderMaterial&&J.releaseShaderCache(e))})(e),W.remove(e)}(t)}this.xr=pe,this.getContext=function(){return ue},this.getContextAttributes=function(){return ue.getContextAttributes()},this.forceContextLoss=function(){const e=V.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=V.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(e){void 0!==e&&(I=e,this.setSize(E,M,!1))},this.getSize=function(e){return e.set(E,M)},this.setSize=function(e,i,n){pe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(E=e,M=i,t.width=Math.floor(e*I),t.height=Math.floor(i*I),!1!==n&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return e.set(E*I,M*I).floor()},this.setDrawingBufferSize=function(e,i,n){E=e,M=i,I=n,t.width=Math.floor(e*n),t.height=Math.floor(i*n),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return e.copy(w)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,i,n){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,i,n),G.viewport(w.copy(P).multiplyScalar(I).floor())},this.getScissor=function(e){return e.copy(k)},this.setScissor=function(e,t,i,n){e.isVector4?k.set(e.x,e.y,e.z,e.w):k.set(e,t,i,n),G.scissor(S.copy(k).multiplyScalar(I).floor())},this.getScissorTest=function(){return R},this.setScissorTest=function(e){G.setScissorTest(R=e)},this.setOpaqueSort=function(e){A=e},this.setTransparentSort=function(e){C=e},this.getClearColor=function(e){return e.copy(re.getClearColor())},this.setClearColor=function(){re.setClearColor.apply(re,arguments)},this.getClearAlpha=function(){return re.getClearAlpha()},this.setClearAlpha=function(){re.setClearAlpha.apply(re,arguments)},this.clear=function(e,t,i){let n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===i||i)&&(n|=1024),ue.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",fe,!1),t.removeEventListener("webglcontextrestored",me,!1),ee.dispose(),te.dispose(),W.dispose(),$.dispose(),Z.dispose(),K.dispose(),ce.dispose(),J.dispose(),pe.dispose(),pe.removeEventListener("sessionstart",ye),pe.removeEventListener("sessionend",ve),N&&(N.dispose(),N=null),xe.stop()},this.renderBufferDirect=function(e,t,i,n,r,s){null===t&&(t=B);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=function(e,t,i,n,r){!0!==t.isScene&&(t=B),q.resetTextureUnits();const s=t.fog,o=n.isMeshStandardMaterial?t.environment:null,a=null===v?m.outputEncoding:!0===v.isXRRenderTarget?v.texture.encoding:eR,l=(n.isMeshStandardMaterial?Z:$).get(n.envMap||o),c=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,u=!!n.normalMap&&!!i.attributes.tangent,h=!!i.morphAttributes.position,p=!!i.morphAttributes.normal,f=i.morphAttributes.position?i.morphAttributes.position.length:0,g=n.toneMapped?m.toneMapping:RP,_=W.get(n),y=d.state.lights;if(!0===D&&(!0===O||e!==b)){const t=e===b&&n.id===x;ie.setState(n,e,t)}let w=!1;n.version===_.__version?_.needsLights&&_.lightsStateVersion!==y.state.version||_.outputEncoding!==a||r.isInstancedMesh&&!1===_.instancing?w=!0:r.isInstancedMesh||!0!==_.instancing?r.isSkinnedMesh&&!1===_.skinning?w=!0:r.isSkinnedMesh||!0!==_.skinning?_.envMap!==l||n.fog&&_.fog!==s?w=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===ie.numPlanes&&_.numIntersection===ie.numIntersection?(_.vertexAlphas!==c||_.vertexTangents!==u||_.morphTargets!==h||_.morphNormals!==p||_.toneMapping!==g||!0===j.isWebGL2&&_.morphTargetsCount!==f)&&(w=!0):w=!0:w=!0:w=!0:(w=!0,_.__version=n.version);let S=_.currentProgram;!0===w&&(S=Ee(n,t,r));let T=!1,E=!1,A=!1;const C=S.getUniforms(),P=_.uniforms;if(G.useProgram(S.program)&&(T=!0,E=!0,A=!0),n.id!==x&&(x=n.id,E=!0),T||b!==e){if(C.setValue(ue,"projectionMatrix",e.projectionMatrix),j.logarithmicDepthBuffer&&C.setValue(ue,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),b!==e&&(b=e,E=!0,A=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=C.map.cameraPosition;void 0!==t&&t.setValue(ue,F.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&C.setValue(ue,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&C.setValue(ue,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){C.setOptional(ue,r,"bindMatrix"),C.setOptional(ue,r,"bindMatrixInverse");const e=r.skeleton;e&&(j.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),C.setValue(ue,"boneTexture",e.boneTexture,q),C.setValue(ue,"boneTextureSize",e.boneTextureSize)):C.setOptional(ue,e,"boneMatrices"))}var k,R;return!i||void 0===i.morphAttributes.position&&void 0===i.morphAttributes.normal||se.update(r,i,n,S),(E||_.receiveShadow!==r.receiveShadow)&&(_.receiveShadow=r.receiveShadow,C.setValue(ue,"receiveShadow",r.receiveShadow)),E&&(C.setValue(ue,"toneMappingExposure",m.toneMappingExposure),_.needsLights&&(R=A,(k=P).ambientLightColor.needsUpdate=R,k.lightProbe.needsUpdate=R,k.directionalLights.needsUpdate=R,k.directionalLightShadows.needsUpdate=R,k.pointLights.needsUpdate=R,k.pointLightShadows.needsUpdate=R,k.spotLights.needsUpdate=R,k.spotLightShadows.needsUpdate=R,k.rectAreaLights.needsUpdate=R,k.hemisphereLights.needsUpdate=R),s&&n.fog&&Q.refreshFogUniforms(P,s),Q.refreshMaterialUniforms(P,n,I,M,N),qN.upload(ue,_.uniformsList,P,q)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(qN.upload(ue,_.uniformsList,P,q),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&C.setValue(ue,"center",r.center),C.setValue(ue,"modelViewMatrix",r.modelViewMatrix),C.setValue(ue,"normalMatrix",r.normalMatrix),C.setValue(ue,"modelMatrix",r.matrixWorld),S}(e,t,i,n,r);G.setMaterial(n,o);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===n.wireframe&&(l=Y.getWireframeAttribute(i),h=2),ce.setup(r,n,a,i,l);let p=oe;null!==l&&(u=X.get(l),p=ae,p.setIndex(u));const f=null!==l?l.count:c.count,g=i.drawRange.start*h,_=i.drawRange.count*h,y=null!==s?s.start*h:0,w=null!==s?s.count*h:1/0,S=Math.max(g,y),T=Math.min(f,g+_,y+w)-1,E=Math.max(0,T-S+1);if(0!==E){if(r.isMesh)!0===n.wireframe?(G.setLineWidth(n.wireframeLinewidth*U()),p.setMode(1)):p.setMode(4);else if(r.isLine){let e=n.linewidth;void 0===e&&(e=1),G.setLineWidth(e*U()),r.isLineSegments?p.setMode(1):r.isLineLoop?p.setMode(2):p.setMode(3)}else r.isPoints?p.setMode(0):r.isSprite&&p.setMode(4);if(r.isInstancedMesh)p.renderInstances(S,E,r.count);else if(i.isInstancedBufferGeometry){const e=Math.min(i.instanceCount,i._maxInstanceCount);p.renderInstances(S,E,e)}else p.render(S,E)}},this.compile=function(e,t){d=te.get(e),d.init(),f.push(d),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(m.physicallyCorrectLights),e.traverse((function(t){const i=t.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++)Ee(i[n],e,t);else Ee(i,e,t)})),f.pop(),d=null};let _e=null;function ye(){xe.stop()}function ve(){xe.start()}const xe=new QD;function be(e,t,i,n){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||L.intersectsSprite(e)){n&&F.setFromMatrixPosition(e.matrixWorld).applyMatrix4(z);const t=K.update(e),r=e.material;r.visible&&h.push(e,t,r,i,F.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==H.render.frame&&(e.skeleton.update(),e.skeleton.frame=H.render.frame),!e.frustumCulled||L.intersectsObject(e))){n&&F.setFromMatrixPosition(e.matrixWorld).applyMatrix4(z);const t=K.update(e),r=e.material;if(Array.isArray(r)){const n=t.groups;for(let s=0,o=n.length;s<o;s++){const o=n[s],a=r[o.materialIndex];a&&a.visible&&h.push(e,t,a,i,F.z,o)}}else r.visible&&h.push(e,t,r,i,F.z,null)}const r=e.children;for(let e=0,s=r.length;e<s;e++)be(r[e],t,i,n)}function we(e,t,i,n){const r=e.opaque,s=e.transmissive,a=e.transparent;d.setupLightsView(i),s.length>0&&function(e,t,i){if(null===N){const e=!0===o&&!0===j.isWebGL2;N=new(e?zR:NR)(1024,1024,{generateMipmaps:!0,type:null!==le.convert(ok)?ok:QP,minFilter:JP,magFilter:$P,wrapS:WP,wrapT:WP,useRenderToTexture:V.has("WEBGL_multisampled_render_to_texture")})}const n=m.getRenderTarget();m.setRenderTarget(N),m.clear();const r=m.toneMapping;m.toneMapping=RP,Se(e,t,i),m.toneMapping=r,q.updateMultisampleRenderTarget(N),q.updateRenderTargetMipmap(N),m.setRenderTarget(n)}(r,t,i),n&&G.viewport(w.copy(n)),r.length>0&&Se(r,t,i),s.length>0&&Se(s,t,i),a.length>0&&Se(a,t,i)}function Se(e,t,i){const n=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],o=s.object,a=s.geometry,l=null===n?s.material:n,c=s.group;o.layers.test(i.layers)&&Te(o,t,i,a,l,c)}}function Te(e,t,i,n,r,s){e.onBeforeRender(m,t,i,n,r,s),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(m,t,i,n,e,s),!0===r.transparent&&r.side===JC?(r.side=KC,r.needsUpdate=!0,m.renderBufferDirect(i,t,n,r,e,s),r.side=YC,r.needsUpdate=!0,m.renderBufferDirect(i,t,n,r,e,s),r.side=JC):m.renderBufferDirect(i,t,n,r,e,s),e.onAfterRender(m,t,i,n,r,s)}function Ee(e,t,i){!0!==t.isScene&&(t=B);const n=W.get(e),r=d.state.lights,s=d.state.shadowsArray,o=r.state.version,a=J.getParameters(e,r.state,s,t,i),l=J.getProgramCacheKey(a);let c=n.programs;n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=(e.isMeshStandardMaterial?Z:$).get(e.envMap||n.environment),void 0===c&&(e.addEventListener("dispose",ge),c=new Map,n.programs=c);let u=c.get(l);if(void 0!==u){if(n.currentProgram===u&&n.lightsStateVersion===o)return Me(e,a),u}else a.uniforms=J.getUniforms(e),e.onBuild(i,a,m),e.onBeforeCompile(a,m),u=J.acquireProgram(a,l),c.set(l,u),n.uniforms=a.uniforms;const h=n.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ie.uniform),Me(e,a),n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=o,n.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotShadowMatrix.value=r.state.spotShadowMatrix,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=u.getUniforms(),f=qN.seqWithValue(p.seq,h);return n.currentProgram=u,n.uniformsList=f,u}function Me(e,t){const i=W.get(e);i.outputEncoding=t.outputEncoding,i.instancing=t.instancing,i.skinning=t.skinning,i.morphTargets=t.morphTargets,i.morphNormals=t.morphNormals,i.morphTargetsCount=t.morphTargetsCount,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas,i.vertexTangents=t.vertexTangents,i.toneMapping=t.toneMapping}xe.setAnimationLoop((function(e){_e&&_e(e)})),"undefined"!=typeof window&&xe.setContext(window),this.setAnimationLoop=function(e){_e=e,pe.setAnimationLoop(e),null===e?xe.stop():xe.start()},pe.addEventListener("sessionstart",ye),pe.addEventListener("sessionend",ve),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===pe.enabled&&!0===pe.isPresenting&&(!0===pe.cameraAutoUpdate&&pe.updateCamera(t),t=pe.getCamera()),!0===e.isScene&&e.onBeforeRender(m,e,t,v),d=te.get(e,f.length),d.init(),f.push(d),z.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),L.setFromProjectionMatrix(z),O=this.localClippingEnabled,D=ie.init(this.clippingPlanes,O,t),h=ee.get(e,p.length),h.init(),p.push(h),be(e,t,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(A,C),!0===D&&ie.beginShadows();const i=d.state.shadowsArray;if(ne.render(i,e,t),!0===D&&ie.endShadows(),!0===this.info.autoReset&&this.info.reset(),re.render(h,e),d.setupLights(m.physicallyCorrectLights),t.isArrayCamera){const i=t.cameras;for(let t=0,n=i.length;t<n;t++){const n=i[t];we(h,e,n,n.viewport)}}else we(h,e,t);null!==v&&(q.updateMultisampleRenderTarget(v),q.updateRenderTargetMipmap(v)),!0===e.isScene&&e.onAfterRender(m,e,t),G.buffers.depth.setTest(!0),G.buffers.depth.setMask(!0),G.buffers.color.setMask(!0),G.setPolygonOffset(!1),ce.resetDefaultState(),x=-1,b=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),h=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return v},this.setRenderTargetTextures=function(e,t,i){W.get(e.texture).__webglTexture=t,W.get(e.depthTexture).__webglTexture=i;const n=W.get(e);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||e.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),e.useRenderToTexture=!1,e.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(e,t){const i=W.get(e);i.__webglFramebuffer=t,i.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,i=0){v=e,_=t,y=i;let n=!0;if(e){const t=W.get(e);void 0!==t.__useDefaultFramebuffer?(G.bindFramebuffer(36160,null),n=!1):void 0===t.__webglFramebuffer?q.setupRenderTarget(e):t.__hasExternalTextures&&q.rebindTextures(e,W.get(e.texture).__webglTexture,W.get(e.depthTexture).__webglTexture)}let r=null,s=!1,o=!1;if(e){const i=e.texture;(i.isDataTexture3D||i.isDataTexture2DArray)&&(o=!0);const n=W.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=n[t],s=!0):r=e.useRenderbuffer?W.get(e).__webglMultisampledFramebuffer:n,w.copy(e.viewport),S.copy(e.scissor),T=e.scissorTest}else w.copy(P).multiplyScalar(I).floor(),S.copy(k).multiplyScalar(I).floor(),T=R;if(G.bindFramebuffer(36160,r)&&j.drawBuffers&&n&&G.drawBuffers(e,r),G.viewport(w),G.scissor(S),G.setScissorTest(T),s){const n=W.get(e.texture);ue.framebufferTexture2D(36160,36064,34069+t,n.__webglTexture,i)}else if(o){const n=W.get(e.texture),r=t||0;ue.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,r)}x=-1},this.readRenderTargetPixels=function(e,t,i,n,r,s,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=W.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){G.bindFramebuffer(36160,a);try{const o=e.texture,a=o.format,l=o.type;if(a!==dk&&le.convert(a)!==ue.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===ok&&(V.has("EXT_color_buffer_half_float")||j.isWebGL2&&V.has("EXT_color_buffer_float"));if(!(l===QP||le.convert(l)===ue.getParameter(35738)||l===sk&&(j.isWebGL2||V.has("OES_texture_float")||V.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ue.checkFramebufferStatus(36160)?t>=0&&t<=e.width-n&&i>=0&&i<=e.height-r&&ue.readPixels(t,i,n,r,le.convert(a),le.convert(l),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==v?W.get(v).__webglFramebuffer:null;G.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,i=0){if(!0!==t.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const n=Math.pow(2,-i),r=Math.floor(t.image.width*n),s=Math.floor(t.image.height*n);q.setTexture2D(t,0),ue.copyTexSubImage2D(3553,i,0,0,e.x,e.y,r,s),G.unbindTexture()},this.copyTextureToTexture=function(e,t,i,n=0){const r=t.image.width,s=t.image.height,o=le.convert(i.format),a=le.convert(i.type);q.setTexture2D(i,0),ue.pixelStorei(37440,i.flipY),ue.pixelStorei(37441,i.premultiplyAlpha),ue.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?ue.texSubImage2D(3553,n,e.x,e.y,r,s,o,a,t.image.data):t.isCompressedTexture?ue.compressedTexSubImage2D(3553,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ue.texSubImage2D(3553,n,e.x,e.y,o,a,t.image),0===n&&i.generateMipmaps&&ue.generateMipmap(3553),G.unbindTexture()},this.copyTextureToTexture3D=function(e,t,i,n,r=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,a=e.max.z-e.min.z+1,l=le.convert(n.format),c=le.convert(n.type);let u;if(n.isDataTexture3D)q.setTexture3D(n,0),u=32879;else{if(!n.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");q.setTexture2DArray(n,0),u=35866}ue.pixelStorei(37440,n.flipY),ue.pixelStorei(37441,n.premultiplyAlpha),ue.pixelStorei(3317,n.unpackAlignment);const h=ue.getParameter(3314),d=ue.getParameter(32878),p=ue.getParameter(3316),f=ue.getParameter(3315),g=ue.getParameter(32877),_=i.isCompressedTexture?i.mipmaps[0]:i.image;ue.pixelStorei(3314,_.width),ue.pixelStorei(32878,_.height),ue.pixelStorei(3316,e.min.x),ue.pixelStorei(3315,e.min.y),ue.pixelStorei(32877,e.min.z),i.isDataTexture||i.isDataTexture3D?ue.texSubImage3D(u,r,t.x,t.y,t.z,s,o,a,l,c,_.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ue.compressedTexSubImage3D(u,r,t.x,t.y,t.z,s,o,a,l,_.data)):ue.texSubImage3D(u,r,t.x,t.y,t.z,s,o,a,l,c,_),ue.pixelStorei(3314,h),ue.pixelStorei(32878,d),ue.pixelStorei(3316,p),ue.pixelStorei(3315,f),ue.pixelStorei(32877,g),0===r&&n.generateMipmaps&&ue.generateMipmap(u),G.unbindTexture()},this.initTexture=function(e){q.setTexture2D(e,0),G.unbindTexture()},this.resetState=function(){_=0,y=0,v=null,G.reset(),ce.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Vz.prototype.isWebGLRenderer=!0,class extends Vz{}.prototype.isWebGL1Renderer=!0;class jz extends VL{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}jz.prototype.isScene=!0;class Gz{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=oR,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=fR()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=fR()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=fR()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Gz.prototype.isInterleavedBuffer=!0;const Hz=new BR;class Wz{constructor(e,t,i,n=!1){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Hz.x=this.getX(t),Hz.y=this.getY(t),Hz.z=this.getZ(t),Hz.applyMatrix4(e),this.setXYZ(t,Hz.x,Hz.y,Hz.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Hz.x=this.getX(t),Hz.y=this.getY(t),Hz.z=this.getZ(t),Hz.applyNormalMatrix(e),this.setXYZ(t,Hz.x,Hz.y,Hz.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Hz.x=this.getX(t),Hz.y=this.getY(t),Hz.z=this.getZ(t),Hz.transformDirection(e),this.setXYZ(t,Hz.x,Hz.y,Hz.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new rD(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Wz(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Wz.prototype.isInterleavedBufferAttribute=!0;class qz extends eD{constructor(e){super(),this.type="SpriteMaterial",this.color=new CR(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let $z;qz.prototype.isSpriteMaterial=!0;const Zz=new BR,Xz=new BR,Yz=new BR,Kz=new vR,Jz=new vR,Qz=new gL,eF=new BR,tF=new BR,iF=new BR,nF=new vR,rF=new vR,sF=new vR;function oF(e,t,i,n,r,s){Kz.subVectors(e,i).addScalar(.5).multiply(n),void 0!==r?(Jz.x=s*Kz.x-r*Kz.y,Jz.y=r*Kz.x+s*Kz.y):Jz.copy(Kz),e.copy(t),e.x+=Jz.x,e.y+=Jz.y,e.applyMatrix4(Qz)}(class extends VL{constructor(e){if(super(),this.type="Sprite",void 0===$z){$z=new mD;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Gz(e,5);$z.setIndex([0,1,2,0,2,3]),$z.setAttribute("position",new Wz(t,3,0,!1)),$z.setAttribute("uv",new Wz(t,2,3,!1))}this.geometry=$z,this.material=void 0!==e?e:new qz,this.center=new vR(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Xz.setFromMatrixScale(this.matrixWorld),Qz.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Yz.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Xz.multiplyScalar(-Yz.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;oF(eF.set(-.5,-.5,0),Yz,s,Xz,n,r),oF(tF.set(.5,-.5,0),Yz,s,Xz,n,r),oF(iF.set(.5,.5,0),Yz,s,Xz,n,r),nF.set(0,0),rF.set(1,0),sF.set(1,1);let o=e.ray.intersectTriangle(eF,tF,iF,!1,Zz);if(null===o&&(oF(tF.set(-.5,.5,0),Yz,s,Xz,n,r),rF.set(0,1),o=e.ray.intersectTriangle(eF,iF,tF,!1,Zz),null===o))return;const a=e.ray.origin.distanceTo(Zz);a<e.near||a>e.far||t.push({distance:a,point:Zz.clone(),uv:JL.getUV(Zz,eF,tF,iF,nF,rF,sF,new vR),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}).prototype.isSprite=!0;const aF=new BR,lF=new OR,cF=new OR,uF=new BR,hF=new gL;class dF extends LD{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new gL,this.bindMatrixInverse=new gL}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new OR,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,n=this.geometry;lF.fromBufferAttribute(n.attributes.skinIndex,e),cF.fromBufferAttribute(n.attributes.skinWeight,e),aF.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const n=cF.getComponent(e);if(0!==n){const r=lF.getComponent(e);hF.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),t.addScaledVector(uF.copy(aF).applyMatrix4(hF),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}dF.prototype.isSkinnedMesh=!0,class extends VL{constructor(){super(),this.type="Bone"}}.prototype.isBone=!0,class extends LR{constructor(e=null,t=1,i=1,n,r,s,o,a,l=$P,c=$P,u,h){super(null,s,o,a,l,c,n,r,u,h),this.image={data:e,width:t,height:i},this.magFilter=l,this.minFilter=c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}.prototype.isDataTexture=!0;class pF extends rD{constructor(e,t,i,n=1){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,i),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}pF.prototype.isInstancedBufferAttribute=!0;const fF=new gL,mF=new gL,gF=[],_F=new LD;class yF extends LD{constructor(e,t,i){super(e,t),this.instanceMatrix=new pF(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const i=this.matrixWorld,n=this.count;if(_F.geometry=this.geometry,_F.material=this.material,void 0!==_F.material)for(let r=0;r<n;r++){this.getMatrixAt(r,fF),mF.multiplyMatrices(i,fF),_F.matrixWorld=mF,_F.raycast(e,gF);for(let e=0,i=gF.length;e<i;e++){const i=gF[e];i.instanceId=r,i.object=this,t.push(i)}gF.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new pF(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}yF.prototype.isInstancedMesh=!0;class vF extends eD{constructor(e){super(),this.type="LineBasicMaterial",this.color=new CR(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}vF.prototype.isLineBasicMaterial=!0;const xF=new BR,bF=new BR,wF=new gL,SF=new mL,TF=new aL;class EF extends VL{constructor(e=new mD,t=new vF){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)xF.fromBufferAttribute(t,e-1),bF.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=xF.distanceTo(bF);e.setAttribute("lineDistance",new aD(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),TF.copy(i.boundingSphere),TF.applyMatrix4(n),TF.radius+=r,!1===e.ray.intersectsSphere(TF))return;wF.copy(n).invert(),SF.copy(e.ray).applyMatrix4(wF);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new BR,c=new BR,u=new BR,h=new BR,d=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position;if(null!==n)for(let i=Math.max(0,s.start),o=Math.min(n.count,s.start+s.count)-1;i<o;i+=d){const s=n.getX(i),o=n.getX(i+1);if(l.fromBufferAttribute(r,s),c.fromBufferAttribute(r,o),SF.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(h);d<e.near||d>e.far||t.push({distance:d,point:u.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}else for(let i=Math.max(0,s.start),n=Math.min(r.count,s.start+s.count)-1;i<n;i+=d){if(l.fromBufferAttribute(r,i),c.fromBufferAttribute(r,i+1),SF.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const n=e.ray.origin.distanceTo(h);n<e.near||n>e.far||t.push({distance:n,point:u.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}EF.prototype.isLine=!0;const MF=new BR,IF=new BR;class AF extends EF{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[];for(let e=0,n=t.count;e<n;e+=2)MF.fromBufferAttribute(t,e),IF.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+MF.distanceTo(IF);e.setAttribute("lineDistance",new aD(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}AF.prototype.isLineSegments=!0,class extends EF{constructor(e,t){super(e,t),this.type="LineLoop"}}.prototype.isLineLoop=!0;class CF extends eD{constructor(e){super(),this.type="PointsMaterial",this.color=new CR(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}CF.prototype.isPointsMaterial=!0;const PF=new gL,kF=new mL,RF=new aL,LF=new BR;function DF(e,t,i,n,r,s,o){const a=kF.distanceSqToPoint(e);if(a<i){const i=new BR;kF.closestPointToPoint(e,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:i,index:t,face:null,object:o})}}(class extends VL{constructor(e=new mD,t=new CF){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),RF.copy(i.boundingSphere),RF.applyMatrix4(n),RF.radius+=r,!1===e.ray.intersectsSphere(RF))return;PF.copy(n).invert(),kF.copy(e.ray).applyMatrix4(PF);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(i.isBufferGeometry){const r=i.index,o=i.attributes.position;if(null!==r)for(let i=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);i<l;i++){const s=r.getX(i);LF.fromBufferAttribute(o,s),DF(LF,s,a,n,e,t,this)}else for(let i=Math.max(0,s.start),r=Math.min(o.count,s.start+s.count);i<r;i++)LF.fromBufferAttribute(o,i),DF(LF,i,a,n,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}).prototype.isPoints=!0,class extends LR{constructor(e,t,i,n,r,s,o,a,l){super(e,t,i,n,r,s,o,a,l),this.minFilter=void 0!==s?s:YP,this.magFilter=void 0!==r?r:YP,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}.prototype.isVideoTexture=!0,class extends LR{constructor(e,t,i){super({width:e,height:t}),this.format=i,this.magFilter=$P,this.minFilter=$P,this.generateMipmaps=!1,this.needsUpdate=!0}}.prototype.isFramebufferTexture=!0,class extends LR{constructor(e,t,i,n,r,s,o,a,l,c,u,h){super(null,s,o,a,l,c,n,r,u,h),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}.prototype.isCompressedTexture=!0,class extends LR{constructor(e,t,i,n,r,s,o,a,l){super(e,t,i,n,r,s,o,a,l),this.needsUpdate=!0}}.prototype.isCanvasTexture=!0,new BR,new BR,new BR,new JL;class OF{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),r+=i.distanceTo(n),t.push(r),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let n=0;const r=i.length;let s;s=t||e*i[r-1];let o,a=0,l=r-1;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),o=i[n]-s,o<0)a=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(n=l,i[n]===s)return n/(r-1);const c=i[n];return(n+(s-c)/(i[n+1]-c))/(r-1)}getTangent(e,t){const i=1e-4;let n=e-i,r=e+i;n<0&&(n=0),r>1&&(r=1);const s=this.getPoint(n),o=this.getPoint(r),a=t||(s.isVector2?new vR:new BR);return a.copy(o).sub(s).normalize(),a}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new BR,n=[],r=[],s=[],o=new BR,a=new gL;for(let t=0;t<=e;t++){const i=t/e;n[t]=this.getTangentAt(i,new BR)}r[0]=new BR,s[0]=new BR;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),u=Math.abs(n[0].y),h=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),u<=l&&(l=u,i.set(0,1,0)),h<=l&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],o),s[0].crossVectors(n[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),s[t]=s[t-1].clone(),o.crossVectors(n[t-1],n[t]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(mR(n[t-1].dot(n[t]),-1,1));r[t].applyMatrix4(a.makeRotationAxis(o,e))}s[t].crossVectors(n[t],r[t])}if(!0===t){let t=Math.acos(mR(r[0].dot(r[e]),-1,1));t/=e,n[0].dot(o.crossVectors(r[0],r[e]))>0&&(t=-t);for(let i=1;i<=e;i++)r[i].applyMatrix4(a.makeRotationAxis(n[i],t*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class NF extends OF{constructor(e=0,t=0,i=1,n=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(e,t){const i=t||new vR,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const o=this.aStartAngle+e*r;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=a-this.aX,n=l-this.aY;a=i*e-n*t+this.aX,l=i*t+n*e+this.aY}return i.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}NF.prototype.isEllipseCurve=!0;class zF extends NF{constructor(e,t,i,n,r,s){super(e,t,i,i,n,r,s),this.type="ArcCurve"}}function FF(){let e=0,t=0,i=0,n=0;function r(r,s,o,a){e=r,t=o,i=-3*r+3*s-2*o-a,n=2*r-2*s+o+a}return{initCatmullRom:function(e,t,i,n,s){r(t,i,s*(i-e),s*(n-t))},initNonuniformCatmullRom:function(e,t,i,n,s,o,a){let l=(t-e)/s-(i-e)/(s+o)+(i-t)/o,c=(i-t)/o-(n-t)/(o+a)+(n-i)/a;l*=o,c*=o,r(t,i,l,c)},calc:function(r){const s=r*r;return e+t*r+i*s+n*(s*r)}}}zF.prototype.isArcCurve=!0;const BF=new BR,UF=new FF,VF=new FF,jF=new FF;class GF extends OF{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new BR){const i=t,n=this.points,r=n.length,s=(r-(this.closed?0:1))*e;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?o=n[(l-1)%r]:(BF.subVectors(n[0],n[1]).add(n[0]),o=BF);const u=n[l%r],h=n[(l+1)%r];if(this.closed||l+2<r?a=n[(l+2)%r]:(BF.subVectors(n[r-1],n[r-2]).add(n[r-1]),a=BF),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(u),e),i=Math.pow(u.distanceToSquared(h),e),n=Math.pow(h.distanceToSquared(a),e);i<1e-4&&(i=1),t<1e-4&&(t=i),n<1e-4&&(n=i),UF.initNonuniformCatmullRom(o.x,u.x,h.x,a.x,t,i,n),VF.initNonuniformCatmullRom(o.y,u.y,h.y,a.y,t,i,n),jF.initNonuniformCatmullRom(o.z,u.z,h.z,a.z,t,i,n)}else"catmullrom"===this.curveType&&(UF.initCatmullRom(o.x,u.x,h.x,a.x,this.tension),VF.initCatmullRom(o.y,u.y,h.y,a.y,this.tension),jF.initCatmullRom(o.z,u.z,h.z,a.z,this.tension));return i.set(UF.calc(c),VF.calc(c),jF.calc(c)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new BR).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function HF(e,t,i,n,r){const s=.5*(n-t),o=.5*(r-i),a=e*e;return(2*i-2*n+s+o)*(e*a)+(-3*i+3*n-2*s-o)*a+s*e+i}function WF(e,t,i,n){return function(e,t){const i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,n)}function qF(e,t,i,n,r){return function(e,t){const i=1-e;return i*i*i*t}(e,t)+function(e,t){const i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,r)}GF.prototype.isCatmullRomCurve3=!0;class $F extends OF{constructor(e=new vR,t=new vR,i=new vR,n=new vR){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new vR){const i=t,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(qF(e,n.x,r.x,s.x,o.x),qF(e,n.y,r.y,s.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}$F.prototype.isCubicBezierCurve=!0;class ZF extends OF{constructor(e=new BR,t=new BR,i=new BR,n=new BR){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new BR){const i=t,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(qF(e,n.x,r.x,s.x,o.x),qF(e,n.y,r.y,s.y,o.y),qF(e,n.z,r.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}ZF.prototype.isCubicBezierCurve3=!0;class XF extends OF{constructor(e=new vR,t=new vR){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new vR){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new vR;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}XF.prototype.isLineCurve=!0;class YF extends OF{constructor(e=new vR,t=new vR,i=new vR){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new vR){const i=t,n=this.v0,r=this.v1,s=this.v2;return i.set(WF(e,n.x,r.x,s.x),WF(e,n.y,r.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}YF.prototype.isQuadraticBezierCurve=!0;class KF extends OF{constructor(e=new BR,t=new BR,i=new BR){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new BR){const i=t,n=this.v0,r=this.v1,s=this.v2;return i.set(WF(e,n.x,r.x,s.x),WF(e,n.y,r.y,s.y),WF(e,n.z,r.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}KF.prototype.isQuadraticBezierCurve3=!0;class JF extends OF{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new vR){const i=t,n=this.points,r=(n.length-1)*e,s=Math.floor(r),o=r-s,a=n[0===s?s:s-1],l=n[s],c=n[s>n.length-2?n.length-1:s+1],u=n[s>n.length-3?n.length-1:s+2];return i.set(HF(o,a.x,l.x,c.x,u.x),HF(o,a.y,l.y,c.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new vR).fromArray(i))}return this}}JF.prototype.isSplineCurve=!0;var QF=Object.freeze({__proto__:null,ArcCurve:zF,CatmullRomCurve3:GF,CubicBezierCurve:$F,CubicBezierCurve3:ZF,EllipseCurve:NF,LineCurve:XF,LineCurve3:class extends OF{constructor(e=new BR,t=new BR){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new BR){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:YF,QuadraticBezierCurve3:KF,SplineCurve:JF});class eB extends OF{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new XF(t,e))}getPoint(e,t){const i=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const e=n[r]-i,s=this.curves[r],o=s.getLength(),a=0===o?0:1-e/o;return s.getPointAt(a,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],o=s&&s.isEllipseCurve?2*e:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?e*s.points.length:e,a=s.getPoints(o);for(let e=0;e<a.length;e++){const n=a[e];i&&i.equals(n)||(t.push(n),i=n)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push((new QF[i.type]).fromJSON(i))}return this}}class tB extends eB{constructor(e){super(),this.type="Path",this.currentPoint=new vR,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new XF(this.currentPoint.clone(),new vR(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){const r=new YF(this.currentPoint.clone(),new vR(e,t),new vR(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,s){const o=new $F(this.currentPoint.clone(),new vR(e,t),new vR(i,n),new vR(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new JF(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+o,t+a,i,n,r,s),this}absarc(e,t,i,n,r,s){return this.absellipse(e,t,i,i,n,r,s),this}ellipse(e,t,i,n,r,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,n,r,s,o,a),this}absellipse(e,t,i,n,r,s,o,a){const l=new NF(e,t,i,n,r,s,o,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class iB extends tB{constructor(e){super(e),this.uuid=fR(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push((new tB).fromJSON(i))}return this}}function nB(e,t,i,n,r){let s,o;if(r===function(e,t,i,n){let r=0;for(let s=t,o=i-n;s<i;s+=n)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}(e,t,i,n)>0)for(s=t;s<i;s+=n)o=TB(s,e[s],e[s+1],o);else for(s=i-n;s>=t;s-=n)o=TB(s,e[s],e[s+1],o);return o&&yB(o,o.next)&&(EB(o),o=o.next),o}function rB(e,t){if(!e)return e;t||(t=e);let i,n=e;do{if(i=!1,n.steiner||!yB(n,n.next)&&0!==_B(n.prev,n,n.next))n=n.next;else{if(EB(n),n=t=n.prev,n===n.next)break;i=!0}}while(i||n!==t);return t}function sB(e,t,i,n,r,s,o){if(!e)return;!o&&s&&function(e,t,i,n){let r=e;do{null===r.z&&(r.z=pB(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,i,n,r,s,o,a,l,c=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ,n);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(o>1)}(r)}(e,n,r,s);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,s?aB(e,n,r,s):oB(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),EB(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?sB(e=lB(rB(e),t,i),t,i,n,r,s,2):2===o&&cB(e,t,i,n,r,s):sB(rB(e),t,i,n,r,s,1);break}}function oB(e){const t=e.prev,i=e,n=e.next;if(_B(t,i,n)>=0)return!1;let r=e.next.next;for(;r!==e.prev;){if(mB(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&_B(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function aB(e,t,i,n){const r=e.prev,s=e,o=e.next;if(_B(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,h=pB(a,l,t,i,n),d=pB(c,u,t,i,n);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&mB(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&_B(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&mB(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&_B(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&mB(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&_B(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&mB(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&_B(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function lB(e,t,i){let n=e;do{const r=n.prev,s=n.next.next;!yB(r,s)&&vB(r,n,n.next,s)&&wB(r,s)&&wB(s,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(s.i/i),EB(n),EB(n.next),n=e=s),n=n.next}while(n!==e);return rB(n)}function cB(e,t,i,n,r,s){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&gB(o,e)){let a=SB(o,e);return o=rB(o,o.next),a=rB(a,a.next),sB(o,t,i,n,r,s),void sB(a,t,i,n,r,s)}e=e.next}o=o.next}while(o!==e)}function uB(e,t){return e.x-t.x}function hB(e,t){if(t=function(e,t){let i=t;const n=e.x,r=e.y;let s,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const e=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=n&&e>o){if(o=e,e===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!s)return null;if(n===o)return s;const a=s,l=s.x,c=s.y;let u,h=1/0;i=s;do{n>=i.x&&i.x>=l&&n!==i.x&&mB(r<c?n:o,r,l,c,r<c?o:n,r,i.x,i.y)&&(u=Math.abs(r-i.y)/(n-i.x),wB(i,e)&&(u<h||u===h&&(i.x>s.x||i.x===s.x&&dB(s,i)))&&(s=i,h=u)),i=i.next}while(i!==a);return s}(e,t),t){const i=SB(t,e);rB(t,t.next),rB(i,i.next)}}function dB(e,t){return _B(e.prev,e,t.prev)<0&&_B(t.next,e,e.next)<0}function pB(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function fB(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function mB(e,t,i,n,r,s,o,a){return(r-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(n-a)-(i-o)*(t-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function gB(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&vB(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(wB(e,t)&&wB(t,e)&&function(e,t){let i=e,n=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(_B(e.prev,e,t.prev)||_B(e,t.prev,t))||yB(e,t)&&_B(e.prev,e,e.next)>0&&_B(t.prev,t,t.next)>0)}function _B(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function yB(e,t){return e.x===t.x&&e.y===t.y}function vB(e,t,i,n){const r=bB(_B(e,t,i)),s=bB(_B(e,t,n)),o=bB(_B(i,n,e)),a=bB(_B(i,n,t));return r!==s&&o!==a||!(0!==r||!xB(e,i,t))||!(0!==s||!xB(e,n,t))||!(0!==o||!xB(i,e,n))||!(0!==a||!xB(i,t,n))}function xB(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function bB(e){return e>0?1:e<0?-1:0}function wB(e,t){return _B(e.prev,e,e.next)<0?_B(e,t,e.next)>=0&&_B(e,e.prev,t)>=0:_B(e,t,e.prev)<0||_B(e,e.next,t)<0}function SB(e,t){const i=new MB(e.i,e.x,e.y),n=new MB(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function TB(e,t,i,n){const r=new MB(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function EB(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function MB(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class IB{static area(e){const t=e.length;let i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i}static isClockWise(e){return IB.area(e)<0}static triangulateShape(e,t){const i=[],n=[],r=[];AB(e),CB(i,e);let s=e.length;t.forEach(AB);for(let e=0;e<t.length;e++)n.push(s),s+=t[e].length,CB(i,t[e]);const o=function(e,t,i=2){const n=t&&t.length,r=n?t[0]*i:e.length;let s=nB(e,0,r,i,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,h,d,p;if(n&&(s=function(e,t,i,n){const r=[];let s,o,a,l,c;for(s=0,o=t.length;s<o;s++)a=t[s]*n,l=s<o-1?t[s+1]*n:e.length,c=nB(e,a,l,n,!1),c===c.next&&(c.steiner=!0),r.push(fB(c));for(r.sort(uB),s=0;s<r.length;s++)hB(r[s],i),i=rB(i,i.next);return i}(e,t,s,i)),e.length>80*i){a=c=e[0],l=u=e[1];for(let t=i;t<r;t+=i)h=e[t],d=e[t+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-a,u-l),p=0!==p?1/p:0}return sB(s,o,i,a,l,p),o}(i,n);for(let e=0;e<o.length;e+=3)r.push(o.slice(e,e+3));return r}}function AB(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function CB(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class PB extends mD{constructor(e=new iB([new vR(.5,.5),new vR(-.5,.5),new vR(-.5,-.5),new vR(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,n=[],r=[];for(let t=0,i=e.length;t<i;t++)s(e[t]);function s(e){const s=[],o=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:1,c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:u-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:kB;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let g,_,y,v,x,b=!1;f&&(g=f.getSpacedPoints(a),b=!0,c=!1,_=f.computeFrenetFrames(a,!1),y=new BR,v=new BR,x=new BR),c||(p=0,u=0,h=0,d=0);const w=e.extractPoints(o);let S=w.shape;const T=w.holes;if(!IB.isClockWise(S)){S=S.reverse();for(let e=0,t=T.length;e<t;e++){const t=T[e];IB.isClockWise(t)&&(T[e]=t.reverse())}}const E=IB.triangulateShape(S,T),M=S;for(let e=0,t=T.length;e<t;e++){const t=T[e];S=S.concat(t)}function I(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}const A=S.length,C=E.length;function P(e,t,i){let n,r,s;const o=e.x-t.x,a=e.y-t.y,l=i.x-e.x,c=i.y-e.y,u=o*o+a*a,h=o*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=t.x-a/h,f=t.y+o/h,m=((i.x-c/d-p)*c-(i.y+l/d-f)*l)/(o*c-a*l);n=p+o*m-e.x,r=f+a*m-e.y;const g=n*n+r*r;if(g<=2)return new vR(n,r);s=Math.sqrt(g/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(n=-a,r=o,s=Math.sqrt(u)):(n=o,r=a,s=Math.sqrt(u/2))}return new vR(n/s,r/s)}const k=[];for(let e=0,t=M.length,i=t-1,n=e+1;e<t;e++,i++,n++)i===t&&(i=0),n===t&&(n=0),k[e]=P(M[e],M[i],M[n]);const R=[];let L,D=k.concat();for(let e=0,t=T.length;e<t;e++){const t=T[e];L=[];for(let e=0,i=t.length,n=i-1,r=e+1;e<i;e++,n++,r++)n===i&&(n=0),r===i&&(r=0),L[e]=P(t[e],t[n],t[r]);R.push(L),D=D.concat(L)}for(let e=0;e<p;e++){const t=e/p,i=u*Math.cos(t*Math.PI/2),n=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=M.length;e<t;e++){const t=I(M[e],k[e],n);z(t.x,t.y,-i)}for(let e=0,t=T.length;e<t;e++){const t=T[e];L=R[e];for(let e=0,r=t.length;e<r;e++){const r=I(t[e],L[e],n);z(r.x,r.y,-i)}}}const O=h+d;for(let e=0;e<A;e++){const t=c?I(S[e],D[e],O):S[e];b?(v.copy(_.normals[0]).multiplyScalar(t.x),y.copy(_.binormals[0]).multiplyScalar(t.y),x.copy(g[0]).add(v).add(y),z(x.x,x.y,x.z)):z(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<A;t++){const i=c?I(S[t],D[t],O):S[t];b?(v.copy(_.normals[e]).multiplyScalar(i.x),y.copy(_.binormals[e]).multiplyScalar(i.y),x.copy(g[e]).add(v).add(y),z(x.x,x.y,x.z)):z(i.x,i.y,l/a*e)}for(let e=p-1;e>=0;e--){const t=e/p,i=u*Math.cos(t*Math.PI/2),n=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=M.length;e<t;e++){const t=I(M[e],k[e],n);z(t.x,t.y,l+i)}for(let e=0,t=T.length;e<t;e++){const t=T[e];L=R[e];for(let e=0,r=t.length;e<r;e++){const r=I(t[e],L[e],n);b?z(r.x,r.y+g[a-1].y,g[a-1].x+i):z(r.x,r.y,l+i)}}}function N(e,t){let i=e.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=e.length-1);for(let e=0,i=a+2*p;e<i;e++){const i=A*e,s=A*(e+1);B(t+n+i,t+r+i,t+r+s,t+n+s)}}}function z(e,t,i){s.push(e),s.push(t),s.push(i)}function F(e,t,r){U(e),U(t),U(r);const s=n.length/3,o=m.generateTopUV(i,n,s-3,s-2,s-1);V(o[0]),V(o[1]),V(o[2])}function B(e,t,r,s){U(e),U(t),U(s),U(t),U(r),U(s);const o=n.length/3,a=m.generateSideWallUV(i,n,o-6,o-3,o-2,o-1);V(a[0]),V(a[1]),V(a[3]),V(a[1]),V(a[2]),V(a[3])}function U(e){n.push(s[3*e+0]),n.push(s[3*e+1]),n.push(s[3*e+2])}function V(e){r.push(e.x),r.push(e.y)}!function(){const e=n.length/3;if(c){let e=0,t=A*e;for(let e=0;e<C;e++){const i=E[e];F(i[2]+t,i[1]+t,i[0]+t)}e=a+2*p,t=A*e;for(let e=0;e<C;e++){const i=E[e];F(i[0]+t,i[1]+t,i[2]+t)}}else{for(let e=0;e<C;e++){const t=E[e];F(t[2],t[1],t[0])}for(let e=0;e<C;e++){const t=E[e];F(t[0]+A*a,t[1]+A*a,t[2]+A*a)}}i.addGroup(e,n.length/3-e,0)}(),function(){const e=n.length/3;let t=0;N(M,t),t+=M.length;for(let e=0,i=T.length;e<i;e++){const i=T[e];N(i,t),t+=i.length}i.addGroup(e,n.length/3-e,1)}()}this.setAttribute("position",new aD(n,3)),this.setAttribute("uv",new aD(r,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,i){if(i.shapes=[],Array.isArray(e))for(let t=0,n=e.length;t<n;t++){const n=e[t];i.shapes.push(n.uuid)}else i.shapes.push(e.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const i=[];for(let n=0,r=e.shapes.length;n<r;n++){const r=t[e.shapes[n]];i.push(r)}const n=e.options.extrudePath;return void 0!==n&&(e.options.extrudePath=(new QF[n.type]).fromJSON(n)),new PB(i,e.options)}}const kB={generateTopUV:function(e,t,i,n,r){const s=t[3*i],o=t[3*i+1],a=t[3*n],l=t[3*n+1],c=t[3*r],u=t[3*r+1];return[new vR(s,o),new vR(a,l),new vR(c,u)]},generateSideWallUV:function(e,t,i,n,r,s){const o=t[3*i],a=t[3*i+1],l=t[3*i+2],c=t[3*n],u=t[3*n+1],h=t[3*n+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*s],g=t[3*s+1],_=t[3*s+2];return Math.abs(a-u)<Math.abs(o-c)?[new vR(o,1-l),new vR(c,1-h),new vR(d,1-f),new vR(m,1-_)]:[new vR(a,1-l),new vR(u,1-h),new vR(p,1-f),new vR(g,1-_)]}};class RB extends mD{constructor(e=new iB([new vR(0,.5),new vR(-.5,-.5),new vR(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],n=[],r=[],s=[];let o=0,a=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(o,a,t),o+=a,a=0;function l(e){const o=n.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===IB.isClockWise(c)&&(c=c.reverse());for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===IB.isClockWise(t)&&(u[e]=t.reverse())}const h=IB.triangulateShape(c,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];n.push(t.x,t.y,0),r.push(0,0,1),s.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],n=t[0]+o,r=t[1]+o,s=t[2]+o;i.push(n,r,s),a+=3}}this.setIndex(i),this.setAttribute("position",new aD(n,3)),this.setAttribute("normal",new aD(r,3)),this.setAttribute("uv",new aD(s,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,n=e.length;i<n;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const i=[];for(let n=0,r=e.shapes.length;n<r;n++){const r=t[e.shapes[n]];i.push(r)}return new RB(i,e.curveSegments)}}(class extends eD{constructor(e){super(),this.type="ShadowMaterial",this.color=new CR(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}).prototype.isShadowMaterial=!0;class LB extends eD{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new CR(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new CR(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nR,this.normalScale=new vR(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}LB.prototype.isMeshStandardMaterial=!0,class extends LB{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new vR(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return mR(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenColor=new CR(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new CR(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new CR(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}.prototype.isMeshPhysicalMaterial=!0,class extends eD{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new CR(16777215),this.specular=new CR(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new CR(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nR,this.normalScale=new vR(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=CP,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}.prototype.isMeshPhongMaterial=!0,class extends eD{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new CR(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new CR(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nR,this.normalScale=new vR(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}.prototype.isMeshToonMaterial=!0,class extends eD{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nR,this.normalScale=new vR(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}.prototype.isMeshNormalMaterial=!0;class DB extends eD{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new CR(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new CR(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=CP,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}DB.prototype.isMeshLambertMaterial=!0,class extends eD{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new CR(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nR,this.normalScale=new vR(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}.prototype.isMeshMatcapMaterial=!0,class extends vF{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}.prototype.isLineDashedMaterial=!0;const OB={arraySlice:function(e,t,i){return OB.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,i=new Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort((function(t,i){return e[t]-e[i]})),i},sortedArray:function(e,t,i){const n=e.length,r=new e.constructor(n);for(let s=0,o=0;o!==n;++s){const n=i[s]*t;for(let i=0;i!==t;++i)r[o++]=e[n+i]}return r},flattenJSON:function(e,t,i,n){let r=1,s=e[0];for(;void 0!==s&&void 0===s[n];)s=e[r++];if(void 0===s)return;let o=s[n];if(void 0!==o)if(Array.isArray(o))do{o=s[n],void 0!==o&&(t.push(s.time),i.push.apply(i,o)),s=e[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[n],void 0!==o&&(t.push(s.time),o.toArray(i,i.length)),s=e[r++]}while(void 0!==s);else do{o=s[n],void 0!==o&&(t.push(s.time),i.push(o)),s=e[r++]}while(void 0!==s)},subclip:function(e,t,i,n,r=30){const s=e.clone();s.name=t;const o=[];for(let e=0;e<s.tracks.length;++e){const t=s.tracks[e],a=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const s=t.times[e]*r;if(!(s<i||s>=n)){l.push(t.times[e]);for(let i=0;i<a;++i)c.push(t.values[e*a+i])}}0!==l.length&&(t.times=OB.convertArray(l,t.times.constructor),t.values=OB.convertArray(c,t.values.constructor),o.push(t))}s.tracks=o;let a=1/0;for(let e=0;e<s.tracks.length;++e)a>s.tracks[e].times[0]&&(a=s.tracks[e].times[0]);for(let e=0;e<s.tracks.length;++e)s.tracks[e].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(e,t=0,i=e,n=30){n<=0&&(n=30);const r=i.tracks.length,s=t/n;for(let t=0;t<r;++t){const n=i.tracks[t],r=n.ValueTypeName;if("bool"===r||"string"===r)continue;const o=e.tracks.find((function(e){return e.name===n.name&&e.ValueTypeName===r}));if(void 0===o)continue;let a=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=n.times.length-1;let d;if(s<=n.times[0]){const e=a,t=l-a;d=OB.arraySlice(n.values,e,t)}else if(s>=n.times[h]){const e=h*l+a,t=e+l-a;d=OB.arraySlice(n.values,e,t)}else{const e=n.createInterpolant(),t=a,i=l-a;e.evaluate(s),d=OB.arraySlice(e.resultBuffer,t,i)}"quaternion"===r&&(new FR).fromArray(d).normalize().conjugate().toArray(d);const p=o.times.length;for(let e=0;e<p;++e){const t=e*u+c;if("quaternion"===r)FR.multiplyQuaternionsFlat(o.values,t,d,0,o.values,t);else{const e=u-2*c;for(let i=0;i<e;++i)o.values[t+i]-=d[i]}}}return e.blendMode=2501,e}};class NB{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let s;i:{n:if(!(e<n)){for(let s=i+2;;){if(void 0===n){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,r)}if(i===s)break;if(r=n,n=t[++i],e<n)break t}s=t.length;break i}if(e>=r)break e;{const o=t[1];e<o&&(i=2,r=o);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(i===s)break;if(n=r,r=t[--i-1],e>=r)break t}s=i,i=0}}for(;i<s;){const n=i+s>>>1;e<t[n]?s=n:i=n+1}if(n=t[i],r=t[i-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,r,e)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let e=0;e!==n;++e)t[e]=i[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}NB.prototype.beforeStart_=NB.prototype.copySampleValue_,NB.prototype.afterEnd_=NB.prototype.copySampleValue_;class zB extends NB{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Kk,endingEnd:Kk}}intervalChanged_(e,t,i){const n=this.parameterPositions;let r=e-2,s=e+1,o=n[r],a=n[s];if(void 0===o)switch(this.getSettings_().endingStart){case Jk:r=e,o=2*t-i;break;case Qk:r=n.length-2,o=t+n[r]-n[r+1];break;default:r=e,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case Jk:s=e,a=2*i-t;break;case Qk:s=1,a=i+n[1]-n[0];break;default:s=e-1,a=t}const l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(a-i),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(i-t)/(n-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,_=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,v=d*m-d*f;for(let e=0;e!==o;++e)r[e]=g*s[c+e]+_*s[l+e]+y*s[a+e]+v*s[u+e];return r}}class FB extends NB{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=(i-t)/(n-t),u=1-c;for(let e=0;e!==o;++e)r[e]=s[l+e]*u+s[a+e]*c;return r}}class BB extends NB{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class UB{constructor(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=OB.convertArray(t,this.TimeBufferType),this.values=OB.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:OB.convertArray(e.times,Array),values:OB.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(i.interpolation=t)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new BB(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new FB(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new zB(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Zk:t=this.InterpolantFactoryMethodDiscrete;break;case Xk:t=this.InterpolantFactoryMethodLinear;break;case Yk:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Zk;case this.InterpolantFactoryMethodLinear:return Xk;case this.InterpolantFactoryMethodSmooth:return Yk}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<e;)++r;for(;-1!==s&&i[s]>t;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=OB.arraySlice(i,r,s),this.values=OB.arraySlice(this.values,r*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let t=0;t!==r;t++){const n=i[t];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,n),e=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,n,s),e=!1;break}s=n}if(void 0!==n&&OB.isTypedArray(n))for(let t=0,i=n.length;t!==i;++t){const i=n[t];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,i),e=!1;break}}return e}optimize(){const e=OB.arraySlice(this.times),t=OB.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===Yk,r=e.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=e[o];if(a!==e[o+1]&&(1!==o||a!==e[0]))if(n)r=!0;else{const e=o*i,n=e-i,s=e+i;for(let o=0;o!==i;++o){const i=t[e+o];if(i!==t[n+o]||i!==t[s+o]){r=!0;break}}}if(r){if(o!==s){e[s]=e[o];const n=o*i,r=s*i;for(let e=0;e!==i;++e)t[r+e]=t[n+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*i,n=s*i,o=0;o!==i;++o)t[n+o]=t[e+o];++s}return s!==e.length?(this.times=OB.arraySlice(e,0,s),this.values=OB.arraySlice(t,0,s*i)):(this.times=e,this.values=t),this}clone(){const e=OB.arraySlice(this.times,0),t=OB.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}UB.prototype.TimeBufferType=Float32Array,UB.prototype.ValueBufferType=Float32Array,UB.prototype.DefaultInterpolation=Xk;class VB extends UB{}VB.prototype.ValueTypeName="bool",VB.prototype.ValueBufferType=Array,VB.prototype.DefaultInterpolation=Zk,VB.prototype.InterpolantFactoryMethodLinear=void 0,VB.prototype.InterpolantFactoryMethodSmooth=void 0;class jB extends UB{}jB.prototype.ValueTypeName="color";class GB extends UB{}GB.prototype.ValueTypeName="number";class HB extends NB{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(i-t)/(n-t);let l=e*o;for(let e=l+o;l!==e;l+=4)FR.slerpFlat(r,0,s,l-o,s,l,a);return r}}class WB extends UB{InterpolantFactoryMethodLinear(e){return new HB(this.times,this.values,this.getValueSize(),e)}}WB.prototype.ValueTypeName="quaternion",WB.prototype.DefaultInterpolation=Xk,WB.prototype.InterpolantFactoryMethodSmooth=void 0;class qB extends UB{}qB.prototype.ValueTypeName="string",qB.prototype.ValueBufferType=Array,qB.prototype.DefaultInterpolation=Zk,qB.prototype.InterpolantFactoryMethodLinear=void 0,qB.prototype.InterpolantFactoryMethodSmooth=void 0;class $B extends UB{}$B.prototype.ValueTypeName="vector";class ZB{constructor(e,t=-1,i,n=2500){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=fR(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let e=0,r=i.length;e!==r;++e)t.push(XB(i[e]).scale(n));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,n=i.length;e!==n;++e)t.push(UB.toJSON(i[e]));return n}static CreateFromMorphTargetSequence(e,t,i,n){const r=t.length,s=[];for(let e=0;e<r;e++){let o=[],a=[];o.push((e+r-1)%r,e,(e+1)%r),a.push(0,1,0);const l=OB.getKeyframeOrder(o);o=OB.sortedArray(o,1,l),a=OB.sortedArray(a,1,l),n||0!==o[0]||(o.push(r),a.push(a[0])),s.push(new GB(".morphTargetInfluences["+t[e].name+"]",o,a).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,i=e.length;t<i;t++){const i=e[t],s=i.name.match(r);if(s&&s.length>1){const e=s[1];let t=n[e];t||(n[e]=t=[]),t.push(i)}}const s=[];for(const e in n)s.push(this.CreateFromMorphTargetSequence(e,n[e],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(e,t,i,n,r){if(0!==i.length){const s=[],o=[];OB.flattenJSON(i,s,o,n),0!==s.length&&r.push(new e(t,s,o))}},n=[],r=e.name||"default",s=e.fps||30,o=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const r=l[e].keys;if(r&&0!==r.length)if(r[0].morphTargets){const e={};let t;for(t=0;t<r.length;t++)if(r[t].morphTargets)for(let i=0;i<r[t].morphTargets.length;i++)e[r[t].morphTargets[i]]=-1;for(const i in e){const e=[],s=[];for(let n=0;n!==r[t].morphTargets.length;++n){const n=r[t];e.push(n.time),s.push(n.morphTarget===i?1:0)}n.push(new GB(".morphTargetInfluence["+i+"]",e,s))}a=e.length*(s||1)}else{const s=".bones["+t[e].name+"]";i($B,s+".position",r,"pos",n),i(WB,s+".quaternion",r,"rot",n),i($B,s+".scale",r,"scl",n)}}return 0===n.length?null:new this(r,a,n,o)}resetDuration(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){const i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function XB(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return GB;case"vector":case"vector2":case"vector3":case"vector4":return $B;case"color":return jB;case"quaternion":return WB;case"bool":case"boolean":return VB;case"string":return qB}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],i=[];OB.flattenJSON(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const YB={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},KB=new class{constructor(e,t,i){const n=this;let r,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===s&&void 0!==n.onStart&&n.onStart(e,o,a),s=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,a),o===a&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){const i=l[t],n=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null}}};class JB{constructor(e){this.manager=void 0!==e?e:KB,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise((function(n,r){i.load(e,n,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const QB={};class eU extends JB{constructor(e){super(e)}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=YB.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==QB[e])return void QB[e].push({onLoad:t,onProgress:i,onError:n});QB[e]=[],QB[e].push({onLoad:t,onProgress:i,onError:n});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body.getReader)return t;const i=QB[e],n=t.body.getReader(),r=t.headers.get("Content-Length"),s=r?parseInt(r):0,o=0!==s;let a=0;const l=new ReadableStream({start(e){!function t(){n.read().then((({done:n,value:r})=>{if(n)e.close();else{a+=r.byteLength;const n=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let e=0,t=i.length;e<t;e++){const t=i[e];t.onProgress&&t.onProgress(n)}e.enqueue(r),t()}}))}()}});return new Response(l)}throw Error(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`)})).then((e=>{switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,o)));case"json":return e.json();default:if(void 0===o)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(o),i=t&&t[1]?t[1].toLowerCase():void 0,n=new TextDecoder(i);return e.arrayBuffer().then((e=>n.decode(e)))}}})).then((t=>{YB.add(e,t);const i=QB[e];delete QB[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onLoad&&n.onLoad(t)}})).catch((t=>{const i=QB[e];if(void 0===i)throw this.manager.itemError(e),t;delete QB[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class tU extends JB{constructor(e){super(e)}load(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=YB.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const o=wR("img");function a(){c(),YB.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){c(),n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}class iU extends JB{constructor(e){super(e)}load(e,t,i,n){const r=new HD,s=new tU(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(i){s.load(e[i],(function(e){r.images[i]=e,o++,6===o&&(r.needsUpdate=!0,t&&t(r))}),void 0,n)}for(let t=0;t<e.length;++t)a(t);return r}}class nU extends JB{constructor(e){super(e)}load(e,t,i,n){const r=new LR,s=new tU(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),i,n),r}}class rU extends VL{constructor(e,t=1){super(),this.type="Light",this.color=new CR(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}rU.prototype.isLight=!0,class extends rU{constructor(e,t,i){super(e,i),this.type="HemisphereLight",this.position.copy(VL.DefaultUp),this.updateMatrix(),this.groundColor=new CR(t)}copy(e){return rU.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}.prototype.isHemisphereLight=!0;const sU=new gL,oU=new BR,aU=new BR;class lU{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new vR(512,512),this.map=null,this.mapPass=null,this.matrix=new gL,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new JD,this._frameExtents=new vR(1,1),this._viewportCount=1,this._viewports=[new OR(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;oU.setFromMatrixPosition(e.matrixWorld),t.position.copy(oU),aU.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(aU),t.updateMatrixWorld(),sU.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(sU),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class cU extends lU{constructor(){super(new VD(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,i=2*pR*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;i===t.fov&&n===t.aspect&&r===t.far||(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}cU.prototype.isSpotLightShadow=!0,class extends rU{constructor(e,t,i=0,n=Math.PI/3,r=0,s=1){super(e,t),this.type="SpotLight",this.position.copy(VL.DefaultUp),this.updateMatrix(),this.target=new VL,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.shadow=new cU}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}.prototype.isSpotLight=!0;const uU=new gL,hU=new BR,dU=new BR;class pU extends lU{constructor(){super(new VD(90,1,.5,500)),this._frameExtents=new vR(4,2),this._viewportCount=6,this._viewports=[new OR(2,1,1,1),new OR(0,1,1,1),new OR(3,1,1,1),new OR(1,1,1,1),new OR(3,0,1,1),new OR(1,0,1,1)],this._cubeDirections=[new BR(1,0,0),new BR(-1,0,0),new BR(0,0,1),new BR(0,0,-1),new BR(0,1,0),new BR(0,-1,0)],this._cubeUps=[new BR(0,1,0),new BR(0,1,0),new BR(0,1,0),new BR(0,1,0),new BR(0,0,1),new BR(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),hU.setFromMatrixPosition(e.matrixWorld),i.position.copy(hU),dU.copy(i.position),dU.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(dU),i.updateMatrixWorld(),n.makeTranslation(-hU.x,-hU.y,-hU.z),uU.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(uU)}}pU.prototype.isPointLightShadow=!0,class extends rU{constructor(e,t,i=0,n=1){super(e,t),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new pU}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}.prototype.isPointLight=!0;class fU extends lU{constructor(){super(new hO(-5,5,5,-5,.5,500))}}fU.prototype.isDirectionalLightShadow=!0;class mU extends rU{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(VL.DefaultUp),this.updateMatrix(),this.target=new VL,this.shadow=new fU}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}mU.prototype.isDirectionalLight=!0;class gU extends rU{constructor(e,t){super(e,t),this.type="AmbientLight"}}gU.prototype.isAmbientLight=!0,class extends rU{constructor(e,t,i=10,n=10){super(e,t),this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}.prototype.isRectAreaLight=!0;class _U{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new BR)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,n=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*n),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*i),t.addScaledVector(s[4],i*n*1.092548),t.addScaledVector(s[5],n*r*1.092548),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],i*r*1.092548),t.addScaledVector(s[8],.546274*(i*i-n*n)),t}getIrradianceAt(e,t){const i=e.x,n=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*n),t.addScaledVector(s[2],1.023328*r),t.addScaledVector(s[3],1.023328*i),t.addScaledVector(s[4],.858086*i*n),t.addScaledVector(s[5],.858086*n*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],.858086*i*r),t.addScaledVector(s[8],.429043*(i*i-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(e,t+3*n);return this}toArray(e=[],t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(e,t+3*n);return e}static getBasisAt(e,t){const i=e.x,n=e.y,r=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-n*n)}}_U.prototype.isSphericalHarmonics3=!0;class yU extends rU{constructor(e=new _U,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}yU.prototype.isLightProbe=!0;class vU{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class xU extends mD{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}let bU;xU.prototype.isInstancedBufferGeometry=!0,class extends JB{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=YB.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){YB.add(e,i),t&&t(i),r.manager.itemEnd(e)})).catch((function(t){n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}.prototype.isImageBitmapLoader=!0;class wU extends JB{constructor(e){super(e)}load(e,t,i,n){const r=this,s=new eU(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(i){try{const e=i.slice(0);(void 0===bU&&(bU=new(window.AudioContext||window.webkitAudioContext)),bU).decodeAudioData(e,(function(e){t(e)}))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}}),i,n)}}(class extends yU{constructor(e,t,i=1){super(void 0,i);const n=(new CR).set(e),r=(new CR).set(t),s=new BR(n.r,n.g,n.b),o=new BR(r.r,r.g,r.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}}).prototype.isHemisphereLightProbe=!0,class extends yU{constructor(e,t=1){super(void 0,t);const i=(new CR).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}.prototype.isAmbientLightProbe=!0;class SU{constructor(e,t,i){let n,r,s;switch(this.binding=e,this.valueSize=i,t){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,n=this.valueSize,r=e*n+n;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==n;++e)i[r+e]=i[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(i,r,0,e,n)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(i,n,e,1-r,t)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let e=t,r=t+t;e!==r;++e)if(i[e]!==i[e+t]){o.setValue(i,n);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let e=i,r=n;e!==r;++e)t[e]=t[n+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)e[t+n]=e[i+n]}_slerp(e,t,i,n){FR.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,r){const s=this._workIndex*r;FR.multiplyQuaternionsFlat(e,s,e,t,e,i),FR.slerpFlat(e,t,e,t,e,s,n)}_lerp(e,t,i,n,r){const s=1-n;for(let o=0;o!==r;++o){const r=t+o;e[r]=e[r]*s+e[i+o]*n}}_lerpAdditive(e,t,i,n,r){for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]+e[i+s]*n}}}const TU="\\[\\]\\.:\\/",EU=new RegExp("["+TU+"]","g"),MU="[^"+TU+"]",IU="[^"+TU.replace("\\.","")+"]",AU=/((?:WC+[\/:])*)/.source.replace("WC",MU),CU=/(WCOD+)?/.source.replace("WCOD",IU),PU=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",MU),kU=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",MU),RU=new RegExp("^"+AU+CU+PU+kU+"$"),LU=["material","materials","bones"];class DU{constructor(e,t,i){this.path=t,this.parsedPath=i||DU.parseTrackName(t),this.node=DU.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new DU.Composite(e,t,i):new DU(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(EU,"")}static parseTrackName(e){const t=RU.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const e=i.nodeName.substring(n+1);-1!==LU.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){const i=function(e){for(let n=0;n<e.length;n++){const r=e[n];if(r.name===t||r.uuid===t)return r;const s=i(r.children);if(s)return s}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let r=t.propertyIndex;if(e||(e=DU.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}const s=e[n];if(void 0===s){const i=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}DU.Composite=class{constructor(e,t,i){const n=i||DU.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},DU.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},DU.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},DU.prototype.GetterByBindingType=[DU.prototype._getValue_direct,DU.prototype._getValue_array,DU.prototype._getValue_arrayElement,DU.prototype._getValue_toArray],DU.prototype.SetterByBindingTypeAndVersioning=[[DU.prototype._setValue_direct,DU.prototype._setValue_direct_setNeedsUpdate,DU.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[DU.prototype._setValue_array,DU.prototype._setValue_array_setNeedsUpdate,DU.prototype._setValue_array_setMatrixWorldNeedsUpdate],[DU.prototype._setValue_arrayElement,DU.prototype._setValue_arrayElement_setNeedsUpdate,DU.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[DU.prototype._setValue_fromArray,DU.prototype._setValue_fromArray_setNeedsUpdate,DU.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class OU{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;const r=t.tracks,s=r.length,o=new Array(s),a={endingStart:Kk,endingEnd:Kk};for(let e=0;e!==s;++e){const t=r[e].createInterpolant(null);o[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const i=this._clip.duration,n=e._clip.duration,r=n/i,s=i/n;e.warp(1,r,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const n=this._mixer,r=n.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const n=(e-r)*i;if(n<0||0===i)return;this._startTime=null,t=i*n}t*=this._updateTimeScale(e);const s=this._updateTime(t),o=this._updateWeight(e);if(o>0){const e=this._interpolants,t=this._propertyBindings;if(2501===this.blendMode)for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(s),t[i].accumulateAdditive(o);else for(let i=0,r=e.length;i!==r;++i)e[i].evaluate(s),t[i].accumulate(n,o)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let n=this.time+e,r=this._loopCount;const s=2202===i;if(0===e)return-1===r||!s||1&~r?n:t-n;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=t||n<0){const i=Math.floor(n/t);n-=t*i,r+=Math.abs(i);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&!(1&~r))return t-n}return n}_setEndings(e,t,i){const n=this._interpolantSettings;i?(n.endingStart=Jk,n.endingEnd=Jk):(n.endingStart=e?this.zeroSlopeAtStart?Jk:Kk:Qk,n.endingEnd=t?this.zeroSlopeAtEnd?Jk:Kk:Qk)}_scheduleFading(e,t,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=t,o[1]=r+e,a[1]=i,this}}(class extends uR{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,s=e._propertyBindings,o=e._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let e=0;e!==r;++e){const r=n[e],l=r.name;let u=c[l];if(void 0!==u)++u.referenceCount,s[e]=u;else{if(u=s[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,l));continue}const n=t&&t._propertyBindings[e].binding.parsedPath;u=new SU(DU.create(i,l,n),r.ValueTypeName,r.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,l),s[e]=u}o[e].resultBuffer=u.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){const n=this._actions,r=this._actionsByClip;let s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=n.length,n.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[t];void 0===s&&(s={},n[t]=s),s[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,o=s[n],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete o[r],0===Object.keys(o).length&&delete s[n]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new FB(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){const n=t||this._root,r=n.uuid;let s="string"==typeof e?ZB.findByName(n,e):e;const o=null!==s?s.uuid:e,a=this._actionsByClip[o];let l=null;if(void 0===i&&(i=null!==s?s.blendMode:2500),void 0!==a){const e=a.actionByRoot[r];if(void 0!==e&&e.blendMode===i)return e;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new OU(this,s,t,i);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}existingAction(e,t){const i=t||this._root,n=i.uuid,r="string"==typeof e?ZB.findByName(i,e):e,s=r?r.uuid:e,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let o=0;o!==i;++o)t[o]._update(n,e,r,s);const o=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)o[e].apply(s);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const e=r.knownActions;for(let i=0,n=e.length;i!==n;++i){const n=e[i];this._deactivateAction(n);const r=n._cacheIndex,s=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,t[r]=s,t.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const e in i){const n=i[e].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[t];if(void 0!==n)for(const e in n){const t=n[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1),class extends Gz{constructor(e,t,i=1){super(e,t),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}.prototype.isInstancedInterleavedBuffer=!0;const NU=new BR,zU=new gL,FU=new gL;function BU(e){const t=[];e&&e.isBone&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,BU(e.children[i]));return t}const UU=new Float32Array(1);new Int32Array(UU.buffer),OF.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(OF.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},tB.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},class extends AF{constructor(e=10,t=10,i=4473924,n=8947848){i=new CR(i),n=new CR(n);const r=t/2,s=e/t,o=e/2,a=[],l=[];for(let e=0,c=0,u=-o;e<=t;e++,u+=s){a.push(-o,0,u,o,0,u),a.push(u,0,-o,u,0,o);const t=e===r?i:n;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new mD;c.setAttribute("position",new aD(a,3)),c.setAttribute("color",new aD(l,3)),super(c,new vF({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends AF{constructor(e){const t=BU(e),i=new mD,n=[],r=[],s=new CR(0,0,1),o=new CR(0,1,0);for(let e=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(s.r,s.g,s.b),r.push(o.r,o.g,o.b))}i.setAttribute("position",new aD(n,3)),i.setAttribute("color",new aD(r,3)),super(i,new vF({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,n=i.getAttribute("position");FU.copy(this.root.matrixWorld).invert();for(let e=0,i=0;e<t.length;e++){const r=t[e];r.parent&&r.parent.isBone&&(zU.multiplyMatrices(FU,r.matrixWorld),NU.setFromMatrixPosition(zU),n.setXYZ(i,NU.x,NU.y,NU.z),zU.multiplyMatrices(FU,r.parent.matrixWorld),NU.setFromMatrixPosition(zU),n.setXYZ(i+1,NU.x,NU.y,NU.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},JB.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),vU.extractUrlBase(e)},JB.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},jR.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},jR.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},jR.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},jR.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},jR.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},aL.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},JD.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},xR.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},xR.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},xR.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},xR.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},xR.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},xR.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},gL.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},gL.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},gL.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new BR).setFromMatrixColumn(this,3)},gL.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},gL.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},gL.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},gL.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},gL.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},gL.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},gL.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},gL.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},gL.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},gL.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},gL.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},gL.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},gL.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},gL.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},gL.prototype.makeFrustum=function(e,t,i,n,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,i,r,s)},gL.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},XD.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},FR.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},FR.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},mL.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},mL.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},mL.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},JL.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},JL.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},JL.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},JL.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},JL.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},JL.barycoordFromPoint=function(e,t,i,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),JL.getBarycoord(e,t,i,n,r)},JL.normal=function(e,t,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),JL.getNormal(e,t,i,n)},iB.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},iB.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new PB(this,e)},iB.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new RB(this,e)},vR.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},vR.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},vR.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},BR.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},BR.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},BR.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},BR.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},BR.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},BR.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},BR.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},BR.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},BR.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},OR.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},OR.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},VL.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},VL.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},VL.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},VL.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},VL.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(VL.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),LD.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(LD.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),dF.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},VD.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(rU.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(rD.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===aR},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(aR)}}}),rD.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?aR:oR),this},rD.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},rD.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},mD.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},mD.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new rD(arguments[1],arguments[2])))},mD.prototype.addDrawCall=function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},mD.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},mD.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},mD.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},mD.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(mD.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Gz.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?aR:oR),this},Gz.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},PB.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},PB.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},PB.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},jz.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Object.defineProperties(eD.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new CR}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(BD.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Vz.prototype.clearTarget=function(e,t,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,n)},Vz.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},Vz.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Vz.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Vz.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Vz.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Vz.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Vz.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Vz.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Vz.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Vz.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Vz.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Vz.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Vz.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Vz.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},Vz.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Vz.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Vz.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Vz.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Vz.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Vz.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Vz.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Vz.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Vz.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Vz.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Vz.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?tR:eR}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(Pz.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(NR.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),class extends VL{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new wU).load(e,(function(e){t.setBuffer(e)})),this},GD.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},GD.prototype.clear=function(e,t,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,i,n)},kR.crossOrigin=void 0,kR.loadTexture=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new nU;r.setCrossOrigin(this.crossOrigin);const s=r.load(e,i,void 0,n);return t&&(s.mapping=t),s},kR.loadTextureCube=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new iU;r.setCrossOrigin(this.crossOrigin);const s=r.load(e,i,void 0,n);return t&&(s.mapping=t),s},kR.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},kR.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:GC}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=GC);var VU={noaa:{scale:[{value:0,color:"#000000"},{value:5,color:"#69E5E4"},{value:10,color:"#4599E9"},{value:15,color:"#0F02E7"},{value:20,color:"#72F44A"},{value:25,color:"#59C239"},{value:30,color:"#3E8B27"},{value:35,color:"#F8F551"},{value:40,color:"#DDBC3F"},{value:45,color:"#EA9736"},{value:50,color:"#E33323"},{value:55,color:"#BF281C"},{value:60,color:"#A72318"},{value:65,color:"#E131F0"},{value:70,color:"#8D54BF"},{value:75,color:"#FEFEFE"}],align:"center"}},jU={jma:{type:"raster",tiles:["https://www.jma.go.jp/bosai/jmatile/data/nowc/${[0].basetime}/none/${[0].validtime}/surf/hrpns/{z}/{x}/{y}.png"],tileSize:256,minzoom:0,maxzoom:10,attribution:'<a href="https://www.jma.go.jp"> Japan Meteorological Agency</a>',catalog:"https://www.jma.go.jp/bosai/jmatile/data/nowc/targetTimes_N1.json",interval:3e5,colors:["#000000","#F2F2FF","#A0D2FF","#218CFF","#0041FF","#FAF500","#FF9900","#FF2800","#B40068"],timestamp:"${[0].basetime}"},rainviewer:{type:"raster",tiles:["${host}${radar.past[-1].path}/256/{z}/{x}/{y}/0/0_1.png"],tileSize:256,minzoom:1,maxzoom:20,attribution:'<a href="https://www.rainviewer.com"> RainViewer</a>',catalog:"https://api.rainviewer.com/public/weather-maps.json",interval:6e5,timestamp:"${radar.past[-1].time}"}};const GU=64,HU=64,WU=new OD(1,-1,1);WU.translate(.5,.5,.5);const qU=new Float32Array([-.002,.002,.01,.002,.002,.01,-.002,.002,-.01,.002,.002,-.01,-.002,-.002,.01,-.002,.002,.01,-.002,-.002,-.01,-.002,.002,-.01,-.002,.002,.01,.002,.002,.01,-.002,-.002,.01,.002,-.002,.01]),$U=new Uint16Array([0,1,2,2,1,3,4,5,6,6,5,7,8,9,10,10,9,11]),ZU=new Float32Array([-.004,.004,.001,.004,.004,.001,-.004,.004,-.001,.004,.004,-.001,-.004,-.004,.001,-.004,.004,.001,-.004,-.004,-.001,-.004,.004,-.001,-.004,.004,.001,.004,.004,.001,-.004,-.004,.001,.004,-.004,.001]),XU=new Uint16Array([0,1,2,2,1,3,4,5,6,6,5,7,8,9,10,10,9,11]),YU="\n    precision highp float;\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n    uniform float time;\n    uniform float scale;\n    attribute vec3 position;\n    attribute vec3 offset;\n\n    void main(void) {\n        vec3 translate = vec3(position.x * scale + offset.x, position.y * scale + offset.y, position.z + mod(offset.z - time + 1.0, 1.0));\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(translate, 1.0);\n    }\n",KU="\n    precision highp float;\n    uniform vec4 color;\n\n    void main(void) {\n        gl_FragColor = color;\n    }\n";function JU(e,t){return void 0===e?t:e}function QU(e,t){let i=t.split(/\.|(?=\[)/)[0];const n=t.slice(i.length).replace(/^\./,"");return Array.isArray(e)&&i.match(/^\[-?\d+\]$/)&&(i=+i.slice(1,-1),i<0&&(i+=e.length)),i in e&&n?QU(e[i],n):e[i]}function eV(e,t){const i=e.match(/\$\{[^}]+\}/g);if(i)for(const n of i)e=e.replace(n,QU(t,n.slice(2,-1)));return e}function tV(e,t,i,n,r,s){const o=1/Math.pow(2,(e-1)/3),a=Math.floor(GU*o),l=Math.floor(HU*o),c=n[0][0],u=[];for(let t=0;t<l;t++)for(let n=0;n<a;n++){const r=i[256*Math.floor((t+.5)/l*256)+Math.floor((n+.5)/a*256)];if(!s==!(128&r)&&(127&r)>=c)for(let i=0;i<Math.pow(2,((127&r)-c)/10)*Math.max(1,e-14);i++)u.push({x:n,y:t})}if(0===u.length)return;const h=new xU,d=new rD(s?ZU:qU,3);h.setAttribute("position",d),h.setIndex(new rD(s?XU:$U,1));const p=new Float32Array(3*u.length),f=new pF(p,3);for(let e=0;e<u.length;e++){const{x:t,y:i}=u[e];f.setXYZ(e,(t+Math.random())/a,(i+Math.random())/l,Math.random())}h.setAttribute("offset",f);const m=new LD(h,r);return m.position.x=t.x,m.position.y=t.y,m.scale.x=t.dx,m.scale.y=t.dy,m.scale.z=2e-4*Math.pow(2,e<10?10-e:e<14?0:.8*(14-e)),m.updateMatrix(),m.matrixAutoUpdate=!1,m.frustumCulled=!1,m}function iV(e){e.geometry instanceof xU&&e.geometry.dispose(),e instanceof yF&&e.dispose()}function nV(e,i){this.constructor.prototype.loadTile.call(this,e,(n=>{const{x:r,y:s,z:o}=e.tileID.canonical,a=`${o}/${r}/${s}`,l=e.texture,c=this._parentLayer,u=this._tileDict;if(l&&c&&!u[a]){const i=this.map.painter.context.gl,n=i.createFramebuffer(),[r,s]=l.size,h=new Uint8Array(r*s*4),d=e._dbz=new Uint8Array(r*s),p=e._mercatorBounds=function(e){const{x:i,y:n,z:r}=e,s=Math.pow(2,r),o=i/s*360-180,a=180*Math.atan(Math.sinh(Math.PI*(1-2*n/s)))/Math.PI,l=(i+1)/s*360-180,c=180*Math.atan(Math.sinh(Math.PI*(1-2*(n+1)/s)))/Math.PI,u=t.MercatorCoordinate.fromLngLat([o,a]),h=t.MercatorCoordinate.fromLngLat([l,c]);return{x:u.x,y:u.y,dx:h.x-u.x,dy:h.y-u.y}}(e.tileID.canonical);if(i.bindFramebuffer(i.FRAMEBUFFER,n),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,l.texture,0),i.readPixels(0,0,r,s,i.RGBA,i.UNSIGNED_BYTE,h),i.bindFramebuffer(i.FRAMEBUFFER,null),i.deleteFramebuffer(n),c._colors){const e=c._colors.map((e=>parseInt(e.replace("#","0x"),16)));for(let t=0;t<d.length;t++){const i=256*(256*h[4*t]+h[4*t+1])+h[4*t+2];for(let n=0;n<e.length;n++)if(i===i[n]){d[t]=n;break}}}else for(let e=0;e<d.length;e++)d[e]=h[4*e];const f=c._zoomGroups[o-1],m=function(e,t,i,n,r){const s=1/Math.pow(2,(e-1)/3),o=Math.floor(GU*s),a=Math.floor(HU*s),l=n[0][0],c=[];for(let e=0;e<a;e++)for(let t=0;t<o;t++){const r=127&i[256*Math.floor((e+.5)/a*256)+Math.floor((t+.5)/o*256)];if(r>=l)for(let i=1;i<n.length;i++)if(r<n[i][0]){c.push({x:t,y:e,p:i});break}}if(0===c.length)return;const u=new yF(WU,r,c.length);for(let e=0;e<c.length;e++){const{x:t,y:i,p:r}=c[e],s=(new gL).makeScale(1/o,1/a,1).setPosition(t/o,i/a,0);u.setMatrixAt(e,s),u.setColorAt(e,n[r][1])}return u.position.x=t.x,u.position.y=t.y,u.scale.x=t.dx,u.scale.y=t.dy,u.scale.z=2e-4*Math.pow(2,e<10?10-e:e<14?0:.8*(14-e)),u.updateMatrix(),u.matrixAutoUpdate=!1,u.renderOrder=1,u}(o,p,d,c._scaleColors,c._meshMaterial);m&&(e._boxMesh=m,f.add(m));const g=tV(o,p,d,c._scaleColors,c._rainMaterial);g&&(e._rainMesh=g,f.add(g));const _=tV(o,p,d,c._scaleColors,c._snowMaterial,!0);_&&(e._snowMesh=_,f.add(_)),u[a]=e}i(n)}))}function rV(e,t){this.constructor.prototype.unloadTile.call(this,e,(i=>{const{x:n,y:r,z:s}=e.tileID.canonical,o=`${s}/${n}/${r}`,a=e._boxMesh,l=e._rainMesh,c=e._snowMesh;a&&(a.parent.remove(a),iV(a),delete e._boxMesh),l&&(l.parent.remove(l),iV(l),delete e._rainMesh),c&&(c.parent.remove(c),iV(c),delete e._snowMesh),delete this._tileDict[o],t(i)}))}class sV extends t.Evented{constructor(e){super(),this.id=e.id,this.type="custom",this.renderingMode="3d",this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this.source=e.source||"rainviewer",this.scale=e.scale||"noaa",this.rainColor=e.rainColor||"#ccf",this.snowColor=e.snowColor||"#fff",this.meshOpacity=JU(e.meshOpacity,.1),this.repaint=JU(e.repaint,!0),this._interval=jU[this.source].interval,this._colors=jU[this.source].colors,this._onZoom=this._onZoom.bind(this)}onAdd(e,t){this._parseColor=e.painter.context.clearColor.default.constructor.parse,this._scene=new jz,this._camera=new UD,this._directionalLight=new mU(16777215),this._directionalLight.position.set(0,-70,100).normalize(),this._scene.add(this._directionalLight),this._ambientLight=new gU(16777215,.4),this._scene.add(this._ambientLight),this._meshMaterial=new DB({opacity:this.meshOpacity,transparent:this.meshOpacity<1});let i=this._parseColor(this.rainColor);this._rainMaterial=new dO({uniforms:{time:{type:"f",value:0},scale:{type:"f",value:1},color:{type:"v4",value:new OR(i.r,i.g,i.b,i.a)}},vertexShader:YU,fragmentShader:KU,transparent:i.a<1,side:JC}),i=this._parseColor(this.snowColor),this._snowMaterial=new dO({uniforms:{time:{type:"f",value:0},scale:{type:"f",value:1},color:{type:"v4",value:new OR(i.r,i.g,i.b,i.a)}},vertexShader:YU,fragmentShader:KU,transparent:i.a<1,side:JC}),this._baseZoom=Math.round(e.getZoom()),this._zoomGroups=[];for(let e=0;e<=24;e++)this._zoomGroups[e]=new Oz,this._zoomGroups[e].visible=e===this._baseZoom,this._scene.add(this._zoomGroups[e]);const{scale:n,align:r}=VU[this.scale];this._scaleColors=n.map((({value:e,color:t},i,n)=>("center"===r&&(e=(e+(i<n.length-1?n[i+1].value:1/0))/2),[e+32,new CR(t)]))),this._map=e,this._map.setLayerZoomRange(this.id,this.minzoom,this.maxzoom),this._map.on("zoom",this._onZoom),this._renderer=new Vz({canvas:e.getCanvas(),context:t,antialias:!0}),this._renderer.autoClear=!1,this._refreshSource(),this._timer=setInterval(this._refreshSource.bind(this),this._interval)}onRemove(){delete this._parseColor,this._scene.remove(this._directionalLight),this._directionalLight.dispose(),delete this._directionalLight,this._scene.remove(this._ambientLight),this._ambientLight.dispose(),delete this._ambientLight,this._meshMaterial.dispose(),delete this._meshMaterial,this._rainMaterial.dispose(),delete this._rainMaterial,delete this._baseZoom;for(let e=0;e<=24;e++)this._scene.remove(this._zoomGroups[e]);delete this._zoomGroups,delete this._scaleColors,delete this._camera,delete this._scene,this._renderer.dispose(),delete this._renderer,this._map.off("zoom",this._onZoom),this._removeSource(),delete this._map,clearInterval(this._timer),delete this._timer}render(e,t){const i=this._map.getZoom();this._rainMaterial.uniforms.time.value=6e-4*performance.now(),this._rainMaterial.uniforms.scale.value=Math.pow(2,this._baseZoom-i-(i>=10.5?1:0)),this._snowMaterial.uniforms.time.value=15e-5*performance.now(),this._snowMaterial.uniforms.scale.value=Math.pow(2,this._baseZoom-i-(i>=10.5?1:0)),this._camera.projectionMatrix=(new gL).fromArray(t),this._renderer.resetState(),this._renderer.render(this._scene,this._camera),this.repaint&&this._map.triggerRepaint()}_onZoom(){this._baseZoom=Math.round(this._map.getZoom());for(let e=0;e<=24;e++)this._zoomGroups[e].visible=e===this._baseZoom}_refreshSource(){const e=this.source,{tiles:t,tileSize:i,minzoom:n,maxzoom:r,attribution:s,catalog:o,timestamp:a}=jU[e];fetch(o).then((e=>e.json())).then((o=>{const l=this._map;this._removeSource(),l.addSource(e,{type:"raster",tiles:t.map((e=>eV(e,o))),tileSize:i,minzoom:n,maxzoom:r,attribution:s});const c=l.getSource(e);c._parentLayer=this,c._tileDict={},c.loadTile=nV,c.unloadTile=rV,l.addLayer({id:e,type:"raster",source:e,paint:{"raster-opacity":0}},this.id),this.fire({type:"refresh",timestamp:+eV(a,o)})}))}_removeSource(){const e=this.source,t=this._map,i=t.getSource(e);i&&(t.removeLayer(e),t.removeSource(e),delete i._parentLayer)}setRainColor(e){if(this.rainColor=e||"#ccf",this._parseColor&&this._rainMaterial){const{r:e,g:t,b:i,a:n}=this._parseColor(this.rainColor);this._rainMaterial.uniforms.color.value=new OR(e,t,i,n),this._rainMaterial.transparent=n<1}return this}setSnowColor(e){if(this.snowColor=e||"#fff",this._parseColor&&this._snowMaterial){const{r:e,g:t,b:i,a:n}=this._parseColor(this.snowColor);this._snowMaterial.uniforms.color.value=new OR(e,t,i,n),this._snowMaterial.transparent=n<1}return this}setMeshOpacity(e){return this.meshOpacity=JU(e,.1),this._meshMaterial&&(this._meshMaterial.opacity=e,this._meshMaterial.transparent=e<1),this}getLegendHTML(){return['<div style="font-size: 10px; line-height: 14px;"><div>dBZ</div>',...VU[this.scale].scale.slice(1).reverse().map((e=>`\n                <div>\n                    <div style="display: inline-block; vertical-align: top; width: 14px; height: 14px; background-color: ${e.color}; border: solid 0.5px #aaa;"></div>\n                    <div style="display: inline-block; vertical-align: top;">${e.value}</div>\n                </div>\n            `)),"</div>"].join("")}}n().accessToken="pk.eyJ1IjoidXJiaXp0b24iLCJhIjoiY2xsZTZvaXd0MGc4MjNzbmdseWNjM213eiJ9.z1YeFXYSbaMe93SMT6muVg";const oV=new(n().Map)({container:"map",style:"mapbox://styles/urbizton/clve9aeu900c501rd7qcn14q6",center:[-94.53,41.99],zoom:6.4,maxZoom:18});let aV,lV;async function cV(e){var t,i;cw&&(e=await async function(e){if(console.log("Filtering data to study areas..."),console.log(e),!e)return;let t=await ew("./assets/I35I80_Lanes_100ft.geojson");const i=await async function(e,t,i){const n=new Fb(138137),r=new Map;return t.features.map((e=>{e.geometry.coordinates.map((t=>{const i=n.add(t[0],t[1]);r.set(i,e)}))})),n.finish(),{type:"FeatureCollection",features:e.features.filter((e=>{const[t,i]=e.geometry.coordinates;return Zb(n,t,i,1,.2).length>0}))}}(e,t);return console.log("Data filtering complete."),tw(),iw(),console.log(i),i}(e)),oV.getLayer("latestLayer")&&oV.removeLayer("latestLayer"),oV.getSource("latestSource")&&oV.removeSource("latestSource"),console.log(e),t=e,oV.addSource("latestSource",{type:"geojson",data:t,generateId:!0}),oV.addLayer({id:"latestLayer",type:"circle",source:"latestSource",layout:{visibility:"visible"},paint:{"circle-color":["match",["get","classification"],"Undefined","#554f56","Bare","#80B932","Partly","#EFC44E","Full","#E51000","#554f56"],"circle-radius":["match",["get","type"],"RWIS",["case",["boolean",["feature-state","hover"],!1],16,14],["case",["boolean",["feature-state","hover"],!1],12,6]],"circle-stroke-width":["case",["boolean",["feature-state","hover"],!1],2,.5],"circle-stroke-color":"#242225"}}),aV=e,function(e){let t=0,i=0;for(let n=0;n<e.length;n++)t+=e[n][0],i+=e[n][1];const n=t/e.length,r=i/e.length,s=!document.getElementById("arrow-img").classList.contains("flipped"),o={};let a=document.getElementById("console").clientWidth-200;o.left=s?0:a,console.log(a),oV.easeTo({padding:o,center:[n,r],zoom:6.5})}("FeatureCollection"===(i=aV).type?i.features.map((e=>e.geometry.coordinates)):"Feature"===i.type?[i.geometry.coordinates]:[])}function uV(e){oV.getLayer("latestInterpolationLayer")&&oV.removeLayer("latestInterpolationLayer"),oV.getSource("latestInterpolation")&&oV.removeSource("latestInterpolation"),function(e){oV.addSource("latestInterpolation",{type:"geojson",data:e,generateId:!0,tolerance:0}),oV.addLayer({id:"latestInterpolationLayer",type:"line",source:"latestInterpolation",layout:{visibility:"visible","line-cap":"square","line-join":"round","line-sort-key":["match",["get","classification"],"Undefined",0,"Bare",4,"Partly",3,"Full",2,0]},paint:{"line-color":["match",["get","classification"],"Undefined","#554f56","Bare","#80B932","Partly","#EFC44E","Full","#E51000","#554f56"],"line-width":3,"line-offset":2}},"latestLayer")}(e),lV=e}oV.addControl(new(n().NavigationControl)({visualizePitch:!0}),"bottom-right"),oV.addControl(new(n().ScaleControl)({maxWidth:300,unit:"imperial"})),oV.addControl(new(n().FullscreenControl)({container:document.querySelector("body")}),"bottom-right"),document.getElementById("center-iowa").addEventListener("click",(function(e){e.preventDefault(),oV.flyTo({center:[-94.53,41.99],zoom:6.7,pitch:0,bearing:0})})),oV.on("style.load",(()=>{oV.resize(),console.log("Map resized"),cV(aV),uV(lV)})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll('.map-styles input[type="radio"]').forEach((e=>{e.addEventListener("click",(function(){if(this.checked){e=this.value,oV.setStyle("mapbox://styles/urbizton/"+e),console.log("Map style set to:",e)}var e}))}))}));const hV=document.getElementById("pointID"),dV=document.getElementById("pointTimestamp"),pV=document.getElementById("pointImage"),fV=(zC=new OC(document.getElementById("donutchart"),NC),zC);let mV,gV=null,_V=!1,yV={CAM:!1},vV=!1;function xV(e){return cn.fromSeconds(e,{zone:"America/Chicago"}).toLocaleString(cn.DATETIME_FULL)}oV.on("mouseleave","latestLayer",(()=>{oV.getCanvas().style.cursor="default",gV&&oV.setFeatureState({source:"latestSource",id:gV},{hover:!1}),_V?_V&&(yV.CAM=!1,hV.textContent=yV.avlID,dV.textContent=yV.timestamp,pV.src=yV.image,pV.parentNode.style.display="block",UC(fV),VC(fV,yV.classes),oV.setFeatureState({source:"latestSource",id:yV.specificID},{hover:!0})):(hV.textContent="",dV.textContent="",pV.src="",pV.parentNode.style.display="none",UC(fV),vV=!1)})),oV.on("click","latestLayer",(e=>{let t=oV.queryRenderedFeatures(e.point,{layers:["latestLayer"]})[0].geometry.coordinates;gw(),_V&&oV.setFeatureState({source:"latestSource",id:yV.specificID},{hover:!1});const i=!document.getElementById("arrow-img").classList.contains("flipped"),n={};let r=document.getElementById("console").clientWidth-200;n.left=i?0:r,oV.easeTo({center:t,padding:n,duration:600}),_V=!0;let s=e.features[0].properties;var o=document.getElementById("img-buttons");if("AVL"==s.type)console.log(s),yV={specificID:e.features[0].id,avlID:s.id,timestamp:xV(s.timestamp),classification:s.classification,classes:s.class,image:s.url},o.style.display="none";else{o.style.display="flex",vV=!0;let t=s.recentangle;yV={type:s.type,specificID:e.features[0].id,avlID:s.id,timestamp:xV(s.timestamp),classification:s.classification,classes:JSON.stringify(JSON.parse(s.angles)[t].class),image:JSON.parse(s.angles)[t].url}}hV.textContent=yV.avlID,dV.textContent=yV.timestamp,pV.src=yV.image,pV.parentNode.style.display="block",UC(fV),VC(fV,yV.classes)})),oV.on("mousemove","latestLayer",(e=>{oV.getCanvas().style.cursor="pointer";const t=oV.queryRenderedFeatures(e.point,{layers:["latestLayer"]});if(t.length>0){const e=t[0],i=e.id;if(i!==gV){let t;vV=!1,gV&&oV.setFeatureState({source:"latestSource",id:gV},{hover:!1}),oV.setFeatureState({source:"latestSource",id:i},{hover:!0}),gV=i,hV.textContent=e.properties.id,dV.textContent=xV(e.properties.timestamp),"RWIS"==e.properties.type?(vV=!0,t=e.properties.recentangle,pV.src=JSON.parse(e.properties.angles)[t].url,pV.parentNode.style.display="block",UC(fV),VC(fV,JSON.stringify(JSON.parse(e.properties.angles)[t].class))):(pV.src=e.properties.url,pV.parentNode.style.display="block",UC(fV),VC(fV,e.properties.class))}}else oV.getCanvas().style.cursor="default",hV.textContent="",dV.textContent="",pV.src="",pV.parentNode.style.display="none",UC(fV),null!==gV&&(oV.setFeatureState({source:"latestSource",id:gV},{hover:!1}),gV=null)})),setTimeout((()=>{mV=document.getElementById("console").offsetWidth}),1e3);let bV=!1;window.addEventListener("mousedown",(e=>{"console"===e.target.id&&(bV=!0)})),window.addEventListener("mousemove",(()=>{bV&&function(){const e=oV.getCenter();let t=oV.getZoom();const i=document.getElementById("console").offsetWidth;if(i!==mV){const n=i-mV;t*=(mV/i)**.1;const r=oV.project(e),s=r.x-.7*n,o=r.y,a=oV.unproject([s,o]);oV.setCenter(a),oV.setZoom(t),mV=i}}()})),window.addEventListener("mouseup",(()=>{bV=!1})),document.querySelector("#realtime-toggle").addEventListener("change",(e=>{if(e.target.checked){const e=new sV({id:"rain",source:"rainviewer",meshOpacity:0,rainColor:"hsla(213, 76%, 73%, 0.86)",snowColor:"hsla(0, 0%, 100%, 1)",scale:"noaa"});oV.addLayer(e),e.on("refresh",(e=>{var t;console.log(`Last Weather Update: ${t=e.timestamp,new Date(1e3*t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`)})),oV.removeLayer("latestLayer"),oV.removeSource("latestSource")}else oV.removeLayer("rain")})),oV.on("idle",(()=>{if(!oV.getLayer("latestLayer")||!oV.getLayer("latestInterpolationLayer"))return void(document.getElementById("menu").style.display="none");document.getElementById("menu").style.display="flex";const e=["latestLayer","latestInterpolationLayer"];for(const t of e){if(document.getElementById(t))continue;const e=document.createElement("a");let i;e.id=t,e.href="#",i="latestLayer"==t?"Actual":"Interpolated",e.textContent=i,e.className="active",e.onclick=function(e){const i=t;e.preventDefault(),e.stopPropagation(),"visible"===oV.getLayoutProperty(i,"visibility")?(oV.setLayoutProperty(i,"visibility","none"),this.className=""):(this.className="active",oV.setLayoutProperty(i,"visibility","visible"))},document.getElementById("menu").appendChild(e)}}));var wV=i(365),SV={};SV.styleTagTransform=Pb(),SV.setAttributes=Mb(),SV.insert=Tb().bind(null,"head"),SV.domAPI=wb(),SV.insertStyleElement=Ab(),xb()(wV.A,SV),wV.A&&wV.A.locals&&wV.A.locals})()})();